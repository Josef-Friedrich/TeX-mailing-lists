From ms@artcom-gmbh.de  Tue Jul  8 16:55:17 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Tue, 8 Jul 2003 17:55:17 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
Message-ID: <20030708155517.GV29868@artcom8.artcom-gmbh.de>

Hi,
current pdfTeX will not embed pdfs with a newer version than the
one to be produced. I want to make this behaviour configurable
through pdftex.cfg (and a corresponding primitive). pdfTeX would
then only emit a warning but embed the pdf anyway (like older
versions did). Reason is to be backwards-compatible: We have
installations where we want to upgrade the pdfTeX-installation
but not the TeX-producing application.

Objections?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Wed Jul  9 11:24:04 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 9 Jul 2003 12:24:04 +0200
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
Message-ID: <20030709102404.GA29868@artcom8.artcom-gmbh.de>

Hi,
the pdfTeX project needs a system for tracking bugs, patches and
feature requests (whenever I integrate all the latest patches and
look for open bugs I fear I forget one). 

We could of course set up the needed software by ourself, but
there are already places that offer the needed services. I did a
quick survey:
- Sourceforge (http://sf.net): 
    - Tracker for bugs, support requests, patches, feature requests
    - Limited to OSI-compatible software (which pdfTeX is)
- Savannah (savannah.nongnu.org): 
    - Tracker for bugs, support requests, patches
    - Limited to GPL-compatible software (which pdfTeX is)
    - Emphasises on freeness
- Berlios (berlios.de):
    - Tracker for bugs, support requests, patches
    - Not limited to OSI-compatible software (which pdfTeX is)
    - It seems you can't automatically get mail about new
      bugs/patches 
    - Management is german

It seems Sourceforge is offering the most with the least strings
attached.

I propose we set up pdfTeX at Sourceforge in the near future
(post-Hawaii) for project management but keep the sources in the
p4 repository at DANTE/TeXlive (it works perfectly).

Comments?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From pragma@wxs.nl  Wed Jul  9 14:32:46 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 09 Jul 2003 09:32:46 -0400
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
In-Reply-To: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
Message-ID: <5.2.0.9.1.20030709093022.02c39a50@localhost>

At 12:24 09/07/2003 +0200, you wrote:
>Hi,
>the pdfTeX project needs a system for tracking bugs, patches and
>feature requests (whenever I integrate all the latest patches and
>look for open bugs I fear I forget one).
>
>We could of course set up the needed software by ourself, but
>there are already places that offer the needed services. I did a
>quick survey:
>- Sourceforge (http://sf.net):
>     - Tracker for bugs, support requests, patches, feature requests
>     - Limited to OSI-compatible software (which pdfTeX is)
>- Savannah (savannah.nongnu.org):
>     - Tracker for bugs, support requests, patches
>     - Limited to GPL-compatible software (which pdfTeX is)
>     - Emphasises on freeness
>- Berlios (berlios.de):
>     - Tracker for bugs, support requests, patches
>     - Not limited to OSI-compatible software (which pdfTeX is)
>     - It seems you can't automatically get mail about new
>       bugs/patches
>     - Management is german
>
>It seems Sourceforge is offering the most with the least strings
>attached.
>
>I propose we set up pdfTeX at Sourceforge in the near future
>(post-Hawaii) for project management but keep the sources in the
>p4 repository at DANTE/TeXlive (it works perfectly).
>
>Comments?

maybe we schould discuss this at the next dante meeting; if i remember 
right Thomas Koch has been talking to Berlios people already about setting 
up something for tex projects, so we should investigate that option in mode 
detail, i.e. pdftex can then be the first project there

Hans

-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From ms@artcom-gmbh.de  Wed Jul  9 15:21:46 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 9 Jul 2003 16:21:46 +0200
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
In-Reply-To: <5.2.0.9.1.20030709093022.02c39a50@localhost>
References: <20030709102404.GA29868@artcom8.artcom-gmbh.de> <5.2.0.9.1.20030709093022.02c39a50@localhost>
Message-ID: <20030709142146.GG29868@artcom8.artcom-gmbh.de>

On 2003-07-09 09:32:46 -0400, Hans Hagen wrote:
> At 12:24 09/07/2003 +0200, you wrote:
> >the pdfTeX project needs a system for tracking bugs, patches and
> >feature requests (whenever I integrate all the latest patches and
> >look for open bugs I fear I forget one).
> >
> >We could of course set up the needed software by ourself, but
> >there are already places that offer the needed services. I did a
> >quick survey:
> >- Sourceforge (http://sf.net):
> >    - Tracker for bugs, support requests, patches, feature requests
> >    - Limited to OSI-compatible software (which pdfTeX is)
> >- Savannah (savannah.nongnu.org):
> >    - Tracker for bugs, support requests, patches
> >    - Limited to GPL-compatible software (which pdfTeX is)
> >    - Emphasises on freeness
> >- Berlios (berlios.de):
> >    - Tracker for bugs, support requests, patches
> >    - Not limited to OSI-compatible software (which pdfTeX is)
> >    - It seems you can't automatically get mail about new
> >      bugs/patches
> >    - Management is german
> >
> >It seems Sourceforge is offering the most with the least strings
> >attached.
> >
> >I propose we set up pdfTeX at Sourceforge in the near future
> >(post-Hawaii) for project management but keep the sources in the
> >p4 repository at DANTE/TeXlive (it works perfectly).
> >
> >Comments?
> 
> maybe we schould discuss this at the next dante meeting; if i remember 
> right Thomas Koch has been talking to Berlios people already about setting 
> up something for tex projects, so we should investigate that option in mode 
> detail, i.e. pdftex can then be the first project there

IIRC the move for Berlios is mainly because Sourceforge and
Savannah accept only OSI-compatible software, which (currently)
rules out everything licensed under the LPPL, while Berlios is
not so dogmatic (they host pdftex.def).

Thomas?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 10 13:01:10 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 14:01:10 +0200
Subject: [NTG-pdftex] PDF inclusion with annotations
In-Reply-To: <m38ysy60pi.fsf@h081217002064.dyn.cm.kabsi.at>
References: <m38ysy60pi.fsf@h081217002064.dyn.cm.kabsi.at>
Message-ID: <20030710120110.GL29868@artcom8.artcom-gmbh.de>

On 2003-05-23 01:06:17 +0200, Andreas Matthias wrote:
> Last month on pdftex mailing list we had a short discussion, whether
> annotations of external PDFs could be copied when including PDFs.
> I gave it a try and now I have a first partial success. The code
> is far from being complete and there are still a lot of bugs in it.
> Nevertheless I think it is the right time now to show you the code,
> so we can discuss whether this is the right way to go on.
> 
> You can download the patches at:
> 
> http://stud3.tuwien.ac.at/~e9225580/pdftex-1.10b-incl-annot.tar.bz2

Andreas,
thank you very much for your patch (and sorry for the long
silence [and the argument lately]).

> (1)While reading the image (function read_pdf_info), the annotations
> of this image are read, too, and a map with all relevant details
> about the annotations is set up. (2)While writing the reference
> (/Im1 Do) to the content stream (function out_image), a dummy
> annotation node is created to get a correct /Annots array. Those
> dummy annotations nodes are caught during module @<Flush out PDF
> annotations@> and are just delete; no dummy annotation object it
> written out. (3)Eventually in function epdf_write all annotation
> objects of this image are copied are written out.

I must confess I have not cared for annotations yet so I just
hope that this is correct (it certainly sounds so) and leave that
to the experts.

> Another important this which happens within the function out_image,
> is the calculation to the new coordinates of the annotation's /Rect.
> There are no big problems if an images is scaled with the help of
> <rule spec> of \pdfximage. But their are a lot of problems if
> macro packages do something like \pdfliteral{.5 0 0 .5 0 0 cm}
> for scaling and similar things for rotating images. To calculate
> the coordinates of /Rect, pdftex must know exactly which coordinate
> transformations are actually taking place. So I introduced two
> new primitives: \pdfsetctm and \pdfresetctm. 

This I find much more interesting. 

[...]

> Since TeX does not have a function to scan floating-point numbers,
> I used scan_dimen as a work around to scan the arguments of \pdfsetctm.
> That's why you must write
> 
>    \pdfsetctm 0bp 1bp -1bp 0bp 0bp
> 
> so far. It should be no problem to change this in the future.

This could be added.

I'm not going to add the patch to the distribution now but think
it's an improvement we should want; what do the others say?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 10 13:07:33 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 14:07:33 +0200
Subject: [NTG-pdftex] pdftex.ch: pdf_set_rule() redundant output
In-Reply-To: <Pine.LNX.4.55.0305082120390.3330@hahepc1.hahe>
References: <Pine.LNX.4.55.0305082120390.3330@hahepc1.hahe>
Message-ID: <20030710120733.GM29868@artcom8.artcom-gmbh.de>

On 2003-05-08 21:29:24 +0200, Hartmut Henkel wrote:
> The patch would be easy, see below.

It's in (#3305)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 10 13:35:48 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 14:35:48 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030605211043.GA9752@linux.vpn.uni-freiburg.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de>
Message-ID: <20030710123548.GQ29868@artcom8.artcom-gmbh.de>

On 2003-06-05 23:10:43 +0200, Heiko Oberdiek wrote:
> Sorry I had forgotten the patches.

It's in (#3306):
- New readonly primitive \pdfshellescape which can be used to test if the
  \write18 feature is enabled or not (it expands to "1" if it's enabled and to
  0 if it's not)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 10 13:53:12 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 14:53:12 +0200
Subject: [NTG-pdftex] Patch OutlineAttr
In-Reply-To: <20030605203513.GA8148@linux.vpn.uni-freiburg.de>
References: <20030605203513.GA8148@linux.vpn.uni-freiburg.de>
Message-ID: <20030710125312.GR29868@artcom8.artcom-gmbh.de>

On 2003-06-05 22:35:13 +0200, Heiko Oberdiek wrote:
> Since PDF 1.3/1.4 further entries are supported in the outline
> item dictionary: /SE, /C, /F. Especially the last to keys can
> be interesting. Currently there is no support in pdfTeX to set
> these entries. Therefore I have added the possibility to
> specify further attributes to the \pdfoutline command:
>   \pdfoutline <outline spec>
>   <outline spec> --> <attr spec> <action spec>
>                      [count <number>] <general text>

Hi,
it's in (#3307):
- The syntax for outlines has been extended to allow attributes:
  <outline spec> --> <attr spec> <action spec> [count <number>] <general text>

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 10 13:57:25 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 14:57:25 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030710123548.GQ29868@artcom8.artcom-gmbh.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de>
Message-ID: <20030710125725.GS29868@artcom8.artcom-gmbh.de>

On 2003-07-10 14:35:48 +0200, Martin Schröder wrote:
> - New readonly primitive \pdfshellescape which can be used to test if the

Thinking further (and being reminded by Rolf): Is there a reason
why this can _not_ be called \shellescape? It's got nothing to do
with pdf (and would be usefull in all web2c-based TeX engines, no
matter what they are called).

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 10 14:49:50 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 10 Jul 2003 15:49:50 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030710125725.GS29868@artcom8.artcom-gmbh.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de> <20030710125725.GS29868@artcom8.artcom-gmbh.de>
Message-ID: <20030710134950.GA1057@linux.vpn.uni-freiburg.de>

On Thu, Jul 10, 2003 at 02:57:25PM +0200, Martin Schroeder wrote:

> On 2003-07-10 14:35:48 +0200, Martin Schröder wrote:
> > - New readonly primitive \pdfshellescape which can be used to test if the
> 
> Thinking further (and being reminded by Rolf): Is there a reason
> why this can _not_ be called \shellescape? It's got nothing to do
> with pdf (and would be usefull in all web2c-based TeX engines, no
> matter what they are called).

\write18 is a property of web2c-based TeX engines, so
\shellescape is the better name and it would be even better,
if this can be added to the other web2c-based TeX engines, too.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 10 15:06:10 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 16:06:10 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030710134950.GA1057@linux.vpn.uni-freiburg.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de> <20030710125725.GS29868@artcom8.artcom-gmbh.de> <20030710134950.GA1057@linux.vpn.uni-freiburg.de>
Message-ID: <20030710140610.GU29868@artcom8.artcom-gmbh.de>

On 2003-07-10 15:49:50 +0200, Heiko Oberdiek wrote:
> On Thu, Jul 10, 2003 at 02:57:25PM +0200, Martin Schroeder wrote:
> > On 2003-07-10 14:35:48 +0200, Martin Schröder wrote:
> > > - New readonly primitive \pdfshellescape which can be used to test if the
> > 
> > Thinking further (and being reminded by Rolf): Is there a reason
> > why this can _not_ be called \shellescape? It's got nothing to do
> > with pdf (and would be usefull in all web2c-based TeX engines, no
> > matter what they are called).
> 
> \write18 is a property of web2c-based TeX engines, so
> \shellescape is the better name and it would be even better,
> if this can be added to the other web2c-based TeX engines, too.

Same here. Olaf? Or does this belong to tex-implementors?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 10 15:13:49 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 10 Jul 2003 16:13:49 +0200
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
In-Reply-To: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
References: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
Message-ID: <20030710141349.GA1258@linux.vpn.uni-freiburg.de>

On Wed, Jul 09, 2003 at 12:24:04PM +0200, Martin Schroeder wrote:

> the pdfTeX project needs a system for tracking bugs, patches and
> feature requests (whenever I integrate all the latest patches and
> look for open bugs I fear I forget one). 

Very good idea.
Also there is then one place for patches, information about
development, ... and these are not distributed about a lot
of mailing lists, newsgroups, ...

> We could of course set up the needed software by ourself, but
> there are already places that offer the needed services. I did a
> quick survey:
> - Sourceforge (http://sf.net): [...]
> - Savannah (savannah.nongnu.org): [...]
> - Berlios (berlios.de): [...]

pdftex.def is already hosted there.

>     - It seems you can't automatically get mail about new
>       bugs/patches

Also I have not found an automatic solution that only needs
to be enabled. Perhaps a cronjob can be generated there that
mails differences of the project summary page, if there are any.

>     - Management is german

An advantage ;-)

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 10 16:29:13 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 17:29:13 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
In-Reply-To: <20030708155517.GV29868@artcom8.artcom-gmbh.de>
References: <20030708155517.GV29868@artcom8.artcom-gmbh.de>
Message-ID: <20030710152913.GY29868@artcom8.artcom-gmbh.de>

On 2003-07-08 17:55:17 +0200, Martin Schröder wrote:
> one to be produced. I want to make this behaviour configurable
> through pdftex.cfg (and a corresponding primitive). pdfTeX would

Currently the primitive is tentatively named
\pdfoptionpdfversionerrorlevel. Any better idea?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 10 17:06:29 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 10 Jul 2003 18:06:29 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
In-Reply-To: <20030710152913.GY29868@artcom8.artcom-gmbh.de>
References: <20030708155517.GV29868@artcom8.artcom-gmbh.de> <20030710152913.GY29868@artcom8.artcom-gmbh.de>
Message-ID: <20030710160629.GA1857@linux.vpn.uni-freiburg.de>

On Thu, Jul 10, 2003 at 05:29:13PM +0200, Martin Schroeder wrote:

> On 2003-07-08 17:55:17 +0200, Martin Schröder wrote:
> > one to be produced. I want to make this behaviour configurable
> > through pdftex.cfg (and a corresponding primitive). pdfTeX would
> 
> Currently the primitive is tentatively named
> \pdfoptionpdfversionerrorlevel. Any better idea?

What is the semantics?

pdfTeX generates 1.x and an image has version 1.y:
x := \pdfoptionpdfversion
z := \pdfoptionpdfversionerrorlevel

x >= y
  no problems

y > x
  ??
  * Abort with error message / continuing with warning
    depending on z.
  * Accepting some images with versions smaller 1.z or 1.(x+z)
    with warning, aborting otherwise.

What happens, if there will be PDF 2.? some day?

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 10 17:17:36 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 10 Jul 2003 18:17:36 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
In-Reply-To: <20030710160629.GA1857@linux.vpn.uni-freiburg.de>
References: <20030708155517.GV29868@artcom8.artcom-gmbh.de> <20030710152913.GY29868@artcom8.artcom-gmbh.de> <20030710160629.GA1857@linux.vpn.uni-freiburg.de>
Message-ID: <20030710161736.GZ29868@artcom8.artcom-gmbh.de>

On 2003-07-10 18:06:29 +0200, Heiko Oberdiek wrote:
> pdfTeX generates 1.x and an image has version 1.y:
> x := \pdfoptionpdfversion
> z := \pdfoptionpdfversionerrorlevel
> 
> x >= y
>   no problems
> 
> y > x
>   ??
>   * Abort with error message / continuing with warning
>     depending on z.

Yes. pdfTeX <1.10a didnn't care for x and y; you only got a
warning from the xpdf layer when y was greater than the y
supported by xpdf. I want to get that behaviour back to be
backwards-compatible.

[...]

> What happens, if there will be PDF 2.? some day?

Then we will need a major rewrite of pdfTeX anyway, as this will
break almost any pdf consuming application anyway (see PDFRef H.1). 
Of course a float for x would be nice, but it's currently not
needed and there is no code in pdfTeX yet to scan float
parameters.

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From olaf@infovore.xs4all.nl  Thu Jul 10 21:05:25 2003
From: olaf@infovore.xs4all.nl (Olaf Weber)
Date: 10 Jul 2003 22:05:25 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030710140610.GU29868@artcom8.artcom-gmbh.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de>
 <20030605211043.GA9752@linux.vpn.uni-freiburg.de>
 <20030710123548.GQ29868@artcom8.artcom-gmbh.de>
 <20030710125725.GS29868@artcom8.artcom-gmbh.de>
 <20030710134950.GA1057@linux.vpn.uni-freiburg.de>
 <20030710140610.GU29868@artcom8.artcom-gmbh.de>
Message-ID: <87el0yqha2.fsf@infovore.xs4all.nl>

Martin Schroeder writes:
> On 2003-07-10 15:49:50 +0200, Heiko Oberdiek wrote:
>> On Thu, Jul 10, 2003 at 02:57:25PM +0200, Martin Schroeder wrote:
>> > On 2003-07-10 14:35:48 +0200, Martin Schröder wrote:
>> > > - New readonly primitive \pdfshellescape which can be used to test if the
>> > 
>> > Thinking further (and being reminded by Rolf): Is there a reason
>> > why this can _not_ be called \shellescape? It's got nothing to do
>> > with pdf (and would be usefull in all web2c-based TeX engines, no
>> > matter what they are called).
>> 
>> \write18 is a property of web2c-based TeX engines, so
>> \shellescape is the better name and it would be even better,
>> if this can be added to the other web2c-based TeX engines, too.

> Same here. Olaf? Or does this belong to tex-implementors?

\shellescape sits in Knuth's namespace.

This seems to have come up private mail as well, and there the
suggestion was to use \ifeof18 instead.

For various reasons I still haven't been able to spend time on TeX.
:-(

-- 
Olaf Weber

               (This space left blank for technical reasons.)


From oberdiek@uni-freiburg.de  Fri Jul 11 00:37:20 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 11 Jul 2003 01:37:20 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <87el0yqha2.fsf@infovore.xs4all.nl>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de> <20030710125725.GS29868@artcom8.artcom-gmbh.de> <20030710134950.GA1057@linux.vpn.uni-freiburg.de> <20030710140610.GU29868@artcom8.artcom-gmbh.de> <87el0yqha2.fsf@infovore.xs4all.nl>
Message-ID: <20030710233720.GA7443@linux>

--G4iJoqBmSsgzjUCe
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit

On Thu, Jul 10, 2003 at 10:05:25PM +0200, Olaf Weber wrote:

> Martin Schroeder writes:
> > On 2003-07-10 15:49:50 +0200, Heiko Oberdiek wrote:
> >> On Thu, Jul 10, 2003 at 02:57:25PM +0200, Martin Schroeder wrote:
> >> > On 2003-07-10 14:35:48 +0200, Martin Schröder wrote:
> >> > > - New readonly primitive \pdfshellescape which can be used to test if the
> >> > 
> >> > Thinking further (and being reminded by Rolf): Is there a reason
> >> > why this can _not_ be called \shellescape? It's got nothing to do
> >> > with pdf (and would be usefull in all web2c-based TeX engines, no
> >> > matter what they are called).
> >> 
> >> \write18 is a property of web2c-based TeX engines, so
> >> \shellescape is the better name and it would be even better,
> >> if this can be added to the other web2c-based TeX engines, too.
> 
> > Same here. Olaf? Or does this belong to tex-implementors?
> 
> \shellescape sits in Knuth's namespace.
> 
> This seems to have come up private mail as well, and there the
> suggestion was to use \ifeof18 instead.
> 
> For various reasons I still haven't been able to spend time on TeX.
> :-(

Ok, I have done it:

Patch ShellEscapeIfeof18

Packages such as pdftricks.sty, epstopdf.sty (or pdftex.def)
call external programs. They do not work at all, if the
\write18 feature is not enabled. Therefore a robust method
would be useful in order to inform the user. For security
reasons the \write18 feature must not be set by TeX macro
code.
  In opposite to patch "ShellEscape" this patch now uses
\ifeof18 for a test of the shell escape feature. Thus the
introduction of a new primitive is avoided. Also it works
now for other TeX engines (tex, etex, pdftex, pdfetex).

Use, for instance:

\ifeof18
  \message{The \string\write18 feature is disabled.}
\else
  \message{The \string\write18 feature is enabled.}
\fi

Patch files based on 2003/07/11 v1.11a:
  tex.ch.diff for TeX/texk/web2c/tex.ch

Attachted are files tex.ch.diff and a test file test.tex.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
--G4iJoqBmSsgzjUCe
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="tex.ch.diff"

*** tex.ch.org	Fri Jul 11 00:32:10 2003
--- tex.ch	Fri Jul 11 01:29:43 2003
***************
*** 1529,1534 ****
--- 1529,1563 ----
  absorbing:begin print(" while scanning text"); info(p):=right_brace_token+"}";
  @z
  
+ @x [26.435] l.8625 - Adding scan procedure for stream numbers including 18
+ procedure scan_four_bit_int;
+ @y
+ procedure scan_four_bit_int_or_xviii;
+ begin scan_int;
+ if (cur_val<0) or ((cur_val>15) and not(cur_val=18)) then
+   begin print_err("Bad number");
+ @.Bad number@>
+   {The help message text is not changed because of trip test.}
+   help2("Since I expected to read a number between 0 and 15,")@/
+     ("I changed this one to zero."); int_error(cur_val); cur_val:=0;
+   end;
+ end;
+ procedure scan_four_bit_int;
+ @z
+ 
+ @x [28.501] l.9746 - Extending ifeof test for shell escape feature
+ if_eof_code: begin scan_four_bit_int; b:=(read_open[cur_val]=closed);
+   end;
+ @y
+ if_eof_code: begin
+     scan_four_bit_int_or_xviii;
+     if (cur_val=18) then
+       b:=not shell_enabled_p
+     else
+       b:=(read_open[cur_val]=closed);
+   end;
+ @z
+ 
  @x [29.513] l.9951 - Area and extension rules for filenames.
  @ The file names we shall deal with for illustrative purposes have the
  following structure:  If the name contains `\.>' or `\.:', the file area

--G4iJoqBmSsgzjUCe
Content-Type: application/x-tex
Content-Disposition: attachment; filename="test.tex"
Content-Transfer-Encoding: quoted-printable

\def\println#{\immediate\write16}=0A\def\test#1{%=0A  \ifeof#1 %=0A    \pri=
ntln{* \number#1: EOF}%=0A  \else=0A    \println{* \number#1: NOT EOF}%=0A =
 \fi=0A}=0A=0A\test{18}=0A=0A\newread\foo=0A\test\foo=0A\println{* \number\=
foo: OPENIN}=0A\openin\foo=3D\jobname\relax=0A\test\foo=0A=0A\nonstopmode=
=0A\test{16}=0A\test{17}=0A\test{19}=0A=0A\csname @@end\endcsname=0A\end=0A
--G4iJoqBmSsgzjUCe--

From ms@artcom-gmbh.de  Fri Jul 11 09:51:08 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Fri, 11 Jul 2003 10:51:08 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
In-Reply-To: <20030710161736.GZ29868@artcom8.artcom-gmbh.de>
References: <20030708155517.GV29868@artcom8.artcom-gmbh.de> <20030710152913.GY29868@artcom8.artcom-gmbh.de> <20030710160629.GA1857@linux.vpn.uni-freiburg.de> <20030710161736.GZ29868@artcom8.artcom-gmbh.de>
Message-ID: <20030711085108.GC29868@artcom8.artcom-gmbh.de>

On 2003-07-10 18:17:36 +0200, Martin Schröder wrote:
> Yes. pdfTeX <1.10a didnn't care for x and y; you only got a
> warning from the xpdf layer when y was greater than the y
> supported by xpdf. I want to get that behaviour back to be
> backwards-compatible.

I'm leaning towards naming the primitive
\pdfoptionpdfinclusionerrorlevel, since it will be initialized
with 1 (error if y > x) and allows future extensions.

Comments?
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Fri Jul 11 11:53:41 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Fri, 11 Jul 2003 12:53:41 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
In-Reply-To: <20030711085108.GC29868@artcom8.artcom-gmbh.de>
References: <20030708155517.GV29868@artcom8.artcom-gmbh.de> <20030710152913.GY29868@artcom8.artcom-gmbh.de> <20030710160629.GA1857@linux.vpn.uni-freiburg.de> <20030710161736.GZ29868@artcom8.artcom-gmbh.de> <20030711085108.GC29868@artcom8.artcom-gmbh.de>
Message-ID: <20030711105341.GE29868@artcom8.artcom-gmbh.de>

On 2003-07-11 10:51:08 +0200, Martin Schröder wrote:
> I'm leaning towards naming the primitive
> \pdfoptionpdfinclusionerrorlevel, since it will be initialized
> with 1 (error if y > x) and allows future extensions.

#3319

- The behaviour when an included pdf has a newer version than the one specified
  with \pdfoptionpdfminorversion can be controlled by the new internal integer
  \pdfoptionpdfinclusionerrorlevel: If it's 0, pdfTeX gives only a warning; if
  it's 1, it raises an error. 
    This can also be set in pdftex.cfg with pdf_inclusion_errorlevel

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Fri Jul 11 12:08:47 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Fri, 11 Jul 2003 13:08:47 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030710233720.GA7443@linux>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de> <20030710125725.GS29868@artcom8.artcom-gmbh.de> <20030710134950.GA1057@linux.vpn.uni-freiburg.de> <20030710140610.GU29868@artcom8.artcom-gmbh.de> <87el0yqha2.fsf@infovore.xs4all.nl> <20030710233720.GA7443@linux>
Message-ID: <20030711110847.GF29868@artcom8.artcom-gmbh.de>

On 2003-07-11 01:37:20 +0200, Heiko Oberdiek wrote:
> Patch ShellEscapeIfeof18

Sounds good.

I've removed \pdfshellescape (#3320).

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Fri Jul 11 12:42:05 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 11 Jul 2003 13:42:05 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030711110847.GF29868@artcom8.artcom-gmbh.de>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <20030710123548.GQ29868@artcom8.artcom-gmbh.de> <20030710125725.GS29868@artcom8.artcom-gmbh.de> <20030710134950.GA1057@linux.vpn.uni-freiburg.de> <20030710140610.GU29868@artcom8.artcom-gmbh.de> <87el0yqha2.fsf@infovore.xs4all.nl> <20030710233720.GA7443@linux> <20030711110847.GF29868@artcom8.artcom-gmbh.de>
Message-ID: <20030711114205.GA3272@linux.vpn.uni-freiburg.de>

On Fri, Jul 11, 2003 at 01:08:47PM +0200, Martin Schroeder wrote:

> On 2003-07-11 01:37:20 +0200, Heiko Oberdiek wrote:
> > Patch ShellEscapeIfeof18
> 
> Sounds good.

A short discussion about the two methods \shellescape vs. \ifeof18:

* \ifeof18: the temptation for enabling the \write18 feature at
  macro level, because this interface only provides asking/reading
  and not writing. For security reasons the \write18 feature
  must not be enabled at macro level.
* The implementation is easier and more portable,
  because there is no need for the nasty magic *_code number of
  a new primitive that would also affect change files of other
  TeX enginges.
* \ifeof18 avoids a new primitive. The "namespace" problem, however,
  could be solved by funny names, eg.: "\.web2c.shellescape".
* But there is also a disadvantage of the \ifeof18 method:
  TeX generates a error message, if \ifeof18 is not supported.
  Unhappily TeX does not provide an exception mechanism, so this
  error cannot be catched.
    For "tex" and "etex" I see no way to avoid this without a new
  primitive that can easily checked for existence. The primitive
  can be either a command that indicates the presence of the
  feature or returns the version number of web2c.
    For "pdf(e)tex" this is not a problem, because here
  \pdfversion and \pdfrevision can be asked. So packages such
  as pdftricks, pdftex.def, ... will be happy.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Fri Jul 11 16:23:13 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Fri, 11 Jul 2003 17:23:13 +0200
Subject: [NTG-pdftex] \pdftrailer (was: 1.10b)
In-Reply-To: <20030226193446.GA10428@lucien.kn-bremen.de>
References: <20030226120905.GA27130@artcom8.artcom-gmbh.de> <20030217114606.GA1651@linux.vpn.uni-freiburg.de> <20030217134723.GC12556@artcom8.artcom-gmbh.de> <20030217142603.GE12556@artcom8.artcom-gmbh.de> <20030217144551.GA5609@linux.vpn.uni-freiburg.de> <20030224153436.GF30077@artcom8.artcom-gmbh.de> <20030226120905.GA27130@artcom8.artcom-gmbh.de> <5.1.0.14.1.20030226185953.0242e410@server-1> <20030226193446.GA10428@lucien.kn-bremen.de>
Message-ID: <20030711152313.GN29868@artcom8.artcom-gmbh.de>

On 2003-02-26 20:34:46 +0100, Martin Schröder wrote:
> On 2003-02-26 19:01:18 +0100, Hans Hagen wrote:
> > Can you also add a primitive \pdftrailer which acts like the catalog but 
> > adds content to the trailer object? We may need this for reaching pdf/x 
> > compatibility.
> 
> Will do in 1.11a

#3321:
- New command \pdftrailer analogue to \pdfcatalog whose argument end up in the
  trailer dictionary.

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From pragma@wxs.nl  Sat Jul 12 18:22:11 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sat, 12 Jul 2003 19:22:11 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
Message-ID: <5.2.0.9.1.20030712192200.02bf2c28@localhost>

At 13:42 11/07/2003 +0200, Heiko Oberdiek wrote:

>* But there is also a disadvantage of the \ifeof18 method:
>   TeX generates a error message, if \ifeof18 is not supported.
>   Unhappily TeX does not provide an exception mechanism, so this
>   error cannot be catched.
>     For "tex" and "etex" I see no way to avoid this without a new
>   primitive that can easily checked for existence. The primitive
>   can be either a command that indicates the presence of the
>   feature or returns the version number of web2c.
>     For "pdf(e)tex" this is not a problem, because here
>   \pdfversion and \pdfrevision can be asked. So packages such
>   as pdftricks, pdftex.def, ... will be happy.

Isn't there a new version of tex coming (dek posted some fixes)? In that 
case, one can use that version number since the moment that those fixes are 
in the new distribution sync with the ifeof18 extension.

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From pragma@wxs.nl  Sat Jul 12 18:22:09 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sat, 12 Jul 2003 19:22:09 +0200
Subject: [NTG-pdftex] pdf_version_found > pdf_version_wanted
Message-ID: <5.2.0.9.1.20030712192200.02c414d8@localhost>

At 17:29 10/07/2003 +0200, Martin Schroeder wrote:
>On 2003-07-08 17:55:17 +0200, Martin Schr=F6der wrote:
> > one to be produced. I want to make this behaviour configurable
> > through pdftex.cfg (and a corresponding primitive). pdfTeX would
>
>Currently the primitive is tentatively named
>\pdfoptionpdfversionerrorlevel. Any better idea?

            ^^^

omit the second pdf -)

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From pragma@wxs.nl  Sat Jul 12 18:22:07 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sat, 12 Jul 2003 19:22:07 +0200
Subject: [NTG-pdftex] PDF inclusion with annotations
Message-ID: <5.2.0.9.1.20030712192200.02c3dda8@localhost>

At 14:01 10/07/2003 +0200, Martin Schroeder wrote:

>I must confess I have not cared for annotations yet so I just
>hope that this is correct (it certainly sounds so) and leave that
>to the experts.

an option is to support this under user control:

\pdfmergeannots=0 : not enabled
\pdfmergeannots=1 : enabled

defaulting to 0 (not enabled)

that way macro packages can control it

also, it will need some extensive testing, esp for user annotations which 
may have object references, resources etc; since this would involve parsing 
of content, it's also a dangerous excersise (hard to make foolproof); this 
means that we should be able to control this at the annotation level:

- links
- widgets
- etc

so, we should need something

\pdfmergelinkannots=1
etc

as well

> > Another important this which happens within the function out_image,
> > is the calculation to the new coordinates of the annotation's /Rect.
> > There are no big problems if an images is scaled with the help of
> > <rule spec> of \pdfximage. But their are a lot of problems if
> > macro packages do something like \pdfliteral{.5 0 0 .5 0 0 cm}
> > for scaling and similar things for rotating images. To calculate
> > the coordinates of /Rect, pdftex must know exactly which coordinate
> > transformations are actually taking place. So I introduced two
> > new primitives: \pdfsetctm and \pdfresetctm.
>
>This I find much more interesting.

this problem is more general, since it also concerns normal (not xpdf 
related) code; i remember discussing this with thanh a few years a go but 
forgot about the implications, but for out_image situations it sounds ok to 
me

>[...]
>
> > Since TeX does not have a function to scan floating-point numbers,
> > I used scan_dimen as a work around to scan the arguments of \pdfsetctm.
> > That's why you must write
> >
> >    \pdfsetctm 0bp 1bp -1bp 0bp 0bp
> >
> > so far. It should be no problem to change this in the future.
>
>This could be added.

i don't like the unit; we could use numbers here and assume that they are 
scaled points (as happened in some dvi postprocessors); an alternative is 
to make it a token list
\pdfsetctm{....} and treat each component as what it is: floating point or 
dimension.

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From pragma@wxs.nl  Sat Jul 12 18:22:06 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sat, 12 Jul 2003 19:22:06 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
Message-ID: <5.2.0.9.1.20030712192200.02c44f08@localhost>

At 15:49 10/07/2003 +0200, Heiko Oberdiek wrote:
>On Thu, Jul 10, 2003 at 02:57:25PM +0200, Martin Schroeder wrote:
>
> > On 2003-07-10 14:35:48 +0200, Martin Schr=F6der wrote:
> > > - New readonly primitive \pdfshellescape which can be used to test if=
 the
> >
> > Thinking further (and being reminded by Rolf): Is there a reason
> > why this can _not_ be called \shellescape? It's got nothing to do
> > with pdf (and would be usefull in all web2c-based TeX engines, no
> > matter what they are called).
>
>\write18 is a property of web2c-based TeX engines, so
>\shellescape is the better name and it would be even better,
>if this can be added to the other web2c-based TeX engines, too.

i have problems with the not that name compatible:

   \shellescape
   \write18

so if a dedicated name would be used, we would either have something:

   \shellescape{some command}
   \shellescapemode =3D=3D number


or (considering it a channel)

   \write18
   \ifeof18

Hans

-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From ms@artcom-gmbh.de  Sun Jul 13 01:45:55 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Sun, 13 Jul 2003 02:45:55 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030712192200.02bf2c28@localhost>
References: <5.2.0.9.1.20030712192200.02bf2c28@localhost>
Message-ID: <20030713004555.GC5369@lucien.kn-bremen.de>

On 2003-07-12 19:22:11 +0200, Hans Hagen wrote:
> Isn't there a new version of tex coming (dek posted some fixes)? In that 
> case, one can use that version number since the moment that those fixes are 
> in the new distribution sync with the ifeof18 extension.

And how do you check the version of the TeX engine in (non-e)TeX?

Best regards
    Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10

From oberdiek@uni-freiburg.de  Sun Jul 13 18:23:55 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 13 Jul 2003 19:23:55 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030712192200.02c44f08@localhost>
References: <5.2.0.9.1.20030712192200.02c44f08@localhost>
Message-ID: <20030713172355.GA1641@linux>

On Sat, Jul 12, 2003 at 07:22:06PM +0200, Hans Hagen wrote:

> i have problems with the not that name compatible:
> 
>   \shellescape
>   \write18
> 
> so if a dedicated name would be used, we would either have something:
> 
>   \shellescape{some command}
>   \shellescapemode == number

This would be the cleanest solution, without that magic nasty "18".
But I fear, nobody will have the courage to extend standard TeX
in this sense.

An alternative for \shellescapemode could be a \if switch:
  \ifshellescape

> or (considering it a channel)
> 
>   \write18
>   \ifeof18

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From oberdiek@uni-freiburg.de  Sun Jul 13 18:31:10 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 13 Jul 2003 19:31:10 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030712192200.02bf2c28@localhost>
References: <5.2.0.9.1.20030712192200.02bf2c28@localhost>
Message-ID: <20030713173110.GB1641@linux>

On Sat, Jul 12, 2003 at 07:22:11PM +0200, Hans Hagen wrote:

> At 13:42 11/07/2003 +0200, Heiko Oberdiek wrote:
> 
> >* But there is also a disadvantage of the \ifeof18 method:
> >  TeX generates a error message, if \ifeof18 is not supported.
> >  Unhappily TeX does not provide an exception mechanism, so this
> >  error cannot be catched.
> >    For "tex" and "etex" I see no way to avoid this without a new
> >  primitive that can easily checked for existence. The primitive
> >  can be either a command that indicates the presence of the
> >  feature or returns the version number of web2c.
> >    For "pdf(e)tex" this is not a problem, because here
> >  \pdfversion and \pdfrevision can be asked. So packages such
> >  as pdftricks, pdftex.def, ... will be happy.
> 
> Isn't there a new version of tex coming (dek posted some fixes)? In that 
> case, one can use that version number since the moment that those fixes are 
> in the new distribution sync with the ifeof18 extension.

TeX/texk/web2c/News:
| 7.5.1 (17 February 2003)
| * New upstream sources from Knuth.
 
TeX/texk/web2c/ChangeLog:
| 2003-02-16  Olaf Weber  <olaf@infovore.xs4all.nl>
|         * tex.web: TeX 3.141592 from Knuth: fixed \xleaders, glueset,
|         weird alignments.
| 
|         * tex.ch: Update banner for TeX 3.141592.

The changes are already done. And it would be difficult to distinguish
between 3.14159 and 3.141592 at macro level. I would not want to read
the .log file for the version number in the banner.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From The Thanh Han <hanthethanh@myrealbox.com>  Fri Jul 11 12:37:01 2003
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Fri, 11 Jul 2003 18:37:01 +0700
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
In-Reply-To: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
References: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
Message-ID: <20030711113701.GE398@pc1-debian>

On Wed, Jul 09, 2003 at 12:24:04PM +0200, Martin Schroeder wrote:
> Hi,
> the pdfTeX project needs a system for tracking bugs, patches and
> feature requests (whenever I integrate all the latest patches and
> look for open bugs I fear I forget one). 
> 
> We could of course set up the needed software by ourself, but
> there are already places that offer the needed services. I did a
> quick survey:
> - Sourceforge (http://sf.net): 
>     - Tracker for bugs, support requests, patches, feature requests
>     - Limited to OSI-compatible software (which pdfTeX is)
> - Savannah (savannah.nongnu.org): 
>     - Tracker for bugs, support requests, patches
>     - Limited to GPL-compatible software (which pdfTeX is)
>     - Emphasises on freeness
> - Berlios (berlios.de):
>     - Tracker for bugs, support requests, patches
>     - Not limited to OSI-compatible software (which pdfTeX is)
>     - It seems you can't automatically get mail about new
>       bugs/patches 
>     - Management is german
> 
> It seems Sourceforge is offering the most with the least strings
> attached.
> 
> I propose we set up pdfTeX at Sourceforge in the near future
> (post-Hawaii) for project management but keep the sources in the
> p4 repository at DANTE/TeXlive (it works perfectly).
> 
> Comments?

sounds great to me. I'd personally prefer sf.

Thanh

From The Thanh Han <hanthethanh@myrealbox.com>  Fri Jul 11 12:37:01 2003
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Fri, 11 Jul 2003 18:37:01 +0700
Subject: [NTG-pdftex] Tracking Bugs, Patches and Feature Requests
In-Reply-To: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
References: <20030709102404.GA29868@artcom8.artcom-gmbh.de>
Message-ID: <20030711113701.GE398@pc1-debian>

On Wed, Jul 09, 2003 at 12:24:04PM +0200, Martin Schroeder wrote:
> Hi,
> the pdfTeX project needs a system for tracking bugs, patches and
> feature requests (whenever I integrate all the latest patches and
> look for open bugs I fear I forget one). 
> 
> We could of course set up the needed software by ourself, but
> there are already places that offer the needed services. I did a
> quick survey:
> - Sourceforge (http://sf.net): 
>     - Tracker for bugs, support requests, patches, feature requests
>     - Limited to OSI-compatible software (which pdfTeX is)
> - Savannah (savannah.nongnu.org): 
>     - Tracker for bugs, support requests, patches
>     - Limited to GPL-compatible software (which pdfTeX is)
>     - Emphasises on freeness
> - Berlios (berlios.de):
>     - Tracker for bugs, support requests, patches
>     - Not limited to OSI-compatible software (which pdfTeX is)
>     - It seems you can't automatically get mail about new
>       bugs/patches 
>     - Management is german
> 
> It seems Sourceforge is offering the most with the least strings
> attached.
> 
> I propose we set up pdfTeX at Sourceforge in the near future
> (post-Hawaii) for project management but keep the sources in the
> p4 repository at DANTE/TeXlive (it works perfectly).
> 
> Comments?

sounds great to me. I'd personally prefer sf.

Thanh

From pragma@wxs.nl  Sun Jul 13 20:47:36 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sun, 13 Jul 2003 21:47:36 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030713173110.GB1641@linux>
References: <5.2.0.9.1.20030712192200.02bf2c28@localhost>
 <5.2.0.9.1.20030712192200.02bf2c28@localhost>
Message-ID: <5.2.0.9.1.20030713214541.02d7b798@localhost>

At 19:31 13/07/2003 +0200, you wrote:

>The changes are already done. And it would be difficult to distinguish
>between 3.14159 and 3.141592 at macro level. I would not want to read
>the .log file for the version number in the banner.

hm, isn't there a macro in latex then that holds the number?

also, you can maybe use a latex version number for testing

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From pragma@wxs.nl  Sun Jul 13 20:53:04 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Sun, 13 Jul 2003 21:53:04 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030713172355.GA1641@linux>
References: <5.2.0.9.1.20030712192200.02c44f08@localhost>
 <5.2.0.9.1.20030712192200.02c44f08@localhost>
Message-ID: <5.2.0.9.1.20030713214811.02b4c0f8@localhost>

At 19:23 13/07/2003 +0200, you wrote:
>On Sat, Jul 12, 2003 at 07:22:06PM +0200, Hans Hagen wrote:
>
> > i have problems with the not that name compatible:
> >
> >   \shellescape
> >   \write18
> >
> > so if a dedicated name would be used, we would either have something:
> >
> >   \shellescape{some command}
> >   \shellescapemode == number
>
>This would be the cleanest solution, without that magic nasty "18".
>But I fear, nobody will have the courage to extend standard TeX
>in this sense.
>
>An alternative for \shellescapemode could be a \if switch:
>   \ifshellescape
>
> > or (considering it a channel)
> >
> >   \write18
> >   \ifeof18

yet another option is to ask peter breitenlohner to add the \shell... 
commands to etex or if that does not happen, to add them as alternatives to 
pdftex (in addition to the \ifeof18's) and then discuss the option to add 
them to etex some time later (there are a few more pdftex features that may 
be interesting to move to etex)

also, since i suppose that you need it for hyperref, you can use the pdftex 
version number (or just test for another new pdftex primitive that is 
introduced at the same time as \ifeof18); in a year from now we may expect 
users who use 'modern things' like write 18 to have updated anyway

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From oberdiek@uni-freiburg.de  Sun Jul 13 22:12:16 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 13 Jul 2003 23:12:16 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030713214811.02b4c0f8@localhost>
References: <5.2.0.9.1.20030712192200.02c44f08@localhost> <5.2.0.9.1.20030712192200.02c44f08@localhost> <5.2.0.9.1.20030713214811.02b4c0f8@localhost>
Message-ID: <20030713211216.GB2603@linux>

On Sun, Jul 13, 2003 at 09:53:04PM +0200, Hans Hagen wrote:

> yet another option is to ask peter breitenlohner to add the \shell... 
> commands to etex or if that does not happen, to add them as alternatives to 
> pdftex (in addition to the \ifeof18's) and then discuss the option to add 
> them to etex some time later (there are a few more pdftex features that may 
> be interesting to move to etex)

This can be a way to go.

> also, since i suppose that you need it for hyperref, you can use the pdftex 
> version number (or just test for another new pdftex primitive that is 
> introduced at the same time as \ifeof18); in a year from now we may expect 
> users who use 'modern things' like write 18 to have updated anyway

Not hyperref, but here are examples:
* pdftex.def/epstopdf.sty for conversion eps->pdf on the fly
* pdftricks relies on \write18.
In both cases the test of pdfTeX version number is enough.

For general use, example:
* running makeindex before \printindex
It would be useful, if the feature can be tested.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From oberdiek@uni-freiburg.de  Sun Jul 13 22:03:00 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 13 Jul 2003 23:03:00 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030713214541.02d7b798@localhost>
References: <5.2.0.9.1.20030712192200.02bf2c28@localhost> <5.2.0.9.1.20030712192200.02bf2c28@localhost> <5.2.0.9.1.20030713214541.02d7b798@localhost>
Message-ID: <20030713210300.GA2603@linux>

On Sun, Jul 13, 2003 at 09:47:36PM +0200, Hans Hagen wrote:

> At 19:31 13/07/2003 +0200, you wrote:
> 
> >The changes are already done. And it would be difficult to distinguish
> >between 3.14159 and 3.141592 at macro level. I would not want to read
> >the .log file for the version number in the banner.
> 
> hm, isn't there a macro in latex then that holds the number?

No, LaTeX does not know, which TeX is used.

> also, you can maybe use a latex version number for testing

Not reliable. For example, my tex is much older than my LaTeX
installation.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From pragma@wxs.nl  Mon Jul 14 10:23:49 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Mon, 14 Jul 2003 11:23:49 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <20030713210300.GA2603@linux>
References: <5.2.0.9.1.20030713214541.02d7b798@localhost>
 <5.2.0.9.1.20030712192200.02bf2c28@localhost>
 <5.2.0.9.1.20030712192200.02bf2c28@localhost>
 <5.2.0.9.1.20030713214541.02d7b798@localhost>
Message-ID: <5.2.0.9.1.20030714112258.032def78@server-1>

At 23:03 13/07/2003 +0200, Heiko Oberdiek wrote:
>On Sun, Jul 13, 2003 at 09:47:36PM +0200, Hans Hagen wrote:
>
> > At 19:31 13/07/2003 +0200, you wrote:
> >
> > >The changes are already done. And it would be difficult to distinguish
> > >between 3.14159 and 3.141592 at macro level. I would not want to read
> > >the .log file for the version number in the banner.
> >
> > hm, isn't there a macro in latex then that holds the number?
>
>No, LaTeX does not know, which TeX is used.
>
> > also, you can maybe use a latex version number for testing
>
>Not reliable. For example, my tex is much older than my LaTeX
>installation.

in that case, why not use the latex version as per tex live 8 (an ifeof18 
test macro extension can wait till then i suppose)

Hans

-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From oberdiek@uni-freiburg.de  Mon Jul 14 11:57:07 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Mon, 14 Jul 2003 12:57:07 +0200
Subject: [NTG-pdftex] Re: Patch ShellEscape
In-Reply-To: <5.2.0.9.1.20030714112258.032def78@server-1>
References: <5.2.0.9.1.20030713214541.02d7b798@localhost> <5.2.0.9.1.20030712192200.02bf2c28@localhost> <5.2.0.9.1.20030712192200.02bf2c28@localhost> <5.2.0.9.1.20030713214541.02d7b798@localhost> <5.2.0.9.1.20030714112258.032def78@server-1>
Message-ID: <20030714105706.GA1066@linux.vpn.uni-freiburg.de>

On Mon, Jul 14, 2003 at 11:23:49AM +0200, Hans Hagen wrote:

> At 23:03 13/07/2003 +0200, Heiko Oberdiek wrote:
> >On Sun, Jul 13, 2003 at 09:47:36PM +0200, Hans Hagen wrote:
> >
> >> At 19:31 13/07/2003 +0200, you wrote:
> >>
> >> >The changes are already done. And it would be difficult to distinguish
> >> >between 3.14159 and 3.141592 at macro level. I would not want to read
> >> >the .log file for the version number in the banner.
> >>
> >> hm, isn't there a macro in latex then that holds the number?
> >
> >No, LaTeX does not know, which TeX is used.
> >
> >> also, you can maybe use a latex version number for testing
> >
> >Not reliable. For example, my tex is much older than my LaTeX
> >installation.
> 
> in that case, why not use the latex version as per tex live 8 (an ifeof18 
> test macro extension can wait till then i suppose)

I have different TeX installations (useful sometimes for testing with
older versions, for example). Thus I want to say, that LaTeX can
be updated independently from the TeX program. And because of the
stable nature of standard TeX and the Error during LaTeX format
generation this will be often the case.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From te@dbs.uni-hannover.de  Tue Jul 15 21:14:27 2003
From: te@dbs.uni-hannover.de (Thomas Esser)
Date: Tue, 15 Jul 2003 22:14:27 +0200
Subject: [NTG-pdftex] pdftex: compile errors/warnings
In-Reply-To: <20030617084609.GK30981@artcom8.artcom-gmbh.de>
References: <002901c334a1$9246d340$d726678e@Kate> <20030617084609.GK30981@artcom8.artcom-gmbh.de>
Message-ID: <20030715201426.GA1030@dbs.uni-hannover.de>

Today, I have compiled pdftex (today's version from the perforce tree)
on a Sparc Solaris machine using the system compilers.

First problem:
  texk/web2c/pdftexdir/utils.c
contains three comments written in C++ style which is not allowed:
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 459: syntax error before or at: /
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 465: syntax error before or at: /
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 471: syntax error before or at: /

And I did get a few warnings:
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 94: warning: assignment type mismatch:
        pointer to unsigned char "=" pointer to char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 125: warning: argument #2 is incompatible with prototype:
        prototype: pointer to const unsigned char : "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/../../../libs/zlib/zlib.h", line 838
        argument : pointer to char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/utils.c", line 289: warning: argument #2 is incompatible with prototype:
        prototype: pointer to const unsigned char : "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/../../../libs/zlib/zlib.h", line 838
        argument : pointer to char

"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/config.c", line 111: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char

"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writet1.c", line 348: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writet1.c", line 1000: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writet1.c", line 1012: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writet1.c", line 1033: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char

"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writezip.c", line 55: warning: assignment type mismatch:
        pointer to unsigned char "=" pointer to char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writezip.c", line 63: warning: assignment type mismatch:
        pointer to unsigned char "=" pointer to char

"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writettf.c", line 720: warning: assignment type mismatch:
        pointer to unsigned char "=" pointer to char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writettf.c", line 1043: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/writettf.c", line 1097: warning: assignment type mismatch:
        pointer to char "=" pointer to unsigned char

"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 195: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 266: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
"/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 296: Warning: String literal converted to char* in formal argument 1 in call to pdf_puts(char*).
...and many more of warnings of this kind...

Thomas

From ms@artcom-gmbh.de  Wed Jul 16 11:42:02 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 16 Jul 2003 12:42:02 +0200
Subject: [NTG-pdftex] 1.11a - open issues?
Message-ID: <20030716104202.GB29868@artcom8.artcom-gmbh.de>

Hi,
I'm planning to release 1.11a next week. Are there any open
issues (patches, bugs, needed features) left?

Best regards
        Martin

PS: Compiler warnings will be fixed. :-)
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Wed Jul 16 11:50:16 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 16 Jul 2003 12:50:16 +0200
Subject: [NTG-pdftex] still beta?
Message-ID: <20030716105016.GC29868@artcom8.artcom-gmbh.de>

from the REAME:

        It is still under beta development and all features are
        liable to change. Despite its beta state, pdfTeX produces
        excellent PDF code.

Is pdfTeX still in beta state? Methinks it has matured enough. :-)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From pragma@wxs.nl  Wed Jul 16 13:31:33 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 16 Jul 2003 14:31:33 +0200
Subject: [NTG-pdftex] still beta?
In-Reply-To: <20030716105016.GC29868@artcom8.artcom-gmbh.de>
Message-ID: <5.2.0.9.1.20030716143115.020816e0@server-1>

At 12:50 16/07/2003 +0200, Martin Schroeder wrote:

>Is pdfTeX still in beta state? Methinks it has matured enough. :-)

No longer beta

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From pragma@wxs.nl  Wed Jul 16 13:33:20 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 16 Jul 2003 14:33:20 +0200
Subject: [NTG-pdftex] 1.11a - open issues?
In-Reply-To: <20030716104202.GB29868@artcom8.artcom-gmbh.de>
Message-ID: <5.2.0.9.1.20030716143147.02a92760@server-1>

At 12:42 16/07/2003 +0200, you wrote:
>Hi,
>I'm planning to release 1.11a next week. Are there any open
>issues (patches, bugs, needed features) left?

maybe add the \pdfcurrentpageobj, expanded/available during shipout, or 
maybe during page building, i.e. allocate the pag eobject number at startup 
and allocate a new one when a ship out took place

Hans
-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From ms@artcom-gmbh.de  Wed Jul 16 14:38:27 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 16 Jul 2003 15:38:27 +0200
Subject: [NTG-pdftex] pdftex: compile errors/warnings
In-Reply-To: <20030715201426.GA1030@dbs.uni-hannover.de>
References: <002901c334a1$9246d340$d726678e@Kate> <20030617084609.GK30981@artcom8.artcom-gmbh.de> <20030715201426.GA1030@dbs.uni-hannover.de>
Message-ID: <20030716133827.GD29868@artcom8.artcom-gmbh.de>

On 2003-07-15 22:14:27 +0200, Thomas Esser wrote:
> "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 195: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
> "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 266: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
> "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 296: Warning: String literal converted to char* in formal argument 1 in call to pdf_puts(char*).
> ...and many more of warnings of this kind...

I've changed the definition of pdftex_fail et.al to const char*
-- hope it helps.

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Wed Jul 16 15:28:59 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 16 Jul 2003 16:28:59 +0200
Subject: [NTG-pdftex] 1.11a - open issues?
In-Reply-To: <5.2.0.9.1.20030716143147.02a92760@server-1>
References: <20030716104202.GB29868@artcom8.artcom-gmbh.de> <5.2.0.9.1.20030716143147.02a92760@server-1>
Message-ID: <20030716142859.GE29868@artcom8.artcom-gmbh.de>

On 2003-07-16 14:33:20 +0200, Hans Hagen wrote:
> At 12:42 16/07/2003 +0200, you wrote:
> >I'm planning to release 1.11a next week. Are there any open
> >issues (patches, bugs, needed features) left?
> 
> maybe add the \pdfcurrentpageobj, expanded/available during shipout, or 
> maybe during page building, i.e. allocate the pag eobject number at startup 
> and allocate a new one when a ship out took place

And this is a needed feature? :-)

I don't have code for that yet and I won't spend time on it now
(the weather's to good for programming), so it'll have to wait
till 1.12a (unless someone sends in a patch (Heiko? :-)).

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Wed Jul 16 15:55:09 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 16 Jul 2003 16:55:09 +0200
Subject: [NTG-pdftex] 1.11a - open issues?
In-Reply-To: <20030716142859.GE29868@artcom8.artcom-gmbh.de>
References: <20030716104202.GB29868@artcom8.artcom-gmbh.de> <5.2.0.9.1.20030716143147.02a92760@server-1> <20030716142859.GE29868@artcom8.artcom-gmbh.de>
Message-ID: <20030716145509.GA2753@linux.vpn.uni-freiburg.de>

On Wed, Jul 16, 2003 at 04:28:59PM +0200, Martin Schroeder wrote:

> On 2003-07-16 14:33:20 +0200, Hans Hagen wrote:
> > At 12:42 16/07/2003 +0200, you wrote:
> > >I'm planning to release 1.11a next week. Are there any open
> > >issues (patches, bugs, needed features) left?
> > 
> > maybe add the \pdfcurrentpageobj, expanded/available during shipout, or 
> > maybe during page building, i.e. allocate the pag eobject number at startup 
> > and allocate a new one when a ship out took place
> 
> And this is a needed feature? :-)
> 
> I don't have code for that yet and I won't spend time on it now
> (the weather's to good for programming), so it'll have to wait
> till 1.12a (unless someone sends in a patch (Heiko? :-)).

Not until next week (I do not have time this weekend.) :-(

An open issue of mine is the color stack with interface
of \special{color ...}. I have already some code, but
I want to do some rewriting/rethinking of the interface.
But this can also be done in next version 1.12a.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 17 11:19:16 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 17 Jul 2003 12:19:16 +0200
Subject: [NTG-pdftex] pdftex: compile errors/warnings
In-Reply-To: <20030716133827.GD29868@artcom8.artcom-gmbh.de>
References: <002901c334a1$9246d340$d726678e@Kate> <20030617084609.GK30981@artcom8.artcom-gmbh.de> <20030715201426.GA1030@dbs.uni-hannover.de> <20030716133827.GD29868@artcom8.artcom-gmbh.de>
Message-ID: <20030717101916.GJ29868@artcom8.artcom-gmbh.de>

On 2003-07-16 15:38:27 +0200, Martin Schröder wrote:
> On 2003-07-15 22:14:27 +0200, Thomas Esser wrote:
> > "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 195: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
> > "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 266: Warning: String literal converted to char* in formal argument fmt in call to pdftex_fail(char*, ...).
> > "/share/gcc-te-remove-me/teTeX/tetex-src/texk/web2c/pdftexdir/pdftoepdf.cc", line 296: Warning: String literal converted to char* in formal argument 1 in call to pdf_puts(char*).
> > ...and many more of warnings of this kind...
> 
> I've changed the definition of pdftex_fail et.al to const char*
> -- hope it helps.

I think I've removed the cause for all of these warnings (aside
from some warnings in pdftoepdf.cc; xpdf would need major fixes
for these).

For the record: The gcc switches to use are 
        -Wall -pedantic -Wwrite-strings

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Wed Jul 23 17:00:01 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 23 Jul 2003 18:00:01 +0200
Subject: [NTG-pdftex] Spurious /NewWindow false
In-Reply-To: <Pine.LNX.4.55.0307221751430.1797@hahepc1.hahe>
References: <20030605194445.GA7253@linux.vpn.uni-freiburg.de> <20030605211043.GA9752@linux.vpn.uni-freiburg.de> <Pine.LNX.4.55.0306280000550.9883@hahepc1.hahe> <Pine.LNX.4.55.0307221751430.1797@hahepc1.hahe>
Message-ID: <20030723160001.GH17026@artcom8.artcom-gmbh.de>

On 2003-07-22 17:54:30 +0200, Hartmut Henkel wrote:
> ist der Patch unten im neuen 1.11 drin?

Hartmut,
yes (#3411). :-)

- Bugfix: \pdfstartlink would produce spurious /NewWindow entries. Also the
  syntax of <action spec> and <goto-action spec> has been cleaned up.
  See http://www.ntg.nl/pipermail/ntg-pdftex/2003-June/000167.html 

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Tue Jul 29 18:43:35 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 29 Jul 2003 19:43:35 +0200
Subject: [NTG-pdftex] Bug: <hex> string to () string
Message-ID: <20030729174335.GA1391@linux.vpn.uni-freiburg.de>

Hello,

I wanted to include pdf slides from:
  http://ais.informatik.uni-freiburg.de/lehre/ss03/ki/slides/01-intro.pdf
by pdfTeX, but the colors in some of the images are terrible wrong.

Driver file:

% test.tex
\nopagenumbers
\pdfcompresslevel=0
\pdfximage width 297bp height 210bp page 14 {01-intro.pdf}
% similar page 9, ...
\pdfrefximage\pdflastximage
\bye

Analysis:

                    01-intro.pdf / test.pdf

/Page object:       107 0  /  3 0
It references via /XObject the /Image object:
/Image object:      110 0  /  8 0
With
/ColorSpace object: 111 0  /  7 0

Start of object 111 0 of 01-intro.pdf:

111 0 obj
[/Indexed
/DeviceRGB
255
<0402070402300402500402700402840402EC3502066E021585020A9A02159C02
...

Start of object 7 0 of test.pdf with one line break for readability:

7 0 obj
[/Indexed/DeviceRGB 255
(\004\002\007\004\0020\004\002P\004\002p\004\002\37777777604
\004\002\377777777545\002\006n\002\025\37777777605\002...

==> The translation of 8-bit characters that have set it eighth bit
    get terrible wrong:
      hex(84) --> string(\37777777604)
      hex(EC) --> string(\37777777754)
    It seems that the octal number is written as 32 bit number instead
    of a 8 bit number.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

From hartmut_henkel@gmx.de  Tue Jul 29 20:15:22 2003
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Tue, 29 Jul 2003 21:15:22 +0200 (CEST)
Subject: [NTG-pdftex] Bug: <hex> string to () string
In-Reply-To: <20030729174335.GA1391@linux.vpn.uni-freiburg.de>
References: <20030729174335.GA1391@linux.vpn.uni-freiburg.de>
Message-ID: <Pine.LNX.4.55.0307292110170.13908@hahepc1.hahe>

On Tue, 29 Jul 2003, Heiko Oberdiek wrote:

> by pdfTeX, but the colors in some of the images are terrible wrong.

A typecast is missing in pdftexdir/pdftoepdf.cc, function copyObject():

            pdf_puts("(");
            for (; *p != 0; p++) {
                c = (unsigned char) *p; // <--- typecast here!
                if (c == '(' || c == ')' || c == '\\')
                    pdf_printf("\\%c", c);
                else if (c < 0x20 || c > 0x7F)
                    pdf_printf("\\%03o", c);

Greetings Hartmut


From oberdiek@uni-freiburg.de  Tue Jul 29 21:20:34 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 29 Jul 2003 22:20:34 +0200
Subject: [NTG-pdftex] Patch 8BitString (was: Bug: <hex> string to () string)
In-Reply-To: <20030729174335.GA1391@linux.vpn.uni-freiburg.de>
References: <20030729174335.GA1391@linux.vpn.uni-freiburg.de>
Message-ID: <20030729202034.GA7681@linux.vpn.uni-freiburg.de>

--0OAP2g/MAC+5xKAE
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello,

and the fix for the image color problem that is a write problem
of strings in PDF syntax:

Patch 8BitString

I wanted to include pdf slides from:
  http://ais.informatik.uni-freiburg.de/lehre/ss03/ki/slides/01-intro.pdf
by pdfTeX, but the colors in some of the images are terrible wrong.

Driver file:

% test.tex
\nopagenumbers
\pdfcompresslevel=0
\pdfximage width 297bp height 210bp page 14 {01-intro.pdf}
% similar page 9, ...
\pdfrefximage\pdflastximage
\bye

Analysis:

                    01-intro.pdf / test.pdf

/Page object:       107 0  /  3 0
It references via /XObject the /Image object:
/Image object:      110 0  /  8 0
With
/ColorSpace object: 111 0  /  7 0

Start of object 111 0 of 01-intro.pdf:

111 0 obj
[/Indexed
/DeviceRGB
255
<0402070402300402500402700402840402EC3502066E021585020A9A02159C02
...

Start of object 7 0 of test.pdf with one line break for readability:

7 0 obj
[/Indexed/DeviceRGB 255
(\004\002\007\004\0020\004\002P\004\002p\004\002\37777777604
\004\002\377777777545\002\006n\002\025\37777777605\002...

==> The translation of 8-bit characters that have set it eighth bit
    get terrible wrong:
      hex(84) --> string(\37777777604)
      hex(EC) --> string(\37777777754)
    It seems that the octal number is written as 32 bit number instead
    of a 8 bit number.


Another test file scenario:

% include.tex:
\pdfinfo{/Title<0204840204>}
\nopagenumbers
\hbox{}
\bye

% test.tex:
\pdfcompresslevel=0
\pdfximage width 210bp height 297bp {test.pdf}
\pdfrefximage\pdflastximage
\nopagenumbers
\bye

==> /Title (\002\004\37777777604\002\004)

After the following patch:

==> /Title (\002\004\204\002\004)

Problem detected in pdftoepdf.cc:

static void copyObject(Object *obj)
{
    ...
    int  i, l, c;
    ...
    else if (obj->isString()) {
        s = obj->getString();
        p = s->getCString();
        l = s->getLength();
        if (strlen(p) == (unsigned int)l) {
            pdf_puts("(");
            for (; *p != 0; p++) {
% original:     c = *p;
% fix:          c = (unsigned char)*p;
                if (c == '(' || c == ')' || c == '\\')
                    pdf_printf("\\%c", c);
                else if (c < 0x20 || c > 0x7F)
                    pdf_printf("\\%03o", c);
                else
                    pdfout(c);
            }
            pdf_puts(")");
        }

The sign extension of *p with type "signed char" (8 bit)
to c with type "signed int" (32 bit) can explain the effect.

Alternatively
  pdf_printf("\\%03o", c);
can be changed to
  pdf_printf("\\%03o", (unsigned char)c);

Patch files based on 2003/07/29 v1.11a:
  pdftoepdf.cc.diff   for TeX/texk/web2c/pdftexdir/pdftoepdf.cc

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
--0OAP2g/MAC+5xKAE
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="pdftoepdf.cc.diff"

*** pdftoepdf.cc.org	Tue Jul 29 21:41:13 2003
--- pdftoepdf.cc	Tue Jul 29 22:06:34 2003
***************
*** 559,565 ****
          if (strlen(p) == (unsigned int)l) {
              pdf_puts("(");
              for (; *p != 0; p++) {
!                 c = *p;
                  if (c == '(' || c == ')' || c == '\\')
                      pdf_printf("\\%c", c);
                  else if (c < 0x20 || c > 0x7F)
--- 559,565 ----
          if (strlen(p) == (unsigned int)l) {
              pdf_puts("(");
              for (; *p != 0; p++) {
!                 c = (unsigned char)*p;
                  if (c == '(' || c == ')' || c == '\\')
                      pdf_printf("\\%c", c);
                  else if (c < 0x20 || c > 0x7F)

--0OAP2g/MAC+5xKAE--

From oberdiek@uni-freiburg.de  Tue Jul 29 21:22:27 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 29 Jul 2003 22:22:27 +0200
Subject: [NTG-pdftex] Bug: <hex> string to () string
In-Reply-To: <Pine.LNX.4.55.0307292110170.13908@hahepc1.hahe>
References: <20030729174335.GA1391@linux.vpn.uni-freiburg.de> <Pine.LNX.4.55.0307292110170.13908@hahepc1.hahe>
Message-ID: <20030729202227.GA7703@linux.vpn.uni-freiburg.de>

On Tue, Jul 29, 2003 at 09:15:22PM +0200, Hartmut Henkel wrote:

> On Tue, 29 Jul 2003, Heiko Oberdiek wrote:
> 
> > by pdfTeX, but the colors in some of the images are terrible wrong.
> 
> A typecast is missing in pdftexdir/pdftoepdf.cc, function copyObject():
> 
>             pdf_puts("(");
>             for (; *p != 0; p++) {
>                 c = (unsigned char) *p; // <--- typecast here!
>                 if (c == '(' || c == ')' || c == '\\')
>                     pdf_printf("\\%c", c);
>                 else if (c < 0x20 || c > 0x7F)
>                     pdf_printf("\\%03o", c);

Very nice, we found the same cause and fix. :-)

Best regards
  Heiko <oberdiek@uni-freiburg.de>

From ms@artcom-gmbh.de  Tue Jul 29 22:05:11 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Tue, 29 Jul 2003 23:05:11 +0200
Subject: [NTG-pdftex] Bug: <hex> string to () string
In-Reply-To: <Pine.LNX.4.55.0307292110170.13908@hahepc1.hahe>
References: <20030729174335.GA1391@linux.vpn.uni-freiburg.de> <Pine.LNX.4.55.0307292110170.13908@hahepc1.hahe>
Message-ID: <20030729210511.GA25206@lucien.kn-bremen.de>

On 2003-07-29 21:15:22 +0200, Hartmut Henkel wrote:
> On Tue, 29 Jul 2003, Heiko Oberdiek wrote:
> 
> > by pdfTeX, but the colors in some of the images are terrible wrong.
> 
> A typecast is missing in pdftexdir/pdftoepdf.cc, function copyObject():

Still? I thought gcc -Wall -pedantic had cought these... :-(

Will fix it.

Best regards
    Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10

From ms@artcom-gmbh.de  Wed Jul 30 09:54:48 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Wed, 30 Jul 2003 10:54:48 +0200
Subject: [NTG-pdftex] Patch 8BitString (was: Bug: <hex> string to () string)
In-Reply-To: <20030729202034.GA7681@linux.vpn.uni-freiburg.de>
References: <20030729174335.GA1391@linux.vpn.uni-freiburg.de> <20030729202034.GA7681@linux.vpn.uni-freiburg.de>
Message-ID: <20030730085448.GQ16501@artcom8.artcom-gmbh.de>

On 2003-07-29 22:20:34 +0200, Heiko Oberdiek wrote:
> *** pdftoepdf.cc.org	Tue Jul 29 21:41:13 2003
> --- pdftoepdf.cc	Tue Jul 29 22:06:34 2003
> ***************
> *** 559,565 ****
>           if (strlen(p) == (unsigned int)l) {
>               pdf_puts("(");
>               for (; *p != 0; p++) {
> !                 c = *p;
>                   if (c == '(' || c == ')' || c == '\\')
>                       pdf_printf("\\%c", c);
>                   else if (c < 0x20 || c > 0x7F)
> --- 559,565 ----
>           if (strlen(p) == (unsigned int)l) {
>               pdf_puts("(");
>               for (; *p != 0; p++) {
> !                 c = (unsigned char)*p;
>                   if (c == '(' || c == ')' || c == '\\')
>                       pdf_printf("\\%c", c);
>                   else if (c < 0x20 || c > 0x7F)

It's in (#3496). Is there any way to catch bugs like these with
gcc? Or is C just broken?

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From staw@gust.org.pl  Wed Jul 30 19:08:49 2003
From: staw@gust.org.pl (Staszek Wawrykiewicz)
Date: Wed, 30 Jul 2003 20:08:49 +0200 (CEST)
Subject: [NTG-pdftex] pdftex documentation
Message-ID: <Pine.LNX.4.44.0307301958540.21976-100000@re86.internetdsl.tpnet.pl>

Since we have so many changes in pdftex, is there any chance
having pdf documentation updated. There are still some documents
in pdf format in texmf/doc/pdftex/ , but... from Nov, 2 2001

Anyway I'd suggest adding texmf/doc/pdftex/NEWS

Ps. I'm bombarded by mails concerning, e.g., adjusting spaces, fontexpand,
efcode, etc., but cannot help :-(
Thanks,

-- 
Staszek Wawrykiewicz
StaW@gust.org.pl



From oberdiek@uni-freiburg.de  Wed Jul 30 21:08:11 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 30 Jul 2003 22:08:11 +0200
Subject: [NTG-pdftex] Patch CreationDate
Message-ID: <20030730200811.GA4696@linux>

--X1bOJ3K7DJ5YkBrT
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello,

Patch CreationDate

If /CreationDate is not given by \pdfinfo, then a default is
used by computing the string by the current setting of
\year, \month, and \time.

Problem A:
The time zone is not set. See the discussion in
  de.comp.text.tex, "[pdftex] Zeitzone von CreationDate"
Valentin Schwamberger observed that his AR/Windows shows then
the time as GMT.

Problem B:
It is easy to fool pdfTeX:
* Setting \year to a number less or greater than 4 digits.
* Setting \year, \month, \date, \time to invalid numbers,
  eg.: \month=13
The result are invalid dates.

The following patch tries to solve these problems:
* Time zone detection by glibc's strftime("%z").
* The current time is used, not \year, \month, ...

Patch files based on 2003/07/30 v1.11a:
  utils.c.diff        for TeX/texk/web2c/pdftexdir/utils.c
  pdftex.ch.diff      for TeX/texk/web2c/pdftexdir/pdftex.ch
  pdftex.defines.diff for TeX/texk/web2c/pdftexdir/pdftex.defines

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
--X1bOJ3K7DJ5YkBrT
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="utils.c.diff"

*** utils.c.org	Wed Jul 30 21:43:08 2003
--- utils.c	Wed Jul 30 21:42:46 2003
***************
*** 473,475 ****
--- 473,644 ----
      convertStringToHexString ((char*)digest, id);
      pdf_printf("/ID [%s %s]\n", id, id);
  }
+ 
+ /* Print the /CreationDate entry.
+ 
+   PDF Reference, third edition says about the expected date format:
+   <blockquote>
+     3.8.2 Dates
+ 
+       PDF defines a standard date format, which closely follows that of
+       the international standard ASN.1 (Abstract Syntax Notation One),
+       defined in ISO/IEC 8824 (see the Bibliography). A date is a string
+       of the form
+ 
+         (D:YYYYMMDDHHmmSSOHH'mm')
+ 
+       where
+ 
+         YYYY is the year
+         MM is the month
+         DD is the day (01-31)
+         HH is the hour (00-23)
+         mm is the minute (00-59)
+         SS is the second (00-59)
+         O is the relationship of local time to Universal Time (UT),
+           denoted by one of the characters +, -, or Z (see below)
+         HH followed by ' is the absolute value of the offset from UT
+           in hours (00-23)
+         mm followed by ' is the absolute value of the offset from UT
+           in minutes (00-59)
+ 
+       The apostrophe character (') after HH and mm is part of the syntax.
+       All elds after the year are optional. (The prefix D:, although also
+       optional, is strongly recommended.) The default values for MM and DD
+       are both 01; all other numerical elds default to zero values.  A plus
+       sign (+) as the value of the O field signifies that local time is
+       later than UT, a minus sign (-) that local time is earlier than UT,
+       and the letter Z that local time is equal to UT. If no UT information
+       is specified, the relationship of the specified time to UT is
+       considered to be unknown. Whether or not the time zone is known, the
+       rest of the date should be specified in local time.
+ 
+       For example, December 23, 1998, at 7:52 PM, U.S. Pacific Standard
+       Time, is represented by the string
+ 
+         D:199812231952-08'00'
+   </blockquote>
+ 
+   The main difficulty is get the time zone data. Function strftime()
+   of glibc knows "%z", the manual page says:
+   <blockquote>
+        %z     The time-zone as hour offset from GMT.  Required to
+               emit RFC822-conformant dates (using "%a, %d  %b  %Y
+               %H:%M:%S %z"). (GNU)
+   </blockquote>
+   Does this mean that the output of "%z" can have any RFC822-conformant
+   format?
+ 
+   RFC 822 specifies:
+   <blockquote>
+      5.  DATE AND TIME SPECIFICATION
+ 
+      5.1.  SYNTAX
+ 
+      [...]
+ 
+      zone        =  "UT"  / "GMT"                ; Universal Time
+                                                  ; North American : UT
+                  /  "EST" / "EDT"                ;  Eastern:  - 5/ - 4
+                  /  "CST" / "CDT"                ;  Central:  - 6/ - 5
+                  /  "MST" / "MDT"                ;  Mountain: - 7/ - 6
+                  /  "PST" / "PDT"                ;  Pacific:  - 8/ - 7
+                  /  1ALPHA                       ; Military: Z = UT;
+                                                  ;  A:-1; (J not used)
+                                                  ;  M:-12; N:+1; Y:+12
+                  / ( ("+" / "-") 4DIGIT )        ; Local differential
+                                                  ;  hours+min. (HHMM)
+   </blockquote>
+ */
+ void printcreationdate()
+ {
+     time_t t;
+     struct tm *tt;
+     size_t size;
+     char time_str[40];
+     char *zone_str;
+ 
+     /* get the time */
+     t = time(NULL);
+     tt = localtime(&t);
+     size = strftime(time_str, sizeof(time_str), "%Y%m%d%H%M%S%z", tt);
+     /* expected format: "YYYYmmddHHMMSSzzzzz" */
+ 
+     /* correction for seconds: %S can be in range 00..61,
+        the PDF reference expects 00..59,
+        therefore we map "60" and "61" to "59" */
+     if (zone_str[12] == '6' && zone_str[13] != 0) {
+         zone_str[12] == '5';
+         zone_str[13] == '9';
+     }
+ 
+     /* correction for time zone */
+     zone_str = &time_str[14];
+     if ((zone_str[0] == '+' || zone_str[0] == '-') &&
+         isdigit(zone_str[1]) &&
+         isdigit(zone_str[2]) &&
+         isdigit(zone_str[3]) &&
+         isdigit(zone_str[4]) &&
+         zone_str[5] == 0) {
+         /* test for GMT */
+         if (strcmp(&zone_str[1], "0000") == 0) {
+             /* case "+0000" or "-0000" */
+             zone_str[0] = 'Z';
+             zone_str[1] = 0;
+         }
+         else {
+             /* convert "sdddd" to "sdd'dd'" (s = sign, d = digit) */
+             zone_str[7] = 0;
+             zone_str[6] = '\'';
+             zone_str[5] = zone_str[4];
+             zone_str[4] = zone_str[3];
+             zone_str[3] = '\'';
+         }
+     }
+     else if (strcmp(zone_str, "Z") == 0) {
+         /* case "Z", nothing to do */
+     }
+     else if (strcmp(zone_str, "GMT") == 0 ||
+              strcmp(zone_str, "UT") == 0) {
+         /* case Universal Time */
+         zone_str[0] = 'Z';
+         zone_str[1] = 0;
+     }
+     else if (zone_str[1] == 0 &&
+              zone_str[0] >= 'A' &&
+              zone_str[0] <= 'M') {
+         /* Military: A:-1 .. M:-12 */
+         sprintf(zone_str, "-%02d'00'", zone_str[0] - 'A' + 1);
+     }
+     else if (zone_str[1] == 0 &&
+              zone_str[0] >= 'N' &&
+              zone_str[0] <= 'Y') {
+         /* Military: N:+1 .. Y:+12 */
+         sprintf(zone_str, "+%02d'00'", zone_str[0] - 'N' + 1);
+     }
+     else if (strcmp(zone_str, "EDT") == 0) {
+         strcpy(zone_str, "-04'00'");
+     }
+     else if (strcmp(zone_str, "EST") == 0 ||
+              strcmp(zone_str, "CDT") == 0) {
+         strcpy(zone_str, "-05'00'");
+     }
+     else if (strcmp(zone_str, "CST") == 0 ||
+              strcmp(zone_str, "MDT") == 0) {
+         strcpy(zone_str, "-06'00'");
+     }
+     else if (strcmp(zone_str, "MST") == 0 ||
+              strcmp(zone_str, "PDT") == 0) {
+         strcpy(zone_str, "-07'00'");
+     }
+     else if (strcmp(zone_str, "PST") == 0) {
+         strcpy(zone_str, "-08'00'");
+     }
+     else {
+         /* unknown zone format or "%z" is not supported by strftime() */
+         zone_str[0] = 0;
+     }
+ 
+     /* print result */
+     pdf_printf("/CreationDate (D:%s)\n", time_str);
+ }

--X1bOJ3K7DJ5YkBrT
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="pdftex.ch.diff"

*** pdftex.ch.org	Wed Jul 30 20:47:21 2003
--- pdftex.ch	Wed Jul 30 20:58:40 2003
***************
*** 4585,4597 ****
  pdf_print_ln(")")
  
  @ @<Print the CreationDate key@>=
! pdf_print("/CreationDate (D:");
! pdf_print_int(year);
! pdf_print_two(month);
! pdf_print_two(day);
! pdf_print_two(time div 60);
! pdf_print_two(time mod 60);
! pdf_print_ln("00)")
  
  @ @<Glob...@>=
  @!pdftex_banner: str_number;   {the complete banner}
--- 4585,4591 ----
  pdf_print_ln(")")
  
  @ @<Print the CreationDate key@>=
! print_creation_date;
  
  @ @<Glob...@>=
  @!pdftex_banner: str_number;   {the complete banner}

--X1bOJ3K7DJ5YkBrT
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="pdftex.defines.diff"

*** pdftex.defines.org	Wed Jul 30 20:46:06 2003
--- pdftex.defines	Wed Jul 30 21:00:34 2003
***************
*** 50,55 ****
--- 50,56 ----
  @define procedure libpdffinish;
  @define procedure writestreamlength();
  @define procedure printID();
+ @define procedure printcreationdate;
  
  { functions from vfpacket.c }
  @define function newvfpacket();

--X1bOJ3K7DJ5YkBrT--

From ms@artcom-gmbh.de  Wed Jul 30 23:24:31 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 00:24:31 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030730200811.GA4696@linux>
References: <20030730200811.GA4696@linux>
Message-ID: <20030730222431.GA2329@lucien.kn-bremen.de>

On 2003-07-30 22:08:11 +0200, Heiko Oberdiek wrote:
> Patch files based on 2003/07/30 v1.11a:
>   utils.c.diff        for TeX/texk/web2c/pdftexdir/utils.c
>   pdftex.ch.diff      for TeX/texk/web2c/pdftexdir/pdftex.ch
>   pdftex.defines.diff for TeX/texk/web2c/pdftexdir/pdftex.defines

Thanks!

[...]

> +   <blockquote>
> +        %z     The time-zone as hour offset from GMT.  Required to
> +               emit RFC822-conformant dates (using "%a, %d  %b  %Y
> +               %H:%M:%S %z"). (GNU)
> +   </blockquote>
> +   Does this mean that the output of "%z" can have any RFC822-conformant
> +   format?

Probably not. %Z gives names, %z only offsets.
date(1) has this:
%z     RFC-822 style numeric timezone (-0500) (a nonstandard extension)

I'll check the sources.

Best regards
    Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10

From pragma@wxs.nl  Thu Jul 31 09:54:47 2003
From: pragma@wxs.nl (Hans Hagen)
Date: Thu, 31 Jul 2003 10:54:47 +0200
Subject: [NTG-pdftex] pdftex documentation
In-Reply-To: <Pine.LNX.4.44.0307301958540.21976-100000@re86.internetdsl.
 tpnet.pl>
Message-ID: <5.2.0.9.1.20030731105343.029dead0@server-1>

At 20:08 30/07/2003 +0200, Staszek Wawrykiewicz wrote:
>Since we have so many changes in pdftex, is there any chance
>having pdf documentation updated. There are still some documents
>in pdf format in texmf/doc/pdftex/ , but... from Nov, 2 2001
>
>Anyway I'd suggest adding texmf/doc/pdftex/NEWS
>
>Ps. I'm bombarded by mails concerning, e.g., adjusting spaces, fontexpand,
>efcode, etc., but cannot help :-(

i'll look at the docu later this year; with regards to adjusting: this 
needs a closer look since there is a discrepancy between than's thesis and 
pdftex itself, as well as that thanh wants to clean up that code.

Hans



-------------------------------------------------------------------------
                                   Hans Hagen | PRAGMA ADE | pragma@wxs.nl
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From ms@artcom-gmbh.de  Thu Jul 31 11:11:41 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 12:11:41 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030730222431.GA2329@lucien.kn-bremen.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de>
Message-ID: <20030731101141.GJ16501@artcom8.artcom-gmbh.de>

On 2003-07-31 00:24:31 +0200, Martin Schröder wrote:
> Probably not. %Z gives names, %z only offsets.
> date(1) has this:
> %z     RFC-822 style numeric timezone (-0500) (a nonstandard extension)

%z is a GNU extension -- Solaris 2.5 doesn't have it.

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 31 11:50:59 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 12:50:59 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731101141.GJ16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731105059.GK16501@artcom8.artcom-gmbh.de>

On 2003-07-31 12:11:41 +0200, Martin Schröder wrote:
> On 2003-07-31 00:24:31 +0200, Martin Schröder wrote:
> > Probably not. %Z gives names, %z only offsets.
> > date(1) has this:
> > %z     RFC-822 style numeric timezone (-0500) (a nonstandard extension)
> 
> %z is a GNU extension -- Solaris 2.5 doesn't have it.

Correction: ISO C99

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 31 13:15:31 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 14:15:31 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030730200811.GA4696@linux>
References: <20030730200811.GA4696@linux>
Message-ID: <20030731121531.GA1068@linux.vpn.uni-freiburg.de>

On Wed, Jul 30, 2003 at 10:08:11PM +0200, Heiko Oberdiek wrote:

> Patch CreationDate

>   utils.c.diff        for TeX/texk/web2c/pdftexdir/utils.c

First bug fix:

> +     if (zone_str[12] == '6' && zone_str[13] != 0) {
> +         zone_str[12] == '5';
> +         zone_str[13] == '9';
> +     }

Should read:

+     if (zone_str[12] == '6' && zone_str[13] != 0) {
+         zone_str[12] = '5';
+         zone_str[13] = '9';
+     }

Explanation for "zone_str[13] != 0":
I check here not for '0' and '1' explicitly, but also for
other don't care cases to save one test. ("6X" with all
possible X except '\0').

The string end test is needed for safety, because it 
would be overwritten by "zone_str[13] = '9';

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From oberdiek@uni-freiburg.de  Thu Jul 31 13:37:19 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 14:37:19 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731105059.GK16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731123718.GB1068@linux.vpn.uni-freiburg.de>

On Thu, Jul 31, 2003 at 12:50:59PM +0200, Martin Schroeder wrote:

> On 2003-07-31 12:11:41 +0200, Martin Schröder wrote:
> > On 2003-07-31 00:24:31 +0200, Martin Schröder wrote:
> > > Probably not. %Z gives names, %z only offsets.
> > > date(1) has this:
> > > %z     RFC-822 style numeric timezone (-0500) (a nonstandard extension)
> > 
> > %z is a GNU extension -- Solaris 2.5 doesn't have it.
> 
> Correction: ISO C99

I have not found, whether %z always results in the sign-four-digit format,
if it is supported. If yes, then most test for RFC-822 time zone
names could be dropped.

In my manual page it was marked as glibc extension, so other
systems without can miss support of %z. How the time zone difference
can be calculated there in a save way? Have to be used the following
procedure or are there better ways?

/* test.c */
#include <time.h>
#include <stdio.h>

int main() {

  time_t t1, t2;
  struct tm *tt;
  double diff;
  int diff_mins;

  t1 = time(0);
  tt = gmtime(&t1);
  tt->tm_isdst = -1;
  t2 = mktime(tt);
  diff = difftime(t1, t2);
  diff_mins = (int)diff/60;

  printf("Diff: %c%02d%02d\n", (diff_mins < 0 ? '-' : '+'),
    abs(diff_mins)/60, abs(diff_mins)%60);

  return 0;
}
/* test.c */

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 31 13:54:18 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 14:54:18 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731121531.GA1068@linux.vpn.uni-freiburg.de>
References: <20030730200811.GA4696@linux> <20030731121531.GA1068@linux.vpn.uni-freiburg.de>
Message-ID: <20030731125418.GL16501@artcom8.artcom-gmbh.de>

On 2003-07-31 14:15:31 +0200, Heiko Oberdiek wrote:
> +     if (zone_str[12] == '6' && zone_str[13] != 0) {
> +         zone_str[12] = '5';
> +         zone_str[13] = '9';
> +     }

s/zone_str/time_str/ :-)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 31 13:56:52 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 14:56:52 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731123718.GB1068@linux.vpn.uni-freiburg.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de>
Message-ID: <20030731125652.GM16501@artcom8.artcom-gmbh.de>

On 2003-07-31 14:37:19 +0200, Heiko Oberdiek wrote:
> In my manual page it was marked as glibc extension, so other
> systems without can miss support of %z. How the time zone difference
> can be calculated there in a save way? Have to be used the following
> procedure or are there better ways?

There is. :-)

<quote src=utils.c#13>
  The main difficulty is get the time zone offset. strftime() does this in ISO
  C99 (e.g. newer glibc) with %z, but we have to work with other systems (e.g.
  Solaris 2.5). So we must use localtime(), which sets the external variable
  timezone (either int or time_t) to the seconds since UTC.
*/
void printcreationdate()
{
    time_t t;
    struct tm *tt;
    size_t size;
    char time_str[40];
    int hours, minutes;

    /* get the time */
    t = time(NULL);
    tt = localtime(&t);
    size = strftime(time_str, sizeof(time_str), "%Y%m%d%H%M%S", tt);
    /* expected format: "YYYYmmddHHMMSS" */

    /* correction for seconds: %S can be in range 00..61,
       the PDF reference expects 00..59,
       therefore we map "60" and "61" to "59" */
    if (time_str[12] == '6' && time_str[13] != 0) {
        time_str[12] == '5';
        time_str[13] == '9';
    }

    /* get the time zone offset */
    hours = ((long int)timezone)/3600;
    minutes = labs((long int)timezone) - (abs(hours) * 3600L);
    sprintf (&time_str[size], "%+03i'%02d'", hours, minutes);

    /* print result */
    pdf_printf("/CreationDate (D:%s)\n", time_str);
}
</quote>

The offset is off by one hour on Suse 7.0/7.1, but I regard this
as a minor misfeature. :-)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 31 14:45:17 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 15:45:17 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731125418.GL16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030731121531.GA1068@linux.vpn.uni-freiburg.de> <20030731125418.GL16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731134516.GA1624@linux.vpn.uni-freiburg.de>

On Thu, Jul 31, 2003 at 02:54:18PM +0200, Martin Schroeder wrote:

> On 2003-07-31 14:15:31 +0200, Heiko Oberdiek wrote:
> > +     if (zone_str[12] == '6' && zone_str[13] != 0) {
> > +         zone_str[12] = '5';
> > +         zone_str[13] = '9';
> > +     }
> 
> s/zone_str/time_str/ :-)

Yes, second bug.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From oberdiek@uni-freiburg.de  Thu Jul 31 15:11:15 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 16:11:15 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731125652.GM16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de> <20030731125652.GM16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731141115.GB1624@linux.vpn.uni-freiburg.de>

On Thu, Jul 31, 2003 at 02:56:52PM +0200, Martin Schroeder wrote:

> On 2003-07-31 14:37:19 +0200, Heiko Oberdiek wrote:
> > In my manual page it was marked as glibc extension, so other
> > systems without can miss support of %z. How the time zone difference
> > can be calculated there in a save way? Have to be used the following
> > procedure or are there better ways?
> 
> There is. :-)
> 
> <quote src=utils.c#13>
>   The main difficulty is get the time zone offset. strftime() does this in ISO
>   C99 (e.g. newer glibc) with %z, but we have to work with other systems (e.g.
>   Solaris 2.5). So we must use localtime(), which sets the external variable
>   timezone (either int or time_t) to the seconds since UTC.
> */
> void printcreationdate()
> {
>     time_t t;
>     struct tm *tt;
>     size_t size;
>     char time_str[40];
>     int hours, minutes;
> 
>     /* get the time */
>     t = time(NULL);
>     tt = localtime(&t);
>     size = strftime(time_str, sizeof(time_str), "%Y%m%d%H%M%S", tt);
>     /* expected format: "YYYYmmddHHMMSS" */
> 
>     /* correction for seconds: %S can be in range 00..61,
>        the PDF reference expects 00..59,
>        therefore we map "60" and "61" to "59" */
>     if (time_str[12] == '6' && time_str[13] != 0) {
>         time_str[12] == '5';
>         time_str[13] == '9';
>     }
> 
>     /* get the time zone offset */
>     hours = ((long int)timezone)/3600;
>     minutes = labs((long int)timezone) - (abs(hours) * 3600L);
>     sprintf (&time_str[size], "%+03i'%02d'", hours, minutes);

* Not really, the minutes are seconds ...
* timezone: GMT - Localtime? But wanted is: Localtime - GMT?

/* test.c */
#include <stdio.h>
#include <time.h>

int main() {

  time_t t;
  struct tm *tt;
  int diff_minutes;

  t = time(NULL);
  tt = localtime(&t);
  diff_minutes = -(long int)timezone/60;

  /* diff_minutes = -70; */ 

  printf("%+03i'%02d'", diff_minutes/60, abs(diff_minutes % 60));

  return 0;
}
/* test.c */

> The offset is off by one hour on Suse 7.0/7.1, but I regard this
> as a minor misfeature. :-)

This is the reason, why I have not used it. The same here (SuSE 7.2),
the test file generates:
  +01'00'
But
  $ date --rfc-822
  Don, 31 Jul 2003 16:00:21 +0200

The same under SunOS Release 5.7:
  +01'00'

My man page says:

|       The localtime() function converts the calendar time  timep
|       to  broken-time  representation, expressed relative to the
|       user's specified  time  zone.     The  function  sets  the
|       external  variables tzname with information about the cur­
|       rent time zone, timezone with the difference between Coor­
|       dinated  Universal  Time  (UTC) and local standard time in
|       seconds, and daylight to a non-zero value if  standard  US
|       daylight savings time rules apply.

Perhaps we have to take daylight into account in some way:

  if (daylight) {
    diff_minutes += 60;
  }

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

From ms@artcom-gmbh.de  Thu Jul 31 16:04:06 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 17:04:06 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731141115.GB1624@linux.vpn.uni-freiburg.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de> <20030731125652.GM16501@artcom8.artcom-gmbh.de> <20030731141115.GB1624@linux.vpn.uni-freiburg.de>
Message-ID: <20030731150406.GN16501@artcom8.artcom-gmbh.de>

On 2003-07-31 16:11:15 +0200, Heiko Oberdiek wrote:
> Perhaps we have to take daylight into account in some way:
> 
>   if (daylight) {
>     diff_minutes += 60;
>   }

Can we be sure that the daylight offset is always and everywhere
60 minutes?  Also it conforms to "standard US daylight savings
time rules" -- whatever that may be.

I experimented with gmtime, mktime and difftime:

    gtm = gmtime(&tt);
    gt = mktime(gtm);
    seconds = (long int) difftime(tt, gt);
    fprintf(stderr, "\nseconds: %li\n", seconds);
    hours = seconds/3600;
    minutes = (labs(seconds) - (abs(hours) * 3600L))/60;
    sprintf (&time_str[size], "%+03i'%02d'", hours, minutes);

But seconds is 3600 while it should be 7200. :-(

I also tried leaving out the tz information in /CreationDate by
setting O to Z and leaving out the offset; but AR5 ignores any
offset and interprets the time as CEST. :-(

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From ms@artcom-gmbh.de  Thu Jul 31 17:59:04 2003
From: ms@artcom-gmbh.de (Martin Schroeder)
Date: Thu, 31 Jul 2003 18:59:04 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731150406.GN16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de> <20030731125652.GM16501@artcom8.artcom-gmbh.de> <20030731141115.GB1624@linux.vpn.uni-freiburg.de> <20030731150406.GN16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731165904.GR16501@artcom8.artcom-gmbh.de>

On 2003-07-31 17:04:06 +0200, Martin Schröder wrote:
> I also tried leaving out the tz information in /CreationDate by
> setting O to Z and leaving out the offset; but AR5 ignores any
> offset and interprets the time as CEST. :-(

Thanks to Thomas I think I have a solution (idea borrowed from sendmail):

void printcreationdate()
{
    time_t t;
    struct tm lt, gmt;
    size_t size;
    char time_str[20];
    int off, hours, minutes;

    /* get the time */
    t = time(NULL);
    lt = *localtime(&t);
    size = strftime(time_str, sizeof(time_str), "%Y%m%d%H%M%S", &lt);
    /* expected format: "YYYYmmddHHMMSS" */

    /* correction for seconds: %S can be in range 00..61,
       the PDF reference expects 00..59,
       therefore we map "60" and "61" to "59" */
    if (time_str[12] == '6') {
        time_str[12] == '5';
        time_str[13] == '9';
    }

    /* get the time zone offset */
    gmt = *gmtime(&t);
    off = (lt.tm_hour - gmt.tm_hour) * 60 + lt.tm_min - gmt.tm_min;
#ifdef DEBUG
    fprintf(stderr, "\noff: %i\n", off);
#endif
    hours = off/60;
    minutes = (abs(off) - (abs(hours) * 60))/60;
    sprintf (&time_str[size], "%+03i'%02d'", hours, minutes);

    /* print result */
    pdf_printf("/CreationDate (D:%s)\n", time_str);
}

off is 120. :-)

Best regards
        Martin
-- 
               Martin Schröder, MS@ArtCom-GmbH.DE
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10


From oberdiek@uni-freiburg.de  Thu Jul 31 20:45:16 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 21:45:16 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731165904.GR16501@artcom8.artcom-gmbh.de>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de> <20030731125652.GM16501@artcom8.artcom-gmbh.de> <20030731141115.GB1624@linux.vpn.uni-freiburg.de> <20030731150406.GN16501@artcom8.artcom-gmbh.de> <20030731165904.GR16501@artcom8.artcom-gmbh.de>
Message-ID: <20030731194516.GA1127@linux>

--Qxx1br4bt0+wmkIi
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit

On Thu, Jul 31, 2003 at 06:59:04PM +0200, Martin Schroeder wrote:

> On 2003-07-31 17:04:06 +0200, Martin Schröder wrote:
> > I also tried leaving out the tz information in /CreationDate by
> > setting O to Z and leaving out the offset; but AR5 ignores any
> > offset and interprets the time as CEST. :-(
> 
> Thanks to Thomas I think I have a solution (idea borrowed from sendmail):
> 
> void printcreationdate()
> {
>     [...]
>     char time_str[20];

too small.

>     [...]
>     /* get the time zone offset */
>     gmt = *gmtime(&t);
>     off = (lt.tm_hour - gmt.tm_hour) * 60 + lt.tm_min - gmt.tm_min;

Not enough, lt and gmt can be different days.

>     [...]
> }

I found the sources of exim here, where I found a similar method,
but with checking of year and day. So I have attached a new patch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
--Qxx1br4bt0+wmkIi
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="utils.c.diff"

*** utils.c.org	Wed Jul 30 21:43:08 2003
--- utils.c	Thu Jul 31 21:36:50 2003
***************
*** 473,475 ****
--- 473,575 ----
      convertStringToHexString ((char*)digest, id);
      pdf_printf("/ID [%s %s]\n", id, id);
  }
+ 
+ /* Print the /CreationDate entry.
+ 
+   PDF Reference, third edition says about the expected date format:
+   <blockquote>
+     3.8.2 Dates
+ 
+       PDF defines a standard date format, which closely follows that of
+       the international standard ASN.1 (Abstract Syntax Notation One),
+       defined in ISO/IEC 8824 (see the Bibliography). A date is a string
+       of the form
+ 
+         (D:YYYYMMDDHHmmSSOHH'mm')
+ 
+       where
+ 
+         YYYY is the year
+         MM is the month
+         DD is the day (01-31)
+         HH is the hour (00-23)
+         mm is the minute (00-59)
+         SS is the second (00-59)
+         O is the relationship of local time to Universal Time (UT),
+           denoted by one of the characters +, -, or Z (see below)
+         HH followed by ' is the absolute value of the offset from UT
+           in hours (00-23)
+         mm followed by ' is the absolute value of the offset from UT
+           in minutes (00-59)
+ 
+       The apostrophe character (') after HH and mm is part of the syntax.
+       All elds after the year are optional. (The prefix D:, although also
+       optional, is strongly recommended.) The default values for MM and DD
+       are both 01; all other numerical elds default to zero values.  A plus
+       sign (+) as the value of the O field signifies that local time is
+       later than UT, a minus sign (-) that local time is earlier than UT,
+       and the letter Z that local time is equal to UT. If no UT information
+       is specified, the relationship of the specified time to UT is
+       considered to be unknown. Whether or not the time zone is known, the
+       rest of the date should be specified in local time.
+ 
+       For example, December 23, 1998, at 7:52 PM, U.S. Pacific Standard
+       Time, is represented by the string
+ 
+         D:199812231952-08'00'
+   </blockquote>
+ */
+ void printcreationdate()
+ {
+     time_t t;
+     struct tm lt, gmt;
+     size_t size;
+     /* minimum size for time_str is 22: "YYYYmmddHHMMSS+HH'MM'" */
+     char time_str[40]; /* larger value for safety */
+     int off, off_hours, off_mins;
+ 
+     /* get the time */
+     t = time(NULL);
+     lt = *localtime(&t);
+     size = strftime(time_str, sizeof(time_str), "%Y%m%d%H%M%S", &lt);
+     /* expected format: "YYYYmmddHHMMSS" */
+     if (size != 14) {
+         /* An unexpected result of strftime */
+         pdftex_warn("/CreationDate dropped because of "
+                     "unexpected result of strftime()");
+         return;
+     }
+ 
+     /* correction for seconds: %S can be in range 00..61,
+        the PDF reference expects 00..59,
+        therefore we map "60" and "61" to "59" */
+     if (time_str[12] == '6') {
+         time_str[12] = '5';
+         time_str[13] = '9'; /* we have checked for size above */
+     }
+ 
+     /* get the time zone offset */
+     gmt = *gmtime(&t);
+ 
+     /* this calculation method was found in exim's tod.c */
+     off = 60*(lt.tm_hour - gmt.tm_hour) + lt.tm_min - gmt.tm_min;
+     if (lt.tm_year != gmt.tm_year) {
+         off += (lt.tm_year > gmt.tm_year) ? 1440 : -1440;
+     }
+     else if (lt.tm_yday != gmt.tm_yday) {
+         off += (lt.tm_yday > gmt.tm_yday) ? 1440 : -1440;
+     }
+ 
+     if (off == 0) {
+         time_str[size++] = 'Z';
+         time_str[size] = 0;
+     }
+     else {
+         off_hours = off/60;
+         off_mins = abs(off - off_hours*60);
+         sprintf(&time_str[size], "%+03i'%02d'", off_hours, off_mins);
+     }
+ 
+     /* print result */
+     pdf_printf("/CreationDate (D:%s)\n", time_str);
+ }

--Qxx1br4bt0+wmkIi--

From oberdiek@uni-freiburg.de  Thu Jul 31 20:52:10 2003
From: oberdiek@uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 31 Jul 2003 21:52:10 +0200
Subject: [NTG-pdftex] Patch CreationDate
In-Reply-To: <20030731194516.GA1127@linux>
References: <20030730200811.GA4696@linux> <20030730222431.GA2329@lucien.kn-bremen.de> <20030731101141.GJ16501@artcom8.artcom-gmbh.de> <20030731105059.GK16501@artcom8.artcom-gmbh.de> <20030731123718.GB1068@linux.vpn.uni-freiburg.de> <20030731125652.GM16501@artcom8.artcom-gmbh.de> <20030731141115.GB1624@linux.vpn.uni-freiburg.de> <20030731150406.GN16501@artcom8.artcom-gmbh.de> <20030731165904.GR16501@artcom8.artcom-gmbh.de> <20030731194516.GA1127@linux>
Message-ID: <20030731195210.GA2166@linux>

Hello,

it would be nice, if the same time could be used for
initialization of \year, \month, \day, and \time
as for the default /CreationDate.

The initialization of \year, ... is done in function
get_date_and_time() in files "pdf(e)texextra.c" that
are automatically generated in the Makefile from
file "lib/texmfmp.c". That would make such a patch a little
nasty.
  The local variable "clock" of get_date_and_time()
could be stored in a global variable that is reused
by printcreationdate() instead of calling time(NULL) again.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 

