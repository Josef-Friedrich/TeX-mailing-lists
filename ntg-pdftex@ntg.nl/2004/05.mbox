From The Thanh Han <hanthethanh@myrealbox.com>  Tue May  4 03:45:25 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Tue, 4 May 2004 09:45:25 +0700
Subject: [NTG-pdftex] easy font expansion
Message-ID: <20040504024525.GA1439@monty>

Hi,

I did some (quite heavy) changes on pdftex to support font expansion, so
it can be used easily. So far the font expansion feature requires that
user must be able to create expanded tfm (eg cmr10+10.tfm). Now font
expansion can be used without expanded tfm. One can say:

\font\f=cmr10
\pdffontexpand\f 20 20 5 autoexpand

and pdftex will create those expanded tfm like cmr10+10, cmr10-20, etc.
automatically. This also works for virtual fonts (like ptmr8t).

The sources tarball is available at

http://vntex.sourceforge.net/private/thanh/pdftex/pdftex-2004_05_02.tar.bz2

[to Hans Hagen: the djgpp binary of pdfxtex is avail. at the same
location]


I didn't submit this version to the texlive repository yet, because I
changed the sources quite a lot and it can introduce new bugs.

For those interested in details of automatical font expansion:

1) a tfm is expanded by copying the metrics from the base tfm, then
character widths, kerns and italic corrections are adjusted.

2) for virtual fonts: nothing is changed apart from local font
definitions (they are automatically expanded just like (1)). This
means that some accents can be misplaced by a very small amount
(0.01--0.01pt). If this amount seems too much to you, then the wokraround
is to create expanded tfm manually.

A minimal test file can look like:

=======================================
\pdffontexpand\font 20 20 5 autoexpand
\pdfadjustspacing 2

<A few long paragraphs here>
\bye
=======================================

Then open the pdf file in acroreader and look at File->Info->Fonts, or
use pdffonts (comes from xpdf) to see whether the body font is expanded.

What is font expansion good for?

1) if you care about micro-typography like even word spacing and greyness of your
pages;

2) if you are typesetting narrow columns and would like to get rid of
those overfull/underfull boxes or frequent hyphenations with none (or
liltle) manual tweaking.

Feedbacks are welcome very much.

Thanh

PS: this version also fixes the problem with \mag

From ms@artcom-gmbh.de  Tue May  4 09:43:25 2004
From: ms@artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue, 4 May 2004 10:43:25 +0200
Subject: [NTG-pdftex] \mag (was: easy font expansion)
In-Reply-To: <20040504024525.GA1439@monty>
References: <20040504024525.GA1439@monty>
Message-ID: <20040504084325.GA31047@artcom8.artcom-gmbh.de>

On 2004-05-04 09:45:25 +0700, The Thanh Han wrote:
> PS: this version also fixes the problem with \mag

How? I.e. what do you think is the correct behaviour?

Best regards
        Martin
-- 
               Martin Schröder, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de

From kakuto@fsci.fuk.kindai.ac.jp  Wed May  5 00:50:44 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Wed, 05 May 2004 08:50:44 +0900
Subject: [NTG-pdftex] Re: easy font expansion
In-Reply-To: Your message of "Tue, 04 May 2004 12:00:10 +0200"
References: <20040504100010.28925.27812.Mailman@ref.ntg.nl>
Message-ID: <200405042350.i44Noklh003340@jupiter.fsci.fuk.kindai.ac.jp>

> I did some (quite heavy) changes on pdftex to support font expansion, so
> it can be used easily. So far the font expansion feature requires that
> user must be able to create expanded tfm (eg cmr10+10.tfm). Now font
> expansion can be used without expanded tfm. One can say:

Great!  Thanks a lot. The new pdfxTeX is compatible with
Olaf's new tex.ch if you use tex.ch2 with only 5 lines:

@x
@d format_extension=".efmt" {the extension, as a \.{WEB} constant}
@y
@d format_extension=".xfmt" {the extension, as a \.{WEB} constant}
@z


Best regards
Akira

From The Thanh Han <hanthethanh@myrealbox.com>  Wed May  5 02:41:13 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 5 May 2004 08:41:13 +0700
Subject: [NTG-pdftex] \mag (was: easy font expansion)
In-Reply-To: <20040504084325.GA31047@artcom8.artcom-gmbh.de>
References: <20040504024525.GA1439@monty> <20040504084325.GA31047@artcom8.artcom-gmbh.de>
Message-ID: <20040505014112.GF529@monty>

On Tue, May 04, 2004 at 10:43:25AM +0200, Martin Schroeder wrote:
> On 2004-05-04 09:45:25 +0700, The Thanh Han wrote:
> > PS: this version also fixes the problem with \mag
> 
> How? I.e. what do you think is the correct behaviour?

that every dimen register is affected by \mag, including \pdfpagewidth,
\pdfpageheight and \pdf[hv]origin. They can be set just like other dimen
registers, ie if you want true dimension, you must set it after \mag has
been set.

Thanh

From pragma@wxs.nl  Tue May  4 21:21:30 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Tue, 04 May 2004 22:21:30 +0200
Subject: [NTG-pdftex] easy font expansion
In-Reply-To: <20040504024525.GA1439@monty>
References: <20040504024525.GA1439@monty>
Message-ID: <6.0.1.1.2.20040504221550.01cff310@server-1>

Hi Thanh,

>I did some (quite heavy) changes on pdftex to support font expansion, so
>it can be used easily. So far the font expansion feature requires that
>user must be able to create expanded tfm (eg cmr10+10.tfm). Now font
>expansion can be used without expanded tfm. One can say:
>
>\font\f=cmr10
>\pdffontexpand\f 20 20 5 autoexpand
>
>and pdftex will create those expanded tfm like cmr10+10, cmr10-20, etc.
>automatically. This also works for virtual fonts (like ptmr8t).
>
>The sources tarball is available at
>
>http://vntex.sourceforge.net/private/thanh/pdftex/pdftex-2004_05_02.tar.bz2
>
>[to Hans Hagen: the djgpp binary of pdfxtex is avail. at the same
>location]

got it ... works great! this will make hz really usable!

i'll see if i can test some big documents.

Hans  


From tipogral@freemail.hu  Wed May  5 09:50:11 2004
From: tipogral@freemail.hu (Nagy Bence)
Date: Wed, 5 May 2004 10:50:11 +0200
Subject: [NTG-pdftex] easy font expansion
In-Reply-To: <20040504024525.GA1439@monty>
References: <20040504024525.GA1439@monty>
Message-ID: <20040505105011.20bfd4c4.tipogral@freemail.hu>

> http://vntex.sourceforge.net/private/thanh/pdftex/pdftex-2004_05_02.tar.bz2

What is the difference between Thanh's archive and the 1.20a-rc1 version
(except the new font expansion)? What contains this 800 kB extra
filesize?

Greetings,

Bence

From Fabrice.Popineau@supelec.fr  Thu May  6 10:29:46 2004
From: Fabrice.Popineau@supelec.fr (Fabrice Popineau)
Date: Thu, 6 May 2004 11:29:46 +0200
Subject: [NTG-pdftex] easy font expansion
In-Reply-To: <20040504024525.GA1439@monty>
Message-ID: <200405060929.i469Tl715277@esemetz.metz.supelec.fr>

> The sources tarball is available at
> 
> http://vntex.sourceforge.net/private/thanh/pdftex/pdftex-
> 2004_05_02.tar.bz2

Before I spend too much time checking : are your changes limited to
texk/web2c/pdf(x)tex ? Nothing else in kpathsea or whatever library ?

Fabrice


From The Thanh Han <hanthethanh@myrealbox.com>  Fri May  7 01:52:45 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Fri, 7 May 2004 07:52:45 +0700
Subject: [NTG-pdftex] easy font expansion
In-Reply-To: <200405060929.i469Tl715277@esemetz.metz.supelec.fr>
References: <20040504024525.GA1439@monty> <200405060929.i469Tl715277@esemetz.metz.supelec.fr>
Message-ID: <20040507005245.GA606@monty>

yes my changes didn't touch anything outside the pdftexdir/ directory

Thanh



On Thu, May 06, 2004 at 11:29:46AM +0200, Fabrice Popineau wrote:
> > The sources tarball is available at
> > 
> > http://vntex.sourceforge.net/private/thanh/pdftex/pdftex-
> > 2004_05_02.tar.bz2
> 
> Before I spend too much time checking : are your changes limited to
> texk/web2c/pdf(x)tex ? Nothing else in kpathsea or whatever library ?
> 
> Fabrice
> 
> 

From kakuto@fsci.fuk.kindai.ac.jp  Fri May  7 05:03:47 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Fri, 07 May 2004 13:03:47 +0900
Subject: [NTG-pdftex] Re: easy font expansion
In-Reply-To: Your message of "Tue, 04 May 2004 12:00:10 +0200"
References: <20040504100010.28925.27812.Mailman@ref.ntg.nl>
Message-ID: <200405070403.i4743mai018476@jupiter.fsci.fuk.kindai.ac.jp>

> This also works for virtual fonts (like ptmr8t).

If I use hz for base 14 fonts, pdf[ex]TeX crashes.
But, if base 14 fonts are embedded by changing pdftex.map like
ptmr8r Times-Roman "TeXBase1Encoding ReEncodeFont" <8r.enc
--->
ptmr8r "TeXBase1Encoding ReEncodeFont" <8r.enc <utmr8a.pfb
hz can be used for base 14 fonts.

Best regards
Akira

From reinhard.kotucha@web.de  Fri May  7 21:58:03 2004
From: reinhard.kotucha@web.de (Reinhard Kotucha)
Date: Fri, 7 May 2004 22:58:03 +0200
Subject: [NTG-pdftex] Re: easy font expansion
In-Reply-To: <200405070403.i4743mai018476@jupiter.fsci.fuk.kindai.ac.jp>
References: <20040504100010.28925.27812.Mailman@ref.ntg.nl>
 <200405070403.i4743mai018476@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <16539.63579.744028.951124@zarniwoop.ms25.local>

>>>>> "Akira" == Akira Kakuto <kakuto@fsci.fuk.kindai.ac.jp> writes:

    >> This also works for virtual fonts (like ptmr8t).
    > If I use hz for base 14 fonts, pdf[ex]TeX crashes.  But, if base
    > 14 fonts are embedded by changing pdftex.map like ptmr8r
    > Times-Roman "TeXBase1Encoding ReEncodeFont" <8r.enc
    > --->
    > ptmr8r "TeXBase1Encoding ReEncodeFont" <8r.enc <utmr8a.pfb hz
    > can be used for base 14 fonts.

This is a limitation of PDF, not pdftex.

In a pdf document you cannot change the FontMatrix as you can do in
PostScript.  Therefore pdftex has to manipulate the font itself when
it is inserted.  If you run pdffonts (from xpdf) on your pdf file
you'll see that the same font is embedded for each expansion step.

It is certainly mentioned in the pdftex manual.  If not, complain.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------



From kakuto@fsci.fuk.kindai.ac.jp  Fri May  7 23:18:58 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 08 May 2004 07:18:58 +0900
Subject: [NTG-pdftex] Re: easy font expansion
In-Reply-To: Your message of "Fri, 7 May 2004 22:58:03 +0200"
References: <16539.63579.744028.951124@zarniwoop.ms25.local>
Message-ID: <200405072218.i47MIxi2023172@jupiter.fsci.fuk.kindai.ac.jp>

Dear Reinhard,

>     > If I use hz for base 14 fonts, pdf[ex]TeX crashes.  But, if base
>     > 14 fonts are embedded by changing pdftex.map like ptmr8r
>     > Times-Roman "TeXBase1Encoding ReEncodeFont" <8r.enc
>     > --->
>     > ptmr8r "TeXBase1Encoding ReEncodeFont" <8r.enc <utmr8a.pfb hz
>     > can be used for base 14 fonts.
> 
> This is a limitation of PDF, not pdftex.
> 
> In a pdf document you cannot change the FontMatrix as you can do in
> PostScript.  Therefore pdftex has to manipulate the font itself when
> it is inserted.  If you run pdffonts (from xpdf) on your pdf file
> you'll see that the same font is embedded for each expansion step.
> 
> It is certainly mentioned in the pdftex manual.  If not, complain.

Thanks a lot.

It will be better for pdf[ex]TeX to exit with an error message
without causing access violation, when a user calls hz without
embedding relevant fonts.

Best regards
Akira

From The Thanh Han <hanthethanh@myrealbox.com>  Sat May  8 08:08:32 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Sat, 8 May 2004 14:08:32 +0700
Subject: [NTG-pdftex] Re: easy font expansion
In-Reply-To: <200405072218.i47MIxi2023172@jupiter.fsci.fuk.kindai.ac.jp>
References: <16539.63579.744028.951124@zarniwoop.ms25.local> <200405072218.i47MIxi2023172@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <20040508070831.GB1153@monty>

On Sat, May 08, 2004 at 07:18:58AM +0900, Akira Kakuto wrote:
> Dear Reinhard,
> 
> >     > If I use hz for base 14 fonts, pdf[ex]TeX crashes.  But, if base
> >     > 14 fonts are embedded by changing pdftex.map like ptmr8r
> >     > Times-Roman "TeXBase1Encoding ReEncodeFont" <8r.enc
> >     > --->
> >     > ptmr8r "TeXBase1Encoding ReEncodeFont" <8r.enc <utmr8a.pfb hz
> >     > can be used for base 14 fonts.
> > 
> > This is a limitation of PDF, not pdftex.
> > 
> > In a pdf document you cannot change the FontMatrix as you can do in
> > PostScript.  Therefore pdftex has to manipulate the font itself when
> > it is inserted.  If you run pdffonts (from xpdf) on your pdf file
> > you'll see that the same font is embedded for each expansion step.
> > 
> > It is certainly mentioned in the pdftex manual.  If not, complain.
> 
> Thanks a lot.
> 
> It will be better for pdf[ex]TeX to exit with an error message
> without causing access violation, when a user calls hz without
> embedding relevant fonts.

yes you are right, pdftex should not segfault but exit with an error
message. I will look at it.

Regards,
Thanh

From pragma@wxs.nl  Sat May  8 10:50:19 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Sat, 08 May 2004 11:50:19 +0200
Subject: [NTG-pdftex] endstream
Message-ID: <6.0.1.1.2.20040508114927.01e33ec0@localhost>

Hi,

When embedding a file using \pdfobj file {...} i get

whateverendstream

is this valid? shouldn't endstream be on its own line?

Hans


-------------------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE/POD/CTS
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From hartmut_henkel@gmx.de  Sat May  8 12:20:55 2004
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Sat, 8 May 2004 13:20:55 +0200 (CEST)
Subject: [NTG-pdftex] endstream
In-Reply-To: <6.0.1.1.2.20040508114927.01e33ec0@localhost>
References: <6.0.1.1.2.20040508114927.01e33ec0@localhost>
Message-ID: <Pine.LNX.4.58.0405081317300.3319@hahepc1.hahe>

On Sat, 8 May 2004, Hans Hagen wrote:

> When embedding a file using \pdfobj file {...} i get
>
> whateverendstream
>
> is this valid? shouldn't endstream be on its own line?

valid, as the Length tells exactly where the data end

"It is also an error if the stream contains too _much_ data, with the
exception that there may be an extra end-of-line marker in the PDF file
before the keyword 'endstream'." PDF ref. 1.4 p. 37

But somehow having endstream on its own line would be nicer.

Regard, Hartmut

From The Thanh Han <hanthethanh@myrealbox.com>  Sun May  9 03:19:19 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Sun, 9 May 2004 09:19:19 +0700
Subject: [NTG-pdftex] endstream
In-Reply-To: <Pine.LNX.4.58.0405081317300.3319@hahepc1.hahe>
References: <6.0.1.1.2.20040508114927.01e33ec0@localhost> <Pine.LNX.4.58.0405081317300.3319@hahepc1.hahe>
Message-ID: <20040509021919.GB463@monty>

On Sat, May 08, 2004 at 01:20:55PM +0200, Hartmut Henkel wrote:
> On Sat, 8 May 2004, Hans Hagen wrote:
> 
> > When embedding a file using \pdfobj file {...} i get
> >
> > whateverendstream
> >
> > is this valid? shouldn't endstream be on its own line?
> 
> valid, as the Length tells exactly where the data end
> 
> "It is also an error if the stream contains too _much_ data, with the
> exception that there may be an extra end-of-line marker in the PDF file
> before the keyword 'endstream'." PDF ref. 1.4 p. 37
> 
> But somehow having endstream on its own line would be nicer.

ok, will do so.

Thanh

From kakuto@fsci.fuk.kindai.ac.jp  Sun May  9 15:43:49 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 09 May 2004 23:43:49 +0900
Subject: [NTG-pdftex] easy font expansion (image inclusion)
In-Reply-To: Your message of "Sun, 09 May 2004 12:00:10 +0200"
References: <20040509100010.16197.63150.Mailman@ref.ntg.nl>
Message-ID: <200405091443.i49Ehoew005537@jupiter.fsci.fuk.kindai.ac.jp>

Hi Thanh,

I have obtained a very small "pointlike" image by
\includegraphics{foo.jpg}
where foo.jpg is a usual size image.
Therefore I have revived previous values for arguments
of "pdf_print_real" as follows:

        pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
    if not is_pdf_image(image) then begin
        pdf_print_real(ext_xn_over_d(pdf_width(p), 
                       ten_pow[6], one_hundred_bp), 6);
        pdf_print(" 0 0 ");
        pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p), 
                       ten_pow[6], one_hundred_bp), 6);

------->

        pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
    if not is_pdf_image(image) then begin
        pdf_print_real(ext_xn_over_d(pdf_width(p), 
                       ten_pow[4], one_bp), 4);
        pdf_print(" 0 0 ");
        pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p), 
                       ten_pow[4], one_bp), 4);

Best regards
Akira

From hartmut_henkel@gmx.de  Sun May  9 16:28:51 2004
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Sun, 9 May 2004 17:28:51 +0200 (CEST)
Subject: [NTG-pdftex] easy font expansion (image inclusion)
In-Reply-To: <200405091443.i49Ehoew005537@jupiter.fsci.fuk.kindai.ac.jp>
References: <20040509100010.16197.63150.Mailman@ref.ntg.nl>
 <200405091443.i49Ehoew005537@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <Pine.LNX.4.58.0405091713150.2012@hahepc1.hahe>

On Sun, 9 May 2004, Akira Kakuto wrote:

> I have obtained a very small "pointlike" image by
> \includegraphics{foo.jpg}
> where foo.jpg is a usual size image.
> Therefore I have revived previous values for arguments
> of "pdf_print_real" as follows:
>
>         pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
>     if not is_pdf_image(image) then begin
>         pdf_print_real(ext_xn_over_d(pdf_width(p),
>                        ten_pow[6], one_hundred_bp), 6);
>         pdf_print(" 0 0 ");
>         pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p),
>                        ten_pow[6], one_hundred_bp), 6);
>
> ------->
>
>         pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
>     if not is_pdf_image(image) then begin
>         pdf_print_real(ext_xn_over_d(pdf_width(p),
>                        ten_pow[4], one_bp), 4);
>         pdf_print(" 0 0 ");
>         pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p),
>                        ten_pow[4], one_bp), 4);

Using "ten_pow[6], one_hundred_bp" was based on the point, that the
constant one_hundred_bp is an exact value, whereas one_bp =
one_hundred_bp / 100 is a rounded one.

The division "ten_pow[4] / one_bp" should give the same result as
"ten_pow[6] / one_hundred_bp", but the latter one without rounding
error. The ext_xn_over_d() function, using double, would not overflow.

Therefore the effective difference by your change seems to be only the
", 4" instead of ", 6". So your result should be also ok when using

"ten_pow[6], one_hundred_bp), 4);"?

Mysterious. Do you have the image for download from somewhere?

Regards, Hartmut

From hartmut_henkel@gmx.de  Sun May  9 16:46:42 2004
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Sun, 9 May 2004 17:46:42 +0200 (CEST)
Subject: [NTG-pdftex] easy font expansion (image inclusion)
In-Reply-To: <200405091443.i49Ehoew005537@jupiter.fsci.fuk.kindai.ac.jp>
References: <20040509100010.16197.63150.Mailman@ref.ntg.nl>
 <200405091443.i49Ehoew005537@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <Pine.LNX.4.58.0405091742290.2520@hahepc1.hahe>

On Sun, 9 May 2004, Akira Kakuto wrote:

>         pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
>     if not is_pdf_image(image) then begin
>         pdf_print_real(ext_xn_over_d(pdf_width(p),
>                        ten_pow[4], one_bp), 4);
>         pdf_print(" 0 0 ");
>         pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p),
>                        ten_pow[4], one_bp), 4);

Ah, it was ", 4" formerly, just the new ", 6" is wrong. Then this should
do it right:

         pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
     if not is_pdf_image(image) then begin
         pdf_print_real(ext_xn_over_d(pdf_width(p),
                        ten_pow[6], one_hundred_bp), 4);
         pdf_print(" 0 0 ");
         pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p),
                        ten_pow[6], one_hundred_bp), 4);

Regards, Hartmut

From kakuto@fsci.fuk.kindai.ac.jp  Sun May  9 16:55:43 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Mon, 10 May 2004 00:55:43 +0900
Subject: [NTG-pdftex] easy font expansion (image inclusion)
In-Reply-To: Your message of "Sun, 9 May 2004 17:46:42 +0200 (CEST)"
References: <Pine.LNX.4.58.0405091742290.2520@hahepc1.hahe>
Message-ID: <200405091555.i49FtiKj005846@jupiter.fsci.fuk.kindai.ac.jp>

Hi Hartmut,

> Ah, it was ", 4" formerly, just the new ", 6" is wrong. Then this should
> do it right:
> 
>          pdf_append_list(pdf_ximage_objnum(p))(pdf_ximage_list);
>      if not is_pdf_image(image) then begin
>          pdf_print_real(ext_xn_over_d(pdf_width(p),
>                         ten_pow[6], one_hundred_bp), 4);
>          pdf_print(" 0 0 ");
>          pdf_print_real(ext_xn_over_d(pdf_height(p) + pdf_depth(p),
>                         ten_pow[6], one_hundred_bp), 4);
> 

Thank you very much. It was ok by 6 ---> 4 only.

Best regards
Akira

From hartmut_henkel@gmx.de  Sun May  9 17:15:01 2004
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Sun, 9 May 2004 18:15:01 +0200 (CEST)
Subject: [NTG-pdftex] easy font expansion (image inclusion)
In-Reply-To: <200405091555.i49FtiKj005846@jupiter.fsci.fuk.kindai.ac.jp>
References: <Pine.LNX.4.58.0405091742290.2520@hahepc1.hahe>
 <200405091555.i49FtiKj005846@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <Pine.LNX.4.58.0405091806590.3284@hahepc1.hahe>

Hi Akira,

On Mon, 10 May 2004, Akira Kakuto wrote:

> Thank you very much. It was ok by 6 ---> 4 only.

many thanks to you! You found this bug :-)

Regards, Hartmut

From staw@gust.org.pl  Tue May 11 02:36:31 2004
From: staw@gust.org.pl (Staszek Wawrykiewicz)
Date: Tue, 11 May 2004 03:36:31 +0200 (CEST)
Subject: [NTG-pdftex] pdf(e)tex compatible with tex?
Message-ID: <Pine.LNX.4.44.0405110215090.3113-101000@re86.internetdsl.tpnet.pl>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463811772-1074887030-1084239391=:3113
Content-Type: TEXT/PLAIN; charset=US-ASCII

I'm so sorry, but I found some incompatibilities in pdfetex in dvi mode.
My silly test, attached in il1test.zip, or in case that the mailer could
remove it, available from 
ftp:/ftp.gust.org.pl/TeX/GUST/test/il1test.zip
can show you that some primitives give strange output, e.g. not expected
headlines and footers using pdfetex based latex format. This example can
be compared with 'latex' or 'pdflatex' from TeX Live 2003 against the
*current* stuff from P4 depot (pdf(e)tex 1.20b-2.1).

Ps. Martin, your 'Bye' was rejected, so I'd still like to hear your 
opinions.
 
Best,

-- 
Staszek Wawrykiewicz
StaW@gust.org.pl


---1463811772-1074887030-1084239391=:3113
Content-Type: APPLICATION/zip; name="il1test.zip"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.44.0405110336310.3113@re86.internetdsl.tpnet.pl>
Content-Description: 
Content-Disposition: attachment; filename="il1test.zip"

UEsDBBQAAAAIAAgPqzAt3axCXAQAAGEKAAALABUAaXNvMS10MS50ZXhVVAkA
A58WoEACFqBAVXgEAPQB9AG1ltluGzcUhu/PU7AB1DRAZVheZNnBoDUcA2nR
xgWsoC3KGqZmzkgTj0hhhopqCOrr9DWy7/uG7Pu+78ieHo5kRWRy04v6wtJ8
PPz/n2eoGea+Zvm8ToRMY6ExH0YxelFcyOsC5HJsXotfv682Uz2kkupQIzYM
eKD8Zh2l9mORpm2R6MiPsQO8mWJD+Euiin+UC3+2QyU1Sr/DcqyFjAZZucAI
qAADZgZTFkdLyGZnmErYTz8PCrTjOpUlsmMcdQ2pUiKrYKxaLEqZpA9VSVWM
Gr9lNdXCzZgwX0gqMU4Bi0K2rJosUFSrWUtInSmpLIcRLM/8xlRDR0quzSaa
ap0sf8fW5tdAbnAt1JhI0noi2WhmCwLgFaxGsr3SCFp7ir7Rapcx1UyFLIgS
IiybQ/8ptGJdIfYNfS+VxifzhTUktcXji9OM/nKMcb8mklX+MIOtHl/t0AJs
8/iCA0dgu8f/duAo7PD4KgeOwU6PT0+3O4NwHHYRnLVhEXZ73Gcz1vQJ2ENB
Z23NEuylnA6chH2U04EC9lMkB1bgAGn+YEMfDpKmAwM4RJoORDhMmg4M4YjH
1623VhQMw1Hq0garMijAMXKfs+EIHCd3B47CCXJ34BicJE0HjsMpiuTAIpz2
+JxJNABLcIbcN9qVk3CW3B0o4By5O7AC58nIgT5coOm/2zCAix4vOw1BgEse
px+vRUP4x+PzdlAxAXCZkgpLFYfhClk5sABXKakDR+Aa9cmBo3Cd4jtwDG54
XAgrE47DTYJowyLcMjvUt6ZPwG3KibZmCe5QTgdOwt3Pcwq4R5GcygrcJ00e
tTsD0IcHpOnAAB6SpgMRHpGmA0N47PGgZq0oHIYn1CVpuYcFeEruyoYj8Izc
HTgKz8ndgWPwgjQdOA4vKZIDi/DK48q+8WEJXpN7066chDfk7kABb8ndgRV4
R0YO9OE9TV+2YQAfPK6dhiB8pOlOZQifHrTzqo66Fskqq6sE6RGrMaFnLwHz
fA4w5PSu8EXavnzl6rXrN27eun3n7r37Dx4+evzk6bPnL16+ev3m7bv3Hz5e
6nSrN/4yMz3f3rJ12/YdO3ft3rN33/4DBw8dPnL02PETJ0+dPnP23PkLF42y
xFYriTTy8twM46qBUjW1ueCbVEWKOg5p7XfrzDvLBF/kCws/EmrFqtp/QfBU
JxQ2g1Od3mAvc/8yC2VcM8tCsT/bXJu10wtNMFp5PZIiZtMb1nUJTc5e5Zlw
b+qA9gqx5c0i+gaLGVrdF8gGrQtH7wsFfXk0Da5h3NCk/lkHMEnM2BQ16ZMm
/tUQMhAhrW2lYJC1+3KmNknqmKbm2PAF7d7QFOuL/5dAvTX8L3lW+rNSpJcb
mKI2N3aKQnbj0pesjj79WKXY223AN9MN5riJfg7mPBJV06WoQdtORTKgI0lf
NEERmJ1CSW0D3s9Ip6Fss7DBLczSmmrGgTlQmVtKB5+uRI2+GM2vTB+z442z
8VEGAwcj+BdQSwECFwMUAAAACAAID6swLd2sQlwEAABhCgAACwANAAAAAAAB
AAAAtIEAAAAAaXNvMS10MS50ZXhVVAUAA58WoEBVeAAAUEsFBgAAAAABAAEA
RgAAAJoEAAAAAA==
---1463811772-1074887030-1084239391=:3113--

From The Thanh Han <hanthethanh@myrealbox.com>  Tue May 11 03:05:14 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Tue, 11 May 2004 09:05:14 +0700
Subject: [NTG-pdftex] Re: [pdftex] Who does the releases?
Message-ID: <20040511020514.GB611@monty>

Hi Martin,

> Thanh,
> I was surprised by the release today (learned of it through
> tetex-pretest). I suggest renaming it to 1.20a-rc3 and splitting
> off pdfxtex ASAP.

I was told that you were not very happy with the latest upload, because
it overwrote the stable sources in texlive/tetex. I am sorry to hear
about that. However, I would like to clarify a few points:

1) I think that the pdftex sources are in the development branch, and they
   are moved to the stable branch only when Sebastian approves it.

2) I am not aware that I should not do a release. We have agreed that
   you will be doing/monitoring/scheduling releases. Does it mean that I 
   should not make any release at all. Then can you please tell me how I
   should name my changes?

3) It's not clear to me why pdfxtex should be gone ASAP. If it should
   not be built by default, isn't it better to change the config files not to
   compile it unless an option `--with-pdfxtex' is explicitly given?

4) At the meantime, I will rename the latest sources to 1.20a-rc3 as you
   suggested. My next changes will be uploaded to pdftex.sarovar.org
   and wait there until we agree that they can be released.

5) If something goes wrong, can you please let me know directly.

Best regards,
Thanh

From kakuto@fsci.fuk.kindai.ac.jp  Tue May 11 03:17:46 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Tue, 11 May 2004 11:17:46 +0900
Subject: [NTG-pdftex] pdf(e)tex compatible with tex?
Message-ID: <200405110217.i4B2HkFv021018@jupiter.fsci.fuk.kindai.ac.jp>

>I'm so sorry, but I found some incompatibilities in pdfetex in dvi mode.
>My silly test, attached in il1test.zip, or in case that the mailer could
>remove it, available from 
>ftp:/ftp.gust.org.pl/TeX/GUST/test/il1test.zip
>can show you that some primitives give strange output, e.g. not expected
>headlines and footers using pdfetex based latex format.

I have also obtained headlines and footers in the case of
pdfelatex and pdfxlatex (1.20b-2.1).
However, pdflatex (1.20b) (i.e., non e-TeX version) seems to
output the same dvi as latex or elatex.

Best regards, Akira

From kakuto@fsci.fuk.kindai.ac.jp  Tue May 11 03:48:03 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Tue, 11 May 2004 11:48:03 +0900
Subject: [NTG-pdftex] Re: [pdftex] Who does the releases?
Message-ID: <200405110248.i4B2m36j021177@jupiter.fsci.fuk.kindai.ac.jp>

Hi Thanh,

>At the meantime, I will rename the latest sources
>to 1.20a-rc3 as you suggested.

Please do not go backward. You have enough numbers to
use, 1.20c, 1.20d, ...
As a stable release version number, you can choose 1.21.

Best regards,
Akira

From The Thanh Han <hanthethanh@myrealbox.com>  Tue May 11 11:09:42 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Tue, 11 May 2004 17:09:42 +0700
Subject: [NTG-pdftex] pdftex-1.20a-rc3
Message-ID: <20040511100942.GB12719@monty>

Hi,

I changed the version back to 1.20a-rc3 as Martin suggested. Also a
src tarball and djgpp binaries are avail. at
http://vntex.sourceforge.net/private/thanh/pdftex/

This version fixes the problem Staszek reported with pdfelatex.

Thanh

From ms@artcom-gmbh.de  Tue May 11 16:05:46 2004
From: ms@artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue, 11 May 2004 17:05:46 +0200
Subject: [NTG-pdftex] [bug] crash at lookup_fontmap
Message-ID: <20040511150546.GW24367@artcom8.artcom-gmbh.de>

With rc3:

Program received signal SIGSEGV, Segmentation fault.
0x80a64c5 in lookup_fontmap (bname=0x830c180 "LUTYFL+CMBX12") at ../../../../src/texk/web2c/pdftexdir/mapfile.c:755
755             if (pdffontmap[i] == 0)
(gdb) bt
#0  0x80a64c5 in lookup_fontmap (bname=0x830c180 "LUTYFL+CMBX12") at ../../../../src/texk/web2c/pdftexdir/mapfile.c:755
#1  0x80b6723 in copyFont (tag=0x830cee0 "F128", fontRef=0xbfffce20) at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:425
#2  0x80b6cfc in copyFontResources (obj=0xbfffcf04) at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:458
#3  0x80b892d in write_epdf () at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:1004
#4  0x80b54f5 in writeimage (img=0) at ../../../../src/texk/web2c/pdftexdir/writeimg.c:316
#5  0x807c9fc in zpdfwriteimage (n=6) at pdftex1.c:7324
#6  0x809b653 in doextension () at pdftex3.c:792
#7  0x809e355 in maincontrol () at pdftex3.c:2283
#8  0x805a150 in mainbody () at pdftexini.c:4908
#9  0x80a1bbe in main (ac=4, av=0xbfffd094) at pdftexextra.c:325

Will investigate further tomorrow.

Best regards
        Martin
-- 
               Martin Schröder, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de

From hartmut_henkel@gmx.de  Wed May 12 00:50:41 2004
From: hartmut_henkel@gmx.de (Hartmut Henkel)
Date: Wed, 12 May 2004 01:50:41 +0200 (CEST)
Subject: [NTG-pdftex] pdfeTeX 1.20b-2.1: writet3 problem
In-Reply-To: <20040511100942.GB12719@monty>
References: <20040511100942.GB12719@monty>
Message-ID: <Pine.LNX.4.58.0405120135460.6362@hahepc1.hahe>

Hi,

in pdftex as of teTeX 2.96.2 there seems to be a problem with reading pk
fonts, e. g.

\font\aaa xbmc10 at 10pt \aaa hi \bye

(xbmc10.mf see pdfetex.web. BTW, this xbmc10.mf is missing in teTeX)

I get "bad pk file, expected pre" from readchar() of pkin.c, but the
xbmc10.600pk is ok, starting with preamble 247. The problem is somehow,
that the check_preamble is true even after the 1st byte read, so that
later in pk file read suddenly a preamble check is done. This has
somehow to do with t3_glyph_num in writepk() of writet3.c. The kludge,
which seems to work, is to have some

boolean checkpreamble=true;

at the begin of writepk(), and then have the while loop like:

 while (readchar(checkpreamble, &cd) != 0) {
            checkpreamble=false;

so that the header is only checked once at start of file read. But this
might cover some problem with t3_glyph_num...

Regards Hartmut

From The Thanh Han <hanthethanh@myrealbox.com>  Wed May 12 02:04:54 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 12 May 2004 08:04:54 +0700
Subject: [NTG-pdftex] pdfeTeX 1.20b-2.1: writet3 problem
In-Reply-To: <Pine.LNX.4.58.0405120135460.6362@hahepc1.hahe>
References: <20040511100942.GB12719@monty> <Pine.LNX.4.58.0405120135460.6362@hahepc1.hahe>
Message-ID: <20040512010454.GA470@monty>

yes I am aware of this problem. Someone posted a bugfix of bbox
calculation (very long time ago). When I was digging my mail box
containing pdftex bug reports, I found that post and applied without
careful testing. My apology for that.

1.20a-rc3 no longer has this bug.

Regards,
Thanh

On Wed, May 12, 2004 at 01:50:41AM +0200, Hartmut Henkel wrote:
> Hi,
> 
> in pdftex as of teTeX 2.96.2 there seems to be a problem with reading pk
> fonts, e. g.
> 
> \font\aaa xbmc10 at 10pt \aaa hi \bye
> 
> (xbmc10.mf see pdfetex.web. BTW, this xbmc10.mf is missing in teTeX)
> 
> I get "bad pk file, expected pre" from readchar() of pkin.c, but the
> xbmc10.600pk is ok, starting with preamble 247. The problem is somehow,
> that the check_preamble is true even after the 1st byte read, so that
> later in pk file read suddenly a preamble check is done. This has
> somehow to do with t3_glyph_num in writepk() of writet3.c. The kludge,
> which seems to work, is to have some
> 
> boolean checkpreamble=true;
> 
> at the begin of writepk(), and then have the while loop like:
> 
>  while (readchar(checkpreamble, &cd) != 0) {
>             checkpreamble=false;
> 
> so that the header is only checked once at start of file read. But this
> might cover some problem with t3_glyph_num...
> 
> Regards Hartmut
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 

From The Thanh Han <hanthethanh@myrealbox.com>  Wed May 12 02:09:31 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 12 May 2004 08:09:31 +0700
Subject: [NTG-pdftex] [bug] crash at lookup_fontmap
In-Reply-To: <20040511150546.GW24367@artcom8.artcom-gmbh.de>
References: <20040511150546.GW24367@artcom8.artcom-gmbh.de>
Message-ID: <20040512010931.GC470@monty>

Hi Martin,

can you please send me a minimal set of test files to reproduce the bug?

Thanks,
Thanh

On Tue, May 11, 2004 at 05:05:46PM +0200, Martin Schroeder wrote:
> With rc3:
> 
> Program received signal SIGSEGV, Segmentation fault.
> 0x80a64c5 in lookup_fontmap (bname=0x830c180 "LUTYFL+CMBX12") at ../../../../src/texk/web2c/pdftexdir/mapfile.c:755
> 755             if (pdffontmap[i] == 0)
> (gdb) bt
> #0  0x80a64c5 in lookup_fontmap (bname=0x830c180 "LUTYFL+CMBX12") at ../../../../src/texk/web2c/pdftexdir/mapfile.c:755
> #1  0x80b6723 in copyFont (tag=0x830cee0 "F128", fontRef=0xbfffce20) at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:425
> #2  0x80b6cfc in copyFontResources (obj=0xbfffcf04) at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:458
> #3  0x80b892d in write_epdf () at ../../../../src/texk/web2c/pdftexdir/pdftoepdf.cc:1004
> #4  0x80b54f5 in writeimage (img=0) at ../../../../src/texk/web2c/pdftexdir/writeimg.c:316
> #5  0x807c9fc in zpdfwriteimage (n=6) at pdftex1.c:7324
> #6  0x809b653 in doextension () at pdftex3.c:792
> #7  0x809e355 in maincontrol () at pdftex3.c:2283
> #8  0x805a150 in mainbody () at pdftexini.c:4908
> #9  0x80a1bbe in main (ac=4, av=0xbfffd094) at pdftexextra.c:325
> 
> Will investigate further tomorrow.
> 
> Best regards
>         Martin
> -- 
>                Martin SchrÃ¶der, ms@artcom-gmbh.de
>      ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
>           Voice +49 421 20419-44 / Fax +49 421 20419-10
>                     http://www.artcom-gmbh.de
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 

From te@dbs.uni-hannover.de  Wed May 12 07:47:56 2004
From: te@dbs.uni-hannover.de (Thomas Esser)
Date: Wed, 12 May 2004 08:47:56 +0200
Subject: [NTG-pdftex] pdfeTeX 1.20b-2.1: writet3 problem
In-Reply-To: <Pine.LNX.4.58.0405120135460.6362@hahepc1.hahe>
References: <20040511100942.GB12719@monty> <Pine.LNX.4.58.0405120135460.6362@hahepc1.hahe>
Message-ID: <20040512064756.GC18529@dbs.uni-hannover.de>

> \font\aaa xbmc10 at 10pt \aaa hi \bye

Works for me now (using pdfeTeX, Version 3.141592-1.20a-rc3-2.1 as
contained in teTeX-beta-2.96.3).

> (xbmc10.mf see pdfetex.web. BTW, this xbmc10.mf is missing in teTeX)

No. It exists in texmf-dist/fonts/source/public/misc/xbmc10.mf

Thomas

From The Thanh Han <hanthethanh@myrealbox.com>  Wed May 12 10:22:46 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 12 May 2004 16:22:46 +0700
Subject: [NTG-pdftex] lookup_fontmap bahaviour [Was: [bug] crash at lookup_fontmap]
In-Reply-To: <20040511150546.GW24367@artcom8.artcom-gmbh.de>
References: <20040511150546.GW24367@artcom8.artcom-gmbh.de>
Message-ID: <20040512092246.GA2445@monty>

Hi,

I found the bug. Before fixing it, I would like to discuss more about
the behaviour of lookup_fontmap().

For a given base name there may exist several map lines containing that
name. The question is which of them should be returned?

At the moment the first one with matching extent and slant is returned.
I wonder whether we can narrow this criteria to something more strict.
For example, we can choose which tfm should be used regard to the
following checks (in descending priority):

* the tfm has been used (some char from this font has been typeset)
* the tfm has been loaded (but not used yet)
* the tfm can be loaded (but not loaded yet)
* the tfm is present in map files, but cannot be loaded. In this case a
  dummy tfm can be loaded instead, and warning should be written

Please let me know your opinion.

Thanh

From ms@artcom-gmbh.de  Wed May 12 10:44:01 2004
From: ms@artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed, 12 May 2004 11:44:01 +0200
Subject: [NTG-pdftex] lookup_fontmap bahaviour
In-Reply-To: <20040512092246.GA2445@monty>
References: <20040511150546.GW24367@artcom8.artcom-gmbh.de> <20040512092246.GA2445@monty>
Message-ID: <20040512094401.GZ24367@artcom8.artcom-gmbh.de>

On 2004-05-12 16:22:46 +0700, The Thanh Han wrote:
> * the tfm has been used (some char from this font has been typeset)
> * the tfm has been loaded (but not used yet)
> * the tfm can be loaded (but not loaded yet)
> * the tfm is present in map files, but cannot be loaded. In this case a
>   dummy tfm can be loaded instead, and warning should be written

Seems o.k. to me.

Best regards
        Martin
-- 
               Martin Schröder, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de

From pragma@wxs.nl  Wed May 12 10:58:22 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 12 May 2004 11:58:22 +0200
Subject: [NTG-pdftex] lookup_fontmap bahaviour [Was: [bug] crash at
 lookup_fontmap]
In-Reply-To: <20040512092246.GA2445@monty>
References: <20040511150546.GW24367@artcom8.artcom-gmbh.de>
 <20040512092246.GA2445@monty>
Message-ID: <6.0.1.1.2.20040512115600.02a0e388@server-1>

At 11:22 12/05/2004, The Thanh Han wrote:

>At the moment the first one with matching extent and slant is returned.

i'd like the last one to be returned, since later definitions may override 
previous ones; (\pdfmapfile, \pdfmapline provide more control, and there's 
also the +-= prefixing that hartmut implemented; i hope that this will not 
get lost)

>I wonder whether we can narrow this criteria to something more strict.
>For example, we can choose which tfm should be used regard to the
>following checks (in descending priority):
>
>* the tfm has been used (some char from this font has been typeset)
>* the tfm has been loaded (but not used yet)
>* the tfm can be loaded (but not loaded yet)
>* the tfm is present in map files, but cannot be loaded. In this case a
>   dummy tfm can be loaded instead, and warning should be written

what is the purpose of that dummy tfm file?

Hans  


From tkacvins@cox.net  Wed May 12 11:25:10 2004
From: tkacvins@cox.net (Tom Kacvinsky)
Date: Wed, 12 May 2004 06:25:10 -0400
Subject: [NTG-pdftex] lookup_fontmap bahaviour [Was: [bug] crash at  lookup_fontmap]
In-Reply-To: <6.0.1.1.2.20040512115600.02a0e388@server-1>
Message-ID: <r02010100-1033-A6456BC8A3FE11D89FB70003935A7DA6@[10.0.1.2]>

>
>what is the purpose of that dummy tfm file?
>

My best guess would be that it is a place holder for the TFM "key"
in those mapfile entires for fonts which are used in included PDF files.

Tom

From kakuto@fsci.fuk.kindai.ac.jp  Wed May 12 11:40:32 2004
From: kakuto@fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Wed, 12 May 2004 19:40:32 +0900
Subject: [NTG-pdftex] pdfeTeX 1.20b-2.1: writet3 problem
Message-ID: <200405121040.i4CAeXmB001911@jupiter.fsci.fuk.kindai.ac.jp>

>1.20a-rc3 no longer has this bug.

I suspect that writet3.c in texlive p4 head is older than
the one in the tarball.

Best regards,
Akira

From pragma@wxs.nl  Wed May 12 15:05:46 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 12 May 2004 16:05:46 +0200
Subject: [NTG-pdftex] bug in pdfxtex
Message-ID: <6.0.1.1.2.20040512160522.029b2878@server-1>

 >pdfetex
This is pdfxTeX, Version 3.141592-1.20a-rc3-2.1 (Web2C 7.5.3)
  \write18 enabled.
**x
kpathsea: Running mktexfmt pdfetex.fmt
Exiting due to signal SIGSEGV
General Protection Fault at eip=00113d54
eax=746d6678 ebx=000fff34 ecx=009a0441 edx=000fff38 esi=00000054 edi=001ee210
ebp=0026e158 esp=0026e14c program=E:\TEX\TE2CCD~1\BIN\PDFETEX.EXE
cs: sel=01a7  base=02aa0000  limit=00b4ffff
ds: sel=01af  base=02aa0000  limit=00b4ffff
es: sel=01af  base=02aa0000  limit=00b4ffff
fs: sel=017f  base=0000ecf0  limit=0000ffff
gs: sel=01bf  base=00000000  limit=0010ffff
ss: sel=01af  base=02aa0000  limit=00b4ffff
App stack: [0026e210..001ee210]  Exceptn stack: [001ee164..001ec224]

Call frame traceback EIPs:
   0x00113d54
   0x000fd9c0
   0x00060bf0
   0x00011d95
   0x0006444d
   0x001135a8


-------------------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE/POD/CTS
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From te@dbs.uni-hannover.de  Wed May 12 18:10:22 2004
From: te@dbs.uni-hannover.de (Thomas Esser)
Date: Wed, 12 May 2004 19:10:22 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <6.0.1.1.2.20040512160522.029b2878@server-1>
References: <6.0.1.1.2.20040512160522.029b2878@server-1>
Message-ID: <20040512171022.GD25772@dbs.uni-hannover.de>

> Exiting due to signal SIGSEGV

Works for me:

    $ rm /software/oss/Text/teTeX-3.0/share/texmf/web2c/pdfetex.fmt
    $ pdfetex
    This is pdfeTeX, Version 3.141592-1.20a-rc3-2.1 (Web2C 7.5.3)
    **x
    kpathsea: Running mktexfmt pdfetex.fmt
    running `pdfetex -ini   -jobname=pdfetex -progname=pdfetex -8bit *pdfetex.ini' ...
    This is pdfeTeX, Version 3.141592-1.20a-rc3-2.1 (Web2C 7.5.3) (INITEX)
    output format initialized to DVI
    entering extended mode
    (/software/oss/Text/teTeX-3.0/share/texmf-dist/tex/plain/config/pdfetex.ini
    ...
    Transcript written on pdfetex.log.
    fmtutil: /software/oss/Text/teTeX-3.0/share/texmf/web2c/pdfetex.fmt installed.
    output format initialized to PDF
    entering extended mode
    (/software/oss/Text/teTeX-3.0/share/texmf-dist/tex/latex/tools/x.tex

Thomas

From ms@artcom-gmbh.de  Wed May 12 20:15:22 2004
From: ms@artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed, 12 May 2004 21:15:22 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <20040512171022.GD25772@dbs.uni-hannover.de>
References: <6.0.1.1.2.20040512160522.029b2878@server-1> <20040512171022.GD25772@dbs.uni-hannover.de>
Message-ID: <20040512191522.GC3070@lucien.kn-bremen.de>

On 2004-05-12 19:10:22 +0200, Thomas Esser wrote:
> > Exiting due to signal SIGSEGV
> 
> Works for me:
> 
>     $ rm /software/oss/Text/teTeX-3.0/share/texmf/web2c/pdfetex.fmt
>     $ pdfetex
>     This is pdfeTeX, Version 3.141592-1.20a-rc3-2.1 (Web2C 7.5.3)

But Hans is running pdf_x_tex :-)

Best regards
    Martin
-- 
               Martin Schröder, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de

From te@dbs.uni-hannover.de  Wed May 12 22:10:51 2004
From: te@dbs.uni-hannover.de (Thomas Esser)
Date: Wed, 12 May 2004 23:10:51 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <20040512191522.GC3070@lucien.kn-bremen.de>
References: <6.0.1.1.2.20040512160522.029b2878@server-1> <20040512171022.GD25772@dbs.uni-hannover.de> <20040512191522.GC3070@lucien.kn-bremen.de>
Message-ID: <20040512211051.GE1420@dbs.uni-hannover.de>

On Wed, May 12, 2004 at 09:15:22PM +0200, Martin Schröder wrote:
> But Hans is running pdf_x_tex :-)

Still works for me on UNIX if I set up the pdfetex "format" to use the
pdfxtex engine.

User calls pdfetex (which is a symlink to pdfxtex in that case) which
calls "mktexfmt pdfetex" which calls pdfxtex (because this is the setup
in fmtutil.cnf in that case) and it all works..

Actually, shortly after sending my mail, I have noticed that pdf_x_tex
and checked what I have just described.

Thomas

From fabrice.popineau@supelec.fr  Wed May 12 22:33:07 2004
From: fabrice.popineau@supelec.fr (Fabrice Popineau)
Date: Wed, 12 May 2004 23:33:07 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <20040512211051.GE1420@dbs.uni-hannover.de>
Message-ID: <20040512213308.25CCCA1BCC@postfix4-2.free.fr>

> Still works for me on UNIX if I set up the pdfetex "format" to use the
> pdfxtex engine.

Works ok for me too with pdfxtex.

Fabrice


From The Thanh Han <hanthethanh@myrealbox.com>  Wed May 12 13:37:02 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 12 May 2004 19:37:02 +0700
Subject: [NTG-pdftex] lookup_fontmap bahaviour [Was: [bug] crash at lookup_fontmap]
In-Reply-To: <6.0.1.1.2.20040512115600.02a0e388@server-1>
References: <20040511150546.GW24367@artcom8.artcom-gmbh.de> <20040512092246.GA2445@monty> <6.0.1.1.2.20040512115600.02a0e388@server-1>
Message-ID: <20040512123701.GB319@monty>

> >I wonder whether we can narrow this criteria to something more strict.
> >For example, we can choose which tfm should be used regard to the
> >following checks (in descending priority):
> >
> >* the tfm has been used (some char from this font has been typeset)
> >* the tfm has been loaded (but not used yet)
> >* the tfm can be loaded (but not loaded yet)
> >* the tfm is present in map files, but cannot be loaded. In this case a
> >  dummy tfm can be loaded instead, and warning should be written
> 
> what is the purpose of that dummy tfm file?

this is for handling font files in embedded pdf files.

Thanh

From ms@artcom-gmbh.de  Thu May 13 00:39:33 2004
From: ms@artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu, 13 May 2004 01:39:33 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <20040512213308.25CCCA1BCC@postfix4-2.free.fr>
References: <20040512211051.GE1420@dbs.uni-hannover.de> <20040512213308.25CCCA1BCC@postfix4-2.free.fr>
Message-ID: <20040512233932.GC18569@lucien.kn-bremen.de>

On 2004-05-12 23:33:07 +0200, Fabrice Popineau wrote:
> Works ok for me too with pdfxtex.

I suspect only Hans is using the djgpp binaries from Thanh?

Best regards
    Martin
-- 
               Martin Schröder, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de

From pragma@wxs.nl  Thu May 13 08:27:26 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Thu, 13 May 2004 09:27:26 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <20040512213308.25CCCA1BCC@postfix4-2.free.fr>
References: <20040512211051.GE1420@dbs.uni-hannover.de>
 <20040512213308.25CCCA1BCC@postfix4-2.free.fr>
Message-ID: <6.0.1.1.2.20040513092604.028fcec0@server-1>

At 23:33 12/05/2004, Fabrice Popineau wrote:
> > Still works for me on UNIX if I set up the pdfetex "format" to use the
> > pdfxtex engine.
>
>Works ok for me too with pdfxtex.

i used thanh's djgpp binaries so it must be in the cross compiling or some 
conflict between djgpp-fptex binaries;

btw, does this mean that you have new pdftex binaries for windows (that is, 
the visual c ones)?

Hans


From Fabrice.Popineau@supelec.fr  Thu May 13 09:51:21 2004
From: Fabrice.Popineau@supelec.fr (Fabrice Popineau)
Date: Thu, 13 May 2004 10:51:21 +0200
Subject: [NTG-pdftex] bug in pdfxtex
In-Reply-To: <6.0.1.1.2.20040513092604.028fcec0@server-1>
Message-ID: <200405130851.i4D8pGI17255@esemetz.metz.supelec.fr>

Ahemm yes :-)

I'll try to upload static ones later today. I need to sort out=20
TeXlive packaging right now.

Fabrice

> -----Message d'origine-----
> De=A0: Hans Hagen [mailto:pragma@wxs.nl]
> Envoy=E9=A0: jeudi 13 mai 2004 09:27
> =C0=A0: Fabrice Popineau
> Cc=A0: ntg-pdftex@ref.vet.uu.nl
> Objet=A0: RE: [NTG-pdftex] bug in pdfxtex
>=20
> At 23:33 12/05/2004, Fabrice Popineau wrote:
> > > Still works for me on UNIX if I set up the pdfetex "format" to use =
the
> > > pdfxtex engine.
> >
> >Works ok for me too with pdfxtex.
>=20
> i used thanh's djgpp binaries so it must be in the cross compiling or =
some
> conflict between djgpp-fptex binaries;
>=20
> btw, does this mean that you have new pdftex binaries for windows =
(that
> is,
> the visual c ones)?
>=20
> Hans


From pragma@wxs.nl  Thu May 13 22:26:13 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Thu, 13 May 2004 23:26:13 +0200
Subject: [NTG-pdftex] still probelms with inclusion
Message-ID: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>

Hi,

The 'old version' of pdftex had problems with including pdf files that uses 
fonts not present on the system (well, my system):

   Font \csname\endcsname=uplr8y not loadable: Metric (TFM) file not found.

the new (djgpp) version still has:

   : invalid font dict type <null>

the last couple of days i switched to map files with FontNames again, but i 
regret that move already.

I'm puzzled because i thought that Hartmuts code took care of that.

I need to make a decision: either ship with or without FontName entries in 
map files; (i never had problems without them, but since it was mentioned 
that inclusion was more efficient with them...)

Is it possible to provide

   \pdfoptionignorefontnames=1

that 'ignores' the font name entries in map files?


Hans



-------------------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE/POD/CTS
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From te@dbs.uni-hannover.de  Thu May 13 22:59:43 2004
From: te@dbs.uni-hannover.de (Thomas Esser)
Date: Thu, 13 May 2004 23:59:43 +0200
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
Message-ID: <20040513215943.GA6604@dbs.uni-hannover.de>

> The 'old version' of pdftex had problems with including pdf files that uses 
> fonts not present on the system (well, my system):
> 
>   Font \csname\endcsname=uplr8y not loadable: Metric (TFM) file not found.

What's the point in including a font in a mapfile, if you don't have it?
I mean, if I put \garbage into a TeX file, I also get an error message.

Thomas

From The Thanh Han <hanthethanh@myrealbox.com>  Fri May 14 04:21:20 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Fri, 14 May 2004 10:21:20 +0700
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
Message-ID: <20040514032120.GB5460@monty>

Hi,

that's the problem we have been discussing about which fm entry to
return for a given base name + slant + extent.

I had some discussion with Hartmut, and it should be feasible to
implement what I suggested in my previous mail:

> For example, we can choose which tfm should be used regard to the
> following checks (in descending priority):
> 
> * the tfm has been used (some char from this font has been typeset)
> * the tfm has been loaded (but not used yet)
> * the tfm can be loaded (but not loaded yet)
> * the tfm is present in map files, but cannot be loaded. In this case a
>   dummy tfm can be loaded instead, and warning should be written

if this is implemented, in your example pdftex would check for all fm entry
with the base name 'Palatino-Roman' and select the 'right' one instead
of the first one (uplr8y) as it is doing at the moment.

Thanh


On Thu, May 13, 2004 at 11:26:13PM +0200, Hans Hagen wrote:
> Hi,
> 
> The 'old version' of pdftex had problems with including pdf files that uses 
> fonts not present on the system (well, my system):
> 
>   Font \csname\endcsname=uplr8y not loadable: Metric (TFM) file not found.
> 
> the new (djgpp) version still has:
> 
>   : invalid font dict type <null>
> 
> the last couple of days i switched to map files with FontNames again, but i 
> regret that move already.
> 
> I'm puzzled because i thought that Hartmuts code took care of that.
> 
> I need to make a decision: either ship with or without FontName entries in 
> map files; (i never had problems without them, but since it was mentioned 
> that inclusion was more efficient with them...)
> 
> Is it possible to provide
> 
>   \pdfoptionignorefontnames=1
> 
> that 'ignores' the font name entries in map files?
> 
> 
> Hans
> 
> 
> 
> -------------------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE/POD/CTS
>                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
> -------------------------------------------------------------------------
>                        information: http://www.pragma-ade.com/roadmap.pdf
>                     documentation: http://www.pragma-ade.com/showcase.pdf
> -------------------------------------------------------------------------
> 
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 

From pragma@wxs.nl  Fri May 14 07:50:21 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Fri, 14 May 2004 08:50:21 +0200
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <20040514032120.GB5460@monty>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
 <20040514032120.GB5460@monty>
Message-ID: <6.0.1.1.2.20040514084819.02a12dc8@server-1>

At 05:21 14/05/2004, you wrote:
>Hi,
>
>that's the problem we have been discussing about which fm entry to
>return for a given base name + slant + extent.
>
>I had some discussion with Hartmut, and it should be feasible to
>implement what I suggested in my previous mail:
>
> > For example, we can choose which tfm should be used regard to the
> > following checks (in descending priority):
> >
> > * the tfm has been used (some char from this font has been typeset)
> > * the tfm has been loaded (but not used yet)
> > * the tfm can be loaded (but not loaded yet)
> > * the tfm is present in map files, but cannot be loaded. In this case a
> >   dummy tfm can be loaded instead, and warning should be written
>
>if this is implemented, in your example pdftex would check for all fm entry
>with the base name 'Palatino-Roman' and select the 'right' one instead
>of the first one (uplr8y) as it is doing at the moment.

What happens if that file is not really the same? (virtual vs original, 
special subset with name unchanged, updated metrics);

is it possible to store a checksum (i assume private keys are possible in 
the font dict) and ignore matches with different checksums?

Hans  


From pragma@wxs.nl  Fri May 14 07:58:11 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Fri, 14 May 2004 08:58:11 +0200
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <20040513215943.GA6604@dbs.uni-hannover.de>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
 <20040513215943.GA6604@dbs.uni-hannover.de>
Message-ID: <6.0.1.1.2.20040514085341.029f6f50@server-1>

At 23:59 13/05/2004, Thomas Esser wrote:
> > The 'old version' of pdftex had problems with including pdf files that 
> uses
> > fonts not present on the system (well, my system):
> >
> >   Font \csname\endcsname=uplr8y not loadable: Metric (TFM) file not found.
>
>What's the point in including a font in a mapfile, if you don't have it?
>I mean, if I put \garbage into a TeX file, I also get an error message.

i put it there because some users asked for it;

also, it's not uncommon in tex distibutions to have tfm/vf files without 
accompanying (non free) pfb or ttf files

so, pdftex should ignore entries where a tfm/vf/pfb/ttf/enc file is missing 
when handling an inclusion

(even worse, when one replaces a virtual font with a non virtual one and 
the doc to be included still has a virtual one, i would not be surprised of 
problems showing up as well)

these things happen and i test such things because of user reports -)

Hans


From The Thanh Han <hanthethanh@myrealbox.com>  Fri May 14 08:27:02 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Fri, 14 May 2004 14:27:02 +0700
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <6.0.1.1.2.20040514084819.02a12dc8@server-1>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost> <20040514032120.GB5460@monty> <6.0.1.1.2.20040514084819.02a12dc8@server-1>
Message-ID: <20040514072702.GA20300@monty>

On Fri, May 14, 2004 at 08:50:21AM +0200, Hans Hagen wrote:
> At 05:21 14/05/2004, you wrote:
> >Hi,
> >
> >that's the problem we have been discussing about which fm entry to
> >return for a given base name + slant + extent.
> >
> >I had some discussion with Hartmut, and it should be feasible to
> >implement what I suggested in my previous mail:
> >
> >> For example, we can choose which tfm should be used regard to the
> >> following checks (in descending priority):
> >>
> >> * the tfm has been used (some char from this font has been typeset)
> >> * the tfm has been loaded (but not used yet)
> >> * the tfm can be loaded (but not loaded yet)
> >> * the tfm is present in map files, but cannot be loaded. In this case a
> >>   dummy tfm can be loaded instead, and warning should be written
> >
> >if this is implemented, in your example pdftex would check for all fm entry
> >with the base name 'Palatino-Roman' and select the 'right' one instead
> >of the first one (uplr8y) as it is doing at the moment.
> 
> What happens if that file is not really the same? (virtual vs original, 
> special subset with name unchanged, updated metrics);
> 
> is it possible to store a checksum (i assume private keys are possible in 
> the font dict) and ignore matches with different checksums?

can you clarify it a bit more? I don't understand what you want to do
here. When you talk about eg Palatino-Roman, we suppose you have
somewhere on your disk a fontfile with that FontName entry inside the
font. If you have several entries with the same FontName but different
fontfile, I consider it a fatal error that should be fixed in the map
files.

Thanh

From pragma@wxs.nl  Fri May 14 10:13:24 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Fri, 14 May 2004 11:13:24 +0200
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <20040514072702.GA20300@monty>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost>
 <20040514032120.GB5460@monty>
 <6.0.1.1.2.20040514084819.02a12dc8@server-1>
 <20040514072702.GA20300@monty>
Message-ID: <6.0.1.1.2.20040514110314.02a74a80@server-1>

At 09:27 14/05/2004, The Thanh Han wrote:

>can you clarify it a bit more? I don't understand what you want to do
>here. When you talk about eg Palatino-Roman, we suppose you have
>somewhere on your disk a fontfile with that FontName entry inside the
>font. If you have several entries with the same FontName but different
>fontfile, I consider it a fatal error that should be fixed in the map
>files.

Imagine that you processed a file in 2001 using a certain font setup (could 
be a pdftex file, but also one produced by GS or whatever) and wants to 
include a page from that  file in a document in 2004. How can you be sure 
that in spite of the name, the font is exactly teh same? It could be an 
update, or a subset, or the new one could have more glyphs (euros added for 
instance). I just found out that for obscure reasons the urw paths became 
urw35vf and users who copy trees over old trees may have ended up with 
duplicates (old ones are found then due to alphabetical searching) etc etc. 
it's a mess out there and it's not going to improve soon, so pdftex should 
be as clever as possible. It's better have too many fonts in a file 
(duplicates) then to get the wrong ones. So the question is, what to check 
for and when to ignore. Keep in mind that people get files from everywhere 
(i'm dealing with files from all kind of applications and esp those urw 
files are all over the place and we cannot know how/what people changed; 
btw, this is one reason why i'm glad that fonts are often copyrighted).

If you provide this \pdfoptionsignorefontname or maybe 
\pdfoptionsfontmethod or whatever, at least we have some control, else i 
have to ship a double set of map files (i just wrote a stripper) for the 
sake of robust inclusion. I have to make a decision because i don't want to 
keep messing aroudn with the distribution (tex live deadlines and so).

Hans  


From The Thanh Han <hanthethanh@myrealbox.com>  Mon May 17 04:21:41 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Mon, 17 May 2004 10:21:41 +0700
Subject: [NTG-pdftex] still probelms with inclusion
In-Reply-To: <6.0.1.1.2.20040514110314.02a74a80@server-1>
References: <6.0.1.1.2.20040513232054.01dd0cd0@localhost> <20040514032120.GB5460@monty> <6.0.1.1.2.20040514084819.02a12dc8@server-1> <20040514072702.GA20300@monty> <6.0.1.1.2.20040514110314.02a74a80@server-1>
Message-ID: <20040517032141.GC333@monty>

Hans,

let's make things simple. For `proper inclusion' you don't need a double
set of map files. When a pdf file is being included, all the metrics &
encodings are copied, just font files are passed to pdftex if the font
names are found in map files.

So given a font in a pdf figure, when you include this figure there are
2 options:

1) font name is not found in map files: then it is copied

2) font name is found in map files: it should be handled by pdftex if
possible, otherwise it should be copied. The point is what `possible'
means here. There are two requirements:

a) the font file is avail. to pdftex; this check has been done by
Hartmut

b) the metric is avail. to pdf: this check is being discussed now.

If you need more fine control, we can extend the mechanism so
all fonts in an included pdf are copied if needed (for example by giving
a keyword after \pdfximage), regardless whether their names are found in
map files or not.

Thanh
   

> Imagine that you processed a file in 2001 using a certain font setup (could 
> be a pdftex file, but also one produced by GS or whatever) and wants to 
> include a page from that  file in a document in 2004. How can you be sure 
> that in spite of the name, the font is exactly teh same? It could be an 
> update, or a subset, or the new one could have more glyphs (euros added for 
> instance). I just found out that for obscure reasons the urw paths became 
> urw35vf and users who copy trees over old trees may have ended up with 
> duplicates (old ones are found then due to alphabetical searching) etc etc. 
> it's a mess out there and it's not going to improve soon, so pdftex should 
> be as clever as possible. It's better have too many fonts in a file 
> (duplicates) then to get the wrong ones. So the question is, what to check 
> for and when to ignore. Keep in mind that people get files from everywhere 
> (i'm dealing with files from all kind of applications and esp those urw 
> files are all over the place and we cannot know how/what people changed; 
> btw, this is one reason why i'm glad that fonts are often copyrighted).
> 
> If you provide this \pdfoptionsignorefontname or maybe 
> \pdfoptionsfontmethod or whatever, at least we have some control, else i 
> have to ship a double set of map files (i just wrote a stripper) for the 
> sake of robust inclusion. I have to make a decision because i don't want to 
> keep messing aroudn with the distribution (tex live deadlines and so).
> 
> Hans  
> 
> 

From The Thanh Han <hanthethanh@myrealbox.com>  Wed May 19 11:13:10 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Wed, 19 May 2004 17:13:10 +0700
Subject: [NTG-pdftex] pdftex-1.20-rc4
Message-ID: <20040519101310.GA25842@monty>

Hi,

I uploaded pdftex-1.20a-rc4 to pdftex.sarovar.org/src. This version
fixes the problem with finding fonts in included pdf, as discussed
before. I also did some (heavy) cleaning up in the code handling fonts,
so expect the unexpected.

Thanh

From The Thanh Han <hanthethanh@myrealbox.com>  Mon May 24 10:11:56 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Mon, 24 May 2004 16:11:56 +0700
Subject: [NTG-pdftex] djgpp binaries for pdftex-1.20a-rc4 available
Message-ID: <20040524091156.GB13954@monty>

Hi,

the recent djgpp binaries seem to have problem. After some digging on
the Internet it seems to be a problem with gcc-3.2.2 when using
libstdc++ (C programs run fine). In the beginning I thought it is
related to linux powerpc only (I am running the cross compiler on linux
powerpc -- debian woody), but other people also have the same problem on
other platforms.

After another a few days strugling hard I got to build gcc-2.95.2 and
rebuild pdftex with that new cross compiler. The binaries are available
at http://pdftex.sarovar.org/djgpp

I did a simple test (pdftex story.tex \\bye) on win2k and it seems to be
ok.

Please test it if you can; after about a week I will upload my changes
to texlive p4 if no problems are found.

I would like put some more info at http://pdftex.sarovar.org when I have
more time to work on it. If you would like to help, please let me know.

Thanh

PS: to Hans: I didn't look at your problem with hz yet.

PS2: to Hartmut: I implemented psname_lookup as we discussed. It was not
very complicated, as thanks to avl it's easy to find all entries with
the same psname + slant + extend. Now all the fm entries are also
inserted to ps_tree. I had more work with checking those tfms and
picking up the `right' one.

From pragma@wxs.nl  Wed May 26 08:34:01 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Wed, 26 May 2004 09:34:01 +0200
Subject: [NTG-pdftex] handling fatal errors / corrupt file
Message-ID: <6.0.1.1.2.20040526093157.01e43480@server-1>

Hi,

Sometimes pdftex quits with a fatal error (e.g. when a pdf image is 
invalid); in that case the pdf file is corrutp. I think that in those 
situations either the fils should be correct, but since that is tricky, 
that alternatively the file is simply deleted automatically. Better no file 
than a corrupt one.

Hans


-------------------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE/POD/CTS
                       Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
  tel: +31 (0)38 477 53 69 | fax: +31 (0)38 477 53 74 | www.pragma-ade.com
-------------------------------------------------------------------------
                        information: http://www.pragma-ade.com/roadmap.pdf
                     documentation: http://www.pragma-ade.com/showcase.pdf
-------------------------------------------------------------------------


From tipogral@freemail.hu  Thu May 27 08:48:17 2004
From: tipogral@freemail.hu (Nagy Bence)
Date: Thu, 27 May 2004 09:48:17 +0200
Subject: [NTG-pdftex] pdftex-1.20-rc4
In-Reply-To: <20040519101310.GA25842@monty>
References: <20040519101310.GA25842@monty>
Message-ID: <20040527094817.4ef6405c.tipogral@freemail.hu>

> I uploaded pdftex-1.20a-rc4 to pdftex.sarovar.org/src. This version
> fixes the problem with finding fonts in included pdf, as discussed
> before. I also did some (heavy) cleaning up in the code handling
> fonts, so expect the unexpected.

This version of pdfTeX includes no more the existing expanded pfb files,
if they are not in the pdftex.map like "garamond+10 <garamond+10.pfb".

Greetings,

Bence

From tipogral@freemail.hu  Thu May 27 09:16:37 2004
From: tipogral@freemail.hu (Nagy Bence)
Date: Thu, 27 May 2004 10:16:37 +0200
Subject: [NTG-pdftex] pdftex-1.20-rc4
In-Reply-To: <20040519101310.GA25842@monty>
References: <20040519101310.GA25842@monty>
Message-ID: <20040527101637.325e803d.tipogral@freemail.hu>

> I uploaded pdftex-1.20a-rc4 to pdftex.sarovar.org/src. This version
> fixes the problem with finding fonts in included pdf, as discussed
> before. I also did some (heavy) cleaning up in the code handling
> fonts, so expect the unexpected.

I wrote a small macro to handling the maplines from my tex file, I want
to get the mapline in the form "fontname <fontname.pfb". But it is not
working.

\let\normalfont\font
\def\font#1=#2 {%
  \message{Adding mapline: +#2 <#2.pfb}%
  \pdfmapline{+#2 <#2.pfb}\normalfont#1=#2 }

Greetings,

Bence

From pragma@wxs.nl  Thu May 27 22:10:06 2004
From: pragma@wxs.nl (Hans Hagen)
Date: Thu, 27 May 2004 23:10:06 +0200
Subject: [NTG-pdftex] pdftex-1.20-rc4
In-Reply-To: <20040527101637.325e803d.tipogral@freemail.hu>
References: <20040519101310.GA25842@monty>
 <20040527101637.325e803d.tipogral@freemail.hu>
Message-ID: <6.0.1.1.2.20040527230920.028edec8@localhost>

At 10:16 27/05/2004, Nagy Bence wrote:
> > I uploaded pdftex-1.20a-rc4 to pdftex.sarovar.org/src. This version
> > fixes the problem with finding fonts in included pdf, as discussed
> > before. I also did some (heavy) cleaning up in the code handling
> > fonts, so expect the unexpected.
>
>I wrote a small macro to handling the maplines from my tex file, I want
>to get the mapline in the form "fontname <fontname.pfb". But it is not
>working.
>
>\let\normalfont\font
>\def\font#1=#2 {%
>   \message{Adding mapline: +#2 <#2.pfb}%
>   \pdfmapline{+#2 <#2.pfb}\normalfont#1=#2 }

it seems that the map line parser looks over the } and wants a \relax; a bug?

% interface=en

\starttext

\ifx\normalfont\undefined \let\normalfont\font \fi

\font\xxxx=cmr10 at 100pt

\def\font#1=#2 %
   {\message{Adding mapline: +#2 <#2.pfb}%
    \pdfmapline{+#2 <#2.pfb}\relax
    \normalfont#1=#2 }

\font\test=cmr10 at 100pt

\test oeps

\stoptext


From The Thanh Han <hanthethanh@myrealbox.com>  Sun May 30 00:54:34 2004
From: The Thanh Han <hanthethanh@myrealbox.com> (The Thanh Han)
Date: Sun, 30 May 2004 06:54:34 +0700
Subject: [NTG-pdftex] pdftex-1.20-rc4
In-Reply-To: <6.0.1.1.2.20040527230920.028edec8@localhost>
References: <20040519101310.GA25842@monty> <20040527101637.325e803d.tipogral@freemail.hu> <6.0.1.1.2.20040527230920.028edec8@localhost>
Message-ID: <20040529235434.GB305@monty>

I tested the following file

============================================
\let\normalfont\font
\def\font#1=#2 {%
  \message{Adding mapline: +#2 <#2.pfb}%   
  \pdfmapline{+#2 <#2.pfb}\normalfont#1=#2 }

\pdfoutput=1
\font\f=cmx10 at 100pt
\f Hello
\bye
============================================

and it seems to be ok. What error did you get?

The \pdfmapfile primitive is very simple. It simply scans a <balanced text>
and calls a  C-subroutine to process it. 

Thanh

On Thu, May 27, 2004 at 11:10:06PM +0200, Hans Hagen wrote:
> At 10:16 27/05/2004, Nagy Bence wrote:
> >> I uploaded pdftex-1.20a-rc4 to pdftex.sarovar.org/src. This version
> >> fixes the problem with finding fonts in included pdf, as discussed
> >> before. I also did some (heavy) cleaning up in the code handling
> >> fonts, so expect the unexpected.
> >
> >I wrote a small macro to handling the maplines from my tex file, I want
> >to get the mapline in the form "fontname <fontname.pfb". But it is not
> >working.
> >
> >\let\normalfont\font
> >\def\font#1=#2 {%
> >  \message{Adding mapline: +#2 <#2.pfb}%
> >  \pdfmapline{+#2 <#2.pfb}\normalfont#1=#2 }
> 
> it seems that the map line parser looks over the } and wants a \relax; a 
> bug?
> 
> % interface=en
> 
> \starttext
> 
> \ifx\normalfont\undefined \let\normalfont\font \fi
> 
> \font\xxxx=cmr10 at 100pt
> 
> \def\font#1=#2 %
>   {\message{Adding mapline: +#2 <#2.pfb}%
>    \pdfmapline{+#2 <#2.pfb}\relax
>    \normalfont#1=#2 }
> 
> \font\test=cmr10 at 100pt
> 
> \test oeps
> 
> \stoptext
> 
> 

From tipogral@freemail.hu  Mon May 31 11:26:57 2004
From: tipogral@freemail.hu (Nagy Bence)
Date: Mon, 31 May 2004 12:26:57 +0200
Subject: [NTG-pdftex] pdftex-1.20-rc4
In-Reply-To: <20040529235434.GB305@monty>
References: <20040519101310.GA25842@monty>
 <20040527101637.325e803d.tipogral@freemail.hu>
 <6.0.1.1.2.20040527230920.028edec8@localhost>
 <20040529235434.GB305@monty>
Message-ID: <20040531122657.67aeb8de.tipogral@freemail.hu>

> ============================================
> \let\normalfont\font
> \def\font#1=#2 {%
>   \message{Adding mapline: +#2 <#2.pfb}%   
>   \pdfmapline{+#2 <#2.pfb}\normalfont#1=#2 }
> 
> \pdfoutput=1
> \font\f=cmx10 at 100pt
> \f Hello
> \bye
> ============================================
> 
> and it seems to be ok. What error did you get?

I think cmx10 exists somewhere in your map files, so pdfTeX loads
it. 

Greetings,

Bence

