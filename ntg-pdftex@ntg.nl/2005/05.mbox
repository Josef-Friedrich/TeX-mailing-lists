From noreply at sarovar.org  Mon May  2 23:31:19 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon May  2 23:36:26 2005
Subject: [NTG-pdftex] [ pdftex-Patches-334 ] Setting MF mode by new token
	register \pdfmfmode
Message-ID: <E1DSiVb-0002My-00@sarovar.org>

Patches item #334, was opened at 2005-05-02 23:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=334&group_id=106

Category: Fonts
Group: v1.21b
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: Setting MF mode by new token register \pdfmfmode

Initial Comment:
Can be dumped into the format, see README.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=334&group_id=106
From noreply at sarovar.org  Thu May  5 14:51:02 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May  5 14:56:06 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-335 ] Empty name (\pdfdest name{}xyz)
	destroys /Names array
Message-ID: <E1DTfok-0005QN-00@sarovar.org>

Bugs item #335, was opened at 2005-05-05 14:51
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=335&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: Empty name (\pdfdest name{}xyz) destroys /Names array

Initial Comment:
Hello,

empty strings are suppressed by pdf_print_str
(pdftex.ch). This is fatal for many places,
resulting in invalid PDF files (no working
bookmarks, ...):

\pdfdest name{}xyz
First page
\vfil\break
\pdfdest name{foobar}xyz
\pdfoutline goto name{foobar} count 0{Second page}
Second page.
\bye

The generated PDF file contains:

  /Names [ 4 0 R (foobar) 10 0 R]
  /Limits [ (foobar)]

instead of

  /Names [() 4 0 R (foobar) 10 0 R]
  /Limits [() (foobar)]

Suggested fix (modulo line breaks):

*** pdftex.ch.org       2005-04-24 00:39:28.000000000 +0200
--- pdftex.ch           2005-05-05 14:45:27.000000000 +0200
***************
*** 1921,1928 ****
  begin
      i := str_start[s];
      j := i + length(s) - 1;
!     if (i > j) then
          return; {null string}
      if (str_pool[i] = '(') and (str_pool[j] = ')')
then begin
          pdf_print(s);
          return;
--- 1921,1930 ----
  begin
      i := str_start[s];
      j := i + length(s) - 1;
!     if (i > j) then begin
!         pdf_print("()");
          return; {null string}
+     end;
      if (str_pool[i] = '(') and (str_pool[j] = ')')
then begin
          pdf_print(s);
          return;

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=335&group_id=106
From noreply at sarovar.org  Thu May  5 14:57:09 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May  5 15:02:11 2005
Subject: [NTG-pdftex] [ pdftex-Patches-336 ] Patch file for Bug 335:
Message-ID: <E1DTfuf-0005bM-00@sarovar.org>

Patch file for Bug 335: "Empty name (\pdfdest name{}xyz) destroys /Names array"
Content-type: text/plain; charset=UTF-8

Patches item #336, was opened at 2005-05-05 14:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=336&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: Patch file for Bug 335:
Patch file for Bug 335: "Empty name (\pdfdest name{}xyz) destroys /Names array"

Initial Comment:
Hello,

This patch changes pdf_print_str of pdftex.ch.
Empty strings are not suppressed but written
as "()".

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=336&group_id=106
From noreply at sarovar.org  Tue May 10 19:17:37 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue May 10 19:22:46 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
Message-ID: <E1DVYMT-0007kv-00@sarovar.org>

Patches item #341, was opened at 2005-05-10 19:17
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: \microinterval patch

Initial Comment:
This change file provides two integer parameters that
amend the 
normal TeX ones like \time and \year, giving the passed
time
since 1 jan 1970, stored at the start of the TeX run:

 \epochseconds    integer part
 \microseconds    fractional part (between and 0-1000000)

And one read-only parameter that is computed each time
it is
queried:

 \microinterval  interval between now() and the values
stored
                 in \epochseconds and \microseconds

You are free to change \epochseconds and \microseconds, but
strange results may occur if you do.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106
From taco at elvenkind.com  Tue May 10 19:27:31 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue May 10 19:30:08 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
In-Reply-To: <E1DVYMT-0007kv-00@sarovar.org>
References: <E1DVYMT-0007kv-00@sarovar.org>
Message-ID: <4280EF03.9030101@elvenkind.com>


As requested by Hans, and works for me. I based it on Thanh's sources
of 1.21b at pdftex.sarovar.org/src

Greetings, Taco

noreply@sarovar.org wrote:
> Summary: \microinterval patch
 >
 > Initial Comment:
 > This change file provides two integer parameters that
 > amend the
 > normal TeX ones like \time and \year, giving the passed
 > time
 > since 1 jan 1970, stored at the start of the TeX run:
 >
 >  \epochseconds    integer part
 >  \microseconds    fractional part (between and 0-1000000)
 >
 > And one read-only parameter that is computed each time
 > it is
 > queried:
 >
 >  \microinterval  interval between now() and the values
 > stored
 >                  in \epochseconds and \microseconds
 >
 > You are free to change \epochseconds and \microseconds, but
 > strange results may occur if you do.
From noreply at sarovar.org  Tue May 10 23:33:48 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue May 10 23:38:59 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
Message-ID: <E1DVcMO-0008Sd-00@sarovar.org>

Patches item #341, was opened at 2005-05-10 19:17
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

Category: None
Group: None
>Status: Deleted
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: \microinterval patch

Initial Comment:
This change file provides two integer parameters that
amend the 
normal TeX ones like \time and \year, giving the passed
time
since 1 jan 1970, stored at the start of the TeX run:

 \epochseconds    integer part
 \microseconds    fractional part (between and 0-1000000)

And one read-only parameter that is computed each time
it is
queried:

 \microinterval  interval between now() and the values
stored
                 in \epochseconds and \microseconds

You are free to change \epochseconds and \microseconds, but
strange results may occur if you do.

----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2005-05-10 23:33

Message:
Logged In: YES 
user_id=1608

removed while Hans and I think of a better interface

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106
From noreply at sarovar.org  Wed May 11 19:52:20 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed May 11 19:57:34 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
Message-ID: <E1DVvNc-0001FJ-00@sarovar.org>

Patches item #341, was opened at 2005-05-10 19:17
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

Category: None
Group: None
>Status: Open
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: \microinterval patch

Initial Comment:
This change file provides two integer parameters that
amend the 
normal TeX ones like \time and \year, giving the passed
time
since 1 jan 1970, stored at the start of the TeX run:

 \epochseconds    integer part
 \microseconds    fractional part (between and 0-1000000)

And one read-only parameter that is computed each time
it is
queried:

 \microinterval  interval between now() and the values
stored
                 in \epochseconds and \microseconds

You are free to change \epochseconds and \microseconds, but
strange results may occur if you do.

----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2005-05-11 19:52

Message:
Logged In: YES 
user_id=1608

Reopened with a much better patch attached

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-05-10 23:33

Message:
Logged In: YES 
user_id=1608

removed while Hans and I think of a better interface

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106
From taco at elvenkind.com  Wed May 11 20:08:35 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed May 11 20:11:14 2005
Subject: [NTG-pdftex] benchmarking patch
In-Reply-To: <E1DVvNc-0001FJ-00@sarovar.org>
References: <E1DVvNc-0001FJ-00@sarovar.org>
Message-ID: <42824A23.1070204@elvenkind.com>


Hi,

The just uploaded patch is much better than the original,
both in the api and in the change file quality. Hans and I
are pleased with it, so as far as we are concerned, this is
as-good-as-it-gets. Of course we hope Thanh is willing to
integrate this into a future pdftex.

   Two new primitives are provided:

   \item \verb|\elapsedtime| is a read-only integer that (initially)
   returns the amount of time passed since the start of this run.
   This amount is given in `scaled seconds': the value 65536
   counts as one second.
   If more time has passed than 32767 seconds, \verb|\maxint| will be
   returned.

   \item \verb|\resettime| updates the internal timer, such that
   subsequent calls to \verb|\elapsedtime| will restart from 0.

A bit of example code (in plain):

   {\catcode`\p=12 \catcode`\t=12 \gdef\WITHOUTPT#1pt{#1}}
   \def\withoutpt#1{\expandafter\WITHOUTPT#1}
   \resettimer
   \def\a{}
   \loop \ifnum\count1<5000
      \edef\a{a\a}\advance\count1 1
   \repeat
   \dimen0=\elapsedtime sp
   \message{loop took \expandafter\withoutpt\the\dimen0seconds}
   \bye

Greetings, Taco
(and sorry for the extra noise on this list)

noreply@sarovar.org wrote:
> Patches item #341, was opened at 2005-05-10 19:17
> You can respond by visiting: 
> http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

From jackos1 at poczta.onet.pl  Wed May 11 20:39:38 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Wed May 11 20:40:28 2005
Subject: [NTG-pdftex] example update
Message-ID: <4282516A.7090203@poczta.onet.pl>

Hi there,

I've just joined the list. I'm working on pdfTeX example file revision 
(example.tex). The newest I've found comes from TeXLive2004. Please let 
me know if there is something newer released or being prepared from that 
time.

Regards, Pawe/l
--
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From martin at oneiros.de  Thu May 12 14:45:00 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu May 12 14:45:02 2005
Subject: [NTG-pdftex] benchmarking patch
In-Reply-To: <42824A23.1070204@elvenkind.com>
References: <E1DVvNc-0001FJ-00@sarovar.org> <42824A23.1070204@elvenkind.com>
Message-ID: <20050512124500.GP3342@blau.artcom-gmbh.de>

On 2005-05-11 20:08:35 +0200, Taco Hoekwater wrote:
> The just uploaded patch is much better than the original,

It's reverse, which makes applying it quite difficult. :-(

The patch seems very good, but I'll forward the idea to
tex-implementors; this seems like a very nice extension.

Best regards
        Martin
-- 
                    http://www.tm.oneiros.de
From noreply at sarovar.org  Thu May 12 14:49:08 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 14:54:20 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
Message-ID: <E1DWD7k-0007Ff-00@sarovar.org>

Patches item #341, was opened at 2005-05-10 19:17
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

Category: None
Group: None
Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Taco Hoekwater (taco)
>Assigned to: Martin Schr?der (oneiros)
Summary: \microinterval patch

Initial Comment:
This change file provides two integer parameters that
amend the 
normal TeX ones like \time and \year, giving the passed
time
since 1 jan 1970, stored at the start of the TeX run:

 \epochseconds    integer part
 \microseconds    fractional part (between and 0-1000000)

And one read-only parameter that is computed each time
it is
queried:

 \microinterval  interval between now() and the values
stored
                 in \epochseconds and \microseconds

You are free to change \epochseconds and \microseconds, but
strange results may occur if you do.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-05-11 19:52

Message:
Logged In: YES 
user_id=1608

Reopened with a much better patch attached

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-05-10 23:33

Message:
Logged In: YES 
user_id=1608

removed while Hans and I think of a better interface

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106
From noreply at sarovar.org  Thu May 12 16:45:34 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 16:51:01 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-294 ] pdfmovechars/encoding problem
Message-ID: <E1DWEwQ-0002yk-00@sarovar.org>

Bugs item #294, was opened at 2005-02-15 21:06
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106

Category: Fonts
Group: v1.21a
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: pdfmovechars/encoding problem

Initial Comment:
This has been reported by J?rg Heinrich at 1 Feb. 2005
on the pdftex list (Subject: [pdftex] pdfetex). The
following derived example leads to a segfault:

% this works:
%\pdfmovechars=1
% this gives segfault:
\pdfmovechars=2
% this works:
%\pdfmapline{phvr8r Helvetica <8r.enc <phvr8a.pfb}
% this gives segfault:
\pdfmapline{phvr8r Helvetica <phvr8a.pfb}
\font\phv phvr8r at 10pt
\phv
a
\bye


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 16:45

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-04-02 00:53

Message:
Logged In: YES 
user_id=929

This patch (patch-294b.tgz) removes the functionality of the
\pdfmovechars primitive. What remains for now is a warning,
once per run, if \pdfmovechars is set to a value unequal 0:

! pdfTeX warning: Primitive \pdfmovechars is obsolete.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-31 23:57

Message:
Logged In: YES 
user_id=929

In function t1_read_enc() the function t1_prefix() was
called while t1_line_array was not allocated yet, causing
the segfault. Making a do...while loop from the while loop
does allocation via t1_getline() in time, see the patch.
Maybe that's enough for now to close the bug.

It seems that the function t1_read_enc() is anyway called
only via get_enc() when pdfmovechars > 0, so both functions
serve only this special case, and are normally not in use.

I have done not any check whether \pdfmovechars general
functionality is ok, and one might as well thow out this
primitive, and the unneeded functions. Let's add a note
"deprecated" in the manual...

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106
From martin at oneiros.de  Thu May 12 17:05:39 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu May 12 17:05:42 2005
Subject: [NTG-pdftex] Re: [ pdftex-Bugs-302 ] -jobname doesn't overcome
	texput
In-Reply-To: <E1DLOA7-0005OP-00@sarovar.org>
References: <E1DLOA7-0005OP-00@sarovar.org>
Message-ID: <20050512150539.GU3342@blau.artcom-gmbh.de>

On 2005-04-12 21:52:51 +0530, noreply@sarovar.org wrote:
> My proposed diff is a variant on Akira's work.  It touches 

Olaf,
what's the state of this? Should I add it to pdftex's web2c
version or will you come up with a new version of web2c shortly?

Best regards
        Martin

PS: A more easily applicable patch would also be quite nice. :-)
-- 
                    http://www.tm.oneiros.de
From noreply at sarovar.org  Thu May 12 17:05:41 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 17:11:20 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-304 ] Names of expanded fonts not in log
	output
Message-ID: <E1DWFFt-0003XP-00@sarovar.org>

Bugs item #304, was opened at 2005-03-02 18:25
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106

Category: Fonts
Group: v1.21a
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Names of expanded fonts not in log output

Initial Comment:
When using font expansion, the log output will not
contain the names of the expanded fonts but the null
character instead (resp. ^^@).

%-------------------------------------
\pdfadjustspacing=2
\pdffontexpand\font 20 20 5 autoexpand
\tracingoutput=1
test

\parfillskip 0pt
test
\bye
%-------------------------------------

Regards,
Robert.


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 17:05

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-30 22:16

Message:
Logged In: YES 
user_id=929

This patch is based of Thanh's change file showfont.ch,
which he gave me during EuroTeX2005 (it's also included,
renamed here to showfont-thanh.ch). Use showfont.ch for the
patch.

There is now a new integer variable \pdftracingfonts. It is
zero by default, then we get a log like this (see
robert050302.log):

...\tenrm t

...\tenrm (+20) e

Without font expansion, this default should be compatible
with TeX's original log output.

If \pdftracingfonts is set to 1 (or greater), we get a more
verbose log (see tst-304.log):

...\xivtt (cmtt10@14.0pt) t

.\xivtt (cmtt10+20@14.0pt) e

Seems to work with change file showfont.ch coming directly
after after hz.ch.

Patch only roughly tested with pdfetex, likely to give
problems with pdfxtex, as the variable numbering might
differ. Log format to be agreed upon...

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106
From noreply at sarovar.org  Thu May 12 17:08:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 17:14:03 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-306 ] cmap: unicode ???? is mapped to
	multiple glyphs
Message-ID: <E1DWFIo-0003zk-00@sarovar.org>

Bugs item #306, was opened at 2005-03-05 17:52
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=306&group_id=106

Category: Fonts
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Peter Dyballa (ballapete)
Assigned to: Hartmut Henkel (hhenkel)
Summary: cmap: unicode ???? is mapped to multiple glyphs

Initial Comment:
I created symlinks from the Lucida fonts that come with Java runtime 
and I created from them TFM files with ttf2tfm version 1.5, and also a 
map file fragment and FD files. When I access LucidaSans-Oblique 
pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C 7.5.4) reports this:

Error: pdflatex (file /usr/local/teTeX/share/texmf.local/fonts/truetype/
lucida/llsro8a.ttf): cmap: unicode 2010 is mapped to multiple glyphs
 ==> Fatal error occurred, the output PDF file is not finished!

U+2010 is HYPHEN


----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 17:08

Message:
Logged In: YES 
user_id=421

What's the state of this?

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=306&group_id=106
From noreply at sarovar.org  Thu May 12 17:10:13 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 17:15:30 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-310 ] \pdfxform doesn't work with box
	registers > 255. Patch included.
Message-ID: <E1DWFKH-000401-00@sarovar.org>

Bugs item #310, was opened at 2005-03-19 20:58
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=310&group_id=106

Category: etex
Group: v1.21a
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: \pdfxform doesn't work with box registers > 255. Patch included.

Initial Comment:
Bug reported by:

Date: Sat, 19 Mar 2005 00:54:40 +0100
From: Pawel Jackowski
To: pdftex@tug.org
Subject: [pdftex] \pdfxform256

Sparse array handling from etex was missing in \pdfxform.
Bug solved by patch to pdfetex.ch2, see pdfetex.ch2.diff. 

Please check.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 17:10

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=310&group_id=106
From noreply at sarovar.org  Thu May 12 17:33:26 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 17:39:38 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-315 ] pdflatex on solaris font problems
	with acroread
Message-ID: <E1DWFgk-0004Ut-00@sarovar.org>

Bugs item #315, was opened at 2005-03-21 16:53
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=315&group_id=106

Category: Fonts
Group: v1.21a
>Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Stan Swiercz (swiercz)
Assigned to: Martin Schr?der (oneiros)
Summary: pdflatex on solaris font problems with acroread

Initial Comment:
I have compiled pdflatex 1.2.1a that comes with teTeX 3.0
on both linux and solaris. The linux version works
properly but the solaris one does not.

The last font included in the pdf output produces the
error:

   Unable to extract the embedded font 'KTGBVU+CMR8'.
   Some characters may not display or print correctly.

when viewed with acroread (version 5 or 6, windows,
linux and solaris versions). Note that no error is seen
when viewed with ghostscript and xpdf. The above error
comes from the file:
------------------------
\documentclass{article} 
\newcommand{\ip}[2]{(#1, #2)}
\begin{document}  
This is an example input file.

Footnotes \footnote{This is an example of a footnote.}
pose no problem.

\LaTeX\ is good at typesetting mathematical formulas
like
       \( x-3y + z = 7 \)
or
       \( a_{1} > x^{2n} + y^{2n} > x' \)
or
       \( \ip{A}{B} = \sum_{i} a_{i} b_{i} \).
The spaces you type in a formula are
ignored.  Remember that a letter like
       $x$                   % $ ... $  and  \( ... \)
 are equivalent
is a formula when it denotes a mathematical
symbol, and it should be typed as one.

\end{document}
-----------------------

The sigma is produced correctly. If however I comment
out the footnote, the sigma in the summation is no
longer viewable and the error message is

   Unable to extract the embedded font 'ATSTIO+CMEX10'.
   Some characters may not display or print correctly.


I attach a pdf files produced on solaris.

Is this a know problem with a patch available?
If you need further information please
do not hesitate to contact me.

Stan



----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 17:33

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Stan Swiercz (swiercz)
Date: 2005-03-24 20:44

Message:
Logged In: YES 
user_id=2345

I restored the original ptexmac.h and patched writet1.c
and recompiled on the original solaris system I was
compiling on.

The pdf produced displays properly on acroread.

I thank you for the prompt response and help.

Stan

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-24 20:29

Message:
Logged In: YES 
user_id=929

Hi Stan,

if possible please test the attached patch to writet1.c. 

This now really initializes t1_save_offset to zero, and the
save_offset() calls are only where really needed (there were
too many, too early. They must never come before the first
fb_putchar(), as only this does the alloc_array(fb,...)
initialization.

Also please do _not_ patch ptexmac.h (!), as this patch
would cover otherwise maybe missing initializations. Leave
ptexmac.h as in teTeX-3.0.

I tried the writet1.c patch with arbitrary initial value of
fb_ptr, and it seems to get it right.

Thanks a lot for help!

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-24 16:48

Message:
Logged In: YES 
user_id=929

who is pulling this bug into the "closed area"? :-) It seems
to work but it still looks weird, maybe the final patch will
be different...

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Stan Swiercz (swiercz)
Date: 2005-03-24 16:18

Message:
Logged In: YES 
user_id=2345

The ptexmac.h patch fixed it.

Thank you!


Stan

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-24 16:04

Message:
Logged In: YES 
user_id=929

once again, please try the patch for ptexmac.h.

Regards, Hartmut



----------------------------------------------------------------------

Comment By: Stan Swiercz (swiercz)
Date: 2005-03-24 16:01

Message:
Logged In: YES 
user_id=2345

It does appear that t1_offset_value is at fault.
I put in a pdftex_warn (something easy to add) in writet1.c
and the first time it outputs I see

Warning: pdflatex (file
/nfs/encs/ArchDep/sun4.solaris8/pkg/teTeX-3.0/root/texm
f/fonts/type1/bluesky/cm/cmr8.pfb): -268435455
t1_save_offset value

All the other times the "warning" is displayed it
returns 0.

Stan


----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-24 15:52

Message:
Logged In: YES 
user_id=929

thanks a lot, it was as expected :-( but the error _is_
around there, it's uninitialized fb_ptr i guess, just
searching how to initialize it.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Stan Swiercz (swiercz)
Date: 2005-03-24 15:44

Message:
Logged In: YES 
user_id=2345

I have applied the patch and found no difference.


Stan

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-24 15:29

Message:
Logged In: YES 
user_id=929

maybe the infamous "Solaris compiler bug" is just an
uninitialized variable t1_save_offset? It's unclear, as it
seems that this could happen only if the font is not being
included. Anyway: Could some Solaris freak try out the
attached tiny patch to writet1.c?

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Thomas Esser (tetex)
Date: 2005-03-24 01:35

Message:
Logged In: YES 
user_id=1230

We have seen this before. pdftex list, posting by Adrian
Lanz, Mon, 
09 Aug 2004.

There was no real outcome of that thread. Adrian wrote on 23
Sep 2004
to the texlive list:

    > On Tue, Sep 21, 2004 at 07:18:23PM -0500, Maksym
Polyakov wrote:
    >> apparently there was some overflow in /Length1 -- it
should be 810
    >
    > Ah, now it sounds familiar. Adrian Lanz has reported
the same to
    > pdftex@tug.org (09 Aug 2004, he uses SUN Solaris 9 /
gcc 3.3.2).
    >

    Yes, I had exactly the same problem recently installing
teTeX-beta
    2.96.7.20040721. In my case, the symptom was that
pdflatex run 
    without error, but a wrong /Length1 parameter was
inserted in the PDF
    output file, which evidently caused Acrobat Reader's
error message
    (no problem, however, with xpdf or with the "dvips
-Ppdf" routine).

    I think I solved the problem by changing the order and
rules how
    shared libraries are found and handled on my Sun Sparc
Solaris 2.9
    system, and/or I may have re-installed some programs and
libraries
    (ncurses, gettext, libiconv). I am sorry not being more
specific on

So, we have at least three people with this problem: Stan
Swiercz,
Maksym Polyakov, Adrian Lanz.

I think that this is some king of compiler bug or something
like that...

Thomas                                                     
                                                               

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-03-23 15:42

Message:
Logged In: YES 
user_id=421

Yes, this is definitely a problem for some specific solaris
installations which I can't reproduce.

----------------------------------------------------------------------

Comment By: Stan Swiercz (swiercz)
Date: 2005-03-23 15:08

Message:
Logged In: YES 
user_id=2345

I have done more debugging and I find that with a newer
solaris 9 kernel the executable works fine. There is some
patch to the OS that fixes this. This is something static as
when I run this executable on a solaris machine running an
older solaris9 kernel or solaris8 it works properly.

Further digging I find that when I run the linker command 
on the older solaris 9 machine it produces a faulty
executable BUT if I run "g++ -v" to see what the real
linking command
is and cut and paste it so as to run it instead  the
executable produces a pdf viewable with acroread.

The basic g++ link command is

c++ -o pdfetex pdfetexini.o pdfetex0.o pdfetex1.o pdfetex2.o
pdfetex3.o pdfetexextra.o ../../libs/md5/md5.o 
pdftexdir/libpdf.a ../../libs/libpng/libpng.a
../../libs/zlib/libz.a ../../libs/xpdf/xpdf/libxpdf.a
../../libs/xpdf/goo/libGoo.a ../../libs/xpdf/fofi/libfofi.a
-lsocket lib/lib.a ../kpathsea/.libs/libkpathsea.a -lm

Instead of running this on older kernels I used

/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/collect2
-V -Y P,/usr/ccs/lib:/usr/lib -L /local/lib -L /encs/lib -Qy
-o pdfetex
/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/crt1.o
/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/crti.o
/usr/ccs/lib/values-Xa.o
/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/crtbegin.o
-L/encs/bin/../lib/gcc-lib/sparc-sun-solaris2.8/3.3.2
-L/encs/bin/../lib/gcc-lib
-L/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2
-L/usr/ccs/bin -L/usr/ccs/lib
-L/encs/bin/../lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/../../..
-L/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/../../..
pdfetexini.o pdfetex0.o pdfetex1.o pdfetex2.o pdfetex3.o
pdfetexextra.o ../../libs/md5/md5.o pdftexdir/libpdf.a
../../libs/libpng/libpng.a ../../libs/zlib/libz.a
../../libs/xpdf/xpdf/libxpdf.a ../../libs/xpdf/goo/libGoo.a
../../libs/xpdf/fofi/libfofi.a -lsocket lib/lib.a
../kpathsea/.libs/libkpathsea.a -lstdc++ -lm -lgcc_s -lgcc
-lc -lgcc_s -lgcc -lc
/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/crtend.o
/encs/pkg/gcc-3.3.2/root/lib/gcc-lib/sparc-sun-solaris2.8/3.3.2/crtn.o

For the record /usr/ccs/lib/values-Xa.o is the same on both
systems. I don't understrand...


I also tracked down what the difference was between a pdf
file that displays and does not display.

The one that does display correctly has 

/Type /Page
/Contents 49 0 R
/Resources 47 0 R
/MediaBox [0 0 612 792]
/Parent 25 0 R
>> endobj
47 0 obj <<
/Font << /F8 12 0 R /F27 24 0 R /F11 31 0 R /F13 37 0 R /F7
18 0 R /F10 34 0 R >>
/ProcSet [ /PDF /Text ]
>> endobj
45 0 obj <<
/Length1 946
/Length2 3204
/Length3 532
/Length 3847      
/Filter /FlateDecode

while the one that does not has


/Type /Page
/Contents 49 0 R
/Resources 47 0 R
/MediaBox [0 0 612 792]
/Parent 25 0 R
>> endobj
47 0 obj <<
/Font << /F8 12 0 R /F27 24 0 R /F11 31 0 R /F13 37 0 R /F7
18 0 R /F10 34 0 R >>
/ProcSet [ /PDF /Text ]
>> endobj
45 0 obj <<
/Length1 268436401
/Length2 3204
/Length3 532
/Length 3848      
/Filter /FlateDecode


the 946 has turned into 268436401!

Hope this info helps.

Stan


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-03-23 14:25

Message:
Logged In: YES 
user_id=421

This seems to be a build problem on Solaris. Compiling the
example on teTeX 3.0 on Linux produces a pdf that shows no
problems in AR.

A possible cause for the message by AR might be this extract
from pdf_test_solaris.pdf:
---------
29 0 obj <<
/Length1 268436401
/Length2 3204
---------
Length1 is definitely wrong.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-03-23 14:16

Message:
Logged In: YES 
user_id=421

I can reproduce the problem with AR5 and AR7(latest "beta")
on Linux. I can't reproduce it with gs 8.50 and Jaws.

I suspect that this is a bug in AR. :-(

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=315&group_id=106
From noreply at sarovar.org  Thu May 12 17:36:53 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu May 12 17:42:27 2005
Subject: [NTG-pdftex] [ pdftex-Patches-336 ] Patch file for Bug 335:
Message-ID: <E1DWFk5-0004dX-00@sarovar.org>

Patch file for Bug 335: "Empty name (\pdfdest name{}xyz) destroys /Names array"
Content-type: text/plain; charset=UTF-8

Patches item #336, was opened at 2005-05-05 14:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=336&group_id=106

Category: None
>Group: v1.21b
>Status: Closed
>Resolution: Later
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: Martin SchrÃ¶der (oneiros)
>Summary: Patch file for Bug 335:
Patch file for Bug 335: "Empty name (\pdfdest name{}xyz) destroys /Names array"

Initial Comment:
Hello,

This patch changes pdf_print_str of pdftex.ch.
Empty strings are not suppressed but written
as "()".

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

>Comment By: Martin SchrÃ¶der (oneiros)
Date: 2005-05-12 17:36

Message:
Logged In: YES 
user_id=421

Please actually _attach_ your patch to bug 335. :-)

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=336&group_id=106
From olaf at infovore.xs4all.nl  Thu May 12 22:23:40 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Thu May 12 22:23:45 2005
Subject: [NTG-pdftex] Re: [ pdftex-Bugs-302 ] -jobname doesn't overcome
	texput
In-Reply-To: <20050512150539.GU3342@blau.artcom-gmbh.de> (Martin
	=?iso-8859-1?q?Schr=F6der's?= message of "Thu,
	12 May 2005 17:05:39 +0200")
References: <E1DLOA7-0005OP-00@sarovar.org>
	<20050512150539.GU3342@blau.artcom-gmbh.de>
Message-ID: <87ekccb3cj.fsf@infovore.xs4all.nl>

Martin Schr?der writes:

> On 2005-04-12 21:52:51 +0530, noreply@sarovar.org wrote:
>> My proposed diff is a variant on Akira's work.  It touches 

> Olaf,
> what's the state of this? Should I add it to pdftex's web2c
> version or will you come up with a new version of web2c shortly?

It's in my personal web2c code, and I can spin it out of there into
the tex-live repository.  I'll probably do that next week or so.

> Best regards
>         Martin

> PS: A more easily applicable patch would also be quite nice. :-)

I attached an actual patch.

-- 
Olaf Weber

               (This space left blank for technical reasons.)

From jackos1 at poczta.onet.pl  Fri May 13 00:38:31 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Fri May 13 00:38:40 2005
Subject: [NTG-pdftex] the manual issues
Message-ID: <4283DAE7.60006@poczta.onet.pl>

Hi,

please consider the following issues (applies to pdfTeX manual
released at 2005-04-27, 15:50).

1. Page 18, \pdfhorigin description:

"use TeX's own \horigin primitive" -- imho should be \hoffset instead
of \horigin ;)

2. Page 18, \pdfpagewidth description:

"If the value is not given..." -- I'd rather say "If the value is set to
0pt". If one say \let\pdfpagewidth\relax, while shipping out the page
pdfTeX will take the last relevant value, not the formula shown in the 
manual.

3. Page 19, \pdfinfo description:

"If a key is used more that once, the first appearance will be used" --
Sugestion; one may think, that pdfTeX reads keys provided to
\pdfinfo (and other primtives that takes a literal pdf text as a 
parameters) and replaces the values if doubled. Perhaps it should be 
mentioned, that no interpretation is made here. Moreover, it seems that 
in Acrobat the SECOND entry takes a place...

4. Page 24, \pdfobj description:

"When <object type spec> is not given, a dictionary object is created"
-- doesn't seem to be true. Isn't that an old behaviour?

5. Page 25, \pdfpagesattr example:

\pdfpagesattr{/Rotate 90 /MediaBox [0 0 612 792]}

One may be confused, since MediaBox setup will never take an effect if 
provided in this way. Each page has always own MediaBox that overrides 
\pdfpagesattr. CropBox could be better I think.

6. Page 25, \pdfpageref description:

Extra backalshes: "\\pdfpageref5 expands to number \18."

7. Page 25, \pdfxform description:

The last sentence in this paragraph -- as in point 3; maybe it should be
mentioned that it may depend on the viewer. Entries provided by the user
doesn't seem to take a priority over later ones in Acrobat. It applies
to Ghostsript however. The code such as

\setbox0\hbox{Aqq}
\pdfxform attr {/BBox [0 0 10 10]}0
\pdfrefxform\pdflastxform

outputs

1 0 obj <<
/Type /XObject
/Subtype /Form
/BBox [0 0 10 10]
/BBox [0 0 17.988 8.745]
/FormType 1
/Matrix [1 0 0 1 0 0]
/Resources 9 0 R
/Length 67
/Filter /FlateDecode
>>

and this is interpreted in different ways, depending on the viewer.

I like the rest very much!

BTW, how manual updates are organised? Are the sources in CVS or one 
from time to time send an updates to sarovar?

Best regards,
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl

From noreply at sarovar.org  Fri May 13 16:38:46 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 16:47:28 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-302 ] -jobname doesn't overcome texput
Message-ID: <E1DWbJO-0003Me-00@sarovar.org>

Bugs item #302, was opened at 2005-03-01 19:06
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=302&group_id=106

Category: web2c
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: John Denker (jsd)
Assigned to: Olaf Weber (infovore)
Summary: -jobname doesn't overcome texput

Initial Comment:
Hi --

Suppose I want to pipe commands into pdflatex:
       echo '\typeout{---\jobname---}' | \
         pdflatex --jobname foo

You might expect that to type out ---foo---
but instead it types out ---texput---

I observe that --jobname works just fine for
any filename I can think of, just not when the
filename is absent entirely.

I can offer two workarounds:
  1) It's not documented, but nevertheless possible
   to \def\jobname{foo}.

  2) Of course it's possible to stuff the commands
   into tmp.tex and then pdflatex --jobname foo tmp.tex

Because these workarounds exist, I would rate this
as a very low-priority bug.  But it had me surprised
and confused for a while.  Given the overall high 
quality of the product, I thought I'd bring it to 
your attention.


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:38

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Olaf Weber (infovore)
Date: 2005-04-12 18:22

Message:
Logged In: YES 
user_id=1847

This is a general problem with the implementation of the 
--jobname 
switch in web2c. 
 
My proposed diff is a variant on Akira's work.  It touches 
more files, 
but gives IMHO a cleaner interface to get_job_name() and 
less need for 
additional #defines.  Unless there turns out to be 
something wrong 
with this, it will be merged in the web2c sources. 
 
 lib/texmfmp.c       |    6 ++++-- 
 mf.ch               |    6 +++++- 
 mp.ch               |    4 +++- 
 tex.ch              |    6 ++++-- 
 web2c/coerce.h      |    2 +- 
 web2c/texmf.defines |    2 +- 
 6 files changed, 18 insertions(+), 8 deletions(-) 
 
Index: mf.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/mf.ch,v 
retrieving revision 1.40 
diff -u -d -r1.40 mf.ch 
--- mf.ch	28 Dec 2004 18:24:38 -0000	1.40 
+++ mf.ch	12 Apr 2005 16:07:11 -0000 
@@ -1717,8 +1717,12 @@ 
 @z 
  
 @x [38.788] Set correct filename for recorder. 
+if job_name=0 then job_name:="mfput"; 
+@.mfput@> 
 pack_job_name(".log"); 
 @y 
+if job_name=0 then job_name:=get_job_name("mfput"); 
+@.mfput@> 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
 pack_job_name(".log"); 
@@ -1778,7 +1782,7 @@ 
 @x [38.793] l.15938 - The job name may have been given on 
the command line. 
   begin job_name:=cur_name; open_log_file; 
 @y 
-  begin job_name:=get_job_name; open_log_file; 
+  begin job_name:=get_job_name(cur_name); open_log_file; 
 @z 
  
 @x [38.793] Can't return name to string pool because of 
editor option? 
Index: mp.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/mp.ch,v 
retrieving revision 1.48 
diff -u -d -r1.48 mp.ch 
--- mp.ch	28 Dec 2004 18:23:47 -0000	1.48 
+++ mp.ch	12 Apr 2005 16:06:53 -0000 
@@ -1403,8 +1403,10 @@ 
 @z 
  
 @x [35.765] Change name of recorder file. 
+if job_name=0 then job_name:="mpout"; 
 pack_job_name(".log"); 
 @y 
+if job_name=0 then job_name:=get_job_name("mpout"); 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
 pack_job_name(".log"); 
@@ -1489,7 +1491,7 @@ 
       incr(j); 
     stop_at_space:=true; 
     end_name; 
-    job_name:=get_job_name; 
+    job_name:=get_job_name(cur_name); 
     str_ref[job_name] := max_str_ref; 
 @z 
  
Index: tex.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/tex.ch,v 
retrieving revision 1.89 
diff -u -d -r1.89 tex.ch 
--- tex.ch	29 Dec 2004 11:08:23 -0000	1.89 
+++ tex.ch	12 Apr 2005 16:07:26 -0000 
@@ -2241,9 +2241,11 @@ 
 @!months:^char; 
 @z 
  
-@x [29.534] l.10289 - Filename change for the recorder. 
+@x [29.534] l.10300 - Filename change for the recorder. 
+if job_name=0 then job_name:="texput"; 
 @.texput@> 
 @y 
+if job_name=0 then job_name:=get_job_name("texput"); 
 @.texput@> 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
@@ -2369,7 +2371,7 @@ 
 @x [29.537] l.10352 - start_input: was job_name given on 
the command line? 
   begin job_name:=cur_name; open_log_file; 
 @y 
-  begin job_name:=get_job_name; open_log_file; 
+  begin job_name:=get_job_name(cur_name); open_log_file; 
 @z 
  
 @x [29.537] l.10356 -  
Index: lib/texmfmp.c 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/lib/texmfmp.c,v 
retrieving revision 1.108 
diff -u -d -r1.108 texmfmp.c 
--- lib/texmfmp.c	12 Apr 2005 15:39:14 -0000	
1.108 
+++ lib/texmfmp.c	12 Apr 2005 15:55:17 -0000 
@@ -1591,10 +1591,12 @@ 
   return maketexstring(fullnameoffile); 
 } 
  
+/* Get the job name to be used, which may have been set 
from the 
+   command line. */ 
 strnumber 
-getjobname() 
+getjobname(strnumber name) 
 { 
-    strnumber ret = curname; 
+    strnumber ret = name; 
     if (job_name != NULL) 
       ret = maketexstring(job_name); 
     return ret; 
Index: web2c/coerce.h 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/web2c/coerce.h,v 
retrieving revision 1.5 
diff -u -d -r1.5 coerce.h 
--- web2c/coerce.h	26 Feb 2004 17:43:14 -0000	
1.5 
+++ web2c/coerce.h	12 Apr 2005 15:55:31 -0000 
@@ -24,7 +24,7 @@ 
 /* And we use the opportunity to declare a few functions 
that could not be 
    declared in texmfmp.h, because they need typedefs not 
yet known at that 
    point.  */ 
-extern strnumber getjobname P1H(void); 
+extern strnumber getjobname P1H(strnumber); 
  
 #ifdef MP 
 /* MP defined poolASCIIcode instead of packedASCIIcode, 
sigh. */ 
Index: web2c/texmf.defines 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/web2c/texmf.defines,v 
retrieving revision 1.17 
diff -u -d -r1.17 texmf.defines 
--- web2c/texmf.defines	14 Jul 2004 16:17:48 -0000	
1.17 
+++ web2c/texmf.defines	12 Apr 2005 15:58:51 -0000 
@@ -22,7 +22,7 @@ 
 @define function callmakempx (); 
 @define function floorscaled (); 
 @define function floorunscaled (); 
-@define function getjobname; 
+@define function getjobname (); 
 @define function getrandomseed; 
 @define function initscreen; 
 @define function inputln (); 
 

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-04-12 14:11

Message:
Logged In: YES 
user_id=421

Patches provided by Akira on NTG-pdftex

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=302&group_id=106
From noreply at sarovar.org  Fri May 13 16:38:59 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 16:47:35 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-302 ] -jobname doesn't overcome texput
Message-ID: <E1DWbJb-0003Mm-00@sarovar.org>

Bugs item #302, was opened at 2005-03-01 19:06
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=302&group_id=106

Category: web2c
Group: v1.21a
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: John Denker (jsd)
Assigned to: Olaf Weber (infovore)
Summary: -jobname doesn't overcome texput

Initial Comment:
Hi --

Suppose I want to pipe commands into pdflatex:
       echo '\typeout{---\jobname---}' | \
         pdflatex --jobname foo

You might expect that to type out ---foo---
but instead it types out ---texput---

I observe that --jobname works just fine for
any filename I can think of, just not when the
filename is absent entirely.

I can offer two workarounds:
  1) It's not documented, but nevertheless possible
   to \def\jobname{foo}.

  2) Of course it's possible to stuff the commands
   into tmp.tex and then pdflatex --jobname foo tmp.tex

Because these workarounds exist, I would rate this
as a very low-priority bug.  But it had me surprised
and confused for a while.  Given the overall high 
quality of the product, I thought I'd bring it to 
your attention.


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:38

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Olaf Weber (infovore)
Date: 2005-04-12 18:22

Message:
Logged In: YES 
user_id=1847

This is a general problem with the implementation of the 
--jobname 
switch in web2c. 
 
My proposed diff is a variant on Akira's work.  It touches 
more files, 
but gives IMHO a cleaner interface to get_job_name() and 
less need for 
additional #defines.  Unless there turns out to be 
something wrong 
with this, it will be merged in the web2c sources. 
 
 lib/texmfmp.c       |    6 ++++-- 
 mf.ch               |    6 +++++- 
 mp.ch               |    4 +++- 
 tex.ch              |    6 ++++-- 
 web2c/coerce.h      |    2 +- 
 web2c/texmf.defines |    2 +- 
 6 files changed, 18 insertions(+), 8 deletions(-) 
 
Index: mf.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/mf.ch,v 
retrieving revision 1.40 
diff -u -d -r1.40 mf.ch 
--- mf.ch	28 Dec 2004 18:24:38 -0000	1.40 
+++ mf.ch	12 Apr 2005 16:07:11 -0000 
@@ -1717,8 +1717,12 @@ 
 @z 
  
 @x [38.788] Set correct filename for recorder. 
+if job_name=0 then job_name:="mfput"; 
+@.mfput@> 
 pack_job_name(".log"); 
 @y 
+if job_name=0 then job_name:=get_job_name("mfput"); 
+@.mfput@> 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
 pack_job_name(".log"); 
@@ -1778,7 +1782,7 @@ 
 @x [38.793] l.15938 - The job name may have been given on 
the command line. 
   begin job_name:=cur_name; open_log_file; 
 @y 
-  begin job_name:=get_job_name; open_log_file; 
+  begin job_name:=get_job_name(cur_name); open_log_file; 
 @z 
  
 @x [38.793] Can't return name to string pool because of 
editor option? 
Index: mp.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/mp.ch,v 
retrieving revision 1.48 
diff -u -d -r1.48 mp.ch 
--- mp.ch	28 Dec 2004 18:23:47 -0000	1.48 
+++ mp.ch	12 Apr 2005 16:06:53 -0000 
@@ -1403,8 +1403,10 @@ 
 @z 
  
 @x [35.765] Change name of recorder file. 
+if job_name=0 then job_name:="mpout"; 
 pack_job_name(".log"); 
 @y 
+if job_name=0 then job_name:=get_job_name("mpout"); 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
 pack_job_name(".log"); 
@@ -1489,7 +1491,7 @@ 
       incr(j); 
     stop_at_space:=true; 
     end_name; 
-    job_name:=get_job_name; 
+    job_name:=get_job_name(cur_name); 
     str_ref[job_name] := max_str_ref; 
 @z 
  
Index: tex.ch 
=================================================================== 
RCS file: /usr/local/cvsroot/texk/texk/web2c/tex.ch,v 
retrieving revision 1.89 
diff -u -d -r1.89 tex.ch 
--- tex.ch	29 Dec 2004 11:08:23 -0000	1.89 
+++ tex.ch	12 Apr 2005 16:07:26 -0000 
@@ -2241,9 +2241,11 @@ 
 @!months:^char; 
 @z 
  
-@x [29.534] l.10289 - Filename change for the recorder. 
+@x [29.534] l.10300 - Filename change for the recorder. 
+if job_name=0 then job_name:="texput"; 
 @.texput@> 
 @y 
+if job_name=0 then job_name:=get_job_name("texput"); 
 @.texput@> 
 pack_job_name(".fls"); 
 recorder_change_filename(stringcast(name_of_file+1)); 
@@ -2369,7 +2371,7 @@ 
 @x [29.537] l.10352 - start_input: was job_name given on 
the command line? 
   begin job_name:=cur_name; open_log_file; 
 @y 
-  begin job_name:=get_job_name; open_log_file; 
+  begin job_name:=get_job_name(cur_name); open_log_file; 
 @z 
  
 @x [29.537] l.10356 -  
Index: lib/texmfmp.c 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/lib/texmfmp.c,v 
retrieving revision 1.108 
diff -u -d -r1.108 texmfmp.c 
--- lib/texmfmp.c	12 Apr 2005 15:39:14 -0000	
1.108 
+++ lib/texmfmp.c	12 Apr 2005 15:55:17 -0000 
@@ -1591,10 +1591,12 @@ 
   return maketexstring(fullnameoffile); 
 } 
  
+/* Get the job name to be used, which may have been set 
from the 
+   command line. */ 
 strnumber 
-getjobname() 
+getjobname(strnumber name) 
 { 
-    strnumber ret = curname; 
+    strnumber ret = name; 
     if (job_name != NULL) 
       ret = maketexstring(job_name); 
     return ret; 
Index: web2c/coerce.h 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/web2c/coerce.h,v 
retrieving revision 1.5 
diff -u -d -r1.5 coerce.h 
--- web2c/coerce.h	26 Feb 2004 17:43:14 -0000	
1.5 
+++ web2c/coerce.h	12 Apr 2005 15:55:31 -0000 
@@ -24,7 +24,7 @@ 
 /* And we use the opportunity to declare a few functions 
that could not be 
    declared in texmfmp.h, because they need typedefs not 
yet known at that 
    point.  */ 
-extern strnumber getjobname P1H(void); 
+extern strnumber getjobname P1H(strnumber); 
  
 #ifdef MP 
 /* MP defined poolASCIIcode instead of packedASCIIcode, 
sigh. */ 
Index: web2c/texmf.defines 
=================================================================== 
RCS 
file: /usr/local/cvsroot/texk/texk/web2c/web2c/texmf.defines,v 
retrieving revision 1.17 
diff -u -d -r1.17 texmf.defines 
--- web2c/texmf.defines	14 Jul 2004 16:17:48 -0000	
1.17 
+++ web2c/texmf.defines	12 Apr 2005 15:58:51 -0000 
@@ -22,7 +22,7 @@ 
 @define function callmakempx (); 
 @define function floorscaled (); 
 @define function floorunscaled (); 
-@define function getjobname; 
+@define function getjobname (); 
 @define function getrandomseed; 
 @define function initscreen; 
 @define function inputln (); 
 

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-04-12 14:11

Message:
Logged In: YES 
user_id=421

Patches provided by Akira on NTG-pdftex

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=302&group_id=106
From noreply at sarovar.org  Fri May 13 16:42:18 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 16:47:36 2005
Subject: [NTG-pdftex] [ pdftex-Patches-91 ] \tagcode patch
Message-ID: <E1DWbMo-0003NF-00@sarovar.org>

Patches item #91, was opened at 2004-07-13 10:58
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=91&group_id=106

Category: None
Group: None
>Status: Closed
>Resolution: Accepted
Priority: 3
Submitted By: Martin Schr?der (oneiros)
Assigned to: The Thanh Han (hanthethanh)
Summary: \tagcode patch

Initial Comment:
Patch from Taco Hoekwater for an extra primitive named
\tagcode, allowing read and write access to a
character's char_tag info. The associated internal
command is assign_font_int, with the new modifier value
tag_code.

More info at http://www.metatex.org/web/tagcode.html

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:42

Message:
Logged In: YES 
user_id=421

This has been included in 1.21a

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=91&group_id=106
From noreply at sarovar.org  Fri May 13 16:42:45 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 16:48:11 2005
Subject: [NTG-pdftex] [ pdftex-Patches-93 ] \quitvmode
Message-ID: <E1DWbNF-0003NY-00@sarovar.org>

Patches item #93, was opened at 2004-07-15 12:12
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=93&group_id=106

Category: None
Group: None
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: The Thanh Han (hanthethanh)
Summary: \quitvmode

Initial Comment:
The change file adds a new primitive called \quitvmode.
In vertical modes, it is identical to \indent, but in
horizontal and math modes it is \noindent.

See http://www.metatex.org/web/quitvmode.html

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:42

Message:
Logged In: YES 
user_id=421

This has been included in 1.21a

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=93&group_id=106
From noreply at sarovar.org  Fri May 13 16:57:53 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 17:03:12 2005
Subject: [NTG-pdftex] [ pdftex-Patches-259 ] Expanded png inclusion support
Message-ID: <E1DWbbt-0003ag-00@sarovar.org>

Patches item #259, was opened at 2005-01-11 16:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106

>Category: Image inclusion
Group: None
>Status: Closed
>Resolution: Accepted
Priority: 5
Submitted By: Taco Hoekwater (taco)
>Assigned to: Hartmut Henkel (hhenkel)
Summary: Expanded png inclusion support

Initial Comment:
The attached zip file contains a change file for all
pdftex's (to be applied *after* hz.cg) and a completely
new writepng.c



----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:57

Message:
Logged In: YES 
user_id=421

This has been included in version 1.30.0

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-03-14 12:03

Message:
Logged In: YES 
user_id=1608

changes as agreed at Pont-a-Mousson:
-\pdfoptionimageforcegray removed
-\pdfoptionimageapplygamma is now 0 or 1

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-03-03 17:00

Message:
Logged In: YES 
user_id=1608

Bugfixes in 16-bit color depth mode (needs an 8-bit alpha
channel) and corrected PNG transformation discovery for gray
conversion.

This is a final version for now, it should be added to a
pdftex beta to allow 'in the wild' testing.


----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-03-01 13:38

Message:
Logged In: YES 
user_id=1608

This update fixes the \pdfoptionimageforcegray bugs
discovered by Hartmut.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-02-28 17:27

Message:
Logged In: YES 
user_id=1608

Sorry, I forgot the 16-bit color code in the previous version

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-02-28 16:38

Message:
Logged In: YES 
user_id=1608

This new version incorporates the code from Hartmut's speed 
patch.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106
From noreply at sarovar.org  Fri May 13 16:58:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri May 13 17:03:55 2005
Subject: [NTG-pdftex] [ pdftex-Patches-341 ] \microinterval patch
Message-ID: <E1DWbcg-0003aw-00@sarovar.org>

Patches item #341, was opened at 2005-05-10 19:17
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106

Category: None
Group: None
>Status: Closed
Resolution: Accepted
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Martin Schr?der (oneiros)
Summary: \microinterval patch

Initial Comment:
This change file provides two integer parameters that
amend the 
normal TeX ones like \time and \year, giving the passed
time
since 1 jan 1970, stored at the start of the TeX run:

 \epochseconds    integer part
 \microseconds    fractional part (between and 0-1000000)

And one read-only parameter that is computed each time
it is
queried:

 \microinterval  interval between now() and the values
stored
                 in \epochseconds and \microseconds

You are free to change \epochseconds and \microseconds, but
strange results may occur if you do.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-13 16:58

Message:
Logged In: YES 
user_id=421

This has been included in version 1.30.0

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-05-11 19:52

Message:
Logged In: YES 
user_id=1608

Reopened with a much better patch attached

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-05-10 23:33

Message:
Logged In: YES 
user_id=1608

removed while Hans and I think of a better interface

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=341&group_id=106
From martin at oneiros.de  Fri May 13 17:07:49 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri May 13 17:07:52 2005
Subject: [NTG-pdftex] pdftex-1.21b snapshot
In-Reply-To: <20050414081040.GC2571@monty.localnet>
References: <20050414081040.GC2571@monty.localnet>
Message-ID: <20050513150749.GW3342@blau.artcom-gmbh.de>

On 2005-04-14 15:10:40 +0700, The Thanh Han wrote:
> This is a bug-fix release that has all pending patches by Hartmut. The
> png patch by Taco has also been integrated. A quick summary from NEWS
> (Martin will make them more meaningful when an official version is
> released):

I tried to. :-)

I have till now integrated everything but #334 and will upload a
new beta (tentatively called 1.30.0) on Tuesday latest.

Best regards
        Martin
-- 
                    http://www.tm.oneiros.de
From hanthethanh at myrealbox.com  Fri May 13 12:26:54 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat May 14 08:12:54 2005
Subject: [NTG-pdftex] benchmarking patch
In-Reply-To: <20050512124500.GP3342@blau.artcom-gmbh.de>
References: <E1DVvNc-0001FJ-00@sarovar.org> <42824A23.1070204@elvenkind.com>
	<20050512124500.GP3342@blau.artcom-gmbh.de>
Message-ID: <20050513102654.GC2552@monty.localnet>

On Thu, May 12, 2005 at 02:45:00PM +0200, Martin Schr?der wrote:
> On 2005-05-11 20:08:35 +0200, Taco Hoekwater wrote:
> > The just uploaded patch is much better than the original,
> 
> It's reverse, which makes applying it quite difficult. :-(
> 
> The patch seems very good, but I'll forward the idea to
> tex-implementors; this seems like a very nice extension.

sounds good. So I will leave it out for the moment.

Thanh
From hanthethanh at myrealbox.com  Fri May 13 12:23:59 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat May 14 08:22:22 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-306 ] cmap: unicode ???? is mapped to
	multiple glyphs
In-Reply-To: <E1DWFIo-0003zk-00@sarovar.org>
References: <E1DWFIo-0003zk-00@sarovar.org>
Message-ID: <20050513102359.GB2552@monty.localnet>

On Thu, May 12, 2005 at 08:38:42PM +0530, noreply@sarovar.org wrote:
> Bugs item #306, was opened at 2005-03-05 17:52
> You can respond by visiting: 
> http://sarovar.org/tracker/?func=detail&atid=493&aid=306&group_id=106
> 
> Category: Fonts
> Group: v1.21a
> Status: Open
> Resolution: None
> Priority: 5
> Submitted By: Peter Dyballa (ballapete)
> Assigned to: Hartmut Henkel (hhenkel)
> Summary: cmap: unicode ???? is mapped to multiple glyphs
> 
> Initial Comment:
> I created symlinks from the Lucida fonts that come with Java runtime 
> and I created from them TFM files with ttf2tfm version 1.5, and also a 
> map file fragment and FD files. When I access LucidaSans-Oblique 
> pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C 7.5.4) reports this:
> 
> Error: pdflatex (file /usr/local/teTeX/share/texmf.local/fonts/truetype/
> lucida/llsro8a.ttf): cmap: unicode 2010 is mapped to multiple glyphs
>  ==> Fatal error occurred, the output PDF file is not finished!
> 
> U+2010 is HYPHEN
> 
> 
> ----------------------------------------------------------------------
> 
> >Comment By: Martin Schr?der (oneiros)
> Date: 2005-05-12 17:08
> 
> Message:
> Logged In: YES 
> user_id=421
> 
> What's the state of this?

after some discussion with Werner Lemberg I changed
writettf.c to generate a warning instead of an error in such
a case. The change is in the latest snapshot Anyway, such a
font should be fixed.

Thanh
From pragma at wxs.nl  Sat May 14 08:35:49 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Sat May 14 08:35:33 2005
Subject: [NTG-pdftex] benchmarking patch
In-Reply-To: <20050513102654.GC2552@monty.localnet>
References: <E1DVvNc-0001FJ-00@sarovar.org> <42824A23.1070204@elvenkind.com>
	<20050512124500.GP3342@blau.artcom-gmbh.de>
	<20050513102654.GC2552@monty.localnet>
Message-ID: <42859C45.5080305@wxs.nl>

The Thanh Han wrote:
> On Thu, May 12, 2005 at 02:45:00PM +0200, Martin Schr?der wrote:
> 
>>On 2005-05-11 20:08:35 +0200, Taco Hoekwater wrote:
>>
>>>The just uploaded patch is much better than the original,
>>
>>It's reverse, which makes applying it quite difficult. :-(
>>
>>The patch seems very good, but I'll forward the idea to
>>tex-implementors; this seems like a very nice extension.
> 
> 
> sounds good. So I will leave it out for the moment.

i see no reason to not put it in -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Sat May 14 13:57:44 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sat May 14 13:57:48 2005
Subject: [NTG-pdftex] pdftex-1.21b snapshot
In-Reply-To: <20050513150749.GW3342@blau.artcom-gmbh.de>
References: <20050414081040.GC2571@monty.localnet>
	<20050513150749.GW3342@blau.artcom-gmbh.de>
Message-ID: <Pine.LNX.4.61.0505141353260.3699@hahepc1.hahe>

Hi Martin,

On Fri, 13 May 2005, Martin Schr?der wrote:

> I have till now integrated everything but #334 and will upload a new
> beta (tentatively called 1.30.0) on Tuesday latest.

seems Thanh is also doing some cleaning up (maybe there will be a new
version at pdftex.sarovar.org/src), please check with him...

Regards, Hartmut
From taco at elvenkind.com  Tue May 17 12:02:41 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue May 17 12:02:47 2005
Subject: [NTG-pdftex] Ugly rules in PDF 
Message-ID: <4289C141.7030806@elvenkind.com>


Hi,

After some discussion with Karl Berry on math-font-discuss:

At Bachotek2005 there was a talk about the Latin Modern fonts,
and there was a small math example included, of course. The
presentation was shown using Adobe's PDF reader, and as you
probably know, it displays the rules TeX draws for fractions
and the radical bar horribly.

The same is, in fact, true for xpdf and ghostview. The general
problem is that rendering graphics and rendering text are not
the same thing in PDF (nor PostScript), and that makes it hard
for a viewer to align the two objects correctly. Our 'problem'
is that people in general believe this is a bug in pdftex :-(

An example file is at  http://tex.aanhet.net/temp/mathtest.pdf
Especially look at the top left of the sqrt signs. The source
code is trivial:
$$\sqrt{\sqrt{\sqrt{\sqrt{\sqrt{\sqrt{x+1}}+1}+1}+1}+1}$$


I volunteered to write a patch for pdftex to try to remove the
problem by making pdftex use a repeated character instead of a
rule, but I am still a bit unsure about the best solution. Also,
I vaguely remember that possibly somebody had done something
with \radical a long time ago already, so I thought I'd ask
feedback before doing any actual coding.


Here is what I propose:

The creation of a new primitive called \mathrulechar, with
the following semantics. Adding

   \mathrulechar="0130

somewhere in the TeX source would make subsequent \radical commands
use a suitable number of repetitions of the character "30 in math
family 1 instead of the horizontal rule pdfTeX draws currently.

No additional macros are involved in the process.

(A suitable character has to be available, of course. It should be
a dash, positioned flat on top of the baseline, no sidebearings)


Greetings, Taco

From pragma at wxs.nl  Tue May 17 13:46:37 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue May 17 13:46:14 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <77761707acdefe545c6d443baf5d9951@sil.org>
References: <4289C141.7030806@elvenkind.com>
	<77761707acdefe545c6d443baf5d9951@sil.org>
Message-ID: <4289D99D.4050000@wxs.nl>

Jonathan Kew wrote:

> This way, *all* rules, not merely TeX's "math rules", get rendered 
> through the same mechanism as text characters.

maybe ok for math, but not for other purposes; rules are used for all kind of 
applications and making them characters influences cut and paste, make use in 
other applications fuzzy, introduces potential problems with draw/fill 
differences between font raterizer and graphic engine (not to speak of side 
effects due to anti aliasing, caching, shading, transparency);

so .. i prefer a math specific solution

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From noreply at sarovar.org  Tue May 17 15:01:34 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue May 17 16:26:35 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-345 ] pdftex-syntax.txt: typo in \pdfobj
Message-ID: <E1DY1hW-0001wU-00@sarovar.org>

Bugs item #345, was opened at 2005-05-17 15:01
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=345&group_id=106

Category: Documentation
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Hartmut Henkel (hhenkel)
Summary: pdftex-syntax.txt: typo in \pdfobj

Initial Comment:
Hello,

the rules for \pdfobj in
  texk/web2c/pdftexdir/pdftex-syntax.txt
are wrong:

\pdfobj <object type spec>
<object type spec> --> reserveobjnum
                     | [useobjnum <number>]
                       [<attr spec>]
                       [stream [<attr spec>]]
                       <object contents>
<object contents> --> <file spec>
                    | <general text>

The first [<attr spec>] should be removed.
Result:
...
<object type spec> --> reserveobjnum
                     | [useobjnum <number>]
                       [stream [<attr spec>]]
                       <object contents>
Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

PS: A little surprised that the file has DOS line
    endings.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=345&group_id=106
From martin at oneiros.de  Tue May 17 16:46:23 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue May 17 16:46:27 2005
Subject: [NTG-pdftex] Ugly rules in PDF
In-Reply-To: <4289C141.7030806@elvenkind.com>
References: <4289C141.7030806@elvenkind.com>
Message-ID: <20050517144623.GB3342@blau.artcom-gmbh.de>

On 2005-05-17 12:02:41 +0200, Taco Hoekwater wrote:
> (A suitable character has to be available, of course. It should be
> a dash, positioned flat on top of the baseline, no sidebearings)

Maybe line10 already has it?

Best regards
        Martin
-- 
                    http://www.tm.oneiros.de
From pragma at wxs.nl  Tue May 17 17:00:17 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue May 17 16:59:55 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <e0.13b0740b.2fbb5a6b@aol.com>
References: <e0.13b0740b.2fbb5a6b@aol.com>
Message-ID: <428A0701.3070202@wxs.nl>

WillAdams@aol.com wrote:
> I think ``horribly'' is a bit extreme.
> 
> Rules are drawn like any other filled rectangle, and can be set to be 
> anti-aliased in viewers which support that setting for graphic objects.
> 
> Using a character is an interesting idea, but has difficulties as Hans 
> noted.

get me right: replacing rules in math sounds ok to me, but not in other cases, 
which reminds me too much of slanted pictex lines built out of periods -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Tue May 17 20:23:42 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue May 17 20:23:46 2005
Subject: [NTG-pdftex] Ugly rules in PDF 
In-Reply-To: <4289C141.7030806@elvenkind.com>
References: <4289C141.7030806@elvenkind.com>
Message-ID: <Pine.LNX.4.61.0505172006250.26455@hahepc1.hahe>

Hi Taco,

On Tue, 17 May 2005, Taco Hoekwater wrote:

> After some discussion with Karl Berry on math-font-discuss:
>
> At Bachotek2005 there was a talk about the Latin Modern fonts, and
> there was a small math example included, of course. The presentation
> was shown using Adobe's PDF reader, and as you probably know, it
> displays the rules TeX draws for fractions and the radical bar
> horribly.

not to forget braces, so maybe also vertical lines are needed?

> [...]
> Here is what I propose:
>
> The creation of a new primitive called \mathrulechar, with the
> following semantics. Adding
>
>   \mathrulechar="0130
>
> somewhere in the TeX source would make subsequent \radical commands
> use a suitable number of repetitions of the character "30 in math
> family 1 instead of the horizontal rule pdfTeX draws currently.
>
> No additional macros are involved in the process.
>
> (A suitable character has to be available, of course. It should be a
> dash, positioned flat on top of the baseline, no sidebearings)

Maybe instead of these repetitions you also could use the Tz operator
together with font size scaling for stretching a single e.g. 1bp*1bp
square pad to the wanted width/height? And what if this char. even came
from an artificial one-character-only Type-1 font, produced (with proper
hinting :-) inside pdftex?

Regards, Hartmut
From reinhard.kotucha at web.de  Wed May 18 02:31:34 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed May 18 02:31:41 2005
Subject: [NTG-pdftex] Ugly rules in PDF 
In-Reply-To: <Pine.LNX.4.61.0505172006250.26455@hahepc1.hahe>
References: <4289C141.7030806@elvenkind.com>
	<Pine.LNX.4.61.0505172006250.26455@hahepc1.hahe>
Message-ID: <17034.36070.136826.951462@zarniwoop.ms25.local>

>>>>> "Hartmut" == Hartmut Henkel <hartmut_henkel@gmx.de> writes:

  >> At Bachotek2005 there was a talk about the Latin Modern fonts,
  >> and there was a small math example included, of course. The
  >> presentation was shown using Adobe's PDF reader, and as you
  >> probably know, it displays the rules TeX draws for fractions and
  >> the radical bar horribly.

  > not to forget braces, so maybe also vertical lines are needed?

There are vertical rules in Computer Modern already.  But you are
right, \underbrace looks very ugly in PDF and maybe people need normal
braces with arbitrary height.

  >> (A suitable character has to be available, of course. It should
  >> be a dash, positioned flat on top of the baseline, no
  >> sidebearings)

  > Maybe instead of these repetitions you also could use the Tz
  > operator together with font size scaling for stretching a single
  > e.g. 1bp*1bp square pad to the wanted width/height? And what if
  > this char. even came from an artificial one-character-only Type-1
  > font, produced (with proper hinting :-) inside pdftex?

That was my first thought when I saw that at BachoTeX.  It was really
horrible, the beamer had a pretty low resolution, BTW.

But what happens if \pdfoutput=0 ?

PostScript \specials are not portable.  So there are three
possibilities:

1.  An internal font is used for PDF output and a rule for dvi.

2.  An external font is used always which can be used by a dvi->ps
    converter as well.  A rule is inserted if the font is not found.

3.  An internal font is used for PDF output and a rule is inserted for
    dvi output unless an external font is found.

The latter is probably the best. 

Scaling one character is IMHO the best solution.  Hans already
mentioned PicTeX.  It might be obsolete, but for testing what Taco
proposed, it's great.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From hanthethanh at myrealbox.com  Tue May 17 10:24:11 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed May 18 04:06:53 2005
Subject: [NTG-pdftex] changes in forthcomming release
Message-ID: <20050517082411.GF2558@monty.localnet>

Hi,

I have applied most of patches and suggestions from Hartmut.
There are still a few pending issues:

1) while we are renaming some promitives to be consistent,
would it be better to change the following as well:

pdfoptionpdfminorversion -> pdfminorversion
pdfoptionalwaysusepdfpagebox -> pdfforcepagebox
pdfoptionpdfinclusionerrorlevel -> ??? 

2) what about moving everything from pdfxtex to pdftex and
remove pdfxtex?

3) should the pkmode and microinterval patches be in as
well?

Martin, can you please wait for a few days, I want to make
another snapshot this week.

Thanh
From taco at elvenkind.com  Wed May 18 06:47:27 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed May 18 06:50:24 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <yfi4qd1l3bo.fsf@triumf.ca>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
Message-ID: <428AC8DF.8000000@elvenkind.com>

Donald Arseneau wrote:
> 
> True, math mode does not have the problem of selection, but using
> characters still sounds horrible.  It *will* wind up being like
> pictex or that old sprite.sty in reverse.  

The current state is quite a lot like latex's 'picture' environment.
Of course drawing and converting the whole radical into a single
glyph on-the-fly would be best, but that's a bit too much for the
moment. Hartmut's idea of using a single scaled glyph is a dedicated
internal font is quite promising.

> The leap to characters is particularly excessive because most rule
> rendering problems can be relieved by using stroked lines instead of
> filled rectangles.  

Not this one, apparently (pdftex already outputs stroked lines).

Taco
From hartmut_henkel at gmx.de  Wed May 18 08:44:20 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed May 18 08:44:31 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428AC8DF.8000000@elvenkind.com>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca> <428AC8DF.8000000@elvenkind.com>
Message-ID: <Pine.LNX.4.61.0505180832330.3970@hahepc1.hahe>

On Wed, 18 May 2005, Taco Hoekwater wrote:

> > The leap to characters is particularly excessive because most rule
> > rendering problems can be relieved by using stroked lines instead of
> > filled rectangles.
>
> Not this one, apparently (pdftex already outputs stroked lines).

i had temporarily disabled pdftex's pdf_set_rule heuristics (everything
that has at least one dimension <= 1bp is stroked): There are no visual
differences whether it's a stroked line or a filled rectangle. It seems
that these rendering problems happen only later in the process.

Regards, Hartmut
From hartmut_henkel at gmx.de  Wed May 18 12:53:12 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed May 18 12:53:30 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <20050517082411.GF2558@monty.localnet>
References: <20050517082411.GF2558@monty.localnet>
Message-ID: <Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>

On Tue, 17 May 2005, The Thanh Han wrote:

> I have applied most of patches and suggestions from Hartmut.

these were just a few clean-up things, e. g. removing the last rest of
pdftex.cfg cfg_ stuff (integers were doubly dumped/undumped without
need), removing rest of pdfmovechars. Then in mapfile.c the map entry
error check is now a separate function to support map primitives, same
for the check for 14 standard font names (which also should be faster
now). The unknown names in "..." map entry sections are now better
reported, and a harmless uninitialized pointer is fixed.

> There are still a few pending issues:
>
> 1) while we are renaming some promitives to be consistent,
> would it be better to change the following as well:
>
> pdfoptionpdfminorversion -> pdfminorversion

i would like these shorter names, but apparently Hans is already using
this in spec-tpd.tex, so we can count it as frozen.

> pdfoptionalwaysusepdfpagebox -> pdfforcepagebox

never seen this in use anywhere. So maybe...

> pdfoptionpdfinclusionerrorlevel -> ???

used by Hans.

> 2) what about moving everything from pdfxtex to pdftex and remove
> pdfxtex?

i would prefer this

> 3) should the pkmode and microinterval patches be in as well?

a pkmode facility has been discussed by Karl. It's now a token register
so that it is dumped into the format. Makes it maybe a little tedious in
pdftexconfig.tex, as one has to assign catcodes for opening and closing
braces, but should be ok.

Microinterval will be fun, allows checking various performance things...

> Martin, can you please wait for a few days, I want to make another
> snapshot this week.

Regards, Hartmut
From martin at oneiros.de  Wed May 18 14:37:31 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed May 18 14:37:34 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>
References: <20050517082411.GF2558@monty.localnet>
	<Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>
Message-ID: <20050518123731.GA5738@blau.artcom-gmbh.de>

On 2005-05-18 12:53:12 +0200, Hartmut Henkel wrote:
> On Tue, 17 May 2005, The Thanh Han wrote:
> > There are still a few pending issues:
> >
> > 1) while we are renaming some promitives to be consistent,
> > would it be better to change the following as well:

How about keeping the old names as well, but undocumenting them
(and maybe giving a warning if they are used, i.e. deprecating
them)? 

> > pdfoptionpdfminorversion -> pdfminorversion
> 
> i would like these shorter names, but apparently Hans is already using
> this in spec-tpd.tex, so we can count it as frozen.
> 
> > pdfoptionalwaysusepdfpagebox -> pdfforcepagebox
> 
> never seen this in use anywhere. So maybe...

ArtCom uses it. But that's not my problem anymore (and they will
probably never upgrade their pdftex). :-}

> > pdfoptionpdfinclusionerrorlevel -> ???
> 
> used by Hans.

We could simply remove the "option"

> > 2) what about moving everything from pdfxtex to pdftex and remove
> > pdfxtex?

Since everybody now is using etex, there shouldn't be a problem
if tex becomes experimental. :-)

> > 3) should the pkmode and microinterval patches be in as well?
> 
> a pkmode facility has been discussed by Karl. It's now a token register
> so that it is dumped into the format. Makes it maybe a little tedious in
> pdftexconfig.tex, as one has to assign catcodes for opening and closing
> braces, but should be ok.
> 
> Microinterval will be fun, allows checking various performance things...

Put them both in.

Best regards
        Martin
-- 
                    http://www.tm.oneiros.de
From taco at elvenkind.com  Wed May 18 15:34:57 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed May 18 15:35:00 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <20050518123731.GA5738@blau.artcom-gmbh.de>
References: <20050517082411.GF2558@monty.localnet>	<Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>
	<20050518123731.GA5738@blau.artcom-gmbh.de>
Message-ID: <428B4481.7020800@elvenkind.com>



Hi,

>>>pdfoptionpdfminorversion -> pdfminorversion
>>
>>i would like these shorter names, but apparently Hans is already using
>>this in spec-tpd.tex, so we can count it as frozen.
>>

I have a number of documents that use \pdfoptionpdfminorversion,
mainly because the release of AR7/Linux took so long, but also
to suppress the warnings when including stuff from Distiller.
So I prefer a 'deprecated' message instead of actual removal,
at least for the next year (or so).

>>>2) what about moving everything from pdfxtex to pdftex and remove
>>>pdfxtex?
> 
> Since everybody now is using etex, there shouldn't be a problem
> if tex becomes experimental. :-)

Sounds good.

Taco
From pragma at wxs.nl  Wed May 18 15:54:25 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 15:54:12 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>
References: <20050517082411.GF2558@monty.localnet>
	<Pine.LNX.4.61.0505181240180.3862@hahepc1.hahe>
Message-ID: <428B4911.2020807@wxs.nl>

Hartmut Henkel wrote:

>>pdfoptionpdfinclusionerrorlevel -> ???
> 
> 
> used by Hans.

indeed

i like the idea of keeping it for one year with obsolete message

that should be enough to let users update

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 18 08:38:32 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 15:55:56 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <20050517082411.GF2558@monty.localnet>
References: <20050517082411.GF2558@monty.localnet>
Message-ID: <428AE2E8.6080508@wxs.nl>

The Thanh Han wrote:

> 2) what about moving everything from pdfxtex to pdftex and
> remove pdfxtex?

ok for me

> 3) should the pkmode and microinterval patches be in as
> well?

indeed, also, taco will make a \noligatures\font patch (this is needed because 
for instance in the popular ec (cork) encoding monospaced fonts have some ligs 
and therefore verbatim is hacky

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 18 09:27:27 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 15:55:58 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428AC8DF.8000000@elvenkind.com>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca> <428AC8DF.8000000@elvenkind.com>
Message-ID: <428AEE5F.9090808@wxs.nl>

Taco Hoekwater wrote:
>> The leap to characters is particularly excessive because most rule
>> rendering problems can be relieved by using stroked lines instead of
>> filled rectangles.  
> 

> Not this one, apparently (pdftex already outputs stroked lines).

fyi: there has been rendering problems with acrobat rules from the start, and 
pdftex has been adapted in the past to this: first rectangles, later lines or 
rectangles, depending on the size (there was/is a threshold); we did lot sof 
experiments (random rules, increasing steps, viewing, printing; i must have the 
test file somewhere on the attic)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 18 09:29:50 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 15:57:42 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428AC8DF.8000000@elvenkind.com>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca> <428AC8DF.8000000@elvenkind.com>
Message-ID: <428AEEEE.6030100@wxs.nl>

Taco Hoekwater wrote:

> moment. Hartmut's idea of using a single scaled glyph is a dedicated
> internal font is quite promising.

a very cute idea indeed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 18 16:01:54 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 16:01:30 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <17034.64171.148206.220114@fell.open.ac.uk>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
	<17034.64171.148206.220114@fell.open.ac.uk>
Message-ID: <428B4AD2.90205@wxs.nl>

Chris Rowley wrote:

> Are we talking about rendering pdf here?  Or rendering postcript?  
> 
> These are not the same (in general), especially when dealing with
> `rule-like objects'.
> 
> To put it another way: pdf is far from device-independent:; this is an
> empirical fact that I have lived with for the last 5 years.

it's just rendering pdf on the screen, for which adobe seems to implement 
different strategies each time (going back between old and new variants and 
such, either or not being influenced by anti-aliasing, cooltype, transparency 
correction, under/overprint, colorspaces etc); in print there are no problems 
(unless one uses a 96-144 dpi printer);

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed May 18 16:17:42 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed May 18 16:17:45 2005
Subject: [NTG-pdftex] changes in forthcomming release
In-Reply-To: <428AE2E8.6080508@wxs.nl>
References: <20050517082411.GF2558@monty.localnet> <428AE2E8.6080508@wxs.nl>
Message-ID: <428B4E86.3040503@elvenkind.com>



Hans Hagen wrote:
> 
> indeed, also, taco will make a \noligatures\font patch (this is needed 

I will wait until the dust has settled. ;-)

From pragma at wxs.nl  Wed May 18 20:04:43 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 18 20:04:21 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <17035.19328.605118.559039@fell.open.ac.uk>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
	<17034.64171.148206.220114@fell.open.ac.uk> <428B4AD2.90205@wxs.nl>
	<17035.19328.605118.559039@fell.open.ac.uk>
Message-ID: <428B83BB.7030301@wxs.nl>

Chris Rowley wrote:

> Oh well, I never expect to see anything reasonable from maths on
> screen (and I spend a lot of time staring at just that right now as i
> am busy editing loads of it!).

i hope fo ryou that in that case they gave you a 1920x1200 screen to work with 
since i'm not that sure if a ten-deep-nested root on a 80 char width page is 
that readable at all on the average screen

> But I agree that missing fraction bars can be a nightmare, especially
> in combinatorial number theory:-)

in that case, i think that they are never missing, but just taking 15 pixels 
width instead of a few (ok, by making that rule transparent you can see through 
and still see the numbers that it covers -)

> and then there is everyone else's stategies!!

lucky you that everyone is using tex for math, which is still better than 
staring at some presentation mathml rendered in a browser using funny symbols, 
scaling etc

maybe, just as math visualization was adapted to paper / print, you need to 
adapt it for the screen /pdf; could be a nice talk of you for some tex 
conference: the New Math Visualization project (i bet that the EU will fund it 
esp when you mention that it serves the big ones like MS and Adobe)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From WillAdams at aol.com  Tue May 17 16:32:11 2005
From: WillAdams at aol.com (WillAdams@aol.com)
Date: Wed May 18 20:04:59 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
Message-ID: <e0.13b0740b.2fbb5a6b@aol.com>

I think ``horribly'' is a bit extreme.

Rules are drawn like any other filled rectangle, and can be set to be 
anti-aliased in viewers which support that setting for graphic objects.

Using a character is an interesting idea, but has difficulties as Hans noted.

Just replacing it w/ a stroked line would be an alternative worth considering 
IMO.

William
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050517/27f46013/attachment.html
From asnd at triumf.ca  Wed May 18 03:39:55 2005
From: asnd at triumf.ca (Donald Arseneau)
Date: Wed May 18 20:05:00 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428A0701.3070202@wxs.nl>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
Message-ID: <yfi4qd1l3bo.fsf@triumf.ca>

Hans Hagen <pragma@wxs.nl> writes:

> WillAdams@aol.com wrote:
> > I think ``horribly'' is a bit extreme.
> > Rules are drawn like any other filled rectangle, and can be set to be
> > anti-aliased in viewers which support that setting for graphic objects.
> > Using a character is an interesting idea, but has difficulties as Hans
> > noted.
> 
> get me right: replacing rules in math sounds ok to me, but not in other
> cases, which reminds me too much of slanted pictex lines built out of periods

True, math mode does not have the problem of selection, but using
characters still sounds horrible.  It *will* wind up being like
pictex or that old sprite.sty in reverse.  

The leap to characters is particularly excessive because most rule
rendering problems can be relieved by using stroked lines instead of
filled rectangles.  Add a few heuristics of height/width and you are
set.


-- 
Donald Arseneau                          asnd@triumf.ca

From C.A.Rowley at open.ac.uk  Wed May 18 10:19:55 2005
From: C.A.Rowley at open.ac.uk (Chris Rowley)
Date: Wed May 18 20:05:17 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <yfi4qd1l3bo.fsf@triumf.ca>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
Message-ID: <17034.64171.148206.220114@fell.open.ac.uk>


> > WillAdams@aol.com wrote:
> > > I think ``horribly'' is a bit extreme.
> > > Rules are drawn like any other filled rectangle, and can be set to be
> > > anti-aliased in viewers which support that setting for graphic objects.
> > > Using a character is an interesting idea, but has difficulties as Hans
> > > noted.
> > 

Donald Arseneau wrote --

> 
> The leap to characters is particularly excessive because most rule
> rendering problems can be relieved by using stroked lines instead of
> filled rectangles.  Add a few heuristics of height/width and you are
> set.
> 

Are we talking about rendering pdf here?  Or rendering postcript?  

These are not the same (in general), especially when dealing with
`rule-like objects'.

To put it another way: pdf is far from device-independent:; this is an
empirical fact that I have lived with for the last 5 years.


chris

From C.A.Rowley at open.ac.uk  Wed May 18 10:24:47 2005
From: C.A.Rowley at open.ac.uk (Chris Rowley)
Date: Wed May 18 20:05:18 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <Pine.LNX.4.61.0505180832330.3970@hahepc1.hahe>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca> <428AC8DF.8000000@elvenkind.com>
	<Pine.LNX.4.61.0505180832330.3970@hahepc1.hahe>
Message-ID: <17034.64463.104105.489089@fell.open.ac.uk>

Hartmut Henkel wrote --

> It seems
> that these rendering problems happen only later in the process.
>

That is a simple way of saying what I was trying to explain...

You cannot deduce from the specification of a graphics object in a pdf
file how it will be rendered; this will differ from device to device.


chris
From C.A.Rowley at open.ac.uk  Wed May 18 16:04:48 2005
From: C.A.Rowley at open.ac.uk (Chris Rowley)
Date: Wed May 18 20:05:18 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428B4AD2.90205@wxs.nl>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
	<17034.64171.148206.220114@fell.open.ac.uk> <428B4AD2.90205@wxs.nl>
Message-ID: <17035.19328.605118.559039@fell.open.ac.uk>

Hans

> it's just rendering pdf on the screen,

Oh well, I never expect to see anything reasonable from maths on
screen (and I spend a lot of time staring at just that right now as i
am busy editing loads of it!).

For us, there are far bigger problems with pdf for maths: no
searching, no `screen readers', no `reflowing', ...

But I agree that missing fraction bars can be a nightmare, especially
in combinatorial number theory:-)

> for which adobe seems to implement 
> different strategies each time

and then there is everyone else's stategies!!

chris

> (unless one uses a 96-144 dpi printer);

So 145 dpi is OK?:-)




(going back between old and new variants and 
> such, either or not being influenced by anti-aliasing, cooltype, transparency 
> correction, under/overprint, colorspaces etc); in print there are no problems 

> 
> Hans
> 
> -----------------------------------------------------------------
>                                            Hans Hagen | PRAGMA ADE
>                Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>       tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                               | www.pragma-pod.nl
> -----------------------------------------------------------------
> 
> 
From pragma at wxs.nl  Thu May 19 09:32:05 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu May 19 09:31:44 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <194.3f280969.2fbd4ccc@aol.com>
References: <194.3f280969.2fbd4ccc@aol.com>
Message-ID: <428C40F5.9070102@wxs.nl>

WillAdams@aol.com wrote:

> re-examination). At some magnifications things are about identical, at 
> others one gets a double-pixel medium grey line, and the other gets a 
> single-pixel dark grey line. Hopefully at some point in time we'll just 

ah, thanks for confirming that, because i noticed something like that here too

of course we can complain a lot about the rendering, but on low res screens it's 
a tricky issue and on average the pdf files look ok; around acrobat 3, 
ghostscript did the best rendering (esp graphics due to anti aliasing), but 
nowadays acrobat does a better job;

one thing i noticed is that on a high res screen rounding can be multiple pixels 
off (the cover page of the 'extreme' manual on our web site is a good 
demonstration); when i submitted a screen dump (1600x1200) to the beta group of 
adobe a few versions back, they told met that that it didn;t happen at their 
site; maybe the developers only use low res screens -)

(btw, having too big rules is not that unfamiliar to me since we started using 
tex on 150 dpi printers and at that time everything tex looked bold; when we gto 
high res printers at frst i thought that there was something wrong with the now 
thinner results)


Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 18 20:55:32 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu May 19 09:32:12 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <yfi4qd1l3bo.fsf@triumf.ca>
References: <e0.13b0740b.2fbb5a6b@aol.com> <428A0701.3070202@wxs.nl>
	<yfi4qd1l3bo.fsf@triumf.ca>
Message-ID: <428B8FA4.2020008@wxs.nl>

Donald Arseneau wrote:
> Hans Hagen <pragma@wxs.nl> writes:
> 
> 
>>WillAdams@aol.com wrote:
>>
>>>I think ``horribly'' is a bit extreme.
>>>Rules are drawn like any other filled rectangle, and can be set to be
>>>anti-aliased in viewers which support that setting for graphic objects.
>>>Using a character is an interesting idea, but has difficulties as Hans
>>>noted.
>>
>>get me right: replacing rules in math sounds ok to me, but not in other
>>cases, which reminds me too much of slanted pictex lines built out of periods
>  
> True, math mode does not have the problem of selection, but using
> characters still sounds horrible.  It *will* wind up being like
> pictex or that old sprite.sty in reverse.  
> 
> The leap to characters is particularly excessive because most rule
> rendering problems can be relieved by using stroked lines instead of
> filled rectangles.  Add a few heuristics of height/width and you are
> set.

nevertheless hartmuts suggestion to use a special built in rule char (type 1) 
and scale that horizontally or vertically makes sense since it then is rendered 
using the cooltype engine and proper hinting / antialiasing is done; in that 
case we have just one char for the horizontal bar in a root symbol (which itself 
is not much different than a bunch of strokes); it's a bit the best of both worlds

i wonder how complicated it is to implement something like that so that we can 
see the results; i attached a sample file, the second line uses a scaled hyphen; 
i wonder how it renders different on low res screens (don't have one connected now)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 40001 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050518/e10fcc2a/test-0001.pdf
From WillAdams at aol.com  Thu May 19 03:58:36 2005
From: WillAdams at aol.com (WillAdams@aol.com)
Date: Thu May 19 09:32:38 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
Message-ID: <194.3f280969.2fbd4ccc@aol.com>

In a message dated 5/18/05 12:51:05 AM, taco@elvenkind.com writes:

> Not this one, apparently (pdftex already outputs stroked lines).
> 
Interesting. I'd not noticed that. There's some interesting discussion of it 
in comp.text.tex ~1999, w/ one of the observations being that using stroked 
lines improves 300dpi output.

FWIW, if one turns on ``Smooth line art'' in Adobe Acrobat 5 (probably 6 and 
7 too) there's not that much difference in the appearance of the rendering of 
the square root rule / character in Hans' example file (which is hinted at in 
the afore-mentioned discussion, and noted by Hans in a post on the ConTeXt 
list as making this matter worth re-examination). At some magnifications things 
are about identical, at others one gets a double-pixel medium grey line, and 
the other gets a single-pixel dark grey line. Hopefully at some point in time 
we'll just get high-resolution displays everywhere and this sort of thing will 
cease to be an issue.

Isn't there a Unicode slot for fraction bar (I know the Mac encoding has a 
slot for fraction slash)?

How is this handled in the soon-to-be-released stix fonts? 
(http://www.stixfonts.org)

William
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050518/712f46b9/attachment.html
From C.A.Rowley at open.ac.uk  Thu May 19 10:08:19 2005
From: C.A.Rowley at open.ac.uk (Chris Rowley)
Date: Thu May 19 10:16:30 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <428C40F5.9070102@wxs.nl>
References: <194.3f280969.2fbd4ccc@aol.com> <428C40F5.9070102@wxs.nl>
Message-ID: <17036.18803.566755.389973@fell.open.ac.uk>

Hans

> 
> one thing i noticed is that on a high res screen rounding can be multiple pixels 
> off (the cover page of the 'extreme' manual on our web site is a good 
> demonstration);

That sounds as if the pdf renderer does not know the exact resolution
it is targeting; thus perhaps it assumes `for screen' == `<150dpi' so tries
to optimise for that.


chris

From hanthethanh at myrealbox.com  Fri May 20 10:08:31 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri May 20 12:15:05 2005
Subject: [NTG-pdftex] problem with autoconf
Message-ID: <20050520080831.GA2565@monty.localnet>

Hi,

having removed pdfxtex from the sources I tried to rerun
autoconf to re-create the configure scripts. I am using
debian sarge and got the following error:

,--------
| autoconf: invalid option -m
`--------

I looked into the manpage and tried to replace '-m' by '-B',
then '-I'

Then I got some error with the pb_AC_ASM_UNDERSCORE macro.
Searched using google showed that Sebastian Rahtz had the
same problem and was not very successful to get it work.

Then I uncommented out in texk/etc/autoconf/acsite.m4 the line 

,--------
| undefine([pb_AC_ASM_UNDERSCORE])
`--------

and was able to go a little bit further:

,--------
| $sh reautoconf 
| .
| configure.in:222: warning: AC_CONFIG_SUBDIRS: you should use literals
| autoconf/status.m4:1078: AC_CONFIG_SUBDIRS is expanded from...
| configure.in:222: the top level
| /home/thanh/pdftex/src/thanh/libs
| libs
| configure.in:53: warning: AC_CONFIG_SUBDIRS: you should use literals
| autoconf/status.m4:1078: AC_CONFIG_SUBDIRS is expanded from...
| configure.in:53: the top level
| /home/thanh/pdftex/src/thanh/texk
| texk
| configure.in:61: warning: AC_CONFIG_SUBDIRS: you should use literals
| autoconf/status.m4:1078: AC_CONFIG_SUBDIRS is expanded from...
| configure.in:61: the top level
| /home/thanh/pdftex/src/thanh/libs/xpdf
| libs/xpdf
| /home/thanh/pdftex/src/thanh/texk/dvipsk
| texk/dvipsk
| /home/thanh/pdftex/src/thanh/texk/kpathsea
| texk/kpathsea
| /home/thanh/pdftex/src/thanh/texk/web2c
| texk/web2c
| configure.in:47: warning: AC_PROG_LEX invoked multiple times
| autoconf/programs.m4:438: AC_DECL_YYTEXT is expanded from...
| configure.in:47: the top level
`--------

But when I tried to run configure from the top level I got:

/home/thanh/pdftex/src/thanh/configure: line 6971: syntax error: unexpected end of file

I have to say what Sebastian wrote in his mail:

,--------
| 
| I think I just hate computers!
| 
`--------

Please, any ideas what I should try next?


Thanh
From hanthethanh at myrealbox.com  Fri May 20 12:19:05 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri May 20 12:19:34 2005
Subject: [NTG-pdftex] new pdftex snapshot
Message-ID: <20050520101905.GA2685@monty.localnet>

Hi,

I have uploaded a new pdftex snapshot to
pdftex.sarovar.org/src

djgpp is also available (pdfetex only)

I didn't change the version and banner, as Martin will
decide what to be there when he makes an official release.

Now I recognize that I forgot the  microinterval patch from
Taco. Sorry about that, will upload another one tomorrow

Thanh
From tipogral at freemail.hu  Fri May 20 12:28:12 2005
From: tipogral at freemail.hu (Nagy Bence)
Date: Fri May 20 12:28:31 2005
Subject: [NTG-pdftex] New Didot-point
Message-ID: <20050520122812.1b04bf9b@localhost>

Dear All,

I have a new tipometer now, and I wondered, that by Rotring Didot-point
is no more 0,376 but 0,375 mm. Actually the new Didot-size is more
komfortable, because one Cicero is exactly equal to 4,5 mm, two Cicero
to 9 mm.

I have attached a small patch, which introduces two new units: nd (new
didot) and nc (new cicero). Maybe we have to follow the sounds of new
times. Any comments?

Greetings, Bence

-- 
Nagy Bence | Tipogr?l.hu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 01-newdidot.patch
Type: application/octet-stream
Size: 1092 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050520/4dfbf9ab/01-newdidot.obj
From pragma at wxs.nl  Fri May 20 12:38:40 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri May 20 12:38:14 2005
Subject: [NTG-pdftex] problem with autoconf
In-Reply-To: <20050520080831.GA2565@monty.localnet>
References: <20050520080831.GA2565@monty.localnet>
Message-ID: <428DBE30.8060005@wxs.nl>

The Thanh Han wrote:

> having removed pdfxtex from the sources I tried to rerun
> autoconf to re-create the configure scripts. I am using
> debian sarge and got the following error:

> ,--------
> | 
> | I think I just hate computers!
> | 
> `--------
> 
> Please, any ideas what I should try next?

getting rid of autoconf (if i remember right it's one of the reasons why fabrice 
disliked the source tree)

- merge all tex etex and pdftex code
- simplify teh source tree

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Fri May 20 12:48:12 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri May 20 12:51:14 2005
Subject: [NTG-pdftex] problem with autoconf
In-Reply-To: <428DBE30.8060005@wxs.nl>
References: <20050520080831.GA2565@monty.localnet> <428DBE30.8060005@wxs.nl>
Message-ID: <428DC06C.5080109@elvenkind.com>

Hans Hagen wrote:
> The Thanh Han wrote:
> 
>> having removed pdfxtex from the sources I tried to rerun
>> autoconf to re-create the configure scripts. I am using
>> debian sarge and got the following error:
> 
> 
>> ,--------
>> | | I think I just hate computers!
>> | `--------
>>
>> Please, any ideas what I should try next?
> 
> 
> getting rid of autoconf (if i remember right it's one of the reasons why 
> fabrice disliked the source tree)

I doubt that that is feasible while the pdftex source is still a
part of tex-live. I try to stay away from autoconf myself, so I'm
afraid I cannot offer any help. Perhaps Olaf or Karl knows what to
do?

Taco

From taco at elvenkind.com  Fri May 20 12:54:28 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri May 20 12:57:29 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <20050520122812.1b04bf9b@localhost>
References: <20050520122812.1b04bf9b@localhost>
Message-ID: <428DC1E4.4090401@elvenkind.com>



Nagy Bence wrote:
> I have attached a small patch, which introduces two new units: nd (new
> didot) and nc (new cicero). Maybe we have to follow the sounds of new
> times. Any comments?

I happily support any unit that uses a unique two letter
identifier (there is already a "px" in pdfxtex: 96px=1in).

Taco
From pragma at wxs.nl  Fri May 20 13:30:30 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri May 20 13:30:17 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <428DC1E4.4090401@elvenkind.com>
References: <20050520122812.1b04bf9b@localhost>
	<428DC1E4.4090401@elvenkind.com>
Message-ID: <428DCA56.3080006@wxs.nl>

Taco Hoekwater wrote:
> 
> 
> Nagy Bence wrote:
> 
>> I have attached a small patch, which introduces two new units: nd (new
>> didot) and nc (new cicero). Maybe we have to follow the sounds of new
>> times. Any comments?
> 
> 
> I happily support any unit that uses a unique two letter
> identifier (there is already a "px" in pdfxtex: 96px=1in).

nd and nc sound ok to me

(btw, what happened to the 10% (% being letter))

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Fri May 20 19:16:48 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 20 19:17:01 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <20050520122812.1b04bf9b@localhost>
References: <20050520122812.1b04bf9b@localhost>
Message-ID: <Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>

On Fri, 20 May 2005, Nagy Bence wrote:

> I have a new tipometer now, and I wondered, that by Rotring
> Didot-point is no more 0,376 but 0,375 mm. Actually the new Didot-size
> is more komfortable, because one Cicero is exactly equal to 4,5 mm,
> two Cicero to 9 mm.
>
> I have attached a small patch, which introduces two new units: nd (new
> didot) and nc (new cicero). Maybe we have to follow the sounds of new
> times. Any comments?

Interesting! Found a reference to this also in Forssmann's
"Lesetypographie" on p. 81 (new Didot point has been standardized in
1978).

It seems that the quotient 1238/1160 can still be improved, see the q&d
awk program:

BEGIN{
for (i=1;i<5000;i++){
 j=i*25.4/72.27/0.375
 jj = int(j+0.5);
 x = jj - j;
 n = i*25.4/72.27/jj
 printf("%4d %4d %14.8f %14.8f\n", i,jj,n,x)
if(x<0) x*=-1
if (x<0.0001)
  print "====================="
}
}

which tells 685/642 --> 0.37499995mm

Regards, Hartmut
From pragma at wxs.nl  Fri May 20 19:40:44 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri May 20 19:40:30 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>
References: <20050520122812.1b04bf9b@localhost>
	<Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>
Message-ID: <428E211C.90104@wxs.nl>

Hartmut Henkel wrote:

> Interesting! Found a reference to this also in Forssmann's
> "Lesetypographie" on p. 81 (new Didot point has been standardized in
> 1978).

ah, that makes the current implementation a bug -)

btw, similar rounding situations occur with A values:

   4*width(A7) <> height(A4)


Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From tipogral at freemail.hu  Fri May 20 19:45:59 2005
From: tipogral at freemail.hu (Nagy Bence)
Date: Fri May 20 19:46:19 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>
References: <20050520122812.1b04bf9b@localhost>
	<Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>
Message-ID: <20050520194559.15aff197@localhost>

Dear Hartmut,

> Interesting! Found a reference to this also in Forssmann's
> "Lesetypographie" on p. 81 (new Didot point has been standardized in
> 1978).

I never heard about this unit before I got the new typometer. There is no
one hungarian book about typography (written after 1990), which contains information about
the new Didot-point.

> which tells 685/642 --> 0.37499995mm

Nice work! Don't you mean, it can be introduced with your quotient in the next release?

Greetings, Bence

-- 
Nagy Bence | Tipogr?l.hu
From hartmut_henkel at gmx.de  Fri May 20 21:20:56 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 20 21:20:59 2005
Subject: [NTG-pdftex] New Didot-point
In-Reply-To: <428E211C.90104@wxs.nl>
References: <20050520122812.1b04bf9b@localhost>
	<Pine.LNX.4.61.0505201911220.4326@hahepc1.hahe>
	<428E211C.90104@wxs.nl>
Message-ID: <Pine.LNX.4.61.0505202055270.3893@hahepc1.hahe>

On Fri, 20 May 2005, Hans Hagen wrote:

> > Interesting! Found a reference to this also in Forssmann's
> > "Lesetypographie" on p. 81 (new Didot point has been standardized in

ooops, it was the "Detailtypografie" (Forssmann and de Jong).

> > 1978).
>
> ah, that makes the current implementation a bug -)

:-) interesting that Knuth still chose the old definition

> btw, similar rounding situations occur with A values:
>
>   4*width(A7) <> height(A4)

this one isn't caused by TeX; it's defined by the ISO standard, which
tells to calculate A1, A2,... by repeated division from A0, and after
each division one has to round to the next lower integer (floor). So all
these A* dimensions do _not_ fit together already by the standard (which
is IMHO a pity; one can't put a nice sqrt(2) formula on the whiteboard
telling that A* paper sizes are strictly following this beautiful
principle).

Regards, Hartmut
From hartmut_henkel at gmx.de  Fri May 20 22:46:31 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 20 22:46:34 2005
Subject: [NTG-pdftex] pdftex-20050520 snapshot zlib problem
Message-ID: <Pine.LNX.4.61.0505202243160.822@hahepc1.hahe>

when putting it into the 1.21a, i get here:

Error: pdfetex: zlib: deflateInit() failed
 ==> Fatal error occurred, the output PDF file is not finished!

Anybody else? checking...

Regards, Hartmut
From hartmut_henkel at gmx.de  Sat May 21 00:24:33 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sat May 21 00:24:37 2005
Subject: [NTG-pdftex] pdftex-20050520 snapshot zlib problem
In-Reply-To: <Pine.LNX.4.61.0505202243160.822@hahepc1.hahe>
References: <Pine.LNX.4.61.0505202243160.822@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0505210022040.17312@hahepc1.hahe>

Hi Thanh,

On Fri, 20 May 2005, Hartmut Henkel wrote:

> when putting it into the 1.21a, i get here:
>
> Error: pdfetex: zlib: deflateInit() failed
>  ==> Fatal error occurred, the output PDF file is not finished!

in writezip.c, brackets are missing after getpdfcompresslevel at 3
places. Please write getpdfcompresslevel().

Regards, Hartmut
From hartmut_henkel at gmx.de  Sat May 21 02:02:53 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sat May 21 02:02:56 2005
Subject: [NTG-pdftex] pdftex-20050520 pdfcompresslevel
In-Reply-To: <Pine.LNX.4.61.0505210022040.17312@hahepc1.hahe>
References: <Pine.LNX.4.61.0505202243160.822@hahepc1.hahe>
	<Pine.LNX.4.61.0505210022040.17312@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0505210157400.4815@hahepc1.hahe>

Hi Thanh,

just found that you have implemented a new feature: Seems the
pdfcompresslevel is not set and frozen any more at document start.
Instead it can be changed within the document, so that some parts can be
compressed, others left uncompressed; it's checked at any stream start
:-)

Regards, Hartmut
From kakuto at fsci.fuk.kindai.ac.jp  Mon May 23 15:07:03 2005
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Mon May 23 15:07:15 2005
Subject: [NTG-pdftex] new pdftex snapshot
Message-ID: <200505231307.j4ND74Dr023867@jupiter.fsci.fuk.kindai.ac.jp>

Thanks for the new snapshot.
The following is Heiko's "null string" patch.
Binary header is also added.

best,
Akira


--- pdftex.ch.orig	Fri May 20 18:32:32 2005
+++ pdftex.ch	Mon May 23 21:50:44 2005
@@ -884,7 +884,13 @@
 pdf_buf[6] := ".";
 pdf_buf[7] := "4";
 pdf_buf[8] := pdf_new_line_char;
-pdf_ptr := 9;
+pdf_buf[9] := "%";
+pdf_buf[10] := 228;
+pdf_buf[11] := 240;
+pdf_buf[12] := 237;
+pdf_buf[13] := 248;
+pdf_buf[14] := pdf_new_line_char;
+pdf_ptr := 15;
 pdf_gone := 0;
 zip_write_state := no_zip;
 pdf_minor_version_written := false;
@@ -2018,8 +2024,10 @@
 begin
     i := str_start[s];
     j := i + length(s) - 1;
-    if (i > j) then
+    if (i > j) then begin
+        pdf_print("()");
         return; {null string}
+    end;
     if (str_pool[i] = '(') and (str_pool[j] = ')') then begin
         pdf_print(s);
         return;
From hartmut_henkel at gmx.de  Mon May 23 19:51:58 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon May 23 19:51:58 2005
Subject: [NTG-pdftex] new pdftex snapshot
In-Reply-To: <200505231307.j4ND74Dr023867@jupiter.fsci.fuk.kindai.ac.jp>
References: <200505231307.j4ND74Dr023867@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>

Hi Akira,

On Mon, 23 May 2005, Akira Kakuto wrote:

> Binary header is also added.

> +pdf_buf[9] := "%";
> +pdf_buf[10] := 228;
> +pdf_buf[11] := 240;
> +pdf_buf[12] := 237;
> +pdf_buf[13] := 248;
> +pdf_buf[14] := pdf_new_line_char;

i wonder what's special with particularily these numbers (other than
they have their 7th bit set)? Is it a special check pattern? The PDF
reference doesn't specify them in detail.

11100100
11110000
11101101
11111000

If i subtract 128, i get "dpmx". Any secret message? :-)

Regards, Hartmut
From martin at oneiros.de  Mon May 23 21:24:09 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon May 23 23:03:23 2005
Subject: [NTG-pdftex] new pdftex snapshot
In-Reply-To: <Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>
References: <200505231307.j4ND74Dr023867@jupiter.fsci.fuk.kindai.ac.jp>
	<Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>
Message-ID: <20050523192409.GC11369@lucien.kn-bremen.de>

On 2005-05-23 19:51:58 +0200, Hartmut Henkel wrote:
> On Mon, 23 May 2005, Akira Kakuto wrote:
> > Binary header is also added.
> 
> > +pdf_buf[9] := "%";
> > +pdf_buf[10] := 228;
> > +pdf_buf[11] := 240;
> > +pdf_buf[12] := 237;
> > +pdf_buf[13] := 248;
> > +pdf_buf[14] := pdf_new_line_char;
> 
> i wonder what's special with particularily these numbers (other than
> they have their 7th bit set)? Is it a special check pattern? The PDF

PDF reference, section 3.4.1: The body of binary PDFs should
start with at least 4 characters >128.

Akira, why these?

Best regards
    Martin
-- 
                    http://www.tm.oneiros.de
From kakuto at fsci.fuk.kindai.ac.jp  Mon May 23 23:53:25 2005
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Mon May 23 23:53:48 2005
Subject: [NTG-pdftex] new pdftex snapshot
In-Reply-To: Your message of "Mon, 23 May 2005 19:51:58 +0200 (CEST)"
References: <Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>
Message-ID: <200505232153.j4NLrRX2025477@jupiter.fsci.fuk.kindai.ac.jp>

> On Mon, 23 May 2005, Akira Kakuto wrote:
> 
> > Binary header is also added.
> 
> > +pdf_buf[9] := "%";
> > +pdf_buf[10] := 228;
> > +pdf_buf[11] := 240;
> > +pdf_buf[12] := 237;
> > +pdf_buf[13] := 248;
> > +pdf_buf[14] := pdf_new_line_char;
> 
> i wonder what's special with particularily these numbers (other than
> they have their 7th bit set)? Is it a special check pattern? The PDF
> reference doesn't specify them in detail.
> 
> 11100100
> 11110000
> 11101101
> 11111000
> 
> If i subtract 128, i get "dpmx". Any secret message? :-)

I copied them from dvipdfmx. I didn't know the hidden message.
Sorry for that. Please choose the other suitable numbers.

best regards,
Akira
From hartmut_henkel at gmx.de  Tue May 24 01:29:06 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue May 24 01:29:31 2005
Subject: [NTG-pdftex] new pdftex snapshot
In-Reply-To: <200505232153.j4NLrRX2025477@jupiter.fsci.fuk.kindai.ac.jp>
References: <Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>
	<200505232153.j4NLrRX2025477@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <Pine.LNX.4.61.0505240108290.7598@hahepc1.hahe>

Hi Akira,

On Tue, 24 May 2005, Akira Kakuto wrote:

> > If i subtract 128, i get "dpmx". Any secret message? :-)
>
> I copied them from dvipdfmx. I didn't know the hidden message. Sorry
> for that. Please choose the other suitable numbers.

don't mind (still ROTFL) i didn't guess at all what the "message" of
"dpmx" would be. But maybe then we can use one of these:

p 240 11110000
t 244 11110100
e 229 11100101
x 248 11111000

p 240 11110000
T 212 11010100
e 229 11100101
X 216 11011000

P 208 11010000
T 212 11010100
e 229 11100101
X 216 11011000

P 208 11010000
T 212 11010100
E 197 11000101
X 216 11011000

Maybe the last one 208, 212, 197, 216 is the favorite as this is the
string registered by Hans with Adobe? Thanh, pick your choice :-)

And we will need a special trick to print the title page of the pdftex
manual then :-)

Regards, Hartmut
From hanthethanh at myrealbox.com  Tue May 24 08:41:43 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Tue May 24 10:20:37 2005
Subject: [NTG-pdftex] problem with autoconf
In-Reply-To: <428DC06C.5080109@elvenkind.com>
References: <20050520080831.GA2565@monty.localnet> <428DBE30.8060005@wxs.nl>
	<428DC06C.5080109@elvenkind.com>
Message-ID: <20050524064143.GC2556@monty.localnet>

On Fri, May 20, 2005 at 12:48:12PM +0200, Taco Hoekwater wrote:
> Hans Hagen wrote:
> >The Thanh Han wrote:
> >
> >>having removed pdfxtex from the sources I tried to rerun
> >>autoconf to re-create the configure scripts. I am using
> >>debian sarge and got the following error:
> >
> >
> >>,--------
> >>| | I think I just hate computers!
> >>| `--------
> >>
> >>Please, any ideas what I should try next?
> >
> >
> >getting rid of autoconf (if i remember right it's one of the reasons why 
> >fabrice disliked the source tree)
> 
> I doubt that that is feasible while the pdftex source is still a
> part of tex-live. I try to stay away from autoconf myself, so I'm
> afraid I cannot offer any help. Perhaps Olaf or Karl knows what to
> do?

what I did for the moment is to leave the configure.in
and configure scripts untouched, until some expert fixes it.

Thanh
From hanthethanh at myrealbox.com  Tue May 24 10:22:45 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Tue May 24 10:38:01 2005
Subject: [NTG-pdftex] pdftex snapshot
Message-ID: <20050524082244.GA2636@monty.localnet>

Hi,

I uploaded another pdftex snapshot. Changes:

,--------
| - patch 335 by Heiko
|  
| - the new didot patch by Bence
| 
| - various cleaning-up patches from Hartmut
| 
| - mapfile.c improved by Hartmut
| 
| - pdfpkmode patch by Hartmut
| 
| - microinterval patch by Taco
| 
| - renamed some primitives:
|     pdfoptionpdfminorversion -> pdfminorversion
|     pdfoptionalwaysusepdfpagebox -> pdfforcepagebox
|     pdfoptionpdfinclusionerrorlevel -> pdfinclusionerrorlevel
| 
| - moved all extensions in pdfxtex to pdftex
| 
`--------

Thanh
From taco at elvenkind.com  Tue May 24 11:40:04 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue May 24 11:40:08 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <20050524082244.GA2636@monty.localnet>
References: <20050524082244.GA2636@monty.localnet>
Message-ID: <4292F674.4070607@elvenkind.com>


Hi Thanh / TeX-k people,

There are some compile-time warnings in the latest snapshots
of pdftex, that are very simple to fix.


In pdftex.ch: the macro pdf_room() first checks its argument against
the pdf_buf_size, but pdf_buf_size is larger (16384) than the largest
possible value for the type of k (a C char), so there are always two
compile-time warnings from gcc:

   pdfetex0.c: In function `zpdfprintint':
   pdfetex0.c:2696: warning: comparison is always false due to limited
   range of data type
   pdfetex1.c: In function `zpdfprintfwint':
   pdfetex1.c:8673: warning: comparison is always false due to limited
   range of data type

Here is a small (two lines) change that surpresses these
compile-time warnings in pdftex0.c and pdftex1.c:
--------------------------------------------------------
diff pdftex.ch.orig  pdftex.ch
1215c1215
< var k:0..23; {index to current digit; we assume that $|n|<10^{23}$}
---
 > var k:integer; {index to current digit; we assume that $|n|<10^{23}$}
2015c2015
< var k:0..23;
---
 > var k:integer;
-------------------------------------------------------------

In pdftex.ch, there is a similar message in tex.ch:load_fmt_file():
items in hyf_next[1] cannot be larger than max_trie_op (65535):

   pdfetexini.c: In function `loadfmtfile':
   pdfetexini.c:4194: warning: comparison is always false due to limited
   range of data type

Here is a different one-line patch to fix that as well:
--------------------------------------------------------------
diff tex.ch.orig tex.ch
227c227
< @!max_trie_op=ssup_trie_opcode; {largest possible trie opcode for any 
language}
---
 > @!max_trie_op=ssup_trie_opcode-1; {largest possible trie opcode for 
any language}
--------------------------------------------------------------

Greetings, Taco

From taco at elvenkind.com  Tue May 24 11:50:43 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue May 24 11:50:47 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <20050524082244.GA2636@monty.localnet>
References: <20050524082244.GA2636@monty.localnet>
Message-ID: <4292F8F3.9040504@elvenkind.com>



The Thanh Han wrote:
> 
> | - moved all extensions in pdfxtex to pdftex

new pdftex  = former pdfxtex, and
new pdfetex = former pdfxtex + etex, right?

Taco
From vit.zyka at seznam.cz  Tue May 24 13:18:08 2005
From: vit.zyka at seznam.cz (Vit Zyka)
Date: Tue May 24 13:17:01 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <20050524082244.GA2636@monty.localnet>
References: <20050524082244.GA2636@monty.localnet>
Message-ID: <42930D70.8080104@seznam.cz>

The Thanh Han wrote:
> | - moved all extensions in pdfxtex to pdftex

Is somewhere a desription of the pdfxtex extensions?

Thanks
Vit Zyka
From noreply at sarovar.org  Wed May 25 00:05:17 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed May 25 00:28:37 2005
Subject: [NTG-pdftex] [ pdftex-Patches-334 ] Setting MF mode by new token
	register \pdfmfmode
Message-ID: <E1DahWX-0007rg-00@sarovar.org>

Patches item #334, was opened at 2005-05-02 23:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=334&group_id=106

Category: Fonts
Group: v1.21b
>Status: Closed
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: Setting MF mode by new token register \pdfmfmode

Initial Comment:
Can be dumped into the format, see README.

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-05-25 00:05

Message:
Logged In: YES 
user_id=929

this is in pdftex-20050524, and will be in pdftex-1.30. It's
now named \pdfpkmode.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=334&group_id=106
From noreply at sarovar.org  Wed May 25 00:21:43 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed May 25 00:29:14 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-335 ] Empty name (\pdfdest name{}xyz)
	destroys /Names array
Message-ID: <E1DahmR-0000BT-00@sarovar.org>

Bugs item #335, was opened at 2005-05-05 14:51
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=335&group_id=106

Category: None
Group: None
>Status: Closed
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: The Thanh Han (hanthethanh)
Summary: Empty name (\pdfdest name{}xyz) destroys /Names array

Initial Comment:
Hello,

empty strings are suppressed by pdf_print_str
(pdftex.ch). This is fatal for many places,
resulting in invalid PDF files (no working
bookmarks, ...):

\pdfdest name{}xyz
First page
\vfil\break
\pdfdest name{foobar}xyz
\pdfoutline goto name{foobar} count 0{Second page}
Second page.
\bye

The generated PDF file contains:

  /Names [ 4 0 R (foobar) 10 0 R]
  /Limits [ (foobar)]

instead of

  /Names [() 4 0 R (foobar) 10 0 R]
  /Limits [() (foobar)]

Suggested fix (modulo line breaks):

*** pdftex.ch.org       2005-04-24 00:39:28.000000000 +0200
--- pdftex.ch           2005-05-05 14:45:27.000000000 +0200
***************
*** 1921,1928 ****
  begin
      i := str_start[s];
      j := i + length(s) - 1;
!     if (i > j) then
          return; {null string}
      if (str_pool[i] = '(') and (str_pool[j] = ')')
then begin
          pdf_print(s);
          return;
--- 1921,1930 ----
  begin
      i := str_start[s];
      j := i + length(s) - 1;
!     if (i > j) then begin
!         pdf_print("()");
          return; {null string}
+     end;
      if (str_pool[i] = '(') and (str_pool[j] = ')')
then begin
          pdf_print(s);
          return;

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-05-25 00:21

Message:
Logged In: YES 
user_id=929

fixed in pdftex-20050524; should be ok in pdftex-1.30

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=335&group_id=106
From noreply at sarovar.org  Wed May 25 00:18:30 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed May 25 00:30:57 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
Message-ID: <E1DahjK-0008Qs-00@sarovar.org>

Bugs item #292, was opened at 2005-02-14 15:22
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106

Category: hz
Group: v1.21a
>Status: Closed
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
>Assigned to: The Thanh Han (hanthethanh)
>Summary: protuding leads to "This can't happen (paragraph)."

Initial Comment:
The input
---------------------
\pdfoutput=1
\input edmac
\input protcode

\font\eightrm=ptmr8t
\setprotcode\eightrm
\pdfprotrudechars=2

\linenummargin{outer} %% left|right|inner|outer
\footparagraph{A}

\tracingall\tracingonline=0
\beginnumbering

\pstart 
\text{There}\Afootnote{Habent sua fata libelli. (Der
Satz wurde auf
Wunsch der Redaktion von ?Living Marxism? gestrichen;
siehe Korsch an
P.~Mattick am 3.10.1938.)}/ is a striking contrast
between the
impression produced in the minds of West"=European
revolutionaries by
those short pamphlets of Lenin and Trotsky which
appeared in poorly
translated and poorly printed editions during the final
stage and the
aftermath of the war, and the response called forth in
Europe and
U.S.A. by the belated appearance, in 1927, of the first
extra"=Russian
versions of Lenin's philosophical work of 1908, on
?Materialism and
Empirio"=Criticism?.
\pend

\endnumbering

\bye
---------------------
(all input files are in the attached archive) leads to 
---------------------
! This can't happen (paragraph).
<recently read> \par 
                     
\do@feet ...s \else \Afootstart {A}\Afootgroup {A}
                                                  \fi
\ifvoid \Bfootins \els...

\pagecontents ...p \@cclv \unvbox \@cclv \do@feet 
                                                 
\ifr@ggedbottom \kern -\di...

\pagebody ...\boxmaxdepth \maxdepth \pagecontents 
                                                  }
\edmac@output ...e \vbox {\makeheadline \pagebody 
                                                 
\makefootline }\fi }\advan...
<output> {\edmac@output 
                        }
...
l.30 \bye
         
I'm broken. Please show this to someone who can fix can fix
---------------------

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-05-25 00:18

Message:
Logged In: YES 
user_id=929

Fixed from pdftex-20050414 on, should be ok in pdftex-1.30.
New fix adds \leftmarginkern and \rightmarginkern
primitives. Margin kerns will generally be removed during
unhboxing or unhcopying, but they can be stored away before,
using these primitives. See manual. Requires patching of
edmac and ledmac styles to get protrusion with these packages.

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-04-03 21:00

Message:
Logged In: YES 
user_id=929

P.S. A nice test are the various ledmac test files in
directory texmf-dist/doc/latex/ledmac/, when you add the
microtype package (somebody must have provided such a
directory to me, thanks)...

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-04-03 20:26

Message:
Logged In: YES 
user_id=929

New try of a patch, see patch-292b.tgz.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-03-23 15:43

Message:
Logged In: YES 
user_id=421

Hartmut,
what's the status here? I remember you fixed this somehow at
EuroTeX.

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-02-14 20:42

Message:
Logged In: YES 
user_id=929

Now we know which side effects patch-274 has. When it's
reverted, the file is processed without error, but margin
kerning is missing (which was the original problem before
patch-274).

Following experiment is done _with_ patch-274.

The "this can't happen" error happens within the line_break
routine, which chokes on a margin_kern_node (which was
filtered out before patch-274).If one adds margin_kern_node
to the do_nothing list, like:

mark_node,ins_node,adjust_node,margin_kern_node: do_nothing;
othercases confusion("paragraph")

it apparently works ok, and margin kerning is fine also
(requires patch in hz.ch). But i need to understand how the
line_break routine works, whether a do_nothing is the right
thing to do...

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-14 15:30

Message:
Logged In: YES 
user_id=421

The submitter used the attached edmac.doc; the error is the
same.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106
From hartmut_henkel at gmx.de  Tue May 24 22:18:09 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed May 25 01:04:55 2005
Subject: [NTG-pdftex] 20050525 pdfretval last minute changes
In-Reply-To: <4292F674.4070607@elvenkind.com>
References: <20050524082244.GA2636@monty.localnet>
	<4292F674.4070607@elvenkind.com>
Message-ID: <Pine.LNX.4.61.0505242153430.10168@hahepc1.hahe>

Hi Thanh,

the attached last-minute-patch to pdftex.ch contains:

1. Akira's identification of binary PDF file, now by special string
"PTEX" with 128 added to each ASCII char (highest bit set).

2. Taco's fix for compile time warnings (without the tex-k one).

3. And i would like to propose to change the register \pdfstrcompresult
into simple \pdfretval. Reason is that it would be nice to have a global
integer "return value" register for general use with utility functions,
e. g. to check whether image embedding failed or so, and i also need
such a return value register for map related stuff...

When i saw that \pdfstrcompresult is already a typical integer return
value for \pdfstrcomp, i thought that this would be the ideal moment to
start a \pdfretval. After the patch, comparison by \pdfstrcomp would set
\pdfretval to -1, 0, or 1.

You sure will have ideas for what to set \pdfretval. It then normally
should contain a 0 for "success", some positive value coding various
"fail" conditions, or other e. g. signed values as after \pdfstrcomp...

Question is, who already is using \pdfstrcomp, and whether he can live
with such a new \pdfretval instead?

Regards, Hartmut


--- pdftex.ch.orig	2005-05-24 09:43:10.000000000 +0200
+++ pdftex.ch	2005-05-24 21:33:31.443521131 +0200
@@ -382,7 +382,7 @@
 @d pdf_last_annot_code        = pdftex_first_rint_code + 5 {code for \.{\\pdflastannot}}
 @d pdf_last_x_pos_code        = pdftex_first_rint_code + 6 {code for \.{\\pdflastxpos}}
 @d pdf_last_y_pos_code        = pdftex_first_rint_code + 7 {code for \.{\\pdflastypos}}
-@d pdf_strcmp_result_code     = pdftex_first_rint_code + 8 {result of \.{\\pdfstrcmp}}
+@d pdf_retval_code            = pdftex_first_rint_code + 8 {global multi-purpose return value}
 @d pdf_last_ximage_colordepth_code = pdftex_first_rint_code + 9 {code for \.{\\pdflastximagecolordepth}}
 @d elapsed_time_code          = pdftex_first_rint_code + 10 {code for \.{\\elapsedtime}}
 @d pdftex_last_item_codes     = pdftex_first_rint_code + 10 {end of \pdfTeX's command codes}
@@ -410,8 +410,8 @@
 @!@:pdf_last_x_pos_}{\.{\\pdflastxpos} primitive@>
 primitive("pdflastypos",last_item,pdf_last_y_pos_code);@/
 @!@:pdf_last_y_pos_}{\.{\\pdflastypos} primitive@>
-primitive("pdfstrcmpresult",last_item,pdf_strcmp_result_code);@/
-@!@:pdf_strcmp_result_}{\.{\\pdfstrcmpresult} primitive@>
+primitive("pdfretval",last_item,pdf_retval_code);@/
+@!@:pdf_retval_}{\.{\\pdfretval} primitive@>
 primitive("pdflastximagecolordepth",last_item,pdf_last_ximage_colordepth_code);@/
 @!@:pdf_last_ximage_colordepth_}{\.{\\pdflastximagecolordepth} primitive@>
 primitive("elapsedtime",last_item,elapsed_time_code);
@@ -429,7 +429,7 @@
   pdf_last_annot_code:  print_esc("pdflastannot");
   pdf_last_x_pos_code:  print_esc("pdflastxpos");
   pdf_last_y_pos_code:  print_esc("pdflastypos");
-  pdf_strcmp_result_code: print_esc("pdfstrcmpresult");
+  pdf_retval_code:      print_esc("pdfretval");
   pdf_last_ximage_colordepth_code: print_esc("pdflastximagecolordepth");
   elapsed_time_code: print_esc("elapsedtime");
   othercases print_esc("badness")
@@ -456,7 +456,7 @@
   pdf_last_annot_code:  cur_val := pdf_last_annot;
   pdf_last_x_pos_code:  cur_val := pdf_last_x_pos;
   pdf_last_y_pos_code:  cur_val := pdf_last_y_pos;
-  pdf_strcmp_result_code:  cur_val := pdf_strcmp_result;
+  pdf_retval_code:      cur_val := pdf_retval;
   pdf_last_ximage_colordepth_code: cur_val := pdf_last_ximage_colordepth;
   elapsed_time_code: cur_val := get_microinterval;
   end; {there are no other cases}
@@ -488,7 +488,7 @@
 in {\sl Technische Grundlagen zur Satzherstellung\/} (Bern, 1980).
 The Didot point has been newly standardized in 1978;
 it's now exactly $\rm 1\,nd=0.375\,mm$.
-Conversion uses the equation $0.375=21681/20320/72.27*25.4$.
+Conversion uses the equation $0.375=21681/20320/72.27\cdot25.4$.
 The new Cicero follows the new Didot point; $\rm 1\,nc=12\,nd$.
 @z

@@ -929,7 +929,13 @@
 pdf_buf[6] := ".";
 pdf_buf[7] := "4";
 pdf_buf[8] := pdf_new_line_char;
-pdf_ptr := 9;
+pdf_buf[9] := "%";
+pdf_buf[10] := 208; {``PTEX''}
+pdf_buf[11] := 212;
+pdf_buf[12] := 197;
+pdf_buf[13] := 216;
+pdf_buf[14] := pdf_new_line_char;
+pdf_ptr := 15;
 pdf_gone := 0;
 zip_write_state := no_zip;
 pdf_minor_version_written := false;
@@ -1212,7 +1218,7 @@
 end;

 procedure pdf_print_int(n:integer); {print out a integer to PDF buffer}
-var k:0..23; {index to current digit; we assume that $|n|<10^{23}$}
+var k:integer; {index to current digit ($0\le k\le23$); we assume that $|n|<10^{23}$}
 m:integer; {used to negate |n| in possibly dangerous cases}
 begin
   k:=0;
@@ -2012,7 +2018,7 @@

 @p procedure pdf_print_fw_int(n, w: integer); {print out an integer with
 fixed width; used for outputting cross-reference table}
-var k:0..23;
+var k:integer; {$0\le k\le23$}
 begin
   k:=0;
   repeat dig[k]:=n mod 10; n:=n div 10; incr(k);
@@ -4766,7 +4772,7 @@
     else
         result := -1;
 done:
-    pdf_strcmp_result := result;
+    pdf_retval := result;
     flush_str(s2);
     flush_str(s1);
 end;
@@ -5642,7 +5648,7 @@
 end

 @ @<Glob...@>=
-@!pdf_strcmp_result: integer; {the last result of \.{\\pdfstrcmp}}
+@!pdf_retval: integer; {global multi-purpose return value}

 @ @<Implement \.{\\pdfstrcmp}@>=
 compare_strings
From hanthethanh at myrealbox.com  Wed May 25 04:30:59 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed May 25 04:40:30 2005
Subject: [NTG-pdftex] 20050525 pdfretval last minute changes
In-Reply-To: <Pine.LNX.4.61.0505242153430.10168@hahepc1.hahe>
References: <20050524082244.GA2636@monty.localnet>
	<4292F674.4070607@elvenkind.com>
	<Pine.LNX.4.61.0505242153430.10168@hahepc1.hahe>
Message-ID: <20050525023059.GF2586@monty.localnet>

Hi Hartmut,

thanks for the patch. Nobody is using \pdfstrcomp, so we can
safely replace it.

I will upload another snapshot soon.

Regards,
Thanh

On Tue, May 24, 2005 at 10:18:09PM +0200, Hartmut Henkel wrote:
> Hi Thanh,
> 
> the attached last-minute-patch to pdftex.ch contains:
> 
> 1. Akira's identification of binary PDF file, now by special string
> "PTEX" with 128 added to each ASCII char (highest bit set).
> 
> 2. Taco's fix for compile time warnings (without the tex-k one).
> 
> 3. And i would like to propose to change the register \pdfstrcompresult
> into simple \pdfretval. Reason is that it would be nice to have a global
> integer "return value" register for general use with utility functions,
> e. g. to check whether image embedding failed or so, and i also need
> such a return value register for map related stuff...
> 
> When i saw that \pdfstrcompresult is already a typical integer return
> value for \pdfstrcomp, i thought that this would be the ideal moment to
> start a \pdfretval. After the patch, comparison by \pdfstrcomp would set
> \pdfretval to -1, 0, or 1.
> 
> You sure will have ideas for what to set \pdfretval. It then normally
> should contain a 0 for "success", some positive value coding various
> "fail" conditions, or other e. g. signed values as after \pdfstrcomp...
> 
> Question is, who already is using \pdfstrcomp, and whether he can live
> with such a new \pdfretval instead?
> 
> Regards, Hartmut
From hanthethanh at myrealbox.com  Wed May 25 04:29:31 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed May 25 05:05:16 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <42930D70.8080104@seznam.cz>
References: <20050524082244.GA2636@monty.localnet> <42930D70.8080104@seznam.cz>
Message-ID: <20050525022931.GE2586@monty.localnet>

On Tue, May 24, 2005 at 01:18:08PM +0200, Vit Zyka wrote:
> The Thanh Han wrote:
> >| - moved all extensions in pdfxtex to pdftex
> 
> Is somewhere a desription of the pdfxtex extensions?

here is a very brief and incomplete ovewview:

,--------
| \item There is a program called \<PDFXTEX>, which is a variant of                          
| \<PDFETEX> that contains experimental features. Those features may be                      
| moved to \<PDFTEX> when they seem to be useful and stable. At the moment                   
| the following extensions are avaiable:                                                     
|     \begin{itemize}                                                                        
|     \item |\pdflastximagecolordepth| returns the last color depth of a                     
|     bitmapped image;                                                                       
|     \item |\pdfximage| supports a keyword |colorspace| following an object                 
|         number representing a \<PDF> ColorSpace object;                                    
|     \item |\pdfstrcmp| compares two strings;                                               
|     \item |\pdfescapestring| and |\pdflastescapedstring| provide a means to                
|     escape strings;                                                                        
|     \item |\pdffirstlineheight|, |\pdflastlinedepth|, |\pdfeachlineheight|                 
|     and |\pdfeachlinedepth| allow fixing line dimensions during paragraph                  
|     buiding;                                                                               
|     \item various extensions from Taco Hoekwater:                                          
|     \begin{itemize}                                                                        
|         \item support for dimension unit |px|;                                             
|         \item |\tagcode| primitive allowing read and write access to a                     
|         character's |char_tag| info.                                                       
|         \item |\quitvmode| primitive quits vertical mode;                                  
|     \end{itemize}                                                                          
|     \end{itemize}                                                                          
| \end{enumerate}                                                                            
`--------

pls a few more that have been added recently.

Those will be described in the pdftex manual soon.

Thanh
From hanthethanh at myrealbox.com  Wed May 25 04:26:22 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed May 25 05:06:25 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <4292F8F3.9040504@elvenkind.com>
References: <20050524082244.GA2636@monty.localnet>
	<4292F8F3.9040504@elvenkind.com>
Message-ID: <20050525022622.GD2586@monty.localnet>

yes exactly. 

Thanh

On Tue, May 24, 2005 at 11:50:43AM +0200, Taco Hoekwater wrote:
> 
> 
> The Thanh Han wrote:
> >
> >| - moved all extensions in pdfxtex to pdftex
> 
> new pdftex  = former pdfxtex, and
> new pdfetex = former pdfxtex + etex, right?
> 
> Taco
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From hanthethanh at myrealbox.com  Wed May 25 03:43:04 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed May 25 06:01:06 2005
Subject: [NTG-pdftex] new pdftex snapshot
In-Reply-To: <Pine.LNX.4.61.0505240108290.7598@hahepc1.hahe>
References: <Pine.LNX.4.61.0505231946380.4002@hahepc1.hahe>
	<200505232153.j4NLrRX2025477@jupiter.fsci.fuk.kindai.ac.jp>
	<Pine.LNX.4.61.0505240108290.7598@hahepc1.hahe>
Message-ID: <20050525014304.GD2732@monty.localnet>

On Tue, May 24, 2005 at 01:29:06AM +0200, Hartmut Henkel wrote:
> ...
> Maybe the last one 208, 212, 197, 216 is the favorite as this is the
> string registered by Hans with Adobe? Thanh, pick your choice :-)

seems also the best choice to me :)

> 
> And we will need a special trick to print the title page of the pdftex
> manual then :-)

looks like some primitive line \pdfbinaryheader is
needed :)

Regards,
Thanh

From pragma at wxs.nl  Wed May 25 08:09:24 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed May 25 08:08:53 2005
Subject: [NTG-pdftex] 20050525 pdfretval last minute changes
In-Reply-To: <20050525023059.GF2586@monty.localnet>
References: <20050524082244.GA2636@monty.localnet>
	<4292F674.4070607@elvenkind.com>
	<Pine.LNX.4.61.0505242153430.10168@hahepc1.hahe>
	<20050525023059.GF2586@monty.localnet>
Message-ID: <42941694.8090205@wxs.nl>

The Thanh Han wrote:

>>Question is, who already is using \pdfstrcomp, and whether he can live
>>with such a new \pdfretval instead?

i can live with the change, i'll use the command once the new pdftex is around

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From te at dbs.uni-hannover.de  Wed May 25 23:48:12 2005
From: te at dbs.uni-hannover.de (Thomas Esser)
Date: Wed May 25 23:48:22 2005
Subject: [NTG-pdftex] problem with autoconf
In-Reply-To: <20050524064143.GC2556@monty.localnet>
References: <20050520080831.GA2565@monty.localnet> <428DBE30.8060005@wxs.nl>
	<428DC06C.5080109@elvenkind.com>
	<20050524064143.GC2556@monty.localnet>
Message-ID: <20050525214812.GA2459@dbs.uni-hannover.de>

> what I did for the moment is to leave the configure.in
> and configure scripts untouched, until some expert fixes it.

You need an installation of a virgin autoconf-2.13, I have my one in
/software/oss/Development/autoconf-2.13. For running configure in texk or
a subdir of it, just put that autoconf into your PATH, then run autoconf
with -m option to texk/etc/autoconf, e.g.

  cd texk/web2c
  PATH=/software/oss/Development/autoconf-2.13/bin:$PATH; export PATH
  autoconf -m ../etc/autoconf

Thomas
From Fabrice.Popineau at supelec.fr  Thu May 26 10:56:28 2005
From: Fabrice.Popineau at supelec.fr (Fabrice Popineau)
Date: Thu May 26 10:55:51 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <20050524082244.GA2636@monty.localnet> (The Thanh Han's message
	of "Tue, 24 May 2005 15:22:45 +0700")
References: <20050524082244.GA2636@monty.localnet>
Message-ID: <4qcqicw3.fsf@esemetz.metz.supelec.fr>


Hi,

I don't know if it is me failing to properly upgrade my source tree but
I get a strange behaviour since 1.21b. This LaTeX document:

\documentclass{article}
\usepackage{utopia}

\begin{document}

This is a test!
{\it This is a test!}
{\bf This is a test!}


\end{document}

ends up in a PDF file where the utopia font is said to be impossible to
extract to display by Acrobat 7.0.

Can anybody prove me wrong? 

-- 
Fabrice

From hanthethanh at myrealbox.com  Thu May 26 11:40:47 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu May 26 11:46:49 2005
Subject: [NTG-pdftex] Re: another last minute change
In-Reply-To: <42957B20.3000503@elvenkind.com>
References: <20050524082244.GA2636@monty.localnet>
	<4292F674.4070607@elvenkind.com>
	<Pine.LNX.4.61.0505242153430.10168@hahepc1.hahe>
	<20050525023059.GF2586@monty.localnet>
	<42957B20.3000503@elvenkind.com>
Message-ID: <20050526094047.GA2708@monty.localnet>

Hi,

I have applied the change and uploaded another snapshot.

Thanh

On Thu, May 26, 2005 at 09:30:40AM +0200, Taco Hoekwater wrote:
> 
> Hi Thanh,
> 
> I messed somthing up again in the microinterval patch.
> Thanh, can you please apply this (discovered by Hartmut)?
> 
> @x
>    else if (microseconds<m)  then
> @y
>    else if (microseconds>m)  then
> @z
> 
> Taco
> 
> The Thanh Han wrote:
> >Hi Hartmut,
> >
> >thanks for the patch. Nobody is using \pdfstrcomp, so we can
> >safely replace it.
> >
> >I will upload another snapshot soon.
> >
> >Regards,
> >Thanh
> >
> >On Tue, May 24, 2005 at 10:18:09PM +0200, Hartmut Henkel wrote:
> >
> >>Hi Thanh,
> >>
> >>the attached last-minute-patch to pdftex.ch contains:
> >>
> >>1. Akira's identification of binary PDF file, now by special string
> >>"PTEX" with 128 added to each ASCII char (highest bit set).
> >>
> >>2. Taco's fix for compile time warnings (without the tex-k one).
> >>
> >>3. And i would like to propose to change the register \pdfstrcompresult
> >>into simple \pdfretval. Reason is that it would be nice to have a global
> >>integer "return value" register for general use with utility functions,
> >>e. g. to check whether image embedding failed or so, and i also need
> >>such a return value register for map related stuff...
> >>
> >>When i saw that \pdfstrcompresult is already a typical integer return
> >>value for \pdfstrcomp, i thought that this would be the ideal moment to
> >>start a \pdfretval. After the patch, comparison by \pdfstrcomp would set
> >>\pdfretval to -1, 0, or 1.
> >>
> >>You sure will have ideas for what to set \pdfretval. It then normally
> >>should contain a 0 for "success", some positive value coding various
> >>"fail" conditions, or other e. g. signed values as after \pdfstrcomp...
> >>
> >>Question is, who already is using \pdfstrcomp, and whether he can live
> >>with such a new \pdfretval instead?
> >>
> >>Regards, Hartmut
> >
> >_______________________________________________
> >ntg-pdftex mailing list
> >ntg-pdftex@ntg.nl
> >http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
> 
From hanthethanh at myrealbox.com  Thu May 26 11:51:01 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu May 26 11:55:35 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <4qcqicw3.fsf@esemetz.metz.supelec.fr>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
Message-ID: <20050526095101.GB2708@monty.localnet>

Hi,

I have tested your file with the latest snapshot. Seems to
be ok on linux, ACR7.

Thanh

On Thu, May 26, 2005 at 10:56:28AM +0200, Fabrice Popineau wrote:
> 
> Hi,
> 
> I don't know if it is me failing to properly upgrade my source tree but
> I get a strange behaviour since 1.21b. This LaTeX document:
> 
> \documentclass{article}
> \usepackage{utopia}
> 
> \begin{document}
> 
> This is a test!
> {\it This is a test!}
> {\bf This is a test!}
> 
> 
> \end{document}
> 
> ends up in a PDF file where the utopia font is said to be impossible to
> extract to display by Acrobat 7.0.
> 
> Can anybody prove me wrong? 
> 
> -- 
> Fabrice
> 
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From Fabrice.Popineau at supelec.fr  Thu May 26 12:16:44 2005
From: Fabrice.Popineau at supelec.fr (Fabrice Popineau)
Date: Thu May 26 12:15:20 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <20050526095101.GB2708@monty.localnet> (The Thanh Han's message
	of "Thu, 26 May 2005 16:51:01 +0700")
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<20050526095101.GB2708@monty.localnet>
Message-ID: <hdgqgulv.fsf@esemetz.metz.supelec.fr>

* The Thanh Han <hanthethanh@myrealbox.com> writes:


    > Hi, I have tested your file with the latest snapshot. Seems to be
    > ok on linux, ACR7.

It still fails for me. You removed 2 occurences of save_offset() in
pdftexdir/writet1.c :

@@ -1050,7 +1035,6 @@
 
 static void t1_include(void)
 {
-    save_offset();
     do {
         t1_getline();
         t1_scan_param();
@@ -1381,7 +1365,6 @@
 static void t1_subset_ascii_part(void)
 {
     int i, j;
-    save_offset();
     t1_getline();
     while (!t1_prefix("/Encoding")) {
         t1_scan_param();
@@ -1391,15 +1374,13 @@

If I reinstate them, I get readable pdf files again. The Length1 values
for t1 fonts were wrong.

Fabrice

From nagybence at tipogral.hu  Fri May 20 11:59:29 2005
From: nagybence at tipogral.hu (Nagy Bence)
Date: Thu May 26 15:24:51 2005
Subject: [NTG-pdftex] New Didot-point
Message-ID: <20050520115929.106e7dd5@localhost>

Dear All,

I have a new tipometer now, and I wondered, that by Rotring Didot-point
is no more 0,376 but 0,375 mm. Actually the new Didot-size is more
komfortable, because one Cicero is exactly equal to 4,5 mm, two Cicero
to 9 mm.

I have attached a small patch, which introduces two new units: nd (new
didot) and nc (new cicero). Maybe we have to follow the sounds of new
times. Any comments?

Greetings, Bence

-- 
Nagy Bence | Tipogr?l.hu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 01-newdidot.patch
Type: application/octet-stream
Size: 1092 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050520/bcbfc664/01-newdidot-0001.obj
From nagybence at tipogral.hu  Fri May 20 12:02:45 2005
From: nagybence at tipogral.hu (Nagy Bence)
Date: Thu May 26 15:24:51 2005
Subject: [NTG-pdftex] New Didot-point
Message-ID: <20050520120245.7a3f8cbc@localhost>

Dear All,

I have a new tipometer now, and I wondered, that by Rotring Didot-point
is no more 0,376 but 0,375 mm. Actually the new Didot-size is more
komfortable, because one Cicero is exactly equal to 4,5 mm, two Cicero
to 9 mm.

I have attached a small patch, which introduces two new units: nd (new
didot) and nc (new cicero). Maybe we have to follow the sounds of new
times. Any comments?

Greetings, Bence

-- 
Nagy Bence | Tipogr?l.hu

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 01-newdidot.patch
Type: application/octet-stream
Size: 1092 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050520/4712a95c/01-newdidot-0001.obj
From P.Taylor at Rhul.Ac.Uk  Mon May 23 15:42:24 2005
From: P.Taylor at Rhul.Ac.Uk (Philip TAYLOR)
Date: Thu May 26 15:24:52 2005
Subject: [NTG-pdftex] Re: [tex-implementors] Ugly rules in PDF
In-Reply-To: <4289C141.7030806@elvenkind.com>
References: <4289C141.7030806@elvenkind.com>
Message-ID: <4291DDC0.5040607@Rhul.Ac.Uk>

I've read through the follow-up messages to this, and
looked at the original demo. in Acrobat V5.0.5 under
Windows/XP at 1152 x 854 on a 19" monitor.  With Acrobat
options "Smooth Text" and "Smooth Line Art" both
selected, the blend between the two is /almost/ invisible
even at 1600% magnification.  Before investing effort
in a PdfTeX-level solution, I would ask if there are
current versions/implementations of Acrobat that do /not/
yield an "almost perfect blend".  If there are, then
I would agree with other posters that we need to
identify /all/ places in TeX where an on-screen glyph
is composed of both font-based glyphs and rules, and
then devise a solution which will accommodate all of these
without the overhead of a full PicTeX-like approach.

Philip Taylor
--------
Taco Hoekwater wrote:

 >
 > Hi,
 >
 > After some discussion with Karl Berry on math-font-discuss:
 >
 > At Bachotek2005 there was a talk about the Latin Modern fonts,
 > and there was a small math example included, of course. The
 > presentation was shown using Adobe's PDF reader, and as you
 > probably know, it displays the rules TeX draws for fractions
 > and the radical bar horribly.
 >
 > The same is, in fact, true for xpdf and ghostview. The general
 > problem is that rendering graphics and rendering text are not
 > the same thing in PDF (nor PostScript), and that makes it hard
 > for a viewer to align the two objects correctly. Our 'problem'
 > is that people in general believe this is a bug in pdftex :-(
 >
 > An example file is at  http://tex.aanhet.net/temp/mathtest.pdf
 > Especially look at the top left of the sqrt signs. The source
 > code is trivial:
 > $$\sqrt{\sqrt{\sqrt{\sqrt{\sqrt{\sqrt{x+1}}+1}+1}+1}+1}$$
 >
 >
 > I volunteered to write a patch for pdftex to try to remove the
 > problem by making pdftex use a repeated character instead of a
 > rule, but I am still a bit unsure about the best solution. Also,
 > I vaguely remember that possibly somebody had done something
 > with \radical a long time ago already, so I thought I'd ask
 > feedback before doing any actual coding.
 >
 >
 > Here is what I propose:
 >
 > The creation of a new primitive called \mathrulechar, with
 > the following semantics. Adding
 >
 >   \mathrulechar="0130
 >
 > somewhere in the TeX source would make subsequent \radical commands
 > use a suitable number of repetitions of the character "30 in math
 > family 1 instead of the horizontal rule pdfTeX draws currently.
 >
 > No additional macros are involved in the process.
 >
 > (A suitable character has to be available, of course. It should be
 > a dash, positioned flat on top of the baseline, no sidebearings)
 >
 >
 > Greetings, Taco
 >
 >
 > _______________________________________________
 > tex-implementors mailing list
 > http://tug.org/mailman/listinfo/tex-implementors
From Fabrice.Popineau at supelec.fr  Thu May 26 11:22:00 2005
From: Fabrice.Popineau at supelec.fr (Fabrice Popineau)
Date: Thu May 26 15:24:52 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <4qcqicw3.fsf@esemetz.metz.supelec.fr> (Fabrice Popineau's
	message of "Thu, 26 May 2005 10:56:28 +0200")
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
Message-ID: <vf56gx53.fsf@esemetz.metz.supelec.fr>


Doesn't work either with lmodern or fourier instead of utopia. Looking
at the attached file, it seems that pdftex fails to include the last font.

-- 
Fabrice

-------------- next part --------------
A non-text attachment was scrubbed...
Name: foo.pdf
Type: application/pdf
Size: 62620 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050526/eb39831e/foo-0001.pdf
From kakuto at fsci.fuk.kindai.ac.jp  Thu May 26 16:39:01 2005
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Thu May 26 16:39:09 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: Your message of "Thu, 26 May 2005 11:22:00 +0200"
References: <vf56gx53.fsf@esemetz.metz.supelec.fr>
Message-ID: <200505261439.j4QEd3JN012836@jupiter.fsci.fuk.kindai.ac.jp>

> Doesn't work either with lmodern or fourier instead of utopia. Looking
> at the attached file, it seems that pdftex fails to include the last font.

It seems to be ok here with utopia and lmodern.
(pdftex-20050526, Adobe Reader 7.0.1 on Windows) 

Best regards,
Akira
From hartmut_henkel at gmx.de  Thu May 26 17:04:33 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu May 26 17:04:40 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <hdgqgulv.fsf@esemetz.metz.supelec.fr>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<20050526095101.GB2708@monty.localnet>
	<hdgqgulv.fsf@esemetz.metz.supelec.fr>
Message-ID: <Pine.LNX.4.61.0505261656110.3993@hahepc1.hahe>

On Thu, 26 May 2005, Fabrice Popineau wrote:

> * The Thanh Han <hanthethanh@myrealbox.com> writes:
>
>
>     > Hi, I have tested your file with the latest snapshot. Seems to be
>     > ok on linux, ACR7.
>
> It still fails for me. You

i did it, it was the patch for bug-315 (the Length1 value was wrong).
The change seemed safe to me. The full patch included also a section

@@ -1717,6 +1715,7 @@
 {
     read_encoding_only = false;
 #ifdef pdfTeX
+    t1_save_offset = 0;
     if (strcasecmp(strend(fm_fontfile(fm_cur)) - 4, ".otf") == 0) {
         if (!is_included(fm_cur) || is_subsetted(fm_cur))
             pdftex_fail("OTF fonts must be included entirely");

Seems this is in. Will check again...

> removed 2 occurences of save_offset() in pdftexdir/writet1.c :
>
> @@ -1050,7 +1035,6 @@
>
>  static void t1_include(void)
>  {
> -    save_offset();
>      do {
>          t1_getline();
>          t1_scan_param();
> @@ -1381,7 +1365,6 @@
>  static void t1_subset_ascii_part(void)
>  {
>      int i, j;
> -    save_offset();
>      t1_getline();
>      while (!t1_prefix("/Encoding")) {
>          t1_scan_param();
> @@ -1391,15 +1374,13 @@
>
> If I reinstate them, I get readable pdf files again. The Length1 values
> for t1 fonts were wrong.

Regards, Hartmut
From pragma at wxs.nl  Thu May 26 17:35:02 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu May 26 17:34:52 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <vf56gx53.fsf@esemetz.metz.supelec.fr>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr>
Message-ID: <4295ECA6.90309@wxs.nl>

Fabrice Popineau wrote:
> Doesn't work either with lmodern or fourier instead of utopia. Looking
> at the attached file, it seems that pdftex fails to include the last font.

acrobat also has problems with two of the embeded lm ones

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Thu May 26 20:05:03 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu May 26 20:05:07 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <vf56gx53.fsf@esemetz.metz.supelec.fr>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr>
Message-ID: <Pine.LNX.4.61.0505261955190.22518@hahepc1.hahe>

Hi Fabrice,

i've looked to writet1.c and added diagnostic print lines. Thought that
maybe fb_ptr would not be initialized. But it is initialized. This
happens during t1_putchar() = fb_putchar() which uses macro alloc_array,
which sets fb_ptr.

t1_putchar() is used by t1_putline(), and this is called before Length1
is calculated. I initialized fb_ptr also to some weird value; also this
didn't matter. After the first t1_putchar() everything was ok. So i
can't yet repeat your problem. No idea...

Regards, Hartmut

From Fabrice.Popineau at supelec.fr  Thu May 26 20:57:09 2005
From: Fabrice.Popineau at supelec.fr (Fabrice Popineau)
Date: Thu May 26 20:56:59 2005
Subject: [NTG-pdftex] pdftex snapshot
In-Reply-To: <Pine.LNX.4.61.0505261845210.16270@hahepc1.hahe> (Hartmut
	Henkel's message of "Thu, 26 May 2005 18:49:41 +0200 (CEST)")
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<20050526095101.GB2708@monty.localnet>
	<hdgqgulv.fsf@esemetz.metz.supelec.fr>
	<Pine.LNX.4.61.0505261707160.4224@hahepc1.hahe>
	<4qcqf10p.fsf@esemetz.metz.supelec.fr>
	<Pine.LNX.4.61.0505261810460.16091@hahepc1.hahe>
	<Pine.LNX.4.61.0505261845210.16270@hahepc1.hahe>
Message-ID: <sm09dddm.fsf@esemetz.metz.supelec.fr>

* Hartmut Henkel <hartmut_henkel@gmx.de> writes:

Sorry to lose your time. I was missing this one:

    > t1_save_offset = 0;

It slipped off when I patched my source tree.
You were on the right track asking if pdfTeX was defined.

Thanks for the help,

Fabrice

From vit.zyka at seznam.cz  Thu May 26 20:22:28 2005
From: vit.zyka at seznam.cz (Vit Zyka)
Date: Thu May 26 21:06:18 2005
Subject: [NTG-pdftex] inclusion of PDF with hz-alg expandeded font
In-Reply-To: <4295ECA6.90309@wxs.nl>
References: <20050524082244.GA2636@monty.localnet>	<4qcqicw3.fsf@esemetz.metz.supelec.fr>	<vf56gx53.fsf@esemetz.metz.supelec.fr>
	<4295ECA6.90309@wxs.nl>
Message-ID: <429613E4.2060602@seznam.cz>

Hallo,

is the next bug known? When one includes a PDF (as a figure) with 
expanded fonts by hz-alg then this text is invisible (but neither 
AR7.0.1win and pdfetex complains).

Example:
% --- PDF with hz
\pdfpagewidth=12cm
\pdfpageheight=12cm
\hsize=8cm
The next text is typeset with hz-alg:
\vskip1cm
\pdfadjustspacing=2
\pdffontexpand\font 25 25 5 autoexpand%
\input knuth
\end
% --- loading
PDF with a hz-expanded font loaded as figure:
\pdfximage{hz.pdf}
\pdfrefximage\pdflastximage
\end

Version:
This is pdfeTeXk, Version 3.141592-1.21b-2.2 (Web2C 7.5.4)

Vit Zyka
-------------- next part --------------
A non-text attachment was scrubbed...
Name: load-hz.pdf
Type: application/pdf
Size: 33008 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050526/b6a4f046/load-hz-0001.pdf
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hz.pdf
Type: application/pdf
Size: 46190 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050526/b6a4f046/hz-0001.pdf
From pragma at wxs.nl  Thu May 26 21:26:24 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu May 26 21:25:57 2005
Subject: [NTG-pdftex] inclusion of PDF with hz-alg expandeded font
In-Reply-To: <429613E4.2060602@seznam.cz>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
Message-ID: <429622E0.806@wxs.nl>

Vit Zyka wrote:
> Hallo,
> 
> is the next bug known? When one includes a PDF (as a figure) with 
> expanded fonts by hz-alg then this text is invisible (but neither 
> AR7.0.1win and pdfetex complains).
> 
> Example:
> % --- PDF with hz
> \pdfpagewidth=12cm
> \pdfpageheight=12cm
> \hsize=8cm
> The next text is typeset with hz-alg:
> \vskip1cm
> \pdfadjustspacing=2
> \pdffontexpand\font 25 25 5 autoexpand%
> \input knuth
> \end
> % --- loading
> PDF with a hz-expanded font loaded as figure:
> \pdfximage{hz.pdf}
> \pdfrefximage\pdflastximage
> \end
> 
> Version:
> This is pdfeTeXk, Version 3.141592-1.21b-2.2 (Web2C 7.5.4)

strange indeed; there are font resources in there but the glyph data seems 
missing (there are encoding vector); acrobat never complains about missing 
glyphs, only about missing font resources.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Thu May 26 21:28:02 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu May 26 21:28:11 2005
Subject: [NTG-pdftex] inclusion of PDF with hz-alg expandeded font
In-Reply-To: <429613E4.2060602@seznam.cz>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
Message-ID: <Pine.LNX.4.61.0505262125360.839@hahepc1.hahe>

On Thu, 26 May 2005, Vit Zyka wrote:

> is the next bug known? When one includes a PDF (as a figure) with
> expanded fonts by hz-alg then this text is invisible (but neither
> AR7.0.1win and pdfetex complains).

Seems the text is just off the page. Try

% --- PDF with hz
\pdfpagewidth=12cm
\pdfpageheight=12cm
\hsize=8cm
\vsize=8cm
The next text is typeset with hz-alg:
\vskip1cm
\pdfadjustspacing=2
\pdffontexpand\font 25 25 5 autoexpand%
\input tufte
%\end
% --- loading
PDF with a hz-expanded font loaded as figure:
\pdfximage{hz.pdf}
\hbox{\pdfrefximage\pdflastximage}
\end

with \vsize setting. Or extend \pdfpageheight...

Regards, Hartmut
From hartmut_henkel at gmx.de  Fri May 27 15:26:11 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 27 15:26:16 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <429613E4.2060602@seznam.cz>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
Message-ID: <Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>

Hi Thanh,

see this line from Vit:

> \pdffontexpand\font 25 25 5 autoexpand%

The "%" is needed when in horizontal mode to get rid of a spurious
blank.

I think we should add a

  @<Scan an optional space@>

there, so that the space after the keyword is ignored (like with e. g.
"12pt"). Maybe similar with "\pdfobj reserveobjnum", and with
"newwindow" and "nonewwindow". Are there more cases like this?

Regards, Hartmut
From hartmut_henkel at gmx.de  Fri May 27 17:24:23 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 27 17:24:26 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
	<Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>

Here is a test file that shows spurious blanks after keywords:


---\pdffontexpand\font 25 25 5 autoexpand---

---\pdfobj reserveobjnum ---

---\pdfdest num1 fitbh ---

---\pdfstartlink goto file{file.pdf} page 1{/FitB}newwindow A\pdfendlink ---

\end


And below are simple patches for pdftex.ch and hz.ch to avoid these
blanks. I hope these are all occurences, and the patch won't cause
backward-incompatibilities. Who would want those spaces anyway?

Regards, Hartmut


--- pdftex.ch.orig	2005-05-26 11:39:32.000000000 +0200
+++ pdftex.ch	2005-05-27 17:02:02.737692220 +0200
@@ -4803,6 +4803,7 @@
 begin
     check_pdfoutput("\pdfobj");
     if scan_keyword("reserveobjnum") then begin
+        @<Scan an optional space@>;
         incr(pdf_obj_count);
         pdf_create_obj(obj_type_obj, pdf_obj_count);
         pdf_last_obj := obj_ptr;
@@ -5263,10 +5264,12 @@
     end
     else
         pdf_error("ext1", "identifier type missing");
-    if scan_keyword("newwindow") then
-        pdf_action_new_window(p) := 1
-    else if scan_keyword("nonewwindow") then
-        pdf_action_new_window(p) := 2
+    if scan_keyword("newwindow") then begin
+        pdf_action_new_window(p) := 1;
+        @<Scan an optional space@>; end
+    else if scan_keyword("nonewwindow") then begin
+        pdf_action_new_window(p) := 2;
+        @<Scan an optional space@>; end
     else
         pdf_action_new_window(p) := 0;
     if (pdf_action_new_window(p) > 0) and
@@ -5310,8 +5313,9 @@
 @ @<Implement \.{\\pdfannot}@>=
 begin
     check_pdfoutput("\pdfannot");
-    if scan_keyword("reserveobjnum") then
-        pdf_last_annot := pdf_new_objnum
+    if scan_keyword("reserveobjnum") then begin
+        pdf_last_annot := pdf_new_objnum;
+        @<Scan an optional space@>; end
     else begin
         if scan_keyword("useobjnum") then begin
             scan_int;
@@ -5507,6 +5511,7 @@
         pdf_dest_type(tail) := pdf_dest_fit
     else
         pdf_error("ext1", "destination type missing");
+    @<Scan an optional space@>;
     if pdf_dest_type(tail) = pdf_dest_fitr then begin
         scan_alt_rule; {scans |<rule spec>| to |alt_rule|}
         pdf_width(tail) := width(alt_rule);


--- hz.ch.orig	2005-05-21 03:31:58.000000000 +0200
+++ hz.ch	2005-05-27 16:40:18.316931899 +0200
@@ -575,8 +575,9 @@
     if (font_stretch = 0) and (font_shrink = 0) then
         pdf_error("font expansion", "invalid limit");
     auto_expand := false;
-    if scan_keyword("autoexpand") then
+    if scan_keyword("autoexpand") then begin
         auto_expand := true;
+        @<Scan an optional space@>; end;

     {check if the font can be expanded}
     if (pdf_font_expand_ratio[f] <> 0) then
From pragma at wxs.nl  Fri May 27 20:07:32 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri May 27 20:07:45 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
	<Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
	<Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>
Message-ID: <429761E4.8040109@wxs.nl>

Hartmut Henkel wrote:
> Here is a test file that shows spurious blanks after keywords:
> 
> 
> ---\pdffontexpand\font 25 25 5 autoexpand---
> 
> ---\pdfobj reserveobjnum ---
> 
> ---\pdfdest num1 fitbh ---
> 
> ---\pdfstartlink goto file{file.pdf} page 1{/FitB}newwindow A\pdfendlink ---
> 
> \end
> 
> 
> And below are simple patches for pdftex.ch and hz.ch to avoid these
> blanks. I hope these are all occurences, and the patch won't cause
> backward-incompatibilities. Who would want those spaces anyway?

normally one ends such a command with \relax (as with \hrule ...)

but pdftex is the only one using keywords without anything behind it so the 
patch fits into tex's paradigm

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Fri May 27 22:30:58 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri May 27 22:31:03 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <429761E4.8040109@wxs.nl>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
	<Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
	<Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>
	<429761E4.8040109@wxs.nl>
Message-ID: <Pine.LNX.4.61.0505272202500.4075@hahepc1.hahe>

On Fri, 27 May 2005, Hans Hagen wrote:

> Hartmut Henkel wrote:
> > Here is a test file that shows spurious blanks after keywords:
> >
> >
> > ---\pdffontexpand\font 25 25 5 autoexpand---
> >
> > ---\pdfobj reserveobjnum ---
> >
> > ---\pdfdest num1 fitbh ---
> >
> > ---\pdfstartlink goto file{file.pdf} page 1{/FitB}newwindow A\pdfendlink ---
> >
> > \end

> normally one ends such a command with \relax (as with \hrule ...)

\hrule?

> but pdftex is the only one using keywords without anything behind it
> so the patch fits into tex's paradigm

yes --- but meanwhile i fear that it might cause complaints from people
actively using these blanks in running text (mainly \pdfdest; the others
might be harmless as they are still rather new).

Would be interesting to know where it might give problems with
LaTeX/hyperref.

Maybe it's too late now for changing...

Regards, Hartmut
From pragma at wxs.nl  Fri May 27 22:57:42 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri May 27 22:57:12 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <Pine.LNX.4.61.0505272202500.4075@hahepc1.hahe>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
	<Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
	<Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>
	<429761E4.8040109@wxs.nl>
	<Pine.LNX.4.61.0505272202500.4075@hahepc1.hahe>
Message-ID: <429789C6.8000307@wxs.nl>

Hartmut Henkel wrote:

> \hrule

\hrule sidth 10cm height 10cm height bla bla

\hrule sidth 10cm height 10cm \relax height bla bla

> Maybe it's too late now for changing...

there has been more drastic changes; also, most users use cpackaged macros for 
that so it's a one place change (if needed at all); users who depend on space 
being present in deep down hidden primitive usage are in danger anyway

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oberdiek at uni-freiburg.de  Sat May 28 00:39:58 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sat May 28 00:40:24 2005
Subject: [NTG-pdftex] pdftex-20050526: spurious blanks after keywords
In-Reply-To: <Pine.LNX.4.61.0505272202500.4075@hahepc1.hahe>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz>
	<Pine.LNX.4.61.0505271517180.3991@hahepc1.hahe>
	<Pine.LNX.4.61.0505271717300.23992@hahepc1.hahe>
	<429761E4.8040109@wxs.nl>
	<Pine.LNX.4.61.0505272202500.4075@hahepc1.hahe>
Message-ID: <20050527223957.GA4955@m0A023219.vpn.uni-freiburg.de>

On Fri, May 27, 2005 at 10:30:58PM +0200, Hartmut Henkel wrote:

> On Fri, 27 May 2005, Hans Hagen wrote:
> 
> > Hartmut Henkel wrote:
> > > Here is a test file that shows spurious blanks after keywords:
> > >
> > >
> > > ---\pdffontexpand\font 25 25 5 autoexpand---
> > >
> > > ---\pdfobj reserveobjnum ---
> > >
> > > ---\pdfdest num1 fitbh ---
> > >
> > > ---\pdfstartlink goto file{file.pdf} page 1{/FitB}newwindow A\pdfendlink ---

> > but pdftex is the only one using keywords without anything behind it
> > so the patch fits into tex's paradigm
> 
> yes --- but meanwhile i fear that it might cause complaints from people
> actively using these blanks in running text (mainly \pdfdest; the others
> might be harmless as they are still rather new).
> 
> Would be interesting to know where it might give problems with
> LaTeX/hyperref.

I have now added \relax after the use of \pdfdest and
after \pdfstartlink to be safe in case of future extensions.
"reserveobjnum" and \pdffontexpand is not used in hyperref.

> Maybe it's too late now for changing...

I do not mind. Better a clear interface than something confusing.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From noreply at sarovar.org  Sat May 28 00:46:12 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat May 28 00:51:53 2005
Subject: [NTG-pdftex] [ pdftex-Feature Requests-354 ] pdftex-syntax.html
Message-ID: <E1Dbnam-0008Al-00@sarovar.org>

Feature Requests item #354, was opened at 2005-05-28 00:46
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=354&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: pdftex-syntax.html

Initial Comment:
Hello,

I have written some scripts to convert
the syntax of pdfTeX into XHTML with
non-terminals as links.

Makefile rules:

pdftex-syntax.xml: pdftex-t.tex syntax-xml.pl
        ./syntax-xml.pl $<

pdftex-syntax.html: pdftex-syntax.xsl syntax-html.xml
        xsltproc -o $@ $+

The .tar archive contains:
* syntax-xml.pl: Perl script that uses
    pdftex-t.tex as input and generates
    pdftex-syntax.xml
* pdftex-syntax.xml: The generated XML file
* pdftex-syntax.dtd: DTD for pdftex-syntax.xml
* syntax-html.xsl: XSLT stylesheet for
    generating pdftex-syntax.html
* pdftex-syntax.html: The generated HTML file
* syntax-html.css: Cascading stylesheet for
    HTMl file

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=354&group_id=106
From noreply at sarovar.org  Sat May 28 01:29:35 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat May 28 01:35:51 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-345 ] pdftex-syntax.txt: typo in \pdfobj
Message-ID: <E1DboGl-0001Fn-00@sarovar.org>

Bugs item #345, was opened at 2005-05-17 15:01
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=345&group_id=106

Category: Documentation
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Hartmut Henkel (hhenkel)
Summary: pdftex-syntax.txt: typo in \pdfobj

Initial Comment:
Hello,

the rules for \pdfobj in
  texk/web2c/pdftexdir/pdftex-syntax.txt
are wrong:

\pdfobj <object type spec>
<object type spec> --> reserveobjnum
                     | [useobjnum <number>]
                       [<attr spec>]
                       [stream [<attr spec>]]
                       <object contents>
<object contents> --> <file spec>
                    | <general text>

The first [<attr spec>] should be removed.
Result:
...
<object type spec> --> reserveobjnum
                     | [useobjnum <number>]
                       [stream [<attr spec>]]
                       <object contents>
Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

PS: A little surprised that the file has DOS line
    endings.

----------------------------------------------------------------------

>Comment By: Heiko Oberdiek (oberdiek)
Date: 2005-05-28 01:29

Message:
Logged In: YES 
user_id=1276

Hello,

the attached file also fixes other errors and typos
in syntax descriptions.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=345&group_id=106
From hanthethanh at myrealbox.com  Fri May 27 10:28:36 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat May 28 05:16:27 2005
Subject: [NTG-pdftex] inclusion of PDF with hz-alg expandeded font
In-Reply-To: <429622E0.806@wxs.nl>
References: <20050524082244.GA2636@monty.localnet>
	<4qcqicw3.fsf@esemetz.metz.supelec.fr>
	<vf56gx53.fsf@esemetz.metz.supelec.fr> <4295ECA6.90309@wxs.nl>
	<429613E4.2060602@seznam.cz> <429622E0.806@wxs.nl>
Message-ID: <20050527082836.GA2516@monty.localnet>

I use the following macro to produce one-page

,--------
| \newbox\epdfbox
| 
| % mkepdf{hmargin}{vmargin}{text}
| \long\def\mkepdf#1#2#3{%
|     \pdfhorigin=1sp
|     \advance \pdfhorigin #1
|     \pdfvorigin=1sp
|     \advance \pdfvorigin #2
|     \setbox\epdfbox=\vbox{#3}
|     \pdfpagewidth=\wd\epdfbox
|     \advance \pdfpagewidth 2\pdfhorigin
|     \pdfpageheight=\ht\epdfbox
|     \advance \pdfpageheight \dp\epdfbox
|     \advance \pdfpageheight 2\pdfvorigin
|     \shipout\box\epdfbox
| }
`--------

Usage:

\mkepdf{1bp}{1bp}{\hbox{Hello, world!}}

or

\mkepdf{1bp}{1bp}{%
    \hsize=3in
    \input foo.tex
    \par
}

HTH,
Thanh
From hanthethanh at myrealbox.com  Sat May 28 12:38:31 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat May 28 12:40:43 2005
Subject: [NTG-pdftex] another snapshot
Message-ID: <20050528103831.GA2577@monty.localnet>

Hi,

I have uploaded another snapshot with the patch removing the
spurious space after some keywords by Hartmut.

Thanh
From noreply at sarovar.org  Mon May 30 19:51:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon May 30 19:57:24 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-359 ] pdftex generates errors when it
	does not have to - eg \pdfinfo 
Message-ID: <E1DcoQQ-0001FI-00@sarovar.org>

Bugs item #359, was opened at 2005-05-30 19:51
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=359&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 3
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: pdftex generates errors when it does not have to - eg \pdfinfo 

Initial Comment:

The following submitted on behalf of Jonathan Fine:


pdftex generates errors when it does not have to.

This fault prevents the build of Python docs on some
platforms.

The fix may be to remove the error-generating code?

For more details, see my posting to comp.text.tex.

Google link:
<http://groups-beta.google.com/group/comp.text.tex/msg/4b4842202ce88cda?hl=en>


Copy and paste
==============
There is, in my opinion, a problem with pdftex.

(This is not to say that the macros used could not be
improved.)

pdftex exits on \pdfinfo error.  TeX does not exit on
error.
==
$ pdftex
This is pdfTeX, Version 3.14159-1.10b (Web2C 7.4.5)
**\pdfoutput 0
{/usr/share/texmf/pdftex/config/pdftex.cfg}
*\pdfinfo
pdfTeX error (ext1): \pdfinfo used while \pdfoutput is
not set.
<*> \pdfinfo

No pages of output.
Transcript written on texput.log.
==


The present semantics of \pdfinfo are confused.
For example, I _can_ use \pdfinfo and generate dvi!

I just have to be a bit sneaky.
==
$ pdftex
This is pdfTeX, Version 3.14159-1.10b (Web2C 7.4.5)
**\pdfoutput 1
{/usr/share/texmf/pdftex/config/pdftex.cfg}
*\pdfinfo {}

*\pdfoutput 0

*\shipout\hbox{}
[1]
*\end
Output written on texput.dvi (1 page, 128 bytes).
==

Here, if pdf is not being generated, pdfinfo is ignored.

Suppose the semantics of \pdfinfo were something like:
  \pdfinfo{ ... }
  Stores information that is written to the PDF file,
  if pdftex generates a PDF file.  Otherwise ignored.

Then the error that prompted this thread would not have
occurred.

-- 

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=359&group_id=106
From noreply at sarovar.org  Mon May 30 20:05:54 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon May 30 20:11:38 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-359 ] pdftex generates errors when it
	does not have to - eg \pdfinfo 
Message-ID: <E1DcoeA-0001gK-00@sarovar.org>

Bugs item #359, was opened at 2005-05-30 19:51
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=359&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 3
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: pdftex generates errors when it does not have to - eg \pdfinfo 

Initial Comment:

The following submitted on behalf of Jonathan Fine:


pdftex generates errors when it does not have to.

This fault prevents the build of Python docs on some
platforms.

The fix may be to remove the error-generating code?

For more details, see my posting to comp.text.tex.

Google link:
<http://groups-beta.google.com/group/comp.text.tex/msg/4b4842202ce88cda?hl=en>


Copy and paste
==============
There is, in my opinion, a problem with pdftex.

(This is not to say that the macros used could not be
improved.)

pdftex exits on \pdfinfo error.  TeX does not exit on
error.
==
$ pdftex
This is pdfTeX, Version 3.14159-1.10b (Web2C 7.4.5)
**\pdfoutput 0
{/usr/share/texmf/pdftex/config/pdftex.cfg}
*\pdfinfo
pdfTeX error (ext1): \pdfinfo used while \pdfoutput is
not set.
<*> \pdfinfo

No pages of output.
Transcript written on texput.log.
==


The present semantics of \pdfinfo are confused.
For example, I _can_ use \pdfinfo and generate dvi!

I just have to be a bit sneaky.
==
$ pdftex
This is pdfTeX, Version 3.14159-1.10b (Web2C 7.4.5)
**\pdfoutput 1
{/usr/share/texmf/pdftex/config/pdftex.cfg}
*\pdfinfo {}

*\pdfoutput 0

*\shipout\hbox{}
[1]
*\end
Output written on texput.dvi (1 page, 128 bytes).
==

Here, if pdf is not being generated, pdfinfo is ignored.

Suppose the semantics of \pdfinfo were something like:
  \pdfinfo{ ... }
  Stores information that is written to the PDF file,
  if pdftex generates a PDF file.  Otherwise ignored.

Then the error that prompted this thread would not have
occurred.

-- 

----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2005-05-30 20:05

Message:
Logged In: YES 
user_id=1608

Relevant bit of code:

  procedure check_pdfoutput(s: str_number);
  begin
    if pdf_output <= 0 then begin
        print_nl("pdfTeX error (ext1): ");
        print(s);
        print(" used while \pdfoutput is not set");
        succumb;
    end;
  end

The fastest resolution, of course, is to change the test to 
"pdf_output < 0" so that the error is also generated in dvi
processing mode. 

But Jonathan's proposal is also valid, at least for
mode-independant commands like \pdfinfo. 

Or maybe generate a normal TeX error message?



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=359&group_id=106
From taco at elvenkind.com  Mon May 30 20:13:25 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon May 30 20:16:54 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-359 ] pdftex generates errors when
	it	does not have to - eg \pdfinfo
In-Reply-To: <E1DcoeA-0001gK-00@sarovar.org>
References: <E1DcoeA-0001gK-00@sarovar.org>
Message-ID: <429B57C5.6010108@elvenkind.com>



noreply@sarovar.org wrote:
 > The fastest resolution, of course, is to change the test to
 > "pdf_output < 0" so that the error is also generated in dvi
 > processing mode.

Sorry, I was being silly again. This remark is plain nonsense.
I promise I will take a holiday soon. No, really. :-/

Taco


From hanthethanh at myrealbox.com  Tue May 31 10:44:24 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jun  1 03:04:45 2005
Subject: [NTG-pdftex] rc1
Message-ID: <20050531084424.GG2519@monty.localnet>

Hi Martin,

I don't plan to upload further snapshots, so can you please
make a pretest release or some rc1?

Thanh
From hanthethanh at myrealbox.com  Tue May 31 10:43:00 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jun  1 03:04:58 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-359 ] pdftex generates errors when it
	does not have to - eg \pdfinfo
In-Reply-To: <E1DcoeA-0001gK-00@sarovar.org>
References: <E1DcoeA-0001gK-00@sarovar.org>
Message-ID: <20050531084300.GF2519@monty.localnet>

On Mon, May 30, 2005 at 11:35:54PM +0530, noreply@sarovar.org wrote:
> Suppose the semantics of \pdfinfo were something like:
>   \pdfinfo{ ... }
>   Stores information that is written to the PDF file,
>   if pdftex generates a PDF file.  Otherwise ignored.
> 
> Then the error that prompted this thread would not have
> occurred.

sounds like a good solution. It will fixed in next
release.

Thanh
