From martin at oneiros.de  Thu Dec  1 23:36:54 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Dec  2 13:41:42 2005
Subject: [NTG-pdftex] Xpdf 3.01pl1
Message-ID: <20051201223653.GA15479@lucien.oneiros.kn-bremen.de>

I'll investigate and do a 1.30.5 if needed.

Best
    Martin

----- Forwarded message from "Derek B. Noonburg" <derekn@foolabs.com> -----

Date: 1 Dec 2005 19:55:28 -0000
Message-ID: <20051201195528.27062.qmail@foolabs.com>
From: "Derek B. Noonburg" <derekn@foolabs.com>
Subject: ANNOUNCE: Xpdf 3.01pl1 - a PDF viewer for X

A new release of Xpdf is available to fix several security holes
reported by iDEFENSE (CAN-2005-3193).

The source code patch is available here:

    ftp://ftp.foolabs.com/pub/xpdf/xpdf-3.01pl1.patch

Updated binaries are available here:

    http://www.foolabs.com/xpdf/download.html

- Derek

----- End forwarded message -----

-- 
                    http://www.tm.oneiros.de
From noreply at sarovar.org  Sun Dec  4 13:59:33 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Dec  4 14:09:36 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-450 ] error copying .pfb font to pdf
Message-ID: <E1EitSn-0007Qa-00@sarovar.org>

Bugs item #450, was opened at 2005-11-09 20:33
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=450&group_id=106

Category: Fonts
Group: v1.21a
>Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Christian Heusquin (chrisheus)
Assigned to: Hartmut Henkel (hhenkel)
Summary: error copying .pfb font to pdf

Initial Comment:
I'm an user of MikTeX package (vers 2.4) and uses 
pdfLaTeX on a regular basis.

I bought a Poscript Type 1 Sabon Font family from 
Monotype and when using the italic (msbri8a.pfb) 
pdfeTex has a problem and stops writing output. The 
pdf is unusable.

I checked the .pfb and its Ok. I can use it with 
Latex but then I have other problems (graphics, and 
symbol fonts).

Here is an extract of the log file:

This is pdfeTeX, Version 3.141592-1.21a-2.2 (MiKTeX 
2.4) (preloaded format=latex 2005.11.7)  9 NOV 2005 
19:41
.
.
.

{8r.enc}<C:\localtexmf\fonts\type1\monotype\s
abon\msbr8a.pfb><C:\localtexmf\fonts\type1
\monotype\sabon\msbri8a.pfb
Warning: pdflatex (file C:\localtexmf\fonts\type1
\monotype\sabon\msbri8a.pfb): 
532 bytes more than expected were ignored

Error: pdflatex (file C:\localtexmf\fonts\type1
\monotype\sabon\msbri8a.pfb): un
expected end of file
 ==> Fatal error occurred, the output PDF file is not 
finished!

----------------------------
If you need, I have all the 
necessary .pfb, .afm, .tfm, .fd, .vf, .map, .enc, .sty
 and a short .tex file to reproduce the problem. 
Anyway I attach them so you have them if you need.

Many thanks in advance

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-11-09 23:29

Message:
Logged In: YES 
user_id=929

seems the font file msbri8a.pfb is broken. It is missing the
line

mark currentfile closefile

near the end. The other fonts in this family are ok! With
the missing line, pdftex can't find the end of the eexec
section. The above statements are normally part of any Type1
font, see the Type1 specification by Adobe.

Just compare your font with other .pfb's after disassembling
by t1disasm. Add above line at the right place, make a new
.pfb by t1asm -b and pdftex will happily use the font.

And complain to the font manufacturer! :-)

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-11-09 20:53

Message:
Logged In: YES 
user_id=929

it's likely that this is solved in a newer version. I can't
check without the font. Try to retest on 1.30.4 from MiKTeX.
Or you might send me the pack of test files to
hartmut_henkel at gmx dot de.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=450&group_id=106
From noreply at sarovar.org  Sun Dec  4 15:11:53 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Dec  4 15:21:01 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-441 ] Debug output of makecfilename
Message-ID: <E1Eiuan-0004tV-00@sarovar.org>

Bugs item #441, was opened at 2005-10-22 09:28
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=441&group_id=106

>Category: Image inclusion
>Group: v1.30.0
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: Martin Schr?der (oneiros)
Summary: Debug output of makecfilename

Initial Comment:
Hello,

since pdfTeX 1.30.4, e.g. \pdfximage prints the file
name twice, the first time stderr is used and messes
up the output, e.g.:

<screen_output lines="8">
This is pdfTeX, Version 3.141592-1.30.4 (Web2C 7.5.5)
(./test.tex (./dir.tex antrschl.jpg
 [1 <./antrschl.jpg>] console.jpg
 [1 <./console.jpg>] img002.jpg
 [1 <./img002.jp
g>]) )
Output written on test.pdf (3 pages, 451963 bytes).
Transcript written on test.log.
</screen_output>

The line break in "<.\img002.jpg>" looks funny.

The reason is some debug output in function
makecfilename of utils.c:
   fprintf(stderr, " %s\n", name);

Patch attached that removes that line.
(With comment that at least marks the incompatibiliy
introduced in 1.30.4 regarding file names, but that
is another topic).

Output after the patch is applied:

<screen_output lines="5">
This is pdfTeX, Version 3.141592-1.30.4 (Web2C 7.5.5)
(./test.tex (./dir.tex [1 <./antrschl.jpg>] [1
<./console.jpg>] [1 <./img002.jp
g>]) )
Output written on test.pdf (3 pages, 451963 bytes).
Transcript written on test.log.
</screen_output>

Perhaps the output is messed up by the web interface
of the bug report system. There should be five lines.
The funny line break in "<.img002.jpg>" is now the
normal TeX line break because of screen line.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=441&group_id=106
From noreply at sarovar.org  Sun Dec  4 15:12:14 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Dec  4 15:21:20 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-444 ] buffer overflow with \pdfmatch
Message-ID: <E1Eiub8-0004u5-00@sarovar.org>

Bugs item #444, was opened at 2005-10-29 19:24
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106

Category: None
>Group: v1.30.0
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Robert (schlcht)
>Assigned to: Martin Schr?der (oneiros)
Summary: buffer overflow with \pdfmatch

Initial Comment:
% The new \pdfmatch primitive will run into a buffer
overflow with strings
% longer than 1023 characters:
%
% (I am using 1.30.3 with Thanh's patches from
pdftex.sarovar.org/src,
% compiled under cygwin.)


\def\x{1,2,3,4,5,6,7,8,9,0,}
\def\testlist{%
  ,\x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x00,}% 1024

\ifcase\pdfmatch{,1,}{\testlist}\relax \fi

% Also, if the pattern is too long:
%\ifcase\pdfmatch{\testlist}{1}\relax \fi

\bye,
Robert.

PS: Is there a simple way to escape all regex special
characters in a string?



----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-12-04 15:12

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.5

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-29 21:08

Message:
Logged In: YES 
user_id=929

see patch to utils.c. This makes makecstring() memory grow
on demand. Also increase MAX_CSTRING_LEN in ptexmac.h to e.
g. 10000000.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106
From noreply at sarovar.org  Sun Dec  4 15:14:43 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Dec  4 15:23:40 2005
Subject: [NTG-pdftex] [ pdftex-Feature Requests-454 ] distribution: rename
	Build script
Message-ID: <E1EiudX-00050a-00@sarovar.org>

Feature Requests item #454, was opened at 2005-11-27 00:53
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=454&group_id=106

Category: None
Group: None
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Robert (schlcht)
>Assigned to: Martin Schr?der (oneiros)
Summary: distribution: rename Build script

Initial Comment:
Here is a very, very minor nuisance: In order to
compile pdftex on case-insensitive file systems like
Windows, one always has to rename the Build script
first, e.g., to Build.sh, since otherwise the directory
build/ cannot be created. 

I would suggest to rename either the script or the
build directory.

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-12-04 15:14

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.5

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=454&group_id=106
From martin at oneiros.de  Mon Dec  5 00:39:40 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Dec  5 00:40:05 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
Message-ID: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>

http://sarovar.org/download.php/846/pdftex-1.40.0-alpha-20051205.tar.bz2

I've tried to intergrate as many patches as possible:
  - 386 grow obj_tab and dest_names arrays dynamically
  - 416 new primitive pdflastlink
  - 427 Character positioning patch
  - 432 Rules in a PDF qQ group
  - 434 Remove queued map item handling
  - 438 \pdfsavepos in DVI mode
  - 443 512 zeros in Type1 fonts not copied anymore
  - 447 Don't write /Encoding for non-reencoded fonts
  - 453 Object Streams for PDF-1.5
  - take PK resolution from "pk_dpi" parameter in texmfmp.c, if
    it has not been set by the format file or by the user

It's roughly tested: The manual still compiles.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Mon Dec  5 00:43:30 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Dec  5 01:02:24 2005
Subject: [NTG-pdftex] Re: [ pdftex-Patches-415 ] various extensions and fixes
In-Reply-To: <E1EBxGP-0004E4-00@sarovar.org>
References: <E1EBxGP-0004E4-00@sarovar.org>
Message-ID: <20051204234330.GG12781@lucien.oneiros.kn-bremen.de>

On 2005-09-04 21:52:37 +0530, noreply@sarovar.org wrote:
> How to apply:
> 
> ~~~~~~~~~~~~~
> 
> cd /path/to/pdftex-1.30.0-srcdir/src/texk
> 
> patch -p1 < /path/to/pdftex-20050818.patch
> 
> cd web2c
> 
> make pdfetex

Thanh,
I have been unable to apply this patch to 1.30.5 (extra.ch
doesn't work any more) and so have not included it in
1.40.0-alpha-20051205. Please update the patch.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From hartmut_henkel at gmx.de  Mon Dec  5 01:05:23 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Dec  5 01:05:28 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
Message-ID: <Pine.LNX.4.61.0512050101110.970@hahepc1.hahe>

On Mon, 5 Dec 2005, Martin Schr?der wrote:

>   - take PK resolution from "pk_dpi" parameter in texmfmp.c, if
>     it has not been set by the format file or by the user

ooops, my mistake, it should be:

   - take PK resolution from "pk_dpi" parameter in texmf.cnf, if
     it has not been set by the format file or by the user

...and once the pk_dpi value is in texmf.cnf, also other programs can
make use of it, and there is then also no need anymore to state the
\pdfpkresolution in pdftexconfig.tex.

Regards, Hartmut
From hanthethanh at gmail.com  Mon Dec  5 04:15:33 2005
From: hanthethanh at gmail.com (Thanh Han The)
Date: Mon Dec  5 04:15:36 2005
Subject: [NTG-pdftex] Re: [ pdftex-Patches-415 ] various extensions and
	fixes
In-Reply-To: <20051204234330.GG12781@lucien.oneiros.kn-bremen.de>
References: <E1EBxGP-0004E4-00@sarovar.org>
	<20051204234330.GG12781@lucien.oneiros.kn-bremen.de>
Message-ID: <74f506dc0512041915l7ad07768hdba6d7ba670c36f9@mail.gmail.com>

thanks Martin, I will take a look at it asap. At the moment there are
still some known problems with the patch but I cannot fix them yet so
it is better to leave the patch out for the moment.

Best,
Thanh

On 12/5/05, Martin Schr?der <martin@oneiros.de> wrote:
> On 2005-09-04 21:52:37 +0530, noreply@sarovar.org wrote:
> > How to apply:
> >
> > ~~~~~~~~~~~~~
> >
> > cd /path/to/pdftex-1.30.0-srcdir/src/texk
> >
> > patch -p1 < /path/to/pdftex-20050818.patch
> >
> > cd web2c
> >
> > make pdfetex
>
> Thanh,
> I have been unable to apply this patch to 1.30.5 (extra.ch
> doesn't work any more) and so have not included it in
> 1.40.0-alpha-20051205. Please update the patch.
>
> Best
>     Martin
> --
>                     http://www.tm.oneiros.de
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
>
From jackos1 at poczta.onet.pl  Mon Dec  5 10:35:23 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Mon Dec  5 10:36:25 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
Message-ID: <439409DB.6030601@poczta.onet.pl>

Martin Schr?der napisa?(a):
> http://sarovar.org/download.php/846/pdftex-1.40.0-alpha-20051205.tar.bz2
[...]
> It's roughly tested: The manual still compiles.

But samplepdf doesn't compile.

	Runaway argument?
	! Paragraph ended before \handleMPsequence was complete.
	<to be read again>
	                   \par
	l.2

I haven't touch this part at all. Has anybody?

BR,
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From pragma at wxs.nl  Mon Dec  5 11:39:47 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Dec  5 11:39:49 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <439409DB.6030601@poczta.onet.pl>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
	<439409DB.6030601@poczta.onet.pl>
Message-ID: <439418F3.6050909@wxs.nl>

Pawel Jackowski wrote:

> Martin Schr?der napisa?(a):
>
>> http://sarovar.org/download.php/846/pdftex-1.40.0-alpha-20051205.tar.bz2
>
> [...]
>
>> It's roughly tested: The manual still compiles.
>
>
> But samplepdf doesn't compile.
>
>     Runaway argument?
>     ! Paragraph ended before \handleMPsequence was complete.
>     <to be read again>
>                        \par
>     l.2
>
> I haven't touch this part at all. Has anybody?
>

(1) maybe clean-up old mpgraph.* files
(2) maybe your format uses an old supp-pdf (somewhere else in the three) 
with a new context

there has been a change (in metafun) with regards to the amount of 
special things (jump from 1K to 10K) but this is (if i'm right) made in 
an upward compatible way

Hans
From jackos1 at poczta.onet.pl  Mon Dec  5 12:46:30 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Mon Dec  5 12:47:17 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <439418F3.6050909@wxs.nl>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
	<439409DB.6030601@poczta.onet.pl> <439418F3.6050909@wxs.nl>
Message-ID: <43942896.8080908@poczta.onet.pl>

Hi there,

>> I haven't touch this part at all. Has anybody?

Hans:
> (1) maybe clean-up old mpgraph.* files
> (2) maybe your format uses an old supp-pdf (somewhere else in the three) 
> with a new context
> 
> there has been a change (in metafun) with regards to the amount of 
> special things (jump from 1K to 10K) but this is (if i'm right) made in 
> an upward compatible way

Agh, trivial problem; cvs checkout with wrong endline characters; 
ConTeXt macro crashes on double \n. Sorry for noise. BTW, should I 
update supp-*.tex stuff? CVS/samplepdf has version 2004.10.26.

Hartmut:
> ...but it does _not_ work with \pdfobjectstreams=1:
> 
> hahe@hahepc2:~/x-sa/samplepdf$ xpdf samplepdf.pdf
> Error (706458): Illegal character <2f> in hex string
> Error (706459): Illegal character <54> in hex string
> Error (706460): Illegal character <79> in hex string
> Error (706461): Illegal character <70> in hex string
> Error (706464): Illegal character <2f> in hex string

So that is something different; my problem was surely because of 
endlines. Now I add

	\pdfobjectstreams=1

at the very begining of samplepdf.tex and the output is damaged indeed. 
Haven't look inside but crashes on Acrobat and GhostScript while 
opening. BUT even with

	\pdfobjectstreams=0 % or simply commented

the output crashes on GhostScript. Acrobat complains but manage to fix 
the problem. Tested on 1.40.0-alpha compiled with Cygwin.

BR,
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From hartmut_henkel at gmx.de  Mon Dec  5 20:28:46 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Dec  5 20:28:55 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
Message-ID: <Pine.LNX.4.61.0512052006010.24299@hahepc1.hahe>

On Mon, 5 Dec 2005, Martin Schr?der wrote:

> http://sarovar.org/download.php/846/pdftex-1.40.0-alpha-20051205.tar.bz2
>
> I've tried to intergrate as many patches as possible:
>   - 386 grow obj_tab and dest_names arrays dynamically

this 386 is not yet included, there were two conflicting patches. I will
integrate it into a fresh 453 patch.

> It's roughly tested: The manual still compiles.

As Pawe/l found, compiling samplepdf.tex leads to acroread and gs
crashes.

Reason 1: the first dictionary was written before the PDF-1.5 string.
Compare to pdf_begin_obj:


procedure pdf_begin_dict(i: integer; pdf_os: boolean); {begin a PDF
dictionary object}
begin
    check_pdfminorversion;       {<--- this line was missing}
    pdf_os_prepare_obj(i, pdf_os);

This will be repaired in the next patch.

Now comes the interesting part: The reason 2 why Acroread and gs still
crash (but not xpdf :-) ist this harmless looking object, 4 0 obj:

Hello

created by

\pdfobj{Hello}
\pdfrefobj \pdflastobj

This "object" is self-standing, not referenced from anywhere. This seems
to be completely legal in PDF-1.4. But when Acroread or gs find it
within an object stream, and everything really looks ok AFAICT, both
just choke. It works ok, when i simply write \pdfobj{(Hello)} instead of
\pdfobj{Hello}. And no hint in the PDF Reference. My guess is that when
an object stream is used, certain types are given to an object, e. g.
<<...>> or [...] or (...) which all means something, but a simple Hello
gives problems.

Anybody any idea about this? What do with such a solitary Hello?

Regards, Hartmut
From hartmut_henkel at gmx.de  Mon Dec  5 20:54:16 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Dec  5 20:54:20 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <Pine.LNX.4.61.0512052006010.24299@hahepc1.hahe>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
	<Pine.LNX.4.61.0512052006010.24299@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0512052051260.24658@hahepc1.hahe>

> It works ok, when i simply write \pdfobj{(Hello)} instead of
> \pdfobj{Hello}.

It also works ok when i write e. g. \pdfobj{99999}, maybe as this would
make sense as a /Length...

Regards, Hartmut

From hartmut_henkel at gmx.de  Mon Dec  5 21:05:27 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Dec  5 21:05:36 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <Pine.LNX.4.61.0512052051260.24658@hahepc1.hahe>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
	<Pine.LNX.4.61.0512052006010.24299@hahepc1.hahe>
	<Pine.LNX.4.61.0512052051260.24658@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0512052100290.24804@hahepc1.hahe>

ok, now it seems that \pdfobj{Hello} does not create a legal PDF object,
as it's none of the eight types described in the PDF Reference section
3.2. E. g., a cross check shows that \pdfobj{false} is ok, a boolean
value, while \pdfobj{maybe} does not work :-)

Regards, Hartmut
From jackos1 at poczta.onet.pl  Tue Dec  6 00:35:13 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Tue Dec  6 00:35:12 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <Pine.LNX.4.61.0512052100290.24804@hahepc1.hahe>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>	<Pine.LNX.4.61.0512052006010.24299@hahepc1.hahe>	<Pine.LNX.4.61.0512052051260.24658@hahepc1.hahe>
	<Pine.LNX.4.61.0512052100290.24804@hahepc1.hahe>
Message-ID: <4394CEB1.2010002@poczta.onet.pl>

Hartmut,

> ok, now it seems that \pdfobj{Hello} does not create a legal PDF object,
> as it's none of the eight types described in the PDF Reference section
> 3.2. E. g., a cross check shows that \pdfobj{false} is ok, a boolean
> value, while \pdfobj{maybe} does not work :-)

My tests show the same. An object
	10 0 obj
	Hello
	endobj
is not correct, but parsers ignores it if don't have to read it. I 
opened such a document in Acrobat and tried to save it as PDF1.5 (which 
instructs Acrobat to compress objects). Then it complains loudly.

So, in samplepdf I will replace all Hello with <<Hello>>, (Hello), 
[Hello] and make a note about the danger.

Thanks,
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From martin at oneiros.de  Tue Dec  6 00:49:27 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Dec  6 01:02:28 2005
Subject: [NTG-pdftex] [ pdftex-Patches-416 ] new primitive pdflastlink
In-Reply-To: <E1E61W8-0002Dw-00@sarovar.org>
References: <E1E61W8-0002Dw-00@sarovar.org>
Message-ID: <20051205234927.GD30743@lucien.oneiros.kn-bremen.de>

On 2005-08-19 13:12:20 +0530, noreply@sarovar.org wrote:
> This patch implements a new primitive \pdflastlink
> (analogous to \pdflastannot) which returns the object
> number of the last object created with \pdfstartlink.

I've integrated it without much looking at it. Anybody got an
opinion?

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From oberdiek at uni-freiburg.de  Tue Dec  6 09:19:09 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue Dec  6 09:19:45 2005
Subject: [NTG-pdftex] [ pdftex-Patches-416 ] new primitive pdflastlink
In-Reply-To: <20051205234927.GD30743@lucien.oneiros.kn-bremen.de>
References: <E1E61W8-0002Dw-00@sarovar.org>
	<20051205234927.GD30743@lucien.oneiros.kn-bremen.de>
Message-ID: <20051206081909.GA24743@irwin.vpn.uni-freiburg.de>

On Tue, Dec 06, 2005 at 12:49:27AM +0100, Martin Schr?der wrote:

> On 2005-08-19 13:12:20 +0530, noreply@sarovar.org wrote:
> > This patch implements a new primitive \pdflastlink
> > (analogous to \pdflastannot) which returns the object
> > number of the last object created with \pdfstartlink.
> 
> I've integrated it without much looking at it. Anybody got an
> opinion?

>From the pdftex mailing list:
| Author: Ralf Utermann
| Subject: PDF forms (revisited)
| Message-ID: <43099329.5060502@Physik.Uni-Augsburg.DE>
| [...]
| I have a uploaded a patch (#416) to sarovar which implements
| a \pdflastlink primitive. A simple example using this is
| discussed at  http://www.physik.uni-augsburg.de/~ralfu/pdf-forms/

The thread started with:
| Author: Ralf Utermann
| Subject: hyperref PDF-forms
| Message-ID: <42F22748.6050101@Physik.Uni-Augsburg.DE>
| Date: Thu, 04 Aug 2005 16:33:44 +0200
| [...]
| when I use the Form environment from hyperref with pdflatex
| I have problems to build a form with TextFields, where one
| TextField should present a result calculated from the input of
| other TextFields, like:

pdfTeX already makes the object number available for a large range
of commands: \pdfobj, \pdfannot, ...
\pdfstartlink was missing in this list and the object number
is needed, see above. I cannot find a reason for a secret
object number of the object, generated by \pdfstartlink,
thus \pdflastlink fits well in the list of primitives that
return the object number (\pdflastobj, \pdflastannot, ...).

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From w.m.l at gmx.net  Thu Dec  8 16:52:17 2005
From: w.m.l at gmx.net (w.m.l@gmx.net)
Date: Thu Dec  8 16:51:47 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
Message-ID: <439856B1.5030900@gmx.net>

On 05.12.2005 00:39, Martin Schr?der wrote:
> It's roughly tested: The manual still compiles.

I get a segfault with the following:

\pdfcompresslevel=0
\documentclass{minimal}
\usepackage{multicol}
\usepackage{hyperref}
\begin{document}
Numbers written in italic refer to the page
where the corresponding entry is described;
numbers underlined refer to the code
  \begin{multicols}{2}
    x\hyperpage{1}
  \end{multicols}
\end{document}

When changing the text above ever so slightly, it will compile, however,
there still won't be a link in the PDF. (Its object number is zero.)


Regards,
Robert.

From hartmut_henkel at gmx.de  Thu Dec  8 21:50:24 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu Dec  8 21:50:28 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <439856B1.5030900@gmx.net>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>
	<439856B1.5030900@gmx.net>
Message-ID: <Pine.LNX.4.61.0512082140450.6937@hahepc1.hahe>

Hi Robert and Ralf,

On Thu, 8 Dec 2005 w.m.l@gmx.net wrote:

> On 05.12.2005 00:39, Martin Schr?der wrote:
> > It's roughly tested: The manual still compiles.
>
> I get a segfault with the following:
>
> \pdfcompresslevel=0
> \documentclass{minimal}
> \usepackage{multicol}
> \usepackage{hyperref}
> \begin{document}
> Numbers written in italic refer to the page
> where the corresponding entry is described;
> numbers underlined refer to the code
>  \begin{multicols}{2}
>    x\hyperpage{1}
>  \end{multicols}
> \end{document}
>
> When changing the text above ever so slightly, it will compile,
> however, there still won't be a link in the PDF. (Its object number is
> zero.)

thanks for testing. Seems to be in the pdflastlink change file, somehow
related to the replacement of

    obj_annot_ptr(obj_ptr) := p;

by

    obj_annot_ptr(pdf_link_objnum(p)) := p;

in do_link(). The original made sense, as the obj_ptr was just freshly
created. But no idea what the patched code does, which does not use
obj_ptr (shouldn't it?). The macros resolved look like:

obj_annot_ptr(pdf_link_objnum(p)) := p;
obj_aux(pdf_link_objnum(p)) := p;
obj_tab[pdf_link_objnum(p)].int4 := p;
obj_tab[mem[p+6].int].int4 := p;

This is one for Ralf...

Regards, Hartmut
From martin at oneiros.de  Fri Dec  9 01:31:22 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Dec  9 01:35:02 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051208
Message-ID: <20051209003122.GA2117@lucien.oneiros.kn-bremen.de>

http://sarovar.org/download.php/850/pdftex-1.40.0-alpha-20051205-20051208.diff.gz
http://sarovar.org/download.php/851/pdftex-1.40.0-alpha-20051208.tar.bz2

- improved patches:
  - 386 grow obj_tab and dest_names arrays dynamically
  - 453 Object Streams for PDF-1.5
  - take PK resolution from "pk_dpi" parameter in  texmf.cnf, if
    it has not
    been set by the format file or by the user
- write out PDF statistics later to make them correct
- makefile target pdfetex-all.pdf for a huge file

Have fun
    Martin
-- 
                    http://www.tm.oneiros.de
From taco at elvenkind.com  Mon Dec 12 20:27:26 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon Dec 12 20:26:36 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <Pine.LNX.4.61.0512082140450.6937@hahepc1.hahe>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>	<439856B1.5030900@gmx.net>
	<Pine.LNX.4.61.0512082140450.6937@hahepc1.hahe>
Message-ID: <439DCF1E.5080609@elvenkind.com>


Hi,

Hartmut Henkel wrote:
> 
> thanks for testing. Seems to be in the pdflastlink change file, somehow
> related to the replacement of
> 
>     obj_annot_ptr(obj_ptr) := p;

I think I've found the cause of the problem, and it is not the change
file itself; that just drew another bug to the surface.

It turns out that when copying node lists, the sixth field of an annot
whatsit was never copied, and that's field that is used to store
the object number for \pdflastlink and \pdflastannot. Hence the copied
one was never properly initialized.

I've attached a new version of pdflastlink.ch that has three changes
compared to the one by Ralf:

    * The quoted bits of web are a bit larger, so it reads a bit easier
    * I've added a section of the @<Make a partial copy of the
      whatsit...@>, to copy the pdf_link_objnum() field
    * There was no need for pdf_create_obj() in do_link any more.

Cheers, Taco
-------------- next part --------------
% WEB change file to introduce pdflastlink
%
% This file is part of pdfTeX.
%
% pdfTeX is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; either version 2 of the License, or
% (at your option) any later version.
%
% pdfTeX is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with pdfTeX; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
%
% $Id: //depot/Build/source.development/TeX/texk/web2c/pdftexdir/hz.ch#15 $
%
% \pdflastlink (read-only integer)
%
% This primitive returns the object number of the last 
% object created with \pdfstartlink
%
% Tested with pdftex 1.30
% Ralf Utermann, ralf.utermann@physik.uni-augsburg.de, August 17, 2005.
%
% It turns out that when a node list is copied, the sixth field of an
% annot whatsit is not carried over to the copy. This caused crashes.
% I've added a line to copy this sixth field. Hope this is ok now.
% Taco Hoekwater. December 12, 2005
%
@x
@d pdftex_last_item_codes     = pdftex_first_rint_code + 12 {end of \pdfTeX's command codes}
@y
@d pdf_last_link_code        = pdftex_first_rint_code + 13 {code for \.{\\pdflastlink}}
@d pdftex_last_item_codes     = pdftex_first_rint_code + 13 {end of \pdfTeX's command codes}
@z

@x
primitive("pdflastannot",last_item,pdf_last_annot_code);@/
@!@:pdf_last_annot_}{\.{\\pdflastannot} primitive@>
@y
primitive("pdflastannot",last_item,pdf_last_annot_code);@/
@!@:pdf_last_annot_}{\.{\\pdflastannot} primitive@>
primitive("pdflastlink",last_item,pdf_last_link_code);@/
@!@:pdf_last_link_}{\.{\\pdflastlink} primitive@>
@z

@x
  pdf_last_annot_code:  print_esc("pdflastannot");
@y
  pdf_last_annot_code:  print_esc("pdflastannot");
  pdf_last_link_code:   print_esc("pdflastlink");
@z

@x
  pdf_last_annot_code:  cur_val := pdf_last_annot;
@y
  pdf_last_annot_code:  cur_val := pdf_last_annot;
  pdf_last_link_code:   cur_val := pdf_last_link;
@z

@x l. 14910
@d pdf_annot_objnum(#)     == mem[# + 6].int {object number of corresponding object}
@y
@d pdf_annot_objnum(#)     == mem[# + 6].int {object number of corresponding object}
@d pdf_link_objnum(#)      == mem[# + 6].int {object number of corresponding object}
@z

@x l. 31759
@ @<Implement \.{\\pdfstartlink}@>=
begin
    check_pdfoutput("\pdfstartlink", true);
    if abs(mode) = vmode then
        pdf_error("ext1", "\pdfstartlink cannot be used in vertical mode");
    new_annot_whatsit(pdf_start_link_node, pdf_annot_node_size);
    pdf_link_action(tail) := scan_action;
end
@y
@ pdflastlink needs an extra global variable
@<Glob...@>=
@!pdf_last_link: integer;

@ @<Implement \.{\\pdfstartlink}@>=
begin
    check_pdfoutput("\pdfstartlink", true);
    if abs(mode) = vmode then
        pdf_error("ext1", "\pdfstartlink cannot be used in vertical mode");
    k := pdf_new_objnum;
    new_annot_whatsit(pdf_start_link_node, pdf_annot_node_size);
    pdf_link_action(tail) := scan_action;
    pdf_link_objnum(tail) := k;
    pdf_last_link := k;
end
@z

@x l. 32444 This is a synchronization trick
@ @<Make a partial copy of the whatsit...@>=
@y
@ @<Make a partial copy of the whatsit...@>=
@z

@x
pdf_start_link_node: begin
    r := get_node(pdf_annot_node_size);
    pdf_height(r) := pdf_height(p);
    pdf_depth(r)  := pdf_depth(p);
    pdf_width(r)  := pdf_width(p);
    pdf_link_attr(r) := pdf_link_attr(p);
    if pdf_link_attr(r) <> null then
        add_token_ref(pdf_link_attr(r));
    pdf_link_action(r) := pdf_link_action(p);
    add_action_ref(pdf_link_action(r));
@y
pdf_start_link_node: begin
    r := get_node(pdf_annot_node_size);
    pdf_height(r) := pdf_height(p);
    pdf_depth(r)  := pdf_depth(p);
    pdf_width(r)  := pdf_width(p);
    pdf_link_attr(r) := pdf_link_attr(p);
    if pdf_link_attr(r) <> null then
        add_token_ref(pdf_link_attr(r));
    pdf_link_action(r) := pdf_link_action(p);
    add_action_ref(pdf_link_action(r));
    pdf_link_objnum(r) := pdf_link_objnum(p);
@z

@x l. 33040
    pdf_create_obj(obj_type_others, 0);
    obj_annot_ptr(obj_ptr) := p;
    pdf_append_list(obj_ptr)(pdf_link_list);
end;
@y
    obj_annot_ptr(pdf_link_objnum(p)) := p;
    pdf_append_list(pdf_link_objnum(p))(pdf_link_list);
end;
@z

From Ralf.Utermann at Physik.Uni-Augsburg.DE  Tue Dec 13 13:41:51 2005
From: Ralf.Utermann at Physik.Uni-Augsburg.DE (Ralf Utermann)
Date: Tue Dec 13 13:41:55 2005
Subject: [NTG-pdftex] 1.40.0-alpha-20051205
In-Reply-To: <439DCF1E.5080609@elvenkind.com>
References: <20051204233940.GF12781@lucien.oneiros.kn-bremen.de>	<439856B1.5030900@gmx.net>
	<Pine.LNX.4.61.0512082140450.6937@hahepc1.hahe>
	<439DCF1E.5080609@elvenkind.com>
Message-ID: <439EC18F.7040807@Physik.Uni-Augsburg.DE>

Hi,

Taco Hoekwater wrote:
[...]
> 
> I've attached a new version of pdflastlink.ch that has three changes
> compared to the one by Ralf:
> 
>    * The quoted bits of web are a bit larger, so it reads a bit easier
>    * I've added a section of the @<Make a partial copy of the
>      whatsit...@>, to copy the pdf_link_objnum() field
>    * There was no need for pdf_create_obj() in do_link any more.
> 
[...]
thanks a lot for looking into this and fixing it. I tested with a form file
where I need pdflastlink and it still works without problem with this new
change file.

Bye, Ralf
-- 
        Ralf Utermann
_____________________________________________________________________
        Universit?t Augsburg, Institut f?r Physik   --   EDV-Betreuer
        Universit?tsstr.1
        D-86135 Augsburg                     Phone:  +49-821-598-3231
        SMTP: Ralf.Utermann@Physik.Uni-Augsburg.DE         Fax: -3411
From martin at oneiros.de  Tue Dec 13 13:52:30 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Dec 14 09:31:57 2005
Subject: [NTG-pdftex] Roadmap
Message-ID: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>

Hi,
this weekend I've met Hans, Hartmut and Taco in Schwetzingen (we
attended the christmas party of the Darmstadt TeXies with Hermann
Zapf) and we discussed the status and future of pdfTeX.

We came down with this "roadmap":

1.40 (200603):
- all the current patches plus \primitive et.al
- cleanup the code (fewer patchfiles) to have a better starting
  point for lua
- move project to Gforge hosted by Fabrice, and setup a complete
  code repository there
- start of "pdfTeX news"

1.50
- more bits, i.e. use more than 16 (and enough) where possible

1.60 or later
- general map file handling for pdfTeX and all programs that use
  map files
- OpenType -- this requires more bits and can be done in steps
- lua -- integration can be done post 1.40, but the TeX<->Lua
  interface needs much testing and developement, so lua will stay
  experimental for quite some time

sometime (i.e. whenever it's ready)
- tagged pdf
- merging hyperlinks in included documents

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Tue Dec 13 15:40:23 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Dec 14 09:44:40 2005
Subject: [NTG-pdftex] 1.40 Schedule
In-Reply-To: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
Message-ID: <20051213144023.GF21934@lucien.oneiros.kn-bremen.de>

I propose this schedule for 1.40:
- alpha, i.e. patches for the not-cleaned-up source code till
  2006-01-15 (2006W02)
- beta, i.e. code cleanup till 2006-02-12 (2006W06)
  here we are in feature freeze and can work on the manual and
  news
- rc0 on 2006-02-20 (2006W07)
  bug hunting!
- release on 2006-03-06 (2006W09), i.e. in time for DANTE Berlin.
  We should also have moved the project to Gforge hosted by
  Fabrice, and setup a complete code repository there till then.

Comments?

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From taco at elvenkind.com  Wed Dec 14 10:05:21 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed Dec 14 10:04:18 2005
Subject: [NTG-pdftex] 1.40 Schedule
In-Reply-To: <20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
Message-ID: <439FE051.7000102@elvenkind.com>



Martin Schr?der wrote:
> I propose this schedule for 1.40:
> - alpha, i.e. patches for the not-cleaned-up source code till
>   2006-01-15 (2006W02)
> - beta, i.e. code cleanup till 2006-02-12 (2006W06)
>   here we are in feature freeze and can work on the manual and
>   news
> - rc0 on 2006-02-20 (2006W07)
>   bug hunting!
> - release on 2006-03-06 (2006W09), i.e. in time for DANTE Berlin.
>   We should also have moved the project to Gforge hosted by
>   Fabrice, and setup a complete code repository there till then.
> 
> Comments?

Martin,

At what point do you intend to flatten the web files?
My \primitive patch will be uploaded in the weekend or beginning
next week (I've been sick through monday afternoon, so I am a bit
behind, and now need to prepare for the NTG meeting upcoming friday).

Taco
From pragma at wxs.nl  Wed Dec 14 10:35:50 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Dec 14 10:35:56 2005
Subject: [NTG-pdftex] 1.40 Schedule
In-Reply-To: <20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
Message-ID: <439FE776.9000006@wxs.nl>

Martin ? wrote:

>I propose this schedule for 1.40:
>- alpha, i.e. patches for the not-cleaned-up source code till
>  2006-01-15 (2006W02)
>- beta, i.e. code cleanup till 2006-02-12 (2006W06)
>  here we are in feature freeze and can work on the manual and
>  news
>- rc0 on 2006-02-20 (2006W07)
>  bug hunting!
>- release on 2006-03-06 (2006W09), i.e. in time for DANTE Berlin.
>  We should also have moved the project to Gforge hosted by
>  Fabrice, and setup a complete code repository there till then.
>
>  
>
this includes the flattening i suppose

Hans
From martin at oneiros.de  Wed Dec 14 13:40:42 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Dec 14 13:59:20 2005
Subject: [NTG-pdftex] 1.40 Schedule
In-Reply-To: <439FE051.7000102@elvenkind.com>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
Message-ID: <20051214124042.GC1480@lucien.oneiros.kn-bremen.de>

On 2005-12-14 10:05:21 +0100, Taco Hoekwater wrote:
> Martin Schr?der wrote:
> >I propose this schedule for 1.40:
> >- alpha, i.e. patches for the not-cleaned-up source code till
> >  2006-01-15 (2006W02)
> >- beta, i.e. code cleanup till 2006-02-12 (2006W06)
> >  here we are in feature freeze and can work on the manual and
> >  news
> >- rc0 on 2006-02-20 (2006W07)
> >  bug hunting!
> >- release on 2006-03-06 (2006W09), i.e. in time for DANTE Berlin.
> >  We should also have moved the project to Gforge hosted by
> >  Fabrice, and setup a complete code repository there till then.
> >
> >Comments?
> 
> At what point do you intend to flatten the web files?

Starting with beta, i.e. after 2006-01-15.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From pragma at wxs.nl  Wed Dec 14 14:29:06 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Dec 14 14:29:13 2005
Subject: [NTG-pdftex] Roadmap
In-Reply-To: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
Message-ID: <43A01E22.7070401@wxs.nl>

Martin ? wrote:

>Hi,
>this weekend I've met Hans, Hartmut and Taco in Schwetzingen (we
>attended the christmas party of the Darmstadt TeXies with Hermann
>Zapf) and we discussed the status and future of pdfTeX.
>
>We came down with this "roadmap":
>
>1.40 (200603):
>- all the current patches plus \primitive et.al
>- cleanup the code (fewer patchfiles) to have a better starting
>  point for lua
>- move project to Gforge hosted by Fabrice, and setup a complete
>  code repository there
>- start of "pdfTeX news"
>  
>

maybe also add hz support for ttf fonts

(currently limited to type1; why?)

Hans
From reinhard.kotucha at web.de  Thu Dec 15 06:04:27 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu Dec 15 06:04:35 2005
Subject: [NTG-pdftex] Roadmap
In-Reply-To: <43A01E22.7070401@wxs.nl>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<43A01E22.7070401@wxs.nl>
Message-ID: <17312.63835.943200.595156@zarniwoop.ms25.local>

>>>>> "Hans" == Hans Hagen <pragma@wxs.nl> writes:

  > maybe also add hz support for ttf fonts

  > (currently limited to type1; why?)

The hz algorithm changes the FontMatrix of the font.  The FontMatrix
is a property of a Type1 font.  If you want to do it in a more general
way you have to change the PDF text matrix.  But though this had been
done in dvipdfm, it's not easy.

BTW., for the same reason ExtendFont and SlantFont do not work with TTF.

Changing the text matrix would be better because currently a font is
included more than once if font expansion is used.

There is another nasty thing: CFF fonts can have a single font with
different font matrices, but there is a restriction in the PDF spec
which allows only one FontMatrix for a particular CFF font.

Changing the text matrix would have a few advantages:

  * The file size will be significantly smaller.  This did not matter
    in the past because very few people used font expansion, but with
    the advent of \autoexpand and microtype.sty it will affect many
    files now.

  * ExtendFont and SlantFont will work with TTF fonts as well.

  * If dvi output is required, pdftex can insert a \special which
    changes PostScript's matrix in a similar way as it does it for pdf
    output.  This will not work for TTF in dvips, though.

Hans, you are the second one who asked (I asked Thanh a few years
ago), so I think that the priority is not very high.

I think that it should be put on a TODO list.  I also recommend to
look into Mark Wick's sources.  He already solved this problem.

What is needed to make dvips able to process TTF?  If no subsetting is
required, will dvips be able to deal with Type42?  Type42 can be
created from TTF on-the-fly.  Is it difficult to insert the pdftex TTF
subsetting code into dvips?

It is useful to care about dvi output and dvips because many people
ask how to use psfrag and using dvips -E and epstopdf is a simple
solution.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From pragma at wxs.nl  Thu Dec 15 16:44:47 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 15 16:44:50 2005
Subject: [NTG-pdftex] Roadmap
In-Reply-To: <17312.63835.943200.595156@zarniwoop.ms25.local>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<43A01E22.7070401@wxs.nl>
	<17312.63835.943200.595156@zarniwoop.ms25.local>
Message-ID: <43A18F6F.4010301@wxs.nl>

Reinhard Kotucha wrote:

>Hans, you are the second one who asked (I asked Thanh a few years
>ago), so I think that the priority is not very high.
>  
>
well, how about deciding now that it has a high priority; we need to go 
that direction anyway because soon open type will take over

also, as you say, now that pdftex generates the instances itself, hz has 
become feasible

also, when you and i want it, it becomes hard for thanh to ignore it -)

since thanh is 'on leave' maybe hartmut sees it as a challenge  ...

btw, thanks for the explanation

Hans

From reinhard.kotucha at web.de  Sun Dec 18 04:50:15 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun Dec 18 04:50:22 2005
Subject: [NTG-pdftex] Roadmap
In-Reply-To: <43A18F6F.4010301@wxs.nl>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<43A01E22.7070401@wxs.nl>
	<17312.63835.943200.595156@zarniwoop.ms25.local>
	<43A18F6F.4010301@wxs.nl>
Message-ID: <17316.56439.563222.152620@zarniwoop.ms25.local>

>>>>> "Hans" == Hans Hagen <pragma@wxs.nl> writes:

  > Reinhard Kotucha wrote:
  >> Hans, you are the second one who asked (I asked Thanh a few years
  >> ago), so I think that the priority is not very high.
  >> 
  >> 
  > well, how about deciding now that it has a high priority; we need
  > to go that direction anyway because soon open type will take over

  > also, as you say, now that pdftex generates the instances itself,
  > hz has become feasible

  > also, when you and i want it, it becomes hard for thanh to ignore
  > it -)

Thanh didn't ignore it, I asked at a time (spring 2002) when he had
absolutely no time to work on pdftex.

But I remember that we also spoke about problems like rounding errors,
especially when fonts with different transformation matrices are
nested.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From noreply at sarovar.org  Mon Dec 19 00:38:18 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Dec 19 00:47:20 2005
Subject: [NTG-pdftex] 
	[ pdftex-Feature Requests-87 ] In case of fatal errors,
	delete the output file
Message-ID: <E1Eo86c-0001Zq-00@sarovar.org>

Feature Requests item #87, was opened at 2004-07-02 11:13
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=87&group_id=106

Category: None
Group: v1.21
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
>Assigned to: Martin Schr?der (oneiros)
Summary: In case of fatal errors, delete the output file

Initial Comment:
When pdfTeX currently encounters a fatal error, it
closes it's output file, which leads to
incomplete/corrupt files.

pdfTeX should produce only valid files, and in case of
fatal errors the output should be deleted.

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-12-19 00:38

Message:
Logged In: YES 
user_id=421

The attached patch unlinks the current file, if a fatal
error happens. Currently this is done without any checks,
and may be a security problem.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2004-07-02 14:35

Message:
Logged In: YES 
user_id=1608

When you truncate a file, the result is an empty file. From
a user's viewpoint, that is not the same thing as a corrupt
PDF. 
The distinction is small, but the advantage of an empty file is
that it is not likely to be confused for a correct PDF.

If it is possible, then deleting the PDF file is definately
better, but file deletion doesn't always work. Truncation
almost always does work, and it's only two syscalls extra,
so why not?


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-07-02 14:21

Message:
Logged In: YES 
user_id=421

Simply truncating a pdf still makes it invalid (because the
file structure is incomplete). Producing a valid truncated
output file in case of fatal errors will be tricky and not
always possible. Deleting the corrupt output is much easier.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2004-07-02 13:50

Message:
Logged In: YES 
user_id=1608

If deleting the file doesnt work, truncation is probably
still better than nothing. (?)

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=87&group_id=106
From martin at oneiros.de  Mon Dec 19 01:01:19 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Dec 19 01:02:37 2005
Subject: [NTG-pdftex] Re: [ pdftex-Feature Requests-87 ] In case of fatal
	errors, delete the output file
In-Reply-To: <E1Eo86c-0001Zq-00@sarovar.org>
References: <E1Eo86c-0001Zq-00@sarovar.org>
Message-ID: <20051219000119.GA19949@lucien.oneiros.kn-bremen.de>

On 2005-12-19 05:08:18 +0530, noreply@sarovar.org wrote:
> Initial Comment:
> When pdfTeX currently encounters a fatal error, it
> 
> closes it's output file, which leads to
> 
> incomplete/corrupt files.
> 
> 
> 
> pdfTeX should produce only valid files, and in case of
> 
> fatal errors the output should be deleted.
> 
> ----------------------------------------------------------------------
> 
> >Comment By: Martin Schr?der (oneiros)
> Date: 2005-12-19 00:38
> 
> Message:
> Logged In: YES 
> user_id=421
> 
> The attached patch unlinks the current file, if a fatal
> 
> error happens. Currently this is done without any checks,
> 
> and may be a security problem.

The patch does this:

    if (outputfilename) {
        xfclose(pdffile, makecstring(outputfilename));
        unlink (makecstring(outputfilename));
    }

How safe is this? And how safe is this for TeX security wise? And
is there a better way?

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From pragma at wxs.nl  Mon Dec 19 14:16:49 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Dec 19 14:16:52 2005
Subject: [NTG-pdftex] various features 
Message-ID: <43A6B2C1.2090607@wxs.nl>

Hi,

Are all Than's recent patches included? Like the \pdfprependkern and 
alike stuff?

Hans
From oberdiek at uni-freiburg.de  Mon Dec 19 14:13:27 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Mon Dec 19 14:28:42 2005
Subject: [NTG-pdftex] Re: [ pdftex-Feature Requests-87 ] In case of fatal
	errors, delete the output file
In-Reply-To: <20051219000119.GA19949@lucien.oneiros.kn-bremen.de>
References: <E1Eo86c-0001Zq-00@sarovar.org>
	<20051219000119.GA19949@lucien.oneiros.kn-bremen.de>
Message-ID: <20051219131327.GA4169@irwin.vpn.uni-freiburg.de>

Hello,

On Mon, Dec 19, 2005 at 01:01:19AM +0100, Martin Schr?der wrote:

> > The attached patch unlinks the current file, if a fatal
> > 
> > error happens. Currently this is done without any checks,
> > 
> > and may be a security problem.
> 
> The patch does this:
> 
>     if (outputfilename) {
>         xfclose(pdffile, makecstring(outputfilename));
>         unlink (makecstring(outputfilename));
>     }
> 
> How safe is this? And how safe is this for TeX security wise? And
> is there a better way?

Perhaps it is more safe, if pdfTeX deletes the file only if it
was successfully opened for writing before to ensure that the
file that pdfTeX removes was generated by pdfTeX before.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From martin at oneiros.de  Mon Dec 19 18:57:04 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Dec 19 19:06:06 2005
Subject: [NTG-pdftex] various features
In-Reply-To: <43A6B2C1.2090607@wxs.nl>
References: <43A6B2C1.2090607@wxs.nl>
Message-ID: <20051219175704.GB29310@lucien.oneiros.kn-bremen.de>

On 2005-12-19 14:16:49 +0100, Hans Hagen wrote:
> Are all Than's recent patches included? Like the \pdfprependkern and 
> alike stuff?

No. But I included all I got.

Thanh?

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From pragma at wxs.nl  Mon Dec 19 20:57:29 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Dec 19 20:58:59 2005
Subject: [NTG-pdftex] various features
In-Reply-To: <20051219175704.GB29310@lucien.oneiros.kn-bremen.de>
References: <43A6B2C1.2090607@wxs.nl>
	<20051219175704.GB29310@lucien.oneiros.kn-bremen.de>
Message-ID: <43A710A9.2030506@wxs.nl>

Martin ? wrote:

>On 2005-12-19 14:16:49 +0100, Hans Hagen wrote:
>  
>
>>Are all Than's recent patches included? Like the \pdfprependkern and 
>>alike stuff?
>>    
>>
>
>No. But I included all I got.
>
>Thanh?
>  
>

ah, i thought that those features were also for the recent tex-live 
release; this pre/post char kerning stuff and such

let's hope that the code didn't get lost (months ago i tested with the 
djgpp binary on thanh's site)

Hans
From olaf at infovore.xs4all.nl  Mon Dec 19 21:58:42 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Mon Dec 19 21:58:47 2005
Subject: [NTG-pdftex] Re: [ pdftex-Feature Requests-87 ] In case of fatal
	errors, delete the output file
In-Reply-To: <20051219131327.GA4169@irwin.vpn.uni-freiburg.de> (Heiko
	Oberdiek's message of "Mon, 19 Dec 2005 14:13:27 +0100")
References: <E1Eo86c-0001Zq-00@sarovar.org>
	<20051219000119.GA19949@lucien.oneiros.kn-bremen.de>
	<20051219131327.GA4169@irwin.vpn.uni-freiburg.de>
Message-ID: <878xugkdml.fsf@infovore.xs4all.nl>

Heiko Oberdiek writes:
> Hello,
> On Mon, Dec 19, 2005 at 01:01:19AM +0100, Martin Schr?der wrote:

>> > The attached patch unlinks the current file, if a fatal
>> > 
>> > error happens. Currently this is done without any checks,
>> > 
>> > and may be a security problem.
>> 
>> The patch does this:
>> 
>> if (outputfilename) {
>> 	xfclose(pdffile, makecstring(outputfilename));
>> 	unlink (makecstring(outputfilename));
>> }
>> 
>> How safe is this? And how safe is this for TeX security wise? And
>> is there a better way?

> Perhaps it is more safe, if pdfTeX deletes the file only if it
> was successfully opened for writing before to ensure that the
> file that pdfTeX removes was generated by pdfTeX before.

For portability, use remove(3) instead of unlink(2).  If the file came
out of xfopen, then we're already assured that pdftex opened it for
writing, so it should definitely be ours to remove.  I don't see
security issues here (they'd have to be dealt with at the point where
the file is opened).

-- 
Olaf Weber

               (This space left blank for technical reasons.)

From kakuto at fsci.fuk.kindai.ac.jp  Tue Dec 20 02:17:50 2005
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Tue Dec 20 02:18:12 2005
Subject: [NTG-pdftex] various features
In-Reply-To: Your message of "Mon, 19 Dec 2005 18:57:04 +0100"
References: <20051219175704.GB29310@lucien.oneiros.kn-bremen.de>
Message-ID: <200512200117.jBK1HqUV026048@jupiter.fsci.fuk.kindai.ac.jp>

> On 2005-12-19 14:16:49 +0100, Hans Hagen wrote:
> > Are all Than's recent patches included? Like the \pdfprependkern and 
> > alike stuff?
> 
> No. But I included all I got.
> 
> Thanh?

http://pdftex.sarovar.org/src/pdftex-20050924.patch.gz

Please include the above patch by Thanh
which defines \pdfprependkern etc.
I'm personally using the subfont mechanism
in the patch to typeset Japanese.
The patch is for 1.30.3. So some hand work will be needed.

Thanks,
Akira
From martin at oneiros.de  Tue Dec 20 01:30:37 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Dec 20 07:54:43 2005
Subject: [NTG-pdftex] Re: [ pdftex-Feature Requests-87 ] In case of fatal
	errors, delete the output file
In-Reply-To: <878xugkdml.fsf@infovore.xs4all.nl>
References: <E1Eo86c-0001Zq-00@sarovar.org>
	<20051219000119.GA19949@lucien.oneiros.kn-bremen.de>
	<20051219131327.GA4169@irwin.vpn.uni-freiburg.de>
	<878xugkdml.fsf@infovore.xs4all.nl>
Message-ID: <20051220003037.GN29310@lucien.oneiros.kn-bremen.de>

On 2005-12-19 21:58:42 +0100, Olaf Weber wrote:
> For portability, use remove(3) instead of unlink(2).  If the file came

Ah yes. Done.

> out of xfopen, then we're already assured that pdftex opened it for
> writing, so it should definitely be ours to remove.  I don't see
> security issues here (they'd have to be dealt with at the point where
> the file is opened).

Good. Btw: exit(3) or abort(3)?

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From jackos1 at poczta.onet.pl  Mon Dec 19 23:03:18 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Tue Dec 20 10:15:15 2005
Subject: [NTG-pdftex] doc gaps
Message-ID: <43A72E26.2000005@poczta.onet.pl>

Hi,

three things, I suppose, already established in releases but not documented:

-- regexp support
-- string comparison
-- `page' modifier for \pdfliteral

Experimental?
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From oberdiek at uni-freiburg.de  Tue Dec 20 12:18:40 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue Dec 20 12:34:48 2005
Subject: [NTG-pdftex] doc gaps
In-Reply-To: <43A72E26.2000005@poczta.onet.pl>
References: <43A72E26.2000005@poczta.onet.pl>
Message-ID: <20051220111840.GA16739@irwin.vpn.uni-freiburg.de>

On Mon, Dec 19, 2005 at 11:03:18PM +0100, Pawel Jackowski wrote:

> Hi,
> 
> three things, I suppose, already established in releases but not documented:
> 
> -- regexp support
> -- string comparison
> -- `page' modifier for \pdfliteral
> 
> Experimental?

* regexp: yes
There are some todos, last summer I have experimented with
pcre, this would add more features, but the syntax will probably
changed. Also a "replace" would be useful.

* string comparison
The open issue was that it would be nicer and more TeX like
if \pdfstrcmp would act as readonly integer register than
returning the result numbers as string.

As readonly register you can safely write:
  \ifcase\pdfstrcmp{a}{a}1\or 2\fi
The result would be "1". Currenty \pdfstrcmp expands to "0"
and \ifcase then sees "01\or...", the result is "2".

Therefore it is probably to implement it as readonly
integer or decide not to do thus before documenting.

* \pdfliteral with `page'?
I don't know this feature.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From pragma at wxs.nl  Tue Dec 20 13:25:27 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Dec 20 13:25:32 2005
Subject: [NTG-pdftex] doc gaps
In-Reply-To: <20051220111840.GA16739@irwin.vpn.uni-freiburg.de>
References: <43A72E26.2000005@poczta.onet.pl>
	<20051220111840.GA16739@irwin.vpn.uni-freiburg.de>
Message-ID: <43A7F837.5060100@wxs.nl>

Heiko Oberdiek wrote:

>
>* \pdfliteral with `page'?
>I don't know this feature.
>  
>

this is related to the save/restore and cm issues, and is also part of 
the literal optimization (hartmut's speciality)

Hans
From martin at oneiros.de  Tue Dec 20 13:10:13 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Dec 20 13:27:51 2005
Subject: [NTG-pdftex] doc gaps
In-Reply-To: <43A72E26.2000005@poczta.onet.pl>
References: <43A72E26.2000005@poczta.onet.pl>
Message-ID: <20051220121012.GB7038@lucien.oneiros.kn-bremen.de>

On 2005-12-19 23:03:18 +0100, Pawel Jackowski wrote:
> three things, I suppose, already established in releases but not documented:
> -- regexp support

Marked as experimental in NEWS.

> -- string comparison

Marked as experimental in NEWS.

> -- `page' modifier for \pdfliteral

Documentation missing.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From jackos1 at poczta.onet.pl  Tue Dec 20 16:38:07 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Tue Dec 20 17:28:55 2005
Subject: [NTG-pdftex] doc gaps
In-Reply-To: <43A7F837.5060100@wxs.nl>
References: <43A72E26.2000005@poczta.onet.pl>	<20051220111840.GA16739@irwin.vpn.uni-freiburg.de>
	<43A7F837.5060100@wxs.nl>
Message-ID: <43A8255F.2090605@poczta.onet.pl>

Ok, thanks for comments. I've described

	\pdfliteral page

stuff. Also a new syntax item added;

	\pdfliteral [<pdfliteral spec>] <general text>
	pdfliteral spec -> direct | page

Please check if consistent.

BR,
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From hartmut_henkel at gmx.de  Tue Dec 20 22:36:40 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Dec 20 22:36:49 2005
Subject: [NTG-pdftex] doc gaps
In-Reply-To: <20051220121012.GB7038@lucien.oneiros.kn-bremen.de>
References: <43A72E26.2000005@poczta.onet.pl>
	<20051220121012.GB7038@lucien.oneiros.kn-bremen.de>
Message-ID: <Pine.LNX.4.61.0512202234450.4024@hahepc1.hahe>

On Tue, 20 Dec 2005, Martin Schr?der wrote:

> On 2005-12-19 23:03:18 +0100, Pawel Jackowski wrote:
>
> > -- `page' modifier for \pdfliteral
>
> Documentation missing.

yes, it's experimental as the new hz textmatrix stuff might interfere
with it. Stay tuned...

Regards, Hartmut
From martin at oneiros.de  Wed Dec 21 00:33:45 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Dec 21 00:35:04 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051221
Message-ID: <20051220233345.GB11973@lucien.oneiros.kn-bremen.de>

http://sarovar.org/download.php/866/pdftex-1.40.0-alpha-20051208-20051221.diff.gz
http://sarovar.org/download.php/867/pdftex-1.40.0-alpha-20051221.tar.bz2

- has a large patch from Thanh
- pdflastlink has been fixed
- remove generated pdf in case of fatal error

Have fun
    Martin
-- 
                    http://www.tm.oneiros.de
From w.m.l at gmx.net  Wed Dec 21 14:03:57 2005
From: w.m.l at gmx.net (w.m.l@gmx.net)
Date: Wed Dec 21 14:03:18 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051221
In-Reply-To: <20051220233345.GB11973@lucien.oneiros.kn-bremen.de>
References: <20051220233345.GB11973@lucien.oneiros.kn-bremen.de>
Message-ID: <43A952BD.70007@gmx.net>

On 21.12.2005 00:33, Martin Schr?der wrote:
> - has a large patch from Thanh

Very nice to see this included!
Here is my bug collection for the new extensions:

%-----------------------------------------------------
% 1) "This can't happen (flushing)" with
%     kerning+expansion+ligatures:
%-----------------------------------------------------
\pdfadjustspacing=1
\pdffontexpand\font 20 20 4 autoexpand
\pdfappendkern=1
\knaccode\font`i=100

\hsize10em
foo fii foo foo foo foo
%% but this works:
%foo f{}ii foo foo foo foo
\bye
%-----------------------------------------------------


%-----------------------------------------------------
% 2) kerning will prevent hyphenation
%    (this is a major drawback, IMHO)
%-----------------------------------------------------
\showhyphens{pdftex}
{
  \pdfprependkern=1
  \knbccode\font`e=100
  \showhyphens{pdftex}
}
{
  \pdfappendkern=1
  \knaccode\font`e=100
  \showhyphens{pdftex}
}
\bye
%-----------------------------------------------------


%-----------------------------------------------------
% 3) no kerning before or after ligatures:
%-----------------------------------------------------
\pdfprependkern=1
\pdfappendkern=1
\def\setkn#1{%
   \knbccode\font #1 = 200\relax
   \knaccode\font #1 = 200\relax
}
\setkn{`a}
\setkn{11} % ff
\setkn{12} % fi
\setkn{`z}

afffiz\par
a\char11 \char12 z
\bye
%-----------------------------------------------------


%-----------------------------------------------------
% 4) appending a kern prevents addititonal spacing:
%-----------------------------------------------------
\pdfadjustinterwordglue=1
\knbscode\font`\e=1000

The test

\pdfappendkern=1
\knaccode\font`\e=1

The test
\bye
%-----------------------------------------------------

That's it ;-)


Best regards,
Robert.
From hartmut_henkel at gmx.de  Wed Dec 21 21:16:32 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed Dec 21 21:16:36 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
Message-ID: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>

following trivial observation i made (several runs):

$ time pdfetex samplepdf

real    0m2.536s
real    0m2.605s
real    0m2.737s
real    0m2.654s

$ time pdfetex samplepdf | buffer

real    0m0.900s
real    0m1.035s
real    0m0.900s
real    0m0.913s

the speed gain is impressive here, also with other files from daily
business and for longer runs. Same if i write

$ pdfetex samplepdf > xxx

So at least here pdfetex spends lots of time just for unbuffered talk to
the terminal. And it's faster with a smaller window.

Maybe we should think of implementing buffered writing? See e. g. man 3
setbuf. The problem is that it should fflush() in case of errors and
switch to unbuffered. And maybe it should fflush() also after a certain
time of say 0.5 s, which would require select().

Has anybody similar statistics?

Regards, Hartmut
From jackos1 at poczta.onet.pl  Wed Dec 21 23:24:45 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Wed Dec 21 23:26:41 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
Message-ID: <43A9D62D.8050308@poczta.onet.pl>

> following trivial observation i made (several runs)[...]
> Has anybody similar statistics?

Just another trivial observation, that in dosish os displaying is even 
more expensive.
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From martin at oneiros.de  Thu Dec 22 00:05:56 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Dec 22 01:03:48 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
Message-ID: <20051221230556.GC20609@lucien.oneiros.kn-bremen.de>

On 2005-12-21 21:16:32 +0100, Hartmut Henkel wrote:
> So at least here pdfetex spends lots of time just for unbuffered talk to
> the terminal. And it's faster with a smaller window.

If you want speed, use \batchmode.

> Maybe we should think of implementing buffered writing? See e. g. man 3
> setbuf. The problem is that it should fflush() in case of errors and
> switch to unbuffered. And maybe it should fflush() also after a certain
> time of say 0.5 s, which would require select().

Using buffered terminal output would IMHO seriously change the
appearance of TeX, so no.

Best
    Martin 
-- 
                    http://www.tm.oneiros.de
From pragma at wxs.nl  Thu Dec 22 10:39:06 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 22 10:39:09 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
Message-ID: <43AA743A.5010101@wxs.nl>

Hartmut Henkel wrote:

>following trivial observation i made (several runs):
>
>$ time pdfetex samplepdf
>
>real    0m2.536s
>real    0m2.605s
>real    0m2.737s
>real    0m2.654s
>
>$ time pdfetex samplepdf | buffer
>
>real    0m0.900s
>real    0m1.035s
>real    0m0.900s
>real    0m0.913s
>
>the speed gain is impressive here, also with other files from daily
>business and for longer runs. Same if i write
>
>$ pdfetex samplepdf > xxx
>
>So at least here pdfetex spends lots of time just for unbuffered talk to
>the terminal. And it's faster with a smaller window.
>
>Maybe we should think of implementing buffered writing? See e. g. man 3
>setbuf. The problem is that it should fflush() in case of errors and
>switch to unbuffered. And maybe it should fflush() also after a certain
>time of say 0.5 s, which would require select().
>
>Has anybody similar statistics?
>  
>
it is a known fact that the speed depends on the kind of terminal; when 
one has a console that uses outline fonts or is graphical in nature 
(e.g. on the mac) the penalty can be huge; try batchmode -)

on my machine (windows xp) the size of the windows does not matter that 
much (i use 5000 line scrollbacks)

maybe this 'locale' thing is interfering as well?

are chars written one by one or by line? maybe there is some 
intermediate way possible:

- normal messages -> buffered
- immediate/write16 -> flush pending messages and write unbuffered

(btw, in your case, i'd try to optimize the terminal fonts; did you 
compare pdfetex with e.g. compiling pdftex?)

Hans


From pragma at wxs.nl  Thu Dec 22 11:15:27 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 22 11:15:29 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <43A9D62D.8050308@poczta.onet.pl>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43A9D62D.8050308@poczta.onet.pl>
Message-ID: <43AA7CBF.2040708@wxs.nl>

Pawel Jackowski wrote:

>> following trivial observation i made (several runs)[...]
>> Has anybody similar statistics?
>
>
> Just another trivial observation, that in dosish os displaying is even 
> more expensive.

hm, not in a windows shell; it depends on the font you use!

Hans
From olaf at infovore.xs4all.nl  Thu Dec 22 11:35:29 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Thu Dec 22 11:36:05 2005
Subject: [NTG-pdftex] Re: [ pdftex-Feature Requests-87 ] In case of fatal
	errors, delete the output file
In-Reply-To: <20051220003037.GN29310@lucien.oneiros.kn-bremen.de> (Martin
	=?iso-8859-1?Q?Schr=F6der's?= message of "Tue,
	20 Dec 2005 01:30:37 +0100")
References: <E1Eo86c-0001Zq-00@sarovar.org>
	<20051219000119.GA19949@lucien.oneiros.kn-bremen.de>
	<20051219131327.GA4169@irwin.vpn.uni-freiburg.de>
	<878xugkdml.fsf@infovore.xs4all.nl>
	<20051220003037.GN29310@lucien.oneiros.kn-bremen.de>
Message-ID: <87psnp4dxq.fsf@infovore.xs4all.nl>

Martin Schr?der writes:
> On 2005-12-19 21:58:42 +0100, Olaf Weber wrote:
>> For portability, use remove(3) instead of unlink(2).  If the file came

> Ah yes. Done.

>> out of xfopen, then we're already assured that pdftex opened it for
>> writing, so it should definitely be ours to remove.  I don't see
>> security issues here (they'd have to be dealt with at the point where
>> the file is opened).

> Good. Btw: exit(3) or abort(3)?

abort(3) means "leave core dump" on many platforms.

-- 
Olaf Weber

               (This space left blank for technical reasons.)

From martin at oneiros.de  Thu Dec 22 12:50:13 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Dec 22 14:25:48 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <43AA743A.5010101@wxs.nl>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43AA743A.5010101@wxs.nl>
Message-ID: <20051222115013.GB31416@lucien.oneiros.kn-bremen.de>

On 2005-12-22 10:39:06 +0100, Hans Hagen wrote:
> are chars written one by one or by line? maybe there is some 
> intermediate way possible:
> 
> - normal messages -> buffered
> - immediate/write16 -> flush pending messages and write unbuffered

And what about [1][2]? I want to see the time between [ and 1 and
] :-)

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Thu Dec 22 14:01:50 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Dec 22 14:25:53 2005
Subject: [NTG-pdftex] C style (was: 1.40 Schedule)
In-Reply-To: <20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
Message-ID: <20051222130149.GE31416@lucien.oneiros.kn-bremen.de>

On 2005-12-14 13:40:42 +0100, Martin Schr?der wrote:
> On 2005-12-14 10:05:21 +0100, Taco Hoekwater wrote:
> > At what point do you intend to flatten the web files?
> 
> Starting with beta, i.e. after 2006-01-15.

I'd also like to unify our coding style. One easy way to do this
is to use indent(1). Any opinions on options to use? The default
(i.e. GNU coding standards) with --no-tabs seems OK to me.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Thu Dec 22 12:55:16 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Dec 22 14:25:55 2005
Subject: [NTG-pdftex] dvipdfmx (was: Roadmap)
In-Reply-To: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
Message-ID: <20051222115516.GC31416@lucien.oneiros.kn-bremen.de>

On 2005-12-13 13:52:30 +0100, Martin Schr?der wrote:
> 1.40 (200603):
> - all the current patches plus \primitive et.al
> - cleanup the code (fewer patchfiles) to have a better starting
>   point for lua
> - move project to Gforge hosted by Fabrice, and setup a complete
>   code repository there
> - start of "pdfTeX news"
> 
> 1.50
> - more bits, i.e. use more than 16 (and enough) where possible
> 
> 1.60 or later
> - general map file handling for pdfTeX and all programs that use
>   map files
> - OpenType -- this requires more bits and can be done in steps
> - lua -- integration can be done post 1.40, but the TeX<->Lua
>   interface needs much testing and developement, so lua will stay
>   experimental for quite some time
> 
> sometime (i.e. whenever it's ready)
> - tagged pdf
> - merging hyperlinks in included documents

Btw: We talked about dvipdfmx. When will pdftex have all of it's
features? I vaguely remember that we are not missing very much.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From taco at elvenkind.com  Thu Dec 22 14:41:58 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu Dec 22 14:42:01 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>	<439FE051.7000102@elvenkind.com>	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
Message-ID: <43AAAD26.4090801@elvenkind.com>



Martin Schr?der wrote:

> On 2005-12-14 13:40:42 +0100, Martin Schr?der wrote:
> 
>>On 2005-12-14 10:05:21 +0100, Taco Hoekwater wrote:
>>
>>>At what point do you intend to flatten the web files?
>>
>>Starting with beta, i.e. after 2006-01-15.
> 
> I'd also like to unify our coding style. One easy way to do this
> is to use indent(1). Any opinions on options to use? The default
> (i.e. GNU coding standards) with --no-tabs seems OK to me.

I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
function headers that break over a line, like:

   int
   main (int argv, argc**)

But I'll happily run any kind of indent command after I've finished
editting so ...

Cheers,

Taco
From pragma at wxs.nl  Thu Dec 22 15:50:46 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 22 15:51:00 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
Message-ID: <43AABD46.5040805@wxs.nl>

Martin ? wrote:

>On 2005-12-13 13:52:30 +0100, Martin Schr?der wrote:
>  
>
>>1.40 (200603):
>>- all the current patches plus \primitive et.al
>>- cleanup the code (fewer patchfiles) to have a better starting
>>  point for lua
>>- move project to Gforge hosted by Fabrice, and setup a complete
>>  code repository there
>>- start of "pdfTeX news"
>>
>>1.50
>>- more bits, i.e. use more than 16 (and enough) where possible
>>
>>1.60 or later
>>- general map file handling for pdfTeX and all programs that use
>>  map files
>>- OpenType -- this requires more bits and can be done in steps
>>- lua -- integration can be done post 1.40, but the TeX<->Lua
>>  interface needs much testing and developement, so lua will stay
>>  experimental for quite some time
>>    
>>
1.70

- take relevant bit and pieces of aleph, esp r-l typesetting so that 
pdftex+lua can replace aleph
- additional font features (beyond open type)
- lua input preprocessing (replacement for otp's)

>>sometime (i.e. whenever it's ready)
>>- tagged pdf
>>- merging hyperlinks in included documents
>>    
>>
>
>Btw: We talked about dvipdfmx. When will pdftex have all of it's
>features? I vaguely remember that we are not missing very much.
>  
>
there is this cid stuff (thanh wanted to add those unicode vectors 
automatically)

Hans

From martin at oneiros.de  Thu Dec 22 15:38:57 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Dec 22 19:02:16 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <43AAAD26.4090801@elvenkind.com>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
	<43AAAD26.4090801@elvenkind.com>
Message-ID: <20051222143857.GG31416@lucien.oneiros.kn-bremen.de>

On 2005-12-22 14:41:58 +0100, Taco Hoekwater wrote:
> Martin Schr?der wrote:
> >I'd also like to unify our coding style. One easy way to do this
> >is to use indent(1). Any opinions on options to use? The default
> >(i.e. GNU coding standards) with --no-tabs seems OK to me.
> 
> I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
> function headers that break over a line, like:
> 
>   int
>   main (int argv, argc**)
> 
> But I'll happily run any kind of indent command after I've finished
> editting so ...

I don't use emacs (or etags), so I've got no problems adding
--dont-break-procedure-type to make you happy. :-)

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From hartmut_henkel at gmx.de  Thu Dec 22 20:28:27 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu Dec 22 20:28:31 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <43AAAD26.4090801@elvenkind.com>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
	<43AAAD26.4090801@elvenkind.com>
Message-ID: <Pine.LNX.4.61.0512222024360.3943@hahepc1.hahe>

On Thu, 22 Dec 2005, Taco Hoekwater wrote:

> Martin Schr?der wrote:
>
> > On 2005-12-14 13:40:42 +0100, Martin Schr?der wrote:
> >
> > I'd also like to unify our coding style. One easy way to do this is
> > to use indent(1). Any opinions on options to use? The default (i.e.
> > GNU coding standards) with --no-tabs seems OK to me.
>
> I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
> function headers that break over a line, like:
>
>   int
>   main (int argv, argc**)
>
> But I'll happily run any kind of indent command after I've finished
> editting so ...

i've already started to indent everything in reach, see the remark in
the headers of some of pdftex's .c files:

/* source code indentation by "indent -kr -nut" */

This looks quite natural: KR-mode and no tabs.

Regards, Hartmut
From vvv at vsu.ru  Thu Dec 22 20:48:17 2005
From: vvv at vsu.ru (Vladimir Volovich)
Date: Thu Dec 22 20:51:05 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <43AABD46.5040805@wxs.nl> (Hans Hagen's message of "Thu, 22 Dec
	2005 15:50:46 +0100")
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
	<43AABD46.5040805@wxs.nl>
Message-ID: <87lkycgbge.fsf@vvv.vsu.ru>

"HH" == Hans Hagen writes:

 HH> 1.70

 HH> - take relevant bit and pieces of aleph, esp r-l typesetting so
 HH> that pdftex+lua can replace aleph

also very essential part of omega/aleph are the 16-bit fonts (or even
32-bit?).

 HH> - additional font features (beyond open type) - lua input
 HH> preprocessing (replacement for otp's)

will lua provide input processing as powerful as OTPs?

Best,
v.

From pragma at wxs.nl  Thu Dec 22 22:01:18 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 22 22:01:20 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <87lkycgbge.fsf@vvv.vsu.ru>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
	<43AABD46.5040805@wxs.nl> <87lkycgbge.fsf@vvv.vsu.ru>
Message-ID: <43AB141E.40701@wxs.nl>

Vladimir Volovich wrote:

>"HH" == Hans Hagen writes:
>
> HH> 1.70
>
> HH> - take relevant bit and pieces of aleph, esp r-l typesetting so
> HH> that pdftex+lua can replace aleph
>
>also very essential part of omega/aleph are the 16-bit fonts (or even
>32-bit?).
>  
>
that's where open type comes in

> HH> - additional font features (beyond open type) - lua input
> HH> preprocessing (replacement for otp's)
>
>will lua provide input processing as powerful as OTPs?
>  
>
i dunno, but it will definitely be easier (and documented)

Hans
From vvv at vsu.ru  Thu Dec 22 22:38:19 2005
From: vvv at vsu.ru (Vladimir Volovich)
Date: Thu Dec 22 22:41:06 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <43AB141E.40701@wxs.nl> (Hans Hagen's message of "Thu, 22 Dec
	2005 22:01:18 +0100")
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
	<43AABD46.5040805@wxs.nl> <87lkycgbge.fsf@vvv.vsu.ru>
	<43AB141E.40701@wxs.nl>
Message-ID: <8764pgg6d0.fsf@vvv.vsu.ru>

"HH" == Hans Hagen writes:

 HH> - take relevant bit and pieces of aleph, esp r-l typesetting so
 HH> that pdftex+lua can replace aleph
 >> also very essential part of omega/aleph are the 16-bit fonts (or
 >> even 32-bit?).
 HH> that's where open type comes in

in my understanding it is essential to have "font 16-bitness" on the
abstract level of TeX (i.e. metric features; specific glyph
representation is very much secondary), not connected to any specific
font format like Opentype.

TeX has always been independent of physical font formats, and that is
it's strength... [and omega's 16-bit fonts are no exception]

 HH> - additional font features (beyond open type) - lua input
 HH> preprocessing (replacement for otp's)
 >>  will lua provide input processing as powerful as OTPs?
 HH> i dunno, but it will definitely be easier (and documented)

are there any preliminary considerations or descriptions of how it
will work (of course not detailed - just to understand the proposed
idea of such a replacement of OTPs)?

Best,
v.

From pragma at wxs.nl  Thu Dec 22 23:02:30 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Dec 22 23:02:31 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <8764pgg6d0.fsf@vvv.vsu.ru>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
	<43AABD46.5040805@wxs.nl> <87lkycgbge.fsf@vvv.vsu.ru>
	<43AB141E.40701@wxs.nl> <8764pgg6d0.fsf@vvv.vsu.ru>
Message-ID: <43AB2276.5030106@wxs.nl>

Vladimir Volovich wrote:

>"HH" == Hans Hagen writes:
>
> HH> - take relevant bit and pieces of aleph, esp r-l typesetting so
> HH> that pdftex+lua can replace aleph
> >> also very essential part of omega/aleph are the 16-bit fonts (or
> >> even 32-bit?).
> HH> that's where open type comes in
>
>in my understanding it is essential to have "font 16-bitness" on the
>abstract level of TeX (i.e. metric features; specific glyph
>representation is very much secondary), not connected to any specific
>font format like Opentype.
>  
>
well, if you only want metric info then \wdcode, \htcode, 
\dpcode,\iccode, \whatevercode can also be a solution

(pdftex already has many \*codes associated with characters)

>TeX has always been independent of physical font formats, and that is
>it's strength... [and omega's 16-bit fonts are no exception]
>  
>
but -since many fonts don't demand much control- it's also a weakness 
that tex cannot handle for instance afm files directly.

since tfm compatibility will remain, some kind of 32 bit native tex 
format will probably show up (in the past there has been discussions 
about reading property lists which are extendible instead of tfm files); 
now that pdftex offers many font related features, it may as well make 
sense to control such things at the macro level on top of regular fonts 
and not using a dedicated font format; so, whatever will happen, there 
will be much control over fonts and how they are used, but a more native 
and direct support will also be provided.

> HH> - additional font features (beyond open type) - lua input
> HH> preprocessing (replacement for otp's)
> >>  will lua provide input processing as powerful as OTPs?
> HH> i dunno, but it will definitely be easier (and documented)
>
>are there any preliminary considerations or descriptions of how it
>will work (of course not detailed - just to understand the proposed
>idea of such a replacement of OTPs)?
>  
>
no, and it's currently also not under discussion, just under 
consideration; also, overloading and plugins is part of the game

(btw i never could find a clear description / explanation of otp's which 
makes it a mechanism for a happy few while in fact we need mechanisms 
for the many)

Hans
From reinhard.kotucha at web.de  Fri Dec 23 00:00:34 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri Dec 23 00:00:40 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <20051222115013.GB31416@lucien.oneiros.kn-bremen.de>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43AA743A.5010101@wxs.nl>
	<20051222115013.GB31416@lucien.oneiros.kn-bremen.de>
Message-ID: <17323.12306.950929.835032@zarniwoop.ms25.local>

>>>>> "Martin" == Martin Schr?der <martin@oneiros.de> writes:

  > On 2005-12-22 10:39:06 +0100, Hans Hagen wrote:
  >> are chars written one by one or by line? maybe there is some
  >> intermediate way possible:
  >> 
  >> - normal messages -> buffered - immediate/write16 -> flush
  >> pending messages and write unbuffered

  > And what about [1][2]? I want to see the time between [ and 1 and
  > ] :-)

Yes, it is annoying if you see nothing for a long time and then a
complete line appears.

But do not expect to see anything at all when you buy a new computer
today.  On my new machine (AMD64, 2.2 GHz) texbook.tex compiles within
0.665 seconds.  That's about 1.5 ms per page!  What do you expect to
see? 

It seems to be reasonable to give up the feature you asked for and try
to get a result as fast as possible.

There is one big problem though:  What happens when TeX runs into an
endless loop?  You don't see where it happens if only complete lines
are issued.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From hartmut_henkel at gmx.de  Fri Dec 23 00:21:10 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri Dec 23 00:21:19 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <17323.12306.950929.835032@zarniwoop.ms25.local>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43AA743A.5010101@wxs.nl>
	<20051222115013.GB31416@lucien.oneiros.kn-bremen.de>
	<17323.12306.950929.835032@zarniwoop.ms25.local>
Message-ID: <Pine.LNX.4.61.0512230019090.5557@hahepc1.hahe>

On Fri, 23 Dec 2005, Reinhard Kotucha wrote:

> There is one big problem though:  What happens when TeX runs into an
> endless loop?  You don't see where it happens if only complete lines
> are issued.

this can be handled by a reasonable timeout, using function select().

Regards, Hartmut
From reinhard.kotucha at web.de  Fri Dec 23 00:26:07 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri Dec 23 00:26:15 2005
Subject: [NTG-pdftex] dvipdfmx
In-Reply-To: <87lkycgbge.fsf@vvv.vsu.ru>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051222115516.GC31416@lucien.oneiros.kn-bremen.de>
	<43AABD46.5040805@wxs.nl> <87lkycgbge.fsf@vvv.vsu.ru>
Message-ID: <17323.13839.558948.598131@zarniwoop.ms25.local>

>>>>> "Vladimir" == Vladimir Volovich <vvv@vsu.ru> writes:

  > also very essential part of omega/aleph are the 16-bit fonts (or
  > even 32-bit?).

It's certainly better to start with 32 bit rather than to look for
volunteers in a few years.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From reinhard.kotucha at web.de  Fri Dec 23 00:55:01 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri Dec 23 00:55:07 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <Pine.LNX.4.61.0512230019090.5557@hahepc1.hahe>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43AA743A.5010101@wxs.nl>
	<20051222115013.GB31416@lucien.oneiros.kn-bremen.de>
	<17323.12306.950929.835032@zarniwoop.ms25.local>
	<Pine.LNX.4.61.0512230019090.5557@hahepc1.hahe>
Message-ID: <17323.15573.285843.548505@zarniwoop.ms25.local>

>>>>> "Hartmut" == Hartmut Henkel <hartmut_henkel@gmx.de> writes:

  > On Fri, 23 Dec 2005, Reinhard Kotucha wrote:
  >> There is one big problem though: What happens when TeX runs into
  >> an endless loop?  You don't see where it happens if only complete
  >> lines are issued.

  > this can be handled by a reasonable timeout, using function
  > select().

A timeout is not a solution.  TeX simply doesn't know what I want.

Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From jackos1 at poczta.onet.pl  Fri Dec 23 10:07:17 2005
From: jackos1 at poczta.onet.pl (Pawel Jackowski)
Date: Fri Dec 23 10:08:26 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <43AA7CBF.2040708@wxs.nl>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43A9D62D.8050308@poczta.onet.pl> <43AA7CBF.2040708@wxs.nl>
Message-ID: <43ABBE45.4060802@poczta.onet.pl>


>>> following trivial observation i made (several runs)[...]
>>> Has anybody similar statistics?
>>
>>
>> Just another trivial observation, that in dosish os displaying is even 
>> more expensive.
> 
> hm, not in a windows shell; it depends on the font you use!

well, yes, it depends on the font, but even for the simplest raster font 
the windowish terminal (cmd, not custom shell I use) still seems to be 
slower. but ok, i thought it is obvious, if not, further tests are to be 
done.
-- 
Pawe/l Jackowski
P.Jackowski@gust.org.pl
From martin at oneiros.de  Fri Dec 23 14:33:47 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Dec 23 15:30:25 2005
Subject: [NTG-pdftex] unbuffered vs. buffered terminal output
In-Reply-To: <Pine.LNX.4.61.0512230019090.5557@hahepc1.hahe>
References: <Pine.LNX.4.61.0512212103120.4703@hahepc1.hahe>
	<43AA743A.5010101@wxs.nl>
	<20051222115013.GB31416@lucien.oneiros.kn-bremen.de>
	<17323.12306.950929.835032@zarniwoop.ms25.local>
	<Pine.LNX.4.61.0512230019090.5557@hahepc1.hahe>
Message-ID: <20051223133346.GA10389@lucien.oneiros.kn-bremen.de>

On 2005-12-23 00:21:10 +0100, Hartmut Henkel wrote:
> this can be handled by a reasonable timeout, using function select().

If it ain't broken, don't fix it. Keep it simple, stupid. :-)

Both apply here -- if you need speed, use \batchmode.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From noreply at sarovar.org  Fri Dec 23 23:35:04 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Dec 23 23:43:57 2005
Subject: [NTG-pdftex] [ pdftex-Patches-462 ] HZ font expansion by text
	matrix manipulation
Message-ID: <E1EpvVA-0005lt-00@sarovar.org>

Patches item #462, was opened at 2005-12-23 23:35
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=462&group_id=106

Category: Positioning
Group: v1.40.0
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: HZ font expansion by text matrix manipulation

Initial Comment:
Use textmatrix Tm instead of /FontMatrix for font
expansion. Then a font file will be embedded only once
for all expansion factors. Gives smaller PDF files.
Works then also for non-embedded fonts. TrueType not
tried yet. Rough patch only, incomplete, work in
progress, no warranty, not for production.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=462&group_id=106
From noreply at sarovar.org  Mon Dec 26 20:21:32 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Dec 26 20:30:40 2005
Subject: [NTG-pdftex] [ pdftex-Patches-453 ] Object Streams for PDF-1.5
Message-ID: <E1EqxuW-0008MU-00@sarovar.org>

Patches item #453, was opened at 2005-11-26 18:05
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=453&group_id=106

Category: Object Streams
Group: v1.30.0
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Object Streams for PDF-1.5

Initial Comment:
Rough early patch, work in progress, produces PDF-1.5
object streams and cross reference streams. With the
patch, and enabled by \pdfminorversion=5, and with
luck, pdfetex produces e. g. from its WEB source a PDF
file with size 5.97 MByte instead of 11.2 MByte without
object streams.

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-12-26 20:21

Message:
Logged In: YES 
user_id=929

Patch update. Object stream writing is now controlled by
primitive \pdfobjcompresslevel = 0...3 (/pdfobjectstreams
primitive removed). 0 = no object streams at all, 1 =
compress objects excluding the ones from embedded PDF files
(for handling of problematic PDF files) and /Info dictionary
(for legibility), 2 = also compress objects from embedded
PDF files, but leave /Info uncompressed, 3 = compress
everything.

Testing welcome.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=453&group_id=106
From martin at oneiros.de  Tue Dec 27 01:00:16 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Dec 27 01:03:49 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051221
In-Reply-To: <43A952BD.70007@gmx.net>
References: <20051220233345.GB11973@lucien.oneiros.kn-bremen.de>
	<43A952BD.70007@gmx.net>
Message-ID: <20051227000016.GB9343@lucien.oneiros.kn-bremen.de>

On 2005-12-21 14:03:57 +0100, w.m.l@gmx.net wrote:
> On 21.12.2005 00:33, Martin Schr?der wrote:
> >- has a large patch from Thanh
> 
> Very nice to see this included!
> Here is my bug collection for the new extensions:

All unfixed for now. :-(

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Tue Dec 27 01:07:46 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Dec 27 01:08:09 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051226
Message-ID: <20051227000745.GC9343@lucien.oneiros.kn-bremen.de>

http://sarovar.org/download.php/872/pdftex-1.40.0-alpha-20051221-20051226.diff.gz
http://sarovar.org/download.php/873/pdftex-1.40.0-alpha-20051226.tar.bz2

- improved patches:
  - 453 Object Streams for PDF-1.5
  - take PK resolution from "pk_dpi" parameter in  texmf.cnf, if
    it has not
    been set by the format file or by the user
  - 432 Rules in a PDF qQ group
- some fixes for Thanhs patch
- some improvements from -Wall
- .indent.pro for indent
-- 
                    http://www.tm.oneiros.de
From hartmut_henkel at gmx.de  Tue Dec 27 09:39:39 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Dec 27 09:39:44 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051226
In-Reply-To: <20051227000745.GC9343@lucien.oneiros.kn-bremen.de>
References: <20051227000745.GC9343@lucien.oneiros.kn-bremen.de>
Message-ID: <Pine.LNX.4.61.0512270935580.14879@hahepc1.hahe>

On Tue, 27 Dec 2005, Martin Schr?der wrote:

> http://sarovar.org/download.php/872/pdftex-1.40.0-alpha-20051221-20051226.diff.gz
> http://sarovar.org/download.php/873/pdftex-1.40.0-alpha-20051226.tar.bz2

> - .indent.pro for indent

do we really want GNUish indentation? like

  if (strcmp (fp->tfm_name, nontfm) != 0)
    {
      p = (fm_entry *) avl_find (tfm_tree, fp);
      if (p != NULL)
        {
          if (mode == FM_DUPIGNORE)

i would prefer K&R (--k-and-r-style):

    if (strcmp(fp->tfm_name, nontfm) != 0) {
        p = (fm_entry *) avl_find(tfm_tree, fp);
        if (p != NULL) {
            if (mode == FM_DUPIGNORE) {

Regards, Hartmut
From hartmut_henkel at gmx.de  Tue Dec 27 15:40:37 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Dec 27 15:40:46 2005
Subject: [NTG-pdftex] pdftex-1.40.0-alpha-20051221
In-Reply-To: <43A952BD.70007@gmx.net>
References: <20051220233345.GB11973@lucien.oneiros.kn-bremen.de>
	<43A952BD.70007@gmx.net>
Message-ID: <Pine.LNX.4.61.0512271531290.28262@hahepc1.hahe>

On Wed, 21 Dec 2005 w.m.l@gmx.net wrote:

> On 21.12.2005 00:33, Martin Schr?der wrote:
> > - has a large patch from Thanh
>
> Very nice to see this included!
> Here is my bug collection for the new extensions:
>
> %-----------------------------------------------------
> % 1) "This can't happen (flushing)" with
> %     kerning+expansion+ligatures:
> %-----------------------------------------------------
> \pdfadjustspacing=1
> \pdffontexpand\font 20 20 4 autoexpand
> \pdfappendkern=1
> \knaccode\font`i=100
>
> \hsize10em
> foo fii foo foo foo foo
> %% but this works:
> %foo f{}ii foo foo foo foo
> \bye

FWIW, this happens in function do_subst_font(). But it starts with
auto_expand_kern(), where the given kern indeed is appended to the i of
"fi" and also to the 2nd "i". It seems as if at this time "fi" is not
yet seen as a ligature. Then in do_subst_font() the "fi" is somehow
already a ligature, and now the kern is part of the lig_ptr list (which
is wrong). Then font(r) is recursively changed to 51, the expanded font
number, and so the kern, which should not be in this list, gets the 51
as its type. But it must be 11 for a kern. Maybe a change should be that
the kern does not end up in the lig_ptr list, but should come after the
"fi" ligature. No idea, how.

Regards, Hartmut

From olaf at infovore.xs4all.nl  Tue Dec 27 21:27:01 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Tue Dec 27 21:27:06 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <43AAAD26.4090801@elvenkind.com> (Taco Hoekwater's message of
	"Thu, 22 Dec 2005 14:41:58 +0100")
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
	<43AAAD26.4090801@elvenkind.com>
Message-ID: <87fyoeqoa2.fsf@infovore.xs4all.nl>

Taco Hoekwater writes:
> Martin Schr?der wrote:
>> On 2005-12-14 13:40:42 +0100, Martin Schr?der wrote:
>>> On 2005-12-14 10:05:21 +0100, Taco Hoekwater wrote:

>>>> At what point do you intend to flatten the web files?

>>> Starting with beta, i.e. after 2006-01-15.

>> I'd also like to unify our coding style. One easy way to do this
>> is to use indent(1). Any opinions on options to use? The default
>> (i.e. GNU coding standards) with --no-tabs seems OK to me.

> I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
> function headers that break over a line, like:

>    int
>    main (int argv, argc**)

> But I'll happily run any kind of indent command after I've finished
> editting so ...

That's not about etags, it's about grep, in particular the ability to
do "grep ^foo *.c" and find the defn of foo().  Apart from the space
(which is abominable) after the function name, I have learned to
appreciate this style.

-- 
Olaf Weber

               (This space left blank for technical reasons.)

From martin at oneiros.de  Wed Dec 28 02:40:00 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Dec 28 02:41:03 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <87fyoeqoa2.fsf@infovore.xs4all.nl>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>
	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>
	<439FE051.7000102@elvenkind.com>
	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>
	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>
	<43AAAD26.4090801@elvenkind.com>
	<87fyoeqoa2.fsf@infovore.xs4all.nl>
Message-ID: <20051228013959.GB26899@lucien.oneiros.kn-bremen.de>

On 2005-12-27 21:27:01 +0100, Olaf Weber wrote:
> Taco Hoekwater writes:
> > I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
> > function headers that break over a line, like:
> 
> >    int
> >    main (int argv, argc**)
> 
> That's not about etags, it's about grep, in particular the ability to
> do "grep ^foo *.c" and find the defn of foo().  Apart from the space

Ah. Agreed.

> (which is abominable) after the function name, I have learned to

The space is not configurable in the declaration -- only after
every function call. And I prefer to have it after calls.

On 2005-12-27 09:39:39 +0100, Hartmut Henkel wrote:
> do we really want GNUish indentation? like
> 
>   if (strcmp (fp->tfm_name, nontfm) != 0)
>     {
>       p = (fm_entry *) avl_find (tfm_tree, fp);
>       if (p != NULL)
>         {
>           if (mode == FM_DUPIGNORE)
> 
> i would prefer K&R (--k-and-r-style):
> 
>     if (strcmp(fp->tfm_name, nontfm) != 0) {
>         p = (fm_entry *) avl_find(tfm_tree, fp);
>         if (p != NULL) {
>             if (mode == FM_DUPIGNORE) {

I suggest a tamed k&r:

--k-and-r-style
--blank-lines-after-procedures
--line-length 80
--procnames-start-lines
--space-after-procedure-calls
--no-tabs                       /* this does not work in indent 2.2.6 :-( */
--preprocessor-indentation 2    /* this is new in indent 2.2.9 */

this gives
    if (strcmp (fp->tfm_name, nontfm) != 0) {
        p = (fm_entry *) avl_find (tfm_tree, fp);
        if (p != NULL) {
            if (mode == FM_DUPIGNORE) {

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From taco at elvenkind.com  Wed Dec 28 09:20:45 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed Dec 28 09:20:39 2005
Subject: [NTG-pdftex] C style
In-Reply-To: <20051228013959.GB26899@lucien.oneiros.kn-bremen.de>
References: <20051213125230.GC21934@lucien.oneiros.kn-bremen.de>	<20051213144023.GF21934@lucien.oneiros.kn-bremen.de>	<439FE051.7000102@elvenkind.com>	<20051214124042.GC1480@lucien.oneiros.kn-bremen.de>	<20051222130149.GE31416@lucien.oneiros.kn-bremen.de>	<43AAAD26.4090801@elvenkind.com>	<87fyoeqoa2.fsf@infovore.xs4all.nl>
	<20051228013959.GB26899@lucien.oneiros.kn-bremen.de>
Message-ID: <43B24ADD.4090702@elvenkind.com>

Martin Schr?der wrote:
> On 2005-12-27 21:27:01 +0100, Olaf Weber wrote:
> 
>>Taco Hoekwater writes:
>>
>>>I've always disliked the GNU "etags-is-too-stupid-for-anything-else"
>>>function headers that break over a line, like:
>>
>>>   int
>>>   main (int argv, argc**)
>>
>>That's not about etags, it's about grep, in particular the ability to
>>do "grep ^foo *.c" and find the defn of foo().  Apart from the space
> 
> Ah. Agreed.

I use "grep ^\\w *.c", and also find static and global identifiers.

But like I said, I don't really care as long as there is a 'run this
command' statement somewhere.

Taco

