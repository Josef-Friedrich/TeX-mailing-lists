From hanthethanh at myrealbox.com  Wed Jan  5 15:35:21 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jan  5 08:55:14 2005
Subject: [NTG-pdftex] testing -- please ignore
Message-ID: <20050105143521.GA1397@monty>

test
From pragma at wxs.nl  Thu Jan  6 02:13:48 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Jan  6 09:41:42 2005
Subject: [NTG-pdftex] bug? 
Message-ID: <41DC90CC.6040709@wxs.nl>

stream
BT
/F1 11.9552 Tf 280.537 760.6529 Td[(1)]TJ -209.67 -58.2684 Td[(test:)]TJ
ET

endstream

this extra empty line looks like a 'bug' to me (only latest version)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ms at artcom-gmbh.de  Thu Jan  6 12:02:20 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Jan  6 12:02:22 2005
Subject: [NTG-pdftex] bug?
In-Reply-To: <41DC90CC.6040709@wxs.nl>
References: <41DC90CC.6040709@wxs.nl>
Message-ID: <20050106110220.GD13371@blau.artcom-gmbh.de>

On 2005-01-06 02:13:48 +0100, Hans Hagen wrote:
> stream
> BT
> /F1 11.9552 Tf 280.537 760.6529 Td[(1)]TJ -209.67 -58.2684 Td[(test:)]TJ
> ET
> 
> endstream
> 
> this extra empty line looks like a 'bug' to me (only latest version)

In my interpretation of the spec this is perfectly legal; the
stream has an extra newline. :-)
If you have a simple test case, please file a bug report at
sarovar (attach the source and the pdf please).

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From pragma at wxs.nl  Thu Jan  6 12:25:48 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Jan  6 12:25:55 2005
Subject: [NTG-pdftex] bug?
In-Reply-To: <20050106110220.GD13371@blau.artcom-gmbh.de>
References: <41DC90CC.6040709@wxs.nl>
	<20050106110220.GD13371@blau.artcom-gmbh.de>
Message-ID: <41DD203C.2030603@wxs.nl>

Martin Schr?der wrote:

> In my interpretation of the spec this is perfectly legal; the
> stream has an extra newline. :-)
> If you have a simple test case, please file a bug report at
> sarovar (attach the source and the pdf please).

sure, but it looks horrible on the pdftex manual's frontpage -)

so ... maybe hartmut sees it as a challenge -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Thu Jan  6 13:16:53 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu Jan  6 13:16:57 2005
Subject: [NTG-pdftex] bug?
In-Reply-To: <41DD203C.2030603@wxs.nl>
References: <41DC90CC.6040709@wxs.nl>
	<20050106110220.GD13371@blau.artcom-gmbh.de>
	<41DD203C.2030603@wxs.nl>
Message-ID: <Pine.LNX.4.61.0501061307310.3802@hahepc1.hahe>

On Thu, 6 Jan 2005, Hans Hagen wrote:

> > In my interpretation of the spec this is perfectly legal; the stream
> > has an extra newline. :-) If you have a simple test case, please
> > file a bug report at sarovar (attach the source and the pdf please).
>
> sure, but it looks horrible on the pdftex manual's frontpage -)

damn horrible indeed :-)

> so ... maybe hartmut sees it as a challenge -)

:-) Maybe reason is that some time ago i asked Thanh to put endstreams
at start of lines, just for better legibility. But as the things before
endstream have different origins, to make it really clean one would
maybe have to check whether the character before already was a 0x0a.
Anyway, yes, it seems to be legal.

Regards, Hartmut
From hanthethanh at myrealbox.com  Thu Jan  6 10:45:59 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Jan  7 04:15:40 2005
Subject: [NTG-pdftex] pdftex-bug-242
Message-ID: <20050106094559.GB25185@monty>

Hi,

> On Sun, 5 Dec 2004, h h extern wrote:
> 
> 
> >>> > Now "!foo.pfb" will be treated by the inner pdftex workings as font
> >>> > with name "!foo.pfb" which is not found, obviously. So pdftex munges
> >>> > "!foo.pfb" and "foo.pfb" differently.
> >
> >>
> >> hm, i suggest to drop the ! (since we need the first char for +-=)
> 
> 
> the ! has been in for long time, so shouldn't it stay there for
> backwards compatibility? Virtually nobody knows about the new !-less
> case as it's documented nowhere, so anybody wanting this no-load feature
> will use the ! sign.
> 
> And the +-= go in front of the tfm names, not the fontfile names. So +-=
> doesn't collide with the ! anyway.
> 
> 
> >> and stick t < and <<
> 
> 
> It's in my suggested patch (does the same with and without !) but this
> can be left out if wanted.

I think the ! has ever been used only once by me during some testing. We should
drop it, as it is pretty useless.

The case without anything (ie "foo foo.pfb") can be useful, however I am not
aware of any practical use of this. In short, it can be used so font
files are not embedded (to make the pdf smaller), and at the same time
keep the document nearly the same as in case the fonts are embedded
(only metrics are copied to pdf; the glyphs will be rendered by acrobat
reader). 

Thanh
From hanthethanh at myrealbox.com  Thu Jan  6 10:54:14 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Jan  7 04:15:52 2005
Subject: [NTG-pdftex] \systemcallmode
Message-ID: <20050106095414.GE25185@monty>

Hi,

I feel that this is web2c-specific and therefore Olaf might want to do that :)

Thanh

> Hi,
> 
> I'd like to see a primitive
> 
>   \pdfsystemcallmode
> 
> which is 0 when write18 is disabled and 0 when enabled
> 
> of course, it would be nicer to have a more generic
> 
>    \systemcallmode
> 
> i'm already be happy if
> 
>   \ifeof18
> 
> would work -)
> 
> Hans
From hanthethanh at myrealbox.com  Thu Jan  6 14:33:03 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Jan  7 04:16:10 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when
	including	pdf file without embedded fonts
Message-ID: <20050106133303.GA25303@monty>

Hi,

> Not yet tried Akira's patch, but there is another problem (ooops they
> are piling up):
> 
> Formerly one could write "!foo.pfb" in the mapfile and the font file
> would not be embedded. So it's also documented. This has silently
> changed, now one can just write "foo.pfb" to have it not embedded.
> (Writing "<foo.pfb" would embed the subset, and "<<foo.pfb" the whole
> font.)
> 
> Now "!foo.pfb" will be treated by the inner pdftex workings as font with
> name "!foo.pfb" which is not found, obviously. So pdftex munges
> "!foo.pfb" and "foo.pfb" differently.

formerly both "foo.pfb" and "!foo.pfb" were possible, but they had
different meaning: "foo.pfb" means "read the font file to extract all
parameters but do not embed it" while "!foo.pfb" means "don't read
anything", and the font descriptor is not created. "!foo.pfb" only works
if the font is installed onto the system where the pdf is being viewed
-- it works more or less similarly to the 14 base fonts, except that the
14 base fonts are built into acroreader while foo.pfb must be installed
onto the system properly (which is not easy at all on unix systems).

The reason I implemented it was that I though it would speed up the time
acrobat reader loads such a document, which was important for efficient
edit-compile-view-edit cycle while pdftexing. 

I think we should drop "!foo.pfb".


Thanh
From pragma at wxs.nl  Fri Jan  7 09:28:25 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri Jan  7 09:28:27 2005
Subject: [NTG-pdftex] pdftex-bug-242
In-Reply-To: <20050106094559.GB25185@monty>
References: <20050106094559.GB25185@monty>
Message-ID: <41DE4829.1020208@wxs.nl>

The Thanh Han wrote:

> I think the ! has ever been used only once by me during some testing. We should
> drop it, as it is pretty useless.

makes sense, just as you removed some other extensions needed for your thesis 
work; don't worry about the 'dropping', changes in map/enc handling have more 
impact

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jan  7 09:29:16 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri Jan  7 09:29:17 2005
Subject: [NTG-pdftex] \systemcallmode
In-Reply-To: <20050106095414.GE25185@monty>
References: <20050106095414.GE25185@monty>
Message-ID: <41DE485C.7040209@wxs.nl>

The Thanh Han wrote:

> I feel that this is web2c-specific and therefore Olaf might want to do that :)

Olaf already added the \ifeof18 test

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Fri Jan  7 11:25:59 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri Jan  7 11:26:02 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when including
	pdf file without embedded fonts
In-Reply-To: <20050106133303.GA25303@monty>
References: <20050106133303.GA25303@monty>
Message-ID: <Pine.LNX.4.61.0501071110170.2144@hahepc1.hahe>

Hi Thanh,

On Thu, 6 Jan 2005, The Thanh Han wrote:

> formerly both "foo.pfb" and "!foo.pfb" were possible, but they had
> different meaning: "foo.pfb" means "read the font file to extract all
> parameters but do not embed it" while "!foo.pfb" means "don't read
> anything", and the font descriptor is not created.

> I think we should drop "!foo.pfb".

you already had dropped it, only i put it in again, and incompletely,
only the scanning. I really shouldn't have done this, sorry. Hope it's
of limited trouble. Now that 1.20b is out, what quickly can be done is
removing the '!' case from the manual.

Regards, Hartmut


P. S. i shuffled the code a bit in this area of mapfile.c to separate
.enc and fontfile flags handling, hope that this was ok.
From taco at elvenkind.com  Fri Jan  7 12:58:06 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri Jan  7 12:58:08 2005
Subject: [NTG-pdftex] PNG handling, transparency
Message-ID: <41DE794E.6040002@elvenkind.com>


>From a thread from November:

Hartmut Henkel wrote:

> seems so yes: the alpha channel, if it would be properly extracted. Or
> use a separate image, tried just the maybe most trivial case:

Assuming nobody else is doing anything with it a.t.m., I'll work on that 
next week (need it for work, so ..)

Greetings, Taco
From taco at elvenkind.com  Mon Jan 10 16:22:54 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon Jan 10 16:23:00 2005
Subject: [NTG-pdftex] PNG inclusion progress
Message-ID: <41E29DCE.6010004@elvenkind.com>


Hi all,

As I said last week, i've been working on PNG inclusion, and I have
reached the point where I have a 'proof of concept' that needs checking
before I continue.

Would somebody with an AR >= 6.0 please see if this file loads OK?

   http://tex.aanhet.net/context/png-test.pdf

This is a compile of the suite of PNG test images, as seen on
	
   http://www.libpng.org/pub/png/pngsuite.html

The one-pixel images do not work, but I expect that is a bug in the 
Reader (they look fine in the PDF source).

I cannot test the pdf file myself, because AR on Linux does not accept 
16-bit images yet, and I do not own any of the platforms that *are*
supported by AR 6/7 (sigh). I really need to know if the file is ok,
so I can change my C code from 'quick&dirty' to 'production' style. :-)


And while at it, I have some technical questions as well:

- The current code assumes that transparancy should always be used 
whenever it is a) present and b) the pdf version allows it (PDF-1.4).
Is this reasonable?

- There is a similar question for 16-bit color samples (PDF-1.5)

- My current code uses 1.0 for the 'screen gamma' and 0.45455 (==1/2.2) 
for the 'assumed file gamma'.  Do these 'gamma values' need 
parameterisation?

- My code ignores bKGD (the default background color), because otherwise 
transparancy inclusion would be pointless. That is, unless someone would 
want to load a transparant PNG with the background applied but without 
transparancy?

- I currently ignore all color management stuff in the PNG (cHRM, sRGB, 
iCCP chunks). I do not know enough about it at the moment, and I wonder 
if anybody is immediately interested anyway? Besides, color management 
would require other changes to pdftex as well, I assume?

- (this is an unrelated question) I consider adding downsampling support 
for PNG images, but it would need a new primitive. Something like
\pdfoptionimageresolution ?



Greetings, Taco

From pragma at wxs.nl  Mon Jan 10 19:27:41 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Jan 10 19:27:49 2005
Subject: [NTG-pdftex] PNG inclusion progress
In-Reply-To: <41E29DCE.6010004@elvenkind.com>
References: <41E29DCE.6010004@elvenkind.com>
Message-ID: <41E2C91D.6000605@wxs.nl>

Taco Hoekwater wrote:

> - The current code assumes that transparancy should always be used 
> whenever it is a) present and b) the pdf version allows it (PDF-1.4).
> Is this reasonable?

indeed

> - There is a similar question for 16-bit color samples (PDF-1.5)

hm, more dangerous, although we may expect users to update their viewer

> - My current code uses 1.0 for the 'screen gamma' and 0.45455 (==1/2.2) 
> for the 'assumed file gamma'.  Do these 'gamma values' need 
> parameterisation?

if possible, yes

> - My code ignores bKGD (the default background color), because otherwise 
> transparancy inclusion would be pointless. That is, unless someone would 
> want to load a transparant PNG with the background applied but without 
> transparancy?

just ignore the bg color

> - I currently ignore all color management stuff in the PNG (cHRM, sRGB, 
> iCCP chunks). I do not know enough about it at the moment, and I wonder 
> if anybody is immediately interested anyway? Besides, color management 
> would require other changes to pdftex as well, I assume?

a next version of pdftex will provide overloading of the color dict so there is 
no need to handle it; it would probably badly interfere anyway

> - (this is an unrelated question) I consider adding downsampling support 
> for PNG images, but it would need a new primitive. Something like
> \pdfoptionimageresolution ?

plus \pdfoptionimageforcebw -)

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From noreply at sarovar.org  Mon Jan 10 21:43:15 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Jan 10 21:46:01 2005
Subject: [NTG-pdftex] [ pdftex-Patches-257 ] Experimental patch for pdftex
	character protrusion
Message-ID: <E1Co6Nf-0004RL-00@sarovar.org>

Patches item #257, was opened at 2005-01-10 21:43
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106

Category: None
Group: Unstable (example)
Status: Open
Resolution: None
Priority: 3
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Experimental patch for pdftex character protrusion

Initial Comment:
Normally items inside a \hbox are not considered for
protrusion. With this experimental patch also nested
\hboxes at the left and right margin are recursively
searched for items with \lpcode or \rpcode, and the
outmost containing boxes are protruded correspondingly.

This seems to be practical e. g. if an elevated
\footnote{foo} (LaTeX) index happens to be at the right
margin; in this case the footnote index normally is
placed too far inward the line. This disturbance was
detected by Peter Muthesius in an de.comp.text.tex news
thread "pdfcprot und Ziffern am rechten Rand" started
Sat Jan 08 14:05:23 CET 2005.

Rough experimental patch, rudimentarily tested with
left and right protrusion, see test file xx.tex with
output xx.pdf. Just for discussion.

No warranty. Have fun!

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106
From hartmut_henkel at gmx.de  Mon Jan 10 23:52:05 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Jan 10 23:52:09 2005
Subject: [NTG-pdftex] pdftex 1.20b protrusion: skip also zero-width glue?
In-Reply-To: <E1Co6Nf-0004RL-00@sarovar.org>
References: <E1Co6Nf-0004RL-00@sarovar.org>
Message-ID: <Pine.LNX.4.61.0501102335270.28713@hahepc1.hahe>

Hi,

this is also an observation by Peter Muthesius on de.comp.text.tex: A
LaTeX \\ line ending will not get the rightmost character in that line
protruded. Reason is that \\ puts a glue_node "width 0pt plus 1fil" at
the end of the line, which is not skipped by the cp_skipable macro in
hz.ch.

Now, should one add also

        or ((type(#) = glue_node) and (width(glue_ptr(#)) = 0))

to the cp_skipable() macro? Then there would be "correct" protrusion
also with lines ended by LaTeX \\. But as the glue provided by \\ has
some fil component, this would influence also positioning of text with
protrusion component on the line if \hfil is used on the same line. Here
some pdfLaTeX example:

\documentclass[a4paper]{article}
\pdfprotrudechars=1
\tracingall
\rpcode\font`\-=1000
\begin{document}
Es kommt eine Zeile mit hfil \hfil Ein-\\
\hrule
Es kommt eine Zeile mit hfill \hfill Ein-\\
\hrule
\pdfprotrudechars=0
Es kommt eine Zeile mit hfil \hfil Ein-\\
\end{document}

With normal pdflatex the 2nd "Ein-" will not protrude into the margin,
but it would if the above line is inserted in hz.ch. However one sees
the side effect, that the positioning of the "Ein-" is affected in the
\hfil case, depending on whether protrusion is activated or not.

Any idea what would be the right behavior?

Regards, Hartmut
From hanthethanh at myrealbox.com  Mon Jan 10 08:48:29 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Tue Jan 11 03:15:08 2005
Subject: [NTG-pdftex] PNG handling, transparency
In-Reply-To: <41DE794E.6040002@elvenkind.com>
References: <41DE794E.6040002@elvenkind.com>
Message-ID: <20050110074829.GC1045@monty>

Go ahead, Taco. It is certainly one thing that should be supported.

Regards,
Thanh

On Fri, Jan 07, 2005 at 12:58:06PM +0100, Taco Hoekwater wrote:
> 
> >From a thread from November:
> 
> Hartmut Henkel wrote:
> 
> >seems so yes: the alpha channel, if it would be properly extracted. Or
> >use a separate image, tried just the maybe most trivial case:
> 
> Assuming nobody else is doing anything with it a.t.m., I'll work on that 
> next week (need it for work, so ..)
> 
> Greetings, Taco
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From hanthethanh at myrealbox.com  Mon Jan 10 15:00:36 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Tue Jan 11 03:15:41 2005
Subject: [NTG-pdftex] ttf fonts reported as non-subsetted
Message-ID: <20050110140036.GA1045@monty>

Hi,

I must have thought of it while implementing the subset tags for type1
fonts. However, to be honest, I don't remember the reason why I left
name records of ttf fonts without subset tags (I guess laziness is the
correct answer :). Anyway it would be nice to have it fixed. I will
download the truetype specification again and look at this issue.

Regards,
Thanh

> Hi,
> 
> there seem to be a few inconsistencies in the way how pdftex handles
> Type1 vs. TT fonts:
> 
> 1. Subsetted Type1 fonts get a 6-character with + sign extension like
> 
> /BaseFont /FCLRSI+CMR10
> 
> in the PDF file, but TT fonts don't get this; there it's simply
> 
> /BaseFont /CMR10
> 
> Therefore even subsetted TT fonts are normally _not_ detected as
> subsetted by the viewer or pdffonts program.
> 
> So this should probably be added to the TTF routines...
> 
> 2. For Type1 fonts, the /BaseFont entry is always taken from the
> /FontName entry in the font. However for TT fonts the /BaseFont entry in
> the PDF file is copied from the tfmname (!) field in the mapline, if no
> psname is stated there, else it's taken from the psname of the mapline.
> E. g.
> 
> \pdfmapline{+Packa___ <8r.enc <PackardAntique.ttf}
> 
> gives in the PDF file:
> 
> /BaseFont /Packa___
> 
> (which should be PackardAntique-Regular), whereas
> 
> \pdfmapline{+Packa___ FOO <8r.enc <PackardAntique.ttf}
> 
> gives
> 
> /BaseFont /FOO
> 
> Here maybe always the /FontName from the TT font should be taken; it's
> an ASCII string with NameID 6 in the TTF name record. Then it would be
> consistent with Type1.
> 
> Regards, Hartmut
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
> 
> 
> 
From noreply at sarovar.org  Tue Jan 11 16:44:31 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Jan 11 16:47:15 2005
Subject: [NTG-pdftex] [ pdftex-Patches-259 ] Expanded png inclusion support
Message-ID: <E1CoOC7-0005tD-00@sarovar.org>

Patches item #259, was opened at 2005-01-11 16:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: Expanded png inclusion support

Initial Comment:
The attached zip file contains a change file for all
pdftex's (to be applied *after* hz.cg) and a completely
new writepng.c



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106
From taco at elvenkind.com  Tue Jan 11 17:29:39 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue Jan 11 17:29:46 2005
Subject: [NTG-pdftex] Expanded png inclusion support
In-Reply-To: <E1CoOC7-0005tD-00@sarovar.org>
References: <E1CoOC7-0005tD-00@sarovar.org>
Message-ID: <41E3FEF3.3010605@elvenkind.com>


Hi,

This is a complete, working patch, but the zip only contains the actual 
pngextra.ch and replacement writepng.c, so some manual editting has to 
be done to the Makefile. The change file needs to be added as the last
item of the "pdftex_web_srcs" collection, the C file can overwrite the
current file.

This version is for testing purposes. I can provide linux 2.6 binaries,
but I don't know how to create win32 executables, sorry.

The main part of the patch is the new writepng.c, but there is also
some web glue to set defaults. The patch contains improvements for PNG
image inclusion, specifically:

- alpha channel and transparency (only if %!PDF >=1.4)
- 16-bit colour (only if %!PDF >=1.5)
- gamma correction
- forced reduction to greyscale (for Hans)

A few primitives had to be introduced to set some default values.
There are a total of four new primitives, that are all integer 
parameters. I almost certainly made mistakes in the WEB coding
(initialization locations etc.), but works well enough for testing.

Here are  the primitives and their defaults:

   \pdfoptionpdfimagehicolor = 1
   %
   % can be set to 0 if undesirable. This is perhaps needed because
   % the reader 5 will reject the pdf document's page completely
   % otherwise.

   \pdfimagegamma = 2200
   %
   % if not supplied in the image. This example implies that the image
   % was originally created with gamma value 2.2 (like magnification)


   \pdfgamma = 1000
   %
   % Gamma value for the 'pdf device'. It looks like this is the
   % 'correct' value used by Adobe, but I'm not 100% sure.

   \pdfoptionimageforcegray = 0
   %
   % If 1, all included PNGs are written to the pdf as greyscale.

The problem with these primitives is that I am unsure how and
when to convert the internal parameters into their C 'fixedxxxxxx'
counterparts. It would be a lot cleaner if the C code would use
the internal parameters directly, but I'm not sure if that is
even possible. Help needed!


Greetings, Taco

noreply@sarovar.org wrote:
> Patches item #259, was opened at 2005-01-11 16:44
 >
> Submitted By: Taco Hoekwater (taco)
> Summary: Expanded png inclusion support
From ms at artcom-gmbh.de  Tue Jan 11 17:36:06 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Jan 11 17:36:08 2005
Subject: [NTG-pdftex] Expanded png inclusion support
In-Reply-To: <41E3FEF3.3010605@elvenkind.com>
References: <E1CoOC7-0005tD-00@sarovar.org> <41E3FEF3.3010605@elvenkind.com>
Message-ID: <20050111163606.GB5571@blau.artcom-gmbh.de>

On 2005-01-11 17:29:39 +0100, Taco Hoekwater wrote:
> This is a complete, working patch, but the zip only contains the actual 

Thanks!

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From hartmut_henkel at gmx.de  Tue Jan 11 20:04:46 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Jan 11 20:05:05 2005
Subject: [NTG-pdftex] pdftex 1.20b protrusion: skip also zero-width glue?
In-Reply-To: <Pine.LNX.4.61.0501102335270.28713@hahepc1.hahe>
References: <E1Co6Nf-0004RL-00@sarovar.org>
	<Pine.LNX.4.61.0501102335270.28713@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0501112001520.2094@hahepc1.hahe>

On Mon, 10 Jan 2005, Hartmut Henkel wrote:

> Now, should one add also
>
>         or ((type(#) = glue_node) and (width(glue_ptr(#)) = 0))

(after having slept over this) it's rubbish as it messes up fil/fill
based alignment (could bee seen already in the example).

Regards, Hartmut
From hartmut_henkel at gmx.de  Wed Jan 12 01:36:20 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed Jan 12 01:36:26 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
 last miktex update
In-Reply-To: <41E45C85.5060002@t-online.de>
References: <41E45C85.5060002@t-online.de>
Message-ID: <Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>

On Wed, 12 Jan 2005, Matthias C. Schmidt wrote:

> After the last update ConTeXt has problems with fonts unter miktex.
>
> from the log:
>
> [1.1{original-empty.map}{texnansiOSFSC-adobe-cronospro.map
> Warning: pdfetex (file texnansiOSFSC-adobe-cronospro.map): invalid entry for
> `texnansiOSFSC-raw-CronosPro-Bold': invalid font file name
>
> the entry in the map-file:
>
> texnansiOSFSC-raw-CronosPro-Bold 4 < CronosPro-Bold.pfb texnansiOSFSC.enc

Please remove the blank after the "<":

texnansiOSFSC-raw-CronosPro-Bold 4 <CronosPro-Bold.pfb texnansiOSFSC.enc

Is it working then?

I'm guilty for this change (anywhere else this blank is missing, but it
was definitively allowed as i see now -- an undocumented feature).

What is the origin of file texnansiOSFSC-adobe-cronospro.map? Is it from
somewhere distributed or written by yourself?

Regards, Hartmut
From hanthethanh at myrealbox.com  Tue Jan 11 04:58:05 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jan 12 04:08:21 2005
Subject: [NTG-pdftex] pdftex 1.20b protrusion: skip also zero-width glue?
In-Reply-To: <Pine.LNX.4.61.0501102335270.28713@hahepc1.hahe>
References: <E1Co6Nf-0004RL-00@sarovar.org>
	<Pine.LNX.4.61.0501102335270.28713@hahepc1.hahe>
Message-ID: <20050111035805.GA1048@monty>

Hi,

in my opinion we should not change anything to make \\ work with
character protrusion. \\ is used to end a line at an arbitrary position,
not at the right margin. When one says '...foo\\', he/she doesn't
expect that 'foo' ends up exactly at the right margin, but anywhere. 

In the below case, I think '\break' should be used instead of '\\'


Regards,
Thanh

On Mon, Jan 10, 2005 at 11:52:05PM +0100, Hartmut Henkel wrote:
> Hi,
> 
> this is also an observation by Peter Muthesius on de.comp.text.tex: A
> LaTeX \\ line ending will not get the rightmost character in that line
> protruded. Reason is that \\ puts a glue_node "width 0pt plus 1fil" at
> the end of the line, which is not skipped by the cp_skipable macro in
> hz.ch.
> 
> Now, should one add also
> 
>         or ((type(#) = glue_node) and (width(glue_ptr(#)) = 0))
> 
> to the cp_skipable() macro? Then there would be "correct" protrusion
> also with lines ended by LaTeX \\. But as the glue provided by \\ has
> some fil component, this would influence also positioning of text with
> protrusion component on the line if \hfil is used on the same line. Here
> some pdfLaTeX example:
> 
> \documentclass[a4paper]{article}
> \pdfprotrudechars=1
> \tracingall
> \rpcode\font`\-=1000
> \begin{document}
> Es kommt eine Zeile mit hfil \hfil Ein-\\
> \hrule
> Es kommt eine Zeile mit hfill \hfill Ein-\\
> \hrule
> \pdfprotrudechars=0
> Es kommt eine Zeile mit hfil \hfil Ein-\\
> \end{document}
> 
> With normal pdflatex the 2nd "Ein-" will not protrude into the margin,
> but it would if the above line is inserted in hz.ch. However one sees
> the side effect, that the positioning of the "Ein-" is affected in the
> \hfil case, depending on whether protrusion is activated or not.
> 
> Any idea what would be the right behavior?
> 
> Regards, Hartmut
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From hanthethanh at myrealbox.com  Tue Jan 11 05:00:09 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jan 12 04:08:23 2005
Subject: [NTG-pdftex] bug?
In-Reply-To: <Pine.LNX.4.61.0501061307310.3802@hahepc1.hahe>
References: <41DC90CC.6040709@wxs.nl>
	<20050106110220.GD13371@blau.artcom-gmbh.de>
	<41DD203C.2030603@wxs.nl>
	<Pine.LNX.4.61.0501061307310.3802@hahepc1.hahe>
Message-ID: <20050111040009.GB1048@monty>

On Thu, Jan 06, 2005 at 01:16:53PM +0100, Hartmut Henkel wrote:
> On Thu, 6 Jan 2005, Hans Hagen wrote:
> 
> > > In my interpretation of the spec this is perfectly legal; the stream
> > > has an extra newline. :-) If you have a simple test case, please
> > > file a bug report at sarovar (attach the source and the pdf please).
> >
> > sure, but it looks horrible on the pdftex manual's frontpage -)
> 
> damn horrible indeed :-)
> 
> > so ... maybe hartmut sees it as a challenge -)
> 
> :-) Maybe reason is that some time ago i asked Thanh to put endstreams
> at start of lines, just for better legibility. But as the things before
> endstream have different origins, to make it really clean one would
> maybe have to check whether the character before already was a 0x0a.
> Anyway, yes, it seems to be legal.

yes that's the reason. We should add some checking whether the last char
is 10 before adding a new line before 'endstream'

Regards,
Thanh
From hanthethanh at myrealbox.com  Tue Jan 11 07:56:41 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jan 12 04:08:36 2005
Subject: [NTG-pdftex] where are the pdftex latest sources?
Message-ID: <20050111065641.GE1048@monty>

Hi,

are the sources at P4 TL the latest one?

Thanh
From pragma at wxs.nl  Wed Jan 12 09:29:33 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Jan 12 09:29:35 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
Message-ID: <41E4DFED.7040800@wxs.nl>

Hartmut Henkel wrote:

> Please remove the blank after the "<":

hm, i ran intro something like that recently, pdftex was never sensitive to 
blanks there, so i have map files with blanks (since there can be blanks 
everywhere i see no reason for a restiction there); makes the file more readable

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Jan 12 09:35:31 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed Jan 12 09:35:33 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <41E4DFED.7040800@wxs.nl>
References: <41E45C85.5060002@t-online.de>	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
	<41E4DFED.7040800@wxs.nl>
Message-ID: <41E4E153.50008@elvenkind.com>

Hans Hagen wrote:
> Hartmut Henkel wrote:
> 
>> Please remove the blank after the "<":
> 
> 
> hm, i ran intro something like that recently, pdftex was never sensitive 
> to blanks there, so i have map files with blanks (since there can be 
> blanks everywhere i see no reason for a restiction there); makes the 
> file more readable

Does this now differ from dvips' behaviour? If so, can we then move the
pdftex map files back to the directory fonts/map/pdftex, please? :-D


Greetings, Taco
From ms at artcom-gmbh.de  Wed Jan 12 10:25:24 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Jan 12 10:25:27 2005
Subject: [NTG-pdftex] where are the pdftex latest sources?
In-Reply-To: <20050111065641.GE1048@monty>
References: <20050111065641.GE1048@monty>
Message-ID: <20050112092524.GC5571@blau.artcom-gmbh.de>

On 2005-01-11 13:56:41 +0700, The Thanh Han wrote:
> are the sources at P4 TL the latest one?

Yes, they are the official ones for 1.20b (in devel)

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From pragma at wxs.nl  Wed Jan 12 10:27:50 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Jan 12 10:27:52 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
Message-ID: <41E4ED96.5080407@wxs.nl>

Hi,

I ran into a mem overflow,

  65281 words of extra memory for PDF output out of 65536

can this one be increased? It happens when I assign lp/rp/ef codes inside a 
group (some 50 times in a row), maybe there's a mem leak?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ms at artcom-gmbh.de  Wed Jan 12 10:33:49 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Jan 12 10:33:51 2005
Subject: [NTG-pdftex] pdf_mem_size (was: ConTeXt dont work with fonts after
	last miktex update)
In-Reply-To: <41E4ED96.5080407@wxs.nl>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
	<41E4ED96.5080407@wxs.nl>
Message-ID: <20050112093349.GD5571@blau.artcom-gmbh.de>

On 2005-01-12 10:27:50 +0100, Hans Hagen wrote:
>  65281 words of extra memory for PDF output out of 65536
> 
> can this one be increased? It happens when I assign lp/rp/ef codes inside a 

Of course. I have this in texmf.cnf:

obj_tab_size = 8388607          % maximum number of pdf objects (this is also the limit for Acrobat 4.x)
dest_names_size = 131072        % maximum number of destinations in pdf files
pdf_mem_size = 524288           % max size of the |pdf_mem| array

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Wed Jan 12 19:34:53 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed Jan 12 19:37:57 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when including
	pdf file without embedded fonts
Message-ID: <E1ConKX-0001rW-00@sarovar.org>

Bugs item #242, was opened at 2004-12-02 15:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106

Category: Fonts
Group: v1.20a
>Status: Open
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Assertion failure when including pdf file without embedded fonts

Initial Comment:
See included shell script

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 15:53

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Thomas Esser (tetex)
Date: 2004-12-03 00:30

Message:
Logged In: YES 
user_id=1230

I can reproduce this bug after
  updmap --setoption pdftexDownloadBase14 false

Thomas

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106
From noreply at sarovar.org  Thu Jan 13 00:19:12 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Jan 13 00:22:25 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when including
	pdf file without embedded fonts
Message-ID: <E1Corlg-0000Ks-00@sarovar.org>

Bugs item #242, was opened at 2004-12-02 15:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106

Category: Fonts
>Group: v1.20b
Status: Open
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Assertion failure when including pdf file without embedded fonts

Initial Comment:
See included shell script

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-13 00:19

Message:
Logged In: YES 
user_id=929

This is a patch for file mapfile.c of pdftex-1.20, cleaning
up a few bugs introduced by patch-242c. The obsolete
qualifier "!" is removed from scanning. Blank handling
between qualifiers "<", "<<" and .enc and f_name names has
been re-introduced, to make it backward compatible and
compatible to the preferences of map file writers.

Please test carefully. Help welcome.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 15:53

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Thomas Esser (tetex)
Date: 2004-12-03 00:30

Message:
Logged In: YES 
user_id=1230

I can reproduce this bug after
  updmap --setoption pdftexDownloadBase14 false

Thomas

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106
From pragma at wxs.nl  Thu Jan 13 14:32:30 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Jan 13 14:32:31 2005
Subject: [NTG-pdftex] pdfliteral 
Message-ID: <41E6786E.6050509@wxs.nl>

Hi,

It looks like pdfliteral direct generates an extra newline

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hanthethanh at myrealbox.com  Thu Jan 13 07:22:37 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Jan 14 02:56:46 2005
Subject: [NTG-pdftex] where are the pdftex latest sources?
In-Reply-To: <Pine.LNX.4.61.0501120538370.4950@hahepc1.hahe>
References: <20050111065641.GE1048@monty>
	<Pine.LNX.4.61.0501120538370.4950@hahepc1.hahe>
Message-ID: <20050113062236.GE1063@monty>

Thanks to Martin & Hartmut.

Regards,
Thanh

On Wed, Jan 12, 2005 at 05:39:52AM +0100, Hartmut Henkel wrote:
> On Tue, 11 Jan 2005, The Thanh Han wrote:
> 
> > are the sources at P4 TL the latest one?
> 
> AFAIK yes, identical to the 1.20b tarball released from sarovar.
> 
> Regards, Hartmut
From hanthethanh at myrealbox.com  Thu Jan 13 07:30:36 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Jan 14 02:56:48 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <41E4ED96.5080407@wxs.nl>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
	<41E4ED96.5080407@wxs.nl>
Message-ID: <20050113063036.GF1063@monty>

Do you have a minimal test file to reproduce the problem?

Thanh

On Wed, Jan 12, 2005 at 10:27:50AM +0100, Hans Hagen wrote:
> Hi,
> 
> I ran into a mem overflow,
> 
>  65281 words of extra memory for PDF output out of 65536
> 
> can this one be increased? It happens when I assign lp/rp/ef codes inside a 
> group (some 50 times in a row), maybe there's a mem leak?
> 
> Hans
> 
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
> 
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From noreply at sarovar.org  Fri Jan 14 03:19:35 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 14 03:22:28 2005
Subject: [NTG-pdftex] [ pdftex-Feature Requests-254 ] fontexpansion,
	dvi output
Message-ID: <E1CpH3n-0005hI-00@sarovar.org>

Feature Requests item #254, was opened at 2004-12-22 21:06
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=254&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: fontexpansion, dvi output

Initial Comment:
Hello developers,

I'd like to use the autoexpand feature with dvips. Are
there any plans to make pdftex write the autoexpanded
tfm files to the current directory, perhaps even
generating a map file? 

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: The Thanh Han (hanthethanh)
Date: 2005-01-14 02:19

Message:
Logged In: YES 
user_id=710

It is likely that this will never be implemented. The better
way to do that is to change the script \<TEX> (\<PDFTEX>)
calls to create missing \<TFM> during run-time (on
\<WEB2C>-based systems this is called |mktextfm|) to create
all the required stuff on demand. 

Thanh

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=496&aid=254&group_id=106
From pragma at wxs.nl  Fri Jan 14 17:12:06 2005
From: pragma at wxs.nl (h h extern)
Date: Fri Jan 14 17:12:07 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <20050113063036.GF1063@monty>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
	<41E4ED96.5080407@wxs.nl> <20050113063036.GF1063@monty>
Message-ID: <41E7EF56.4090405@wxs.nl>

The Thanh Han wrote:

it was something

<repeat 150 times>
   \bgroup
     <define font with protruding>
     use that font
   \egroup
<endrepeat>

(i changed the file)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hanthethanh at myrealbox.com  Fri Jan 14 00:41:22 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat Jan 15 04:08:30 2005
Subject: [NTG-pdftex] pdfcurpageref -- does it make sense?
In-Reply-To: <20050106094723.GC25185@monty>
References: <20050106094723.GC25185@monty>
Message-ID: <20050113234122.GB1097@monty>

Hi,

I wonder how Hans and other would solve this problem. tex doesn't have a
concept of `current page' while processing the input token list. The
page number can be detected reliably only using 2nd pass processing, as
the page where some material ends up is known only at shipping phase.

It is possible to provide a primitive which returns the *next* page object
number, but IMHO it doesn't make any sense.

Thanh

> Feature Requests item #252, was opened at 2004-12-14 16:47
> You can respond by visiting: 
> http://sarovar.org/tracker/?func=detail&atid=496&aid=252&group_id=106
> 
> Category: None
> Group: None
> Status: Open
> Resolution: None
> Priority: 5
> Submitted By: Nobody (None)
> Assigned to: Nobody (None)
> Summary: current page object number
> 
> Initial Comment:
> Dear PdfTeX-developpers,
> 
> sometimes the reference to the current page object is 
> needed within the implementation of another pdf object.
> 
> As an example may serve the `Screen Annotation' 
> several interactive PDF features rely on.
> 
> Currently, the \pdfpageref command, which takes a page 
> number as argument, can be used for this purpose. 
> 
> It is difficult, however, to maintain a reliable page 
> counter as the attached file demonstrates. It uses the 
> `everyshi' package by M. Schroeder.
> 
> On the first line of every page a wrong object number 
> is being output.
> 
> It would be very nice to have a command like 
> \pdfcurrentpageref to be implemented in pdftex.
> 
> Thanks for your attention,
> 
> Alexander Grahn
From hanthethanh at myrealbox.com  Mon Jan 17 05:01:07 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Mon Jan 17 05:04:10 2005
Subject: [NTG-pdftex] ttf support
Message-ID: <20050117040106.GA1714@monty>

Hi all,

I am working on ttf support: 1) will make the subset tag work in the
same way as t1; 2) support refering glyphs by their unicode index in map
files. In case one has some further ideas for improvements for fixes,
please let me know.

Regards,
Thanh
From pragma at wxs.nl  Mon Jan 17 10:11:31 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Jan 17 10:11:27 2005
Subject: [NTG-pdftex] pdfcurpageref -- does it make sense?
In-Reply-To: <20050113234122.GB1097@monty>
References: <20050106094723.GC25185@monty> <20050113234122.GB1097@monty>
Message-ID: <41EB8143.8020101@wxs.nl>

The Thanh Han wrote:

> I wonder how Hans and other would solve this problem. tex doesn't have a
> concept of `current page' while processing the input token list. The
> page number can be detected reliably only using 2nd pass processing, as
> the page where some material ends up is known only at shipping phase.

I use two pass solutions for that.

I can imagine a primitive \pdfpageobjnum  that expands at shipout time, i.e.

   \pdfobj{.... \pdfpageobjnum\space 0 R}

in this case \pdfpageobjnum is like pdfsavepos, during shipout, those 
placeholders in the shipped out box  are resolved; outside the otr/shipout 
routine it's zero, so

   \count15=\pdfpageobjnum

leads to \count15 being 0

I guess that the reason for this request is that in media objects one needs to 
refer to the page where the object (or its visualization) ends up, a kin dof 
circular reference between definition and usage; since these page references 
remain in the object (and are not used elsewhere) the delayed resolution during 
shipout is ok;

> It is possible to provide a primitive which returns the *next* page object
> number, but IMHO it doesn't make any sense.

indeed, things can end up many pages later (think of intermediate float flushing)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hanthethanh at myrealbox.com  Tue Jan 18 02:01:14 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Tue Jan 18 04:08:42 2005
Subject: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
In-Reply-To: <41E7EF56.4090405@wxs.nl>
References: <41E45C85.5060002@t-online.de>
	<Pine.LNX.4.61.0501120127030.26483@hahepc1.hahe>
	<41E4ED96.5080407@wxs.nl> <20050113063036.GF1063@monty>
	<41E7EF56.4090405@wxs.nl>
Message-ID: <20050118010114.GA1060@monty>

Hans,

I did the following plain test

\newcount\n
\loop
\bgroup
    \font\f=cmr10
    \rpcode\font`\-=50
    \lpcode\font`\-=50
    \f Hello, world!
\egroup
    \advance\n by 1
\ifnum \n < 1250 \repeat
\bye

and got no error. It doesn't matter whether you set rpcode/lpcode for
how many characters, the first one always triggers mem allocation for
the rest 255 chars.

Can you send me a minimal test file?

Thanh

On Fri, Jan 14, 2005 at 05:12:06PM +0100, Hans Hagen wrote:
> The Thanh Han wrote:
> 
> it was something
> 
> <repeat 150 times>
>   \bgroup
>     <define font with protruding>
>     use that font
>   \egroup
> <endrepeat>
> 
> (i changed the file)
> 
> Hans
> 
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
> 
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From pragma at wxs.nl  Tue Jan 18 11:52:40 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Jan 18 11:52:46 2005
Subject: [Fwd: Re: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts
	after last miktex update]
Message-ID: <41ECEA78.3060308@wxs.nl>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
An embedded message was scrubbed...
From: h h extern <pragma@wxs.nl>
Subject: Re: [NTG-pdftex] Re: [NTG-context] ConTeXt dont work with fonts after
	last miktex update
Date: Tue, 18 Jan 2005 11:51:41 +0100
Size: 2820
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050118/d1c11da8/NTG-contextConTeXtdontworkwithfontsafterlastmiktexupdate.mht
From noreply at sarovar.org  Tue Jan 18 22:19:39 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Jan 18 22:22:47 2005
Subject: [NTG-pdftex] [ pdftex-Patches-257 ] Experimental patch for pdftex
	character protrusion
Message-ID: <E1Cr0lH-0000Yv-00@sarovar.org>

Patches item #257, was opened at 2005-01-10 21:43
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106

Category: None
Group: Unstable (example)
Status: Open
Resolution: None
Priority: 3
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Experimental patch for pdftex character protrusion

Initial Comment:
Normally items inside a \hbox are not considered for
protrusion. With this experimental patch also nested
\hboxes at the left and right margin are recursively
searched for items with \lpcode or \rpcode, and the
outmost containing boxes are protruded correspondingly.

This seems to be practical e. g. if an elevated
\footnote{foo} (LaTeX) index happens to be at the right
margin; in this case the footnote index normally is
placed too far inward the line. This disturbance was
detected by Peter Muthesius in an de.comp.text.tex news
thread "pdfcprot und Ziffern am rechten Rand" started
Sat Jan 08 14:05:23 CET 2005.

Rough experimental patch, rudimentarily tested with
left and right protrusion, see test file xx.tex with
output xx.pdf. Just for discussion.

No warranty. Have fun!

Regards, Hartmut


----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-18 22:19

Message:
Logged In: YES 
user_id=929

Character protrusion patch news:

* The protrusion character can now be inside deeply nested
\hbox{}, with further (also nested) skipable \hbox{} stuff
in the way. The nested list will be recursively searched
until a non-skipable item (protrusion character, other
character, or list end) is found.

* Try to solve left protrusion at paragraph start with
\parindent=0pt,by selectively skipping over TeX's empty
\hbox{} there.

* Protrusion character search by 2 new functions
find_protchar_left() and find_protchar_right(), and simple
stack.

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106
From hartmut_henkel at gmx.de  Tue Jan 18 22:57:10 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Jan 18 22:57:16 2005
Subject: [NTG-pdftex] character protrusion with the first letter in a
	paragraph
In-Reply-To: <41987217.6000503@wxs.nl>
References: <20041114005338.GA302@monty> <41987217.6000503@wxs.nl>
Message-ID: <Pine.LNX.4.61.0501182229230.18356@hahepc1.hahe>

On Mon, 15 Nov 2004, Hans Hagen wrote:

> The Thanh Han wrote:
> >
> > I have been thinking of the question how to make char protrusion
> > work with the first char of a paragraph. The simplest (and quite
> > robust) solution can be as follows: when considering whether a
> > marginal kern should be inserted, we skip certain kinds of
> > `invisible' node (like adjust node, penalty node and the like). Now
> > to make it work with the first char of a par, we also skip null
> > boxes (box with zero dimen and empty contents) at the left margin.
> > The question is whether such behaviour is ``correct'', and what
> > surprises it can bring in certain situations.
>
> there are several solutions possible:
>
> <nothing><null box>text text text text
>
> here it looks safe to me to do as you suggest, it can of course be
> made into an option, say \pdfprotrudeparstart=1 or so
>
> <something><null box>text text text text

these two cases i tried to handle in the experimental patch 257. At
paragraph start the empty \hbox{} inserted by TeX is skipped, if
\parindent=0pt. Else, inside the paragraph the discardable items at line
start are skipped. Then the cp_skipable things are skipped, while diving
in and out \hboxes, if any.

> is more tricky since one may use the box in order to prevent
> protruding; on the other hand, if you ignore all null boxes, then it
> maybe nice to have something
>
> \noprotrusion, which introduces a special node, which in itself may be
> tricky, although pdftex introduces new nodes anyway

Also any empty or non-empty box with some height or depth does this, e.
g. "\vphantom." Maybe that's enough?

> I can also imagine something \pdfprotrudeleft (and right) that can be
> inserted manually (or everypar'd; in that case it would be handy to
> finally have \everyendpar available as well); imagine:
>
> \pdfprotrudeleft \hbox {somechar} some text
>
> \pdfprotrudeleft \hbox {\hbox {somechar}} some text

at least now it would find "somechar" inside the box if this is
protrudable.

> how difficult is it to let pdftex in that case follow the list until
> it finds a char (here 's'); this woudl permit things like
>
> \pdfprotrudeleft \hbox {x\hskip-2pt x} some text

To _hide_ the whole \hbox until "s" is found and active at the margin?

Or should one allow protrusion of "s" in things like \llap{foo}s?

Regards, Hartmut
From hanthethanh at myrealbox.com  Wed Jan 19 12:47:57 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu Jan 20 10:53:51 2005
Subject: [NTG-pdftex] character protrusion with the first letter in a
	paragraph
In-Reply-To: <Pine.LNX.4.61.0501182229230.18356@hahepc1.hahe>
References: <20041114005338.GA302@monty> <41987217.6000503@wxs.nl>
	<Pine.LNX.4.61.0501182229230.18356@hahepc1.hahe>
Message-ID: <20050119114757.GA1065@monty>

On Tue, Jan 18, 2005 at 10:57:10PM +0100, Hartmut Henkel wrote:
> On Mon, 15 Nov 2004, Hans Hagen wrote:
> 
> > The Thanh Han wrote:
> > >
> > > I have been thinking of the question how to make char protrusion
> > > work with the first char of a paragraph. The simplest (and quite
> > > robust) solution can be as follows: when considering whether a
> > > marginal kern should be inserted, we skip certain kinds of
> > > `invisible' node (like adjust node, penalty node and the like). Now
> > > to make it work with the first char of a par, we also skip null
> > > boxes (box with zero dimen and empty contents) at the left margin.
> > > The question is whether such behaviour is ``correct'', and what
> > > surprises it can bring in certain situations.
> >
> > there are several solutions possible:
> >
> > <nothing><null box>text text text text
> >
> > here it looks safe to me to do as you suggest, it can of course be
> > made into an option, say \pdfprotrudeparstart=1 or so
> >
> > <something><null box>text text text text
> 
> these two cases i tried to handle in the experimental patch 257. At
> paragraph start the empty \hbox{} inserted by TeX is skipped, if
> \parindent=0pt. Else, inside the paragraph the discardable items at line
> start are skipped. Then the cp_skipable things are skipped, while diving
> in and out \hboxes, if any.
> 
> > is more tricky since one may use the box in order to prevent
> > protruding; on the other hand, if you ignore all null boxes, then it
> > maybe nice to have something
> >
> > \noprotrusion, which introduces a special node, which in itself may be
> > tricky, although pdftex introduces new nodes anyway
> 
> Also any empty or non-empty box with some height or depth does this, e.
> g. "\vphantom." Maybe that's enough?

definitively. How to *block* protrusion is trivial. How to make it work
is more tricky :)

> > I can also imagine something \pdfprotrudeleft (and right) that can be
> > inserted manually (or everypar'd; in that case it would be handy to
> > finally have \everyendpar available as well); imagine:
> >
> > \pdfprotrudeleft \hbox {somechar} some text
> >
> > \pdfprotrudeleft \hbox {\hbox {somechar}} some text
> 
> at least now it would find "somechar" inside the box if this is
> protrudable.

making char protrusion work with metarial inside boxes is already a bug
step and would solve a lot of problems.

> > how difficult is it to let pdftex in that case follow the list until
> > it finds a char (here 's'); this woudl permit things like
> >
> > \pdfprotrudeleft \hbox {x\hskip-2pt x} some text
> 
> To _hide_ the whole \hbox until "s" is found and active at the margin?
> 
> Or should one allow protrusion of "s" in things like \llap{foo}s?

I don't know what it can be good for. If there is a need to protrude
something that is not a character, using some virtual character may
solve the problem faster.

Thanh
From ms at artcom-gmbh.de  Thu Jan 20 12:25:34 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Jan 20 12:25:37 2005
Subject: [NTG-pdftex] 1.20c
Message-ID: <20050120112534.GJ15507@blau.artcom-gmbh.de>

Hi,
Thomas Esser is close to releasing teTeX 3.00 and asks for a new
version of pdftex with all open bugs (!) fixed.

Is there anything besides #242 and xpdf 3.00pl3 that should go
in?

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Fri Jan 21 00:38:48 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 21 00:42:14 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when including
	pdf file without embedded fonts
Message-ID: <E1Crlt2-0005gG-00@sarovar.org>

Bugs item #242, was opened at 2004-12-02 20:01
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106

Category: Fonts
Group: v1.20b
Status: Open
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Assertion failure when including pdf file without embedded fonts

Initial Comment:
See included shell script

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2005-01-21 05:08

Message:
Logged In: NO 

I?ve already contacted the owner of LJBOOK.com and he 
doesn?t see a problem with it on his end. I don?t know if 
it has something to do with the PDF or not. I?m writing in 
English in the United States. I have Adobe Reader 6.0.

I?ve tried multiple times to make a copy of my Livejournal 
through ljbook.com without success. I have a lot of 
entries, all ?friends only? or ?private? from 2002 to 
2005. When I make the copy of my journal into the PDF, a 
majority of the words with apostrophes and ?quotes? like 
I?ll, Don?t, She?s, Couldn?t, That?s, How?s, etc. gets 
replaced by a symbol that looks like a weird letter ?a? 
with something on top of it. The actual apostrophe gets 
replaced with the symbol and makes those words look 
separated and weird. I?ve tried multiple times and the 
same problem occurs. It shows more in the years 2004 and 
2005 but it does show in the 2002 and 2003 entries also, 
when it?s in the PDF. I also tried those years on its own 
and get the same problem. I have the ?Auto-convert older 
entries from? set correctly and the encodings set properly 
and still have the problem. Could you please help me out? 
I?m really in need to backup my journal and don?t know why 
almost all the words that have apostrophes are turning the 
apostrophes into that symbol when it?s in the PDF format. 
When it?s in my regular Livejournal, it?s perfect and 
doesn?t show that. Just when it?s backed up into the PDF.

Please help me out. I would really appreciate it a lot. 
Thank you very much in advance.

liveatshea@hotmail.com 



----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-13 04:49

Message:
Logged In: YES 
user_id=929

This is a patch for file mapfile.c of pdftex-1.20, cleaning
up a few bugs introduced by patch-242c. The obsolete
qualifier "!" is removed from scanning. Blank handling
between qualifiers "<", "<<" and .enc and f_name names has
been re-introduced, to make it backward compatible and
compatible to the preferences of map file writers.

Please test carefully. Help welcome.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 20:23

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Thomas Esser (tetex)
Date: 2004-12-03 05:00

Message:
Logged In: YES 
user_id=1230

I can reproduce this bug after
  updmap --setoption pdftexDownloadBase14 false

Thomas

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106
From noreply at sarovar.org  Fri Jan 21 10:44:25 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 21 10:47:18 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1CrvL7-0003Hw-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 15:14
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From noreply at sarovar.org  Fri Jan 21 10:58:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 21 11:01:38 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1CrvYw-0003Nz-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From ms at artcom-gmbh.de  Fri Jan 21 11:05:26 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Jan 21 11:05:29 2005
Subject: [NTG-pdftex] non-logged-in postings (was: [ pdftex-Bugs-262 ]
	Type42 inclusion)
In-Reply-To: <E1CrvYw-0003Nz-00@sarovar.org>
References: <E1CrvYw-0003Nz-00@sarovar.org>
Message-ID: <20050121100526.GQ15507@blau.artcom-gmbh.de>

On 2005-01-21 15:28:42 +0530, noreply@sarovar.org wrote:
> Also please login when commenting on this or any other bug.

I've disabled non-logged-in postings.

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Fri Jan 21 15:57:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 21 16:00:43 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1Cs0EI-0001zB-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From ms at artcom-gmbh.de  Fri Jan 21 16:16:03 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Jan 21 16:16:07 2005
Subject: [NTG-pdftex] 1.20c-beta-20050121
In-Reply-To: <20050120112534.GJ15507@blau.artcom-gmbh.de>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
Message-ID: <20050121151603.GF24453@blau.artcom-gmbh.de>

> p4 describe -s 6738
Change 6738 by ms@artcom on 2005/01/21 15:38:24

        pdftex: 1.20c-beta-20050121

Affected files ...

... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/NEWS#78 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/README#25 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/mapfile.c#28 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftex.ch#161 edit

--------------------------------------------------------------
pdfTeX 3.141592-1.20c-beta-20050121 was released on 2005-01-21
--------------------------------------------------------------
- Fixed a bug in the scanning of map lines introduced in the the fix of bug
  #242 in 1.20b.
  
- Fixed three problems in xpdf; xpdf is now 3.00pl3

- \ifeof18 is a simple method to test if \write18 is enabled.

It's in p4 and in sarovar (http://sarovar.org/projects/pdftex/).

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Fri Jan 21 23:13:43 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Jan 21 23:16:51 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1Cs72F-0004F4-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 23:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From hanthethanh at myrealbox.com  Fri Jan 21 08:09:52 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat Jan 22 06:20:12 2005
Subject: [NTG-pdftex] 1.20c
In-Reply-To: <20050120112534.GJ15507@blau.artcom-gmbh.de>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
Message-ID: <20050121070952.GA1112@monty>

Hi,

Hartmut has made a lot of patches, concerning mainly map file handling
and char protrusion. Hartmut can tell better whether these patches
should be in 1.20c.

Beside, I am also working on ttf support. Don't know when they will be
done, and whether this change should go to the new release of tetex. 

When will tetex-3.0 be released?

Thanh

On Thu, Jan 20, 2005 at 12:25:34PM +0100, Martin Schroeder wrote:
> Hi,
> Thomas Esser is close to releasing teTeX 3.00 and asks for a new
> version of pdftex with all open bugs (!) fixed.
> 
> Is there anything besides #242 and xpdf 3.00pl3 that should go
> in?
> 
> Best regards
>         Martin
> -- 
>                Martin Schr?der, ms@artcom-gmbh.de
>      ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
>           Voice +49 421 20419-44 / Fax +49 421 20419-10
>                     http://www.artcom-gmbh.de
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From te at dbs.uni-hannover.de  Sat Jan 22 09:05:08 2005
From: te at dbs.uni-hannover.de (Thomas Esser)
Date: Sat Jan 22 09:05:15 2005
Subject: [NTG-pdftex] 1.20c
In-Reply-To: <20050121070952.GA1112@monty>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121070952.GA1112@monty>
Message-ID: <20050122080508.GA28631@dbs.uni-hannover.de>

> When will tetex-3.0 be released?

I'll hopefully make a new release candidate this weekend (dvips updates
are pending) and if all goes well the 3.0 release at the end of this month
(i.e. a week later). So, not much time left...

In the past, I did promisse teTeX-3.0 for "sometime in 2004", so I am
already late.

Thomas
From hartmut_henkel at gmx.de  Sat Jan 22 09:44:36 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sat Jan 22 09:44:42 2005
Subject: [NTG-pdftex] 1.20c
In-Reply-To: <20050121070952.GA1112@monty>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121070952.GA1112@monty>
Message-ID: <Pine.LNX.4.61.0501220917510.1232@hahepc1.hahe>

On Fri, 21 Jan 2005, The Thanh Han wrote:

> Hartmut has made a lot of patches, concerning mainly map file handling
> and char protrusion. Hartmut can tell better whether these patches
> should be in 1.20c.

Patch #242 is only fixing the recent "< "-bug (it's already in 1.20c,
runs ok). Thanks a lot to Martin for 1.20c! There isn't more map related
stuff yet. And the protrusion patch #257 would be much too early for
pdftex in teTeX, it's only experimental, needs heavy checking (i can't
spot an error, but i don't have the overview what hz or this TeX list
business with discardables does), only Thanh can tell, then maybe put it
into pdfxtex first. I'll try to make a pdfxtex.ch3...

Regards, Hartmut
From noreply at sarovar.org  Sat Jan 22 14:36:21 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Jan 22 14:39:44 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1CsLR7-0000yl-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-22 14:36

Message:
Logged In: YES 
user_id=2197

Hello,

dvips also chokes if it tries to subset the font, including
it completely works though. I don't really know if it's
worth implementing support for Type42 in pdftex, I wouldn't
use it either -- I just tried to find out if dvips+ttf
without loss of hinting information is really a no-go as
often claimed. Result was: no, no problem ;-)

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 23:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From reinhard.kotucha at web.de  Sun Jan 23 00:52:56 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun Jan 23 00:53:11 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <E1Cq0HY-0008Og-4o@xenon.Stanford.EDU>
References: <E1Cq0HY-0008Og-4o@xenon.Stanford.EDU>
Message-ID: <16882.59224.380051.241668@zarniwoop.ms25.local>

I send a copy to ntg-pdftex@ntg.nl because I don't know how pdftex
deals with fonts in embedded PDF files.

>>>>> "Tomas" == Tomas G Rokicki <rokicki@CS.Stanford.EDU> writes:

  > I just submitted a fix for the problem where a document includes a
  > figure that uses a downloaded PostScript font, and that same font
  > is also used by the main document itself.  Dvips was partially
  > downloading the font in this case when it should have downloaded
  > the entire font.  It now does download the entire font.

If I understand you correctly, you want to put the entire font into
the output file if the /FontName of the font in the included eps-file
is the same as a font used by TeX (the /FontName in psfonts.map).

This will solve a few problems but not all.  The main problem is that
this solution assumes that a font in an embedded eps file and a font
in texmf with the same /FontName are identical.  But unfortunately we
cannot rely on this.

One example is /Courier.  http://ms25.ath.cx/courier.pdf shows the
difference between /leftquote in URW Courier and IBM Courier provided
by XFree86 (/usr/X11R6/lib/fonts/Type1/cour.pfa).

If you have problems downloading the file, let me know.

Both have "/FontName /Courier def" but they are totally different.

Another problem are the free URW fonts.  They are under GPL and
someone added cyrillic glyphs to the fonts.  The modified fonts are
distributed with ghostscript.  When I looked into them, they still
needed some refinement.  Walter Schmidt maintains the original URW
fonts on CTAN for exactly this reason.

Assume that someone creates an eps file using the cyrillic glyphs from
the gs fonts, does it really help if dvips include the entire font
from the the texmf tree (which does not have cyrillic glyphs)?

I think it's better not to touch eps files if possible.  People expect
that if they can be printed, they can be included into a TeX document.
In most cases you get better results if you replace an embedded font
by one provided by a TeX distribution but in some cases the result
might be not what people expect.  Checking the /UniqueID would
minimize the risk but for fonts under GPL I wouldn't even rely on
this.

Isn't it better to rename the TeX fonts (the fonts mentioned in
dvips.map)?  For instance, from psfonts.map:

bchb8r CharterBT-Bold "TeXBase1Encoding ReEncodeFont" <8r.enc <bchb8a.pfb

When loading a font, replace "/CharterBT-Bold" by "/bchb8a" and then
"/bchb8a findfont" instead of "/CharterBT-Bold findfont".

There are some legal problems as well.  If the user requires
subsetting in psfonts.map and for some reason the entire font is
included, there should at least be a warning message on screen.
Some font suppliers disallow distribution of files containing entire
fonts.

Your approach leads to smaller files.  I like this, of course.  Maybe
checking the /UniqueID is sufficient if we assume that people
providing modified fonts are clever enough to change the /UniqueID as
well.  I must admit that I don't know whether you already do this.

At the DANTE-2003 I had a discussion about problems like this with
Walter Schmidt.  At this time he was thinking about changing /FontName
in the free URW fonts on CTAN, but I disliked this approach because it
only solves problems with the fonts he maintains.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Sun Jan 23 16:12:12 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun Jan 23 16:12:49 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <200501231448.j0NEmIE15028@f7.net>
References: <200501231448.j0NEmIE15028@f7.net>
Message-ID: <Pine.LNX.4.61.0501231605050.16094@hahepc1.hahe>

On Sun, 23 Jan 2005, Karl Berry wrote:

>     At this time he was thinking about changing /FontName
>     in the free URW fonts on CTAN
>
> I sincerely hope Walter does not do that.  Seems like it would have
> major backward-compatibility implications.

e. g. there would be problems with pdftex: while trying to replace fonts
coming with PDF files to be embedded, pdftex would not match the
traditional fontnames any more and would fail replacing fonts (like
/Times-Roman), then the whole font replacement business would be
practically broken, resulting in larger filesize in these cases. Same if
one would also check for matching UniqueId field. So maybe it's better
that it remains fuzzy as is (with a few sideeffects). Or maybe invent a
font name alias mechanism as Fontmap from gs.

Regards, Hartmut
From rokicki at CS.Stanford.EDU  Sun Jan 23 02:03:51 2005
From: rokicki at CS.Stanford.EDU (Tomas G. Rokicki)
Date: Sun Jan 23 21:16:03 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
Message-ID: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>

All your points are good, but I clain the "fix" is still an improvement,
and for that reason I am leaving it in there.

Perhaps I am naive, but if someone gives me an environment in which
there are multiple, and distinctly different, fonts, with the same
/FontName, I claim all bets are off.  I have encountered this before
and it's not a good situation.  At this time I simply don't have a
solution for a case like this.

On the other hand, I do agree that it is better to rename the TeX
fonts if we will partially subset them.  I believe we should do this
(assuming technically we can make it work; I do not know that we
cannot, nor do I know of specific issues, but I would not be surprised
if this breaks something).  Of course there are legal issues with
renaming a font too, most likely.  :-)  This is something to consider
for the next release (not only of dvips but also of pdftex, I believe).
But I believe this is a substantial change to a piece of code that I am
simply not familiar enough with to mess with.  I do know that I have
had in the past substantial problems with just changing the UniqueID
of the font; different interpreters were very unhappy with some of the
changes I made and I had to back them out.  But that's just a technical
issue.

On the legal issue:  I agree a warning may be appropriate whenever a
font is included in its entirety.  Right now dvips turns a deaf ear
to these issues, but it is perhaps time for it to support at the
very least a warning message.

Another alternative is to run all included graphics through a
companion interpreter that's been configured to only collect information
on what characters and what fonts are used (probably by redefining
show and a few other operators).  But this is another substantial
undertaking.

Just so we are very clear:  is it your position that this change that
was made should be reversed?  Or improved before the next release?
Both of these positions would be troublesome for me.  If it's just a
question of, here's some additional issues to consider and let's try
to get a solution to them as quickly as possible, I could not agree
more.

I must say that I've had no indication that the problems you mention
are severe (i.e., causing problems for people), but perhaps that is
because I don't follow most of the TeX groups.

I believe this is a discussion that we should have as part of a larger
group, so I am happy to have gotten your note, and I hope our
collected wisdom on these groups will steer us all in the appropriate
direction.  But for now I've got to get a point release out the
door.

-tom
From karl at freefriends.org  Sun Jan 23 15:48:18 2005
From: karl at freefriends.org (Karl Berry)
Date: Sun Jan 23 21:16:03 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>
Message-ID: <200501231448.j0NEmIE15028@f7.net>

    I agree a warning may be appropriate whenever a
    font is included in its entirety.

May I suggest a modification: whenever a *proprietary* font (that is,
one with the restrictive licensing) is included.

It would be quite a lot of noise to generate a warning for every
fully-included font, as most commonly-used fonts in the TeX world are
free.  Seems like any "real" warning regarding problematic fonts would
quickly be lost in the swamp of resulting messages.

The only thing I can think of is some kind of additional map file option
(ugggh) to generate the warning.  Then when people (like Walter)
generate TeX support for proprietary fonts, the pregenerated map files
can specify the new option.

Further: any changes to map file syntax should be coordinated with
pdftex and dvipdf[m][x], as another long-term goal should be to re-unify
map files so that the same syntax can be used for all programs.  It is a
hassle for TeX Live and other distributions to have maintain the same
information in three formats with only tiny differences.


Also, I'm not sure if this is already included in the discussion, but
any such warning should presumably apply when the font is fully
downloaded at all, independent of whether that happens due to an .eps
inclusion or simply using the font in the document.


    At this time he was thinking about changing /FontName
    in the free URW fonts on CTAN

I sincerely hope Walter does not do that.  Seems like it would have
major backward-compatibility implications.

karl
From pragma at wxs.nl  Sun Jan 23 23:07:44 2005
From: pragma at wxs.nl (h h extern)
Date: Sun Jan 23 23:07:53 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <200501231448.j0NEmIE15028@f7.net>
References: <200501231448.j0NEmIE15028@f7.net>
Message-ID: <41F42030.9070207@wxs.nl>

Karl Berry wrote:

> May I suggest a modification: whenever a *proprietary* font (that is,
> one with the restrictive licensing) is included.
> 
> It would be quite a lot of noise to generate a warning for every
> fully-included font, as most commonly-used fonts in the TeX world are
> free.  Seems like any "real" warning regarding problematic fonts would
> quickly be lost in the swamp of resulting messages.

if that kind of crappy messages are really needed, then please only to the log 
file and optional

> The only thing I can think of is some kind of additional map file option
> (ugggh) to generate the warning.  Then when people (like Walter)
> generate TeX support for proprietary fonts, the pregenerated map files
> can specify the new option.

that will become a never ending story then; there are all kind of thinsg going on:

- you may mess up the design, metrics, glyph programs all under the same name 
[no fonts]
- you may mess up the design, metrics, glyph programs all under a different name 
[cmr]
- you may use the font, make virtual instances, change metrics, but need to keep 
the design intact (may not create clones) [like utopia]
- you may use the font, but not distribute file that contain all glyphs at the 
same time [lucida]

i'm not even sure what category the palatino falls in: since there is an 
official one -from linotype- i even wonder if we may call all those variants on 
tex live palatino at all; it's funny that we're discussing them as being 
'programs' i.e. some gpl being applied to them while part of the copyright [at 
least on the type 1's] not concerns the 'implementation' but the design, which 
deserves its own kind of licence [artistic ownership and such];

> Further: any changes to map file syntax should be coordinated with
> pdftex and dvipdf[m][x], as another long-term goal should be to re-unify
> map files so that the same syntax can be used for all programs.  It is a
> hassle for TeX Live and other distributions to have maintain the same
> information in three formats with only tiny differences.

hm, not change, dvipdfmx and dvips should just use the pdftex one (i need to 
check it, but some time ago the dvipdfmx people were working along those lines, 
including runtime mapfile/line definitions)

> Also, I'm not sure if this is already included in the discussion, but
> any such warning should presumably apply when the font is fully
> downloaded at all, independent of whether that happens due to an .eps
> inclusion or simply using the font in the document.
>  
>     At this time he was thinking about changing /FontName
>     in the free URW fonts on CTAN
> 
> I sincerely hope Walter does not do that.  Seems like it would have
> major backward-compatibility implications.

normally the copyright lines that are part of a font are copied into the pdf 
file along with the shape definitions, metric info, etc etc; so .. that part 
should be correct.

[i think that as soon as users start seeing funny font copyright messages at 
runtime, they will stop using the fonts, and in the end we will end up with cmr 
only files]

Hans


btw

i have no problem with copyrighted font designs, as long as we may mess around 
with the metrics, which is normally no problem since all dtp programs mess 
around with them when typesetting text, so messing around is part of the game; 
actually, messing around with the shapes is also permitted since that can be 
done in most vector drawing programs, as long as one does not produce and 
distribute a new font; so ... i do't really see the problem; ever since pdf was 
around, the only problems has been:

- some font vendors don't permits any font to be part of a posted pdf; solution: 
i simply refuse to use such fonts

- some font vendors don't permits a complete instance to be part of a posted 
pdf, since usa law than seems to imply that the font is kind of public since 
someone with a twisted mind can copy the font from the file and use it; 
solution: always embed subsets, which is kind of default behaviour for pdftex

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Mon Jan 24 04:04:05 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon Jan 24 04:04:26 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>
References: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>
Message-ID: <16884.26022.71128.839175@zarniwoop.ms25.local>

>>>>> "Tomas" == Tomas G Rokicki <rokicki@CS.Stanford.EDU> writes:

  > All your points are good, but I clain the "fix" is still an
  > improvement, and for that reason I am leaving it in there.

Yes.  It is definitely an improvement and should not be reversed.  It
seems that pdftex and dvips now behave similar, which also is an
advantage.

And a quick fix isn't what I want if it has an impact on reliability.
But it is something one should keep in mind for future versions.

  > Perhaps I am naive, but if someone gives me an environment in
  > which there are multiple, and distinctly different, fonts, with
  > the same /FontName, I claim all bets are off.  I have encountered
  > this before and it's not a good situation.  At this time I simply
  > don't have a solution for a case like this.

You already live in such an environment.  At the university we had a
Kyocera printer with built in Bitstream fonts.  The /Courier had the
same problem as the IBM Courier, you couldn't distinguish between a
/leftquote and a /rightquote at normal sizes (10pt ... 12pt).  In this
case you have to download the font.  And you must always download
Courier if you want your document to be portable.

The nasty thing is that people use Courier for printing program code.
I prefer cmtt for things like that, anyway.  But some people still use
Courier.

  > On the other hand, I do agree that it is better to rename the TeX
  > fonts if we will partially subset them.  I believe we should do
  > this (assuming technically we can make it work; I do not know that
  > we cannot, nor do I know of specific issues, but I would not be
  > surprised if this breaks something).

AFAIK, fonts in PostScript files are always global so that they cannot
be handled by save/restore or gsave/grestore, but I'm not sure.  If
this is true, then I do not see any other solution than to rename one
of them if an embedded font and a TeX font have the same /FontName but
are different.

To decide whether two fonts are different it's better to compare their
/UniqueIDs rather than their /FontNames.  Or probably both.

  > with to mess with.  I do know that I have had in the past
  > substantial problems with just changing the UniqueID of the font;
  > different interpreters were very unhappy with some of the changes
  > I made and I had to back them out.  But that's just a technical
  > issue.

That's strange.  From the viewpoint of a PS interpreter a UniqueID is
an arbitrary number.  

  > Another alternative is to run all included graphics through a
  > companion interpreter that's been configured to only collect
  > information on what characters and what fonts are used (probably
  > by redefining show and a few other operators).  But this is
  > another substantial undertaking.

Interesting point.  If you only want to use an external interpreter to
solve the problems we talked about, it's probably not worth the
effort.  This could be handled by an external program as well which
also fixes %%BoundingBox: (atend).

There are some limitations in dvips because it lacks a PS
interpreter.  For instance, I wrote a script which used dvips -E to
convert TeX formulas to eps and then converted them to png.  

I tried the same with graphics, but that failed because dvips doesn't
understand PostScript's scale, translate and rotate operators.

If you want to support something like that, it makes sense to think
about it.  As far as eps-files are concerned, an external program
wouldn't be bad.  

It could check whether the required font exists in texmf, and if this
is true, determine the subset, remove the font and add a comment to
the eps file which is similar to that what metapost inserts if the
prologues variable is not set.  

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From reinhard.kotucha at web.de  Mon Jan 24 05:01:25 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon Jan 24 05:01:42 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <200501231448.j0NEmIE15028@f7.net>
References: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>
	<200501231448.j0NEmIE15028@f7.net>
Message-ID: <16884.29461.621824.110928@zarniwoop.ms25.local>

>>>>> "Karl" == Karl Berry <karl@freefriends.org> writes:

  >     I agree a warning may be appropriate whenever a font is
  > included in its entirety.

  > May I suggest a modification: whenever a *proprietary* font (that
  > is, one with the restrictive licensing) is included.

It's probably too hard to find out which font is proprietary.

  > It would be quite a lot of noise to generate a warning for every
  > fully-included font, as most commonly-used fonts in the TeX world
  > are free.  Seems like any "real" warning regarding problematic
  > fonts would quickly be lost in the swamp of resulting messages.

dvips already lists all fonts on STDOUT, isn't it sufficient to put an
asterisk behind each font that had been loaded entirely and then issue
a message like "*) Some Fonts had not been subsetted" at the end if at
least one asterisk appears?

The message is just an example.  It should be understood by people who
do not know what subsetting is.  But English is not my native
language, feel free to provide better suggestions.

Hans, is this ok for you?  Or is it still too crappy?

  > The only thing I can think of is some kind of additional map file
  > option (ugggh) to generate the warning.  Then when people (like
  > Walter) generate TeX support for proprietary fonts, the
  > pregenerated map files can specify the new option.

I don't see that there is any need to change the map files.

Usually there is no need to download an entire font.  The map files
provided by TeX distributions are set up to do subsetting by default.
My only concern is that people rely on this and do not notice that
they violate against licenses because something happens in the
background they are not aware of.

  > Further: any changes to map file syntax should be coordinated with
  > pdftex and dvipdf[m][x], as another long-term goal should be to
  > re-unify map files so that the same syntax can be used for all
  > programs.  It is a hassle for TeX Live and other distributions to
  > have maintain the same information in three formats with only tiny
  > differences.

Of course.

  > Also, I'm not sure if this is already included in the discussion,
  > but any such warning should presumably apply when the font is
  > fully downloaded at all, independent of whether that happens due
  > to an .eps inclusion or simply using the font in the document.

Sounds quite straightforward:  An asterisk for each font which is
included entirely, independent of the map file entry.

  >     At this time he was thinking about changing /FontName in the
  > free URW fonts on CTAN

  > I sincerely hope Walter does not do that.  Seems like it would
  > have major backward-compatibility implications.

No, he didn't.  It was an idea which came up during the conference
dinner, but he changed his mind quite soon.  I just metioned it to
show that I'm not the only one who sees problems here.

Karl, if anyone changes some font names, I suppose you are the first
one who will notice this because he will ask you to update the
fontname database you maintain.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From pragma at wxs.nl  Mon Jan 24 09:55:05 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Jan 24 09:55:36 2005
Subject: [NTG-pdftex] Re: [tex-k] Dvips fix for font in EPSF improperly
	downloaded
In-Reply-To: <16884.29461.621824.110928@zarniwoop.ms25.local>
References: <E1CsWAR-0001oX-6E@xenon.Stanford.EDU>
	<200501231448.j0NEmIE15028@f7.net>
	<16884.29461.621824.110928@zarniwoop.ms25.local>
Message-ID: <41F4B7E9.9090007@wxs.nl>

Reinhard Kotucha wrote:

> The message is just an example.  It should be understood by people who
> do not know what subsetting is.  But English is not my native
> language, feel free to provide better suggestions.
> 
> Hans, is this ok for you?  Or is it still too crappy?

i can live with one line (but don't expect the average user to understand what 
subsetting is -)

> Usually there is no need to download an entire font.  The map files
> provided by TeX distributions are set up to do subsetting by default.
> My only concern is that people rely on this and do not notice that
> they violate against licenses because something happens in the
> background they are not aware of.

my guess is that no font ever gets embedded completely, since (1) tex does not 
use the space and (2) no tex encoding uses all slots; maybe pdftex should always 
   subset

> Sounds quite straightforward:  An asterisk for each font which is
> included entirely, independent of the map file entry.

indeed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Jan 26 09:52:08 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Jan 26 09:52:12 2005
Subject: [NTG-pdftex] pdf inclusion
Message-ID: <41F75A38.1040206@wxs.nl>

Hi,

I was wondering, it it technically difficult to include a specific xobject 
(xform) from a pdf file (not so much different from including a page)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hanthethanh at myrealbox.com  Wed Jan 26 13:46:17 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Jan 26 13:48:27 2005
Subject: [NTG-pdftex] pdf inclusion
In-Reply-To: <41F75A38.1040206@wxs.nl>
References: <41F75A38.1040206@wxs.nl>
Message-ID: <20050126124617.GA1172@monty>

Hi Hans,

On Wed, Jan 26, 2005 at 09:52:08AM +0100, Hans Hagen wrote:
> Hi,
> 
> I was wondering, it it technically difficult to include a specific xobject 
> (xform) from a pdf file (not so much different from including a page)

it should not be difficult.

Thanh
From hartmut_henkel at gmx.de  Wed Jan 26 22:24:48 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed Jan 26 22:24:52 2005
Subject: [NTG-pdftex] Fwd: xpdf library bug? (fwd)
Message-ID: <Pine.LNX.4.61.0501262223310.1889@hahepc1.hahe>

---------- Forwarded message ----------
Date: Wed, 26 Jan 2005 16:19:22 -0500
From: Martin Otte <otte@duke.edu>
To: Hartmut Henkel <hartmut_henkel@gmx.de>
Cc: karl@freefriends.org, Gerben Wierda <Gerben.Wierda@rna.nl>
Subject: Fwd: xpdf library bug?

Hi,

I noticed in the latest pdftex-1.20c-beta-20050121 is a patch that I
made to the file FoFiType1.cc which corrects a seg-fault in pdftex that
occurs when including a document with the Mathematica fonts.

It is probably preferable to instead use the patch from the pdf
maintainer, which should be included with this email. If you have
already made this change, then please disregard my email.

Thanks,
Martin Otte


Begin forwarded message:

> From: "Derek B. Noonburg" <derekn@foolabs.com>
> Date: January 19, 2005 12:39:17 AM EST
> To: karl@freefriends.org
> Cc: Gerben.Wierda@rna.nl, frank@wizards.de, andrew@stone.com,
> otte@duke.edu
> Subject: Re: xpdf library bug?
> Reply-To: "Derek B. Noonburg" <derekn@foolabs.com>
>
> On 12 Jan, Karl Berry wrote:
>> Greetings,
>>
>> The tex-live list got this bug report regarding the xpdf library.
>> You can get the attachments from
>> http://tug.org/pipermail/tex-live/2005-January/007617.html
>>
>> Thanks,
>> karl
>>
>> Subject: pdflatex segmentation fault and patch to fix
>> From:    "Martin Otte" <otte@duke.edu>
>> Date:    Tue, January 11, 2005 23:40
>> To:      gerben.wierda@rna.nl
>>
>> Hi,
>>
>> Thanks for your excellent packaging of tex/latex for the mac.
>>
>> I am using the TeX Live 2004 and teTeX 3 distribution from the tex
>> i-package released on 2004/12/01.
>>
>> With this i-package, pdflatex always seg-faults for me when I include
>>  pdf
>> figures generated using the PStill postscript-to-pdf converter.  These
>> pdfs open fine with Acrobat and Preview. I downloaded the final  TeX
>> Live
>> 2004 source package, compiled pdfetex, ran the executable  under a
>> debugger and found that pdflatex crashes in the xpdf library. I  then
>> verified that these pdf's also crash the xpdf viewer on my linux
>> machine.
>>
>> The crash occurs in the file libs/xpdf/fofi/FoFiType1.cc. There is a
>> string buffer size variable "n" that becomes negative and causes the
>> program to crash. I attached a patch that can be used from the libs
>> directory of the TeX Live distribution that prevents the buffer size
>> from
>> becoming negative.
>
> That's a known bug in Xpdf 3.00.  I'm attaching a patch file which
> should fix it.
>
> - Derek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fofi.patch
Type: application/octet-stream
Size: 833 bytes
Desc: 
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050126/bd0f0931/fofi.obj
From noreply at sarovar.org  Thu Jan 27 10:14:26 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Jan 27 10:18:04 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1Cu5jO-00053P-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 09:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Nobody (None)
Assigned to: Nobody (None)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: The Thanh Han (hanthethanh)
Date: 2005-01-27 09:14

Message:
Logged In: YES 
user_id=710

Hi,

pdftex doesn't support Type42 fonts and probably won't,
unless someone else implements it, as I see little sense in
making it work.

Thanh



----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-22 13:36

Message:
Logged In: YES 
user_id=2197

Hello,

dvips also chokes if it tries to subset the font, including
it completely works though. I don't really know if it's
worth implementing support for Type42 in pdftex, I wouldn't
use it either -- I just tried to find out if dvips+ttf
without loss of hinting information is really a no-go as
often claimed. Result was: no, no problem ;-)

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 22:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 14:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 09:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From noreply at sarovar.org  Thu Jan 27 10:44:38 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Jan 27 10:48:08 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-242 ] Assertion failure when including
	pdf file without embedded fonts
Message-ID: <E1Cu6Cc-0005nv-00@sarovar.org>

Bugs item #242, was opened at 2004-12-02 15:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106

Category: Fonts
Group: v1.20b
>Status: Closed
>Resolution: Invalid
Priority: 5
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Assertion failure when including pdf file without embedded fonts

Initial Comment:
See included shell script

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2005-01-21 00:38

Message:
Logged In: NO 

I?ve already contacted the owner of LJBOOK.com and he 
doesn?t see a problem with it on his end. I don?t know if 
it has something to do with the PDF or not. I?m writing in 
English in the United States. I have Adobe Reader 6.0.

I?ve tried multiple times to make a copy of my Livejournal 
through ljbook.com without success. I have a lot of 
entries, all ?friends only? or ?private? from 2002 to 
2005. When I make the copy of my journal into the PDF, a 
majority of the words with apostrophes and ?quotes? like 
I?ll, Don?t, She?s, Couldn?t, That?s, How?s, etc. gets 
replaced by a symbol that looks like a weird letter ?a? 
with something on top of it. The actual apostrophe gets 
replaced with the symbol and makes those words look 
separated and weird. I?ve tried multiple times and the 
same problem occurs. It shows more in the years 2004 and 
2005 but it does show in the 2002 and 2003 entries also, 
when it?s in the PDF. I also tried those years on its own 
and get the same problem. I have the ?Auto-convert older 
entries from? set correctly and the encodings set properly 
and still have the problem. Could you please help me out? 
I?m really in need to backup my journal and don?t know why 
almost all the words that have apostrophes are turning the 
apostrophes into that symbol when it?s in the PDF format. 
When it?s in my regular Livejournal, it?s perfect and 
doesn?t show that. Just when it?s backed up into the PDF.

Please help me out. I would really appreciate it a lot. 
Thank you very much in advance.

liveatshea@hotmail.com 



----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-13 00:19

Message:
Logged In: YES 
user_id=929

This is a patch for file mapfile.c of pdftex-1.20, cleaning
up a few bugs introduced by patch-242c. The obsolete
qualifier "!" is removed from scanning. Blank handling
between qualifiers "<", "<<" and .enc and f_name names has
been re-introduced, to make it backward compatible and
compatible to the preferences of map file writers.

Please test carefully. Help welcome.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 15:53

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Thomas Esser (tetex)
Date: 2004-12-03 00:30

Message:
Logged In: YES 
user_id=1230

I can reproduce this bug after
  updmap --setoption pdftexDownloadBase14 false

Thomas

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=242&group_id=106
From noreply at sarovar.org  Thu Jan 27 10:46:30 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Jan 27 10:50:00 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1Cu6EQ-0005oM-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

>Category: Fonts
>Group: v1.20b
Status: Open
Resolution: None
>Priority: 3
Submitted By: Nobody (None)
>Assigned to: Hartmut Henkel (hhenkel)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-01-27 10:46

Message:
Logged In: YES 
user_id=421

If we decide that Type42 fonts are unsupported, pdftex
should at least raise a clear error when it finds them.

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2005-01-27 10:14

Message:
Logged In: YES 
user_id=710

Hi,

pdftex doesn't support Type42 fonts and probably won't,
unless someone else implements it, as I see little sense in
making it work.

Thanh



----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-22 14:36

Message:
Logged In: YES 
user_id=2197

Hello,

dvips also chokes if it tries to subset the font, including
it completely works though. I don't really know if it's
worth implementing support for Type42 in pdftex, I wouldn't
use it either -- I just tried to find out if dvips+ttf
without loss of hinting information is really a no-go as
often claimed. Result was: no, no problem ;-)

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 23:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From hanthethanh at myrealbox.com  Fri Jan 28 10:02:12 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat Jan 29 02:57:11 2005
Subject: [NTG-pdftex] pdfcurpageref -- does it make sense?
In-Reply-To: <41EB8143.8020101@wxs.nl>
References: <20050106094723.GC25185@monty> <20050113234122.GB1097@monty>
	<41EB8143.8020101@wxs.nl>
Message-ID: <20050128090212.GB1113@monty>

Hi,

using the 2nd pass processing then would solve this problem without the
need to introduce a new primitive. One can record the page numbers in
1st run, and use those numbers in 2nd run as argument to \pdfpageref. 
Or am I missing some point?

Thanh

On Mon, Jan 17, 2005 at 10:11:31AM +0100, Hans Hagen wrote:
> The Thanh Han wrote:
> 
> >I wonder how Hans and other would solve this problem. tex doesn't have a
> >concept of `current page' while processing the input token list. The
> >page number can be detected reliably only using 2nd pass processing, as
> >the page where some material ends up is known only at shipping phase.
> 
> I use two pass solutions for that.
> 
> I can imagine a primitive \pdfpageobjnum  that expands at shipout time, i.e.
> 
>   \pdfobj{.... \pdfpageobjnum\space 0 R}
> 
> in this case \pdfpageobjnum is like pdfsavepos, during shipout, those 
> placeholders in the shipped out box  are resolved; outside the otr/shipout 
> routine it's zero, so
> 
>   \count15=\pdfpageobjnum
> 
> leads to \count15 being 0
> 
> I guess that the reason for this request is that in media objects one needs 
> to refer to the page where the object (or its visualization) ends up, a kin 
> dof circular reference between definition and usage; since these page 
> references remain in the object (and are not used elsewhere) the delayed 
> resolution during shipout is ok;
> 
> >It is possible to provide a primitive which returns the *next* page object
> >number, but IMHO it doesn't make any sense.
> 
> indeed, things can end up many pages later (think of intermediate float 
> flushing)
> 
> Hans
> 
> 
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
> 
> 
From hanthethanh at myrealbox.com  Fri Jan 28 11:18:35 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat Jan 29 02:57:23 2005
Subject: [NTG-pdftex] Re: [pdftex] pdfeTeX: bad interaction of
	\pdfstartlink...\pdfendlink with \beginR...\endR
In-Reply-To: <Pine.LNX.4.61.0412282334020.24951@hahepc1.hahe>
References: <87y8fmylx9.fsf@vvv.vsu.ru>
	<Pine.LNX.4.61.0412282334020.24951@hahepc1.hahe>
Message-ID: <20050128101835.GH1113@monty>

Hi,

I have no idea how to solve it. Perhaps someone with better
understanding of etex internals can help?

Thanh

On Tue, Dec 28, 2004 at 11:51:40PM +0100, Hartmut Henkel wrote:
> On Sun, 26 Dec 2004, Vladimir Volovich wrote:
> 
> > There seems to be a bug in interaction of right-to-left features of
> > eTeX with pdflink features of pdftex.
> 
> yes, tried to localize it: When the horizontal list is reversed
> (left/right swapped) by function reverse(), so are the \pdfstartlink and
> \pdfendlink whatsits. Then \pdfendlink happens before \pdfstartlink,
> causing the error. Tried to swap links from/to both nodes after
> reversal, so that the start/end sequence is right, but then the 2nd
> error appears:
> 
> > This can't happen (copying). error:
> 
> This seems to be due to a missing style_node: case in @ @<Case statement
> to copy...@>= which might be result from some math node that is
> artificially added during reversing the list or not? Copying also the
> style_node makes it run. But no idea whether that's the right way to do
> it. And there might be more cases like \pdfstartlink and \pdfendlink
> that might need a fix.
> 
> Regards, Hartmut
> 
> _______________________________________________
> pdftex mailing list
> pdftex@tug.org
> http://tug.org/mailman/listinfo/pdftex
> 
From hanthethanh at myrealbox.com  Sat Jan 29 01:39:16 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Sat Jan 29 03:05:50 2005
Subject: [NTG-pdftex] Expanded png inclusion support
In-Reply-To: <41E3FEF3.3010605@elvenkind.com>
References: <E1CoOC7-0005tD-00@sarovar.org> <41E3FEF3.3010605@elvenkind.com>
Message-ID: <20050129003916.GA1295@monty>

Hi,

is anyone doing something with Taco's patch? If not I will merge it to
pdftex sources (will be uploaded soon as 1.20c-beta<date>

Thanh



On Tue, Jan 11, 2005 at 05:29:39PM +0100, Taco Hoekwater wrote:
> 
> Hi,
> 
> This is a complete, working patch, but the zip only contains the actual 
> pngextra.ch and replacement writepng.c, so some manual editting has to 
> be done to the Makefile. The change file needs to be added as the last
> item of the "pdftex_web_srcs" collection, the C file can overwrite the
> current file.
> 
> This version is for testing purposes. I can provide linux 2.6 binaries,
> but I don't know how to create win32 executables, sorry.
> 
> The main part of the patch is the new writepng.c, but there is also
> some web glue to set defaults. The patch contains improvements for PNG
> image inclusion, specifically:
> 
> - alpha channel and transparency (only if %!PDF >=1.4)
> - 16-bit colour (only if %!PDF >=1.5)
> - gamma correction
> - forced reduction to greyscale (for Hans)
> 
> A few primitives had to be introduced to set some default values.
> There are a total of four new primitives, that are all integer 
> parameters. I almost certainly made mistakes in the WEB coding
> (initialization locations etc.), but works well enough for testing.
> 
> Here are  the primitives and their defaults:
> 
>   \pdfoptionpdfimagehicolor = 1
>   %
>   % can be set to 0 if undesirable. This is perhaps needed because
>   % the reader 5 will reject the pdf document's page completely
>   % otherwise.
> 
>   \pdfimagegamma = 2200
>   %
>   % if not supplied in the image. This example implies that the image
>   % was originally created with gamma value 2.2 (like magnification)
> 
> 
>   \pdfgamma = 1000
>   %
>   % Gamma value for the 'pdf device'. It looks like this is the
>   % 'correct' value used by Adobe, but I'm not 100% sure.
> 
>   \pdfoptionimageforcegray = 0
>   %
>   % If 1, all included PNGs are written to the pdf as greyscale.
> 
> The problem with these primitives is that I am unsure how and
> when to convert the internal parameters into their C 'fixedxxxxxx'
> counterparts. It would be a lot cleaner if the C code would use
> the internal parameters directly, but I'm not sure if that is
> even possible. Help needed!
> 
> 
> Greetings, Taco
> 
> noreply@sarovar.org wrote:
> >Patches item #259, was opened at 2005-01-11 16:44
> >
> >Submitted By: Taco Hoekwater (taco)
> >Summary: Expanded png inclusion support
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From noreply at sarovar.org  Sat Jan 29 23:08:40 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Jan 29 23:12:15 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1Cv0lk-0006Gz-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: Fonts
Group: v1.20b
Status: Open
Resolution: None
Priority: 3
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-29 23:08

Message:
Logged In: YES 
user_id=929

The attached simple patch for writet1.c checks the /FontType
key and if it's 42, pdfTeX exits with an error message:

Error: pdfetex (file ./foo.pfb): Type42 fonts unsupported by
pdfTeX

This could be modified so that an error is given if it's
_not_ Type1.But which font types _are_ supported?

Another way might be to check the header comment for
"%!PS-AdobeFont" or "%!FontType1". But all this can be
cheated, and there might be fonts with wrong comment lines
floating around...

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-27 10:46

Message:
Logged In: YES 
user_id=421

If we decide that Type42 fonts are unsupported, pdftex
should at least raise a clear error when it finds them.

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2005-01-27 10:14

Message:
Logged In: YES 
user_id=710

Hi,

pdftex doesn't support Type42 fonts and probably won't,
unless someone else implements it, as I see little sense in
making it work.

Thanh



----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-22 14:36

Message:
Logged In: YES 
user_id=2197

Hello,

dvips also chokes if it tries to subset the font, including
it completely works though. I don't really know if it's
worth implementing support for Type42 in pdftex, I wouldn't
use it either -- I just tried to find out if dvips+ttf
without loss of hinting information is really a no-go as
often claimed. Result was: no, no problem ;-)

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 23:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From pragma at wxs.nl  Sun Jan 30 21:40:32 2005
From: pragma at wxs.nl (h h extern)
Date: Sun Jan 30 21:40:35 2005
Subject: [NTG-pdftex] crashing png graphic 
Message-ID: <41FD4640.6020909@wxs.nl>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
An embedded message was scrubbed...
From: Mojca Miklavec <mojca.miklavec@guest.arnes.si>
Subject: [NTG-context] pdfeTeX crashes
Date: Sun, 30 Jan 2005 05:30:49 +0100
Size: 6524
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050130/3fef1c7b/NTG-contextpdfeTeXcrashes.mht
From hartmut_henkel at gmx.de  Sun Jan 30 22:05:33 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun Jan 30 22:05:37 2005
Subject: [NTG-pdftex] crashing png graphic 
In-Reply-To: <41FD4640.6020909@wxs.nl>
References: <41FD4640.6020909@wxs.nl>
Message-ID: <Pine.LNX.4.61.0501302159340.3678@hahepc1.hahe>

On Sun, 30 Jan 2005, h h extern wrote:

> Date: Sun, 30 Jan 2005 05:30:49 +0100
> From: Mojca Miklavec <mojca.miklavec@guest.arnes.si>
> Reply-To: mailing list for ConTeXt users <ntg-context@ntg.nl>
> To: mailing list for ConTeXt users <ntg-context@ntg.nl>
> Subject: [NTG-context] pdfeTeX crashes

> The problem was most probably caused by PNG images, exported from MS
> PowerPoint slides, an example is on
> http://pub.mojca.org/mailinglists/context/alpha.png.

tried it, it works ok with pdftex-1.20c.

> It looks like a very strange bug. Any ideas?

most likely a bug in the libpng used in pdftex-1.20a. Solution: Upgrade
to pdftex-1.20c which includes libpng 1.2.8.

> libpng warning: Ignoring bad row filter type

> This is pdfeTeX, Version 3.141592-1.20a-2.2 (Web2c 7.5.3) \write18
> enabled.

Regards, Hartmut
From ms at artcom-gmbh.de  Sun Jan 30 23:14:14 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Jan 31 01:03:33 2005
Subject: [NTG-pdftex] crashing png graphic
In-Reply-To: <Pine.LNX.4.61.0501302159340.3678@hahepc1.hahe>
References: <41FD4640.6020909@wxs.nl>
	<Pine.LNX.4.61.0501302159340.3678@hahepc1.hahe>
Message-ID: <20050130221413.GA25212@lucien.kn-bremen.de>

On 2005-01-30 22:05:33 +0100, Hartmut Henkel wrote:
> most likely a bug in the libpng used in pdftex-1.20a. Solution: Upgrade
> to pdftex-1.20c which includes libpng 1.2.8.

1.20b is enough. Getting 1.20c is an experiment in itself. :-)

Best regards
    Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Mon Jan 31 02:59:55 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Jan 31 03:03:13 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-199 ] font expansion: characters may
	vanish
Message-ID: <E1CvQr5-0007Qc-00@sarovar.org>

Bugs item #199, was opened at 2004-09-23 02:43
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106

Category: hz
Group: v1.20a
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: The Thanh Han (hanthethanh)
Summary: font expansion: characters may vanish

Initial Comment:

For extremely large shrink values, characters may not
be visible in the pdf output (although the fonts seem
to be embedded), e.g. in the following file:

%----------------------------------------------
\hsize220pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand
\efcode\font`\s=500
\efcode\font`\e=500
\efcode\font`\y=500

see what you get\penalty-10000

\bye
%----------------------------------------------

or even worse:

%----------------------------------------------
\hsize180pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand

see what you get\penalty-10000

\bye
%----------------------------------------------

The font `cmr17-Extend_100' will not be visible.

I only managed to achieve this effect with extremely
large font sizes, which may or may not be related (it
could also be that I didn't find the `magic' \hsize).

If you force the characters to shrink even more, for
example by setting \hsize to 120pt in the latter test
file, the unexpanded font will be used, thus printing
the characters over each other.


Regards,
Robert  <w.m.l@gmx.net>

PS. I didn't bother to create expanded fonts, so I
cannot tell whether it depends on the autoexpand feature.


----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2005-01-31 07:29

Message:
Logged In: NO 

It seems as if Hartmut's patch hasn't been applied, as the
following test file will still produce incorrect output for
both pdftex 1.20b and 1.20c-beta:

%-------------------------------------------------
\pdfadjustspacing=2
\font\testfont=cmr10 \testfont
\pdffontexpand\font 0 1000 100 autoexpand
\hsize40pt

OK: text text text text\break

not OK: text text text text\break

\bye

%-------------------------------------------------

Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 20:23

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2004-10-02 00:11

Message:
Logged In: YES 
user_id=929

tiny patch tries to solve this bug. See README and PDF test
file included.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-10-01 20:47

Message:
Logged In: YES 
user_id=421

I you mean the effect in the attached pdf: This is either a
bug in Jaws (png attached) or a bug in pdftex. gs 8.30,
harlequin 5.3.4a and AR 5 all display the file distorted. :-(

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-29 03:36

Message:
Logged In: NO 

But the problem I mentioned above in the last paragraph
isn't related to Acrobat Reader, is it?
% ------------------------------------------
\hsize35pt
\pdfadjustspacing=2
\font\testfont=cmr12\testfont
\pdffontexpand\font 0 1000 100 autoexpand

text text text text\penalty-10000

\bye
% ------------------------------------------

Seems like a sanity check is missing somewhere. If my guess
is right, pdftex tries to use the font `cmr17-Extend_0',
which (incorrectly) translates into the base font. What it
should probably do is use the smallest available expanded
font, i.e. in this case Extend_100, and make the line overfull.

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-09-27 20:57

Message:
Logged In: YES 
user_id=421

An Acrobat Reader bug. :-)

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-23 03:32

Message:
Logged In: NO 

Obviously, I filed this report too early. Sorry about that.

It is not a pdftex bug, but appears to be a bug in Acrobat
Reader 6. (Just to tell you what I saw:) At zoom level 200%
or larger, the font most shrunk (Extend_100) is not visible
on screen. That is, in the first example, I only see "See y
e", in the second, nothing at all. However, if I zoom out,
the characters re-appear. 

Sorry for not zooming out earlier. 

Regards,
Robert.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106
From noreply at sarovar.org  Mon Jan 31 03:09:40 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Jan 31 03:12:47 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-274 ] \unhbox kills protrusion
Message-ID: <E1CvR0W-00083f-00@sarovar.org>

Bugs item #274, was opened at 2005-01-31 02:09
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106

Category: hz
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: The Thanh Han (hanthethanh)
Summary: \unhbox kills protrusion

Initial Comment:
Protrusion will break when boxes containing protruded
characters are \unhbox'ed. I've stumbled upon this when
using edmac/ledmac, which decomposes each paragraph
into lines, then reassembling them.

I wasn't sure whether protrusion is supposed to survive
this treatment but it does if one uses \unhcopy instead
of \unhbox.

Here's a greatly reduced example:
%--------------------------------------------
\font\testfont=cmr10 \testfont
\pdfprotrudechars=2
\rpcode\font`\-=1000
\parindent0pt
\hsize=126pt

\newbox\testline
\newbox\testbox
%
\setbox\testbox\vbox{%
   Margin kerning is the adjustments
   of the characters at the
   margins of a typeset text.
}
\loop\ifvbox\testbox
   \setbox\testline=\vsplit\testbox to\baselineskip
   \unvbox\testline
   \setbox\testline=\lastbox
   \hbox to\hsize{\unhcopy\testline}% OK
   \hbox to\hsize{\unhbox\testline} % not OK
\repeat

\bye
% --------------------------------------------------


Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106
From noreply at sarovar.org  Mon Jan 31 13:08:17 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Jan 31 13:11:53 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-199 ] font expansion: characters may
	vanish
Message-ID: <E1CvaLp-0006MP-00@sarovar.org>

Bugs item #199, was opened at 2004-09-22 23:13
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106

Category: hz
Group: v1.20a
>Status: Open
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: The Thanh Han (hanthethanh)
Summary: font expansion: characters may vanish

Initial Comment:

For extremely large shrink values, characters may not
be visible in the pdf output (although the fonts seem
to be embedded), e.g. in the following file:

%----------------------------------------------
\hsize220pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand
\efcode\font`\s=500
\efcode\font`\e=500
\efcode\font`\y=500

see what you get\penalty-10000

\bye
%----------------------------------------------

or even worse:

%----------------------------------------------
\hsize180pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand

see what you get\penalty-10000

\bye
%----------------------------------------------

The font `cmr17-Extend_100' will not be visible.

I only managed to achieve this effect with extremely
large font sizes, which may or may not be related (it
could also be that I didn't find the `magic' \hsize).

If you force the characters to shrink even more, for
example by setting \hsize to 120pt in the latter test
file, the unexpanded font will be used, thus printing
the characters over each other.


Regards,
Robert  <w.m.l@gmx.net>

PS. I didn't bother to create expanded fonts, so I
cannot tell whether it depends on the autoexpand feature.


----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-01-31 13:08

Message:
Logged In: YES 
user_id=421

The state of the patch is indeed fuzzy; at least I did not
apply it, but some parts are in.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2005-01-31 02:59

Message:
Logged In: NO 

It seems as if Hartmut's patch hasn't been applied, as the
following test file will still produce incorrect output for
both pdftex 1.20b and 1.20c-beta:

%-------------------------------------------------
\pdfadjustspacing=2
\font\testfont=cmr10 \testfont
\pdffontexpand\font 0 1000 100 autoexpand
\hsize40pt

OK: text text text text\break

not OK: text text text text\break

\bye

%-------------------------------------------------

Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 15:53

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2004-10-01 20:41

Message:
Logged In: YES 
user_id=929

tiny patch tries to solve this bug. See README and PDF test
file included.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-10-01 17:17

Message:
Logged In: YES 
user_id=421

I you mean the effect in the attached pdf: This is either a
bug in Jaws (png attached) or a bug in pdftex. gs 8.30,
harlequin 5.3.4a and AR 5 all display the file distorted. :-(

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-29 00:06

Message:
Logged In: NO 

But the problem I mentioned above in the last paragraph
isn't related to Acrobat Reader, is it?
% ------------------------------------------
\hsize35pt
\pdfadjustspacing=2
\font\testfont=cmr12\testfont
\pdffontexpand\font 0 1000 100 autoexpand

text text text text\penalty-10000

\bye
% ------------------------------------------

Seems like a sanity check is missing somewhere. If my guess
is right, pdftex tries to use the font `cmr17-Extend_0',
which (incorrectly) translates into the base font. What it
should probably do is use the smallest available expanded
font, i.e. in this case Extend_100, and make the line overfull.

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-09-27 17:27

Message:
Logged In: YES 
user_id=421

An Acrobat Reader bug. :-)

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-23 00:02

Message:
Logged In: NO 

Obviously, I filed this report too early. Sorry about that.

It is not a pdftex bug, but appears to be a bug in Acrobat
Reader 6. (Just to tell you what I saw:) At zoom level 200%
or larger, the font most shrunk (Extend_100) is not visible
on screen. That is, in the first example, I only see "See y
e", in the second, nothing at all. However, if I zoom out,
the characters re-appear. 

Sorry for not zooming out earlier. 

Regards,
Robert.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106
From noreply at sarovar.org  Mon Jan 31 23:34:52 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Jan 31 23:38:10 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-274 ] \unhbox kills protrusion
Message-ID: <E1Cvk8C-0005bz-00@sarovar.org>

Bugs item #274, was opened at 2005-01-31 03:09
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106

Category: hz
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: The Thanh Han (hanthethanh)
Summary: \unhbox kills protrusion

Initial Comment:
Protrusion will break when boxes containing protruded
characters are \unhbox'ed. I've stumbled upon this when
using edmac/ledmac, which decomposes each paragraph
into lines, then reassembling them.

I wasn't sure whether protrusion is supposed to survive
this treatment but it does if one uses \unhcopy instead
of \unhbox.

Here's a greatly reduced example:
%--------------------------------------------
\font\testfont=cmr10 \testfont
\pdfprotrudechars=2
\rpcode\font`\-=1000
\parindent0pt
\hsize=126pt

\newbox\testline
\newbox\testbox
%
\setbox\testbox\vbox{%
   Margin kerning is the adjustments
   of the characters at the
   margins of a typeset text.
}
\loop\ifvbox\testbox
   \setbox\testline=\vsplit\testbox to\baselineskip
   \unvbox\testline
   \setbox\testline=\lastbox
   \hbox to\hsize{\unhcopy\testline}% OK
   \hbox to\hsize{\unhbox\testline} % not OK
\repeat

\bye
% --------------------------------------------------


Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-31 23:34

Message:
Logged In: YES 
user_id=929

There seems to be one place in hz.ch where \unhbox and
\unhcopy are treated differently:

%@x [1100] - margin kerning
%while link(tail)<>null do tail:=link(tail);
%@y
%if c = copy_code then begin
%    while link(tail)<>null do tail:=link(tail);
%end
%else while link(tail) <> null do begin
%    r := link(tail);
%    if not is_char_node(r) and (type(r) = margin_kern_node)
then begin
%        link(tail) := link(r);
%        free_avail(margin_char(r));
%        free_node(r, margin_kern_node_size);
%    end;
%    tail:=link(tail);
%end;
%@z

After just commenting this piece out (as shown), both
\unhcopy and \unhbox do protrusion ok. Now i don't have the
slightest idea what this code is for, neither which side
effects would appear if it's removed...

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106
