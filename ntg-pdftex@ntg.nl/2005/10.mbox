From Aleks_Kleyn at MailAPS.org  Sat Oct  1 17:45:33 2005
From: Aleks_Kleyn at MailAPS.org (Aleks Kleyn)
Date: Sun Oct  2 22:01:04 2005
Subject: [NTG-pdftex] RE: [pdftex] Re: GrailTeX -- Yet Another TeX
	Distribution
In-Reply-To: <433CFF6D.5000000@freemail.hu>
Message-ID: <000001c5c69f$296ce7f0$5d02a8c0@aleks>

I looked at this link and found exe files which work in windows. But soon I
have question. I saw there pdfTeX, but there is no pdflatex. Do different
people write these modules and why when pdflatex starts it refers to pdfetex
which is not called by it. Also I saw pdfplatex which refers to pdfTeX. What
is difference between pdfTeX and pdfetex. It looks like their output is
similar.

Aleks Kleyn
http://www.geocities.com/aleks_kleyn


-----Original Message-----
From: pdftex-bounces@tug.org [mailto:pdftex-bounces@tug.org] On Behalf Of
Nagy Bence
Sent: Friday, September 30, 2005 5:04 AM
To: pdftex@tug.org; ntg-pdftex@ntg.nl
Subject: [pdftex] Re: GrailTeX -- Yet Another TeX Distribution

Dear TeX-friends,

I made a compact LaTeX-based TeX-distribution which can be very usable
e.g. for building TeX-based web solutions. GrailTeX is downloadable from

http://www.tipogral.hu/index.rhtml/grailtex

Most interesting features: package-based architecture with dependency
support, the latest pdfeTeX binary (named grailtex) with unstable
patches, Latin Modern Type1 fonts instead of bitmapped Metafont Computer
Modern (EC) files...

There is currently just a minimal documentation on its website.

Any comments are welcomed!

Greetings, Bence

-- 
Nagy Bence
-> Magyar Grafika | www.mgonline.hu
-> Tipogr?l.hu | www.tipogral.hu

_______________________________________________
pdftex mailing list
pdftex@tug.org
http://tug.org/mailman/listinfo/pdftex

From noreply at sarovar.org  Mon Oct  3 01:16:18 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct  3 01:24:02 2005
Subject: [NTG-pdftex] [ pdftex-Patches-427 ] Character positioning patch
Message-ID: <E1EMD46-0004le-00@sarovar.org>

Patches item #427, was opened at 2005-09-11 12:39
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Character positioning patch

Initial Comment:
Experimental patch increases resolution of /Widths
array by 1 fractional digit, makes corrections of type
")-1(" and ")1(" in the TJ array happen much less
often, particularily for CM fonts. Gives e. g. 1 % PDF
file size shrink for pdfetex web sources compiled into PDF.

Rough patch only, not for production. Testing welcome.

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-03 01:16

Message:
Logged In: YES 
user_id=929

patch updated: now the TJ array building in procedure
pdf_begin_string is simplified/tidied up.

Testing welcome!

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106
From noreply at sarovar.org  Thu Oct  6 21:01:29 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Oct  6 21:09:12 2005
Subject: [NTG-pdftex] [ pdftex-Patches-432 ] Rules in a PDF qQ group
Message-ID: <E1ENazh-0002mj-00@sarovar.org>

Patches item #432, was opened at 2005-10-06 21:01
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=432&group_id=106

Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Rules in a PDF qQ group

Initial Comment:
Put rules with their positioning on the page inside a
qQ group. Should make \pdfliteral page {...} behave
consistently after text or rules or images, as then any
positioning starts from the PDF origin; no
delta-positioning anymore. It's already being tested in
pdfluatex. Just to have it at sarovar...

Testing welcome, particularily with text and graphics
transforms by graphicx package, to spot backward
incompatibilities, if any...

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=432&group_id=106
From noreply at sarovar.org  Sun Oct  9 00:25:12 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct  9 00:33:04 2005
Subject: [NTG-pdftex] [ pdftex-Patches-427 ] Character positioning patch
Message-ID: <E1EON7w-000793-00@sarovar.org>

Patches item #427, was opened at 2005-09-11 12:39
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Character positioning patch

Initial Comment:
Experimental patch increases resolution of /Widths
array by 1 fractional digit, makes corrections of type
")-1(" and ")1(" in the TJ array happen much less
often, particularily for CM fonts. Gives e. g. 1 % PDF
file size shrink for pdfetex web sources compiled into PDF.

Rough patch only, not for production. Testing welcome.

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-09 00:25

Message:
Logged In: YES 
user_id=929

Removed pdf_first_space_corr variable, as it seems that it
was defunct anyway: There was no pdf_end_string procedure
call (only place where something is done with
pdf_first_space_corr), where afterwards the pdf_h variable
(then modified by pdf_first_space_corr) would actually be
used. E. g. pdf_moveto uses pdf_last_h instead, and after
pdf_end_text there is anyway a pdf_set_origin call.

And pdf_begin_string gets simpler.

Testing welcome!

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-03 01:16

Message:
Logged In: YES 
user_id=929

patch updated: now the TJ array building in procedure
pdf_begin_string is simplified/tidied up.

Testing welcome!

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106
From reinhard.kotucha at web.de  Sun Oct  9 02:55:41 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun Oct  9 02:55:45 2005
Subject: [NTG-pdftex] pdftex documentation
Message-ID: <17224.27277.98594.745345@zarniwoop.ms25.local>

Hi,
is there newer documentation for pdftex available than that in the
TeXLive repository?

The manual in the TL repository seems to be out-of-date and I'm sure
that Pawel already has something better.

For this documentation (or documentation in general), a smaller value
of \pdfminorversion would make more sense.  Not everyone has the
latest version of Acroread and some people avoid AR7 because it is so
slow.  

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From noreply at sarovar.org  Sun Oct  9 15:06:13 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct  9 15:14:02 2005
Subject: [NTG-pdftex] [ pdftex-Patches-427 ] Character positioning patch
Message-ID: <E1EOasX-00065F-00@sarovar.org>

Patches item #427, was opened at 2005-09-11 12:39
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106

>Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Character positioning patch

Initial Comment:
Experimental patch increases resolution of /Widths
array by 1 fractional digit, makes corrections of type
")-1(" and ")1(" in the TJ array happen much less
often, particularily for CM fonts. Gives e. g. 1 % PDF
file size shrink for pdfetex web sources compiled into PDF.

Rough patch only, not for production. Testing welcome.

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-09 15:06

Message:
Logged In: YES 
user_id=929

Patch extended: Now pdf_set_origin has (h, v) parameters,
simplifies pdf_begin_text procedure.

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-09 00:25

Message:
Logged In: YES 
user_id=929

Removed pdf_first_space_corr variable, as it seems that it
was defunct anyway: There was no pdf_end_string procedure
call (only place where something is done with
pdf_first_space_corr), where afterwards the pdf_h variable
(then modified by pdf_first_space_corr) would actually be
used. E. g. pdf_moveto uses pdf_last_h instead, and after
pdf_end_text there is anyway a pdf_set_origin call.

And pdf_begin_string gets simpler.

Testing welcome!

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-03 01:16

Message:
Logged In: YES 
user_id=929

patch updated: now the TJ array building in procedure
pdf_begin_string is simplified/tidied up.

Testing welcome!

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=427&group_id=106
From noreply at sarovar.org  Sun Oct  9 15:07:42 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct  9 15:15:28 2005
Subject: [NTG-pdftex] [ pdftex-Patches-432 ] Rules in a PDF qQ group
Message-ID: <E1EOaty-00067b-00@sarovar.org>

Patches item #432, was opened at 2005-10-06 21:01
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=432&group_id=106

Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Rules in a PDF qQ group

Initial Comment:
Put rules with their positioning on the page inside a
qQ group. Should make \pdfliteral page {...} behave
consistently after text or rules or images, as then any
positioning starts from the PDF origin; no
delta-positioning anymore. It's already being tested in
pdfluatex. Just to have it at sarovar...

Testing welcome, particularily with text and graphics
transforms by graphicx package, to spot backward
incompatibilities, if any...

Regards, Hartmut

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-09 15:07

Message:
Logged In: YES 
user_id=929

Update pdf_set_origin_temp: Now has (h, v) parameters.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=432&group_id=106
From martin at oneiros.de  Sun Oct  9 14:05:55 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Sun Oct  9 15:32:14 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <17224.27277.98594.745345@zarniwoop.ms25.local>
References: <17224.27277.98594.745345@zarniwoop.ms25.local>
Message-ID: <20051009120555.GA536@lucien.oneiros.kn-bremen.de>

On 2005-10-09 02:55:41 +0200, Reinhard Kotucha wrote:
> is there newer documentation for pdftex available than that in the
> TeXLive repository?

Yes, included in the pdftex distribution on CTAN or sarovar. That
covers up to 1.30.x

> For this documentation (or documentation in general), a smaller value
> of \pdfminorversion would make more sense.  Not everyone has the
> latest version of Acroread and some people avoid AR7 because it is so
> slow.  

Already fixed. :-)

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From karl at freefriends.org  Sun Oct  9 20:37:19 2005
From: karl at freefriends.org (Karl Berry)
Date: Sun Oct  9 20:37:32 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <20051009120555.GA536@lucien.oneiros.kn-bremen.de>
Message-ID: <200510091837.j99IbJT29888@f7.net>

    Yes, included in the pdftex distribution on CTAN or sarovar. That
    covers up to 1.30.x

Ok, I see links on http://www.tug.org/applications/pdftex/ to the -[las]
pdf files, so I grabbed those, and also pdftex-syntax.txt.

I don't see any updates for these files:
pdftex-i.tex
pdftex-t.txt
pdftex-w.pdf
pdftex-w.tex

Also, I see sources in the zip file, but no output in the zip file, or
elsewhere on CTAN.  Am I missing it?  It would be convenient to have it
there.  wget from sarovar doesn't preserve timestamps (besides being slow).

Thanks,
Karl
From vvv at vsu.ru  Sun Oct  9 20:55:26 2005
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun Oct  9 21:00:14 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <200510091837.j99IbJT29888@f7.net> (Karl Berry's message of "Sun, 
	9 Oct 2005 13:37:19 -0500")
References: <200510091837.j99IbJT29888@f7.net>
Message-ID: <87mzlimsf5.fsf@vvv.vsu.ru>

"KB" == Karl Berry writes:

 >>     Yes, included in the pdftex distribution on CTAN or
 >> sarovar. That covers up to 1.30.x

 KB> Ok, I see links on http://www.tug.org/applications/pdftex/ to the
 KB> -[las] pdf files, so I grabbed those, and also pdftex-syntax.txt.

and the comment in pdftex-s.pdf says:

  This manual revision (1.596) tries to keep track with the recent
  pdfTEX development up to version 1.21b.

so if it's indeed covering up to 1.30.x, please update it to say so.

Best,
v.

From karl at freefriends.org  Sun Oct  9 23:46:58 2005
From: karl at freefriends.org (Karl Berry)
Date: Sun Oct  9 23:47:09 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <Pine.LNX.4.44.0510092212410.13327-100000@re86.internetdsl.tpnet.pl>
Message-ID: <200510092146.j99Lkwu03794@f7.net>

    we have on p4 some (perhaps) obsolete 
    files: pdftex-t.txt, 

As I wrote.  Also 
 pdftex-i.tex
 pdftex-w.pdf
 pdftex-w.tex

    moreover texmf/doc/pdftex/examples/ can be also
    removed, as pdftex has something better (I believe) in manual/samplepdf/

Indeed, I wasn't sure if samplepdf/ was really supposed to replace examples/.

Overall, texmf/doc/pdftex in TL is a frustrating mix of files from a
variety of places.  Advice (or, ideally, a canonical location we can
just copy from) would be appreciated.
http://tug.org/texlive/devsrc/Master/texmf/doc/pdftex/

Thanks,
Karl
From hartmut_henkel at gmx.de  Mon Oct 10 00:11:21 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Oct 10 00:11:26 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <200510092146.j99Lkwu03794@f7.net>
References: <200510092146.j99Lkwu03794@f7.net>
Message-ID: <Pine.LNX.4.61.0510092357210.7293@hahepc1.hahe>

On Sun, 9 Oct 2005, Karl Berry wrote:

> Overall, texmf/doc/pdftex in TL is a frustrating mix of files from a
> variety of places.

the misc/pdfTeX-FAQ from 2000 refers to version 0.14f, still mentions
the old config file, and TIFF, is misleading. Should be removed IMHO. Is
it worthwile to update it? Is a separate FAQ for pdfTeX really needed,
if we have the manual?

If it's ok for Martin, also the pdftex-pdfkeys/pdftex-pdfkeys and
therefore the whole dir. could be removed in principle, as this info is
now included in the manual.

And why can't my xpdf display Thanh's thesis-png.pdf (only white
sheets), but Adobe Reader can?

Regards, Hartmut
From karl at freefriends.org  Mon Oct 10 00:38:18 2005
From: karl at freefriends.org (Karl Berry)
Date: Mon Oct 10 00:38:23 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <Pine.LNX.4.61.0510092357210.7293@hahepc1.hahe>
Message-ID: <200510092238.j99McIq12901@f7.net>

    the misc/pdfTeX-FAQ from 2000 refers to version 0.14f, still mentions
    the old config file, and TIFF, is misleading. Should be removed IMHO. 

Ok, I will delete it.

    If it's ok for Martin, also the pdftex-pdfkeys/pdftex-pdfkeys and
    therefore the whole dir. could be removed in principle, as this info
    is now included in the manual.

Fine with me if it's fine with Martin.  Deletions always make me happy :).

    And why can't my xpdf display Thanh's thesis-png.pdf (only white
    sheets), but Adobe Reader can?

You're asking me :)?  All those files predate my involvement in TL by a
good many years, I have no idea where they came from.

I'd love to have a pdftex doc location on CTAN I could just copy
wholesale for TL ...

Thanks,
Karl
From martin at oneiros.de  Mon Oct 10 01:04:16 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Oct 10 01:57:59 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <200510091837.j99IbJT29888@f7.net>
References: <20051009120555.GA536@lucien.oneiros.kn-bremen.de>
	<200510091837.j99IbJT29888@f7.net>
Message-ID: <20051009230415.GA5376@lucien.oneiros.kn-bremen.de>

On 2005-10-09 13:37:19 -0500, Karl Berry wrote:
> Also, I see sources in the zip file, but no output in the zip file, or
> elsewhere on CTAN.  Am I missing it?  It would be convenient to have it

No. A simple "make" should get you the output (if you have a
recent enough ConTeXt & pdfTeX).

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Mon Oct 10 01:04:48 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Oct 10 01:58:00 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <87mzlimsf5.fsf@vvv.vsu.ru>
References: <200510091837.j99IbJT29888@f7.net> <87mzlimsf5.fsf@vvv.vsu.ru>
Message-ID: <20051009230448.GB5376@lucien.oneiros.kn-bremen.de>

On 2005-10-09 22:55:26 +0400, Vladimir Volovich wrote:
> and the comment in pdftex-s.pdf says:
> 
>   This manual revision (1.596) tries to keep track with the recent
>   pdfTEX development up to version 1.21b.
> 
> so if it's indeed covering up to 1.30.x, please update it to say so.

Will do.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From vvv at vsu.ru  Mon Oct 10 09:52:05 2005
From: vvv at vsu.ru (Vladimir Volovich)
Date: Mon Oct 10 09:57:03 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <20051009230448.GB5376@lucien.oneiros.kn-bremen.de> (Martin
	=?iso-8859-15?Q?Schr=F6der's?= message of "Mon, 10 Oct 2005 01:04:48
	+0200")
References: <200510091837.j99IbJT29888@f7.net> <87mzlimsf5.fsf@vvv.vsu.ru>
	<20051009230448.GB5376@lucien.oneiros.kn-bremen.de>
Message-ID: <87wtkllsgq.fsf@vvv.vsu.ru>

"MS" == Martin Schr?der writes:

 >> and the comment in pdftex-s.pdf says:
 >> 
 >> This manual revision (1.596) tries to keep track with the recent
 >> pdfTEX development up to version 1.21b.
 >> 
 >> so if it's indeed covering up to 1.30.x, please update it to say
 >> so.

 MS> Will do.

i looked at random email in ntg-pdftex mentioning recently added
primitives, and i see that e.g. \pdfforcepagebox is present in pdftex
1.30.3, but is not even mentioned in pdftex-s.pdf.

so i guess that pdftex-s.pdf is not "covering up to 1.30.x"

please do make sure that all primitives are described in the manual...

Best,
v.

From martin at oneiros.de  Mon Oct 10 15:17:23 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Oct 10 15:30:19 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <87wtkllsgq.fsf@vvv.vsu.ru>
References: <200510091837.j99IbJT29888@f7.net> <87mzlimsf5.fsf@vvv.vsu.ru>
	<20051009230448.GB5376@lucien.oneiros.kn-bremen.de>
	<87wtkllsgq.fsf@vvv.vsu.ru>
Message-ID: <20051010131722.GA11242@lucien.oneiros.kn-bremen.de>

On 2005-10-10 11:52:05 +0400, Vladimir Volovich wrote:
> "MS" == Martin Schr?der writes:
>  MS> Will do.
> 
> i looked at random email in ntg-pdftex mentioning recently added
> primitives, and i see that e.g. \pdfforcepagebox is present in pdftex
> 1.30.3, but is not even mentioned in pdftex-s.pdf.
> 
> so i guess that pdftex-s.pdf is not "covering up to 1.30.x"
> 
> please do make sure that all primitives are described in the manual...

They are; the pdftex-s.pdf you get is just too old. If you
generate it from the current sources (distributed e.g. on CTAN),
you will find its description on page 47.

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From karl at freefriends.org  Mon Oct 10 19:18:42 2005
From: karl at freefriends.org (Karl Berry)
Date: Mon Oct 10 19:18:51 2005
Subject: [NTG-pdftex] Re: [tex-live] pdftex documentation
In-Reply-To: <20051010131722.GA11242@lucien.oneiros.kn-bremen.de>
Message-ID: <200510101718.j9AHIgK10371@f7.net>

    They are; the pdftex-s.pdf you get is just too old. 

Ah, the essence of the problem.  I got that pdftex-s.pdf (and the
others) from the links on pdftex.org, blithely and incorrectly assuming
they were up to date.  So maybe you should update those links?

(Once again, having a canonical source for the doc, formatted versions
included, would make things so much simpler, for both users and
distributors.)

Anyway, I will rebuild the pdf's from the sources.  When I did that last
year, though, Hans decided we should rebuild it all in Optima at the
last minute ... Hans, do you plan to do that again this year :)?

Thanks,
k
From martin at oneiros.de  Tue Oct 11 01:43:25 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Oct 11 07:50:11 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
	plain TeX fails
In-Reply-To: <200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <20051010234325.GA16120@lucien.oneiros.kn-bremen.de>

On 2005-10-11 07:01:53 +0900, Akira Kakuto wrote:
> > Indeed, I confirm that 
> >   pdfetex 'v er.tex'
> > works in TL 2004 and fails with the current TL pdfetex (both
> > i386-linux).  The error message is: 
> > 
> > ! I can't find file `"v er.tex"'.
> 
> On Windows, pdfetex "v er.tex" is OK.
> Please check
> char *makecfilename(strnumber s) in utils.c,
> where I find #ifdef WIN32.

Is this by chance bug #377 again? :-(

Best
    Martin

PS: Followup -> ntg-pdftex
-- 
                    http://www.tm.oneiros.de
From martin at oneiros.de  Tue Oct 11 02:01:47 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Oct 11 07:50:13 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
	plain TeX fails
In-Reply-To: <20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
	<20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
Message-ID: <20051011000147.GB16120@lucien.oneiros.kn-bremen.de>

On 2005-10-11 01:43:25 +0200, Martin Schr?der wrote:
> Is this by chance bug #377 again? :-(

Seems so. At least it worked in 1.30.0-rc1, but is broken since
rc2. :-(

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From olaf at infovore.xs4all.nl  Tue Oct 11 18:39:24 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Tue Oct 11 18:39:29 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
 plain TeX fails
In-Reply-To: <20051010234325.GA16120@lucien.oneiros.kn-bremen.de> (
	=?iso-8859-1?q?Martin_Schr=F6der's_message_of?= "Tue,
	11 Oct 2005 01:43:25 +0200")
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
	<20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
Message-ID: <87ll109fer.fsf@infovore.xs4all.nl>

Martin Schr?der writes:
> On 2005-10-11 07:01:53 +0900, Akira Kakuto wrote:

>>> Indeed, I confirm that 
>>>   pdfetex 'v er.tex'
>>> works in TL 2004 and fails with the current TL pdfetex (both
>>> i386-linux).  The error message is: 
>>> 
>>> ! I can't find file `"v er.tex"'.

>> On Windows, pdfetex "v er.tex" is OK.
>> Please check
>> char *makecfilename(strnumber s) in utils.c,
>> where I find #ifdef WIN32.

> Is this by chance bug #377 again? :-(

> Best
>     Martin

> PS: Followup -> ntg-pdftex

	In pdftex.ch:

@x 11447
@d append_to_name(#)==begin c:=#; if not (c="""") then begin incr(k);
  if k<=file_name_size then name_of_file[k]:=xchr[c];
  end end
@y
@d append_to_name(#)==begin c:=#; if not (c="""") or not is_quote_bad
  then begin incr(k);
  if k<=file_name_size then name_of_file[k]:=xchr[c];
  end end
@z

	In utils.c:

boolean isquotebad() {
#ifdef WIN32
    return true;
#else
    return false;
#endif
}


On non-WIN32 this means that append_to_name effectively becomes

   begin
      c:=#;
      if true then begin
         incr(k);
         if k<=file_name_size then name_of_file[k]:=xchr[c];
      end
   end

So the quotes aren't stripped from quoted filenames, and the file
becomes unfindable as a result.


Try the following diff:

Index: pdftexdir/pdfstrcmp.ch
===================================================================
RCS file: /usr/local/cvsroot/texk/texk/web2c/pdftexdir/pdfstrcmp.ch,v
retrieving revision 1.1
diff -u -r1.1 pdfstrcmp.ch
--- pdftexdir/pdfstrcmp.ch	27 Jul 2005 08:17:45 -0000	1.1
+++ pdftexdir/pdfstrcmp.ch	11 Oct 2005 16:34:49 -0000
@@ -442,17 +442,6 @@
 job_name_code: print(job_name);
 @z
 
-@x 11447
-@d append_to_name(#)==begin c:=#; if not (c="""") then begin incr(k);
-  if k<=file_name_size then name_of_file[k]:=xchr[c];
-  end end
-@y
-@d append_to_name(#)==begin c:=#; if not (c="""") or not is_quote_bad
-  then begin incr(k);
-  if k<=file_name_size then name_of_file[k]:=xchr[c];
-  end end
-@z
-
 %***********************************************************************
 
 @x 32168
Index: pdftexdir/pdftex.ch
===================================================================
RCS file: /usr/local/cvsroot/texk/texk/web2c/pdftexdir/pdftex.ch,v
retrieving revision 1.17
diff -u -r1.17 pdftex.ch
--- pdftexdir/pdftex.ch	10 Sep 2005 08:43:42 -0000	1.17
+++ pdftexdir/pdftex.ch	11 Oct 2005 16:37:00 -0000
@@ -3988,7 +3988,7 @@
     @<Output the |obj_tab|@>;
     @<Output the trailer@>;
     pdf_flush;
-    print_nl("Output written on "); slow_print(output_file_name);
+    print_nl("Output written on "); print_file_name(0, output_file_name, 0);
   @.Output written on x@>
     print(" ("); print_int(total_pages); print(" page");
     if total_pages<>1 then print_char("s");
Index: pdftexdir/utils.c
===================================================================
RCS file: /usr/local/cvsroot/texk/texk/web2c/pdftexdir/utils.c,v
retrieving revision 1.5
diff -u -r1.5 utils.c
--- pdftexdir/utils.c	3 Aug 2005 08:43:39 -0000	1.5
+++ pdftexdir/utils.c	11 Oct 2005 16:33:51 -0000
@@ -1111,32 +1111,19 @@
 /* makecfilename
   input/ouput same as makecstring:
     input: string number
-    output: C string (buffer address that contains the string)
-  WIN32: quotes are removed.
+    output: C string with quotes removed.
 */
 char *makecfilename(strnumber s) {
     char *name = makecstring(s);
-#ifdef WIN32
-    /* unquote file name */
-    if (*name == '"') {
-        char *p = name;
-        char *q = name;
-        while (p && *p) {
-            *q = (*p == '"' ? *(++p) : *p);
-            p++, q++;
-        }
-        *q = '\0';
+    char *p = name;
+    char *q = name;
+
+    while (*p) {
+        if (*p != '"')
+            *q++ = *p;
+        p++;
     }
+    *q = '\0';
     fprintf(stderr, " %s\n", name);
-#endif
     return name;
 }
-
-
-boolean isquotebad() {
-#ifdef WIN32
-    return true;
-#else
-    return false;
-#endif
-}



-- 
Olaf Weber

               (This space left blank for technical reasons.)

From olaf at infovore.xs4all.nl  Tue Oct 11 18:50:43 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Tue Oct 11 18:50:50 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
 plain TeX fails
In-Reply-To: <87ll109fer.fsf@infovore.xs4all.nl> (Olaf Weber's message of
	"Tue, 11 Oct 2005 18:39:24 +0200")
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
	<20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
	<87ll109fer.fsf@infovore.xs4all.nl>
Message-ID: <87hdbo9evw.fsf@infovore.xs4all.nl>

Olaf Weber writes:
> Martin Schr?der writes:

>> Is this by chance bug #377 again? :-(

> Try the following diff:

[...]

Specifically addressing #377, this should work:


Index: pdftexdir/writeimg.c
===================================================================
RCS file: /usr/local/cvsroot/texk/texk/web2c/pdftexdir/writeimg.c,v
retrieving revision 1.3
diff -u -r1.3 writeimg.c
--- pdftexdir/writeimg.c	27 Jul 2005 08:17:46 -0000	1.3
+++ pdftexdir/writeimg.c	11 Oct 2005 16:48:47 -0000
@@ -1,5 +1,5 @@
 /*
-Copyright (c) 1996-2002 Han The Thanh, <thanh@pdftex.org>
+Copyright (c) 1996-2002, 2005 Han The Thanh, <thanh@pdftex.org>
 
 This file is part of pdfTeX.
 
@@ -259,20 +259,7 @@
        already used by cur_file_name */
     if (page_name != 0)
       dest = xstrdup(makecstring(page_name));
-    cur_file_name = makecstring(s);
-#ifdef WIN32
-    /* unquote file name */
-    if (*cur_file_name == '"') {
-      char *p = cur_file_name;
-      char *q = cur_file_name;
-      while (p && *p) {
-    *q = (*p == '"' ? *(++p) : *p);
-    p++, q++;
-      }
-      *q = '\0';
-    }
-    fprintf(stderr, " %s\n", cur_file_name);
-#endif
+    cur_file_name = makecfilename(s);
     img_name(img) = kpse_find_file(cur_file_name, kpse_tex_format, true);
     if (img_name(img) == NULL)
         pdftex_fail("cannot find image file");



-- 
Olaf Weber

               (This space left blank for technical reasons.)

From martin at oneiros.de  Tue Oct 11 23:44:56 2005
From: martin at oneiros.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Tue Oct 11 23:53:19 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
	plain TeX fails
In-Reply-To: <87hdbo9evw.fsf@infovore.xs4all.nl>
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
	<20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
	<87ll109fer.fsf@infovore.xs4all.nl>
	<87hdbo9evw.fsf@infovore.xs4all.nl>
Message-ID: <20051011214456.GD25061@lucien.oneiros.kn-bremen.de>

On 2005-10-11 18:50:43 +0200, Olaf Weber wrote:
> Specifically addressing #377, this should work:

Thanks!

I'll most likely do a new release (1.30.4) with this patch, but I
won't have time for this till Saturday.

If there are any other _bugs_ that need fixing, now is the time. :-)

Best
    Martin
-- 
                    http://www.tm.oneiros.de
From Rolf.Niepraschk at ptb.de  Wed Oct 12 08:34:59 2005
From: Rolf.Niepraschk at ptb.de (Rolf.Niepraschk@ptb.de)
Date: Wed Oct 12 08:35:04 2005
Subject: [NTG-pdftex] Tip: Heirloom Documentation Tools 
In-Reply-To: <20051011214456.GD25061@lucien.oneiros.kn-bremen.de>
Message-ID: <OF2D6BFF97.3AA1C295-ONC1257098.0023738A-42257098.00242990@ptb.de>


The following may be of interest:

----------------------

==> http://heirloom.sourceforge.net/doctools.html

About: The Heirloom Documentation Tools package provides troff, nroff, and
related utilities to format manual pages and other documents for output on
terminals and printers.
...

Changes: Support for OpenType fonts has been added. This includes support
for CFF-based (PostScript) OpenType fonts as well as support for most
TrueType fonts. The new "otfdump" utility prints the contents of OpenType
font files just as troff interprets it. OpenType features, such as small
capitals or old-style numerals, can be accessed using the new ".feature"
request.
...

----------------------

...Rolf


From noreply at sarovar.org  Thu Oct 13 01:08:33 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Oct 13 01:16:23 2005
Subject: [NTG-pdftex] [ pdftex-Patches-434 ] Remove queued map item handling
Message-ID: <E1EPpi5-0006bC-00@sarovar.org>

Patches item #434, was opened at 2005-10-13 01:08
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=434&group_id=106

Category: Fonts
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Remove queued map item handling

Initial Comment:
Remove queued map item handling from mapfile.c
==============================================

Formerly all items from \pdfmapfile{+-=mapfile} or
\pdfmapline{+-=mapline} were queued up in a list until
the next font was selected; then the whole list was
processed, e. g. all queued mapfiles or maplines read in.

When one gave \pdfmapfile{mapfile} or
\pdfmapline{mapline} without +-=, the pending list was
cleared. The only practical use for this was to prevent
reading in the default mapfile. But this can be done
simpler, without queuing.

With this patch all \pdfmapfile{+-=mapfile} or
\pdfmapline{+-=mapline} requests are processed
completely and immediately without queuing, which means
that if e. g. a \pdfmapfile{+-=mapfile} primitive is
scanned, the mapfile will be read in right away. This
happens independently from selecting a font.

When \pdfmapfile{+-=mapfile} or \pdfmapline{+-=mapline}
is scanned, and there is a default mapfile, it is read
first and then the mapfile. Reading of the default
mapfile can be disabled by \pdfmapfile{} or
\pdfmapline{} or \pdfmapfile{mapfile} or
\pdfmapline{mapline} without +-= as long as the default
mapfile hasn't already been read in.

Latest when the first font is requested, the default
mapfile will be read, if this hasn't already been
disabled by the mentioned primitives. Apart from
possibly reading the default mapfile, there is no other
action when a font is requested, since the
\pdfmapfile{+-=mapfile} or \pdfmapline{+-=mapline}
primitives have already acted right away when they were
called.

The effects of this patch are the following:

* Initial mapfile reading still can be blocked in the
usual way.

* The difficult to describe queuing mechanism has gone,
code gets simpler.

* Mapfile reading happens directly by the primitives.

* Therefore it's possible to use \pdfretval with the
primitives, to check success of the mapfile/line
reading (not yet implemented).

* As the return value is connected to the \pdfmapfile
or \pdfmapline call, one can easier implement other map
setting primitives and give them return values. This
was not possible before, as the queuing was inbetween.

* For any standard use, the patch should be compatible
to the former queuing method.

The mapfile.c is a patched version of the mapfile.c
from Thanh's subfont patch pdftex-20050924.patch.gz for
pdftex-1.30.3.

Hope it doesn't sound too messy :-) For discussion.

Regards, Hartmut



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=434&group_id=106
From noreply at sarovar.org  Sat Oct 15 01:21:26 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Oct 15 01:29:27 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-435 ] Wrong file name in error messages
	of image inclusion (readimage)
Message-ID: <E1EQYre-0007S4-00@sarovar.org>

Bugs item #435, was opened at 2005-10-15 01:21
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106

Category: Image inclusion
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Martin Schr?der (oneiros)
Summary: Wrong file name in error messages of image inclusion (readimage)

Initial Comment:
Hello,

see the thread "Wrong search path for PDF/PNG/JPG
files" (2005/10/14) in the pdftex mailing list.
Wlodek Bzyl detected a bug regarding image
inclusion:

pdfTeX sometimes prints a wrong file name in image
error messages:
The current directory contains:
pic.jpg (JPG image), pic.jpg.tex (e.g. consisting of
"\relax") and
test.tex:
  \pdfximage{pic.jpg}
  \pdfrefximage\pdflastximage
  \bye

Then kpse_find_file will find "pic.jpg.tex" (the
automatically adding of ".tex" is sometimes very
annoying) and prints the error message:
  Error: pdftex (file ./pic.jpg): reading image file
  failed
Or if the file pic.jpg.tex is longer:
  Error: pdftex (file ./pic.jpg): unknown type of image

In both cases the file name in the error message is
wrong. The error message is thrown by pdftex_fail that
looks for cur_file_name and prints it (utils.c).
However the real image file name can be changed
by kpse_find_file (e.g. adding ".tex"):

    img_name(img) = kpse_find_file(cur_file_name,
                           kpse_tex_format, true);
    if (img_name(img) == NULL)
        pdftex_fail("cannot find image file");

// Here the file name is still correct
// (img_name(img) is NULL)
// But after this, img_name(img) is not NULL and
// contains the used file name, cur_file_name is no
// longer valid.

    checktypebyheader(img);
    checktypebyextension(img);
    ...
    default:
        pdftex_fail("unknown type of image");
    }
    ...
    cur_file_name = NULL;
    ...

// checktypebyheader calls pdftex_fail,
// and pdftex_fail is also used
// later, in each case using the wrong cur_file_name.

Fix is easy:
  cur_file_name = img_name(img);
after the NULL check part before checktypebyheader.
There are no memory problems. Before cur_file_name
points to a static buffer, the return value of
makecstring. Thus free must not be used on
cur_file_name. And the memory part of img_name(img)
is not changed.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106
From vvv at vsu.ru  Sat Oct 15 18:37:02 2005
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sat Oct 15 18:41:37 2005
Subject: [NTG-pdftex] bug in pdfetex (re \immediate)?
Message-ID: <87wtke20up.fsf@vvv.vsu.ru>

Hi!

consider the following Plain TeX file:

\immediate\immediate\openout1=test.out
\immediate\write1 {line 1}
\immediate\write1 {line 2}
\immediate\closeout1

\bye

(it was reduced from a real-life example).

if i process it with vanilla TeX engine (i.e. not with pdfetex, but
with TeX), you get what i expect: two lines are written to the file
test.out, and there are no pages of output (no DVI file generated).

however, if i process this file with pdfetex, i do not get what i
would expect: instead, the lines are written to terminal, test.out is
created and is empty, and there is also a 1-page PDF file generated.

the bug goes away if i remove the second \immediate, but as i said
this is a simplified example converted from a real-life usage.

Best,
v.

From noreply at sarovar.org  Sat Oct 15 23:57:49 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct 16 00:05:40 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-437 ] two \immediate cancel itself
Message-ID: <E1EQu2H-0008IY-00@sarovar.org>

Bugs item #437, was opened at 2005-10-15 23:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: two \immediate cancel itself

Initial Comment:
Hello,

Vladimir Volovich found the following bug, I quote
his bug report from the ntg-pdftex list here:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not
> with pdfetex, but with TeX), you get what i expect:
> two lines are written to the file test.out, and
> there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do
> not get what i would expect: instead, the lines are
> written to terminal, test.out is created and is
> empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate,
> but as i said this is a simplified example converted
> from a real-life usage.

It is indeed a bug:

this is the original code of "Implement \immediate":

| begin get_x_token;
| if (cur_cmd=extension)and(cur_chr<=close_node) then
|   begin p:=tail; do_extension;{append a whatsit node}
|   out_what(tail); {do the action immediately}
|   flush_node_list(tail); tail:=p; link(p):=null;
|   end
| else back_input;
| end

A token is read. If the token hears to \immediate,
it is executed with the immediate setting.
Otherwise the token is just put back.
  Now pdfTeX has more commands that obey \immediate:

| begin get_x_token;
| if cur_cmd=extension then begin
|    if cur_chr<=close_node then
|       begin <<original action>> end
|     else case cur_chr of
|         pdf_obj_code: begin <<...>> end;
|         pdf_xform_code: begin <<...>> end;
|         pdf_ximage_code: begin <<...>> end;
|         end;
|     endcases;
| end 
| else
|     back_input;
| end

Cases:
a) cur_cmd != extension
   --> nothing is changed (back_input)
b) cur_cmd == extension && cur_chr <= close_node
   --> nothing is changed (original action)
c) cur_cmd == extension
   && cur_chr in (pdf_{obj,xform,ximage}_code)
   --> new behaviour for pdfTeX
d) cur_cmd == extension && cur_chr > close_node
   && cur_chr not in (pdf_{obj,xform,ximage}_code)
   --> no action

Case d) is the bug. \immediate is an extension primitive
with cur_chr > close_node. Thus the second \immediate
is read, but then dropped. The effect is:
  \immediate\immediate\openout is same as \openout
Instead of "no action" there should be "back_input".
Before "endcases" the following line needs to be added:
    ...
    else case cur_chr of
      ...
      othercases back_input
    endcases;

I have attachted a diff file for pdftexdir/pdftex.ch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106
From oberdiek at uni-freiburg.de  Sun Oct 16 00:07:24 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sun Oct 16 00:07:47 2005
Subject: [NTG-pdftex] bug in pdfetex (re \immediate)?
In-Reply-To: <87wtke20up.fsf@vvv.vsu.ru>
References: <87wtke20up.fsf@vvv.vsu.ru>
Message-ID: <20051015220724.GA3649@irwin.vpn.uni-freiburg.de>

Hello,

On Sat, Oct 15, 2005 at 08:37:02PM +0400, Vladimir Volovich wrote:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not with pdfetex, but
> with TeX), you get what i expect: two lines are written to the file
> test.out, and there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do not get what i
> would expect: instead, the lines are written to terminal, test.out is
> created and is empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate, but as i said
> this is a simplified example converted from a real-life usage.

This is indeed a bug, I have put my analysis and bug fix
as bug report 437 on the pdftex web site.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From noreply at sarovar.org  Sun Oct 16 00:24:53 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct 16 00:32:53 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-304 ] Names of expanded fonts not in log
	output
Message-ID: <E1EQuST-00028I-00@sarovar.org>

Bugs item #304, was opened at 2005-03-02 17:25
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106

Category: Fonts
Group: v1.21a
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Names of expanded fonts not in log output

Initial Comment:
When using font expansion, the log output will not
contain the names of the expanded fonts but the null
character instead (resp. ^^@).

%-------------------------------------
\pdfadjustspacing=2
\pdffontexpand\font 20 20 5 autoexpand
\tracingoutput=1
test

\parfillskip 0pt
test
\bye
%-------------------------------------

Regards,
Robert.


----------------------------------------------------------------------

>Comment By: Robert (schlcht)
Date: 2005-10-15 22:24

Message:
Logged In: YES 
user_id=2217

If the font is not autoexpand'ed, its name will still not be
written to the log file.

(pdftex 1.30.3; same test file, without "autoexpand")

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 15:05

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-30 20:16

Message:
Logged In: YES 
user_id=929

This patch is based of Thanh's change file showfont.ch,
which he gave me during EuroTeX2005 (it's also included,
renamed here to showfont-thanh.ch). Use showfont.ch for the
patch.

There is now a new integer variable \pdftracingfonts. It is
zero by default, then we get a log like this (see
robert050302.log):

...\tenrm t

...\tenrm (+20) e

Without font expansion, this default should be compatible
with TeX's original log output.

If \pdftracingfonts is set to 1 (or greater), we get a more
verbose log (see tst-304.log):

...\xivtt (cmtt10@14.0pt) t

.\xivtt (cmtt10+20@14.0pt) e

Seems to work with change file showfont.ch coming directly
after after hz.ch.

Patch only roughly tested with pdfetex, likely to give
problems with pdfxtex, as the variable numbering might
differ. Log format to be agreed upon...

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106
From noreply at sarovar.org  Sun Oct 16 18:16:36 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct 16 18:24:27 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-437 ] Two \immediate cancel themselves
Message-ID: <E1ERBBc-0007ls-00@sarovar.org>

Bugs item #437, was opened at 2005-10-15 23:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
>Summary: Two \immediate cancel themselves

Initial Comment:
Hello,

Vladimir Volovich found the following bug, I quote
his bug report from the ntg-pdftex list here:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not
> with pdfetex, but with TeX), you get what i expect:
> two lines are written to the file test.out, and
> there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do
> not get what i would expect: instead, the lines are
> written to terminal, test.out is created and is
> empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate,
> but as i said this is a simplified example converted
> from a real-life usage.

It is indeed a bug:

this is the original code of "Implement \immediate":

| begin get_x_token;
| if (cur_cmd=extension)and(cur_chr<=close_node) then
|   begin p:=tail; do_extension;{append a whatsit node}
|   out_what(tail); {do the action immediately}
|   flush_node_list(tail); tail:=p; link(p):=null;
|   end
| else back_input;
| end

A token is read. If the token hears to \immediate,
it is executed with the immediate setting.
Otherwise the token is just put back.
  Now pdfTeX has more commands that obey \immediate:

| begin get_x_token;
| if cur_cmd=extension then begin
|    if cur_chr<=close_node then
|       begin <<original action>> end
|     else case cur_chr of
|         pdf_obj_code: begin <<...>> end;
|         pdf_xform_code: begin <<...>> end;
|         pdf_ximage_code: begin <<...>> end;
|         end;
|     endcases;
| end 
| else
|     back_input;
| end

Cases:
a) cur_cmd != extension
   --> nothing is changed (back_input)
b) cur_cmd == extension && cur_chr <= close_node
   --> nothing is changed (original action)
c) cur_cmd == extension
   && cur_chr in (pdf_{obj,xform,ximage}_code)
   --> new behaviour for pdfTeX
d) cur_cmd == extension && cur_chr > close_node
   && cur_chr not in (pdf_{obj,xform,ximage}_code)
   --> no action

Case d) is the bug. \immediate is an extension primitive
with cur_chr > close_node. Thus the second \immediate
is read, but then dropped. The effect is:
  \immediate\immediate\openout is same as \openout
Instead of "no action" there should be "back_input".
Before "endcases" the following line needs to be added:
    ...
    else case cur_chr of
      ...
      othercases back_input
    endcases;

I have attachted a diff file for pdftexdir/pdftex.ch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106
From noreply at sarovar.org  Sun Oct 16 23:52:05 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sun Oct 16 23:59:55 2005
Subject: [NTG-pdftex] [ pdftex-Patches-438 ] \pdfsavepos in DVI mode
Message-ID: <E1ERGQH-0007oM-00@sarovar.org>

Patches item #438, was opened at 2005-10-16 23:52
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106

Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: \pdfsavepos in DVI mode

Initial Comment:
\pdfsavepos in DVI mode

Hello,

using \pdfsavepos in a package of mine (tabularht)
I was wondering, why \pdfsavepos is not allowed to
work in DVI mode. \pdfsavepos in PDF mode is based
on cur_h and cur_v, both coming from the DVI frontend.

The only difference I found is that the PDF format
and pdfTeX's PDF mode know about page dimensions.
Thus the directions of the axes are the same for
the PDF format and the values of \pdfsavepos
(\pdflastxpos, \pdflastypos).
  Origin:          lower left corner
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

The DVI case doesn't know about page dimensions, thus
I suggest using cur_h=0 and cur_v=0 as origin. It is
the left upper corner of the box that is being shipped
out.
  Origin:          left upper corner of the box
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

Thus the absolute values differ in both modes and I
don't see that this can be avoided. However, if the
application uses a reference point then the relative
values are exactly the same.

The attachted patch enables and implements \pdfsavepos
for the DVI mode. It also contains the patch for
bug 437 (Two \immediate cancel themselves).

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106
From noreply at sarovar.org  Mon Oct 17 00:09:18 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 00:17:37 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-437 ] Two \immediate cancel themselves
Message-ID: <E1ERGgw-00016Q-00@sarovar.org>

Bugs item #437, was opened at 2005-10-15 23:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106

Category: None
>Group: v1.30.0
Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: Hartmut Henkel (hhenkel)
Summary: Two \immediate cancel themselves

Initial Comment:
Hello,

Vladimir Volovich found the following bug, I quote
his bug report from the ntg-pdftex list here:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not
> with pdfetex, but with TeX), you get what i expect:
> two lines are written to the file test.out, and
> there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do
> not get what i would expect: instead, the lines are
> written to terminal, test.out is created and is
> empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate,
> but as i said this is a simplified example converted
> from a real-life usage.

It is indeed a bug:

this is the original code of "Implement \immediate":

| begin get_x_token;
| if (cur_cmd=extension)and(cur_chr<=close_node) then
|   begin p:=tail; do_extension;{append a whatsit node}
|   out_what(tail); {do the action immediately}
|   flush_node_list(tail); tail:=p; link(p):=null;
|   end
| else back_input;
| end

A token is read. If the token hears to \immediate,
it is executed with the immediate setting.
Otherwise the token is just put back.
  Now pdfTeX has more commands that obey \immediate:

| begin get_x_token;
| if cur_cmd=extension then begin
|    if cur_chr<=close_node then
|       begin <<original action>> end
|     else case cur_chr of
|         pdf_obj_code: begin <<...>> end;
|         pdf_xform_code: begin <<...>> end;
|         pdf_ximage_code: begin <<...>> end;
|         end;
|     endcases;
| end 
| else
|     back_input;
| end

Cases:
a) cur_cmd != extension
   --> nothing is changed (back_input)
b) cur_cmd == extension && cur_chr <= close_node
   --> nothing is changed (original action)
c) cur_cmd == extension
   && cur_chr in (pdf_{obj,xform,ximage}_code)
   --> new behaviour for pdfTeX
d) cur_cmd == extension && cur_chr > close_node
   && cur_chr not in (pdf_{obj,xform,ximage}_code)
   --> no action

Case d) is the bug. \immediate is an extension primitive
with cur_chr > close_node. Thus the second \immediate
is read, but then dropped. The effect is:
  \immediate\immediate\openout is same as \openout
Instead of "no action" there should be "back_input".
Before "endcases" the following line needs to be added:
    ...
    else case cur_chr of
      ...
      othercases back_input
    endcases;

I have attachted a diff file for pdftexdir/pdftex.ch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106
From noreply at sarovar.org  Mon Oct 17 00:10:33 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 00:18:33 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-435 ] Wrong file name in error messages
	of image inclusion (readimage)
Message-ID: <E1ERGi9-0001C6-00@sarovar.org>

Bugs item #435, was opened at 2005-10-15 01:21
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106

Category: Image inclusion
>Group: v1.30.0
Status: Open
>Resolution: Fixed
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Martin Schr?der (oneiros)
Summary: Wrong file name in error messages of image inclusion (readimage)

Initial Comment:
Hello,

see the thread "Wrong search path for PDF/PNG/JPG
files" (2005/10/14) in the pdftex mailing list.
Wlodek Bzyl detected a bug regarding image
inclusion:

pdfTeX sometimes prints a wrong file name in image
error messages:
The current directory contains:
pic.jpg (JPG image), pic.jpg.tex (e.g. consisting of
"\relax") and
test.tex:
  \pdfximage{pic.jpg}
  \pdfrefximage\pdflastximage
  \bye

Then kpse_find_file will find "pic.jpg.tex" (the
automatically adding of ".tex" is sometimes very
annoying) and prints the error message:
  Error: pdftex (file ./pic.jpg): reading image file
  failed
Or if the file pic.jpg.tex is longer:
  Error: pdftex (file ./pic.jpg): unknown type of image

In both cases the file name in the error message is
wrong. The error message is thrown by pdftex_fail that
looks for cur_file_name and prints it (utils.c).
However the real image file name can be changed
by kpse_find_file (e.g. adding ".tex"):

    img_name(img) = kpse_find_file(cur_file_name,
                           kpse_tex_format, true);
    if (img_name(img) == NULL)
        pdftex_fail("cannot find image file");

// Here the file name is still correct
// (img_name(img) is NULL)
// But after this, img_name(img) is not NULL and
// contains the used file name, cur_file_name is no
// longer valid.

    checktypebyheader(img);
    checktypebyextension(img);
    ...
    default:
        pdftex_fail("unknown type of image");
    }
    ...
    cur_file_name = NULL;
    ...

// checktypebyheader calls pdftex_fail,
// and pdftex_fail is also used
// later, in each case using the wrong cur_file_name.

Fix is easy:
  cur_file_name = img_name(img);
after the NULL check part before checktypebyheader.
There are no memory problems. Before cur_file_name
points to a static buffer, the return value of
makecstring. Thus free must not be used on
cur_file_name. And the memory part of img_name(img)
is not changed.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106
From noreply at sarovar.org  Mon Oct 17 00:11:30 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 00:19:30 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-437 ] Two \immediate cancel themselves
Message-ID: <E1ERGj4-0001Ci-00@sarovar.org>

Bugs item #437, was opened at 2005-10-15 23:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106

Category: None
Group: v1.30.0
Status: Open
>Resolution: Fixed
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Two \immediate cancel themselves

Initial Comment:
Hello,

Vladimir Volovich found the following bug, I quote
his bug report from the ntg-pdftex list here:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not
> with pdfetex, but with TeX), you get what i expect:
> two lines are written to the file test.out, and
> there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do
> not get what i would expect: instead, the lines are
> written to terminal, test.out is created and is
> empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate,
> but as i said this is a simplified example converted
> from a real-life usage.

It is indeed a bug:

this is the original code of "Implement \immediate":

| begin get_x_token;
| if (cur_cmd=extension)and(cur_chr<=close_node) then
|   begin p:=tail; do_extension;{append a whatsit node}
|   out_what(tail); {do the action immediately}
|   flush_node_list(tail); tail:=p; link(p):=null;
|   end
| else back_input;
| end

A token is read. If the token hears to \immediate,
it is executed with the immediate setting.
Otherwise the token is just put back.
  Now pdfTeX has more commands that obey \immediate:

| begin get_x_token;
| if cur_cmd=extension then begin
|    if cur_chr<=close_node then
|       begin <<original action>> end
|     else case cur_chr of
|         pdf_obj_code: begin <<...>> end;
|         pdf_xform_code: begin <<...>> end;
|         pdf_ximage_code: begin <<...>> end;
|         end;
|     endcases;
| end 
| else
|     back_input;
| end

Cases:
a) cur_cmd != extension
   --> nothing is changed (back_input)
b) cur_cmd == extension && cur_chr <= close_node
   --> nothing is changed (original action)
c) cur_cmd == extension
   && cur_chr in (pdf_{obj,xform,ximage}_code)
   --> new behaviour for pdfTeX
d) cur_cmd == extension && cur_chr > close_node
   && cur_chr not in (pdf_{obj,xform,ximage}_code)
   --> no action

Case d) is the bug. \immediate is an extension primitive
with cur_chr > close_node. Thus the second \immediate
is read, but then dropped. The effect is:
  \immediate\immediate\openout is same as \openout
Instead of "no action" there should be "back_input".
Before "endcases" the following line needs to be added:
    ...
    else case cur_chr of
      ...
      othercases back_input
    endcases;

I have attachted a diff file for pdftexdir/pdftex.ch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106
From noreply at sarovar.org  Mon Oct 17 00:12:48 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 00:20:51 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-304 ] Names of expanded fonts not in log
	output
Message-ID: <E1ERGkK-0001DQ-00@sarovar.org>

Bugs item #304, was opened at 2005-03-02 18:25
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106

Category: Fonts
Group: v1.21a
>Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Names of expanded fonts not in log output

Initial Comment:
When using font expansion, the log output will not
contain the names of the expanded fonts but the null
character instead (resp. ^^@).

%-------------------------------------
\pdfadjustspacing=2
\pdffontexpand\font 20 20 5 autoexpand
\tracingoutput=1
test

\parfillskip 0pt
test
\bye
%-------------------------------------

Regards,
Robert.


----------------------------------------------------------------------

Comment By: Robert (schlcht)
Date: 2005-10-16 00:24

Message:
Logged In: YES 
user_id=2217

If the font is not autoexpand'ed, its name will still not be
written to the log file.

(pdftex 1.30.3; same test file, without "autoexpand")

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-05-12 17:05

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.0

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-03-30 22:16

Message:
Logged In: YES 
user_id=929

This patch is based of Thanh's change file showfont.ch,
which he gave me during EuroTeX2005 (it's also included,
renamed here to showfont-thanh.ch). Use showfont.ch for the
patch.

There is now a new integer variable \pdftracingfonts. It is
zero by default, then we get a log like this (see
robert050302.log):

...\tenrm t

...\tenrm (+20) e

Without font expansion, this default should be compatible
with TeX's original log output.

If \pdftracingfonts is set to 1 (or greater), we get a more
verbose log (see tst-304.log):

...\xivtt (cmtt10@14.0pt) t

.\xivtt (cmtt10+20@14.0pt) e

Seems to work with change file showfont.ch coming directly
after after hz.ch.

Patch only roughly tested with pdfetex, likely to give
problems with pdfxtex, as the variable numbering might
differ. Log format to be agreed upon...

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=304&group_id=106
From noreply at sarovar.org  Mon Oct 17 00:16:10 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 00:26:23 2005
Subject: [NTG-pdftex] [ pdftex-Patches-438 ] \pdfsavepos in DVI mode
Message-ID: <E1ERGna-0001Fc-00@sarovar.org>

Patches item #438, was opened at 2005-10-16 23:52
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106

Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: \pdfsavepos in DVI mode

Initial Comment:
\pdfsavepos in DVI mode

Hello,

using \pdfsavepos in a package of mine (tabularht)
I was wondering, why \pdfsavepos is not allowed to
work in DVI mode. \pdfsavepos in PDF mode is based
on cur_h and cur_v, both coming from the DVI frontend.

The only difference I found is that the PDF format
and pdfTeX's PDF mode know about page dimensions.
Thus the directions of the axes are the same for
the PDF format and the values of \pdfsavepos
(\pdflastxpos, \pdflastypos).
  Origin:          lower left corner
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

The DVI case doesn't know about page dimensions, thus
I suggest using cur_h=0 and cur_v=0 as origin. It is
the left upper corner of the box that is being shipped
out.
  Origin:          left upper corner of the box
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

Thus the absolute values differ in both modes and I
don't see that this can be avoided. However, if the
application uses a reference point then the relative
values are exactly the same.

The attachted patch enables and implements \pdfsavepos
for the DVI mode. It also contains the patch for
bug 437 (Two \immediate cancel themselves).

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-17 00:16

Message:
Logged In: YES 
user_id=929

to give page dimension info for pdftex also in DVI mode, one
could implement the standard \special{papersize=x,y} also in
pdftex (parallel to \pdfpagewidth/height), so that it would
be scanned, and also go into the DVI file. Would this help?

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106
From pragma at wxs.nl  Mon Oct 17 09:46:17 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Mon Oct 17 09:45:44 2005
Subject: [NTG-pdftex] [ pdftex-Patches-438 ] \pdfsavepos in DVI mode
In-Reply-To: <E1ERGQH-0007oM-00@sarovar.org>
References: <E1ERGQH-0007oM-00@sarovar.org>
Message-ID: <435356C9.1080101@wxs.nl>

noreply@sarovar.org wrote:

>using \pdfsavepos in a package of mine (tabularht)
>I was wondering, why \pdfsavepos is not allowed to
>  
>
i dunno, probably because positional info (in principle0 is part of dvi 
already ... in dvi mode one can use specials and the dvipos program (in 
the past i used a perl script for this but a few years ago choff added 
the dvipos program to the dvipdfmx suite)

Hans 


-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------

From noreply at sarovar.org  Mon Oct 17 13:39:57 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 13:48:06 2005
Subject: [NTG-pdftex] [ pdftex-Patches-438 ] \pdfsavepos in DVI mode
Message-ID: <E1ERTLR-0003df-00@sarovar.org>

Patches item #438, was opened at 2005-10-16 23:52
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106

Category: Positioning
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: \pdfsavepos in DVI mode

Initial Comment:
\pdfsavepos in DVI mode

Hello,

using \pdfsavepos in a package of mine (tabularht)
I was wondering, why \pdfsavepos is not allowed to
work in DVI mode. \pdfsavepos in PDF mode is based
on cur_h and cur_v, both coming from the DVI frontend.

The only difference I found is that the PDF format
and pdfTeX's PDF mode know about page dimensions.
Thus the directions of the axes are the same for
the PDF format and the values of \pdfsavepos
(\pdflastxpos, \pdflastypos).
  Origin:          lower left corner
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

The DVI case doesn't know about page dimensions, thus
I suggest using cur_h=0 and cur_v=0 as origin. It is
the left upper corner of the box that is being shipped
out.
  Origin:          left upper corner of the box
  horizontal axis: values increasing from left to right
  vertical axis:   values increasing from bottom to top
  unit:            sp

Thus the absolute values differ in both modes and I
don't see that this can be avoided. However, if the
application uses a reference point then the relative
values are exactly the same.

The attachted patch enables and implements \pdfsavepos
for the DVI mode. It also contains the patch for
bug 437 (Two \immediate cancel themselves).

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

>Comment By: Heiko Oberdiek (oberdiek)
Date: 2005-10-17 13:39

Message:
Logged In: YES 
user_id=1276

Hello,

I have now extended the patch: \pdfpagewidth/height
are now used for the page dimensions. Also the
funny DVI origin offset of 1in is taken into
account. Thus the values in DVI and PDF mode are
the same. The exception is \pdf{h,v}origin. If
the value is not 1in, then the values differ in
DVI and PDF mode. However, also the DVI and PDF
output will differ in this case. Thus the different
values are then ok, I think.
  If someone wants to have the same values, he just
sets \pdfpage{width,height} and let \pdf{h,v}origin
untouched.

Hartmut Henkel wrote:
> to give page dimension info for pdftex also in
> DVI mode, one could implement the standard
> \special{papersize=x,y} also in pdftex (parallel
> to \pdfpagewidth/height), so that it would be
> scanned, and also go into the DVI file. Would
> this help?

I think, not really:
* Scanning of \specials are done in PDF mode already,
  but here it is not really necessary, the current
  drivers know about \pdfpage{width,height}.
* In DVI mode, the scanning of \special's contents
  must then be added to set \pdfpage{width,height}.
  But who needs this actually?
  * Relative positioning with \pdfsavepos works
    with or without the correct page size
    information.
  * Absolute positioning is more difficult in use
    (If you are somewhere in a box, how do you
    want to apply absolute positions?)
  * If someone insist on absolute positioning,
    he will probably not rely on an accidentally
    issued \special{papersize=...}. He will probably
    make sure, that the papersize information
    is set and then he can also set
    \pdfpage{width,height}.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

PS: The name of the patch file is now
    "v2-pdftex.ch.diff". And I have removed
    the patch of fixed bug 437.


----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-17 00:16

Message:
Logged In: YES 
user_id=929

to give page dimension info for pdftex also in DVI mode, one
could implement the standard \special{papersize=x,y} also in
pdftex (parallel to \pdfpagewidth/height), so that it would
be scanned, and also go into the DVI file. Would this help?

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=438&group_id=106
From noreply at sarovar.org  Mon Oct 17 19:27:46 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 19:35:57 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-437 ] Two \immediate cancel themselves
Message-ID: <E1ERYm2-0004Fb-00@sarovar.org>

Bugs item #437, was opened at 2005-10-15 23:57
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106

Category: None
Group: v1.30.0
>Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Two \immediate cancel themselves

Initial Comment:
Hello,

Vladimir Volovich found the following bug, I quote
his bug report from the ntg-pdftex list here:

> consider the following Plain TeX file:
> 
> \immediate\immediate\openout1=test.out
> \immediate\write1 {line 1}
> \immediate\write1 {line 2}
> \immediate\closeout1
> 
> \bye
> 
> (it was reduced from a real-life example).
> 
> if i process it with vanilla TeX engine (i.e. not
> with pdfetex, but with TeX), you get what i expect:
> two lines are written to the file test.out, and
> there are no pages of output (no DVI file generated).
> 
> however, if i process this file with pdfetex, i do
> not get what i would expect: instead, the lines are
> written to terminal, test.out is created and is
> empty, and there is also a 1-page PDF file generated.
> 
> the bug goes away if i remove the second \immediate,
> but as i said this is a simplified example converted
> from a real-life usage.

It is indeed a bug:

this is the original code of "Implement \immediate":

| begin get_x_token;
| if (cur_cmd=extension)and(cur_chr<=close_node) then
|   begin p:=tail; do_extension;{append a whatsit node}
|   out_what(tail); {do the action immediately}
|   flush_node_list(tail); tail:=p; link(p):=null;
|   end
| else back_input;
| end

A token is read. If the token hears to \immediate,
it is executed with the immediate setting.
Otherwise the token is just put back.
  Now pdfTeX has more commands that obey \immediate:

| begin get_x_token;
| if cur_cmd=extension then begin
|    if cur_chr<=close_node then
|       begin <<original action>> end
|     else case cur_chr of
|         pdf_obj_code: begin <<...>> end;
|         pdf_xform_code: begin <<...>> end;
|         pdf_ximage_code: begin <<...>> end;
|         end;
|     endcases;
| end 
| else
|     back_input;
| end

Cases:
a) cur_cmd != extension
   --> nothing is changed (back_input)
b) cur_cmd == extension && cur_chr <= close_node
   --> nothing is changed (original action)
c) cur_cmd == extension
   && cur_chr in (pdf_{obj,xform,ximage}_code)
   --> new behaviour for pdfTeX
d) cur_cmd == extension && cur_chr > close_node
   && cur_chr not in (pdf_{obj,xform,ximage}_code)
   --> no action

Case d) is the bug. \immediate is an extension primitive
with cur_chr > close_node. Thus the second \immediate
is read, but then dropped. The effect is:
  \immediate\immediate\openout is same as \openout
Instead of "no action" there should be "back_input".
Before "endcases" the following line needs to be added:
    ...
    else case cur_chr of
      ...
      othercases back_input
    endcases;

I have attachted a diff file for pdftexdir/pdftex.ch.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-10-17 19:27

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.4

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=437&group_id=106
From noreply at sarovar.org  Mon Oct 17 19:27:46 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 17 19:35:58 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-435 ] Wrong file name in error messages
	of image inclusion (readimage)
Message-ID: <E1ERYm2-0004FV-00@sarovar.org>

Bugs item #435, was opened at 2005-10-15 01:21
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106

Category: Image inclusion
Group: v1.30.0
>Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Martin Schr?der (oneiros)
Summary: Wrong file name in error messages of image inclusion (readimage)

Initial Comment:
Hello,

see the thread "Wrong search path for PDF/PNG/JPG
files" (2005/10/14) in the pdftex mailing list.
Wlodek Bzyl detected a bug regarding image
inclusion:

pdfTeX sometimes prints a wrong file name in image
error messages:
The current directory contains:
pic.jpg (JPG image), pic.jpg.tex (e.g. consisting of
"\relax") and
test.tex:
  \pdfximage{pic.jpg}
  \pdfrefximage\pdflastximage
  \bye

Then kpse_find_file will find "pic.jpg.tex" (the
automatically adding of ".tex" is sometimes very
annoying) and prints the error message:
  Error: pdftex (file ./pic.jpg): reading image file
  failed
Or if the file pic.jpg.tex is longer:
  Error: pdftex (file ./pic.jpg): unknown type of image

In both cases the file name in the error message is
wrong. The error message is thrown by pdftex_fail that
looks for cur_file_name and prints it (utils.c).
However the real image file name can be changed
by kpse_find_file (e.g. adding ".tex"):

    img_name(img) = kpse_find_file(cur_file_name,
                           kpse_tex_format, true);
    if (img_name(img) == NULL)
        pdftex_fail("cannot find image file");

// Here the file name is still correct
// (img_name(img) is NULL)
// But after this, img_name(img) is not NULL and
// contains the used file name, cur_file_name is no
// longer valid.

    checktypebyheader(img);
    checktypebyextension(img);
    ...
    default:
        pdftex_fail("unknown type of image");
    }
    ...
    cur_file_name = NULL;
    ...

// checktypebyheader calls pdftex_fail,
// and pdftex_fail is also used
// later, in each case using the wrong cur_file_name.

Fix is easy:
  cur_file_name = img_name(img);
after the NULL check part before checktypebyheader.
There are no memory problems. Before cur_file_name
points to a static buffer, the return value of
makecstring. Thus free must not be used on
cur_file_name. And the memory part of img_name(img)
is not changed.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-10-17 19:27

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.30.4

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=435&group_id=106
From hartmut_henkel at gmx.de  Fri Oct 21 22:24:35 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri Oct 21 22:24:42 2005
Subject: [NTG-pdftex] Interesting Paper
Message-ID: <Pine.LNX.4.61.0510212221001.4653@hahepc1.hahe>

just found "Two Diet Plans for Fat PDF" by Thomas A. Phelps and Robert
Wilensky, University of California, Berkeley.

http://multivalent.sourceforge.net/Research/TwoDietPlans.pdf

Regards, Hartmut
From noreply at sarovar.org  Sat Oct 22 09:28:50 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Oct 22 09:37:05 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-441 ] Debug output of makecfilename
Message-ID: <E1ETDoA-0004MB-00@sarovar.org>

Bugs item #441, was opened at 2005-10-22 09:28
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=441&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: Debug output of makecfilename

Initial Comment:
Hello,

since pdfTeX 1.30.4, e.g. \pdfximage prints the file
name twice, the first time stderr is used and messes
up the output, e.g.:

<screen_output lines="8">
This is pdfTeX, Version 3.141592-1.30.4 (Web2C 7.5.5)
(./test.tex (./dir.tex antrschl.jpg
 [1 <./antrschl.jpg>] console.jpg
 [1 <./console.jpg>] img002.jpg
 [1 <./img002.jp
g>]) )
Output written on test.pdf (3 pages, 451963 bytes).
Transcript written on test.log.
</screen_output>

The line break in "<.\img002.jpg>" looks funny.

The reason is some debug output in function
makecfilename of utils.c:
   fprintf(stderr, " %s\n", name);

Patch attached that removes that line.
(With comment that at least marks the incompatibiliy
introduced in 1.30.4 regarding file names, but that
is another topic).

Output after the patch is applied:

<screen_output lines="5">
This is pdfTeX, Version 3.141592-1.30.4 (Web2C 7.5.5)
(./test.tex (./dir.tex [1 <./antrschl.jpg>] [1
<./console.jpg>] [1 <./img002.jp
g>]) )
Output written on test.pdf (3 pages, 451963 bytes).
Transcript written on test.log.
</screen_output>

Perhaps the output is messed up by the web interface
of the bug report system. There should be five lines.
The funny line break in "<.img002.jpg>" is now the
normal TeX line break because of screen line.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=441&group_id=106
From noreply at sarovar.org  Mon Oct 24 22:41:17 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Oct 24 22:49:17 2005
Subject: [NTG-pdftex] [ pdftex-Patches-443 ] 512 zeros in Type1 fonts not
	copied anymore
Message-ID: <E1EU989-0003JP-00@sarovar.org>

Patches item #443, was opened at 2005-10-24 22:41
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=443&group_id=106

Category: Fonts
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: 512 zeros in Type1 fonts not copied anymore

Initial Comment:
When embedding Type1 fonts in PDF files, it is not
needed to copy the trailing 512 zeros; they are
redundant. This has been suggested in the paper "Two
Diet Plans for Fat PDF" by Thomas A. Phelps and Robert
Wilensky. Reduces file size a little. Then /Length3 =
0, see Table 5.24 in the PDF Ref. v. 1.6. The tiny
patch to writet1.c does this for pdfTeX. No change in
the dvips portion.

In the patch also the font matrix transform is
streamlined by use of generic transform macros.

Testing welcome.

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=443&group_id=106
From Rolf.Niepraschk at ptb.de  Tue Oct 25 16:48:22 2005
From: Rolf.Niepraschk at ptb.de (Rolf Niepraschk)
Date: Tue Oct 25 16:48:27 2005
Subject: [NTG-pdftex] [Fwd: Producing Tagged PDF or PDF/A from LaTeX (ISO
	19005-1)]
Message-ID: <435E45B6.1040407@ptb.de>



-------- Original-Nachricht --------
Betreff: Producing Tagged PDF or PDF/A from LaTeX (ISO 19005-1)
Datum: 25 Oct 2005 13:36:19 GMT
Von: n05W43+mgk25@cl.cam.ac.uk (Markus Kuhn)
Organisation: University of Cambridge, England
Newsgruppen: comp.text.tex

Is there any solution on the horizon for turning a LaTeX document into
a "Tagged PDF" file, that is a PDF 1.4 file written in such a way
that the underlying Unicode plaintext in it can be recovered smoothly
(for easier searching, cut&paste, NLP parsing, Braille, speech
synthesis, etc.).

Background:

The new international standard ISO 19005-1:2005 defines an
"electronic document file format for long-term preservation" called
PDF/A-1. This is basically a subset of PDF 1.4, with lots of nasty and
dangerous stuff (JavaScript, external references, missing fonts,
encryption, etc.) removed and various historic ambiguities in the
PDF spec clarified.

It was mainly developed to make PDF useful for legal-deposit purposes,
All very good and commendable for anyone using PDF in electronic
publishing and archival applications.

However:

Full compliance with the PDF/A-1 format requires that "Tagged PDF"
is used, such that the underlying plaintext remains accessible for
further processing.

How could I do that from LaTeX?

Markus

-- 
Markus Kuhn, Computer Laboratory, University of Cambridge
http://www.cl.cam.ac.uk/~mgk25/ || CB3 0FD, Great Britain



From reinhard.kotucha at web.de  Thu Oct 27 00:52:59 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu Oct 27 00:53:10 2005
Subject: [NTG-pdftex] documentation
Message-ID: <17248.2251.974745.273351@zarniwoop.ms25.local>

Hi,
is it possible to make documentation for pdftex and hyperref
accessible to texdoc(1)?

While the pdftex manual can be accessed if people know that it is
called "pdftex-a" (it sounds like a joke if people say "Read the
documentation" on a mailing list), the hyperref manual is inaccessible.

On my system I get:

$ locate manual.pdf | wc -l
    164

Is it possible to solve it before TL is released?

I would expect that "texdoc <packagename>" or "texdoc <progname>"
provides something useful.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From karl at freefriends.org  Thu Oct 27 00:57:27 2005
From: karl at freefriends.org (Karl Berry)
Date: Thu Oct 27 00:57:32 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <17248.2251.974745.273351@zarniwoop.ms25.local>
Message-ID: <200510262257.j9QMvRs03657@f7.net>

    $ locate manual.pdf | wc -l
        164

Yeah.  I don't know what can be done about the plethora of manual.pdf's
except encourage authors to use a better name.

    Is it possible to solve it before TL is released?

Well, if you can make a patch for the texdoc .dat file,
I can install it :).

(Personally I am not sure that so many people use texdoc that it is
worth a superhuman effort, but there's certainly no harm in making it as
good as we can.)
From reinhard.kotucha at web.de  Thu Oct 27 01:14:34 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu Oct 27 01:14:47 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <200510262257.j9QMvRs03657@f7.net>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
Message-ID: <17248.3546.192846.88454@zarniwoop.ms25.local>

>>>>> "Karl" == Karl Berry <karl@freefriends.org> writes:

  > Well, if you can make a patch for the texdoc .dat file, I can
  > install it :).

I fear that, unlike texdoctk, texdoc simply uses ls-R as a database.  

Thomas recently mentioned that one can define aliases, but I think
that it is best if the authors provide fixes.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From te at dbs.uni-hannover.de  Thu Oct 27 06:53:54 2005
From: te at dbs.uni-hannover.de (Thomas Esser)
Date: Thu Oct 27 06:54:04 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <17248.3546.192846.88454@zarniwoop.ms25.local>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
Message-ID: <20051027045354.GB19146@dbs.uni-hannover.de>

> Thomas recently mentioned that one can define aliases, but I think
> that it is best if the authors provide fixes.

teTeX currently has

% documentation
TETEXDOC.pdf teTeX.pdf
etex-man.pdf etex.pdf
pdftex-a.pdf pdftex.pdf
testeuro.dvi eurosym.dvi
layman.dvi layouts.dvi
mfpman.pdf mfpic.pdf
psgomanual.pdf psgo.pdf
koma-script.pdf komascr.pdf
koma-script.pdf komascript.pdf
gerbibtx.dvi bibgerm.dvi

All this in texmf-dist/aliases (which TeX Live has dropped).

Thomas
From oberdiek at uni-freiburg.de  Thu Oct 27 10:34:12 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu Oct 27 10:34:49 2005
Subject: [NTG-pdftex] Re: documentation
In-Reply-To: <17248.2251.974745.273351@zarniwoop.ms25.local>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
Message-ID: <20051027083412.GA2745@m0A023206.vpn.uni-freiburg.de>

On Thu, Oct 27, 2005 at 12:52:59AM +0200, Reinhard Kotucha wrote:

> is it possible to make documentation for pdftex and hyperref
> accessible to texdoc(1)?

hyperref: Next version, this is almost done.
* The source code documentation hyperref.pdf from hyperref.dtx
  will contain a section with links and bookmarks that point
  to the other docus.
  Thus you can then use "texdoc hyperref.pdf".
* And README and ChangeLog will also be available as
  README.pdf and ChangeLog.pdf. (The conversions are done
  automatically).

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
From oberdiek at uni-freiburg.de  Thu Oct 27 14:21:32 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu Oct 27 14:22:39 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <1130407254.4360a556a63b8@imp.chebucto.net>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
	<1130407254.4360a556a63b8@imp.chebucto.net>
Message-ID: <20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>

On Thu, Oct 27, 2005 at 07:00:54AM -0300, George White wrote:

> Quoting Reinhard Kotucha <reinhard.kotucha@web.de>:
> 
> > >>>>> "Karl" == Karl Berry <karl@freefriends.org> writes:
> > 
> >   > Well, if you can make a patch for the texdoc .dat file, I can
> >   > install it :).
> > 
> > I fear that, unlike texdoctk, texdoc simply uses ls-R as a database.  
> > 
> > Thomas recently mentioned that one can define aliases, but I think
> > that it is best if the authors provide fixes.
> 
> It may be best, but is it practical?  Will aliases help when you have
> dozens of manual.pdf files?  
> 
> I suspect it is much easier to make changes in texdoc to support 
> "package/manual".  On systems that support symlinks one could process
> the doc tree to make package/manual.pdf -> package/package.pdf.

And how you want to solve the problem of several documentation
files? One symlink can point to just *one* file.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
From reinhard.kotucha at web.de  Fri Oct 28 01:35:30 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri Oct 28 01:35:53 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
	<1130407254.4360a556a63b8@imp.chebucto.net>
	<20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>
Message-ID: <17249.25666.376461.349887@zarniwoop.ms25.local>

>>>>> "Heiko" == Heiko Oberdiek <oberdiek@uni-freiburg.de> writes:

  > And how you want to solve the problem of several documentation
  > files? One symlink can point to just *one* file.

I do not claim that "mv manual.pdf hyperref.pdf" solves all problems.
But it is better than what we have now.

If there are more files, names like hyperref-example.pdf would not be
bad.  They can be remembered easily.  But the main problem is that the
name "manual.pdf" is not unique.

But the main doc file should have a name which people expext.

TeXLive will be released in a few days, so we certainly will not be
able to have a perfect solution, but I think that 
"mv manual.pdf hyperref.pdf" is a significant improvement.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From oberdiek at uni-freiburg.de  Fri Oct 28 00:58:09 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri Oct 28 01:38:35 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <1130436015.436115af82192@imp.chebucto.net>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
	<1130407254.4360a556a63b8@imp.chebucto.net>
	<20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>
	<1130436015.436115af82192@imp.chebucto.net>
Message-ID: <20051027225808.GA4879@irwin.vpn.uni-freiburg.de>

On Thu, Oct 27, 2005 at 03:00:15PM -0300, George White wrote:

> Quoting Heiko Oberdiek <oberdiek@uni-freiburg.de>:
> 
> > On Thu, Oct 27, 2005 at 07:00:54AM -0300, George White wrote:
> > 
> > > Quoting Reinhard Kotucha <reinhard.kotucha@web.de>:
> > > 
> > > > >>>>> "Karl" == Karl Berry <karl@freefriends.org> writes:
> > > > 
> > > >   > Well, if you can make a patch for the texdoc .dat file, I can
> > > >   > install it :).
> > > > 
> > > > I fear that, unlike texdoctk, texdoc simply uses ls-R as a database.  
> > > > 
> > > > Thomas recently mentioned that one can define aliases, but I think
> > > > that it is best if the authors provide fixes.
> > > 
> > > It may be best, but is it practical?  Will aliases help when you have
> > > dozens of manual.pdf files?  
> > > 
> > > I suspect it is much easier to make changes in texdoc to support 
> > > "package/manual".  On systems that support symlinks one could process
> > > the doc tree to make package/manual.pdf -> package/package.pdf.
> > 
> > And how you want to solve the problem of several documentation
> > files? One symlink can point to just *one* file.
> 
> Hopefully the others will at least be be mentioned in manual.pdf,

Perhaps somewhere, in many cases not:
* Different language versions:
  manual-en.pdf, manual-de.pdf, ...
  The normal expectation is then, that the users that open
  manual-en.pdf see the English version, readers of manual-de.pdf
  the German version, ... It would be a surprise, if theses manual
  versions start with a list of links to the different language
  versions. And which language should be choosen for this part?
* Separate source code documentation and user manual,
  articles, slides, ...

> but 
> this emphasizes the point that, for many packages, the directory in the
> doc tree is the real connection to the package and may contain multiple files
> with generic names like manual.pdf that may indicated the type of content but
> tell you nothing about the package.

But you still have the directory!

The current texdoc behaviour is not appropriate for
documentation that consist of several files:
  TDS:doc/.../package/package.pdf % for manual
  TDS:doc/.../package/package.pdf % for source code doc
  -> you are running out of names
  -> it is not clear, what the type of content is
  -> redundant naming, you could strip the directory "package" level

A more naturally naming convention is:
  TDS:doc/.../package/manual.pdf
  TDS:doc/.../package/source.pdf

Possible ways to solve the texdoc problem:
* The package author offers a document for texdoc with standardized
  name (e.g. texdoc-index.[pdf,html,...] that
  contains explanations and links to the package's documentation.

    TDS:doc/.../packageA/texdoc-index.pdf
    TDS:doc/.../packageA/manual.pdf
    TDS:doc/.../packageA/source.pdf
    TDS:doc/.../packageB/texdoc-index.html
    TDS:doc/.../packageB/manual.html
    TDS:doc/.../packageB/README

  Then texdoc also looks for this document (texdoc-index.*).

* Or a separate data base is maintained with package overviews.
  (e.g. source in XML. PDF and HTML are automatically generated.)

     source/packageA.xml
     source/packageB.xml
     pdf/packageA.pdf
     pdf/pacakgeB.pdf
     html/packageA.html
     html/packageB.html

     Then texdoc also looks for this database.

* Or texdoc shows the directory and let the user decide, which file\
  he wants.

* ...

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
From oberdiek at uni-freiburg.de  Fri Oct 28 02:02:08 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri Oct 28 02:03:38 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <17249.25666.376461.349887@zarniwoop.ms25.local>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
	<1130407254.4360a556a63b8@imp.chebucto.net>
	<20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>
	<17249.25666.376461.349887@zarniwoop.ms25.local>
Message-ID: <20051028000208.GA5676@irwin.vpn.uni-freiburg.de>

On Fri, Oct 28, 2005 at 01:35:30AM +0200, Reinhard Kotucha wrote:

> >>>>> "Heiko" == Heiko Oberdiek <oberdiek@uni-freiburg.de> writes:
> 
>   > And how you want to solve the problem of several documentation
>   > files? One symlink can point to just *one* file.
> 
> I do not claim that "mv manual.pdf hyperref.pdf" solves all problems.
> But it is better than what we have now.

You forget about hyperref.dtx --> hyperref.pdf.
Therefore I think my solution is better (see one of my previous mails).

> If there are more files, names like hyperref-example.pdf would not be
> bad.  They can be remembered easily.  But the main problem is that the
> name "manual.pdf" is not unique.

We have already "package/manual". This are not more chars
than "package-manual". But I don't know, why some versions
of texdoc understand "package/manual" and others don't.

> But the main doc file should have a name which people expext.
> 
> TeXLive will be released in a few days, so we certainly will not be

I don't know about release dates.

> able to have a perfect solution, but I think that 
> "mv manual.pdf hyperref.pdf" is a significant improvement.

hyperref.pdf is the document, generated from hyperref.dtx.
Thus this solution leads to confusion.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
From reinhard.kotucha at web.de  Fri Oct 28 02:17:41 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri Oct 28 02:17:50 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <20051028000208.GA5676@irwin.vpn.uni-freiburg.de>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
	<1130407254.4360a556a63b8@imp.chebucto.net>
	<20051027122131.GA4126@m0A023206.vpn.uni-freiburg.de>
	<17249.25666.376461.349887@zarniwoop.ms25.local>
	<20051028000208.GA5676@irwin.vpn.uni-freiburg.de>
Message-ID: <17249.28197.710303.562521@zarniwoop.ms25.local>

>>>>> "Heiko" == Heiko Oberdiek <oberdiek@uni-freiburg.de> writes:

  > hyperref.pdf is the document, generated from hyperref.dtx.  Thus
  > this solution leads to confusion.

There is no file hyperref.pdf in TeXLive or teTeX.  Karl? Thomas?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From noreply at sarovar.org  Sat Oct 29 19:24:59 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Oct 29 19:33:03 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-444 ] buffer overflow with \pdfmatch
Message-ID: <E1EVuRv-00084L-00@sarovar.org>

Bugs item #444, was opened at 2005-10-29 17:24
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: Nobody (None)
Summary: buffer overflow with \pdfmatch

Initial Comment:
% The new \pdfmatch primitive will run into a buffer
overflow with strings
% longer than 1023 characters:
%
% (I am using 1.30.3 with Thanh's patches from
pdftex.sarovar.org/src,
% compiled under cygwin.)


\def\x{1,2,3,4,5,6,7,8,9,0,}
\def\testlist{%
  ,\x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x00,}% 1024

\ifcase\pdfmatch{,1,}{\testlist}\relax \fi

% Also, if the pattern is too long:
%\ifcase\pdfmatch{\testlist}{1}\relax \fi

\bye,
Robert.

PS: Is there a simple way to escape all regex special
characters in a string?



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106
From noreply at sarovar.org  Sat Oct 29 21:08:45 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Sat Oct 29 21:16:54 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-444 ] buffer overflow with \pdfmatch
Message-ID: <E1EVw4L-0007mk-00@sarovar.org>

Bugs item #444, was opened at 2005-10-29 19:24
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: Nobody (None)
Summary: buffer overflow with \pdfmatch

Initial Comment:
% The new \pdfmatch primitive will run into a buffer
overflow with strings
% longer than 1023 characters:
%
% (I am using 1.30.3 with Thanh's patches from
pdftex.sarovar.org/src,
% compiled under cygwin.)


\def\x{1,2,3,4,5,6,7,8,9,0,}
\def\testlist{%
  ,\x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x \x\x\x\x\x
   \x\x\x\x\x \x\x\x\x\x \x00,}% 1024

\ifcase\pdfmatch{,1,}{\testlist}\relax \fi

% Also, if the pattern is too long:
%\ifcase\pdfmatch{\testlist}{1}\relax \fi

\bye,
Robert.

PS: Is there a simple way to escape all regex special
characters in a string?



----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-10-29 21:08

Message:
Logged In: YES 
user_id=929

see patch to utils.c. This makes makecstring() memory grow
on demand. Also increase MAX_CSTRING_LEN in ptexmac.h to e.
g. 10000000.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=444&group_id=106
From aa056 at chebucto.ns.ca  Wed Oct 12 14:14:29 2005
From: aa056 at chebucto.ns.ca (George White)
Date: Mon Oct 31 21:53:00 2005
Subject: [NTG-pdftex] Re: [tex-live] Whitespace in file name with all but
	plain TeX fails
In-Reply-To: <87hdbo9evw.fsf@infovore.xs4all.nl>
References: <200510101727.j9AHR3q12018@f7.net>
	<200510102201.j9AM1rhj023736@jupiter.fsci.fuk.kindai.ac.jp>
	<20051010234325.GA16120@lucien.oneiros.kn-bremen.de>
	<87ll109fer.fsf@infovore.xs4all.nl>
	<87hdbo9evw.fsf@infovore.xs4all.nl>
Message-ID: <1129119264.434cfe207aeb7@webmail.chebucto.ns.ca>

Quoting Olaf Weber <olaf@infovore.xs4all.nl>:

> Olaf Weber writes:
> > Martin Schr?der writes:
> 
> >> Is this by chance bug #377 again? :-(
> 
> > Try the following diff:
> 
> [...]

I applied both patches on my FC4 linux system.  A quick test confirms the white
space in filename problem is solved.  

-- 
George N. White III
Head of St. Margarets Bay, Nova Scotia
From dak at gnu.org  Thu Oct 27 00:59:46 2005
From: dak at gnu.org (David Kastrup)
Date: Mon Oct 31 21:53:00 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <17248.2251.974745.273351@zarniwoop.ms25.local> (Reinhard
	Kotucha's message of "Thu, 27 Oct 2005 00:52:59 +0200")
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
Message-ID: <8564rjg9zx.fsf@lola.goethe.zz>

Reinhard Kotucha <reinhard.kotucha@web.de> writes:

> is it possible to make documentation for pdftex and hyperref
> accessible to texdoc(1)?
>
> While the pdftex manual can be accessed if people know that it is
> called "pdftex-a" (it sounds like a joke if people say "Read the
> documentation" on a mailing list), the hyperref manual is
> inaccessible.
>
> On my system I get:
>
> $ locate manual.pdf | wc -l
>     164
>
> Is it possible to solve it before TL is released?

texdoc hyperref/manual

> I would expect that "texdoc <packagename>" or "texdoc <progname>"
> provides something useful.

Seems desirable.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum
From frank at kuesterei.ch  Thu Oct 27 10:12:36 2005
From: frank at kuesterei.ch (=?iso-8859-1?q?Frank_K=FCster?=)
Date: Mon Oct 31 21:53:00 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <8564rjg9zx.fsf@lola.goethe.zz> (David Kastrup's message of
	"Thu, 27 Oct 2005 00:59:46 +0200")
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<8564rjg9zx.fsf@lola.goethe.zz>
Message-ID: <87r7a78jkb.fsf@alhambra.kuesterei.ch>

David Kastrup <dak@gnu.org> wrote:

> Reinhard Kotucha <reinhard.kotucha@web.de> writes:
>
>> is it possible to make documentation for pdftex and hyperref
>> accessible to texdoc(1)?
>>
>> While the pdftex manual can be accessed if people know that it is
>> called "pdftex-a" (it sounds like a joke if people say "Read the
>> documentation" on a mailing list), the hyperref manual is
>> inaccessible.
>>
>> On my system I get:
>>
>> $ locate manual.pdf | wc -l
>>     164
>>
>> Is it possible to solve it before TL is released?
>
> texdoc hyperref/manual

Or, if you don't know that by heart, 

texdoc -s hyperref
texdoc hyperref/manual

>> I would expect that "texdoc <packagename>" or "texdoc <progname>"
>> provides something useful.
>
> Seems desirable.

Heiko Oberdiek (hyperref's maintainer) argued that there is not one
piece of documentation for hyperref, and therefore there's no good
solution as to what "texdoc hyperref" should show.  The other documents
are not only developers' information, there's also some interesting user
docs in there (especially but not only in README), and a real solution
would require to rewrite the manual (which is outdated, anyway).  I'm
sure he welcomes offers for help; I myself have done that once and have
the sources for the docs on my system, but in fact I never found time.

Regards, Frank
-- 
Frank K?ster
Inst. f. Biochemie der Univ. Z?rich
Debian Developer

From aa056 at chebucto.ns.ca  Thu Oct 27 12:00:54 2005
From: aa056 at chebucto.ns.ca (George White)
Date: Mon Oct 31 21:53:01 2005
Subject: [NTG-pdftex] Re: [tex-live] documentation
In-Reply-To: <17248.3546.192846.88454@zarniwoop.ms25.local>
References: <17248.2251.974745.273351@zarniwoop.ms25.local>
	<200510262257.j9QMvRs03657@f7.net>
	<17248.3546.192846.88454@zarniwoop.ms25.local>
Message-ID: <1130407254.4360a556a63b8@imp.chebucto.net>

Quoting Reinhard Kotucha <reinhard.kotucha@web.de>:

> >>>>> "Karl" == Karl Berry <karl@freefriends.org> writes:
> 
>   > Well, if you can make a patch for the texdoc .dat file, I can
>   > install it :).
> 
> I fear that, unlike texdoctk, texdoc simply uses ls-R as a database.  
> 
> Thomas recently mentioned that one can define aliases, but I think
> that it is best if the authors provide fixes.

It may be best, but is it practical?  Will aliases help when you have
dozens of manual.pdf files?  

I suspect it is much easier to make changes in texdoc to support 
"package/manual".  On systems that support symlinks one could process
the doc tree to make package/manual.pdf -> package/package.pdf.

-- 
George N. White III
Head of St. Margarets Bay, Nova Scotia
