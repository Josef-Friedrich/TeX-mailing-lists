From hanthethanh at myrealbox.com  Wed Feb  2 02:07:38 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Feb  2 03:26:35 2005
Subject: [NTG-pdftex] on the bug "unhbox kills char protrusion"
Message-ID: <20050202010738.GA1116@monty>

Hi,

I was scratching my head for a while trying to remember why I wanted
do remove margin_kern_node while unboxing. Then I found the following
message:

,--------
| Date: Wed, 04 Oct 2000 19:45:49 +0200
| To: Han The Thanh <thanh@informatics.muni.cz>
| From: Hans Hagen <pragma@wxs.nl>
| Subject: Re: protruding -- an interesting problem
| 
| At 07:35 PM 10/4/00 +0200, Han The Thanh wrote:
| >Hans,
| >
| >I encoutered an interesting problem of protruding: they are implemented by
| >inserting a new kind of node; I named it `margin_kern_node'. A problem
| >arose when a paragraph broken into lines is now unboxed; we have some
| >extra nodes which cannot be handled by other part of TeX anymore. I
| >consider to ignore such nodes when unbox a box. 
| 
| Hm. What part? breaking apart boxes are a problem anyway, since marks and
| specials interfere. I suggest: 
| 
| (1) keep the nodes there when unvboxing
| (2) discard them when unhboxing (the lines of such an unvboxed box) 
| 
| There's a lot of stuff around that unvboxes, like multi column routines! I
| would render your protruding useless. 
| 
| 
| if you have a margin_kern node, then can you also add: \nomarginkern (like
| the proposes etex primitive \noligs) which means: don't kern the next char, 
| 
| Hans
`--------

It is interesting to remove that part as Hartmut did, and see what
surprises it can bring :). 

Thanh
From hanthethanh at myrealbox.com  Wed Feb  2 02:55:26 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Feb  2 03:27:06 2005
Subject: [NTG-pdftex] pdftex snapshot
Message-ID: <20050202015526.GC1116@monty>

Hi,

pdftex-1.20c-beta-20050202 is available at pdftex.sarovar.org/src
This snapshot contains all patches from Hartmut and my changes.

The djgpp binaries are also available.

Thanh
From hanthethanh at myrealbox.com  Wed Feb  2 10:03:10 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu Feb  3 02:27:04 2005
Subject: [NTG-pdftex] Type3 fonts
Message-ID: <20050202090310.GA1684@monty>

Hi,

I spent a few hours playing with type3 fonts, but was not able to create
a type3 font that uses another font (type1). It seems that the text
operators somehow doesn't work inside the CharProc stream for type3
fonts. I was experimenting with it because I wonder whether it makes
sense to have mechanism to create user-defined fonts. The answer seems
to be no. But anyway, if someone is interested in this issue, please
have a look into the pdf I created, maybe I did something wrong. As the
files are small so I attached it here, hopefully it doesn't cause any
inconvenience. I tried with xpdf, gv and acrobat reader (on linux), and
got dots or blank glyph only. 

In short, it seems that type3 font is not the way to go. 

Thanh
-------------- next part --------------
A non-text attachment was scrubbed...
Name: f.zip
Type: application/zip
Size: 5074 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050202/65792849/f.zip
From hanthethanh at myrealbox.com  Wed Feb  2 15:43:35 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu Feb  3 02:29:49 2005
Subject: [NTG-pdftex] forgot to apply patch to reject Type42 fonts
Message-ID: <20050202144335.GA1116@monty>

Hi Martin,

I forgot to apply the patch from Hartmut to reject Type42 fonts. Can you
please apply it then? Thanks.

Thanh
From pragma at wxs.nl  Thu Feb  3 10:43:55 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Feb  3 10:43:49 2005
Subject: [NTG-pdftex] Type3 fonts
In-Reply-To: <20050202090310.GA1684@monty>
References: <20050202090310.GA1684@monty>
Message-ID: <4201F25B.5080409@wxs.nl>

The Thanh Han wrote:
> Hi,
> 
> I spent a few hours playing with type3 fonts, but was not able to create
> a type3 font that uses another font (type1). It seems that the text
> operators somehow doesn't work inside the CharProc stream for type3
> fonts. I was experimenting with it because I wonder whether it makes
> sense to have mechanism to create user-defined fonts. The answer seems
> to be no. But anyway, if someone is interested in this issue, please
> have a look into the pdf I created, maybe I did something wrong. As the
> files are small so I attached it here, hopefully it doesn't cause any
> inconvenience. I tried with xpdf, gv and acrobat reader (on linux), and
> got dots or blank glyph only. 
> 
> In short, it seems that type3 font is not the way to go. 

there is an error in the file:

/Font << /F1 9 0 R /F2 10 0 R>>
/Font << /F1 9 0 R >>

if, in vi (keeps bytes), you change this into:

/Font << /F1 9 0 R /F2 10 0 R>>
/Fint << /F1 9 0 R >>

the document opens (still no first paragraph visible, but at least it's something

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Feb  3 10:55:22 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Feb  3 10:55:15 2005
Subject: [Fwd: Re: [NTG-pdftex] Type3 fonts]
Message-ID: <4201F50A.50109@wxs.nl>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
An embedded message was scrubbed...
From: Hans Hagen <pragma@wxs.nl>
Subject: Re: [NTG-pdftex] Type3 fonts
Date: Thu, 03 Feb 2005 10:55:04 +0100
Size: 1128
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050203/bead93c3/NTG-pdftexType3fonts.mht
From pragma at wxs.nl  Thu Feb  3 12:17:50 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Feb  3 12:17:43 2005
Subject: [NTG-pdftex] re: type 3 
Message-ID: <4202085E.1020707@wxs.nl>

Hi

 >> inconvenience. I tried with xpdf, gv and acrobat reader (on linux), and
 >> got dots or blank glyph only.


with a bit of merging i can get something produced by metapost visible but only 
in gsview, changin gyour last part to:

\pdfliteral direct {/F2 3009.9626 Tf} AA

(i needed a bigger scale -)

Is there an example of a file with a type3 that shows up somewhere?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Feb  3 15:29:26 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Thu Feb  3 17:26:13 2005
Subject: [NTG-pdftex] strange effect pdfliteral
Message-ID: <42023546.2030900@wxs.nl>

Can someone explain why in the last example the pdfliteral messes up the spacing

\pdfcompresslevel=0

\setupcolors[state=start]

\starttext

\def\red  #1{\pdfliteral {1 0 0 rg}#1\pdfliteral{0 g}}
\def\green#1{\pdfliteral {0 1 0 rg}#1\pdfliteral{0 g}}
\def\blue #1{\pdfliteral {0 0 1 rg}#1\pdfliteral{0 g}}

\dorecurse{25} {\red{red} \green{green} \blue{blue} }

\def\red  #1{\pdfliteral direct {1 0 0 rg}#1\pdfliteral{0 g}}
\def\green#1{\pdfliteral direct {0 1 0 rg}#1\pdfliteral{0 g}}
\def\blue #1{\pdfliteral direct {0 0 1 rg}#1\pdfliteral{0 g}}

\dorecurse{25} {\red{red} \green{green} \blue{blue} }

\def\red  #1{\pdfliteral direct {1 0 0 rg} #1\pdfliteral{0 g}}
\def\green#1{\pdfliteral direct {0 1 0 rg} #1\pdfliteral{0 g}}
\def\blue #1{\pdfliteral direct {0 0 1 rg} #1\pdfliteral{0 g}}

\dorecurse{25} {\red{red} \green{green} \blue{blue} }

\def\red  #1{\pdfliteral direct {1 0 0 rg}#1\pdfliteral direct {0 g}}
\def\green#1{\pdfliteral direct {0 1 0 rg}#1\pdfliteral direct {0 g}}
\def\blue #1{\pdfliteral direct {0 0 1 rg}#1\pdfliteral direct {0 g}}

\dorecurse{25} {\red{red} \green{green} \blue{blue} }

\stoptext



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdftex.tex
Type: application/x-tex
Size: 1044 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050203/a47177b1/pdftex-0001.tex
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdftex.pdf
Type: application/pdf
Size: 49064 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050203/a47177b1/pdftex-0001.pdf
From ms at artcom-gmbh.de  Thu Feb  3 17:39:31 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Feb  3 17:39:34 2005
Subject: [NTG-pdftex] forgot to apply patch to reject Type42 fonts
In-Reply-To: <20050202144335.GA1116@monty>
References: <20050202144335.GA1116@monty>
Message-ID: <20050203163931.GU5322@blau.artcom-gmbh.de>

On 2005-02-02 21:43:35 +0700, The Thanh Han wrote:
> I forgot to apply the patch from Hartmut to reject Type42 fonts. Can you
> please apply it then? Thanks.

Done.

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From ms at artcom-gmbh.de  Thu Feb  3 17:53:35 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Feb  3 17:53:38 2005
Subject: [NTG-pdftex] 1.20c-beta-20050203
In-Reply-To: <20050121151603.GF24453@blau.artcom-gmbh.de>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121151603.GF24453@blau.artcom-gmbh.de>
Message-ID: <20050203165335.GV5322@blau.artcom-gmbh.de>

> p4 describe -s 6763 
Change 6763 by ms@artcom on 2005/02/03 17:50:43

        pdfTeX 1.20c-beta-20050203
        Numerous changes from Thanh; see texk/web2c/pdftexdir/NEWS

Affected files ...

... //depot/Build/source.development/TeX/libs/xpdf/goo/gfile.h#14 edit
... //depot/Build/source.development/TeX/texk/web2c/pdfetexdir/pdfetex.ch1#9 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/NEWS#79 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/hz.ch#12 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/image.h#10 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftex.ch#162 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftex.defines#13 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftex.mk#34 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftoepdf.cc#51 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/ptexlib.h#24 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/ptexmac.h#14 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/ttf2afm.c#14 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/utils.c#21 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writefont.c#13 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writeimg.c#15 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writejpg.c#8 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writepng.c#5 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writet1.c#22 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writettf.c#13 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writettf.h#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/colorspace.ch#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/escapestr.ch#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/fixlinedimen.ch#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/pdfxtex.defines#5 edit
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/pdfxtex.mk#20 edit
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/pxdimen.ch#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/quitvmode.ch#1 add
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/strcmp.ch#5 edit
... //depot/Build/source.development/TeX/texk/web2c/pdfxtexdir/tagcode.ch#1 add

--------------------------------------------------------------
pdfTeX 3.141592-1.20c-beta-20050203 was released on 2005-02-03
--------------------------------------------------------------
- ttf2afm has been heavily changed:
    - added support for refering to glyphs via unicode in encoding files (ie 'uniXXX')
    - added some more info to the AFM output
    - some minor bug fixes
    - a short documentation available

- pdftex now understand forms 'uniXXXX' in encoding files (only makes sense
  with TrueType fonts)

- added subset tag for TrueType fonts

- PDF strings are now printed as following:
    (This is a string) -> (This is a string)
    This is a string -> (This is a string)
    <a1b245c1a2...> -> <a1b245c1a2...>

- check for double newline char to get rid of empty lines in PDF output

- Fixed a bug in the scanning of map lines introduced in the the fix of bug
  #242 in 1.20b.
  
- Fixed three problems in xpdf; xpdf is now 3.00pl3

- \ifeof18 is a simple method to test if \write18 is enabled.

- a few extensions in pdfxtex:
    - \pdflastximagecolordepth returns the last color depth
    - \pdfximage supports a keyword "colorspace" following an object number
      representing a ColorSpace object
    - \pdfstrcmp compares two strings
    - \pdfescapestring/\pdflastescapedstring provide a mean to escape string
    - \pdffirstlineheight/\pdflastlinedepth/\pdfeachlineheight/\pdfeachlinedepth
      allow fixing line dimen
    - patches from Taco
        - px dimen unit
        - tagcode patch
        - quitvmode patch

It's in p4; I'll upload a tarball to sarovar (http://sarovar.org/projects/pdftex/) soon.

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From taco at elvenkind.com  Fri Feb  4 02:55:01 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu Feb  3 20:55:13 2005
Subject: [NTG-pdftex] strange effect pdfliteral
In-Reply-To: <42023546.2030900@wxs.nl>
References: <42023546.2030900@wxs.nl>
Message-ID: <4202D5F5.3000703@elvenkind.com>

Hans Hagen wrote:
> Can someone explain why in the last example the pdfliteral messes up the 
> spacing

I have the impression that \pdfliteral direct {} forgets to take
notice of the fact that a skip has been outputted. It rescues this
situation at the beginning of each line, so it is probably something
that pdf_set_origin() normally does (since that is never called
for a 'direct' literal).
From noreply at sarovar.org  Fri Feb  4 01:34:15 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Fri Feb  4 01:37:29 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-282 ] TTF embedding
Message-ID: <E1CwrQN-00034L-00@sarovar.org>

Bugs item #282, was opened at 2005-02-04 01:34
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=282&group_id=106

Category: Fonts
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: TTF embedding

Initial Comment:
pdfeTeX 3.141592-1.20c-beta-20050203-2.2 (Web2C 7.5.4)

Some TTF embedding problem, found when i tried the old
test files from repaired bug 210. The log tells that
chinese font htsong.ttf is embedded.But xpdf-3.0 chokes
with

Error: Couldn't create a font for 'MWCLGR+SongTi'
Error: Couldn't create a font for 'ULNAVB+SongTi'
Error: Couldn't create a font for 'FAKOEO+SongTi'

and nothing is shown.Previously there were nice chinese
characters.

See tst.tgz. You also need free htsong.ttf, forgot from
where, maybe google after it (it's huge, 9 MB).

Regards, Hartmut

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=282&group_id=106
From hanthethanh at myrealbox.com  Thu Feb  3 14:37:18 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Feb  4 02:53:28 2005
Subject: [NTG-pdftex] Type3 fonts
In-Reply-To: <4201F25B.5080409@wxs.nl>
References: <20050202090310.GA1684@monty> <4201F25B.5080409@wxs.nl>
Message-ID: <20050203133718.GC1230@monty>

> there is an error in the file:
> 
> /Font << /F1 9 0 R /F2 10 0 R>>
> /Font << /F1 9 0 R >>
> 
> if, in vi (keeps bytes), you change this into:
> 
> /Font << /F1 9 0 R /F2 10 0 R>>
> /Fint << /F1 9 0 R >>
> 
> the document opens (still no first paragraph visible, but at least it's 
> something

oops, sorry, I already did it but somehow forgot to do in the version
sent to the ML. In fact I managed to make xpdf segfault quite a few
times before coming to this end :)

Thanh
From hanthethanh at myrealbox.com  Fri Feb  4 01:45:05 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Feb  4 02:53:33 2005
Subject: [NTG-pdftex] .TTF suffix is not supported by kpathsea?
Message-ID: <20050204004504.GA1150@monty>

Hi,

I have been playing with ttf2afm and somehow it cannot open files with
uppercase name (in the current dir). Renaming the file to have lowercase
suffix .ttf helps. Is this the correct behaviour of kpathsea, or I am
doing something wrong?

Thanh
From kakuto at fsci.fuk.kindai.ac.jp  Fri Feb  4 03:15:36 2005
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Fri Feb  4 03:15:52 2005
Subject: [NTG-pdftex] .TTF suffix is not supported by kpathsea?
In-Reply-To: Your message of "Fri, 4 Feb 2005 07:45:05 +0700"
References: <20050204004504.GA1150@monty>
Message-ID: <200502040215.j142Fc16002896@jupiter.fsci.fuk.kindai.ac.jp>

> I have been playing with ttf2afm and somehow it cannot open files with
> uppercase name (in the current dir). Renaming the file to have lowercase
> suffix .ttf helps. Is this the correct behaviour of kpathsea, or I am
> doing something wrong?

That is the correct behavior.
Kpse-allowed suffixes are .ttc and .ttf.
-- 
Akira Kakuto
From hanthethanh at myrealbox.com  Fri Feb  4 03:26:04 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Feb  4 03:36:07 2005
Subject: [NTG-pdftex] .TTF suffix is not supported by kpathsea?
In-Reply-To: <200502040215.j142Fc16002896@jupiter.fsci.fuk.kindai.ac.jp>
References: <20050204004504.GA1150@monty>
	<200502040215.j142Fc16002896@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <20050204022604.GC1297@monty>

thanks, Akira. Then I know that I have to rename the fonts to lowercase
by myself.

Thanh

On Fri, Feb 04, 2005 at 11:15:36AM +0900, Akira Kakuto wrote:
> > I have been playing with ttf2afm and somehow it cannot open files with
> > uppercase name (in the current dir). Renaming the file to have lowercase
> > suffix .ttf helps. Is this the correct behaviour of kpathsea, or I am
> > doing something wrong?
> 
> That is the correct behavior.
> Kpse-allowed suffixes are .ttc and .ttf.
> -- 
> Akira Kakuto
> 
From pragma at wxs.nl  Fri Feb  4 09:56:43 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri Feb  4 09:56:34 2005
Subject: [NTG-pdftex] 1.20c-beta-20050203
In-Reply-To: <20050203165335.GV5322@blau.artcom-gmbh.de>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121151603.GF24453@blau.artcom-gmbh.de>
	<20050203165335.GV5322@blau.artcom-gmbh.de>
Message-ID: <420338CB.4030707@wxs.nl>

Martin Schr?der wrote:

>         pdfTeX 1.20c-beta-20050203

isn't it time to move to 1.21, esp since there is some new functionality we need 
to adapt to using the [main] version number

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hanthethanh at myrealbox.com  Fri Feb  4 10:34:38 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Feb  4 10:43:14 2005
Subject: [NTG-pdftex] 1.20c-beta-20050203
In-Reply-To: <420338CB.4030707@wxs.nl>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121151603.GF24453@blau.artcom-gmbh.de>
	<20050203165335.GV5322@blau.artcom-gmbh.de>
	<420338CB.4030707@wxs.nl>
Message-ID: <20050204093438.GA1245@monty>

it's up to Martin. 

Thanh

On Fri, Feb 04, 2005 at 09:56:43AM +0100, Hans Hagen wrote:
> Martin Schr?der wrote:
> 
> >        pdfTeX 1.20c-beta-20050203
> 
> isn't it time to move to 1.21, esp since there is some new functionality we 
> need to adapt to using the [main] version number
> 
> Hans
> 
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
> 
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From hanthethanh at myrealbox.com  Fri Feb  4 10:36:18 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Fri Feb  4 10:43:18 2005
Subject: [NTG-pdftex] new snapshot
Message-ID: <20050204093618.GB1245@monty>

Hi Martin & Hartmut,

I uploaded a new snapshot of pdftex -- this version fixed the problem
with ttf embedding and some minor fixes I forgot to apply in the
previous version.

To Hans: djgpp has also been updated.

Thanh
From ms at artcom-gmbh.de  Fri Feb  4 19:58:41 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Fri Feb  4 19:58:44 2005
Subject: [NTG-pdftex] 1.21a
In-Reply-To: <20050204093438.GA1245@monty>
References: <20050120112534.GJ15507@blau.artcom-gmbh.de>
	<20050121151603.GF24453@blau.artcom-gmbh.de>
	<20050203165335.GV5322@blau.artcom-gmbh.de>
	<420338CB.4030707@wxs.nl> <20050204093438.GA1245@monty>
Message-ID: <20050204185841.GG5322@blau.artcom-gmbh.de>

> p4 describe -s 6766 
Change 6766 by ms@artcom on 2005/02/04 19:26:21

        pdftex: 1.21a
        some small fixes by Thanh and a small fix to ttf2afm.c
        update README and NEWS

Affected files ...

... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/NEWS#80 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/README#26 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/pdftex.ch#163 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/ttf2afm.c#15 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writet1.c#23 edit
... //depot/Build/source.development/TeX/texk/web2c/pdftexdir/writettf.c#14 edit

The only difference from Thanh's latest snapshot is a fix for a
compilation problem in ttf2afm.c

It's at sarovar and uploaded to CTAN; the announcement to the
pdftex list is on it's way and Freshmeat is also pending.

Happy weekend :-)
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Tue Feb  8 10:30:00 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Feb  8 10:33:37 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-282 ] TTF embedding
Message-ID: <E1CyRh2-0005Ln-00@sarovar.org>

Bugs item #282, was opened at 2005-02-04 01:34
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=282&group_id=106

Category: Fonts
Group: None
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: TTF embedding

Initial Comment:
pdfeTeX 3.141592-1.20c-beta-20050203-2.2 (Web2C 7.5.4)

Some TTF embedding problem, found when i tried the old
test files from repaired bug 210. The log tells that
chinese font htsong.ttf is embedded.But xpdf-3.0 chokes
with

Error: Couldn't create a font for 'MWCLGR+SongTi'
Error: Couldn't create a font for 'ULNAVB+SongTi'
Error: Couldn't create a font for 'FAKOEO+SongTi'

and nothing is shown.Previously there were nice chinese
characters.

See tst.tgz. You also need free htsong.ttf, forgot from
where, maybe google after it (it's huge, 9 MB).

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-08 10:30

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.21a

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=282&group_id=106
From noreply at sarovar.org  Tue Feb  8 10:30:00 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Feb  8 10:33:38 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-262 ] Type42 inclusion
Message-ID: <E1CyRh2-0005Lj-00@sarovar.org>

Bugs item #262, was opened at 2005-01-21 10:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106

Category: Fonts
Group: v1.20b
>Status: Closed
>Resolution: Fixed
Priority: 3
Submitted By: Nobody (None)
Assigned to: Hartmut Henkel (hhenkel)
Summary: Type42 inclusion

Initial Comment:
Hello,

Trying to get ttf fonts working both with dvips and
pdflatex I experimented with converting the ttf to
Type42 using fontforge, disassembling it via t1disasm
and creating a pfb with t1asm. The resulting pfb is
included via dvips and both ghostscript and distiller
can interpret it.
Unfortunately, pdflatex gives me the following error
trying to include the pfb: 
Error: pdftex (file FranklinGothic-Medium.pfb):
unexpected end of file
 ==> Fatal error occurred, the output PDF file is not
finished!

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-08 10:30

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.21a

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-29 23:08

Message:
Logged In: YES 
user_id=929

The attached simple patch for writet1.c checks the /FontType
key and if it's 42, pdfTeX exits with an error message:

Error: pdfetex (file ./foo.pfb): Type42 fonts unsupported by
pdfTeX

This could be modified so that an error is given if it's
_not_ Type1.But which font types _are_ supported?

Another way might be to check the header comment for
"%!PS-AdobeFont" or "%!FontType1". But all this can be
cheated, and there might be fonts with wrong comment lines
floating around...

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-27 10:46

Message:
Logged In: YES 
user_id=421

If we decide that Type42 fonts are unsupported, pdftex
should at least raise a clear error when it finds them.

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2005-01-27 10:14

Message:
Logged In: YES 
user_id=710

Hi,

pdftex doesn't support Type42 fonts and probably won't,
unless someone else implements it, as I see little sense in
making it work.

Thanh



----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-22 14:36

Message:
Logged In: YES 
user_id=2197

Hello,

dvips also chokes if it tries to subset the font, including
it completely works though. I don't really know if it's
worth implementing support for Type42 in pdftex, I wouldn't
use it either -- I just tried to find out if dvips+ttf
without loss of hinting information is really a no-go as
often claimed. Result was: no, no problem ;-)

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-21 23:13

Message:
Logged In: YES 
user_id=929

>From inspection of disassembled font
FranklinGothic-Medium.pfb it seems that this Type 42 font is
incompatible with writet1.c.Maybe handling Type 42 fonts is
not implemented in general?

The problem is, that after scanning of the /Encoding array
the function t1_subset_ascii_part() is waiting for the
string "currentfile eexec" while running the {...} while
(t1_in_eexec == 0); loop.  But in the Type 42 font there
follows the /sfnts key and the Type 42 program is scanned.
Then, as t1_in_eexec will never be changed, the while loop
runs into the end of the font file, resulting in the error.

Looks like it would require quite some change in writet1.c
to handle these Type 42 fonts. Would such a change make
sense, given that this type of font appears rather seldomly?

I also wonder how it should work in dvips, as it uses the
same writet1.c, and here also the same error message appears.

Also dvipdfm can't process the font, it just hangs.

All on teTeX-2.99.9 debian woody i686.

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Michael Zedler (zedler)
Date: 2005-01-21 15:57

Message:
Logged In: YES 
user_id=2197

You may find the pfb, tfm, vf at
http://www.hft.ei.tum.de/mz/test_t42.zip

I suppose the error is due to pdftex trying to subset the
Type42 font. 

Cheers,
Michael

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-21 10:58

Message:
Logged In: YES 
user_id=421

Please include some test files; at least the pfb is needed.
Also please login when commenting on this or any other bug.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=262&group_id=106
From pragma at wxs.nl  Tue Feb  8 10:55:18 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Feb  8 11:37:35 2005
Subject: [NTG-pdftex] feature request 
Message-ID: <42088C86.9000404@wxs.nl>

Hi,

Some fonts have glyoh variants, e.g. latin modern has umlauts versions and 
alternative copyright symbols and such. The characteristics of those 
alternatives don't change, so we could pop them in using an special enc file, 
which is what i do now. However, in order to fully exploit this feature, we need 
some extension.

Say that we use lmr10 two times, one time with the alternatives, and one time 
as-is. We need:

- two tfm files (the same but a different name)
- two mapping lines
- one pfb file

However, if we have

   \pdfsetfontenc\somefont{blabla.enc}

we can do with

- one tfm files (the same but a different name)
- one mapping lines (the original)
- one pfb file

I can even imagine that we have

   \pdfsetfontfile\somefont{blabla.pfb}
   \pdfsetfontname\somefont{FunnyFontName}

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From andreas.lobinger at freenet.de  Tue Feb  8 15:09:02 2005
From: andreas.lobinger at freenet.de (andreas.lobinger@freenet.de)
Date: Tue Feb  8 18:23:55 2005
Subject: [NTG-pdftex] pdftex1.21a build, linker problem
Message-ID: <E1CyW34-0006j6-7q@www9.emo.freenet-rz.de>

An HTML attachment was scrubbed...
URL: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050208/0caaca2f/attachment.html
-------------- next part --------------
Aloha,
i'm building pdftex on a sort-of standard sparc-sun-solaris2.8.
I get a linker problem in building ctangleboot
...
/bin/sh ../libtool --mode=link gcc -o ctangleboot   ctangleboot.o cwebboot.o lib/lib.a ../kpathsea/libkpathsea.la -lm  
gcc -o ctangleboot ctangleboot.o cwebboot.o  lib/lib.a ../kpathsea/.libs/libkpathsea.a -lm
ld: fatal: symbol `main' is multiply-defined:
        (file ctangleboot.o and file lib/lib.a(main.o));
ld: fatal: File processing errors. No output written to ctangleboot
collect2: ld returned 1 exit status
gmake: *** [ctangleboot] Error 1
It seems, that the build process is assuming a ld that quietly
suppresses multiply defined objects.
This shouldn't be so.
Wishing a happy day
 LOBI


From andreas.lobinger at freenet.de  Tue Feb  8 16:05:41 2005
From: andreas.lobinger at freenet.de (andreas.lobinger@freenet.de)
Date: Tue Feb  8 18:23:55 2005
Subject: [NTG-pdftex] Type3 fonts and the way to go
Message-ID: <E1CyWvt-0000e5-2Z@www9.emo.freenet-rz.de>

An HTML attachment was scrubbed...
URL: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050208/bae098a1/attachment.html
-------------- next part --------------
Aloha,The Thanh Han posted:>I spent a few hours playing with type3 fonts, but was not able to create>a type3 font that uses another font (type1). It seems that the text>operators somehow doesn't work inside the CharProc stream for type3>fonts.> ...>But anyway, if someone is interested in this issue, please>have a look into the pdf I created, maybe I did something wrong.-Ressources, as Hans Hagen pointed out, the /Ressources of the pageand therefore object 13 need both /Fonts defined. -Encoding, as you're defining chars 97 and 98 and use 'A' and 'B' which are 65 and 66 in my StdEncoding table you won't get that muchpage impression...-Scaling, you need to reread the chapter about text space details. You aredefining a /FontMatrix of [0.001 etc.] which gives you a 1000x1000 glyphcoordinate system. For /A you use this (750 re), but for /B you definea very small /F1.  I don't have a facility to compile your f2.tex with an recent pdftex, soi changed the abovementioned points directly in the f2.pdf. Here are the objects with the changes:13 0 obj
<<
  /Font <<
    /F2 10 0 R 
    /F1 9 0 R 
  >>
  /ProcSet [/PDF /Text]
>>
endobj
10 0 obj
<<
  /Type /Font 
  /FontBBox [0 0 1000 1000]
  /FirstChar 65 
  /Widths [750 750]
  /FontMatrix [0.001 0 0 0.001 0 0]
  /Encoding 5 0 R 
  /CharProcs 4 0 R 
  /Resources 6 0 R 
  /LastChar 66 
  /Name /F2 
  /Subtype /Type3 
>>
endobj
5 0 obj
<<
  /Type /Encoding 
  /Differences [65 /A /B]
>>
endobj
2 0 obj
<<
  /Length 35 
>>
stream
 1000 0 d0 BT /F1 900 Tf (B) Tj ET endstream endobj
As far as i understand f2.tex it should be very easy to change (except for the /Ressourcesentry). Wishing a happy day	LOBI  

From hartmut_henkel at gmx.de  Tue Feb  8 19:00:22 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Feb  8 19:00:26 2005
Subject: [NTG-pdftex] feature request 
In-Reply-To: <42088C86.9000404@wxs.nl>
References: <42088C86.9000404@wxs.nl>
Message-ID: <Pine.LNX.4.61.0502081852110.1557@hahepc1.hahe>

On Tue, 8 Feb 2005, Hans Hagen wrote:

> However, if we have
>
>   \pdfsetfontenc\somefont{blabla.enc}
>
> we can do with
>
> - one tfm files (the same but a different name)
> - one mapping lines (the original)
> - one pfb file
>
> I can even imagine that we have
>
>   \pdfsetfontfile\somefont{blabla.pfb}

or  \pdfsetfontfile\somefont{< blabla.pfb}?

>   \pdfsetfontname\somefont{FunnyFontName}

more...

\pdfsetfonttransform\somefont{0.9 ExtendFont 0.1 SlantFont}
\pdfsetfontflag\somefont{5}

All this only as long as the font is not yet in use, right?

Another maybe more simple way would be some font aliasing mechanism,
creating a "virtual" tfmname, e. g. \pdffonttfmalias{cmr10 hcmr10}
(while no hcmr10.tfm exists), and then you can create a normal map line
starting with hcmr10...

Regards, Hartmut
From pragma at wxs.nl  Tue Feb  8 19:04:11 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Feb  8 19:05:11 2005
Subject: [NTG-pdftex] Type3 fonts and the way to go
In-Reply-To: <E1CyWvt-0000e5-2Z@www9.emo.freenet-rz.de>
References: <E1CyWvt-0000e5-2Z@www9.emo.freenet-rz.de>
Message-ID: <4208FF1B.60103@wxs.nl>

andreas.lobinger@freenet.de wrote:
> Aloha,The Thanh Han posted:

....

actually, Thanh's example was straight from the pdf reference manual; it works 
ok in gsview but fails to show up in acrobat; adobe tmeselves use the funny 
small scale factors too, so i'm puzzled

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Feb  8 19:42:37 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Feb  8 19:42:42 2005
Subject: [NTG-pdftex] feature request
In-Reply-To: <Pine.LNX.4.61.0502081852110.1557@hahepc1.hahe>
References: <42088C86.9000404@wxs.nl>
	<Pine.LNX.4.61.0502081852110.1557@hahepc1.hahe>
Message-ID: <4209081D.7060202@wxs.nl>

Hartmut Henkel wrote:

> All this only as long as the font is not yet in use, right?

depends on what 'in use is', but i assume that it follows the same strategy as 
map lines, so 'as long as not yet frozen by usage' is ok -)

> Another maybe more simple way would be some font aliasing mechanism,
> creating a "virtual" tfmname, e. g. \pdffonttfmalias{cmr10 hcmr10}
> (while no hcmr10.tfm exists), and then you can create a normal map line
> starting with hcmr10...

i've been thinking about that, but the problem is that it will overload all 
usages of fonts since tex shares them, so

\font\a=cmr10 at 10pt \pdfsetfontenc\a{< one.enc}
\font\b=cmr10 at 10pt \pdfsetfontenc\b{< two.enc}

would indeed mean two different mapping for each instance; while an alias would 
apply the enc to both instances (sorry, bit fuzzy explanation)

btw, aliasing could be a nice feature for other reasons, think of:

$someenc=blabla.enc

$someenc-bla1 <bla1.pdf <$someenc
$someenc-bla2 <bla2.pdf <$someenc
$someenc-bla3 <bla3.pdf <$someenc


now, imagine:

\pdfmapline{$someenc=blabla.enc}
\pdfmapfile{somefile.map}
\pdfmapline{$someenc=whowhow.enc}
\pdfmapfile{somefile.map}

but then, it can be done with macros and pdfmapline already, so i decided not to 
ask for it -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Tue Feb  8 20:12:54 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue Feb  8 20:12:58 2005
Subject: [NTG-pdftex] feature request
In-Reply-To: <4209081D.7060202@wxs.nl>
References: <42088C86.9000404@wxs.nl>
	<Pine.LNX.4.61.0502081852110.1557@hahepc1.hahe>
	<4209081D.7060202@wxs.nl>
Message-ID: <Pine.LNX.4.61.0502081948590.2029@hahepc1.hahe>

On Tue, 8 Feb 2005, Hans Hagen wrote:

> Hartmut Henkel wrote:

> > Another maybe more simple way would be some font aliasing mechanism,
> > creating a "virtual" tfmname, e. g. \pdffonttfmalias{cmr10 hcmr10}
> > (while no hcmr10.tfm exists), and then you can create a normal map
> > line starting with hcmr10...
>
> i've been thinking about that, but the problem is that it will
> overload all usages of fonts since tex shares them, so
>
> \font\a=cmr10 at 10pt \pdfsetfontenc\a{< one.enc}
> \font\b=cmr10 at 10pt \pdfsetfontenc\b{< two.enc}

yes, but it could be implemented without sharing like:

\pdfmapline{+ cmr10 CMR10 <cmr10.pfb}
\pdfmapline{+ hcmr10 CMR10 <someenc.enc <cmr10.pfb} % no hcmr10.tfm
\pdffonttfmalias{cmr10 hcmr10} % line may come this late
\font\a=cmr10 at 10pt
\font\b=hcmr10 at 10pt
\b Hello!

> would indeed mean two different mapping for each instance; while an
> alias would apply the enc to both instances (sorry, bit fuzzy
> explanation)

i thought it would be just another independent tfmname, aliased to cmr10
only for tfm/vf read. TeX wouldn't notice at all (but i don't have any
preference what to implement/if time :-)

> btw, aliasing could be a nice feature for other reasons, think of:

> but then, it can be done with macros and pdfmapline already, so i
> decided not to ask for it -)

yes, only what can't be done by macros :-)

Regards, Hartmut
From pragma at wxs.nl  Tue Feb  8 20:39:31 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Tue Feb  8 20:39:35 2005
Subject: [NTG-pdftex] feature request
In-Reply-To: <Pine.LNX.4.61.0502081948590.2029@hahepc1.hahe>
References: <42088C86.9000404@wxs.nl>
	<Pine.LNX.4.61.0502081852110.1557@hahepc1.hahe>
	<4209081D.7060202@wxs.nl>
	<Pine.LNX.4.61.0502081948590.2029@hahepc1.hahe>
Message-ID: <42091573.5080409@wxs.nl>

Hartmut Henkel wrote:

> yes, but it could be implemented without sharing like:
> 
> \pdfmapline{+ cmr10 CMR10 <cmr10.pfb}
> \pdfmapline{+ hcmr10 CMR10 <someenc.enc <cmr10.pfb} % no hcmr10.tfm
> \pdffonttfmalias{cmr10 hcmr10} % line may come this late
> \font\a=cmr10 at 10pt
> \font\b=hcmr10 at 10pt
> \b Hello!

ok, that could work (and is a useful feature too) but in y case it would mean 
that i'd have to use different font definitions, so i'd gain nothing; actually i 
want to avoid new font definitions:

\def\SetFont#1{\font#1=cmr10 at 10pt}

\SetFont\a
\SetFont\b
\pdfsetenc\b{<whatever.enc}

you see, i don't want to chabge teh definition of \SetFont (which normally is a 
bit more compex that that since we're talking about font systems)

> i thought it would be just another independent tfmname, aliased to cmr10
> only for tfm/vf read. TeX wouldn't notice at all (but i don't have any
> preference what to implement/if time :-)

sure, but it should be a bit of a challenge for you -)

> yes, only what can't be done by macros :-)

indeed,

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From noreply at sarovar.org  Wed Feb  9 12:35:12 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed Feb  9 12:38:41 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-199 ] font expansion: characters may
	vanish
Message-ID: <E1Cyq7k-0003Ym-00@sarovar.org>

Bugs item #199, was opened at 2004-09-22 23:13
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106

Category: hz
Group: v1.20a
>Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Nobody (None)
Assigned to: The Thanh Han (hanthethanh)
Summary: font expansion: characters may vanish

Initial Comment:

For extremely large shrink values, characters may not
be visible in the pdf output (although the fonts seem
to be embedded), e.g. in the following file:

%----------------------------------------------
\hsize220pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand
\efcode\font`\s=500
\efcode\font`\e=500
\efcode\font`\y=500

see what you get\penalty-10000

\bye
%----------------------------------------------

or even worse:

%----------------------------------------------
\hsize180pt
\pdfadjustspacing=2
\font\testfont=cmr17 at 90pt\testfont
\pdffontexpand\font 0 1000 100 autoexpand

see what you get\penalty-10000

\bye
%----------------------------------------------

The font `cmr17-Extend_100' will not be visible.

I only managed to achieve this effect with extremely
large font sizes, which may or may not be related (it
could also be that I didn't find the `magic' \hsize).

If you force the characters to shrink even more, for
example by setting \hsize to 120pt in the latter test
file, the unexpanded font will be used, thus printing
the characters over each other.


Regards,
Robert  <w.m.l@gmx.net>

PS. I didn't bother to create expanded fonts, so I
cannot tell whether it depends on the autoexpand feature.


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-09 12:35

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.21a

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-01-31 13:08

Message:
Logged In: YES 
user_id=421

The state of the patch is indeed fuzzy; at least I did not
apply it, but some parts are in.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2005-01-31 02:59

Message:
Logged In: NO 

It seems as if Hartmut's patch hasn't been applied, as the
following test file will still produce incorrect output for
both pdftex 1.20b and 1.20c-beta:

%-------------------------------------------------
\pdfadjustspacing=2
\font\testfont=cmr10 \testfont
\pdffontexpand\font 0 1000 100 autoexpand
\hsize40pt

OK: text text text text\break

not OK: text text text text\break

\bye

%-------------------------------------------------

Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-12-22 15:53

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.20b

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2004-10-01 20:41

Message:
Logged In: YES 
user_id=929

tiny patch tries to solve this bug. See README and PDF test
file included.

Regards, Hartmut

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-10-01 17:17

Message:
Logged In: YES 
user_id=421

I you mean the effect in the attached pdf: This is either a
bug in Jaws (png attached) or a bug in pdftex. gs 8.30,
harlequin 5.3.4a and AR 5 all display the file distorted. :-(

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-29 00:06

Message:
Logged In: NO 

But the problem I mentioned above in the last paragraph
isn't related to Acrobat Reader, is it?
% ------------------------------------------
\hsize35pt
\pdfadjustspacing=2
\font\testfont=cmr12\testfont
\pdffontexpand\font 0 1000 100 autoexpand

text text text text\penalty-10000

\bye
% ------------------------------------------

Seems like a sanity check is missing somewhere. If my guess
is right, pdftex tries to use the font `cmr17-Extend_0',
which (incorrectly) translates into the base font. What it
should probably do is use the smallest available expanded
font, i.e. in this case Extend_100, and make the line overfull.

Regards,
Robert.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2004-09-27 17:27

Message:
Logged In: YES 
user_id=421

An Acrobat Reader bug. :-)

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2004-09-23 00:02

Message:
Logged In: NO 

Obviously, I filed this report too early. Sorry about that.

It is not a pdftex bug, but appears to be a bug in Acrobat
Reader 6. (Just to tell you what I saw:) At zoom level 200%
or larger, the font most shrunk (Extend_100) is not visible
on screen. That is, in the first example, I only see "See y
e", in the second, nothing at all. However, if I zoom out,
the characters re-appear. 

Sorry for not zooming out earlier. 

Regards,
Robert.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=199&group_id=106
From noreply at sarovar.org  Wed Feb  9 12:35:12 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed Feb  9 12:38:41 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-274 ] \unhbox kills protrusion
Message-ID: <E1Cyq7k-0003Yp-00@sarovar.org>

Bugs item #274, was opened at 2005-01-31 03:09
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106

Category: hz
Group: None
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: The Thanh Han (hanthethanh)
Summary: \unhbox kills protrusion

Initial Comment:
Protrusion will break when boxes containing protruded
characters are \unhbox'ed. I've stumbled upon this when
using edmac/ledmac, which decomposes each paragraph
into lines, then reassembling them.

I wasn't sure whether protrusion is supposed to survive
this treatment but it does if one uses \unhcopy instead
of \unhbox.

Here's a greatly reduced example:
%--------------------------------------------
\font\testfont=cmr10 \testfont
\pdfprotrudechars=2
\rpcode\font`\-=1000
\parindent0pt
\hsize=126pt

\newbox\testline
\newbox\testbox
%
\setbox\testbox\vbox{%
   Margin kerning is the adjustments
   of the characters at the
   margins of a typeset text.
}
\loop\ifvbox\testbox
   \setbox\testline=\vsplit\testbox to\baselineskip
   \unvbox\testline
   \setbox\testline=\lastbox
   \hbox to\hsize{\unhcopy\testline}% OK
   \hbox to\hsize{\unhbox\testline} % not OK
\repeat

\bye
% --------------------------------------------------


Regards,
Robert  <w.m.l[at]gmx.net>


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-09 12:35

Message:
Logged In: YES 
user_id=421

This has been fixed in 1.21a

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-31 23:34

Message:
Logged In: YES 
user_id=929

There seems to be one place in hz.ch where \unhbox and
\unhcopy are treated differently:

%@x [1100] - margin kerning
%while link(tail)<>null do tail:=link(tail);
%@y
%if c = copy_code then begin
%    while link(tail)<>null do tail:=link(tail);
%end
%else while link(tail) <> null do begin
%    r := link(tail);
%    if not is_char_node(r) and (type(r) = margin_kern_node)
then begin
%        link(tail) := link(r);
%        free_avail(margin_char(r));
%        free_node(r, margin_kern_node_size);
%    end;
%    tail:=link(tail);
%end;
%@z

After just commenting this piece out (as shown), both
\unhcopy and \unhbox do protrusion ok. Now i don't have the
slightest idea what this code is for, neither which side
effects would appear if it's removed...

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=274&group_id=106
From ms at artcom-gmbh.de  Wed Feb  9 15:11:27 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Wed Feb  9 15:11:29 2005
Subject: [NTG-pdftex] pdftex1.21a build, linker problem
In-Reply-To: <E1CyW34-0006j6-7q@www9.emo.freenet-rz.de>
References: <E1CyW34-0006j6-7q@www9.emo.freenet-rz.de>
Message-ID: <20050209141127.GA8732@blau.artcom-gmbh.de>

On 2005-02-08 15:09:02 +0100, andreas.lobinger@freenet.de wrote:
> i'm building pdftex on a sort-of standard sparc-sun-solaris2.8.
> I get a linker problem in building ctangleboot
> ...
> /bin/sh ../libtool --mode=link gcc -o ctangleboot   ctangleboot.o cwebboot.o
> lib/lib.a ../kpathsea/libkpathsea.la -lm 
> gcc -o ctangleboot ctangleboot.o cwebboot.o  lib/lib.a ../kpathsea/.libs/
> libkpathsea.a -lm
> ld: fatal: symbol `main' is multiply-defined:
>         (file ctangleboot.o and file lib/lib.a(main.o));
> ld: fatal: File processing errors. No output written to ctangleboot
> collect2: ld returned 1 exit status
> gmake: *** [ctangleboot] Error 1
> 
> It seems, that the build process is assuming a ld that quietly
> suppresses multiply defined objects.

Olaf?

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From pragma at wxs.nl  Wed Feb  9 15:31:17 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Feb  9 15:31:19 2005
Subject: [Fwd: Re: [NTG-pdftex] Type3 fonts and the way to go]
Message-ID: <420A1EB5.5030600@wxs.nl>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
An embedded message was scrubbed...
From: Hans Hagen <pragma@wxs.nl>
Subject: Re: [NTG-pdftex] Type3 fonts and the way to go
Date: Wed, 09 Feb 2005 13:50:17 +0100
Size: 3482
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050209/c2548d69/NTG-pdftexType3fontsandthewaytogo.mht
From pragma at wxs.nl  Wed Feb  9 15:31:31 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Wed Feb  9 15:31:34 2005
Subject: [Fwd: Re: [NTG-pdftex] Type3 fonts and the way to go]
Message-ID: <420A1EC3.2040806@wxs.nl>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------
-------------- next part --------------
An embedded message was scrubbed...
From: andreas.lobinger@freenet.de
Subject: Re: Re: [NTG-pdftex] Type3 fonts and the way to go
Date: Wed, 09 Feb 2005 13:32:37 +0100
Size: 37553
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20050209/a223c91a/NTG-pdftexType3fontsandthewaytogo-0001.mht
From olaf at infovore.xs4all.nl  Wed Feb  9 19:15:00 2005
From: olaf at infovore.xs4all.nl (Olaf Weber)
Date: Wed Feb  9 19:15:05 2005
Subject: [NTG-pdftex] pdftex1.21a build, linker problem
In-Reply-To: <20050209141127.GA8732@blau.artcom-gmbh.de> (Martin
	=?iso-8859-1?q?Schr=F6der's?= message of "Wed,
	9 Feb 2005 15:11:27 +0100")
References: <E1CyW34-0006j6-7q@www9.emo.freenet-rz.de>
	<20050209141127.GA8732@blau.artcom-gmbh.de>
Message-ID: <87hdklmwgr.fsf@infovore.xs4all.nl>

Martin Schr?der writes:
> On 2005-02-08 15:09:02 +0100, andreas.lobinger@freenet.de wrote:

>> i'm building pdftex on a sort-of standard sparc-sun-solaris2.8.
>> I get a linker problem in building ctangleboot
>> ...
>> /bin/sh ../libtool --mode=link gcc -o ctangleboot   ctangleboot.o cwebboot.o
>> lib/lib.a ../kpathsea/libkpathsea.la -lm 
>> gcc -o ctangleboot ctangleboot.o cwebboot.o  lib/lib.a ../kpathsea/.libs/
>> libkpathsea.a -lm
>> ld: fatal: symbol `main' is multiply-defined:
>> (file ctangleboot.o and file lib/lib.a(main.o));
>> ld: fatal: File processing errors. No output written to ctangleboot
>> collect2: ld returned 1 exit status
>> gmake: *** [ctangleboot] Error 1
>> 
>> It seems, that the build process is assuming a ld that quietly
>> suppresses multiply defined objects.

> Olaf?

That's likely true.  Not sure yet how I'm going to fix this...

-- 
Olaf Weber

               (This space left blank for technical reasons.)

From noreply at sarovar.org  Wed Feb  9 20:30:47 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Wed Feb  9 20:34:09 2005
Subject: [NTG-pdftex] [ pdftex-Patches-257 ] Experimental patch for pdftex
	character protrusion
Message-ID: <E1CyxXz-0007EM-00@sarovar.org>

Patches item #257, was opened at 2005-01-10 21:43
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106

Category: None
Group: Unstable (example)
>Status: Closed
Resolution: None
Priority: 3
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: Nobody (None)
Summary: Experimental patch for pdftex character protrusion

Initial Comment:
Normally items inside a \hbox are not considered for
protrusion. With this experimental patch also nested
\hboxes at the left and right margin are recursively
searched for items with \lpcode or \rpcode, and the
outmost containing boxes are protruded correspondingly.

This seems to be practical e. g. if an elevated
\footnote{foo} (LaTeX) index happens to be at the right
margin; in this case the footnote index normally is
placed too far inward the line. This disturbance was
detected by Peter Muthesius in an de.comp.text.tex news
thread "pdfcprot und Ziffern am rechten Rand" started
Sat Jan 08 14:05:23 CET 2005.

Rough experimental patch, rudimentarily tested with
left and right protrusion, see test file xx.tex with
output xx.pdf. Just for discussion.

No warranty. Have fun!

Regards, Hartmut


----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-02-09 20:30

Message:
Logged In: YES 
user_id=929

patch257h has been put into hz.ch for 1.21a
(pdftex, pdfetex, pdfxtex)

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-01-18 22:19

Message:
Logged In: YES 
user_id=929

Character protrusion patch news:

* The protrusion character can now be inside deeply nested
\hbox{}, with further (also nested) skipable \hbox{} stuff
in the way. The nested list will be recursively searched
until a non-skipable item (protrusion character, other
character, or list end) is found.

* Try to solve left protrusion at paragraph start with
\parindent=0pt,by selectively skipping over TeX's empty
\hbox{} there.

* Protrusion character search by 2 new functions
find_protchar_left() and find_protchar_right(), and simple
stack.

Regards, Hartmut


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=257&group_id=106
From te at dbs.uni-hannover.de  Sat Feb 12 18:13:00 2005
From: te at dbs.uni-hannover.de (Thomas Esser)
Date: Sat Feb 12 18:16:19 2005
Subject: [NTG-pdftex] pdftex1.21a build, linker problem
In-Reply-To: <87hdklmwgr.fsf@infovore.xs4all.nl>
References: <E1CyW34-0006j6-7q@www9.emo.freenet-rz.de>
	<20050209141127.GA8732@blau.artcom-gmbh.de>
	<87hdklmwgr.fsf@infovore.xs4all.nl>
Message-ID: <20050212171300.GA447@dbs.uni-hannover.de>

> >> It seems, that the build process is assuming a ld that quietly
> >> suppresses multiply defined objects.
> 
> That's likely true.  Not sure yet how I'm going to fix this...

Look at xdvik as it is included in teTeX-3.0. There, we have a check
whether multiple definitions are allowed. That could be used for adding
#ifdef's in the C files (protecting main()).

Thomas
From noreply at sarovar.org  Mon Feb 14 15:22:26 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Feb 14 15:25:51 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
Message-ID: <E1D0h7K-0005zA-00@sarovar.org>

Bugs item #292, was opened at 2005-02-14 15:22
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106

Category: hz
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
Summary: protuding leads to "This can't happen (paragraph)."

Initial Comment:
The input
---------------------
\pdfoutput=1
\input edmac
\input protcode

\font\eightrm=ptmr8t
\setprotcode\eightrm
\pdfprotrudechars=2

\linenummargin{outer} %% left|right|inner|outer
\footparagraph{A}

\tracingall\tracingonline=0
\beginnumbering

\pstart 
\text{There}\Afootnote{Habent sua fata libelli. (Der
Satz wurde auf
Wunsch der Redaktion von ?Living Marxism? gestrichen;
siehe Korsch an
P.~Mattick am 3.10.1938.)}/ is a striking contrast
between the
impression produced in the minds of West"=European
revolutionaries by
those short pamphlets of Lenin and Trotsky which
appeared in poorly
translated and poorly printed editions during the final
stage and the
aftermath of the war, and the response called forth in
Europe and
U.S.A. by the belated appearance, in 1927, of the first
extra"=Russian
versions of Lenin's philosophical work of 1908, on
?Materialism and
Empirio"=Criticism?.
\pend

\endnumbering

\bye
---------------------
(all input files are in the attached archive) leads to 
---------------------
! This can't happen (paragraph).
<recently read> \par 
                     
\do@feet ...s \else \Afootstart {A}\Afootgroup {A}
                                                  \fi
\ifvoid \Bfootins \els...

\pagecontents ...p \@cclv \unvbox \@cclv \do@feet 
                                                 
\ifr@ggedbottom \kern -\di...

\pagebody ...\boxmaxdepth \maxdepth \pagecontents 
                                                  }
\edmac@output ...e \vbox {\makeheadline \pagebody 
                                                 
\makefootline }\fi }\advan...
<output> {\edmac@output 
                        }
...
l.30 \bye
         
I'm broken. Please show this to someone who can fix can fix
---------------------

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106
From noreply at sarovar.org  Mon Feb 14 15:30:24 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Feb 14 15:33:52 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
Message-ID: <E1D0hF2-00068J-00@sarovar.org>

Bugs item #292, was opened at 2005-02-14 15:22
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106

Category: hz
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
>Summary: protuding leads to "This can't happen (paragraph)."

Initial Comment:
The input
---------------------
\pdfoutput=1
\input edmac
\input protcode

\font\eightrm=ptmr8t
\setprotcode\eightrm
\pdfprotrudechars=2

\linenummargin{outer} %% left|right|inner|outer
\footparagraph{A}

\tracingall\tracingonline=0
\beginnumbering

\pstart 
\text{There}\Afootnote{Habent sua fata libelli. (Der
Satz wurde auf
Wunsch der Redaktion von ?Living Marxism? gestrichen;
siehe Korsch an
P.~Mattick am 3.10.1938.)}/ is a striking contrast
between the
impression produced in the minds of West"=European
revolutionaries by
those short pamphlets of Lenin and Trotsky which
appeared in poorly
translated and poorly printed editions during the final
stage and the
aftermath of the war, and the response called forth in
Europe and
U.S.A. by the belated appearance, in 1927, of the first
extra"=Russian
versions of Lenin's philosophical work of 1908, on
?Materialism and
Empirio"=Criticism?.
\pend

\endnumbering

\bye
---------------------
(all input files are in the attached archive) leads to 
---------------------
! This can't happen (paragraph).
<recently read> \par 
                     
\do@feet ...s \else \Afootstart {A}\Afootgroup {A}
                                                  \fi
\ifvoid \Bfootins \els...

\pagecontents ...p \@cclv \unvbox \@cclv \do@feet 
                                                 
\ifr@ggedbottom \kern -\di...

\pagebody ...\boxmaxdepth \maxdepth \pagecontents 
                                                  }
\edmac@output ...e \vbox {\makeheadline \pagebody 
                                                 
\makefootline }\fi }\advan...
<output> {\edmac@output 
                        }
...
l.30 \bye
         
I'm broken. Please show this to someone who can fix can fix
---------------------

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-02-14 15:30

Message:
Logged In: YES 
user_id=421

The submitter used the attached edmac.doc; the error is the
same.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106
From noreply at sarovar.org  Mon Feb 14 20:42:11 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Feb 14 20:45:39 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
Message-ID: <E1D0m6l-0006LB-00@sarovar.org>

Bugs item #292, was opened at 2005-02-14 15:22
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106

Category: hz
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
>Summary: protuding leads to "This can't happen (paragraph)."

Initial Comment:
The input
---------------------
\pdfoutput=1
\input edmac
\input protcode

\font\eightrm=ptmr8t
\setprotcode\eightrm
\pdfprotrudechars=2

\linenummargin{outer} %% left|right|inner|outer
\footparagraph{A}

\tracingall\tracingonline=0
\beginnumbering

\pstart 
\text{There}\Afootnote{Habent sua fata libelli. (Der
Satz wurde auf
Wunsch der Redaktion von ?Living Marxism? gestrichen;
siehe Korsch an
P.~Mattick am 3.10.1938.)}/ is a striking contrast
between the
impression produced in the minds of West"=European
revolutionaries by
those short pamphlets of Lenin and Trotsky which
appeared in poorly
translated and poorly printed editions during the final
stage and the
aftermath of the war, and the response called forth in
Europe and
U.S.A. by the belated appearance, in 1927, of the first
extra"=Russian
versions of Lenin's philosophical work of 1908, on
?Materialism and
Empirio"=Criticism?.
\pend

\endnumbering

\bye
---------------------
(all input files are in the attached archive) leads to 
---------------------
! This can't happen (paragraph).
<recently read> \par 
                     
\do@feet ...s \else \Afootstart {A}\Afootgroup {A}
                                                  \fi
\ifvoid \Bfootins \els...

\pagecontents ...p \@cclv \unvbox \@cclv \do@feet 
                                                 
\ifr@ggedbottom \kern -\di...

\pagebody ...\boxmaxdepth \maxdepth \pagecontents 
                                                  }
\edmac@output ...e \vbox {\makeheadline \pagebody 
                                                 
\makefootline }\fi }\advan...
<output> {\edmac@output 
                        }
...
l.30 \bye
         
I'm broken. Please show this to someone who can fix can fix
---------------------

----------------------------------------------------------------------

>Comment By: Hartmut Henkel (hhenkel)
Date: 2005-02-14 20:42

Message:
Logged In: YES 
user_id=929

Now we know which side effects patch-274 has. When it's
reverted, the file is processed without error, but margin
kerning is missing (which was the original problem before
patch-274).

Following experiment is done _with_ patch-274.

The "this can't happen" error happens within the line_break
routine, which chokes on a margin_kern_node (which was
filtered out before patch-274).If one adds margin_kern_node
to the do_nothing list, like:

mark_node,ins_node,adjust_node,margin_kern_node: do_nothing;
othercases confusion("paragraph")

it apparently works ok, and margin kerning is fine also
(requires patch in hz.ch). But i need to understand how the
line_break routine works, whether a do_nothing is the right
thing to do...

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-14 15:30

Message:
Logged In: YES 
user_id=421

The submitter used the attached edmac.doc; the error is the
same.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106
From noreply at sarovar.org  Tue Feb 15 20:46:18 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Feb 15 20:50:04 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
Message-ID: <E1D18eI-0002Kp-00@sarovar.org>

Bugs item #292, was opened at 2005-02-14 15:22
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106

Category: hz
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
>Summary: protuding leads to "This can't happen (paragraph)."

Initial Comment:
The input
---------------------
\pdfoutput=1
\input edmac
\input protcode

\font\eightrm=ptmr8t
\setprotcode\eightrm
\pdfprotrudechars=2

\linenummargin{outer} %% left|right|inner|outer
\footparagraph{A}

\tracingall\tracingonline=0
\beginnumbering

\pstart 
\text{There}\Afootnote{Habent sua fata libelli. (Der
Satz wurde auf
Wunsch der Redaktion von ?Living Marxism? gestrichen;
siehe Korsch an
P.~Mattick am 3.10.1938.)}/ is a striking contrast
between the
impression produced in the minds of West"=European
revolutionaries by
those short pamphlets of Lenin and Trotsky which
appeared in poorly
translated and poorly printed editions during the final
stage and the
aftermath of the war, and the response called forth in
Europe and
U.S.A. by the belated appearance, in 1927, of the first
extra"=Russian
versions of Lenin's philosophical work of 1908, on
?Materialism and
Empirio"=Criticism?.
\pend

\endnumbering

\bye
---------------------
(all input files are in the attached archive) leads to 
---------------------
! This can't happen (paragraph).
<recently read> \par 
                     
\do@feet ...s \else \Afootstart {A}\Afootgroup {A}
                                                  \fi
\ifvoid \Bfootins \els...

\pagecontents ...p \@cclv \unvbox \@cclv \do@feet 
                                                 
\ifr@ggedbottom \kern -\di...

\pagebody ...\boxmaxdepth \maxdepth \pagecontents 
                                                  }
\edmac@output ...e \vbox {\makeheadline \pagebody 
                                                 
\makefootline }\fi }\advan...
<output> {\edmac@output 
                        }
...
l.30 \bye
         
I'm broken. Please show this to someone who can fix can fix
---------------------

----------------------------------------------------------------------

Comment By: Hartmut Henkel (hhenkel)
Date: 2005-02-14 20:42

Message:
Logged In: YES 
user_id=929

Now we know which side effects patch-274 has. When it's
reverted, the file is processed without error, but margin
kerning is missing (which was the original problem before
patch-274).

Following experiment is done _with_ patch-274.

The "this can't happen" error happens within the line_break
routine, which chokes on a margin_kern_node (which was
filtered out before patch-274).If one adds margin_kern_node
to the do_nothing list, like:

mark_node,ins_node,adjust_node,margin_kern_node: do_nothing;
othercases confusion("paragraph")

it apparently works ok, and margin kerning is fine also
(requires patch in hz.ch). But i need to understand how the
line_break routine works, whether a do_nothing is the right
thing to do...

Regards, Hartmut


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-14 15:30

Message:
Logged In: YES 
user_id=421

The submitter used the attached edmac.doc; the error is the
same.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=292&group_id=106
From noreply at sarovar.org  Tue Feb 15 21:06:41 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Tue Feb 15 21:10:03 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-294 ] pdfmovechars/encoding problem
Message-ID: <E1D18y1-0002t1-00@sarovar.org>

Bugs item #294, was opened at 2005-02-15 21:06
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106

Category: Fonts
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: Hartmut Henkel (hhenkel)
Assigned to: The Thanh Han (hanthethanh)
Summary: pdfmovechars/encoding problem

Initial Comment:
This has been reported by J?rg Heinrich at 1 Feb. 2005
on the pdftex list (Subject: [pdftex] pdfetex). The
following derived example leads to a segfault:

% this works:
%\pdfmovechars=1
% this gives segfault:
\pdfmovechars=2
% this works:
%\pdfmapline{phvr8r Helvetica <8r.enc <phvr8a.pfb}
% this gives segfault:
\pdfmapline{phvr8r Helvetica <phvr8a.pfb}
\font\phv phvr8r at 10pt
\phv
a
\bye


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106
From hanthethanh at myrealbox.com  Wed Feb 16 02:19:20 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Wed Feb 16 04:01:26 2005
Subject: [NTG-pdftex] Type3 fonts and the way to go
In-Reply-To: <E1CyWvt-0000e5-2Z@www9.emo.freenet-rz.de>
References: <E1CyWvt-0000e5-2Z@www9.emo.freenet-rz.de>
Message-ID: <20050216011920.GB1131@monty>

Hello & happy new year to the list^1,

many thanks to Andreas for spending time on the pdf I sent and pointing
out what I missed. I will spend some more time to play with it. It would
be very helpful if you could send me a pdf file with type3 fonts refering
to type1 fonts.

Thanh

1) yes here in Asia we have just celebrated the lunar new year
From hanthethanh at myrealbox.com  Thu Feb 17 02:20:56 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu Feb 17 02:49:05 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
In-Reply-To: <E1D0m6l-0006LB-00@sarovar.org>
References: <E1D0m6l-0006LB-00@sarovar.org>
Message-ID: <20050217012056.GC2897@monty>

Hi Hartmut,

this probably has to do with the issue whether to copy or not
margin_kern_node when unboxing a box we discussed a while ago. Perhaps
edmac typesets some text, unboxes it and typesets it again and in this
second phase the margin_kern_node ends up with error, as the only place
where margin_kern_node makes sense is in the post line-breaking phase.

I have no idea how to solve it yet. Ignoring margin_kern_node during
line-breaking seems to be the right thing to do, but I am afraid it's
not enough. Leaving margin_kern_node nodes pass unboxing means that they
can end up anywhere, hence we also need to handle them everywhere (which
is very fragile).

Regards,
Thanh


> ----------------------------------------------------------------------
> 
> >Comment By: Hartmut Henkel (hhenkel)
> Date: 2005-02-14 20:42
> 
> Message:
> Logged In: YES 
> user_id=929
> 
> Now we know which side effects patch-274 has. When it's
> reverted, the file is processed without error, but margin
> kerning is missing (which was the original problem before
> patch-274).
> 
> Following experiment is done _with_ patch-274.
> 
> The "this can't happen" error happens within the line_break
> routine, which chokes on a margin_kern_node (which was
> filtered out before patch-274).If one adds margin_kern_node
> to the do_nothing list, like:
> 
> mark_node,ins_node,adjust_node,margin_kern_node: do_nothing;
> othercases confusion("paragraph")
> 
> it apparently works ok, and margin kerning is fine also
> (requires patch in hz.ch). But i need to understand how the
> line_break routine works, whether a do_nothing is the right
> thing to do...
> 
> Regards, Hartmut
> 
> 
> ----------------------------------------------------------------------
From hanthethanh at myrealbox.com  Thu Feb 17 01:32:57 2005
From: hanthethanh at myrealbox.com (The Thanh Han)
Date: Thu Feb 17 02:49:11 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-294 ] pdfmovechars/encoding problem
In-Reply-To: <E1D18y1-0002t1-00@sarovar.org>
References: <E1D18y1-0002t1-00@sarovar.org>
Message-ID: <20050217003257.GA2897@monty>

Hi,

this issue needs revision as well. In the beginning there were requests
to move chars in range [0, 32) to higher slots if possible, so I
introduced \pdfmovechars. I don't use this feature myself, and it seems
that almost nobody else does, thus the bug slipped out without being
noticed for quite a long time.

Now to summarize the issue:

when possible, move all chars in range [0, 32) to higher slots. The
question is, what ``when possible'' means?

When a tfm has only 128 chars as cm font, it's simple: move chars in
range [0, 32) to [160, 192).

When a tfm has 256 chars with some free slots (assigned to .notdef
glygh), move chars in [0, 32) to these slots. But the number of free
slots maybe less than 32, then what we should do?

Before fixing this bug, I would like to discuss whether it makes sense
to support this feature at all. It seems that when an encoding has more
than 128 assigned chars, then usually the number of free slots is less
than 32. Hence I suggest 2 solutions:

1) completely remove this feature; or

2) only consider fonts with 128 chars.

Thanh



On Wed, Feb 16, 2005 at 01:36:41AM +0530, noreply@sarovar.org wrote:
> Bugs item #294, was opened at 2005-02-15 21:06
> You can respond by visiting: 
> http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106
> 
> Category: Fonts
> Group: v1.21a
> Status: Open
> Resolution: None
> Priority: 5
> Submitted By: Hartmut Henkel (hhenkel)
> Assigned to: The Thanh Han (hanthethanh)
> Summary: pdfmovechars/encoding problem
> 
> Initial Comment:
> This has been reported by J?rg Heinrich at 1 Feb. 2005
> on the pdftex list (Subject: [pdftex] pdfetex). The
> following derived example leads to a segfault:
> 
> % this works:
> %\pdfmovechars=1
> % this gives segfault:
> \pdfmovechars=2
> % this works:
> %\pdfmapline{phvr8r Helvetica <8r.enc <phvr8a.pfb}
> % this gives segfault:
> \pdfmapline{phvr8r Helvetica <phvr8a.pfb}
> \font\phv phvr8r at 10pt
> \phv
> a
> \bye
> 
> 
> ----------------------------------------------------------------------
> 
> You can respond by visiting: 
> http://sarovar.org/tracker/?func=detail&atid=493&aid=294&group_id=106
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex
> 
From hartmut_henkel at gmx.de  Thu Feb 17 23:29:09 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu Feb 17 23:29:13 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
In-Reply-To: <20050217012056.GC2897@monty>
References: <E1D0m6l-0006LB-00@sarovar.org> <20050217012056.GC2897@monty>
Message-ID: <Pine.LNX.4.61.0502172307230.17543@hahepc1.hahe>

On Thu, 17 Feb 2005, The Thanh Han wrote:

> this probably has to do with the issue whether to copy or not
> margin_kern_node when unboxing a box we discussed a while ago.

Yes, seems so. Meanwhile i have temporarily reverted the status to
_before_ patch-274, and then it shows here that even this example

\font\testfont=cmr10 \testfont
\pdfprotrudechars=2
\rpcode\font`\-=1000
\parindent0pt
\hsize=126pt
\newbox\testline
\newbox\testbox
\setbox\testbox\vbox{Margin kerning is the adjustments $\dots$}
\setbox\testline=\vsplit\testbox to\baselineskip
\unvbox\testline
\setbox\testline=\lastbox
\unhcopy\testline
\bye

gives an error: "! This can't happen (paragraph)" (wondering why this
case wasn't detected before). So if one goes the way of removing
margin_kern_node, it needs to be done _both_ for \unhbox and \unhcopy
cases.

> I have no idea how to solve it yet. Ignoring margin_kern_node during
> line-breaking seems to be the right thing to do, but I am afraid it's
> not enough. Leaving margin_kern_node nodes pass unboxing means that
> they can end up anywhere, hence we also need to handle them everywhere
> (which is very fragile).

It looks like after patch-292 one actually would be rather safe against
"confusion" cases since it seems that \hboxes anyway can't be unhboxed
or unhcopied into a vlist or into a math list; this is caught early by
TeX. I couldn't yet find a case, where after patch-292 it would still
give such an error.

But patch-292 introduces typographic problems, weird breaks, and letters
are running into each other, see the catastrophies in the following test
file (which should run through smoothly after patch-292):

\font\testfont=cmr10 \testfont
\pdfprotrudechars=2
\rpcode\font`\-=1000
\parindent0pt
\hsize=126pt

\newbox\testline
\newbox\testbox
%
\setbox\testbox\vbox{Margin kerning is the adjustments $\dots$}

\beginsection --- 1 ---

\hrule
\copy\testbox
\hrule

\beginsection --- 2 ---

\hrule
\setbox\testline=\vsplit\testbox to\baselineskip
\unvbox\testline
\setbox\testline=\lastbox
\line{\unhcopy\testline}
ABC \unhcopy\testline XYZ\break
\bye
\unhcopy\testline\break
\unhcopy\testline XYZ
\hrule

\beginsection --- 3 ---

\rlap{\vbox{
  \halign{#\unskip\hfil\cr
  A\cr
  \unhcopy\testline X\cr
  \noalign{\hrule}
  B\cr}}}

\beginsection --- 4 ---

\rlap{\vbox{
  \halign{#\unskip\hfil\cr
  A\cr
  Margin kerning is the adjust-\cr
  Margin kerning is the adjust-C\cr
  \noalign{\hrule}
  B\cr}}}

\bye

And sorting these cases out so that they are right (after one knows what
"right" should be) doesn't look straightforward to me.

Regards, Hartmut
From hartmut_henkel at gmx.de  Thu Feb 17 23:46:18 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu Feb 17 23:46:22 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
In-Reply-To: <Pine.LNX.4.61.0502172307230.17543@hahepc1.hahe>
References: <E1D0m6l-0006LB-00@sarovar.org> <20050217012056.GC2897@monty>
	<Pine.LNX.4.61.0502172307230.17543@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0502172345350.22593@hahepc1.hahe>

On Thu, 17 Feb 2005, Hartmut Henkel wrote:

> ABC \unhcopy\testline XYZ\break
> \bye
> \unhcopy\testline\break

Ooops, remove this \bye.

Regards, Hartmut
From pragma at wxs.nl  Fri Feb 18 10:15:28 2005
From: pragma at wxs.nl (Hans Hagen)
Date: Fri Feb 18 10:15:32 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-292 ] protuding leads to "This can't
	happen (paragraph)."
In-Reply-To: <Pine.LNX.4.61.0502172307230.17543@hahepc1.hahe>
References: <E1D0m6l-0006LB-00@sarovar.org> <20050217012056.GC2897@monty>
	<Pine.LNX.4.61.0502172307230.17543@hahepc1.hahe>
Message-ID: <4215B230.8080608@wxs.nl>

Hartmut Henkel wrote:
> On Thu, 17 Feb 2005, The Thanh Han wrote:
> 
> 
>>this probably has to do with the issue whether to copy or not
>>margin_kern_node when unboxing a box we discussed a while ago.
> 
> 
> Yes, seems so. Meanwhile i have temporarily reverted the status to
> _before_ patch-274, and then it shows here that even this example
> 
> \font\testfont=cmr10 \testfont
> \pdfprotrudechars=2
> \rpcode\font`\-=1000
> \parindent0pt
> \hsize=126pt
> \newbox\testline
> \newbox\testbox
> \setbox\testbox\vbox{Margin kerning is the adjustments $\dots$}
> \setbox\testline=\vsplit\testbox to\baselineskip
> \unvbox\testline
> \setbox\testline=\lastbox
> \unhcopy\testline
> \bye
> 
> gives an error: "! This can't happen (paragraph)" (wondering why this
> case wasn't detected before). So if one goes the way of removing
> margin_kern_node, it needs to be done _both_ for \unhbox and \unhcopy
> cases.

i wonder where it originates,

.\kern-10.00002 (right margin)      % prelast node in box
.\glue(\rightskip) 0.0              % last node in box

the prelast node is only present when protruding; so i suppose that it is the 
protruding specific node? also,

\hbox(6.94444+1.94444)x126.0, glue set 1.20831

the glue set is positive here (negative in non prot case)

so, is this kern the troublemaker? Also,

fails    : \unhcopy\testline
succeeds : \unhbox \testline

so, maybe the bug is in the copying routine


Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Mon Feb 21 02:29:24 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon Feb 21 02:29:30 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
Message-ID: <16921.14708.841165.130511@zarniwoop.ms25.local>

Hi,
I'm wondering whether pdftex complains if I set the variable
\pdfoptionpdfminorversion to a very low value and use PDF features
which had been introduced in more recent versions of Acrobat.

Does pdftex complain in this case?

There is a problem with the manual, the file pdftex-a.pdf contains the
line "%PDF-1.5" which requires AR6 which is not available for Linux.

I doubt that this is necessary here because it doesn't make use of the
latest features.  So "%PDF-1.4" would be better.

Maybe even a lower value could be used.

Because many people work on the manual, it makes sense to set
\pdfoptionpdfminorversion explicitely in the file.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From ms at artcom-gmbh.de  Mon Feb 21 14:44:34 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Feb 21 14:44:37 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <16921.14708.841165.130511@zarniwoop.ms25.local>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
Message-ID: <20050221134434.GT19810@blau.artcom-gmbh.de>

On 2005-02-21 02:29:24 +0100, Reinhard Kotucha wrote:
> I'm wondering whether pdftex complains if I set the variable
> \pdfoptionpdfminorversion to a very low value and use PDF features
> which had been introduced in more recent versions of Acrobat.
> 
> Does pdftex complain in this case?

No. It's only checked against the version of included pdfs.

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From ms at artcom-gmbh.de  Mon Feb 21 14:45:24 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Mon Feb 21 14:45:27 2005
Subject: [NTG-pdftex] gmail
Message-ID: <20050221134524.GU19810@blau.artcom-gmbh.de>

If anybody wants a gmail account: I've got 49 invitations left. :-)

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From oberdiek at uni-freiburg.de  Mon Feb 21 15:09:17 2005
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Mon Feb 21 15:09:26 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <16921.14708.841165.130511@zarniwoop.ms25.local>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
Message-ID: <20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>

On Mon, Feb 21, 2005 at 02:29:24AM +0100, Reinhard Kotucha wrote:

> Hi,
> I'm wondering whether pdftex complains if I set the variable
> \pdfoptionpdfminorversion to a very low value and use PDF features
> which had been introduced in more recent versions of Acrobat.
> 
> Does pdftex complain in this case?

User code (in dictionaries, streams, ...) is not interpreted
by pdfTeX and is not checked against the different PDF
specifications. Thus the user have to take care. Or
\pdfoptionpdfminorversion should be set to low values
by experts only.

But perhaps at least code by pdfTeX itself could be checked.
Consider this example:

\pdfoptionpdfminorversion=0
\pdfdest name {foobar} Fit
\null
\nopagenumbers
\bye

Now the pdf file contains a named destination using a string
This is a feature of PDF 1.2. The pdf file, however,
is marked as "%PDF-1.0".

This could be solved by an internal variable that records the
maximum version of used PDF features. Then conflicts with
\pdfoptionpdfminorversion can be detected and an error or
warning can be raised.
  Also this can be extended by a new primitive, thus that
packages such as hyperref also can mark its code with
its maximum version number of used PDF features.

Yours sincerely
  Heiko <oberdiek@uni-freiburg.de>
-- 
From hartmut_henkel at gmx.de  Mon Feb 21 20:14:14 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Feb 21 20:14:17 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
Message-ID: <Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>

On Mon, 21 Feb 2005, Heiko Oberdiek wrote:

> This could be solved by an internal variable that records the maximum
> version of used PDF features. Then conflicts with
> \pdfoptionpdfminorversion can be detected and an error or warning can
> be raised.

Or pdftex could track the maximum of minor version and write this value
at the _end_ of the pdftex run (currently it's written at the start, and
frozen). There is already a procedure for setting the /Length counts,
which can be mis-used, e. g. i have just tried this:

    @<Output the trailer@>;
    pdf_flush;
    write_stream_length(2,7); {experiment: set the minor version number to 2}
    print_nl("Output written on "); slow_print(output_file_name);

Then one could make a fast macro which updates the minor version at any
functionality requiring at least a certain value, about:

@d require_minor_version(#) == if minorversion < # then minorversion := #

And also the \pdfoptionpdfminorversion would just use the same macro
after clipping to max. 9. By this one could never force a minor version
value that is too low.

OTOH it's then difficult to forcibly keep pdftex at a wanted low version
number.

> Also this can be extended by a new primitive, thus that packages such
> as hyperref also can mark its code with its maximum version number of
> used PDF features.

Regards, Hartmut
From reinhard.kotucha at web.de  Wed Feb 23 23:00:07 2005
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed Feb 23 23:00:13 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
Message-ID: <16924.64743.659481.316337@zarniwoop.ms25.local>

>>>>> "Hartmut" == Hartmut Henkel <hartmut_henkel@gmx.de> writes:

  > On Mon, 21 Feb 2005, Heiko Oberdiek wrote:
  >> This could be solved by an internal variable that records the
  >> maximum version of used PDF features. Then conflicts with
  >> \pdfoptionpdfminorversion can be detected and an error or warning
  >> can be raised.

  > Or pdftex could track the maximum of minor version and write this
  > value at the _end_ of the pdftex run (currently it's [...]

If you really want to change the pdftex sources, keep in mind that
Adobe certainly will change the *major* number in the near future.

Maybe it's better to keep the whole version number within one
variable, so that if Adobe changes the major number, not everything
has to be changed again.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha@web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From ms at artcom-gmbh.de  Thu Feb 24 00:25:12 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Feb 24 01:02:23 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <16924.64743.659481.316337@zarniwoop.ms25.local>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
	<16924.64743.659481.316337@zarniwoop.ms25.local>
Message-ID: <20050223232512.GA14787@lucien.kn-bremen.de>

On 2005-02-23 23:00:07 +0100, Reinhard Kotucha wrote:
> If you really want to change the pdftex sources, keep in mind that
> Adobe certainly will change the *major* number in the near future.

Nope. Changing the major number means everything can be
incompatible; e.g. PDF 2.0 could use XML instead of XREF+objects.
That would break everything, which even Adobe can't do.

Best regards
    Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Thu Feb 24 06:15:25 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Feb 24 06:18:58 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-300 ] "page is rotated 90 degrees" for
	no reason
Message-ID: <E1D4BLR-00074J-00@sarovar.org>

Bugs item #300, was opened at 2005-02-24 00:15
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106

Category: PDF inclusion
Group: v1.21a
Status: Open
Resolution: None
Priority: 5
Submitted By: John Denker (jsd)
Assigned to: Martin Schr?der (oneiros)
Summary: "page is rotated 90 degrees" for no reason

Initial Comment:
Hi --

I have a good-sized document that uses
\includegraphics{} to include about 250 images, each of
which was prepared in the same way, converting a .eps
file to a .pdf file using epstopdf.  Of these, 65 of
them end up rotated 90 degrees for no reason.  The .log
file mentions the fact, saying 
	page is rotated 90 degrees
and a glance at the output document confirms this.

What is happening?  Why is it happening?  Why is it not
documented?  How do I make it stop happening?

I have looked at the source to pdflatex without finding 
anything that fiddles with the "rotate" angle.  I have 
done experiments including changing the \textwidth
without finding anything that has any effect.  I have
no clue why some images are rotated and some are not; 
it is not a function of image-width or anything simple
like that.

Putting an explicit [angle=0] directive on the
\includegraphics has no effect.

I have scrutinized the image files using "identify
-verbose" and "pdfinfo" without finding anything that
would explain the observed behavior.

I have searched the archives of the mailing-list as
best I could using the modest search facilities
available.  I have skimmed the open and closed bugs on
the bug-reporting system.

I downloaded the latest tetex-texmf distro from ctan to
make sure the problem exists in that version.  The
problem is 100% reproducible.  Version info from the
head of the .log file is:

This is pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C
7.5.4) (format=pdflatex 2005.2.23)  23 FEB 2005 23:32
entering extended mode
**how.tex
(./how.tex
LaTeX2e <2003/12/01>
Babel <v3.8d> ....


If you need the next level of detail, I will have to 
cobble up a document that demonstrates the problem.  
(I don't think you want to look at the multi-megabyte 
example I already have, and it's proprietary anyway.)
But for the moment I'm hoping somebody will instantly 
recognize the problem and know the solution, saving
me the trouble of cobbling up a demo document.

Please let me know what info you need.



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106
From pragma at wxs.nl  Thu Feb 24 10:53:38 2005
From: pragma at wxs.nl (h h extern)
Date: Thu Feb 24 10:53:46 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <20050223232512.GA14787@lucien.kn-bremen.de>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
	<16924.64743.659481.316337@zarniwoop.ms25.local>
	<20050223232512.GA14787@lucien.kn-bremen.de>
Message-ID: <421DA422.3010009@wxs.nl>

Martin Schr?der wrote:
> On 2005-02-23 23:00:07 +0100, Reinhard Kotucha wrote:
> 
>>If you really want to change the pdftex sources, keep in mind that
>>Adobe certainly will change the *major* number in the near future.
> 
> 
> Nope. Changing the major number means everything can be
> incompatible; e.g. PDF 2.0 could use XML instead of XREF+objects.
> That would break everything, which even Adobe can't do.

i suppose they will do the same as with PS, level 3 is still downward 
compatible, so major is not so much breaking things but more indicating some 
real big change (whatever that may be)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From noreply at sarovar.org  Thu Feb 24 11:11:02 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Feb 24 11:14:32 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-300 ] "page is rotated 90 degrees" for
	no reason
Message-ID: <E1D4FxW-0006qU-00@sarovar.org>

Bugs item #300, was opened at 2005-02-24 06:15
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106

Category: PDF inclusion
Group: v1.21a
>Status: Closed
>Resolution: Invalid
Priority: 5
Submitted By: John Denker (jsd)
Assigned to: Martin Schr?der (oneiros)
>Summary: "page is rotated 90 degrees" for no reason

Initial Comment:
Hi --

I have a good-sized document that uses
\includegraphics{} to include about 250 images, each of
which was prepared in the same way, converting a .eps
file to a .pdf file using epstopdf.  Of these, 65 of
them end up rotated 90 degrees for no reason.  The .log
file mentions the fact, saying 
	page is rotated 90 degrees
and a glance at the output document confirms this.

What is happening?  Why is it happening?  Why is it not
documented?  How do I make it stop happening?

I have looked at the source to pdflatex without finding 
anything that fiddles with the "rotate" angle.  I have 
done experiments including changing the \textwidth
without finding anything that has any effect.  I have
no clue why some images are rotated and some are not; 
it is not a function of image-width or anything simple
like that.

Putting an explicit [angle=0] directive on the
\includegraphics has no effect.

I have scrutinized the image files using "identify
-verbose" and "pdfinfo" without finding anything that
would explain the observed behavior.

I have searched the archives of the mailing-list as
best I could using the modest search facilities
available.  I have skimmed the open and closed bugs on
the bug-reporting system.

I downloaded the latest tetex-texmf distro from ctan to
make sure the problem exists in that version.  The
problem is 100% reproducible.  Version info from the
head of the .log file is:

This is pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C
7.5.4) (format=pdflatex 2005.2.23)  23 FEB 2005 23:32
entering extended mode
**how.tex
(./how.tex
LaTeX2e <2003/12/01>
Babel <v3.8d> ....


If you need the next level of detail, I will have to 
cobble up a document that demonstrates the problem.  
(I don't think you want to look at the multi-megabyte 
example I already have, and it's proprietary anyway.)
But for the moment I'm hoping somebody will instantly 
recognize the problem and know the solution, saving
me the trouble of cobbling up a demo document.

Please let me know what info you need.



----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2005-02-24 11:11

Message:
Logged In: YES 
user_id=421

This is not a bug in pdftex, but a (mis)feature of
ghostscript (which follows a (mis)feature of Adobe
Distiller): Both distillers try to find pages that really
should be landscape but are portrait and then set the
/Rotate attribute of the page, which pdftex honours.

This behaviour of gs can be configured: The parameter is
AutoRotatePages; more information is at
http://www.cs.wisc.edu/~ghost/doc/cvs/Ps2pdf.htm
Try with ps2pdf -dPDFSETTINGS=printer

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106
From ms at artcom-gmbh.de  Thu Feb 24 11:52:50 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Feb 24 11:52:54 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <421DA422.3010009@wxs.nl>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
	<16924.64743.659481.316337@zarniwoop.ms25.local>
	<20050223232512.GA14787@lucien.kn-bremen.de>
	<421DA422.3010009@wxs.nl>
Message-ID: <20050224105250.GM5389@blau.artcom-gmbh.de>

On 2005-02-24 10:53:38 +0100, Hans Hagen wrote:
> i suppose they will do the same as with PS, level 3 is still downward 
> compatible, so major is not so much breaking things but more indicating 
> some real big change (whatever that may be)

The spec says this in H.1:

"Adobe increments the major version number when the PDF
specification changes in such a way that existing viewer
applications are unlikely to read a document without serious
errors that prevent pages from being viewed."

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From pragma at wxs.nl  Thu Feb 24 12:35:25 2005
From: pragma at wxs.nl (h h extern)
Date: Thu Feb 24 12:35:33 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <20050224105250.GM5389@blau.artcom-gmbh.de>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
	<16924.64743.659481.316337@zarniwoop.ms25.local>
	<20050223232512.GA14787@lucien.kn-bremen.de>
	<421DA422.3010009@wxs.nl>
	<20050224105250.GM5389@blau.artcom-gmbh.de>
Message-ID: <421DBBFD.1040005@wxs.nl>

Martin Schr?der wrote:
> On 2005-02-24 10:53:38 +0100, Hans Hagen wrote:
> 
>>i suppose they will do the same as with PS, level 3 is still downward 
>>compatible, so major is not so much breaking things but more indicating 
>>some real big change (whatever that may be)
> 
> 
> The spec says this in H.1:
> 
> "Adobe increments the major version number when the PDF
> specification changes in such a way that existing viewer
> applications are unlikely to read a document without serious
> errors that prevent pages from being viewed."

sure, but the reader will read older versions;

i wonder, what criterium do we use for incrementing a pdf major number

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ms at artcom-gmbh.de  Thu Feb 24 12:47:50 2005
From: ms at artcom-gmbh.de (Martin =?iso-8859-1?Q?Schr=F6der?=)
Date: Thu Feb 24 12:47:54 2005
Subject: [NTG-pdftex] \pdfoptionpdfminorversion
In-Reply-To: <421DBBFD.1040005@wxs.nl>
References: <16921.14708.841165.130511@zarniwoop.ms25.local>
	<20050221140916.GA2732@m0A023245.vpn.uni-freiburg.de>
	<Pine.LNX.4.61.0502211950020.19857@hahepc1.hahe>
	<16924.64743.659481.316337@zarniwoop.ms25.local>
	<20050223232512.GA14787@lucien.kn-bremen.de>
	<421DA422.3010009@wxs.nl>
	<20050224105250.GM5389@blau.artcom-gmbh.de>
	<421DBBFD.1040005@wxs.nl>
Message-ID: <20050224114750.GN5389@blau.artcom-gmbh.de>

On 2005-02-24 12:35:25 +0100, Hans Hagen wrote:
> i wonder, what criterium do we use for incrementing a pdf major number

ITIYM pdftexs version? :-)

MAJOR feature enhancements.

Best regards
        Martin
-- 
               Martin Schr?der, ms@artcom-gmbh.de
     ArtCom GmbH, Lise-Meitner-Str 5, 28359 Bremen, Germany
          Voice +49 421 20419-44 / Fax +49 421 20419-10
                    http://www.artcom-gmbh.de
From noreply at sarovar.org  Thu Feb 24 14:58:28 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Thu Feb 24 15:01:58 2005
Subject: [NTG-pdftex] [ pdftex-Bugs-300 ] "page is rotated 90 degrees" for
	no reason
Message-ID: <E1D4JVc-0004MP-00@sarovar.org>

Bugs item #300, was opened at 2005-02-24 00:15
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106

Category: PDF inclusion
Group: v1.21a
Status: Closed
Resolution: Invalid
Priority: 5
Submitted By: John Denker (jsd)
Assigned to: Martin Schr?der (oneiros)
>Summary: "page is rotated 90 degrees" for no reason

Initial Comment:
Hi --

I have a good-sized document that uses
\includegraphics{} to include about 250 images, each of
which was prepared in the same way, converting a .eps
file to a .pdf file using epstopdf.  Of these, 65 of
them end up rotated 90 degrees for no reason.  The .log
file mentions the fact, saying 
	page is rotated 90 degrees
and a glance at the output document confirms this.

What is happening?  Why is it happening?  Why is it not
documented?  How do I make it stop happening?

I have looked at the source to pdflatex without finding 
anything that fiddles with the "rotate" angle.  I have 
done experiments including changing the \textwidth
without finding anything that has any effect.  I have
no clue why some images are rotated and some are not; 
it is not a function of image-width or anything simple
like that.

Putting an explicit [angle=0] directive on the
\includegraphics has no effect.

I have scrutinized the image files using "identify
-verbose" and "pdfinfo" without finding anything that
would explain the observed behavior.

I have searched the archives of the mailing-list as
best I could using the modest search facilities
available.  I have skimmed the open and closed bugs on
the bug-reporting system.

I downloaded the latest tetex-texmf distro from ctan to
make sure the problem exists in that version.  The
problem is 100% reproducible.  Version info from the
head of the .log file is:

This is pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C
7.5.4) (format=pdflatex 2005.2.23)  23 FEB 2005 23:32
entering extended mode
**how.tex
(./how.tex
LaTeX2e <2003/12/01>
Babel <v3.8d> ....


If you need the next level of detail, I will have to 
cobble up a document that demonstrates the problem.  
(I don't think you want to look at the multi-megabyte 
example I already have, and it's proprietary anyway.)
But for the moment I'm hoping somebody will instantly 
recognize the problem and know the solution, saving
me the trouble of cobbling up a demo document.

Please let me know what info you need.



----------------------------------------------------------------------

>Comment By: John Denker (jsd)
Date: 2005-02-24 08:58

Message:
Logged In: YES 
user_id=2267

Thanks!  The response to my report was very helpful.
One slight correction:  the solution is not
   -dPDFSETTINGS=printer
but rather
   -dAutoRotatePages=/None


----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2005-02-24 05:11

Message:
Logged In: YES 
user_id=421

This is not a bug in pdftex, but a (mis)feature of
ghostscript (which follows a (mis)feature of Adobe
Distiller): Both distillers try to find pages that really
should be landscape but are portrait and then set the
/Rotate attribute of the page, which pdftex honours.

This behaviour of gs can be configured: The parameter is
AutoRotatePages; more information is at
http://www.cs.wisc.edu/~ghost/doc/cvs/Ps2pdf.htm
Try with ps2pdf -dPDFSETTINGS=printer

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=300&group_id=106
From taco at aanhet.net  Sun Feb 27 12:09:06 2005
From: taco at aanhet.net (Taco Hoekwater)
Date: Sun Feb 27 12:09:39 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <38dihaF5o9va9U1@individual.net>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>
	<38dihaF5o9va9U1@individual.net>
Message-ID: <4221AA52.4070302@aanhet.net>


Hartmut,

I saw this on c.t.t. Shall I attempt a merge of yours and my patches?

Taco

Hartmut Henkel wrote:
> <remolinero@hotmail.com> wrote:
> 
> 
>>I need to put a lot of PNG pictures in a tex document. But including
>>PNGs makes pdfLaTeX to hang a few seconds after including each PNG.
>>This doen't happens with other file types as JPG, PDF, etc.
>>
>>Is there a way to ommit this delay? Without converting all PNGs to
>>other format?
> 
> 
> If you compile from source, maybe check
> 
> http://www.circuitwizard.de/pdftex/patch5
> 
> which should read much faster, if the PNG files are of the right type. The
> problem with this rough patch is that it's now getting obsolete as it
> doesn't (yet) support new transparency features to come.
> 
> Regards, Hartmut
From hartmut_henkel at gmx.de  Sun Feb 27 17:09:13 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun Feb 27 17:09:17 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <4221AA52.4070302@aanhet.net>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>
	<38dihaF5o9va9U1@individual.net> <4221AA52.4070302@aanhet.net>
Message-ID: <Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>

Hi Taco,

On Sun, 27 Feb 2005, Taco Hoekwater wrote:

> I saw this on c.t.t. Shall I attempt a merge of yours and my patches?

oh yes, that would be very nice! The reason why i hesitated with this
patch is that it's not clear to me whether the libpng internally does
any color transforms or other RGB number tweaking during decompression,
maybe driven by some special PNG chunks in the image file. The fast
reading patch would ignore these chunks. But until now i couldn't verify
that libpng would do such calculations at all. Likely not; then the
patch would be safe.

Regards, Hartmut


> Hartmut Henkel wrote:
> > <remolinero@hotmail.com> wrote:
> >
> > > I need to put a lot of PNG pictures in a tex document. But
> > > including PNGs makes pdfLaTeX to hang a few seconds after
> > > including each PNG. This doen't happens with other file types as
> > > JPG, PDF, etc.
> > >
> > > Is there a way to ommit this delay? Without converting all PNGs to
> > > other format?
> >
> > If you compile from source, maybe check
> >
> > http://www.circuitwizard.de/pdftex/patch5
> >
> > which should read much faster, if the PNG files are of the right
> > type. The problem with this rough patch is that it's now getting
> > obsolete as it doesn't (yet) support new transparency features to
> > come.
From noreply at sarovar.org  Mon Feb 28 16:38:09 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Feb 28 16:41:43 2005
Subject: [NTG-pdftex] [ pdftex-Patches-259 ] Expanded png inclusion support
Message-ID: <E1D5myH-0004Aw-00@sarovar.org>

Patches item #259, was opened at 2005-01-11 16:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: Expanded png inclusion support

Initial Comment:
The attached zip file contains a change file for all
pdftex's (to be applied *after* hz.cg) and a completely
new writepng.c



----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2005-02-28 16:38

Message:
Logged In: YES 
user_id=1608

This new version incorporates the code from Hartmut's speed 
patch.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106
From noreply at sarovar.org  Mon Feb 28 17:27:06 2005
From: noreply at sarovar.org (noreply@sarovar.org)
Date: Mon Feb 28 17:30:36 2005
Subject: [NTG-pdftex] [ pdftex-Patches-259 ] Expanded png inclusion support
Message-ID: <E1D5nje-0005BA-00@sarovar.org>

Patches item #259, was opened at 2005-01-11 16:44
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Taco Hoekwater (taco)
Assigned to: Nobody (None)
Summary: Expanded png inclusion support

Initial Comment:
The attached zip file contains a change file for all
pdftex's (to be applied *after* hz.cg) and a completely
new writepng.c



----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2005-02-28 17:27

Message:
Logged In: YES 
user_id=1608

Sorry, I forgot the 16-bit color code in the previous version

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2005-02-28 16:38

Message:
Logged In: YES 
user_id=1608

This new version incorporates the code from Hartmut's speed 
patch.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=495&aid=259&group_id=106
From taco at elvenkind.com  Mon Feb 28 17:33:08 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon Feb 28 17:33:13 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>	<38dihaF5o9va9U1@individual.net>
	<4221AA52.4070302@aanhet.net>
	<Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>
Message-ID: <422347C4.6060802@elvenkind.com>


Hi,

I just uploaded a new patch version (twice, sorry). I felt had
to introduce a new primitive

        \pdfoptionimageapplygamma = <0,1,2>

because otherwise almost all images would be rejected because
of gamma processing. Values:

	0 - never do gamma, i.e. same as versions < 1.21a
         1 - only do gamma if it would not break fast reading
         2 - always do gamma

In order to be acceptable for native copying, the following
constraints must be met:

* minor pdf version must be at least 2
* gray conversion must not be needed.
* if apply gamma is "2", the 'gamma delta' must be near zero
* the image file format must not be interlaced
* the color bit depth must be 8 or less, unless pdf minor is >=5
* the image may not have an alpha channel nor 'gif' transparancy.

The test suite (the variant I use) gives me 78 native file
inclusions with values 0 or 1 for 'apply gamma', and 54 files
with value 2 in 8bit color mode; (these numbers are resp. 98
and 69 in 16bit color mode).


Of course I also ran a speed test:

   $ ls -l hellhuge.png
   -rw-r--r--  1 taco users 12639474 Feb 28 15:23 hellhuge.png
   $ ./pngcheck hellhuge.png
   OK: hellhuge.png (5120x5120, 24-bit RGB, non-interlaced, 83.9%).

   $ time pdfetex \&cont-en fasthuge.tex
   Output written on fasthuge.pdf (1 page, 12626572 bytes).
   Transcript written on fasthuge.log.
   0.31user 0.27system 0:02.27elapsed 25%CPU

   $ time pdfetex \&cont-en slowhuge.tex
   Output written on slowhuge.pdf (1 page, 25379598 bytes).
   Transcript written on slowhuge.log.
   25.86user 1.58system 0:34.68elapsed 79%CPU

Greetings, Taco


Hartmut Henkel wrote:
> Hi Taco,
> 
> On Sun, 27 Feb 2005, Taco Hoekwater wrote:
> 
> 
>>I saw this on c.t.t. Shall I attempt a merge of yours and my patches?
> 
> 
> oh yes, that would be very nice! The reason why i hesitated with this
> patch is that it's not clear to me whether the libpng internally does
> any color transforms or other RGB number tweaking during decompression,
> maybe driven by some special PNG chunks in the image file. The fast
> reading patch would ignore these chunks. But until now i couldn't verify
> that libpng would do such calculations at all. Likely not; then the
> patch would be safe.
> 
> Regards, Hartmut
From hartmut_henkel at gmx.de  Mon Feb 28 21:18:24 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Feb 28 21:18:28 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <422347C4.6060802@elvenkind.com>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>
	<38dihaF5o9va9U1@individual.net> <4221AA52.4070302@aanhet.net>
	<Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>
	<422347C4.6060802@elvenkind.com>
Message-ID: <Pine.LNX.4.61.0502282103560.3050@hahepc1.hahe>

Hi Taco,

On Mon, 28 Feb 2005, Taco Hoekwater wrote:

> I just uploaded a new patch version (twice, sorry). I felt had to
> introduce a new primitive

you did it :-) thanks a lot! Trying out... Here it hangs with

pdftexdir/libpdf.a(writepng.o): In function `read_png_info':
/usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:50:
undefined reference to `fixedimageapplygamma'
/usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:52:
undefined reference to `fixedgamma'...

Do you have any idea what i'm missing? E. g. don't i need some
getintpar()?

> Of course I also ran a speed test:
>
>   $ ls -l hellhuge.png
>   -rw-r--r--  1 taco users 12639474 Feb 28 15:23 hellhuge.png
>   $ ./pngcheck hellhuge.png
>   OK: hellhuge.png (5120x5120, 24-bit RGB, non-interlaced, 83.9%).
>
>   $ time pdfetex \&cont-en fasthuge.tex
>   Output written on fasthuge.pdf (1 page, 12626572 bytes).
>   Transcript written on fasthuge.log.
>   0.31user 0.27system 0:02.27elapsed 25%CPU
>
>   $ time pdfetex \&cont-en slowhuge.tex
>   Output written on slowhuge.pdf (1 page, 25379598 bytes).
>   Transcript written on slowhuge.log.
>   25.86user 1.58system 0:34.68elapsed 79%CPU

this last one is not recompressed?

Regards, Hartmut
From hartmut_henkel at gmx.de  Mon Feb 28 21:31:49 2005
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon Feb 28 21:32:03 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <Pine.LNX.4.61.0502282103560.3050@hahepc1.hahe>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>
	<38dihaF5o9va9U1@individual.net> <4221AA52.4070302@aanhet.net>
	<Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>
	<422347C4.6060802@elvenkind.com>
	<Pine.LNX.4.61.0502282103560.3050@hahepc1.hahe>
Message-ID: <Pine.LNX.4.61.0502282130110.6641@hahepc1.hahe>

On Mon, 28 Feb 2005, Hartmut Henkel wrote:

> you did it :-) thanks a lot! Trying out... Here it hangs with
>
> pdftexdir/libpdf.a(writepng.o): In function `read_png_info':
> /usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:50:
> undefined reference to `fixedimageapplygamma'
> /usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:52:
> undefined reference to `fixedgamma'...

Ooops, this was with pdfxtex, sorry, which isn't so straight-forward due
to the other patches already there. I have now thrown out pdfxtex from
the Makefile and it compiles...

Regards, Hartmut
From taco at elvenkind.com  Mon Feb 28 21:47:51 2005
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon Feb 28 21:48:28 2005
Subject: [NTG-pdftex] Re: Slow PNG inclusion with pdfLaTeX
In-Reply-To: <Pine.LNX.4.61.0502282130110.6641@hahepc1.hahe>
References: <1109434034.561064.42080@l41g2000cwc.googlegroups.com>	<38dihaF5o9va9U1@individual.net>
	<4221AA52.4070302@aanhet.net>	<Pine.LNX.4.61.0502271653020.1312@hahepc1.hahe>	<422347C4.6060802@elvenkind.com>	<Pine.LNX.4.61.0502282103560.3050@hahepc1.hahe>
	<Pine.LNX.4.61.0502282130110.6641@hahepc1.hahe>
Message-ID: <42238377.7010403@elvenkind.com>


I had problems as well. The builds for pdfxtex and pdfetex read
the pdftexd.h file that is autogenerated, *not* pdfxtexd.h or
pdfetexd.h, as they should. Didn't know how to fix so I just
added the change file to all three :-)

Taco

Hartmut Henkel wrote:
> On Mon, 28 Feb 2005, Hartmut Henkel wrote:
> 
> 
>>you did it :-) thanks a lot! Trying out... Here it hangs with
>>
>>pdftexdir/libpdf.a(writepng.o): In function `read_png_info':
>>/usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:50:
>>undefined reference to `fixedimageapplygamma'
>>/usr/local/src/tex/teTeX/tetex-src-3.0/texk/web2c/pdftexdir/writepng.c:52:
>>undefined reference to `fixedgamma'...
> 
> 
> Ooops, this was with pdfxtex, sorry, which isn't so straight-forward due
> to the other patches already there. I have now thrown out pdfxtex from
> the Makefile and it compiles...
> 
> Regards, Hartmut
> _______________________________________________
> ntg-pdftex mailing list
> ntg-pdftex@ntg.nl
> http://www.ntg.nl/mailman/listinfo/ntg-pdftex

