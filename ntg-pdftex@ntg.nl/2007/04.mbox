From noreply at sarovar.org  Sun Apr  1 02:44:47 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Sun, 01 Apr 2007 06:14:47 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-747 ] \letterspacefont and
	\pdffontexpand, again
Message-ID: <E1HXoBb-0001my-00@sarovar.org>

Bugs item #747, was opened at 2007-03-09 03:09
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=747&group_id=106

Category: hz
Group: v1.40.1
Status: Open
Resolution: Accepted
Priority: 5
Submitted By: Robert (schlcht)
Assigned to: The Thanh Han (hanthethanh)
Summary: \letterspacefont and \pdffontexpand, again

Initial Comment:
When expanding a letterspaced font, the base font will
be expanded, too, resulting in the error `font has been
expanded with different parameters' when the base font
is expanded again:

\letterspacefont\lsfont\font 100
\pdffontexpand\lsfont 20 20 5 autoexpand
\pdffontexpand\font   20 20 5 autoexpand
Z\bye


----------------------------------------------------------------------

>Comment By: Robert (schlcht)
Date: 2007-04-01 00:44

Message:
Logged In: YES 
user_id=2217

Fine for me and microtype. 

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2007-03-31 09:52

Message:
Logged In: YES 
user_id=710

either name is ok with me. We need a new pritimive to load a
new font and expand it, since the current one doesn't load a
new font and hence is making trouble. I would wait for a
while to see how Robert sees it before making any change.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-03-19 11:07

Message:
Logged In: NO 

Hello,

I do not think that \pdfexpandfont is a good name for a new 
primitive, as it is too easy to confuse with \pdffontexpand. 
What about \pdfexpandnewfont, as -- if I understand 
correctly -- a new font is loaded?


Jonathan

P.S: Thank you for creating pdfTeX!

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2007-03-10 20:18

Message:
Logged In: YES 
user_id=710

Phil Taylor has a suggestion that seems great to me:
introduce a new primitive \pdfexpandfont instead. How do you
see it?

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-03-10 19:24

Message:
Logged In: YES 
user_id=421

Forget that comment. Of course a change of \pdffontexpand
has to be considered carefully. By you. :-)

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-03-10 19:22

Message:
Logged In: YES 
user_id=421

No. It's an undocumented primitive. ;-)

----------------------------------------------------------------------

Comment By: The Thanh Han (hanthethanh)
Date: 2007-03-09 17:28

Message:
Logged In: YES 
user_id=710

sigh. A mistake when implementing the \pdffontexpand
primitive: it should load a new font for expansion, instead
of expanding a loaded font. Too late for change now?

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=747&group_id=106

From taco at elvenkind.com  Sun Apr  1 09:22:34 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 01 Apr 2007 09:22:34 +0200
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: <877isxma2p.fsf@riesling.zuerich.kuesterei.ch>
References: <E1HWw39-0004Qo-00@skye.ra.phy.cam.ac.uk>	<460D1A1B.3020500@elvenkind.com>	<874po268pt.fsf@riesling.zuerich.kuesterei.ch>	<460D34D4.1000203@elvenkind.com>
	<877isxma2p.fsf@riesling.zuerich.kuesterei.ch>
Message-ID: <460F5DBA.4070006@elvenkind.com>


Hi Frank,

Frank K?ster wrote:
> Taco Hoekwater <taco at elvenkind.com> wrote:
> 
>> If everybody links with poppler, poppler should be in the repository,
>> not xpdf.
> 
> I have half-finished autoconf magic to make the switch to poppler
> configurable.  If you volunteer  to finish it, I can send it to you.

Since I am the one complaining, that would definately be fair.
But before I say yes, how much knowledge would be needed? I know
only a very little bit about autoconf, and unless there is a good
manual you can point me to, it could take me a long time to learn.

Best wishes.
Taco

From martin at oneiros.de  Sun Apr  1 13:51:26 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 1 Apr 2007 13:51:26 +0200
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: <460F5DBA.4070006@elvenkind.com>
References: <E1HWw39-0004Qo-00@skye.ra.phy.cam.ac.uk>
	<460D1A1B.3020500@elvenkind.com>
	<874po268pt.fsf@riesling.zuerich.kuesterei.ch>
	<460D34D4.1000203@elvenkind.com>
	<877isxma2p.fsf@riesling.zuerich.kuesterei.ch>
	<460F5DBA.4070006@elvenkind.com>
Message-ID: <68c491a60704010451y261a0dd7s3d9d76b08af24630@mail.gmail.com>

2007/4/1, Taco Hoekwater <taco at elvenkind.com>:
> Frank K?ster wrote:
> > I have half-finished autoconf magic to make the switch to poppler
> > configurable.  If you volunteer  to finish it, I can send it to you.
>
> Since I am the one complaining, that would definately be fair.
> But before I say yes, how much knowledge would be needed? I know
> only a very little bit about autoconf, and unless there is a good
> manual you can point me to, it could take me a long time to learn.

Taco,
please finish luaTeX instead. :-)

I know little about autofoo, but probably more than you, so I will
help Frank. But please be patient. Not tomorrow, but definitely in
time for 1.50. :-)

I think it would help this effort if pdfTeX had a layer of abstraction
between itself and xpdf/poppler/...; will work on that.

Best
   Martin

From sanjoy at mrao.cam.ac.uk  Sun Apr  1 14:07:25 2007
From: sanjoy at mrao.cam.ac.uk (Sanjoy Mahajan)
Date: Sun, 01 Apr 2007 13:07:25 +0100
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: Your message of "Sun, 01 Apr 2007 09:22:34 +0200."
	<460F5DBA.4070006@elvenkind.com> 
Message-ID: <E1HXyqD-0003Qr-00@skye.ra.phy.cam.ac.uk>

The autoconf manual is 'info autoconf', or as the autoconf entry in
Emacs's info mode.

> Since I am the one complaining, that would definately be fair.

I'm also been complaining, so if it doesn't require too much autoconf
knowledge (I've written only one, short autoconf script, for an
Othello program) I'll join Taco in finishing the autoconf magic.

> half-finished autoconf magic to make the switch to poppler
> configurable. 

Is the magic that autoconf should detect whether libpoppler0
(i.e. 0.4.x) and headers are on the system and use them if they are,
otherwise use the in-tree xpdf?  Or is that too much magic?

-Sanjoy

`Not all those who wander are lost.' (J.R.R. Tolkien)

From martin at oneiros.de  Sun Apr  1 14:27:58 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 1 Apr 2007 14:27:58 +0200
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: <E1HXyqD-0003Qr-00@skye.ra.phy.cam.ac.uk>
References: <460F5DBA.4070006@elvenkind.com>
	<E1HXyqD-0003Qr-00@skye.ra.phy.cam.ac.uk>
Message-ID: <68c491a60704010527m207b9e5fy32f45790b2d38e3d@mail.gmail.com>

2007/4/1, Sanjoy Mahajan <sanjoy at mrao.cam.ac.uk>:
> Is the magic that autoconf should detect whether libpoppler0
> (i.e. 0.4.x) and headers are on the system and use them if they are,
> otherwise use the in-tree xpdf?  Or is that too much magic?

The build should use the in-tree xpdf unless configure is instructed
to use poppler (something like --with-poppler).

Note that we already have patch 474 for tracking this feature.

Best
   Martin

From pragma at wxs.nl  Sun Apr  1 21:26:09 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 01 Apr 2007 21:26:09 +0200
Subject: [NTG-pdftex] [Fwd: Re:  [tex-live] buf-size]
Message-ID: <46100751.60909@wxs.nl>


-------------- next part --------------
An embedded message was scrubbed...
From: Hans Hagen <pragma at wxs.nl>
Subject: Re: [NTG-pdftex] [tex-live] buf-size
Date: Sun, 01 Apr 2007 21:25:48 +0200
Size: 1635
Url: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20070401/5820de0a/attachment.mht 

From frank at debian.org  Mon Apr  2 10:24:01 2007
From: frank at debian.org (Frank =?iso-8859-1?Q?K=FCster?=)
Date: Mon, 02 Apr 2007 10:24:01 +0200
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: <68c491a60704010451y261a0dd7s3d9d76b08af24630@mail.gmail.com>
	(Martin =?iso-8859-1?Q?Schr=F6der's?= message of "Sun\, 1 Apr 2007
	13\:51\:26 +0200")
References: <E1HWw39-0004Qo-00@skye.ra.phy.cam.ac.uk>
	<460D1A1B.3020500@elvenkind.com>
	<874po268pt.fsf@riesling.zuerich.kuesterei.ch>
	<460D34D4.1000203@elvenkind.com>
	<877isxma2p.fsf@riesling.zuerich.kuesterei.ch>
	<460F5DBA.4070006@elvenkind.com>
	<68c491a60704010451y261a0dd7s3d9d76b08af24630@mail.gmail.com>
Message-ID: <87hcrztc9q.fsf@riesling.zuerich.kuesterei.ch>

"Martin Schr?der" <martin at oneiros.de> wrote:

> I think it would help this effort if pdfTeX had a layer of abstraction
> between itself and xpdf/poppler/...; will work on that.

Once you've done that, you have the specifications (and probably some of
the implementation) ready for the no-display C-only version of
libpoppler, haven't you?

Regards, Frank

P.S. I'll send a diff with the autoconf stuff I have later
-- 
Dr. Frank K?ster
Single Molecule Spectroscopy, Protein Folding @ Inst. f. Biochemie, Univ. Z?rich
Debian Developer (teTeX/TeXLive)

From frank at debian.org  Mon Apr  2 18:10:28 2007
From: frank at debian.org (Frank =?iso-8859-1?Q?K=FCster?=)
Date: Mon, 02 Apr 2007 18:10:28 +0200
Subject: [NTG-pdftex] [tex-live] Debian TeX -- new packages
In-Reply-To: <460F5DBA.4070006@elvenkind.com> (Taco Hoekwater's message of
	"Sun\, 01 Apr 2007 09\:22\:34 +0200")
References: <E1HWw39-0004Qo-00@skye.ra.phy.cam.ac.uk>
	<460D1A1B.3020500@elvenkind.com>
	<874po268pt.fsf@riesling.zuerich.kuesterei.ch>
	<460D34D4.1000203@elvenkind.com>
	<877isxma2p.fsf@riesling.zuerich.kuesterei.ch>
	<460F5DBA.4070006@elvenkind.com>
Message-ID: <874pnyvjt7.fsf@riesling.zuerich.kuesterei.ch>

Taco Hoekwater <taco at elvenkind.com> wrote:

> Hi Frank,
>
> Frank K?ster wrote:
>> Taco Hoekwater <taco at elvenkind.com> wrote:
>>
>>> If everybody links with poppler, poppler should be in the repository,
>>> not xpdf.
>>
>> I have half-finished autoconf magic to make the switch to poppler
>> configurable.  If you volunteer  to finish it, I can send it to you.
>
> Since I am the one complaining, that would definately be fair.
> But before I say yes, how much knowledge would be needed? I know
> only a very little bit about autoconf, and unless there is a good
> manual you can point me to, it could take me a long time to learn.

I don't know much about autoconf, too, and I found the info manual, as
well as other resources, hardly helpful:  They teach you how to use
existing macros, but not how to write new ones.  

I tried to prepare a diff of my working directory and normal texlive
dir, but what I didn't remember was that I copied the poppler sources
into the tree (because I thought it would be easier to make the
dynamic-vs-static linking switch first, and xpdf vs poppler later).
Since I am not sure which files in the poppler dir I touched, it doesn't
make much sense to try to diff the trees without remembering what I did
(and I don't have time for this ATM).

Actually, what I did was pretty straightforward: I copied libfoo.ac (I
think foo=png, but I'm not sure) and did simple replaces.  I stopped
when I came to the place were it was necessary to know how to detect
installed poppler header files with autoconf, see above.

Regards, Frank
-- 
Dr. Frank K?ster
Single Molecule Spectroscopy, Protein Folding @ Inst. f. Biochemie, Univ. Z?rich
Debian Developer (teTeX/TeXLive)

From taco at elvenkind.com  Tue Apr  3 11:34:23 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 03 Apr 2007 11:34:23 +0200
Subject: [NTG-pdftex] [Fwd: [Dev-luatex] What is the unit "nc" supposed to
	be?]
Message-ID: <46121F9F.1010708@elvenkind.com>


The following is forwarded from the LuaTeX list.

-------- Original Message --------
Subject: [Dev-luatex] What is the unit "nc" supposed to be?
Date: Tue, 03 Apr 2007 11:25:34 +0200
From: David Kastrup <dak at gnu.org>
To: dev-luatex at ntg.nl


New Cicero or what?

Please consider the following:

This is luaTeX, Version 3.141592-snapshot-2007040210 (Web2C 7.5.6)
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

*

This does not cut it at all.  The section in tex.web starts with

@ The necessary conversion factors can all be specified exactly as
fractions whose numerator and denominator are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified exactly as
fractions whose numerator and denominator are 65535 or less.

Who does things like that without actually checking that they work?
It is possible to rework the arithmetic to get along with 65535, but
it is certainly not a matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an Aleph or a LuaTeX
invention (did I forget anything?), but it certainly can't stay like
that.

Sorry if I sound like a whiner here.  If you think it worth the
trouble, I can rework the arithmetic (but there is a reason that Knuth
kept to 15 bit factors, so it is going to become more complicated).
But I consider it more likely that nc should be changed to 1370:107
which is the closest 15 bit fraction to 12nd (it is smaller than 12nd,
but the next larger suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not equal to 1in+1in
anyway.  I think we can afford this.

Certainly better than the current behavior.

-- 
David Kastrup
_______________________________________________
dev-luatex mailing list
dev-luatex at ntg.nl
http://www.ntg.nl/mailman/listinfo/dev-luatex

From martin at oneiros.de  Tue Apr  3 11:36:07 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 3 Apr 2007 11:36:07 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <861wj195dd.fsf@lola.quinscape.zz>
References: <861wj195dd.fsf@lola.quinscape.zz>
Message-ID: <68c491a60704030236i697cd7c1l5f95ffe9c02b6e89@mail.gmail.com>

2007/4/3, David Kastrup <dak at gnu.org>:
> New Cicero or what?

>From the pdftex NEWS for 1.30:

- pdftex knows two new units:
  - new Didot (1nd=0.375mm)
  - new Cicero (1nc=12nd)

But it's broken in pdftex as well. :-(

> Who does things like that without actually checking that they work?
> It is possible to rework the arithmetic to get along with 65535, but
> it is certainly not a matter of merely changing the _documentation_
> and not the code.

Me. I got a patch and didn't check it. :-(

Best
   Martin

From noreply at sarovar.org  Tue Apr  3 11:20:49 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Tue, 03 Apr 2007 14:50:49 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYfC5-0004jI-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 11:20
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Open
Resolution: None
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From taco at elvenkind.com  Tue Apr  3 11:42:20 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 03 Apr 2007 11:42:20 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <861wj195dd.fsf@lola.quinscape.zz>
References: <861wj195dd.fsf@lola.quinscape.zz>
Message-ID: <4612217C.1050908@elvenkind.com>



David Kastrup wrote:
> But I consider it more likely that nc should be changed to 1370:107

And also, I applied this change to luatex.web (and fixed the
documentation sting back). TeX's conversions are approximations
anyway, I see little point in changing the conversion arithmetic.

Taco

From noreply at sarovar.org  Tue Apr  3 11:38:30 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Tue, 03 Apr 2007 15:08:30 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYfTC-0006Uf-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 11:20
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From noreply at sarovar.org  Tue Apr  3 11:43:37 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Tue, 03 Apr 2007 15:13:37 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYfY9-0006W2-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 11:20
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
>Status: Closed
>Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2007-04-03 11:43

Message:
Logged In: YES 
user_id=421

A patch is attached; this will be included in the next release.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From dak at gnu.org  Tue Apr  3 12:03:21 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 03 Apr 2007 12:03:21 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <4612217C.1050908@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 03 Apr 2007 11\:42\:20 +0200")
References: <861wj195dd.fsf@lola.quinscape.zz> <4612217C.1050908@elvenkind.com>
Message-ID: <86slbh7p1y.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> David Kastrup wrote:
>> But I consider it more likely that nc should be changed to 1370:107
>
> And also, I applied this change to luatex.web (and fixed the
> documentation sting back). TeX's conversions are approximations
> anyway, I see little point in changing the conversion arithmetic.

Well, but I would find a change rendering "1in"="72.27pt" attractive.
I'll propose one shortly.  Anyway, those fractions carry _way_ more
precision than TeX's general arithmetic anyway, and TeX's truncation
(which this was all about in the first place) introduces more bias
than this particular fraction does.  One could argue that 32163:2512
will be a nicer fraction since it overshoots, and TeX forgets to round
the final result, so we err on different sides.

But I'd rather have the closest ratio and fix TeX's, excuse me
(hopefully Knuth didn't hear), LuaTeX's arithmetic on units by letting
it round properly.

-- 
David Kastrup

From pragma at wxs.nl  Tue Apr  3 12:22:20 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 03 Apr 2007 12:22:20 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <86slbh7p1y.fsf@lola.quinscape.zz>
References: <861wj195dd.fsf@lola.quinscape.zz> <4612217C.1050908@elvenkind.com>
	<86slbh7p1y.fsf@lola.quinscape.zz>
Message-ID: <46122ADC.5090605@wxs.nl>

David Kastrup wrote:
> Taco Hoekwater <taco at elvenkind.com> writes:
>
>   
>> David Kastrup wrote:
>>     
>>> But I consider it more likely that nc should be changed to 1370:107
>>>       
>> And also, I applied this change to luatex.web (and fixed the
>> documentation sting back). TeX's conversions are approximations
>> anyway, I see little point in changing the conversion arithmetic.
>>     
>
> Well, but I would find a change rendering "1in"="72.27pt" attractive.
> I'll propose one shortly.  Anyway, those fractions carry _way_ more
> precision than TeX's general arithmetic anyway, and TeX's truncation
> (which this was all about in the first place) introduces more bias
> than this particular fraction does.  One could argue that 32163:2512
> will be a nicer fraction since it overshoots, and TeX forgets to round
> the final result, so we err on different sides.
>
> But I'd rather have the closest ratio and fix TeX's, excuse me
> (hopefully Knuth didn't hear), LuaTeX's arithmetic on units by letting
> it round properly.
>
>   
this is not going to happen soon, maybe a different 'rounding' some day;

while developing we need to be able to compare pdftex output with luatex 
output/processing and implementing a different rounding model is not 
convenient at this time

nobody bothered about that for 25 years so we're not in a great hurry 
there -)

Hans  

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From dak at gnu.org  Tue Apr  3 13:06:44 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 03 Apr 2007 13:06:44 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <4612217C.1050908@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 03 Apr 2007 11\:42\:20 +0200")
References: <861wj195dd.fsf@lola.quinscape.zz> <4612217C.1050908@elvenkind.com>
Message-ID: <86k5wt7m4b.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> David Kastrup wrote:
>> But I consider it more likely that nc should be changed to 1370:107
>
> And also, I applied this change to luatex.web (and fixed the
> documentation sting back). TeX's conversions are approximations
> anyway, I see little point in changing the conversion arithmetic.

Unfortunately, Knuth is a practical joker.  The old documentation
string, while sounding reassuring, is actually also wrong.

With the code he has written there, the requirement is that the _sum_
of num and denum does not exceed 32768.  Which happens to be the case
for his ratios, but not for _either_ of the new ones.

Check the following:

This is luaTeX, Version 3.141592-snapshot-2007040210 (Web2C 7.5.6)
**\relax

*\dimen0=9.9998nd

*\showthe\dimen0
> 7.44438pt.
<*> \showthe\dimen0
                   
? 

*\dimen0=10nd

*\showthe\dimen0
> 10.66977pt.
<*> \showthe\dimen0
                   
? 

*

So I recommend that you change the ratio of nd either to 1370:1284
(which reinstates the 12nd=1nc relation), or better change it to the
closest usable ratio which is 11183:10481.

So it looks like neither the new cicero nor the new didot have a
chance to be represented exactly.  Too bad.

I am still being sidetracked from what I really wanted to look at.

Does anybody actually _use_ those new dimensions?

-- 
David Kastrup

From taco at elvenkind.com  Tue Apr  3 14:23:07 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 03 Apr 2007 14:23:07 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <86k5wt7m4b.fsf@lola.quinscape.zz>
References: <861wj195dd.fsf@lola.quinscape.zz>	<4612217C.1050908@elvenkind.com>
	<86k5wt7m4b.fsf@lola.quinscape.zz>
Message-ID: <4612472B.5080806@elvenkind.com>



David Kastrup wrote:
> 
> So I recommend that you change the ratio of nd either to 1370:1284
> (which reinstates the 12nd=1nc relation), or better change it to the

I picked that choice for luatex. People would be awfully confused if
12pt!=12pc, so I suspect the same is true for nds and ncs (assuming
anyone actually uses these units, which is doubtful at this stage).

Taco

From martin at oneiros.de  Tue Apr  3 14:25:57 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 3 Apr 2007 14:25:57 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <4612472B.5080806@elvenkind.com>
References: <861wj195dd.fsf@lola.quinscape.zz> <4612217C.1050908@elvenkind.com>
	<86k5wt7m4b.fsf@lola.quinscape.zz> <4612472B.5080806@elvenkind.com>
Message-ID: <68c491a60704030525r3c71d336p5dae1d99a0bf898c@mail.gmail.com>

2007/4/3, Taco Hoekwater <taco at elvenkind.com>:
> 12pt!=12pc, so I suspect the same is true for nds and ncs (assuming
> anyone actually uses these units, which is doubtful at this stage).

The bug has been in the wild since 2005-08-01, so I agree: Nobody uses
them. Not even the author of the patch. :-{

Best
   Martin

From dak at gnu.org  Tue Apr  3 14:52:51 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 03 Apr 2007 14:52:51 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <4612472B.5080806@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 03 Apr 2007 14\:23\:07 +0200")
References: <861wj195dd.fsf@lola.quinscape.zz>
	<4612217C.1050908@elvenkind.com> <86k5wt7m4b.fsf@lola.quinscape.zz>
	<4612472B.5080806@elvenkind.com>
Message-ID: <86slbh62n0.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> David Kastrup wrote:
>>
>> So I recommend that you change the ratio of nd either to 1370:1284
>> (which reinstates the 12nd=1nc relation), or better change it to the
>
> I picked that choice for luatex. People would be awfully confused if
> 12pt!=12pc,

I'd be confused it it were...

> so I suspect the same is true for nds and ncs (assuming anyone
> actually uses these units, which is doubtful at this stage).

I'd probably prefer the more exact value 11183:10481.  Both nc and nd
don't exist in the wild, they are only abstract ratios inside of TeX.
If people specify a value in the smaller unit nc, they presumably want
to have it heeded as well as possible.

But since those values differ only in the seventh place, the
five-digit precision of TeX's "scaled" values will probably make that
difference irrelevant for most applications.

Your choice makes x nd equivalent to 12*x nc, where x is a "scaled"
15.16 fixed point number from TeX.

I have the sneaking suspicion that Knuth might have known about these
units and decided not to put them into TeX since they did not have
convenient exact ratios like the others.

-- 
David Kastrup

From dak at gnu.org  Tue Apr  3 15:02:07 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 03 Apr 2007 15:02:07 +0200
Subject: [NTG-pdftex] [Dev-luatex] What is the unit "nc" supposed to be?
In-Reply-To: <68c491a60704030525r3c71d336p5dae1d99a0bf898c@mail.gmail.com>
	(Martin =?iso-8859-1?Q?Schr=F6der's?= message of "Tue\, 3 Apr 2007
	14\:25\:57 +0200")
References: <861wj195dd.fsf@lola.quinscape.zz>
	<4612217C.1050908@elvenkind.com> <86k5wt7m4b.fsf@lola.quinscape.zz>
	<4612472B.5080806@elvenkind.com>
	<68c491a60704030525r3c71d336p5dae1d99a0bf898c@mail.gmail.com>
Message-ID: <86odm5627k.fsf@lola.quinscape.zz>

"Martin Schr?der" <martin at oneiros.de> writes:

> 2007/4/3, Taco Hoekwater <taco at elvenkind.com>:
>> 12pt!=12pc, so I suspect the same is true for nds and ncs (assuming
>> anyone actually uses these units, which is doubtful at this stage).
>
> The bug has been in the wild since 2005-08-01, so I agree: Nobody uses
> them. Not even the author of the patch. :-{

Well, at least not with large numbers behind the decimal point.  The
nc is rather easy to break with those (0.6nc does the trick), but you
have to cherry-pick values for breaking nd (9.99998nd is the smallest
value of form x.99998nd that actually breaks).

So it is possible that the author uses nd, and possibly multiples of
0.5nc without seeing the problem.

-- 
David Kastrup

From noreply at sarovar.org  Wed Apr  4 08:37:38 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 12:07:38 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYz7i-0003Ik-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 14:50
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 12:07

Message:
Logged In: NO 

Unfortunately, Knuth's original comment is _also_ wrong. 
The _sum_ of numerator and denominator must not exceed 32768.

So the conversion ratio for nd is _also_ incorrect, as can
be witnessed by checking the value 9.99998nd.

Changing the ratio to 685:642 would reconstitute the
relation 12nd=1nc.  The closest approximation for nd that
works with the code would be 11183:10481.  However, we are
talking about differences in the order of 1e-7, so the ratio
with the simpler relation to nc might be preferable.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-04-03 15:13

Message:
Logged In: YES 
user_id=421

A patch is attached; this will be included in the next release.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From noreply at sarovar.org  Wed Apr  4 09:28:24 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 12:58:24 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYzuq-0000DD-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 14:50
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 12:58

Message:
Logged In: NO 

Here is a patch for the last comment.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 12:07

Message:
Logged In: NO 

Unfortunately, Knuth's original comment is _also_ wrong. 
The _sum_ of numerator and denominator must not exceed 32768.

So the conversion ratio for nd is _also_ incorrect, as can
be witnessed by checking the value 9.99998nd.

Changing the ratio to 685:642 would reconstitute the
relation 12nd=1nc.  The closest approximation for nd that
works with the code would be 11183:10481.  However, we are
talking about differences in the order of 1e-7, so the ratio
with the simpler relation to nc might be preferable.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-04-03 15:13

Message:
Logged In: YES 
user_id=421

A patch is attached; this will be included in the next release.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From noreply at sarovar.org  Wed Apr  4 09:30:28 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 13:00:28 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HYzwq-0000EK-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 14:50
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 13:00

Message:
Logged In: NO 

Here is a patch for the last comment.

Index: luatex.web
===================================================================
--- luatex.web	(revision 383)
+++ luatex.web	(working copy)
@@ -11534,7 +11534,7 @@
 end
 
 @ The necessary conversion factors can all be specified
exactly as
-fractions whose numerator and denominator are 65535 or less.
+fractions whose numerator and denominator add to 32768 or less.
 According to the definitions here,
$\rm2660\,dd\approx1000.33297\,mm$;
 this agrees well with the value $\rm1000.333\,mm$ cited by
Bosshard
 @^Bosshard, Hans Rudolf@>
@@ -11542,8 +11542,12 @@
 The Didot point has been newly standardized in 1978;
 it's now exactly $\rm 1\,nd=0.375\,mm$.
 Conversion uses the equation
$0.375=21681/20320/72.27\cdot25.4$.
-The new Cicero follows the new Didot point; $\rm 1\,nc=12\,nd$.
-
+The new Cicero follows the new Didot point; $\rm
1\,nc=12\,nd$.  These
+would lead to the ratios $21681/20320$ and $65043/5080$,
respectively.
+The closest approximations supported by the algorithm would be
+$11183/10481$ and $1370/107$.  In order to maintain the
+relation $\rm 1\,nc=12\nd$, we pick the ratio $685/642$ for
$\rm nc$,
+however.
 @d set_conversion_end(#)== denom:=#; end
 @d set_conversion(#)==@+begin num:=#; set_conversion_end
 
@@ -11562,9 +11566,9 @@
 @.dd@>
 else if scan_keyword("cc") then set_conversion(14856)(1157)
 @.cc@>
-else if scan_keyword("nd") then set_conversion(21681)(20320)
+else if scan_keyword("nd") then set_conversion(685)(642)
 @.nd@>
-else if scan_keyword("nc") then set_conversion(65043)(5080)
+else if scan_keyword("nc") then set_conversion(1370)(107)
 @.nc@>
 else if scan_keyword("sp") then goto done
 @.sp@>


----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 12:58

Message:
Logged In: NO 

Here is a patch for the last comment.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 12:07

Message:
Logged In: NO 

Unfortunately, Knuth's original comment is _also_ wrong. 
The _sum_ of numerator and denominator must not exceed 32768.

So the conversion ratio for nd is _also_ incorrect, as can
be witnessed by checking the value 9.99998nd.

Changing the ratio to 685:642 would reconstitute the
relation 12nd=1nc.  The closest approximation for nd that
works with the code would be 11183:10481.  However, we are
talking about differences in the order of 1e-7, so the ratio
with the simpler relation to nc might be preferable.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-04-03 15:13

Message:
Logged In: YES 
user_id=421

A patch is attached; this will be included in the next release.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From dak at gnu.org  Wed Apr  4 09:57:53 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 04 Apr 2007 09:57:53 +0200
Subject: [NTG-pdftex] Proposed patch for the nc/nd problem
Message-ID: <86odm43726.fsf@lola.quinscape.zz>

A non-text attachment was scrubbed...
Name: not available
Type: text/x-patch
Size: 1649 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20070404/25ac6e42/attachment.bin 

From noreply at sarovar.org  Wed Apr  4 12:44:46 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 16:14:46 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-752 ] nc/nd broken
Message-ID: <E1HZ2ys-0008Dt-00@sarovar.org>

Bugs item #752, was opened at 2007-04-03 11:20
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

Category: Primitives
Group: v1.30.0
Status: Closed
Resolution: Fixed
Priority: 5
Submitted By: Martin Schr?der (oneiros)
Assigned to: Martin Schr?der (oneiros)
Summary: nc/nd broken

Initial Comment:
David Kastrup reports this:
------------------------
**\dimen0=1nc

*\showthe\dimen0
> 12.80373pt.
<*> \showthe\dimen0

?

*\dimen0=0.99998nc

*\showthe\dimen0
> -0.09723pt.
<*> \showthe\dimen0

?

This does not cut it at all.  The section in tex.web
starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 32768 or less.


In LuaTeX, the section brazenly starts with

@ The necessary conversion factors can all be specified
exactly as fractions whose numerator and denominator
are 65535 or less.

Who does things like that without actually checking
that they work? It is possible to rework the arithmetic
to get along with 65535, but it is certainly not a
matter of merely changing the _documentation_
and not the code.

I have no idea whether this is an eTeX, a PDFTeX, an
Aleph or a LuaTeX invention (did I forget anything?),
but it certainly can't stay like that.

Sorry if I sound like a whiner here.  If you think it
worth the trouble, I can rework the arithmetic (but
there is a reason that Knuth kept to 15 bit factors, so
it is going to become more complicated).
But I consider it more likely that nc should be changed
to 1370:107 which is the closest 15 bit fraction to
12nd (it is smaller than 12nd, but the next larger
suitable fraction 32163:2512 is slightly further
from 12nd).  Please remember that in TeX, 2in is not
equal to 1in+1in anyway.  I think we can afford this.

Certainly better than the current behavior.
------------------------
He tested it with luaTeX, but the bug is already in pdftex.

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2007-04-04 12:44

Message:
Logged In: YES 
user_id=421

Accepted (with minor documentation corrections).

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 09:30

Message:
Logged In: NO 

Here is a patch for the last comment.

Index: luatex.web
===================================================================
--- luatex.web	(revision 383)
+++ luatex.web	(working copy)
@@ -11534,7 +11534,7 @@
 end
 
 @ The necessary conversion factors can all be specified
exactly as
-fractions whose numerator and denominator are 65535 or less.
+fractions whose numerator and denominator add to 32768 or less.
 According to the definitions here,
$\rm2660\,dd\approx1000.33297\,mm$;
 this agrees well with the value $\rm1000.333\,mm$ cited by
Bosshard
 @^Bosshard, Hans Rudolf@>
@@ -11542,8 +11542,12 @@
 The Didot point has been newly standardized in 1978;
 it's now exactly $\rm 1\,nd=0.375\,mm$.
 Conversion uses the equation
$0.375=21681/20320/72.27\cdot25.4$.
-The new Cicero follows the new Didot point; $\rm 1\,nc=12\,nd$.
-
+The new Cicero follows the new Didot point; $\rm
1\,nc=12\,nd$.  These
+would lead to the ratios $21681/20320$ and $65043/5080$,
respectively.
+The closest approximations supported by the algorithm would be
+$11183/10481$ and $1370/107$.  In order to maintain the
+relation $\rm 1\,nc=12\nd$, we pick the ratio $685/642$ for
$\rm nc$,
+however.
 @d set_conversion_end(#)== denom:=#; end
 @d set_conversion(#)==@+begin num:=#; set_conversion_end
 
@@ -11562,9 +11566,9 @@
 @.dd@>
 else if scan_keyword("cc") then set_conversion(14856)(1157)
 @.cc@>
-else if scan_keyword("nd") then set_conversion(21681)(20320)
+else if scan_keyword("nd") then set_conversion(685)(642)
 @.nd@>
-else if scan_keyword("nc") then set_conversion(65043)(5080)
+else if scan_keyword("nc") then set_conversion(1370)(107)
 @.nc@>
 else if scan_keyword("sp") then goto done
 @.sp@>


----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 09:28

Message:
Logged In: NO 

Here is a patch for the last comment.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-04 08:37

Message:
Logged In: NO 

Unfortunately, Knuth's original comment is _also_ wrong. 
The _sum_ of numerator and denominator must not exceed 32768.

So the conversion ratio for nd is _also_ incorrect, as can
be witnessed by checking the value 9.99998nd.

Changing the ratio to 685:642 would reconstitute the
relation 12nd=1nc.  The closest approximation for nd that
works with the code would be 11183:10481.  However, we are
talking about differences in the order of 1e-7, so the ratio
with the simpler relation to nc might be preferable.

----------------------------------------------------------------------

Comment By: Martin Schr?der (oneiros)
Date: 2007-04-03 11:43

Message:
Logged In: YES 
user_id=421

A patch is attached; this will be included in the next release.

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=752&group_id=106

From noreply at sarovar.org  Wed Apr  4 19:31:34 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 23:01:34 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-762 ] symbolic font gets /Flags as
	nonsymbolic
Message-ID: <E1HZ9KY-0001SL-00@sarovar.org>

Bugs item #762, was opened at 2007-04-04 19:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

Category: Fonts
Group: v1.40.0
Status: Open
Resolution: None
Priority: 7
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
Summary: symbolic font gets /Flags as nonsymbolic

Initial Comment:
The input file

\pdfcompresslevel=0
\pdfmapline{psyr Symbol}
\nopagenumbers
\font\sy=psyr
\sy a
\end

results in a pdf with a Font Descriptor with /Flags 34
for the Symbol font, which is wrong; it should be 4.

The flags are initialized as 4 in mapfile.c and
writefont.c sees this as the default value and writes
34 to the pdf.

Reported by TeX Guy <pdftexlist at gmail.com> and analyzed
by George N. White III <gnwiii at gmail.com>; see the
thread starting at
http://tug.org/pipermail/pdftex/2007-April/007133.html

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

From noreply at sarovar.org  Wed Apr  4 19:32:04 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 23:02:04 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-762 ] symbolic font gets /Flags as
	nonsymbolic
Message-ID: <E1HZ9L2-0001SZ-00@sarovar.org>

Bugs item #762, was opened at 2007-04-04 19:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

Category: Fonts
Group: v1.40.0
Status: Open
>Resolution: Accepted
Priority: 7
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
Summary: symbolic font gets /Flags as nonsymbolic

Initial Comment:
The input file

\pdfcompresslevel=0
\pdfmapline{psyr Symbol}
\nopagenumbers
\font\sy=psyr
\sy a
\end

results in a pdf with a Font Descriptor with /Flags 34
for the Symbol font, which is wrong; it should be 4.

The flags are initialized as 4 in mapfile.c and
writefont.c sees this as the default value and writes
34 to the pdf.

Reported by TeX Guy <pdftexlist at gmail.com> and analyzed
by George N. White III <gnwiii at gmail.com>; see the
thread starting at
http://tug.org/pipermail/pdftex/2007-April/007133.html

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

From noreply at sarovar.org  Wed Apr  4 19:42:57 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 04 Apr 2007 23:12:57 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-762 ] symbolic font gets /Flags as
	nonsymbolic
Message-ID: <E1HZ9VZ-0002F2-00@sarovar.org>

Bugs item #762, was opened at 2007-04-04 19:31
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

Category: Fonts
Group: v1.40.0
Status: Open
Resolution: Accepted
Priority: 7
Submitted By: Martin Schr?der (oneiros)
Assigned to: Hartmut Henkel (hhenkel)
Summary: symbolic font gets /Flags as nonsymbolic

Initial Comment:
The input file

\pdfcompresslevel=0
\pdfmapline{psyr Symbol}
\nopagenumbers
\font\sy=psyr
\sy a
\end

results in a pdf with a Font Descriptor with /Flags 34
for the Symbol font, which is wrong; it should be 4.

The flags are initialized as 4 in mapfile.c and
writefont.c sees this as the default value and writes
34 to the pdf.

Reported by TeX Guy <pdftexlist at gmail.com> and analyzed
by George N. White III <gnwiii at gmail.com>; see the
thread starting at
http://tug.org/pipermail/pdftex/2007-April/007133.html

----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2007-04-04 19:42

Message:
Logged In: YES 
user_id=421

The default might be reasonable, but even setting the
fontflags as 4 (symbol) doesn't work, as this is interpreted
as being the default and changed to 34. :-(

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=762&group_id=106

From oberdiek at uni-freiburg.de  Fri Apr  6 00:47:54 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 6 Apr 2007 00:47:54 +0200
Subject: [NTG-pdftex] \pdfprimitive
Message-ID: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>

Hello,

\def\show{Hello World}
\pdfprimitive\show\relax

I would expect that the primitive \show (not the macro) is
executed and shows \relax. Instead I get an error (pdfTeX 1.40.3):

  ! Undefined control sequence.
  l.2 \pdfprimitive\show

Did I misunderstood \pdfprimitive?

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From taco at elvenkind.com  Fri Apr  6 09:10:01 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 Apr 2007 09:10:01 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
Message-ID: <4615F249.7080206@elvenkind.com>

Heiko Oberdiek wrote:
> Hello,
> 
> \def\show{Hello World}
> \pdfprimitive\show\relax
> 
> I would expect that the primitive \show (not the macro) is
> executed and shows \relax. Instead I get an error (pdfTeX 1.40.3):
> 
>   ! Undefined control sequence.
>   l.2 \pdfprimitive\show
> 
> Did I misunderstood \pdfprimitive?

No, that should have worked. I will investigate.

Best wishes,
Taco

From oberdiek at uni-freiburg.de  Fri Apr  6 12:16:36 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 6 Apr 2007 12:16:36 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <4615F249.7080206@elvenkind.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
Message-ID: <20070406101635.GA30102@irwin.vpn.uni-freiburg.de>

On Fri, Apr 06, 2007 at 09:10:01AM +0200, Taco Hoekwater wrote:

> Heiko Oberdiek wrote:
> > Hello,
> > 
> > \def\show{Hello World}
> > \pdfprimitive\show\relax
> > 
> > I would expect that the primitive \show (not the macro) is
> > executed and shows \relax. Instead I get an error (pdfTeX 1.40.3):
> > 
> >   ! Undefined control sequence.
> >   l.2 \pdfprimitive\show
> > 
> > Did I misunderstood \pdfprimitive?
> 
> No, that should have worked. I will investigate.

Thanks.

BTW, is there a way to restore a primitive without having
a previously generated backup?

Example:

\def\show{something}% (e.g. ucsenc.def)

% Can something like
\expandafter\let\expandafter\show\pdfprimitive\show
% be used for restoring the meaning of \show?
% Or is the following the only way:
\def\show{\pdfprimitive\show}

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From taco at elvenkind.com  Fri Apr  6 13:11:39 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 Apr 2007 13:11:39 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
Message-ID: <46162AEB.4090107@elvenkind.com>

Heiko Oberdiek wrote:
>>>   ! Undefined control sequence.
>>>   l.2 \pdfprimitive\show
>>>
>>> Did I misunderstood \pdfprimitive?
>> No, that should have worked. I will investigate.
> 
> Thanks.

I am an idiot. I was testing \pdfprimitive itself for expandability,
instead of its argument. There is a very small patch possible, but
I had better do some more tests before submitting it.

Taco

From Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org  Fri Apr  6 13:44:11 2007
From: Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org (Philip & Le Khanh)
Date: Fri, 06 Apr 2007 12:44:11 +0100
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
Message-ID: <4616328B.60108@Royal-Tunbridge-Wells.Org>

As an aside, if I understand the function
of \pdfprimitive correctly (that is, it
allows access to a primitive whose name
has been stolen), then it is (IMHO)
singularly ill-named, in that it allows
access to /all/ primitives (e.g., \show)
rather than just PDF primitives ...  If
this is the case, is there any chance of
a better choice of name in a future release ?

** Phil

From taco at elvenkind.com  Sat Apr  7 09:20:35 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Apr 2007 09:20:35 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <4616328B.60108@Royal-Tunbridge-Wells.Org>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
Message-ID: <46174643.1020007@elvenkind.com>

Philip & Le Khanh wrote:
> As an aside, if I understand the function
> of \pdfprimitive correctly (that is, it
> allows access to a primitive whose name
> has been stolen), then it is (IMHO)
> singularly ill-named, in that it allows
> access to /all/ primitives (e.g., \show)
> rather than just PDF primitives ...  If
> this is the case, is there any chance of
> a better choice of name in a future release ?

We had a long discussion a few years back about the names
for the non-tex, non-etex primitives. The consensus was that
they should all be recognizable by having a unique prefix,
that is when the \pdf.... naming convention started.

(personally, I don't like it, but I was outvoted)

Best,
Taco




From oberdiek at uni-freiburg.de  Sat Apr  7 11:05:40 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sat, 7 Apr 2007 11:05:40 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <4616328B.60108@Royal-Tunbridge-Wells.Org>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
Message-ID: <20070407090540.GA9463@irwin.vpn.uni-freiburg.de>

On Fri, Apr 06, 2007 at 12:44:11PM +0100, Philip & Le Khanh wrote:

> As an aside, if I understand the function
> of \pdfprimitive correctly (that is, it
> allows access to a primitive whose name
> has been stolen), then it is (IMHO)
> singularly ill-named, in that it allows
> access to /all/ primitives (e.g., \show)
> rather than just PDF primitives ...  If
> this is the case, is there any chance of
> a better choice of name in a future release ?

The prefix \pdf does not mean PDF mode.
It marks a primitive that adds a new feature,
introduced by pdfTeX. (It's shorter than \pdftex).

Rationale:
A new primitive name can and will probably collide
with some existing macro name. It's impossible
to get and check all existing macro names.
  Thus each macro code provider would be forced
to check new pdfTeX versions for collisions with
new primitives to infinity. That's also impossible,
because many packages have lost their maintainers.
  As long as we don't have real namespaces, the
prefix method simulates a namespace. A macro code
provider who just avoids names starting with \pdf
is then out of trouble if new primitives are added.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From martin at oneiros.de  Sat Apr  7 14:03:52 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sat, 7 Apr 2007 14:03:52 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <4616328B.60108@Royal-Tunbridge-Wells.Org>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
Message-ID: <68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>

2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
> rather than just PDF primitives ...  If
> this is the case, is there any chance of
> a better choice of name in a future release ?

Would you prefer a pdfTeX version that suddenly has a primitive \foo
thus potentially breaking all documents already providing \foo ? :-)

Best
   Martin

From taco at elvenkind.com  Sat Apr  7 14:29:43 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Apr 2007 14:29:43 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
Message-ID: <46178EB7.2080005@elvenkind.com>

Martin Schr?der wrote:
> 2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
>> rather than just PDF primitives ...  If
>> this is the case, is there any chance of
>> a better choice of name in a future release ?
> 
> Would you prefer a pdfTeX version that suddenly has a primitive \foo
> thus potentially breaking all documents already providing \foo ? :-)

(We've been over this, I am just reiterating my viewpoint here)

Having \foo does not prevent \def\foo{} at all.

It prevents \newcommand\foo, but \pdffoo prevents \newcommand\pdffoo,
and depending on the purpose of a macro package, that can be just as
bad. The LaTeX macro was written on the assumption that the engine
would never, ever change.

That assumption is faulty today and has been for quite a few years
now, so I don't buy that we should cater for it in the executable.
In LuaTeX I will follow the eTeX paradigm, and this particular
command will be called \primitive. Only PDF-related commands will
have a \pdf prefix.

In any case, people that don't like new features can always stick
to an old(er) version of (pdf)TeX, without developments taking place.

Best wishes,
Taco

From pragma at wxs.nl  Sat Apr  7 19:53:52 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 07 Apr 2007 19:53:52 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
Message-ID: <4617DAB0.6050907@wxs.nl>

? wrote:
> 2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
>   
>> rather than just PDF primitives ...  If
>> this is the case, is there any chance of
>> a better choice of name in a future release ?
>>     
>
> Would you prefer a pdfTeX version that suddenly has a primitive \foo
> thus potentially breaking all documents already providing \foo ? :-)
>
>   
if a document provides \foo, then a nw primitive \foo is never seen because the document obscures it; actually, the user won't even notice; 

only when a macro package uses \foo there could be a problem but that's seldom the user's concern 

Hans 

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From oberdiek at uni-freiburg.de  Sat Apr  7 21:52:56 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sat, 7 Apr 2007 21:52:56 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <4617DAB0.6050907@wxs.nl>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<4617DAB0.6050907@wxs.nl>
Message-ID: <20070407195256.GA26810@irwin.vpn.uni-freiburg.de>

On Sat, Apr 07, 2007 at 07:53:52PM +0200, Hans Hagen wrote:

> ??? wrote:
> > 2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
> >   
> >> rather than just PDF primitives ...  If
> >> this is the case, is there any chance of
> >> a better choice of name in a future release ?
> >>     
> >
> > Would you prefer a pdfTeX version that suddenly has a primitive \foo
> > thus potentially breaking all documents already providing \foo ? :-)
>
> if a document provides \foo, then a nw primitive \foo is never seen
> because the document obscures it; actually, the user won't even notice;

If the document uses \newcommand, then the user will get an error.
If the user uses a package that uses the new foo, this package
will probably break.
...

> only when a macro package uses \foo there could be a problem but that's
> seldom the user's concern

Some will generate bug reports that could have been avoided in the
first place.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From pragma at wxs.nl  Sat Apr  7 23:10:51 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 07 Apr 2007 23:10:51 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070407195256.GA26810@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<4617DAB0.6050907@wxs.nl>
	<20070407195256.GA26810@irwin.vpn.uni-freiburg.de>
Message-ID: <461808DB.1030900@wxs.nl>

Heiko Oberdiek wrote:
> On Sat, Apr 07, 2007 at 07:53:52PM +0200, Hans Hagen wrote:
>
>   
>> ??? wrote:
>>     
>>> 2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
>>>   
>>>       
>>>> rather than just PDF primitives ...  If
>>>> this is the case, is there any chance of
>>>> a better choice of name in a future release ?
>>>>     
>>>>         
>>> Would you prefer a pdfTeX version that suddenly has a primitive \foo
>>> thus potentially breaking all documents already providing \foo ? :-)
>>>       
>> if a document provides \foo, then a nw primitive \foo is never seen
>> because the document obscures it; actually, the user won't even notice;
>>     
>
> If the document uses \newcommand, then the user will get an error.
> If the user uses a package that uses the new foo, this package
> will probably break.
> ...
>   

\let\mynamespacedprimitive=\primitive
\let\primitive\undefined
>   
>> only when a macro package uses \foo there could be a problem but that's
>> seldom the user's concern
>>     
>
> Some will generate bug reports that could have been avoided in the
> first place.
>   
\pdfsomething can be in use as well, you never knw what users have defined 

when etex came around \protected and \unexpanded were examples of a command that had a great potential for clashes (context had both already defined but i just use saved meanings then); such is live, such is progress 

Hans 


-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From oberdiek at uni-freiburg.de  Sun Apr  8 00:33:25 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 8 Apr 2007 00:33:25 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <461808DB.1030900@wxs.nl>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<4617DAB0.6050907@wxs.nl>
	<20070407195256.GA26810@irwin.vpn.uni-freiburg.de>
	<461808DB.1030900@wxs.nl>
Message-ID: <20070407223324.GA30005@irwin.vpn.uni-freiburg.de>

On Sat, Apr 07, 2007 at 11:10:51PM +0200, Hans Hagen wrote:

> Heiko Oberdiek wrote:
> >
> > If the document uses \newcommand, then the user will get an error.
> > If the user uses a package that uses the new foo, this package
> > will probably break.
> > ...
> >   
> 
> \let\mynamespacedprimitive=\primitive
> \let\primitive\undefined

And the package that wants to use \primitive?
A command name cannot be defined and undefined at the same time.

> \pdfsomething can be in use as well, you never knw what users have defined

Yes, but it can be considered as reserved namespace.
Thus if someone writes a package using \pdfsomething and
pdfTeX later introduces a new primitive \pdfsomething, the
package author cannot complain.

> when etex came around \protected and \unexpanded were examples of a
> command that had a great potential for clashes (context had both already
> defined but i just use saved meanings then); such is live, such is
> progress

And calling for unnecessary trouble and bug reports.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From vvv at vsu.ru  Sun Apr  8 03:34:46 2007
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sat, 07 Apr 2007 18:34:46 -0700
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <46178EB7.2080005@elvenkind.com> (Taco Hoekwater's message of
	"Sat, 07 Apr 2007 14:29:43 +0200")
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<46178EB7.2080005@elvenkind.com>
Message-ID: <87zm5jps21.fsf@external.prs-office.com>

"TH" == Taco Hoekwater writes:

 TH> In LuaTeX I will follow the eTeX paradigm, and this particular
 TH> command will be called \primitive. Only PDF-related commands will
 TH> have a \pdf prefix.

and LuaTeX later is going to be merged into pdftex...
what will happen to the primitive names, then?

if you will have renamed most of them (with stripped "pdf" at the
beginning), it will create another messy situation.

so it seems safer to stick to the already used names, otherwise there
will be a mess of prefixed and non-prefixed names (i personally also
don't like the prefix, but since it is already used, it should be
retained in both pdftex and luatex).

Best,
v.


From Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org  Sat Apr  7 15:12:40 2007
From: Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org (Philip & Le Khanh)
Date: Sat, 07 Apr 2007 14:12:40 +0100
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
Message-ID: <461798C8.5080303@Royal-Tunbridge-Wells.Org>

Yes, that was the decision we took with e-TeX, and
I do not think that with the benefit of hindsight
the decision was a mistaken one. All you are doing
by using a "pdf" prefix is /reducing/ the chances
of a namespace clash, not eliminating the possibility.

But I am not against the idea of a prefix per se;
I am more concerned that the choice of "pdf" as
the prefix for functionality that has nothing
to do with PDF can only mislead the innocent user.

** Phil.
--------
Martin Schr?der wrote:
 > 2007/4/6, Philip & Le Khanh <Philip-and-LeKhanh at royal-tunbridge-wells.org>:
 >> rather than just PDF primitives ...  If
 >> this is the case, is there any chance of
 >> a better choice of name in a future release ?
 >
 > Would you prefer a pdfTeX version that suddenly has a primitive \foo
 > thus potentially breaking all documents already providing \foo ? :-)
 >
 > Best
 >    Martin
 > _______________________________________________
 > ntg-pdftex mailing list
 > ntg-pdftex at ntg.nl
 > http://www.ntg.nl/mailman/listinfo/ntg-pdftex

From taco at elvenkind.com  Sun Apr  8 09:52:29 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 08 Apr 2007 09:52:29 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <87zm5jps21.fsf@external.prs-office.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>	<4616328B.60108@Royal-Tunbridge-Wells.Org>	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>	<46178EB7.2080005@elvenkind.com>
	<87zm5jps21.fsf@external.prs-office.com>
Message-ID: <46189F3D.9070100@elvenkind.com>

Vladimir Volovich wrote:
> "TH" == Taco Hoekwater writes:
> 
>  TH> In LuaTeX I will follow the eTeX paradigm, and this particular
>  TH> command will be called \primitive. Only PDF-related commands will
>  TH> have a \pdf prefix.
> 
> and LuaTeX later is going to be merged into pdftex...

Not merged so much as superceded. There is a traditional pdftex 1.50
yet to come, and that will be around (and bugfixed) forever.

LuaTeX's executable will continue to be named luatex, but it will
internally present itself as \pdftexversion = 2 (as well as other
version identifiers).

General policy note:

I feel free to make some changes that break compatibility on both
the input and the output side, because the major version number (as
well as the executable name) will be changed. If I did not have that
liberty, lots of things would simply not be doable.

I have already removed a few of the most recent extension primitives,
because the functionality can better be handled by lua scripting.
Think of \pdfelapsedtime and \pdffilesize.

The syntax of the \font primitive in luatex has also changed, it now
accepts a brace group as 'font identifier'. Without that change,
I would have had to invent a completely new way of specifying fonts,
and that would have been enormously confusing to both users and
macro programmers.

Luatex is *not* going to be identical to pdftex 1.xx. It will be
as compatible as is reasonable, but such compatibility is not the
first goal. The top spot is reserved for creating new functionality.
The second spot is for creating a clean base for even more development.
Compatibility comes somewhere below that.

People that want 100% pdftex, should stick with pdftex.

> if you will have renamed most of them (with stripped "pdf" at the
> beginning), it will create another messy situation.
> 
> so it seems safer to stick to the already used names, otherwise there

I will consider creating aliases, but since that can just as easily
be done by a macro package (using \protected\def), it is not very
high on my todo list. Looking back on how LaTeX has handled new engines
in the past, it is a very safe bet to assume that a \usepackage{luatex}
or a separate 'corona.fmt' will be required to make use of the new
features, anyway.

Best wishes,
Taco


From oberdiek at uni-freiburg.de  Sun Apr  8 10:56:50 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 8 Apr 2007 10:56:50 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <461798C8.5080303@Royal-Tunbridge-Wells.Org>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<461798C8.5080303@Royal-Tunbridge-Wells.Org>
Message-ID: <20070408085650.GA60@irwin.vpn.uni-freiburg.de>

On Sat, Apr 07, 2007 at 02:12:40PM +0100, Philip & Le Khanh wrote:

> Yes, that was the decision we took with e-TeX, and
> I do not think that with the benefit of hindsight
> the decision was a mistaken one. All you are doing
> by using a "pdf" prefix is /reducing/ the chances
> of a namespace clash, not eliminating the possibility.

No, it's more, it avoids future name clashes:
If a macro author avoids the name space of macro names
starting with the "pdf" prefix, then he is not bothered
by new primitives.
  Of course it does not prevent conflicts with
old macro code. Hyperref's \pdfbookmark is a prominent
example. Luckily pdfTeX named its primitive \pdfoutline.

> But I am not against the idea of a prefix per se;
> I am more concerned that the choice of "pdf" as
> the prefix for functionality that has nothing
> to do with PDF can only mislead the innocent user.

Also keep in mind, that names consisting of words,
not protected by prefixes or special characters
("@" in LaTeX) interfere with user land macro names.
Primitives are seldom intended to be used in user land
directly. Most are hidden inside higher level markup
macros (LaTeX, ConTeXt, ...). If an "innocent" user
deals with these primitives directly, he left his
"innocence".

Some time ago there was also a discussion about prefix
names. The costs for a new prefix for stuff that is useful
also for DVI mode are high:
* Inconsistency if some macros have the new prefix,
  others not. And the "cosmetic" naming problem remains.
* Or severe compatibility problems, if primitives are
  renamed that exist for a long time.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From vvv at vsu.ru  Sun Apr  8 18:46:12 2007
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun, 08 Apr 2007 09:46:12 -0700
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <46189F3D.9070100@elvenkind.com> (Taco Hoekwater's message of
	"Sun, 08 Apr 2007 09:52:29 +0200")
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<46178EB7.2080005@elvenkind.com>
	<87zm5jps21.fsf@external.prs-office.com>
	<46189F3D.9070100@elvenkind.com>
Message-ID: <874pnqq0ff.fsf@external.prs-office.com>

"TH" == Taco Hoekwater writes:

 TH> Luatex is *not* going to be identical to pdftex 1.xx. It will be
 TH> as compatible as is reasonable, but such compatibility is not the
 TH> first goal.

but you mentioned that you plan to rename lots of existing
non-PDF-related primitives by stripping the "pdf" prefix; this would
merely create problem for macro-package writers... and it doesn't
sound like it couldn't be avoided; on the other hand, avoiding
renaming of existing primitives sounds like a reasonable way to
improve compatibility. :)

Best,
v.


From pragma at wxs.nl  Mon Apr  9 15:36:32 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 09 Apr 2007 15:36:32 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <874pnqq0ff.fsf@external.prs-office.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<4616328B.60108@Royal-Tunbridge-Wells.Org>
	<68c491a60704070503t77016506y94400956e37ade9a@mail.gmail.com>
	<46178EB7.2080005@elvenkind.com>
	<87zm5jps21.fsf@external.prs-office.com>
	<46189F3D.9070100@elvenkind.com>
	<874pnqq0ff.fsf@external.prs-office.com>
Message-ID: <461A4160.3080303@wxs.nl>

Vladimir Volovich wrote:
> "TH" == Taco Hoekwater writes:
>
>  TH> Luatex is *not* going to be identical to pdftex 1.xx. It will be
>  TH> as compatible as is reasonable, but such compatibility is not the
>  TH> first goal.
>
> but you mentioned that you plan to rename lots of existing
> non-PDF-related primitives by stripping the "pdf" prefix; this would
> merely create problem for macro-package writers... and it doesn't
> sound like it couldn't be avoided; on the other hand, avoiding
> renaming of existing primitives sounds like a reasonable way to
> improve compatibility. :)
>   
we use luatex to clean up some of the mess that crept in; it makes no sense to carry around this burden forever; as taco said: pdftex will be around forever, and for straightforward open type support xetex is also an option

also, in order to support luatex beyond its 'compatibility with pdftex 1.* level' macro packages need to be adapted substantially anyway; if this is no option, pdftex is a good alternative 

Hans 


-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From taco at elvenkind.com  Tue Apr 10 12:46:03 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Apr 2007 12:46:03 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <46162AEB.4090107@elvenkind.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<46162AEB.4090107@elvenkind.com>
Message-ID: <461B6AEB.6060207@elvenkind.com>

Taco Hoekwater wrote:
> Heiko Oberdiek wrote:
>>>>   ! Undefined control sequence.
>>>>   l.2 \pdfprimitive\show
>>>>
>>>> Did I misunderstood \pdfprimitive?
>>> No, that should have worked. I will investigate.
>>
>> Thanks.
> 
> I am an idiot. I was testing \pdfprimitive itself for expandability,
> instead of its argument. There is a very small patch possible, but
> I had better do some more tests before submitting it.

Patch attached.

Best wishes,
Taco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdfprimitive-bugfix.diff
Type: text/x-patch
Size: 469 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20070410/0ce1febf/attachment.bin 

From oberdiek at uni-freiburg.de  Tue Apr 10 14:00:00 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 10 Apr 2007 14:00:00 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <461B6AEB.6060207@elvenkind.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<46162AEB.4090107@elvenkind.com> <461B6AEB.6060207@elvenkind.com>
Message-ID: <20070410120000.GA9759@irwin.vpn.uni-freiburg.de>

On Tue, Apr 10, 2007 at 12:46:03PM +0200, Taco Hoekwater wrote:

> >I was testing \pdfprimitive itself for expandability,
> >instead of its argument. There is a very small patch possible, but
> >I had better do some more tests before submitting it.
> 
> Patch attached.

Thanks.

As nearest way to restore a primitive that is
redefined somewhere I found:

\def\show{...}% some package

\let\show\relax % prevents expansion if \show is expanded
\def\show{\pdfprimitive\show}

However \show remains a macro. Thus some kind of
\pdfprimitivelet would be nice and complete the interface.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From martin at oneiros.de  Tue Apr 10 14:14:47 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 10 Apr 2007 14:14:47 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <461B6AEB.6060207@elvenkind.com>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<46162AEB.4090107@elvenkind.com> <461B6AEB.6060207@elvenkind.com>
Message-ID: <68c491a60704100514r261506e0ya160fc298113b412@mail.gmail.com>

2007/4/10, Taco Hoekwater <taco at elvenkind.com>:
> Patch attached.

Thanks. One more step towards 1.40.4 ...

Best
   Martin

From Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org  Tue Apr 10 15:00:47 2007
From: Philip-and-LeKhanh at Royal-Tunbridge-Wells.Org (Philip & Le Khanh)
Date: Tue, 10 Apr 2007 14:00:47 +0100
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070410120000.GA9759@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>	<4615F249.7080206@elvenkind.com>	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>	<46162AEB.4090107@elvenkind.com>
	<461B6AEB.6060207@elvenkind.com>
	<20070410120000.GA9759@irwin.vpn.uni-freiburg.de>
Message-ID: <461B8A7F.6000308@Royal-Tunbridge-Wells.Org>

Is there a Win-32 executable of PdfeTeX with this patch available ?
I would be interested in experimenting to see if Heiko's
desideratum can be accomplished within the existing set
of primitives.

** Phil.
--------
Heiko Oberdiek wrote:
> On Tue, Apr 10, 2007 at 12:46:03PM +0200, Taco Hoekwater wrote:
> 
>>> I was testing \pdfprimitive itself for expandability,
>>> instead of its argument. There is a very small patch possible, but
>>> I had better do some more tests before submitting it.
>> Patch attached.
> 
> Thanks.
> 
> As nearest way to restore a primitive that is
> redefined somewhere I found:
> 
> \def\show{...}% some package
> 
> \let\show\relax % prevents expansion if \show is expanded
> \def\show{\pdfprimitive\show}
> 
> However \show remains a macro. Thus some kind of
> \pdfprimitivelet would be nice and complete the interface.
> 
> Yours sincerely
>   Heiko <oberdiek at uni-freiburg.de>

From oberdiek at uni-freiburg.de  Wed Apr 11 18:35:16 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Apr 2007 18:35:16 +0200
Subject: [NTG-pdftex] \pdfprimitive
In-Reply-To: <20070410120000.GA9759@irwin.vpn.uni-freiburg.de>
References: <20070405224754.GA23417@irwin.vpn.uni-freiburg.de>
	<4615F249.7080206@elvenkind.com>
	<20070406101635.GA30102@irwin.vpn.uni-freiburg.de>
	<46162AEB.4090107@elvenkind.com> <461B6AEB.6060207@elvenkind.com>
	<20070410120000.GA9759@irwin.vpn.uni-freiburg.de>
Message-ID: <20070411163516.GA3185@irwin.vpn.uni-freiburg.de>

On Tue, Apr 10, 2007 at 02:00:00PM +0200, Heiko Oberdiek wrote:

> As nearest way to restore a primitive that is
> redefined somewhere I found:
> 
> \def\show{...}% some package
> 
> \let\show\relax % prevents expansion if \show is expanded
> \def\show{\pdfprimitive\show}

I forgot e-TeX:
  \protected\def\show{\pdfprimitive\show}

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From reinhard.kotucha at web.de  Wed Apr 11 22:52:59 2007
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 11 Apr 2007 22:52:59 +0200
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
In-Reply-To: <a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>
References: <a31ed7840703210407y6237fb52o77440e5394def2e5@mail.gmail.com>
	<1610090900.20070326145922@ujf-grenoble.fr>
	<m3slbrlsse.fsf@lugabout.jhcloos.org>
	<17928.18961.422463.316339@zarniwoop.ms25.local>
	<a31ed7840704020831w1ec8624cqcaebe793314e5a7e@mail.gmail.com>
	<17937.27223.459330.789325@zarniwoop.ms25.local>
	<a31ed7840704040837p445d836ch178e79f47da37425@mail.gmail.com>
	<17940.55.808062.92472@zarniwoop.ms25.local>
	<a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>
Message-ID: <17949.19115.804363.461487@zarniwoop.ms25.local>

Hi, I now added pdftex, NTG-pdftex, and Eddie to the CC.  

For people who did not follow the thread on the pdftex mailing list,
here is a short summary:

Marcel created some subsets of an OTF font using lcdf typetools.  One
subset used normal figures, one used oldstyle figures and one used
superscript figures.  His printer produced wrong output.

I examined the output files produced by pdftex:  All the subsets used
the same encoding scheme,  the glyph names had been /one, /two, and
/three in all subsets, the /UniqueID is the same in all subsets.  The
only difference was /FontName since an arbitrary string had been
prepended to the original /FontName.

It turned out that Marcel's printer ignores /FontName and entirely
depends on the /UniqueID.  I converted the three subsets to PFA and
wrote a small test file and even Ghostscript (-sDEVICE=X11alpha)
produced wrong output.  See:

   http://ms25.ath.cx/testfonts.ps

It works with gs if you comment out the /UniqueID in testfonts.ps but
this seems not to be sufficient for Marcel's printer because:

>>>>> "Marcel" == Marcel Korpel <marcel.lists at gmail.com> writes:

  > On 04/04/07, Reinhard Kotucha <reinhard.kotucha at web.de> wrote:
  >> The current release (1.40.3) does this already.  At least it
  >> removes the first occurrence of the UniqueID.  But there is still
  >> a UniqueID in the /Private dictionary.  Maybe it should be
  >> removed too.  I'm quite confident that no interpreter looks for a
  >> UniqueID in the /Private dictionary.

  > Well, at least the mentioned Oc? printer seems to use it. When I
  > only remove the first instance of the /UniqueID, the bug pops up
  > again...

In my opinion it is wrong to ignore /FontName.  But on the other hand
I think that it is also wrong *not* to delete the /UniqueID when a
subset of a font is created.  I don't know what the Adobe reference
manuals say, the nasty things are in the TechNotes, but it seems that
developers of PS interpreters interpret the specs slightly different
anyway.

Though I think that the /UniqueID is helpful to distinguish between
Adobe Courier and IBM Courier (shipped with X11), I now come to the
conclusion that it causes more trouble than it helps.

I don't think that it's bad that a font provides a /UniqueID.  But it
is probably quite appropriate to remove it when a subset is created.

The current release of pdftex deletes the /UniqueID from the font
dictionary but not the instance in the /Private dictionary.  But
certainly it should.

I also think that lcdf typetools should remove the /UniqueID if a font
is altered.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From kohler at cs.ucla.edu  Thu Apr 12 03:05:46 2007
From: kohler at cs.ucla.edu (Eddie Kohler)
Date: Wed, 11 Apr 2007 18:05:46 -0700
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
In-Reply-To: <17949.19115.804363.461487@zarniwoop.ms25.local>
References: <a31ed7840703210407y6237fb52o77440e5394def2e5@mail.gmail.com>	<1610090900.20070326145922@ujf-grenoble.fr>	<m3slbrlsse.fsf@lugabout.jhcloos.org>	<17928.18961.422463.316339@zarniwoop.ms25.local>	<a31ed7840704020831w1ec8624cqcaebe793314e5a7e@mail.gmail.com>	<17937.27223.459330.789325@zarniwoop.ms25.local>	<a31ed7840704040837p445d836ch178e79f47da37425@mail.gmail.com>	<17940.55.808062.92472@zarniwoop.ms25.local>	<a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>
	<17949.19115.804363.461487@zarniwoop.ms25.local>
Message-ID: <461D85EA.3040108@cs.ucla.edu>

Hi Reinhard,

How did Marcel create the subsets?  I imagine that pdftex was 
responsible for the real subsetting; that the lcdf-typetools simply 
created the initial font.

Any subset should remove any /UniqueID and Private /UniqueID, then alter 
the font's /XUID array, usually by appending numbers to it that are a 
fingerprint of the subset.  All modern printers will do the right thing 
with /XUID.  If you don't modify /XUID, you should remove it.

The specs say that two distinct fonts must not have the same /XUID (or 
/UniqueID, if /XUID doesn't exist).  Otherwise printers are allowed to 
do horrible things.  (Fonts with different /Encoding vectors or 
/FontMatrix manipulations may have the same UniqueID without problems.)

The lcdf-typetools that alter glyphs, such as mmpfb, already fixed /XUID 
and killed /UniqueID.  **EXCEPT** that I totally forgot t1dotlessj, 
which creates a dotless-j glyph font, and didn't change the UniqueID 
there.  Now I do (in version 2.62).

Eddie


Reinhard Kotucha wrote:
> Hi, I now added pdftex, NTG-pdftex, and Eddie to the CC.  
> 
> For people who did not follow the thread on the pdftex mailing list,
> here is a short summary:
> 
> Marcel created some subsets of an OTF font using lcdf typetools.  One
> subset used normal figures, one used oldstyle figures and one used
> superscript figures.  His printer produced wrong output.
> 
> I examined the output files produced by pdftex:  All the subsets used
> the same encoding scheme,  the glyph names had been /one, /two, and
> /three in all subsets, the /UniqueID is the same in all subsets.  The
> only difference was /FontName since an arbitrary string had been
> prepended to the original /FontName.
> 
> It turned out that Marcel's printer ignores /FontName and entirely
> depends on the /UniqueID.  I converted the three subsets to PFA and
> wrote a small test file and even Ghostscript (-sDEVICE=X11alpha)
> produced wrong output.  See:
> 
>    http://ms25.ath.cx/testfonts.ps
> 
> It works with gs if you comment out the /UniqueID in testfonts.ps but
> this seems not to be sufficient for Marcel's printer because:
> 
>>>>>> "Marcel" == Marcel Korpel <marcel.lists at gmail.com> writes:
> 
>   > On 04/04/07, Reinhard Kotucha <reinhard.kotucha at web.de> wrote:
>   >> The current release (1.40.3) does this already.  At least it
>   >> removes the first occurrence of the UniqueID.  But there is still
>   >> a UniqueID in the /Private dictionary.  Maybe it should be
>   >> removed too.  I'm quite confident that no interpreter looks for a
>   >> UniqueID in the /Private dictionary.
> 
>   > Well, at least the mentioned Oc? printer seems to use it. When I
>   > only remove the first instance of the /UniqueID, the bug pops up
>   > again...
> 
> In my opinion it is wrong to ignore /FontName.  But on the other hand
> I think that it is also wrong *not* to delete the /UniqueID when a
> subset of a font is created.  I don't know what the Adobe reference
> manuals say, the nasty things are in the TechNotes, but it seems that
> developers of PS interpreters interpret the specs slightly different
> anyway.
> 
> Though I think that the /UniqueID is helpful to distinguish between
> Adobe Courier and IBM Courier (shipped with X11), I now come to the
> conclusion that it causes more trouble than it helps.
> 
> I don't think that it's bad that a font provides a /UniqueID.  But it
> is probably quite appropriate to remove it when a subset is created.
> 
> The current release of pdftex deletes the /UniqueID from the font
> dictionary but not the instance in the /Private dictionary.  But
> certainly it should.
> 
> I also think that lcdf typetools should remove the /UniqueID if a font
> is altered.
> 
> Regards,
>   Reinhard
> 

From noreply at sarovar.org  Fri Apr 13 04:54:01 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Fri, 13 Apr 2007 08:24:01 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-772 ] Option -recorder does not work for
	Type1 or PK files
Message-ID: <E1HcBvF-0002ez-00@sarovar.org>

Bugs item #772, was opened at 2007-04-13 04:54
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: Option -recorder does not work for Type1 or PK files

Initial Comment:
Hello,

pdfTeX 1.40.3 supports the Web2C feature,
enabled by option -recorder.
However, it does not record all files,
.pfb (Type1) or .pk files are missing.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

PS: texmf.cnf isn't recorded either.


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

From marcel.lists at gmail.com  Thu Apr 12 10:15:04 2007
From: marcel.lists at gmail.com (Marcel Korpel)
Date: Thu, 12 Apr 2007 10:15:04 +0200
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
In-Reply-To: <461D85EA.3040108@cs.ucla.edu>
References: <a31ed7840703210407y6237fb52o77440e5394def2e5@mail.gmail.com>
	<m3slbrlsse.fsf@lugabout.jhcloos.org>
	<17928.18961.422463.316339@zarniwoop.ms25.local>
	<a31ed7840704020831w1ec8624cqcaebe793314e5a7e@mail.gmail.com>
	<17937.27223.459330.789325@zarniwoop.ms25.local>
	<a31ed7840704040837p445d836ch178e79f47da37425@mail.gmail.com>
	<17940.55.808062.92472@zarniwoop.ms25.local>
	<a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>
	<17949.19115.804363.461487@zarniwoop.ms25.local>
	<461D85EA.3040108@cs.ucla.edu>
Message-ID: <a31ed7840704120115q52a9a9dw759ce0fa40bb792c@mail.gmail.com>

On 12/04/07, Eddie Kohler <kohler at cs.ucla.edu> wrote:
> How did Marcel create the subsets?  I imagine that pdftex was
> responsible for the real subsetting; that the lcdf-typetools simply
> created the initial font.

No, I didn't use lcdf-tools, it wasn't an OTF font. I was wrong in my
initial mail. When using a different font encoding with the same PFB
fle (produced by lcdf-tools), everything was ok.

I created the subsets using Fontforge, manually, and put the right
characters in the right positions, so I could use them with pdfTeX.

Sorry for this confusion caused, I was not wholly clear.

Regards,
Marcel

From kohler at cs.ucla.edu  Thu Apr 12 16:21:14 2007
From: kohler at cs.ucla.edu (Eddie Kohler)
Date: Thu, 12 Apr 2007 07:21:14 -0700
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
In-Reply-To: <a31ed7840704120115q52a9a9dw759ce0fa40bb792c@mail.gmail.com>
References: <a31ed7840703210407y6237fb52o77440e5394def2e5@mail.gmail.com>	
	<m3slbrlsse.fsf@lugabout.jhcloos.org>	
	<17928.18961.422463.316339@zarniwoop.ms25.local>	
	<a31ed7840704020831w1ec8624cqcaebe793314e5a7e@mail.gmail.com>	
	<17937.27223.459330.789325@zarniwoop.ms25.local>	
	<a31ed7840704040837p445d836ch178e79f47da37425@mail.gmail.com>	
	<17940.55.808062.92472@zarniwoop.ms25.local>	
	<a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>	
	<17949.19115.804363.461487@zarniwoop.ms25.local>	
	<461D85EA.3040108@cs.ucla.edu>
	<a31ed7840704120115q52a9a9dw759ce0fa40bb792c@mail.gmail.com>
Message-ID: <461E405A.102@cs.ucla.edu>

Fonts produced by lcdf-typetools usually work fine with pdftex!... ??

Eddie


Marcel Korpel wrote:
> On 12/04/07, Eddie Kohler <kohler at cs.ucla.edu> wrote:
>> How did Marcel create the subsets?  I imagine that pdftex was
>> responsible for the real subsetting; that the lcdf-typetools simply
>> created the initial font.
> 
> No, I didn't use lcdf-tools, it wasn't an OTF font. I was wrong in my
> initial mail. When using a different font encoding with the same PFB
> fle (produced by lcdf-tools), everything was ok.
> 
> I created the subsets using Fontforge, manually, and put the right
> characters in the right positions, so I could use them with pdfTeX.
> 
> Sorry for this confusion caused, I was not wholly clear.
> 
> Regards,
> Marcel

From hanthethanh at gmail.com  Fri Apr 13 13:06:32 2007
From: hanthethanh at gmail.com (Thanh Han The)
Date: Fri, 13 Apr 2007 13:06:32 +0200
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
Message-ID: <74f506dc0704130406t64aa919u7b2c7db43686839@mail.gmail.com>

yes. At least for me.

Regards,
Thanh

On Thu, Apr 12, 2007 at 07:21:14AM -0700, Eddie Kohler wrote:
> Fonts produced by lcdf-typetools usually work fine with pdftex!... ??
>
> Eddie
>
>
> Marcel Korpel wrote:
> > On 12/04/07, Eddie Kohler <kohler at cs.ucla.edu> wrote:
> >> How did Marcel create the subsets?  I imagine that pdftex was
> >> responsible for the real subsetting; that the lcdf-typetools simply
> >> created the initial font.
> >
> > No, I didn't use lcdf-tools, it wasn't an OTF font. I was wrong in my
> > initial mail. When using a different font encoding with the same PFB
> > fle (produced by lcdf-tools), everything was ok.
> >
> > I created the subsets using Fontforge, manually, and put the right
> > characters in the right positions, so I could use them with pdfTeX.
> >
> > Sorry for this confusion caused, I was not wholly clear.
> >
> > Regards,
> > Marcel
> _______________________________________________
> pdftex mailing list
> pdftex at tug.org
> http://tug.org/mailman/listinfo/pdftex

From oberdiek at uni-freiburg.de  Fri Apr 13 13:33:01 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 13 Apr 2007 13:33:01 +0200
Subject: [NTG-pdftex] [pdftex] problem when using package color with
	floats
In-Reply-To: <823851.30572.qm@web54402.mail.yahoo.com>
References: <823851.30572.qm@web54402.mail.yahoo.com>
Message-ID: <20070413113300.GA3065@irwin.vpn.uni-freiburg.de>

On Fri, Apr 13, 2007 at 02:07:16AM -0700, Bintu Vasudevan wrote:

> when i redefine the macro used for floats (including figures and tables)
> so that single spacing is used. My tex file compile and as work fine.
> 
> But when i want  to usepackage{color} is hangs througing with message:
> =============================================
> ! Too many }'s.
> \color at endbox ->\color at endgroup \egroup

Typical error message in case of wrong use of \setbox
that doesn't respect the color interface of LaTeX.
This isn't specific for pdfTeX at all, thus these mailing lists
are the wrong place.

> Here is Redefined the macro defined
> -----------------------------------------------------------------------------------------------------
>  % (Note \def\figure{\@float{figure}set single spacing} doesn't work
> %  because figure has an optional argument)
> \def\@xfloat#1[#2]{\ifhmode \@bsphack\@floatpenalty -\@Mii\else
>    \@floatpenalty-\@Miii\fi\def\@captype{#1}\ifinner
>       \@parmoderr\@floatpenalty\z@
>     \else\@next\@currbox\@freelist{\@tempcnta\csname ftype@#1\endcsname
>        \multiply\@tempcnta\@xxxii\advance\@tempcnta\sixt@@n
>        \@tfor \@tempa :=#2\do
>             {\if\@tempa h\advance\@tempcnta \@ne\fi
>              \if\@tempa t\advance\@tempcnta \tw@\fi
>              \if\@tempa b\advance\@tempcnta 4\relax\fi
>              \if\@tempa p\advance\@tempcnta 8\relax\fi
>      }\global\count\@currbox\@tempcnta}\@fltovf\fi
>     \global\setbox\@currbox\vbox\bgroup
>     \def\baselinestretch{1}\@normalsize
>     \boxmaxdepth\z@
>     \hsize\columnwidth \@parboxrestore}
> -----------------------------------------------------------------------------------------------------

\setbox\@currbox\vbox\bgroup ... <color stuff> \egroup

The color stuff uses \aftergroup to reset the color.
However, in case of an unprotected \setbox, see above, these
stuff, delayed by \aftergroup, is executed *after* the box
is constructed and assigned by \setbox.

LaTeX uses an additional grouping level. Without \color the
group commands are no-ops (\relax), color redefines these
hooks as \begingroup and \endgroup.

Look at the original \@xfloat:
  ...
  \setbox\@currbox\color at vbox\normalcolor\vbox\bgroup
  ...

Without color:
  \color at vbox       = \relax
  \normalcolor      = \relax
  \color at endbox     = \relax
  \color at begingroup = \relax
  \color at endgroup   = \relax
With color:
  \color at vbox       = \vbox\bgroup\color at begingroup
  \normalcolor      = \let\current at color\default at color\set at color
  \color at endbox     = \color at endgroup\egroup
  \color at begingroup = \begingroup
  \color at endgroup   = \endgroup

Thus use either the LaTeX's higher level macros such as
  \savebox, \sbox, minipage, \parbox
or use the low level hook commands. The minimal requirement
for color is an additional grouping level:
  \setbox...=\vbox{\begingroup ...\endgroup}

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From noreply at sarovar.org  Fri Apr 13 12:46:55 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Fri, 13 Apr 2007 16:16:55 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-772 ] Option -recorder does not work for
	Type1 or PK files
Message-ID: <E1HcJIt-0004mi-00@sarovar.org>

Bugs item #772, was opened at 2007-04-13 04:54
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

>Category: web2c
>Group: v1.40.0
Status: Open
>Resolution: Accepted
>Priority: 4
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: Martin Schr?der (oneiros)
Summary: Option -recorder does not work for Type1 or PK files

Initial Comment:
Hello,

pdfTeX 1.40.3 supports the Web2C feature,
enabled by option -recorder.
However, it does not record all files,
.pfb (Type1) or .pk files are missing.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

PS: texmf.cnf isn't recorded either.


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

From bintu_gv at yahoo.com  Fri Apr 13 11:07:16 2007
From: bintu_gv at yahoo.com (Bintu Vasudevan)
Date: Fri, 13 Apr 2007 02:07:16 -0700 (PDT)
Subject: [NTG-pdftex] problem when using package color with floats
Message-ID: <823851.30572.qm@web54402.mail.yahoo.com>

Hi 

when i redefine the macro used for floats (including figures and tables)
so that single spacing is used. My tex file compile and as work fine.

But when i want  to usepackage{color} is hangs througing with message:
=============================================
! Too many }'s.
\color at endbox ->\color at endgroup \egroup

l.39 \end{figure}

?
==============================================

Here is Redefined the macro defined
-----------------------------------------------------------------------------------------------------
 % (Note \def\figure{\@float{figure}set single spacing} doesn't work
%  because figure has an optional argument)
\def\@xfloat#1[#2]{\ifhmode \@bsphack\@floatpenalty -\@Mii\else
   \@floatpenalty-\@Miii\fi\def\@captype{#1}\ifinner
      \@parmoderr\@floatpenalty\z@
    \else\@next\@currbox\@freelist{\@tempcnta\csname ftype@#1\endcsname
       \multiply\@tempcnta\@xxxii\advance\@tempcnta\sixt@@n
       \@tfor \@tempa :=#2\do
            {\if\@tempa h\advance\@tempcnta \@ne\fi
             \if\@tempa t\advance\@tempcnta \tw@\fi
             \if\@tempa b\advance\@tempcnta 4\relax\fi
             \if\@tempa p\advance\@tempcnta 8\relax\fi
     }\global\count\@currbox\@tempcnta}\@fltovf\fi
    \global\setbox\@currbox\vbox\bgroup
    \def\baselinestretch{1}\@normalsize
    \boxmaxdepth\z@
    \hsize\columnwidth \@parboxrestore}
-----------------------------------------------------------------------------------------------------
 
can some body help in this case.

Thanks in Advance

bintu



       
---------------------------------
Ahhh...imagining that irresistible "new car" smell?
 Check outnew cars at Yahoo! Autos.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20070413/56dbf4d3/attachment.html 

From marcel.lists at gmail.com  Sat Apr 14 10:25:14 2007
From: marcel.lists at gmail.com (Marcel Korpel)
Date: Sat, 14 Apr 2007 09:25:14 +0100
Subject: [NTG-pdftex] [pdftex] Font (embedding) problem
In-Reply-To: <461E405A.102@cs.ucla.edu>
References: <a31ed7840703210407y6237fb52o77440e5394def2e5@mail.gmail.com>
	<a31ed7840704020831w1ec8624cqcaebe793314e5a7e@mail.gmail.com>
	<17937.27223.459330.789325@zarniwoop.ms25.local>
	<a31ed7840704040837p445d836ch178e79f47da37425@mail.gmail.com>
	<17940.55.808062.92472@zarniwoop.ms25.local>
	<a31ed7840704111146s5b140571hccb35bce610f84c8@mail.gmail.com>
	<17949.19115.804363.461487@zarniwoop.ms25.local>
	<461D85EA.3040108@cs.ucla.edu>
	<a31ed7840704120115q52a9a9dw759ce0fa40bb792c@mail.gmail.com>
	<461E405A.102@cs.ucla.edu>
Message-ID: <a31ed7840704140125g3249815v87321bc0d73dc82e@mail.gmail.com>

On 12/04/07, Eddie Kohler <kohler at cs.ucla.edu> wrote:
> Fonts produced by lcdf-typetools usually work fine with pdftex!... ??

Yes, that's true. As I said, the problem wasn't a font created with
lcdf-typetools, as I initially thought, but a font re-encoded manually
using FontForge. When trying to use an OTF-font using lcdf-typetools,
everything went fine when using this printer.

Regards,
Marcel

From kakuto at fsci.fuk.kindai.ac.jp  Sun Apr 15 04:17:53 2007
From: kakuto at fsci.fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 15 Apr 2007 11:17:53 +0900
Subject: [NTG-pdftex] [ pdftex-Bugs-772 ] Option -recorder does not
	work	 for	Type1 or PK files
In-Reply-To: Your message of "Fri, 13 Apr 2007 16:16:55 +0530"
References: <E1HcJIt-0004mi-00@sarovar.org>
Message-ID: <200704150217.l3F2HtZU023916@jupiter.fsci.fuk.kindai.ac.jp>

Hi Heiko,

> Bugs item #772, was opened at 2007-04-13 04:54

> pdfTeX 1.40.3 supports the Web2C feature,enabled by option -recorder.
> However, it does not record all files,.pfb (Type1) or .pk files are missing.
> Yours sincerely  Heiko <oberdiek at uni-freiburg.de>
> PS: texmf.cnf isn't recorded either.

I think texmf.cnf is not read by using open_input also
in the case of the other TeX programs.

Best regards,
Akira


--- writet1.c.orig	Wed Dec 27 08:37:36 2006
+++ writet1.c	Sun Apr 15 11:00:09 2007
@@ -921,10 +921,18 @@
 static boolean t1_open_fontfile(const char *open_name_prefix)
 {
     ff_entry *ff;
-    ff = check_ff_exist(fd_cur->fm->ff_name, is_truetype(fd_cur->fm));
-    if (ff->ff_path != NULL)
-        t1_file = xfopen(cur_file_name = ff->ff_path, FOPEN_RBIN_MODE);
-    else {
+    boolean is_tt = is_truetype (fd_cur->fm);
+    ff = check_ff_exist(fd_cur->fm->ff_name, is_tt);
+    if (ff->ff_path != NULL) {
+        cur_file_name = ff->ff_path;
+        if (nameoffile) free (nameoffile);
+        nameoffile = (char *)malloc (strlen (cur_file_name) + 2);
+        (void)strcpy (nameoffile + 1, cur_file_name);
+        if (is_tt)
+            open_input (&t1_file, kpse_truetype_format, FOPEN_RBIN_MODE);
+        else
+            open_input (&t1_file, kpse_type1_format, FOPEN_RBIN_MODE);
+    } else {
         set_cur_file_name(fd_cur->fm->ff_name);
         pdftex_warn("cannot open Type 1 font file for reading");
         return false;
--- writet3.c.orig	Wed Dec 27 08:37:36 2006
+++ writet3.c	Sun Apr 15 11:02:10 2007
@@ -197,7 +197,13 @@
         cur_file_name = NULL;
         return false;
     }
-    t3_file = xfopen(name, FOPEN_RBIN_MODE);
+    if (nameoffile) free (nameoffile);
+    nameoffile = (char *)malloc (strlen (name) + 2);
+    strcpy (nameoffile + 1, name);
+    if (!open_input (&t3_file, kpse_pk_format, FOPEN_RBIN_MODE)) {
+        pdftex_warn ("missing pk font %s.", name);
+        return false;
+    }
     t3_image_used = true;
     is_pk_font = true;
     tex_printf(" <%s", (char *) name);

From oberdiek at uni-freiburg.de  Sun Apr 15 10:09:57 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sun, 15 Apr 2007 10:09:57 +0200
Subject: [NTG-pdftex] [ pdftex-Bugs-772 ] Option -recorder does not
	work	 for	Type1 or PK files
In-Reply-To: <200704150217.l3F2HtZU023916@jupiter.fsci.fuk.kindai.ac.jp>
References: <E1HcJIt-0004mi-00@sarovar.org>
	<200704150217.l3F2HtZU023916@jupiter.fsci.fuk.kindai.ac.jp>
Message-ID: <20070415080957.GA23404@irwin.vpn.uni-freiburg.de>

Hello,

On Sun, Apr 15, 2007 at 11:17:53AM +0900, Akira Kakuto wrote:

> Hi Heiko,
> 
> > Bugs item #772, was opened at 2007-04-13 04:54
> 
> > pdfTeX 1.40.3 supports the Web2C feature,enabled by option -recorder.
> > However, it does not record all files,.pfb (Type1) or .pk files are missing.
> > Yours sincerely  Heiko <oberdiek at uni-freiburg.de>
> > PS: texmf.cnf isn't recorded either.
> 
> I think texmf.cnf is not read by using open_input also
> in the case of the other TeX programs.

Yes, therefore I only put it in the "PS:" part.
Other files not catched in this sense are "aliases", "ls-R".

> --- writet1.c.orig	Wed Dec 27 08:37:36 2006
> +++ writet1.c	Sun Apr 15 11:00:09 2007
[...]
> --- writet3.c.orig	Wed Dec 27 08:37:36 2006
> +++ writet3.c	Sun Apr 15 11:02:10 2007
[...]

Many thanks, these files are now recorded.

After further testing (sorry) I found other gaps in file name recording:

\pdfximage{<file>}
\pdffilesize{<file>}
\pdffilemoddate{<file>}
\pdffiledump{<file>}
\pdfmdfivesum file{<file>}

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>
-- 

From noreply at sarovar.org  Sun Apr 15 23:20:26 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Mon, 16 Apr 2007 02:50:26 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-774 ] UniqueID in subsetted Type1 fonts
Message-ID: <E1HdC94-0006XI-00@sarovar.org>

Bugs item #774, was opened at 2007-04-15 23:20
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=774&group_id=106

Category: Fonts
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Reinhard Kotucha (reinhard)
Assigned to: Hartmut Henkel (hhenkel)
Summary: UniqueID in subsetted Type1 fonts

Initial Comment:
The currant version of pdftex removes the UniqueID from
the font dictionary when a subset of a Type1 font is
included.  However, there is still a UniqueID in the
Private dictionary which should be removed too.

>From the PostScript Language Reference Manual (p. 336):

> When you copy a font dictionary for the purpose of 
> creating a modified font, you should not copy the 
> UniqueID or XUID entry. As an exception to this 
> general rule, it is acceptable (and preferable) to 
> retain the original UniqueID or XUID entry if
> the only modified entries are FontName, FontInfo, 
> FontMatrix, or Encoding, because those changes do not
> affect the glyphs? appearance or metrics.

Regards,
  Reinhard

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=774&group_id=106

From noreply at sarovar.org  Mon Apr 16 11:59:55 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Mon, 16 Apr 2007 15:29:55 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-775 ] Build failure on alpha-linux with
	certain gcc versions
Message-ID: <E1HdO03-00014q-00@sarovar.org>

Bugs item #775, was opened at 2007-04-16 11:59
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

Category: Build process
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Frank K?ster (frank)
Assigned to: Martin Schr?der (oneiros)
Summary: Build failure on alpha-linux with certain gcc versions

Initial Comment:
pdftex fails to build on Linux-alpha with newer gcc
versions.  This is a known bug in gcc, but it's very
obscure and it seems unlikely to be solved soon. 
Therefore you might consider to apply the patch below
as a workaround.

Falk Hueffner wrote in the Debian BTS
(http://bugs.debian.org/419434):

[...]
gcc -DHAVE_CONFIG_H  -I.
-I../../../../texk/web2c/pdftexdir -I..
-I../../../../texk/web2c/pdftexdir/../..  -I..
-I../../../../texk/web2c/pdftexdir/.. -I../..
-I../../../../texk/web2c/pdftexdir/../..
-I../../../libs/md5
-I../../../../texk/web2c/pdftexdir/../../../libs/md5
-I../../../libs/xpdf -I../../../libs/xpdf/..
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf/..
-I../../../libs/obsdcompat
-I../../../libs/obsdcompat/..
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat/..
-DpdfTeX -g -O2  -c
../../../../texk/web2c/pdftexdir/writezip.c -o writezip.o
../../../../texk/web2c/pdftexdir/writezip.c: In
function 'writezip':
../../../../texk/web2c/pdftexdir/writezip.c:75: error:
unrecognizable insn:
(insn 139 138 140 9
../../../../texk/web2c/pdftexdir/writezip.c:54 (set
(reg:DI 141)
        (plus:DI (reg/f:DI 138)
            (const_int 32768 [0x8000]))) -1 (nil)
    (nil))
../../../../texk/web2c/pdftexdir/writezip.c:75:
internal compiler error: in extract_insn, at recog.c:2084
Please submit a full bug report,
with preprocessed source if appropriate.
See <URL:http://gcc.gnu.org/bugs.html> for instructions.
For Debian GNU/Linux specific bug reporting instructions,
see <URL:file:///usr/share/doc/gcc-4.1/README.Bugs>.
Preprocessed source stored into /tmp/ccKHjfIv.out file,
please attach this to your bugreport.
make[4]: *** [writezip.o] Error 1
make[4]: Leaving directory
`/build/buildd/texlive-bin-2007/build/source/Work/texk/web2c/pdftexdir'

(log at
http://buildd.debian.org/fetch.cgi?pkg=texlive-bin&arch=alpha&ver=2007-3&stamp=1176603526)

The reason is an obscure bug in gcc that only triggers
when accessing exactly the 32767th element of a
character array. Since I don't know how fix it in gcc
and nobody else seems to be working on that, I suggest
you apply the following workaround:



----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

From noreply at sarovar.org  Mon Apr 16 12:04:14 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Mon, 16 Apr 2007 15:34:14 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-775 ] Build failure on alpha-linux with
	certain gcc versions
Message-ID: <E1HdO4E-00017n-00@sarovar.org>

Bugs item #775, was opened at 2007-04-16 11:59
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

Category: Build process
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Frank K?ster (frank)
Assigned to: Martin Schr?der (oneiros)
Summary: Build failure on alpha-linux with certain gcc versions

Initial Comment:
pdftex fails to build on Linux-alpha with newer gcc
versions.  This is a known bug in gcc, but it's very
obscure and it seems unlikely to be solved soon. 
Therefore you might consider to apply the patch below
as a workaround.

Falk Hueffner wrote in the Debian BTS
(http://bugs.debian.org/419434):

[...]
gcc -DHAVE_CONFIG_H  -I.
-I../../../../texk/web2c/pdftexdir -I..
-I../../../../texk/web2c/pdftexdir/../..  -I..
-I../../../../texk/web2c/pdftexdir/.. -I../..
-I../../../../texk/web2c/pdftexdir/../..
-I../../../libs/md5
-I../../../../texk/web2c/pdftexdir/../../../libs/md5
-I../../../libs/xpdf -I../../../libs/xpdf/..
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf/..
-I../../../libs/obsdcompat
-I../../../libs/obsdcompat/..
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat/..
-DpdfTeX -g -O2  -c
../../../../texk/web2c/pdftexdir/writezip.c -o writezip.o
../../../../texk/web2c/pdftexdir/writezip.c: In
function 'writezip':
../../../../texk/web2c/pdftexdir/writezip.c:75: error:
unrecognizable insn:
(insn 139 138 140 9
../../../../texk/web2c/pdftexdir/writezip.c:54 (set
(reg:DI 141)
        (plus:DI (reg/f:DI 138)
            (const_int 32768 [0x8000]))) -1 (nil)
    (nil))
../../../../texk/web2c/pdftexdir/writezip.c:75:
internal compiler error: in extract_insn, at recog.c:2084
Please submit a full bug report,
with preprocessed source if appropriate.
See <URL:http://gcc.gnu.org/bugs.html> for instructions.
For Debian GNU/Linux specific bug reporting instructions,
see <URL:file:///usr/share/doc/gcc-4.1/README.Bugs>.
Preprocessed source stored into /tmp/ccKHjfIv.out file,
please attach this to your bugreport.
make[4]: *** [writezip.o] Error 1
make[4]: Leaving directory
`/build/buildd/texlive-bin-2007/build/source/Work/texk/web2c/pdftexdir'

(log at
http://buildd.debian.org/fetch.cgi?pkg=texlive-bin&arch=alpha&ver=2007-3&stamp=1176603526)

The reason is an obscure bug in gcc that only triggers
when accessing exactly the 32767th element of a
character array. Since I don't know how fix it in gcc
and nobody else seems to be working on that, I suggest
you apply the following workaround:



----------------------------------------------------------------------

>Comment By: Frank K?ster (frank)
Date: 2007-04-16 12:04

Message:
Logged In: YES 
user_id=3360

forgot to tick the "attach file" box

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

From javier at digi21.net  Mon Apr 16 14:07:00 2007
From: javier at digi21.net (=?ISO-8859-1?Q?Javier_M=FAgica_de_Rivera?=)
Date: Mon, 16 Apr 2007 14:07:00 +0200
Subject: [NTG-pdftex] \mathsurround
Message-ID: <462366E4.806@digi21.net>

I recently needed to typeset a narrow column with some math, so very 
dificult to find break points resulting in acceptable looking lines. I 
found that the best solution would be achieved if I had, say, 
\mathsurround=0pt plus2pt, but \muthsurround is a dimen, not a skip. Is 
there any particular reason why it is not a glue? If there is not, it 
would be easy to implement, wouldn't it?

--Javier


From taco at elvenkind.com  Tue Apr 17 11:23:35 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 17 Apr 2007 11:23:35 +0200
Subject: [NTG-pdftex] \mathsurround
In-Reply-To: <462366E4.806@digi21.net>
References: <462366E4.806@digi21.net>
Message-ID: <46249217.8050401@elvenkind.com>



Javier M?gica de Rivera wrote:
> I recently needed to typeset a narrow column with some math, so very 
> dificult to find break points resulting in acceptable looking lines. I 
> found that the best solution would be achieved if I had, say, 
> \mathsurround=0pt plus2pt, but \muthsurround is a dimen, not a skip. 
> Is there any particular reason why it is not a glue? 

I've been thinking about that. I can't come up with a valid reason
other than that dimens are easier to handle internally than skips,
but I may have overlooked something.

> If there is not, it would be easy to implement, wouldn't it?

Implementation would not be hard, afaict.

Best,
Taco

From dak at gnu.org  Tue Apr 17 11:30:30 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 17 Apr 2007 11:30:30 +0200
Subject: [NTG-pdftex] \mathsurround
In-Reply-To: <46249217.8050401@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 17 Apr 2007 11\:23\:35 +0200")
References: <462366E4.806@digi21.net> <46249217.8050401@elvenkind.com>
Message-ID: <86mz17qrex.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> Javier M?gica de Rivera wrote:
>> I recently needed to typeset a narrow column with some math, so very 
>> dificult to find break points resulting in acceptable looking lines. I 
>> found that the best solution would be achieved if I had, say, 
>> \mathsurround=0pt plus2pt, but \muthsurround is a dimen, not a skip. 
>> Is there any particular reason why it is not a glue? 
>
> I've been thinking about that. I can't come up with a valid reason
> other than that dimens are easier to handle internally than skips,
> but I may have overlooked something.
>
>> If there is not, it would be easy to implement, wouldn't it?
>
> Implementation would not be hard, afaict.

Skips require reference counting.  That's quite a bookkeeping
nuisance.

-- 
David Kastrup

From taco at elvenkind.com  Tue Apr 17 11:43:51 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 17 Apr 2007 11:43:51 +0200
Subject: [NTG-pdftex] \mathsurround
In-Reply-To: <86mz17qrex.fsf@lola.quinscape.zz>
References: <462366E4.806@digi21.net> <46249217.8050401@elvenkind.com>
	<86mz17qrex.fsf@lola.quinscape.zz>
Message-ID: <462496D7.2080905@elvenkind.com>



David Kastrup wrote:
>>> If there is not, it would be easy to implement, wouldn't it?
>> Implementation would not be hard, afaict.
> 
> Skips require reference counting.  That's quite a bookkeeping
> nuisance.

That is possible, but not required. We can just as easy store the
entire glue as fields inside the math nodes. For now, we should
focus on whether or not a move from dimen to skip would have
unwanted side-effects.

Taco


From dak at gnu.org  Tue Apr 17 11:47:33 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 17 Apr 2007 11:47:33 +0200
Subject: [NTG-pdftex] \mathsurround
In-Reply-To: <462496D7.2080905@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 17 Apr 2007 11\:43\:51 +0200")
References: <462366E4.806@digi21.net> <46249217.8050401@elvenkind.com>
	<86mz17qrex.fsf@lola.quinscape.zz> <462496D7.2080905@elvenkind.com>
Message-ID: <86irbvqqmi.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> David Kastrup wrote:
>>>> If there is not, it would be easy to implement, wouldn't it?
>>> Implementation would not be hard, afaict.
>>
>> Skips require reference counting.  That's quite a bookkeeping
>> nuisance.
>
> That is possible, but not required. We can just as easy store the
> entire glue as fields inside the math nodes. For now, we should
> focus on whether or not a move from dimen to skip would have
> unwanted side-effects.

I think that the mathsurround does not actually make it into the
surrounding horizontal list explicitly.  This might make it hard to
let it partake in glue calculations properly.

-- 
David Kastrup

From noreply at sarovar.org  Tue Apr 17 13:19:36 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Tue, 17 Apr 2007 16:49:36 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-772 ] Option -recorder does not work for
	Type1 or PK files
Message-ID: <E1Hdlii-0001W9-00@sarovar.org>

Bugs item #772, was opened at 2007-04-13 04:54
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

Category: web2c
Group: v1.40.0
Status: Open
Resolution: Accepted
Priority: 4
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Martin Schr?der (oneiros)
Summary: Option -recorder does not work for Type1 or PK files

Initial Comment:
Hello,

pdfTeX 1.40.3 supports the Web2C feature,
enabled by option -recorder.
However, it does not record all files,
.pfb (Type1) or .pk files are missing.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

PS: texmf.cnf isn't recorded either.


----------------------------------------------------------------------

>Comment By: Heiko Oberdiek (oberdiek)
Date: 2007-04-17 13:19

Message:
Logged In: YES 
user_id=1276

Hello,

to prevent that it gets lost, a followup of mine in
ntg-pdftex mailing list:

After further testing (sorry) I found other gaps in file
name recording:

\pdfximage{<file>}
\pdffilesize{<file>}
\pdffilemoddate{<file>}
\pdffiledump{<file>}
\pdfmdfivesum file{<file>}

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=772&group_id=106

From noreply at sarovar.org  Tue Apr 17 22:48:51 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 18 Apr 2007 02:18:51 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces are
	not recognized
Message-ID: <E1Hduba-0004Q7-00@sarovar.org>

Bugs item #776, was opened at 2007-04-17 22:48
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

Category: Primitives
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Reinhard Kotucha (reinhard)
Assigned to: Nobody (None)
Summary: Filenames with multiple spaces are not recognized

Initial Comment:
$ echo 'hello world\bye' > hello\ \ world.tex
$ cat hello\ \ world.tex 
hello world\bye
$ pdftex hello\ \ world.tex 
This is pdfTeX, Version 3.141592-1.40.3 (Web2C 7.5.6)
entering extended mode
! I can't find file `"hello world.tex"'.
<*> "hello  world.tex"
                      
Please type another input file name:


It seems that pdftex gets the correct name (with two
spaces) but it is searching for something different.

Regards,
  Reinhard


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

From noreply at sarovar.org  Tue Apr 17 23:20:43 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 18 Apr 2007 02:50:43 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces are
	not recognized
Message-ID: <E1Hdv6R-0007Vr-00@sarovar.org>

Bugs item #776, was opened at 2007-04-17 22:48
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

Category: Primitives
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Reinhard Kotucha (reinhard)
Assigned to: Nobody (None)
Summary: Filenames with multiple spaces are not recognized

Initial Comment:
$ echo 'hello world\bye' > hello\ \ world.tex
$ cat hello\ \ world.tex 
hello world\bye
$ pdftex hello\ \ world.tex 
This is pdfTeX, Version 3.141592-1.40.3 (Web2C 7.5.6)
entering extended mode
! I can't find file `"hello world.tex"'.
<*> "hello  world.tex"
                      
Please type another input file name:


It seems that pdftex gets the correct name (with two
spaces) but it is searching for something different.

Regards,
  Reinhard


----------------------------------------------------------------------

>Comment By: Taco Hoekwater (taco)
Date: 2007-04-17 23:20

Message:
Logged In: YES 
user_id=1608

It will handle this properly:

$ pdftex hello\ \space\ world.tex

The problem (of course) is that the tokenizer will fold two
(or more) tokens of \catcode 10 into a single one, so you
have to prevent tex from seeing two of these in-a-row.

It may actually be possible to fix the case where the file
is given as a single argument on the commandline, but fixing
the general case is unreasonably hard (e.g. \input commands
used inside macros), I do not think would be worth the
effort and therefore vote for documenting the current
behaviour as a known limitation.


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

From noreply at sarovar.org  Tue Apr 17 23:36:59 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 18 Apr 2007 03:06:59 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces are
	not recognized
Message-ID: <E1HdvMB-0000EF-00@sarovar.org>

Bugs item #776, was opened at 2007-04-18 02:18
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

Category: Primitives
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Reinhard Kotucha (reinhard)
Assigned to: Nobody (None)
Summary: Filenames with multiple spaces are not recognized

Initial Comment:
$ echo 'hello world\bye' > hello\ \ world.tex
$ cat hello\ \ world.tex 
hello world\bye
$ pdftex hello\ \ world.tex 
This is pdfTeX, Version 3.141592-1.40.3 (Web2C 7.5.6)
entering extended mode
! I can't find file `"hello world.tex"'.
<*> "hello  world.tex"
                      
Please type another input file name:


It seems that pdftex gets the correct name (with two
spaces) but it is searching for something different.

Regards,
  Reinhard


----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-18 03:06

Message:
Logged In: NO 

The command line is scanned by TeX.  The catcodes for the
filename are determined by the format.

If you want TeX to be able to deal with multiple spaces, you
can do so by doing
\everyjob\expandafter{\the\everyjob \catcode`\ =10\relax}
\catcode`\ =12 \dump%
as the last thing when generating your format file.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2007-04-18 02:50

Message:
Logged In: YES 
user_id=1608

It will handle this properly:

$ pdftex hello\ \space\ world.tex

The problem (of course) is that the tokenizer will fold two
(or more) tokens of \catcode 10 into a single one, so you
have to prevent tex from seeing two of these in-a-row.

It may actually be possible to fix the case where the file
is given as a single argument on the commandline, but fixing
the general case is unreasonably hard (e.g. \input commands
used inside macros), I do not think would be worth the
effort and therefore vote for documenting the current
behaviour as a known limitation.


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

From javier at digi21.net  Wed Apr 18 18:08:32 2007
From: javier at digi21.net (=?ISO-8859-1?Q?Javier_M=FAgica_de_Rivera?=)
Date: Wed, 18 Apr 2007 18:08:32 +0200
Subject: [NTG-pdftex] \mathsurround
In-Reply-To: <86irbvqqmi.fsf@lola.quinscape.zz>
References: <462366E4.806@digi21.net>
	<46249217.8050401@elvenkind.com>	<86mz17qrex.fsf@lola.quinscape.zz>
	<462496D7.2080905@elvenkind.com> <86irbvqqmi.fsf@lola.quinscape.zz>
Message-ID: <46264280.4050801@digi21.net>

When I wrote about \mathsurround I had also in mind another limitation, 
but this one seems much more dificult to change. It is the fact that we 
may only want the mathsurround glue to be inserted if the math formula 
would otherwise still be adjacent to a glue or a kern, not counting 
intermediate whatsits or penalties; or better, to have a 
\shortmathsurround for the other cases. It is even delicate to formaly 
define the rules we want to follow. For the moment I think it is enough 
if \mathsurround is changed to be a skip.

However I will not forget about this idea. If muthsurround exists it 
should be possible to have it behave the way we would like (as authors). 
When I have looked at the tex sources and learned more about the 
internals I will try to look about it, but it is likely that this year I 
will have very few time.



From noreply at sarovar.org  Wed Apr 18 18:13:22 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 18 Apr 2007 21:43:22 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces are
	not recognized
Message-ID: <E1HeCmY-0006iK-00@sarovar.org>

Bugs item #776, was opened at 2007-04-17 22:48
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

Category: Primitives
>Group: v1.40.0
>Status: Closed
>Resolution: Wont Fix
Priority: 5
Submitted By: Reinhard Kotucha (reinhard)
Assigned to: Nobody (None)
Summary: Filenames with multiple spaces are not recognized

Initial Comment:
$ echo 'hello world\bye' > hello\ \ world.tex
$ cat hello\ \ world.tex 
hello world\bye
$ pdftex hello\ \ world.tex 
This is pdfTeX, Version 3.141592-1.40.3 (Web2C 7.5.6)
entering extended mode
! I can't find file `"hello world.tex"'.
<*> "hello  world.tex"
                      
Please type another input file name:


It seems that pdftex gets the correct name (with two
spaces) but it is searching for something different.

Regards,
  Reinhard


----------------------------------------------------------------------

>Comment By: Martin Schr?der (oneiros)
Date: 2007-04-18 18:13

Message:
Logged In: YES 
user_id=421

I agree: This is simply an undocumented misfeature. Anybody
who uses space in filenames in TeX does so at this own risk,
and this should be documented. I don't think the time for
fixing this is justified.

----------------------------------------------------------------------

Comment By: Nobody (None)
Date: 2007-04-17 23:36

Message:
Logged In: NO 

The command line is scanned by TeX.  The catcodes for the
filename are determined by the format.

If you want TeX to be able to deal with multiple spaces, you
can do so by doing
\everyjob\expandafter{\the\everyjob \catcode`\ =10\relax}
\catcode`\ =12 \dump%
as the last thing when generating your format file.

----------------------------------------------------------------------

Comment By: Taco Hoekwater (taco)
Date: 2007-04-17 23:20

Message:
Logged In: YES 
user_id=1608

It will handle this properly:

$ pdftex hello\ \space\ world.tex

The problem (of course) is that the tokenizer will fold two
(or more) tokens of \catcode 10 into a single one, so you
have to prevent tex from seeing two of these in-a-row.

It may actually be possible to fix the case where the file
is given as a single argument on the commandline, but fixing
the general case is unreasonably hard (e.g. \input commands
used inside macros), I do not think would be worth the
effort and therefore vote for documenting the current
behaviour as a known limitation.


----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=776&group_id=106

From noreply at sarovar.org  Wed Apr 18 18:15:38 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Wed, 18 Apr 2007 21:45:38 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-775 ] Build failure on alpha-linux with
	certain gcc versions
Message-ID: <E1HeCok-00079L-00@sarovar.org>

Bugs item #775, was opened at 2007-04-16 11:59
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

Category: Build process
>Group: v1.40.0
Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Frank K?ster (frank)
Assigned to: Martin Schr?der (oneiros)
Summary: Build failure on alpha-linux with certain gcc versions

Initial Comment:
pdftex fails to build on Linux-alpha with newer gcc
versions.  This is a known bug in gcc, but it's very
obscure and it seems unlikely to be solved soon. 
Therefore you might consider to apply the patch below
as a workaround.

Falk Hueffner wrote in the Debian BTS
(http://bugs.debian.org/419434):

[...]
gcc -DHAVE_CONFIG_H  -I.
-I../../../../texk/web2c/pdftexdir -I..
-I../../../../texk/web2c/pdftexdir/../..  -I..
-I../../../../texk/web2c/pdftexdir/.. -I../..
-I../../../../texk/web2c/pdftexdir/../..
-I../../../libs/md5
-I../../../../texk/web2c/pdftexdir/../../../libs/md5
-I../../../libs/xpdf -I../../../libs/xpdf/..
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf
-I../../../../texk/web2c/pdftexdir/../../../libs/xpdf/..
-I../../../libs/obsdcompat
-I../../../libs/obsdcompat/..
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat
-I../../../../texk/web2c/pdftexdir/../../../libs/obsdcompat/..
-DpdfTeX -g -O2  -c
../../../../texk/web2c/pdftexdir/writezip.c -o writezip.o
../../../../texk/web2c/pdftexdir/writezip.c: In
function 'writezip':
../../../../texk/web2c/pdftexdir/writezip.c:75: error:
unrecognizable insn:
(insn 139 138 140 9
../../../../texk/web2c/pdftexdir/writezip.c:54 (set
(reg:DI 141)
        (plus:DI (reg/f:DI 138)
            (const_int 32768 [0x8000]))) -1 (nil)
    (nil))
../../../../texk/web2c/pdftexdir/writezip.c:75:
internal compiler error: in extract_insn, at recog.c:2084
Please submit a full bug report,
with preprocessed source if appropriate.
See <URL:http://gcc.gnu.org/bugs.html> for instructions.
For Debian GNU/Linux specific bug reporting instructions,
see <URL:file:///usr/share/doc/gcc-4.1/README.Bugs>.
Preprocessed source stored into /tmp/ccKHjfIv.out file,
please attach this to your bugreport.
make[4]: *** [writezip.o] Error 1
make[4]: Leaving directory
`/build/buildd/texlive-bin-2007/build/source/Work/texk/web2c/pdftexdir'

(log at
http://buildd.debian.org/fetch.cgi?pkg=texlive-bin&arch=alpha&ver=2007-3&stamp=1176603526)

The reason is an obscure bug in gcc that only triggers
when accessing exactly the 32767th element of a
character array. Since I don't know how fix it in gcc
and nobody else seems to be working on that, I suggest
you apply the following workaround:



----------------------------------------------------------------------

Comment By: Frank K?ster (frank)
Date: 2007-04-16 12:04

Message:
Logged In: YES 
user_id=3360

forgot to tick the "attach file" box

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=775&group_id=106

From reinhard.kotucha at web.de  Wed Apr 18 21:50:31 2007
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 18 Apr 2007 21:50:31 +0200
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces
	are not recognized
In-Reply-To: <E1HeCmY-0006iK-00@sarovar.org>
References: <E1HeCmY-0006iK-00@sarovar.org>
Message-ID: <17958.30343.420508.565322@zarniwoop.ms25.local>

Many thanks to Nobody (whoever this is) and Taco.

The tex file is generated by a perl script, hence it should be very
easy to be fixed.  BTW, I don't need \everyjob here because I don't
use format files.  This makes things even easier.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-4592165
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From dak at gnu.org  Wed Apr 18 22:24:42 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 18 Apr 2007 22:24:42 +0200
Subject: [NTG-pdftex] [ pdftex-Bugs-776 ] Filenames with multiple spaces
	are not recognized
In-Reply-To: <17958.30343.420508.565322@zarniwoop.ms25.local> (Reinhard
	Kotucha's message of "Wed\, 18 Apr 2007 21\:50\:31 +0200")
References: <E1HeCmY-0006iK-00@sarovar.org>
	<17958.30343.420508.565322@zarniwoop.ms25.local>
Message-ID: <85odll8m7p.fsf@lola.goethe.zz>

Reinhard Kotucha <reinhard.kotucha at web.de> writes:

> Many thanks to Nobody (whoever this is) and Taco.
>
> The tex file is generated by a perl script, hence it should be very
> easy to be fixed.  BTW, I don't need \everyjob here because I don't
> use format files.  This makes things even easier.

Well, I just noticed that I am Nobody.

I realized this kind of nonsense, by the way, from trying to use
XMLTeX as a format.  XMLTeX turns - into an active character in order
to inhibit ligatures.  It turns out that as a consequence, XMLTeX as a
format can't accept filenames with - signs on the command line.

It is left as an exercise to the reader to figure out how the
interaction of format and file name is supposed to work in the
presence of -parse-first-line: it would appear to me that in this case
the file name needs to get established before the format name.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From noreply at sarovar.org  Fri Apr 20 22:18:46 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Sat, 21 Apr 2007 01:48:46 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-777 ] Bug fix for \pdfunescapehex
Message-ID: <E1HezZ8-0002UA-00@sarovar.org>

Bugs item #777, was opened at 2007-04-20 22:18
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=777&group_id=106

Category: None
Group: None
Status: Open
Resolution: None
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
Assigned to: Nobody (None)
Summary: Bug fix for \pdfunescapehex

Initial Comment:
The patch is based on pdftex-1.40.3 and fixes a bug
of \pdfunescapehex:

\pdfunescapehex returns a wrong result, if the last
character is not a hexadecimal digit and the last
hex pair is incomplete.

Test:

\def\test#1#2{%
  \edef\x{\pdfunescapehex{#1}}%
  \edef\y{\detokenize{#2}}%
  \immediate\write16{%
    [\detokenize{#1}] -> %
    [\x] \ifx\x\y= \else<> \fi [\y]%
  }%
}
\test{50}{P}% ok
\test{50X}{P}% ok
\test{5 }{P}% bug
\test{5X}{P}% bug
\csname @@end\endcsname
\end

Bug fix is attached:
utils.c.diff patches pdftexdir/utils.c.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=777&group_id=106

From noreply at sarovar.org  Fri Apr 20 22:36:37 2007
From: noreply at sarovar.org (noreply at sarovar.org)
Date: Sat, 21 Apr 2007 02:06:37 +0530
Subject: [NTG-pdftex] [ pdftex-Bugs-777 ] Bug fix for \pdfunescapehex
Message-ID: <E1HezqP-0003bd-00@sarovar.org>

Bugs item #777, was opened at 2007-04-20 22:18
You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=777&group_id=106

>Category: Primitives
>Group: v1.40.0
Status: Open
>Resolution: Accepted
Priority: 5
Submitted By: Heiko Oberdiek (oberdiek)
>Assigned to: Martin Schr?der (oneiros)
Summary: Bug fix for \pdfunescapehex

Initial Comment:
The patch is based on pdftex-1.40.3 and fixes a bug
of \pdfunescapehex:

\pdfunescapehex returns a wrong result, if the last
character is not a hexadecimal digit and the last
hex pair is incomplete.

Test:

\def\test#1#2{%
  \edef\x{\pdfunescapehex{#1}}%
  \edef\y{\detokenize{#2}}%
  \immediate\write16{%
    [\detokenize{#1}] -> %
    [\x] \ifx\x\y= \else<> \fi [\y]%
  }%
}
\test{50}{P}% ok
\test{50X}{P}% ok
\test{5 }{P}% bug
\test{5X}{P}% bug
\csname @@end\endcsname
\end

Bug fix is attached:
utils.c.diff patches pdftexdir/utils.c.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

----------------------------------------------------------------------

You can respond by visiting: 
http://sarovar.org/tracker/?func=detail&atid=493&aid=777&group_id=106

From dak at gnu.org  Wed Apr 25 14:53:51 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 25 Apr 2007 14:53:51 +0200
Subject: [NTG-pdftex] This is such a mess...
Message-ID: <86647k8vj4.fsf@lola.quinscape.zz>

A non-text attachment was scrubbed...
Name: not available
Type: text/x-tex
Size: 136 bytes
Desc: not available
Url : http://www.ntg.nl/pipermail/ntg-pdftex/attachments/20070425/343c6bb9/attachment.bin 

