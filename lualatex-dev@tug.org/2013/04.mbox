From elie.roux at telecom-bretagne.eu  Thu Apr 11 19:33:14 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 11 Apr 2013 19:33:14 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
Message-ID: <5166F3DA.8010609@telecom-bretagne.eu>

Dear all,

Here is a copy of a mail I just sent by mistake to 
lualatex-dev at googlegroups.com instead of this address. If you answer it, 
can you please send your reply also to other people outside this group?

Thank you,
--
Elie

-------- Original Message --------
Subject: LuaLaTeX for TeXLive 2013
Date: Thu, 11 Apr 2013 19:29:46 +0200
From: ?lie Roux <elie.roux at telecom-bretagne.eu>
To: lualatex-dev at googlegroups.com,  Philipp Gesang 
<philipp.gesang at alumni.uni-heidelberg.de>, George Nurser 
<gnurser at gmail.com>, ??? ?????? Vafa Khalighi <vafa at live.com.au>, 
Khaled Hosny <khaledhosny at eglug.org>, Paul Isambert 
<zappathustra at free.fr>,  Mojca Miklavec <mojca.miklavec.lists at gmail.com>

Dear all,

After some years of pause in my TeX activities, I'm considering to come
back to it, especially since LuaTeX 0.75 breaks the LuaLaTeX packages
and I need them to work for another project.

As I hardly followed the lists, I don't really know who is involved in
all this, so I'm writing to lualatex-dev at googlegroups.com and to other
people I know are interested and involved. There are certainly more
people outside, please consider forwarding this mail to them. I didn't
manage to find the administration interface of the googlegroup so I do
not know who subscribed, sorry if some of you receive this email twice
or if I forgot someone.

I took the initiative, after some discussions, to start working on this,
with the great and precious help of Philipp Gesang without who the
update of luaotfload would certainly not be possible.

The purpose of this quite long mail is to discuss, inform, take advices
and critics, and welcome help on ideas, development and testing.

Here is the current state :
  - luaotfload v1 [1] and v2 [2] break with LuaTeX? 0.75
  - luatexbase [3] breaks with LuaTeX 0.75
  - fontspec [4] and unicode-math [5] break with luaotfload v2
  - lualibs [6] seems ok, but it might be a good idea to update it

The following ideas have appeared and are started, do not hesitate to
comment, on the ideas or their implementations:
  1. adapt luaotfload v1 and v2 to LuaTeX 0.75
  2. adapt luatexbase to LuaTeX 0.75
  3. make a luaotfload v3 (or v2.1) with code updated from the ConTeXt
     code that will ship in TeXLive 2013
  4. update lualibs with the same ConTeXt code, keeping backward
     compatibility by adding a backward compatibility file
  5. make fontspec and unicode-math compatible with luaotfload v2 and v3
     (keeping backward compatibility)
  6. make a more developped lualibs with other libraries

Different developments on these ideas:

  1. updates of luaotfload v1 and v2 for compatibility with LuaTeX 0.75
     are available on [7] and [8], to be tested further. It also fixes
     some small issues. Note that this just adapts the old code for
     compatibility with new LuaTeX, it does not really update the code.

  2. update of luatexbase is available on [9], to be tested further.
     I think what I did is not really what should be done and I'll update
     it, but it's quite a small update...

  3. Phlipp Gesang is working on luaotfload v3, in collaboration with
     Hans Hagen on [10], and has an update of fontspec on [11]. The new
     luaotfload will certainly use a copy of luatex-fonts.lua, an
     integrated file made by Hans in order to make his fontloader code
     useable outside ConTeXt. The code is from the beta currently in
     TeXLive 2013.

  4. Philipp will work on the update of lualibs when the font code will
     be stable.

  5. For fontspec adaptation, most of the work had already been done by
     Khaled, I just merged it with the current master and made it
     backward compatible with luaotfload v1, it's on [12]. For
     unicode-math, the adaptation is quite simple and is one [13]. I'm
     not sure it works with luaotfload v3.

  6. Philipp had a very interesting idea: it was to rename the current
     lualibs into lualibs-essentials and to make a lualibs-extended with
     goodies from ConTeXt like introspection, instant serialization, a
     json parser, converters for dimensions, etc. I personally think it
     is a very good idea, but I would like to have your opinion on this.

The main questions are: what do you think about all this? Would you have
time to test or contribute? How do you think we should proceed?

Here is a proposal, but I'm not really sure about it, so do not hesitate
to criticize it:

  - first we could update luaotfload v1 and luatexbase on CTAN, for
    people testing TeXLive 2013, as these are really mandatory for
    LuaTeX 0.75. Once I'll have it finished, I'll ask Manuel to
    review and upload on CTAN. Manuel, does it seem ok?

  - then update fontspec and unicode-math on CTAN too, so that people
    can test the new luaotfload easily. This would require some further
    testing and synchronization between [11] and [12], but it can be
    quite fast. Once it will be done, we would have already something
    useable and a little updated in TeXLive! Will, what do you think?

  - the most interesting but difficult part: test luaotfload v3
    extensively, against many uses (complex scripts, maths, etc.), when
    Philipp will consider his code stable enough. This will require tests
    by people with experience in the domain... I was, of course,
    thinking about Khaled. Khaled, I know you don't have time to be
    involved in all this, but would you have some very hard documents or
    test files on arabic or math? Of course, everyone is kindly
    encouraged to test with all possible documents!

Thank you all for everything,
--
Elie

[1] https://github.com/khaledhosny/luaotfload/tree/texlive2011 (it is
     the version currently on CTAN and in TeXLive 2012)
[2] https://github.com/khaledhosny/luaotfload/
[3] https://github.com/mpg/luatexbase/
[4] https://github.com/wspr/fontspec/
[5] https://github.com/wspr/unicode-math
[6] https://github.com/mpg/lualibs
[7] https://github.com/eroux/luaotfload/
[8] https://github.com/eroux/luaotfload/tree/texlive2011
[9] https://github.com/eroux/luatexbase
[10] https://github.com/phi-gamma/luaotfload/tree/experimental
[11] https://github.com/phi-gamma/fontspec/tree/experimental
[12] https://github.com/eroux/fontspec/tree/otfl-unstable
[13] https://github.com/eroux/unicode-math


From lstonys at vtex.lt  Fri Apr 12 08:58:26 2013
From: lstonys at vtex.lt (Linas Stonys)
Date: Fri, 12 Apr 2013 09:58:26 +0300
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5166F3DA.8010609@telecom-bretagne.eu>
References: <5166F3DA.8010609@telecom-bretagne.eu>
Message-ID: <5167B092.6020206@vtex.lt>

Hi, All,
What about compiling .luc files for otf font cache and load it instead 
of .lua ones? Or maybe use .luc for all of the lua files, like PYTHON 
does with .pyc files?
The idea was written here:
http://tug.org/pipermail/luatex/2013-March/004101.html

In the future would be good that font cache files could be loaded using 
kpsea library.

Linas

> Different developments on these ideas:
>
>   1. updates of luaotfload v1 and v2 for compatibility with LuaTeX 0.75
>      are available on [7] and [8], to be tested further. It also fixes
>      some small issues. Note that this just adapts the old code for
>      compatibility with new LuaTeX, it does not really update the code.

From elie.roux at telecom-bretagne.eu  Fri Apr 12 09:13:38 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 12 Apr 2013 09:13:38 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5167B092.6020206@vtex.lt>
References: <5166F3DA.8010609@telecom-bretagne.eu> <5167B092.6020206@vtex.lt>
Message-ID: <5167B422.4070507@telecom-bretagne.eu>

Dear Linas,

> What about compiling .luc files for otf font cache and load it instead
> of .lua ones? Or maybe use .luc for all of the lua files, like PYTHON
> does with .pyc files?
> The idea was written here:
> http://tug.org/pipermail/luatex/2013-March/004101.html

This is already the case with luaotfload v2, and will of course still be 
the case with v3.

> In the future would be good that font cache files could be loaded using
> kpsea library.

Good idea. I don't really have time to test carrefully right now, but I 
think it's already the case if you pass the good arguments to kpse*.

Thank you,
-- 
Elie

From lstonys at vtex.lt  Fri Apr 12 09:37:41 2013
From: lstonys at vtex.lt (Linas Stonys)
Date: Fri, 12 Apr 2013 10:37:41 +0300
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5167B422.4070507@telecom-bretagne.eu>
References: <5166F3DA.8010609@telecom-bretagne.eu> <5167B092.6020206@vtex.lt>
 <5167B422.4070507@telecom-bretagne.eu>
Message-ID: <5167B9C5.5040903@vtex.lt>

Dear ?lie,
for example, if I want to edit temp-<fontname>.lua file, I can't do it 
in local directory (actually I can, bet luatex will not load it now).
So, there should be a strict place for creation of them. But loading 
could be done by kpsea (like with other standard "configuration" files 
like: psfont.map, updmap.cfg, and others)

TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).

I could edit it for my self, for example:
TEXMFCACHE=.//;$TEXMFVAR


>
> Good idea. I don't really have time to test carrefully right now, but I
> think it's already the case if you pass the good arguments to kpse*.
>
> Thank you,

From elie.roux at telecom-bretagne.eu  Fri Apr 12 10:11:42 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 12 Apr 2013 10:11:42 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5167B9C5.5040903@vtex.lt>
References: <5166F3DA.8010609@telecom-bretagne.eu> <5167B092.6020206@vtex.lt>
 <5167B422.4070507@telecom-bretagne.eu> <5167B9C5.5040903@vtex.lt>
Message-ID: <5167C1BE.6090602@telecom-bretagne.eu>

On 12/04/2013 09:37, Linas Stonys wrote:
> Dear ?lie,
> for example, if I want to edit temp-<fontname>.lua file, I can't do it
> in local directory (actually I can, bet luatex will not load it now).
> So, there should be a strict place for creation of them. But loading
> could be done by kpsea (like with other standard "configuration" files
> like: psfont.map, updmap.cfg, and others)
>
> TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).
>
> I could edit it for my self, for example:
> TEXMFCACHE=.//;$TEXMFVAR

Ok, I understand better now, sorry. Karl, do you think it would be a 
good idea to make this change?

Thank you,
-- 
Elie

From wspr81 at gmail.com  Fri Apr 12 10:27:51 2013
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 12 Apr 2013 17:57:51 +0930
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5166F3DA.8010609@telecom-bretagne.eu>
References: <5166F3DA.8010609@telecom-bretagne.eu>
Message-ID: <A2178019-4194-40E5-A1D1-6D0013DDCC4B@gmail.com>

(Sent from my phone.) 

On 12/04/2013, at 3:03 AM, ?lie Roux <elie.roux at telecom-bretagne.eu> wrote:

> - then update fontspec and unicode-math on CTAN too, so that people
>   can test the new luaotfload easily. This would require some further
>   testing and synchronization between [11] and [12], but it can be
>   quite fast. Once it will be done, we would have already something
>   useable and a little updated in TeXLive! Will, what do you think?

Definitely, this sounds like a good approach. I can make sure updates are pushed to ctan promptly. 

W

From elie.roux at telecom-bretagne.eu  Fri Apr 12 10:45:51 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 12 Apr 2013 10:45:51 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <A2178019-4194-40E5-A1D1-6D0013DDCC4B@gmail.com>
References: <5166F3DA.8010609@telecom-bretagne.eu>
 <A2178019-4194-40E5-A1D1-6D0013DDCC4B@gmail.com>
Message-ID: <5167C9BF.8070701@telecom-bretagne.eu>

On 12/04/2013 10:27, Will Robertson wrote:
> (Sent from my phone.)
>
> On 12/04/2013, at 3:03 AM, ?lie Roux<elie.roux at telecom-bretagne.eu>  wrote:
>
>> - then update fontspec and unicode-math on CTAN too, so that people
>>    can test the new luaotfload easily. This would require some further
>>    testing and synchronization between [11] and [12], but it can be
>>    quite fast. Once it will be done, we would have already something
>>    useable and a little updated in TeXLive! Will, what do you think?
>
> Definitely, this sounds like a good approach. I can make sure updates are pushed to ctan promptly.

Hello Will,

This is great!

I'll tell you when we get to a point where fontspec and unicode-math can 
be uploaded to ctan, It will most certainly be in a few days.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Fri Apr 12 20:16:42 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 12 Apr 2013 20:16:42 +0200
Subject: [lltx] LuaLaTeX for TeXLive 2013
In-Reply-To: <5166F30A.4010401@telecom-bretagne.eu>
References: <5166F30A.4010401@telecom-bretagne.eu>
Message-ID: <20130412181642.GB2425@khaled-laptop>

On Thu, Apr 11, 2013 at 07:29:46PM +0200, ?lie Roux wrote:
>  - the most interesting but difficult part: test luaotfload v3
>    extensively, against many uses (complex scripts, maths, etc.), when
>    Philipp will consider his code stable enough. This will require tests
>    by people with experience in the domain... I was, of course,
>    thinking about Khaled. Khaled, I know you don't have time to be
>    involved in all this, but would you have some very hard documents or
>    test files on arabic or math? Of course, everyone is kindly
>    encouraged to test with all possible documents!

I actually don?t have that many LaTeX documents?, so the tests in
luaotfload repository would be much more useful.

Regards,
Khaled

? I actually have only 2 of them :) an article for TUGBoat that I wrote
  in Plain but Karl decided to LaTeXify it, and a font manual that I
  wrote very recently using XeTeX because I wanted to use HarfBuzz.

From karl at freefriends.org  Sat Apr 13 01:16:57 2013
From: karl at freefriends.org (Karl Berry)
Date: Fri, 12 Apr 2013 23:16:57 +0000
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <5167C1BE.6090602@telecom-bretagne.eu>
Message-ID: <201304122316.r3CNGvDW003479@freefriends.org>

    > TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).

Mojca, does ConTeXt use TEXMFCACHE?  Would this disturb anything?

In general, having another variable name/tree in texmf.cnf does not make
me happy, but if it's the right thing to do, fine.  Can someone please
describe its purpose (as distinct from the other trees) in a couple of
sentences so I can put it into the documentation?

Thanks,
Karl

Date: Fri, 12 Apr 2013 10:11:42 +0200
From: ??lie Roux <elie.roux at telecom-bretagne.eu>
To: Linas Stonys <lstonys at vtex.lt>
CC: lualatex-dev at tug.org,
        Philipp Gesang <philipp.gesang at alumni.uni-heidelberg.de>,
        Karl Berry <karl at freefriends.org>
Subject: Re: [lltx] Fwd: LuaLaTeX for TeXLive 2013

On 12/04/2013 09:37, Linas Stonys wrote:
> Dear ??lie,
> for example, if I want to edit temp-<fontname>.lua file, I can't do it
> in local directory (actually I can, bet luatex will not load it now).
> So, there should be a strict place for creation of them. But loading
> could be done by kpsea (like with other standard "configuration" files
> like: psfont.map, updmap.cfg, and others)
>
> TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).
>
> I could edit it for my self, for example:
> TEXMFCACHE=.//;$TEXMFVAR

Ok, I understand better now, sorry. Karl, do you think it would be a 
good idea to make this change?

Thank you,
-- 
Elie

From mojca.miklavec.lists at gmail.com  Sat Apr 13 01:48:27 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 13 Apr 2013 01:48:27 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <201304122316.r3CNGvDW003479@freefriends.org>
References: <5167C1BE.6090602@telecom-bretagne.eu>
 <201304122316.r3CNGvDW003479@freefriends.org>
Message-ID: <CALBOmsYOCozBRzm=nsoHXFxU+xVeoooZ3qszKqQZTY+0oqKzCg@mail.gmail.com>

On Apr 13, 2013 1:17 AM, "Karl Berry" wrote:
>
>     > TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).
>
> Mojca, does ConTeXt use TEXMFCACHE?  Would this disturb anything?

Yes, ConTeXt uses it for filename database, font cache, ..., see
texmfcnf.lua, but only for luatex, and the value for latex could/should be
the same anyway. (Doesn't lualatex use texmfcnf.lua?)

Mojca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130413/b1a1086d/attachment.html>

From elie.roux at telecom-bretagne.eu  Sat Apr 13 16:55:12 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 13 Apr 2013 16:55:12 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <CALBOmsYOCozBRzm=nsoHXFxU+xVeoooZ3qszKqQZTY+0oqKzCg@mail.gmail.com>
References: <5167C1BE.6090602@telecom-bretagne.eu>	<201304122316.r3CNGvDW003479@freefriends.org>
 <CALBOmsYOCozBRzm=nsoHXFxU+xVeoooZ3qszKqQZTY+0oqKzCg@mail.gmail.com>
Message-ID: <516971D0.8000605@telecom-bretagne.eu>

On 13/04/2013 01:16, Karl Berry wrote:
>> TEXMFCACHE could be added to texmf.cnf (TEXMFCACHE=$TEXMFVAR).
>
> In general, having another variable name/tree in texmf.cnf does not
> make me happy, but if it's the right thing to do, fine.  Can someone
> please describe its purpose (as distinct from the other trees) in a
> couple of sentences so I can put it into the documentation?

Maybe there is a similarity with FC_CACHEDIR? I have to say I don't know 
how it's used by XeTeX or ConTeXt.

Anyway, TEXMFCACHE would be the place to look for cached file, currently 
only fonts.


On 13/04/2013 01:48, Mojca Miklavec wrote:
>
> Yes, ConTeXt uses it for filename database, font cache, ..., see
> texmfcnf.lua, but only for luatex, and the value for latex
> could/should be the same anyway. (Doesn't lualatex use
> texmfcnf.lua?)

LuaLaTeX doesn't use texmfcnf.lua, currently it doesn't need it and it 
seems really ConTeXt-specific (as written in the file). But maybe 
TEXMFCACHE could belong here?... how does the kpse library handle 
texmfcnf.lua?

Maybe we're not yet ready to add TEXMFCACHE, a temporary solution would 
be to fix the loader for it to look in the current directory...

What do you think?

Also, I was wondering if it was a good idea to change

TEXINPUTS.lualatex = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
TEXINPUTS.dvilualatex = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//

for

TEXINPUTS.lualatex = 
.;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//
TEXINPUTS.dvilualatex = 
.;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//

?

Thank you,
-- 
Elie

From karl at freefriends.org  Sun Apr 14 01:12:42 2013
From: karl at freefriends.org (Karl Berry)
Date: Sat, 13 Apr 2013 23:12:42 +0000
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <516971D0.8000605@telecom-bretagne.eu>
Message-ID: <201304132312.r3DNCg0l031401@freefriends.org>

    Maybe there is a similarity with FC_CACHEDIR?

All I know about that is what other people told me and I put into the
description in texmf.cnf.  It's not related to the general (huge) luatex
cache, in any case.

Mojca, let me ask this (which is what I should have asked in the first
place): will ConTeXt be disturbed if I add TEXMFCACHE to texmf.cnf?

I guess the default value could/should be the same, namely:
  $TEXMFSYSVAR;$TEXMFVAR
so it seems like it should be safe, but I'm never sure of anything ...

    how does the kpse library handle texmfcnf.lua?

It doesn't.

Thanks,
k

From karl at freefriends.org  Sun Apr 14 01:19:27 2013
From: karl at freefriends.org (Karl Berry)
Date: Sat, 13 Apr 2013 23:19:27 +0000
Subject: [lltx] TEXINPUTS.lualatex
Message-ID: <201304132319.r3DNJRP1031630@freefriends.org>

    [change to]
    TEXINPUTS.lualatex = 
    .;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//
    TEXINPUTS.dvilualatex = 
    .;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//

Probably.  In practice, can lualatex actually read the (few) existing
lamed/lambda files?  Looks like oinuit.sty and ocherokee.sty might be
the only two ... can you check?

BTW, looking into this, it seems there is no lamed/ directory and, as
far as I can see, never has been.  Maybe I'll take that out of the
paths, unless you see some reason for it to stay.  The lamed format is
built using lambda.ini ...

Thanks,
K

From elie.roux at telecom-bretagne.eu  Sun Apr 14 09:29:46 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sun, 14 Apr 2013 09:29:46 +0200
Subject: [lltx] TEXINPUTS.lualatex
In-Reply-To: <201304132319.r3DNJRP1031630@freefriends.org>
References: <201304132319.r3DNJRP1031630@freefriends.org>
Message-ID: <516A5AEA.7020401@telecom-bretagne.eu>

On 14/04/2013 01:19, Karl Berry wrote:
>      [change to]
>      TEXINPUTS.lualatex =
>      .;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//
>      TEXINPUTS.dvilualatex =
>      .;$TEXMF/tex/{lualatex,lamed,lambda,latex,luatex,generic,}//
>
> Probably.  In practice,

Those are probably the good words... my point was more "philosophical", 
but I didn't even check what was in there...

> can lualatex actually read the (few) existing
> lamed/lambda files?  Looks like oinuit.sty and ocherokee.sty might be
> the only two ... can you check?

It doesn't, as these use \ocp which is deprecated in LuaTeX (not useful 
anymore)... So you can safely ignore my first request, sorry. There are 
some files that could technically be used (ot1omarab.fd), but I'm not 
sure why someone would use this, as it is quite linked with the other 
deprecated files.

> BTW, looking into this, it seems there is no lamed/ directory and, as
> far as I can see, never has been.  Maybe I'll take that out of the
> paths, unless you see some reason for it to stay.  The lamed format is
> built using lambda.ini ...

Ok. At least my request wasn't that useles...

Thank you,
-- 
Elie

From mojca.miklavec.lists at gmail.com  Sun Apr 14 10:37:30 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 14 Apr 2013 10:37:30 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <201304132312.r3DNCg0l031401@freefriends.org>
References: <516971D0.8000605@telecom-bretagne.eu>
 <201304132312.r3DNCg0l031401@freefriends.org>
Message-ID: <CALBOmsYrb3d9uCTPB9m5vb=CYedO=wKHqRxi=3TUkwqLCsMukQ@mail.gmail.com>

On Apr 14, 2013 1:12 AM, "Karl Berry" wrote:
>
>     Maybe there is a similarity with FC_CACHEDIR?
>
> All I know about that is what other people told me and I put into the
> description in texmf.cnf.  It's not related to the general (huge) luatex
> cache, in any case.

It's only used for xetex in windows only.

> Mojca, let me ask this (which is what I should have asked in the first
> place): will ConTeXt be disturbed if I add TEXMFCACHE to texmf.cnf?

No. Mkii doesn't use it and mkiv doesn't read texmf.cnf. Feel free to add
it, I only suggest to use the same value in both texmf.cnf and texmfcnf.lua.

Mojca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130414/5e5be4b3/attachment.html>

From elie.roux at telecom-bretagne.eu  Sun Apr 14 15:30:19 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sun, 14 Apr 2013 15:30:19 +0200
Subject: [lltx] Microtype update
Message-ID: <516AAF6B.8040605@telecom-bretagne.eu>

Dear Robert,

Philipp Gesang and I are currently updating the luaotfload and fontspec 
packages for LuaTeX, most certainly for TeXLive 2013. This is quite a 
heavy update and it implies some backward-incompatible changes in the 
lua structures of the font files.

The attached patch microtype-patch.diff make microtype compatible with 
the new luaotfload (TeXLive 2013) and the old one (TeXLive 2009-2012).

Also, luatexbase is now really widespread and stable, while luatextra is 
deprecated, so the attached patch microtype-patch-luatexbase.diff makes 
microtype use luatexbase instead of luatextra. Also, luatexbase is 
really available everywhere so I made it a requirement, but feel free to 
do otherwise... I think it is safe though.

Please tell me your feeling about this. Do you think you could make an 
update for TeXLive 2013 (freezing on May 20th)?

Thank you very much,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: microtype-patch.diff
Type: text/x-patch
Size: 1067 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130414/59ede9db/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: microtype-patch-luatexbase.diff
Type: text/x-patch
Size: 1242 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130414/59ede9db/attachment-0001.bin>

From elie.roux at telecom-bretagne.eu  Sun Apr 14 19:12:36 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sun, 14 Apr 2013 19:12:36 +0200
Subject: [lltx] [luatex] lua module search behaviour
In-Reply-To: <516A8721.2070309@wxs.nl>
References: <5169115F.7010907@telecom-bretagne.eu>
 <51692FB0.2040407@elvenkind.com> <516939ED.4010709@telecom-bretagne.eu>
 <516951E3.5060401@elvenkind.com> <516961E7.3050005@telecom-bretagne.eu>
 <516A6471.7070006@elvenkind.com> <516A7FEA.8040602@telecom-bretagne.eu>
 <516A8721.2070309@wxs.nl>
Message-ID: <516AE384.5090702@telecom-bretagne.eu>

> have you configured the variable
>
> OVFFONTS
>
> tfm/ofm nv/ovf both use the o variables

After some research, I managed to find a solution to my problems with 
the two attached file.

If I understand correctly:
  - when luatex sees the asked font omarab.ofm, it looks for 
omarab.ofm.ovp [1] and doesn't find it
  - with the toolchain aleph -> dvips, dvips looks for omarab.ovp and 
finds it [2]

It seems a bit weird to try to find omarab.ofm with type ovp, as:

$ kpsewhich -format ovp omarab.ofm
$ kpsewhich -format ovp omarab
/usr/share/texmf-texlive/fonts/ovp/public/omega/omarab.ovp

Now, this could be alright and it could be documented (I'm thinking of 
section 2.7.12 of the manual) that one should not call an ofm font with 
its extension.

But! there is another problem which I think is related: if I use 
ConTeXt's fonts*.lua files of any version, I have to register the 
find_vf_file callback (with the same function as in my file) otherwise 
ofm files don't work, even when called without the ofm extension... So 
it might be related with something in LuaTeX, not ConTeXt, as ConTeXt 
just calls font.read_tfm and returns...

What do you think?

Thank you!
--
Elie

[1]: see the output of
luatex --kpathsea-debug=-1 tfmofm.tex 2>&1 |grep ovf |grep omarab
if you remove the callback

[2]: see the output of
dvips -d 3650 tfmofm.dvi 2>&1 |grep ovf |grep omarab
if you remove the first line of the .tex file
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tfmofm.lua
Type: text/x-lua
Size: 275 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130414/9ae3ff0a/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tfmofm.tex
Type: application/x-tex
Size: 75 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130414/9ae3ff0a/attachment.tex>

From elie.roux at telecom-bretagne.eu  Mon Apr 15 09:02:58 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Mon, 15 Apr 2013 09:02:58 +0200
Subject: [lltx] [luatex] lua module search behaviour
In-Reply-To: <516AE384.5090702@telecom-bretagne.eu>
References: <5169115F.7010907@telecom-bretagne.eu>
 <51692FB0.2040407@elvenkind.com> <516939ED.4010709@telecom-bretagne.eu>
 <516951E3.5060401@elvenkind.com> <516961E7.3050005@telecom-bretagne.eu>
 <516A6471.7070006@elvenkind.com> <516A7FEA.8040602@telecom-bretagne.eu>
 <516A8721.2070309@wxs.nl> <516AE384.5090702@telecom-bretagne.eu>
Message-ID: <516BA622.5070307@telecom-bretagne.eu>

Dear Taco and all,

Here is a patch that fixes all the problems (including those with 
luaotfload):

Index: tfmofm.w
===================================================================
--- tfmofm.w	(r?vision 4633)
+++ tfmofm.w	(copie de travail)
@@ -623,7 +623,7 @@
      /* cnom can be an absolute filename, xbasename() fixes that. */

      tmpnam = strdup(xbasename(cnom));
-    if (strcmp(tmpnam + strlen(tmpnam) - 4, ".tfm") == 0) {
+    if (strcmp(tmpnam + strlen(tmpnam) - 4, ".tfm") == 0 || 
strcmp(tmpnam + strlen(tmpnam) - 4, ".ofm") == 0) {
          *(tmpnam + strlen(tmpnam) - 4) = 0;
      }
      set_font_name(f, tmpnam);


Could this reach TeXLive 2013?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Mon Apr 15 09:35:10 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Mon, 15 Apr 2013 09:35:10 +0200
Subject: [lltx] [luatex] lua module search behaviour
In-Reply-To: <516BA622.5070307@telecom-bretagne.eu>
References: <5169115F.7010907@telecom-bretagne.eu>
 <51692FB0.2040407@elvenkind.com> <516939ED.4010709@telecom-bretagne.eu>
 <516951E3.5060401@elvenkind.com> <516961E7.3050005@telecom-bretagne.eu>
 <516A6471.7070006@elvenkind.com> <516A7FEA.8040602@telecom-bretagne.eu>
 <516A8721.2070309@wxs.nl> <516AE384.5090702@telecom-bretagne.eu>
 <516BA622.5070307@telecom-bretagne.eu>
Message-ID: <516BADAE.6060909@telecom-bretagne.eu>

While we are in patches, can you also consider the one I just attached 
on http://tracker.luatex.org/view.php?id=787? (attached to this mail 
too). It fixes myalatexformat (bugs 787 and 746). I CC the list as some 
people will be happy to see this fixed... Do you think it could also 
reach TeXLive 2013?

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex-format.patch
Type: text/x-patch
Size: 512 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130415/185290f4/attachment.bin>

From taco at docwolves.nl  Mon Apr 15 19:07:36 2013
From: taco at docwolves.nl (Taco hoekwater)
Date: Mon, 15 Apr 2013 19:07:36 +0200
Subject: [lltx] [luatex] lua module search behaviour
In-Reply-To: <516BADAE.6060909@telecom-bretagne.eu>
References: <5169115F.7010907@telecom-bretagne.eu>
 <51692FB0.2040407@elvenkind.com> <516939ED.4010709@telecom-bretagne.eu>
 <516951E3.5060401@elvenkind.com> <516961E7.3050005@telecom-bretagne.eu>
 <516A6471.7070006@elvenkind.com> <516A7FEA.8040602@telecom-bretagne.eu>
 <516A8721.2070309@wxs.nl> <516AE384.5090702@telecom-bretagne.eu>
 <516BA622.5070307@telecom-bretagne.eu> <516BADAE.6060909@telecom-bretagne.eu>
Message-ID: <AB61BAC7-58C3-4D99-88F9-FC7A7C2C4BA5@docwolves.nl>



Op 15 apr. 2013 om 09:35 heeft ?lie Roux <elie.roux at telecom-bretagne.eu> het volgende geschreven:

> While we are in patches, can you also consider the one I just attached on http://tracker.luatex.org/view.php?id=787? (attached to this mail too). It fixes myalatexformat (bugs 787 and 746). I CC the list as some people will be happy to see this fixed... Do you think it could also reach TeXLive 2013?

I would be happy to apply both to TL this year, but I have no access tonight. If someone else with write access wants to step in, that would be nice. Otherwise: tomorrow morning local time (Europe/Amsterdam) and hope it is still in time.

Best wishes,
Taco



From karl at freefriends.org  Mon Apr 15 23:31:00 2013
From: karl at freefriends.org (Karl Berry)
Date: Mon, 15 Apr 2013 21:31:00 +0000
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <CALBOmsYrb3d9uCTPB9m5vb=CYedO=wKHqRxi=3TUkwqLCsMukQ@mail.gmail.com>
Message-ID: <201304152131.r3FLV0o7013908@freefriends.org>

    mm> [FC_CACHEDIR] is only used for xetex in windows only.

Doesn't ConTeXt use it, on all platforms?  That's what I was told at one
point, don't know by who.

    mm> Feel free to add [TEXMFCACHE], I only suggest to use the same
    value in both texmf.cnf and texmfcnf.lua.

Definitely.  Committed the new texmf.cnf just now.


Thanks,
Karl

From mojca.miklavec.lists at gmail.com  Tue Apr 16 07:53:53 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 16 Apr 2013 07:53:53 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <201304152131.r3FLV0o7013908@freefriends.org>
References: <CALBOmsYrb3d9uCTPB9m5vb=CYedO=wKHqRxi=3TUkwqLCsMukQ@mail.gmail.com>
 <201304152131.r3FLV0o7013908@freefriends.org>
Message-ID: <CALBOmsZM75Bm+ta64TyzM1HmkUAJxut30VkGThbqYVvWM9g9WA@mail.gmail.com>

On Apr 15, 2013 11:31 PM, "Karl Berry" wrote:
>
>     mm> [FC_CACHEDIR] is only used for xetex in windows only.
>
> Doesn't ConTeXt use it, on all platforms?  That's what I was told at one
> point, don't know by who.

No, just for XeTeX on Windows. But it uses the other FC variable to find
fonts.conf with LuaTeX on all platforms.

Mojca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130416/bc39bc05/attachment.html>

From w.m.l at gmx.net  Fri Apr 19 23:54:53 2013
From: w.m.l at gmx.net (Robert)
Date: Fri, 19 Apr 2013 23:54:53 +0200
Subject: [lltx] Microtype update
In-Reply-To: <516AAF6B.8040605@telecom-bretagne.eu>
References: <516AAF6B.8040605@telecom-bretagne.eu>
Message-ID: <5171BD2D.6030002@gmx.net>

Dear ?lie, all,

On 14.04.13 15:30, ?lie Roux wrote:
> The attached patch microtype-patch.diff make microtype compatible with
> the new luaotfload (TeXLive 2013) and the old one (TeXLive 2009-2012).

many thanks indeed for the patches, I will incorporate them in the next 
version. I cannot test with 0.75, as the oberdiek bundle hasn't been 
updated (right?), so I'll take your word for it.

> Also, luatexbase is now really widespread and stable, while luatextra is
> deprecated, so the attached patch microtype-patch-luatexbase.diff makes
> microtype use luatexbase instead of luatextra. Also, luatexbase is
> really available everywhere so I made it a requirement, but feel free to
> do otherwise... I think it is safe though.

OK.

> Please tell me your feeling about this. Do you think you could make an
> update for TeXLive 2013 (freezing on May 20th)?

There's one nasty bug I need to fix until then, but this seems doable.

Thanks again and best regards,
-- 
  Robert

From elie.roux at telecom-bretagne.eu  Sat Apr 20 11:18:49 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sat, 20 Apr 2013 11:18:49 +0200
Subject: [lltx] Microtype update
In-Reply-To: <5171BD2D.6030002@gmx.net>
References: <516AAF6B.8040605@telecom-bretagne.eu> <5171BD2D.6030002@gmx.net>
Message-ID: <51725D79.3000401@telecom-bretagne.eu>

Dear Robert, all,

> many thanks indeed for the patches, I will incorporate them in the next
> version.

Thank you very much!

> I cannot test with 0.75, as the oberdiek bundle hasn't been
> updated (right?), so I'll take your word for it.

I do not think so. If you want to test you can use the two attached 
files. oberdiek.luatex.lua comes from a new unreleased version of the 
oberdiek bundle, pdftexcmds.lua has just a raw fix by me. It's not 
official but it's just in case you want to try.

>> Please tell me your feeling about this. Do you think you could make an
>> update for TeXLive 2013 (freezing on May 20th)?
>
> There's one nasty bug I need to fix until then, but this seems doable.

Great! I heard the date of the package freeze will be around May 20th so 
you still have time... The new luaotfload has a really active 
development, and lots of good things appear in it, I hope we'll manage 
to release it before the freeze...

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: oberdiek.luatex.lua
Type: text/x-lua
Size: 1953 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130420/120dd62b/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdftexcmds.lua
Type: text/x-lua
Size: 9102 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130420/120dd62b/attachment-0001.bin>

From elie.roux at telecom-bretagne.eu  Mon Apr 22 18:36:25 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Mon, 22 Apr 2013 18:36:25 +0200
Subject: [lltx] Fwd: LuaLaTeX for TeXLive 2013
In-Reply-To: <201304152131.r3FLV0o7013908@freefriends.org>
References: <201304152131.r3FLV0o7013908@freefriends.org>
Message-ID: <51756709.3090202@telecom-bretagne.eu>

 >
>      mm>  Feel free to add [TEXMFCACHE], I only suggest to use the same
>      value in both texmf.cnf and texmfcnf.lua.
>
> Definitely.  Committed the new texmf.cnf just now.

Thank you!

The new version of luaotfload (certainly available before the package 
freeze) takes it into consideration.

Also, Karl, there was a question on which I wanted to have your opinion: 
we have the script mkluatexfontdb in luaotfload. This script generates 
the font names cache database. In the future version, we (well, Philipp) 
added more features to it, and we would like to rename it into 
"fontdbutil", keeping also the old name (with a symbolic link, the 
script having a different behaviour according to the name with which 
it's called).
What do you think about the name fontdbutil? Do you think we should 
rename it with a "luatex" somewhere?

Thank you,
-- 
Elie

From karl at freefriends.org  Wed Apr 24 17:11:49 2013
From: karl at freefriends.org (Karl Berry)
Date: Wed, 24 Apr 2013 15:11:49 +0000
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <51756709.3090202@telecom-bretagne.eu>
Message-ID: <201304241511.r3OFBnlO018973@freefriends.org>

Hi Elie,

1) Why do you need to rename it?  What's wrong with adding the features
to it under its existing name?  Just because it will do other things?

2) If you use argv[0] to change the behavior, please also make cmdline
options to control it in the same way.  It's trivial to do that, and
that way, users can use an alias or their own trivial wrapper script to
get the behavior they want with the name they want, which turns out to
be surprisingly useful in all kinds of unforeseen situations.

3) I definitely think "lua", at least, should be in the name.
"fontdbutil" doesn't give any clues -- there are endless numbers of
fonts, databases, and utilities in the world, after all.

What are the features you want to add?

Thanks,
k

From elie.roux at telecom-bretagne.eu  Thu Apr 25 10:25:33 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Thu, 25 Apr 2013 10:25:33 +0200
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <201304241511.r3OFBnlO018973@freefriends.org>
References: <201304241511.r3OFBnlO018973@freefriends.org>
Message-ID: <5178E87D.6020205@telecom-bretagne.eu>

Hi Karl, all,

> 1) Why do you need to rename it?  What's wrong with adding the features
> to it under its existing name?  Just because it will do other things?

We are fine with any name. The difference is that the default
behavior has changed: an update has to be requested explicitly
using the -u switch. We are reluctant to break existing behavior,
so we were looking for a way to both change things and keep them
the way they are without code duplication.

> 2) If you use argv[0] to change the behavior, please also make cmdline
> options to control it in the same way.  It's trivial to do that, and
> that way, users can use an alias or their own trivial wrapper script to
> get the behavior they want with the name they want, which turns out to
> be surprisingly useful in all kinds of unforeseen situations.

Agreed. A tracker item has been opened:

   https://github.com/lualatex/luaotfload/issues/4


> 3) I definitely think "lua", at least, should be in the name.
> "fontdbutil" doesn't give any clues -- there are endless numbers of
> fonts, databases, and utilities in the world, after all.

Ok. What about luafontdbutil?

> What are the features you want to add?

New features have already been added in the future version:
  - rudimentary querying for feedback on whether and how the database 
resolves a font name (--find option).
  - have it output basic information for a font name (--info switch).

It will help users to see what's in their database and how to query it 
with the good name.

What do you think?

Thank you,
-- 
Elie

From karl at freefriends.org  Fri Apr 26 00:08:50 2013
From: karl at freefriends.org (Karl Berry)
Date: Thu, 25 Apr 2013 22:08:50 +0000
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <5178E87D.6020205@telecom-bretagne.eu>
Message-ID: <201304252208.r3PM8orr012151@freefriends.org>

    The difference is that the default behavior has changed: 

Well, don't change it :).

    We are reluctant to break existing behavior,

I totally agree.  That would be far worse than two names.
Definitely don't do that, whatever else happens.

    Ok. What about luafontdbutil?

Fine by me.

    It will help users to see what's in their database and how to query
    it with the good name.

Sounds very good.

Thanks,
Karl

From karl at freefriends.org  Fri Apr 26 17:23:04 2013
From: karl at freefriends.org (Karl Berry)
Date: Fri, 26 Apr 2013 15:23:04 +0000
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <5178E87D.6020205@telecom-bretagne.eu>
Message-ID: <201304261523.r3QFN4Dl000475@freefriends.org>

I realized that your initial idea of "luatex" in the script name 
sounds better than just "lua".  After all, it's really about the
application (luatex) not the language (lua).

But "util" could be omitted.  Then it'd be links like
luatexfontdb --info
luatexfontdb --find
etc.
Seems ok?

k


From Philipp.Gesang at alumni.uni-heidelberg.de  Fri Apr 26 19:57:36 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 26 Apr 2013 19:57:36 +0200
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <201304261523.r3QFN4Dl000475@freefriends.org>
References: <5178E87D.6020205@telecom-bretagne.eu>
 <201304261523.r3QFN4Dl000475@freefriends.org>
Message-ID: <20130426175736.GA32236@phlegethon>

Hi Karl, all,

???<date: 2013-04-26, Friday>???<from: Karl Berry>???

> I realized that your initial idea of "luatex" in the script name 
> sounds better than just "lua".  After all, it's really about the
> application (luatex) not the language (lua).

Or ?luaotfload?. That?s how all the files are prefixed now (was
?otfl?).

> But "util" could be omitted.  Then it'd be links like
> luatexfontdb --info
> luatexfontdb --find

Khaled suggests that we avoid the ?td? cluster to improve
legibility.

  https://github.com/lualatex/luaotfload/commit/7bf46ad63839d6e38a9c1e11ec7d4fba27d1bc51#commitcomment-3089240

I like his idea of hyphenating the name.

> etc.
> Seems ok?

Best
Philipp


-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130426/05eeccb7/attachment.bin>

From karl at freefriends.org  Fri Apr 26 23:46:20 2013
From: karl at freefriends.org (Karl Berry)
Date: Fri, 26 Apr 2013 21:46:20 +0000
Subject: [lltx] mkluatexfontdb -> fontdbutil
In-Reply-To: <20130426175736.GA32236@phlegethon>
Message-ID: <201304262146.r3QLkKF2024179@freefriends.org>

luaotfload-{tool,util} sounds fine to me.  Or just "luaotfload".  I see
nothing against the script and the .sty having the same name.
All fine by me :).

Best,
k

From nomosnomos at gmail.com  Sun Apr 28 08:12:52 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Sun, 28 Apr 2013 15:12:52 +0900
Subject: [lltx] please remove mac os x ttc files from otfl-blacklist.cnf
Message-ID: <CAFzmAm2bia=9QGPDWO2LrE3Z1dc=sk=8y2wKf3ijF1s5hN9oSA@mail.gmail.com>

Dear all,

Luatex engine has ability to handle mac os x ttc fonts since a few years ago.
Therefore please remove list of those files from otfl-blacklist.cnf.

Regards,
--
Dohyun Kim
Seoul, Republic of Korea

From nomosnomos at gmail.com  Sun Apr 28 08:55:21 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Sun, 28 Apr 2013 15:55:21 +0900
Subject: [lltx] caching of fonts with non-ascii chars in file name
Message-ID: <CAFzmAm1r19uupywmtp+hXrNjM_s5=faNZmbMQudCzEM4os4tdA@mail.gmail.com>

Hi,

For instance, I have these font files in /Library/Fonts/ :

????.ttf
????.ttf
????.ttf

As the file name is non-ascii chars only, the name of cache file for
these fonts is always the same, that is "temp--.lua"

So it would be better to apply a simple patch like the following to
otfl-data-con.lua :

--- otfl-data-con.lua.orig    2013-04-28 15:13:48.000000000 +0900
+++ otfl-data-con.lua    2013-04-28 15:14:05.000000000 +0900
@@ -128,5 +128,5 @@
 end

 function containers.cleanname(name)
-    return (gsub(lower(name),"[^%w%d]+","-"))
+    return (gsub(lower(name),"[^%w%d\128-\255]+","-"))
 end


Regards,
--
Dohyun Kim
Seoul, Republic of Korea


From elie.roux at telecom-bretagne.eu  Sun Apr 28 10:20:54 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sun, 28 Apr 2013 10:20:54 +0200
Subject: [lltx] please remove mac os x ttc files from otfl-blacklist.cnf
In-Reply-To: <CAFzmAm2bia=9QGPDWO2LrE3Z1dc=sk=8y2wKf3ijF1s5hN9oSA@mail.gmail.com>
References: <CAFzmAm2bia=9QGPDWO2LrE3Z1dc=sk=8y2wKf3ijF1s5hN9oSA@mail.gmail.com>
Message-ID: <517CDBE6.1030705@telecom-bretagne.eu>

Dear Kim,

> Luatex engine has ability to handle mac os x ttc fonts since a few years ago.
> Therefore please remove list of those files from otfl-blacklist.cnf.

I don't have myself ttc files. Are you sure these can be handled by the 
luaotfload present on the CTAN? LuaTeX can handle them, but I'm not sure 
the current luaotfload does...

The future luaotfload will, but it's not finished yet, we hope to 
release it for TeXLive 2013.

Thank you,
-- 
Elie

From p.stephani2 at gmail.com  Sun Apr 28 16:49:40 2013
From: p.stephani2 at gmail.com (Philipp Stephani)
Date: Sun, 28 Apr 2013 16:49:40 +0200
Subject: [lltx] please remove mac os x ttc files from otfl-blacklist.cnf
In-Reply-To: <CAFzmAm2bia=9QGPDWO2LrE3Z1dc=sk=8y2wKf3ijF1s5hN9oSA@mail.gmail.com>
References: <CAFzmAm2bia=9QGPDWO2LrE3Z1dc=sk=8y2wKf3ijF1s5hN9oSA@mail.gmail.com>
Message-ID: <CAArVCkQGfW_DP-82AvTR3FjJJ0Hn=xdpy4FhKSdnhb+AWNR28g@mail.gmail.com>

2013/4/28 Dohyun Kim <nomosnomos at gmail.com>

> Dear all,
>
> Luatex engine has ability to handle mac os x ttc fonts since a few years
> ago.
> Therefore please remove list of those files from otfl-blacklist.cnf.
>

This has already been fixed upstream (
https://github.com/khaledhosny/luaotfload/issues/37), but the release is
pending (https://github.com/khaledhosny/luaotfload/issues/51).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130428/c5976bd9/attachment.html>

From p.stephani2 at gmail.com  Sun Apr 28 16:53:01 2013
From: p.stephani2 at gmail.com (Philipp Stephani)
Date: Sun, 28 Apr 2013 16:53:01 +0200
Subject: [lltx] caching of fonts with non-ascii chars in file name
In-Reply-To: <CAFzmAm1r19uupywmtp+hXrNjM_s5=faNZmbMQudCzEM4os4tdA@mail.gmail.com>
References: <CAFzmAm1r19uupywmtp+hXrNjM_s5=faNZmbMQudCzEM4os4tdA@mail.gmail.com>
Message-ID: <CAArVCkTJnWGw3ZcL3gnhMqx7qZy2air_7=GF2B98m7ZQD9CvZg@mail.gmail.com>

2013/4/28 Dohyun Kim <nomosnomos at gmail.com>

> --- otfl-data-con.lua.orig    2013-04-28 15:13:48.000000000 +0900
> +++ otfl-data-con.lua    2013-04-28 15:14:05.000000000 +0900
> @@ -128,5 +128,5 @@
>  end
>
>  function containers.cleanname(name)
> -    return (gsub(lower(name),"[^%w%d]+","-"))
> +    return (gsub(lower(name),"[^%w%d\128-\255]+","-"))
>  end
>

That looks reasonable, could you please report it at
https://github.com/khaledhosny/luaotfload so it can be tracked?
However, the "cleanname" function still looks fishy to me. Why do such a
replacement and lowercasing at all? The cache should simply use the font
name as-is, without any modifications.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130428/50ea7f15/attachment.html>

From elie.roux at telecom-bretagne.eu  Sun Apr 28 17:19:55 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sun, 28 Apr 2013 17:19:55 +0200
Subject: [lltx] caching of fonts with non-ascii chars in file name
In-Reply-To: <CAArVCkTJnWGw3ZcL3gnhMqx7qZy2air_7=GF2B98m7ZQD9CvZg@mail.gmail.com>
References: <CAFzmAm1r19uupywmtp+hXrNjM_s5=faNZmbMQudCzEM4os4tdA@mail.gmail.com>
 <CAArVCkTJnWGw3ZcL3gnhMqx7qZy2air_7=GF2B98m7ZQD9CvZg@mail.gmail.com>
Message-ID: <517D3E1B.3050703@telecom-bretagne.eu>

On 28/04/2013 16:53, Philipp Stephani wrote:
> 2013/4/28 Dohyun Kim <nomosnomos at gmail.com <mailto:nomosnomos at gmail.com>>
>
>     --- otfl-data-con.lua.orig    2013-04-28 15:13:48.000000000 +0900
>     +++ otfl-data-con.lua    2013-04-28 15:14:05.000000000 +0900
>     @@ -128,5 +128,5 @@
>       end
>
>       function containers.cleanname(name)
>     -    return (gsub(lower(name),"[^%w%d]+","-"))
>     +    return (gsub(lower(name),"[^%w%d\128-\255]+","-"))
>       end
>
>
> That looks reasonable, could you please report it at
> https://github.com/khaledhosny/luaotfload so it can be tracked?
> However, the "cleanname" function still looks fishy to me. Why do such a
> replacement and lowercasing at all? The cache should simply use the font
> name as-is, without any modifications.

Among other reasons, it might be due to case-insensitive OSs like Windows...

Also, the development of luaotfload now takes place on 
https://github.com/lualatex/luaotfload/, this is where it would be most 
useful to report issues for now.

Thank you,
-- 
Elie

From nomosnomos at gmail.com  Mon Apr 29 03:29:18 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Mon, 29 Apr 2013 10:29:18 +0900
Subject: [lltx] implementation of btex .. etex in luamplib
Message-ID: <CAFzmAm0AEosVVBygjaAHbSqoJz5KCrR=FUCmau2VmXnSrMxgpA@mail.gmail.com>

Hi,

I am planning to upload a package for Korean to CTAN.  Among the files
in the package, two files attached as a zip file in this mail are not
just for Hangul but might be used also for other languages or math
equations.  They are substitutes for luamplib, enabling btex .. etex
for typesetting non-ascii characters in mplibcode environment.  I
suggest here to adopt them to current luamplib package, so that I can
remove them from my package to be uploaded to CTAN.

These two files are derived from the code written by Hans Hagen years
ago, not from current luamplib.  And I do not want to maintain these
files, as I am no expert on the metapost and pdf stuff.  Therefore
they are in public domain.  Feel free to modify them including
copyright notice as you want.

Best,
--
Dohyun Kim
Seoul, Republic of Korea
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatexko-mplib.zip
Type: application/zip
Size: 5395 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130429/41e9a04a/attachment.zip>

From elie.roux at telecom-bretagne.eu  Mon Apr 29 09:33:50 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Mon, 29 Apr 2013 09:33:50 +0200
Subject: [lltx] implementation of btex .. etex in luamplib
In-Reply-To: <CAFzmAm0AEosVVBygjaAHbSqoJz5KCrR=FUCmau2VmXnSrMxgpA@mail.gmail.com>
References: <CAFzmAm0AEosVVBygjaAHbSqoJz5KCrR=FUCmau2VmXnSrMxgpA@mail.gmail.com>
Message-ID: <517E225E.3010204@telecom-bretagne.eu>

Dear Kim,

> I am planning to upload a package for Korean to CTAN.  Among the files
> in the package, two files attached as a zip file in this mail are not
> just for Hangul but might be used also for other languages or math
> equations.  They are substitutes for luamplib, enabling btex .. etex
> for typesetting non-ascii characters in mplibcode environment.  I
> suggest here to adopt them to current luamplib package, so that I can
> remove them from my package to be uploaded to CTAN.

This sounds good, they will be easily adapted to luamplib. When I'll 
merge them, will you have time to test them before I upload it to ctan? 
I'll push them (today certainly) on 
https://github.com/lualatex/luamplib. Or do you have tests already?

Thank you,
-- 
Elie

From nomosnomos at gmail.com  Mon Apr 29 13:18:29 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Mon, 29 Apr 2013 20:18:29 +0900
Subject: [lltx] implementation of btex .. etex in luamplib
In-Reply-To: <517E225E.3010204@telecom-bretagne.eu>
References: <CAFzmAm0AEosVVBygjaAHbSqoJz5KCrR=FUCmau2VmXnSrMxgpA@mail.gmail.com>
 <517E225E.3010204@telecom-bretagne.eu>
Message-ID: <CAFzmAm21KFhWeSDLgP66TV0Xm9zNKgdP1=+D0rMUshEXywKEiQ@mail.gmail.com>

2013/4/29 ?lie Roux <elie.roux at telecom-bretagne.eu>:
> Dear Kim,
>
>
>> I am planning to upload a package for Korean to CTAN.  Among the files
>> in the package, two files attached as a zip file in this mail are not
>> just for Hangul but might be used also for other languages or math
>> equations.  They are substitutes for luamplib, enabling btex .. etex
>> for typesetting non-ascii characters in mplibcode environment.  I
>> suggest here to adopt them to current luamplib package, so that I can
>> remove them from my package to be uploaded to CTAN.
>
>
> This sounds good, they will be easily adapted to luamplib. When I'll merge
> them, will you have time to test them before I upload it to ctan? I'll push
> them (today certainly) on https://github.com/lualatex/luamplib. Or do you
> have tests already?
>

I do not have a test file prepared yet.
But I can test with those mp codes that we find in the mp manual.
Thanks.

--
Dohyun Kim
Seoul, Republic of Korea


From ismo.toijala at gmail.com  Tue Apr 30 16:30:45 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Tue, 30 Apr 2013 16:30:45 +0200
Subject: [lltx] Problems using custom format with luaTeX
Message-ID: <CAPd6TP1Ucep0ci2ZULsdj2aL8TUAdctWVrb+HhgpVC67wOuPyw@mail.gmail.com>

Hello,

Now that using custom formats with luaTeX is possible I have been
testing all the packages I use.
I found problems with four packages: luacolor, pgf, fontspec and unicode-math.

All of the tests a simple file for the format and a simple document
with two pages.
All of the files are attached.

The formats are created with: luatex -ini '&lualatex format.tex\dump'
and loaded with: luatex '&format d.tex'

I am using a fully updated TL2013 pretest on x86_64-linux.

1. luacolor

The error is at the end of the first page.

(/home/ismo/.local/texlive/2013/texmf-dist/tex/context/base/supp-pdf.mkii
[Loading MPS to PDF converter (version 2006.09.02).]
)
! LuaTeX error [string "\directlua "]:1: attempt to index field 'luacolor' (a ni
l value)
stack traceback:
        [string "\directlua "]:1: in main chunk.
<argument> ...et("\luatexluaescapestring {\current at color }")}

l.3 \newpage

2. pgf

I reported the crash to the luaTeX bugtracker:
http://tracker.luatex.org/view.php?id=824

The crash is at the end of the document.

ABD: EveryShipout initializing macros
(/home/ismo/.local/texlive/2013/texmf-dist/tex/context/base/supp-pdf.mkii
[Loading MPS to PDF converter (version 2006.09.02).]
)
(/home/ismo/.local/texlive/2013/texmf-dist/tex/latex/oberdiek/epstopdf-base.sty
(/home/ismo/.local/texlive/2013/texmf-dist/tex/latex/oberdiek/grfext.sty
(/home/ismo/.local/texlive/2013/texmf-dist/tex/generic/oberdiek/kvdefinekeys.st
y)) (/home/ismo/.local/texlive/2013/texmf-dist/tex/latex/oberdiek/kvoptions.sty
(/home/ismo/.local/texlive/2013/texmf-dist/tex/generic/oberdiek/kvsetkeys.sty
(/home/ismo/.local/texlive/2013/texmf-dist/tex/generic/oberdiek/etexcmds.sty)))

(/home/ismo/.local/texlive/2013/texmf-dist/tex/latex/latexconfig/epstopdf-sys.c
fg)) [1{/home/ismo/.local/texlive/2013/texmf-var/fonts/map/pdftex/updmap/pdftex.
map}] [2]PANIC: unprotected error in call to Lua API (object in use)
Aborted (core dumped)

3. fontspec

The font can be found if it is loaded in the format, but not when
loaded in the document.

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
! fontspec error: "font-not-found"
!
! The font "LatinModernSans" cannot be found.
!
! See the fontspec documentation for further information.
!
! For immediate help type H <return>.
!...............................................

l.1 \setmainfont{Latin Modern Sans}

4. unicode-math

I reported the crash to the luaTeX bugtracker:
http://tracker.luatex.org/view.php?id=825

The crash is directly on loading the format.
The crash does not happen when \setmathfont is not used in the format,
but the fontspec bug makes it impossible to load a font in the
document.

This is LuaTeX, Version beta-0.76.0-2013042316 (rev 4627)
 restricted \write18 enabled.
Segmentation fault (core dumped)

5. unicode-math 2

If amsmath is loaded before unicode-math and \setmathfont is not used,
a different error results

! LuaTeX error [string "\directlua "]:1: attempt to index global 'lualatex' (a n
il value)
stack traceback:
        [string "\directlua "]:1: in main chunk.
\__lltxmath_set_mathchar:NN ...\int_eval:n {`#2})}
                                                  \scan_stop:
l.1 \begin{document}
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tests.zip
Type: application/zip
Size: 1769 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20130430/711e6059/attachment.zip>

From elie.roux at telecom-bretagne.eu  Tue Apr 30 16:57:16 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Tue, 30 Apr 2013 16:57:16 +0200
Subject: [lltx] Problems using custom format with luaTeX
In-Reply-To: <CAPd6TP1Ucep0ci2ZULsdj2aL8TUAdctWVrb+HhgpVC67wOuPyw@mail.gmail.com>
References: <CAPd6TP1Ucep0ci2ZULsdj2aL8TUAdctWVrb+HhgpVC67wOuPyw@mail.gmail.com>
Message-ID: <517FDBCC.6050102@telecom-bretagne.eu>

Dear Ismo,

Thank you for your feedback. These bugs are quite hard to track and to 
understand. I think that a good first step would be to fix the issues 
you reported in the LuaTeX engine, and then to address the others, as 
they will certainly be fixed by the first step...

I have taken a look at the LuaTeX issues, but understanding the 
corresponding code is quite difficult and I would need to dig into 
format format (if you follow me) to understand more. In any case I don't 
think a fix will reach TeXLive 2013 (unless Taco takes care of it) 
sorry. If you know C programming, you can give it a try!

Thank you,
-- 
Elie

