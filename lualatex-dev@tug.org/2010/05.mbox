From elie.roux at telecom-bretagne.eu  Tue May 11 08:07:19 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 11 May 2010 09:07:19 +0300
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <B7FA5848-2305-423D-8B1C-96D8C64C72C6@gmail.com>
References: <20100407095509.GA3437@khaled-laptop> <4BBCF447.2050603@gmail.com> <20100407231624.GA5067@khaled-laptop> <4BBDA8C8.9070407@gmail.com> <20100408121930.GB29952@khaled-laptop> <20100408170745.GA32215@khaled-laptop> <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com> <20100409070923.GA2201@khaled-laptop> <20100511031223.GC2356@khaled-laptop> <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com> <20100511043417.GA6603@khaled-laptop> <B7FA5848-2305-423D-8B1C-96D8C64C72C6@gmail.com>
Message-ID: <4BE8F417.3000502@telecom-bretagne.eu>

Will Robertson a ?crit :
> I might be wrong but I think that is a safe assumption. E.g., eulervm is a virtual font based on euler, and contains files zeurb*.vf and zeurb*.tfm. To the best of my knowledge all TeX fonts use the .tfm file (TeX font metric) to provide character size/kerning information.
>   

Checking for ofm (extended tfm) would be safe to, it would prevent 
aleph/omega fonts from breaking.

Thank you,
-- 
Elie


From mpg at elzevir.fr  Mon May 10 11:02:13 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 11:02:13 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7C8AD.8000201@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr>
Message-ID: <4BE7CB95.8030309@elzevir.fr>

Le 10/05/2010 10:49, Manuel P?gouri?-Gonnard a ?crit :
> Le 10/05/2010 10:38, Elie Roux a ?crit :
>> Khaled Hosny a ?crit :
>>> I myself didn't upgrade, because I, again, have no clear view of the
>>> situation, and I don't want to break my semi-working system farther.
>>>   
>>
>> The masters of khaledhosny/luaotfload, mpg/luatextra and
>> eroux/luatexbase should be working together now... I added everyone to
>> eroux/luatexbase, so feel free to push if something doesn't work!
>>
> Could everyone please wait a few hours and *discuss* and try to *understand*
> what is going on before forking/coding too much?
> 
Example:

http://github.com/eroux/luatexbase/commit/a3f50895e8a5f5a3ae7f15fdf905acce6ae521b8

> Adding some functions in callback, in order to keep a bit of
> compatibility for now with the different versions of the packages.

Did you read my previous mails? Did you read "summary of incompatible
changes between 0.1x and 0.2" in the Changes file? 0.2 is *not* meant to
be backward compatible! It stopped writing things in the callback table
on purpose.

You want to do collaborative development? Fine. Please make the effort
to understand what is going on. Then I'll add you as a commiter to
luatexbase. But not when you fix non-bugs in the wrong branch.

Manuel.

PS: I promised all of you yesterday I'll post an update on the situation today,
and I'll actively fi whatever bug is reported to the right branch. You didn't
listen, you didn't want to wait for even a few hours and discuss, now you're
wasting your time and mine with commits to the wrong branch.


From elie.roux at telecom-bretagne.eu  Tue May 11 08:00:59 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 11 May 2010 09:00:59 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE88B71.6040505@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr> <4BE88B71.6040505@elzevir.fr>
Message-ID: <4BE8F29B.4040008@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Well, to the best of my knowledge, everything's master is now 
> compatible with
> luatexbase's master. So, I've deleted the 0.1x branch in order to avoid confusion.
>
> I suggest we put up a CTAN upload on Wednesday with the master of every package
> (except maybe fontspec): TL 09 will be frozen at this point. Then, as soon as
> TL2010 pretest images are available we can make an announcement about it on the
> luatex list and hopefully get some "real users" to test things so we can fix
> possible bugs before TL10 freezes for the DVD release.
>   

That's OK for me!
-- 
Elie


From elie.roux at telecom-bretagne.eu  Sun May  9 07:50:25 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 09 May 2010 08:50:25 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
Message-ID: <4BE64D21.5050701@telecom-bretagne.eu>

Hello,

here is the answer from Karl. Are we ready to upload everything on the 
CTAN? Tomorrow for example? We should upload luatextra, euenc, fontspec 
and luaotfload... did I forget something?

Thank you,
-- 
Elie
-------------- next part --------------
An embedded message was scrubbed...
From: karl at freefriends.org (Karl Berry)
Subject: Re: new tlmgr action
Date: Sat, 8 May 2010 23:12:43 GMT
Size: 2902
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100509/af4e3912/attachment.eml>

From preining at logic.at  Thu May 13 10:57:32 2010
From: preining at logic.at (Norbert Preining)
Date: Thu, 13 May 2010 17:57:32 +0900
Subject: [lltx] new tlmgr action
In-Reply-To: <4BEBBEA6.9090905@telecom-bretagne.eu>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr> <20100513012703.GD3188@gamma.logic.tuwien.ac.at> <4BEBBEA6.9090905@telecom-bretagne.eu>
Message-ID: <20100513085732.GI27051@gamma.logic.tuwien.ac.at>

On Do, 13 Mai 2010, Elie Roux wrote:
> Thank you for these, this is very good news! With these improvements and  
> the new versions of fontspec and luaotfload, I can hardly wait to see  
> TeXLive 2010!

Well, it is still your (as a group) job to agree and finish the uploads
to CTAN before we freeze updates from CTAN.

And when the we build test repositories some tests would be welcome.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
LISTOWEL (n.)
The small mat on the bar designed to be more absorbent than the bar,
but not as absorbent as your elbows.
			--- Douglas Adams, The Meaning of Liff


From wspr81 at gmail.com  Tue May 11 06:53:41 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 11 May 2010 14:23:41 +0930
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <20100511043417.GA6603@khaled-laptop>
References: <20100407095509.GA3437@khaled-laptop> <4BBCF447.2050603@gmail.com> <20100407231624.GA5067@khaled-laptop> <4BBDA8C8.9070407@gmail.com> <20100408121930.GB29952@khaled-laptop> <20100408170745.GA32215@khaled-laptop> <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com> <20100409070923.GA2201@khaled-laptop> <20100511031223.GC2356@khaled-laptop> <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com> <20100511043417.GA6603@khaled-laptop>
Message-ID: <B7FA5848-2305-423D-8B1C-96D8C64C72C6@gmail.com>

On 11/05/2010, at 2:04 PM, Khaled Hosny wrote:

> That sounds very reasonable, but my knowledge about legacy tex fonts is
> bit limited, right now I just check if there is a tfm file with the same
> name, kpse.find_file(name, "tfm"), and if true I skip font names
> database, is this safe assumption? what about virtual fonts?

I might be wrong but I think that is a safe assumption. E.g., eulervm is a virtual font based on euler, and contains files zeurb*.vf and zeurb*.tfm. To the best of my knowledge all TeX fonts use the .tfm file (TeX font metric) to provide character size/kerning information.

-- Will



From elie.roux at telecom-bretagne.eu  Mon May 10 13:10:39 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 14:10:39 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7D2A8.5080303@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr> <4BE7CE97.9060208@telecom-bretagne.eu> <4BE7D2A8.5080303@elzevir.fr>
Message-ID: <4BE7E9AF.7090809@telecom-bretagne.eu>

Hello,

I think the main issue is timing here... let's discuss about it.

If I understand correctly, there is a version of luatexbase that is 
compatible with old versions of packages (it didn't work with me, but 
now that I have a version working, I don't really want to report bugs on 
the other), and there is also a new one introducing incompatible 
changes, like not writing in the callback nor tex table except for 
overriding callback.register. I totally agree with this changes. Where I 
disagree is when we should introduce those changes. If they are to be 
made (I think everyone agrees on it), why not changing it now, we have 
plenty of time to fix the other packages according to these changes. If 
we delay it, this will introduce the incompatible changes for TeXLive 
2011 or even worse in an update of TeXLive 2010, which will mean more 
and more package incompatibilities... The best solution according to me 
is to fix everything now. Frankly we have time to do so before TeXLive 
2010 and if we do this we'll all be able to test. With the solution we 
have now, only you are able to test, and you didn't spot all the 
possible bugs (especially the huge one from 
http://github.com/eroux/luatexbase/commit/1b9ba1489eff995eedcc2c8bf41026cbedc75be9), 
this gives me a bad feeling about pushing a version in TeXLive 2010 that 
noone tested except for you. Also, the reason I took the master branch 
is that in the master of luatextra, luamcallback dissapeared, but it is 
called by the compatible version of luatexbase, which means that the 
compatible version of luatexbase is in fact incompatible with the new 
version of luatextra... it certainly makes a lot of sense to you, but 
frankly, that's why Khaled and me call it a blur situation... If there 
is a file renaming to make, why don't we do it now? TeXLive 2010 is not 
frozen yet, we should put the incompatible changes in it and test it! 
Making a "compatible" version that is incompatible with the future and 
that noone will test is complete nonsense to me...

Summing up, I don't agree to work on several versions of all the 
packages at the same time, we should push all the (incompatible) changes 
now and test against the LuaTeX of TeXLive 2010. Otherwise you'll be 
alone to know the details of the compatibilities... But if I understand 
your last mail correctly, you're in the TeXLive team so you're the 
boss... I'm fine with it, I have a working version on my computer now, I 
can finally work.

Thank you,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Thu May 13 17:47:47 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 13 May 2010 18:47:47 +0300
Subject: [lltx] luatex logo
In-Reply-To: <4BEC1D23.7010002@elzevir.fr>
References: <4BEC1A3F.2070101@telecom-bretagne.eu> <4BEC1D23.7010002@elzevir.fr>
Message-ID: <4BEC1F23.7090302@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I'm all for inclusion in metalogo, but if it's not possible, I don't 
> see the
> point in a luatexlogo package (precisely since there is no kerning to do).
>   

I think the trickery of Heiko in the mail would have its place in a 
potential luatexlogo package... or maybe luatexbase-logo? It's just that 
the name sounds less attractive...

Thank you,
-- 
Elie


From mpg at elzevir.fr  Mon May 10 20:41:22 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 20:41:22 +0200
Subject: [lltx] directlua
In-Reply-To: <4BE8525E.2030005@telecom-bretagne.eu>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop> <4BE848B2.9000004@elzevir.fr> <4BE84D73.9060702@telecom-bretagne.eu> <4BE85125.7080504@elzevir.fr> <4BE8525E.2030005@telecom-bretagne.eu>
Message-ID: <4BE85352.8090804@elzevir.fr>

Le 10/05/2010 20:37, Elie Roux a ?crit :
> I'm in favor of moving to newattribute... but last time I wanted to do
> such a thing, the blocking point was Karl... did he change his mind?

No idea, I'll ask him.

> Anyway, I think a solution is also to write to the people who wrote the
> class, there is a mail address on the page.
> 
Sure, but my point was not actually this class, but rather: how many such class
are around, that we're not aware of? Is it worth risking to break them in order
to have a more natural name for our macros? (It's a real question, I'm not
saying either yes or no right now.)

Manuel.


From elie.roux at telecom-bretagne.eu  Mon May 10 11:15:03 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 12:15:03 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7CB95.8030309@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr>
Message-ID: <4BE7CE97.9060208@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Did you read my previous mails? Did you read "summary of incompatible
> changes between 0.1x and 0.2" in the Changes file? 0.2 is *not* meant to
> be backward compatible! It stopped writing things in the callback table
> on purpose.
>   

I know that, but my goal was to make a version that works and that is 
compatible with the master versions of the other packages. I think 
that's what most people want... With this version and the latest code of 
other packages, everything works fine... Now people (and not only you) 
can update their system, test, understand how it works, etc., and we can 
discuss.

Thank you,
-- 
Elie


From wspr81 at gmail.com  Fri May 14 01:34:16 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 09:04:16 +0930
Subject: [lltx] Moving to new list
Message-ID: <60F9DE68-19B0-44CA-90B6-8F1A7B7384DF@gmail.com>

Dear all,

Since there seems to be a fair bit of activity going on here (and for the foreseeable future, I think), it's time to move the discussion to a "real" mailing list.

Please subscribe immediately to

http://tug.org/mailman/listinfo/lualatex-dev

and direct all future messages there.

Why? Google Groups if left unprotected end up filled with spam, and it's a pain having to authorise everyone to join (especially, for them, if there's a multi-hour delay in their first post arriving on the list). Secondly, being hosted on tug.org means the list settings can be coordinated with all the other mailing lists they maintain.

-- Will



From mpg at elzevir.fr  Mon May 10 13:04:52 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 10 May 2010 13:04:52 +0200
Subject: [lltx] luatexbase, luatextra etc.
Message-ID: <4BE7E854.4090902@elzevir.fr>

Hi,

As promised, a brief summary on luatextra, luatexbase etc. Everything should
work exactly as it worked before the split, with the following packages
installed from the following branches:

- luaextra: master
- luatextra: 0.97x
- luatexbase: 0.1x

If anything doesn't work as advertised with those versions, please tell me (with
a reproducer). I'm sorry for not making "master" the compatible branch, I
realise now it makes life more complicated, I'll try not to do the same mistake
again later.

Backward-incompatible changes are present in luatexbase's master. They are
listed in at the beginning of the Changes file. We need to coordinate the
migration to luatexbase's master: everyone should check the list of incompatible
changes against his code and adapt it if necessary (or tell me if you think I
was wrong to break compatibility on this point, so we can discuss it).

The decision to migrate to luatexbase's master now or later is not mine. Please
have a look at the Changes file and tell me if you are ready to do it now and
want to delay it. If you want to do the transition now, ?lie already did some
adaptations in luatextra's master. Please be aware that more incompatible
changes may be coming, but, as far as I'm concerned, I'll always keep you
informed about them.

That was for the technical part. Now for the development.

I consider mpg/luatexbase on github to be the reference version. If you want
push access to this version, it's ok with me as long as I am confident you'll
act responsibly, eg make sure you understand what the branches are for, try to
discuss before undoing things I did, and carefully check your code, before
pushing anything. I tend to prefer being bugged and fixing things myself since I
tend to think I have a fairly complete understanding of the current state of the
code and its future evolutions, so I think this way is the more effective.
However, I realise not everyone agrees, so I'll grant push access if required,
but I don't want to share push access without being sure things will be properly
discussed before (or very soon after) being acted upon.

Manuel.


From t34www at googlemail.com  Mon May 10 11:07:36 2010
From: t34www at googlemail.com (T T)
Date: Mon, 10 May 2010 10:07:36 +0100
Subject: [lltx] new tlmgr action
In-Reply-To: <20100510021634.GL21730@gamma.logic.tuwien.ac.at>
References: <4BE64D21.5050701@telecom-bretagne.eu>
	 <20100509130459.GB2193@khaled-laptop>
	 <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr>
	 <4BE55F14.1080300@telecom-bretagne.eu>
	 <20100510021634.GL21730@gamma.logic.tuwien.ac.at>
Message-ID: <AANLkTinaVqhTw_qka4bl1DOvp2Fwnb5Hk-rmZ1CwKMiO@mail.gmail.com>

2010/5/10 Norbert Preining <preining at logic.at>:
>> - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the binaries
>> of TeXLive? (the program automatically switches to TEXMFSYSVAR if called
>> with a filename containing "-sys")
>
> That is easy, too, we just have to link them there, or so.

And wrappers on win32.  FYI, I added support for  "-sys" scripts some
time ago by setting:

TEXMFCONFIG = $TEXMFSYSCONFIG
TEXMFVAR = $TEXMFSYSVAR

and calling the non-sys version. Dunno if it matters, but it might if
you rely on arg[0] to check for "-sys" version.

Cheers,

Tomek


From preining at logic.at  Thu May 13 03:27:04 2010
From: preining at logic.at (Norbert Preining)
Date: Thu, 13 May 2010 10:27:04 +0900
Subject: [lltx] new tlmgr action
In-Reply-To: <4BEAEABE.7010700@elzevir.fr>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr>
Message-ID: <20100513012703.GD3188@gamma.logic.tuwien.ac.at>

On Mi, 12 Mai 2010, Manuel P?gouri?-Gonnard wrote:
> > - add a button or something in the menu to execute it? Or integrate it
> > in another tlmgr update button?
> 
> Still todo.

Done. If the mkluatexfontdb-sys is available a button in the Actions menu
of tlmgr gui will show up that says
	Update luaTeX font database

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
SHIFNAL (n.,vb.)
An awkward shuffling walk caused by two or more people in a hurry
accidentally getting into the same segment of revolving door. A
similar effect is achieved by people entering three-legged races
unwisely joined at the neck instead of the ankles.
			--- Douglas Adams, The Meaning of Liff


From khaledhosny at eglug.org  Tue May 11 11:53:41 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 11 May 2010 12:53:41 +0300
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <4BE8F417.3000502@telecom-bretagne.eu>
References: <4BBDA8C8.9070407@gmail.com>
 <20100408121930.GB29952@khaled-laptop>
 <20100408170745.GA32215@khaled-laptop>
 <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com>
 <20100409070923.GA2201@khaled-laptop>
 <20100511031223.GC2356@khaled-laptop>
 <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com>
 <20100511043417.GA6603@khaled-laptop>
 <B7FA5848-2305-423D-8B1C-96D8C64C72C6@gmail.com>
 <4BE8F417.3000502@telecom-bretagne.eu>
Message-ID: <20100511095341.GA10000@khaled-laptop>

On Tue, May 11, 2010 at 09:07:19AM +0300, Elie Roux wrote:
> Will Robertson a ?crit :
> >I might be wrong but I think that is a safe assumption. E.g., eulervm is a virtual font based on euler, and contains files zeurb*.vf and zeurb*.tfm. To the best of my knowledge all TeX fonts use the .tfm file (TeX font metric) to provide character size/kerning information.
> 
> Checking for ofm (extended tfm) would be safe to, it would prevent
> aleph/omega fonts from breaking.

This what I did already, since I found checking for ofm would find tfm
files too.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 20:02:40 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 20:02:40 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510174643.GA4120@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FF12.2020904@elzevir.fr> <20100510125821.GA2948@khaled-laptop> <20100510174643.GA4120@khaled-laptop>
Message-ID: <4BE84A40.2010700@elzevir.fr>

Le 10/05/2010 19:46, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 03:58:21PM +0300, Khaled Hosny wrote:
>> "lualibs" then.
> 
> OK, I renamed the files in http://github.com/mpg/luaextra to lualibs
> (except the reference to the repository), may be we should move the
> repository too.
> 
I just moved the repository.

I hope everyone agreed with this new name, since the discussion was quite short.

Manuel.


From mpg at elzevir.fr  Mon May 10 14:23:59 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 14:23:59 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7F7A7.3030007@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr> <4BE7CE97.9060208@telecom-bretagne.eu> <4BE7D2A8.5080303@elzevir.fr> <4BE7E9AF.7090809@telecom-bretagne.eu> <4BE7F243.30805@elzevir.fr> <4BE7F7A7.3030007@telecom-bretagne.eu>
Message-ID: <4BE7FADF.3000103@elzevir.fr>

Le 10/05/2010 14:10, Elie Roux a ?crit :
> Manuel P?gouri?-Gonnard a ?crit :
>> I tend to agree with you: now would be a good time if it fits
>> everyone's agenda.
>>   
> 
> Ok! So should we test everything's master now?

IMO, yes, but not until everyone had a look at the list of incompatible changes
and express their opinion on this point, see my other message. (Again, was it
that hard to wait for me to wait that message?)

>> It happens only when both foobar.tex and foobar.lua exist.
> 
> Which may be quite a common situation...
> 
Sure. I just wanted to point out that the code was working in other situations,
so that this bug doesn't mean the code was completely untested.

>> FYI (in case you want to try to understand and not only criticize) I
>> was waiting
>> for Heiko's reply on luatex.sty and luatex-base merging, which could have
>> introduced more incompatible changes, before
>>   
> 
> Did you get one? He's quite hard to reach sometimes...
> 
I didn't get his answer yet. I'll ask him when he thinks he'll have time to reply.

> And sorry for all the noise, I just like to shake things to that they
> advance a bit fast...
> 
Sometimes it's necessary to "shake things" as you say, sometimes it isn't. This
time, IMO, it wasn't necessary at all: I thought I made it quite clear by
explicitly stating that I'l act upon your report soon and I planned to be as
active as necessary until the TL10 "deadline". Now we've lost time and energy,
uselessly IMO, not to mention personal attacks.

Manuel.


From t34www at googlemail.com  Mon May 10 12:39:19 2010
From: t34www at googlemail.com (T T)
Date: Mon, 10 May 2010 11:39:19 +0100
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE7D322.3090600@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu>
	 <20100509130459.GB2193@khaled-laptop>
	 <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr>
	 <4BE55F14.1080300@telecom-bretagne.eu>
	 <20100510021634.GL21730@gamma.logic.tuwien.ac.at>
	 <AANLkTinaVqhTw_qka4bl1DOvp2Fwnb5Hk-rmZ1CwKMiO@mail.gmail.com>
	 <4BE7CF25.7040201@telecom-bretagne.eu> <4BE7D322.3090600@elzevir.fr>
Message-ID: <AANLkTikZqUy7dhy0KyFGhz7QyZZIV86xQ-PGZlMh-DL7@mail.gmail.com>

On 10 May 2010 10:34, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Le 10/05/2010 11:17, Elie Roux a ?crit :
>> T T a ?crit :
>>> And wrappers on win32. FYI, I added support for "-sys" scripts some
>>> time ago by setting:
>>>
>>> TEXMFCONFIG = $TEXMFSYSCONFIG
>>> TEXMFVAR = $TEXMFSYSVAR
>>>
>>> and calling the non-sys version. Dunno if it matters, but it might if
>>> you rely on arg[0] to check for "-sys" version.
>>>
>>
>> Hello,
>>
>> that's exactly what we do ;) This means that we can safely remove this
>> check? Should we keep the --sys option?
>>
> Since there is hope that MikTeX will provide LuaTeX some day, and it doesn't use
> the same wrappers system as TL (AFAIK), I suggest keeping an option in the
> script itself rather than relying only on the wrapper (or arg[0], since I'm not
> sure how it is set with MikTeX either).

I don't think miktex has any notion of "-sys" utilities (nor kpathsea
for that matter, which makes this script very TL-centric), but
symlinks on unix will need the argv[0] check, therefore it should
stay.  (And I would keep the --sys option too if it is already there.)

Cheers,

Tomek


From mpg at elzevir.fr  Mon May 10 11:34:26 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 10 May 2010 11:34:26 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE7CF25.7040201@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu>	 <20100509130459.GB2193@khaled-laptop>	 <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr>	 <4BE55F14.1080300@telecom-bretagne.eu>	 <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <AANLkTinaVqhTw_qka4bl1DOvp2Fwnb5Hk-rmZ1CwKMiO@mail.gmail.com> <4BE7CF25.7040201@telecom-bretagne.eu>
Message-ID: <4BE7D322.3090600@elzevir.fr>

Le 10/05/2010 11:17, Elie Roux a ?crit :
> T T a ?crit :
>> And wrappers on win32. FYI, I added support for "-sys" scripts some
>> time ago by setting:
>>
>> TEXMFCONFIG = $TEXMFSYSCONFIG
>> TEXMFVAR = $TEXMFSYSVAR
>>
>> and calling the non-sys version. Dunno if it matters, but it might if
>> you rely on arg[0] to check for "-sys" version.
>>   
> 
> Hello,
> 
> that's exactly what we do ;) This means that we can safely remove this
> check? Should we keep the --sys option?
> 
Since there is hope that MikTeX will provide LuaTeX some day, and it doesn't use
the same wrappers system as TL (AFAIK), I suggest keeping an option in the
script itself rather than relying only on the wrapper (or arg[0], since I'm not
sure how it is set with MikTeX either).

Manuel.


From khaledhosny at eglug.org  Mon May 10 15:01:13 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 16:01:13 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE7FCFC.8000309@telecom-bretagne.eu>
References: <4BE7E854.4090902@elzevir.fr>
 <20100510121603.GA2250@khaled-laptop>
 <4BE7FCFC.8000309@telecom-bretagne.eu>
Message-ID: <20100510130113.GB2948@khaled-laptop>

On Mon, May 10, 2010 at 03:33:00PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >BTW, I think now is better than later to pick a less confusing name for
> >luaextra, any suggestions?
> 
> I agree on this. What about lualibs? Just a thought: what about
> integrating alt-getopt.lua in lua[extra/libs]? This would make sense
> for me...

alt-getopt.lua is genric lua code with no luatex specific dependencies
unlike most of current luaextra modules, so I'm not sure if it really
makes sense.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 10:49:49 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 10:49:49 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7C61E.6060001@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu>
Message-ID: <4BE7C8AD.8000201@elzevir.fr>

Le 10/05/2010 10:38, Elie Roux a ?crit :
> Khaled Hosny a ?crit :
>> I myself didn't upgrade, because I, again, have no clear view of the
>> situation, and I don't want to break my semi-working system farther.
>>   
> 
> The masters of khaledhosny/luaotfload, mpg/luatextra and
> eroux/luatexbase should be working together now... I added everyone to
> eroux/luatexbase, so feel free to push if something doesn't work!
> 
Could everyone please wait a few hours and *discuss* and try to *understand*
what is going on before forking/coding too much?

Thanks!

Manuel.


From elie.roux at telecom-bretagne.eu  Sat May  8 14:54:44 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 08 May 2010 15:54:44 +0300
Subject: [lltx] new tlmgr action
Message-ID: <4BE55F14.1080300@telecom-bretagne.eu>

Hello,

In the version of luaotfload that will be shipped with TeXLive 2010 
(http://github.com/khaledhosny/luaotfload) there is a script called 
mkluatexfontdb.lua that explores and analyses the fonts in TEXMF and 
OSFONTDIR (or through fc-list if OSFONTDIR is empty) and writes a 
database (a lua table) in 
TEXMFVAR/luatex/generic/luaotfload/names/otfl-names.lua. The info 
contained in the database are important and allow the user to choose a 
font with its name, as under XeTeX, through fontspec for example. The 
first pass is quite heavy (~30s) as all fonts need to be analyzed with 
the fontforge library of LuaTeX, but the other pass analyze only the new 
fonts and remove the old ones without parsing everything, so the 
execution is fast (~0.5s). The script is made to be executed with 
texlua; a recent one if possible, as an old one will produce huge 
memleaks. By default the script outputs a progression bar, but output 
can be disabled with the -q switch. The script makes active use of the 
file otfl-font-names.lua, which uses the files luaextra-file.lua, 
luaextra-table.lua of the luatextra package. It uses also alt-getopt.lua 
which is distributed on the ctan.

Would it be possible to:
 - execute the script at the end of the installation with tlmgr?
 - add a button or something in the menu to execute it? Or integrate it 
in another tlmgr update button?
 - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the 
binaries of TeXLive? (the program automatically switches to TEXMFSYSVAR 
if called with a filename containing "-sys")

Thank you,
-- 
Elie


From wspr81 at gmail.com  Fri May 14 07:18:20 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 14:48:20 +0930
Subject: [lltx] Future of xltxtra
In-Reply-To: <20100514050610.GA2805@khaled-laptop>
References: <20100514050610.GA2805@khaled-laptop>
Message-ID: <BB571CB0-943B-45C3-ACDB-B24A1C0E6392@gmail.com>

On 14/05/2010, at 2:36 PM, Khaled Hosny wrote:

> Seeing how people get confused about what xltxtra is for, I'd rather
> make the package detect luatex and this show an error message. This way
> we give the users a meaningful error message and avoid continuing the
> confusion.

That may well be the best option. Users can always scroll past the error if they are still experimenting. (After all, there's not too much in xltxtra that will break in LuaLaTeX.)

Okay, I'll work towards a unified fontspec+xltxtra minus the contentious bits'n'pieces. I'm pretty confident on which parts don't cause problems and which should be split into separate packages.

-- Will




From khaledhosny at eglug.org  Mon May 10 19:46:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 20:46:43 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510125821.GA2948@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr>
 <20100510121603.GA2250@khaled-laptop>
 <4BE7FF12.2020904@elzevir.fr>
 <20100510125821.GA2948@khaled-laptop>
Message-ID: <20100510174643.GA4120@khaled-laptop>

On Mon, May 10, 2010 at 03:58:21PM +0300, Khaled Hosny wrote:
> "lualibs" then.

OK, I renamed the files in http://github.com/mpg/luaextra to lualibs
(except the reference to the repository), may be we should move the
repository too.

 Regards,
  Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 20:32:05 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 20:32:05 +0200
Subject: [lltx] directlua
In-Reply-To: <4BE84D73.9060702@telecom-bretagne.eu>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop> <4BE848B2.9000004@elzevir.fr> <4BE84D73.9060702@telecom-bretagne.eu>
Message-ID: <4BE85125.7080504@elzevir.fr>

Le 10/05/2010 20:16, Elie Roux a ?crit :
> Ok! Good news. By the way, has there been some updates on the
> \newluatexattribute and \newluatexcatcodetable? There was once the idea
> that it could be renamed \newattribute and \newcatcodetable... I think
> it would be great, but the decision is not mine...
> 
I'm all for \newcatcodetable (and \setcatcodetable accordingly). If everyone
agrees, we can move to it whenever you guys want to.

I'm more reserved on \newattribute. Unlike "catcodetable", "attribute" is a very
generic term, so chances are high it is already used. I grepped CTAN's macros
directory for it, and fortunatly found no match (except of course Heiko's
luatex.sty and packages using it). Unfortunately, at least one class not on CTAN
is already using this name, see:

http://www.e-publications.org/ims/support/
http://www.e-publications.org/ims/support/download/imsart-generic.zip

We have to be aware that this class will be incompatible with luatexbase if we
decide to use \newattribute. I'm not saying it is a showstopper, since we may
also consider that the class is wrong to use such a generic name and should
prefix its internal macros with a unique (or at least non-generic) string.

I must admit I have no strong opinion on this point. I think the decision should
be collective.

Thanks for the reminder,
Manuel.


From khaledhosny at eglug.org  Mon May 10 06:27:45 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 07:27:45 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE74380.1020600@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu>
 <20100509130459.GB2193@khaled-laptop>
 <4BE6E68E.7030502@telecom-bretagne.eu>
 <4BE74380.1020600@elzevir.fr>
Message-ID: <20100510042745.GA2514@khaled-laptop>

On Mon, May 10, 2010 at 01:21:36AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 09/05/2010 18:45, Elie Roux a ?crit :
> > Khaled Hosny a ?crit :
> >> For luaotfload I still need to sync with ConTeXt (there are few fixes
> >> and new features I'm interested about), also I was waiting for the
> >> luatextra/luaextra split to be finalised and update luaotfload
> >> accordingly, the situation now is a bit messy.
> > 
> > I didn't realize the current situation was such a mess,
> 
> I'm still not sure it is.

My main issue is the fuzzyness of the situation, I don't know what is
depricated and what is not, should we drop luatextra for luatex-base or
not, what about luaextra? nothing clear, and that makes it messy
situation for me.

> > I've just tried
> > to update everything, and I'm fixing small pieces of code everywhere,
> > almost nothing works... Even
> > http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-20100330.tds.zip
> > doesn't work with my (latest trunk) LuaTeX...
> 
> I'm very surprised, I tested it thouroghly with luatex 0.25.4, 0.40.6 and
> whatever was trunk at this date. Could you please provide me a test file so that

I myself didn't upgrade, because I, again, have no clear view of the
situation, and I don't want to break my semi-working system farther.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Mon May 10 15:39:08 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 16:39:08 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510133444.GA3194@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FCFC.8000309@telecom-bretagne.eu> <20100510130113.GB2948@khaled-laptop> <4BE808C9.90305@telecom-bretagne.eu> <20100510133444.GA3194@khaled-laptop>
Message-ID: <4BE80C7C.6070104@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Nope, they don't. They depend on specific modules built in luatex not
> available in standard lua.
>   

Good point, I tend to forget that, as I never use lua outside of LuaTeX...
-- 
Elie



From elie.roux at telecom-bretagne.eu  Thu May 13 10:56:06 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 13 May 2010 11:56:06 +0300
Subject: [lltx] new tlmgr action
In-Reply-To: <20100513012703.GD3188@gamma.logic.tuwien.ac.at>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr> <20100513012703.GD3188@gamma.logic.tuwien.ac.at>
Message-ID: <4BEBBEA6.9090905@telecom-bretagne.eu>

> Norbert created a new trigger "addLuaMap" (named so since it is somehow similar
> to add(Mixed)Map), which causes mkluatexfontdb-sys to be run (without options)
> if present every time a package with this trigger is installed. I activated the
> trigger for all packages that currently ship otf or ttf files (list below,
> derived from texlive.tlpdb). We'll do the same for new packages shipping such files.


> Done. If the mkluatexfontdb-sys is available a button in the Actions menu
> of tlmgr gui will show up that says
> 	Update luaTeX font database
>   

Hello,

Thank you for these, this is very good news! With these improvements and 
the new versions of fontspec and luaotfload, I can hardly wait to see 
TeXLive 2010!

Thank you again,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Mon May 10 20:16:19 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 21:16:19 +0300
Subject: [lltx] directlua
In-Reply-To: <4BE848B2.9000004@elzevir.fr>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop> <4BE848B2.9000004@elzevir.fr>
Message-ID: <4BE84D73.9060702@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I agree with Khaled.
> luatexbase-compat is only needed for compatibility with older versions of LuaTeX
> (like, earlier than TL09 on this point).
>   

Ok! Good news. By the way, has there been some updates on the 
\newluatexattribute and \newluatexcatcodetable? There was once the idea 
that it could be renamed \newattribute and \newcatcodetable... I think 
it would be great, but the decision is not mine...

Thank you,
-- 
Elie


From mpg at elzevir.fr  Wed May 12 19:53:12 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 12 May 2010 19:53:12 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <4BEAEABE.7010700@elzevir.fr>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr>
Message-ID: <4BEAEB08.2020703@elzevir.fr>



Le 12/05/2010 19:51, Manuel P?gouri?-Gonnard a ?crit :
> trigger for all packages that currently ship otf or ttf files (list below,

Did I write "below"? Here it is:

iwona
mnsymbol
libertine
lm
junicode
libris
skaknew
philokalia
gentium
Asana-Math
inconsolata
gnu-freefont
gfsbaskerville
semaphor
cyklop
gfsneohellenic
gfssolomos
phaistos
tex-gyre
lmextra
kurier
belleek
gfsporson
venturisadf
gfsartemisia
antt
itrans
umtypewriter
gfsdidot
gfsbodoni
gfscomplutum

m


From elie.roux at telecom-bretagne.eu  Mon May 10 14:10:15 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 15:10:15 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7F243.30805@elzevir.fr>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr> <4BE7CE97.9060208@telecom-bretagne.eu> <4BE7D2A8.5080303@elzevir.fr> <4BE7E9AF.7090809@telecom-bretagne.eu> <4BE7F243.30805@elzevir.fr>
Message-ID: <4BE7F7A7.3030007@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I tend to agree with you: now would be a good time if it fits everyone's agenda.
>   

Ok! So should we test everything's master now? I'll make the changes in 
luamplib and luaotfload against mpg/luatexbase's master if it's ok for 
everyone...

> It happens only when both foobar.tex and foobar.lua exist.

Which may be quite a common situation...

>  Also, your fix had
> typos that made the code silently not work as advertised, and you didn't
> document it. You also "fixed" a non-problem in the same commit.
>   

My bad, sorry.

> FYI (in case you want to try to understand and not only criticize) I 
> was waiting
> for Heiko's reply on luatex.sty and luatex-base merging, which could have
> introduced more incompatible changes, before
>   

Did you get one? He's quite hard to reach sometimes...

And sorry for all the noise, I just like to shake things to that they 
advance a bit fast...

Thank you,
-- 
Elie


From heiko.oberdiek at googlemail.com  Thu May 13 22:27:07 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 13 May 2010 22:27:07 +0200
Subject: [lltx] luatex logo
In-Reply-To: <4BEC1A3F.2070101@telecom-bretagne.eu>
References: <4BEC1A3F.2070101@telecom-bretagne.eu>
Message-ID: <20100513202707.GA3309@oberdiek.my-fqdn.de>

On Thu, May 13, 2010 at 06:26:55PM +0300, Elie Roux wrote:

> I think it would be great to have the \LuaTeX and \LuaLaTeX macros
> in a package for TeXLive 2010.

> seems an idea Hand and Taco don't want, so it would be best to keep
> something simple such as \def\LuaTeX{Lua\TeX}, but maybe something
> like http://tug.org/pipermail/luatex/2010-March/001331.html would be
> suitable too.

The latter I have put in the quite new package `hologo'.

Yours sincerely
  Heiko Oberdiek


From mpg at elzevir.fr  Mon May 10 20:12:07 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 20:12:07 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE84A40.2010700@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FF12.2020904@elzevir.fr> <20100510125821.GA2948@khaled-laptop> <20100510174643.GA4120@khaled-laptop> <4BE84A40.2010700@elzevir.fr>
Message-ID: <4BE84C77.5060701@elzevir.fr>

Le 10/05/2010 20:02, Manuel P?gouri?-Gonnard a ?crit :
> I just moved the repository.
> 
Btw, you need to update your copy of the repo using eg

 git remote set-url origin git at github.com:mpg/lualibs.git

m


From preining at logic.at  Mon May 10 04:16:34 2010
From: preining at logic.at (Norbert Preining)
Date: Mon, 10 May 2010 11:16:34 +0900
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu>
Message-ID: <20100510021634.GL21730@gamma.logic.tuwien.ac.at>

Dear all,

On Sa, 08 Mai 2010, Elie Roux wrote:
> mkluatexfontdb.lua that explores and analyses the fonts in TEXMF and  
...
> Would it be possible to:
> - execute the script at the end of the installation with tlmgr?

At the end of installation of TeX Live? Then it is install-tl, but anyway.
Yes, easy.

> - add a button or something in the menu to execute it? Or integrate it  
> in another tlmgr update button?

I guess the best place would be to add it to the actions in the tlmgr GUI
where there is already something for updmap-sys etc.

> - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the binaries 
> of TeXLive? (the program automatically switches to TEXMFSYSVAR if called 
> with a filename containing "-sys")

That is easy, too, we just have to link them there, or so.

One question: At which point in time these mkluatexfontdb-sys should be 
called during normal operation? Say we install a set of new fonts (.pfb
format)? WOuld it make sense to call the script?

Why do I ask? It looks like this script should be called always when
updmap-sy is also called. Maybe it will be called a few times more, but
that does not hurt as you said.

So the idea is that we adapt the tlmgr so that when it would call updmap-sys
to enable/disable some maps, it would also call that script.

Does that make sense?

On Mo, 10 Mai 2010, Manuel P?gouri?-Gonnard wrote:
> > I didn't realize the current situation was such a mess,
> 
> I'm still not sure it is.
> 
> > I've just tried
> > to update everything, and I'm fixing small pieces of code everywhere,
> > almost nothing works... Even
> > http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-20100330.tds.zip
> > doesn't work with my (latest trunk) LuaTeX...
> 
> I'm very surprised, I tested it thouroghly with luatex 0.25.4, 0.40.6 and
> whatever was trunk at this date. Could you please provide me a test file so that
> I can try to reproduce your problems?


I guess I will not start doing anything here until all of you have cleaned
up a bit.

I agree that having that in 2010 would be nice, but if it simply is not
ready so it be.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
AMBLESIDE (n.)
A talk given about the Facts of Life by a father to his son whilst
walking in the garden on a Sunday afternoon.
			--- Douglas Adams, The Meaning of Liff


From khaledhosny at eglug.org  Thu May 13 14:47:46 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 13 May 2010 15:47:46 +0300
Subject: [lltx] new tlmgr action
In-Reply-To: <4BEBC3A1.9070903@elzevir.fr>
References: <4BE55F14.1080300@telecom-bretagne.eu>
 <4BEAEABE.7010700@elzevir.fr>
 <20100513012703.GD3188@gamma.logic.tuwien.ac.at>
 <4BEBBEA6.9090905@telecom-bretagne.eu>
 <20100513085732.GI27051@gamma.logic.tuwien.ac.at>
 <4BEBC3A1.9070903@elzevir.fr>
Message-ID: <20100513124746.GC2358@khaled-laptop>

On Thu, May 13, 2010 at 11:17:21AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 13/05/2010 10:57, Norbert Preining a ?crit :
> > Well, it is still your (as a group) job to agree and finish the uploads
> > to CTAN before we freeze updates from CTAN.
> > 
> Upload done, except fontspec for now.
> 
> (I'll push it to TL in a few hours.)
> 
> > And when the we build test repositories some tests would be welcome.
> > 
> Of course today's update is just a snapshot, probably full of bugs, so we're
> happy to use the TL pre-test phase in order to squash them. We plan to do more
> snapshot upload as needed, then put up a (hopefully good) final version before
> the final freeze.

For "squashing bugs", I think we need to advertise this list more
prominently as it seems no much people know about it. I still get
personal emails about luaotfload/lualibs issues.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Sun May  9 09:10:32 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 09 May 2010 10:10:32 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <DA9C502F-26E4-4B8C-B5DE-F88383DC53E1@gmail.com>
References: <4BE64D21.5050701@telecom-bretagne.eu> <DA9C502F-26E4-4B8C-B5DE-F88383DC53E1@gmail.com>
Message-ID: <4BE65FE8.60608@telecom-bretagne.eu>

Will Robertson a ?crit :
> I'm afraid there's still more work to be done before we can upload fontspec. (The manual, mostly.)
>
> Can we stick with the low-level tools for now? 

Sure, fontspec can be uploaded later... I'd really like it to be in 
TeXLive 2010 DVD though... do you think it will be OK?

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Mon May 10 06:14:07 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 07:14:07 +0300
Subject: [lltx] new tlmgr action
In-Reply-To: <20100510021634.GL21730@gamma.logic.tuwien.ac.at>
References: <4BE64D21.5050701@telecom-bretagne.eu>
 <20100509130459.GB2193@khaled-laptop>
 <4BE6E68E.7030502@telecom-bretagne.eu>
 <4BE74380.1020600@elzevir.fr>
 <4BE55F14.1080300@telecom-bretagne.eu>
 <20100510021634.GL21730@gamma.logic.tuwien.ac.at>
Message-ID: <20100510041407.GB2300@khaled-laptop>

On Mon, May 10, 2010 at 11:16:34AM +0900, Norbert Preining wrote:
> Dear all,
> > - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the binaries 
> > of TeXLive? (the program automatically switches to TEXMFSYSVAR if called 
> > with a filename containing "-sys")
> 
> That is easy, too, we just have to link them there, or so.
> 
> One question: At which point in time these mkluatexfontdb-sys should be 
> called during normal operation? Say we install a set of new fonts (.pfb
> format)? WOuld it make sense to call the script?

We only index OpenType fonts (.otf and .ttf), type1 fonts still used the
tex way (tfm etc.) and there is no much sense to do otherwise.

I'd say the script would run as part of installation process and
whenever opentype fonts are installed. But since we also index system
fonts, this will not be enough so the scripts should be there for the
user to run them manually. Later, we may provide a way to monitor font
directories and whenever the user asks for non-existent font we check if
the font database is not up to date and update it, but this should not
concern texlive.

BTW Elie, I think the -sys mode is conceptually broken as it might index
fonts only available to the current user.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From wspr81 at gmail.com  Mon May 10 14:53:10 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 10 May 2010 22:23:10 +0930
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE7E854.4090902@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr>
Message-ID: <47B7EAC6-F2A2-4174-B40F-3F86578CC186@gmail.com>

(Sent from my phone.)

On 10/05/2010, at 20:34, Manuel P?gouri?-Gonnard <mpg at elzevir.fr>  
wrote:

> I consider mpg/luatexbase on github to be the reference version. If  
> you want
> push access to this version, it's ok with me as long as I am  
> confident you'll
> act responsibly, eg make sure you understand what the branches are  
> for, try to
> discuss before undoing things I did, and carefully check your code,  
> before
> pushing anything.

I realise I've been (regretably) out of the loop all this time, but my  
opinion here is that since github makes forks so easy there's no huge  
pressing reason for everyone to have push access to each other's  
repositories. In fact, I sort of feel that it can dampen high  
frequency noise of the sort we've seen here, albeit with the downside  
that some things can take a little longer to propagate.

Climbing back into my (hopefully temporary) hole,

Will

From mpg at elzevir.fr  Tue May 11 01:32:53 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 11 May 2010 01:32:53 +0200
Subject: [lltx] directlua
In-Reply-To: <20100510212016.GA11073@oberdiek.my-fqdn.de>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510212016.GA11073@oberdiek.my-fqdn.de>
Message-ID: <4BE897A5.4080201@elzevir.fr>

Le 10/05/2010 23:20, Heiko Oberdiek a ?crit :
> * Is \directlua always available?

Yes. As AFAICS, it will always be.

>   Or are there formats with undefined \directlua that is
>   available as \luadirect?

No. \luadirect is only defined in a package (luatextra), not in any format.

> * Anyway, you need to check for LuaTeX and it's version.
>   I doubt, that you want to support *all* older LuaTeX versions.
>   Also the syntax of \directlua has changed.
> 
Right. In luatexbase-compat, I try to provide something that basically works
with 0.25.4, 0.40.6 and 0.60.x at least, namely \luatxbase at directlua, that
expands either to \directlua or \directlua0 depending on the version.

> Package ifluatex.sty can be loaded by iniTeX and provides
> \ifluatex, \luatexversion, and \luatexversion. It only
> requires \directlua. Should I change this that in case
> \directlua is not available that \luadirect is tried?
> 
No. To the best of my knowledge, there is nothing wrong with ifluatex.sty.

Manuel.


From mpg at elzevir.fr  Mon May 10 16:26:15 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 16:26:15 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <20100510041407.GB2300@khaled-laptop>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop>
Message-ID: <4BE81787.6070208@elzevir.fr>

Le 10/05/2010 06:14, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 11:16:34AM +0900, Norbert Preining wrote:
>> Dear all,
>>> - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the binaries 
>>> of TeXLive? (the program automatically switches to TEXMFSYSVAR if called 
>>> with a filename containing "-sys")
>>
>> That is easy, too, we just have to link them there, or so.
>>
>> One question: At which point in time these mkluatexfontdb-sys should be 
>> called during normal operation? Say we install a set of new fonts (.pfb
>> format)? WOuld it make sense to call the script?
> 
> We only index OpenType fonts (.otf and .ttf), type1 fonts still used the
> tex way (tfm etc.) and there is no much sense to do otherwise.
> 
> I'd say the script would run as part of installation process and
> whenever opentype fonts are installed.

Is it a problem to run the script more often than necessary? (For example,
whenever fonts of any type are installed.) If it's ok, I agree with Norbert that
we whould run it whenever we run updmap-sys.

> But since we also index system
> fonts, this will not be enough so the scripts should be there for the
> user to run them manually. Later, we may provide a way to monitor font
> directories and whenever the user asks for non-existent font we check if
> the font database is not up to date and update it, but this should not
> concern texlive.
> 
I agree that this part should not concern TL.

Btw, as a user, I would very much appreciate this kind of improvement :-)

Manuel.


From mpg at elzevir.fr  Mon May 10 10:13:36 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 10:13:36 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <20100510042745.GA2514@khaled-laptop>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop>
Message-ID: <4BE7C030.9040501@elzevir.fr>

Le 10/05/2010 06:27, Khaled Hosny a ?crit :
> My main issue is the fuzzyness of the situation, I don't know what is
> depricated and what is not, should we drop luatextra for luatex-base or
> not, what about luaextra? nothing clear, and that makes it messy
> situation for me.
> 
I thought I posted an explanation about that, but apparently more is needed.
I'll sum it up again later today.

Manuel.


From mpg at elzevir.fr  Thu May 13 11:17:21 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 13 May 2010 11:17:21 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <20100513085732.GI27051@gamma.logic.tuwien.ac.at>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr> <20100513012703.GD3188@gamma.logic.tuwien.ac.at> <4BEBBEA6.9090905@telecom-bretagne.eu> <20100513085732.GI27051@gamma.logic.tuwien.ac.at>
Message-ID: <4BEBC3A1.9070903@elzevir.fr>

Le 13/05/2010 10:57, Norbert Preining a ?crit :
> Well, it is still your (as a group) job to agree and finish the uploads
> to CTAN before we freeze updates from CTAN.
> 
Upload done, except fontspec for now.

(I'll push it to TL in a few hours.)

> And when the we build test repositories some tests would be welcome.
> 
Of course today's update is just a snapshot, probably full of bugs, so we're
happy to use the TL pre-test phase in order to squash them. We plan to do more
snapshot upload as needed, then put up a (hopefully good) final version before
the final freeze.

Manuel.


From khaledhosny at eglug.org  Fri May 14 06:24:56 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 14 May 2010 07:24:56 +0300
Subject: [lltx] Moving to new list
In-Reply-To: <60F9DE68-19B0-44CA-90B6-8F1A7B7384DF@gmail.com>
References: <60F9DE68-19B0-44CA-90B6-8F1A7B7384DF@gmail.com>
Message-ID: <20100514042456.GA2699@khaled-laptop>

On Fri, May 14, 2010 at 09:04:16AM +0930, Will Robertson wrote:
> Dear all,
> 
> Since there seems to be a fair bit of activity going on here (and for the foreseeable future, I think), it's time to move the discussion to a "real" mailing list.
> 
> Please subscribe immediately to
> 
> http://tug.org/mailman/listinfo/lualatex-dev
> 
> and direct all future messages there.
> 
> Why? Google Groups if left unprotected end up filled with spam, and it's a pain having to authorise everyone to join (especially, for them, if there's a multi-hour delay in their first post arriving on the list). Secondly, being hosted on tug.org means the list settings can be coordinated with all the other mailing lists they maintain.

Great, but the list archives need to be made puplic, also can't we
import archives of this list into tug one?

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Sun May  9 18:45:02 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 09 May 2010 19:45:02 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <20100509130459.GB2193@khaled-laptop>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop>
Message-ID: <4BE6E68E.7030502@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> For luaotfload I still need to sync with ConTeXt (there are few fixes
> and new features I'm interested about), also I was waiting for the
> luatextra/luaextra split to be finalised and update luaotfload
> accordingly, the situation now is a bit messy.

I didn't realize the current situation was such a mess, I've just tried 
to update everything, and I'm fixing small pieces of code everywhere, 
almost nothing works... Even 
http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-20100330.tds.zip 
doesn't work with my (latest trunk) LuaTeX... I think we should put a 
lot of efforts on making it work soon. I'll be available the next few 
days so I can take care of it. Manuel, could you give us the rights on 
luatexbase and tell us what you think about it?

Thank you,
-- 
Elie


From mpg at elzevir.fr  Mon May 10 14:41:54 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 14:41:54 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510121603.GA2250@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop>
Message-ID: <4BE7FF12.2020904@elzevir.fr>

Le 10/05/2010 14:16, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 01:04:52PM +0200, Manuel P?gouri?-Gonnard wrote:
>> The decision to migrate to luatexbase's master now or later is not mine. Please
>> have a look at the Changes file and tell me if you are ready to do it now and
>> want to delay it. If you want to do the transition now, ?lie already did some
>> adaptations in luatextra's master. Please be aware that more incompatible
>> changes may be coming, but, as far as I'm concerned, I'll always keep you
>> informed about them.
> 
> I'm fine with migrating luaotfload and luaextra to luatexbase master,
> provided that it is considered stable enough for texlive inclusion.

Depends on what you mean by "stable". It should not have more bugs than the 0.1x
branch, though of course bugs may be introduced by any modification in the code.

Concerning foreseeable future compatibility breakages, things are more complicated:
- concerning compat, cctb, loader, regs, I don't plan to do breaking changes
other than required for the possible merge with Heiko's luatex.sty.
- mcb (aka luamcallbacks) and modutils are more likely to change soon, we'll
need to discuss a few points.

Btw, this is the reason why I didn't push everyone to switch to the master
branch earlier: I wanted to minimise the number of times we needed to
synchronize for such changes. Of course, now than TL10 is approaching, it makes
more sense to switch to the latest versions now without waiting any more.

To sum up again: any of master and 0.1x can be a candidate for inclusion in TL,
and it's your choice.

> Now, do I still need luatextra or can I just load luatexbase and
> luaextra directly.
> 
You can do as you want. luatextra still provides a few more things, but if you
don't need them, you can load luatexbase and luaextra directly, but loading
luatextra is not deprecated either.

> BTW, I think now is better than later to pick a less confusing name for
> luaextra, any suggestions?
> 
I agree. ?lie's suggestion of lualibs sounds fine to me. (Or luautils, too.)

Manuel.


From mpg at elzevir.fr  Thu May 13 17:56:26 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 13 May 2010 17:56:26 +0200
Subject: [lltx] luatex logo
In-Reply-To: <4BEC1F23.7090302@telecom-bretagne.eu>
References: <4BEC1A3F.2070101@telecom-bretagne.eu> <4BEC1D23.7010002@elzevir.fr> <4BEC1F23.7090302@telecom-bretagne.eu>
Message-ID: <4BEC212A.6010406@elzevir.fr>

Le 13/05/2010 17:47, Elie Roux a ?crit :
> Manuel P?gouri?-Gonnard a ?crit :
>> I'm all for inclusion in metalogo, but if it's not possible, I don't
>> see the
>> point in a luatexlogo package (precisely since there is no kerning to
>> do).
>>   
> I think the trickery of Heiko in the mail would have its place in a
> potential luatexlogo package...

I thought this trick was just for fun.

> or maybe luatexbase-logo? It's just that
> the name sounds less attractive...
> 
It doesn't belong to luatexbase IMO. It has nothing to do with basic resources
management.

m


From khaledhosny at eglug.org  Fri May 14 07:18:51 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 14 May 2010 08:18:51 +0300
Subject: [lltx] Moving to new list
In-Reply-To: <6BE26733-2D09-4C77-91C6-8DEAE999175B@gmail.com>
References: <60F9DE68-19B0-44CA-90B6-8F1A7B7384DF@gmail.com>
	<20100514042456.GA2699@khaled-laptop>
	<6BE26733-2D09-4C77-91C6-8DEAE999175B@gmail.com>
Message-ID: <20100514051851.GA3181@khaled-laptop>

On Fri, May 14, 2010 at 02:14:27PM +0930, Will Robertson wrote:
> On 14/05/2010, at 1:54 PM, Khaled Hosny wrote:
> 
> > Great, but the list archives need to be made puplic, also can't we
> > import archives of this list into tug one?
> 
> I've made the list archives public, but as far as I know it's not possible to import the archives from Google Groups into mailman. (I don't see a super-important need, do you?)

Not super-important, but I tend to use google to search in a certain
mailing list archives, and I guess many others would do so, with the old
messages in a different list, there will be little chance for people
finding them. But this would only happens when one restricts search to a
specific url, so it isn't that important.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Thu May 13 22:46:35 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 13 May 2010 23:46:35 +0300
Subject: [lltx] luatex logo
In-Reply-To: <20100513202707.GA3309@oberdiek.my-fqdn.de>
References: <4BEC1A3F.2070101@telecom-bretagne.eu> <20100513202707.GA3309@oberdiek.my-fqdn.de>
Message-ID: <4BEC652B.5000405@telecom-bretagne.eu>

Heiko Oberdiek a ?crit :
> The latter I have put in the quite new package `hologo'.
>   

Interesting, thank you!

There are though some interesting features that I like in metalogo (like 
some more beautiful kernings for some fonts and the possibility to 
adjust them and to share the settings... I really hope a solution could 
be found (integrating the automatic kerning trick into metalogo, but I 
doubt it will be accepted...), but I think that the only possibility to 
have a nice logo is to do it by hand, for example by combining the 
\HOLOGO at NegativeKerning{aT,oT,To} for the aT spacing and some metalogo 
settings for the TeX spacings... that's kind of sad.

Thank you,
-- 
Elie


From wspr81 at gmail.com  Fri May 14 05:08:35 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 12:38:35 +0930
Subject: [lltx] Future of xltxtra
Message-ID: <93FED8CB-3B39-452C-8E04-1E0619061052@gmail.com>

Hi,

I've now updated xltxtra to cope with the latest versions of fontspec.

On github I'm using two branches:

master -- XeTeX-only, up-to-date
luatex -- up-to-date with support for LuaTeX, based off Khaled's fork

Considering that xltxtra really stands for "XeLaTeX extras", my immediate thought was that we didn't need to worry too much about LuaTeX compatibility.

On the other hand, XeTeX users might want to try and compile their old documents with LuaTeX and this would cause unnecessarily problems.

Adding more complexity to the argument is that I've come to think that the whole idea of the xltxtra package was a bit of a mistake. It mixes features on too many levels:

1.  Low-level improvements and package loading
    (fixltx2e, etc., verbatim patching)
2.  User-level features (such as the superscript stuff)
3.  Not-very-useful user-level features (\vfrac, \namedglyph)

If I was to start from scratch, I'd drop #3 entirely, and move the subscript/superscript changes to a separate package.

But that doesn't solve what I see as the biggest issue: xltxtra is a silly name for LuaLaTeX.

I'm starting to think that the underlying things that fontspec does, such as fix footnotes by loading fixltx2e and patch verbatim to work with unicode, etc., could all be done internally.

The template for LuaLaTeX documents would look, then, like

\usepackage{fontspec}
\usepackage{...}% logos, real s'scripts, other user-features, etc.

Don't need xunicode since euenc takes care of it, and the relevant pieces of xltxtra will be folded into fontspec. I've resisted that sort of idea in the past but I'm now having a slow change of heart.

Having done this, we should still keep xltxtra working under LuaLaTeX simply to make things easier for cross-compatibility. With a big warning "THIS PACKAGE IS NO LONGER REQUIRED".

Any thoughts?

-- Will




From elie.roux at telecom-bretagne.eu  Mon May 10 19:40:24 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 20:40:24 +0300
Subject: [lltx] directlua
Message-ID: <4BE84508.9060708@telecom-bretagne.eu>

Hello,

I'm changing the code in luamplib, and I'm loading only 
luatexbase-modutils. The problem is that now I don't have the mapping 
directlua -> luadirect. This mapping was done when there was quite a 
madness about prefixing everything, but now things seem to calm down... 
so should we keep directlua or should we use luadirect? If we must use 
luadirect, then it would make sense to have a luatexbase.sty that does 
it, for packages to load it and automatically have things working... 
requiring all packages to load luatexbase-compat seems a bit weird 
(especially the name).

Thank you,
-- 
Elie


From mpg at elzevir.fr  Wed May 12 19:51:58 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 12 May 2010 19:51:58 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE55F14.1080300@telecom-bretagne.eu>
References: <4BE55F14.1080300@telecom-bretagne.eu>
Message-ID: <4BEAEABE.7010700@elzevir.fr>

Hi,

Le 08/05/2010 14:54, Elie Roux a ?crit :
> - execute the script at the end of the installation with tlmgr?

Norbert created a new trigger "addLuaMap" (named so since it is somehow similar
to add(Mixed)Map), which causes mkluatexfontdb-sys to be run (without options)
if present every time a package with this trigger is installed. I activated the
trigger for all packages that currently ship otf or ttf files (list below,
derived from texlive.tlpdb). We'll do the same for new packages shipping such files.

So, this part should be OK now. Of course it needs testing :)

> - add a button or something in the menu to execute it? Or integrate it
> in another tlmgr update button?

Still todo.

> - have the scripts mkluatexfontdb and mkluatexfontdb-sys in the binaries
> of TeXLive? (the program automatically switches to TEXMFSYSVAR if called
> with a filename containing "-sys")
> 
As Norbert said, it will be done as soon as luaotfload is uploaded to CTAN and
we install the new version in TL, this is almost normal procedure.

Manuel.


From elie.roux at telecom-bretagne.eu  Thu May 13 17:26:55 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 13 May 2010 18:26:55 +0300
Subject: [lltx] luatex logo
Message-ID: <4BEC1A3F.2070101@telecom-bretagne.eu>

Hello,

I think it would be great to have the \LuaTeX and \LuaLaTeX macros in a 
package for TeXLive 2010. Andrew do you think it would be possible to 
add the logos in metalogo? Adjusting kerning by hand seems an idea Hand 
and Taco don't want, so it would be best to keep something simple such 
as \def\LuaTeX{Lua\TeX}, but maybe something like 
http://tug.org/pipermail/luatex/2010-March/001331.html would be suitable 
too.

Do you think you could make an update to metalogo with these changes? 
Otherwise I think the best solution would be to make a luatexlogo 
package with these definitions.

Thank you,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Mon May 10 11:17:25 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 12:17:25 +0300
Subject: [lltx] new tlmgr action
In-Reply-To: <AANLkTinaVqhTw_qka4bl1DOvp2Fwnb5Hk-rmZ1CwKMiO@mail.gmail.com>
References: <4BE64D21.5050701@telecom-bretagne.eu>	 <20100509130459.GB2193@khaled-laptop>	 <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr>	 <4BE55F14.1080300@telecom-bretagne.eu>	 <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <AANLkTinaVqhTw_qka4bl1DOvp2Fwnb5Hk-rmZ1CwKMiO@mail.gmail.com>
Message-ID: <4BE7CF25.7040201@telecom-bretagne.eu>

T T a ?crit :
> And wrappers on win32. FYI, I added support for "-sys" scripts some
> time ago by setting:
>
> TEXMFCONFIG = $TEXMFSYSCONFIG
> TEXMFVAR = $TEXMFSYSVAR
>
> and calling the non-sys version. Dunno if it matters, but it might if
> you rely on arg[0] to check for "-sys" version.
>   

Hello,

that's exactly what we do ;) This means that we can safely remove this 
check? Should we keep the --sys option?

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Mon May 10 14:16:03 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 15:16:03 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE7E854.4090902@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr>
Message-ID: <20100510121603.GA2250@khaled-laptop>

On Mon, May 10, 2010 at 01:04:52PM +0200, Manuel P?gouri?-Gonnard wrote:
> The decision to migrate to luatexbase's master now or later is not mine. Please
> have a look at the Changes file and tell me if you are ready to do it now and
> want to delay it. If you want to do the transition now, ?lie already did some
> adaptations in luatextra's master. Please be aware that more incompatible
> changes may be coming, but, as far as I'm concerned, I'll always keep you
> informed about them.

I'm fine with migrating luaotfload and luaextra to luatexbase master,
provided that it is considered stable enough for texlive inclusion.
Now, do I still need luatextra or can I just load luatexbase and
luaextra directly.

BTW, I think now is better than later to pick a less confusing name for
luaextra, any suggestions?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From khaledhosny at eglug.org  Mon May 10 14:58:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 15:58:21 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE7FF12.2020904@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr>
 <20100510121603.GA2250@khaled-laptop>
 <4BE7FF12.2020904@elzevir.fr>
Message-ID: <20100510125821.GA2948@khaled-laptop>

On Mon, May 10, 2010 at 02:41:54PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 10/05/2010 14:16, Khaled Hosny a ?crit :
> > On Mon, May 10, 2010 at 01:04:52PM +0200, Manuel P?gouri?-Gonnard wrote:
> >> The decision to migrate to luatexbase's master now or later is not mine. Please
> >> have a look at the Changes file and tell me if you are ready to do it now and
> >> want to delay it. If you want to do the transition now, ?lie already did some
> >> adaptations in luatextra's master. Please be aware that more incompatible
> >> changes may be coming, but, as far as I'm concerned, I'll always keep you
> >> informed about them.
> > 
> > I'm fine with migrating luaotfload and luaextra to luatexbase master,
> > provided that it is considered stable enough for texlive inclusion.
> 
> Depends on what you mean by "stable".

Stable in the sense of no major rewrites in the near future, things are
clear now.

> > Now, do I still need luatextra or can I just load luatexbase and
> > luaextra directly.
> > 
> You can do as you want. luatextra still provides a few more things, but if you
> don't need them, you can load luatexbase and luaextra directly, but loading
> luatextra is not deprecated either.

I just dislike the name, nothing else :)

> > BTW, I think now is better than later to pick a less confusing name for
> > luaextra, any suggestions?
> > 
> I agree. ?lie's suggestion of lualibs sounds fine to me. (Or luautils, too.)

"lualibs" then.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From khaledhosny at eglug.org  Mon May 10 20:12:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 21:12:43 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE84A40.2010700@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr>
 <20100510121603.GA2250@khaled-laptop>
 <4BE7FF12.2020904@elzevir.fr>
 <20100510125821.GA2948@khaled-laptop>
 <20100510174643.GA4120@khaled-laptop>
 <4BE84A40.2010700@elzevir.fr>
Message-ID: <20100510181243.GA4285@khaled-laptop>

On Mon, May 10, 2010 at 08:02:40PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 10/05/2010 19:46, Khaled Hosny a ?crit :
> > On Mon, May 10, 2010 at 03:58:21PM +0300, Khaled Hosny wrote:
> >> "lualibs" then.
> > 
> > OK, I renamed the files in http://github.com/mpg/luaextra to lualibs
> > (except the reference to the repository), may be we should move the
> > repository too.
> > 
> I just moved the repository.
> 
> I hope everyone agreed with this new name, since the discussion was quite short.

I don't think there are many users of the package, if any, since it was
an internal package until recently, so I didn't expect much more
discussion.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 15:20:56 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 15:20:56 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <47B7EAC6-F2A2-4174-B40F-3F86578CC186@gmail.com>
References: <4BE7E854.4090902@elzevir.fr> <47B7EAC6-F2A2-4174-B40F-3F86578CC186@gmail.com>
Message-ID: <4BE80838.20703@elzevir.fr>

Le 10/05/2010 14:53, Will Robertson a ?crit :
> On 10/05/2010, at 20:34, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> 
>> I consider mpg/luatexbase on github to be the reference version. If
>> you want
>> push access to this version, it's ok with me as long as I am confident
>> you'll
>> act responsibly, eg make sure you understand what the branches are
>> for, try to
>> discuss before undoing things I did, and carefully check your code,
>> before
>> pushing anything.
> 
> I realise I've been (regretably) out of the loop all this time, but my
> opinion here is that since github makes forks so easy there's no huge
> pressing reason for everyone to have push access to each other's
> repositories. In fact, I sort of feel that it can dampen high frequency
> noise of the sort we've seen here, albeit with the downside that some
> things can take a little longer to propagate.
> 
I tend to agree.

But whatever solution we choose, I'd like to emphasize again the importance of
communicating in order to avoid counter-productive moves. If there are many
forks, one of them has to be the reference and one should always seek
integration in the reference repo in order to avoid yet another mess.

Manuel.


From wspr81 at gmail.com  Sun May  9 08:45:41 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 9 May 2010 16:15:41 +0930
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE64D21.5050701@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu>
Message-ID: <DA9C502F-26E4-4B8C-B5DE-F88383DC53E1@gmail.com>

On 09/05/2010, at 3:20 PM, Elie Roux wrote:

> here is the answer from Karl. Are we ready to upload everything on the CTAN? Tomorrow for example? We should upload luatextra, euenc, fontspec and luaotfload... did I forget something?

I'm afraid there's still more work to be done before we can upload fontspec. (The manual, mostly.)

Can we stick with the low-level tools for now? Perhaps make an comment in the announcement text for otfload that fontspec for LuaLaTeX is well on its way...

-- Will



From wspr81 at gmail.com  Tue May 11 05:54:45 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 11 May 2010 13:24:45 +0930
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <20100511031223.GC2356@khaled-laptop>
References: <4BBC4AD6.2080305@gmail.com> <20100407095509.GA3437@khaled-laptop> <4BBCF447.2050603@gmail.com> <20100407231624.GA5067@khaled-laptop> <4BBDA8C8.9070407@gmail.com> <20100408121930.GB29952@khaled-laptop> <20100408170745.GA32215@khaled-laptop> <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com> <20100409070923.GA2201@khaled-laptop> <20100511031223.GC2356@khaled-laptop>
Message-ID: <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com>

On 11/05/2010, at 12:42 PM, Khaled Hosny wrote:

> On Fri, Apr 09, 2010 at 09:09:23AM +0200, Khaled Hosny wrote:
>> On Fri, Apr 09, 2010 at 10:09:47AM +0930, Will Robertson wrote:
>>> The following defaults will happen, I think:
>>> 
>>> \fontspec{Latin Modern Roman} % <- name
>>> \fontspec{ec-lmr10}           % <- name
>> ec-lmr10 is a tfm file, but anyway the name mechanism falls back to
>> filename if no font is found (but going directly to filename search is
>> faster).
>> 
>>> \fontspec{ec-lmr10.otf}       % <- file (from the extension)
>>> \fontspec[Path]{ec-lmr10}     % <- file
>>> 
>>> ([Path] is the same as [ExternalLocation].)
>>> 
>>> This is the same as currently happens, so I can't see any problems.
>> 
>> OK, once the change is made in fontspec, I'll change luaotfload
>> defaults.
> 
> Will, any updates on this? I want to make the change before uploading to
> CTAN, but I'm not sure how broken fontspec will be then.


To confirm: this means that you'll no longer be compatible with XeTeX if people use the plain \font syntax. Is this actually okay? I'm starting to think it might not be the best idea.

From the point of view of fontspec it doesn't make any difference, but I just want to make sure we're not raising another problem in trying to solve an edge case.

As a counterpoint, what would happen instead if the filename database was queried first and only if a font was not found in the search path a system (or named) font was used?

\font\tenrm=ec-lmr10        % file
\font\tenrm=file:ec-lmr10   % file
\font\tenrm=sys-ec-lmr10    % name if not found as a file
\font\tenrm={name:Latin Modern Roman} % name

This would still solve the problem from the beginning of this thread (I think), and looks to me a little more simple. Have I missed a problem with this approach, though?

-- Will



From preining at logic.at  Mon May 10 16:32:48 2010
From: preining at logic.at (Norbert Preining)
Date: Mon, 10 May 2010 23:32:48 +0900
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE81787.6070208@elzevir.fr> <20100510041407.GB2300@khaled-laptop>
References: <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <4BE81787.6070208@elzevir.fr> <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop>
Message-ID: <20100510143248.GF22488@gamma.logic.tuwien.ac.at>

On Mo, 10 Mai 2010, Khaled Hosny wrote:
> I'd say the script would run as part of installation process and
> whenever opentype fonts are installed. But since we also index system

There is by now no mechanism to trigger anything depending on specific
file types in tlmgr. We have package specific actions (which could of course
be donee by adding the call to the script to each package's script postaction),
and some "generic" for hyphenation patterns, font maps, formats. 

Ok I am unclear.

We have now specific postaction type for opentype fonts, only for font maps.
But we can execute a script in postaction script.

On Mo, 10 Mai 2010, Manuel P?gouri?-Gonnard wrote:
> Is it a problem to run the script more often than necessary? (For example,
> whenever fonts of any type are installed.) If it's ok, I agree with Norbert that
> we whould run it whenever we run updmap-sys.

That is the idea, because in I guess (without checking) all cases where
otf fonts are installed as texlive package also some map file is installed.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
ULLAPOOL (n.)
The spittle which builds up on the floor of the Royal Opera House.
			--- Douglas Adams, The Meaning of Liff


From khaledhosny at eglug.org  Tue May 11 05:12:23 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 11 May 2010 06:12:23 +0300
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <20100409070923.GA2201@khaled-laptop>
References: <4BBC4AD6.2080305@gmail.com>
 <20100407095509.GA3437@khaled-laptop>
 <4BBCF447.2050603@gmail.com>
 <20100407231624.GA5067@khaled-laptop>
 <4BBDA8C8.9070407@gmail.com>
 <20100408121930.GB29952@khaled-laptop>
 <20100408170745.GA32215@khaled-laptop>
 <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com>
 <20100409070923.GA2201@khaled-laptop>
Message-ID: <20100511031223.GC2356@khaled-laptop>

On Fri, Apr 09, 2010 at 09:09:23AM +0200, Khaled Hosny wrote:
> On Fri, Apr 09, 2010 at 10:09:47AM +0930, Will Robertson wrote:
> > The following defaults will happen, I think:
> > 
> > \fontspec{Latin Modern Roman} % <- name
> > \fontspec{ec-lmr10}           % <- name
> ec-lmr10 is a tfm file, but anyway the name mechanism falls back to
> filename if no font is found (but going directly to filename search is
> faster).
> 
> > \fontspec{ec-lmr10.otf}       % <- file (from the extension)
> > \fontspec[Path]{ec-lmr10}     % <- file
> > 
> > ([Path] is the same as [ExternalLocation].)
> > 
> > This is the same as currently happens, so I can't see any problems.
> 
> OK, once the change is made in fontspec, I'll change luaotfload
> defaults.

Will, any updates on this? I want to make the change before uploading to
CTAN, but I'm not sure how broken fontspec will be then.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Mon May 10 10:38:54 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 11:38:54 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <20100510042745.GA2514@khaled-laptop>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop>
Message-ID: <4BE7C61E.6060001@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I myself didn't upgrade, because I, again, have no clear view of the
> situation, and I don't want to break my semi-working system farther.
>   

The masters of khaledhosny/luaotfload, mpg/luatextra and 
eroux/luatexbase should be working together now... I added everyone to 
eroux/luatexbase, so feel free to push if something doesn't work!

Thank you,
-- 
Elie


From mpg at elzevir.fr  Mon May 10 15:27:48 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 15:27:48 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE808C9.90305@telecom-bretagne.eu>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FCFC.8000309@telecom-bretagne.eu> <20100510130113.GB2948@khaled-laptop> <4BE808C9.90305@telecom-bretagne.eu>
Message-ID: <4BE809D4.6020204@elzevir.fr>

Le 10/05/2010 15:23, Elie Roux a ?crit :
> Khaled Hosny a ?crit :
>> alt-getopt.lua is genric lua code with no luatex specific dependencies
>> unlike most of current luaextra modules, so I'm not sure if it really
>> makes sense.
>>   
> 
> I tend to disagree here: all the files in luaextra could very well fit
> in any other lua program, it's just some high-level lua libraries, take
> file or table for example, there is nothing luatex-specific in there...
> So for me a package that would include some higher-level lua libraries
> would make sense. Of course we cannot include everything, but the
> minimum for a smooth package development would be nice, and I think it
> would be reached with luaextra + alt-getopt (maybe some more things, but
> this seems OK to me). Also IIRC there is no license problem in including
> it. This would make more sense to me than more and more lua libraries
> packages on the CTAN... Just to make sure: the plan is to include it in
> the same package, not to load it by default (it doesn't really make sense).
> 
What would be gained by including alt-getopt in lualibs? Nothing. (I don't
consider the number of packages to be of any value.) But there are some problems
with mixing them, like different authors, different developement cycles, etc.

So, I'm still against this inclusion.

Manuel.


From preining at logic.at  Tue May 11 13:52:44 2010
From: preining at logic.at (Norbert Preining)
Date: Tue, 11 May 2010 20:52:44 +0900
Subject: [lltx] new tlmgr action
In-Reply-To: <4BE83194.1000808@elzevir.fr>
References: <4BE81787.6070208@elzevir.fr> <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <20100510143248.GF22488@gamma.logic.tuwien.ac.at> <4BE83194.1000808@elzevir.fr>
Message-ID: <20100511115244.GD7818@gamma.logic.tuwien.ac.at>

On Mo, 10 Mai 2010, Manuel P?gouri?-Gonnard wrote:
> We may want to create a new postaction for this script.

I tend to disagree. I try to prevent proliferation of postactions, we have
already severals, and in this case the incantation is always the same,
there is no data to carry over. 

If the script will reside somewhere in the texmf(-dist) hierarchy I suggest
to simpy add
	postaction script file=texmf-dist/scripts/foo/bar/mkfontblabla.texlua
to the respective packages.

Note that we currently only support automatic detection of file with
extension of
	.pl		perl
	.texlua		texlua
but not .lua.

Everything else is just run as is with perl cmd, so in any case it should
work.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
HORTON-CUM-STUDLEY (n.)
The combination of little helpful grunts, nodding movements of the
head, considerate smiles, upward frowns and serious pauses that a
group of people join in making in trying to elicit the next
pronouncement of somebody with a dreadful stutter.
			--- Douglas Adams, The Meaning of Liff


From khaledhosny at eglug.org  Mon May 10 15:34:44 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 16:34:44 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE808C9.90305@telecom-bretagne.eu>
References: <4BE7E854.4090902@elzevir.fr>
 <20100510121603.GA2250@khaled-laptop>
 <4BE7FCFC.8000309@telecom-bretagne.eu>
 <20100510130113.GB2948@khaled-laptop>
 <4BE808C9.90305@telecom-bretagne.eu>
Message-ID: <20100510133444.GA3194@khaled-laptop>

On Mon, May 10, 2010 at 04:23:21PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >alt-getopt.lua is genric lua code with no luatex specific dependencies
> >unlike most of current luaextra modules, so I'm not sure if it really
> >makes sense.
> 
> I tend to disagree here: all the files in luaextra could very well
> fit in any other lua program,

Nope, they don't. They depend on specific modules built in luatex not
available in standard lua.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From elie.roux at telecom-bretagne.eu  Mon May 10 15:23:21 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 16:23:21 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510130113.GB2948@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FCFC.8000309@telecom-bretagne.eu> <20100510130113.GB2948@khaled-laptop>
Message-ID: <4BE808C9.90305@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> alt-getopt.lua is genric lua code with no luatex specific dependencies
> unlike most of current luaextra modules, so I'm not sure if it really
> makes sense.
>   

I tend to disagree here: all the files in luaextra could very well fit 
in any other lua program, it's just some high-level lua libraries, take 
file or table for example, there is nothing luatex-specific in there... 
So for me a package that would include some higher-level lua libraries 
would make sense. Of course we cannot include everything, but the 
minimum for a smooth package development would be nice, and I think it 
would be reached with luaextra + alt-getopt (maybe some more things, but 
this seems OK to me). Also IIRC there is no license problem in including 
it. This would make more sense to me than more and more lua libraries 
packages on the CTAN... Just to make sure: the plan is to include it in 
the same package, not to load it by default (it doesn't really make sense).

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Sun May  9 15:04:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 9 May 2010 16:04:59 +0300
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE64D21.5050701@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu>
Message-ID: <20100509130459.GB2193@khaled-laptop>

On Sun, May 09, 2010 at 08:50:25AM +0300, Elie Roux wrote:
> Hello,
> 
> here is the answer from Karl. Are we ready to upload everything on
> the CTAN? Tomorrow for example? We should upload luatextra, euenc,
> fontspec and luaotfload... did I forget something?

For luaotfload I still need to sync with ConTeXt (there are few fixes
and new features I'm interested about), also I was waiting for the
luatextra/luaextra split to be finalised and update luaotfload
accordingly, the situation now is a bit messy.

I've some less important TODO items like fixing logging and adding
support to load external fonts by font name (for use with fontspec's
ExternalLocation feature), but I think we can live without it.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 20:15:07 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 20:15:07 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510181243.GA4285@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FF12.2020904@elzevir.fr> <20100510125821.GA2948@khaled-laptop> <20100510174643.GA4120@khaled-laptop> <4BE84A40.2010700@elzevir.fr> <20100510181243.GA4285@khaled-laptop>
Message-ID: <4BE84D2B.2070203@elzevir.fr>

Le 10/05/2010 20:12, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 08:02:40PM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 10/05/2010 19:46, Khaled Hosny a ?crit :
>>> On Mon, May 10, 2010 at 03:58:21PM +0300, Khaled Hosny wrote:
>>>> "lualibs" then.
>>>
>>> OK, I renamed the files in http://github.com/mpg/luaextra to lualibs
>>> (except the reference to the repository), may be we should move the
>>> repository too.
>>>
>> I just moved the repository.
>>
>> I hope everyone agreed with this new name, since the discussion was quite short.
> 
> I don't think there are many users of the package, if any, since it was
> an internal package until recently, so I didn't expect much more
> discussion.
> 
Agreed, that's why I moved the repo without waiting any longer.

m


From mpg at elzevir.fr  Thu May 13 15:18:33 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Thu, 13 May 2010 15:18:33 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <20100513124746.GC2358@khaled-laptop>
References: <4BE55F14.1080300@telecom-bretagne.eu> <4BEAEABE.7010700@elzevir.fr> <20100513012703.GD3188@gamma.logic.tuwien.ac.at> <4BEBBEA6.9090905@telecom-bretagne.eu> <20100513085732.GI27051@gamma.logic.tuwien.ac.at> <4BEBC3A1.9070903@elzevir.fr> <20100513124746.GC2358@khaled-laptop>
Message-ID: <4BEBFC29.1090208@elzevir.fr>

Le 13/05/2010 14:47, Khaled Hosny a ?crit :
> On Thu, May 13, 2010 at 11:17:21AM +0200, Manuel P?gouri?-Gonnard wrote:
>> Of course today's update is just a snapshot, probably full of bugs, so we're
>> happy to use the TL pre-test phase in order to squash them. We plan to do more
>> snapshot upload as needed, then put up a (hopefully good) final version before
>> the final freeze.
> 
> For "squashing bugs", I think we need to advertise this list more
> prominently as it seems no much people know about it. I still get
> personal emails about luaotfload/lualibs issues.
> 
Also, we should make an announcement on the luatex list concerning the packages
as soon as a TL pretest build is available, so that people know they can test
easily.

Concerning the list:
- Taco said it is OK if user report/discussions go to the luatex list
- According to google 30 persons are subscribed to the present list, which is
not so bad for a rather young -dev list.
- The list may be moved to tug.org soon, so maybe it's worth waiting for this
move to happen before advertising.

After creating the list, Will said he'd wait a moment and advertise it a bit
(texhax, ctt). I think now (or more precisely, just after moving to tug.org)
would be a good moment for that.

Manuel.


From mpg at elzevir.fr  Mon May 10 15:03:21 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 15:03:21 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510130113.GB2948@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop> <4BE7FCFC.8000309@telecom-bretagne.eu> <20100510130113.GB2948@khaled-laptop>
Message-ID: <4BE80419.6020603@elzevir.fr>

Le 10/05/2010 15:01, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 03:33:00PM +0300, Elie Roux wrote:
>> Khaled Hosny a ?crit :
>>> BTW, I think now is better than later to pick a less confusing name for
>>> luaextra, any suggestions?
>>
>> I agree on this. What about lualibs? Just a thought: what about
>> integrating alt-getopt.lua in lua[extra/libs]? This would make sense
>> for me...
> 
> alt-getopt.lua is genric lua code with no luatex specific dependencies
> unlike most of current luaextra modules, so I'm not sure if it really
> makes sense.
> 
I agree. In a more general way, it doesn't make sense IMO to have big packages
with many different things in it, unless they are interdependent.

Manuel.


From elie.roux at telecom-bretagne.eu  Mon May 10 20:37:18 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 21:37:18 +0300
Subject: [lltx] directlua
In-Reply-To: <4BE85125.7080504@elzevir.fr>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop> <4BE848B2.9000004@elzevir.fr> <4BE84D73.9060702@telecom-bretagne.eu> <4BE85125.7080504@elzevir.fr>
Message-ID: <4BE8525E.2030005@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I'm all for \newcatcodetable (and \setcatcodetable accordingly). If 
> everyone
> agrees, we can move to it whenever you guys want to.
>   

That would be great!

> I'm more reserved on \newattribute. Unlike "catcodetable", "attribute" is a very
> generic term, so chances are high it is already used. I grepped CTAN's macros
> directory for it, and fortunatly found no match (except of course Heiko's
> luatex.sty and packages using it). Unfortunately, at least one class not on CTAN
> is already using this name, see:
>
> http://www.e-publications.org/ims/support/
> http://www.e-publications.org/ims/support/download/imsart-generic.zip
>
> We have to be aware that this class will be incompatible with luatexbase if we
> decide to use \newattribute. I'm not saying it is a showstopper, since we may
> also consider that the class is wrong to use such a generic name and should
> prefix its internal macros with a unique (or at least non-generic) string.
>   

I'm in favor of moving to newattribute... but last time I wanted to do 
such a thing, the blocking point was Karl... did he change his mind? 
Anyway, I think a solution is also to write to the people who wrote the 
class, there is a mail address on the page.

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Fri May 14 07:06:10 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 14 May 2010 08:06:10 +0300
Subject: [lltx] Future of xltxtra
In-Reply-To: <93FED8CB-3B39-452C-8E04-1E0619061052@gmail.com>
Message-ID: <20100514050610.GA2805@khaled-laptop>

On Fri, May 14, 2010 at 05:08:35AM, Will Robertson wrote:
> Hi,
> 
> I've now updated xltxtra to cope with the latest versions of fontspec.
> 
> On github I'm using two branches:
> 
> master -- XeTeX-only, up-to-date
> luatex -- up-to-date with support for LuaTeX, based off Khaled's fork
> 
> Considering that xltxtra really stands for "XeLaTeX extras", my
> immediate thought was that we didn't need to worry too much about LuaTeX
> compatibility.
> 
> On the other hand, XeTeX users might want to try and compile their old
> documents with LuaTeX and this would cause unnecessarily problems.
> 
> Adding more complexity to the argument is that I've come to think that
> the whole idea of the xltxtra package was a bit of a mistake. It mixes
> features on too many levels:
> 
> 1.  Low-level improvements and package loading
>     (fixltx2e, etc., verbatim patching)
> 2.  User-level features (such as the superscript stuff)
> 3.  Not-very-useful user-level features (\vfrac, \namedglyph)
> 
> If I was to start from scratch, I'd drop #3 entirely, and move the
> subscript/superscript changes to a separate package.
> 
> But that doesn't solve what I see as the biggest issue: xltxtra is a
> silly name for LuaLaTeX.
> 
> I'm starting to think that the underlying things that fontspec does,
> such as fix footnotes by loading fixltx2e and patch verbatim to work
> with unicode, etc., could all be done internally.
> 
> The template for LuaLaTeX documents would look, then, like
> 
> \usepackage{fontspec}
> \usepackage{...}% logos, real s'scripts, other user-features, etc.
> 
> Don't need xunicode since euenc takes care of it, and the relevant
> pieces of xltxtra will be folded into fontspec. I've resisted that sort
> of idea in the past but I'm now having a slow change of heart.
> 
> Having done this, we should still keep xltxtra working under LuaLaTeX
> simply to make things easier for cross-compatibility. With a big warning
> "THIS PACKAGE IS NO LONGER REQUIRED".
> 
> Any thoughts?

Seeing how people get confused about what xltxtra is for, I'd rather
make the package detect luatex and this show an error message. This way
we give the users a meaningful error message and avoid continuing the
confusion.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From mpg at elzevir.fr  Mon May 10 18:17:24 2010
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 10 May 2010 18:17:24 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <20100510143248.GF22488@gamma.logic.tuwien.ac.at>
References: <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <4BE81787.6070208@elzevir.fr> <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <20100510143248.GF22488@gamma.logic.tuwien.ac.at>
Message-ID: <4BE83194.1000808@elzevir.fr>

Le 10/05/2010 16:32, Norbert Preining a ?crit :
> That is the idea, because in I guess (without checking) all cases where
> otf fonts are installed as texlive package also some map file is installed.
> 
Thanks for making this assumption explicit: it made me check and realise it is
wrong. A counter-example is philokalia there are probably others (didn't check
further).

We may want to create a new postaction for this script.

I suggest we continue this discussion internally, since we have all the
information we need on the script thanks to Khaled and ?lie, so this is now a TL
issue.

Manuel.


From mpg at elzevir.fr  Mon May 10 13:47:15 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 13:47:15 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7E9AF.7090809@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr> <4BE7CE97.9060208@telecom-bretagne.eu> <4BE7D2A8.5080303@elzevir.fr> <4BE7E9AF.7090809@telecom-bretagne.eu>
Message-ID: <4BE7F243.30805@elzevir.fr>

Le 10/05/2010 13:10, Elie Roux a ?crit :
> I think the main issue is timing here... let's discuss about it.
> 
Good idea, let's discuss.

> If I understand correctly, there is a version of luatexbase that is
> compatible with old versions of packages (it didn't work with me, but
> now that I have a version working, I don't really want to report bugs on
> the other), and there is also a new one introducing incompatible
> changes, like not writing in the callback nor tex table except for
> overriding callback.register.

Right.

> I totally agree with this changes. Where I
> disagree is when we should introduce those changes.

Well, since I never gave an opinion on that point, I fail to understand how you
can disagree with what I didn't say. So, just as I'm asking you to make me a
clear bug report and letting me reasonable amount of time (like 24h) to fiw it
before forking everything, I'm also asking you to ask me for my opinion before
disagreeing with it.

> If they are to be
> made (I think everyone agrees on it), why not changing it now, we have
> plenty of time to fix the other packages according to these changes.

I agree, but as I said in my other message minutes ago, the decision is not mine
to make, since the burden of adapting code in luaotfload, fontspec and other
packages relying on luatextra that I'm less aware of (like gregorio) isn't mine
either. So i'd like to have everyone's opinion on that.

I tend to agree with you: now would be a good time if it fits everyone's agenda.

> possible bugs (especially the huge one from
> http://github.com/eroux/luatexbase/commit/1b9ba1489eff995eedcc2c8bf41026cbedc75be9),

It happens only when both foobar.tex and foobar.lua exist. Also, your fix had
typos that made the code silently not work as advertised, and you didn't
document it. You also "fixed" a non-problem in the same commit.

Anyway, bugs happen and that's precisely why I asked everyone to bug me if
something stopped working when I released the fixed version. That doesn't make a
reason to fork after only a few hours of this bug not being fixed (while it has
been there for months).

> this gives me a bad feeling about pushing a version in TeXLive 2010 that
> noone tested except for you.

It has been tested by others, since I got reports about that. But of course I
agree that it's desirable to get as testing as possible. I took some time to
write a long message explaining things (2010603-28). If it wasn't clear enough,
I apologize for it, but you could ask me for clarification and wait a few hours
for me to answer. Btw, that's what happened, except that you though it was
appropriate to complicated the situation even more by forking because I promised
a clarification for today but decided to go sleeping first...

> Also, the reason I took the master branch
> is that in the master of luatextra, luamcallback dissapeared, but it is
> called by the compatible version of luatexbase, which means that the
> compatible version of luatexbase is in fact incompatible with the new
> version of luatextra... it certainly makes a lot of sense to you,

No, before your last commit, master of luatextra was compatible with luatexbase
tag 0.1 (now branch 0.1x) and luaextra's master as advertised.

> Summing up, I don't agree to work on several versions of all the
> packages at the same time, we should push all the (incompatible) changes
> now and test against the LuaTeX of TeXLive 2010.

I also think this is the way to go.

FYI (in case you want to try to understand and not only criticize) I was waiting
for Heiko's reply on luatex.sty and luatex-base merging, which could have
introduced more incompatible changes, before


> Otherwise you'll be
> alone to know the details of the compatibilities...

I have been trying hard to communicate on it, by email on this list and the
luatex list, and in the Changes file in luatexbase.

> But if I understand
> your last mail correctly, you're in the TeXLive team so you're the
> boss...

???!! I *never* said or *even thought* something like that! Insinuating that I
want to abuse my position as a TL developer is insulting! Will you please stop
insulting me? I'm trying to have a technical discussion here.

My point was, I'm strongly under the impression that you don't try to understand
my work and plans concerning luatexbase before modifying it. I was just asking
you to consider that if I made a change in the code or worked in some way, I may
have reasons for that, and these reasons may be valuable even if you wouldn't
have done things the same way, so please make the effort to discuss with me
before forking things and basically reverting my commits. This is common
courtesy, and I think I deserve it.

> I'm fine with it, I have a working version on my computer now, I
> can finally work.
> 
You could have achieved the same results with only a few hours difference, by
waiting for me to fix it as I told you yesterday I would do today. This would
have saved us some painful words too.

Manuel.


From heiko.oberdiek at googlemail.com  Mon May 10 23:20:17 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Mon, 10 May 2010 23:20:17 +0200
Subject: [lltx] directlua
In-Reply-To: <4BE84508.9060708@telecom-bretagne.eu>
References: <4BE84508.9060708@telecom-bretagne.eu>
Message-ID: <20100510212016.GA11073@oberdiek.my-fqdn.de>

Hello,

On Mon, May 10, 2010 at 08:40:24PM +0300, Elie Roux wrote:

> I'm changing the code in luamplib, and I'm loading only
> luatexbase-modutils. The problem is that now I don't have the
> mapping directlua -> luadirect. This mapping was done when there was
> quite a madness about prefixing everything,

* Is \directlua always available?
  Or are there formats with undefined \directlua that is
  available as \luadirect?
* Anyway, you need to check for LuaTeX and it's version.
  I doubt, that you want to support *all* older LuaTeX versions.
  Also the syntax of \directlua has changed.

Package ifluatex.sty can be loaded by iniTeX and provides
\ifluatex, \luatexversion, and \luatexversion. It only
requires \directlua. Should I change this that in case
\directlua is not available that \luadirect is tried?

Yours sincerely
  Heiko Oberdiek


From mpg at elzevir.fr  Mon May 10 11:32:24 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 11:32:24 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE7CE97.9060208@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <20100510042745.GA2514@khaled-laptop> <4BE7C61E.6060001@telecom-bretagne.eu> <4BE7C8AD.8000201@elzevir.fr> <4BE7CB95.8030309@elzevir.fr> <4BE7CE97.9060208@telecom-bretagne.eu>
Message-ID: <4BE7D2A8.5080303@elzevir.fr>

Le 10/05/2010 11:15, Elie Roux a ?crit :
> Manuel P?gouri?-Gonnard a ?crit :
>> Did you read my previous mails? Did you read "summary of incompatible
>> changes between 0.1x and 0.2" in the Changes file? 0.2 is *not* meant to
>> be backward compatible! It stopped writing things in the callback table
>> on purpose.
>>   
> 
> I know that,

Ok, so you consciously unmade a change I did on purpose without discussing it
with me. If that is your vision of collaborative development... For me,
collaborative development implies much more than push access to a repository.

Sorry for answering publicly to a private mail, but by prefering to keep control
over luatexbase for a moment, I'm not acting like a kid not wanting to share his
toy. I think I'm quite a bit more mature than that. Whatever you think, I'm also
more experienced than you with TeX, and working hard to produce quality code.
Please respect that by not insulting me and taking the time to discuss with me
before undoing changes I made in some code. Thanks in advance.

> but my goal was to make a version that works

It doesn't work any better that a fixed 0.1 version would have.

> and that is
> compatible with the master versions of the other packages.

I doubt that unless you carefully checked the list of incompatibilities against
the code of other packages too. (If you did, please inform us, since this would
be good news.)

> I think
> that's what most people want... With this version and the latest code of
> other packages, everything works fine... Now people (and not only you)
> can update their system, test, understand how it works, etc., and we can
> discuss.
> 
We could discuss earlier too.

I could have fixed the know problems and made a clear summary by now if I didn't
lose time and energy with your forking compulsion.

Manuel.


From mpg at elzevir.fr  Mon May 10 01:21:36 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 01:21:36 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE6E68E.7030502@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu>
Message-ID: <4BE74380.1020600@elzevir.fr>

Le 09/05/2010 18:45, Elie Roux a ?crit :
> Khaled Hosny a ?crit :
>> For luaotfload I still need to sync with ConTeXt (there are few fixes
>> and new features I'm interested about), also I was waiting for the
>> luatextra/luaextra split to be finalised and update luaotfload
>> accordingly, the situation now is a bit messy.
> 
> I didn't realize the current situation was such a mess,

I'm still not sure it is.

> I've just tried
> to update everything, and I'm fixing small pieces of code everywhere,
> almost nothing works... Even
> http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-20100330.tds.zip
> doesn't work with my (latest trunk) LuaTeX...

I'm very surprised, I tested it thouroghly with luatex 0.25.4, 0.40.6 and
whatever was trunk at this date. Could you please provide me a test file so that
I can try to reproduce your problems?

> I think we should put a
> lot of efforts on making it work soon. I'll be available the next few
> days so I can take care of it. Manuel, could you give us the rights on
> luatexbase and tell us what you think about it?
> 
Unless you strongly disagree, I prefer keeping control of luatexbase for now.
I'll be as active as needed in order to have a stable version in time for TL'10.

I'll run some tests again tomorrow and keep you posted.

Manuel.


From wspr81 at gmail.com  Sun May  9 09:49:16 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 9 May 2010 17:19:16 +0930
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <4BE65FE8.60608@telecom-bretagne.eu>
References: <4BE64D21.5050701@telecom-bretagne.eu> <DA9C502F-26E4-4B8C-B5DE-F88383DC53E1@gmail.com> <4BE65FE8.60608@telecom-bretagne.eu>
Message-ID: <DA748236-B694-4F3F-B68F-92F5393BB4C7@gmail.com>

On 09/05/2010, at 4:40 PM, Elie Roux wrote:

> Sure, fontspec can be uploaded later... I'd really like it to be in TeXLive 2010 DVD though... do you think it will be OK?

Yes, I agree.
When's the deadline?

Have you guys all been using fontspec recently? Are there any outstanding issues that you're aware of? (I know I asked this before, but I just like to double-check.)

I do have a message from Khaled flagged about changing the default settings for how fonts are loaded (using an explicit "file:..." syntax); but other than that my todo list -- besides long-standing bugs -- is mostly for the documentation.

-- Will



From mpg at elzevir.fr  Thu May 13 17:39:15 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 13 May 2010 17:39:15 +0200
Subject: [lltx] luatex logo
In-Reply-To: <4BEC1A3F.2070101@telecom-bretagne.eu>
References: <4BEC1A3F.2070101@telecom-bretagne.eu>
Message-ID: <4BEC1D23.7010002@elzevir.fr>

Le 13/05/2010 17:26, Elie Roux a ?crit :
> I think it would be great to have the \LuaTeX and \LuaLaTeX macros in a
> package for TeXLive 2010. Andrew do you think it would be possible to
> add the logos in metalogo? Adjusting kerning by hand seems an idea Hand
> and Taco don't want, so it would be best to keep something simple such
> as \def\LuaTeX{Lua\TeX}, but maybe something like
> http://tug.org/pipermail/luatex/2010-March/001331.html would be suitable
> too.
> 
> Do you think you could make an update to metalogo with these changes?
> Otherwise I think the best solution would be to make a luatexlogo
> package with these definitions.
> 
I'm all for inclusion in metalogo, but if it's not possible, I don't see the
point in a luatexlogo package (precisely since there is no kerning to do).

Manuel.


From khaledhosny at eglug.org  Mon May 10 19:51:40 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 May 2010 20:51:40 +0300
Subject: [lltx] directlua
In-Reply-To: <4BE84508.9060708@telecom-bretagne.eu>
References: <4BE84508.9060708@telecom-bretagne.eu>
Message-ID: <20100510175140.GA4170@khaled-laptop>

On Mon, May 10, 2010 at 08:40:24PM +0300, Elie Roux wrote:
> Hello,
> 
> I'm changing the code in luamplib, and I'm loading only
> luatexbase-modutils. The problem is that now I don't have the
> mapping directlua -> luadirect. This mapping was done when there was
> quite a madness about prefixing everything, but now things seem to
> calm down... so should we keep directlua or should we use luadirect?
> If we must use luadirect, then it would make sense to have a
> luatexbase.sty that does it, for packages to load it and
> automatically have things working... requiring all packages to load
> luatexbase-compat seems a bit weird (especially the name).

I'd say let luadirect die and use directlua for new/updated code as,
IIRC, this part of luatex is now stabilized. If compatibility with very
old luatex versions is needed, one can then load luatexbase-compat.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From khaledhosny at eglug.org  Tue May 11 06:34:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 11 May 2010 07:34:17 +0300
Subject: [lltx] [luaotfload] Footnotes
In-Reply-To: <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com>
References: <20100407095509.GA3437@khaled-laptop>
 <4BBCF447.2050603@gmail.com>
 <20100407231624.GA5067@khaled-laptop>
 <4BBDA8C8.9070407@gmail.com>
 <20100408121930.GB29952@khaled-laptop>
 <20100408170745.GA32215@khaled-laptop>
 <2D4509D0-A9CE-4571-A71E-01D02DAAA3F8@gmail.com>
 <20100409070923.GA2201@khaled-laptop>
 <20100511031223.GC2356@khaled-laptop>
 <D4275DBA-B2DD-49F6-B38F-E5FB80DAAE3C@gmail.com>
Message-ID: <20100511043417.GA6603@khaled-laptop>

On Tue, May 11, 2010 at 01:24:45PM +0930, Will Robertson wrote:
> On 11/05/2010, at 12:42 PM, Khaled Hosny wrote:
> 
> > On Fri, Apr 09, 2010 at 09:09:23AM +0200, Khaled Hosny wrote:
> >> On Fri, Apr 09, 2010 at 10:09:47AM +0930, Will Robertson wrote:
> >>> The following defaults will happen, I think:
> >>> 
> >>> \fontspec{Latin Modern Roman} % <- name
> >>> \fontspec{ec-lmr10}           % <- name
> >> ec-lmr10 is a tfm file, but anyway the name mechanism falls back to
> >> filename if no font is found (but going directly to filename search is
> >> faster).
> >> 
> >>> \fontspec{ec-lmr10.otf}       % <- file (from the extension)
> >>> \fontspec[Path]{ec-lmr10}     % <- file
> >>> 
> >>> ([Path] is the same as [ExternalLocation].)
> >>> 
> >>> This is the same as currently happens, so I can't see any problems.
> >> 
> >> OK, once the change is made in fontspec, I'll change luaotfload
> >> defaults.
> > 
> > Will, any updates on this? I want to make the change before uploading to
> > CTAN, but I'm not sure how broken fontspec will be then.
> 
> 
> To confirm: this means that you'll no longer be compatible with XeTeX if people use the plain \font syntax. Is this actually okay? I'm starting to think it might not be the best idea.
> 
> From the point of view of fontspec it doesn't make any difference, but I just want to make sure we're not raising another problem in trying to solve an edge case.
> 
> As a counterpoint, what would happen instead if the filename database was queried first and only if a font was not found in the search path a system (or named) font was used?

That sounds very reasonable, but my knowledge about legacy tex fonts is
bit limited, right now I just check if there is a tfm file with the same
name, kpse.find_file(name, "tfm"), and if true I skip font names
database, is this safe assumption? what about virtual fonts?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer


From wspr81 at gmail.com  Fri May 14 06:44:27 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 14:14:27 +0930
Subject: [lltx] Moving to new list
In-Reply-To: <20100514042456.GA2699@khaled-laptop>
References: <60F9DE68-19B0-44CA-90B6-8F1A7B7384DF@gmail.com> <20100514042456.GA2699@khaled-laptop>
Message-ID: <6BE26733-2D09-4C77-91C6-8DEAE999175B@gmail.com>

On 14/05/2010, at 1:54 PM, Khaled Hosny wrote:

> Great, but the list archives need to be made puplic, also can't we
> import archives of this list into tug one?

I've made the list archives public, but as far as I know it's not possible to import the archives from Google Groups into mailman. (I don't see a super-important need, do you?)

I'll keep the Google Group active in case anyone wants to see the archives there, but I'll eventually remove the ability for people to post.

-- Will



From mpg at elzevir.fr  Tue May 11 14:10:48 2010
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 11 May 2010 14:10:48 +0200
Subject: [lltx] new tlmgr action
In-Reply-To: <20100511115244.GD7818@gamma.logic.tuwien.ac.at>
References: <4BE81787.6070208@elzevir.fr> <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <20100510143248.GF22488@gamma.logic.tuwien.ac.at> <4BE83194.1000808@elzevir.fr> <20100511115244.GD7818@gamma.logic.tuwien.ac.at>
Message-ID: <4BE94948.6020803@elzevir.fr>

Hi,

Le 11/05/2010 13:52, Norbert Preining a ?crit :
> On Mo, 10 Mai 2010, Manuel P?gouri?-Gonnard wrote:
>> We may want to create a new postaction for this script.
> 
> I tend to disagree. I try to prevent proliferation of postactions, we have
> already severals, and in this case the incantation is always the same,
> there is no data to carry over. 
> 
> If the script will reside somewhere in the texmf(-dist) hierarchy I suggest
> to simpy add
> 	postaction script file=texmf-dist/scripts/foo/bar/mkfontblabla.texlua
> to the respective packages.
> 
Of course you're right. I forgot we already had a "script" postaction (well, I
see that only XeTeX is using it for now).

> Note that we currently only support automatic detection of file with
> extension of
> 	.pl		perl
> 	.texlua		texlua
> but not .lua.
> 
I guess adding .lua -> texlua is easy.

The tricky part is, we want to call the -sys version of the script. Please
excuse me if I'm suggesting something stupid, but couldn't we extend postaction
script so that it can use executables under bin/ ? That way, we could benefit
from the symlinks/wrapper for the -sys variant, and wouldn't need to worry about
guessing the interpreter.

Another point: it is possible that a package with this postaction script
mkluatexfontdb is installed while luaotfload is not. In that case, tlmgr should
silently skip the postaction IMO. (The problem doesn't arise with XeTeX since
the script is included in the xetex package itself.)

Manuel.


From mpg at elzevir.fr  Sun May  9 11:20:56 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 09 May 2010 11:20:56 +0200
Subject: [lltx] [Fwd: Re: new tlmgr action]
In-Reply-To: <DA748236-B694-4F3F-B68F-92F5393BB4C7@gmail.com>
References: <4BE64D21.5050701@telecom-bretagne.eu> <DA9C502F-26E4-4B8C-B5DE-F88383DC53E1@gmail.com> <4BE65FE8.60608@telecom-bretagne.eu> <DA748236-B694-4F3F-B68F-92F5393BB4C7@gmail.com>
Message-ID: <4BE67E78.3010602@elzevir.fr>

Le 09/05/2010 09:49, Will Robertson a ?crit :
> On 09/05/2010, at 4:40 PM, Elie Roux wrote:
> 
>> Sure, fontspec can be uploaded later... I'd really like it to be in TeXLive
>> 2010 DVD though... do you think it will be OK?
> 
> Yes, I agree. When's the deadline?
> 
There's no hard deadline now, but we're probably freezing ctan -> tl updates in
a matter of weeks (for the record, it's the last thing we'll be freezing).

> Have you guys all been using fontspec recently? Are there any outstanding
> issues that you're aware of? (I know I asked this before, but I just like to
> double-check.)
> 
Unfortunately, I've only been using it with XeTeX. You're already aware of the
only problem I encountered.

Manuel.



From elie.roux at telecom-bretagne.eu  Mon May 10 16:36:00 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 17:36:00 +0300
Subject: [lltx] new tlmgr action
In-Reply-To: <20100510143248.GF22488@gamma.logic.tuwien.ac.at>
References: <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <4BE81787.6070208@elzevir.fr> <4BE64D21.5050701@telecom-bretagne.eu> <20100509130459.GB2193@khaled-laptop> <4BE6E68E.7030502@telecom-bretagne.eu> <4BE74380.1020600@elzevir.fr> <4BE55F14.1080300@telecom-bretagne.eu> <20100510021634.GL21730@gamma.logic.tuwien.ac.at> <20100510041407.GB2300@khaled-laptop> <20100510143248.GF22488@gamma.logic.tuwien.ac.at>
Message-ID: <4BE819D0.7090404@telecom-bretagne.eu>

Norbert Preining a ?crit :
>> Is it a problem to run the script more often than necessary? (For example,
>> whenever fonts of any type are installed.) If it's ok, I agree with Norbert that
>> we whould run it whenever we run updmap-sys.
>>     
>
> That is the idea, because in I guess (without checking) all cases where
> otf fonts are installed as texlive package also some map file is installed.
>   

Good point, I definitely agree on running it at the same time as updmap-sys.

Thank you,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Mon May 10 14:33:00 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 15:33:00 +0300
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <20100510121603.GA2250@khaled-laptop>
References: <4BE7E854.4090902@elzevir.fr> <20100510121603.GA2250@khaled-laptop>
Message-ID: <4BE7FCFC.8000309@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> BTW, I think now is better than later to pick a less confusing name for
> luaextra, any suggestions?
>   

I agree on this. What about lualibs? Just a thought: what about 
integrating alt-getopt.lua in lua[extra/libs]? This would make sense for 
me...

Thank you,
-- 
Elie


From mpg at elzevir.fr  Tue May 11 00:40:49 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 11 May 2010 00:40:49 +0200
Subject: [lltx] luatexbase, luatextra etc.
In-Reply-To: <4BE7E854.4090902@elzevir.fr>
References: <4BE7E854.4090902@elzevir.fr>
Message-ID: <4BE88B71.6040505@elzevir.fr>

Le 10/05/2010 13:04, Manuel P?gouri?-Gonnard a ?crit :
> Backward-incompatible changes are present in luatexbase's master. They are
> listed in at the beginning of the Changes file. We need to coordinate the
> migration to luatexbase's master: everyone should check the list of incompatible
> changes against his code and adapt it if necessary (or tell me if you think I
> was wrong to break compatibility on this point, so we can discuss it).
> 
> The decision to migrate to luatexbase's master now or later is not mine. Please
> have a look at the Changes file and tell me if you are ready to do it now and
> want to delay it. If you want to do the transition now, ?lie already did some
> adaptations in luatextra's master. Please be aware that more incompatible
> changes may be coming, but, as far as I'm concerned, I'll always keep you
> informed about them.
> 
Well, to the best of my knowledge, everything's master is now compatible with
luatexbase's master. So, I've deleted the 0.1x branch in order to avoid confusion.

I suggest we put up a CTAN upload on Wednesday with the master of every package
(except maybe fontspec): TL 09 will be frozen at this point. Then, as soon as
TL2010 pretest images are available we can make an announcement about it on the
luatex list and hopefully get some "real users" to test things so we can fix
possible bugs before TL10 freezes for the DVD release.

Wdyt?

Manuel.


From elie.roux at telecom-bretagne.eu  Mon May 10 20:48:22 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 10 May 2010 21:48:22 +0300
Subject: [lltx] directlua
In-Reply-To: <4BE85352.8090804@elzevir.fr>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop> <4BE848B2.9000004@elzevir.fr> <4BE84D73.9060702@telecom-bretagne.eu> <4BE85125.7080504@elzevir.fr> <4BE8525E.2030005@telecom-bretagne.eu> <4BE85352.8090804@elzevir.fr>
Message-ID: <4BE854F6.3050006@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Sure, but my point was not actually this class, but rather: how many 
> such class
> are around, that we're not aware of? Is it worth risking to break them in order
> to have a more natural name for our macros? (It's a real question, I'm not
> saying either yes or no right now.)
>   

For me yes... If we are compatible with CTAN, that's largely enough 
already...

Thank you,
-- 
Elie


From mpg at elzevir.fr  Mon May 10 19:56:02 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 10 May 2010 19:56:02 +0200
Subject: [lltx] directlua
In-Reply-To: <20100510175140.GA4170@khaled-laptop>
References: <4BE84508.9060708@telecom-bretagne.eu> <20100510175140.GA4170@khaled-laptop>
Message-ID: <4BE848B2.9000004@elzevir.fr>

Le 10/05/2010 19:51, Khaled Hosny a ?crit :
> On Mon, May 10, 2010 at 08:40:24PM +0300, Elie Roux wrote:
>> Hello,
>>
>> I'm changing the code in luamplib, and I'm loading only
>> luatexbase-modutils. The problem is that now I don't have the
>> mapping directlua -> luadirect. This mapping was done when there was
>> quite a madness about prefixing everything, but now things seem to
>> calm down... so should we keep directlua or should we use luadirect?
>> If we must use luadirect, then it would make sense to have a
>> luatexbase.sty that does it, for packages to load it and
>> automatically have things working... requiring all packages to load
>> luatexbase-compat seems a bit weird (especially the name).
> 
> I'd say let luadirect die and use directlua for new/updated code as,
> IIRC, this part of luatex is now stabilized. If compatibility with very
> old luatex versions is needed, one can then load luatexbase-compat.
> 
I agree with Khaled.

luatexbase-compat is only needed for compatibility with older versions of LuaTeX
(like, earlier than TL09 on this point).

Manuel.



From wspr81 at gmail.com  Fri May 14 07:12:03 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 14:42:03 +0930
Subject: [lltx] Old archives
Message-ID: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>

Hello,

Just in case people are looking for older archives of the lualatex-dev group, please visit

    http://groups.google.com/group/lualatex-dev/

At present, that address is also archiving messages to this current mailing list. (I think, anyway.) I'm not sure if that's a good idea or not, but being able to search through the group using Google's tools is a possible advantage.

-- Will




From mpg at elzevir.fr  Fri May 14 11:49:47 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 14 May 2010 11:49:47 +0200
Subject: [lltx] Old archives
In-Reply-To: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>
References: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>
Message-ID: <4BED1CBB.1040202@elzevir.fr>

Hi,

Le 14/05/2010 07:12, Will Robertson a ?crit :
> Hello,
> 
> Just in case people are looking for older archives of the lualatex-dev group, please visit
> 
>     http://groups.google.com/group/lualatex-dev/
> 
I'm glad to announce I found a way to import the archives from the old group in
pipermail (mailman's archiver). I took the maildir archive of the group on my
mail server, converted it to mailbox, then it was enough to replace the mbox
file containing the archive with this mbox file on the server and update the index.

The process is not perfect, as you can notice by looking at this month's
archive. Part of one of my message was considered a separate message for some
reason (most probably the paragraph starting with a line matching '^From.*:')
and put as the last message of the archive with [nosubject]. I assume this is a
bug of mailman's archiver, but I don't feel like investigating further.

> At present, that address is also archiving messages to this current mailing
> list. (I think, anyway.) I'm not sure if that's a good idea or not, but being
> able to search through the group using Google's tools is a possible
> advantage.
> 
I'm under the impression that only messages posted by you are archived (since,
as the administrator, you're now the only one allowed to post to the group). I'm
not sure if it is possible to archive the list on google without falling in the
same problem (spam or mandatory subscription) as before. IMO, archiving on
google groups could be cool if it is easy to set up, but isn't worth the effort
if it's causing problems.

Manuel.


From wspr81 at gmail.com  Fri May 14 12:02:05 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 19:32:05 +0930
Subject: [lltx] Old archives
In-Reply-To: <4BED1CBB.1040202@elzevir.fr>
References: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>
	<4BED1CBB.1040202@elzevir.fr>
Message-ID: <6DF867DC-54CD-45A7-B975-0291115CA1F0@gmail.com>

On 14/05/2010, at 7:19 PM, Manuel P?gouri?-Gonnard wrote:

> I'm glad to announce I found a way to import the archives from the old group in
> pipermail (mailman's archiver).

Nice, thanks!


> The process is not perfect, as you can notice by looking at this month's
> archive. Part of one of my message was considered a separate message for some
> reason (most probably the paragraph starting with a line matching '^From.*:')
> and put as the last message of the archive with [nosubject]. I assume this is a
> bug of mailman's archiver, but I don't feel like investigating further.

Certainly nothing to worry about.


> I'm under the impression that only messages posted by you are archived (since,
> as the administrator, you're now the only one allowed to post to the group).

On the contrary, your message is now there:

http://groups.google.com/group/lualatex-dev/msg/898274b13fb4f202

Don't ask me how this works, though :)


> I'm
> not sure if it is possible to archive the list on google without falling in the
> same problem (spam or mandatory subscription) as before. IMO, archiving on
> google groups could be cool if it is easy to set up, but isn't worth the effort
> if it's causing problems.

As far as I know (just a quick check, then), it's impossible for anyone but me to post to the list, but it's still tracking the messages sent to the tug mailing list.

I don't know if it's worth keeping -- besides the better searching -- but until there's harm done (which I can't see how, seeing as this group itself is public) I see no reason not to keep it there.

-- Will



From mpg at elzevir.fr  Fri May 14 12:03:39 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 14 May 2010 12:03:39 +0200
Subject: [lltx] Old archives
In-Reply-To: <4BED1CBB.1040202@elzevir.fr>
References: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>
	<4BED1CBB.1040202@elzevir.fr>
Message-ID: <4BED1FFB.8090503@elzevir.fr>

Le 14/05/2010 11:49, Manuel P?gouri?-Gonnard a ?crit :
> The process is not perfect, as you can notice by looking at this month's
> archive. Part of one of my message was considered a separate message for some
> reason (most probably the paragraph starting with a line matching '^From.*:')
> and put as the last message of the archive with [nosubject]. I assume this is a
> bug of mailman's archiver, but I don't feel like investigating further.
> 
I finally decided to turn around this problem by manually editing the message in
the archive so that the incriminated line now starts with "Now, from" rather
than "From". It fixes this annoying incorrect splitting problem, and I hope you
won't mind this slight rewrite of history (btw, it was one of my messages).

Manuel.

From mpg at elzevir.fr  Fri May 14 12:10:50 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 14 May 2010 12:10:50 +0200
Subject: [lltx] Old archives
In-Reply-To: <6DF867DC-54CD-45A7-B975-0291115CA1F0@gmail.com>
References: <F99D1125-4BF1-40B3-A2F2-F1105511FA17@gmail.com>
	<4BED1CBB.1040202@elzevir.fr>
	<6DF867DC-54CD-45A7-B975-0291115CA1F0@gmail.com>
Message-ID: <4BED21AA.9050309@elzevir.fr>

Le 14/05/2010 12:02, Will Robertson a ?crit :
>> I'm under the impression that only messages posted by you are archived (since,
>> as the administrator, you're now the only one allowed to post to the group).
> 
> On the contrary, your message is now there:
> 
> http://groups.google.com/group/lualatex-dev/msg/898274b13fb4f202
> 
> Don't ask me how this works, though :)
> 
Oh, great.

> As far as I know (just a quick check, then), it's impossible for anyone but 
> me to post to the list, but it's still tracking the messages sent to the tug 
> mailing list.
> 
Good.

> I don't know if it's worth keeping -- besides the better searching -- but 
> until there's harm done (which I can't see how, seeing as this group itself
> is public) I see no reason not to keep it there.

Agreed.

Manuel.

From wspr81 at gmail.com  Fri May 14 12:15:08 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 19:45:08 +0930
Subject: [lltx] getting up to speed
Message-ID: <54E77853-DE5C-478D-8EC7-8D67BCEA874B@gmail.com>

Hi,

Now it's time to find out how behind I am and how little I know about all this stuff.

Q1:  Do I need TeX Live 2010-vintage LuaTeX to get the lualatex-dev packages working?
     (If the answer to this is not "yes" then I'm in trouble.)
     If so, what's the easiest way to do that?

-- Will



From mpg at elzevir.fr  Fri May 14 12:23:20 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 14 May 2010 12:23:20 +0200
Subject: [lltx] getting up to speed
In-Reply-To: <54E77853-DE5C-478D-8EC7-8D67BCEA874B@gmail.com>
References: <54E77853-DE5C-478D-8EC7-8D67BCEA874B@gmail.com>
Message-ID: <4BED2498.90804@elzevir.fr>

Le 14/05/2010 12:15, Will Robertson a ?crit :
> Q1:  Do I need TeX Live 2010-vintage LuaTeX to get the lualatex-dev packages working?
>      (If the answer to this is not "yes" then I'm in trouble.)
>      If so, what's the easiest way to do that?
> 
Unless I'm mistaken, luaotfload does require a LuaTeX more recent than the one
in TL09. luatexbase is meant to be compatible with 0.25.4 (not sure if it really
makes sense, but now that it's done). Some features of luainputenc require a
recent LuaTeX too. Not sure about the others.

I think the easiest way to do that is to grab a luatex binary from luatex.org
and put it in your TL09's bin dir, assuming to installed a "vanilla" TL. If
you're using a TL from your distro's packages, the same should apply but there
is a risk that your package manager overwrites your binary later. OTOH, Debian
packages already include a fairly recent LuaTeX.

Of course, you may want to do a copy of your old luatex executable before, so
that you can switch between them if needed.

hth,
Manuel.

From wspr81 at gmail.com  Fri May 14 13:13:12 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 14 May 2010 20:43:12 +0930
Subject: [lltx] getting up to speed
In-Reply-To: <4BED2498.90804@elzevir.fr>
References: <54E77853-DE5C-478D-8EC7-8D67BCEA874B@gmail.com>
	<4BED2498.90804@elzevir.fr>
Message-ID: <9BA4CF02-23F2-451C-B432-74DC75A0DEE2@gmail.com>

On 14/05/2010, at 7:53 PM, Manuel P?gouri?-Gonnard wrote:

> Unless I'm mistaken, luaotfload does require a LuaTeX more recent than the one
> in TL09.

In that case let it be said that from now on I'll be using/testing against whatever bleeding edge version turns up on my machine from luatex.org.


> I think the easiest way to do that is to grab a luatex binary from luatex.org
> and put it in your TL09's bin dir, assuming to installed a "vanilla" TL.

And then (if there's anyone reading this who's as unfamiliar with this process as I am) execute

sudo fmtutil-sys --byengine luatex

to rebuild your formats with the new version of LuaTeX.

Thanks!
(More progress later tonight.)

-- Will



From khaledhosny at eglug.org  Fri May 14 14:20:02 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 14 May 2010 15:20:02 +0300
Subject: [lltx] getting up to speed
In-Reply-To: <4BED2498.90804@elzevir.fr>
References: <54E77853-DE5C-478D-8EC7-8D67BCEA874B@gmail.com>
	<4BED2498.90804@elzevir.fr>
Message-ID: <20100514122002.GA5923@khaled-laptop>

On Fri, May 14, 2010 at 12:23:20PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 14/05/2010 12:15, Will Robertson a ?crit :
> > Q1:  Do I need TeX Live 2010-vintage LuaTeX to get the lualatex-dev packages working?
> >      (If the answer to this is not "yes" then I'm in trouble.)
> >      If so, what's the easiest way to do that?
> > 
> Unless I'm mistaken, luaotfload does require a LuaTeX more recent than the one
> in TL09. luatexbase is meant to be compatible with 0.25.4 (not sure if it really
> makes sense, but now that it's done). Some features of luainputenc require a
> recent LuaTeX too. Not sure about the others.
> 
> I think the easiest way to do that is to grab a luatex binary from luatex.org
> and put it in your TL09's bin dir, assuming to installed a "vanilla" TL.

That is essentially what I do (but I build my binaries locally).

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sat May 15 07:15:51 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 15 May 2010 14:45:51 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
Message-ID: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>

Hi,

A few problems with mkluatexfontdb.

* * *

I think mkluatexfontdb is erroneously running fc-list on Mac OS X to locate external fonts.

Here's the snippet from otfl-font-nms:

    --[[
    This function scans the OS fonts through fontcache (fc-list), it executes
    only if OSFONTDIR is empty (which is the case under most Unix by default).
    If OSFONTDIR is non-empty, this means that the system fonts it contains have
    already been scanned, and thus we don't scan them again.
    --]]

For a start, I'm not even sure how I got fontconfig on my machine; it's not part of Mac OS X but I think it turned up along with ImageMagick or some other similar program.

* * *

The actual error that is being reported is:

luaotfload | executing 'fc-list : file' and parsing its result..../otfl-font-nms.lua:441: bad argument #1 to 'lower' (string expected, got nil)

which occurs if there's a font without an extension; I've fixed that up with a quick check for nil before the lowercase happens.

After fixing that up, I now run into

luaotfload | loading font: /usr/X11R6/lib/X11/fonts/OTF/SyrCOMUrhoyBold.otf
Bus error

which isn't as easy for me to diagnose.

Long story short: skip fc-list if at all possible.

* * *

So how do we do this? On Mac OS X I think the script should perform something like (bash shell)

export OSFONTDIR=~/Library/Fonts:/Library/Fonts:/System/Library/Fonts

but I don't know how to execute this locally within the Lua script. Doing this on the command line, I then get the following error:

luaotfload ? loading font: /Library/Fonts/NISC18030.ttf./otfl-font-nms.lua:255: bad argument #1 to 'close' (fontloader.splinefont expected, got nil)


Performing the following "fix" to work around that problem:

    local f = fontloader.open(filename, subfont)
    if not nil then -- is there a better way to do this??
      return t 
    end

I then get

luaotfload | loading font: /Library/Fonts/????.ttf
Bus error


which again I can't diagnose.

Any thoughts?

-- Will



From elie.roux at telecom-bretagne.eu  Sat May 15 09:38:30 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Sat, 15 May 2010 09:38:30 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
Message-ID: <AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>

2010/5/15 Will Robertson <wspr81 at gmail.com>:
>
> For a start, I'm not even sure how I got fontconfig on my machine; it's not part of Mac OS X but I think it turned up along with ImageMagick or some other similar program.

Or TeXLive?

> Long story short: skip fc-list if at all possible.

I don't really see the reason... why do you think we should do that?
fc-list is shipped with TeXLive, and even if not, causes no harm (the
Bus error has nothing to do with fc-list as far as I understand).

> export OSFONTDIR=~/Library/Fonts:/Library/Fonts:/System/Library/Fonts

In fact we use fc-list if OSFONTDIR is empty... but it would be easy
to add a check for OSX and to act as if was filled with the values you
just said. Anyway, are you sure it didn't work

> luaotfload ? loading font: /Library/Fonts/NISC18030.ttf./otfl-font-nms.lua:255: bad argument #1 to 'close' (fontloader.splinefont expected, got nil)
>
> I then get
>
> luaotfload | loading font: /Library/Fonts/????.ttf
> Bus error
>
>
> which again I can't diagnose.
>
> Any thoughts?

This looks like bugs in LuaTeX... sadly I think you are the only one
being in a position to report them, as I think you're the only one
working under OSX... Could you send me these fonts privately so that I
can test on my system to see if I get the errors too? In any case I
think the best would be to prepare two bugreports :(

Thank you,
-- 
Elie


From mpg at elzevir.fr  Sat May 15 10:21:10 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 15 May 2010 10:21:10 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
Message-ID: <4BEE5976.7080400@elzevir.fr>

Le 15/05/2010 09:38, ?lie Roux a ?crit :
> 2010/5/15 Will Robertson <wspr81 at gmail.com>:
>>
>> For a start, I'm not even sure how I got fontconfig on my machine; it's not part of Mac OS X but I think it turned up along with ImageMagick or some other similar program.
> 
> Or TeXLive?
> 
Nope. We ship it on windows, but certainly not on unices. (It may be part of
MacTeX however, but I don't think so.)

Manuel.

From wspr81 at gmail.com  Sat May 15 10:28:07 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 15 May 2010 17:58:07 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
Message-ID: <6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>

On 15/05/2010, at 5:08 PM, ?lie Roux wrote:

>> luaotfload | loading font: /Library/Fonts/????.ttf
>> Bus error
> 
> This looks like bugs in LuaTeX... 

How can I reduce the problem down to something I can submit to the LuaTeX team?

-- Will



From elie.roux at telecom-bretagne.eu  Sat May 15 10:38:14 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Sat, 15 May 2010 10:38:14 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>
Message-ID: <AANLkTikkvV64d9-W9gSu-vbMqwvi7BaWAuVpTeTst2jw@mail.gmail.com>

2010/5/15 Will Robertson <wspr81 at gmail.com>:
> On 15/05/2010, at 5:08 PM, ?lie Roux wrote:
>
>>> luaotfload | loading font: /Library/Fonts/????.ttf
>>> Bus error
>>
>> This looks like bugs in LuaTeX...
>
> How can I reduce the problem down to something I can submit to the LuaTeX team?

I think the best way is to do the very basic fontloader calls on the
fonts you told us about, like open, close, etc. Or could you send us
the fonts?

Thank you,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Sat May 15 10:40:28 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Sat, 15 May 2010 10:40:28 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BEE5976.7080400@elzevir.fr>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
Message-ID: <AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>

Le 15 mai 2010 10:21, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> a ?crit :
>>
>> Or TeXLive?
>>
> Nope. We ship it on windows, but certainly not on unices. (It may be part of
> MacTeX however, but I don't think so.)

Ok!

But it seems strange to me that we cannot count on fc-list... IIRC
XeTeX is using it too (not fc-list but the fontconfig library), so it
should be present everywhere XeTeX is running well (and thus
particularly on OSX)... am I wrong?

Thank you,
-- 
Elie


From mpg at elzevir.fr  Sat May 15 10:59:33 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 15 May 2010 10:59:33 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
Message-ID: <4BEE6275.1020006@elzevir.fr>

Le 15/05/2010 10:40, ?lie Roux a ?crit :
> Le 15 mai 2010 10:21, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> a ?crit :
>>>
>>> Or TeXLive?
>>>
>> Nope. We ship it on windows, but certainly not on unices. (It may be part of
>> MacTeX however, but I don't think so.)
> 
> Ok!
> 
> But it seems strange to me that we cannot count on fc-list... IIRC
> XeTeX is using it too (not fc-list but the fontconfig library), so it
> should be present everywhere XeTeX is running well (and thus
> particularly on OSX)... am I wrong?
> 
Well, libfontconfig is probably present but not necessarily the fc-list
command-line tool. Also, XeTeX may use specific OS X features on OS X (not sure
about that).

Manuel.

From elie.roux at telecom-bretagne.eu  Sat May 15 11:38:37 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Sat, 15 May 2010 11:38:37 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BEE6275.1020006@elzevir.fr>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
Message-ID: <AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>

Le 15 mai 2010 10:59, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> a ?crit :
>
> Well, libfontconfig is probably present but not necessarily the fc-list
> command-line tool. Also, XeTeX may use specific OS X features on OS X (not sure
> about that).

After some research, it seems that XeTeX uses something called "Apple
Type Services" on OSX... so this means we should have a special case
for OSX. I think the best way is to fake an OSFONTDIR... unless there
is a simple way to get the font directories another way? Will, do you
know something about that? I think you're the only one able to play
with OSX... Last time I checked, OSX refused to run in a virtual
machine, but it was two years ago... did the situation change?

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Sat May 15 12:07:56 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 13:07:56 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>
Message-ID: <20100515100756.GA3475@khaled-laptop>

On Sat, May 15, 2010 at 05:58:07PM +0930, Will Robertson wrote:
> On 15/05/2010, at 5:08 PM, ?lie Roux wrote:
> 
> >> luaotfload | loading font: /Library/Fonts/????.ttf
> >> Bus error
> > 
> > This looks like bugs in LuaTeX... 
> 
> How can I reduce the problem down to something I can submit to the LuaTeX team?

A simple script like:

f = fontloader.open(arg[1])
m = fontloader.to_table(f)
fontloader.close(f)


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sat May 15 12:11:29 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 13:11:29 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
Message-ID: <20100515101129.GA3796@khaled-laptop>

On Sat, May 15, 2010 at 11:38:37AM +0200, ?lie Roux wrote:
> Le 15 mai 2010 10:59, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> a ?crit :
> >
> > Well, libfontconfig is probably present but not necessarily the fc-list
> > command-line tool. Also, XeTeX may use specific OS X features on OS X (not sure
> > about that).
> 
> After some research, it seems that XeTeX uses something called "Apple
> Type Services" on OSX... so this means we should have a special case
> for OSX. I think the best way is to fake an OSFONTDIR... unless there
> is a simple way to get the font directories another way? Will, do you
> know something about that? I think you're the only one able to play
> with OSX... Last time I checked, OSX refused to run in a virtual
> machine, but it was two years ago... did the situation change?

Latest VirtualBox is said to support OSX, didn't test it though.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sat May 15 14:48:24 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 15:48:24 +0300
Subject: [lltx] kpse and texlua
Message-ID: <4BEE9818.6080608@telecom-bretagne.eu>

Hello,

I just realized that mkluatexfontdb wasn't working if lualibs.lua (or 
any other required file) wasn't in the same directory. Am I the only one 
having this problem? In order to fix this I load luatexbase.loader.lua 
(with dofile) and I fix lualibs so that it works with this system (I 
commited this small change).

Is it OK for everyone if add the line 
dofile(kpse.find_file("luatexbase.loader.lua")) to mkluatexfontdb? With 
this change it works fine on my system.

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Sat May 15 15:01:02 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 16:01:02 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEE9818.6080608@telecom-bretagne.eu>
References: <4BEE9818.6080608@telecom-bretagne.eu>
Message-ID: <20100515130101.GA4681@khaled-laptop>

On Sat, May 15, 2010 at 03:48:24PM +0300, Elie Roux wrote:
> Hello,
> 
> I just realized that mkluatexfontdb wasn't working if lualibs.lua
> (or any other required file) wasn't in the same directory. Am I the
> only one having this problem? In order to fix this I load
> luatexbase.loader.lua (with dofile) and I fix lualibs so that it
> works with this system (I commited this small change).

Works just fine here, I never but lualibs (or luaextra) modules in the
same directory. For some reason, your luatex is not using kpse to find
require()'d modules, which the 'kpse.set_program_name("luatex")' is
supposed to activate.

> Is it OK for everyone if add the line
> dofile(kpse.find_file("luatexbase.loader.lua")) to mkluatexfontdb?
> With this change it works fine on my system.

Or we may try to see what is broken with your system.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sat May 15 15:09:52 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 16:09:52 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515130101.GA4681@khaled-laptop>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
Message-ID: <4BEE9D20.9020209@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Or we may try to see what is broken with your system.
>   

I think my texmf.cnf is broken... anyway it's very strange that all this 
seems to work with luatex and not texlua... could anyone send me his 
texmf.cnf please?

Also Manuel, if one day we want to load luatexbase.loader.lua in texlua 
mode (which may happen), I think it would be good to detect it and to 
avoid the printing of the file name.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sat May 15 16:08:36 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 17:08:36 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515131519.GA5628@khaled-laptop>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
Message-ID: <4BEEAAE4.3010402@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Mine attached.

Thank you! Sadly this does not solve anything (unless I missed something 
in the merge). I'll wait for a build of texlive 2010 to test it further...

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sat May 15 17:48:37 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 18:48:37 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEEAAE4.3010402@telecom-bretagne.eu>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
Message-ID: <20100515154837.GA29743@khaled-laptop>

On Sat, May 15, 2010 at 05:08:36PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Mine attached.
> 
> Thank you! Sadly this does not solve anything (unless I missed
> something in the merge). I'll wait for a build of texlive 2010 to
> test it further...

But I'm using texlive2009.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sat May 15 17:56:31 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 18:56:31 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515154837.GA29743@khaled-laptop>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
Message-ID: <4BEEC42F.60404@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> But I'm using texlive2009.
>   

Yes, but I'm using the Debian one; the problem must come from here, but 
it's pretty hard to spot... since it's my own trunk binary, I really 
don't see where the problem is...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Sat May 15 21:38:09 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 15 May 2010 21:38:09 +0200
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEEC42F.60404@telecom-bretagne.eu>
References: <4BEE9818.6080608@telecom-bretagne.eu>	<20100515130101.GA4681@khaled-laptop>	<4BEE9D20.9020209@telecom-bretagne.eu>	<20100515131519.GA5628@khaled-laptop>	<4BEEAAE4.3010402@telecom-bretagne.eu>	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu>
Message-ID: <4BEEF821.7000002@elzevir.fr>

Le 15/05/2010 17:56, Elie Roux a ?crit :
> Khaled Hosny a ?crit :
>> But I'm using texlive2009.
>>   
> 
> Yes, but I'm using the Debian one; the problem must come from here, but
> it's pretty hard to spot... since it's my own trunk binary, I really
> don't see where the problem is...
> 
Thinking of it, I'm not sure if a "vanilla" luatex binary can work with a
Debian-ised TeX Live, since the relative path are not at all the same. Can you
test with the Debian-provided binary?

I'm very surprised that loading luatexbase.loader seems to solve the problem. In
theory, it's essentially useless with luatex 0.60.x (once kpse is initialised).

Btw, mkluatexfontdb works just fine for me (TL2010, luatex 0.60.1).

Manuel.

From elie.roux at telecom-bretagne.eu  Sat May 15 22:17:45 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 23:17:45 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEEF821.7000002@elzevir.fr>
References: <4BEE9818.6080608@telecom-bretagne.eu>	<20100515130101.GA4681@khaled-laptop>	<4BEE9D20.9020209@telecom-bretagne.eu>	<20100515131519.GA5628@khaled-laptop>	<4BEEAAE4.3010402@telecom-bretagne.eu>	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
Message-ID: <4BEF0169.8090107@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
 > Thinking of it, I'm not sure if a "vanilla" luatex binary can work with a
 > Debian-ised TeX Live, since the relative path are not at all the 
same. Can you
 > test with the Debian-provided binary?
 >
 > I'm very surprised that loading luatexbase.loader seems to solve the 
problem. In
 > theory, it's essentially useless with luatex 0.60.x (once kpse is 
initialised).

Here is the result with a debian luatex (exactly the same as with the 
latest trunk built on my own):

eroux at norgz-laptop:~/lualatex/luaotfload$ texlua mkluatexfontdb.lua
mkluatexfontdb.lua:13: module 'lualibs' not found:
    no field package.preload['lualibs']
    [kpse lua searcher] file not found: 'lualibs'
    [kpse C searcher] file not found: 'lualibs'

In both cases, adding luatexbase.loader fixes everything... Don't you 
think we should load it for the Debian distros?

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sat May 15 22:26:54 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 23:26:54 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEF0169.8090107@telecom-bretagne.eu>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
Message-ID: <20100515202654.GA12079@khaled-laptop>

On Sat, May 15, 2010 at 11:17:45PM +0300, Elie Roux wrote:
> Manuel P?gouri?-Gonnard a ?crit :
> > Thinking of it, I'm not sure if a "vanilla" luatex binary can work with a
> > Debian-ised TeX Live, since the relative path are not at all the
> same. Can you
> > test with the Debian-provided binary?
> >
> > I'm very surprised that loading luatexbase.loader seems to solve
> the problem. In
> > theory, it's essentially useless with luatex 0.60.x (once kpse is
> initialised).
> 
> Here is the result with a debian luatex (exactly the same as with
> the latest trunk built on my own):
> 
> eroux at norgz-laptop:~/lualatex/luaotfload$ texlua mkluatexfontdb.lua
> mkluatexfontdb.lua:13: module 'lualibs' not found:
>    no field package.preload['lualibs']
>    [kpse lua searcher] file not found: 'lualibs'
>    [kpse C searcher] file not found: 'lualibs'

Could you try with kpse debug turned on, e.g.:
$ texlua --kpathsea-debug=1 mkluatexfontdb.lua


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sat May 15 22:33:08 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 23:33:08 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515202654.GA12079@khaled-laptop>
References: <4BEE9818.6080608@telecom-bretagne.eu>
	<20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
	<20100515202654.GA12079@khaled-laptop>
Message-ID: <4BEF0504.2060300@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Could you try with kpse debug turned on, e.g.:
> $ texlua --kpathsea-debug=1 mkluatexfontdb.lua
>   

Here is the result:

eroux at norgz-laptop:~/lualatex/luaotfload$ texlua --kpathsea-debug=1 
mkluatexfontdb.lua
kdebug:kpse_normalize_path (//share/texmf-local/web2c) => 2
kdebug:kpse_normalize_path (//share/texmf-local/web2c) => 2
kdebug:kpse_normalize_path (//texmf-local/web2c) => 2
kdebug:kpse_normalize_path (//texmf-local/web2c) => 2
kdebug:kpse_normalize_path (//share/texmf/web2c) => 2
kdebug:kpse_normalize_path (//share/texmf/web2c) => 2
kdebug:kpse_normalize_path (//texmf/web2c) => 2
kdebug:kpse_normalize_path (//texmf/web2c) => 2
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (./lualibs.luc) => 0
kdebug:kpse_normalize_path (./lualibs.luctex) => 0
kdebug:kpse_normalize_path (./lualibs.texluc) => 0
kdebug:kpse_normalize_path (./lualibs.lua) => 0
kdebug:kpse_normalize_path (./lualibs.luatex) => 0
kdebug:kpse_normalize_path (./lualibs.texlua) => 0
kdebug:dir_links(/home/eroux/.texmf-var/scripts/luatexfontdb) => 2
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (./lualibs.luc) => 0
kdebug:kpse_normalize_path (./lualibs.luctex) => 0
kdebug:kpse_normalize_path (./lualibs.texluc) => 0
kdebug:kpse_normalize_path (./lualibs.lua) => 0
kdebug:kpse_normalize_path (./lualibs.luatex) => 0
kdebug:kpse_normalize_path (./lualibs.texlua) => 0
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (./lualibs.dll) => 0
kdebug:kpse_normalize_path (./lualibs.so) => 0
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (./lualibs.dll) => 0
kdebug:kpse_normalize_path (./lualibs.so) => 0
mkluatexfontdb.lua:13: module 'lualibs' not found:
    no field package.preload['lualibs']
    [kpse lua searcher] file not found: 'lualibs'
    [kpse C searcher] file not found: 'lualibs'


Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sat May 15 22:47:07 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 15 May 2010 23:47:07 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEF0504.2060300@telecom-bretagne.eu>
References: <20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
	<20100515202654.GA12079@khaled-laptop>
	<4BEF0504.2060300@telecom-bretagne.eu>
Message-ID: <20100515204707.GA12544@khaled-laptop>

On Sat, May 15, 2010 at 11:33:08PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Could you try with kpse debug turned on, e.g.:
> >$ texlua --kpathsea-debug=1 mkluatexfontdb.lua
> 
> Here is the result:

I don't know what to make with the output :) you can just try increasing
the long level until you find something useful.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sat May 15 22:58:20 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 15 May 2010 23:58:20 +0300
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515204707.GA12544@khaled-laptop>
References: <20100515130101.GA4681@khaled-laptop>
	<4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
	<20100515202654.GA12079@khaled-laptop>
	<4BEF0504.2060300@telecom-bretagne.eu>
	<20100515204707.GA12544@khaled-laptop>
Message-ID: <4BEF0AEC.40001@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I don't know what to make with the output :) you can just try increasing
> the long level until you find something useful.

That was the solution indeed, sorry for not having thought about that! I 
forgot some things in the texmf.cnf migration... sorry for the useless 
noise!

Thank you,
-- 
Elie

From arthur.reutenauer at normalesup.org  Sat May 15 23:12:07 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 15 May 2010 23:12:07 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
Message-ID: <20100515211207.GU4709@phare.normalesup.org>

> After some research, it seems that XeTeX uses something called "Apple
> Type Services" on OSX... so this means we should have a special case
> for OSX.

  Sure; that being said, wouldn't it be more coherent to check for
fc-list first, and only then resort to a manual OSFONTDIR?

	Arthur

From arthur.reutenauer at normalesup.org  Sat May 15 23:09:59 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 15 May 2010 23:09:59 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
Message-ID: <20100515210959.GT4709@phare.normalesup.org>

	Hello,

> luaotfload | loading font: /usr/X11R6/lib/X11/fonts/OTF/SyrCOMUrhoyBold.otf
> Bus error

  I can't reproduce the problem, and I have that font, as well as all
the other Meltho fonts.

> luaotfload ? loading font: /Library/Fonts/NISC18030.ttf./otfl-font-nms.lua:255: bad argument #1 to 'close' (fontloader.splinefont expected, got nil)

  I confirm the problem here: this is a simplified Chinese font that
contains only bitmaps; its internal structure seems very weird to me,
there is no 'glyf' table (I'm not sure if that's even conformant to the
standard!).  We can safely ignore it, your fix handles this case nicely.

> luaotfload | loading font: /Library/Fonts/????.ttf
> Bus error

  Can't reproduce either, and I have the font (its name reads "Huawen
kaiti", by the way, it's simplified Chinese font in Kai style).

	Arthur

From arthur.reutenauer at normalesup.org  Sat May 15 22:51:43 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 15 May 2010 22:51:43 +0200
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515204707.GA12544@khaled-laptop>
References: <4BEE9D20.9020209@telecom-bretagne.eu>
	<20100515131519.GA5628@khaled-laptop>
	<4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
	<20100515202654.GA12079@khaled-laptop>
	<4BEF0504.2060300@telecom-bretagne.eu>
	<20100515204707.GA12544@khaled-laptop>
Message-ID: <20100515205143.GS4709@phare.normalesup.org>

> I don't know what to make with the output :) you can just try increasing
> the long level until you find something useful.

  Not sure if it helps, but I just had the same kind of problems as ?lie
on my machine, and I can make the script work if I tweak with
TEXINPUTS (by manually naming the repositories where the Lua files
reside).  I expected setting LUAINPUTS would help here, but it doesn't.

	Arthur

From mpg at elzevir.fr  Sun May 16 00:46:04 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 00:46:04 +0200
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515205143.GS4709@phare.normalesup.org>
References: <4BEE9D20.9020209@telecom-bretagne.eu>	<20100515131519.GA5628@khaled-laptop>	<4BEEAAE4.3010402@telecom-bretagne.eu>	<20100515154837.GA29743@khaled-laptop>	<4BEEC42F.60404@telecom-bretagne.eu>
	<4BEEF821.7000002@elzevir.fr>	<4BEF0169.8090107@telecom-bretagne.eu>	<20100515202654.GA12079@khaled-laptop>	<4BEF0504.2060300@telecom-bretagne.eu>	<20100515204707.GA12544@khaled-laptop>
	<20100515205143.GS4709@phare.normalesup.org>
Message-ID: <4BEF242C.8010603@elzevir.fr>

Le 15/05/2010 22:51, Arthur Reutenauer a ?crit :
>> I don't know what to make with the output :) you can just try increasing
>> the long level until you find something useful.
> 
>   Not sure if it helps, but I just had the same kind of problems as ?lie
> on my machine, and I can make the script work if I tweak with
> TEXINPUTS (by manually naming the repositories where the Lua files
> reside).  I expected setting LUAINPUTS would help here, but it doesn't.
> 
LUAINPUTS has TEXINPUTS appended.

m

From mpg at elzevir.fr  Sun May 16 00:46:31 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 00:46:31 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100515211207.GU4709@phare.normalesup.org>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
Message-ID: <4BEF2447.1030900@elzevir.fr>

Le 15/05/2010 23:12, Arthur Reutenauer a ?crit :
>> After some research, it seems that XeTeX uses something called "Apple
>> Type Services" on OSX... so this means we should have a special case
>> for OSX.
> 
>   Sure; that being said, wouldn't it be more coherent to check for
> fc-list first, and only then resort to a manual OSFONTDIR?
> 
I think so.

Manuel.

From arthur.reutenauer at normalesup.org  Sun May 16 01:18:26 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 16 May 2010 01:18:26 +0200
Subject: [lltx] kpse and texlua
In-Reply-To: <4BEF242C.8010603@elzevir.fr>
References: <4BEEAAE4.3010402@telecom-bretagne.eu>
	<20100515154837.GA29743@khaled-laptop>
	<4BEEC42F.60404@telecom-bretagne.eu> <4BEEF821.7000002@elzevir.fr>
	<4BEF0169.8090107@telecom-bretagne.eu>
	<20100515202654.GA12079@khaled-laptop>
	<4BEF0504.2060300@telecom-bretagne.eu>
	<20100515204707.GA12544@khaled-laptop>
	<20100515205143.GS4709@phare.normalesup.org>
	<4BEF242C.8010603@elzevir.fr>
Message-ID: <20100515231826.GV4709@phare.normalesup.org>

> LUAINPUTS has TEXINPUTS appended.

  Yes, but as I said, setting LUAINPUTS changes nothing; apparently only
TEXINPUTS is used to look up those files (lualibs.lua,
lualibs-string.lua, etc.).

	Arthur

From elie.roux at telecom-bretagne.eu  Sun May 16 07:18:35 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 08:18:35 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100515211207.GU4709@phare.normalesup.org>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
Message-ID: <4BEF802B.8020007@telecom-bretagne.eu>

Arthur Reutenauer a ?crit :
> Sure; that being said, wouldn't it be more coherent to check for
> fc-list first, and only then resort to a manual OSFONTDIR?
>   

That would be an idea... anyway, does the master version of 
khaledhosny/luaotfload work well for you? does it find fonts in 
~/Library/fonts? I was not sure about the ~...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Sun May 16 09:47:01 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 09:47:01 +0200
Subject: [lltx] kpse and texlua
In-Reply-To: <20100515231826.GV4709@phare.normalesup.org>
References: <4BEEAAE4.3010402@telecom-bretagne.eu>	<20100515154837.GA29743@khaled-laptop>	<4BEEC42F.60404@telecom-bretagne.eu>
	<4BEEF821.7000002@elzevir.fr>	<4BEF0169.8090107@telecom-bretagne.eu>	<20100515202654.GA12079@khaled-laptop>	<4BEF0504.2060300@telecom-bretagne.eu>	<20100515204707.GA12544@khaled-laptop>	<20100515205143.GS4709@phare.normalesup.org>	<4BEF242C.8010603@elzevir.fr>
	<20100515231826.GV4709@phare.normalesup.org>
Message-ID: <4BEFA2F5.5000209@elzevir.fr>

Le 16/05/2010 01:18, Arthur Reutenauer a ?crit :
>> LUAINPUTS has TEXINPUTS appended.
> 
>   Yes, but as I said, setting LUAINPUTS changes nothing; apparently only
> TEXINPUTS is used to look up those files (lualibs.lua,
> lualibs-string.lua, etc.).
> 
You mean, with luatex's built-in kpse loader? That would be very surprising. Are
you sure the files were require()-ed and you loaded no package changing
package.loaders? What's your luatex version? Which distribution?

I'd like to have this sorted out, cause two occurrences of the same problem
don't look like a coincidence...

Manuel.

From wspr81 at gmail.com  Sun May 16 11:07:23 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 18:37:23 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BEF2447.1030900@elzevir.fr>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
Message-ID: <D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>

On 16/05/2010, at 8:16 AM, Manuel P?gouri?-Gonnard wrote:

> Le 15/05/2010 23:12, Arthur Reutenauer a ?crit :
>>> After some research, it seems that XeTeX uses something called "Apple
>>> Type Services" on OSX... so this means we should have a special case
>>> for OSX.
>> 
>>  Sure; that being said, wouldn't it be more coherent to check for
>> fc-list first, and only then resort to a manual OSFONTDIR?
>> 
> I think so.

Except fc-list, even if it exists on Mac OS X, won't necessarily contain a listing of the system-installed fonts. Wait. Maybe it will. (It seems to on my machine.)

I'm slightly more comfortable at this stage with just using the standard font directories; perhaps later we can think about using fc-list as well (or instead).


On 16/05/2010, at 2:48 PM, Elie Roux wrote:

> Arthur Reutenauer a ?crit :
>> Sure; that being said, wouldn't it be more coherent to check for
>> fc-list first, and only then resort to a manual OSFONTDIR?
>>  
> 
> That would be an idea... anyway, does the master version of khaledhosny/luaotfload work well for you? does it find fonts in ~/Library/fonts? I was not sure about the ~...


Yep, that's working well now.
Even though it's not as important now, I still think it would be a good idea to include the check for no extension:

        local ext = match(line,"^.+%.([^/\\]-)$") or ""
        ext = lower(ext)


Thanks,

-- Will



From wspr81 at gmail.com  Sun May 16 11:20:41 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 18:50:41 +0930
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
Message-ID: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>

Hello,

I'm thinking about the workflow that users will need to follow when installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found then the font cache is refreshed to see if there have been new fonts installed. This is far friendly than having to run mkluatexfontdb, even if it has a button in tlmgr. But am I right in thinking that this won't be possible for security reasons? (A la shell escape.)

-- Will



From mpg at elzevir.fr  Sun May 16 11:47:13 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 11:47:13 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
Message-ID: <4BEFBF21.5000808@elzevir.fr>

Le 16/05/2010 11:20, Will Robertson a ?crit :
> I'm thinking about the workflow that users will need to follow when
> installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found
> then the font cache is refreshed to see if there have been new fonts
> installed.

Interesting. As a XeTeX user, I wasn't even aware of that :-) So, you never need
to run fc-cache manually?

> This is far friendly than having to run mkluatexfontdb, even if it
> has a button in tlmgr. But am I right in thinking that this won't be possible
> for security reasons? (A la shell escape.)
> 
Basically, yes. But, as you may know, we're finally releasing the "restricted
shell-escape" feature in TL10. AFAIK, the list of authorised programs is not
fixed yet, but if it can include fc-list, then mkluatexfontsdb could be invoked
directly from LuaTeX (not using os.system(), but using it directly since it is
lua code).

Somehow unrelated: I just realised mkluatexfontsdb uses io.popen(). Last time I
checked, this function was not working on windows. Did anyone test luaotfload on
windows?

Manuel.

From wspr81 at gmail.com  Sun May 16 12:06:28 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 19:36:28 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
Message-ID: <DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>

On 16/05/2010, at 6:37 PM, Will Robertson wrote:

> 
> On 16/05/2010, at 2:48 PM, Elie Roux wrote:
>> 
>> That would be an idea... anyway, does the master version of khaledhosny/luaotfload work well for you? does it find fonts in ~/Library/fonts? I was not sure about the ~...
> 
> 
> Yep, that's working well now.


Scratch that; using "~" is no good. I've pushed a fix to that line that you can use as inspiration if you like :)

I'm still confused about all the different ways mkluatexfontdb scans through directories and when.

Without $OSFONTDIR, the script searches through the static font locations recursively. But if you set $OSFONTDIR to those locations, it then searches through them non-recursively. I guess the biggest confusion is why scan_texmf_tree uses osdirs to search through non-texmf locations. And in doing so, what is the purposes of OSFONTDIR?

-- Will



From wspr81 at gmail.com  Sun May 16 12:19:41 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 19:49:41 +0930
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BEFBF21.5000808@elzevir.fr>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<4BEFBF21.5000808@elzevir.fr>
Message-ID: <AD52C72A-3477-45E6-AA19-3EB3AA33D2A9@gmail.com>

On 16/05/2010, at 7:17 PM, Manuel P?gouri?-Gonnard wrote:

> Le 16/05/2010 11:20, Will Robertson a ?crit :
>> I'm thinking about the workflow that users will need to follow when
>> installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found
>> then the font cache is refreshed to see if there have been new fonts
>> installed.
> 
> Interesting. As a XeTeX user, I wasn't even aware of that :-) So, you never need
> to run fc-cache manually?

Ah, no. Sorry for the confusion.
This is only true on Mac OS X, when it uses system calls and manages its own font cache.
AFAIK, fc-cache is manually required under Linux/Windows.


>> This is far friendly than having to run mkluatexfontdb, even if it
>> has a button in tlmgr. But am I right in thinking that this won't be possible
>> for security reasons? (A la shell escape.)
>> 
> Basically, yes. But, as you may know, we're finally releasing the "restricted
> shell-escape" feature in TL10. AFAIK, the list of authorised programs is not
> fixed yet, but if it can include fc-list, then mkluatexfontsdb could be invoked
> directly from LuaTeX (not using os.system(), but using it directly since it is
> lua code).

That's what I had in mind. What do you think?
It slows down compilation very slightly when you mis-type a font name, but the convenience is worth it, in my opinion.


> Somehow unrelated: I just realised mkluatexfontsdb uses io.popen(). Last time I
> checked, this function was not working on windows. Did anyone test luaotfload on
> windows?

Sorry, don't have a Windows box :(

-- Will



From mpg at elzevir.fr  Sun May 16 12:34:42 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 12:34:42 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <AD52C72A-3477-45E6-AA19-3EB3AA33D2A9@gmail.com>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>	<4BEFBF21.5000808@elzevir.fr>
	<AD52C72A-3477-45E6-AA19-3EB3AA33D2A9@gmail.com>
Message-ID: <4BEFCA42.5080805@elzevir.fr>

Le 16/05/2010 12:19, Will Robertson a ?crit :
>> Interesting. As a XeTeX user, I wasn't even aware of that :-) So, you never need
>> to run fc-cache manually?
> 
> Ah, no. Sorry for the confusion.
> This is only true on Mac OS X, when it uses system calls and manages its own font cache.
> AFAIK, fc-cache is manually required under Linux/Windows.
> 
Ok, thanks for the info.

> That's what I had in mind. What do you think?
> It slows down compilation very slightly when you mis-type a font name, but the convenience is worth it, in my opinion.
> 
Sounds like a good idea to me. I seem to understand it was in Khaled's plans too.

>> Somehow unrelated: I just realised mkluatexfontsdb uses io.popen(). Last time I
>> checked, this function was not working on windows. Did anyone test luaotfload on
>> windows?
> 
> Sorry, don't have a Windows box :(
> 
I have a (virtual) one, specifically for testing. I'll try to run a few tests
(I'm going to have a busy week, so don't hold your breath).

Manuel.

From wspr81 at gmail.com  Sun May 16 12:40:47 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 20:10:47 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100515100756.GA3475@khaled-laptop>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<6A84CEA7-550C-4037-BA78-F6E03D6DE30D@gmail.com>
	<20100515100756.GA3475@khaled-laptop>
Message-ID: <63372B66-ECB2-4053-A68D-E5EE9D46EFC0@gmail.com>

On 15/05/2010, at 7:37 PM, Khaled Hosny wrote:

> On Sat, May 15, 2010 at 05:58:07PM +0930, Will Robertson wrote:
>> On 15/05/2010, at 5:08 PM, ?lie Roux wrote:
>> 
>>>> luaotfload | loading font: /Library/Fonts/????.ttf
>>>> Bus error
>>> 
>>> This looks like bugs in LuaTeX... 
>> 
>> How can I reduce the problem down to something I can submit to the LuaTeX team?
> 
> A simple script like:
> 
> f = fontloader.open(arg[1])
> m = fontloader.to_table(f)
> fontloader.close(f)

Thanks!

Turns out the problem was with a .ttc file and the bus error was being triggered in the first half of load_font before the log was written.

-- Will



From wspr81 at gmail.com  Sun May 16 14:23:24 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 16 May 2010 21:53:24 +0930
Subject: [lltx] Ignoring select fonts
Message-ID: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>

Hi,

Mac OS X contains a font called "LastResort.ttf" that takes a looooong time to be cached (it contains a glyph for every since unicode code point). So long I've never sat through the caching process.

To fix this up, I tried writing some naive code to allow fonts to be ignored; I didn't get far before running into issues, however. (At first I used a basic inline conditional but thought that looked like too much of a back.)

The idea was to filter out the contents of `list`:


    list = remove_ignore_fonts(list)
    for _,fnt in ipairs(list) do
        fnt = path_normalize(fnt)
        load_font(fnt, fontnames, status, newfontnames, newstatus, texmf)
    end


With something like this:


if os.name == "macosx" then

    ignorefonts = {
      "/System/Library/Fonts/LastResort.ttf"
    }
    
    function remove_ignore_fonts(fonts)
        local fontsubset = fonts
        
        for N,fnt in ipairs(fonts) do
        for _,ignore in ipairs(ignorefonts) do
            if fnt == ignore then
              logs.report("ignoring font '%s'", fnt)
              table.remove(fontsubset,N)
            end
        end
        end
        
        return fontsubset
    end
    
else
    function remove_ignore_fonts(fonts)
        return fonts
    end
end


I know this is a pretty inefficient approach but first things first, right.
When this is run, I get warnings such as this turning up non-systematically:

texlua(62003) malloc: *** error for object 0x327860: pointer being freed was not allocated
*** set a breakpoint in malloc_error_break to debug

Every now and then it causes a more serious problem:

texlua(61939) malloc: *** mmap(size=2097152) failed (error code=12)
*** error: can't allocate region
*** set a breakpoint in malloc_error_break to debug
luaotfload | loading font: /Users/will/Library/Fonts/CharisSILI.ttfnot enough memory

(Sometimes instead a segfault, sometimes a bus error.)

This is beyond my capability to debug in my present post-hangover state. (Tips on exactly what to do here greatly appreciated, however.) Now, I don't know if this is a problem with my code or somewhere else, but I just wanted to mention to be careful if you look at using anything from this in the main repo.

-- Will



From khaledhosny at eglug.org  Sun May 16 14:24:55 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 15:24:55 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>
	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>
	<4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
Message-ID: <20100516122455.GA2391@khaled-laptop>

On Sun, May 16, 2010 at 07:36:28PM +0930, Will Robertson wrote:
> On 16/05/2010, at 6:37 PM, Will Robertson wrote:
> 
> > 
> > On 16/05/2010, at 2:48 PM, Elie Roux wrote:
> >> 
> >> That would be an idea... anyway, does the master version of khaledhosny/luaotfload work well for you? does it find fonts in ~/Library/fonts? I was not sure about the ~...
> > 
> > 
> > Yep, that's working well now.
> 
> 
> Scratch that; using "~" is no good. I've pushed a fix to that line that you can use as inspiration if you like :)
> 
> I'm still confused about all the different ways mkluatexfontdb scans through directories and when.
> 
> Without $OSFONTDIR, the script searches through the static font locations recursively. But if you set $OSFONTDIR to those locations, it then searches through them non-recursively. I guess the biggest confusion is why scan_texmf_tree uses osdirs to search through non-texmf locations. And in doing so, what is the purposes of OSFONTDIR?

For TEXMF tree font directories, kpse returns the individual
subdirectories, AFAICT, so I felt there is no need to scan them
recursively, while OSFONTDIR is returned as is i.e. if I set
OSFONTDIR=~/.fonts, kpse will just return this so I had to scan it
recursively.

I admit the code is unnecessary complex and nit very well organized,
partly because it was written and rewritten partially across a period of
time and I didn't always know what I'm doing.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 14:31:52 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 15:31:52 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
Message-ID: <20100516123152.GB2391@khaled-laptop>

On Sun, May 16, 2010 at 06:50:41PM +0930, Will Robertson wrote:
> Hello,
> 
> I'm thinking about the workflow that users will need to follow when installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found then the font cache is refreshed to see if there have been new fonts installed. This is far friendly than having to run mkluatexfontdb, even if it has a button in tlmgr. But am I right in thinking that this won't be possible for security reasons? (A la shell escape.)

We don't need to run the script, almost all the code is part of
luaotfload itself, the script is just a command line interface to it. It
is doable, basically we can do the following:
* in names.load() if no names database found, generate one.
* in names.resolve() if font not found and no corresponding tfm file,
  then update the database and look again.

The code was written with this in mind, though I didn't manage to
actually implement it, may be now is good time to try.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 14:34:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 15:34:59 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <AD52C72A-3477-45E6-AA19-3EB3AA33D2A9@gmail.com>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<4BEFBF21.5000808@elzevir.fr>
	<AD52C72A-3477-45E6-AA19-3EB3AA33D2A9@gmail.com>
Message-ID: <20100516123459.GC2391@khaled-laptop>

On Sun, May 16, 2010 at 07:49:41PM +0930, Will Robertson wrote:
> On 16/05/2010, at 7:17 PM, Manuel P?gouri?-Gonnard wrote:
> 
> > Le 16/05/2010 11:20, Will Robertson a ?crit :
> >> I'm thinking about the workflow that users will need to follow when
> >> installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found
> >> then the font cache is refreshed to see if there have been new fonts
> >> installed.
> > 
> > Interesting. As a XeTeX user, I wasn't even aware of that :-) So, you never need
> > to run fc-cache manually?
> 
> Ah, no. Sorry for the confusion.
> This is only true on Mac OS X, when it uses system calls and manages its own font cache.
> AFAIK, fc-cache is manually required under Linux/Windows.

Under linux, it does force fontconfig cache update, but it is very slow
that I actually hate this feature (on modern Linux systems, font cache
is always kept up to date).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 14:39:07 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 15:39:07 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BEFBF21.5000808@elzevir.fr>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<4BEFBF21.5000808@elzevir.fr>
Message-ID: <20100516123907.GD2391@khaled-laptop>

On Sun, May 16, 2010 at 11:47:13AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 16/05/2010 11:20, Will Robertson a ?crit :
> > This is far friendly than having to run mkluatexfontdb, even if it
> > has a button in tlmgr. But am I right in thinking that this won't be possible
> > for security reasons? (A la shell escape.)
> > 
> Basically, yes. But, as you may know, we're finally releasing the "restricted
> shell-escape" feature in TL10. AFAIK, the list of authorised programs is not
> fixed yet, but if it can include fc-list, then mkluatexfontsdb could be invoked
> directly from LuaTeX (not using os.system(), but using it directly since it is
> lua code).
> 
> Somehow unrelated: I just realised mkluatexfontsdb uses io.popen(). Last time I
> checked, this function was not working on windows. Did anyone test luaotfload on
> windows?

Elie? Yet another reason to try to get rid of the fc-list hack in the
future, if we had a ready to use xml library for use with lualatex,
then we can just parse fontconfig files and not need the command line
tools at all.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From dcnieho at gmail.com  Sun May 16 16:28:46 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Sun, 16 May 2010 22:28:46 +0800
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BEFBF21.5000808@elzevir.fr>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<4BEFBF21.5000808@elzevir.fr>
Message-ID: <AANLkTimdrQP3fm-K12KEHl8ypMHiLC8AnsiePy1fPxlW@mail.gmail.com>

> Interesting. As a XeTeX user, I wasn't even aware of that :-) So, you never need
> to run fc-cache manually?
>
> Somehow unrelated: I just realised mkluatexfontsdb uses io.popen(). Last time I
> checked, this function was not working on windows. Did anyone test luaotfload on
> windows?
>
> Manuel.
>

about 1.5 months ago, mkluatexfontsdb worked on windows (most of the
time, barring some unexplained stops randomly in the middle).

FYI, XeteX in windows seems rather smart as well. When a font is not
found (e.g. I just dropped it in one of the font trees in the tex
tree) there is a halt in execution for a few seconds (presumably xetex
is searching for the font) and the document compiles fine.

Best,
Dee

From wspr81 at gmail.com  Sun May 16 16:45:00 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 17 May 2010 00:15:00 +0930
Subject: [lltx] Regarding fontspec
Message-ID: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>

Hi,

Although I didn't manage to look at everything I'd hoped over this weekend, I'm now relatively happy with the state of fontspec and LuaTeX. More documentation needs to be organised and I need to get better examples in there, but that can happen over the next few weeks.

luaotfload seems to be behaving itself on Mac OS X well enough in my fork; I recommend pulling in at least the intention behind what I've committed there (if not the exact code if you'd prefer to write it yourself).

I'm okay with uploading fontspec & xltxtra as soon as the lua* packages are updated; probably need to write a quick INSTALL readme for early testers.

Can you test that everything still works for you? :)

Cheers,
-- Will

P.S.  I'd also like to get unicode-math finally into CTAN. Once fontspec is ready I'll do what I can to get unicode-math released before TUG 2010. Busy month.




From elie.roux at telecom-bretagne.eu  Sun May 16 16:53:46 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 17:53:46 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100516122455.GA2391@khaled-laptop>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>	<20100515211207.GU4709@phare.normalesup.org>	<4BEF2447.1030900@elzevir.fr>	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
Message-ID: <4BF006FA.2060707@telecom-bretagne.eu>

Khaled Hosny a ?crit :
>> Scratch that; using "~" is no good. I've pushed a fix to that line that you can use as inspiration if you like :)
>>     

Thank you, I'll update the script with it.

>> Without $OSFONTDIR, the script searches through the static font locations recursively. But if you set $OSFONTDIR to those locations, it then searches through them non-recursively. I guess the biggest confusion is why scan_texmf_tree uses osdirs to search through non-texmf locations. And in doing so, what is the purposes of OSFONTDIR?
>>     

In fact there is some black kpse magick underneath OSFONTDIR (or more 
the way it's included in OPENTYPEFONTS) that makes it searched at the 
top level and also in subdirectories... it's not recursive but almost.

> For TEXMF tree font directories, kpse returns the individual
> subdirectories, AFAICT, so I felt there is no need to scan them
> recursively, while OSFONTDIR is returned as is i.e. if I set
> OSFONTDIR=~/.fonts, kpse will just return this so I had to scan it
> recursively.

I think this is wrong for OSFONTDIR, in my tests it was scanned also at 
sublevel, for example if I set OSFONTDIR to /usr/share/fonts it will 
find the fonts in it, even if they are under subdirectories (but not 
subsubdirectories). But maybe I did something wrong in my tests...

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sun May 16 16:59:21 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 17:59:21 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100516123907.GD2391@khaled-laptop>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>	<4BEFBF21.5000808@elzevir.fr>
	<20100516123907.GD2391@khaled-laptop>
Message-ID: <4BF00849.5020606@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Elie?

Last time I checked yes... but I changed my job, and I don't have 
windows anymore... Also it should be tested under a non-cygwin 
windows... I'll try to do it but my hard disk is full and it's hard to 
find some room for a windows VM...

>  Yet another reason to try to get rid of the fc-list hack in the
> future, if we had a ready to use xml library for use with lualatex,
> then we can just parse fontconfig files and not need the command line
> tools at all.
>   

I'm not sure redoing fc-list in lua is a fantastic idea... having 
fontconfig bindings in lua would be more interesting in my opinion... 
But anyway, this is extremely low priority...

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sun May 16 17:10:51 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 18:10:51 +0300
Subject: [lltx] Ignoring select fonts
In-Reply-To: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>
References: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>
Message-ID: <4BF00AFB.9000903@telecom-bretagne.eu>

Will Robertson a ?crit :
> I know this is a pretty inefficient approach but first things first, right.
> When this is run, I get warnings such as this turning up non-systematically:
>
> texlua(62003) malloc: *** error for object 0x327860: pointer being freed was not allocated
> *** set a breakpoint in malloc_error_break to debug
>
> Every now and then it causes a more serious problem:
>
> texlua(61939) malloc: *** mmap(size=2097152) failed (error code=12)
> *** error: can't allocate region
> *** set a breakpoint in malloc_error_break to debug
> luaotfload | loading font: /Users/will/Library/Fonts/CharisSILI.ttfnot enough memory
>
> (Sometimes instead a segfault, sometimes a bus error.)
>
> This is beyond my capability to debug in my present post-hangover state. (Tips on exactly what to do here greatly appreciated, however.)

For memory leaks and errors, the best way to debug is to use valgrind. 
There is a very experimental port to Mac OSX, but I think it would be a 
good first start. If you manage to make it run, run it with maximum 
verbosity (there are quite a lot of options) on the execution that 
causes errors, and send the restults to luatex-dev. Anyway, these errors 
seem quite serious :(

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 16 17:38:13 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 18:38:13 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BF006FA.2060707@telecom-bretagne.eu>
References: <4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
Message-ID: <20100516153813.GA4145@khaled-laptop>

On Sun, May 16, 2010 at 05:53:46PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >For TEXMF tree font directories, kpse returns the individual
> >subdirectories, AFAICT, so I felt there is no need to scan them
> >recursively, while OSFONTDIR is returned as is i.e. if I set
> >OSFONTDIR=~/.fonts, kpse will just return this so I had to scan it
> >recursively.
> 
> I think this is wrong for OSFONTDIR, in my tests it was scanned also
> at sublevel, for example if I set OSFONTDIR to /usr/share/fonts it
> will find the fonts in it, even if they are under subdirectories
> (but not subsubdirectories). But maybe I did something wrong in my
> tests...
$ export OSFONTDIR="/usr/share/fonts"
$ kpsewhich -expand-path='$OSFONTDIR'
/usr/share/fonts

No subdirs returned. Anyway, I just made the code scan all dirs
recursively, it doesn't harm to do so.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 17:41:57 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 18:41:57 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF00849.5020606@telecom-bretagne.eu>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<4BEFBF21.5000808@elzevir.fr> <20100516123907.GD2391@khaled-laptop>
	<4BF00849.5020606@telecom-bretagne.eu>
Message-ID: <20100516154156.GB4145@khaled-laptop>

On Sun, May 16, 2010 at 05:59:21PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Elie?
> 
> Last time I checked yes... but I changed my job, and I don't have
> windows anymore... Also it should be tested under a non-cygwin
> windows... I'll try to do it but my hard disk is full and it's hard
> to find some room for a windows VM...
> 
> > Yet another reason to try to get rid of the fc-list hack in the
> >future, if we had a ready to use xml library for use with lualatex,
> >then we can just parse fontconfig files and not need the command line
> >tools at all.
> 
> I'm not sure redoing fc-list in lua is a fantastic idea... having
> fontconfig bindings in lua would be more interesting in my
> opinion... But anyway, this is extremely low priority...

ConTeXt already does it (I suggested it to Hans while ago), it is not
that hard as we don't actually use any of fontconfig's magic (we don't
need it actually), all what we need is a list of font directories and
parsing fontfconfig files (plain xml files) for "dir" and "include"
keywords is not a big deal once we have an xml library.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sun May 16 17:48:41 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 18:48:41 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100516153813.GA4145@khaled-laptop>
References: <4BEE5976.7080400@elzevir.fr>
	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>
	<4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
Message-ID: <4BF013D9.1070806@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> $ export OSFONTDIR="/usr/share/fonts"
> $ kpsewhich -expand-path='$OSFONTDIR'
> /usr/share/fonts
>   

Agreed. But, as I said, the black magic is not in OSFONTDIR, it's in the 
way it's included in OPENTYPEFONTS, try kpsewhich 
--expand-patch='$OPENTYPEFONTS' and see the magic. Saying that, it just 
occured to me that the code I wrote about that is on the good way but is 
still buggy...

> No subdirs returned. Anyway, I just made the code scan all dirs
> recursively, it doesn't harm to do so.
>   

Yes it does, it scans fonts two times (or even more if the font is in a 
subsubdirectory).

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 16 17:48:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 18:48:59 +0300
Subject: [lltx] Ignoring select fonts
In-Reply-To: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>
References: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>
Message-ID: <20100516154859.GC4145@khaled-laptop>

On Sun, May 16, 2010 at 09:53:24PM +0930, Will Robertson wrote:
> Hi,
> 
> Mac OS X contains a font called "LastResort.ttf" that takes a looooong time to be cached (it contains a glyph for every since unicode code point). So long I've never sat through the caching process.
> 
> To fix this up, I tried writing some naive code to allow fonts to be ignored; I didn't get far before running into issues, however. (At first I used a basic inline conditional but thought that looked like too much of a back.)
> 
> The idea was to filter out the contents of `list`:
> 
> 
>     list = remove_ignore_fonts(list)
>     for _,fnt in ipairs(list) do
>         fnt = path_normalize(fnt)
>         load_font(fnt, fontnames, status, newfontnames, newstatus, texmf)
>     end
> 
> 
> With something like this:
> 
> 
> if os.name == "macosx" then
> 
>     ignorefonts = {
>       "/System/Library/Fonts/LastResort.ttf"
>     }

Depending on filenames and absolute paths is not a good idea as we deal
with fonts whose unique identifier is not filename. We can instead have
a special "black listing" configuration file that lists known
problematic fonts by font name, we can then make a check just after the
fontloader.info() call and if we found a matching name we skip it.
fontloader.info() is quite cheap.

A lua file with a simple table is the simplest, we can even allow having
multiple versions in the texmf tree and concatenate them, so users can
blacklist fonts they don't want (I wanted to do so for a while).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 18:29:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 19:29:11 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BF013D9.1070806@telecom-bretagne.eu>
References: <4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
Message-ID: <20100516162910.GA4321@khaled-laptop>

On Sun, May 16, 2010 at 06:48:41PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >$ export OSFONTDIR="/usr/share/fonts"
> >$ kpsewhich -expand-path='$OSFONTDIR'
> >/usr/share/fonts
> 
> Agreed. But, as I said, the black magic is not in OSFONTDIR, it's in
> the way it's included in OPENTYPEFONTS, try kpsewhich
> --expand-patch='$OPENTYPEFONTS' and see the magic. Saying that, it
> just occured to me that the code I wrote about that is on the good
> way but is still buggy...

Well, then I see to possible solutions:
* ignore the actual value of OSFONTDIR, if it is set then kpse can found
  those fonts, so treat them all as TEXMF fonts. This might even be more
  desired as in case user moving his system font dirs around and
  updating OSFONTDIR, to us it'll be still the same and no updates
  needed.
* see why kpse (texmf.cnf) is doing so, if there is no good reason then
  fix it.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 18:34:48 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 19:34:48 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100516123152.GB2391@khaled-laptop>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<20100516123152.GB2391@khaled-laptop>
Message-ID: <20100516163447.GA4454@khaled-laptop>

On Sun, May 16, 2010 at 03:31:52PM +0300, Khaled Hosny wrote:
> On Sun, May 16, 2010 at 06:50:41PM +0930, Will Robertson wrote:
> > Hello,
> > 
> > I'm thinking about the workflow that users will need to follow when installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found then the font cache is refreshed to see if there have been new fonts installed. This is far friendly than having to run mkluatexfontdb, even if it has a button in tlmgr. But am I right in thinking that this won't be possible for security reasons? (A la shell escape.)
> 
> We don't need to run the script, almost all the code is part of
> luaotfload itself, the script is just a command line interface to it. It
> is doable, basically we can do the following:
> * in names.load() if no names database found, generate one.

I just implemented this and it seems to work, except that fc-list won't
be run unless "--shell-escape" is enabled.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sun May 16 19:13:22 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 20:13:22 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100516162910.GA4321@khaled-laptop>
References: <4BEE6275.1020006@elzevir.fr>
	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>
	<20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
	<20100516162910.GA4321@khaled-laptop>
Message-ID: <4BF027B2.5070605@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Well, then I see to possible solutions:
> * ignore the actual value of OSFONTDIR, if it is set then kpse can found
>   those fonts, so treat them all as TEXMF fonts. This might even be more
>   desired as in case user moving his system font dirs around and
>   updating OSFONTDIR, to us it'll be still the same and no updates
>   needed.
>   

Hmm... this actually seems like the best solution, you're right! I 
cannot dev tonight, but it seems that revert the commit I made and 
document this would be good. I'll do it tomorrow in the evening if noone 
has time to do it.

> * see why kpse (texmf.cnf) is doing so, if there is no good reason then
>   fix it.
>   

I don't know kpse very well, but it seems to be the // in ;OSFONTDIR// 
that makes the magic appear, I think it's the normal behaviour.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sun May 16 19:15:59 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 16 May 2010 20:15:59 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100516163447.GA4454@khaled-laptop>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>	<20100516123152.GB2391@khaled-laptop>
	<20100516163447.GA4454@khaled-laptop>
Message-ID: <4BF0284F.4080002@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I just implemented this and it seems to work, except that fc-list won't
> be run unless "--shell-escape" is enabled.
>   

In fact last year I asked Karl to add fc-match in the list of the 
shell_escape commands in texmf.cnf, I was thinking we would use it. It 
would be good to have fc-list in the shell_escape list too. Karl, what 
do you think about it?

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 16 20:25:25 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 21:25:25 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BF027B2.5070605@telecom-bretagne.eu>
References: <20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
	<20100516162910.GA4321@khaled-laptop>
	<4BF027B2.5070605@telecom-bretagne.eu>
Message-ID: <20100516182525.GA5483@khaled-laptop>

On Sun, May 16, 2010 at 08:13:22PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Well, then I see to possible solutions:
> >* ignore the actual value of OSFONTDIR, if it is set then kpse can found
> >  those fonts, so treat them all as TEXMF fonts. This might even be more
> >  desired as in case user moving his system font dirs around and
> >  updating OSFONTDIR, to us it'll be still the same and no updates
> >  needed.
> 
> Hmm... this actually seems like the best solution, you're right! I
> cannot dev tonight, but it seems that revert the commit I made and
> document this would be good. I'll do it tomorrow in the evening if
> noone has time to do it.

OK, I just reverted it.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 16 20:57:50 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 May 2010 21:57:50 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100516123152.GB2391@khaled-laptop>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>
	<20100516123152.GB2391@khaled-laptop>
Message-ID: <20100516185750.GA5616@khaled-laptop>

On Sun, May 16, 2010 at 03:31:52PM +0300, Khaled Hosny wrote:
> On Sun, May 16, 2010 at 06:50:41PM +0930, Will Robertson wrote:
> > Hello,
> > 
> > I'm thinking about the workflow that users will need to follow when installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found then the font cache is refreshed to see if there have been new fonts installed. This is far friendly than having to run mkluatexfontdb, even if it has a button in tlmgr. But am I right in thinking that this won't be possible for security reasons? (A la shell escape.)
> 
> We don't need to run the script, almost all the code is part of
> luaotfload itself, the script is just a command line interface to it. It
> is doable, basically we can do the following:
> * in names.load() if no names database found, generate one.
> * in names.resolve() if font not found and no corresponding tfm file,
>   then update the database and look again.

Both are now implemented, wasn't that hard :) should have been done much
earlier. Lets hope there is no major bugs.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 16 21:35:01 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 16 May 2010 21:35:01 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100516163447.GA4454@khaled-laptop>
References: <98220E82-3E8C-4153-8A6F-212CCEB92BD7@gmail.com>	<20100516123152.GB2391@khaled-laptop>
	<20100516163447.GA4454@khaled-laptop>
Message-ID: <4BF048E5.9050402@elzevir.fr>

Le 16/05/2010 18:34, Khaled Hosny a ?crit :
> On Sun, May 16, 2010 at 03:31:52PM +0300, Khaled Hosny wrote:
>> On Sun, May 16, 2010 at 06:50:41PM +0930, Will Robertson wrote:
>>> Hello,
>>>
>>> I'm thinking about the workflow that users will need to follow when installing new system fonts for LuaLaTeX. In XeTeX, if a font is not found then the font cache is refreshed to see if there have been new fonts installed. This is far friendly than having to run mkluatexfontdb, even if it has a button in tlmgr. But am I right in thinking that this won't be possible for security reasons? (A la shell escape.)
>>
>> We don't need to run the script, almost all the code is part of
>> luaotfload itself, the script is just a command line interface to it. It
>> is doable, basically we can do the following:
>> * in names.load() if no names database found, generate one.
> 
> I just implemented this and it seems to work, except that fc-list won't
> be run unless "--shell-escape" is enabled.
> 
That's precisely what I meant with the restricted shell-escape.

m

From mpg at elzevir.fr  Sun May 16 21:43:24 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 16 May 2010 21:43:24 +0200
Subject: [lltx] Ignoring select fonts
In-Reply-To: <4BF00AFB.9000903@telecom-bretagne.eu>
References: <E175685C-0B8D-48DC-8A9B-9FFDFCE1B2C2@gmail.com>
	<4BF00AFB.9000903@telecom-bretagne.eu>
Message-ID: <4BF04ADC.9040601@elzevir.fr>

Le 16/05/2010 17:10, Elie Roux a ?crit :
>> This is beyond my capability to debug in my present post-hangover
>> state. (Tips on exactly what to do here greatly appreciated, however.)
> 
> For memory leaks and errors, the best way to debug is to use valgrind.
> There is a very experimental port to Mac OSX, but I think it would be a
> good first start. If you manage to make it run, run it with maximum
> verbosity (there are quite a lot of options) on the execution that
> causes errors, and send the restults to luatex-dev. Anyway, these errors
> seem quite serious :(
> 
Unless I'm seriously mistaken, memory allocation errors are not your (as Lua
programmer = texlua user) responsibility, but mean there is a problem in the
engine itself.

It would be good to have a small reproducer and send it to the LuaTeX team.

Manuel.

From mpg at elzevir.fr  Sun May 16 21:47:11 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 16 May 2010 21:47:11 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100516122455.GA2391@khaled-laptop>
References: <19D3011C-B025-4497-9639-4A59D80CD4A5@gmail.com>	<AANLkTilkc0bNjeO65mAXw-O0lveQaIO5gAOg9Uxf9jcn@mail.gmail.com>	<4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>	<20100515211207.GU4709@phare.normalesup.org>	<4BEF2447.1030900@elzevir.fr>	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
Message-ID: <4BF04BBF.6050701@elzevir.fr>

Le 16/05/2010 14:24, Khaled Hosny a ?crit :
> For TEXMF tree font directories, kpse returns the individual
> subdirectories, AFAICT, so I felt there is no need to scan them
> recursively, while OSFONTDIR is returned as is i.e. if I set
> OSFONTDIR=~/.fonts, kpse will just return this so I had to scan it
> recursively.
> 
You should append // to OSFONTDIR (or better make sure it ends with //) before
calling kpse.

Manuel.

From mpg at elzevir.fr  Sun May 16 21:49:30 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 16 May 2010 21:49:30 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <4BF013D9.1070806@telecom-bretagne.eu>
References: <4BEE5976.7080400@elzevir.fr>	<AANLkTin-cSb-Zv047S0ur_9sBzB1BNfWo7H4h5rfq2BP@mail.gmail.com>	<4BEE6275.1020006@elzevir.fr>	<AANLkTik8hL7hNeoagG-DJDZXgcdE3WINpsP9g1LQfeW4@mail.gmail.com>	<20100515211207.GU4709@phare.normalesup.org>	<4BEF2447.1030900@elzevir.fr>	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>	<20100516122455.GA2391@khaled-laptop>	<4BF006FA.2060707@telecom-bretagne.eu>	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
Message-ID: <4BF04C4A.30203@elzevir.fr>

Le 16/05/2010 17:48, Elie Roux a ?crit :
> Agreed. But, as I said, the black magic is not in OSFONTDIR, it's in the
> way it's included in OPENTYPEFONTS, try kpsewhich
> --expand-patch='$OPENTYPEFONTS' and see the magic. Saying that, it just
> occured to me that the code I wrote about that is on the good way but is
> still buggy...
> 
There's no black magic at all, see the meaning of // in the kpathsea manual,
section 3.3.6.

Manuel.

From wspr81 at gmail.com  Mon May 17 01:28:17 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 17 May 2010 08:58:17 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <20100516182525.GA5483@khaled-laptop>
References: <20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
	<20100516162910.GA4321@khaled-laptop>
	<4BF027B2.5070605@telecom-bretagne.eu>
	<20100516182525.GA5483@khaled-laptop>
Message-ID: <71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>

Hi,

So in my fork of luaotfload I've made the following changes (pre last night's commits by Khaled):

1.  Avoid error if a font turns up without an extension
2.  Use $HOME instead of ~/
3.  Avoid .ttc fonts on Mac OS X (see Taco's reply on the LuaTeX list about my bus error)
4.  Ignore some fonts (specifically LastResort.ttf)
5.  Document the behaviour of mkluatexfontdb slightly more

#1 is an error if fc-list is used under Mac OS X (but I think that has that just been made impossible?)
#2-#4 are necessary to get it working under Mac OS X

Would like me to rework these into the current HEAD or would you like to tackle them yourself? (Easier to start from scratch, I think, rather than merge my commits; more conflicts than I like to deal with.)

It wasn't clear to me, based on last night's changes, if you were aware of them but didn't have time to incorporate them or if they went unnoticed.

Will




From mpg at elzevir.fr  Mon May 17 01:39:28 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 17 May 2010 01:39:28 +0200
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>
References: <20100515211207.GU4709@phare.normalesup.org>	<4BEF2447.1030900@elzevir.fr>	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>	<20100516122455.GA2391@khaled-laptop>	<4BF006FA.2060707@telecom-bretagne.eu>	<20100516153813.GA4145@khaled-laptop>	<4BF013D9.1070806@telecom-bretagne.eu>	<20100516162910.GA4321@khaled-laptop>	<4BF027B2.5070605@telecom-bretagne.eu>	<20100516182525.GA5483@khaled-laptop>
	<71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>
Message-ID: <4BF08230.1010605@elzevir.fr>

Le 17/05/2010 01:28, Will Robertson a ?crit :
> 2.  Use $HOME instead of ~/

Is this part of the code specific to Unix? There's no $HOME on windows. (You
could use kpse.expand_path('~') in order to get something reasonable on all OSes.)

Manuel.

From wspr81 at gmail.com  Mon May 17 01:57:09 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 17 May 2010 09:27:09 +0930
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>
References: <20100515211207.GU4709@phare.normalesup.org>
	<4BEF2447.1030900@elzevir.fr>
	<D61806B2-8BF0-4D3A-AB7E-2CDEBF374AAE@gmail.com>
	<DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
	<20100516162910.GA4321@khaled-laptop>
	<4BF027B2.5070605@telecom-bretagne.eu>
	<20100516182525.GA5483@khaled-laptop>
	<71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>
Message-ID: <5383A9C6-AFED-4191-9524-F45F9A6CB1F7@gmail.com>

On 17/05/2010, at 8:58 AM, Will Robertson wrote:

> Would like me to rework these into the current HEAD or would you like to tackle them yourself? (Easier to start from scratch, I think, rather than merge my commits; more conflicts than I like to deal with.)

Actually I've just done this myself.

The changes last night have not broken anything :)
Things are working well.

My github fork of luaotfload is now based off the current HEAD and contains the fixes necessary for getting it working in Mac OS X. (You may want to change the ignore fonts method without using absolute paths, though.)

-- Will



From karl at freefriends.org  Mon May 17 00:23:59 2010
From: karl at freefriends.org (Karl Berry)
Date: Sun, 16 May 2010 22:23:59 GMT
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF0284F.4080002@telecom-bretagne.eu>
Message-ID: <201005162223.o4GMNxS6013902@f7.net>

    In fact last year I asked Karl to add fc-match in the list of the 
    shell_escape commands in texmf.cnf, I was thinking we would use it. It 
    would be good to have fc-list in the shell_escape list too. Karl, what 
    do you think about it?

As long as they cannot be exploited to get a shell or do nefarious
things on the local system.  Looking at the man pages, they seem safe,
but my brain is not good at thinking about ways to abuse programs.

Can you please carefully review all possible options?  Manuel knows how
much trouble we can get into :).

One thing that occurs to me is that we would have to do something to
avoid executing them from the current directory on Windows.  Perhaps on
Windows we should always execute the programs from our own bindir.  But
on Unix we could/should respect PATH.

The only other programs we are contemplating enabling for TL'10 is
repstopdf and kpsewhich, both of which are always in our bindir.  So
fc-* would be different in that respect.

karl

From khaledhosny at eglug.org  Mon May 17 15:45:39 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 May 2010 16:45:39 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005162223.o4GMNxS6013902@f7.net>
References: <4BF0284F.4080002@telecom-bretagne.eu>
	<201005162223.o4GMNxS6013902@f7.net>
Message-ID: <20100517134538.GA9408@khaled-laptop>

On Sun, May 16, 2010 at 10:23:59PM +0000, Karl Berry wrote:
>     In fact last year I asked Karl to add fc-match in the list of the 
>     shell_escape commands in texmf.cnf, I was thinking we would use it. It 
>     would be good to have fc-list in the shell_escape list too. Karl, what 
>     do you think about it?
> 
> As long as they cannot be exploited to get a shell or do nefarious
> things on the local system.  Looking at the man pages, they seem safe,
> but my brain is not good at thinking about ways to abuse programs.
> 
> Can you please carefully review all possible options?  Manuel knows how
> much trouble we can get into :).
> 
> One thing that occurs to me is that we would have to do something to
> avoid executing them from the current directory on Windows.  Perhaps on
> Windows we should always execute the programs from our own bindir.  But
> on Unix we could/should respect PATH.

I was thinking that using fc tools on both non-cygwin Windows and OSX
doesn't make sense, we should scan font directories directly.

I don't also like the idea of hardcoding such paths into the code, that
is precisely what $OSFONTDIR is for. So, I think texlive/mactex should
set $OSFONTDIR to some sensible value on Windows/OSX, something like:

osx:
/System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//

windows:
%WINDIR%\Fonts (%WINDIR% is an env variable, not sure how kpse handle
those on windows)

This leaves only unices, until we find a way to git rid of fc there.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From arthur.reutenauer at normalesup.org  Mon May 17 23:02:10 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 17 May 2010 23:02:10 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100517134538.GA9408@khaled-laptop>
References: <4BF0284F.4080002@telecom-bretagne.eu>
	<201005162223.o4GMNxS6013902@f7.net>
	<20100517134538.GA9408@khaled-laptop>
Message-ID: <20100517210210.GD14937@phare.normalesup.org>

> osx:
> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//

  You probably also want $HOME/Library/Fonts// there.

	Arthur

From mpg at elzevir.fr  Mon May 17 23:09:29 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 17 May 2010 23:09:29 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100517134538.GA9408@khaled-laptop>
References: <4BF0284F.4080002@telecom-bretagne.eu>	<201005162223.o4GMNxS6013902@f7.net>
	<20100517134538.GA9408@khaled-laptop>
Message-ID: <4BF1B089.1000905@elzevir.fr>

Le 17/05/2010 15:45, Khaled Hosny a ?crit :
> I don't also like the idea of hardcoding such paths into the code, that
> is precisely what $OSFONTDIR is for. So, I think texlive/mactex should
> set $OSFONTDIR to some sensible value on Windows/OSX, something like:
> 
> osx:
> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
> 
Btw, since T1FONTS (etc.) is defined as [blabla];$OSFONTDIR//, it seems to me
$OSFONTDIR should rather be defined as

{/System/Library/Fonts,/Network/Library/Fonts,/Library/Fonts}

(Similarly to, eg, TEXMF.)

I have no opinion on the actual value either on OS X or Windows. My point is
only about kpse syntax.

Manuel.

From karl at freefriends.org  Mon May 17 23:14:35 2010
From: karl at freefriends.org (Karl Berry)
Date: Mon, 17 May 2010 21:14:35 GMT
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100517210210.GD14937@phare.normalesup.org>
Message-ID: <201005172114.o4HLEZ1g010182@f7.net>

    > osx:
    > /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//

      You probably also want $HOME/Library/Fonts// there.

I am not enthused about embedding system directories in our texmf.cnf,
which will inevitably change without warning with os releases, cause
weird problems/slowdowns for some users because their setups aren't the
same as yours, etc.

OSFONTDIR is there because Hans wanted it, that's the only reason.  I
guess some part of context setup/invocation sets it.  I think any
determination of the value should be done by some os-specific tool (that
TL does not maintain), not just a random hardwired list.

Maybe whatever context does can be extracted into a more general tool.
I dunno.  All I know is, I don't want to go there for the generic TL
release.  Sorry.

From khaledhosny at eglug.org  Mon May 17 04:31:10 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 May 2010 05:31:10 +0300
Subject: [lltx] mkluatexfontdb & Mac OS X
In-Reply-To: <5383A9C6-AFED-4191-9524-F45F9A6CB1F7@gmail.com>
References: <DC383E73-9F4A-4920-B12A-AA5CF392310A@gmail.com>
	<20100516122455.GA2391@khaled-laptop>
	<4BF006FA.2060707@telecom-bretagne.eu>
	<20100516153813.GA4145@khaled-laptop>
	<4BF013D9.1070806@telecom-bretagne.eu>
	<20100516162910.GA4321@khaled-laptop>
	<4BF027B2.5070605@telecom-bretagne.eu>
	<20100516182525.GA5483@khaled-laptop>
	<71658C50-6F8B-409F-8D1E-B7712B08E292@gmail.com>
	<5383A9C6-AFED-4191-9524-F45F9A6CB1F7@gmail.com>
Message-ID: <20100517023110.GA6529@khaled-laptop>

On Mon, May 17, 2010 at 09:27:09AM +0930, Will Robertson wrote:
> On 17/05/2010, at 8:58 AM, Will Robertson wrote:
> 
> > Would like me to rework these into the current HEAD or would you like to tackle them yourself? (Easier to start from scratch, I think, rather than merge my commits; more conflicts than I like to deal with.)
> 
> Actually I've just done this myself.
> 
> The changes last night have not broken anything :)
> Things are working well.
> 
> My github fork of luaotfload is now based off the current HEAD and contains the fixes necessary for getting it working in Mac OS X. (You may want to change the ignore fonts method without using absolute paths, though.)

I started doing some work before going to sleep, now I need to check
your commits.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Mon May 17 19:39:18 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 17 May 2010 20:39:18 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005162223.o4GMNxS6013902@f7.net>
References: <201005162223.o4GMNxS6013902@f7.net>
Message-ID: <4BF17F46.1050201@telecom-bretagne.eu>

Karl Berry a ?crit :
> One thing that occurs to me is that we would have to do something to
> avoid executing them from the current directory on Windows.  Perhaps on
> Windows we should always execute the programs from our own bindir.  But
> on Unix we could/should respect PATH.
>
> The only other programs we are contemplating enabling for TL'10 is
> repstopdf and kpsewhich, both of which are always in our bindir.  So
> fc-* would be different in that respect.
>   

IIRC, there is a fc-list in the bindir of TeXLive under windows... and 
/usr/bin/fc-list is the standard on unix.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Mon May 17 19:40:44 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 17 May 2010 20:40:44 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100517134538.GA9408@khaled-laptop>
References: <4BF0284F.4080002@telecom-bretagne.eu>
	<201005162223.o4GMNxS6013902@f7.net>
	<20100517134538.GA9408@khaled-laptop>
Message-ID: <4BF17F9C.4010708@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I was thinking that using fc tools on both non-cygwin Windows and OSX
> doesn't make sense, we should scan font directories directly.
>
> I don't also like the idea of hardcoding such paths into the code, that
> is precisely what $OSFONTDIR is for. So, I think texlive/mactex should
> set $OSFONTDIR to some sensible value on Windows/OSX, something like:
>
> osx:
> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
>
> windows:
> %WINDIR%\Fonts (%WINDIR% is an env variable, not sure how kpse handle
> those on windows)
>   

Definitely agreed. Could these changes appear in the texmf.cnf?

> This leaves only unices, until we find a way to git rid of fc there.
>   

I don't really see the point of getting rid of fc on unix, it's quite 
standard (unlike on Windows and OSX), and it seems to work quite well.

Thank you,
-- 
Elie


From khaledhosny at eglug.org  Mon May 17 18:29:18 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 May 2010 19:29:18 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
Message-ID: <20100517162918.GA10856@khaled-laptop>

On Mon, May 17, 2010 at 12:15:00AM +0930, Will Robertson wrote:
> Hi,
> 
> Although I didn't manage to look at everything I'd hoped over this weekend, I'm now relatively happy with the state of fontspec and LuaTeX. More documentation needs to be organised and I need to get better examples in there, but that can happen over the next few weeks.
> 
> luaotfload seems to be behaving itself on Mac OS X well enough in my fork; I recommend pulling in at least the intention behind what I've committed there (if not the exact code if you'd prefer to write it yourself).

I'm not very exited about hardcoding system font directories into the
code, why OSFONTDIR is there then?, but I've no problem applying your
patch for now. For TTC and LastResort font, I'm still thinking on a more
general font blacklisting way, I'm thinking in a special lua file
containing a simple table with entries that are either font names or
filenames, and it can be exact matches or pattens, something like:

blacklist = {
    {"LastResort", "name"},
    {".ttc$", "file"},
}

What do you think?

> Can you test that everything still works for you? :)

The example file works for me, but I didn't check any further.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon May 17 17:27:12 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 17 May 2010 17:27:12 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005162223.o4GMNxS6013902@f7.net>
References: <201005162223.o4GMNxS6013902@f7.net>
Message-ID: <4BF16050.8000605@elzevir.fr>

Le 17/05/2010 00:23, Karl Berry a ?crit :
> The only other programs we are contemplating enabling for TL'10 is
> repstopdf and kpsewhich, both of which are always in our bindir.  So
> fc-* would be different in that respect.
> 
My humble opinion is, we should enable only repstopdf and kpsewhich for now, and
think about fc-* later. This restricted \write18 thing is already complicated
enough, let's do it step by step.

Manuel.

From karl at freefriends.org  Mon May 17 23:57:26 2010
From: karl at freefriends.org (Karl Berry)
Date: Mon, 17 May 2010 21:57:26 GMT
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF16050.8000605@elzevir.fr>
Message-ID: <201005172157.o4HLvQUv021524@f7.net>

    My humble opinion is, we should enable only repstopdf and kpsewhich for now

I like it :).

From wspr81 at gmail.com  Tue May 18 03:33:43 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 18 May 2010 11:03:43 +0930
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005172114.o4HLEZ1g010182@f7.net>
References: <201005172114.o4HLEZ1g010182@f7.net>
Message-ID: <F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>

On 18/05/2010, at 6:44 AM, Karl Berry wrote:

>> osx:
>> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
> 
>      You probably also want $HOME/Library/Fonts// there.
> 
> I am not enthused about embedding system directories in our texmf.cnf,
> which will inevitably change without warning with os releases, cause
> weird problems/slowdowns for some users because their setups aren't the
> same as yours, etc.
> 
> OSFONTDIR is there because Hans wanted it, that's the only reason.  I
> guess some part of context setup/invocation sets it.  I think any
> determination of the value should be done by some os-specific tool (that
> TL does not maintain), not just a random hardwired list.


These directories aren't random, they are where Mac OS X looks for and stores its fonts. 

This is the best emulation of XeTeX's "use system fonts" feature without querying system APIs, which I'm not sure is possible from within LuaTeX. It's not perfect, because (if you know what you're doing) fonts can be installed in Mac OS X from other places and fonts can also be disabled but not removed from those locations, but it's the best we can do at this stage I think.

-- Will



From wspr81 at gmail.com  Tue May 18 03:37:43 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 18 May 2010 11:07:43 +0930
Subject: [lltx] Regarding fontspec
In-Reply-To: <20100517162918.GA10856@khaled-laptop>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
Message-ID: <7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>

On 18/05/2010, at 1:59 AM, Khaled Hosny wrote:

> I'm not very exited about hardcoding system font directories into the
> code, why OSFONTDIR is there then?

I guess the argument in this particular case is that it's only this *very particular* font that we're trying to ignore. I don't mind ignoring each and every font with filename LastResort.ttf if that makes more sense to you.

But up until now I've been assuming that OSFONTDIR will not have been set. I'll need to do more testing if we're changing texmf.cnf to allocate OSFONTDIR to the system font locations.


> but I've no problem applying your
> patch for now. For TTC and LastResort font, I'm still thinking on a more
> general font blacklisting way, I'm thinking in a special lua file
> containing a simple table with entries that are either font names or
> filenames, and it can be exact matches or pattens, something like:
> 
> blacklist = {
>    {"LastResort", "name"},
>    {".ttc$", "file"},
> }
> 
> What do you think?

Looks good to me.
How do you want me to maintain my fork?
Continue rebasing your changes to HEAD?

-- Will



From elie.roux at telecom-bretagne.eu  Tue May 18 14:41:28 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 18 May 2010 15:41:28 +0300
Subject: [lltx] behaviour of luaotfload
Message-ID: <4BF28AF8.5020708@telecom-bretagne.eu>

Hello,

with the current master of luaotfload, I get an error

!LuaTeX error: cannot find OpenType font file for reading
 ==> Fatal error occurred, no output PDF file produced!

at the end of the compilation... does someone know where it comes from? 
It appears if a font is in the TEXMFHOME directory and is called with 
\font directly (with or without file: at the beginning). Do other people 
have this problem? Also, the current method doesn't work with font in 
the current directory, which is a quite strong regression. I'll try to 
fix it, but it's not that simple, as I didn't write anything in 
names.resolve(); Khaled, could you take a look?

Also, the behaviour seems strange in very simple cases: if I do 
\font\test=fxlri.otf, it will try to look for the name, and if won't 
find it, so it will regenerate the database and try again. Wouldn't it 
be better to look if we find a font file extention to the name, and then 
simply return instead of regenerating the database?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Tue May 18 16:21:10 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 18 May 2010 17:21:10 +0300
Subject: [lltx] behaviour of luaotfload
In-Reply-To: <4BF28AF8.5020708@telecom-bretagne.eu>
References: <4BF28AF8.5020708@telecom-bretagne.eu>
Message-ID: <4BF2A256.4060601@telecom-bretagne.eu>

Elie Roux a ?crit :
> !LuaTeX error: cannot find OpenType font file for reading
> ==> Fatal error occurred, no output PDF file produced!
>
> at the end of the compilation... does someone know where it comes 
> from? It appears if a font is in the TEXMFHOME directory and is called 
> with \font directly (with or without file: at the beginning). Do other 
> people have this problem? Also, the current method doesn't work with 
> font in the current directory, which is a quite strong regression. 
> I'll try to fix it, but it's not that simple, as I didn't write 
> anything in names.resolve(); Khaled, could you take a look?

After some testing, it's easy to reproduce it by putting a font only in 
TEXMFHOME... (copy fxlr.otf in TEXMFHOME/fonts/opentype/newfont.otf and 
try to load it). This looks like a bug in LuaTeX... this could be 
patched by putting the absolute name in the database for TEXMFHOME, do 
you think it would be a good idea? Can someone confirm the bug so that I 
can bugreport it?

> Also, the behaviour seems strange in very simple cases: if I do 
> \font\test=fxlri.otf, it will try to look for the name, and if won't 
> find it, so it will regenerate the database and try again. Wouldn't it 
> be better to look if we find a font file extention to the name, and 
> then simply return instead of regenerating the database?

I fixed the behaviour in the last push I made... please tell me if you 
see wrong things in it. Will, I'll try to merge your code soon.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Tue May 18 17:01:25 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 18:01:25 +0300
Subject: [lltx] behaviour of luaotfload
In-Reply-To: <4BF28AF8.5020708@telecom-bretagne.eu>
References: <4BF28AF8.5020708@telecom-bretagne.eu>
Message-ID: <20100518150125.GA2745@khaled-laptop>

On Tue, May 18, 2010 at 03:41:28PM +0300, Elie Roux wrote:
> Hello,
> 
> with the current master of luaotfload, I get an error
> 
> !LuaTeX error: cannot find OpenType font file for reading
> ==> Fatal error occurred, no output PDF file produced!

This means the pdf backend can't find the font we passed to it, this
used to happen with outdated names database, i.e. we are passing to it a
font that doesn't exist or can't be found by kpse. May be you generated
your database with OSFONTDIR set and then run luatex with it unset?
This shouldn't be an issue actually, as luaotfload will update the
database in such case. 

> at the end of the compilation... does someone know where it comes
> from? It appears if a font is in the TEXMFHOME directory and is
> called with \font directly (with or without file: at the beginning).
> Do other people have this problem? Also, the current method doesn't
> work with font in the current directory, which is a quite strong
> regression. I'll try to fix it, but it's not that simple, as I
> didn't write anything in names.resolve(); Khaled, could you take a
> look?

Well, the code is getting too hacky, I guess I need to set down rewrite
it with all these issues in mind not as an afterthought.

> Also, the behaviour seems strange in very simple cases: if I do
> \font\test=fxlri.otf, it will try to look for the name, and if won't
> find it, so it will regenerate the database and try again. Wouldn't
> it be better to look if we find a font file extention to the name,
> and then simply return instead of regenerating the database?

Instead of adding yet another hack, people should just use the already
documented syntax for loading fonts by filename:

\font\foo=file:foo.bar

One already knows he is using a luaotfload specific feature when he
trays load font files with extensions.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Tue May 18 17:18:32 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 18 May 2010 18:18:32 +0300
Subject: [lltx] behaviour of luaotfload
In-Reply-To: <20100518150125.GA2745@khaled-laptop>
References: <4BF28AF8.5020708@telecom-bretagne.eu>
	<20100518150125.GA2745@khaled-laptop>
Message-ID: <4BF2AFC8.1060204@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> This means the pdf backend can't find the font we passed to it,

That was my guess...

>  this
> used to happen with outdated names database, i.e. we are passing to it a
> font that doesn't exist or can't be found by kpse. May be you generated
> your database with OSFONTDIR set and then run luatex with it unset?
> This shouldn't be an issue actually, as luaotfload will update the
> database in such case. 

No, everything is up-to-date, and, as you said, database is regenerated 
in this case. This is what I really don't get, the specification really 
looks OK...

> Well, the code is getting too hacky, I guess I need to set down rewrite
> it with all these issues in mind not as an afterthought

I'm not sure this bug is in luaotfload... I'm still testing the bug, but 
it really looks strange...

> Instead of adding yet another hack, people should just use the already
> documented syntax for loading fonts by filename:
>
> \font\foo=file:foo.bar
>
> One already knows he is using a luaotfload specific feature when he
> trays load font files with extensions.
>   

I can't say I totally agree, but I accept this... Loading font by file 
seems the default for me, but that's certainly because I'm not totally 
converted to fontspec...

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Tue May 18 17:34:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 18:34:17 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005172114.o4HLEZ1g010182@f7.net>
References: <20100517210210.GD14937@phare.normalesup.org>
	<201005172114.o4HLEZ1g010182@f7.net>
Message-ID: <20100518153417.GA3106@khaled-laptop>

On Mon, May 17, 2010 at 09:14:35PM +0000, Karl Berry wrote:
>     > osx:
>     > /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
> 
>       You probably also want $HOME/Library/Fonts// there.
> 
> I am not enthused about embedding system directories in our texmf.cnf,
> which will inevitably change without warning with os releases, cause
> weird problems/slowdowns for some users because their setups aren't the
> same as yours, etc.

AFAIK, those are the only documented font directories by Apple and
Microsoft and are unlikely to change or be different between OS versions
etc. I also, naively, thought that since texmf.cnf is a configuration
file it is more appropriate place to store such configuration items
rather than hardcoding them into luaotfload, and in is easier to update
a configuration file than releasing a new version of a package, or so I
thought.

> OSFONTDIR is there because Hans wanted it, that's the only reason.  I
> guess some part of context setup/invocation sets it.  I think any
> determination of the value should be done by some os-specific tool (that
> TL does not maintain), not just a random hardwired list.

It is your decision, but the list is not random, both are extracted from
Apple and MS published documentation.

> Maybe whatever context does can be extracted into a more general tool.
> I dunno.  All I know is, I don't want to go there for the generic TL
> release.  Sorry.

AFAIK, context just checks if OSFONTDIR is set, which is essentially
what we do (context doesn't use kpse, so there is little to be shared
anyway).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue May 18 17:39:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 18:39:17 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
Message-ID: <20100518153916.GB3106@khaled-laptop>

On Tue, May 18, 2010 at 11:03:43AM +0930, Will Robertson wrote:
> On 18/05/2010, at 6:44 AM, Karl Berry wrote:
> 
> >> osx:
> >> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
> > 
> >      You probably also want $HOME/Library/Fonts// there.
> > 
> > I am not enthused about embedding system directories in our texmf.cnf,
> > which will inevitably change without warning with os releases, cause
> > weird problems/slowdowns for some users because their setups aren't the
> > same as yours, etc.
> > 
> > OSFONTDIR is there because Hans wanted it, that's the only reason.  I
> > guess some part of context setup/invocation sets it.  I think any
> > determination of the value should be done by some os-specific tool (that
> > TL does not maintain), not just a random hardwired list.
> 
> 
> These directories aren't random, they are where Mac OS X looks for and stores its fonts. 
> 
> This is the best emulation of XeTeX's "use system fonts" feature without querying system APIs, which I'm not sure is possible from within LuaTeX. It's not perfect, because (if you know what you're doing) fonts can be installed in Mac OS X from other places and fonts can also be disabled but not removed from those locations, but it's the best we can do at this stage I think.

An alternative is to write a binary lua module that interfaces with
system API's (it can be even abstract both Apple and FC API, and
whatever MS provides), but someone have to write it first :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From arthur.reutenauer at normalesup.org  Tue May 18 17:53:59 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 18 May 2010 17:53:59 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518153916.GB3106@khaled-laptop>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
	<20100518153916.GB3106@khaled-laptop>
Message-ID: <20100518155359.GB27419@phare.normalesup.org>

> An alternative is to write a binary lua module that interfaces with
> system API's (it can be even abstract both Apple and FC API, and
> whatever MS provides), but someone have to write it first :)

  The idea struck me, too, but as you put it, someone has to write it
first; and even then, it would make distribution far more complicated :-)

	Arthur

From simon at simifilm.ch  Tue May 18 18:05:33 2010
From: simon at simifilm.ch (Simon Spiegel)
Date: Tue, 18 May 2010 18:05:33 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontd
In-Reply-To: <mailman.32286.1274198130.3365.lualatex-dev@tug.org>
References: <mailman.32286.1274198130.3365.lualatex-dev@tug.org>
Message-ID: <60D0ECF0-92D6-4001-804A-47D1C9FDFEA4@simifilm.ch>


On 18.05.2010, at 17:55, lualatex-dev-request at tug.org wrote:
> On Mon, May 17, 2010 at 09:14:35PM +0000, Karl Berry wrote:
>>> osx:
>>> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
>> 
>>      You probably also want $HOME/Library/Fonts// there.
>> 
>> I am not enthused about embedding system directories in our texmf.cnf,
>> which will inevitably change without warning with os releases, cause
>> weird problems/slowdowns for some users because their setups aren't the
>> same as yours, etc.
> 
> AFAIK, those are the only documented font directories by Apple and
> Microsoft and are unlikely to change or be different between OS versions
> etc. I also, naively, thought that since texmf.cnf is a configuration
> file it is more appropriate place to store such configuration items
> rather than hardcoding them into luaotfload, and in is easier to update
> a configuration file than releasing a new version of a package, or so I
> thought.

I see one not so small potential problem here: There are various font managers for OSX which store their fonts in non standard locations (for example, I use FontExplorer X Pro). Still, these programs make their fonts available to all apps which use the standard system APIs. I'd claim that such managers might not be so rare among (La)TeX users since they often care about their fonts. But these managed fonts wouldn't be available to LuaLaTeX ?

simon

--
Simon Spiegel
Steinhaldenstr. 50
8002 Z?rich

Telephon: ++41 44 451 5334
Mobophon: ++41 76 459 60 39


http://www.simifilm.ch

?Goethen getroffen. Beeindruckt.? Unbekannt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100518/638b48ca/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3916 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100518/638b48ca/attachment.bin>

From khaledhosny at eglug.org  Tue May 18 18:18:51 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 19:18:51 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
Message-ID: <20100518161851.GA3534@khaled-laptop>

On Tue, May 18, 2010 at 11:07:43AM +0930, Will Robertson wrote:
> On 18/05/2010, at 1:59 AM, Khaled Hosny wrote:
> 
> > I'm not very exited about hardcoding system font directories into the
> > code, why OSFONTDIR is there then?
> 
> I guess the argument in this particular case is that it's only this *very particular* font that we're trying to ignore. I don't mind ignoring each and every font with filename LastResort.ttf if that makes more sense to you.
> 
> But up until now I've been assuming that OSFONTDIR will not have been set. I'll need to do more testing if we're changing texmf.cnf to allocate OSFONTDIR to the system font locations.
> 
> 
> > but I've no problem applying your
> > patch for now. For TTC and LastResort font, I'm still thinking on a more
> > general font blacklisting way, I'm thinking in a special lua file
> > containing a simple table with entries that are either font names or
> > filenames, and it can be exact matches or pattens, something like:
> > 
> > blacklist = {
> >    {"LastResort", "name"},
> >    {".ttc$", "file"},
> > }
> > 
> > What do you think?
> 
> Looks good to me.
> How do you want me to maintain my fork?
> Continue rebasing your changes to HEAD?

Donno, but I'm unlikely to have time for luaotfload in the near future,
so it is up to Elie to decide.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Tue May 18 18:31:46 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 18 May 2010 19:31:46 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <20100518161851.GA3534@khaled-laptop>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>	<20100517162918.GA10856@khaled-laptop>	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
Message-ID: <4BF2C0F2.4080800@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Donno, but I'm unlikely to have time for luaotfload in the near future,
> so it is up to Elie to decide.
>   

Is it ok if I merge the commits manually and change the owner to you 
(Will)? The other solution would be to do it yourself... Khaled, could 
you give him the rights on your repo?

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Tue May 18 18:51:42 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 19:51:42 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <4BF2C0F2.4080800@telecom-bretagne.eu>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
Message-ID: <20100518165141.GA3700@khaled-laptop>

On Tue, May 18, 2010 at 07:31:46PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Donno, but I'm unlikely to have time for luaotfload in the near future,
> >so it is up to Elie to decide.
> 
> Is it ok if I merge the commits manually and change the owner to you
> (Will)? The other solution would be to do it yourself... Khaled,
> could you give him the rights on your repo?

Done :)

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue May 18 20:15:26 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 18 May 2010 21:15:26 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontd
In-Reply-To: <60D0ECF0-92D6-4001-804A-47D1C9FDFEA4@simifilm.ch>
References: <mailman.32286.1274198130.3365.lualatex-dev@tug.org> 
	<60D0ECF0-92D6-4001-804A-47D1C9FDFEA4@simifilm.ch>
Message-ID: <AANLkTin2Y5HFAeRqrGOAmWMwy7UfXefazVMonVQBu4-B@mail.gmail.com>

On Tue, May 18, 2010 at 7:05 PM, Simon Spiegel <simon at simifilm.ch> wrote:

>
> On 18.05.2010, at 17:55, lualatex-dev-request at tug.org wrote:
>
> On Mon, May 17, 2010 at 09:14:35PM +0000, Karl Berry wrote:
>
> osx:
>
> /System/Library/Fonts//;/Network/Library/Fonts//;/Library/Fonts//
>
>
>      You probably also want $HOME/Library/Fonts// there.
>
>
> I am not enthused about embedding system directories in our texmf.cnf,
>
> which will inevitably change without warning with os releases, cause
>
> weird problems/slowdowns for some users because their setups aren't the
>
> same as yours, etc.
>
>
> AFAIK, those are the only documented font directories by Apple and
> Microsoft and are unlikely to change or be different between OS versions
> etc. I also, naively, thought that since texmf.cnf is a configuration
> file it is more appropriate place to store such configuration items
> rather than hardcoding them into luaotfload, and in is easier to update
> a configuration file than releasing a new version of a package, or so I
> thought.
>
>
> I see one not so small potential problem here: There are various font
> managers for OSX which store their fonts in non standard locations (for
> example, I use FontExplorer X Pro). Still, these programs make their fonts
> available to all apps which use the standard system APIs. I'd claim that
> such managers might not be so rare among (La)TeX users since they often care
> about their fonts. But these managed fonts wouldn't be available to LuaLaTeX
> ?
>
> simon
>
>
Right now, we cannot support such setups, users of these tools need to set
OSFONTDIR manually then, but we can at least try tosupport the more standard
locations.

Regards,
 Khaled


-- 
Khaled Hosny
Arabic localiser and member of Arabeyes.org team
Free font developer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100518/c02af644/attachment-0001.html>

From elie.roux at telecom-bretagne.eu  Tue May 18 22:34:40 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 18 May 2010 23:34:40 +0300
Subject: [lltx] bug in the caches
Message-ID: <4BF2F9E0.7020507@telecom-bretagne.eu>

Hello,

I just spent some time debugging the error I had in luaotfload. It came 
from something I wasn't expecting: In the cache of the font, the 
filename is wrong because I moved the font. The problem is that 
specification.filename is not taken into account at all if there is a 
filename in the cache, even if this filename leads to no file.

Hans, do you think you could change the files to fix this problem? (If 
I'm not wrong and if the problem has not already been fixed since the 
last time we sync, which is very recent).

If not (this is more for the lualatex team), I thought about two solutions:
  - we could free the font cache when we call mkluatexfontdb, this would 
reset everything and it would be doable by the user in case of bug (that 
could appear later)
  - I can patch the ConTeXt files to check the filename, but it will be 
a bit more difficult to maintain...
  - we can do both!

Also I just discovered something: if fc-list cannot be executed (which 
is likely to be the case for TeXLive 2010) and the font database is 
regenerated during a tex compilation, the font database will loose all 
the OS fonts... I think the best way to fix this is not to save the 
database if fc-list cannot be executed, and print a warning message 
telling the user that a font has not been found and if it should have, 
to launch mkluatexfontdb.

I just spotted another problem (that we can postpone): the .pk files are 
always regenerated, even when they can be found... I'll try to fix the 
problem soon.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Tue May 18 23:04:19 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 00:04:19 +0300
Subject: [lltx] bug in the caches
In-Reply-To: <4BF2F9E0.7020507@telecom-bretagne.eu>
References: <4BF2F9E0.7020507@telecom-bretagne.eu>
Message-ID: <20100518210419.GA4732@khaled-laptop>

On Tue, May 18, 2010 at 11:34:40PM +0300, Elie Roux wrote:
> Also I just discovered something: if fc-list cannot be executed
> (which is likely to be the case for TeXLive 2010) and the font
> database is regenerated during a tex compilation, the font database
> will loose all the OS fonts... I think the best way to fix this is
> not to save the database if fc-list cannot be executed, and print a
> warning message telling the user that a font has not been found and
> if it should have, to launch mkluatexfontdb.

But, by then, we would have been rendered the feature useless (and even
annoying) to the majority of texlive users, I'd rather drop fc-list
completely and relay solely on OSFONTDIR if it won't work with texlive
out of box.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue May 18 23:08:05 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 00:08:05 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518155359.GB27419@phare.normalesup.org>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
	<20100518153916.GB3106@khaled-laptop>
	<20100518155359.GB27419@phare.normalesup.org>
Message-ID: <20100518210805.GB4732@khaled-laptop>

On Tue, May 18, 2010 at 05:53:59PM +0200, Arthur Reutenauer wrote:
> > An alternative is to write a binary lua module that interfaces with
> > system API's (it can be even abstract both Apple and FC API, and
> > whatever MS provides), but someone have to write it first :)
> 
>   The idea struck me, too, but as you put it, someone has to write it
> first; and even then, it would make distribution far more complicated :-)

Another option is to find Apple font configuration files (which are
likely to be some sort of XML) and try to parse it directly, and the
same for FC, but we still need an XML library (but this can be easier
since context has one ;).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Tue May 18 23:14:57 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 00:14:57 +0300
Subject: [lltx] bug in the caches
In-Reply-To: <20100518210419.GA4732@khaled-laptop>
References: <4BF2F9E0.7020507@telecom-bretagne.eu>
	<20100518210419.GA4732@khaled-laptop>
Message-ID: <4BF30351.2090306@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> But, by then, we would have been rendered the feature useless (and even
> annoying) to the majority of texlive users, I'd rather drop fc-list
> completely and relay solely on OSFONTDIR if it won't work with texlive
> out of box.

Whatever the decision taken, I think the support of luaotfload in 
TeXLive 2010 will be far from perfect (no OSFONTDIR, no fc-list executed 
directly), for political reasons about which we cannot do anything. The 
question is to know what the smallest annoyance will be: not finding all 
fonts (fonts found by fc-cache but not in OSFONTDIR) and forcing the 
user to fill OSFONTDIR or not updating the database during compilation 
time... I'm personaly in favor of the second solution, I don't think 
users will be very happy about changing their texmf.cnf and having to 
manually discover their fonts when fc is supposed to do that for them... 
I think I know Khaled's opinion... what do other people think about that?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Tue May 18 23:19:25 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 00:19:25 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518210805.GB4732@khaled-laptop>
References: <201005172114.o4HLEZ1g010182@f7.net>	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>	<20100518153916.GB3106@khaled-laptop>	<20100518155359.GB27419@phare.normalesup.org>
	<20100518210805.GB4732@khaled-laptop>
Message-ID: <4BF3045D.501@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Another option is to find Apple font configuration files (which are
> likely to be some sort of XML) and try to parse it directly, and the
> same for FC, but we still need an XML library (but this can be easier
> since context has one ;).
>   

Am I the only one finding this extremely ugly? Anyway, while we are in 
ugliness, I don't really see why we need some sort of xml library to 
parse the configuration files, some regexp will do the trick very easily 
(for the fonts.conf of fc at least).

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Wed May 19 00:20:32 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 01:20:32 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518155359.GB27419@phare.normalesup.org>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
	<20100518153916.GB3106@khaled-laptop>
	<20100518155359.GB27419@phare.normalesup.org>
Message-ID: <20100518210805.GB4732@khaled-laptop>

On Tue, May 18, 2010 at 05:53:59PM +0200, Arthur Reutenauer wrote:
> > An alternative is to write a binary lua module that interfaces with
> > system API's (it can be even abstract both Apple and FC API, and
> > whatever MS provides), but someone have to write it first :)
> 
>   The idea struck me, too, but as you put it, someone has to write it
> first; and even then, it would make distribution far more complicated :-)

Another option is to find Apple font configuration files (which are
likely to be some sort of XML) and try to parse it directly, and the
same for FC, but we still need an XML library (but this can be easier
since context has one ;).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Wed May 19 00:33:15 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 01:33:15 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF3045D.501@telecom-bretagne.eu>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
	<20100518153916.GB3106@khaled-laptop>
	<20100518155359.GB27419@phare.normalesup.org>
	<20100518210805.GB4732@khaled-laptop>
	<4BF3045D.501@telecom-bretagne.eu>
Message-ID: <20100518223315.GA4910@khaled-laptop>

On Wed, May 19, 2010 at 12:19:25AM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Another option is to find Apple font configuration files (which are
> >likely to be some sort of XML) and try to parse it directly, and the
> >same for FC, but we still need an XML library (but this can be easier
> >since context has one ;).
> 
> Am I the only one finding this extremely ugly?

Because running a command line tool and then parsing its non-standard
output (non-standard in the way that it was never meant to be machine
readable and can change without prior notice) is much more uglier, but
reading a configuration file is not.

>                                                Anyway, while we are
> in ugliness, I don't really see why we need some sort of xml library
> to parse the configuration files, some regexp will do the trick very
> easily (for the fonts.conf of fc at least).

Because I neither know XML nor regular expressions (unless very
superficial knowledge is counted.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Wed May 19 00:36:54 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 19 May 2010 00:36:54 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518223315.GA4910@khaled-laptop>
References: <201005172114.o4HLEZ1g010182@f7.net>	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>	<20100518153916.GB3106@khaled-laptop>	<20100518155359.GB27419@phare.normalesup.org>	<20100518210805.GB4732@khaled-laptop>	<4BF3045D.501@telecom-bretagne.eu>
	<20100518223315.GA4910@khaled-laptop>
Message-ID: <4BF31686.5040902@elzevir.fr>

Le 19/05/2010 00:33, Khaled Hosny a ?crit :
> On Wed, May 19, 2010 at 12:19:25AM +0300, Elie Roux wrote:
>> Khaled Hosny a ?crit :
>>> Another option is to find Apple font configuration files (which are
>>> likely to be some sort of XML) and try to parse it directly, and the
>>> same for FC, but we still need an XML library (but this can be easier
>>> since context has one ;).
>>
>> Am I the only one finding this extremely ugly?
> 
> Because running a command line tool and then parsing its non-standard
> output (non-standard in the way that it was never meant to be machine
> readable and can change without prior notice) is much more uglier, but
> reading a configuration file is not.
> 
I agree with Khaled. If al we need is the list of directories, then reading the
configuration file sounds like a good option.

>>                                                Anyway, while we are
>> in ugliness, I don't really see why we need some sort of xml library
>> to parse the configuration files, some regexp will do the trick very
>> easily (for the fonts.conf of fc at least).
> 
> Because I neither know XML nor regular expressions (unless very
> superficial knowledge is counted.)
> 
While it is generally a bad idea to try parsing XML using regexes, I think it
would be possible to retrieve the information in this particular case using
regexes rather than a full-fledge XML parser.

Manuel.

From karl at freefriends.org  Wed May 19 01:04:23 2010
From: karl at freefriends.org (Karl Berry)
Date: Tue, 18 May 2010 23:04:23 GMT
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <20100518153417.GA3106@khaled-laptop>
Message-ID: <201005182304.o4IN4NG3028328@f7.net>

I continue to think just throwing any hardwired set of directories into
the global texmf.cnf for all users of all tex's in all situations is
more likely to be harmful than helpful.

One thing that comes to mind is that we (that is, install-tl) could set,
not OSFONTDIR, but OSFONTDIR.lualatex.  Then the value couldn't affect
non-lualatex users.  and it would be a way to get experience with how
well these directories really work.

Hardwiring the directory list in luaotfload would achieve the same thing
and does not actually sound like a bad thing to me.  Do you already have
platform-specific code there?

    AFAIK, context just checks if OSFONTDIR is set, 

If you say so.  That wasn't my understanding from Hans, but I never
actually looked at what he did.  Indeed, maybe he just sets it personally.

karl

From wspr81 at gmail.com  Wed May 19 01:33:04 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 09:03:04 +0930
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <201005182304.o4IN4NG3028328@f7.net>
References: <201005182304.o4IN4NG3028328@f7.net>
Message-ID: <C292BD6C-F213-4B40-8A8B-B4722746A227@gmail.com>

On 19/05/2010, at 8:34 AM, Karl Berry wrote:

> One thing that comes to mind is that we (that is, install-tl) could set,
> not OSFONTDIR, but OSFONTDIR.lualatex.  Then the value couldn't affect
> non-lualatex users.  and it would be a way to get experience with how
> well these directories really work.

Without (personally) knowing how ConTeXt is using this env variable, this seems quite prudent, if that (being the use of a texmf.cnf assignment) is the option we end up choosing.

> Hardwiring the directory list in luaotfload would achieve the same thing
> and does not actually sound like a bad thing to me.  Do you already have
> platform-specific code there?

Yes, at the moment, but Khaled was trying (I think) to avoid this situation. I'm fine with keeping the directories hard-wired into luaotfload at least for now.

Thanks,
-- Will



From arthur.reutenauer at normalesup.org  Wed May 19 01:46:58 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 19 May 2010 01:46:58 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <C292BD6C-F213-4B40-8A8B-B4722746A227@gmail.com>
References: <201005182304.o4IN4NG3028328@f7.net>
	<C292BD6C-F213-4B40-8A8B-B4722746A227@gmail.com>
Message-ID: <20100518234658.GG27419@phare.normalesup.org>

> Without (personally) knowing how ConTeXt is using this env variable, this seems quite prudent, if that (being the use of a texmf.cnf assignment) is the option we end up choosing.

  Me too, for what it's worth.

	Arthur

From wspr81 at gmail.com  Wed May 19 02:31:44 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 10:01:44 +0930
Subject: [lltx] Regarding fontspec
In-Reply-To: <20100518165141.GA3700@khaled-laptop>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
	<20100518165141.GA3700@khaled-laptop>
Message-ID: <43739882-870D-497C-94F6-56E737270A31@gmail.com>

On 19/05/2010, at 2:21 AM, Khaled Hosny wrote:

> On Tue, May 18, 2010 at 07:31:46PM +0300, Elie Roux wrote:
>> Khaled Hosny a ?crit :
>>> Donno, but I'm unlikely to have time for luaotfload in the near future,
>>> so it is up to Elie to decide.
>> 
>> Is it ok if I merge the commits manually and change the owner to you
>> (Will)? The other solution would be to do it yourself... Khaled,
>> could you give him the rights on your repo?
> 
> Done :)

I made a mess of rebasing my work on yours the first time round, so I'll have to go back and see which of my changes are still relevant before applying them on top of the new HEAD.

I hope I can do this today.

Since I haven't heard of major objections to the way my commits were handled, I'll try and do the same sort of things again: get it working on Mac OS X right now and then later we'll think about making it more elegant.

But am supposed to be assuming that OSFONTDIR is set or not?
Or test for both cases?

-- Will



From wspr81 at gmail.com  Wed May 19 08:32:51 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 16:02:51 +0930
Subject: [lltx] otfload current status
Message-ID: <00C63345-547E-4DC7-97C2-0A2D3F59EBF4@gmail.com>

Elie et al,

The HEAD of luaotfload gives me errors very early on, so I've forked the repository from HEAD^1 and added (again) the necessary changes to get things working on Mac OS X:

  http://github.com/wspr/luaotfload/tree/fresh

Please fix khaled/HEAD first and I'll push my changes after that. (If you've got time, by all means feel free to pull my changes in yourself!)

Please also do not push much to khaled/HEAD before that happens, because I'll probably then have to spend more time merging/rebasing, which I've already spent today. I know I need the practise but twice on the same set of commits is not fun.

-- Will



From elie.roux at telecom-bretagne.eu  Wed May 19 09:15:54 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 10:15:54 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <43739882-870D-497C-94F6-56E737270A31@gmail.com>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
	<20100518165141.GA3700@khaled-laptop>
	<43739882-870D-497C-94F6-56E737270A31@gmail.com>
Message-ID: <4BF3902A.8070905@telecom-bretagne.eu>

Will Robertson a ?crit :
> But am supposed to be assuming that OSFONTDIR is set or not?
> Or test for both cases?
>   

Hello,

it should be tested for both cases.

Thank you,
-- 
Elie


From elie.roux at telecom-bretagne.eu  Wed May 19 09:40:18 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 10:40:18 +0300
Subject: [lltx] otfload current status
In-Reply-To: <00C63345-547E-4DC7-97C2-0A2D3F59EBF4@gmail.com>
References: <00C63345-547E-4DC7-97C2-0A2D3F59EBF4@gmail.com>
Message-ID: <4BF395E2.8060704@telecom-bretagne.eu>

Will Robertson a ?crit :
> The HEAD of luaotfload gives me errors very early on, so I've forked the repository from HEAD^1 and added (again) the necessary changes to get things working on Mac OS X:
>
>   http://github.com/wspr/luaotfload/tree/fresh
>
> Please fix khaled/HEAD first and I'll push my changes after that. (If you've got time, by all means feel free to pull my changes in yourself!)

Done!

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Wed May 19 10:06:39 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 11:06:39 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF31686.5040902@elzevir.fr>
References: <201005172114.o4HLEZ1g010182@f7.net>	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>	<20100518153916.GB3106@khaled-laptop>	<20100518155359.GB27419@phare.normalesup.org>	<20100518210805.GB4732@khaled-laptop>	<4BF3045D.501@telecom-bretagne.eu>
	<20100518223315.GA4910@khaled-laptop> <4BF31686.5040902@elzevir.fr>
Message-ID: <4BF39C0F.8090600@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I agree with Khaled. If al we need is the list of directories, then 
> reading the
> configuration file sounds like a good option.
>   

Ok... let's go then... well... this solves the problem in linux where 
the file is at a standard place (/etc/fonts/fonts.conf)... at least I 
hope all distributions put it here. Do anyone have a different file? 
That's part of the problem that may appear later: if a distribution 
changes this file, its location, its format, etc. we will have to have a 
huge amount of patches... where the call to fc-list is standard thanks 
to the path variable which is supposed to be set accordingly. There is 
absolutely no guaranty that it will stay in the same format across the 
versions, whereas we can expect some sort of backward compatibility in 
fc-list.

Anyway, how should we proceed under windows? Should we scan only 
C:\WINNT\Fonts?

> While it is generally a bad idea to try parsing XML using regexes, I think it
> would be possible to retrieve the information in this particular case using
> regexes rather than a full-fledge XML parser.
>   

The fonts.conf I have is extremely simple to parse... could everyone 
send me his fonts.conf so that I can see if there are some differences?

Thank you,
-- 
Elie

From wspr81 at gmail.com  Wed May 19 11:37:21 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 19:07:21 +0930
Subject: [lltx] code style
Message-ID: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>

Hi,

Quick questions:

Why the obfuscation such as 

local splitpath, expandpath = file.split_path, kpse.expand_path
local gsub, match, rpadd    = string.gsub, string.match, string.rpadd

and so on? It makes the code typed shorter, yes, but I've found it harder to read because I haven't known the context of the functions. Is this a regular kind of thing in Lua programming?

Also, four spaces for indenting? Again, is this standard?

-- Will



From elie.roux at telecom-bretagne.eu  Wed May 19 11:59:13 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 12:59:13 +0300
Subject: [lltx] code style
In-Reply-To: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
Message-ID: <4BF3B671.3070801@telecom-bretagne.eu>

Will Robertson a ?crit :
> local splitpath, expandpath = file.split_path, kpse.expand_path
> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd
>
> and so on? It makes the code typed shorter, yes, but I've found it harder to read because I haven't known the context of the functions. Is this a regular kind of thing in Lua programming?
>   

It makes these functions accessed faster too. Actually this is a ConTeXt 
programming style, we just took it from there, and fully trust Hans for 
doing these kind of things right.

> Also, four spaces for indenting? Again, is this standard?
>   

Spaces for indenting is maybe something we don't want to discuss... it 
has a decades-past of flame wars behind it... let's keep with spaces for 
indenting...

Thank you,
-- 
Elie

From arthur.reutenauer at normalesup.org  Wed May 19 11:59:48 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 19 May 2010 11:59:48 +0200
Subject: [lltx] code style
In-Reply-To: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
Message-ID: <20100519095948.GP27419@phare.normalesup.org>

> local splitpath, expandpath = file.split_path, kpse.expand_path
> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd

  It's not obfuscation, it's Hans' style :-)  I'm not a big fan either,
but I got used to it, reading ConTeXt's Lua source code.

  I think I've seen it under Roberto's pen in _Programming in Lua_ but
can't be sure.

> Also, four spaces for indenting? Again, is this standard?

  This is K&R, Will!  I think they used four spaces for a single indent,
and a eight-space tab for a double indent (and so on); I personally like
it better than a full eight-space tab because you can have more levels
of indentation ;-)  At work we're even using two-space indents (well,
I'm the only one respecting the house style so *I* use a two-space
indent and I've come to like it best).

	Arthur

From wspr81 at gmail.com  Wed May 19 11:06:22 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 18:36:22 +0930
Subject: [lltx] otfload current status
In-Reply-To: <4BF395E2.8060704@telecom-bretagne.eu>
References: <00C63345-547E-4DC7-97C2-0A2D3F59EBF4@gmail.com>
	<4BF395E2.8060704@telecom-bretagne.eu>
Message-ID: <B6571E97-34BB-4A75-BA33-E68E1A4F4E4D@gmail.com>

On 19/05/2010, at 5:10 PM, Elie Roux wrote:

> Done!

Okay, I've now pushed my changes to khaled's master.
It still contains the ugly hacks to get things working on Mac OS X. We should think about fixing these up as we go along.

Could you check I haven't inadvertently broken anything?
(An eyeball or two over my code would be appreciated as I'm still a little unfamiliar in Lua.)

-- Will



From wspr81 at gmail.com  Wed May 19 11:18:13 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 18:48:13 +0930
Subject: [lltx] Regarding fontspec
In-Reply-To: <4BF3902A.8070905@telecom-bretagne.eu>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
	<20100518165141.GA3700@khaled-laptop>
	<43739882-870D-497C-94F6-56E737270A31@gmail.com>
	<4BF3902A.8070905@telecom-bretagne.eu>
Message-ID: <1737D2A4-D2C8-451A-91BC-55E5A33B9D2C@gmail.com>

On 19/05/2010, at 4:45 PM, Elie Roux wrote:

> it should be tested for both cases.

Without digging too far, I can confirm that:

1. Without OSFONTDIR, all texmf fonts and system fonts are located.

2. With OSFONTDIR, all texmf fonts and fonts found in OSFONTDIR are located. (Because OSFONTDIR is inherited by OPENTYPEFONTS in texmf.cnf.)

Is this actually what we want to happen?
Or would the following instead be better?

2b. With OSFONTDIR, all texmf fonts and system fonts are located and ALSO all fonts in OSFONTDIR.

This makes more sense to me, personally -- in that users would like to add extra directories to their font-search-path -- but it doesn't really make sense with the name of "OSFONTDIR".

-- Will



From wspr81 at gmail.com  Wed May 19 13:58:25 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 21:28:25 +0930
Subject: [lltx] code style
In-Reply-To: <20100519095948.GP27419@phare.normalesup.org>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
	<20100519095948.GP27419@phare.normalesup.org>
Message-ID: <C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>

On 19/05/2010, at 7:29 PM, Arthur Reutenauer wrote:

>> local splitpath, expandpath = file.split_path, kpse.expand_path
>> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd
> 
>  It's not obfuscation, it's Hans' style :-)  I'm not a big fan either,
> but I got used to it, reading ConTeXt's Lua source code.

Well, that's the whole point -- once you're used to it, it's fine :)
I don't have a huge objection to it and I can see how it's useful when you're re-using many many functions.

But it's just a bit inconsistent when you've got expandpath (=kpse.expand_path) but then go and use kpse.expand_var in the same file. And it adds an extra line of code to the beginning of the script.

Sorry to complain. I just haven't eaten yet and it's late :)
I'm perfectly happy to leave things as are. (Although I might judiciously edit once in a while.)

(P.S.  Not that I'm one to talk about consistency or good code when you take a look inside fontspec.dtx!)


> I think I've seen it under Roberto's pen in _Programming in Lua_ but
> can't be sure.

I do seem to recall he mentions it, yes...


>> Also, four spaces for indenting? Again, is this standard?
> 
>  This is K&R, Will!  I think they used four spaces for a single indent,
> and a eight-space tab for a double indent (and so on); I personally like
> it better than a full eight-space tab because you can have more levels
> of indentation ;-)  At work we're even using two-space indents (well,
> I'm the only one respecting the house style so *I* use a two-space
> indent and I've come to like it best).


I didn't mean to imply that I preferred tabs; on the contrary.
I personally like 2-space-indenting, but mostly only from lots of TeX use, where command names get rather long.

In fact, I just wanted to clarify -- this is what we want to do, explicitly? :)

-- Will



From elie.roux at telecom-bretagne.eu  Wed May 19 14:11:01 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 15:11:01 +0300
Subject: [lltx] bug in the caches
In-Reply-To: <4BF3BECD.4080007@wxs.nl>
References: <4BF2F9E0.7020507@telecom-bretagne.eu> <4BF3BECD.4080007@wxs.nl>
Message-ID: <4BF3D555.3030801@telecom-bretagne.eu>

Hans Hagen a ?crit :
> i can check on the filename and do an additional lookup if needed but 
> that's as far as i want to go; anything more complex is asking for 
> troubles (also, as we're in code freeze time for tex live i'd rather 
> not do drastic changes as something that might work at your end can 
> equally well not work with context)

Ok! The best would be to set the filename of the table returned by the 
cache to nil if a lookup fails, if this check is done, everything should 
work OK.

Actually it might be a bug in ConTeXt too... AFAICT, the path in the 
cache (if it exists) is the only one passed to the backend for the 
inclusion in the pdf, which implies errors if it's wrong (when the one 
of the specification, it it exists, has far less chances to be wrong... 
But there are a lot of things I don't know in ConTeXt, so I can't tell more.

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Wed May 19 14:12:18 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 19 May 2010 14:12:18 +0200
Subject: [lltx] code style
In-Reply-To: <4BF3B671.3070801@telecom-bretagne.eu>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
	<4BF3B671.3070801@telecom-bretagne.eu>
Message-ID: <AANLkTikHtsBjVzypPKYhuPP7olMn_yIN11EuV-y6jPC4@mail.gmail.com>

On Wed, May 19, 2010 at 11:59 AM, Elie Roux
<elie.roux at telecom-bretagne.eu> wrote:
> Will Robertson a ?crit :
>>
>> local splitpath, expandpath = file.split_path, kpse.expand_path
>> local gsub, match, rpadd ? ?= string.gsub, string.match, string.rpadd
>>
>> and so on? It makes the code typed shorter, yes, but I've found it harder
>> to read because I haven't known the context of the functions. Is this a
>> regular kind of thing in Lua programming?
>>
>
> It makes these functions accessed faster too. Actually this is a ConTeXt
> programming style, we just took it from there, and fully trust Hans for
> doing these kind of things right.
>
>> Also, four spaces for indenting? Again, is this standard?
>>
>
> Spaces for indenting is maybe something we don't want to discuss... it has a
> decades-past of flame wars behind it... let's keep with spaces for
> indenting...
>
> Thank you,
> --
> Elie
>


Lua code from ConTeXt minimals *mkiv files is almost indistinguishable
from ordinary Lua code
and can (and should be, in my opinion) used as example.
Hans's style (aka ConTeXt style) is clearly expressed by   TeX macros
in *tex and *mkii files .



PS
forgive me Elie, but I  have made a mistake with the first email .



-- 
luigi


From elie.roux at telecom-bretagne.eu  Wed May 19 14:17:52 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 15:17:52 +0300
Subject: [lltx] Regarding fontspec
In-Reply-To: <1737D2A4-D2C8-451A-91BC-55E5A33B9D2C@gmail.com>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
	<20100518165141.GA3700@khaled-laptop>
	<43739882-870D-497C-94F6-56E737270A31@gmail.com>
	<4BF3902A.8070905@telecom-bretagne.eu>
	<1737D2A4-D2C8-451A-91BC-55E5A33B9D2C@gmail.com>
Message-ID: <4BF3D6F0.5050400@telecom-bretagne.eu>

Will Robertson a ?crit :
> 2. With OSFONTDIR, all texmf fonts and fonts found in OSFONTDIR are located. (Because OSFONTDIR is inherited by OPENTYPEFONTS in texmf.cnf.)
>
> Is this actually what we want to happen?
>   

Yes!

> Or would the following instead be better?
>
> 2b. With OSFONTDIR, all texmf fonts and system fonts are located and ALSO all fonts in OSFONTDIR.
>
> This makes more sense to me, personally -- in that users would like to add extra directories to their font-search-path -- but it doesn't really make sense with the name of "OSFONTDIR".
>   

It seems weird to me that a user sets an incomplete OSFONTDIR (meaning 
not containing the directories we have in luaotfload)... unless I didn't 
really understand what you were meaning...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Wed May 19 14:56:48 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 19 May 2010 14:56:48 +0200
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF39C0F.8090600@telecom-bretagne.eu>
References: <201005172114.o4HLEZ1g010182@f7.net>	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>	<20100518153916.GB3106@khaled-laptop>	<20100518155359.GB27419@phare.normalesup.org>	<20100518210805.GB4732@khaled-laptop>	<4BF3045D.501@telecom-bretagne.eu>	<20100518223315.GA4910@khaled-laptop>
	<4BF31686.5040902@elzevir.fr>
	<4BF39C0F.8090600@telecom-bretagne.eu>
Message-ID: <4BF3E010.3090004@elzevir.fr>

Le 19/05/2010 10:06, Elie Roux a ?crit :
> Ok... let's go then... well... this solves the problem in linux where
> the file is at a standard place (/etc/fonts/fonts.conf)... at least I
> hope all distributions put it here. Do anyone have a different file?
> That's part of the problem that may appear later: if a distribution
> changes this file, its location, its format, etc. we will have to have a
> huge amount of patches... where the call to fc-list is standard thanks
> to the path variable which is supposed to be set accordingly.

No, as Khaled mentioned, fc-list's output format is completely non-standard and
may change at any time, with higher probability that the location of
configuration files, if you want my opinion. Also, if we ever have to deal with
such a change, it's easier to test with file location (either the file is here
or not) than with output format (how to you recognize which format is being used).

Manuel.

From mpg at elzevir.fr  Wed May 19 15:19:31 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 19 May 2010 15:19:31 +0200
Subject: [lltx] code style
In-Reply-To: <C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
Message-ID: <4BF3E563.80202@elzevir.fr>

Le 19/05/2010 13:58, Will Robertson a ?crit :
> On 19/05/2010, at 7:29 PM, Arthur Reutenauer wrote:
> 
>>> local splitpath, expandpath = file.split_path, kpse.expand_path
>>> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd
>>
>>  It's not obfuscation, it's Hans' style :-)  I'm not a big fan either,
>> but I got used to it, reading ConTeXt's Lua source code.
> 
> Well, that's the whole point -- once you're used to it, it's fine :)

Personally, I don't like this style very much either, fwiw. I don't doubt you
can get used to any style, but anyway.

> But it's just a bit inconsistent when you've got expandpath (=kpse.expand_path) but then go and use kpse.expand_var in the same file. And it adds an extra line of code to the beginning of the script.
> 
Agreed.

>> I think I've seen it under Roberto's pen in _Programming in Lua_ but
>> can't be sure.
> 
> I do seem to recall he mentions it, yes...
> 
It is probably mentioned as a standard way to deal with modules. The easiest way
to "import" variables in a module is to declare it using

module('foobar', package.seeall)

but it has the following funny effect: foobar.string will be the same as the
global string table.

Another, more paranoid way of importing symbols in modules is to import them as
locals, eg:

local pairs, ipairs, format = pairs, ipairs, string.format
module('foobar')

Here the goal is not really to shoten names, but to keep a closer control about
which symbols are available in the scope of the module, and avoid the above
mentioned funny effect.

(Also, locals are accessed faster than globals, as ?lie mentioned, but I doubt
this is relevant except in very special cases.)

> I didn't mean to imply that I preferred tabs; on the contrary.
> I personally like 2-space-indenting, but mostly only from lots of TeX use, where command names get rather long.
> 
Currently, I'm indenting my TeX code with two spaces, my stand-alone Lua code
with four spaces, and for Lua code embedded in dtx files... hum, I don't know. A
mix of both, I'm afraid.

Manuel.

From wspr81 at gmail.com  Wed May 19 15:36:14 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 19 May 2010 23:06:14 +0930
Subject: [lltx] Regarding fontspec
In-Reply-To: <4BF3D6F0.5050400@telecom-bretagne.eu>
References: <28F11A83-C75D-41D1-8FA6-F4BA90003470@gmail.com>
	<20100517162918.GA10856@khaled-laptop>
	<7E22A424-0053-4BDE-AE2B-8549A958AC98@gmail.com>
	<20100518161851.GA3534@khaled-laptop>
	<4BF2C0F2.4080800@telecom-bretagne.eu>
	<20100518165141.GA3700@khaled-laptop>
	<43739882-870D-497C-94F6-56E737270A31@gmail.com>
	<4BF3902A.8070905@telecom-bretagne.eu>
	<1737D2A4-D2C8-451A-91BC-55E5A33B9D2C@gmail.com>
	<4BF3D6F0.5050400@telecom-bretagne.eu>
Message-ID: <A419295F-539A-40AF-AE82-D52F06F1753D@gmail.com>

On 19/05/2010, at 9:47 PM, Elie Roux wrote:

>> 2b. With OSFONTDIR, all texmf fonts and system fonts are located and ALSO all fonts in OSFONTDIR.
>> 
>> This makes more sense to me, personally -- in that users would like to add extra directories to their font-search-path -- but it doesn't really make sense with the name of "OSFONTDIR".
>>  
> 
> It seems weird to me that a user sets an incomplete OSFONTDIR (meaning not containing the directories we have in luaotfload)... unless I didn't really understand what you were meaning...

Okay, that works. I'll document it that way.
(As long as we're clear on the behaviour either approach is fine, I think.)

-- Will



From pragma at wxs.nl  Wed May 19 14:45:06 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 19 May 2010 14:45:06 +0200
Subject: [lltx] bug in the caches
In-Reply-To: <4BF3D555.3030801@telecom-bretagne.eu>
References: <4BF2F9E0.7020507@telecom-bretagne.eu> <4BF3BECD.4080007@wxs.nl>
	<4BF3D555.3030801@telecom-bretagne.eu>
Message-ID: <4BF3DD52.4000305@wxs.nl>

On 19-5-2010 2:11, Elie Roux wrote:

> But there are a lot of things I don't know in ConTeXt, so I can't tell
> more.

we have a different lookup subsystem in context (as it can be that one 
runs from a cd drive and gets a different mount point/drive at a next 
session) ... fonts in context are done different anyway

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 19 12:34:53 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 19 May 2010 12:34:53 +0200
Subject: [lltx] bug in the caches
In-Reply-To: <4BF2F9E0.7020507@telecom-bretagne.eu>
References: <4BF2F9E0.7020507@telecom-bretagne.eu>
Message-ID: <4BF3BECD.4080007@wxs.nl>

On 18-5-2010 10:34, Elie Roux wrote:
> Hello,
>
> I just spent some time debugging the error I had in luaotfload. It came
> from something I wasn't expecting: In the cache of the font, the
> filename is wrong because I moved the font. The problem is that
> specification.filename is not taken into account at all if there is a
> filename in the cache, even if this filename leads to no file.
>
> Hans, do you think you could change the files to fix this problem? (If
> I'm not wrong and if the problem has not already been fixed since the
> last time we sync, which is very recent).
>
> If not (this is more for the lualatex team), I thought about two solutions:
> - we could free the font cache when we call mkluatexfontdb, this would
> reset everything and it would be doable by the user in case of bug (that
> could appear later)
> - I can patch the ConTeXt files to check the filename, but it will be a
> bit more difficult to maintain...
> - we can do both!

i can check on the filename and do an additional lookup if needed but 
that's as far as i want to go; anything more complex is asking for 
troubles (also, as we're in code freeze time for tex live i'd rather not 
do drastic changes as something that might work at your end can equally 
well not work with context)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wspr81 at gmail.com  Wed May 19 16:39:36 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 20 May 2010 00:09:36 +0930
Subject: [lltx] otfload licences
Message-ID: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>

Hi,

What licence is the luaotfload package supposed to be under?

otfl-* that were written specifically contain "GPL" as does the readme, but the rest is "CC0", which I hadn't heard of before now but after a very very brief look certainly don't object to.

I'm assuming ConTeXt isn't under the GPL or the whole package would have to be, right?

-- Will



From elie.roux at telecom-bretagne.eu  Wed May 19 17:14:30 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 18:14:30 +0300
Subject: [lltx] otfload licences
In-Reply-To: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
Message-ID: <4BF40056.4050900@telecom-bretagne.eu>

Will Robertson a ?crit :
> What licence is the luaotfload package supposed to be under?
>   

GPL.

> otfl-* that were written specifically contain "GPL" as does the readme, but the rest is "CC0", which I hadn't heard of before now but after a very very brief look certainly don't object to.
>
> I'm assuming ConTeXt isn't under the GPL or the whole package would have to be, right?
>   

ConTeXt's license is quite unclear, but I consider it's GPL, and thus 
luaotfload is GPL (no other choice, as it contains GPL code).

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Wed May 19 21:25:33 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 19 May 2010 22:25:33 +0300
Subject: [lltx] kpse.init_prog and texconfig table
Message-ID: <4BF43B2D.7040908@telecom-bretagne.eu>

Hello,

after some experimentation, it seems that a call to kpse.init_prog is a 
good thing to keep the behaviour normal for pk fonts... The problem is 
that otf-font-nms seems a weird place to make that call, it would be 
better for it to be in the format. Also after some readings of the 
luatex manual, I  also think it would definitely be a good thing to have 
the texconfig table filled... The problem is that it's the format which 
would be supposed to do so normally.

We cannot achieve putting some lua code cleanly in the format for 
TeXLive 2010 (at least I don't think so), but a temporary solution would 
be to build a new part of luatexbase (luatexbase-init?) to do so. It 
would contain the call to kpse.init_prog and also the initalization of 
the texconfig table... what do you think about it? It would be a good 
occasion to test it before integrating it in the format.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Wed May 19 21:43:52 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 22:43:52 +0300
Subject: [lltx] Can luatex auto-run mkluatexfontdb ?
In-Reply-To: <4BF39C0F.8090600@telecom-bretagne.eu>
References: <201005172114.o4HLEZ1g010182@f7.net>
	<F1761AD4-FBFD-41FC-9051-E25D7F8CBE4E@gmail.com>
	<20100518153916.GB3106@khaled-laptop>
	<20100518155359.GB27419@phare.normalesup.org>
	<20100518210805.GB4732@khaled-laptop>
	<4BF3045D.501@telecom-bretagne.eu>
	<20100518223315.GA4910@khaled-laptop> <4BF31686.5040902@elzevir.fr>
	<4BF39C0F.8090600@telecom-bretagne.eu>
Message-ID: <20100519194352.GB3190@khaled-laptop>

On Wed, May 19, 2010 at 11:06:39AM +0300, Elie Roux wrote:
> Manuel P?gouri?-Gonnard a ?crit :
> >I agree with Khaled. If al we need is the list of directories,
> >then reading the
> >configuration file sounds like a good option.
> 
> Ok... let's go then... well... this solves the problem in linux
> where the file is at a standard place (/etc/fonts/fonts.conf)... at
> least I hope all distributions put it here.

Check FC documentation about standard location of configuration file, I
recall it was documented there.

>                                              Do anyone have a
> different file? That's part of the problem that may appear later: if
> a distribution changes this file, its location, its format, etc. we
> will have to have a huge amount of patches...

Distributions can't change the format, unless they change FC
drastically, which I don't see any sane distribution doing. FC
configuration syntax is well documented and is unlikely to change since
there are many third party tools that read/write it, we are not alone.

>                                               where the call to
> fc-list is standard thanks to the path variable which is supposed to
> be set accordingly. There is absolutely no guaranty that it will
> stay in the same format across the versions, whereas we can expect
> some sort of backward compatibility in fc-list.

It is actually the other way around, read my comment above. Note that
fc-list output is supposed to be human, not machine readable, and no
syntax is documented at all, I just guessed from the output on my
machine. I don't know from where you get the idea it would remain
backward compatible.

> Anyway, how should we proceed under windows? Should we scan only
> C:\WINNT\Fonts?

No, it is %windir%\fonts, %windir% as an env variable (dunno how env
variables are handled under windows, though).

> >While it is generally a bad idea to try parsing XML using regexes, I think it
> >would be possible to retrieve the information in this particular case using
> >regexes rather than a full-fledge XML parser.
> 
> The fonts.conf I have is extremely simple to parse... could everyone
> send me his fonts.conf so that I can see if there are some
> differences?

Most FC configuration files (almost everything under /etc/fonts) is
shipped with the library itself, distributions are likely to add files
on top of it, but, to be safe, you should be checking file syntax in the
documentation, you don't need to reverse engineer it.
http://fontconfig.org/fontconfig-user.html

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Wed May 19 21:50:44 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 22:50:44 +0300
Subject: [lltx] code style
In-Reply-To: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
Message-ID: <20100519195044.GC3190@khaled-laptop>

On Wed, May 19, 2010 at 07:07:21PM +0930, Will Robertson wrote:
> Hi,
> 
> Quick questions:
> 
> Why the obfuscation such as 
> 
> local splitpath, expandpath = file.split_path, kpse.expand_path
> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd
> 
> and so on? It makes the code typed shorter, yes, but I've found it harder to read because I haven't known the context of the functions. Is this a regular kind of thing in Lua programming?

Because the first tip you get for "optimizing lua code" is: always use
locals, it is faster.

> 
> Also, four spaces for indenting? Again, is this standard?

I was thinking about switching to two spaces instead, because the code
can get very nested and we get very long lines quite easily.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Wed May 19 21:55:12 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 22:55:12 +0300
Subject: [lltx] code style
In-Reply-To: <C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>
	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
Message-ID: <20100519195512.GD3190@khaled-laptop>

On Wed, May 19, 2010 at 09:28:25PM +0930, Will Robertson wrote:
> On 19/05/2010, at 7:29 PM, Arthur Reutenauer wrote:
> 
> >> local splitpath, expandpath = file.split_path, kpse.expand_path
> >> local gsub, match, rpadd    = string.gsub, string.match, string.rpadd
> > 
> >  It's not obfuscation, it's Hans' style :-)  I'm not a big fan either,
> > but I got used to it, reading ConTeXt's Lua source code.
> 
> Well, that's the whole point -- once you're used to it, it's fine :)
> I don't have a huge objection to it and I can see how it's useful when you're re-using many many functions.
> 
> But it's just a bit inconsistent when you've got expandpath (=kpse.expand_path) but then go and use kpse.expand_var in the same file. And it adds an extra line of code to the beginning of the script.

May be because the later was used just once, may be someone was
quickly experimenting and later forgot to do it the "standard" way, may
be just an oversight. The code is far from being well written anyway, and
I'm not particularly big fan of it.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Wed May 19 22:13:19 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 19 May 2010 23:13:19 +0300
Subject: [lltx] kpse.init_prog and texconfig table
In-Reply-To: <4BF43B2D.7040908@telecom-bretagne.eu>
References: <4BF43B2D.7040908@telecom-bretagne.eu>
Message-ID: <20100519201319.GA3539@khaled-laptop>

On Wed, May 19, 2010 at 10:25:33PM +0300, Elie Roux wrote:
> Hello,
> 
> after some experimentation, it seems that a call to kpse.init_prog
> is a good thing to keep the behaviour normal for pk fonts... The
> problem is that otf-font-nms seems a weird place to make that call,
> it would be better for it to be in the format. Also after some
> readings of the luatex manual, I  also think it would definitely be
> a good thing to have the texconfig table filled...

To use texconfig table you have to disable kpse, otherwise whatever ends
there will have no effect, and I think it is a no go at least in the
foreseen future.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Thu May 20 01:32:39 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 20 May 2010 09:02:39 +0930
Subject: [lltx] otfload licences
In-Reply-To: <4BF40056.4050900@telecom-bretagne.eu>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
Message-ID: <D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>

On 20/05/2010, at 12:44 AM, Elie Roux wrote:

> Will Robertson a ?crit :
>> What licence is the luaotfload package supposed to be under?
> 
> GPL.

Okay, then the rest of the package should be changed to the GPL as well.

>> otfl-* that were written specifically contain "GPL" as does the readme, but the rest is "CC0", which I hadn't heard of before now but after a very very brief look certainly don't object to.
>> 
>> I'm assuming ConTeXt isn't under the GPL or the whole package would have to be, right?
> 
> ConTeXt's license is quite unclear, but I consider it's GPL, and thus luaotfload is GPL (no other choice, as it contains GPL code).

ConTeXt's licence looks clear enough to me:
  <http://wiki.contextgarden.net/Read_Me>

-- Will



From elie.roux at telecom-bretagne.eu  Thu May 20 08:25:32 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 20 May 2010 09:25:32 +0300
Subject: [lltx] otfload licences
In-Reply-To: <D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
Message-ID: <4BF4D5DC.1040905@telecom-bretagne.eu>

Will Robertson a ?crit :
> Okay, then the rest of the package should be changed to the GPL as well.
>   

Do you mean the rest of the code? I don't think so, you can distribute 
CC0 code under GPL, CC0 allows it.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Thu May 20 08:30:09 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 20 May 2010 09:30:09 +0300
Subject: [lltx] kpse.init_prog and texconfig table
In-Reply-To: <20100519201319.GA3539@khaled-laptop>
References: <4BF43B2D.7040908@telecom-bretagne.eu>
	<20100519201319.GA3539@khaled-laptop>
Message-ID: <4BF4D6F1.10002@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> To use texconfig table you have to disable kpse, otherwise whatever ends
> there will have no effect, and I think it is a no go at least in the
> foreseen future.
>   

Oh, sorry I didn't read the first key well... for sure, disabling kpse 
is something we don't want... but having the other keys to read, even if 
they're not interpreted by the core would be useful, pk_dpi or 
shell_escape for example...

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Thu May 20 08:51:25 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 20 May 2010 09:51:25 +0300
Subject: [lltx] otfload licences
In-Reply-To: <D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
Message-ID: <4BF4DBED.3070208@telecom-bretagne.eu>

Will Robertson a ?crit :
> ConTeXt's licence looks clear enough to me:
>   <http://wiki.contextgarden.net/Read_Me>
>   

The paragraph

"For practical purposes distributers may also choose the LaTeX project 
licence, which is considered to be a bit more TeX friendly. (BSD alike 
licences, the Ruby Licence and the Apache are all licences that apply 
well for ConTeXt.) In practice, users may forget about the legal part, 
if only because I haven't even read (and understood) it completely myself"

doesn't to me... And also, I see no mention of "GPLv2 or later", so we 
cannot distribute the code under GPLv3, and we cannot distribute GPLv3 
code under GPLv2, so the only solution is to put the code under GPLv2 or 
CC0 (which allows redistribution under GPLv2).

Thank you,
-- 
Elie

From wspr81 at gmail.com  Thu May 20 09:09:28 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 20 May 2010 16:39:28 +0930
Subject: [lltx] otfload licences
In-Reply-To: <4BF4DBED.3070208@telecom-bretagne.eu>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
	<4BF4DBED.3070208@telecom-bretagne.eu>
Message-ID: <AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>

Hi,

I already commented briefly on GitHub, but before we continue this discussion we need to clear some things up:

1.  We have code from ConTeXt which is in the GPL (v2, apparently)

2.  Any derived work from that code must also be in the GPL.

3.  Are we allowed to distribute luaotfload under CC0 with the ConTeXt files under GPL? I didn't think so:

"If you modify your copy or copies of the program or any portion of it, or develop a program based upon it, you may distribute the resulting work provided you do so under the GNU General Public License."

4.  Do we *want* to have this weird double-licencing? If so, why?

My suggestion is to have the whole bundle under a single licence. And because the ConTeXt code is already GPL, so should all the rest.

* * *

> The paragraph
> [snip]
> doesn't to me...

I originally interpreted that to mean anyone else writing ConTeXt modules, but on second read it's more ambiguous than that. I'm going to take the conservative approach and ignore that paragraph from now on. ("For practical purposes" doesn't sound very legally sound, to me.)

> And also, I see no mention of "GPLv2 or later", so we cannot distribute the code under GPLv3, and we cannot distribute GPLv3 code under GPLv2, so the only solution is to put the code under GPLv2 or CC0 (which allows redistribution under GPLv2).


I missed the fact that it was v2 of the GPL, not v3. That was a mistake on my part.

* * *

>> Okay, then the rest of the package should be changed to the GPL as well.
> 
> Do you mean the rest of the code? I don't think so, you can distribute CC0 code under GPL, CC0 allows it.

But we're in the reverse situation: you can't distribute GPL code under the CC0 licence.

-- Will



From elie.roux at telecom-bretagne.eu  Thu May 20 09:25:55 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 20 May 2010 10:25:55 +0300
Subject: [lltx] otfload licences
In-Reply-To: <AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
	<4BF4DBED.3070208@telecom-bretagne.eu>
	<AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
Message-ID: <4BF4E403.1010909@telecom-bretagne.eu>

Will Robertson a ?crit :
> 1.  We have code from ConTeXt which is in the GPL (v2, apparently)
>
> 2.  Any derived work from that code must also be in the GPL.
>   

Right. Note that luaotfload.dtx, mkluatexfontdb, luat-ovr anr font-nms 
are not derived files.

> 3.  Are we allowed to distribute luaotfload under CC0 with the ConTeXt files under GPL? I didn't think so:
>   

No, luaotfload was never distributed under the CC0 license... 
luaotfload.dtx (and the derived files) and the other files we created 
were, but the whole package was distrbuted under GPL.

> 4.  Do we *want* to have this weird double-licencing? If so, why?
>   

I personally really dislike GPL and LPPL for TeX code, it makes things 
too complicated, and it causes the kind of legal fog that starts by "for 
practical purpose"... With CC0, you can do anything you want and even 
change the license.

> My suggestion is to have the whole bundle under a single licence. And because the ConTeXt code is already GPL, so should all the rest.
>   

I don't really see the point... You can distruibute code under CC0 (the 
code we created) in a GPL package...

> I originally interpreted that to mean anyone else writing ConTeXt modules, but on second read it's more ambiguous than that. I'm going to take the conservative approach and ignore that paragraph from now on. ("For practical purposes" doesn't sound very legally sound, to me.)
>   

Yes, we have no choice but ignoring it...

> But we're in the reverse situation: you can't distribute GPL code under the CC0 licence.
>   

I said from the beginning that luaotfload was distributed under GPL. 
What could help is that the ConTeXt files contain the legal notice that 
you find (theorically) in all the GPL files, this would make things 
clearer... but I don't think Hans likes it (and I understand him in a 
way...).

To make it clear maybe a paragraph in the readme saying that the whole 
package is distributed under GPL would help... Anyway if you really like 
legal things, you should put a COPYING file in git containing the GPLv2 
text, it's part of the license...

So, what exactly is the point of going all-GPL? It simplifies a little 
bit, but gives some useless restrictions to some files.

Thank you,
-- 
Elie

From mpg at elzevir.fr  Thu May 20 09:27:23 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 20 May 2010 09:27:23 +0200
Subject: [lltx] otfload licences
In-Reply-To: <AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>	<4BF40056.4050900@telecom-bretagne.eu>	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>	<4BF4DBED.3070208@telecom-bretagne.eu>
	<AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
Message-ID: <4BF4E45B.9080300@elzevir.fr>

Le 20/05/2010 09:09, Will Robertson a ?crit :
> Hi,
> 
> I already commented briefly on GitHub, but before we continue this discussion we need to clear some things up:
> 
> 1.  We have code from ConTeXt which is in the GPL (v2, apparently)
> 
> 2.  Any derived work from that code must also be in the GPL.
> 
> 3.  Are we allowed to distribute luaotfload under CC0 with the ConTeXt files under GPL? I didn't think so:
> 
> "If you modify your copy or copies of the program or any portion of it, or develop a program based upon it, you may distribute the resulting work provided you do so under the GNU General Public License."
> 
> 4.  Do we *want* to have this weird double-licencing? If so, why?
> 
> My suggestion is to have the whole bundle under a single licence. And because the ConTeXt code is already GPL, so should all the rest.
> 
FWIW, I fully agree with your points. IMO the whole package under GPLv2 is the
better way to go.

>> Do you mean the rest of the code? I don't think so, you can distribute CC0 code under GPL, CC0 allows it.
> 
> But we're in the reverse situation: you can't distribute GPL code under the CC0 licence.
> 
Right, that is the point.

Manuel.

From wspr81 at gmail.com  Thu May 20 09:34:28 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 20 May 2010 17:04:28 +0930
Subject: [lltx] code style
In-Reply-To: <4BF3E563.80202@elzevir.fr>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
	<4BF3E563.80202@elzevir.fr>
Message-ID: <D1568E18-3D77-4861-BBBE-2197612DE680@gmail.com>

On 19/05/2010, at 10:49 PM, Manuel P?gouri?-Gonnard wrote:

> Another, more paranoid way of importing symbols in modules is to import them as
> locals, eg:
> 
> local pairs, ipairs, format = pairs, ipairs, string.format
> module('foobar')
> 
> Here the goal is not really to shoten names, but to keep a closer control about
> which symbols are available in the scope of the module, and avoid the above
> mentioned funny effect.


This looked interesting, especially after reading more about it in P.I.L., so I spent some time converting -nms to use this syntax.

It was a little more work than I bargained for, but in the end I really like how it forces you to be more strict about how data is being passed around between modules. The more I look into these modules it seems they're rather TeX-like in passing around large global variables everywhere.

Take a look:

http://github.com/wspr/luaotfload/tree/module

Comments welcome. Would you be interested in trying this out in the master branch?

-- Will



From mpg at elzevir.fr  Thu May 20 09:34:47 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 20 May 2010 09:34:47 +0200
Subject: [lltx] otfload licences
In-Reply-To: <4BF4E403.1010909@telecom-bretagne.eu>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>	<4BF40056.4050900@telecom-bretagne.eu>	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>	<4BF4DBED.3070208@telecom-bretagne.eu>	<AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
	<4BF4E403.1010909@telecom-bretagne.eu>
Message-ID: <4BF4E617.50407@elzevir.fr>

Le 20/05/2010 09:25, Elie Roux a ?crit :
> To make it clear maybe a paragraph in the readme saying that the whole
> package is distributed under GPL would help... Anyway if you really like
> legal things, you should put a COPYING file in git containing the GPLv2
> text, it's part of the license...
> 
> So, what exactly is the point of going all-GPL? It simplifies a little
> bit, but gives some useless restrictions to some files.
> 
Okay, so what about adding a COPYING or LICENCE file clearly stating the following:
- the whole package is published under GPL
- more precisely:
  - <list of context files> are derived from ConTeXt, original copyright <I
didn't check>, GPL v2.
  - <list of new files> may be used, distributed and modified under the terms of
CC0.

I don't disagree with the idea of putting some files under a "freeer"
(non-copyleft) licence, but I think it'll help people if at first glance, they
can identify a single licence for the whole package (and discover only later
that some files are more freely usable).

Manuel.

From elie.roux at telecom-bretagne.eu  Thu May 20 09:39:39 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 20 May 2010 10:39:39 +0300
Subject: [lltx] otfload licences
In-Reply-To: <4BF4E617.50407@elzevir.fr>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>	<4BF40056.4050900@telecom-bretagne.eu>	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>	<4BF4DBED.3070208@telecom-bretagne.eu>	<AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
	<4BF4E403.1010909@telecom-bretagne.eu> <4BF4E617.50407@elzevir.fr>
Message-ID: <4BF4E73B.3080802@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Okay, so what about adding a COPYING or LICENCE file clearly stating 
> the following:
> - the whole package is published under GPL
> - more precisely:
>   - <list of context files> are derived from ConTeXt, original copyright <I
> didn't check>, GPL v2.
>   - <list of new files> may be used, distributed and modified under the terms of
> CC0.
>
> I don't disagree with the idea of putting some files under a "freeer"
> (non-copyleft) licence, but I think it'll help people if at first glance, they
> can identify a single licence for the whole package (and discover only later
> that some files are more freely usable).
>   

I agree on that!

Thank you,
-- 
Elie

From mpg at elzevir.fr  Thu May 20 10:26:02 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 20 May 2010 10:26:02 +0200
Subject: [lltx] code style
In-Reply-To: <D1568E18-3D77-4861-BBBE-2197612DE680@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
	<4BF3E563.80202@elzevir.fr>
	<D1568E18-3D77-4861-BBBE-2197612DE680@gmail.com>
Message-ID: <4BF4F21A.3060502@elzevir.fr>

Le 20/05/2010 09:34, Will Robertson a ?crit :
> This looked interesting, especially after reading more about it in P.I.L., 
> so I spent some time converting -nms to use this syntax.
> 
Cool.

> It was a little more work than I bargained for, but in the end I really like 
> how it forces you to be more strict about how data is being passed around 
> between modules. The more I look into these modules it seems they're rather 
> TeX-like in passing around large global variables everywhere.
> 
I'm not sure if that level of strictness is required. Actually, I use that kind
of control (implemented another way) in texdoc, and it sometimes bothers even
myself (but not enough to make me switch to another system) :-)

> Comments welcome.

I've got no interesting comment to do :-)

> Would you be interested in trying this out in the master 
> branch?
> 
No opinion on this point.

Manuel.

From wspr81 at gmail.com  Thu May 20 11:30:27 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 20 May 2010 19:00:27 +0930
Subject: [lltx] code style
In-Reply-To: <4BF4F21A.3060502@elzevir.fr>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
	<4BF3E563.80202@elzevir.fr>
	<D1568E18-3D77-4861-BBBE-2197612DE680@gmail.com>
	<4BF4F21A.3060502@elzevir.fr>
Message-ID: <1FCB6E9C-05EE-4837-9104-1882E7F4EC3C@gmail.com>

On 20/05/2010, at 5:56 PM, Manuel P?gouri?-Gonnard wrote:
> 
> I'm not sure if that level of strictness is required.

My only thought is that we should use either the strict style exclusively or not worry at all about using locals like expandpath=kpse.expand_path.

I like the way that the strict style enforces a more explicit method of passing data around, but I'm not too fussed.

(Of course, we don't want to start forking the ConTeXt files so we're be a little stuck anyway.)

W



From mpg at elzevir.fr  Thu May 20 11:53:52 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 20 May 2010 11:53:52 +0200
Subject: [lltx] code style
In-Reply-To: <1FCB6E9C-05EE-4837-9104-1882E7F4EC3C@gmail.com>
References: <DE75B276-F0EB-4EB8-AF2D-382D44679890@gmail.com>	<20100519095948.GP27419@phare.normalesup.org>
	<C4973559-1C4C-4BB3-A061-BBC5CC2618A0@gmail.com>
	<4BF3E563.80202@elzevir.fr>
	<D1568E18-3D77-4861-BBBE-2197612DE680@gmail.com>
	<4BF4F21A.3060502@elzevir.fr>
	<1FCB6E9C-05EE-4837-9104-1882E7F4EC3C@gmail.com>
Message-ID: <4BF506B0.5000400@elzevir.fr>

Le 20/05/2010 11:30, Will Robertson a ?crit :
> On 20/05/2010, at 5:56 PM, Manuel P?gouri?-Gonnard wrote:
>>
>> I'm not sure if that level of strictness is required.
> 
> My only thought is that we should use either the strict style exclusively or not worry at all about using locals like expandpath=kpse.expand_path.
> 
I tend to think so.

> (Of course, we don't want to start forking the ConTeXt files so we're be a little stuck anyway.)
> 
Yep, maybe it is better to adopt the Context style for luaotfload in order to
keep things consistent. I don't have a strong opinion either way (and since I'm
not contributing code to luaotfload, my opinion wouldn't matter much anyway).

m

From khaledhosny at eglug.org  Thu May 20 18:59:09 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 20 May 2010 19:59:09 +0300
Subject: [lltx] otfload licences
In-Reply-To: <4BF4E403.1010909@telecom-bretagne.eu>
References: <0ECA14DD-C7E7-450E-8FCF-C0F8467ACE3A@gmail.com>
	<4BF40056.4050900@telecom-bretagne.eu>
	<D76D0BF9-2119-4FD0-BA70-D17FED434EA4@gmail.com>
	<4BF4DBED.3070208@telecom-bretagne.eu>
	<AE426348-1CDE-4626-ADD1-74E971168177@gmail.com>
	<4BF4E403.1010909@telecom-bretagne.eu>
Message-ID: <20100520165909.GB3716@khaled-laptop>

On Thu, May 20, 2010 at 10:25:55AM +0300, Elie Roux wrote:
> Will Robertson a ?crit :
> >1.  We have code from ConTeXt which is in the GPL (v2, apparently)
> >
> >2.  Any derived work from that code must also be in the GPL.
> 
> Right. Note that luaotfload.dtx, mkluatexfontdb, luat-ovr anr
> font-nms are not derived files.

luat-ovr and font-nms are actually derived from other context modules, so
they are bound to original context license.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Fri May 21 04:08:03 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 21 May 2010 11:38:03 +0930
Subject: [lltx] CTAN release
Message-ID: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>

Hi,

Unless I'm mistaken, we're now pretty much ready to upload the lua* packages.

Like I wrote earlier, I think fontspec is now ready to be tested although there's still improvements that should be made to the documentation. The main details are there, however.

How do we get people to test the release? We ideally need people running TL2010, since luaotfload won't work on 2009 binaries, but is there anyone doing that yet? In which case (correct me if I'm wrong) before we release we need to write a readme for "lualatex installation and testing" so people can

(a) get the right binaries for LuaTeX
(b) install the lua* packages
(c) install fontspec & xltxtra
(d) run mkluatexfontdb.lua

Assuming this is quick to write, how soon can we upload everything?

-- Will



From mpg at elzevir.fr  Fri May 21 09:28:00 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 21 May 2010 09:28:00 +0200
Subject: [lltx] CTAN release
In-Reply-To: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
Message-ID: <4BF63600.5010900@elzevir.fr>

Le 21/05/2010 04:08, Will Robertson a ?crit :
> Unless I'm mistaken, we're now pretty much ready to upload the lua* packages.
> 
Right. Everything except fontenc & euenc was upload like a week ago. I guess
only luaotfload needs re-uploading.

> Like I wrote earlier, I think fontspec is now ready to be tested although
> there's still improvements that should be made to the documentation. The main
> details are there, however.
> 
Great.

> How do we get people to test the release? We ideally need people running
> TL2010, since luaotfload won't work on 2009 binaries, but is there anyone
> doing that yet?

Besides me and a few people running TL out of the SVN tree, I don't think so :-)
But, binaries are being commited as we speak (since two days now), so I think
full prestest images will be available in a matter of days.

So, my opinion is to wait for TL pretest images to be available, and ask people
to test from there.

> In which case (correct me if I'm wrong) before we release we
> need to write a readme for "lualatex installation and testing" so people can
> 

> (a) get the right binaries for LuaTeX
> (b) install the lua* packages
> (c) install fontspec & xltxtra
> (d) run mkluatexfontdb.lua
> 
Sounds a bit complicated IMO, compared to waiting a few days. (Additionally,
we'll loose^Wspend time explaining users what to do and debugging their
installation about such nasty things as TEXMFDIST/tex/xelatex taking precedence
over TEXMFHOME/tex/latex with xelatex, etc, time which may be better spend
hacking or documenting things.)

Manuel.

From wspr81 at gmail.com  Fri May 21 09:38:24 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 21 May 2010 17:08:24 +0930
Subject: [lltx] CTAN release
In-Reply-To: <4BF63600.5010900@elzevir.fr>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
Message-ID: <F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>

On 21/05/2010, at 4:58 PM, Manuel P?gouri?-Gonnard wrote:

> Le 21/05/2010 04:08, Will Robertson a ?crit :
>> Unless I'm mistaken, we're now pretty much ready to upload the lua* packages.
>> 
> Right. Everything except fontenc & euenc was upload like a week ago. I guess
> only luaotfload needs re-uploading.

Alright; Khaled mentioned in a commit that resyncing needs to happen between ConTeXt and luaotfload. Whoever is responsible for uploading it, please let us know when it's done.

After the luaotfload upload I'll send fontspec/euenc/xltxtra immediately; I'll spend the weekend ensuring the documentation for fontspec is (a) good enough where necessary, and (b) clear that it's still work-in-progress.


> So, my opinion is to wait for TL pretest images to be available, and ask people
> to test from there.

Sounds good. I hate explaining installation to people. (Because I dislike maintaining manual installation of packages myself. Thank heavens biblatex is now in CTAN.)

-- Will



From luigi.scarso at gmail.com  Fri May 21 09:42:27 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 21 May 2010 09:42:27 +0200
Subject: [lltx] CTAN release
In-Reply-To: <F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
Message-ID: <AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>

> Sounds good. I hate explaining installation to people. (Because I dislike maintaining manual installation of packages myself. Thank heavens biblatex is now in CTAN.)

Anyway is it doable a sort of "lualatex minimals ala context" ?



-- 
luigi

From mpg at elzevir.fr  Fri May 21 10:00:41 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 21 May 2010 10:00:41 +0200
Subject: [lltx] CTAN release
In-Reply-To: <AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>	<4BF63600.5010900@elzevir.fr>	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
	<AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>
Message-ID: <4BF63DA9.7090203@elzevir.fr>

Le 21/05/2010 09:42, luigi scarso a ?crit :
>> Sounds good. I hate explaining installation to people. (Because I dislike
>> maintaining manual installation of packages myself. Thank heavens biblatex is
>> now in CTAN.)
> 
> Anyway is it doable a sort of "lualatex minimals ala context" ?
> 
I seem to remember we discussed this, and a separate distribution ? la Context
Minimals is difficult to put together. We reached the conclusion that the best
solution was to make a separate TL repository.

It would not be very hard, I even started preliminary work on it, but I'm
unlikely to finish soon (due to real-life reasons (in a word: thesis), I'm now
just doing what needs to be done before TL2010, and I'll probably be inactive
for a while after that). Of course, anyone is welcome to take over the project.

Anyway, I don't feel there is an urgent need for that: TL2010 pretest images
will be available in a few days, and normal packages can be updated during the
year without any problem. Only when Luatex 0.7x will be out will a separate repo
be interesting again, if the latest version of a package requires this version
of LuaTeX. (At this point, I hope I'll be back in the loop, and will still
volunteer for maintaining lualatex-dev TL repo if needed.)

Manuel.



From mpg at elzevir.fr  Fri May 21 10:03:02 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 21 May 2010 10:03:02 +0200
Subject: [lltx] CTAN release
In-Reply-To: <F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>	<4BF63600.5010900@elzevir.fr>
	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
Message-ID: <4BF63E36.4040200@elzevir.fr>

Le 21/05/2010 09:38, Will Robertson a ?crit :
> Alright; Khaled mentioned in a commit that resyncing needs to happen between
> ConTeXt and luaotfload. Whoever is responsible for uploading it, please let
> us know when it's done.
> 
According to my github feeds, I'm under impression it is done.

> After the luaotfload upload I'll send fontspec/euenc/xltxtra immediately;
> I'll spend the weekend ensuring the documentation for fontspec is (a) good
> enough where necessary, and (b) clear that it's still work-in-progress.
> 
Alternatively, you can just wait until TL pretest is announced so that you can
keep updating the doc in the meanwhile. A you like.

m

From luigi.scarso at gmail.com  Fri May 21 10:04:06 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 21 May 2010 10:04:06 +0200
Subject: [lltx] CTAN release
In-Reply-To: <4BF63DA9.7090203@elzevir.fr>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
	<AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>
	<4BF63DA9.7090203@elzevir.fr>
Message-ID: <AANLkTilKvgDPjPjT-uHbJftXjtrtRfXh8LePndZwC9uI@mail.gmail.com>

On Fri, May 21, 2010 at 10:00 AM, Manuel P?gouri?-Gonnard
<mpg at elzevir.fr> wrote:
> Le 21/05/2010 09:42, luigi scarso a ?crit :

> I seem to remember we discussed this, and a separate distribution ? la Context
> Minimals is difficult to put together. We reached the conclusion that the best
> solution was to make a separate TL repository.
>
> It would not be very hard, I even started preliminary work on it, but I'm
> unlikely to finish soon (due to real-life reasons (in a word: thesis), I'm now
> just doing what needs to be done before TL2010, and I'll probably be inactive
> for a while after that). Of course, anyone is welcome to take over the project.
>
> Anyway, I don't feel there is an urgent need for that: TL2010 pretest images
> will be available in a few days, and normal packages can be updated during the
> year without any problem. Only when Luatex 0.7x will be out will a separate repo
> be interesting again, if the latest version of a package requires this version
> of LuaTeX. (At this point, I hope I'll be back in the loop, and will still
> volunteer for maintaining lualatex-dev TL repo if needed.)

ok, thank you and "in bocca al lupo" for your thesis.


-- 
luigi


From elie.roux at telecom-bretagne.eu  Fri May 21 10:39:33 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 11:39:33 +0300
Subject: [lltx] CTAN release
In-Reply-To: <4BF63600.5010900@elzevir.fr>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
Message-ID: <4BF646C5.1050709@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Right. Everything except fontenc & euenc was upload like a week ago. I 
> guess
> only luaotfload needs re-uploading.
>   

I think the only thing that needs updating is the static directories 
under windows and linux (taking it from fonts.conf)... I can probably do 
that today (unless someone else wants to do it?)...

Thank you,
-- 
Elie


From arthur.reutenauer at normalesup.org  Fri May 21 12:35:22 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Fri, 21 May 2010 12:35:22 +0200
Subject: [lltx] CTAN release
In-Reply-To: <AANLkTilKvgDPjPjT-uHbJftXjtrtRfXh8LePndZwC9uI@mail.gmail.com>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
	<AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>
	<4BF63DA9.7090203@elzevir.fr>
	<AANLkTilKvgDPjPjT-uHbJftXjtrtRfXh8LePndZwC9uI@mail.gmail.com>
Message-ID: <20100521103522.GE15350@phare.normalesup.org>

> ok, thank you and "in bocca al lupo" for your thesis.

  Crepi il lupo!

From khaledhosny at eglug.org  Fri May 21 14:37:20 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 15:37:20 +0300
Subject: [lltx] [luaotfload] Default mode
In-Reply-To: <20100521122425.GA9933@khaled-laptop>
References: <20100521122425.GA9933@khaled-laptop>
Message-ID: <AANLkTimfrevId6Z_Ua4Py_uRIDeYRCIfEh5n6wuUm4nV@mail.gmail.com>

Currently, the default OpenType processing mode is the very limited
"base" mode, it is supposed to be faster than the more complete "node"
mode, but in practice the speed difference is unnoticeable. Since all
advanced OpenType features (any thing beyond good old TeX ligaturing)
doesn't work in "base" mode, I don't see much point of making it
default.

The only place where "base" is required is math, but I think it is
reasonable to ask users of OpenType math to set mode to "base", not the
other way around.

What do you think?

Regards,
?Khaled

--
?Khaled Hosny
?Arabic localiser and member of Arabeyes.org team
?Free font developer


From khaledhosny at eglug.org  Fri May 21 14:42:27 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 15:42:27 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of \newluatexattribute ?
Message-ID: <20100521123946.GA10050@khaled-laptop>

After spending most of the day debugging why Arabic shaping is broken in
the luaotfload, it turned out to be an attribute issue. The first
allocated attribute by \newluatexattribute is 0 and ConTeXt code don't
seem to like that, it specifically expects attributes used in luaotfload
to be < 255 and > 127.

The problem didn't show before switch to luatexbase, so I expect there
was some change in how \newluatexattribute allocates new attributes.
Also, to avoid any other hidden surprises, is there a way for luaotfload
to assign attributes in the aforementioned range in a way that works
nicely with the attributes package?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Fri May 21 14:45:44 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 21 May 2010 14:45:44 +0200
Subject: [lltx] CTAN release
In-Reply-To: <20100521103522.GE15350@phare.normalesup.org>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>	<4BF63600.5010900@elzevir.fr>	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>	<AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>	<4BF63DA9.7090203@elzevir.fr>	<AANLkTilKvgDPjPjT-uHbJftXjtrtRfXh8LePndZwC9uI@mail.gmail.com>
	<20100521103522.GE15350@phare.normalesup.org>
Message-ID: <4BF68078.1060401@elzevir.fr>

Le 21/05/2010 12:35, Arthur Reutenauer a ?crit :
>> ok, thank you and "in bocca al lupo" for your thesis.
> 
Fortunately, google translator knows of a few expressions, and gave me "bonne
chance" (good luck) as a translation, but...

>   Crepi il lupo!

For this I get "Wolf fissures" (in supposedly French) and "Cracks wolf" in
English :-)

m

From mpg at elzevir.fr  Fri May 21 14:47:09 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 21 May 2010 14:47:09 +0200
Subject: [lltx] [luaotfload] Default mode
In-Reply-To: <AANLkTimfrevId6Z_Ua4Py_uRIDeYRCIfEh5n6wuUm4nV@mail.gmail.com>
References: <20100521122425.GA9933@khaled-laptop>
	<AANLkTimfrevId6Z_Ua4Py_uRIDeYRCIfEh5n6wuUm4nV@mail.gmail.com>
Message-ID: <4BF680CD.4090103@elzevir.fr>

Le 21/05/2010 14:37, Khaled Hosny a ?crit :
> Currently, the default OpenType processing mode is the very limited
> "base" mode, it is supposed to be faster than the more complete "node"
> mode, but in practice the speed difference is unnoticeable. Since all
> advanced OpenType features (any thing beyond good old TeX ligaturing)
> doesn't work in "base" mode, I don't see much point of making it
> default.
> 
I agree. Speed considerations are not important unless it becomes reeeaaaaaaly
sloooow.

> The only place where "base" is required is math, but I think it is
> reasonable to ask users of OpenType math to set mode to "base", not the
> other way around.
> 
> What do you think?
> 
I agree with you.

m

From luigi.scarso at gmail.com  Fri May 21 14:49:41 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 21 May 2010 14:49:41 +0200
Subject: [lltx] CTAN release
In-Reply-To: <4BF68078.1060401@elzevir.fr>
References: <0840EDDF-2053-4450-A906-64831C9508B2@gmail.com>
	<4BF63600.5010900@elzevir.fr>
	<F98E2571-16A0-4DC8-89BB-8D7DF003C2A7@gmail.com>
	<AANLkTinFa3pQ5L6VBVUOmivqmjMVwuG2PjbJE6FUV3mU@mail.gmail.com>
	<4BF63DA9.7090203@elzevir.fr>
	<AANLkTilKvgDPjPjT-uHbJftXjtrtRfXh8LePndZwC9uI@mail.gmail.com>
	<20100521103522.GE15350@phare.normalesup.org>
	<4BF68078.1060401@elzevir.fr>
Message-ID: <AANLkTinOujEKXeDACG5r2jA7bhoJGDtFDrCvvpx2La35@mail.gmail.com>

On Fri, May 21, 2010 at 2:45 PM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Le 21/05/2010 12:35, Arthur Reutenauer a ?crit :
>>> ok, thank you and "in bocca al lupo" for your thesis.
>>
> Fortunately, google translator knows of a few expressions, and gave me "bonne
> chance" (good luck) as a translation, but...
>
>> ? Crepi il lupo!
>
> For this I get "Wolf fissures" (in supposedly French) and "Cracks wolf" in
> English :-)
>
> m
>

http://it.wikipedia.org/wiki/In_bocca_al_lupo

-- 
luigi


From mpg at elzevir.fr  Fri May 21 14:53:30 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 21 May 2010 14:53:30 +0200
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <20100521123946.GA10050@khaled-laptop>
References: <20100521123946.GA10050@khaled-laptop>
Message-ID: <4BF6824A.4050803@elzevir.fr>

Le 21/05/2010 14:42, Khaled Hosny a ?crit :
> After spending most of the day debugging why Arabic shaping is broken in
> the luaotfload, it turned out to be an attribute issue. The first
> allocated attribute by \newluatexattribute is 0 and ConTeXt code don't
> seem to like that, it specifically expects attributes used in luaotfload
> to be < 255 and > 127.
> 
IMHO, it shouldn't expect that. I tend to call that broken, unless someone
provides me with a good explanation.

> The problem didn't show before switch to luatexbase, so I expect there
> was some change in how \newluatexattribute allocates new attributes.

There was a minor change, I don't remember the details right now, but indeed
allocation didn't start at 0 previously for some reason. Since allocation should
be a black box, I didn't expect the change to be noticeable, that's why I didn't
announce it.

> Also, to avoid any other hidden surprises, is there a way for luaotfload
> to assign attributes in the aforementioned range in a way that works
> nicely with the attributes package?
> 
No. I can't see any nice way to to that. Well, if less than 127 attributes have
been allocated, you could allocate dummy attributes up to 127, then start
allocating your attributes. If more than 255 attributes have already been
allocated, there's nothing you can do.

Manuel.

From elie.roux at telecom-bretagne.eu  Fri May 21 14:53:31 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 15:53:31 +0300
Subject: [lltx] [luaotfload] Default mode
In-Reply-To: <4BF680CD.4090103@elzevir.fr>
References: <20100521122425.GA9933@khaled-laptop>	<AANLkTimfrevId6Z_Ua4Py_uRIDeYRCIfEh5n6wuUm4nV@mail.gmail.com>
	<4BF680CD.4090103@elzevir.fr>
Message-ID: <4BF6824B.5090002@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> I agree with you.

I agree too!
-- 
Elie

From khaledhosny at eglug.org  Fri May 21 15:02:54 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 16:02:54 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <4BF6824A.4050803@elzevir.fr>
References: <20100521123946.GA10050@khaled-laptop>
	<4BF6824A.4050803@elzevir.fr>
Message-ID: <20100521130254.GA10524@khaled-laptop>

On Fri, May 21, 2010 at 02:53:30PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 21/05/2010 14:42, Khaled Hosny a ?crit :
> > After spending most of the day debugging why Arabic shaping is broken in
> > the luaotfload, it turned out to be an attribute issue. The first
> > allocated attribute by \newluatexattribute is 0 and ConTeXt code don't
> > seem to like that, it specifically expects attributes used in luaotfload
> > to be < 255 and > 127.
> > 
> IMHO, it shouldn't expect that. I tend to call that broken, unless someone
> provides me with a good explanation.

There are some comments in the code, but basically Hans doesn't allocate
attributes at TeX end, and in lua he reserves ranges for special uses.
The code has a function, attributes.private, that allocates attributes
in this range, but we override it sense it doesn't check if the
attribute is already allocated, our replacement hand allocate attributes
using \newluatexattribute.

> > The problem didn't show before switch to luatexbase, so I expect there
> > was some change in how \newluatexattribute allocates new attributes.
> 
> There was a minor change, I don't remember the details right now, but indeed
> allocation didn't start at 0 previously for some reason. Since allocation should
> be a black box, I didn't expect the change to be noticeable, that's why I didn't
> announce it.

I can work around it by allocating a dummy attribute first if you don't
want to change it back, not a big deal.

> > Also, to avoid any other hidden surprises, is there a way for luaotfload
> > to assign attributes in the aforementioned range in a way that works
> > nicely with the attributes package?
> > 
> No. I can't see any nice way to to that. Well, if less than 127 attributes have
> been allocated, you could allocate dummy attributes up to 127, then start
> allocating your attributes. If more than 255 attributes have already been
> allocated, there's nothing you can do.

OK, I wanted to be on the safe side, but lets just assume there no other
problems beyond the one we just found.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Fri May 21 14:56:04 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 15:56:04 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <20100521123946.GA10050@khaled-laptop>
References: <20100521123946.GA10050@khaled-laptop>
Message-ID: <4BF682E4.8010305@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> After spending most of the day debugging why Arabic shaping is broken in
> the luaotfload, it turned out to be an attribute issue. The first
> allocated attribute by \newluatexattribute is 0 and ConTeXt code don't
> seem to like that, it specifically expects attributes used in luaotfload
> to be < 255 and > 127.
>   

IIRC, ConTeXt doesn't really care about the 127-255 range, whereas it 
really cares about using the attribute 0, that's why I made the first 
attribute 1 in luatextra... What about doing the same in luatexbase? I 
don't think it really hurts anything...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Fri May 21 15:16:06 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 21 May 2010 15:16:06 +0200
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <20100521130254.GA10524@khaled-laptop>
References: <20100521123946.GA10050@khaled-laptop>	<4BF6824A.4050803@elzevir.fr>
	<20100521130254.GA10524@khaled-laptop>
Message-ID: <4BF68796.4040007@elzevir.fr>

Le 21/05/2010 15:02, Khaled Hosny a ?crit :
> On Fri, May 21, 2010 at 02:53:30PM +0200, Manuel P?gouri?-Gonnard wrote:
>> IMHO, it shouldn't expect that. I tend to call that broken, unless someone
>> provides me with a good explanation.
> 
> There are some comments in the code, but basically Hans doesn't allocate
> attributes at TeX end, and in lua he reserves ranges for special uses.
> The code has a function, attributes.private, that allocates attributes
> in this range, but we override it sense it doesn't check if the
> attribute is already allocated, our replacement hand allocate attributes
> using \newluatexattribute.
> 
Ok, thanks for the explanation.

>>> The problem didn't show before switch to luatexbase, so I expect there
>>> was some change in how \newluatexattribute allocates new attributes.
>>
>> There was a minor change, I don't remember the details right now, but indeed
>> allocation didn't start at 0 previously for some reason. Since allocation should
>> be a black box, I didn't expect the change to be noticeable, that's why I didn't
>> announce it.
> 
> I can work around it by allocating a dummy attribute first if you don't
> want to change it back, not a big deal.
> 
If allocating a single dummy attribute can solve the problem, I think is it the
way to go.

>> No. I can't see any nice way to to that. Well, if less than 127 attributes have
>> been allocated, you could allocate dummy attributes up to 127, then start
>> allocating your attributes. If more than 255 attributes have already been
>> allocated, there's nothing you can do.
> 
> OK, I wanted to be on the safe side, but lets just assume there no other
> problems beyond the one we just found.
> 
Code assuming attributes don't start at 0 is probably fairly rare (all other
allocation starts at 0), so I think (hope) it'll be ok this way.

Thanks,
Manuel.

From mpg at elzevir.fr  Fri May 21 15:17:58 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 21 May 2010 15:17:58 +0200
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <4BF682E4.8010305@telecom-bretagne.eu>
References: <20100521123946.GA10050@khaled-laptop>
	<4BF682E4.8010305@telecom-bretagne.eu>
Message-ID: <4BF68806.6070402@elzevir.fr>

Le 21/05/2010 14:56, Elie Roux a ?crit :
> Khaled Hosny a ?crit :
>> After spending most of the day debugging why Arabic shaping is broken in
>> the luaotfload, it turned out to be an attribute issue. The first
>> allocated attribute by \newluatexattribute is 0 and ConTeXt code don't
>> seem to like that, it specifically expects attributes used in luaotfload
>> to be < 255 and > 127.
>>   
> 
> IIRC, ConTeXt doesn't really care about the 127-255 range, whereas it
> really cares about using the attribute 0, that's why I made the first
> attribute 1 in luatextra...

You should have commented that, I thought it was a mistake (it's to easy to get
mixed up with such things).

> What about doing the same in luatexbase? I
> don't think it really hurts anything...
> 
I don't mind either way. But if we do change it un luatexbase, let's documented.

I'm about to leave now, more about that tonight (it'll let me time to think
about it).

Manuel.

From khaledhosny at eglug.org  Fri May 21 15:23:07 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 16:23:07 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <4BF688D7.6010106@telecom-bretagne.eu>
References: <20100521123946.GA10050@khaled-laptop>
	<4BF6824A.4050803@elzevir.fr>
	<20100521130254.GA10524@khaled-laptop>
	<4BF68796.4040007@elzevir.fr>
	<4BF688D7.6010106@telecom-bretagne.eu>
Message-ID: <20100521132307.GA10771@khaled-laptop>

On Fri, May 21, 2010 at 04:21:27PM +0300, Elie Roux wrote:
> Manuel P?gouri?-Gonnard a ?crit :
> >If allocating a single dummy attribute can solve the problem, I think is it the
> >way to go.
> 
> I don't really know how to test it... Khaled, does it solve the problem?

Yup it does (I actually tried it before even posting about the issue).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Fri May 21 15:29:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 16:29:17 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <20100521132307.GA10771@khaled-laptop>
References: <20100521123946.GA10050@khaled-laptop>
	<4BF6824A.4050803@elzevir.fr>
	<20100521130254.GA10524@khaled-laptop>
	<4BF68796.4040007@elzevir.fr>
	<4BF688D7.6010106@telecom-bretagne.eu>
	<20100521132307.GA10771@khaled-laptop>
Message-ID: <4BF68AAD.1020208@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Yup it does (I actually tried it before even posting about the issue).

Ok, I let you push it.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri May 21 15:10:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 16:10:17 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <20100521130254.GA10524@khaled-laptop>
References: <20100521123946.GA10050@khaled-laptop>	<4BF6824A.4050803@elzevir.fr>
	<20100521130254.GA10524@khaled-laptop>
Message-ID: <4BF68639.20809@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I can work around it by allocating a dummy attribute first if you don't
> want to change it back, not a big deal.
>   

That's probably the best idea.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Fri May 21 15:47:58 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 16:47:58 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
Message-ID: <20100521134758.GA11034@khaled-laptop>

Is there going to be support for allocating attributes from lua? Having
to resort to Te to allocate attributes from inside lua code is tricky,
for instance I tried:

tex.sprint(luatexbase.catcodetables.latex, "\\newluatexattribute\\otfldummy")

But it doesn't seem to work, and even if working it seems a bit hacky.
Hiding this inside luatexbse-attr seems more sensible to me.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Fri May 21 15:21:27 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 16:21:27 +0300
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <4BF68796.4040007@elzevir.fr>
References: <20100521123946.GA10050@khaled-laptop>	<4BF6824A.4050803@elzevir.fr>	<20100521130254.GA10524@khaled-laptop>
	<4BF68796.4040007@elzevir.fr>
Message-ID: <4BF688D7.6010106@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> If allocating a single dummy attribute can solve the problem, I think is it the
> way to go.
>   

I don't really know how to test it... Khaled, does it solve the problem?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri May 21 15:50:41 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 21 May 2010 16:50:41 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <20100521134758.GA11034@khaled-laptop>
References: <20100521134758.GA11034@khaled-laptop>
Message-ID: <4BF68FB1.2030407@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Is there going to be support for allocating attributes from lua? Having
> to resort to Te to allocate attributes from inside lua code is tricky,
> for instance I tried:
>
> tex.sprint(luatexbase.catcodetables.latex, "\\newluatexattribute\\otfldummy")
>
> But it doesn't seem to work, and even if working it seems a bit hacky.
> Hiding this inside luatexbse-attr seems more sensible to me.
>   

Although I agree it would be a good thing to be able to allocate 
attributes from lua, in our case it would make perfect sense to allocate 
it like the others in luaotfload.sty...

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Fri May 21 16:29:39 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 21 May 2010 17:29:39 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF68FB1.2030407@telecom-bretagne.eu>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF68FB1.2030407@telecom-bretagne.eu>
Message-ID: <20100521142939.GA11247@khaled-laptop>

On Fri, May 21, 2010 at 04:50:41PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Is there going to be support for allocating attributes from lua? Having
> >to resort to Te to allocate attributes from inside lua code is tricky,
> >for instance I tried:
> >
> >tex.sprint(luatexbase.catcodetables.latex, "\\newluatexattribute\\otfldummy")
> >
> >But it doesn't seem to work, and even if working it seems a bit hacky.
> >Hiding this inside luatexbse-attr seems more sensible to me.
> 
> Although I agree it would be a good thing to be able to allocate
> attributes from lua, in our case it would make perfect sense to
> allocate it like the others in luaotfload.sty...

I agree, I actually wanted to do the other way around; to move all
allocations but this dummy one to lua. Hand allocating all required
attributes doesn't seem to be the best way to me, if the code allocates
them dynamically, so should we.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sat May 22 08:25:24 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 22 May 2010 15:55:24 +0930
Subject: [lltx] mkluatexfontdb tracing
Message-ID: <7FA46F9B-FF4B-423C-B6DD-3EC8CF3F36BE@gmail.com>

Hi,

When I run mkluatexfontdb, I get output that looks like this:

luaotfload | scanning TEXMF fonts:
[=============================================================================>]
luaotfload | scanning OS fonts:
[======================================>                                       ]
luaotfload | error: failed to open /Library/Fonts/NISC18030.ttf
[=========================================================>                    ]
luaotfload | ignoring font '/System/Library/Fonts/LastResort.ttf'
[=============================================================================>]
luaotfload | 619 fonts in the database


I think we probably want to suppress those two info lines, as they're generally not useful to most people. (As neither of these are fonts that anyone is going to want to load.)

I've changed the script to have these conditional to trace_progress.

-- Will



From mpg at elzevir.fr  Sat May 22 11:59:21 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 22 May 2010 11:59:21 +0200
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <20100521134758.GA11034@khaled-laptop>
References: <20100521134758.GA11034@khaled-laptop>
Message-ID: <4BF7AAF9.7010909@elzevir.fr>

Le 21/05/2010 15:47, Khaled Hosny a ?crit :
> Is there going to be support for allocating attributes from lua?

If you're asking for it, I see no reason for not providing it :-) OTOH, it may
require a few changes in the current allocation code, so I don't guarantee a
short delay for implementation.

> Having
> to resort to Te to allocate attributes from inside lua code is tricky,
> for instance I tried:
> 
> tex.sprint(luatexbase.catcodetables.latex, "\\newluatexattribute\\otfldummy")
> 
Yeah, and this won't work in every circumstance (imagine this code is run inside
and \edef, for instance).

> But it doesn't seem to work, and even if working it seems a bit hacky.

Right.

> Hiding this inside luatexbse-attr seems more sensible to me.
> 
Is the following interface ok with you?

luatexbase.newattribute(<string> name)
	- allocates a new attribute
	- stores its number in luatexbase.attributes[name]

While we're at it, would you like a luatexbase.unsetattribute() function?

Manuel.

From elie.roux at telecom-bretagne.eu  Sat May 22 12:09:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 22 May 2010 13:09:17 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF7AAF9.7010909@elzevir.fr>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF7AAF9.7010909@elzevir.fr>
Message-ID: <4BF7AD4D.9010800@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Is the following interface ok with you?
> luatexbase.newattribute(<string> name)
> 	- allocates a new attribute
> 	- stores its number in luatexbase.attributes[name]
>   

I think it could also return the attribute number.

Thank you,
-- 
Elie

From mpg at elzevir.fr  Sat May 22 13:53:42 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 22 May 2010 13:53:42 +0200
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF7AD4D.9010800@telecom-bretagne.eu>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF7AAF9.7010909@elzevir.fr>
	<4BF7AD4D.9010800@telecom-bretagne.eu>
Message-ID: <4BF7C5C6.8080703@elzevir.fr>

Le 22/05/2010 12:09, Elie Roux a ?crit :
> Manuel P?gouri?-Gonnard a ?crit :
>> Is the following interface ok with you?
>> luatexbase.newattribute(<string> name)
>>     - allocates a new attribute
>>     - stores its number in luatexbase.attributes[name]
>>   
> 
> I think it could also return the attribute number.
> 
Agreed.

Manuel.


From khaledhosny at eglug.org  Sat May 22 18:46:05 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 22 May 2010 19:46:05 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF7C5C6.8080703@elzevir.fr>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF7AAF9.7010909@elzevir.fr>
	<4BF7AD4D.9010800@telecom-bretagne.eu>
	<4BF7C5C6.8080703@elzevir.fr>
Message-ID: <20100522164605.GA26880@khaled-laptop>

On Sat, May 22, 2010 at 01:53:42PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 22/05/2010 12:09, Elie Roux a ?crit :
> > Manuel P?gouri?-Gonnard a ?crit :
> >> Is the following interface ok with you?
> >> luatexbase.newattribute(<string> name)
> >>     - allocates a new attribute
> >>     - stores its number in luatexbase.attributes[name]
> >>   
> > 
> > I think it could also return the attribute number.
> > 
> Agreed.

That and the unsetattribute seems fine to me, too.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 23 14:35:27 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 23 May 2010 14:35:27 +0200
Subject: [lltx] [luatexbase] Change in the behaviour of
 \newluatexattribute ?
In-Reply-To: <4BF68806.6070402@elzevir.fr>
References: <20100521123946.GA10050@khaled-laptop>
	<4BF682E4.8010305@telecom-bretagne.eu>
	<4BF68806.6070402@elzevir.fr>
Message-ID: <4BF9210F.50003@elzevir.fr>

Le 21/05/2010 15:17, Manuel P?gouri?-Gonnard a ?crit :
> Le 21/05/2010 14:56, Elie Roux a ?crit :
>> IIRC, ConTeXt doesn't really care about the 127-255 range, whereas it
>> really cares about using the attribute 0, that's why I made the first
>> attribute 1 in luatextra...
> 
> You should have commented that, I thought it was a mistake (it's to easy to get
> mixed up with such things).
> 
Ok, I just checked with a version of luatextra from just before the split. The
first attribute allocated is \attribute2. Was that on purpose?

Anyway, I just changed the allocation code to start from 1 for attributes, and
documented the reason.

Also, I checked catcodetables: they also used to be allocated from 2 with
luatextra, and now start from one (\catcodetable0 is the default catcodetable
loaded an initex time). I don't expect it to have any impact, but since
experience proves unexpected things do happen, now you're informed :-)

Manuel.

From mpg at elzevir.fr  Sun May 23 16:38:15 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 23 May 2010 16:38:15 +0200
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <20100521134758.GA11034@khaled-laptop>
References: <20100521134758.GA11034@khaled-laptop>
Message-ID: <4BF93DD7.6030302@elzevir.fr>

Hi,

I just implemented the following:

- <number> luatexbase.new_attribute(<string> name, <any type> silent = nil)
Allocates a new attribute, without associated TeX CS, and returns the allocated
number. If an error occurs, call error() in silent is false (default) or return
-1 (error handling up to the caller) is silent is true.

- luatexbase.unset_attribute(<string> name)
Unsets the named attribute.

I changed the TeX macros to be wrappers around these functions.

I hope it's what you asked for, otherwise please complain :-)

Manuel.

From mpg at elzevir.fr  Sun May 23 16:40:18 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 23 May 2010 16:40:18 +0200
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF93DD7.6030302@elzevir.fr>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF93DD7.6030302@elzevir.fr>
Message-ID: <4BF93E52.5070301@elzevir.fr>

Le 23/05/2010 16:38, Manuel P?gouri?-Gonnard a ?crit :
> - <number> luatexbase.new_attribute(<string> name, <any type> silent = nil)
> Allocates a new attribute, without associated TeX CS, and returns the allocated
> number. If an error occurs, call error() in silent is false (default) or return
> -1 (error handling up to the caller) is silent is true.
> 
Darn, read "iF silent is" (two times). Baaaad fingers :-/

From khaledhosny at eglug.org  Sun May 23 18:23:06 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 23 May 2010 19:23:06 +0300
Subject: [lltx] mkluatexfontdb tracing
In-Reply-To: <7FA46F9B-FF4B-423C-B6DD-3EC8CF3F36BE@gmail.com>
References: <7FA46F9B-FF4B-423C-B6DD-3EC8CF3F36BE@gmail.com>
Message-ID: <20100523162140.GA4571@khaled-laptop>

On Sat, May 22, 2010 at 03:55:24PM +0930, Will Robertson wrote:
> Hi,
> 
> When I run mkluatexfontdb, I get output that looks like this:
> 
> luaotfload | scanning TEXMF fonts:
> [=============================================================================>]
> luaotfload | scanning OS fonts:
> [======================================>                                       ]
> luaotfload | error: failed to open /Library/Fonts/NISC18030.ttf
> [=========================================================>                    ]
> luaotfload | ignoring font '/System/Library/Fonts/LastResort.ttf'
> [=============================================================================>]
> luaotfload | 619 fonts in the database
> 
> 
> I think we probably want to suppress those two info lines, as they're generally not useful to most people. (As neither of these are fonts that anyone is going to want to load.)

Agreed.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 23 18:24:14 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 23 May 2010 19:24:14 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF93DD7.6030302@elzevir.fr>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF93DD7.6030302@elzevir.fr>
Message-ID: <20100523162414.GB4571@khaled-laptop>

On Sun, May 23, 2010 at 04:38:15PM +0200, Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I just implemented the following:
> 
> - <number> luatexbase.new_attribute(<string> name, <any type> silent = nil)
> Allocates a new attribute, without associated TeX CS, and returns the allocated
> number. If an error occurs, call error() in silent is false (default) or return
> -1 (error handling up to the caller) is silent is true.
> 
> - luatexbase.unset_attribute(<string> name)
> Unsets the named attribute.
> 
> I changed the TeX macros to be wrappers around these functions.
> 
> I hope it's what you asked for, otherwise please complain :-)

Great! I updated luaotfload accordingly.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 23 18:27:00 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 23 May 2010 19:27:00 +0300
Subject: [lltx] [luatexbase] Allocating attributes from lua
In-Reply-To: <4BF93DD7.6030302@elzevir.fr>
References: <20100521134758.GA11034@khaled-laptop>
	<4BF93DD7.6030302@elzevir.fr>
Message-ID: <20100523162414.GB4571@khaled-laptop>

On Sun, May 23, 2010 at 04:38:15PM +0200, Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I just implemented the following:
> 
> - <number> luatexbase.new_attribute(<string> name, <any type> silent = nil)
> Allocates a new attribute, without associated TeX CS, and returns the allocated
> number. If an error occurs, call error() in silent is false (default) or return
> -1 (error handling up to the caller) is silent is true.
> 
> - luatexbase.unset_attribute(<string> name)
> Unsets the named attribute.
> 
> I changed the TeX macros to be wrappers around these functions.
> 
> I hope it's what you asked for, otherwise please complain :-)

Great! I updated luaotfload accordingly.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Tue May 25 10:33:43 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 25 May 2010 18:03:43 +0930
Subject: [lltx] uploading packages
Message-ID: <63D31892-D2B7-4E7B-9FDB-B0C08D984930@gmail.com>

Hi

Now that TL2010 is in pretesting, it's definitely time to upload these packages.

After I take another pass over the fontspec docs tomorrow I'll be ready to upload euenc+fontspec+xltxtra to CTAN.

I tested the latest pushes to luaotfload and everything seems to be working. I would very much rather if people testing TL with fontspec were using the latest version of luaotfload. And Mac users can't use the version of mkluatexfontdb currently on CTAN.

Is luaotfload 1.08 almost ready to be sent to CTAN as well? I'd like to wait until that happens before proceeding with fontspec. 

-- Will



From elie.roux at telecom-bretagne.eu  Tue May 25 14:18:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 25 May 2010 15:18:17 +0300
Subject: [lltx] uploading packages
In-Reply-To: <63D31892-D2B7-4E7B-9FDB-B0C08D984930@gmail.com>
References: <63D31892-D2B7-4E7B-9FDB-B0C08D984930@gmail.com>
Message-ID: <4BFBC009.1010508@telecom-bretagne.eu>

Will Robertson a ?crit :
> I tested the latest pushes to luaotfload and everything seems to be working.
>   

Great!

> Is luaotfload 1.08 almost ready to be sent to CTAN as well? I'd like to wait until that happens before proceeding with fontspec. 
>   

I think we can upload it now, and then reupload it after making some 
improvements on the reading of the font.conf file.

Manual, can you upload it (if everything works on your system)?

Thank you,
-- 
Elie

From wspr81 at gmail.com  Thu May 27 10:29:04 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 27 May 2010 17:59:04 +0930
Subject: [lltx] fontspec v2.0b1 uploaded
Message-ID: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>

Hi,

CTAN has now been sent fontspec v2.0b1 with matching euenc and xltxtra updates. It will hopefully turn up in TeX Live 2010 quite soon.

You know what that means about luaotfload... :)
If you're confident that the current master is functional (my testing doesn't cover fontconfig, remember), I can send in the update if you really insist. As long as `make ctan` is all I need to do...

(I don't understand, Elie, why you asked Manuel to do it when his name isn't even in the package. Are there other lua* packages that also need to be uploaded in sync?)

-- Will



From elie.roux at telecom-bretagne.eu  Thu May 27 10:48:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 27 May 2010 11:48:17 +0300
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
Message-ID: <4BFE31D1.4040408@telecom-bretagne.eu>

Will Robertson a ?crit :
> You know what that means about luaotfload... :)
> If you're confident that the current master is functional (my testing doesn't cover fontconfig, remember), I can send in the update if you really insist. As long as `make ctan` is all I need to do...
>   

I think the current master is functional but quite incomplete, but it 
will satisfy 95% of users, the rest of them will have to wait for an 
update, that will come sunday hopefully.

> (I don't understand, Elie, why you asked Manuel to do it when his name isn't even in the package. Are there other lua* packages that also need to be uploaded in sync?)
>   

lualibs have to be uploaded at the same time, as well as luatexbase, so 
Manuel was quite a good choice, but Khaled could do that too.

Thank you,
-- 
Elie

From mpg at elzevir.fr  Thu May 27 10:55:31 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 27 May 2010 10:55:31 +0200
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
Message-ID: <4BFE3383.3030002@elzevir.fr>

Le 27/05/2010 10:29, Will Robertson a ?crit :
> CTAN has now been sent fontspec v2.0b1 with matching euenc and xltxtra
> updates. It will hopefully turn up in TeX Live 2010 quite soon.
> 
Great, thanks

> (I don't understand, Elie, why you asked Manuel to do it when his name isn't
> even in the package. Are there other lua* packages that also need to be
> uploaded in sync?)
> 
I think current luaotfload needs a current version of luatexbase, since it's
using the new Lua interface to allocate attributes. I just uploaded luatexbase
to ctan (after bumping the version to 0.2a). Here is the Changes entry:

2010/05/27 v0.2a
    attr
        - allocate from 1 to avoid problems with some external code
        - provide a Lua interface: new_attribute() and unset_attribute().
    modutils
        - fix bug with module require_module()-ed many times.
    luatexbase
        - new, loads: compat,loader,regs,attr,cctb.

As previously requested by Khaled, a luatexbase package, loading the other bits,
is provided. Currently it doesn't load modutils nor mcb, since I don't consider
them stable yet, there's a few things I'd still like to discuss about them (more
about that later).

Manuel.


From mpg at elzevir.fr  Thu May 27 10:57:21 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 27 May 2010 10:57:21 +0200
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <4BFE31D1.4040408@telecom-bretagne.eu>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
	<4BFE31D1.4040408@telecom-bretagne.eu>
Message-ID: <4BFE33F1.6050204@elzevir.fr>

Le 27/05/2010 10:48, Elie Roux a ?crit :
> lualibs have to be uploaded at the same time, as well as luatexbase, so
> Manuel was quite a good choice, but Khaled could do that too.
> 
I saw your message just after sending mine. Let's say I'll let Khaled take care
of lualibs and luaotfload.

Thanks for the information,
Manuel.

From wspr81 at gmail.com  Thu May 27 11:01:40 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 27 May 2010 18:31:40 +0930
Subject: [lltx] status of lua-inputenc
Message-ID: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>

Hi,

CTAN contains the following packages:

macros/latex/exptl/lualatex/lua-inputenc/

macros/luatex/latex/luainputenc/

The former was written by Javier Bezos in 2008.
The latter is being currently developed by Elie.

I think having them both there is significantly confusing. Can we organise something to merge the two, at the very least?

-- Will



From arthur.reutenauer at normalesup.org  Thu May 27 11:05:19 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 27 May 2010 11:05:19 +0200
Subject: [lltx] status of lua-inputenc
In-Reply-To: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
Message-ID: <20100527090519.GB5115@phare.normalesup.org>

> The former was written by Javier Bezos in 2008.
> The latter is being currently developed by Elie.

  Don't forget that ?lie's luainputenc used to be called lua-inputenc
until end of 2008 - beginning of 2009 ;-)

	Arthur

From mpg at elzevir.fr  Thu May 27 11:08:41 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 27 May 2010 11:08:41 +0200
Subject: [lltx] status of lua-inputenc
In-Reply-To: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
Message-ID: <4BFE3699.3060901@elzevir.fr>

Le 27/05/2010 11:01, Will Robertson a ?crit :
> CTAN contains the following packages:
> 
> macros/latex/exptl/lualatex/lua-inputenc/
> 
> macros/luatex/latex/luainputenc/
> 
> The former was written by Javier Bezos in 2008.
> The latter is being currently developed by Elie.
> 
> I think having them both there is significantly confusing. Can we organise
> something to merge the two, at the very least?
> 
It is obviously desirable.

But, fwiw, I'd like to add that lua-inputenc is currently not distributed in TL
(most probably due to being in exptl on ctan).

Also, at first glance, after just having a quick look at lua-inputenc's README,
I'm under the impression it is sort of superseded by luainputenc. But of course
we need to check that more thoroughly before taking any decision.

Manuel.

From arthur.reutenauer at normalesup.org  Thu May 27 11:15:52 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 27 May 2010 11:15:52 +0200
Subject: [lltx] status of lua-inputenc
In-Reply-To: <4BFE3699.3060901@elzevir.fr>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
	<4BFE3699.3060901@elzevir.fr>
Message-ID: <20100527091551.GD5115@phare.normalesup.org>

  Javier: the discussion started on the lualatex-dev mailing-list with
you in Cc, but Will, who started the thread, used your old address
@texytipografia.com

> Also, at first glance, after just having a quick look at lua-inputenc's README,
> I'm under the impression it is sort of superseded by luainputenc. But of course
> we need to check that more thoroughly before taking any decision.

  Yes, that was Javier's intention, from what I remember from
discussions with him in September 2008.

	Arthur

From elie.roux at telecom-bretagne.eu  Thu May 27 11:19:03 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 27 May 2010 12:19:03 +0300
Subject: [lltx] status of lua-inputenc
In-Reply-To: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
Message-ID: <4BFE3907.30501@telecom-bretagne.eu>

Will Robertson a ?crit :
> macros/latex/exptl/lualatex/lua-inputenc/
>   

Hello,

This one is deprecated, I thought I asked to remove it, but maybe I 
forgot... Can the CTAN team remove it please?

Thank you,
-- 
Elie

From mpg at elzevir.fr  Thu May 27 11:37:30 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 27 May 2010 11:37:30 +0200
Subject: [lltx] status of lua-inputenc
In-Reply-To: <4BFE3907.30501@telecom-bretagne.eu>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
	<4BFE3907.30501@telecom-bretagne.eu>
Message-ID: <4BFE3D5A.2070000@elzevir.fr>

Le 27/05/2010 11:19, Elie Roux a ?crit :
> Will Robertson a ?crit :
>> macros/latex/exptl/lualatex/lua-inputenc/
>>   
> 
> This one is deprecated, I thought I asked to remove it, but maybe I
> forgot... Can the CTAN team remove it please?
> 
Well, maybe we can wait for Javier's opinion, since he's the author. No need to
hurry here.

m

From khaledhosny at eglug.org  Thu May 27 13:24:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 27 May 2010 14:24:49 +0300
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <4BFE33F1.6050204@elzevir.fr>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
	<4BFE31D1.4040408@telecom-bretagne.eu>
	<4BFE33F1.6050204@elzevir.fr>
Message-ID: <20100527112449.GA13041@khaled-laptop>

On Thu, May 27, 2010 at 10:57:21AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 27/05/2010 10:48, Elie Roux a ?crit :
> > lualibs have to be uploaded at the same time, as well as luatexbase, so
> > Manuel was quite a good choice, but Khaled could do that too.
> > 
> I saw your message just after sending mine. Let's say I'll let Khaled take care
> of lualibs and luaotfload.

Since I never uploaded any of those packages to CTAN, I'm not sure what
I'm supposed to do.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From Robin.Fairbairns at cl.cam.ac.uk  Thu May 27 12:35:45 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 27 May 2010 11:35:45 +0100
Subject: [lltx] status of lua-inputenc
In-Reply-To: Your message of Thu, 27 May 2010 12:19:03 +0300.
	<4BFE3907.30501@telecom-bretagne.eu>
Message-ID: <24475.1274956545@cl.cam.ac.uk>

Elie Roux <elie.roux at telecom-bretagne.eu> wrote:

> Will Robertson a ?crit :
> > macros/latex/exptl/lualatex/lua-inputenc/
> 
> This one is deprecated, I thought I asked to remove it, but maybe I
> forgot... Can the CTAN team remove it please?

it's history (modulo mirroring delays).

i don't remember being asked to remove it, and finding any request would
be a "challenge" which i cba to undertake ;-)

robin


From listas at tex-tipografia.com  Thu May 27 14:30:14 2010
From: listas at tex-tipografia.com (Javier Bezos)
Date: Thu, 27 May 2010 14:30:14 +0200
Subject: [lltx] status of lua-inputenc
In-Reply-To: <4BFE3D5A.2070000@elzevir.fr>
References: <1205AF20-AB11-4695-9008-E9B8C82EBDFE@gmail.com>
	<4BFE3907.30501@telecom-bretagne.eu> <4BFE3D5A.2070000@elzevir.fr>
Message-ID: <4BFE65D6.9080002@tex-tipografia.com>


>>> macros/latex/exptl/lualatex/lua-inputenc/
>>>   ...
>> forgot... Can the CTAN team remove it please?
>>  
> Well, maybe we can wait for Javier's opinion, 

Remove it. There is a replacement and it can lead to
confusion (in fact, I thought it was already removed).

Cheers
Javier


From elie.roux at telecom-bretagne.eu  Thu May 27 15:14:10 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 27 May 2010 16:14:10 +0300
Subject: [lltx] status of lua-inputenc
In-Reply-To: <24475.1274956545@cl.cam.ac.uk>
References: <24475.1274956545@cl.cam.ac.uk>
Message-ID: <4BFE7022.1050907@telecom-bretagne.eu>

Robin Fairbairns a ?crit :
> i don't remember being asked to remove it, and finding any request would
> be a "challenge" which i cba to undertake ;-)

Attached is my mail dated 15/02/2009 11:09, subject: "suppressing 
latex/exptl/lualatex/lua-inputenc". Could it be that this mail got lost?

Thank you,
-- 
Elie

-------------- next part --------------
An embedded message was scrubbed...
From: Elie Roux <elie.roux at telecom-bretagne.eu>
Subject: suppressing latex/exptl/lualatex/lua-inputenc 
Date: Sun, 15 Feb 2009 10:09:40 +0100
Size: 738
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100527/0c360b49/attachment.eml>

From mpg at elzevir.fr  Fri May 28 09:27:12 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Fri, 28 May 2010 09:27:12 +0200
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <20100527112449.GA13041@khaled-laptop>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>	<4BFE31D1.4040408@telecom-bretagne.eu>	<4BFE33F1.6050204@elzevir.fr>
	<20100527112449.GA13041@khaled-laptop>
Message-ID: <4BFF7050.5040509@elzevir.fr>

Le 27/05/2010 13:24, Khaled Hosny a ?crit :
> On Thu, May 27, 2010 at 10:57:21AM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 27/05/2010 10:48, Elie Roux a ?crit :
>>> lualibs have to be uploaded at the same time, as well as luatexbase, so
>>> Manuel was quite a good choice, but Khaled could do that too.
>>>
>> I saw your message just after sending mine. Let's say I'll let Khaled take care
>> of lualibs and luaotfload.
> 
> Since I never uploaded any of those packages to CTAN, I'm not sure what
> I'm supposed to do.
> 
Well, make ctan should work (check this by examining the output of unzip -l
<name>.tds.zip), then you can upload <name>.zip to a CTAN node, either
- using the web form, or
- by ftp using the incoming directory of the UK node and sending a mail to Robin
stating whether you want the change announced, and providing an announcement
text if needed.

Before doing so, you may want to update the NEWS file of the package, bump the
version number, make a git tag, etc. That's I prefer you (or ?lie or... not me
anyway) do it: I'd feel uncomfortable editing the NEWS file for lualibs, I don't
even know what's new and why a newer version is needed by luaotfload...

Thanks,
Manuel.

From khaledhosny at eglug.org  Fri May 28 15:41:05 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 28 May 2010 16:41:05 +0300
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <4BFF7050.5040509@elzevir.fr>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>
	<4BFE31D1.4040408@telecom-bretagne.eu>
	<4BFE33F1.6050204@elzevir.fr>
	<20100527112449.GA13041@khaled-laptop>
	<4BFF7050.5040509@elzevir.fr>
Message-ID: <20100528134104.GA2216@khaled-laptop>

On Fri, May 28, 2010 at 09:27:12AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 27/05/2010 13:24, Khaled Hosny a ?crit :
> > On Thu, May 27, 2010 at 10:57:21AM +0200, Manuel P?gouri?-Gonnard wrote:
> >> Le 27/05/2010 10:48, Elie Roux a ?crit :
> >>> lualibs have to be uploaded at the same time, as well as luatexbase, so
> >>> Manuel was quite a good choice, but Khaled could do that too.
> >>>
> >> I saw your message just after sending mine. Let's say I'll let Khaled take care
> >> of lualibs and luaotfload.
> > 
> > Since I never uploaded any of those packages to CTAN, I'm not sure what
> > I'm supposed to do.
> > 
> Well, make ctan should work (check this by examining the output of unzip -l
> <name>.tds.zip), then you can upload <name>.zip to a CTAN node, either
> - using the web form, or
> - by ftp using the incoming directory of the UK node and sending a mail to Robin
> stating whether you want the change announced, and providing an announcement
> text if needed.
> 
> Before doing so, you may want to update the NEWS file of the package, bump the
> version number, make a git tag, etc. That's I prefer you (or ?lie or... not me
> anyway) do it: I'd feel uncomfortable editing the NEWS file for lualibs, I don't
> even know what's new and why a newer version is needed by luaotfload...

Thanks for the info, I uploaded both now, lets hope every thing is OK.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sat May 29 11:49:52 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 29 May 2010 11:49:52 +0200
Subject: [lltx] fontspec v2.0b1 uploaded
In-Reply-To: <20100528134104.GA2216@khaled-laptop>
References: <14CE6236-38E4-4081-8C02-333607742709@gmail.com>	<4BFE31D1.4040408@telecom-bretagne.eu>	<4BFE33F1.6050204@elzevir.fr>	<20100527112449.GA13041@khaled-laptop>	<4BFF7050.5040509@elzevir.fr>
	<20100528134104.GA2216@khaled-laptop>
Message-ID: <4C00E340.6020805@elzevir.fr>

Le 28/05/2010 15:41, Khaled Hosny a ?crit :
> Thanks for the info, I uploaded both now, lets hope every thing is OK.
> 
I just installed them in TL, so they should be in tonight's build. I also added
the link to mkluatexfontdb in bin, since it seems we forgot to do so earlier.

Manuel.

From wspr81 at gmail.com  Sun May 30 04:23:57 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 11:53:57 +0930
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
References: <127518234726231200000437@sniffer>
Message-ID: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>

Hi Elie, etc.,

I assume you're monitoring the tex-live list, but just in case not, see below.

I'm not exactly sure where the check for this should go.

Would it be enough to replace

        path = kpse.readable_file(path)

by
        path = kpse.readable_file(path) or ""

?

(I'm afraid I can't test this code path since I don't have a windows box.)

Cheers,
Will


Begin forwarded message:

> From: "Akira Kakuto" <kakuto at fuk.kindai.ac.jp>
> Date: 30 May 2010 10:49:07 AM ACST
> To: Will Robertson <wspr81 at gmail.com>
> Cc: List MacTeX <mactex at tug.org>, TeX Live <tex-live at tug.org>
> Subject: Re: [tex-live] fontspec for LuaTeX
> 
> Hi Will,
> 
>> Any testing you could perform would be greatly appreciated,
>> especially running the mkluatexfontdb script in the luaotfload
>> package and then attempting to access system fonts in LuaLaTeX
>> with fontspec. 
> 
> In my test on windows, mkluatexfontdb failed at
> 
> otfl-font-nms.lua:487: attempt to index local 'path' (a nil value)
> 
> line 486 is
>        path = kpse.readable_file(path)
> 
> Note that kpse.readable_file(path) returns a nil value if
> path is a directory. In my case the path was a directory
> "destdir" for the command line:
> 
> mkluatexfontdb --database-dir=destdir
> 
> Thanks,
> Akira
> 
> 
> 

-- Will



From wspr81 at gmail.com  Sun May 30 06:37:42 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 14:07:42 +0930
Subject: [lltx] [tex-live] fontspec for LuaTeX
In-Reply-To: <127519271342689700000669@sniffer>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127519271342689700000669@sniffer>
Message-ID: <BC710A5D-C029-4DB6-BE9B-C50588D7BCD5@gmail.com>

On 30/05/2010, at 1:41 PM, Akira Kakuto wrote:

> If I search all directories, mkluatexfontdb exits silently
> after parsing all fonts, without the above message,
> and the database is empty.
> 
> Is there any restriction on the total number of fonts?

That is strange. I'm not really the one to ask; I've only messed around inside the script enough to get it working on Mac OS X. There shouldn't be any restrictions, but clearly the script is getting stuck on something.

Does anyone else have any ideas?

(Good to hear it's working to some extent, however -- have you tried a basic LuaLaTeX document to see if the fonts are able to be used in fontspec?)

-- Will



From wspr81 at gmail.com  Sun May 30 12:04:21 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 19:34:21 +0930
Subject: [lltx] bleeding edge makefile
Message-ID: <6880833E-B1A4-45CA-966A-E5FF1968B07A@gmail.com>

Hi,

I hate updating packages by hand. Here's a makefile to keep all the lualatex packages on the bleeding edge: (assuming it's in a parallel folder to where you've cloned all the packages)

PKG = luainputenc lualibs luamplib luaotfload luatexbase luatextra fontspec

all: $(PKG)

$(PKG):
	cd ../$@; git pull && make install TEXMFROOT=~/Library/texmf/

luatex:
	rsync -rvzctlp rsync://contextgarden.net/minimals/current/bin/luatex/osx-intel/bin/ ~/bin/luatex
	sudo cp ~/bin/luatex/luatex /usr/texbin/luatex
	sudo fmtutil-sys --byengine luatex


-- Will



From wspr81 at gmail.com  Sun May 30 12:12:51 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 19:42:51 +0930
Subject: [lltx] luaotfload bug?
Message-ID: <FCE4A623-86FF-4FC7-901C-F122A7AE32B7@gmail.com>

Hi,

Haven't looked into it, but here's what the bleeding edge reports (it's a fontspec example document):


/Users/will/Library/texmf/tex/luatex/luaotfload/luaotfload.sty:47: LuaTeX error
 ...ill/Library/texmf/tex/luatex/luatexbase/modutils.lua:56: module 'luaotfload
' not found:
	no field package.preload['luaotfload']
	[luatexbase.loader] Loading error:
	/Users/will/Library/texmf/tex/luatex/luaotfload/luaotfload.lua:23: malformed n
umber near '1.08a'
	[kpse C searcher] file not found: 'luaotfload'
stack traceback:
	[C]: in function 'require'
	...ill/Library/texmf/tex/luatex/luatexbase/modutils.lua:56: in function 'use_m
odule'
	<\directlua >:1: in main chunk.
\luatexUseModule ...\luatexluaescapestring {#1}")}
                                                  
l.47 \luatexUseModule{luaotfload}


Seems to be a problem with luaotfload. The v1.08 tag is okay.
I might have time to look at this later tonight.
But maybe not.

-- Will



From wspr81 at gmail.com  Sun May 30 14:01:41 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 21:31:41 +0930
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
Message-ID: <E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>

Dear all,

Several issues below; I'll investigate some as best I can.
I'll cc my own reply to this list.

Manuel, is the symlink issue for 64-bit Mac binaries a TL problem? Can you fix that?

Secondly, same thing for alt_getopt ?

W

Begin forwarded message:

> From: Bruno Voisin <bvoisin at me.com>
> Date: 30 May 2010 9:02:45 PM ACST
> To: "MacOS X and TeX." <mactex at tug.org>
> Subject: Re: [MacTeX] fontspec for LuaTeX
> Reply-To: "MacOS X and TeX." <mactex at tug.org>
> 
> Le 29 mai 2010 ? 10:14, Will Robertson a ?crit :
> 
>> Any testing you could perform would be greatly appreciated, especially running the mkluatexfontdb script in the luaotfload package and then attempting to access system fonts in LuaLaTeX with fontspec.
> 
> It took some steps to reach that point:
> 
> 
> - First problem: there is no mkluatexfontdb symlink in /usr/local/texlive/2010/bin/x86_64-darwin, only in /usr/local/texlive/2010/bin/universal-darwin. I had to switch from TeXLive-2010-64 to TeXLive-2010 in the TeX Dist system pref panel for mkluatexfontdb to be found.
> 
> 
> - Second, more serious problem:
> 
> 	theo9mc182:~ bvoisin$ mkluatexfontdb --help
> 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
> 		no field package.preload['alt_getopt']
> 		[kpse lua searcher] file not found: 'alt_getopt'
> 	[kpse C searcher] file not found: 'alt_getopt'
> 	
> Noticing there is a /usr/local/texlive/2010/texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua, I tried to create a symlink apt_getopt to it in /usr/texbin but that didn't improve things
> 
> 	theo9mc182:universal-darwin bvoisin$ cd /usr/texbin
> 	theo9mc182:texbin bvoisin$ sudo ln -s ../../texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua alt_getopt
> 	Password:
> 	theo9mc182:texbin bvoisin$ mkluatexfontdb --help
> 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
> 		no field package.preload['alt_getopt']
> 		[kpse lua searcher] file not found: 'alt_getopt'
> 		[kpse C searcher] file not found: 'alt_getopt'
> 
> Calling the symlink alt_getopt.lua did work:
> 
> 	theo9mc182:texbin bvoisin$ sudo ln -s ../../texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua alt_getopt.lua
> 	Password:
> 	theo9mc182:texbin bvoisin$ mkluatexfontdb --help
> 	Usage: mkluatexfontdb [OPTION]...
> 	[...]
> 	theo9mc182:texbin bvoisin$ sudo mkluatexfontdb -vv
> 	
> 	luaotfload | generating font names database.
> 	[...]
> 
> 
> The total output is included below, in case that can be of any help.
> 
> A couple of thoughts:
> 
> 
> - The same problem as with updmap vs updmap-sys remains, apparently, but it's even worse: if you want to make fonts known to LuaLaTeX system-wise, I thought you'd run
> 
> 	sudo -H mklualatexfontdb
> 
> But in this case (I tried) the font database is created in /var/root/.texlive2010/texmf-var, which won't be used unless you're logged in as root I imagine. Shouldn't /usr/texlive/2010/texmf-var be used instead?
> 
> And if you run either of
> 
> 	sudo mkluatexfontdb
> 	mkluatexfontdb
> 
> the font database is created in ~/.texlive2010/texmf-var, ie for a given user only.
> 
> With that in mind, I think there should be two versions of mkluatexfontdb: one, the current one, using $TEXMFVAR for output, and the other, mkluatexfontdb-sys, using $TEXMFSYSVAR so that the LuaTeX font database can be created system-wise, not account-by-account.
> 
> 
> - What happens with font duplicates? For example OS X contains the usual Microsoft Office fonts in .ttf format in /Library/Fonts, but upon installation Office installs its own versions, often in old FFIL suitcase format, in /Library/Fonts/Microsoft. I resolved the duplicates manually in Font Book by disactivating the Microsoft versions, but what happens with mkluatexfontdb?
> 
> In otfl-names.lua I noticed
> 
> 	  {
> 	   ["familyname"]="Verdana",
> 	   ["filename"]={ "/Library/Fonts/Verdana.ttf", false },
> 	   ["fontname"]="Verdana",
> 	   ["fullname"]="Verdana",
> 	   ["names"]={
> 	    ["family"]="Verdana",
> 	    ["fullname"]="Verdana",
> 	    ["psname"]="Verdana",
> 	    ["subfamily"]="Regular",
> 	   },
> 	   ["size"]={},
> 	   ["slant"]=0,
> 	   ["weight"]=400,
> 	   ["width"]=5,
> 	  },
> 
> 	  ["/Library/Fonts/Verdana.ttf"]={
> 	   ["index"]={ 654 },
> 	   ["timestamp"]=1247723022,
> 	  },
> 
> Does this mean subdirs of
> 
>    ~/Library/Fonts          /Library/Fonts
>    /System/Library/Fonts    /Network/Library/Fonts
> 
> aren't searched? If so, that would mean things would work differently as for OS X (hence XeLaTeX) which does see fonts in subdirs of these.
> 
> The same duplicate problem would occur for us OSXers who install (as the MacTeX package allows optionally) the OpenType versions of the Latin Modern and TeX Gyre fonts in
> 
> 	/Library/Fonts/Latin Modern
> 	/Library/Fonts/TeX Gyre
> 
> (ie duplicates there and in /usr/local/texlive/2010/texmf-dist/fonts/opentype/public).
> 
> 
> Finally I tried to typeset in LuaLaTeX a document written for XeLaTeX and using Verdana as its main font. Didn't work:
> 
> 	/usr/local/texlive/2010/texmf-dist/tex/luatex/luaotfload/luaotfload.sty:47: Lua
> 	TeX error ...e/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua:56: module 'l
> 	uaotfload' not found:
> 		no field package.preload['luaotfload']
> 		[luatexbase.loader] Loading error:
> 		/usr/local/texlive/2010/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:23: ma
> 	lformed number near '1.08a'
> 		[kpse C searcher] file not found: 'luaotfload'
> 		[oberdiek.luatex.kpse_module_loader] Search failed
> 	stack traceback:
> 		[C]: in function 'require'
> 		...e/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua:56: in function 'use_m
> 	odule'
> 		<\directlua >:1: in main chunk.
> 	\luatexUseModule ...\luatexluaescapestring {#1}")}
> 
> and I gave up there.
> 
> Bruno
> 
> 
> 
> theo9mc182:texbin bvoisin$ sudo mkluatexfontdb -vv
> 
> luaotfload | generating font names database.
> luaotfload | creating directory /Users/bvoisin/.texlive2010/texmf-var/luatex/generic/luaotfload/names
> luaotfload | no font names database or old one found, generating new one
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype'
> luaotfload | 330 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 330 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype'
> luaotfload | loading font: LibrisADFStd-Bold.otf
> luaotfload | loading font: LibrisADFStd-BoldItalic.otf
> luaotfload | loading font: LibrisADFStd-Italic.otf
> luaotfload | loading font: LibrisADFStd-Regular.otf
> luaotfload | loading font: VenturisADF-Bold.otf
> luaotfload | loading font: VenturisADF-BoldItalic.otf
> luaotfload | loading font: VenturisADF-Italic.otf
> luaotfload | loading font: VenturisADF-Regular.otf
> luaotfload | loading font: VenturisADFCd-Bold.otf
> luaotfload | loading font: VenturisADFCd-BoldItalic.otf
> luaotfload | loading font: VenturisADFCd-Italic.otf
> luaotfload | loading font: VenturisADFCd-Regular.otf
> luaotfload | loading font: VenturisADFCdStyle-BdItalic.otf
> luaotfload | loading font: VenturisADFCdStyle-Bold.otf
> luaotfload | loading font: VenturisADFCdStyle-Italic.otf
> luaotfload | loading font: VenturisADFCdStyle-Regular.otf
> luaotfload | loading font: VenturisADFHeavy-Italic.otf
> luaotfload | loading font: VenturisADFHeavy.otf
> luaotfload | loading font: VenturisADFStyle-Bold.otf
> luaotfload | loading font: VenturisADFStyle-BoldItalic.otf
> luaotfload | loading font: VenturisADFStyle-Italic.otf
> luaotfload | loading font: VenturisADFStyle-Regular.otf
> luaotfload | loading font: VenturisADFTitlingNo2.otf
> luaotfload | loading font: VenturisADFTitlingNo4.otf
> luaotfload | loading font: VenturisADFNo2-Bold.otf
> luaotfload | loading font: VenturisADFNo2-BoldItalic.otf
> luaotfload | loading font: VenturisADFNo2-Italic.otf
> luaotfload | loading font: VenturisADFNo2-Regular.otf
> luaotfload | loading font: VenturisADFNo2Cd-Bold.otf
> luaotfload | loading font: VenturisADFNo2Cd-BoldItalic.otf
> luaotfload | loading font: VenturisADFNo2Cd-Italic.otf
> luaotfload | loading font: VenturisADFNo2Cd-Regular.otf
> luaotfload | loading font: VenturisADFNo2Med-BdItalic.otf
> luaotfload | loading font: VenturisADFNo2Med-Bold.otf
> luaotfload | loading font: VenturisADFNo2Med-Italic.otf
> luaotfload | loading font: VenturisADFNo2Med-Regular.otf
> luaotfload | loading font: VenturisADFGothTitling.otf
> luaotfload | loading font: VenturisOldADF-Bold.otf
> luaotfload | loading font: VenturisOldADF-BoldItalic.otf
> luaotfload | loading font: VenturisOldADF-Italic.otf
> luaotfload | loading font: VenturisOldADF-Regular.otf
> luaotfload | loading font: VenturisADFTitlingNo1.otf
> luaotfload | loading font: VenturisADFTitlingNo3.otf
> luaotfload | loading font: VenturisSansADF-Bold.otf
> luaotfload | loading font: VenturisSansADF-BoldItalic.otf
> luaotfload | loading font: VenturisSansADF-Italic.otf
> luaotfload | loading font: VenturisSansADF-Regular.otf
> luaotfload | loading font: VenturisSansADFCd-BdItalic.otf
> luaotfload | loading font: VenturisSansADFCd-Bold.otf
> luaotfload | loading font: VenturisSansADFCd-Italic.otf
> luaotfload | loading font: VenturisSansADFCd-Regular.otf
> luaotfload | loading font: VenturisSansADFEx-BdItalic.otf
> luaotfload | loading font: VenturisSansADFEx-Bold.otf
> luaotfload | loading font: VenturisSansADFEx-Italic.otf
> luaotfload | loading font: VenturisSansADFEx-Regular.otf
> luaotfload | loading font: VenturisSansADFHeavy.otf
> luaotfload | loading font: VenturisSansADFHv-Oblique.otf
> luaotfload | loading font: VenturisSansADFLt-BdItalic.otf
> luaotfload | loading font: VenturisSansADFLt-Bold.otf
> luaotfload | loading font: VenturisSansADFLt-Italic.otf
> luaotfload | loading font: VenturisSansADFLt-Regular.otf
> luaotfload | loading font: VenturisSansADFNo2-BdItalic.otf
> luaotfload | loading font: VenturisSansADFNo2-Bold.otf
> luaotfload | loading font: VenturisSansADFNo2-Italic.otf
> luaotfload | loading font: VenturisSansADFNo2-Regular.otf
> luaotfload | loading font: VenturisSansADFNo2Cd-BdItal.otf
> luaotfload | loading font: VenturisSansADFNo2Cd-Bold.otf
> luaotfload | loading font: VenturisSansADFNo2Cd-Italic.otf
> luaotfload | loading font: VenturisSansADFNo2Cd-Rg.otf
> luaotfload | loading font: VenturisSansADFNo2Ex-BdItal.otf
> luaotfload | loading font: VenturisSansADFNo2Ex-Bold.otf
> luaotfload | loading font: VenturisSansADFNo2Ex-Italic.otf
> luaotfload | loading font: VenturisSansADFNo2Ex-Rg.otf
> luaotfload | loading font: AntykwaTorunska-Bold.otf
> luaotfload | loading font: AntykwaTorunska-BoldItalic.otf
> luaotfload | loading font: AntykwaTorunska-Italic.otf
> luaotfload | loading font: AntykwaTorunska-Regular.otf
> luaotfload | loading font: AntykwaTorunskaCond-Bold.otf
> luaotfload | loading font: AntykwaTorunskaCond-BoldItalic.otf
> luaotfload | loading font: AntykwaTorunskaCond-Italic.otf
> luaotfload | loading font: AntykwaTorunskaCond-Regular.otf
> luaotfload | loading font: AntykwaTorunskaCondLight-Italic.otf
> luaotfload | loading font: AntykwaTorunskaCondLight-Regular.otf
> luaotfload | loading font: AntykwaTorunskaCondMed-Italic.otf
> luaotfload | loading font: AntykwaTorunskaCondMed-Regular.otf
> luaotfload | loading font: AntykwaTorunskaLight-Italic.otf
> luaotfload | loading font: AntykwaTorunskaLight-Regular.otf
> luaotfload | loading font: AntykwaTorunskaMed-Italic.otf
> luaotfload | loading font: AntykwaTorunskaMed-Regular.otf
> luaotfload | loading font: Asana-Math.otf
> luaotfload | loading font: cyklop-italic.otf
> luaotfload | loading font: cyklop-regular.otf
> luaotfload | loading font: GFSArtemisia.otf
> luaotfload | loading font: GFSArtemisiaBold.otf
> luaotfload | loading font: GFSArtemisiaBoldIt.otf
> luaotfload | loading font: GFSArtemisiaIt.otf
> luaotfload | loading font: GFSBaskerville.otf
> luaotfload | loading font: GFSBodoni.otf
> luaotfload | loading font: GFSBodoniBold.otf
> luaotfload | loading font: GFSBodoniBoldIt.otf
> luaotfload | loading font: GFSBodoniIt.otf
> luaotfload | loading font: GFSPolyglot.otf
> luaotfload | loading font: GFSDidot.otf
> luaotfload | loading font: GFSDidotBold.otf
> luaotfload | loading font: GFSDidotBoldItalic.otf
> luaotfload | loading font: GFSDidotItalic.otf
> luaotfload | loading font: GFSOlga.otf
> luaotfload | loading font: GFSNeohellenic.otf
> luaotfload | loading font: GFSNeohellenicBold.otf
> luaotfload | loading font: GFSNeohellenicBoldIt.otf
> luaotfload | loading font: GFSNeohellenicIt.otf
> luaotfload | loading font: GFSPorson.otf
> luaotfload | loading font: GFSSolomos.otf
> luaotfload | loading font: FreeMono.otf
> luaotfload | loading font: FreeMonoBold.otf
> luaotfload | loading font: FreeMonoBoldOblique.otf
> luaotfload | loading font: FreeMonoOblique.otf
> luaotfload | loading font: FreeSans.otf
> luaotfload | loading font: FreeSansBold.otf
> luaotfload | loading font: FreeSansBoldOblique.otf
> luaotfload | loading font: FreeSansOblique.otf
> luaotfload | loading font: FreeSerif.otf
> luaotfload | loading font: FreeSerifBold.otf
> luaotfload | loading font: FreeSerifBoldItalic.otf
> luaotfload | loading font: FreeSerifItalic.otf
> luaotfload | loading font: Inconsolata.otf
> luaotfload | loading font: Iwona-Bold.otf
> luaotfload | loading font: Iwona-BoldItalic.otf
> luaotfload | loading font: Iwona-Italic.otf
> luaotfload | loading font: Iwona-Regular.otf
> luaotfload | loading font: IwonaCond-Bold.otf
> luaotfload | loading font: IwonaCond-BoldItalic.otf
> luaotfload | loading font: IwonaCond-Italic.otf
> luaotfload | loading font: IwonaCond-Regular.otf
> luaotfload | loading font: IwonaCondHeavy-Italic.otf
> luaotfload | loading font: IwonaCondHeavy-Regular.otf
> luaotfload | loading font: IwonaCondLight-Italic.otf
> luaotfload | loading font: IwonaCondLight-Regular.otf
> luaotfload | loading font: IwonaCondMedium-Italic.otf
> luaotfload | loading font: IwonaCondMedium-Regular.otf
> luaotfload | loading font: IwonaHeavy-Italic.otf
> luaotfload | loading font: IwonaHeavy-Regular.otf
> luaotfload | loading font: IwonaLight-Italic.otf
> luaotfload | loading font: IwonaLight-Regular.otf
> luaotfload | loading font: IwonaMedium-Italic.otf
> luaotfload | loading font: IwonaMedium-Regular.otf
> luaotfload | loading font: Kurier-Bold.otf
> luaotfload | loading font: Kurier-BoldItalic.otf
> luaotfload | loading font: Kurier-Italic.otf
> luaotfload | loading font: Kurier-Regular.otf
> luaotfload | loading font: KurierCond-Bold.otf
> luaotfload | loading font: KurierCond-BoldItalic.otf
> luaotfload | loading font: KurierCond-Italic.otf
> luaotfload | loading font: KurierCond-Regular.otf
> luaotfload | loading font: KurierCondHeavy-Italic.otf
> luaotfload | loading font: KurierCondHeavy-Regular.otf
> luaotfload | loading font: KurierCondLight-Italic.otf
> luaotfload | loading font: KurierCondLight-Regular.otf
> luaotfload | loading font: KurierCondMedium-Italic.otf
> luaotfload | loading font: KurierCondMedium-Regular.otf
> luaotfload | loading font: KurierHeavy-Italic.otf
> luaotfload | loading font: KurierHeavy-Regular.otf
> luaotfload | loading font: KurierLight-Italic.otf
> luaotfload | loading font: KurierLight-Regular.otf
> luaotfload | loading font: KurierMedium-Italic.otf
> luaotfload | loading font: KurierMedium-Regular.otf
> luaotfload | loading font: fxbb.otf
> luaotfload | loading font: fxbbo.otf
> luaotfload | loading font: fxbk.otf
> luaotfload | loading font: fxbo.otf
> luaotfload | loading font: fxbob.otf
> luaotfload | loading font: fxboi.otf
> luaotfload | loading font: fxbr.otf
> luaotfload | loading font: fxbri.otf
> luaotfload | loading font: fxbro.otf
> luaotfload | loading font: fxbs.otf
> luaotfload | loading font: fxbsb.otf
> luaotfload | loading font: fxbsi.otf
> luaotfload | loading font: fxlb.otf
> luaotfload | loading font: fxlbi.otf
> luaotfload | loading font: fxlbo.otf
> luaotfload | loading font: fxlr.otf
> luaotfload | loading font: fxlri.otf
> luaotfload | loading font: fxlro.otf
> luaotfload | loading font: lmmono10-italic.otf
> luaotfload | loading font: lmmono10-regular.otf
> luaotfload | loading font: lmmono12-regular.otf
> luaotfload | loading font: lmmono8-regular.otf
> luaotfload | loading font: lmmono9-regular.otf
> luaotfload | loading font: lmmonocaps10-oblique.otf
> luaotfload | loading font: lmmonocaps10-regular.otf
> luaotfload | loading font: lmmonolt10-bold.otf
> luaotfload | loading font: lmmonolt10-boldoblique.otf
> luaotfload | loading font: lmmonolt10-oblique.otf
> luaotfload | loading font: lmmonolt10-regular.otf
> luaotfload | loading font: lmmonoltcond10-oblique.otf
> luaotfload | loading font: lmmonoltcond10-regular.otf
> luaotfload | loading font: lmmonoprop10-oblique.otf
> luaotfload | loading font: lmmonoprop10-regular.otf
> luaotfload | loading font: lmmonoproplt10-bold.otf
> luaotfload | loading font: lmmonoproplt10-boldoblique.otf
> luaotfload | loading font: lmmonoproplt10-oblique.otf
> luaotfload | loading font: lmmonoproplt10-regular.otf
> luaotfload | loading font: lmmonoslant10-regular.otf
> luaotfload | loading font: lmroman10-bold.otf
> luaotfload | loading font: lmroman10-bolditalic.otf
> luaotfload | loading font: lmroman10-italic.otf
> luaotfload | loading font: lmroman10-regular.otf
> luaotfload | loading font: lmroman12-bold.otf
> luaotfload | loading font: lmroman12-italic.otf
> luaotfload | loading font: lmroman12-regular.otf
> luaotfload | loading font: lmroman17-regular.otf
> luaotfload | loading font: lmroman5-bold.otf
> luaotfload | loading font: lmroman5-regular.otf
> luaotfload | loading font: lmroman6-bold.otf
> luaotfload | loading font: lmroman6-regular.otf
> luaotfload | loading font: lmroman7-bold.otf
> luaotfload | loading font: lmroman7-italic.otf
> luaotfload | loading font: lmroman7-regular.otf
> luaotfload | loading font: lmroman8-bold.otf
> luaotfload | loading font: lmroman8-italic.otf
> luaotfload | loading font: lmroman8-regular.otf
> luaotfload | loading font: lmroman9-bold.otf
> luaotfload | loading font: lmroman9-italic.otf
> luaotfload | loading font: lmroman9-regular.otf
> luaotfload | loading font: lmromancaps10-oblique.otf
> luaotfload | loading font: lmromancaps10-regular.otf
> luaotfload | loading font: lmromandemi10-oblique.otf
> luaotfload | loading font: lmromandemi10-regular.otf
> luaotfload | loading font: lmromandunh10-oblique.otf
> luaotfload | loading font: lmromandunh10-regular.otf
> luaotfload | loading font: lmromanslant10-bold.otf
> luaotfload | loading font: lmromanslant10-regular.otf
> luaotfload | loading font: lmromanslant12-regular.otf
> luaotfload | loading font: lmromanslant17-regular.otf
> luaotfload | loading font: lmromanslant8-regular.otf
> luaotfload | loading font: lmromanslant9-regular.otf
> luaotfload | loading font: lmromanunsl10-regular.otf
> luaotfload | loading font: lmsans10-bold.otf
> luaotfload | loading font: lmsans10-boldoblique.otf
> luaotfload | loading font: lmsans10-oblique.otf
> luaotfload | loading font: lmsans10-regular.otf
> luaotfload | loading font: lmsans12-oblique.otf
> luaotfload | loading font: lmsans12-regular.otf
> luaotfload | loading font: lmsans17-oblique.otf
> luaotfload | loading font: lmsans17-regular.otf
> luaotfload | loading font: lmsans8-oblique.otf
> luaotfload | loading font: lmsans8-regular.otf
> luaotfload | loading font: lmsans9-oblique.otf
> luaotfload | loading font: lmsans9-regular.otf
> luaotfload | loading font: lmsansdemicond10-oblique.otf
> luaotfload | loading font: lmsansdemicond10-regular.otf
> luaotfload | loading font: lmsansquot8-bold.otf
> luaotfload | loading font: lmsansquot8-boldoblique.otf
> luaotfload | loading font: lmsansquot8-oblique.otf
> luaotfload | loading font: lmsansquot8-regular.otf
> luaotfload | loading font: MnSymbol-Bold10.otf
> luaotfload | loading font: MnSymbol-Bold12.otf
> luaotfload | loading font: MnSymbol-Bold5.otf
> luaotfload | loading font: MnSymbol-Bold6.otf
> luaotfload | loading font: MnSymbol-Bold7.otf
> luaotfload | loading font: MnSymbol-Bold8.otf
> luaotfload | loading font: MnSymbol-Bold9.otf
> luaotfload | loading font: MnSymbol10.otf
> luaotfload | loading font: MnSymbol12.otf
> luaotfload | loading font: MnSymbol5.otf
> luaotfload | loading font: MnSymbol6.otf
> luaotfload | loading font: MnSymbol7.otf
> luaotfload | loading font: MnSymbol8.otf
> luaotfload | loading font: MnSymbol9.otf
> luaotfload | loading font: Phaistos.otf
> luaotfload | loading font: Philokalia-Regular.otf
> luaotfload | loading font: smfb10.otf
> luaotfload | loading font: smfbsl10.otf
> luaotfload | loading font: smfeb10.otf
> luaotfload | loading font: smfebsl10.otf
> luaotfload | loading font: smfer10.otf
> luaotfload | loading font: smfesl10.otf
> luaotfload | loading font: smfett10.otf
> luaotfload | loading font: smfpb10.otf
> luaotfload | loading font: smfpbsl10.otf
> luaotfload | loading font: smfpr10.otf
> luaotfload | loading font: smfpsl10.otf
> luaotfload | loading font: smfptt10.otf
> luaotfload | loading font: smfr10.otf
> luaotfload | loading font: smfsl10.otf
> luaotfload | loading font: smftt10.otf
> luaotfload | loading font: AlphaDia.otf
> luaotfload | loading font: SkakNew-Diagram.otf
> luaotfload | loading font: SkakNew-DiagramT.otf
> luaotfload | loading font: SkakNew-Figurine.otf
> luaotfload | loading font: SkakNew-FigurineBold.otf
> luaotfload | loading font: texgyreadventor-bold.otf
> luaotfload | loading font: texgyreadventor-bolditalic.otf
> luaotfload | loading font: texgyreadventor-italic.otf
> luaotfload | loading font: texgyreadventor-regular.otf
> luaotfload | loading font: texgyrebonum-bold.otf
> luaotfload | loading font: texgyrebonum-bolditalic.otf
> luaotfload | loading font: texgyrebonum-italic.otf
> luaotfload | loading font: texgyrebonum-regular.otf
> luaotfload | loading font: texgyrechorus-mediumitalic.otf
> luaotfload | loading font: texgyrecursor-bold.otf
> luaotfload | loading font: texgyrecursor-bolditalic.otf
> luaotfload | loading font: texgyrecursor-italic.otf
> luaotfload | loading font: texgyrecursor-regular.otf
> luaotfload | loading font: texgyreheros-bold.otf
> luaotfload | loading font: texgyreheros-bolditalic.otf
> luaotfload | loading font: texgyreheros-italic.otf
> luaotfload | loading font: texgyreheros-regular.otf
> luaotfload | loading font: texgyreheroscn-bold.otf
> luaotfload | loading font: texgyreheroscn-bolditalic.otf
> luaotfload | loading font: texgyreheroscn-italic.otf
> luaotfload | loading font: texgyreheroscn-regular.otf
> luaotfload | loading font: texgyrepagella-bold.otf
> luaotfload | loading font: texgyrepagella-bolditalic.otf
> luaotfload | loading font: texgyrepagella-italic.otf
> luaotfload | loading font: texgyrepagella-regular.otf
> luaotfload | loading font: texgyreschola-bold.otf
> luaotfload | loading font: texgyreschola-bolditalic.otf
> luaotfload | loading font: texgyreschola-italic.otf
> luaotfload | loading font: texgyreschola-regular.otf
> luaotfload | loading font: texgyretermes-bold.otf
> luaotfload | loading font: texgyretermes-bolditalic.otf
> luaotfload | loading font: texgyretermes-italic.otf
> luaotfload | loading font: texgyretermes-regular.otf
> luaotfload | loading font: UMTypewriter-Bold.otf
> luaotfload | loading font: UMTypewriter-BoldItalic.otf
> luaotfload | loading font: UMTypewriter-Italic.otf
> luaotfload | loading font: UMTypewriter-Oblique.otf
> luaotfload | loading font: UMTypewriter-Regular.otf
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis'
> luaotfload | 73 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 73 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/libris'
> luaotfload | 4 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/libris'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturis'
> luaotfload | 20 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 20 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturis'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturis2'
> luaotfload | 12 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 12 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturis2'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturisold'
> luaotfload | 5 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturisold'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturissans'
> luaotfload | 20 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 20 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturissans'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturissans2'
> luaotfload | 12 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 12 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/arkandis/venturissans2'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public'
> luaotfload | 257 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 257 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/antt'
> luaotfload | 16 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 16 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/antt'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/Asana-Math'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/Asana-Math'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/cyklop'
> luaotfload | 2 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 2 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/cyklop'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsartemisia'
> luaotfload | 4 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsartemisia'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsbaskerville'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsbaskerville'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsbodoni'
> luaotfload | 4 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsbodoni'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfscomplutum'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfscomplutum'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsdidot'
> luaotfload | 5 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsdidot'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsneohellenic'
> luaotfload | 4 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsneohellenic'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsporson'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfsporson'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfssolomos'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gfssolomos'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gnu-freefont'
> luaotfload | 12 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 12 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/gnu-freefont'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/inconsolata'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/inconsolata'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/iwona'
> luaotfload | 20 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 20 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/iwona'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/kurier'
> luaotfload | 20 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 20 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/kurier'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/libertine'
> luaotfload | 18 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 18 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/libertine'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/lm'
> luaotfload | 72 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 72 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/lm'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/mnsymbol'
> luaotfload | 14 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 14 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/mnsymbol'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/phaistos'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/phaistos'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/philokalia'
> luaotfload | 1 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/philokalia'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/semaphor'
> luaotfload | 15 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 15 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/semaphor'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/skaknew'
> luaotfload | 5 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/skaknew'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/tex-gyre'
> luaotfload | 33 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 33 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/tex-gyre'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/umtypewriter'
> luaotfload | 5 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/opentype/public/umtypewriter'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype'
> luaotfload | 0 'otf' fonts found
> luaotfload | 37 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 37 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype'
> luaotfload | loading font: AmericanTypewriter.ttf
> luaotfload | loading font: AmericanTypewriterBold.ttf
> luaotfload | loading font: AmericanTypewriterCondensed.ttf
> luaotfload | loading font: AmericanTypewriterCondensedBold.ttf
> luaotfload | loading font: AmericanTypewriterCondensedLight.ttf
> luaotfload | loading font: AmericanTypewriterLight.ttf
> luaotfload | loading font: Baskerville.ttf
> luaotfload | loading font: BaskervilleBold.ttf
> luaotfload | loading font: BaskervilleBoldItalic.ttf
> luaotfload | loading font: BaskervilleItalic.ttf
> luaotfload | loading font: BaskervilleSemiBold.ttf
> luaotfload | loading font: BaskervilleSemiBoldItalic.ttf
> luaotfload | loading font: Didot.ttf
> luaotfload | loading font: DidotBold.ttf
> luaotfload | loading font: DidotItalic.ttf
> luaotfload | loading font: FuturaCondensedExtraBold.ttf
> luaotfload | loading font: FuturaCondensedMedium.ttf
> luaotfload | loading font: FuturaMedium.ttf
> luaotfload | loading font: FuturaMediumItalic.ttf
> luaotfload | loading font: GillSans.ttf
> luaotfload | loading font: GillSansBold.ttf
> luaotfload | loading font: GillSansBoldItalic.ttf
> luaotfload | loading font: GillSansItalic.ttf
> luaotfload | loading font: GillSansLight.ttf
> luaotfload | loading font: GillSansLightItalic.ttf
> luaotfload | loading font: HoeflerText.ttf
> luaotfload | loading font: HoeflerTextBlack.ttf
> luaotfload | loading font: HoeflerTextBlackItalic.ttf
> luaotfload | loading font: HoeflerTextItalic.ttf
> luaotfload | loading font: HoeflerTextOrnaments.ttf
> luaotfload | loading font: LucidaGrande.ttf
> luaotfload | loading font: LucidaGrandeBold.ttf
> luaotfload | loading font: OptimaBold.ttf
> luaotfload | loading font: OptimaBoldItalic.ttf
> luaotfload | loading font: OptimaExtraBlack.ttf
> luaotfload | loading font: OptimaItalic.ttf
> luaotfload | loading font: OptimaRegular.ttf
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts'
> luaotfload | 0 'otf' fonts found
> luaotfload | 37 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 37 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/americantypewriter'
> luaotfload | 0 'otf' fonts found
> luaotfload | 6 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 6 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/americantypewriter'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/baskerville'
> luaotfload | 0 'otf' fonts found
> luaotfload | 6 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 6 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/baskerville'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/didot'
> luaotfload | 0 'otf' fonts found
> luaotfload | 3 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 3 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/didot'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/futura'
> luaotfload | 0 'otf' fonts found
> luaotfload | 4 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/futura'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/georgia'
> luaotfload | 0 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 0 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/georgia'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/gillsans'
> luaotfload | 0 'otf' fonts found
> luaotfload | 6 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 6 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/gillsans'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/helveticaneue'
> luaotfload | 0 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 0 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/helveticaneue'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/hoefler'
> luaotfload | 0 'otf' fonts found
> luaotfload | 5 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/hoefler'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/lucidagrande'
> luaotfload | 0 'otf' fonts found
> luaotfload | 2 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 2 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/lucidagrande'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/optima'
> luaotfload | 0 'otf' fonts found
> luaotfload | 5 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/optima'
> luaotfload | scanning '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/verdana'
> luaotfload | 0 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 0 fonts found in '/usr/local/texlive/2010/../texmf-local/fonts/truetype/gtamacfonts/verdana'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype'
> luaotfload | 0 'otf' fonts found
> luaotfload | 34 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 2 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 36 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype'
> luaotfload | loading font: LibrisADFStd-Bold.ttf
> luaotfload | loading font: LibrisADFStd-BoldItalic.ttf
> luaotfload | loading font: LibrisADFStd-Italic.ttf
> luaotfload | loading font: LibrisADFStd-Regular.ttf
> luaotfload | loading font: lmtypewriter10-regular.ttf
> luaotfload | loading font: Asana-Math.ttf
> luaotfload | loading font: blex.ttf
> luaotfload | loading font: blsy.ttf
> luaotfload | loading font: rblmi.ttf
> luaotfload | loading font: GenBasB.ttf
> luaotfload | loading font: GenBasBI.ttf
> luaotfload | loading font: GenBasI.ttf
> luaotfload | loading font: GenBasR.ttf
> luaotfload | loading font: FreeMono.ttf
> luaotfload | loading font: FreeMonoBold.ttf
> luaotfload | loading font: FreeMonoBoldOblique.ttf
> luaotfload | loading font: FreeMonoOblique.ttf
> luaotfload | loading font: FreeSans.ttf
> luaotfload | loading font: FreeSansBold.ttf
> luaotfload | loading font: FreeSansBoldOblique.ttf
> luaotfload | loading font: FreeSansOblique.ttf
> luaotfload | loading font: FreeSerif.ttf
> luaotfload | loading font: FreeSerifBold.ttf
> luaotfload | loading font: FreeSerifBoldItalic.ttf
> luaotfload | loading font: FreeSerifItalic.ttf
> luaotfload | loading font: itxbeng.ttf
> luaotfload | loading font: itxguj.ttf
> luaotfload | loading font: ncpi____.ttf
> luaotfload | loading font: ncpr____.ttf
> luaotfload | loading font: xdvng.ttf
> luaotfload | loading font: Junicode-Bold.ttf
> luaotfload | loading font: Junicode-BoldItalic.ttf
> luaotfload | loading font: Junicode-Italic.ttf
> luaotfload | loading font: Junicode-Regular.ttf
> luaotfload | loading font: GenI102.TTF
> luaotfload | loading font: GenR102.TTF
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/arkandis'
> luaotfload | 0 'otf' fonts found
> luaotfload | 4 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/arkandis'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/arkandis/libris'
> luaotfload | 0 'otf' fonts found
> luaotfload | 4 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/arkandis/libris'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/hoekwater'
> luaotfload | 0 'otf' fonts found
> luaotfload | 1 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/hoekwater'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/hoekwater/lmextra'
> luaotfload | 0 'otf' fonts found
> luaotfload | 1 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/hoekwater/lmextra'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public'
> luaotfload | 0 'otf' fonts found
> luaotfload | 29 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 2 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 31 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/Asana-Math'
> luaotfload | 0 'otf' fonts found
> luaotfload | 1 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 1 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/Asana-Math'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/belleek'
> luaotfload | 0 'otf' fonts found
> luaotfload | 3 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 3 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/belleek'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/gentium'
> luaotfload | 0 'otf' fonts found
> luaotfload | 4 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 2 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 6 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/gentium'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/gnu-freefont'
> luaotfload | 0 'otf' fonts found
> luaotfload | 12 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 12 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/gnu-freefont'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/itrans'
> luaotfload | 0 'otf' fonts found
> luaotfload | 5 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 5 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/itrans'
> luaotfload | scanning '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/junicode'
> luaotfload | 0 'otf' fonts found
> luaotfload | 4 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 4 fonts found in '/usr/local/texlive/2010/texmf-dist/fonts/truetype/public/junicode'
> luaotfload | searching in static system directories...
> luaotfload | scanning '/Users/bvoisin/Library/Fonts'
> luaotfload | 0 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 0 fonts found in '/Users/bvoisin/Library/Fonts'
> luaotfload | scanning '/Library/Fonts'
> luaotfload | 204 'otf' fonts found
> luaotfload | 162 'ttf' fonts found
> luaotfload | 8 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 2 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 376 fonts found in '/Library/Fonts'
> luaotfload | loading font: /Library/Fonts/ACaslonPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/ACaslonPro-BoldItalic.otf
> luaotfload | loading font: /Library/Fonts/ACaslonPro-Italic.otf
> luaotfload | loading font: /Library/Fonts/ACaslonPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/ACaslonPro-Semibold.otf
> luaotfload | loading font: /Library/Fonts/ACaslonPro-SemiboldItalic.otf
> luaotfload | loading font: /Library/Fonts/AdobeFangsongStd-Regular.otf
> luaotfload | loading font: /Library/Fonts/AdobeHeitiStd-Regular.otf
> luaotfload | loading font: /Library/Fonts/AdobeKaitiStd-Regular.otf
> luaotfload | loading font: /Library/Fonts/AdobeMingStd-Light.otf
> luaotfload | loading font: /Library/Fonts/AdobeMyungjoStd-Medium.otf
> luaotfload | loading font: /Library/Fonts/AdobeSongStd-Light.otf
> luaotfload | loading font: /Library/Fonts/AGaramondPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/AGaramondPro-BoldItalic.otf
> luaotfload | loading font: /Library/Fonts/AGaramondPro-Italic.otf
> luaotfload | loading font: /Library/Fonts/AGaramondPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/Behrensschrift/Behrensschrift-Shadow.otf
> luaotfload | loading font: /Library/Fonts/Behrensschrift/Behrensschrift.otf
> luaotfload | loading font: /Library/Fonts/BellGothicStd-Black.otf
> luaotfload | loading font: /Library/Fonts/BellGothicStd-Bold.otf
> luaotfload | loading font: /Library/Fonts/BirchStd.otf
> luaotfload | loading font: /Library/Fonts/BlackoakStd.otf
> luaotfload | loading font: /Library/Fonts/BrushScriptStd.otf
> luaotfload | loading font: /Library/Fonts/ChaparralPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/ChaparralPro-BoldIt.otf
> luaotfload | loading font: /Library/Fonts/ChaparralPro-Italic.otf
> luaotfload | loading font: /Library/Fonts/ChaparralPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/CharlemagneStd-Bold.otf
> luaotfload | loading font: /Library/Fonts/CooperBlackStd-Italic.otf
> luaotfload | loading font: /Library/Fonts/CooperBlackStd.otf
> luaotfload | loading font: /Library/Fonts/EccentricStd.otf
> luaotfload | loading font: /Library/Fonts/GiddyupStd.otf
> luaotfload | loading font: /Library/Fonts/Hiragino Sans GB W3.otf
> luaotfload | loading font: /Library/Fonts/Hiragino Sans GB W6.otf
> luaotfload | loading font: /Library/Fonts/HoboStd.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-ExtraLight.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-Heavy.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-Light.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-Medium.otf
> luaotfload | loading font: /Library/Fonts/KozGoPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-ExtraLight.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-Heavy.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-Light.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-Medium.otf
> luaotfload | loading font: /Library/Fonts/KozMinPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/LetterGothicStd-Bold.otf
> luaotfload | loading font: /Library/Fonts/LetterGothicStd-BoldSlanted.otf
> luaotfload | loading font: /Library/Fonts/LetterGothicStd-Slanted.otf
> luaotfload | loading font: /Library/Fonts/LetterGothicStd.otf
> luaotfload | loading font: /Library/Fonts/LithosPro-Black.otf
> luaotfload | loading font: /Library/Fonts/LithosPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/MesquiteStd.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-BoldCn.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-BoldCnIt.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-BoldIt.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-It.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-Medium.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-MediumIt.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-Semibold.otf
> luaotfload | loading font: /Library/Fonts/MinionPro-SemiboldIt.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-BoldCond.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-BoldCondIt.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-BoldIt.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-Cond.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-CondIt.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-It.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-Semibold.otf
> luaotfload | loading font: /Library/Fonts/MyriadPro-SemiboldIt.otf
> luaotfload | loading font: /Library/Fonts/NuevaStd-BoldCond.otf
> luaotfload | loading font: /Library/Fonts/NuevaStd-BoldCondItalic.otf
> luaotfload | loading font: /Library/Fonts/NuevaStd-Cond.otf
> luaotfload | loading font: /Library/Fonts/NuevaStd-CondItalic.otf
> luaotfload | loading font: /Library/Fonts/OCRAStd.otf
> luaotfload | loading font: /Library/Fonts/OratorStd-Slanted.otf
> luaotfload | loading font: /Library/Fonts/OratorStd.otf
> luaotfload | loading font: /Library/Fonts/PoplarStd.otf
> luaotfload | loading font: /Library/Fonts/PrestigeEliteStd-Bd.otf
> luaotfload | loading font: /Library/Fonts/RosewoodStd-Regular.otf
> luaotfload | loading font: /Library/Fonts/StencilStd.otf
> luaotfload | loading font: /Library/Fonts/TektonPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/TektonPro-BoldCond.otf
> luaotfload | loading font: /Library/Fonts/TektonPro-BoldExt.otf
> luaotfload | loading font: /Library/Fonts/TektonPro-BoldObl.otf
> luaotfload | loading font: /Library/Fonts/TrajanPro-Bold.otf
> luaotfload | loading font: /Library/Fonts/TrajanPro-Regular.otf
> luaotfload | loading font: /Library/Fonts/?????? Pro W4.otf
> luaotfload | loading font: /Library/Fonts/?????? ProN W4.otf
> luaotfload | loading font: /Library/Fonts/?????? Pro W3.otf
> luaotfload | loading font: /Library/Fonts/?????? Pro W6.otf
> luaotfload | loading font: /Library/Fonts/?????? Pro W3.otf
> luaotfload | loading font: /Library/Fonts/?????? Pro W6.otf
> luaotfload | loading font: /Library/Fonts/?????? Std W8.otf
> luaotfload | loading font: /Library/Fonts/?????? StdN W8.otf
> luaotfload | loading font: /Library/Fonts/AlBayan.ttf
> luaotfload | loading font: /Library/Fonts/AlBayanBold.ttf
> luaotfload | loading font: /Library/Fonts/Andale Mono.ttf
> luaotfload | loading font: /Library/Fonts/Apple Chancery.ttf
> luaotfload | loading font: /Library/Fonts/Apple LiGothic Medium.ttf
> luaotfload | loading font: /Library/Fonts/Apple LiSung Light.ttf
> luaotfload | loading font: /Library/Fonts/AppleMyungjo.ttf
> luaotfload | loading font: /Library/Fonts/Arial Black.ttf
> luaotfload | loading font: /Library/Fonts/Arial Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Arial Bold.ttf
> luaotfload | loading font: /Library/Fonts/Arial Italic.ttf
> luaotfload | loading font: /Library/Fonts/Arial Narrow Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Arial Narrow Bold.ttf
> luaotfload | loading font: /Library/Fonts/Arial Narrow Italic.ttf
> luaotfload | loading font: /Library/Fonts/Arial Narrow.ttf
> luaotfload | loading font: /Library/Fonts/Arial Rounded Bold.ttf
> luaotfload | loading font: /Library/Fonts/Arial Unicode.ttf
> luaotfload | loading font: /Library/Fonts/Arial.ttf
> luaotfload | loading font: /Library/Fonts/ArialHB.ttf
> luaotfload | loading font: /Library/Fonts/ArialHBBold.ttf
> luaotfload | loading font: /Library/Fonts/Ayuthaya.ttf
> luaotfload | loading font: /Library/Fonts/Baghdad.ttf
> luaotfload | loading font: /Library/Fonts/BiauKai.ttf
> luaotfload | loading font: /Library/Fonts/BigCaslon.ttf
> luaotfload | loading font: /Library/Fonts/Brush Script.ttf
> luaotfload | loading font: /Library/Fonts/Chalkduster.ttf
> luaotfload | loading font: /Library/Fonts/Comic Sans MS Bold.ttf
> luaotfload | loading font: /Library/Fonts/Comic Sans MS.ttf
> luaotfload | loading font: /Library/Fonts/Corsiva.ttf
> luaotfload | loading font: /Library/Fonts/CorsivaBold.ttf
> luaotfload | loading font: /Library/Fonts/Courier New Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Courier New Bold.ttf
> luaotfload | loading font: /Library/Fonts/Courier New Italic.ttf
> luaotfload | loading font: /Library/Fonts/Courier New.ttf
> luaotfload | loading font: /Library/Fonts/DecoTypeNaskh.ttf
> luaotfload | loading font: /Library/Fonts/DevanagariMT.ttf
> luaotfload | loading font: /Library/Fonts/DevanagariMTBold.ttf
> luaotfload | loading font: /Library/Fonts/EuphemiaCASBold.ttf
> luaotfload | loading font: /Library/Fonts/EuphemiaCASItalic.ttf
> luaotfload | loading font: /Library/Fonts/EuphemiaCASRegular.ttf
> luaotfload | loading font: /Library/Fonts/Georgia Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Georgia Bold.ttf
> luaotfload | loading font: /Library/Fonts/Georgia Italic.ttf
> luaotfload | loading font: /Library/Fonts/Georgia.ttf
> luaotfload | loading font: /Library/Fonts/GujaratiMT.ttf
> luaotfload | loading font: /Library/Fonts/GujaratiMTBold.ttf
> luaotfload | loading font: /Library/Fonts/Gungseouche.ttf
> luaotfload | loading font: /Library/Fonts/Gurmukhi.ttf
> luaotfload | loading font: /Library/Fonts/HeadlineA.ttf
> luaotfload | loading font: /Library/Fonts/Hei.ttf
> luaotfload | loading font: /Library/Fonts/Herculanum.ttf
> luaotfload | loading font: /Library/Fonts/Hoefler Text Ornaments.ttf
> luaotfload | loading font: /Library/Fonts/Impact.ttf
> luaotfload | loading font: /Library/Fonts/InaiMathi.ttf
> luaotfload | loading font: /Library/Fonts/Kai.ttf
> luaotfload | loading font: /Library/Fonts/Kailasa.ttf
> luaotfload | loading font: /Library/Fonts/Kokonor.ttf
> luaotfload | loading font: /Library/Fonts/Krungthep.ttf
> luaotfload | loading font: /Library/Fonts/KufiStandardGK.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Batang.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Bookshelf Symbol 7.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Brush Script.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Calibri Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Calibri Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Calibri Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Calibri.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Cambria Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Cambria Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Cambria Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Cambria.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Candara Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Candara Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Candara Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Candara.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Consolas Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Consolas Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Consolas Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Consolas.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Constantia Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Constantia Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Constantia Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Constantia.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Corbel Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Corbel Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Corbel Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Corbel.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Franklin Gothic Book Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Franklin Gothic Book.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Franklin Gothic Medium Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Franklin Gothic Medium.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Gill Sans MT Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Gill Sans MT Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Gill Sans MT Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Gill Sans MT.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Gulim.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Lucida Console.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Lucida Sans Unicode.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Marlett.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Meiryo Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Meiryo Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Meiryo Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Meiryo.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS Gothic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS Mincho.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS PGothic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS PMincho.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS Reference Sans Serif.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/MS Reference Specialty.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Perpetua Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Perpetua Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Perpetua Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Perpetua.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/PMingLiU.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/SimSun.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Tw Cen MT Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Tw Cen MT Bold.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Tw Cen MT Italic.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft/Tw Cen MT.ttf
> luaotfload | loading font: /Library/Fonts/Microsoft Sans Serif.ttf
> luaotfload | loading font: /Library/Fonts/MshtakanBold.ttf
> luaotfload | loading font: /Library/Fonts/MshtakanBoldOblique.ttf
> luaotfload | loading font: /Library/Fonts/MshtakanOblique.ttf
> luaotfload | loading font: /Library/Fonts/MshtakanRegular.ttf
> luaotfload | loading font: /Library/Fonts/Nadeem.ttf
> luaotfload | loading font: /Library/Fonts/NewPeninimMT.ttf
> luaotfload | loading font: /Library/Fonts/NewPeninimMTBold.ttf
> luaotfload | loading font: /Library/Fonts/NewPeninimMTBoldInclined.ttf
> luaotfload | loading font: /Library/Fonts/NewPeninimMTInclined.ttf
> luaotfload | loading font: /Library/Fonts/NISC18030.ttf
> luaotfload | error: failed to open /Library/Fonts/NISC18030.ttf
> luaotfload | loading font: /Library/Fonts/Osaka.ttf
> luaotfload | loading font: /Library/Fonts/OsakaMono.ttf
> luaotfload | loading font: /Library/Fonts/PCmyoungjo.ttf
> luaotfload | loading font: /Library/Fonts/Pilgiche.ttf
> luaotfload | loading font: /Library/Fonts/PlantagenetCherokee.ttf
> luaotfload | loading font: /Library/Fonts/Raanana.ttf
> luaotfload | loading font: /Library/Fonts/RaananaBold.ttf
> luaotfload | loading font: /Library/Fonts/Sathu.ttf
> luaotfload | loading font: /Library/Fonts/Silom.ttf
> luaotfload | loading font: /Library/Fonts/Skia.ttf
> luaotfload | loading font: /Library/Fonts/Tahoma Bold.ttf
> luaotfload | loading font: /Library/Fonts/Tahoma.ttf
> luaotfload | loading font: /Library/Fonts/Times New Roman Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Times New Roman Bold.ttf
> luaotfload | loading font: /Library/Fonts/Times New Roman Italic.ttf
> luaotfload | loading font: /Library/Fonts/Times New Roman.ttf
> luaotfload | loading font: /Library/Fonts/Trebuchet MS Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Trebuchet MS Bold.ttf
> luaotfload | loading font: /Library/Fonts/Trebuchet MS Italic.ttf
> luaotfload | loading font: /Library/Fonts/Trebuchet MS.ttf
> luaotfload | loading font: /Library/Fonts/Verdana Bold Italic.ttf
> luaotfload | loading font: /Library/Fonts/Verdana Bold.ttf
> luaotfload | loading font: /Library/Fonts/Verdana Italic.ttf
> luaotfload | loading font: /Library/Fonts/Verdana.ttf
> luaotfload | loading font: /Library/Fonts/Webdings.ttf
> luaotfload | loading font: /Library/Fonts/Wingdings 2.ttf
> luaotfload | loading font: /Library/Fonts/Wingdings 3.ttf
> luaotfload | loading font: /Library/Fonts/Wingdings.ttf
> luaotfload | loading font: /Library/Fonts/Zapfino.ttf
> luaotfload | loading font: /Library/Fonts/?? Pro.ttf
> luaotfload | loading font: /Library/Fonts/????.ttf
> luaotfload | loading font: /Library/Fonts/????.ttf
> luaotfload | loading font: /Library/Fonts/????.ttf
> luaotfload | loading font: /Library/Fonts/AppleCasual.dfont
> luaotfload | loading font: /Library/Fonts/Cairo/Cairo.dfont
> luaotfload | loading font: /Library/Fonts/Capitals.dfont
> luaotfload | loading font: /Library/Fonts/CharcoalCY.dfont
> luaotfload | loading font: /Library/Fonts/GenevaCY.dfont
> luaotfload | loading font: /Library/Fonts/HelveticaCY.dfont
> luaotfload | loading font: /Library/Fonts/MarVoSym/MarVoSym.dfont
> luaotfload | loading font: /Library/Fonts/MathematicaFonts.dfont
> luaotfload | loading font: /Library/Fonts/Calvin/CALVINN.TTF
> luaotfload | loading font: /Library/Fonts/Calvin/CALVINO.TTF
> luaotfload | scanning '/System/Library/Fonts'
> luaotfload | 4 'otf' fonts found
> luaotfload | 18 'ttf' fonts found
> luaotfload | 5 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 27 fonts found in '/System/Library/Fonts'
> luaotfload | ignoring font '/System/Library/Fonts/LastResort.ttf'
> luaotfload | loading font: /System/Library/Fonts/?????? ProN W3.otf
> luaotfload | loading font: /System/Library/Fonts/?????? ProN W6.otf
> luaotfload | loading font: /System/Library/Fonts/?????? ProN W3.otf
> luaotfload | loading font: /System/Library/Fonts/?????? ProN W6.otf
> luaotfload | loading font: /System/Library/Fonts/Apple Braille Outline 6 Dot.ttf
> luaotfload | loading font: /System/Library/Fonts/Apple Braille Outline 8 Dot.ttf
> luaotfload | loading font: /System/Library/Fonts/Apple Braille Pinpoint 6 Dot.ttf
> luaotfload | loading font: /System/Library/Fonts/Apple Braille Pinpoint 8 Dot.ttf
> luaotfload | loading font: /System/Library/Fonts/Apple Braille.ttf
> luaotfload | loading font: /System/Library/Fonts/Apple Symbols.ttf
> luaotfload | loading font: /System/Library/Fonts/AppleGothic.ttf
> luaotfload | loading font: /System/Library/Fonts/Geeza Pro Bold.ttf
> luaotfload | loading font: /System/Library/Fonts/Geeza Pro.ttf
> luaotfload | loading font: /System/Library/Fonts/Keyboard.ttf
> luaotfload | loading font: /System/Library/Fonts/Symbol.ttf
> luaotfload | loading font: /System/Library/Fonts/Thonburi.ttf
> luaotfload | loading font: /System/Library/Fonts/ThonburiBold.ttf
> luaotfload | loading font: /System/Library/Fonts/ZapfDingbats.ttf
> luaotfload | loading font: /System/Library/Fonts/?? Pro.ttf
> luaotfload | loading font: /System/Library/Fonts/????.ttf
> luaotfload | loading font: /System/Library/Fonts/????.ttf
> luaotfload | loading font: /System/Library/Fonts/Courier.dfont
> luaotfload | loading font: /System/Library/Fonts/Geneva.dfont
> luaotfload | loading font: /System/Library/Fonts/Helvetica.dfont
> luaotfload | loading font: /System/Library/Fonts/Monaco.dfont
> luaotfload | loading font: /System/Library/Fonts/Times.dfont
> luaotfload | scanning '/Network/Library/Fonts'
> luaotfload | 0 'otf' fonts found
> luaotfload | 0 'ttf' fonts found
> luaotfload | 0 'dfont' fonts found
> luaotfload | 0 'OTF' fonts found
> luaotfload | 0 'TTF' fonts found
> luaotfload | 0 'DFONT' fonts found
> luaotfload | 0 fonts found in '/Network/Library/Fonts'
> luaotfload | 738 fonts in the database
> luaotfload | saved font names database in /Users/bvoisin/.texlive2010/texmf-var/luatex/generic/luaotfload/names/otfl-names.lua
> 
> 

-- Will



From wspr81 at gmail.com  Sun May 30 14:24:06 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 21:54:06 +0930
Subject: [lltx] [MacTeX] fontspec for LuaTeX
In-Reply-To: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
References: <D8F41A0D-214E-41C0-AA05-6CC6A0D81405@gmail.com>
	<FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
Message-ID: <257E6E4E-809C-4884-8846-46039CA963D2@gmail.com>

On 30/05/2010, at 9:02 PM, Bruno Voisin wrote:

> It took some steps to reach that point:

Thank you very much, Bruno, for the pain-staking testing.
I had no idea there would be so many stumbling blocks.


> - First problem: there is no mkluatexfontdb symlink [...]
> - Second, more serious problem:
> [...]
> Calling the symlink alt_getopt.lua did work

These will both be resolved, I hope, on the TeX Live side of things.
I'll confirm with Manuel.


> With that in mind, I think there should be two versions of mkluatexfontdb: one, the current one, using $TEXMFVAR for output, and the other, mkluatexfontdb-sys, using $TEXMFSYSVAR so that the LuaTeX font database can be created system-wise, not account-by-account.

The eventual goal is to have mkluatexfontdb operate transparently in much the same way as XeTeX does things. This being the case, I (personally) think it's okay to only have a local-user font cache. Is there an important reason I'm overlooking that this should be possible for all users?

(I admit having a system-wide cache for system-wide fonts makes sense, but it does add to the complexity of the code.)


> - What happens with font duplicates? For example OS X contains the usual Microsoft Office fonts in .ttf format in /Library/Fonts, but upon installation Office installs its own versions, often in old FFIL suitcase format, in /Library/Fonts/Microsoft. I resolved the duplicates manually in Font Book by disactivating the Microsoft versions, but what happens with mkluatexfontdb?

To the best of my knowledge, mkluatexfontdb will only use the first of a set of duplicate fonts; it doesn't attempt to detect which is newer or anything like that.

This could be a problem but the code is still new. Suggestions on how to deal with conflicts very welcome (specifically how the user interface would work). Is it enough to make it clear in the log that duplicates have been found and the user needs to sort it out themselves? (I can definitely work on improving the log output; additional logic will probably be beyond me for now.)

(And as you've perhaps noticed, it doesn't use Mac OS X's idea of "installed fonts" -- as understood by Font Book -- at all; it just looks in the standard locations.)

[...]


> Does this mean subdirs of
> 
>    ~/Library/Fonts          /Library/Fonts
>    /System/Library/Fonts    /Network/Library/Fonts
> 
> aren't searched? If so, that would mean things would work differently as for OS X (hence XeLaTeX) which does see fonts in subdirs of these.

I just tried it out myself and I can confirm that subdirectories *are* searched. In your case, I can only imagine that the fonts that aren't being found are older FFIL fonts *only* -- LuaTeX will only deal with otf, ttf, and dfont fonts. (ttc fonts are broken but might work one day.)


> Finally I tried to typeset in LuaLaTeX a document written for XeLaTeX and using Verdana as its main font. Didn't work:
> 
> 	/usr/local/texlive/2010/texmf-dist/tex/luatex/luaotfload/luaotfload.sty:47: Lua
> 	TeX error ...e/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua:56: module 'l
> 	uaotfload' not found:

I just discovered this problem, too, with the latest version (v1.8a) of luaotfload.
I have no idea where it came from.
It might well be a Mac OS X-only problem, which would explain why it didn't turn up until after the update was put on CTAN. (The other LuaLaTeX guys are all on Linux.)


> and I gave up there.

Sorry for the disappointing ending.
I really appreciate the effort.
We'll fix these problems as fast as possible.

-- Will



From kakuto at fuk.kindai.ac.jp  Sun May 30 04:59:08 2010
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 30 May 2010 11:59:08 +0900
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
Message-ID: <127518834833046300000577@sniffer>

Hi Will,

> Would it be enough to replace
> 
>         path = kpse.readable_file(path)

By simply commenting out the line:

-- path = kpse.readable_file(path)

mkluatexfontdb -vvv --database-dir=destdir
ran (it needed long time, since I have large otf fonts).
But destdir/otfl-names.lua
is empty! (the file exits but it is empty).

I'll investigate further.

Thanks,
Akira


From kakuto at fuk.kindai.ac.jp  Sun May 30 06:11:43 2010
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 30 May 2010 13:11:43 +0900
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
Message-ID: <127519271342689700000669@sniffer>

Hi Will,

> By simply commenting out the line:
> 
> -- path = kpse.readable_file(path)
>
> mkluatexfontdb -vvv --database-dir=destdir
> ran (it needed long time, since I have large otf fonts).
> But destdir/otfl-names.lua
> is empty! (the file exists but it is empty).

I have tried by reducing the number of search directory.
Then the database destdir/otfl-names.lua was successfully
created (463 fonts are written in the database):
... ...
luaotfload | 463 fonts in the database
luaotfload | saved font names database in c:/usr/local/share/texmf/tex/luatex/luaotfload/names/otfl-names.lua

If I search all directories, mkluatexfontdb exits silently
after parsing all fonts, without the above message,
and the database is empty.

Is there any restriction on the total number of fonts?

Thanks,
Akira


From kakuto at fuk.kindai.ac.jp  Sun May 30 12:12:01 2010
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 30 May 2010 19:12:01 +0900
Subject: [lltx] [tex-live] fontspec for LuaTeX
In-Reply-To: <BC710A5D-C029-4DB6-BE9B-C50588D7BCD5@gmail.com>
References: <BC710A5D-C029-4DB6-BE9B-C50588D7BCD5@gmail.com>
Message-ID: <127521432182787800000aca@sniffer>

Hi Will,


> (Good to hear it's working to some extent, 
> however -- have you tried a basic LuaLaTeX document to see
> if the fonts are able to be used in fontspec?)

Your example, fontspec-luatex.tex works fine.

Thanks,
Akira


From khaledhosny at eglug.org  Sun May 30 14:59:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 15:59:11 +0300
Subject: [lltx] [MacTeX] fontspec for LuaTeX
In-Reply-To: <257E6E4E-809C-4884-8846-46039CA963D2@gmail.com>
References: <D8F41A0D-214E-41C0-AA05-6CC6A0D81405@gmail.com>
	<FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<257E6E4E-809C-4884-8846-46039CA963D2@gmail.com>
Message-ID: <20100530125910.GA2682@khaled-laptop>

On Sun, May 30, 2010 at 09:54:06PM +0930, Will Robertson wrote:
> On 30/05/2010, at 9:02 PM, Bruno Voisin wrote:
> > - What happens with font duplicates? For example OS X contains the usual Microsoft Office fonts in .ttf format in /Library/Fonts, but upon installation Office installs its own versions, often in old FFIL suitcase format, in /Library/Fonts/Microsoft. I resolved the duplicates manually in Font Book by disactivating the Microsoft versions, but what happens with mkluatexfontdb?
> 
> To the best of my knowledge, mkluatexfontdb will only use the first of a set of duplicate fonts; it doesn't attempt to detect which is newer or anything like that.

Not exactly, the last seen font is the only one considered, so if you
have a font under /usr/share/fonts and another version under ~/.fonts,
the later is the one ends in the database, if this isn't what you are
getting, then it is a bug.
 
Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 15:19:42 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 15:19:42 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
Message-ID: <4C0265EE.2020503@elzevir.fr>

Le 30/05/2010 14:01, Will Robertson a ?crit :
>> - First problem: there is no mkluatexfontdb symlink in
>> /usr/local/texlive/2010/bin/x86_64-darwin, only in
>> /usr/local/texlive/2010/bin/universal-darwin. I had to switch from
>> TeXLive-2010-64 to TeXLive-2010 in the TeX Dist system pref panel for
>> mkluatexfontdb to be found.
>> 
I don't understand. There is a symlink in x86_64-darwin in TL's SVN.

>> - Second, more serious problem:
>>
>> 	theo9mc182:~ bvoisin$ mkluatexfontdb --help
>> 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
>> 		no field package.preload['alt_getopt']
>> 		[kpse lua searcher] file not found: 'alt_getopt'
>> 	[kpse C searcher] file not found: 'alt_getopt'
>> 
I'll investigate, but the symlink in bin is *not* the correct general solution.

>> - The same problem as with updmap vs updmap-sys remains, apparently, but
>> it's even worse: if you want to make fonts known to LuaLaTeX system-wise, I
>> thought you'd run
>> 
>> sudo -H mklualatexfontdb
>> 
>> But in this case (I tried) the font database is created in
>> /var/root/.texlive2010/texmf-var, which won't be used unless you're logged
>> in as root I imagine. Shouldn't /usr/texlive/2010/texmf-var be used
>> instead?
>> 
The --sys option is supposed to do that. This is the correct behaviour (as
opposed to detecting the uid or anything), since the TL tree may not be
maintained by root, so the script cannot guess if you want it to operate
system-wide or not, so you have to request it explicitly.

>> With that in mind, I think there should be two versions of mkluatexfontdb:
>> one, the current one, using $TEXMFVAR for output, and the other,
>> mkluatexfontdb-sys, using $TEXMFSYSVAR so that the LuaTeX font database can
>> be created system-wise, not account-by-account.
>> 
Again, the --sys option does that. But I'll install a symlink mkluatexfontdb-sys
too, for consistency (it should have been install with mkluatexfontdb, but I
forgot).

Manuel.

From mpg at elzevir.fr  Sun May 30 15:26:14 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 15:26:14 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C0265EE.2020503@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr>
Message-ID: <4C026776.4010202@elzevir.fr>

[without bruno]

Le 30/05/2010 15:19, Manuel P?gouri?-Gonnard a ?crit :
>>> 	theo9mc182:~ bvoisin$ mkluatexfontdb --help
>>> 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
>>> 		no field package.preload['alt_getopt']
>>> 		[kpse lua searcher] file not found: 'alt_getopt'
>>> 	[kpse C searcher] file not found: 'alt_getopt'
>>>
> I'll investigate, but the symlink in bin is *not* the correct general solution.
> 
My question is: how the hell did it work anywhere? Currently, require() is not
supposed to find alt_getopt.lua where it is located. I would be interesting to
know how this went unnoticed before release, in order to avoid the same kind of
problems later.

Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
located like alt_getopt are found. I think now is the time :-)

Manuel.

From mpg at elzevir.fr  Sun May 30 15:33:54 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 15:33:54 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C026776.4010202@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<4C0265EE.2020503@elzevir.fr>
	<4C026776.4010202@elzevir.fr>
Message-ID: <4C026942.5000806@elzevir.fr>

Le 30/05/2010 15:26, Manuel P?gouri?-Gonnard a ?crit :
> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
> located like alt_getopt are found. I think now is the time :-)
> 
Done. Now it works for me.

I'm still curious to now how it went unnoticed until now.

m

From wspr81 at gmail.com  Sun May 30 15:36:58 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 23:06:58 +0930
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C026942.5000806@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<4C0265EE.2020503@elzevir.fr>
	<4C026776.4010202@elzevir.fr> <4C026942.5000806@elzevir.fr>
Message-ID: <6791F177-A6E8-49EF-9F4B-02A7E1346608@gmail.com>

On 30/05/2010, at 11:03 PM, Manuel P?gouri?-Gonnard wrote:

> Le 30/05/2010 15:26, Manuel P?gouri?-Gonnard a ?crit :
>> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
>> located like alt_getopt are found. I think now is the time :-)
>> 
> Done. Now it works for me.
> 
> I'm still curious to now how it went unnoticed until now.

I think (?) because we've probably all been running mkluatexfontfb from luaotfload directly, which contains its own copy of the alt_getopt script. Oops.

-- Will



From khaledhosny at eglug.org  Sun May 30 15:37:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 16:37:49 +0300
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <127519271342689700000669@sniffer>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127519271342689700000669@sniffer>
Message-ID: <20100530133749.GA3126@khaled-laptop>

On Sun, May 30, 2010 at 01:11:43PM +0900, Akira Kakuto wrote:
> Hi Will,
> 
> > By simply commenting out the line:
> > 
> > -- path = kpse.readable_file(path)
> >
> > mkluatexfontdb -vvv --database-dir=destdir
> > ran (it needed long time, since I have large otf fonts).
> > But destdir/otfl-names.lua
> > is empty! (the file exists but it is empty).
> 
> I have tried by reducing the number of search directory.
> Then the database destdir/otfl-names.lua was successfully
> created (463 fonts are written in the database):
> ... ...
> luaotfload | 463 fonts in the database
> luaotfload | saved font names database in c:/usr/local/share/texmf/tex/luatex/luaotfload/names/otfl-names.lua
> 
> If I search all directories, mkluatexfontdb exits silently
> after parsing all fonts, without the above message,
> and the database is empty.
> 
> Is there any restriction on the total number of fonts?

No, there isn't, I used to run the script against more than 3000 fonts.

You can try to increase verbosity level and see what is going on.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sun May 30 15:39:06 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 30 May 2010 16:39:06 +0300
Subject: [lltx] luaotfload bug?
In-Reply-To: <FCE4A623-86FF-4FC7-901C-F122A7AE32B7@gmail.com>
References: <FCE4A623-86FF-4FC7-901C-F122A7AE32B7@gmail.com>
Message-ID: <4C026A7A.20506@telecom-bretagne.eu>

Will Robertson a ?crit :
> 	/Users/will/Library/texmf/tex/luatex/luaotfload/luaotfload.lua:23: malformed n
> umber near '1.08a'
>   

Hello,

I think it comes from here: 
http://github.com/khaledhosny/luaotfload/commit/58561dcddc21d070da19b67012ed98ddb4dda721 
(I added a note). A new version should be uploaded ASAP.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 30 15:39:19 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 16:39:19 +0300
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <127518834833046300000577@sniffer>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127518834833046300000577@sniffer>
Message-ID: <20100530133919.GB3126@khaled-laptop>

On Sun, May 30, 2010 at 11:59:08AM +0900, Akira Kakuto wrote:
> Hi Will,
> 
> > Would it be enough to replace
> > 
> >         path = kpse.readable_file(path)
> 
> By simply commenting out the line:
> 
> -- path = kpse.readable_file(path)

Elie, why this line is there in the first place?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 15:42:32 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 16:42:32 +0300
Subject: [lltx] luaotfload bug?
In-Reply-To: <FCE4A623-86FF-4FC7-901C-F122A7AE32B7@gmail.com>
References: <FCE4A623-86FF-4FC7-901C-F122A7AE32B7@gmail.com>
Message-ID: <20100530134232.GC3126@khaled-laptop>

On Sun, May 30, 2010 at 07:42:51PM +0930, Will Robertson wrote:
> Hi,
> 
> Haven't looked into it, but here's what the bleeding edge reports (it's a fontspec example document):
> 
> 
> /Users/will/Library/texmf/tex/luatex/luaotfload/luaotfload.sty:47: LuaTeX error
>  ...ill/Library/texmf/tex/luatex/luatexbase/modutils.lua:56: module 'luaotfload
> ' not found:
> 	no field package.preload['luaotfload']
> 	[luatexbase.loader] Loading error:
> 	/Users/will/Library/texmf/tex/luatex/luaotfload/luaotfload.lua:23: malformed n
> umber near '1.08a'
> 	[kpse C searcher] file not found: 'luaotfload'
> stack traceback:
> 	[C]: in function 'require'
> 	...ill/Library/texmf/tex/luatex/luatexbase/modutils.lua:56: in function 'use_m
> odule'
> 	<\directlua >:1: in main chunk.
> \luatexUseModule ...\luatexluaescapestring {#1}")}
>                                                   
> l.47 \luatexUseModule{luaotfload}
> 
> 
> Seems to be a problem with luaotfload. The v1.08 tag is okay.
> I might have time to look at this later tonight.
> But maybe not.

Oops, the lua package version field is a number not string, so it can't be
1.08a, I think I'll just make it 1.09, no need for funny subversions.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 15:47:23 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 30 May 2010 15:47:23 +0200
Subject: [lltx] fc-list?
Message-ID: <4C026C6B.2090801@elzevir.fr>

Hi,

Just to be sure: is fc-list used at all under any circumstance by
mkluatexfontdb? More precisely, does TL still needs to allow it to be run by
restricted shell_escape?

Thanks,
Manuel.

From mpg at elzevir.fr  Sun May 30 15:49:43 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 30 May 2010 15:49:43 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <6791F177-A6E8-49EF-9F4B-02A7E1346608@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<4C0265EE.2020503@elzevir.fr>	<4C026776.4010202@elzevir.fr>
	<4C026942.5000806@elzevir.fr>
	<6791F177-A6E8-49EF-9F4B-02A7E1346608@gmail.com>
Message-ID: <4C026CF7.7030900@elzevir.fr>

Le 30/05/2010 15:36, Will Robertson a ?crit :
> On 30/05/2010, at 11:03 PM, Manuel P?gouri?-Gonnard wrote:
> 
>> Le 30/05/2010 15:26, Manuel P?gouri?-Gonnard a ?crit :
>>> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
>>> located like alt_getopt are found. I think now is the time :-)
>>>
>> Done. Now it works for me.
>>
>> I'm still curious to now how it went unnoticed until now.
> 
> I think (?) because we've probably all been running mkluatexfontfb from luaotfload directly, which contains its own copy of the alt_getopt script. Oops.
> 
I suggest we delete this copy, unless someone gives a good reason to keep it.

Manuel.

From kakuto at fuk.kindai.ac.jp  Sun May 30 15:56:01 2010
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 30 May 2010 22:56:01 +0900
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
Message-ID: <127522776149003000000de3@sniffer>

Hi Will,

> > In my test on windows, mkluatexfontdb failed at
> > 
> > otfl-font-nms.lua:487: attempt to index local 'path' (a nil value)
> > 
> > line 486 is
> >        path = kpse.readable_file(path)
> > 
> > Note that kpse.readable_file(path) returns a nil value if
> > path is a directory. In my case the path was a directory
> > "destdir" for the command line:
> > 
> > mkluatexfontdb --database-dir=destdir

I excluded a directory where there are some problematic fonts.
Now mkluatexfontdb works fine if I remove line 486 in
otfl-font-nms.lua.

Thanks,
Akira


From khaledhosny at eglug.org  Sun May 30 16:02:35 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:02:35 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
Message-ID: <20100530140235.GD3126@khaled-laptop>

On Sun, May 30, 2010 at 09:31:41PM +0930, Will Robertson wrote:
> Dear all,
> 
> Several issues below; I'll investigate some as best I can.
> I'll cc my own reply to this list.
> 
> Manuel, is the symlink issue for 64-bit Mac binaries a TL problem? Can you fix that?

I think we should no longer ask people to run mkluatexfontdb
script, luaotfload will take care of generating database.
Also, AFAIC, the script is the supposed to run from the same directory
where luaotfload and alt_getopt reside, anything else is not tested.

No real multiuser support either, there is a --sys option but it does
not work as advertised (i.e. it will index fonts that only accessible to
the user running it), and I don't personally support it either.

> 
> Secondly, same thing for alt_getopt ?
> 
> W
> 
> Begin forwarded message:
> 
> > From: Bruno Voisin <bvoisin at me.com>
> > Date: 30 May 2010 9:02:45 PM ACST
> > To: "MacOS X and TeX." <mactex at tug.org>
> > Subject: Re: [MacTeX] fontspec for LuaTeX
> > Reply-To: "MacOS X and TeX." <mactex at tug.org>
> > 
> > Le 29 mai 2010 ? 10:14, Will Robertson a ?crit :
> > 
> >> Any testing you could perform would be greatly appreciated, especially running the mkluatexfontdb script in the luaotfload package and then attempting to access system fonts in LuaLaTeX with fontspec.
> > 
> > It took some steps to reach that point:
> > 
> > 
> > - First problem: there is no mkluatexfontdb symlink in /usr/local/texlive/2010/bin/x86_64-darwin, only in /usr/local/texlive/2010/bin/universal-darwin. I had to switch from TeXLive-2010-64 to TeXLive-2010 in the TeX Dist system pref panel for mkluatexfontdb to be found.
> > 
> > 
> > - Second, more serious problem:
> > 
> > 	theo9mc182:~ bvoisin$ mkluatexfontdb --help
> > 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
> > 		no field package.preload['alt_getopt']
> > 		[kpse lua searcher] file not found: 'alt_getopt'
> > 	[kpse C searcher] file not found: 'alt_getopt'
> > 	
> > Noticing there is a /usr/local/texlive/2010/texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua, I tried to create a symlink apt_getopt to it in /usr/texbin but that didn't improve things
> > 
> > 	theo9mc182:universal-darwin bvoisin$ cd /usr/texbin
> > 	theo9mc182:texbin bvoisin$ sudo ln -s ../../texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua alt_getopt
> > 	Password:
> > 	theo9mc182:texbin bvoisin$ mkluatexfontdb --help
> > 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
> > 		no field package.preload['alt_getopt']
> > 		[kpse lua searcher] file not found: 'alt_getopt'
> > 		[kpse C searcher] file not found: 'alt_getopt'
> > 
> > Calling the symlink alt_getopt.lua did work:
> > 
> > 	theo9mc182:texbin bvoisin$ sudo ln -s ../../texmf-dist/scripts/lua-alt-getopt/alt_getopt.lua alt_getopt.lua
> > 	Password:
> > 	theo9mc182:texbin bvoisin$ mkluatexfontdb --help
> > 	Usage: mkluatexfontdb [OPTION]...
> > 	[...]
> > 	theo9mc182:texbin bvoisin$ sudo mkluatexfontdb -vv
> > 	
> > 	luaotfload | generating font names database.
> > 	[...]
> > 
> > 
> > The total output is included below, in case that can be of any help.

Forget about mkluatexfontdb, just process your tex document and
luaotfload will take care of font database generation.

> > 
> > A couple of thoughts:
> > 
> > 
> > - The same problem as with updmap vs updmap-sys remains, apparently, but it's even worse: if you want to make fonts known to LuaLaTeX system-wise, I thought you'd run
> > 
> > 	sudo -H mklualatexfontdb
> > 
> > But in this case (I tried) the font database is created in /var/root/.texlive2010/texmf-var, which won't be used unless you're logged in as root I imagine. Shouldn't /usr/texlive/2010/texmf-var be used instead?
> > 
> > And if you run either of
> > 
> > 	sudo mkluatexfontdb
> > 	mkluatexfontdb
> > 
> > the font database is created in ~/.texlive2010/texmf-var, ie for a given user only.
> > 
> > With that in mind, I think there should be two versions of mkluatexfontdb: one, the current one, using $TEXMFVAR for output, and the other, mkluatexfontdb-sys, using $TEXMFSYSVAR so that the LuaTeX font database can be created system-wise, not account-by-account.

It is essentially a single user script, no actual support for multiuser
systems, apart from installing the database in $TEXMFSYSVAR. It might
get multiuser at some point, but there are issues that need to be
thought about first.

> > 
> > 
> > - What happens with font duplicates? For example OS X contains the usual Microsoft Office fonts in .ttf format in /Library/Fonts, but upon installation Office installs its own versions, often in old FFIL suitcase format, in /Library/Fonts/Microsoft. I resolved the duplicates manually in Font Book by disactivating the Microsoft versions, but what happens with mkluatexfontdb?
> > 
> > In otfl-names.lua I noticed
> > 
> > 	  {
> > 	   ["familyname"]="Verdana",
> > 	   ["filename"]={ "/Library/Fonts/Verdana.ttf", false },
> > 	   ["fontname"]="Verdana",
> > 	   ["fullname"]="Verdana",
> > 	   ["names"]={
> > 	    ["family"]="Verdana",
> > 	    ["fullname"]="Verdana",
> > 	    ["psname"]="Verdana",
> > 	    ["subfamily"]="Regular",
> > 	   },
> > 	   ["size"]={},
> > 	   ["slant"]=0,
> > 	   ["weight"]=400,
> > 	   ["width"]=5,
> > 	  },
> > 
> > 	  ["/Library/Fonts/Verdana.ttf"]={
> > 	   ["index"]={ 654 },
> > 	   ["timestamp"]=1247723022,
> > 	  },
> > 
> > Does this mean subdirs of
> > 
> >    ~/Library/Fonts          /Library/Fonts
> >    /System/Library/Fonts    /Network/Library/Fonts
> > 
> > aren't searched? If so, that would mean things would work differently as for OS X (hence XeLaTeX) which does see fonts in subdirs of these.
> > 
> > The same duplicate problem would occur for us OSXers who install (as the MacTeX package allows optionally) the OpenType versions of the Latin Modern and TeX Gyre fonts in
> > 
> > 	/Library/Fonts/Latin Modern
> > 	/Library/Fonts/TeX Gyre
> > 
> > (ie duplicates there and in /usr/local/texlive/2010/texmf-dist/fonts/opentype/public).

Sub directories are definitely searched, duplicates are dealt in a
rather dump way; the last seen one takes precedence and others are
ignored. May be at some point we would consider checking font version
and keep the recent one, but font versions are a mess and can't be
relayed upon.

> > 
> > 
> > Finally I tried to typeset in LuaLaTeX a document written for XeLaTeX and using Verdana as its main font. Didn't work:
> > 
> > 	/usr/local/texlive/2010/texmf-dist/tex/luatex/luaotfload/luaotfload.sty:47: Lua
> > 	TeX error ...e/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua:56: module 'l
> > 	uaotfload' not found:
> > 		no field package.preload['luaotfload']
> > 		[luatexbase.loader] Loading error:
> > 		/usr/local/texlive/2010/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:23: ma
> > 	lformed number near '1.08a'
> > 		[kpse C searcher] file not found: 'luaotfload'
> > 		[oberdiek.luatex.kpse_module_loader] Search failed
> > 	stack traceback:
> > 		[C]: in function 'require'
> > 		...e/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua:56: in function 'use_m
> > 	odule'
> > 		<\directlua >:1: in main chunk.
> > 	\luatexUseModule ...\luatexluaescapestring {#1}")}
> > 
> > and I gave up there.

That is my fault, I should have run it before uploading to CTAN.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 16:05:27 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:05:27 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C026776.4010202@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr> <4C026776.4010202@elzevir.fr>
Message-ID: <20100530140527.GE3126@khaled-laptop>

On Sun, May 30, 2010 at 03:26:14PM +0200, Manuel P?gouri?-Gonnard wrote:
> [without bruno]
> 
> Le 30/05/2010 15:19, Manuel P?gouri?-Gonnard a ?crit :
> >>> 	theo9mc182:~ bvoisin$ mkluatexfontdb --help
> >>> 	/usr/texbin/mkluatexfontdb:14: module 'alt_getopt' not found:
> >>> 		no field package.preload['alt_getopt']
> >>> 		[kpse lua searcher] file not found: 'alt_getopt'
> >>> 	[kpse C searcher] file not found: 'alt_getopt'
> >>>
> > I'll investigate, but the symlink in bin is *not* the correct general solution.
> > 
> My question is: how the hell did it work anywhere? Currently, require() is not
> supposed to find alt_getopt.lua where it is located. I would be interesting to
> know how this went unnoticed before release, in order to avoid the same kind of
> problems later.
> 
> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
> located like alt_getopt are found. I think now is the time :-)

We had some discussion while ago about this, and since I don't recall
reaching an acceptable solution, I just copied alt_getopt to luaotfload
and asked every one to run the script without installing it.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 16:10:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:10:17 +0300
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <127522776149003000000de3@sniffer>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127522776149003000000de3@sniffer>
Message-ID: <20100530141017.GA3242@khaled-laptop>

On Sun, May 30, 2010 at 10:56:01PM +0900, Akira Kakuto wrote:
> Hi Will,
> 
> > > In my test on windows, mkluatexfontdb failed at
> > > 
> > > otfl-font-nms.lua:487: attempt to index local 'path' (a nil value)
> > > 
> > > line 486 is
> > >        path = kpse.readable_file(path)
> > > 
> > > Note that kpse.readable_file(path) returns a nil value if
> > > path is a directory. In my case the path was a directory
> > > "destdir" for the command line:
> > > 
> > > mkluatexfontdb --database-dir=destdir
> 
> I excluded a directory where there are some problematic fonts.
> Now mkluatexfontdb works fine if I remove line 486 in
> otfl-font-nms.lua.

I'd be interested in such fonts to see if it is a luaotfload or
luatex bug.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sun May 30 16:11:31 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 23:41:31 +0930
Subject: [lltx] [tex-live] fontspec for LuaTeX
In-Reply-To: <127522776149003000000de3@sniffer>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127522776149003000000de3@sniffer>
Message-ID: <E9D36DEF-7ED4-47C3-8D18-17B09753DCFA@gmail.com>

On 30/05/2010, at 11:26 PM, Akira Kakuto wrote:

> I excluded a directory where there are some problematic fonts.
> Now mkluatexfontdb works fine if I remove line 486 in
> otfl-font-nms.lua.

Are these excluded fonts anything we should be dealing with systematically? There's a font in Mac OS X that we're purposefully ignoring and we are intending on extending this mechanism for general fonts.

-- Will



From mpg at elzevir.fr  Sun May 30 16:12:24 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 16:12:24 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <20100530140235.GD3126@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop>
Message-ID: <4C027248.3090302@elzevir.fr>

Le 30/05/2010 16:02, Khaled Hosny a ?crit :
> I think we should no longer ask people to run mkluatexfontdb
> script, luaotfload will take care of generating database.

Ok, good to know.

> Also, AFAIC, the script is the supposed to run from the same directory
> where luaotfload and alt_getopt reside, anything else is not tested.
> 
This restriction obviously needs to be removed for production use. I think it
should work now, with the new lua search path in TL (so, with tomorrow's update
of tlpretest).

> No real multiuser support either, there is a --sys option but it does
> not work as advertised (i.e. it will index fonts that only accessible to
> the user running it), and I don't personally support it either.
> 
So, maybe it's preferable to remove the option (and the corresponding items in
TL: postaction, tlmgr button...) and update the doc.

I think, however, that it's worth keeping the mkluatexfontdb executable in the
bin dir, so that the user can run it with options (eg, -v for debugging). Wdyt?

> That is my fault, I should have run it before uploading to CTAN.
> 
I added a "check" target in the Makefile and made "ctan" depend on it (a good
habit for every package, if you want my opinion), so as to avoid future similar
problems.

Manuel.

From mpg at elzevir.fr  Sun May 30 16:15:50 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 16:15:50 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <20100530140527.GE3126@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<4C0265EE.2020503@elzevir.fr>
	<4C026776.4010202@elzevir.fr> <20100530140527.GE3126@khaled-laptop>
Message-ID: <4C027316.2050705@elzevir.fr>

Le 30/05/2010 16:05, Khaled Hosny a ?crit :
>> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
>> located like alt_getopt are found. I think now is the time :-)
> 
> We had some discussion while ago about this, and since I don't recall
> reaching an acceptable solution, I just copied alt_getopt to luaotfload
> and asked every one to run the script without installing it.
> 
Again, this obviously can't hold for production use. What exactly is the
problem? Why do you think you need a copy of alt-getopt.lua in luaotfload?

Manuel.

From wspr81 at gmail.com  Sun May 30 16:16:33 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 30 May 2010 23:46:33 +0930
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C027248.3090302@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
Message-ID: <0B527576-9411-41FA-896D-F949528B7DA7@gmail.com>

On 30/05/2010, at 11:42 PM, Manuel P?gouri?-Gonnard wrote:

> Le 30/05/2010 16:02, Khaled Hosny a ?crit :
>> I think we should no longer ask people to run mkluatexfontdb
>> script, luaotfload will take care of generating database.
> 
> Ok, good to know.

Wait, so just to be clear: mkluatexfontdb no longer uses fontconfig?
It just uses fontconfig information to know where to search?

And this means that it can still be run automatically even with restricted shell escape?

I didn't realise this had been implemented already. I'm going to have to update some documentation.


> So, maybe it's preferable to remove the option (and the corresponding items in
> TL: postaction, tlmgr button...) and update the doc.
> 
> I think, however, that it's worth keeping the mkluatexfontdb executable in the
> bin dir, so that the user can run it with options (eg, -v for debugging). Wdyt?

Strongly agree on both counts.


>> That is my fault, I should have run it before uploading to CTAN.
>> 
> I added a "check" target in the Makefile and made "ctan" depend on it (a good
> habit for every package, if you want my opinion), so as to avoid future similar
> problems.

Thanks :)

-- Will



From khaledhosny at eglug.org  Sun May 30 16:25:01 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:25:01 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C027248.3090302@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
Message-ID: <20100530142500.GA3711@khaled-laptop>

On Sun, May 30, 2010 at 04:12:24PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 16:02, Khaled Hosny a ?crit :
> > I think we should no longer ask people to run mkluatexfontdb
> > script, luaotfload will take care of generating database.
> 
> Ok, good to know.
> 
> > Also, AFAIC, the script is the supposed to run from the same directory
> > where luaotfload and alt_getopt reside, anything else is not tested.
> > 
> This restriction obviously needs to be removed for production use. I think it
> should work now, with the new lua search path in TL (so, with tomorrow's update
> of tlpretest).

It was not intented as a restriction, but it is the only case I test and
is known to work, others are free to test other use cases and fix what
is broken.

> 
> > No real multiuser support either, there is a --sys option but it does
> > not work as advertised (i.e. it will index fonts that only accessible to
> > the user running it), and I don't personally support it either.
> > 
> So, maybe it's preferable to remove the option (and the corresponding items in
> TL: postaction, tlmgr button...) and update the doc.
> 
> I think, however, that it's worth keeping the mkluatexfontdb executable in the
> bin dir, so that the user can run it with options (eg, -v for debugging). Wdyt?

It is up to Elie to decide, I never likes the --sys version, but he
seems to have a good reason for it (--destdir=/path/to/systexmfvar
should have the same effect, but at least don't give the illusion we are
multiuser.)

> > That is my fault, I should have run it before uploading to CTAN.
> > 
> I added a "check" target in the Makefile and made "ctan" depend on it (a good
> habit for every package, if you want my opinion), so as to avoid future similar
> problems.

It is a bit slow, but it is fine, it would makes such mistakes hard.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 16:28:02 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:28:02 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <0B527576-9411-41FA-896D-F949528B7DA7@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<0B527576-9411-41FA-896D-F949528B7DA7@gmail.com>
Message-ID: <20100530142802.GB3711@khaled-laptop>

On Sun, May 30, 2010 at 11:46:33PM +0930, Will Robertson wrote:
> On 30/05/2010, at 11:42 PM, Manuel P?gouri?-Gonnard wrote:
> 
> > Le 30/05/2010 16:02, Khaled Hosny a ?crit :
> >> I think we should no longer ask people to run mkluatexfontdb
> >> script, luaotfload will take care of generating database.
> > 
> > Ok, good to know.
> 
> Wait, so just to be clear: mkluatexfontdb no longer uses fontconfig?
> It just uses fontconfig information to know where to search?
> 
> And this means that it can still be run automatically even with restricted shell escape?
> 
> I didn't realise this had been implemented already. I'm going to have to update some documentation.

Yes, it is, I no longer run the standalone script myself. The reading of
fontconfig configuration files is not as done as we might like, but it is
basically working and Elie is working on the remaining issues.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 16:29:10 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 16:29:10 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <20100530142500.GA3711@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<20100530142500.GA3711@khaled-laptop>
Message-ID: <4C027636.4020204@elzevir.fr>

Le 30/05/2010 16:25, Khaled Hosny a ?crit :
> On Sun, May 30, 2010 at 04:12:24PM +0200, Manuel P?gouri?-Gonnard wrote:
>> This restriction obviously needs to be removed for production use. I think it
>> should work now, with the new lua search path in TL (so, with tomorrow's update
>> of tlpretest).
> 
> It was not intented as a restriction, but it is the only case I test and
> is known to work, others are free to test other use cases and fix what
> is broken.
> 
Well, I keep thinking it would have been better to test that in real conditions
earlier (like, before uploading to ctan). Anyway...

>> I added a "check" target in the Makefile and made "ctan" depend on it (a good
>> habit for every package, if you want my opinion), so as to avoid future similar
>> problems.
> 
> It is a bit slow, but it is fine, it would makes such mistakes hard.
> 
Speed should not be an issue when preparing a release unless we want to relase
every other minute :-)

Manuel.

From elie.roux at telecom-bretagne.eu  Sun May 30 16:29:21 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 30 May 2010 17:29:21 +0300
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <20100530133919.GB3126@khaled-laptop>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>	<127518834833046300000577@sniffer>
	<20100530133919.GB3126@khaled-laptop>
Message-ID: <4C027641.1070401@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Elie, why this line is there in the first place?
>   

Because of the LuaTeX manual: "The return value is the actual absolute 
filename you should use, because the disk name is not always
the same as the requested name, due to aliases and system-specific 
handling under e. g. msdos.", it seems safe to call it... but I didn't 
notice it failed on directories on my tests, we surely can remove it.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 30 16:30:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:30:11 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C027316.2050705@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr> <4C026776.4010202@elzevir.fr>
	<20100530140527.GE3126@khaled-laptop> <4C027316.2050705@elzevir.fr>
Message-ID: <20100530143011.GC3711@khaled-laptop>

On Sun, May 30, 2010 at 04:15:50PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 16:05, Khaled Hosny a ?crit :
> >> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
> >> located like alt_getopt are found. I think now is the time :-)
> > 
> > We had some discussion while ago about this, and since I don't recall
> > reaching an acceptable solution, I just copied alt_getopt to luaotfload
> > and asked every one to run the script without installing it.
> > 
> Again, this obviously can't hold for production use. What exactly is the
> problem? Why do you think you need a copy of alt-getopt.lua in luaotfload?

require() didn't find it because where it is installed was not searched
for lua modules, a fix were promised and I was just waiting for it, now,
IIUC, it is already fixed.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 16:31:44 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 16:31:44 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <20100530143011.GC3711@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<4C0265EE.2020503@elzevir.fr>
	<4C026776.4010202@elzevir.fr>	<20100530140527.GE3126@khaled-laptop>
	<4C027316.2050705@elzevir.fr> <20100530143011.GC3711@khaled-laptop>
Message-ID: <4C0276D0.2060501@elzevir.fr>

Le 30/05/2010 16:30, Khaled Hosny a ?crit :
> On Sun, May 30, 2010 at 04:15:50PM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 30/05/2010 16:05, Khaled Hosny a ?crit :
>>>> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
>>>> located like alt_getopt are found. I think now is the time :-)
>>>
>>> We had some discussion while ago about this, and since I don't recall
>>> reaching an acceptable solution, I just copied alt_getopt to luaotfload
>>> and asked every one to run the script without installing it.
>>>
>> Again, this obviously can't hold for production use. What exactly is the
>> problem? Why do you think you need a copy of alt-getopt.lua in luaotfload?
> 
> require() didn't find it because where it is installed was not searched
> for lua modules, a fix were promised and I was just waiting for it, now,
> IIUC, it is already fixed.
> 
There is a lot of alternative solutions that could have worked in the meanwhile
(more reliably than making assumptions about the current working directory, I mean).

m

From khaledhosny at eglug.org  Sun May 30 16:32:39 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:32:39 +0300
Subject: [lltx] Fwd: [tex-live] fontspec for LuaTeX
In-Reply-To: <4C027641.1070401@telecom-bretagne.eu>
References: <BB0D517E-5925-4E1E-8B2B-264A8F6557DE@gmail.com>
	<127518834833046300000577@sniffer>
	<20100530133919.GB3126@khaled-laptop>
	<4C027641.1070401@telecom-bretagne.eu>
Message-ID: <20100530143238.GA3769@khaled-laptop>

On Sun, May 30, 2010 at 05:29:21PM +0300, Elie Roux wrote:
> Khaled Hosny a ?crit :
> >Elie, why this line is there in the first place?
> 
> Because of the LuaTeX manual: "The return value is the actual
> absolute filename you should use, because the disk name is not
> always
> the same as the requested name, due to aliases and system-specific
> handling under e. g. msdos.", it seems safe to call it... but I
> didn't notice it failed on directories on my tests, we surely can
> remove it.

I just commented out that line, and uploaded a new version to CTAN.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 16:34:55 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:34:55 +0300
Subject: [lltx] fc-list?
In-Reply-To: <4C026C6B.2090801@elzevir.fr>
References: <4C026C6B.2090801@elzevir.fr>
Message-ID: <20100530143455.GB3769@khaled-laptop>

On Sun, May 30, 2010 at 03:47:23PM +0200, Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> Just to be sure: is fc-list used at all under any circumstance by
> mkluatexfontdb? More precisely, does TL still needs to allow it to be run by
> restricted shell_escape?

No, we don't use it any more. Only the documentation need to be updated.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sun May 30 16:35:55 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 30 May 2010 17:35:55 +0300
Subject: [lltx] fc-list?
In-Reply-To: <4C026C6B.2090801@elzevir.fr>
References: <4C026C6B.2090801@elzevir.fr>
Message-ID: <4C0277CB.8090407@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Just to be sure: is fc-list used at all under any circumstance by
> mkluatexfontdb?

Nope.

>  More precisely, does TL still needs to allow it to be run by
> restricted shell_escape?
>   

It depends on the politics of TeXLive, if maintaining something in the 
list is a lot of work, you can delete it, if it's just a check to know 
if it's safe, I don't really see any reason not to allow it.

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Sun May 30 16:41:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:41:21 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C0276D0.2060501@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr> <4C026776.4010202@elzevir.fr>
	<20100530140527.GE3126@khaled-laptop> <4C027316.2050705@elzevir.fr>
	<20100530143011.GC3711@khaled-laptop> <4C0276D0.2060501@elzevir.fr>
Message-ID: <20100530144121.GA3829@khaled-laptop>

On Sun, May 30, 2010 at 04:31:44PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 16:30, Khaled Hosny a ?crit :
> > On Sun, May 30, 2010 at 04:15:50PM +0200, Manuel P?gouri?-Gonnard wrote:
> >> Le 30/05/2010 16:05, Khaled Hosny a ?crit :
> >>>> Anyway, for some time I've been wanting to change LUAINPUTS so that lua modules
> >>>> located like alt_getopt are found. I think now is the time :-)
> >>>
> >>> We had some discussion while ago about this, and since I don't recall
> >>> reaching an acceptable solution, I just copied alt_getopt to luaotfload
> >>> and asked every one to run the script without installing it.
> >>>
> >> Again, this obviously can't hold for production use. What exactly is the
> >> problem? Why do you think you need a copy of alt-getopt.lua in luaotfload?
> > 
> > require() didn't find it because where it is installed was not searched
> > for lua modules, a fix were promised and I was just waiting for it, now,
> > IIUC, it is already fixed.
> > 
> There is a lot of alternative solutions that could have worked in the meanwhile
> (more reliably than making assumptions about the current working directory, I mean).

Right, but I don't like writing code that I know it soon will be
obsoleted, and I was under the assumption that it is going to be fixed
for texlive2010, which, for the best of my knowledge, not released yet.

I never claimed luaofload is bug free, or even working at all, the only
reason it was uploaded to CTAN is for more people to test it. If I'm
supposed to test everything, or anything at all, then I don't think it
is going to be released, ever. (hint, STIX 1.0.0 :)

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 16:45:49 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 16:45:49 +0200
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <20100530144121.GA3829@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr> <4C026776.4010202@elzevir.fr>
	<20100530140527.GE3126@khaled-laptop> <4C027316.2050705@elzevir.fr>
	<20100530143011.GC3711@khaled-laptop> <4C0276D0.2060501@elzevir.fr>
	<20100530144121.GA3829@khaled-laptop>
Message-ID: <4C027A1D.30601@elzevir.fr>

Le 30/05/2010 16:41, Khaled Hosny a ?crit :
>> There is a lot of alternative solutions that could have worked in the meanwhile
>> (more reliably than making assumptions about the current working directory, I mean).
> 
> Right, but I don't like writing code that I know it soon will be
> obsoleted,

You prefer commiting files that you know will soon be useless? ;-)

> I never claimed luaofload is bug free, or even working at all, the only
> reason it was uploaded to CTAN is for more people to test it. If I'm
> supposed to test everything, or anything at all, then I don't think it
> is going to be released, ever. (hint, STIX 1.0.0 :)
> 
We sure can't test everything, but I still find it annoying to release something
that doesn't have any chance of working out of our local installation. So maybe
there's a balance between that and never releasing.

m

From khaledhosny at eglug.org  Sun May 30 16:55:10 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 17:55:10 +0300
Subject: [lltx] Fwd: [MacTeX] fontspec for LuaTeX
In-Reply-To: <4C027A1D.30601@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<4C0265EE.2020503@elzevir.fr> <4C026776.4010202@elzevir.fr>
	<20100530140527.GE3126@khaled-laptop> <4C027316.2050705@elzevir.fr>
	<20100530143011.GC3711@khaled-laptop> <4C0276D0.2060501@elzevir.fr>
	<20100530144121.GA3829@khaled-laptop> <4C027A1D.30601@elzevir.fr>
Message-ID: <20100530145510.GA4052@khaled-laptop>

On Sun, May 30, 2010 at 04:45:49PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 16:41, Khaled Hosny a ?crit :
> >> There is a lot of alternative solutions that could have worked in the meanwhile
> >> (more reliably than making assumptions about the current working directory, I mean).
> > 
> > Right, but I don't like writing code that I know it soon will be
> > obsoleted,
> 
> You prefer commiting files that you know will soon be useless? ;-)

Because 'git rm foo; git commit -m "foo bar"; git push' is a lot cheaper
than going through the code reading lengthy comments about this hack
and that work around and knowing what was fixed and what not.

> > I never claimed luaofload is bug free, or even working at all, the only
> > reason it was uploaded to CTAN is for more people to test it. If I'm
> > supposed to test everything, or anything at all, then I don't think it
> > is going to be released, ever. (hint, STIX 1.0.0 :)
> > 
> We sure can't test everything, but I still find it annoying to release something
> that doesn't have any chance of working out of our local installation. So maybe
> there's a balance between that and never releasing.

Though I completely agree with you, I can't guarantee this will not
happen again.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Sun May 30 17:12:46 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 30 May 2010 18:12:46 +0300
Subject: [lltx] LuaTeX logos
In-Reply-To: <AANLkTik6wrrGmp_cP1ZNuOAl57UT4N0Xu351UOPAWer2@mail.gmail.com>
References: <AANLkTik6wrrGmp_cP1ZNuOAl57UT4N0Xu351UOPAWer2@mail.gmail.com>
Message-ID: <4C02806E.1060109@telecom-bretagne.eu>

Andrew Moschou a ?crit :
> I have sent an updated version of metalogo to CTAN which includes 
> definitions for \LuaTeX and \LuaLaTeX.

Hello Andrew and all,

Thank you for your update! I have just one request for the future: do 
you think you could define \LuaTeX as

Lua%
\HOLOGO at NegativeKerning{aT,oT,To}%
\TeX %

with HOLOGO at NegativeKerning{aT,oT,To} being the biggest negative kern 
between aT (which in most fonts never has a negative kern), oT and To 
(which is a good candidate). This definition is in hologo 
(http://www.tex.ac.uk/tex-archive/macros/latex/contrib/oberdiek/hologo.pdf).

I think it would be really optimal... what do you think?

Thank you,
-- 
Elie

From wspr81 at gmail.com  Sun May 30 17:35:21 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 31 May 2010 01:05:21 +0930
Subject: [lltx] make check
In-Reply-To: <4C027248.3090302@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
Message-ID: <47377146-A262-4E09-A031-E77F3A373D64@gmail.com>

On 30/05/2010, at 11:42 PM, Manuel P?gouri?-Gonnard wrote:

> I added a "check" target in the Makefile and made "ctan" depend on it (a good habit for every package, if you want my opinion), so as to avoid future similar problems.

Bit confused:


$ luatex tests/color.tex 
[...]
! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
alue).
<to be read again> 
                   \font 
l.6 \font
         \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...


But if I first `cd tests` & then `luatex color.tex` then things work fine. Is `make check` not quite doing the right thing or is just that I'm still on TL09?

-- Will



From wspr81 at gmail.com  Sun May 30 17:38:49 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 31 May 2010 01:08:49 +0930
Subject: [lltx] fc-list?
In-Reply-To: <20100530143455.GB3769@khaled-laptop>
References: <4C026C6B.2090801@elzevir.fr> <20100530143455.GB3769@khaled-laptop>
Message-ID: <836666B9-758E-4297-A210-17CB2E159547@gmail.com>

On 31/05/2010, at 12:04 AM, Khaled Hosny wrote:

> On Sun, May 30, 2010 at 03:47:23PM +0200, Manuel P?gouri?-Gonnard wrote:
>> Hi,
>> 
>> Just to be sure: is fc-list used at all under any circumstance by
>> mkluatexfontdb? More precisely, does TL still needs to allow it to be run by
>> restricted shell_escape?
> 
> No, we don't use it any more. Only the documentation need to be updated.

Why does the script still contain the --fc-cache option? Can all that code be deleted? Or is fc-cache still useful for finding the font locations?

-- Will



From khaledhosny at eglug.org  Sun May 30 17:39:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 18:39:49 +0300
Subject: [lltx] make check
In-Reply-To: <47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
Message-ID: <20100530153949.GA4523@khaled-laptop>

On Mon, May 31, 2010 at 01:05:21AM +0930, Will Robertson wrote:
> On 30/05/2010, at 11:42 PM, Manuel P?gouri?-Gonnard wrote:
> 
> > I added a "check" target in the Makefile and made "ctan" depend on it (a good habit for every package, if you want my opinion), so as to avoid future similar problems.
> 
> Bit confused:
> 
> 
> $ luatex tests/color.tex 
> [...]
> ! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
> alue).
> <to be read again> 
>                    \font 
> l.6 \font
>          \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...
> 
> 
> But if I first `cd tests` & then `luatex color.tex` then things work fine. Is `make check` not quite doing the right thing or is just that I'm still on TL09?

I got no errors here, is the installed version of luaotfload the same as
git one?

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 17:40:06 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 30 May 2010 17:40:06 +0200
Subject: [lltx] bleeding edge makefile
In-Reply-To: <6880833E-B1A4-45CA-966A-E5FF1968B07A@gmail.com>
References: <6880833E-B1A4-45CA-966A-E5FF1968B07A@gmail.com>
Message-ID: <4C0286D6.7040204@elzevir.fr>

Le 30/05/2010 12:04, Will Robertson a ?crit :
> I hate updating packages by hand.

Me too :-)


> $(PKG):
> 	cd ../$@; git pull && make install TEXMFROOT=~/Library/texmf/
> 
You may want to run

find ~/Library/texmf -type d -name $@ -exec rm {} +

(assuming a GNU find) first (that is, remove the old version before installing
the new one, in case files were deleted or renamed).

FWIW, here is the set of zsh functions I'm using for managing my texmfhome and
especially lltx packages:

rmtexmfhome() {
    local texmfhome=$(kpsewhich --var-value TEXMFHOME)
    for pack in $@; do
        find $texmfhome -type d -name $pack -exec rm -r {} +
    done
}
lltxupdate() {
    local sources=~/tex/packages
    local texmfhome=$(kpsewhich --var-value TEXMFHOME)
    for pack in $@; do
        find $texmfhome -type d -name $pack -exec rm -r {} +
        (cd $sources/$pack && make install TEXMFROOT=$texmfhome)
    done
}
lstexmfhome() {
    for dir in ~/texmf/tex/*/*; do
        echo ${dir##*/}
    done
}

The last one lists the packages installed in texmfhome, so I can easily know if
I'm using the system version or a locally installed version of something.

Manuel.

From khaledhosny at eglug.org  Sun May 30 17:43:30 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 18:43:30 +0300
Subject: [lltx] fc-list?
In-Reply-To: <836666B9-758E-4297-A210-17CB2E159547@gmail.com>
References: <4C026C6B.2090801@elzevir.fr> <20100530143455.GB3769@khaled-laptop>
	<836666B9-758E-4297-A210-17CB2E159547@gmail.com>
Message-ID: <20100530154330.GA4596@khaled-laptop>

On Mon, May 31, 2010 at 01:08:49AM +0930, Will Robertson wrote:
> On 31/05/2010, at 12:04 AM, Khaled Hosny wrote:
> 
> > On Sun, May 30, 2010 at 03:47:23PM +0200, Manuel P?gouri?-Gonnard wrote:
> >> Hi,
> >> 
> >> Just to be sure: is fc-list used at all under any circumstance by
> >> mkluatexfontdb? More precisely, does TL still needs to allow it to be run by
> >> restricted shell_escape?
> > 
> > No, we don't use it any more. Only the documentation need to be updated.
> 
> Why does the script still contain the --fc-cache option? Can all that code be deleted? Or is fc-cache still useful for finding the font locations?

Just an oversight, it should go away.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 17:44:08 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 30 May 2010 17:44:08 +0200
Subject: [lltx] make check
In-Reply-To: <47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<20100530140235.GD3126@khaled-laptop>
	<4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
Message-ID: <4C0287C8.700@elzevir.fr>

Le 30/05/2010 17:35, Will Robertson a ?crit :
> $ luatex tests/color.tex 
> [...]
> ! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
> alue).
> <to be read again> 
>                    \font 
> l.6 \font
>          \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...
> 
> 
> But if I first `cd tests` & then `luatex color.tex` then things work fine.
> Is `make check` not quite doing the right thing or is just that I'm still on TL09?
> 
The culprit is probably that files from the current working directory are found
first, so when you change your working directory, you also change the version
used (easy to check in the log).

I think the makefile is doing the right thing by running in the top-level
directory, so that the current version is hopefully used instead of the system
version.

Manuel.

From wspr81 at gmail.com  Sun May 30 17:57:26 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 31 May 2010 01:27:26 +0930
Subject: [lltx] fc-list?
In-Reply-To: <20100530154330.GA4596@khaled-laptop>
References: <4C026C6B.2090801@elzevir.fr> <20100530143455.GB3769@khaled-laptop>
	<836666B9-758E-4297-A210-17CB2E159547@gmail.com>
	<20100530154330.GA4596@khaled-laptop>
Message-ID: <E90BCC1D-1267-4D1F-8892-1D7BF23557E4@gmail.com>

On 31/05/2010, at 1:13 AM, Khaled Hosny wrote:

> On Mon, May 31, 2010 at 01:08:49AM +0930, Will Robertson wrote:
>> 
>> 
>> Why does the script still contain the --fc-cache option? Can all that code be deleted? Or is fc-cache still useful for finding the font locations?
> 
> Just an oversight, it should go away.

I'll do it now.

W



From khaledhosny at eglug.org  Sun May 30 17:58:57 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 18:58:57 +0300
Subject: [lltx] fc-list?
In-Reply-To: <E90BCC1D-1267-4D1F-8892-1D7BF23557E4@gmail.com>
References: <4C026C6B.2090801@elzevir.fr> <20100530143455.GB3769@khaled-laptop>
	<836666B9-758E-4297-A210-17CB2E159547@gmail.com>
	<20100530154330.GA4596@khaled-laptop>
	<E90BCC1D-1267-4D1F-8892-1D7BF23557E4@gmail.com>
Message-ID: <20100530155857.GA5051@khaled-laptop>

On Mon, May 31, 2010 at 01:27:26AM +0930, Will Robertson wrote:
> On 31/05/2010, at 1:13 AM, Khaled Hosny wrote:
> 
> > On Mon, May 31, 2010 at 01:08:49AM +0930, Will Robertson wrote:
> >> 
> >> 
> >> Why does the script still contain the --fc-cache option? Can all that code be deleted? Or is fc-cache still useful for finding the font locations?
> > 
> > Just an oversight, it should go away.
> 
> I'll do it now.

I just did, but I can't test it.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun May 30 18:01:38 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 19:01:38 +0300
Subject: [lltx] make check
In-Reply-To: <4C0287C8.700@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr>
Message-ID: <20100530160138.GB5051@khaled-laptop>

On Sun, May 30, 2010 at 05:44:08PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 17:35, Will Robertson a ?crit :
> > $ luatex tests/color.tex 
> > [...]
> > ! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
> > alue).
> > <to be read again> 
> >                    \font 
> > l.6 \font
> >          \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...
> > 
> > 
> > But if I first `cd tests` & then `luatex color.tex` then things work fine.
> > Is `make check` not quite doing the right thing or is just that I'm still on TL09?
> > 
> The culprit is probably that files from the current working directory are found
> first, so when you change your working directory, you also change the version
> used (easy to check in the log).
> 
> I think the makefile is doing the right thing by running in the top-level
> directory, so that the current version is hopefully used instead of the system
> version.

Note that, for some tests, names texligatures and opbd, luatex must be
run from the tests directory to find the *.fea files, otherwise the
visual result of the tests will be wrong.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 18:06:55 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 18:06:55 +0200
Subject: [lltx] make check
In-Reply-To: <20100530160138.GB5051@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
Message-ID: <4C028D1F.7040307@elzevir.fr>

Le 30/05/2010 18:01, Khaled Hosny a ?crit :
> Note that, for some tests, names texligatures and opbd, luatex must be
> run from the tests directory to find the *.fea files, otherwise the
> visual result of the tests will be wrong.
> 
I added --output-dir=tests to the invocation of luatex, which prepends "tests"
to TEXINPUTS (in addition to putting the output files in tests, which looks
cleaner), so it should solve this problem.

Manuel.

From khaledhosny at eglug.org  Sun May 30 18:09:32 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 19:09:32 +0300
Subject: [lltx] make check
In-Reply-To: <4C028D1F.7040307@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr>
Message-ID: <20100530160932.GA5203@khaled-laptop>

On Sun, May 30, 2010 at 06:06:55PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 18:01, Khaled Hosny a ?crit :
> > Note that, for some tests, names texligatures and opbd, luatex must be
> > run from the tests directory to find the *.fea files, otherwise the
> > visual result of the tests will be wrong.
> > 
> I added --output-dir=tests to the invocation of luatex, which prepends "tests"
> to TEXINPUTS (in addition to putting the output files in tests, which looks
> cleaner), so it should solve this problem.

I didn't know --output-dir works for input too, and I was wondering why
there isn't an --input-dir option.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sun May 30 18:10:59 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 31 May 2010 01:40:59 +0930
Subject: [lltx] fc-list?
In-Reply-To: <20100530155857.GA5051@khaled-laptop>
References: <4C026C6B.2090801@elzevir.fr> <20100530143455.GB3769@khaled-laptop>
	<836666B9-758E-4297-A210-17CB2E159547@gmail.com>
	<20100530154330.GA4596@khaled-laptop>
	<E90BCC1D-1267-4D1F-8892-1D7BF23557E4@gmail.com>
	<20100530155857.GA5051@khaled-laptop>
Message-ID: <80537EF8-D632-4480-A538-282DB3B00441@gmail.com>

On 31/05/2010, at 1:28 AM, Khaled Hosny wrote:

> I just did, but I can't test it.

Thanks.
The new version seems to work fine.

I had to move alt_getopts back into the local dir to run the script before I get it in some sort of global location. Assume that's fine.

-- Will



From mpg at elzevir.fr  Sun May 30 18:11:51 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 18:11:51 +0200
Subject: [lltx] make check
In-Reply-To: <20100530160932.GA5203@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<20100530140235.GD3126@khaled-laptop>
	<4C027248.3090302@elzevir.fr>	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>	<4C0287C8.700@elzevir.fr>
	<20100530160138.GB5051@khaled-laptop>	<4C028D1F.7040307@elzevir.fr>
	<20100530160932.GA5203@khaled-laptop>
Message-ID: <4C028E47.60702@elzevir.fr>

Le 30/05/2010 18:09, Khaled Hosny a ?crit :
> On Sun, May 30, 2010 at 06:06:55PM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 30/05/2010 18:01, Khaled Hosny a ?crit :
>>> Note that, for some tests, names texligatures and opbd, luatex must be
>>> run from the tests directory to find the *.fea files, otherwise the
>>> visual result of the tests will be wrong.
>>>
>> I added --output-dir=tests to the invocation of luatex, which prepends "tests"
>> to TEXINPUTS (in addition to putting the output files in tests, which looks
>> cleaner), so it should solve this problem.
> 
> I didn't know --output-dir works for input too,

It has to, since latex re-read some output files (most notably, the .aux file).

m

From khaledhosny at eglug.org  Sun May 30 18:13:33 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 19:13:33 +0300
Subject: [lltx] make check
In-Reply-To: <4C028D1F.7040307@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr>
Message-ID: <20100530161333.GB5203@khaled-laptop>

On Sun, May 30, 2010 at 06:06:55PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 18:01, Khaled Hosny a ?crit :
> > Note that, for some tests, names texligatures and opbd, luatex must be
> > run from the tests directory to find the *.fea files, otherwise the
> > visual result of the tests will be wrong.
> > 
> I added --output-dir=tests to the invocation of luatex, which prepends "tests"
> to TEXINPUTS (in addition to putting the output files in tests, which looks
> cleaner), so it should solve this problem.

BTW, systemfonts test loads some fonts that are not part of texlive
(even one of the fonts is likely to exits only on my desk :), not sure
if we should remove such fonts as it will make the test less useful
albeit more portable.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 18:14:50 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 30 May 2010 18:14:50 +0200
Subject: [lltx] fc-list?
In-Reply-To: <80537EF8-D632-4480-A538-282DB3B00441@gmail.com>
References: <4C026C6B.2090801@elzevir.fr>
	<20100530143455.GB3769@khaled-laptop>	<836666B9-758E-4297-A210-17CB2E159547@gmail.com>	<20100530154330.GA4596@khaled-laptop>	<E90BCC1D-1267-4D1F-8892-1D7BF23557E4@gmail.com>	<20100530155857.GA5051@khaled-laptop>
	<80537EF8-D632-4480-A538-282DB3B00441@gmail.com>
Message-ID: <4C028EFA.1060608@elzevir.fr>

Le 30/05/2010 18:10, Will Robertson a ?crit :
> I had to move alt_getopts back into the local dir to run the script before I get it in some sort of global location. Assume that's fine.
> 
Atm, you can
- put it anywhere in the tex trees (like ~/Library/texmf/tex), or
- put it in the current directory as you did, or
- adjust LUAINPUTS in your local texmf.cnf to the new default value:

LUAINPUTS = .;$TEXMF/scripts/{$progname,$engine,}/{lua,}//;$TEXINPUTS

Manuel.

From wspr81 at gmail.com  Sun May 30 18:15:37 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 31 May 2010 01:45:37 +0930
Subject: [lltx] make check
In-Reply-To: <4C028D1F.7040307@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr>
Message-ID: <AB01C474-FD42-41AE-ADF4-FE36D8AF368C@gmail.com>

On 31/05/2010, at 1:36 AM, Manuel P?gouri?-Gonnard wrote:

> Le 30/05/2010 18:01, Khaled Hosny a ?crit :
>> Note that, for some tests, names texligatures and opbd, luatex must be
>> run from the tests directory to find the *.fea files, otherwise the
>> visual result of the tests will be wrong.
>> 
> I added --output-dir=tests to the invocation of luatex, which prepends "tests"
> to TEXINPUTS (in addition to putting the output files in tests, which looks
> cleaner), so it should solve this problem.

Looks like it solves Khaled's problem but it doesn't fix mine... but I'm way to tired to debug anything. G'night.

-- Will

This is LuaTeX, Version beta-0.60.1-2010042812 (rev 3657)  (format=luatex 2010.5.17)  31 MAY 2010 01:42
**tests/color.tex
(./tests/color.tex (./luaotfload.sty (/Users/will/Library/texmf/tex/luatex/luat
extra/luatextra.sty (/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/if
luatex.sty
Package: ifluatex 2010/03/01 v1.3 Provides the ifluatex switch (HO)
Package ifluatex Info: LuaTeX detected.
) (/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-modutils.sty
Package: luatexbase-modutils 2010/05/27 v0.2a Module utilities for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-loader.sty
Package: luatexbase-loader 2010/05/27 v0.2a Lua module loader for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-compat.sty
Package: luatexbase-compat 2010/05/27 v0.2a Compatibility tools for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
))
(/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase.loader.lua))
(/Users/will/Library/texmf/tex/luatex/luatexbase/modutils.lua)) (/Users/will/Li
brary/texmf/tex/luatex/luatexbase/luatexbase-attr.sty
Package: luatexbase-attr 2010/05/27 v0.2a Attributes allocation for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-compat.sty) (/Use
rs/will/Library/texmf/tex/luatex/luatexbase/luatexbase-loader.sty)
(/Users/will/Library/texmf/tex/luatex/luatexbase/attr.lua)) (/Users/will/Librar
y/texmf/tex/luatex/luatexbase/luatexbase-cctb.sty
Package: luatexbase-cctb 2010/05/27 v0.2a Catcodetable allocation for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-loader.sty)
(/Users/will/Library/texmf/tex/luatex/luatexbase/cctb.lua) (/Users/will/Library
/texmf/tex/luatex/luatexbase/luatexbase-compat.sty)
\lltxb at catcodetable@alloc=\count27
\@tempcnta=\count28
\@tempcntb=\count29
\CatcodeTableIniTeX=\luatexcatcodetable1
\CatcodeTableString=\luatexcatcodetable2
\CatcodeTableOther=\luatexcatcodetable3
\CatcodeTableLaTeX=\luatexcatcodetable4
\CatcodeTableLaTeXAtLetter=\luatexcatcodetable5
\CatcodeTableExpl=\luatexcatcodetable6
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-regs.sty
Package: luatexbase-regs 2010/05/27 v0.2a Registers allocation for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
)) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-mcb.sty
Package: luatexbase-mcb 2010/05/27 v0.2a Callback management for LuaTeX
(/usr/local/texlive/2009/texmf-dist/tex/generic/oberdiek/ifluatex.sty
Package ifluatex Info: The package is already loaded.
) (/Users/will/Library/texmf/tex/luatex/luatexbase/luatexbase-modutils.sty)
(/Users/will/Library/texmf/tex/luatex/luatexbase/mcb.lua)
Lua module: luamcallbacks 2010/05/12 v0.20 register several functions in a call
back
)
(/Users/will/Library/texmf/tex/luatex/lualibs/lualibs.lua)
Lua module: lualibs 2010/05/21 v0.94 Lua additional functions.

lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-stri
ng.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-lpeg
.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-bool
ean.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-numb
er.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-math
.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-tabl
e.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-aux.
lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-io.l
ua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-os.l
ua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-file
.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-md5.
lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-dir.
lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-unic
ode.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-util
s.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-dime
n.lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-url.
lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-set.
lua
lualibs: loading file /Users/will/Library/texmf/tex/luatex/lualibs/lualibs-dime
n.lua
Lua module: luatextra 2010/05/10 v0.97 Additional low level functions for LuaTe
X

luamcallbacks: inserting function 'luatextra.open_read_file' at position 1 in c
allback list for 'open_read_file' (./luaotfload.sty))
(./luaotfload.lua)
Lua module: luaotfload 2010/05/30 v1.09 ConTeXt font loading system.

luaotfload: loading file ./otfl-luat-dum.lua.
luaotfload: loading file ./otfl-luat-ovr.lua.
luaotfload: loading file ./otfl-data-con.lua.
luaotfload: loading file ./otfl-node-ini.lua.
luaotfload: loading file ./otfl-node-res.lua.
luaotfload: loading file ./otfl-node-inj.lua.
luatexbase.attributes["otfl at markbase"] = 1
luatexbase.attributes["otfl at markmark"] = 2
luatexbase.attributes["otfl at markdone"] = 3
luatexbase.attributes["otfl at cursbase"] = 4
luatexbase.attributes["otfl at curscurs"] = 5
luatexbase.attributes["otfl at cursdone"] = 6
luatexbase.attributes["otfl at kernpair"] = 7
luaotfload: loading file ./otfl-node-fnt.lua.
luaotfload: loading file ./otfl-node-dum.lua.
luaotfload: loading file ./otfl-font-ini.lua.
luaotfload: loading file ./otfl-font-tfm.lua.
luatexbase.attributes["otfl at state"] = 8
luaotfload: loading file ./otfl-font-cid.lua.
luaotfload: loading file ./otfl-font-map.lua.
luaotfload: loading file ./otfl-font-ott.lua.
luaotfload: loading file ./otfl-font-otf.lua.
luaotfload: loading file ./otfl-font-otd.lua.
luaotfload: loading file ./otfl-font-oti.lua.
luaotfload: loading file ./otfl-font-otb.lua.
luaotfload: loading file ./otfl-font-otn.lua.
luaotfload: loading file ./otfl-font-ota.lua.
luaotfload: loading file ./otfl-font-otc.lua.
luaotfload: loading file ./otfl-font-def.lua.
luaotfload: loading file ./otfl-font-xtx.lua.
luaotfload: loading file ./otfl-font-dum.lua.
luaotfload: loading file ./otfl-font-nms.lua.
luaotfload: loading file ./otfl-font-clr.lua.
luamcallbacks: inserting function 'luaotfload.pre_linebreak_filter' at position
 1 in callback list for 'pre_linebreak_filter'
luamcallbacks: inserting function 'luaotfload.hpack_filter' at position 1 in ca
llback list for 'hpack_filter'
luamcallbacks: inserting function 'luaotfload.define_font' at position 1 in cal
lback list for 'define_font'
luamcallbacks: inserting function 'luaotfload.find_vf_file' at position 1 in ca
llback list for 'find_vf_file')
! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
alue).
<to be read again> 
                   \font 
l.6 \font
         \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...
The lua interpreter ran into a problem, so the
remainder of this lua chunk will be ignored.

! Font \testa=file:lmroman10-regular.otf:color=FF0000BB;+liga;+tlig;+trep at 10
pt  not loadable: metric data not found or bad.
<to be read again> 
                   \font 
l.6 \font
         \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep"...
I wasn't able to read the size data for this font,
so I will ignore the font specification.
[Wizards can fix TFM files using TFtoPL/PLtoTF.]
You might try inserting a different font spec;
e.g., type `I\font<same font id>=<substitute font name>'.

! LuaTeX error ./otfl-font-otf.lua:314: attempt to index local 'bb' (a number v
alue).
<to be read again> 
                   \testa 
l.7 \testa
           \input knuth \par
The lua interpreter ran into a problem, so the
remainder of this lua chunk will be ignored.

! Font \testb=file:lmroman10-regular.otf:color=FFFF0099;+liga;+tlig;+trep at 10
pt  not loadable: metric data not found or bad.
<to be read again> 
                   \testa 
l.7 \testa
           \input knuth \par
I wasn't able to read the size data for this font,
so I will ignore the font specification.
[Wizards can fix TFM files using TFtoPL/PLtoTF.]
You might try inserting a different font spec;
e.g., type `I\font<same font id>=<substitute font name>'.

(/usr/local/texlive/2009/texmf-dist/tex/context/sample/knuth.tex) (/usr/local/t
exlive/2009/texmf-dist/tex/context/sample/knuth.tex) [1{/usr/local/texlive/2009
/texmf-var/fonts/map/pdftex/updmap/pdftex.map}] )</usr/local/texlive/2009/texmf
-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
Output written on color.pdf (1 page, 8075 bytes).
PDF statistics: 12 PDF objects out of 1000 (max. 8388607)
 8 compressed objects within 1 object stream
 0 named destinations out of 1000 (max. 131072)
 1 words of extra memory for PDF output out of 10000 (max. 10000000)

 

From mpg at elzevir.fr  Sun May 30 18:18:57 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 18:18:57 +0200
Subject: [lltx] make check
In-Reply-To: <20100530161333.GB5203@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>	<20100530140235.GD3126@khaled-laptop>
	<4C027248.3090302@elzevir.fr>	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>	<4C0287C8.700@elzevir.fr>
	<20100530160138.GB5051@khaled-laptop>	<4C028D1F.7040307@elzevir.fr>
	<20100530161333.GB5203@khaled-laptop>
Message-ID: <4C028FF1.3010300@elzevir.fr>

Le 30/05/2010 18:13, Khaled Hosny a ?crit :
> BTW, systemfonts test loads some fonts that are not part of texlive
> (even one of the fonts is likely to exits only on my desk :), not sure
> if we should remove such fonts as it will make the test less useful
> albeit more portable.
> 
I suggest splitting the current "make check" in check and check-full, with check
using only fonts from TL, and check-full being the current check (or even,
check-tl, check-free with only free fonts commonly available, and check-full for
fonts that are commercial and/or harder to get).

Last time I tried, all test files except one were working fine for me (no
missing font), but I probably have a few system fonts installed.

Manuel.



From khaledhosny at eglug.org  Sun May 30 18:24:23 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 19:24:23 +0300
Subject: [lltx] make check
In-Reply-To: <4C028FF1.3010300@elzevir.fr>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr> <20100530161333.GB5203@khaled-laptop>
	<4C028FF1.3010300@elzevir.fr>
Message-ID: <20100530162423.GA5541@khaled-laptop>

On Sun, May 30, 2010 at 06:18:57PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 18:13, Khaled Hosny a ?crit :
> > BTW, systemfonts test loads some fonts that are not part of texlive
> > (even one of the fonts is likely to exits only on my desk :), not sure
> > if we should remove such fonts as it will make the test less useful
> > albeit more portable.
> > 
> I suggest splitting the current "make check" in check and check-full, with check
> using only fonts from TL, and check-full being the current check (or even,
> check-tl, check-free with only free fonts commonly available, and check-full for
> fonts that are commercial and/or harder to get).
> 
> Last time I tried, all test files except one were working fine for me (no
> missing font), but I probably have a few system fonts installed.

Checking again, all fonts used are avaiable on debian (I've different
version of the Arabic font, but it doesn't make diffrence). The split
seems fine with me, we can have for no a tl subset and + everything
else.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun May 30 18:29:47 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 30 May 2010 18:29:47 +0200
Subject: [lltx] make check
In-Reply-To: <20100530162423.GA5541@khaled-laptop>
References: <FE8E41F9-7DF5-4AFD-9B1F-9A08BE153112@me.com>
	<E5F367B3-4F48-47F4-9E62-AEEF38AD1D33@gmail.com>
	<20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr> <20100530161333.GB5203@khaled-laptop>
	<4C028FF1.3010300@elzevir.fr> <20100530162423.GA5541@khaled-laptop>
Message-ID: <4C02927B.6030503@elzevir.fr>

Le 30/05/2010 18:24, Khaled Hosny a ?crit :
> Checking again, all fonts used are avaiable on debian (I've different
> version of the Arabic font, but it doesn't make diffrence).

That's good news.

> The split
> seems fine with me, we can have for no a tl subset and + everything
> else.
> 
Ok. Do you want to take care of it, or should I do it? It's no problem for me to
do, but I'll not be doing it just right now (maybe tonight or tomorrow).

m


From khaledhosny at eglug.org  Sun May 30 19:33:00 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 30 May 2010 20:33:00 +0300
Subject: [lltx] make check
In-Reply-To: <4C02927B.6030503@elzevir.fr>
References: <20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr> <20100530161333.GB5203@khaled-laptop>
	<4C028FF1.3010300@elzevir.fr> <20100530162423.GA5541@khaled-laptop>
	<4C02927B.6030503@elzevir.fr>
Message-ID: <20100530173300.GA6792@khaled-laptop>

On Sun, May 30, 2010 at 06:29:47PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 30/05/2010 18:24, Khaled Hosny a ?crit :
> > Checking again, all fonts used are avaiable on debian (I've different
> > version of the Arabic font, but it doesn't make diffrence).
> 
> That's good news.
> 
> > The split
> > seems fine with me, we can have for no a tl subset and + everything
> > else.
> > 
> Ok. Do you want to take care of it, or should I do it? It's no problem for me to
> do, but I'll not be doing it just right now (maybe tonight or tomorrow).

I don't smoke makefiles :) so it is all yours.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From kakuto at fuk.kindai.ac.jp  Mon May 31 05:44:57 2010
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Mon, 31 May 2010 12:44:57 +0900
Subject: [lltx] [tex-live] fontspec for LuaTeX
In-Reply-To: <E9D36DEF-7ED4-47C3-8D18-17B09753DCFA@gmail.com>
References: <E9D36DEF-7ED4-47C3-8D18-17B09753DCFA@gmail.com>
Message-ID: <127527749764261000002a63@sniffer>

Hi Will,

> > I excluded a directory where there are some problematic fonts.
> > Now mkluatexfontdb works fine if I remove line 486 in
> > otfl-font-nms.lua.
> 
> Are these excluded fonts anything we should be dealing with
> systematically? There's a font in Mac OS X that we're purposefully
> ignoring and we are intending on extending this mechanism for
>  general fonts.

I didn't dentify which font caused a problem.

Best regards,
Akira


From elie.roux at telecom-bretagne.eu  Mon May 31 09:22:09 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 31 May 2010 10:22:09 +0300
Subject: [lltx] [tex-live] fontspec for LuaTeX
In-Reply-To: <127527749764261000002a63@sniffer>
References: <E9D36DEF-7ED4-47C3-8D18-17B09753DCFA@gmail.com>
	<127527749764261000002a63@sniffer>
Message-ID: <4C0363A1.6070709@telecom-bretagne.eu>

Akira Kakuto a ?crit :
> I didn't dentify which font caused a problem.

Hello,

would you find time to run some more tests about it? It would be very 
useful for us to know which fonts to blacklist, it would help quite a 
lot of people certainly.

Thank you,
-- 
Elie

From mpg at elzevir.fr  Mon May 31 14:51:19 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 31 May 2010 14:51:19 +0200
Subject: [lltx] make check
In-Reply-To: <20100530173300.GA6792@khaled-laptop>
References: <20100530140235.GD3126@khaled-laptop> <4C027248.3090302@elzevir.fr>
	<47377146-A262-4E09-A031-E77F3A373D64@gmail.com>
	<4C0287C8.700@elzevir.fr> <20100530160138.GB5051@khaled-laptop>
	<4C028D1F.7040307@elzevir.fr> <20100530161333.GB5203@khaled-laptop>
	<4C028FF1.3010300@elzevir.fr> <20100530162423.GA5541@khaled-laptop>
	<4C02927B.6030503@elzevir.fr> <20100530173300.GA6792@khaled-laptop>
Message-ID: <4C03B0C7.9040902@elzevir.fr>

Le 30/05/2010 19:33, Khaled Hosny a ?crit :
> On Sun, May 30, 2010 at 06:29:47PM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 30/05/2010 18:24, Khaled Hosny a ?crit :
>>> The split
>>> seems fine with me, we can have for no a tl subset and + everything
>>> else.
>>>
>> Ok. Do you want to take care of it, or should I do it? It's no problem for me to
>> do, but I'll not be doing it just right now (maybe tonight or tomorrow).
> 
> I don't smoke makefiles :) so it is all yours.
> 
Done.

m

From mpg at elzevir.fr  Mon May 31 15:02:52 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 31 May 2010 15:02:52 +0200
Subject: [lltx] mkluatexfontdb & svn
Message-ID: <4C03B37C.1040004@elzevir.fr>

Hi,

I usually run TeX Live live (no kidding) from the SVN tree. I noticed it seems
to disturb luaotfload, presumably because a lot of wrong files (from the .svn
subdirectories) end up listed in the cache (on a regular installation, I've got
no problem).

I suggest explicitly excluding those directories during exploration of the font
trees, just as mktexlsr does. More precisely, directories matching the following
(sed) regex (taken from mktexlsr code) should be excluded:

\.\(bzr\|git\|hg\|svn\)\|CVS\|RCS\|_darcs

(to be reimplemented in lua as using a hash of forbidden values I guess, since
lua regexes do not support alternation).

Thanks,
Manuel.

From khaledhosny at eglug.org  Mon May 31 15:24:03 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 31 May 2010 16:24:03 +0300
Subject: [lltx] mkluatexfontdb & svn
In-Reply-To: <4C03B37C.1040004@elzevir.fr>
References: <4C03B37C.1040004@elzevir.fr>
Message-ID: <20100531132403.GA19731@khaled-laptop>

On Mon, May 31, 2010 at 03:02:52PM +0200, Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I usually run TeX Live live (no kidding) from the SVN tree. I noticed it seems
> to disturb luaotfload, presumably because a lot of wrong files (from the .svn
> subdirectories) end up listed in the cache (on a regular installation, I've got
> no problem).

I don't understand this, files in .svn directories usually have
.svn-base suffix and thus will be ignored by luaotfload. I'd like to
know more details about the issues you have.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon May 31 17:07:39 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 31 May 2010 17:07:39 +0200
Subject: [lltx] mkluatexfontdb & svn
In-Reply-To: <20100531132403.GA19731@khaled-laptop>
References: <4C03B37C.1040004@elzevir.fr>
	<20100531132403.GA19731@khaled-laptop>
Message-ID: <4C03D0BB.4050109@elzevir.fr>

Le 31/05/2010 15:24, Khaled Hosny a ?crit :
> On Mon, May 31, 2010 at 03:02:52PM +0200, Manuel P?gouri?-Gonnard wrote:
>> I usually run TeX Live live (no kidding) from the SVN tree. I noticed it seems
>> to disturb luaotfload, presumably because a lot of wrong files (from the .svn
>> subdirectories) end up listed in the cache (on a regular installation, I've got
>> no problem).
> 
> I don't understand this, files in .svn directories usually have
> .svn-base suffix and thus will be ignored by luaotfload. I'd like to
> know more details about the issues you have.
> 
Excerpt from my name cache file (2nd entry in the "mappings" table):

  {
   ["familyname"]="Asana Math",
   ["filename"]={ "Asana-Math.otf.svn-base", false },
   ["fontname"]="Asana-Math",
   -- ...

Also, running from the svn tree the last but one line of output reads:

luaotfload | 1647 fonts in the database

and on a normal installation it is:

luaotfload | 1252 fonts in the database

So I guess the extension filtering code needs to be fixed.

Even if the extension is enough to rule the files out in the svn case, I still
think it's a good idea to exclude known vcs directories, since:
- we (at least I) don't know about all other vcs'es;
- it save some time anyway.

Manuel.



From khaledhosny at eglug.org  Mon May 31 19:16:00 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 31 May 2010 20:16:00 +0300
Subject: [lltx] mkluatexfontdb & svn
In-Reply-To: <4C03D0BB.4050109@elzevir.fr>
References: <4C03B37C.1040004@elzevir.fr>
	<20100531132403.GA19731@khaled-laptop>
	<4C03D0BB.4050109@elzevir.fr>
Message-ID: <20100531171600.GA5608@khaled-laptop>

On Mon, May 31, 2010 at 05:07:39PM +0200, Manuel P?gouri?-Gonnard wrote:
> Excerpt from my name cache file (2nd entry in the "mappings" table):
> 
>   {
>    ["familyname"]="Asana Math",
>    ["filename"]={ "Asana-Math.otf.svn-base", false },
>    ["fontname"]="Asana-Math",
>    -- ...
> 
> Also, running from the svn tree the last but one line of output reads:
> 
> luaotfload | 1647 fonts in the database
> 
> and on a normal installation it is:
> 
> luaotfload | 1252 fonts in the database
> 
> So I guess the extension filtering code needs to be fixed.

This is fixed now, or so I hope.

> Even if the extension is enough to rule the files out in the svn case, I still
> think it's a good idea to exclude known vcs directories, since:
> - we (at least I) don't know about all other vcs'es;
> - it save some time anyway.

dir.glob() seems to be pretty cheap, so I didn't bother ignoring those
directory right now, if it is still an issue I'll try to look at it
(some code needs refactoring first etc.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon May 31 19:46:52 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 31 May 2010 19:46:52 +0200
Subject: [lltx] mkluatexfontdb & svn
In-Reply-To: <20100531171600.GA5608@khaled-laptop>
References: <4C03B37C.1040004@elzevir.fr>	<20100531132403.GA19731@khaled-laptop>	<4C03D0BB.4050109@elzevir.fr>
	<20100531171600.GA5608@khaled-laptop>
Message-ID: <4C03F60C.9060104@elzevir.fr>

Le 31/05/2010 19:16, Khaled Hosny a ?crit :
>> So I guess the extension filtering code needs to be fixed.
> 
> This is fixed now, or so I hope.
> 
Works for me. Thanks.

M.

