From khaledhosny at eglug.org  Sun Sep 12 13:51:41 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 12 Sep 2010 14:51:41 +0300
Subject: [lltx] luamplib problem
In-Reply-To: <4C6C071B.2000308@telecom-bretagne.eu>
References: <97357B72-5AED-4825-9DEA-08E94F15E56D@me.com>
	<4C5E6FC5.10408@telecom-bretagne.eu>
	<4C5E72D2.8030203@elvenkind.com>
	<4C5E7D30.3060101@telecom-bretagne.eu>
	<1F2D7B16-318E-49C1-A2EB-27963F413F83@gmail.com>
	<4C6C071B.2000308@telecom-bretagne.eu>
Message-ID: <20100912115141.GA3608@khaled-laptop>

On Wed, Aug 18, 2010 at 06:15:23PM +0200, Elie Roux wrote:
> Will Robertson a ?crit :
> >>the plan is for me to leave any software activity behind me in september, so it would be useful is someone took the package...
> 
> Hello,
> 
> I certainly should have brought this more solemnly, but yes, that's
> the idea...

I'm sorry to hear that, but in such case I'd be interested in
maintaining luamplib.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From texworld at laposte.net  Sun Sep 12 20:05:18 2010
From: texworld at laposte.net (TeXWorld)
Date: Sun, 12 Sep 2010 20:05:18 +0200
Subject: [lltx] [Fontspec] Problem with \addfontfeature
Message-ID: <4C8D165E.2020602@laposte.net>

  Hello,

Here's my system :
Windows Seven
TL 2010
LuaTeX 0.63.0-2010090911 (rev 3872)
Fontspec v2.0b
TeX Gyre Bonum is installed.

I tried to test the code from the Fontspec documentation page 15. Here's 
my code :


\documentclass{article}

\usepackage{xcolor}

\usepackage{fontspec}

\begin{document}

\fontsize{48}{48}

\fontspec{TeX Gyre Bonum Bold}

{\addfontfeature{Color=FF000099}W}\kern-1ex

{\addfontfeature{Color=0000FF99}S}\kern-0.8ex

{\addfontfeature{Color=DDBB2299}P}\kern-0.8ex

{\addfontfeature{Color=00BB3399}R}

\end{document}



When I compile it with XeLaTeX it works except that I have to 
transparency (of course I run Windows...).

The Problem is with LuaLaTeX. I get the following error message :

luaotfload | Font names database loaded: C:/Users/jack/.texlive2010/texmf-v

ar/luatex-cache/generic/names/otfl-names.lua(load: c:/Users/jack/.texlive20

10/texmf-var/luatex-cache/generic/fonts/otf/temp-texgyrebonum-bold.lua)error: 
...0/texmf-dist/tex/luatex/luaotfload/otfl-font-clr.lua:31: bad argument 
#1 to 'tonumber' (string expected, got nil)

.

\newpage ...erypar {}\fi \par \vfil \penalty -\@M

l.11 \end{document}

?





From khaledhosny at eglug.org  Sun Sep 12 22:09:03 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 12 Sep 2010 23:09:03 +0300
Subject: [lltx] [Fontspec] Problem with \addfontfeature
In-Reply-To: <4C8D165E.2020602@laposte.net>
References: <4C8D165E.2020602@laposte.net>
Message-ID: <20100912200903.GA8238@khaled-laptop>

On Sun, Sep 12, 2010 at 08:05:18PM +0200, TeXWorld wrote:
>  Hello,
> 
> Here's my system :
> Windows Seven
> TL 2010
> LuaTeX 0.63.0-2010090911 (rev 3872)
> Fontspec v2.0b
> TeX Gyre Bonum is installed.
> 
> I tried to test the code from the Fontspec documentation page 15.
> Here's my code :

For some reason, fontspec is passing invalid colour code, instead of
00BB3399 it passes 00BB3399FF (wit extra FF), and luaotfload does not
attempt to sanitize such broken color code.

An extra check can be added to luaotfload, but fontspec should be
passing correct color code.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Sep 13 04:46:38 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 13 Sep 2010 05:46:38 +0300
Subject: [lltx] [Fontspec] Problem with \addfontfeature
In-Reply-To: <20100912200903.GA8238@khaled-laptop>
References: <4C8D165E.2020602@laposte.net>
	<20100912200903.GA8238@khaled-laptop>
Message-ID: <20100913024638.GA11694@khaled-laptop>

On Sun, Sep 12, 2010 at 11:09:03PM +0300, Khaled Hosny wrote:
> On Sun, Sep 12, 2010 at 08:05:18PM +0200, TeXWorld wrote:
> >  Hello,
> > 
> > Here's my system :
> > Windows Seven
> > TL 2010
> > LuaTeX 0.63.0-2010090911 (rev 3872)
> > Fontspec v2.0b
> > TeX Gyre Bonum is installed.
> > 
> > I tried to test the code from the Fontspec documentation page 15.
> > Here's my code :
> 
> For some reason, fontspec is passing invalid colour code, instead of
> 00BB3399 it passes 00BB3399FF (wit extra FF), and luaotfload does not
> attempt to sanitize such broken color code.
> 
> An extra check can be added to luaotfload, but fontspec should be
> passing correct color code.

The version of luaotfload on github does this now, so your example
compiles fine (and gives transparency).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mailing_list at arcor.de  Mon Sep 13 18:27:44 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 13 Sep 2010 18:27:44 +0200
Subject: [lltx] problem with luamplib from TL2010 (pretest)
Message-ID: <4C8E5100.2020701@arcor.de>

Hi,

I have a problem with luamplib v1.03 and lualatex v0.60.2 from TL2010 
pretest (updated today).  The following TeX example successfully runs 
through luatex:

\input luamplib.sty
\mplibcode
beginfig(1);
         draw fullcircle scaled 100;
endfig;
\endmplibcode
\bye

But this similar LaTeX example cannot be processed by lualatex:

\listfiles
\documentclass{article}
\usepackage{luamplib}
\begin{document}
\begin{mplibcode}
beginfig(1);
draw fullcircle scaled 100;
endfig;
\end{mplibcode}
\end{document}


The resulting pdf file contains the literal line

   luamplib.processlines()

plus page number.  Log file attached.

Best regards,
Stephan Hennig


 > >lualatex latex-luatex
> This is LuaTeX, Version beta-0.60.2-2010071421 (Web2C 2010) (rev 3736)  (format=lualatex 2010.8.31)  13 SEP 2010 18:05
>  restricted \write18 enabled.
> **latex-luatex.tex
> (./latex-luatex.tex
> LaTeX2e <2009/09/24>
> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns for engl
> ish, dumylang, nohyphenation, loaded.
> (f:/texlive/2010/texmf-dist/tex/latex/base/article.cls
> Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
> (f:/texlive/2010/texmf-dist/tex/latex/base/size10.clo
> File: size10.clo 2007/10/19 v1.4h Standard LaTeX file (size option)
> )
> \c at part=\count79
> \c at section=\count80
> \c at subsection=\count81
> \c at subsubsection=\count82
> \c at paragraph=\count83
> \c at subparagraph=\count84
> \c at figure=\count85
> \c at table=\count86
> \abovecaptionskip=\skip41
> \belowcaptionskip=\skip42
> \bibindent=\dimen102
> )
> (f:/texlive/2010/texmf-dist/tex/luatex/luamplib/luamplib.sty
> Package: luamplib 2010/05/10 v1.03 mplib package for LuaTeX.
>
> (f:/texlive/2010/texmf-dist/tex/luatex/luatexbase/luatexbase-modutils.sty
> Package: luatexbase-modutils 2010/05/27 v0.2a Module utilities for LuaTeX
>
> (f:/texlive/2010/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package: ifluatex 2010/03/01 v1.3 Provides the ifluatex switch (HO)
> Package ifluatex Info: LuaTeX detected.
> )
> (f:/texlive/2010/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty
> Package: luatexbase-loader 2010/05/27 v0.2a Lua module loader for LuaTeX
>
> (f:/texlive/2010/texmf-dist/tex/luatex/luatexbase/luatexbase-compat.sty
> Package: luatexbase-compat 2010/05/27 v0.2a Compatibility tools for LuaTeX
> )
> (f:/texlive/2010/texmf-dist/tex/luatex/luatexbase/luatexbase.loader.lua))
> (f:/texlive/2010/texmf-dist/tex/luatex/luatexbase/modutils.lua))
> (f:/texlive/2010/texmf-dist/tex/latex/fancyvrb/fancyvrb.sty
> Package: fancyvrb 2008/02/07
>
> Style option: `fancyvrb' v2.7a, with DG/SPQR fixes, and firstline=lastline fix
> <2008/02/07> (tvz) (f:/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty
> Package: keyval 1999/03/16 v1.13 key=value parser (DPC)
> \KV at toks@=\toks14
> )
> \FV at CodeLineNo=\count87
> \FV at InFile=\read1
> \FV at TabBox=\box26
> \c at FancyVerbLine=\count88
> \FV at StepNumber=\count89
> \FV at OutFile=\write3
> )
> (f:/texlive/2010/texmf-dist/tex/luatex/luamplib/luamplib.lua)
> Lua module: luamplib 2010/05/10 v1.03 Lua package to typeset Metapost with LuaT
> eX's MPLib.
> \mplibscratchbox=\box27
> )
> No file latex-luatex.aux.
> LaTeX Font Info:    Checking defaults for OML/cmm/m/it on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> LaTeX Font Info:    Checking defaults for T1/cmr/m/n on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> LaTeX Font Info:    Checking defaults for OT1/cmr/m/n on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> LaTeX Font Info:    Checking defaults for OMS/cmsy/m/n on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> LaTeX Font Info:    Checking defaults for OMX/cmex/m/n on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> LaTeX Font Info:    Checking defaults for U/cmr/m/n on input line 4.
> LaTeX Font Info:    ... okay on input line 4.
> ! Undefined control sequence.
> \endmplibcode ...plibaddlines {memoire}\luadirect
>                                                   {luamplib.processlines()}
> l.9 \end{mplibcode}
>
> ?
> [1
>
> {f:/texlive/2010/texmf-var/fonts/map/pdftex/updmap/pdftex.map}]
> (./latex-luatex.aux)
>
>  *File List*
>  article.cls    2007/10/19 v1.4h Standard LaTeX document class
>   size10.clo    2007/10/19 v1.4h Standard LaTeX file (size option)
> luamplib.sty    2010/05/10 v1.03 mplib package for LuaTeX.
> luatexbase-modutils.sty    2010/05/27 v0.2a Module utilities for LuaTeX
> ifluatex.sty    2010/03/01 v1.3 Provides the ifluatex switch (HO)
> luatexbase-loader.sty    2010/05/27 v0.2a Lua module loader for LuaTeX
> luatexbase-compat.sty    2010/05/27 v0.2a Compatibility tools for LuaTeX
> fancyvrb.sty    2008/02/07
>   keyval.sty    1999/03/16 v1.13 key=value parser (DPC)
>  ***********
>
>  )
>
> Here is how much of LuaTeX's memory you used:
>  688 strings out of 257265
>  100000,89155 words of node,token memory allocated
>  259 words of node memory still in use:
>    2 hlist, 1 vlist, 1 rule, 2 glue, 39 glue_spec, 1 write nodes
>    avail lists: 2:12,3:2,4:22,5:1,6:33,7:1,9:6,10:3
>  4208 multiletter control sequences out of 65536+200000
>  15 fonts using 431807 bytes
>  39i,4n,23p,163b,110s stack positions out of 5000i,500n,6000p,200000b,50000s
> <f:/texlive/2010/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
> Output written on latex-luatex.pdf (1 page, 13324 bytes).
> PDF statistics: 12 PDF objects out of 1000 (max. 8388607)
>  7 compressed objects within 1 object stream
>  0 named destinations out of 1000 (max. 131072)
>  1 words of extra memory for PDF output out of 10000 (max. 10000000)
>

From news3 at nililand.de  Mon Sep 13 18:59:17 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 13 Sep 2010 18:59:17 +0200
Subject: [lltx] problem with luamplib from TL2010 (pretest)
References: <4C8E5100.2020701@arcor.de>
Message-ID: <1tq7ldsqb55lh.dlg@nililand.de>

Am Mon, 13 Sep 2010 18:27:44 +0200 schrieb Stephan Hennig:

> Hi,
> 
> I have a problem with luamplib v1.03 and lualatex v0.60.2 from TL2010 
> pretest (updated today).  The following TeX example successfully runs 
> through luatex:
> 
> \input luamplib.sty
> \mplibcode
> beginfig(1);
>          draw fullcircle scaled 100;
> endfig;
> \endmplibcode
> \bye
> 
> But this similar LaTeX example cannot be processed by lualatex:
> 
> \listfiles
> \documentclass{article}
> \usepackage{luamplib}
> \begin{document}
> \begin{mplibcode}
> beginfig(1);
> draw fullcircle scaled 100;
> endfig;
> \end{mplibcode}
> \end{document}
> 
> 
> The resulting pdf file contains the literal line
> 
>    luamplib.processlines()
> 
> plus page number.  Log file attached.

>> ! Undefined control sequence.
>> \endmplibcode ...plibaddlines {memoire}\luadirect
>>                                                   {luamplib.processlines()}
>> l.9 \end{mplibcode}

Well I do have luamplib version 1.04 which avoids this error (it
should be \directlua instead of \luadirect I think) but now gives
another error with luatex and lualatex:

! LuaTeX error j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: bad
argument #2 to 'format' (string expected, got nil)
stack traceback:
	
[C]: in function 'format'
	
j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: in function 'log'
	
j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:124: in function
'load'
	j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:170: in
function 'process'
	<\directlua >:1: in main chunk.
\mplibprocess
...ectlua {luamplib.process([[#1]])}




-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Sep 13 19:04:12 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 13 Sep 2010 20:04:12 +0300
Subject: [lltx] problem with luamplib from TL2010 (pretest)
In-Reply-To: <4C8E5100.2020701@arcor.de>
References: <4C8E5100.2020701@arcor.de>
Message-ID: <20100913170412.GA31847@khaled-laptop>

On Mon, Sep 13, 2010 at 06:27:44PM +0200, Stephan Hennig wrote:
> Hi,
> 
> I have a problem with luamplib v1.03 and lualatex v0.60.2 from
> TL2010 pretest (updated today).  The following TeX example
> successfully runs through luatex:
> 
> \input luamplib.sty
> \mplibcode
> beginfig(1);
>         draw fullcircle scaled 100;
> endfig;
> \endmplibcode
> \bye
> 
> But this similar LaTeX example cannot be processed by lualatex:
> 
> \listfiles
> \documentclass{article}
> \usepackage{luamplib}
> \begin{document}
> \begin{mplibcode}
> beginfig(1);
> draw fullcircle scaled 100;
> endfig;
> \end{mplibcode}
> \end{document}
> 
> 
> The resulting pdf file contains the literal line
> 
>   luamplib.processlines()
> 
> plus page number.  Log file attached.

Compiles file with version from github, alternatively you can open the
luamplib.sty file and replace `\luadirect` with `\diectlua`.
BTW, texlive2010 is now officially released, may be you want to replace
the pretest repository to get further updates.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mailing_list at arcor.de  Mon Sep 13 19:21:08 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 13 Sep 2010 19:21:08 +0200
Subject: [lltx] problem with luamplib from TL2010 (pretest)
In-Reply-To: <20100913170412.GA31847@khaled-laptop>
References: <4C8E5100.2020701@arcor.de> <20100913170412.GA31847@khaled-laptop>
Message-ID: <4C8E5D84.9060509@arcor.de>

Am 13.09.2010 19:04, schrieb Khaled Hosny:

> Compiles file with version from github,

That solves the problem here.  Thanks!


> BTW, texlive2010 is now officially released, may be you want to replace
> the pretest repository to get further updates.

Do you know if that is necessary?  I have changed the reference 
repository and did receive several updates today that (I think) were not 
in the pretest repository (latexmk, Libertine, fontspec, unicode-math etc.)

Best regards,
Stephan Hennig

From khaledhosny at eglug.org  Mon Sep 13 19:24:52 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 13 Sep 2010 20:24:52 +0300
Subject: [lltx] problem with luamplib from TL2010 (pretest)
In-Reply-To: <1tq7ldsqb55lh.dlg@nililand.de>
References: <4C8E5100.2020701@arcor.de>
 <1tq7ldsqb55lh.dlg@nililand.de>
Message-ID: <20100913172452.GB31847@khaled-laptop>

On Mon, Sep 13, 2010 at 06:59:17PM +0200, Ulrike Fischer wrote:
> Am Mon, 13 Sep 2010 18:27:44 +0200 schrieb Stephan Hennig:
> 
> > Hi,
> > 
> > I have a problem with luamplib v1.03 and lualatex v0.60.2 from TL2010 
> > pretest (updated today).  The following TeX example successfully runs 
> > through luatex:
> > 
> > \input luamplib.sty
> > \mplibcode
> > beginfig(1);
> >          draw fullcircle scaled 100;
> > endfig;
> > \endmplibcode
> > \bye
> > 
> > But this similar LaTeX example cannot be processed by lualatex:
> > 
> > \listfiles
> > \documentclass{article}
> > \usepackage{luamplib}
> > \begin{document}
> > \begin{mplibcode}
> > beginfig(1);
> > draw fullcircle scaled 100;
> > endfig;
> > \end{mplibcode}
> > \end{document}
> > 
> > 
> > The resulting pdf file contains the literal line
> > 
> >    luamplib.processlines()
> > 
> > plus page number.  Log file attached.
> 
> >> ! Undefined control sequence.
> >> \endmplibcode ...plibaddlines {memoire}\luadirect
> >>                                                   {luamplib.processlines()}
> >> l.9 \end{mplibcode}
> 
> Well I do have luamplib version 1.04 which avoids this error (it
> should be \directlua instead of \luadirect I think) but now gives
> another error with luatex and lualatex:
> 
> ! LuaTeX error j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: bad
> argument #2 to 'format' (string expected, got nil)
> stack traceback:
> 	
> [C]: in function 'format'
> 	
> j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: in function 'log'
> 	
> j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:124: in function
> 'load'
> 	j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:170: in
> function 'process'
> 	<\directlua >:1: in main chunk.
> \mplibprocess
> ...ectlua {luamplib.process([[#1]])}

I can't reproduce this, but indeed `luamplib.finder()` is returning
nil. May be you need to run `luamplib-createmem.lua` script to create a
mem file, seems miktex does not provide one by default.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Sep 13 19:25:58 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 13 Sep 2010 20:25:58 +0300
Subject: [lltx] problem with luamplib from TL2010 (pretest)
In-Reply-To: <4C8E5D84.9060509@arcor.de>
References: <4C8E5100.2020701@arcor.de> <20100913170412.GA31847@khaled-laptop>
	<4C8E5D84.9060509@arcor.de>
Message-ID: <20100913172558.GC31847@khaled-laptop>

On Mon, Sep 13, 2010 at 07:21:08PM +0200, Stephan Hennig wrote:
> Am 13.09.2010 19:04, schrieb Khaled Hosny:
> 
> >Compiles file with version from github,
> 
> That solves the problem here.  Thanks!
> 
> 
> >BTW, texlive2010 is now officially released, may be you want to replace
> >the pretest repository to get further updates.
> 
> Do you know if that is necessary?  I have changed the reference
> repository and did receive several updates today that (I think) were
> not in the pretest repository (latexmk, Libertine, fontspec,
> unicode-math etc.)

I'm not sure, but that what I did myself, just in case.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From news3 at nililand.de  Tue Sep 14 10:03:58 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Tue, 14 Sep 2010 10:03:58 +0200
Subject: [lltx] problem with luamplib from TL2010 (pretest)
References: <4C8E5100.2020701@arcor.de> <1tq7ldsqb55lh.dlg@nililand.de>
	<20100913172452.GB31847@khaled-laptop>
Message-ID: <5jw94yrma60i.dlg@nililand.de>

Am Mon, 13 Sep 2010 20:24:52 +0300 schrieb Khaled Hosny:


>> Well I do have luamplib version 1.04 which avoids this error (it
>> should be \directlua instead of \luadirect I think) but now gives
>> another error with luatex and lualatex:
>> 
>> ! LuaTeX error j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: bad
>> argument #2 to 'format' (string expected, got nil)
>> stack traceback:
>> 	
>> [C]: in function 'format'
>> 	
>> j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:74: in function 'log'
>> 	
>> j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:124: in function
>> 'load'
>> 	j:/MIKTEX2.7/tex/luatex/luamplib/luamplib.lua:170: in
>> function 'process'
>> 	<\directlua >:1: in main chunk.
>> \mplibprocess
>> ...ectlua {luamplib.process([[#1]])}

> I can't reproduce this, but indeed `luamplib.finder()` is returning
> nil. May be you need to run `luamplib-createmem.lua` script to create a
> mem file, seems miktex does not provide one by default.

It is naturally possible that it is a problem with my installation,
as it is partly miktex partly a mini texlive. But the documentation
says that a mem is not actually needed and it worked last time I
tried (end of july). 

Also I just saw that the same error is mentioned two threads below
(8. August) where Taco mentioned that some code should be added to
luamplib. 

Like mentioned there I too can't create a mem with the lua script,
it tells me "dumping format plain in mplib-luatex.mem" but no file
is generated. 

My luatex version is currently beta-0.62.0-2010081917. 

-- 
Ulrike Fischer 


From joelcsalomon at gmail.com  Tue Sep 14 19:30:51 2010
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Tue, 14 Sep 2010 13:30:51 -0400
Subject: [lltx] unicode-math breakage with newest TL '10 update
Message-ID: <4C8FB14B.2060303@gmail.com>

(Technically this is OT for the X?TeX list, but I suspect the folks who
can help me are here?)

Minimal test case:
	% !TEX TS-program = lualatex
	\documentclass{minimal}
	
	\usepackage{unicode-math}
	\setmathfont{Cambria Math}
	
	\begin{document}
	\[
		\dot x + \ddot y
	\]
	\end{document}
Works with X?LaTeX, but LuaLatex gives me this error:

luaotfload | Font names database loaded:
/home/chesky/.texlive2010/texmf-var/luatex-cache/generic/names/otfl-names.lua(load:
/home/chesky/.texlive2010/texmf-var/luatex-cache/generic/fonts/otf/temp-cambria-cambria-math-1.lua)
! Missing control sequence inserted.
<inserted text>
                \inaccessible
l.5 \setmathfont{Cambria Math}

? h
Please don't say `\def cs{...}', say `\def\cs{...}'.
I've inserted an inaccessible control sequence so that your
definition will be completed without mixing me up too badly.
You can recover graciously from this error, if you're
careful; see exercise 27.2 in The TeXbook.
?

Any clues?

?Joel

From ulrik.vieth at arcor.de  Tue Sep 14 20:38:18 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Tue, 14 Sep 2010 20:38:18 +0200 (CEST)
Subject: [lltx] unicode-math breakage with newest TL '10 update
In-Reply-To: <4C8FB14B.2060303@gmail.com>
References: <4C8FB14B.2060303@gmail.com>
Message-ID: <1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>

I can confirm that the problem exists in LuaLaTeX, but not in XeLaTeX,
so I would attribute the problem to the latest update of luaotfload,
which was updated from 1.18 to 1.19 today. Khaled, can you check?

Regards, Ulrik


----- Original Nachricht ----
Von:     "Joel C. Salomon" <joelcsalomon at gmail.com>
An:      lualatex-dev at tug.org, xetex at tug.org
Datum:   14.09.2010 19:30
Betreff: [lltx] unicode-math breakage with newest TL '10 update

> (Technically this is OT for the X?TeX list, but I suspect the folks who
> can help me are here?)
> 
> Minimal test case:
> 	% !TEX TS-program = lualatex
> 	\documentclass{minimal}
> 	
> 	\usepackage{unicode-math}
> 	\setmathfont{Cambria Math}
> 	
> 	\begin{document}
> 	\[
> 		\dot x + \ddot y
> 	\]
> 	\end{document}
> Works with X?LaTeX, but LuaLatex gives me this error:
> 
> luaotfload | Font names database loaded:
> /home/chesky/.texlive2010/texmf-var/luatex-cache/generic/names/otfl-names.lu
> a(load:
> /home/chesky/.texlive2010/texmf-var/luatex-cache/generic/fonts/otf/temp-camb
> ria-cambria-math-1.lua)
> ! Missing control sequence inserted.
> <inserted text>
>                 \inaccessible
> l.5 \setmathfont{Cambria Math}
> 
> ? h
> Please don't say `\def cs{...}', say `\def\cs{...}'.
> I've inserted an inaccessible control sequence so that your
> definition will be completed without mixing me up too badly.
> You can recover graciously from this error, if you're
> careful; see exercise 27.2 in The TeXbook.
> ?
> 
> Any clues?
> 
> ?Joel
> 

From st_philipp at yahoo.de  Tue Sep 14 20:40:31 2010
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Tue, 14 Sep 2010 20:40:31 +0200
Subject: [lltx] Invalid entries in the font database
Message-ID: <B832CB4C-49C9-4237-8DC9-47910C39B76F@yahoo.de>

This post emanates from this thread:
http://groups.google.de/group/comp.text.tex/browse_thread/thread/39df61979cabff3a

Apparently mkluatexfontdb writes partial entries if a font file is
corrupted and cannot be read, but it should rather skip the corrupted
file altogether and emit a warning.

From ulrik.vieth at arcor.de  Tue Sep 14 21:28:51 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Tue, 14 Sep 2010 21:28:51 +0200 (CEST)
Subject: [lltx] unicode-math breakage with newest TL '10 update
In-Reply-To: <1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>
References: <1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>
	<4C8FB14B.2060303@gmail.com>
Message-ID: <26341960.1284492531028.JavaMail.ngmail@webmail06.arcor-online.net>

I've tried manually undoing the change in luaotfload, but it didn't help,
so I'm no longer sure about my attribution of the problem to luaotfload.

It could equally well be caused by some other recent updates in TL,
such as fontspec, unicode-math or expl3.  Will, could you check?

Regards, Ulrik

----- Original Nachricht ----
Von:     ulrik.vieth at arcor.de
An:      joelcsalomon at gmail.com, lualatex-dev at tug.org, xetex at tug.org
Datum:   14.09.2010 20:38
Betreff: Re: [lltx] unicode-math breakage with newest TL '10 update

> I can confirm that the problem exists in LuaLaTeX, but not in XeLaTeX,
> so I would attribute the problem to the latest update of luaotfload,
> which was updated from 1.18 to 1.19 today. Khaled, can you check?
> 
> Regards, Ulrik
> 
> 
> ----- Original Nachricht ----
> Von:     "Joel C. Salomon" <joelcsalomon at gmail.com>
> An:      lualatex-dev at tug.org, xetex at tug.org
> Datum:   14.09.2010 19:30
> Betreff: [lltx] unicode-math breakage with newest TL '10 update
> 
> > (Technically this is OT for the X?TeX list, but I suspect the folks who
> > can help me are here?)
> > 
> > Minimal test case:
> > 	% !TEX TS-program = lualatex
> > 	\documentclass{minimal}
> > 	
> > 	\usepackage{unicode-math}
> > 	\setmathfont{Cambria Math}
> > 	
> > 	\begin{document}
> > 	\[
> > 		\dot x + \ddot y
> > 	\]
> > 	\end{document}
> > Works with X?LaTeX, but LuaLatex gives me this error:
> > 
> > luaotfload | Font names database loaded:
> >
> /home/chesky/.texlive2010/texmf-var/luatex-cache/generic/names/otfl-names.lu
> 
> > a(load:
> >
> /home/chesky/.texlive2010/texmf-var/luatex-cache/generic/fonts/otf/temp-camb
> 
> > ria-cambria-math-1.lua)
> > ! Missing control sequence inserted.
> > <inserted text>
> >                 \inaccessible
> > l.5 \setmathfont{Cambria Math}
> > 
> > ? h
> > Please don't say `\def cs{...}', say `\def\cs{...}'.
> > I've inserted an inaccessible control sequence so that your
> > definition will be completed without mixing me up too badly.
> > You can recover graciously from this error, if you're
> > careful; see exercise 27.2 in The TeXbook.
> > ?
> > 
> > Any clues?
> > 
> > ?Joel
> > 
> 

From khaledhosny at eglug.org  Tue Sep 14 21:34:58 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 14 Sep 2010 22:34:58 +0300
Subject: [lltx] unicode-math breakage with newest TL '10 update
In-Reply-To: <26341960.1284492531028.JavaMail.ngmail@webmail06.arcor-online.net>
References: <1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>
	<4C8FB14B.2060303@gmail.com>
	<26341960.1284492531028.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <20100914193458.GF2125@khaled-laptop>

On Tue, Sep 14, 2010 at 09:28:51PM +0200, ulrik.vieth at arcor.de wrote:
> I've tried manually undoing the change in luaotfload, but it didn't help,
> so I'm no longer sure about my attribution of the problem to luaotfload.
> 
> It could equally well be caused by some other recent updates in TL,
> such as fontspec, unicode-math or expl3.  Will, could you check?

I have hard time understanding Joel message (I still don't), but this
don't look like a luaotfload thing (but who am I to give statements
about errors involving TeX macros).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue Sep 14 21:36:30 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 14 Sep 2010 22:36:30 +0300
Subject: [lltx] Invalid entries in the font database
In-Reply-To: <B832CB4C-49C9-4237-8DC9-47910C39B76F@yahoo.de>
References: <B832CB4C-49C9-4237-8DC9-47910C39B76F@yahoo.de>
Message-ID: <20100914193630.GG2125@khaled-laptop>

On Tue, Sep 14, 2010 at 08:40:31PM +0200, Philipp Stephani wrote:
> This post emanates from this thread:
> http://groups.google.de/group/comp.text.tex/browse_thread/thread/39df61979cabff3a
> 
> Apparently mkluatexfontdb writes partial entries if a font file is
> corrupted and cannot be read, but it should rather skip the corrupted
> file altogether and emit a warning.

If you can give me such font, I'll check, but IIRC, we already reject
fonts that, we think, are broken (apart from the black listing).

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Tue Sep 14 22:15:22 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Tue, 14 Sep 2010 22:15:22 +0200 (CEST)
Subject: [lltx] unicode-math breakage with newest TL '10 update
In-Reply-To: <20100914193458.GF2125@khaled-laptop>
References: <20100914193458.GF2125@khaled-laptop>
	<1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>
	<4C8FB14B.2060303@gmail.com>
	<26341960.1284492531028.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <1263250243.1284495322102.JavaMail.ngmail@webmail06.arcor-online.net>

I've traced it with logging all and it seems to be an expansion
or catcode problem:

It happens during the processing of \um_input_math_symbol_table
for \g_um_mathtable_tl ...n {"0220F}{\prod }{\mathop }

It ends up trying to do a \global \def &#8719;, which would only work
if  &#8719; is an active character or if &#8719; were an unexpanded \prod.

Really messy stuff to debug.
Regards, Ulrik


! Missing control sequence inserted.
<inserted text> 
                \inaccessible 
<to be read again> 
                   &#8719;
<argument> \group_end: {\global \def &#8719;
                                        {\csname \cs_to_str:N \prod _sym\end...

\::: #1->#1
           
\um_set_big_operator:nnn ...r:N #2_sym\endcsname }
                                                  \group_end: \um_set_mathch...

\g_um_mathtable_tl ...n {"0220F}{\prod }{\mathop }
                                                  \_um_sym:nnn {"02210}{\cop...

\\setmathfont ...lt }\um_input_math_symbol_table: 
                                                  \um_remap_symbols: \um_set...



----- Original Nachricht ----
Von:     Khaled Hosny <khaledhosny at eglug.org>
An:      ulrik.vieth at arcor.de
Datum:   14.09.2010 21:34
Betreff: Re: [lltx] unicode-math breakage with newest TL '10 update

> On Tue, Sep 14, 2010 at 09:28:51PM +0200, ulrik.vieth at arcor.de wrote:
> > I've tried manually undoing the change in luaotfload, but it didn't help,
> > so I'm no longer sure about my attribution of the problem to luaotfload.
> > 
> > It could equally well be caused by some other recent updates in TL,
> > such as fontspec, unicode-math or expl3.  Will, could you check?
> 
> I have hard time understanding Joel message (I still don't), but this
> don't look like a luaotfload thing (but who am I to give statements
> about errors involving TeX macros).
> 
> Regards,
>  Khaled
> 
> -- 
>  Khaled Hosny
>  Arabic localiser and member of Arabeyes.org team
>  Free font developer
> 

From ulrik.vieth at arcor.de  Tue Sep 14 22:57:49 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Tue, 14 Sep 2010 22:57:49 +0200 (CEST)
Subject: [lltx] unicode-math breakage with newest TL '10 update
In-Reply-To: <1263250243.1284495322102.JavaMail.ngmail@webmail06.arcor-online.net>
References: <1263250243.1284495322102.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100914193458.GF2125@khaled-laptop>
	<1801499143.1284489498048.JavaMail.ngmail@webmail06.arcor-online.net>
	<4C8FB14B.2060303@gmail.com>
	<26341960.1284492531028.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <2141359507.1284497869498.JavaMail.ngmail@webmail06.arcor-online.net>

Hi all,

I can confirm that the problem goes away, if I restore the backup
of the previous version of expl3:

tlmgr restore expl3 19446

Please, somebody figure out why the update in expl3 broke
temporariy catcode changes in unicode-math.

Regards, Ulrik

----- Original Nachricht ----
Von:     ulrik.vieth at arcor.de
An:      khaledhosny at eglug.org, ulrik.vieth at arcor.de
Datum:   14.09.2010 22:15
Betreff: Aw: Re: [lltx] unicode-math breakage with newest TL '10 update

> I've traced it with logging all and it seems to be an expansion
> or catcode problem:
> 
> It happens during the processing of \um_input_math_symbol_table
> for \g_um_mathtable_tl ...n {"0220F}{\prod }{\mathop }
> 
> It ends up trying to do a \global \def &#8719;, which would only work
> if  &#8719; is an active character or if &#8719; were an unexpanded \prod.
> 
> Really messy stuff to debug.
> Regards, Ulrik
> 
> 
> ! Missing control sequence inserted.
> <inserted text> 
>                 \inaccessible 
> <to be read again> 
>                    &#8719;
> <argument> \group_end: {\global \def &#8719;
>                                         {\csname \cs_to_str:N \prod
> _sym\end...
> 
> \::: #1->#1
>            
> \um_set_big_operator:nnn ...r:N #2_sym\endcsname }
>                                                   \group_end:
> \um_set_mathch...
> 
> \g_um_mathtable_tl ...n {"0220F}{\prod }{\mathop }
>                                                   \_um_sym:nnn
> {"02210}{\cop...
> 
> \\setmathfont ...lt }\um_input_math_symbol_table: 
>                                                   \um_remap_symbols:
> \um_set...
> 
> 
> 
> ----- Original Nachricht ----
> Von:     Khaled Hosny <khaledhosny at eglug.org>
> An:      ulrik.vieth at arcor.de
> Datum:   14.09.2010 21:34
> Betreff: Re: [lltx] unicode-math breakage with newest TL '10 update
> 
> > On Tue, Sep 14, 2010 at 09:28:51PM +0200, ulrik.vieth at arcor.de wrote:
> > > I've tried manually undoing the change in luaotfload, but it didn't
> help,
> > > so I'm no longer sure about my attribution of the problem to
> luaotfload.
> > > 
> > > It could equally well be caused by some other recent updates in TL,
> > > such as fontspec, unicode-math or expl3.  Will, could you check?
> > 
> > I have hard time understanding Joel message (I still don't), but this
> > don't look like a luaotfload thing (but who am I to give statements
> > about errors involving TeX macros).
> > 
> > Regards,
> >  Khaled
> > 
> > -- 
> >  Khaled Hosny
> >  Arabic localiser and member of Arabeyes.org team
> >  Free font developer
> > 
> 

From yvesscherrer at gmail.com  Wed Sep 15 11:31:40 2010
From: yvesscherrer at gmail.com (Yves Scherrer)
Date: Wed, 15 Sep 2010 11:31:40 +0200
Subject: [lltx] Problem with slanted fonts
Message-ID: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>

Hi,
I have installed TexLive 2010 and am trying out Lualatex.
When typesetting the following example:

\documentclass{article}
\usepackage{fontspec}
\setmainfont{Gentium Basic}
\begin{document}
\textsl{hello}
\end{document}

the resulting pdf file contains the following line:

Basic/I:mode=node;script=latn;language=DFLT;hello

I wouldn't expect to find the font features in there...
What am I doing wrong here?

Let me know if you need the log file.
Thanks
Yves

From news3 at nililand.de  Wed Sep 15 17:00:36 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Wed, 15 Sep 2010 17:00:36 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
Message-ID: <pjfaid8iho2u$.dlg@nililand.de>

Am Wed, 15 Sep 2010 11:31:40 +0200 schrieb Yves Scherrer:

> Hi,
> I have installed TexLive 2010 and am trying out Lualatex.
> When typesetting the following example:
> 
> \documentclass{article}
> \usepackage{fontspec}
> \setmainfont{Gentium Basic}
> \begin{document}
> \textsl{hello}
> \end{document}
> 
> the resulting pdf file contains the following line:
> 
> Basic/I:mode=node;script=latn;language=DFLT;hello
> 
> I wouldn't expect to find the font features in there...
> What am I doing wrong here?

Nothing. It is a bug, due to the space in the font name. 

Until the bug is repaired you can remove the space from the font
name (GentiumBasic), or you can use \textit instead of \textsl. This
will give the same result anyway as long as you don't use the
SlantedFont-option to declare a specific slanted font. 


-- 
Ulrike Fischer 


From simon at simifilm.ch  Thu Sep 16 18:01:25 2010
From: simon at simifilm.ch (Simon Spiegel)
Date: Thu, 16 Sep 2010 18:01:25 +0200
Subject: [lltx] OSFONTDIR on OSX
Message-ID: <932956F2-7D62-470E-9392-30888EA39CDD@simifilm.ch>

Hi,

I know that there has been a lot of discussion on mkluatexfontdb and OSFONTDIR, and I tried to read through it, but somehow I still don't get it (or maybe it doesn't work). I'm running TL2010 on OSX 10.6.4. From what I understand, LuaLaTeX should by default look in the standard places of the system for fonts and in the personal tree. This works so far. 

Now if I want to add other locations, I have to set the OSFONTDIR variable. So I went and did the following in the terminal: 
export OSFONTDIR="/Users/simi/FontExplorer X"/

The result was: zero. Although "kpsewhich -expand-path='$OSFONTDIR'" gives me the correct path, fonts in this directory will not be found. If I copy the font in my personal tree, it gets found.

TIA

Simon


--
Simon Spiegel
Steinhaldenstr. 50
8002 Z?rich

Telephon: ++41 44 451 5334
Mobophon: ++41 76 459 60 39

http://www.simifilm.ch

?Facts are meaningless. You could use facts to prove anything that's even remotely true!? Homer Simpson






From wspr81 at gmail.com  Sat Sep 18 08:28:37 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 18 Sep 2010 15:58:37 +0930
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <pjfaid8iho2u$.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
Message-ID: <BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>

On 16/09/2010, at 12:30 AM, Ulrike Fischer wrote:

> Am Wed, 15 Sep 2010 11:31:40 +0200 schrieb Yves Scherrer:
> 
>> Hi,
>> I have installed TexLive 2010 and am trying out Lualatex.
>> When typesetting the following example:
>> 
>> \documentclass{article}
>> \usepackage{fontspec}
>> \setmainfont{Gentium Basic}
>> \begin{document}
>> \textsl{hello}
>> \end{document}
>> 
>> the resulting pdf file contains the following line:
>> 
>> Basic/I:mode=node;script=latn;language=DFLT;hello
>> 
>> I wouldn't expect to find the font features in there...
>> What am I doing wrong here?
> 
> Nothing. It is a bug, due to the space in the font name. 
> 
> Until the bug is repaired you can remove the space from the font
> name (GentiumBasic), or you can use \textit instead of \textsl. This
> will give the same result anyway as long as you don't use the
> SlantedFont-option to declare a specific slanted font. 

I've been trying to track down the origin of this bug and so far I'm out of luck. I tried first switching to "luaotfload" style font loading with 

   \font\1={xyz}

instead of XeTeX-style

   \font\1="xyz"

but that produced even more problems.

This *could* be a bug in the LaTeX2e kernel, but I don't have time to wade into the NFSS at this stage.

I've added an issue for this bug:

    http://github.com/wspr/fontspec/issues/issue/74

To be addressed when possible.

-- Will



From news3 at nililand.de  Sun Sep 19 13:27:38 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Sun, 19 Sep 2010 13:27:38 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
Message-ID: <6loj00aw479m.dlg@nililand.de>

Am Sat, 18 Sep 2010 15:58:37 +0930 schrieb Will Robertson:


>>> I have installed TexLive 2010 and am trying out Lualatex.
>>> When typesetting the following example:
>>> 
>>> \documentclass{article}
>>> \usepackage{fontspec}
>>> \setmainfont{Gentium Basic}
>>> \begin{document}
>>> \textsl{hello}
>>> \end{document}
>>> 
>>> the resulting pdf file contains the following line:
>>> 
>>> Basic/I:mode=node;script=latn;language=DFLT;hello
>>> 
>>> I wouldn't expect to find the font features in there...
>>> What am I doing wrong here?
>> 
>> Nothing. It is a bug, due to the space in the font name. 
>> 
>> Until the bug is repaired you can remove the space from the font
>> name (GentiumBasic), or you can use \textit instead of \textsl. This
>> will give the same result anyway as long as you don't use the
>> SlantedFont-option to declare a specific slanted font. 
 
> I've been trying to track down the origin of this bug and so far
> I'm out of luck. 

I have tracked it a bit down. The source is 1. that \slshape use sub
in \DeclareFontShape and 2. that the "font declaration" is stored in
a command. The result depends also on the actual font. In the
following example Times New Roman gives "only" some unwanted text in
the pdf (because "Times" is the name of an existing font too), while
Lucida gives directly an error (! Font
\EU2/testfam/m/n/10=name:Lucida not loadable:). Attention: If you
use both method (with and without command \fontdesc) for the same
font they can be side effect.



\documentclass{article}

\usepackage{luaotfload}


\DeclareFontEncoding{EU2}{}{}
\DeclareErrorFont{EU2}{lmr}{m}{n}{10}
\DeclareFontSubstitution{EU2}{lmr}{m}{n}

\newcommand\fontdesc{<-> "name:Times New
Roman:mode=node;script=latn;language=DFLT;"}
\renewcommand\fontdesc{<-> "name:Lucida
Sans:mode=node;script=latn;language=DFLT;"}
\DeclareFontFamily{EU2}{testfam}{}
\DeclareFontShape {EU2}{testfam}{m}{n}
        {\fontdesc}{}
\DeclareFontShape {EU2}{testfam}{m}{it}
        {<->sub * testfam/m/n}{}


%\DeclareFontFamily{EU2}{testfamb}{}
%\DeclareFontShape {EU2}{testfamb}{m}{n}
%        {<-> "name:Lucida
%Sans:mode=node;script=latn;language=DFLT;"}{}
%\DeclareFontShape {EU2}{testfamb}{m}{it}
%        {<->sub * testfamb/m/n}{}


\DeclareFontFamily{EU2}{testfamb}{}
\DeclareFontShape {EU2}{testfamb}{m}{n}
        {<-> "name:Times New
Roman:mode=node;script=latn;language=DFLT;"}{}
\DeclareFontShape {EU2}{testfamb}{m}{it}
        {<->sub * testfamb/m/n}{}


\begin{document}

\fontencoding{EU2}

{\fontfamily{testfam}\selectfont fam\\
 \fontshape{it}\selectfont abc}


\fontfamily{testfamb}\selectfont famb\\
\fontshape{it}\selectfont abc

\end{document}



-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Sun Sep 19 13:37:31 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 19 Sep 2010 14:37:31 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <6loj00aw479m.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
Message-ID: <20100919113731.GM1978@khaled-laptop>

On Sun, Sep 19, 2010 at 01:27:38PM +0200, Ulrike Fischer wrote:
> Am Sat, 18 Sep 2010 15:58:37 +0930 schrieb Will Robertson:
> 
> 
> >>> I have installed TexLive 2010 and am trying out Lualatex.
> >>> When typesetting the following example:
> >>> 
> >>> \documentclass{article}
> >>> \usepackage{fontspec}
> >>> \setmainfont{Gentium Basic}
> >>> \begin{document}
> >>> \textsl{hello}
> >>> \end{document}
> >>> 
> >>> the resulting pdf file contains the following line:
> >>> 
> >>> Basic/I:mode=node;script=latn;language=DFLT;hello
> >>> 
> >>> I wouldn't expect to find the font features in there...
> >>> What am I doing wrong here?
> >> 
> >> Nothing. It is a bug, due to the space in the font name. 
> >> 
> >> Until the bug is repaired you can remove the space from the font
> >> name (GentiumBasic), or you can use \textit instead of \textsl. This
> >> will give the same result anyway as long as you don't use the
> >> SlantedFont-option to declare a specific slanted font. 
>  
> > I've been trying to track down the origin of this bug and so far
> > I'm out of luck. 
> 
> I have tracked it a bit down. The source is 1. that \slshape use sub
> in \DeclareFontShape and 2. that the "font declaration" is stored in
> a command. The result depends also on the actual font. In the
> following example Times New Roman gives "only" some unwanted text in
> the pdf (because "Times" is the name of an existing font too), while
> Lucida gives directly an error (! Font
> \EU2/testfam/m/n/10=name:Lucida not loadable:). Attention: If you
> use both method (with and without command \fontdesc) for the same
> font they can be side effect.

So, how XeTeX is dealing with this? If its behaviour can be emulated in
luaotfload then we should do it, else it might be something for LuaTeX
to handle.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sun Sep 19 14:36:09 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 19 Sep 2010 22:06:09 +0930
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <6loj00aw479m.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
Message-ID: <75C3E9A1-591E-4548-A371-929194A2E805@gmail.com>

On 19/09/2010, at 8:57 PM, Ulrike Fischer wrote:

> I have tracked it a bit down. The source is 1. that \slshape use sub
> in \DeclareFontShape and 2. that the "font declaration" is stored in
> a command.

None of this makes sense to me. I've tried playing with your example; see attached.
Even the order of which font comes first seems to break things; uncomment the \reverse line to see (if our results are the same, anyway); when uncommented, the output looks correct; when commented, the garbage appears again -- for both instances of \selectfont.

Also, \fontdesc is expanded before \DeclareFontShape, so that doesn't seem to be the (main) source of the problem.

Surrounding the font strings with braces instead of quotes also kills things (I suspect due to a LaTeX limitation).

Stumped.

-- Will

\documentclass{article}
\usepackage{luaotfload}
\DeclareFontEncoding{EU2}{}{}
\DeclareErrorFont{EU2}{lmr}{m}{n}{10}
\DeclareFontSubstitution{EU2}{lmr}{m}{n}
\newcommand\fontdesc{<->"name:XITS Math:mode=node;script=latn;language=DFLT;"}
\DeclareFontFamily{EU2}{testfam}{}
\edef\x{\noexpand\DeclareFontShape {EU2}{testfam}{m}{n}{\fontdesc}{}}
\x
\DeclareFontShape {EU2}{testfam}{m}{it}{<->sub*testfam/m/n}{}

\DeclareFontFamily{EU2}{testfamb}{}
\DeclareFontShape {EU2}{testfamb}{m}{n}{<->"name:XITS Math:mode=node;language=DFLT;script=latn;"}{}
\DeclareFontShape {EU2}{testfamb}{m}{it}{<->sub*testfamb/m/n}{}
\begin{document}
\fontencoding{EU2}
\def\reverse#1#2{#2#1}
\reverse % comment for the problem
{\fontfamily{testfam}[\selectfont] fam\\
\fontshape{it}[\selectfont] abc\\}
{\fontfamily{testfamb}[\selectfont] famb\\
\fontshape{it}[\selectfont] abc\\}
\end{document}

From news3 at nililand.de  Sun Sep 19 16:24:52 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Sun, 19 Sep 2010 16:24:52 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
Message-ID: <12l0s7gh6p9ms.dlg@nililand.de>

Am Sun, 19 Sep 2010 14:37:31 +0300 schrieb Khaled Hosny:

> On Sun, Sep 19, 2010 at 01:27:38PM +0200, Ulrike Fischer wrote:
>> Am Sat, 18 Sep 2010 15:58:37 +0930 schrieb Will Robertson:
>> 
>> 
>>>>> I have installed TexLive 2010 and am trying out Lualatex.
>>>>> When typesetting the following example:
>>>>> 
>>>>> \documentclass{article}
>>>>> \usepackage{fontspec}
>>>>> \setmainfont{Gentium Basic}
>>>>> \begin{document}
>>>>> \textsl{hello}
>>>>> \end{document}
>>>>> 
>>>>> the resulting pdf file contains the following line:
>>>>> 
>>>>> Basic/I:mode=node;script=latn;language=DFLT;hello
>>>>> 
>>>>> I wouldn't expect to find the font features in there...
>>>>> What am I doing wrong here?
>>>> 
>>>> Nothing. It is a bug, due to the space in the font name. 
>>>> 
>>>> Until the bug is repaired you can remove the space from the font
>>>> name (GentiumBasic), or you can use \textit instead of \textsl. This
>>>> will give the same result anyway as long as you don't use the
>>>> SlantedFont-option to declare a specific slanted font. 
>>  
>>> I've been trying to track down the origin of this bug and so far
>>> I'm out of luck. 
>> 
>> I have tracked it a bit down. The source is 1. that \slshape use sub
>> in \DeclareFontShape and 2. that the "font declaration" is stored in
>> a command. The result depends also on the actual font. In the
>> following example Times New Roman gives "only" some unwanted text in
>> the pdf (because "Times" is the name of an existing font too), while
>> Lucida gives directly an error (! Font
>> \EU2/testfam/m/n/10=name:Lucida not loadable:). Attention: If you
>> use both method (with and without command \fontdesc) for the same
>> font they can be side effect.
> 
> So, how XeTeX is dealing with this? If its behaviour can be emulated in
> luaotfload then we should do it, else it might be something for LuaTeX
> to handle.

I have no idea how xetex is going around. But I found the place
where it fails: in \do at subst@correction. A failing example gives
this with tracingmacros =1 :


EU2/testfam/m/n -><->"name:Lucida Sans" 

<->"name:Lucida Sans" ->

\subst at correction ->\EU2/testfam/m/it/10 \global \font
\EU2/testfam/m/n/10 \fontname \font \relax 
luaotfload | Updating the font names database:
luaotfload | Scanning TEXMF and OS fonts...
... and then error

A non failing shows this (notice the missing space!):

EU2/testfam/m/n -><->"name:LucidaSans" 

<->"name:LucidaSans" ->

\subst at correction ->\EU2/testfam/m/it/10 \global \font
\EU2/testfam/m/n/10 \fontname \font \relax 
luaotfload | load font: font family='lucidasans',
subfamily='regular' found: lsans.ttf
 
-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Sun Sep 19 18:50:09 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 19 Sep 2010 19:50:09 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <12l0s7gh6p9ms.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
Message-ID: <20100919165009.GB3751@khaled-laptop>

On Sun, Sep 19, 2010 at 04:24:52PM +0200, Ulrike Fischer wrote:
> Am Sun, 19 Sep 2010 14:37:31 +0300 schrieb Khaled Hosny:
> 
> > On Sun, Sep 19, 2010 at 01:27:38PM +0200, Ulrike Fischer wrote:
> >> Am Sat, 18 Sep 2010 15:58:37 +0930 schrieb Will Robertson:
> >> 
> >> 
> >>>>> I have installed TexLive 2010 and am trying out Lualatex.
> >>>>> When typesetting the following example:
> >>>>> 
> >>>>> \documentclass{article}
> >>>>> \usepackage{fontspec}
> >>>>> \setmainfont{Gentium Basic}
> >>>>> \begin{document}
> >>>>> \textsl{hello}
> >>>>> \end{document}
> >>>>> 
> >>>>> the resulting pdf file contains the following line:
> >>>>> 
> >>>>> Basic/I:mode=node;script=latn;language=DFLT;hello
> >>>>> 
> >>>>> I wouldn't expect to find the font features in there...
> >>>>> What am I doing wrong here?
> >>>> 
> >>>> Nothing. It is a bug, due to the space in the font name. 
> >>>> 
> >>>> Until the bug is repaired you can remove the space from the font
> >>>> name (GentiumBasic), or you can use \textit instead of \textsl. This
> >>>> will give the same result anyway as long as you don't use the
> >>>> SlantedFont-option to declare a specific slanted font. 
> >>  
> >>> I've been trying to track down the origin of this bug and so far
> >>> I'm out of luck. 
> >> 
> >> I have tracked it a bit down. The source is 1. that \slshape use sub
> >> in \DeclareFontShape and 2. that the "font declaration" is stored in
> >> a command. The result depends also on the actual font. In the
> >> following example Times New Roman gives "only" some unwanted text in
> >> the pdf (because "Times" is the name of an existing font too), while
> >> Lucida gives directly an error (! Font
> >> \EU2/testfam/m/n/10=name:Lucida not loadable:). Attention: If you
> >> use both method (with and without command \fontdesc) for the same
> >> font they can be side effect.
> > 
> > So, how XeTeX is dealing with this? If its behaviour can be emulated in
> > luaotfload then we should do it, else it might be something for LuaTeX
> > to handle.
> 
> I have no idea how xetex is going around. But I found the place
> where it fails: in \do at subst@correction. A failing example gives
> this with tracingmacros =1 :
> 
> 
> EU2/testfam/m/n -><->"name:Lucida Sans" 
> 
> <->"name:Lucida Sans" ->
> 
> \subst at correction ->\EU2/testfam/m/it/10 \global \font
> \EU2/testfam/m/n/10 \fontname \font \relax 
> luaotfload | Updating the font names database:
> luaotfload | Scanning TEXMF and OS fonts...
> ... and then error
> 
> A non failing shows this (notice the missing space!):
> 
> EU2/testfam/m/n -><->"name:LucidaSans" 
> 
> <->"name:LucidaSans" ->
> 
> \subst at correction ->\EU2/testfam/m/it/10 \global \font
> \EU2/testfam/m/n/10 \fontname \font \relax 
> luaotfload | load font: font family='lucidasans',
> subfamily='regular' found: lsans.ttf

How I forgot that! internally, "Lucida Sans", "LucidaSans",
"lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
strip spaces and lower case font name before doing matching. So fontspec
can just strip the spaces in some way (if not easy in tex, can be done
in lua).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Mon Sep 20 02:43:51 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 20 Sep 2010 10:13:51 +0930
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <20100919165009.GB3751@khaled-laptop>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
Message-ID: <D9E2285F-49F0-4CC3-ABC0-1E508AA86DA1@gmail.com>

On 20/09/2010, at 2:20 AM, Khaled Hosny wrote:

>> I have no idea how xetex is going around. But I found the place
>> where it fails: in \do at subst@correction. A failing example gives
>> this with tracingmacros =1 :
>> 
>> 
>> EU2/testfam/m/n -><->"name:Lucida Sans" 
>> 
>> <->"name:Lucida Sans" ->

It's very strange that this works with XeTeX, since nothing different is happening internally.

> How I forgot that! internally, "Lucida Sans", "LucidaSans",
> "lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
> strip spaces and lower case font name before doing matching.

I haven't done the lowercasing, but I've just pushed an update to fontspec on Github that zaps all spaces at the very beginning and it seems to fix the problem. (Even if the cause is still somewhat odd.) Would you like to test it out?

I introduced another bug in the last official update over the weekend so I need to upload a new CTAN soon-ish. Might take me until the end of the week if things get hectic, though.

Thanks for the help!
-- Will



From khaledhosny at eglug.org  Mon Sep 20 02:54:05 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Sep 2010 03:54:05 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <D9E2285F-49F0-4CC3-ABC0-1E508AA86DA1@gmail.com>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<D9E2285F-49F0-4CC3-ABC0-1E508AA86DA1@gmail.com>
Message-ID: <20100920005405.GA14970@khaled-laptop>

On Mon, Sep 20, 2010 at 10:13:51AM +0930, Will Robertson wrote:
> On 20/09/2010, at 2:20 AM, Khaled Hosny wrote:
> 
> >> I have no idea how xetex is going around. But I found the place
> >> where it fails: in \do at subst@correction. A failing example gives
> >> this with tracingmacros =1 :
> >> 
> >> 
> >> EU2/testfam/m/n -><->"name:Lucida Sans" 
> >> 
> >> <->"name:Lucida Sans" ->
> 
> It's very strange that this works with XeTeX, since nothing different is happening internally.
> 
> > How I forgot that! internally, "Lucida Sans", "LucidaSans",
> > "lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
> > strip spaces and lower case font name before doing matching.
> 
> I haven't done the lowercasing,

By "we will" I was referring to the current luaotfload behaviour, so
since fontspec's problem is only with spaces, there is no need to
lowercase too (I know my writings are cryptic, now I think what I'm
saying is just more confusing).


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Mon Sep 20 03:34:51 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 20 Sep 2010 11:04:51 +0930
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <20100920005405.GA14970@khaled-laptop>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<D9E2285F-49F0-4CC3-ABC0-1E508AA86DA1@gmail.com>
	<20100920005405.GA14970@khaled-laptop>
Message-ID: <757533EC-A0C4-4CFD-BD90-C76C48EE916D@gmail.com>

On 20/09/2010, at 10:24 AM, Khaled Hosny wrote:

> By "we will" I was referring to the current luaotfload behaviour, so
> since fontspec's problem is only with spaces, there is no need to
> lowercase too (I know my writings are cryptic, now I think what I'm
> saying is just more confusing).

Not at all :) Makes perfect sense.
(I realised after sending that I didn't need to mention the lowercasing bit. Oh well.)

Thanks,
-- Will



From news3 at nililand.de  Mon Sep 20 10:23:51 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 20 Sep 2010 10:23:51 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
Message-ID: <1ds73r7f3tl2x$.dlg@nililand.de>

Am Sun, 19 Sep 2010 19:50:09 +0300 schrieb Khaled Hosny:


> How I forgot that! internally, "Lucida Sans", "LucidaSans",
> "lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
> strip spaces and lower case font name before doing matching. So fontspec
> can just strip the spaces in some way (if not easy in tex, can be done
> in lua).

Well naturally stripping space is a solution which I already
mentioned at the begin of the thread. Nevertheless it is interesting
why it fails for luatex but not with xetex and I think I found the
reason: \fontname works differently.

In following example xetex returns the fontnames of the system fonts
surrounded by quotes ("Lucida Sans Regular", "Arial", but cmr10
without quotes) while luatex/luaoftload returns all fonts without
quotes: name:Lucida Sans. name:Arial. As during substituation
\fontname\font is feeded back to a font command luatex now looks due
to the missing quotes for the font name:Lucida

\documentclass{article}
\usepackage{ifluatex}
\ifluatex
 \usepackage{luaotfload}
 \font\test="name:Lucida Sans"
 \font\testb="name:Arial"
\else
 \font\test="Lucida Sans"
 \font\testb="Arial"
\fi


\begin{document}
\fontname\font \test \fontname\font \testb\fontname\font
\end{document}




-- 
Ulrike Fischer 


From taco at elvenkind.com  Mon Sep 20 11:28:09 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 20 Sep 2010 11:28:09 +0200
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <1ds73r7f3tl2x$.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>	<pjfaid8iho2u$.dlg@nililand.de>	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>	<6loj00aw479m.dlg@nililand.de>	<20100919113731.GM1978@khaled-laptop>	<12l0s7gh6p9ms.dlg@nililand.de>	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
Message-ID: <4C972929.3000504@elvenkind.com>

On 09/20/2010 10:23 AM, Ulrike Fischer wrote:
> Am Sun, 19 Sep 2010 19:50:09 +0300 schrieb Khaled Hosny:
>
>
>> How I forgot that! internally, "Lucida Sans", "LucidaSans",
>> "lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
>> strip spaces and lower case font name before doing matching. So fontspec
>> can just strip the spaces in some way (if not easy in tex, can be done
>> in lua).
>
> Well naturally stripping space is a solution which I already
> mentioned at the begin of the thread. Nevertheless it is interesting
> why it fails for luatex but not with xetex and I think I found the
> reason: \fontname works differently.
>
> In following example xetex returns the fontnames of the system fonts
> surrounded by quotes ("Lucida Sans Regular", "Arial", but cmr10
> without quotes) while luatex/luaoftload returns all fonts without
> quotes: name:Lucida Sans. name:Arial. As during substituation
> \fontname\font is feeded back to a font command luatex now looks due
> to the missing quotes for the font name:Lucida

A simple solution would be to wrap the \fontname returned value in a {}
group before passing it back to \font.

Best wishes,
Taco

From khaledhosny at eglug.org  Mon Sep 20 11:31:31 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Sep 2010 12:31:31 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <1ds73r7f3tl2x$.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
Message-ID: <20100920093131.GA32615@khaled-laptop>

On Mon, Sep 20, 2010 at 10:23:51AM +0200, Ulrike Fischer wrote:
> Am Sun, 19 Sep 2010 19:50:09 +0300 schrieb Khaled Hosny:
> 
> 
> > How I forgot that! internally, "Lucida Sans", "LucidaSans",
> > "lucidasans", "L U ci DaS anS" all are the same to luaotfload, we will
> > strip spaces and lower case font name before doing matching. So fontspec
> > can just strip the spaces in some way (if not easy in tex, can be done
> > in lua).
> 
> Well naturally stripping space is a solution which I already
> mentioned at the begin of the thread. Nevertheless it is interesting
> why it fails for luatex but not with xetex and I think I found the
> reason: \fontname works differently.
> 
> In following example xetex returns the fontnames of the system fonts
> surrounded by quotes ("Lucida Sans Regular", "Arial", but cmr10
> without quotes) while luatex/luaoftload returns all fonts without
> quotes: name:Lucida Sans. name:Arial. As during substituation
> \fontname\font is feeded back to a font command luatex now looks due
> to the missing quotes for the font name:Lucida

I had that feeling it is related to \fontname, it caused a nasty bug
before, and now this one.
Now, does surrounding fontname with brackets works too, or only quotes?
It can be easily fixed in luaotfload (we populate the name field of the
tfm table of the font).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From news3 at nililand.de  Mon Sep 20 12:52:40 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 20 Sep 2010 12:52:40 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
Message-ID: <1ocy3egvztdp6.dlg@nililand.de>

Am Mon, 20 Sep 2010 12:31:31 +0300 schrieb Khaled Hosny:



>> Well naturally stripping space is a solution which I already
>> mentioned at the begin of the thread. Nevertheless it is interesting
>> why it fails for luatex but not with xetex and I think I found the
>> reason: \fontname works differently.
>> 
>> In following example xetex returns the fontnames of the system fonts
>> surrounded by quotes ("Lucida Sans Regular", "Arial", but cmr10
>> without quotes) while luatex/luaoftload returns all fonts without
>> quotes: name:Lucida Sans. name:Arial. As during substituation
>> \fontname\font is feeded back to a font command luatex now looks due
>> to the missing quotes for the font name:Lucida
 
> I had that feeling it is related to \fontname, it caused a nasty bug
> before, and now this one.
> Now, does surrounding fontname with brackets works too, or only quotes?
> It can be easily fixed in luaotfload (we populate the name field of the
> tfm table of the font).

Well I tried this redefinition and it worked fine with lualatex
(only with lualatex! pdflatex and xelatex don't like the additional
braces).  

\makeatletter
\def\do at subst@correction{%
       \xdef\subst at correction{%
          \font at name
          \global\expandafter\font
            \csname \curr at fontshape/\f at size\endcsname
            {\noexpand\fontname\font} %<--- braces
           \relax}%
       \aftergroup\subst at correction
}

So braces are probably ok. 

Brackets ("[" and "]") seems to work too. 
-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Sep 20 13:01:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Sep 2010 14:01:11 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <1ocy3egvztdp6.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
Message-ID: <20100920110110.GA12613@khaled-laptop>

On Mon, Sep 20, 2010 at 12:52:40PM +0200, Ulrike Fischer wrote:
> Am Mon, 20 Sep 2010 12:31:31 +0300 schrieb Khaled Hosny:
> > I had that feeling it is related to \fontname, it caused a nasty bug
> > before, and now this one.
> > Now, does surrounding fontname with brackets works too, or only quotes?
> > It can be easily fixed in luaotfload (we populate the name field of the
> > tfm table of the font).
> 
> Well I tried this redefinition and it worked fine with lualatex
> (only with lualatex! pdflatex and xelatex don't like the additional
> braces).  
> 
> \makeatletter
> \def\do at subst@correction{%
>        \xdef\subst at correction{%
>           \font at name
>           \global\expandafter\font
>             \csname \curr at fontshape/\f at size\endcsname
>             {\noexpand\fontname\font} %<--- braces
>            \relax}%
>        \aftergroup\subst at correction
> }
> 
> So braces are probably ok. 

I did some experimentation, weired enough (at lest to me), quoting the
name in tfm.name works as expected, but the braces don't. Somewhere in
the chain the quotes are eaten before passing back to lua, but the
braces are not which will break font specification parsing.

> Brackets ("[" and "]") seems to work too. 

Brackets will (I think) force a name based lookup, which is not always
desired.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Mon Sep 20 12:58:55 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 20 Sep 2010 20:28:55 +0930
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <1ocy3egvztdp6.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
Message-ID: <002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>

On 20/09/2010, at 8:22 PM, Ulrike Fischer wrote:

> Well I tried this redefinition and it worked fine with lualatex
> (only with lualatex! pdflatex and xelatex don't like the additional
> braces).  
> 
> \makeatletter
> \def\do at subst@correction{%
>       \xdef\subst at correction{%
>          \font at name
>          \global\expandafter\font
>            \csname \curr at fontshape/\f at size\endcsname
>            {\noexpand\fontname\font} %<--- braces
>           \relax}%
>       \aftergroup\subst at correction
> }
> 
> So braces are probably ok. 

Thanks for doing this.

What are your thoughts on the preferable approach?

If we strip spaces beforehand then we know that we won't fall foul of any related problems with \fontname; if we patch the NFSS then the approach will be robust for other people's code that also falls foul of the same problem.

Guess we could even do both :)

-- Will



From khaledhosny at eglug.org  Mon Sep 20 13:43:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Sep 2010 14:43:21 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
References: <pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
Message-ID: <20100920114321.GA15198@khaled-laptop>

On Mon, Sep 20, 2010 at 08:28:55PM +0930, Will Robertson wrote:
> On 20/09/2010, at 8:22 PM, Ulrike Fischer wrote:
> 
> > Well I tried this redefinition and it worked fine with lualatex
> > (only with lualatex! pdflatex and xelatex don't like the additional
> > braces).  
> > 
> > \makeatletter
> > \def\do at subst@correction{%
> >       \xdef\subst at correction{%
> >          \font at name
> >          \global\expandafter\font
> >            \csname \curr at fontshape/\f at size\endcsname
> >            {\noexpand\fontname\font} %<--- braces
> >           \relax}%
> >       \aftergroup\subst at correction
> > }
> > 
> > So braces are probably ok. 
> 
> Thanks for doing this.
> 
> What are your thoughts on the preferable approach?
> 
> If we strip spaces beforehand then we know that we won't fall foul of any related problems with \fontname; if we patch the NFSS then the approach will be robust for other people's code that also falls foul of the same problem.
> 
> Guess we could even do both :)

And fix luaotfload too, so someone writing his own .fd files don't fall
foul :)

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From news3 at nililand.de  Mon Sep 20 14:00:16 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 20 Sep 2010 14:00:16 +0200
Subject: [lltx] Problem with slanted fonts
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>
	<pjfaid8iho2u$.dlg@nililand.de>
	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>
	<6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
Message-ID: <15vexxk7f28om.dlg@nililand.de>

Am Mon, 20 Sep 2010 20:28:55 +0930 schrieb Will Robertson:

> On 20/09/2010, at 8:22 PM, Ulrike Fischer wrote:
> 
>> Well I tried this redefinition and it worked fine with lualatex
>> (only with lualatex! pdflatex and xelatex don't like the additional
>> braces).  
>> 
>> \makeatletter
>> \def\do at subst@correction{%
>>       \xdef\subst at correction{%
>>          \font at name
>>          \global\expandafter\font
>>            \csname \curr at fontshape/\f at size\endcsname
>>            {\noexpand\fontname\font} %<--- braces
>>           \relax}%
>>       \aftergroup\subst at correction
>> }
>> 
>> So braces are probably ok. 
> 
> Thanks for doing this.
> 
> What are your thoughts on the preferable approach?
 
> If we strip spaces beforehand then we know that we won't fall foul
> of any related problems with \fontname; if we patch the NFSS then
> the approach will be robust for other people's code that also
> falls foul of the same problem.

I only patched \do at subst@correction to check if braces, bracket and
quotes around the fontname solves the problem. I don't think that
this patch is in itself a good solution. I also don't think that
changing fontspec is the right way.

I think \fontname\font should give something back, that luatex
accepts as fontname. So this should work also with fonts like Lucida
Sans:

\documentclass{article}
\usepackage{luaotfload}
\begin{document}
%\font\testa="name:Lucida Sans" \testa

abc \font\test=\fontname\font\space at 15pt \test abc
\end{document}

So at my opinion luaoftload or whoever is responsable for the syntax
of \fontname should be adapted. I don't know enough of the syntax
regarding quotes, braces, brackets to be able to make a suggestion
which is the best.

 
-- 
Ulrike Fischer 


From taco at elvenkind.com  Mon Sep 20 14:12:40 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 20 Sep 2010 14:12:40 +0200
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <15vexxk7f28om.dlg@nililand.de>
References: <AANLkTinBCnLq-+t+SVxnehpRD-qC856GL6C=NKbDgxf-@mail.gmail.com>	<pjfaid8iho2u$.dlg@nililand.de>	<BE5D447A-B26E-4167-8F96-04D4AB8CDB20@gmail.com>	<6loj00aw479m.dlg@nililand.de>	<20100919113731.GM1978@khaled-laptop>	<12l0s7gh6p9ms.dlg@nililand.de>	<20100919165009.GB3751@khaled-laptop>	<1ds73r7f3tl2x$.dlg@nililand.de>	<20100920093131.GA32615@khaled-laptop>	<1ocy3egvztdp6.dlg@nililand.de>	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
	<15vexxk7f28om.dlg@nililand.de>
Message-ID: <4C974FB8.8070802@elvenkind.com>

On 09/20/2010 02:00 PM, Ulrike Fischer wrote:
>
> So at my opinion luaoftload or whoever is responsable for the syntax
> of \fontname should be adapted.

That would be me (i.e. luatex itself). I can output a brace group
is that is preferred, but I cannot oversee whether that would not
add even more confusion on the luaotfload side.

Taco

From khaledhosny at eglug.org  Mon Sep 20 14:51:52 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Sep 2010 15:51:52 +0300
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <4C974FB8.8070802@elvenkind.com>
References: <6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
	<15vexxk7f28om.dlg@nililand.de> <4C974FB8.8070802@elvenkind.com>
Message-ID: <20100920125152.GA2717@khaled-laptop>

On Mon, Sep 20, 2010 at 02:12:40PM +0200, Taco Hoekwater wrote:
> On 09/20/2010 02:00 PM, Ulrike Fischer wrote:
> >
> >So at my opinion luaoftload or whoever is responsable for the syntax
> >of \fontname should be adapted.
> 
> That would be me (i.e. luatex itself). I can output a brace group
> is that is preferred, but I cannot oversee whether that would not
> add even more confusion on the luaotfload side.

I think we can go with quoting the name at luaotfload side for now, we
don't know what side effects this grouping would have on
luaotfload/ConTeXt.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From news3 at nililand.de  Mon Sep 20 15:07:46 2010
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 20 Sep 2010 15:07:46 +0200
Subject: [lltx] Problem with slanted fonts
References: <6loj00aw479m.dlg@nililand.de>
	<20100919113731.GM1978@khaled-laptop>
	<12l0s7gh6p9ms.dlg@nililand.de>
	<20100919165009.GB3751@khaled-laptop>
	<1ds73r7f3tl2x$.dlg@nililand.de>
	<20100920093131.GA32615@khaled-laptop>
	<1ocy3egvztdp6.dlg@nililand.de>
	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>
	<15vexxk7f28om.dlg@nililand.de> <4C974FB8.8070802@elvenkind.com>
	<20100920125152.GA2717@khaled-laptop>
Message-ID: <1shrj5b67ztyq.dlg@nililand.de>

Am Mon, 20 Sep 2010 15:51:52 +0300 schrieb Khaled Hosny:


>>>So at my opinion luaoftload or whoever is responsable for the syntax
>>>of \fontname should be adapted.
 
>> That would be me (i.e. luatex itself). I can output a brace group
>> is that is preferred, but I cannot oversee whether that would not
>> add even more confusion on the luaotfload side.
 
> I think we can go with quoting the name at luaotfload side for now, we
> don't know what side effects this grouping would have on
> luaotfload/ConTeXt.

I would prefer a solution on the luatex level. After all \fontname
is a primitive and it should give back "the correct value". It
shouldn't be the duty of packages to code around problems. Also the
luatex manual says that font name can have braces around them. 

But naturally if both luaoftload and luatex put braces around the
output of \fontname things will break ;-)

But what is with context? How is it handled there? Does it allow
spaces in font names? If yes does the equivalent of

\font\testa="name:Lucida Sans" \testa
abc \font\test=\fontname\font\space at 15pt \test abc

break or does context have some correction code? 


-- 
Ulrike Fischer 


From taco at elvenkind.com  Mon Sep 20 15:24:44 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 20 Sep 2010 15:24:44 +0200
Subject: [lltx] Problem with slanted fonts
In-Reply-To: <1shrj5b67ztyq.dlg@nililand.de>
References: <6loj00aw479m.dlg@nililand.de>	<20100919113731.GM1978@khaled-laptop>	<12l0s7gh6p9ms.dlg@nililand.de>	<20100919165009.GB3751@khaled-laptop>	<1ds73r7f3tl2x$.dlg@nililand.de>	<20100920093131.GA32615@khaled-laptop>	<1ocy3egvztdp6.dlg@nililand.de>	<002F6FD4-7662-493C-992A-A45214AB392C@gmail.com>	<15vexxk7f28om.dlg@nililand.de>
	<4C974FB8.8070802@elvenkind.com>	<20100920125152.GA2717@khaled-laptop>
	<1shrj5b67ztyq.dlg@nililand.de>
Message-ID: <4C97609C.9060508@elvenkind.com>

On 09/20/2010 03:07 PM, Ulrike Fischer wrote:
>
> But what is with context? How is it handled there? Does it allow
> spaces in font names?

Yes: it accepts both "name:Lucida Sans" and "name:lucidasans"
as user input (as well as a file: equivalent)

> If yes does the equivalent of
>
> \font\testa="name:Lucida Sans" \testa
> abc \font\test=\fontname\font\space at 15pt \test abc
>
> break or does context have some correction code?

It succeeds, because internally context uses the 'file:' approach
in all cases. Since file: is the default, it is not even reported by
\fontname, which would be 'lbr' in this case (assuming Y&Y/TUG names).

I assume context would fail on filenames with spaces in them, but
otoh Hans probably disallows those right from the start.

From elie.roux at telecom-bretagne.eu  Wed Sep 22 18:00:21 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 22 Sep 2010 18:00:21 +0200
Subject: [lltx] luamplib problem
In-Reply-To: <7FD3E5A9-D46E-499D-9FE5-F55C41CA664E@me.com>
References: <97357B72-5AED-4825-9DEA-08E94F15E56D@me.com>
	<4C5E6FC5.10408@telecom-bretagne.eu>
	<4C5E72D2.8030203@elvenkind.com>
	<4C5E7D30.3060101@telecom-bretagne.eu>
	<7FD3E5A9-D46E-499D-9FE5-F55C41CA664E@me.com>
Message-ID: <4C9A2815.5070709@telecom-bretagne.eu>

Ivo Geradts a ?crit :
> Because of my holiday I have been mostly away from my keyboard last 
> weeks, but in the meantime I have been thinking about your luaTeX 
> packages. I wondered whether you have already found someone who will 
> take over their maintenance. If that is not the case, I am happy to 
> offer my help (although I am not completely sure whether I am qualified 
> for the job).

Hello,

it's really nice of yours to offer your help in this area! The best mail 
address for the lualatex packages though is lualatex-dev at tug.org (in copy).

 > [...]
> What would be the way to go, if we would like to assist maintaining 
> them?

Khaled Hosny has already proposed himself for the maintainance, but I 
think he has largely enough work with luaotfload... Khaled, what do you 
think?

> Did you go over all ConTeXt files to select the parts relevant for 
> plainTeX?

Actually the code of luamplib is isolated in ConTeXt, in the files here 
http://source.contextgarden.net/tex/generic/context, especially 
luatex-mplib.*

> Did you write a lot of code from scratch?

Not a lot, I just adapted the code to LaTeX. Also a bit of backward 
compatibility (ConTeXt has no such thing) would be great, as the code 
must change from LuaTeX 0.60 to LuaTeX 0.61 (iirc).

> Did you work closely with Hans on these packages?

Not at all...

Thank you!
-- 
Elie

From khaledhosny at eglug.org  Wed Sep 22 18:29:41 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 22 Sep 2010 19:29:41 +0300
Subject: [lltx] luamplib problem
In-Reply-To: <4C9A2815.5070709@telecom-bretagne.eu>
References: <97357B72-5AED-4825-9DEA-08E94F15E56D@me.com>
	<4C5E6FC5.10408@telecom-bretagne.eu>
	<4C5E72D2.8030203@elvenkind.com>
	<4C5E7D30.3060101@telecom-bretagne.eu>
	<7FD3E5A9-D46E-499D-9FE5-F55C41CA664E@me.com>
	<4C9A2815.5070709@telecom-bretagne.eu>
Message-ID: <20100922162941.GD2084@khaled-laptop>

On Wed, Sep 22, 2010 at 06:00:21PM +0200, Elie Roux wrote:
> Ivo Geradts a ?crit :
> >Because of my holiday I have been mostly away from my keyboard
> >last weeks, but in the meantime I have been thinking about your
> >luaTeX packages. I wondered whether you have already found someone
> >who will take over their maintenance. If that is not the case, I
> >am happy to offer my help (although I am not completely sure
> >whether I am qualified for the job).
> 
> Hello,
> 
> it's really nice of yours to offer your help in this area! The best
> mail address for the lualatex packages though is
> lualatex-dev at tug.org (in copy).
> 
> > [...]
> >What would be the way to go, if we would like to assist
> >maintaining them?
> 
> Khaled Hosny has already proposed himself for the maintainance, but
> I think he has largely enough work with luaotfload... Khaled, what
> do you think?

I had some ideas that I wanted to experiment with (mainly supporting
text labels that would be typeset by the same instant to TeX ensuring
that fonts, directionality and so are the same as body text), but I did
not actually look at the code for a while now. So, if someone else wants
to take care of it, that would even be better and one can always
contribute patches when needed.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Thu Sep 23 08:16:39 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 23 Sep 2010 15:46:39 +0930
Subject: [lltx] ancientgreek with lualatex
In-Reply-To: <20100923055224.GF2054@phare.normalesup.org>
References: <AANLkTikph4Ztc=sqscwYrojxnGeZ+k-zPym5P=siCRyZ@mail.gmail.com>
	<AANLkTikBbhawOhzEaPy++1wn5t_kBqgKFrPjNcC3Bhz0@mail.gmail.com>
	<4C9A1629.9040006@elzevir.fr>
	<AANLkTik1_26pe--tTG0SKBoQz42Pbc5+Mgm388zmSO=F@mail.gmail.com>
	<20100922231622.GA6480@khaled-laptop>
	<20100923055224.GF2054@phare.normalesup.org>
Message-ID: <632DAFE9-AF34-40A3-880C-ECB1DB04EAD1@gmail.com>

On 23/09/2010, at 3:22 PM, Arthur Reutenauer wrote:

>  I think the main issue you need to solve in the LuaLaTeX team is to
> decide whether you want to solve this problem the same way XeTeX does,
> setting those codes in the format (XeTeX does that by inputting
> unicode-letters.tex as you know)

I definitely think this is the right thing to do.

I suggest first talking to Jonathan about removing the XeTeX tests from unicode-letters.tex (and moving them to xelatex.ini) and then writing a patch for lualatex.ini for a cross-platform unicode-letters.tex. Then we can talk to Karl about adding it to the master distribution (since lualatex.ini is his, for now).

What say ye?

-- Will



From wspr81 at gmail.com  Sun Sep 26 18:06:52 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 27 Sep 2010 01:36:52 +0930
Subject: [lltx] debugging when luaotfload can't find fonts
Message-ID: <898677EC-27FF-4D9C-958A-8E08C463EF11@gmail.com>

Hi,

I'm having trouble loading fonts and I don't know how to debug the problem.

My otfl-names.lua cache contains, for example,

>   {
>    ["familyname"]="XB Zar",
>    ["filename"]={ "/Users/will/Library/Fonts/XB Zar/XB Zar.ttf", false },
>    ["fontname"]="XBZar",
>    ["fullname"]="XB Zar",
>    ["names"]={
>     ["family"]="XB Zar",
>     ["fullname"]="XB Zar",
>     ["psname"]="XBZar",
>     ["subfamily"]="Regular",
>    },
>    ["size"]={},
>    ["slant"]=0,
>    ["weight"]=400,
>    ["width"]=5,
>   },


and yet when I run

> \documentclass{article}
> \usepackage{fontspec}
> \begin{document}
>   \huge
>   \fontspec[Script=Arabic,Numbers=Arabic]{XB Zar}
>   test
> \end{document}


I get the following:

> luaotfload | Font names database loaded: /Users/will/Library/texlive/2010/texmf
> -var/luatex-cache/generic/names/otfl-names.lua(load: /Users/will/Library/texliv
> e/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar.lua)(load: /Users/w
> ill/Library/texlive/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar-b
> d.lua)(load: /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/fo
> nts/otf/temp-xb-zar-it.lua)(load: /Users/will/Library/texlive/2010/texmf-var/lu
> atex-cache/generic/fonts/otf/temp-xb-zar-bdit.lua) [1{/usr/local/texlive/2010/t
> exmf-var/fonts/map/pdftex/updmap/pdftex.map}] (./test.aux) )
>  276 words of node memory still in use:
>    2 hlist, 1 vlist, 1 rule, 2 glue, 3 attribute, 40 glue_spec, 3 attribute_lis
> t, 1 write nodes
>    avail lists: 2:22,3:5,4:26,6:27,7:2,9:7
> </Users/will/Library/texmf/fonts/opentype/public/lm/lmroman10-regular.otf>
> !LuaTeX error: cannot find OpenType font file for reading
>  ==> Fatal error occurred, no output PDF file produced!


What's going wrong here? Could this error messages be a little more clear?

-- Will



From khaledhosny at eglug.org  Sun Sep 26 18:14:55 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 26 Sep 2010 19:14:55 +0300
Subject: [lltx] debugging when luaotfload can't find fonts
In-Reply-To: <898677EC-27FF-4D9C-958A-8E08C463EF11@gmail.com>
References: <898677EC-27FF-4D9C-958A-8E08C463EF11@gmail.com>
Message-ID: <20100926161455.GA4684@khaled-laptop>

On Mon, Sep 27, 2010 at 01:36:52AM +0930, Will Robertson wrote:
> Hi,
> 
> I'm having trouble loading fonts and I don't know how to debug the problem.
> 
> My otfl-names.lua cache contains, for example,
> 
> >   {
> >    ["familyname"]="XB Zar",
> >    ["filename"]={ "/Users/will/Library/Fonts/XB Zar/XB Zar.ttf", false },
> >    ["fontname"]="XBZar",
> >    ["fullname"]="XB Zar",
> >    ["names"]={
> >     ["family"]="XB Zar",
> >     ["fullname"]="XB Zar",
> >     ["psname"]="XBZar",
> >     ["subfamily"]="Regular",
> >    },
> >    ["size"]={},
> >    ["slant"]=0,
> >    ["weight"]=400,
> >    ["width"]=5,
> >   },
> 
> 
> and yet when I run
> 
> > \documentclass{article}
> > \usepackage{fontspec}
> > \begin{document}
> >   \huge
> >   \fontspec[Script=Arabic,Numbers=Arabic]{XB Zar}
> >   test
> > \end{document}
> 
> 
> I get the following:
> 
> > luaotfload | Font names database loaded: /Users/will/Library/texlive/2010/texmf
> > -var/luatex-cache/generic/names/otfl-names.lua(load: /Users/will/Library/texliv
> > e/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar.lua)(load: /Users/w
> > ill/Library/texlive/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar-b
> > d.lua)(load: /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/fo
> > nts/otf/temp-xb-zar-it.lua)(load: /Users/will/Library/texlive/2010/texmf-var/lu
> > atex-cache/generic/fonts/otf/temp-xb-zar-bdit.lua) [1{/usr/local/texlive/2010/t
> > exmf-var/fonts/map/pdftex/updmap/pdftex.map}] (./test.aux) )
> >  276 words of node memory still in use:
> >    2 hlist, 1 vlist, 1 rule, 2 glue, 3 attribute, 40 glue_spec, 3 attribute_lis
> > t, 1 write nodes
> >    avail lists: 2:22,3:5,4:26,6:27,7:2,9:7
> > </Users/will/Library/texmf/fonts/opentype/public/lm/lmroman10-regular.otf>
> > !LuaTeX error: cannot find OpenType font file for reading
> >  ==> Fatal error occurred, no output PDF file produced!
> 
> 
> What's going wrong here? Could this error messages be a little more clear?

That is a PDF backend error, it means the path luaotfload had passed to
luatex is non-existent. Possible causes are: the font have been moved
and the font database is outdated (unlikely, because I check if the font
exists on the disk before passing to luatex), or the font have been
moved after being cached, and the cache contain reference to the old
path (the /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar*.lua files).

The cache handling code of ConTeXt have been kept as is, but if this is
actually the cause, I'll see if we can do some validation.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Sun Sep 26 19:08:09 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 27 Sep 2010 02:38:09 +0930
Subject: [lltx] debugging when luaotfload can't find fonts
In-Reply-To: <20100926161455.GA4684@khaled-laptop>
References: <898677EC-27FF-4D9C-958A-8E08C463EF11@gmail.com>
	<20100926161455.GA4684@khaled-laptop>
Message-ID: <9BA82567-76EF-458D-9E6E-59335604A1BB@gmail.com>

On 27/09/2010, at 1:44 AM, Khaled Hosny wrote:

> That is a PDF backend error, it means the path luaotfload had passed to
> luatex is non-existent. Possible causes are: the font have been moved
> and the font database is outdated (unlikely, because I check if the font
> exists on the disk before passing to luatex), or the font have been
> moved after being cached, and the cache contain reference to the old
> path (the /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar*.lua files).

Aha. The fonts appear to have been moved at some stage.
I had deleted the font names database in

/Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/names/otfl-names.lua

but when that was re-created it was still using the old temp-xb-zar*.lua files. I think these temp-*.lua files need to be kept up-to-date more aggressively.

-- Will



From khaledhosny at eglug.org  Sun Sep 26 19:14:01 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 26 Sep 2010 20:14:01 +0300
Subject: [lltx] debugging when luaotfload can't find fonts
In-Reply-To: <9BA82567-76EF-458D-9E6E-59335604A1BB@gmail.com>
References: <898677EC-27FF-4D9C-958A-8E08C463EF11@gmail.com>
	<20100926161455.GA4684@khaled-laptop>
	<9BA82567-76EF-458D-9E6E-59335604A1BB@gmail.com>
Message-ID: <20100926171400.GA5256@khaled-laptop>

On Mon, Sep 27, 2010 at 02:38:09AM +0930, Will Robertson wrote:
> On 27/09/2010, at 1:44 AM, Khaled Hosny wrote:
> 
> > That is a PDF backend error, it means the path luaotfload had passed to
> > luatex is non-existent. Possible causes are: the font have been moved
> > and the font database is outdated (unlikely, because I check if the font
> > exists on the disk before passing to luatex), or the font have been
> > moved after being cached, and the cache contain reference to the old
> > path (the /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/fonts/otf/temp-xb-zar*.lua files).
> 
> Aha. The fonts appear to have been moved at some stage.
> I had deleted the font names database in
> 
> /Users/will/Library/texlive/2010/texmf-var/luatex-cache/generic/names/otfl-names.lua
> 
> but when that was re-created it was still using the old temp-xb-zar*.lua files. I think these temp-*.lua files need to be kept up-to-date more aggressively.

The names list are always kept up to date, you have to delete the cached
files. Currently, the cache is not invalidated (and thus recreated) when
the font moves, I guess we should fix this.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Tue Sep 28 16:23:30 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 28 Sep 2010 23:53:30 +0930
Subject: [lltx] Fwd: Re: fontspec: No small caps with `Ligatures=TeX'
Message-ID: <3880643F-BA7E-4FF5-8F12-166D4B76AF3D@gmail.com>

Hi,

See below. From a thread on c.t.t. perhaps for future reference.
I guess I should actually put this on github.
Oh well :)

W

Subject: Re: fontspec: No small caps with `Ligatures=TeX'
From: Enrico Gregorio <gregorio at math.unipd.it>

Arash Esbati <esbati at gmx.de> wrote:

Enrico Gregorio <gregorio at math.unipd.it> writes:

There is also another one, but I'm not sure whether it depends
on fontspec or on luaotfload.

I think the culprit is `fxlb.otf' itself.  Try:

-> otfinfo -i fxlb.otf
Family:              Linux Libertine O
Subfamily:           Bold Regular
Full name:           Linux Libertine O Bold
PostScript name:     LinLibertineOB
Version:             Version 4.1.5
...

The Subfamily should be `Bold' and not `Bold Regular'.  I edited the
respecting line in my otfl-names.lua manually and it worked (see below)

{
["familyname"]="Linux Libertine O",
["filename"]={ "fxlb.otf", false },
["fontname"]="LinLibertineOB",
["fullname"]="Linux Libertine O Bold",
["names"]={
["family"]="Linux Libertine O",
["fullname"]="Linux Libertine O Bold",
["psname"]="LinLibertineOB",
["subfamily"]="Bold Regular",
["subfamily"]="Bold", <<<<---- Changed 
},
["size"]={},
["slant"]=0,
["weight"]=700,
["width"]=5,
},

What do you think, would you consider this a bug in the font?

Well found! I guess ?lie Roux or whoever is in charge of this
business should try and correct the naming algorithm. After all
"Bold Regular" doesn't seem completely incorrect, albeit nonstandard.

Ciao
Enrico


-- Will



From khaledhosny at eglug.org  Tue Sep 28 16:51:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 28 Sep 2010 17:51:43 +0300
Subject: [lltx] Fwd: Re: fontspec: No small caps with `Ligatures=TeX'
In-Reply-To: <20100928143409.GA7589@khaled-laptop>
References: <3880643F-BA7E-4FF5-8F12-166D4B76AF3D@gmail.com>
	<20100928143409.GA7589@khaled-laptop>
Message-ID: <20100928145142.GB7589@khaled-laptop>

On Tue, Sep 28, 2010 at 05:34:09PM +0300, Khaled Hosny wrote:
> On Tue, Sep 28, 2010 at 11:53:30PM +0930, Will Robertson wrote:
> > Well found! I guess ?lie Roux or whoever is in charge of this
> > business should try and correct the naming algorithm. After all
> > "Bold Regular" doesn't seem completely incorrect, albeit nonstandard.
> 
> Just tell whoever in charge of Linux Libertine to fix the font, the name
> matching code is already complex enough. I could ignore the style name
> completely and rely on the numerical wight value in the OS/2 table, but
> that would cause a load of other bugs (SemiBold, DemiBold, anyone?).

I think that was very dismissive. Technically speaking, if the font has
the proper numeric weight value, then it is not broken, but I need to
learn how to use that in away that does not break other fonts. Special
casing "Bold Regular" is not an option, what about "Bold Roman", "Bold
Book", "Bold Medium" etc.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue Sep 28 16:34:10 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 28 Sep 2010 17:34:10 +0300
Subject: [lltx] Fwd: Re: fontspec: No small caps with `Ligatures=TeX'
In-Reply-To: <3880643F-BA7E-4FF5-8F12-166D4B76AF3D@gmail.com>
References: <3880643F-BA7E-4FF5-8F12-166D4B76AF3D@gmail.com>
Message-ID: <20100928143409.GA7589@khaled-laptop>

On Tue, Sep 28, 2010 at 11:53:30PM +0930, Will Robertson wrote:
> Hi,
> 
> See below. From a thread on c.t.t. perhaps for future reference.
> I guess I should actually put this on github.
> Oh well :)
> 
> W
> 
> Subject: Re: fontspec: No small caps with `Ligatures=TeX'
> From: Enrico Gregorio <gregorio at math.unipd.it>
> 
> Arash Esbati <esbati at gmx.de> wrote:
> 
> Enrico Gregorio <gregorio at math.unipd.it> writes:
> 
> There is also another one, but I'm not sure whether it depends
> on fontspec or on luaotfload.
> 
> I think the culprit is `fxlb.otf' itself.  Try:
> 
> -> otfinfo -i fxlb.otf
> Family:              Linux Libertine O
> Subfamily:           Bold Regular
> Full name:           Linux Libertine O Bold
> PostScript name:     LinLibertineOB
> Version:             Version 4.1.5
> ...
> 
> The Subfamily should be `Bold' and not `Bold Regular'.  I edited the
> respecting line in my otfl-names.lua manually and it worked (see below)
> 
> {
> ["familyname"]="Linux Libertine O",
> ["filename"]={ "fxlb.otf", false },
> ["fontname"]="LinLibertineOB",
> ["fullname"]="Linux Libertine O Bold",
> ["names"]={
> ["family"]="Linux Libertine O",
> ["fullname"]="Linux Libertine O Bold",
> ["psname"]="LinLibertineOB",
> ["subfamily"]="Bold Regular",
> ["subfamily"]="Bold", <<<<---- Changed 
> },
> ["size"]={},
> ["slant"]=0,
> ["weight"]=700,
> ["width"]=5,
> },
> 
> What do you think, would you consider this a bug in the font?
> 
> Well found! I guess ?lie Roux or whoever is in charge of this
> business should try and correct the naming algorithm. After all
> "Bold Regular" doesn't seem completely incorrect, albeit nonstandard.

Just tell whoever in charge of Linux Libertine to fix the font, the name
matching code is already complex enough. I could ignore the style name
completely and rely on the numerical wight value in the OS/2 table, but
that would cause a load of other bugs (SemiBold, DemiBold, anyone?).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From lomov.vl at gmail.com  Thu Sep 30 07:27:12 2010
From: lomov.vl at gmail.com (Vladimir Lomov)
Date: Thu, 30 Sep 2010 14:27:12 +0900
Subject: [lltx] Hyphenation in LuaLaTeX
Message-ID: <AANLkTi=_FG0dxkohzvYYXqyDhOGiqZy_PyDifMSpCnmp@mail.gmail.com>

Hi.
I'm trying to find out how to enable hyphenation in LuaLaTeX for Russian.

I made simple example with Russian text but lualatex don't hyphenate
the text. According to log the file with Russian patterns is loaded. I
tried French, German, Polish and Dutch languages and they work well
(though there is small problem with Polish but I think this is related
with the engine itself).

Any ideas what could be the source of the problem?

Also I notice that XeLaTeX and LuaLaTeX gives slightly different
results on the same file.

I attach all necessary files.

My environment: TeX Live 2010 (with fresh updated packages) and luatex
compiled from source (SVN).
System: linux x86_64.

About test:
One could run all files either by lualatex or xelatex. If one compare
results from xelatex and lualatex one could see that lualatex gives
more compact lines but sometimes words are not hyphenated. See for
example German or Polish text.

All texts are taken from wikipedia (de, fr, nl, pl, ru parts).

For reference I attached also pdf and log files produced by lualatex
and xelatex.

P.S. OT: I wonder how many ML users have xz utility
(http://tukaani.org/xz/)? Usual it gives files smaller than bzip2 of
gzip.

---
WBR, Vladimir Lomov
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hyphen.tar.bz2
Type: application/x-bzip2
Size: 240736 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20100930/43003841/attachment-0001.bz2>

