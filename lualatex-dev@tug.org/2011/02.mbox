From taco at elvenkind.com  Fri Feb  4 09:16:33 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 04 Feb 2011 09:16:33 +0100
Subject: [lltx] [luatex] Tracking feature with microtype and LuaTeX
In-Reply-To: <EE68B169-0110-4ACB-A911-B97F08F48513@unibas.ch>
References: <EE68B169-0110-4ACB-A911-B97F08F48513@unibas.ch>
Message-ID: <4D4BB5E1.4070701@elvenkind.com>


Hi,

Added the lualatex list as a CC.

Best wishes,
Taco

On 02/04/2011 09:15 AM, Till A. Heilmann wrote:
> The tracking feature in microtype 2.5 beta-04 is supposed to work with
> LuaTeX 0.62 and above (see microtype manual p. 16). But it doesn't (see
> below). Am I doing something wrong or is it a bug?
>
> \listfiles
> \documentclass{article}
> \usepackage[tracking]{microtype}
> \begin{document}
> Test.
> \end{document}
>
> This is LuaTeX, Version beta-0.65.0-2010121316
> restricted \write18 enabled.
> (./test.tex
> LaTeX2e <2009/09/24>
> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns
> for engl
> ish, dumylang, nohyphenation, loaded.
> (/usr/local/texlive/2010/texmf-dist/tex/latex/base/article.cls
> Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
> (/usr/local/texlive/2010/texmf-dist/tex/latex/base/size10.clo))
> (/Users/till/Dropbox/texmf/tex/latex/microtype/microtype.sty
> (/usr/local/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty)
> (/Users/till/Dropbox/texmf/tex/latex/microtype/microtype-luatex.def)
> (/Users/till/Dropbox/texmf/tex/latex/microtype/microtype.cfg))
> No file test.aux.
>
> ! Package microtype Error: The tracking feature only works with pdftex 1.40
> (microtype) or newer. Switching it off.
>
> See the microtype package documentation for explanation.
> Type H <return> for immediate help.
> ...
>
> l.4 \begin{document}
>
> ?
> (/Users/till/Dropbox/texmf/tex/latex/microtype/mt-cmr.cfg)
> [1{/Users/till/Libra
> ry/texlive/2010/texmf-var/fonts/map/pdftex/updmap/pdftex.map}] (./test.aux)
>
> *File List*
> article.cls 2007/10/19 v1.4h Standard LaTeX document class
> size10.clo 2007/10/19 v1.4h Standard LaTeX file (size option)
> microtype.sty 2010/11/11 v2.5 <beta-04> Micro-typographical refinements
> (RS)
>
> keyval.sty 1999/03/16 v1.13 key=value parser (DPC)
> microtype-luatex.def
> microtype.cfg 2010/11/11 v2.5 <beta-04> microtype main configuration
> file (R
> S)
> mt-cmr.cfg 2009/11/09 v2.0 microtype config. file: Computer Modern Roman (
> RS)
> ***********
>
> )
> 260 words of node memory still in use:
> 2 hlist, 1 vlist, 1 rule, 2 glue, 39 glue_spec, 1 write nodes
> avail lists: 1:1,2:15,3:2,4:23,5:1,6:13,7:1,9:6
> </usr/local/texlive/2010/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
>
> Output written on test.pdf (1 page, 10967 bytes).
> Transcript written on test.log.
>


From w.m.l at gmx.net  Fri Feb  4 16:36:16 2011
From: w.m.l at gmx.net (Robert)
Date: Fri, 04 Feb 2011 16:36:16 +0100
Subject: [lltx] [luatex] Tracking feature with microtype and LuaTeX
In-Reply-To: <4D4BB5E1.4070701@elvenkind.com>
References: <EE68B169-0110-4ACB-A911-B97F08F48513@unibas.ch>
 <4D4BB5E1.4070701@elvenkind.com>
Message-ID: <4D4C1CF0.7030209@gmx.net>

On 02/04/2011 09:15 AM, Till A. Heilmann wrote:
> The tracking feature in microtype 2.5 beta-04 is supposed to work with
> LuaTeX 0.62 and above (see microtype manual p. 16). But it doesn't (see
> below). Am I doing something wrong or is it a bug?

Works for me. Maybe an old version of microtype-luatex.def?

Regards,
-- 
  Robert

From w.m.l at gmx.net  Fri Feb  4 17:27:04 2011
From: w.m.l at gmx.net (Robert)
Date: Fri, 04 Feb 2011 17:27:04 +0100
Subject: [lltx] [luatex] Tracking feature with microtype and LuaTeX
In-Reply-To: <4D4C1CF0.7030209@gmx.net>
References: <EE68B169-0110-4ACB-A911-B97F08F48513@unibas.ch>
 <4D4BB5E1.4070701@elvenkind.com> <4D4C1CF0.7030209@gmx.net>
Message-ID: <4D4C28D8.6050009@gmx.net>

On 04.02.11 16:36, I wrote:
> Works for me.

Because I was testing with my private version. Sorry. I've now uploaded 
beta-5 to xetex.tk and to tlcontrib (should be available at the turn of 
the hour). And then it should really work ...

Best regards,
-- 
  Robert

From news3 at nililand.de  Sat Feb  5 15:28:14 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Sat, 5 Feb 2011 15:28:14 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
	"luaotfload.patch_font"
Message-ID: <1ljwcgp8ixgpm.dlg@nililand.de>

I'm really happy that the newest version of luaotfload offers a
callback "luaotfload.patch_font" which can be use to change fonts. I
think that is really useful. As a first step I would like to use it
to reencode some chess fonts so that they can be used with latex.

Below is a small example of my first tests. It tries to replace the
"a" by a "b". For all fonts in the example I get the expected "look"
in the pdf ("bbc").

I have two questions:

1. I added some messages to the function (for diagnosing), but they
don't appear for all fonts in the log/terminal. I see messages from
the fontspec-fonts "The font is \EU2/lmr/m/it/10" but not from
"\font\mytest" and "\font\mytestb". The curious thing is that I get
a "The font is \mytest"-message if I uncomment the last fontspec, I
can't find a rule, why some messages appear and other not. Has
someone an idea?

2. For the first test I simply set 
fontdata.characters[0x0061]=fontdata.characters[0x0062]. 

But I'm really unsure which table(s) should be copied how. I think I
copied to much: When I copy&paste the output in the pdf I get "aac
aac aac". This means my code also affected the input "b" - something
I don't want.

What I want is
- only the input "a" should be affected.
- its output in the pdf should be "b" (with correct width and heigth
etc
- it should copy&paste as "a" or - better - as a completly different
character e.g. "d".

 

\documentclass{article}
\usepackage{fontspec}
\usepackage{luacode}
%
\begin{luacode*}
local function patch_font(fontdata)
  texio.write_nl("The font is", tex.fontidentifier(font.current()))
  texio.write_nl("")
  fontdata.characters[0x0061]=fontdata.characters[0x0062]
end
 luatexbase.add_to_callback("luaotfload.patch_font", patch_font,
"patch_font")
\end{luacode*}


\font\mytest="Georgia" \mytest

\begin{document}
\itshape abc \font\mytestb="Arial" \mytestb
abc \mytest abc
\newpage
abc

%\fontspec{"Arial"} abc
\end{document}


-- 
Ulrike Fischer 


From st_philipp at yahoo.de  Sat Feb  5 21:31:46 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Sat, 5 Feb 2011 21:31:46 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
	"luaotfload.patch_font"
In-Reply-To: <1ljwcgp8ixgpm.dlg@nililand.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
Message-ID: <CE5F0784-4A6C-48F9-A2D0-E37705597F62@yahoo.de>

Am 05.02.2011 um 15:28 schrieb Ulrike Fischer:

> I'm really happy that the newest version of luaotfload offers a
> callback "luaotfload.patch_font" which can be use to change fonts. I
> think that is really useful. As a first step I would like to use it
> to reencode some chess fonts so that they can be used with latex.
> 
> Below is a small example of my first tests. It tries to replace the
> "a" by a "b". For all fonts in the example I get the expected "look"
> in the pdf ("bbc").
> 
> I have two questions:
> 
> 1. I added some messages to the function (for diagnosing), but they
> don't appear for all fonts in the log/terminal. I see messages from
> the fontspec-fonts "The font is \EU2/lmr/m/it/10" but not from
> "\font\mytest" and "\font\mytestb". The curious thing is that I get
> a "The font is \mytest"-message if I uncomment the last fontspec, I
> can't find a rule, why some messages appear and other not. Has
> someone an idea?

Font loading happens *before* the font is assigned to a font definition token, and before selecting the font. `font.current()`, however, returns the number of the most recently selected font, which is never the font being loaded (because TeX simply doesn't know the latter yet). You can test that by comparing the requested with the current font:

local function patch_font(fontdata)
 texio.write_nl("The font is " .. tex.fontidentifier(font.current()) .. " while loading " .. fontdata.name)
end

This gives:

The font is \EU2/lmr/m/n/10 while loading Georgia  % while executing \font\mytest=Georgia; the default font (Latin Modern Roman) is the current one
The font is EU2/lmr/m/n/10 while loading file:lmroman10-italic:script=latn;+trep;+tlig;  % while executing \itshape; LM Roman is still selected
The font is \EU2/lmr/m/it/10 while loading Arial  % while \font\mytestb="Arial"; LM Italic is the current font


> 
> 2. For the first test I simply set 
> fontdata.characters[0x0061]=fontdata.characters[0x0062]. 
> 
> But I'm really unsure which table(s) should be copied how.

That line doesn't copy anything, it just has char 0x61 point to the same table as char 0x62.

> I think I
> copied to much: When I copy&paste the output in the pdf I get "aac
> aac aac". This means my code also affected the input "b" - something
> I don't want.
> 
> What I want is
> - only the input "a" should be affected.
> - its output in the pdf should be "b" (with correct width and heigth
> etc
> - it should copy&paste as "a" or - better - as a completly different
> character e.g. "d".

You have to set the `tounicode` table entry:

 fontdata.tounicode = 1
 local a = { }
 local b = fontdata.characters[0x0062]
 local c = fontdata.characters[0x0063]
 for k, v in pairs(b) do
   a[k] = v
 end
 a.tounicode = "0064"
 b.tounicode = "0062"
 c.tounicode = "0063"
 fontdata.characters[0x0061] = a

This doesn't work as expected (you still get "ddc" instead of "dbc"), so I'm CC'ing Taco.

I think for your problem you should prefer virtual fonts over font patching. I requested the addition of the patch_font callback to be able to fix minor bugs (e.g. a wrong math parameter in Cambria Math) during font loading. Remapping characters should probably be done by means of virtual fonts:

\documentclass{article}
\usepackage{fontspec}
\usepackage{luacode}
\font\realfont={name:LMRoman10-Regular:}\relax
\begin{luacode*}
local real_id = font.id("realfont")
local real_data = font.getfont(real_id)
local virtual_data = {
  type = "virtual",
  name = "test",
  tounicode = 1,
  fonts = {
    { id = font.id("realfont"), size = 0xA0000 }
  },
  characters = { }
}
for k, v in pairs(real_data.characters) do
  local i, c, u
  if k == 0x0061 then
    i = 0x0062
    c = real_data.characters[i]
    u = "0064"
  else
    i = k
    c = v
    u = c.tounicode or (i < 0xFFFF and string.format("%04X", i))
  end
  virtual_data.characters[k] = {
    width = c.width,
    height = c.height,
    depth = c.depth,
    tounicode = u,
    commands = {
      { "char", i }
    }
  }
end
local virtual_id = font.define(virtual_data)
function select_virtual_font()
  font.current(virtual_id)
end
\end{luacode*}
\begin{document}
\luadirect{select_virtual_font()}
abc
\end{document}

The tounicode entries still don't work as expected; hopefully Taco can enlighten us.

From taco at elvenkind.com  Sun Feb  6 10:25:06 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 06 Feb 2011 10:25:06 +0100
Subject: [lltx] Patching fonts with the luaotfload
	callback	"luaotfload.patch_font"
In-Reply-To: <CE5F0784-4A6C-48F9-A2D0-E37705597F62@yahoo.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <CE5F0784-4A6C-48F9-A2D0-E37705597F62@yahoo.de>
Message-ID: <4D4E68F2.9030601@elvenkind.com>

On 02/05/2011 09:31 PM, Philipp Stephani wrote:
>
> The tounicode entries still don't work as expected; hopefully Taco can enlighten us.

tounicode (and the PDF /ToUnicode feature) works on the font glyphs
that are actually included in the pdf, that is why it does not work. In
the virtual font, it does notwork because there is no actual glyph, and
in the original is works 'too well' as both 'a' and 'b' use the same
glyph.

As long as you are actually re-encoding, it is not too hard to alter
the font, but getting two input characters that map to the same glyph
to have two different tounicode values is impossible.

Virtual fonts do not really help that much for the posted problem
because of the need to adjust tounicode as well. The code in the first
post was good enough, except for a lua misunderstanding:

   fontdata.characters[0x0061] = fontdata.characters[0x0062]

is a variable assignment, not a table copy. To create an actual
copy of fontdata.characters[0x0062], you would need to do something
like this:

   fontdata.characters[0x0061]={}
   -- copy the table from 'b'
   for a,v in pairs(fontdata.characters[0x0062]) do
     fontdata.characters[0x0061][a] = v
   end

(if you are re-encoding an entire font, it is more efficient to
use a remap table to actually swap the table entries instead of
copying all keys.)

After the assignment(s), you can add

   fontdata.characters[0x0061].tounicode = "0061"

to set the correct tounicode value.

Best wishes,
Taco





From news3 at nililand.de  Sun Feb  6 18:03:46 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Sun, 6 Feb 2011 18:03:46 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
	"luaotfload.patch_font"
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <CE5F0784-4A6C-48F9-A2D0-E37705597F62@yahoo.de>
Message-ID: <18x8tfw34stlj$.dlg@nililand.de>

Am Sat, 5 Feb 2011 21:31:46 +0100 schrieb Philipp Stephani:

 
>> I'm really happy that the newest version of luaotfload offers a
>> callback "luaotfload.patch_font" which can be use to change fonts. I
>> think that is really useful. As a first step I would like to use it
>> to reencode some chess fonts so that they can be used with latex.
>> 
>> Below is a small example of my first tests. It tries to replace the
>> "a" by a "b". For all fonts in the example I get the expected "look"
>> in the pdf ("bbc").
>> 
>> I have two questions:
>> 
>> 1. I added some messages to the function (for diagnosing), but they
>> don't appear for all fonts in the log/terminal. I see messages from
>> the fontspec-fonts "The font is \EU2/lmr/m/it/10" but not from
>> "\font\mytest" and "\font\mytestb". The curious thing is that I get
>> a "The font is \mytest"-message if I uncomment the last fontspec, I
>> can't find a rule, why some messages appear and other not. Has
>> someone an idea?
> 
> Font loading happens *before* the font is assigned to a font
> definition token, and before selecting the font.

Yes I realized that some time I sent the question. Pitty as I wanted
to use the information about the TeX-fontname in the patch.  


> I think for your problem you should prefer virtual fonts over font
> patching. I requested the addition of the patch_font callback to
> be able to fix minor bugs (e.g. a wrong math parameter in Cambria
> Math) during font loading. Remapping characters should probably
> be done by means of virtual fonts:

In theory I agree, after my first tests I didn't feel very
confortable with the patch_callback as if affects every font. In
practice I don't know how to use virtual fonts in sensible way. In
your example you are activitating the virtual fonts with some
luacode (\luadirect{select_virtual_font()}) and you have to load the
real font before. 

But I want in the end to do something like
\font\myfont="myvirtualfont". The luatex manual contains an example
with a virtual font and this syntax. But it uses the define_callback
to implement it and at my opinion this is not the right place to
define a single virtual font. It would be much better if one could
store the definitions of the virtual font in a stand-alone file and
let luaotfload "find" and handle the font. But I don't neither if
this is already possible nor how. 




-- 
Ulrike Fischer 


From st_philipp at yahoo.de  Sun Feb  6 18:34:42 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Sun, 06 Feb 2011 18:34:42 +0100
Subject: [lltx] Patching fonts with the luaotfload
	callback	"luaotfload.patch_font"
In-Reply-To: <18x8tfw34stlj$.dlg@nililand.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <CE5F0784-4A6C-48F9-A2D0-E37705597F62@yahoo.de>
 <18x8tfw34stlj$.dlg@nililand.de>
Message-ID: <4D4EDBB2.3050906@yahoo.de>

Am 06.02.2011 18:03, schrieb Ulrike Fischer:
> But I want in the end to do something like
> \font\myfont="myvirtualfont". The luatex manual contains an example
> with a virtual font and this syntax. But it uses the define_callback
> to implement it and at my opinion this is not the right place to
> define a single virtual font. It would be much better if one could
> store the definitions of the virtual font in a stand-alone file and
> let luaotfload "find" and handle the font. But I don't neither if
> this is already possible nor how. 

This has always been possible, long before LuaTeX was invented:
http://www.tex.ac.uk/cgi-bin/texfaq2html?label=virtualfonts

From till.heilmann at unibas.ch  Sun Feb  6 22:27:34 2011
From: till.heilmann at unibas.ch (Till A. Heilmann)
Date: Sun, 6 Feb 2011 22:27:34 +0100
Subject: [lltx] [luatex]   Tracking feature with microtype and LuaTeX
Message-ID: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>

With the new microtype beta 5, the above minimal example works. Thank  
you for your help--and, obviously, for all the fantastic work you  
guys are putting into Lua(La)TeX and the packages!

Things are different (and much more complicated) for my real life  
book project, though. In this particular and rather complex case, I  
cannot seem to get it right. It is difficult to explain in detail,  
but I will try to show some of the problems bothering me with two  
other (almost) minimal examples.

Consider this file first ...

\documentclass{article}
\usepackage[ngerman]{babel}
\usepackage{blindtext}
\usepackage{fontspec}
\usepackage[T1]{fontenc}
\setmainfont{TeX Gyre Bonum}
\renewcommand{\rmdefault}{qbk}
\newcommand{\mysmallfont}{\fontsize{8}{10}\rmfamily}
\usepackage[tracking=true,letterspace=0]{microtype}
\DeclareMicrotypeSet*[tracking]{mytracking}{encoding={*}}
\SetTracking{encoding={*},family={rm*},size={8}}{188}
\begin{document}
\blindtext\par
\mysmallfont
\blindtext
\end{document}

The code works just the way I want it: The tracking feature of  
microtype is enabled and fonts are not letterspaced in general but  
only in specified cases (e.g. serif fonts in size 8pt).

What I do not understand is why

a) I have to load the fontenc package (line 5) with option T1 (I keep  
reading loading fontenc is not necessary with fontspec)

and why

b) I need to set Bonum as \rmdefault with \renewcommand (line 7): is  
\setmainfont not supposed to handle this?

Without fontenc, tracking works but the document is set not in Bonum  
but in Computern Modern. Without \renewcommand{\rmdefault}{qbk},  
neither the tracking works nor is Bonum used.

As a consequence, I load fontenc but this, in turn, breaks some of my  
characters: Consider the second file ...

\documentclass{article}
\usepackage{fontspec}
\usepackage[T1]{fontenc}
\setmainfont{TeX Gyre Bonum}
\begin{document}
? ? ?
\end{document}

Now, Bonum is not used and the sharp S, the ellipsis, and the en dash  
are set wrong (or not at all), apparently because fontenc *is* loaded  
(line 3). Without loading fontenc, it works just fine (and no need  
for a \renewcommand{\rmdefault}{qbk} either).

I'm confused.
-- 
Dr. Till A. Heilmann
Assistenz

UNIVERSIT?T BASEL
Institut f?r Medienwissenschaft
Bernoullistrasse 28
CH-4056 Basel
Tel. +41 (0)61 267 09 86 (direkt)
Tel. +41 (0)61 267 09 11 (Sekretariat)
Fax  +41 (0)61 267 08 87
E-Mail till.heilmann at unibas.ch
www.mewi.unibas.ch


-------------- next part --------------
A non-text attachment was scrubbed...
Name: theilmann_card_de.vcf
Type: text/directory
Size: 634 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20110206/419d25ca/attachment.bin>
-------------- next part --------------



From khaledhosny at eglug.org  Sun Feb  6 22:30:12 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 6 Feb 2011 23:30:12 +0200
Subject: [lltx] Reencode chessfonts with luaoftload
In-Reply-To: <20101025110729.GA24338@khaled-laptop>
References: <houh97n0s5t8$.dlg@nililand.de>
 <20101025110729.GA24338@khaled-laptop>
Message-ID: <20110206213012.GA21211@khaled-laptop>

On Mon, Oct 25, 2010 at 01:07:29PM +0200, Khaled Hosny wrote:
> > 5. Is there some code around which generates like (nfssfont.tex) a
> > neat font table of a ttf-font?
> 
> I need one, if you found any (to make tables for XITS and other fonts).

I just found fntsample[1], very nice tool.

[1] http://fntsample.sourceforge.net/

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian

From reinhard.kotucha at web.de  Mon Feb  7 02:08:43 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 7 Feb 2011 02:08:43 +0100
Subject: [lltx] Reencode chessfonts with luaoftload
In-Reply-To: <20110206213012.GA21211@khaled-laptop>
References: <houh97n0s5t8$.dlg@nililand.de>
 <20101025110729.GA24338@khaled-laptop>
 <20110206213012.GA21211@khaled-laptop>
Message-ID: <19791.17947.420764.777481@zaphod.ms25.net>

On 6 February 2011 Khaled Hosny wrote:

 > On Mon, Oct 25, 2010 at 01:07:29PM +0200, Khaled Hosny wrote:
 > > > 5. Is there some code around which generates like (nfssfont.tex) a
 > > > neat font table of a ttf-font?
 > > 
 > > I need one, if you found any (to make tables for XITS and other fonts).
 > 
 > I just found fntsample[1], very nice tool.
 > 
 > [1] http://fntsample.sourceforge.net/

Very nice indeed.  Just tried with OTF, TTF, and Type 1.  Shows all
glyphs in a Type 1 font.  Also a nice example for programming with
cairo/pango/freetype.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From wspr81 at gmail.com  Mon Feb  7 12:48:52 2011
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 7 Feb 2011 22:18:52 +1030
Subject: [lltx] [luatex]   Tracking feature with microtype and LuaTeX
In-Reply-To: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>
References: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>
Message-ID: <BF565B99-59CA-428F-A154-8E0A3C548D1A@gmail.com>

On 07/02/2011, at 7:57 AM, Till A. Heilmann wrote:

> a) I have to load the fontenc package (line 5) with option T1 (I keep reading loading fontenc is not necessary with fontspec)
> 
> and why
> 
> b) I need to set Bonum as \rmdefault with \renewcommand (line 7): is \setmainfont not supposed to handle this?

These lines eliminate what fontspec is doing to load the OpenType fonts. But it makes sense that you need to do this to because we haven't attempted any integration between microtype and fontspec yet. To be honest I've tried not to think about it.

Robert, have you any idea what is required in fontspec to achieve this? I have to admit not spending much time in microtype's internals.

Khaled had a couple of simple options in fontspec that bypassed microtype to activate the hz features but I thought it was better to wait until we could integrate the packages properly.

-- Will



From till.heilmann at unibas.ch  Tue Feb  8 14:57:54 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Tue, 8 Feb 2011 14:57:54 +0100
Subject: [lltx] German hyphenation, fontspec and adjusted kerning
Message-ID: <81EE4468-CD13-45B0-9F83-E0F5F3DC8E8A@unibas.ch>

As Ulrike Fischer pointed out to me, the German hyphenation patterns conflict with the adjustment of kerning pairs via fontspec and OTF feature files.

Minimal example ...

bonum.fea

languagesystem DFLT dflt;
languagesystem latn dflt;
feature kern {
pos f h 100;
} kern;

test.tex

\documentclass{article}
\makeatletter\bbl at patterns{ngerman}\makeatother
\usepackage{fontspec}
\setmainfont[FeatureFile=bonum.fea]{TeX Gyre Bonum}
\begin{document}
fh aufhalten
\end{document}

Is this a bug that can be fixed or do we have to live with it?
-- 
Dr. Till A. Heilmann
Research Assistant

UNIVERSITY OF BASEL
Institute for Media Studies
Bernoullistrasse 28
CH-4056 Basel
Tel. +41 (0)61 267 09 86
Fax  +41 (0)61 267 08 87
E-Mail till.heilmann at unibas.ch
www.mewi.unibas.ch

-------------- next part --------------
A non-text attachment was scrubbed...
Name: theilmann_card_en.vcf
Type: text/directory
Size: 614 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20110208/5fad1d74/attachment.bin>
-------------- next part --------------


From elie.roux at telecom-bretagne.eu  Tue Feb  8 16:10:04 2011
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 08 Feb 2011 16:10:04 +0100
Subject: [lltx] strange pdf
Message-ID: <4D515CCC.2020100@telecom-bretagne.eu>

Hello,

on http://norgz.guiling.fr/optima/ is a strange pdf : it shows well with 
xpdf and poppler, but on Acrobat Reader (latest versions of Linux and 
Windows), the italic words show up regular... Is it a bug in LuaTeX, 
fontspec, luaotfload or Acrobat Reader? I don't really know where to 
start as I'm far from being a pdf expert... In the same directory are 
the log file as well as the fonts with which I had this behaviour.

Thank you,
-- 
Elie

From w.m.l at gmx.net  Tue Feb  8 16:42:40 2011
From: w.m.l at gmx.net (Robert)
Date: Tue, 08 Feb 2011 16:42:40 +0100
Subject: [lltx] [luatex]   Tracking feature with microtype and LuaTeX
In-Reply-To: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>
References: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>
Message-ID: <4D516470.7040106@gmx.net>

[Sorry, Till, this was supposed to go to the lists]

On 06.02.11 22:27, Till A. Heilmann wrote:
 > What I do not understand is why
 >
 > a) I have to load the fontenc package (line 5) with option T1 (I keep
 > reading loading fontenc is not necessary with fontspec)
 >
 > and why
 >
 > b) I need to set Bonum as \rmdefault with \renewcommand (line 7): is
 > \setmainfont not supposed to handle this?

As Will noted, you disable fontenc with these lines.

The problem was that microtype did not correctly expand the variable 
"rm*" in the \SetTracking definition. It would have worked if you had 
written:

\SetTracking{encoding={*},family={TeX Gyre Bonum},size={8}}{188}

I've fixed this now in tlcontrib, so that you can remove lines 5 and 7 
again, and still say "rm*".

Regards,
-- 
  Robert

From w.m.l at gmx.net  Tue Feb  8 16:43:35 2011
From: w.m.l at gmx.net (Robert)
Date: Tue, 08 Feb 2011 16:43:35 +0100
Subject: [lltx] [luatex]   Tracking feature with microtype and LuaTeX
In-Reply-To: <BF565B99-59CA-428F-A154-8E0A3C548D1A@gmail.com>
References: <5CF0721B-0E60-4C52-BEAC-7FB4DBE6F342@unibas.ch>
 <BF565B99-59CA-428F-A154-8E0A3C548D1A@gmail.com>
Message-ID: <4D5164A7.2010202@gmx.net>

[Sorry, Will, this was supposed to go to the lists]

On 07.02.11 12:48, Will Robertson wrote:
 > Robert, have you any idea what is required in fontspec to achieve
 > this?

In this case, it was simply a bug in microtype (see my other mail). The 
basic things should already work.

However, both packages could indeed be integrated better. At the moment, 
microtype still uses the pdftex primitives to set up the fonts (\lccode 
etc.), while fontspec of course loads and modifies them in lua. The 
following would be conceptually cleaner, and probably also faster:
  * fontspec would call microtype just before loading the font,
  * microtype would then return a lua configuration table for this font,
  * and fontspec would pass this table to luaotfload (instead of 
luaotfload's "default" ones, which are really not very good IMHO)

In fontspec, this would probably only require the addition of one line. 
Unfortunately for me, the bulk of the changes would have to be made in 
microtype. And I won't be able to even start working on this before 
March ...


Regards,
-- 
  Robert

From zappathustra at free.fr  Tue Feb  8 16:52:40 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 08 Feb 2011 16:52:40 +0100
Subject: [lltx] [luatex] strange pdf
In-Reply-To: <4D515CCC.2020100@telecom-bretagne.eu>
References: <4D515CCC.2020100@telecom-bretagne.eu>
Message-ID: <4D5166C8.6070701@free.fr>

Le 08/02/2011 16:10, Elie Roux a ?crit :
> Hello,
>
> on http://norgz.guiling.fr/optima/ is a strange pdf : it shows well 
> with xpdf and poppler, but on Acrobat Reader (latest versions of Linux 
> and Windows), the italic words show up regular... Is it a bug in 
> LuaTeX, fontspec, luaotfload or Acrobat Reader? I don't really know 
> where to start as I'm far from being a pdf expert... In the same 
> directory are the log file as well as the fonts with which I had this 
> behaviour.

Unfortunately the fonts can't be accessed.
Anyway:
- make the same document with XeTeX, or even with OpenOffice or whatever 
(and turn it into a PDF in the later case); if the trouble remains, it 
comes from Acrobat or the font. Otherwise, the trouble comes from the 
packages or LuaTeX, so:
- Remove fontspec, i.e. use luaotfload directly: \input luaotfload.sty 
\font\myfont{Optima-Oblique.otf}, etc. If the problem remains:
- Load the font by yourself, without luaotfload.sty 
(http://wiki.luatex.org/index.php/Use_a_TrueType_font). If the problem 
remains: you have a bug.

Best,
Paul

From heiko.oberdiek at googlemail.com  Tue Feb  8 17:23:00 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Tue, 8 Feb 2011 17:23:00 +0100
Subject: [lltx] strange pdf
In-Reply-To: <4D515CCC.2020100@telecom-bretagne.eu>
References: <4D515CCC.2020100@telecom-bretagne.eu>
Message-ID: <20110208162300.GA17500@oberdiek.my-fqdn.de>

On Tue, Feb 08, 2011 at 04:10:04PM +0100, Elie Roux wrote:

> on http://norgz.guiling.fr/optima/ is a strange pdf : it shows well
> with xpdf and poppler,

xpdf 3.00: "s  es seco   es"
gs 8.70: "first    second"
acroread5/linux, acroread7/linux:
  "first test second test" with "test" in italics.
acroread8/linux: "first test second test" without italics

Result of "pdffonts testbug.pdf":

name                                 type         emb sub uni object ID
------------------------------------ ------------ --- --- --- ---------
FTDOSG+Optima                        CID Type 0C  yes yes yes      4  0
ONVDNU+Optima-Oblique                CID Type 0C  yes yes yes      5  0

Yours sincerely
  Heiko Oberdiek

From zappathustra at free.fr  Tue Feb  8 17:39:16 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 08 Feb 2011 17:39:16 +0100
Subject: [lltx] [luatex]  strange pdf
In-Reply-To: <20110208162300.GA17500@oberdiek.my-fqdn.de>
References: <4D515CCC.2020100@telecom-bretagne.eu>
 <20110208162300.GA17500@oberdiek.my-fqdn.de>
Message-ID: <4D5171B4.9090401@free.fr>

Also note that Windows can't read the font files (there are accessible 
after all, sorry for my earlier statement) and won't install it. It says 
they're invalid.
Best,
Paul

Le 08/02/2011 17:23, Heiko Oberdiek a ?crit :
> On Tue, Feb 08, 2011 at 04:10:04PM +0100, Elie Roux wrote:
>
>> on http://norgz.guiling.fr/optima/ is a strange pdf : it shows well
>> with xpdf and poppler,
> xpdf 3.00: "s  es seco   es"
> gs 8.70: "first    second"
> acroread5/linux, acroread7/linux:
>    "first test second test" with "test" in italics.
> acroread8/linux: "first test second test" without italics
>
> Result of "pdffonts testbug.pdf":
>
> name                                 type         emb sub uni object ID
> ------------------------------------ ------------ --- --- --- ---------
> FTDOSG+Optima                        CID Type 0C  yes yes yes      4  0
> ONVDNU+Optima-Oblique                CID Type 0C  yes yes yes      5  0
>
> Yours sincerely
>    Heiko Oberdiek

From luigi.scarso at gmail.com  Tue Feb  8 17:54:38 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 8 Feb 2011 17:54:38 +0100
Subject: [lltx] strange pdf
In-Reply-To: <4D515CCC.2020100@telecom-bretagne.eu>
References: <4D515CCC.2020100@telecom-bretagne.eu>
Message-ID: <AANLkTikmorO0HByQMtSUutPpn1e9F_A9D-9P3X5Z0=Wu@mail.gmail.com>

On Tue, Feb 8, 2011 at 4:10 PM, Elie Roux <elie.roux at telecom-bretagne.eu> wrote:
> Hello,
>
> on http://norgz.guiling.fr/optima/ is a strange pdf : it shows well with
> xpdf and poppler, but on Acrobat Reader (latest versions of Linux and
> Windows), the italic words show up regular... Is it a bug in LuaTeX,
> fontspec, luaotfload or Acrobat Reader? I don't really know where to start
> as I'm far from being a pdf expert... In the same directory are the log file
> as well as the fonts with which I had this behaviour.
>
> Thank you,
> --
> Elie
>
adobe reader 9.4.1
first test second test
'test' are not slanted

mupdf 0.6
first test second test
'test' are slanted

xpdf 3.02
first test second test
'test' are  slanted

gs 9.0
first test second test
'test' are  missing


-- 
luigi

From elie.roux at telecom-bretagne.eu  Wed Feb  9 10:11:39 2011
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 09 Feb 2011 10:11:39 +0100
Subject: [lltx] [luatex] strange pdf
In-Reply-To: <4D5166C8.6070701@free.fr>
References: <4D515CCC.2020100@telecom-bretagne.eu> <4D5166C8.6070701@free.fr>
Message-ID: <4D525A4B.8040403@telecom-bretagne.eu>

Hello,

sorry for the noise, I didn't suspect the font and it was the culprit... 
With another version everything works perfectly fine!

Thank you,
-- 
Elie

From patrick at gundla.ch  Wed Feb 16 14:30:14 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 16 Feb 2011 14:30:14 +0100
Subject: [lltx] endless loop
Message-ID: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>

Hi,

I come across this error when using lualatex:

------------------------------------------------
[many messages like these:]
luaotfload | Font names database not found, generating new one.
             This can take several minutes; please be patient.
luaotfload | Updating the font names database:
! LuaTeX error ...e2010/texmf-dist/tex/luatex/lualibs/lualibs-file.lua:75: stac
k overflow.
<to be read again> 
                   \scan_stop: 
l.4 \setmainfont{TeX Gyre Bonum}
------------------------------------------------                                


The input file is from a question on the luatex list:

------------------------------------------------
\documentclass{article}
\usepackage[ngerman]{babel}
\usepackage{fontspec}
\setmainfont{TeX Gyre Bonum}
\begin{document}
fh aufhalten
\end{document}
------------------------------------------------


Now- what to do?

Thanks!
Patrick                                                  




From zappathustra at free.fr  Wed Feb 16 14:35:21 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 16 Feb 2011 14:35:21 +0100
Subject: [lltx] endless loop
In-Reply-To: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
Message-ID: <4D5BD299.9020802@free.fr>

I've encountered it recently, and Manuel too. For the moment, the 
solution (if I remember correctly what I've done) is to create a dummy 
database file with nothing in it, where luaotfload would have put it, i.e.:

$home/.texlive2010/texmf-var/luatex-cache/generic/names/otfl-names.lua

But Manuel will send a bug report to Khaled, so it should be fixed soon.

Best,
Paul

Le 16/02/2011 14:30, Patrick Gundlach a ?crit :
> Hi,
>
> I come across this error when using lualatex:
>
> ------------------------------------------------
> [many messages like these:]
> luaotfload | Font names database not found, generating new one.
>               This can take several minutes; please be patient.
> luaotfload | Updating the font names database:
> ! LuaTeX error ...e2010/texmf-dist/tex/luatex/lualibs/lualibs-file.lua:75: stac
> k overflow.
> <to be read again>
>                     \scan_stop:
> l.4 \setmainfont{TeX Gyre Bonum}
> ------------------------------------------------
>
>
> The input file is from a question on the luatex list:
>
> ------------------------------------------------
> \documentclass{article}
> \usepackage[ngerman]{babel}
> \usepackage{fontspec}
> \setmainfont{TeX Gyre Bonum}
> \begin{document}
> fh aufhalten
> \end{document}
> ------------------------------------------------
>
>
> Now- what to do?
>
> Thanks!
> Patrick
>
>
>

From khaledhosny at eglug.org  Wed Feb 16 16:26:00 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 16 Feb 2011 17:26:00 +0200
Subject: [lltx] endless loop
In-Reply-To: <4D5BD299.9020802@free.fr>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr>
Message-ID: <20110216152600.GC2349@khaled-laptop>

On Wed, Feb 16, 2011 at 02:35:21PM +0100, Paul Isambert wrote:
> I've encountered it recently, and Manuel too. For the moment, the
> solution (if I remember correctly what I've done) is to create a
> dummy database file with nothing in it, where luaotfload would have
> put it, i.e.:
> 
> $home/.texlive2010/texmf-var/luatex-cache/generic/names/otfl-names.lua
> 
> But Manuel will send a bug report to Khaled, so it should be fixed soon.

Fixed on git few days ago, I think it deserves a release. I wounder why
everyone is encountering it just now (this is like the fifth report)
though the bug have been there for ages.

Regards,
 Khaled

> 
> Best,
> Paul
> 
> Le 16/02/2011 14:30, Patrick Gundlach a ?crit :
> >Hi,
> >
> >I come across this error when using lualatex:
> >
> >------------------------------------------------
> >[many messages like these:]
> >luaotfload | Font names database not found, generating new one.
> >              This can take several minutes; please be patient.
> >luaotfload | Updating the font names database:
> >! LuaTeX error ...e2010/texmf-dist/tex/luatex/lualibs/lualibs-file.lua:75: stac
> >k overflow.
> ><to be read again>
> >                    \scan_stop:
> >l.4 \setmainfont{TeX Gyre Bonum}
> >------------------------------------------------
> >
> >
> >The input file is from a question on the luatex list:
> >
> >------------------------------------------------
> >\documentclass{article}
> >\usepackage[ngerman]{babel}
> >\usepackage{fontspec}
> >\setmainfont{TeX Gyre Bonum}
> >\begin{document}
> >fh aufhalten
> >\end{document}
> >------------------------------------------------
> >
> >
> >Now- what to do?
> >
> >Thanks!
> >Patrick
> >
> >
> >

-- 
 Khaled Hosny
 Egyptian

From mpg at elzevir.fr  Thu Feb 17 12:43:39 2011
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Thu, 17 Feb 2011 12:43:39 +0100
Subject: [lltx] endless loop
In-Reply-To: <20110216152600.GC2349@khaled-laptop>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
Message-ID: <4D5D09EB.60106@elzevir.fr>

Le 16/02/2011 16:26, Khaled Hosny a ?crit :
> Fixed on git few days ago, I think it deserves a release.

I'm glad you fixed it and are about to release the fixed version.

May I suggest that you add to the code a global counter of how many times
database (re-)generation was attempted and stop trying if it reaches, say 3.
This way, future similar bugs would not trigger an endless loop. (Interestingly
enough, on my Linux machine, I rapidly got a stack overflow, while on the
windows (virtual) box, I had to kill the process after a few minutes.)

> I wounder why
> everyone is encountering it just now (this is like the fifth report)
> though the bug have been there for ages.
> 
The bug happens only when there is no name database at all, so it doesn't happen
if you used a previous version of luaotfload. It happens only on new
installations and when you remove all cache files.

Maybe a lot of people are either trying it for the first time or using a new
installation?

Manuel.

From khaledhosny at eglug.org  Thu Feb 17 12:53:36 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 17 Feb 2011 13:53:36 +0200
Subject: [lltx] endless loop
In-Reply-To: <4D5D09EB.60106@elzevir.fr>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr>
Message-ID: <20110217115336.GA2677@khaled-laptop>

On Thu, Feb 17, 2011 at 12:43:39PM +0100, Manuel P?gouri?-Gonnard wrote:
> Le 16/02/2011 16:26, Khaled Hosny a ?crit :
> > Fixed on git few days ago, I think it deserves a release.
> 
> I'm glad you fixed it and are about to release the fixed version.
> 
> May I suggest that you add to the code a global counter of how many times
> database (re-)generation was attempted and stop trying if it reaches, say 3.
> This way, future similar bugs would not trigger an endless loop. (Interestingly
> enough, on my Linux machine, I rapidly got a stack overflow, while on the
> windows (virtual) box, I had to kill the process after a few minutes.)

The loop itself was the bug, it shouldn't be looping at all (I was
simply calling a function1 that calls function2 but function2 were in
turn calling function1 again :) The new version already uploaded to
CTAN.

> > I wounder why
> > everyone is encountering it just now (this is like the fifth report)
> > though the bug have been there for ages.
> > 
> The bug happens only when there is no name database at all, so it doesn't happen
> if you used a previous version of luaotfload. It happens only on new
> installations and when you remove all cache files.

I know, it is just interesting how many people run into this just now
though it have been laying there for months.

> Maybe a lot of people are either trying it for the first time or using a new
> installation?

May be.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian

From mpg at elzevir.fr  Thu Feb 17 13:07:59 2011
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Thu, 17 Feb 2011 13:07:59 +0100
Subject: [lltx] endless loop
In-Reply-To: <20110217115336.GA2677@khaled-laptop>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr> <20110217115336.GA2677@khaled-laptop>
Message-ID: <4D5D0F9F.5010804@elzevir.fr>

Le 17/02/2011 12:53, Khaled Hosny a ?crit :
>> May I suggest that you add to the code a global counter of how many times
>> database (re-)generation was attempted and stop trying if it reaches, say 3.
>> This way, future similar bugs would not trigger an endless loop. (Interestingly
>> enough, on my Linux machine, I rapidly got a stack overflow, while on the
>> windows (virtual) box, I had to kill the process after a few minutes.)
> 
> The loop itself was the bug, it shouldn't be looping at all (I was
> simply calling a function1 that calls function2 but function2 were in
> turn calling function1 again :) The new version already uploaded to
> CTAN.
> 
I understand that. I just wanted to suggest an additional safety net so that, if
another similar bug ever happens, it is catched more cleanly.

Manuel.

From khaledhosny at eglug.org  Thu Feb 17 14:06:18 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 17 Feb 2011 15:06:18 +0200
Subject: [lltx] endless loop
In-Reply-To: <4D5D0F9F.5010804@elzevir.fr>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr> <20110217115336.GA2677@khaled-laptop>
 <4D5D0F9F.5010804@elzevir.fr>
Message-ID: <20110217130618.GA5265@khaled-laptop>

On Thu, Feb 17, 2011 at 01:07:59PM +0100, Manuel P?gouri?-Gonnard wrote:
> Le 17/02/2011 12:53, Khaled Hosny a ?crit :
> >> May I suggest that you add to the code a global counter of how many times
> >> database (re-)generation was attempted and stop trying if it reaches, say 3.
> >> This way, future similar bugs would not trigger an endless loop. (Interestingly
> >> enough, on my Linux machine, I rapidly got a stack overflow, while on the
> >> windows (virtual) box, I had to kill the process after a few minutes.)
> > 
> > The loop itself was the bug, it shouldn't be looping at all (I was
> > simply calling a function1 that calls function2 but function2 were in
> > turn calling function1 again :) The new version already uploaded to
> > CTAN.
> > 
> I understand that. I just wanted to suggest an additional safety net so that, if
> another similar bug ever happens, it is catched more cleanly.

The database generation code should already run at most once, but here
it didn't get executed actually, it was looping very early.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian

From mpg at elzevir.fr  Thu Feb 17 14:11:39 2011
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Thu, 17 Feb 2011 14:11:39 +0100
Subject: [lltx] endless loop
In-Reply-To: <20110217130618.GA5265@khaled-laptop>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr> <20110217115336.GA2677@khaled-laptop>
 <4D5D0F9F.5010804@elzevir.fr> <20110217130618.GA5265@khaled-laptop>
Message-ID: <4D5D1E8B.2020103@elzevir.fr>

Le 17/02/2011 14:06, Khaled Hosny a ?crit :
> The database generation code should already run at most once, but here
> it didn't get executed actually, it was looping very early.
> 
Ok, now I see.

Thanks,
Manuel.

From news3 at nililand.de  Thu Feb 17 14:12:46 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 17 Feb 2011 14:12:46 +0100
Subject: [lltx] endless loop
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr> <20110217115336.GA2677@khaled-laptop>
Message-ID: <lmj35nhq5m6b$.dlg@nililand.de>

Am Thu, 17 Feb 2011 13:53:36 +0200 schrieb Khaled Hosny:

>>> I wounder why everyone is encountering it just now (this is like
>>> the fifth report) though the bug have been there for ages.

>> The bug happens only when there is no name database at all, so it doesn't happen
>> if you used a previous version of luaotfload. It happens only on new
>> installations and when you remove all cache files.

> I know, it is just interesting how many people run into this just now
> though it have been laying there for months.

The example of Patrick suggests that he tried to investigate a
problem involving feature files (mentioned first on
tex.stackexchange and now also on luatex.user-list). You must delete
the temp-file when you change the fea-file. Perhaps he deleted the
cache too. 



-- 
Ulrike Fischer 


From patrick at gundla.ch  Thu Feb 17 20:25:20 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 17 Feb 2011 20:25:20 +0100
Subject: [lltx] endless loop
In-Reply-To: <lmj35nhq5m6b$.dlg@nililand.de>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
 <4D5BD299.9020802@free.fr> <20110216152600.GC2349@khaled-laptop>
 <4D5D09EB.60106@elzevir.fr> <20110217115336.GA2677@khaled-laptop>
 <lmj35nhq5m6b$.dlg@nililand.de>
Message-ID: <E5B784DD-9A8F-4B39-BDF4-28800EE08B55@gundla.ch>


Am 17.02.2011 um 14:12 schrieb Ulrike Fischer:

> Am Thu, 17 Feb 2011 13:53:36 +0200 schrieb Khaled Hosny:
> 
>>>> I wounder why everyone is encountering it just now (this is like
>>>> the fifth report) though the bug have been there for ages.
> 
>>> The bug happens only when there is no name database at all, so it doesn't happen
>>> if you used a previous version of luaotfload. It happens only on new
>>> installations and when you remove all cache files.
> 
>> I know, it is just interesting how many people run into this just now
>> though it have been laying there for months.
> 
> The example of Patrick suggests that he tried to investigate a
> problem involving feature files (mentioned first on
> tex.stackexchange and now also on luatex.user-list). You must delete
> the temp-file when you change the fea-file. Perhaps he deleted the
> cache too. 

Actually I don't remember if I deleted the cache. I do that once in a while when experimenting with luaotfload.

Patrick



From khaledhosny at eglug.org  Sun Feb 20 17:48:52 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 20 Feb 2011 18:48:52 +0200
Subject: [lltx] Patching fonts with the luaotfload callback
 "luaotfload.patch_font"
In-Reply-To: <1ljwcgp8ixgpm.dlg@nililand.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
Message-ID: <20110220164851.GA4359@khaled-laptop>

On Sat, Feb 05, 2011 at 03:28:14PM +0100, Ulrike Fischer wrote:
> I'm really happy that the newest version of luaotfload offers a
> callback "luaotfload.patch_font" which can be use to change fonts. I
> think that is really useful. As a first step I would like to use it
> to reencode some chess fonts so that they can be used with latex.
> 
> Below is a small example of my first tests. It tries to replace the
> "a" by a "b". For all fonts in the example I get the expected "look"
> in the pdf ("bbc").
> 

Another way to patch the fonts is to do something like:

\input luaotfload.sty
\directlua{
 local function chess(tfmdata,value)
     if value then
     % whatever
     end
 end
 table.insert(fonts.triggers,"chess")
 fonts.initializers.base.otf.chess = chess
 fonts.initializers.node.otf.chess = chess
}
\font\test=name:foo:chess=yes at 15pt
\test foo
\bye

This way you can control which fonts to be processed, and "chess" option
can take any value so your code might even do different patching
conditionally (this should work for ConTeXt as well).

BTW, you can save "tfmdata" to a file using:
  table.tofile("file.lua", tfmdata, true)

If you want to inspect its structure.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian

From news3 at nililand.de  Mon Feb 21 17:04:39 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 21 Feb 2011 17:04:39 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
	"luaotfload.patch_font"
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <20110220164851.GA4359@khaled-laptop>
Message-ID: <1i0t073jvjurf$.dlg@nililand.de>

Am Sun, 20 Feb 2011 18:48:52 +0200 schrieb Khaled Hosny:


> Another way to patch the fonts is to do something like:
> 
> \input luaotfload.sty
> \directlua{
>  local function chess(tfmdata,value)
>      if value then
>      % whatever
>      end
>  end
>  table.insert(fonts.triggers,"chess")
>  fonts.initializers.base.otf.chess = chess
>  fonts.initializers.node.otf.chess = chess
> }
> \font\test=name:foo:chess=yes at 15pt
> \test foo
> \bye
> 
> This way you can control which fonts to be processed, and "chess" option
> can take any value so your code might even do different patching
> conditionally (this should work for ConTeXt as well).

This seems to work great. I even can declare the font in the normal
latex way:

\documentclass{article}
\usepackage[LSF,T1]{fontenc}
\DeclareFontFamily{LSF}{skaknewOTF}{}
 \DeclareFontShape{LSF}{skaknewOTF}{m}{n}{<->
file:SkakNew-Figurine.otf:chess=yes}{}

\usepackage{luaotfload}
\directlua{
 local function chess(tfmdata,value)
     if value then
      tfmdata.indices[75]=14
      table.tofile("filechess.lua", tfmdata, true)
    end
 end
 table.insert(fonts.triggers,"chess")
 fonts.initializers.base.otf.chess = chess
 fonts.initializers.node.otf.chess = chess
}

\begin{document}
\fontfamily{skaknewOTF}\fontencoding{LSF}\selectfont KQ
\end{document}


 
> BTW, you can save "tfmdata" to a file using:
>   table.tofile("file.lua", tfmdata, true)
> 
> If you want to inspect its structure.

Well here starts the problems. I can see the structure, but how can
I understand it? Which tables and table entries do I have to copy to
get a clean reencoding? Above I set the "indices" to copy the queen
to the "K" (which normally shows a king in this font). But I doubt
that the bounding box and other things are correct. 

Also the tfmdata seems to contain a lot of data more than once. E.g.
"indices" exist also in the luatex table. 

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Feb 21 17:11:14 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 21 Feb 2011 18:11:14 +0200
Subject: [lltx] Patching fonts with the luaotfload callback
 "luaotfload.patch_font"
In-Reply-To: <1i0t073jvjurf$.dlg@nililand.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <20110220164851.GA4359@khaled-laptop>
 <1i0t073jvjurf$.dlg@nililand.de>
Message-ID: <20110221161114.GA2974@khaled-laptop>

On Mon, Feb 21, 2011 at 05:04:39PM +0100, Ulrike Fischer wrote:
> > BTW, you can save "tfmdata" to a file using:
> >   table.tofile("file.lua", tfmdata, true)
> > 
> > If you want to inspect its structure.
> 
> Well here starts the problems. I can see the structure, but how can
> I understand it? Which tables and table entries do I have to copy to
> get a clean reencoding? Above I set the "indices" to copy the queen
> to the "K" (which normally shows a king in this font). But I doubt
> that the bounding box and other things are correct. 
> 
> Also the tfmdata seems to contain a lot of data more than once. E.g.
> "indices" exist also in the luatex table. 

I'd check the luatex manual, also some fields are not interpreted by
the backed but internal to the lua code (anything not mentioned in the
manual). If something not clear, asking on luatex list (and CC Hans if
needed) might help (I don't know most of these fields myself).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian

From reinhard.kotucha at web.de  Mon Feb 21 22:31:55 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 21 Feb 2011 22:31:55 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
 "luaotfload.patch_font"
In-Reply-To: <1i0t073jvjurf$.dlg@nililand.de>
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <20110220164851.GA4359@khaled-laptop>
 <1i0t073jvjurf$.dlg@nililand.de>
Message-ID: <19810.55755.713681.328828@zaphod.ms25.net>

On 2011-02-21 at 17:04:39 +0100, Ulrike Fischer wrote:

 > Am Sun, 20 Feb 2011 18:48:52 +0200 schrieb Khaled Hosny:
 > 
 > 
 > > Another way to patch the fonts is to do something like:
 > > 
 > > \input luaotfload.sty
 > > \directlua{
 > >  local function chess(tfmdata,value)
 > >      if value then
 > >      % whatever
 > >      end
 > >  end
 > >  table.insert(fonts.triggers,"chess")
 > >  fonts.initializers.base.otf.chess = chess
 > >  fonts.initializers.node.otf.chess = chess
 > > }
 > > \font\test=name:foo:chess=yes at 15pt
 > > \test foo
 > > \bye
 > > 
 > > This way you can control which fonts to be processed, and "chess" option
 > > can take any value so your code might even do different patching
 > > conditionally (this should work for ConTeXt as well).
 > 
 > This seems to work great. I even can declare the font in the normal
 > latex way:
 > 
 > \documentclass{article}
 > \usepackage[LSF,T1]{fontenc}
 > \DeclareFontFamily{LSF}{skaknewOTF}{}
 >  \DeclareFontShape{LSF}{skaknewOTF}{m}{n}{<->
 > file:SkakNew-Figurine.otf:chess=yes}{}
 > 
 > \usepackage{luaotfload}
 > \directlua{
 >  local function chess(tfmdata,value)
 >      if value then
 >       tfmdata.indices[75]=14
 >       table.tofile("filechess.lua", tfmdata, true)
 >     end
 >  end
 >  table.insert(fonts.triggers,"chess")
 >  fonts.initializers.base.otf.chess = chess
 >  fonts.initializers.node.otf.chess = chess
 > }
 > 
 > \begin{document}
 > \fontfamily{skaknewOTF}\fontencoding{LSF}\selectfont KQ
 > \end{document}
 > 
 > 
 >  
 > > BTW, you can save "tfmdata" to a file using:
 > >   table.tofile("file.lua", tfmdata, true)
 > > 
 > > If you want to inspect its structure.
 > 
 > Well here starts the problems. I can see the structure, but how can
 > I understand it? Which tables and table entries do I have to copy to
 > get a clean reencoding? Above I set the "indices" to copy the queen
 > to the "K" (which normally shows a king in this font). But I doubt
 > that the bounding box and other things are correct. 

Hi Ulrike,
I must admit that it's all quite new to me too, but your example file
is a good starting point.  Thanks!

>From the output of your example file it's hard to determine whether
the metrics are correct because the queen and the king have almost the
same width.  Fortunately, there is an uparrow in the font, assigned
to the letter 'C'.

I modified your file a bit.  After replacing the king by a queen, I
replaced the queen by an uparrow.  It seems that it's necessary to
replace tfmdata.descriptions too.  Comment out the tfmdata.descriptions 
lines and see what happens.

I don't know whether tfmdata.shared.otfdata.glyphs has to be adapted
too.

Regards,
  Reinhard


\documentclass{article}
\usepackage[LSF,T1]{fontenc}
\DeclareFontFamily{LSF}{skaknewOTF}{}
 \DeclareFontShape{LSF}{skaknewOTF}{m}{n}{<->
file:SkakNew-Figurine.otf:chess=yes}{}

\usepackage{luaotfload}
\directlua{
 local function chess(tfmdata,value)
    if value then

      % replace king by queen
      tfmdata.indices[75]=14
      tfmdata.descriptions[75]=tfmdata.descriptions[81]

      % replace queen by uparrow
      tfmdata.indices[81]=45
      tfmdata.descriptions[81]=tfmdata.descriptions[67]

      table.tofile("filechess.lua", tfmdata, true)
    end
 end
 table.insert(fonts.triggers,"chess")
 fonts.initializers.base.otf.chess = chess
 fonts.initializers.node.otf.chess = chess
}

\begin{document}
\fontfamily{skaknewOTF}\fontencoding{LSF}\selectfont KQQQKQQQK
\end{document}


-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From st_philipp at yahoo.de  Mon Feb 21 23:01:12 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Mon, 21 Feb 2011 23:01:12 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <4D5D0F0F.1040703@elzevir.fr>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
Message-ID: <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>


Am 17.02.2011 um 13:05 schrieb Manuel P?gouri?-Gonnard:

> Hi,
> 
> Sorry for replying so lately, I haven't been reading the list recently.
> 

I'm CC'ing to the list, hope that's ok.

> Le 29/01/2011 10:58, Philipp Stephani a ?crit :
>> Am 29.01.2011 um 05:04 schrieb Will Robertson:
>> 
>>> When I run a unicode-math document with LuaLaTeX, here's the console output
>>> I get purely related to loading the various Lua stuff:
>>> [...]
>>> Is there any way to make this quieter? (Can lua files be loaded from lua
>>> without being printed in the console output?)
> 
> Future versions of luatexbase may be packed in only one sty file and one lua
> file, which would reduce output.

That would be nice, but only as a temporary solution. (Imagine a recommendation for C++ programmers to put their complete code in one file?such a suggestion would be immediately dismissed as absurd.) LuaTeX should really print file names only if the user requests it, and even then in a readable format without parentheses etc.

> For lualibs, I don't know. Printing lua file
> names was considered a feature, for consistency with TeX and ease of debugging.

If there is any possibility, this should be turned off. The Rule of Silence says: When a program has nothing surprising to say, it should say nothing. So, ideally, running lualatex on a file that produces no errors or warnings should not output any single character.
When I have lots of time (i.e. probably never), I plan to investigate how far silencing can go:
- \GenericError etc. can be overwritten to produce sensible messages (file-line-error style, no line breaks)
- LuaTeX already has the possibility to suppress page number printing
- One could switch to \batchmode and then back for every error and warning, but I consider that a hack

> 
>> Also, expl3 should
>> probably move to the latex-base collection of TeX Live since it is nowadays
>> required by important packages such as fontspec and siunitx.
> 
> We happened to discuss this yesterday, and agreed to move both fontspec and
> expl3 to collection-latex-recommended since fontspec is no longer pecific to
> xetex, and expl3 is expected to be used by an increasing number of packages.

Great!

From khaledhosny at eglug.org  Mon Feb 21 23:34:41 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 22 Feb 2011 00:34:41 +0200
Subject: [lltx] quietening lualatex console output
In-Reply-To: <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de>
 <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
Message-ID: <20110221223441.GB17212@khaled-laptop>

On Mon, Feb 21, 2011 at 11:01:12PM +0100, Philipp Stephani wrote:
> 
> Am 17.02.2011 um 13:05 schrieb Manuel P?gouri?-Gonnard:
> 
> > Hi,
> > 
> > Sorry for replying so lately, I haven't been reading the list recently.
> > 
> 
> I'm CC'ing to the list, hope that's ok.
> 
> > Le 29/01/2011 10:58, Philipp Stephani a ?crit :
> >> Am 29.01.2011 um 05:04 schrieb Will Robertson:
> >> 
> >>> When I run a unicode-math document with LuaLaTeX, here's the console output
> >>> I get purely related to loading the various Lua stuff:
> >>> [...]
> >>> Is there any way to make this quieter? (Can lua files be loaded from lua
> >>> without being printed in the console output?)
> > 
> > Future versions of luatexbase may be packed in only one sty file and one lua
> > file, which would reduce output.
> 
> That would be nice, but only as a temporary solution. (Imagine a
> recommendation for C++ programmers to put their complete code in one
> file?such a suggestion would be immediately dismissed as absurd.)
> LuaTeX should really print file names only if the user requests it,
> and even then in a readable format without parentheses etc.

I don't usually compile C/C++ files invoking gcc/ld directly, I use make
which is very chatty by default, even the new silent mode prints the
name of every compiled or linked object.

> > For lualibs, I don't know. Printing lua file
> > names was considered a feature, for consistency with TeX and ease of debugging.
> 
> If there is any possibility, this should be turned off. The Rule of
> Silence says: When a program has nothing surprising to say, it should
> say nothing. So, ideally, running lualatex on a file that produces no
> errors or warnings should not output any single character.

*TeX can be quite slow; I've a ~100 pages Arabic book that takes about a
minute, if ConTeXt did not print anything at all it would have been felt
much slower (BTW, ConTeXt terminal output is much more useful and human
readable than LaTeX's).

Regards,
 Khaled


-- 
 Khaled Hosny
 Egyptian
 Arab

From reinhard.kotucha at web.de  Tue Feb 22 00:21:57 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 22 Feb 2011 00:21:57 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de>
 <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
Message-ID: <19810.62357.378129.585778@zaphod.ms25.net>

On 2011-02-21 at 23:01:12 +0100, Philipp Stephani wrote:

 > [...]
 > LuaTeX should really print file names only if the user requests it,

The next step will be to issue error messages only if users request
them explicitly.

 > and even then in a readable format without parentheses etc.

It's already in a readable format.  However, I remember the ridiculous
flame wars between Pascal an C users some decades ago.  Maybe LuaTeX
should replace braces by BEGIN and END in order to make these
ignorants happy.  Urghh!

I thought that we discussed all this already.  What prevents you from
creating a format file with \everyjob{\batchmode}?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From mpg at elzevir.fr  Tue Feb 22 10:05:32 2011
From: mpg at elzevir.fr (=?windows-1252?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 22 Feb 2011 10:05:32 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
Message-ID: <4D637C5C.30905@elzevir.fr>

Le 21/02/2011 23:01, Philipp Stephani a ?crit :
> I'm CC'ing to the list, hope that's ok.
> 
Sure, that was my intention, but I obviously hit the wrong key.

>> Future versions of luatexbase may be packed in only one sty file and one lua
>> file, which would reduce output.
> 
> That would be nice, but only as a temporary solution. (Imagine a
> recommendation for C++ programmers to put their complete code in one
> file?such a suggestion would be immediately dismissed as absurd.)

I agree.

> LuaTeX
> should really print file names only if the user requests it, and even then in
> a readable format without parentheses etc.
> 
I agree too, but I don't want to spend much time on it now. I'd rather wait for
the announced overhaul of the error system in LuaTeX itself with new Lua
interfaces. I'm confident Taco and the LuaTeX team will do something nice as
usual, and I don't see any good reason to try doing the same thing in a hacky
way now. At least I won't spend time on it myself.

> If there is any possibility, this should be turned off. The Rule of Silence
> says: When a program has nothing surprising to say, it should say nothing.
> So, ideally, running lualatex on a file that produces no errors or warnings
> should not output any single character.

I kinda agree (with the limitations expressed by Khaled: the program has to give
feedback if processing is going to take a while), but currently it seems more
natural to me to be consistent with TeX.

> When I have lots of time (i.e. probably never), I plan to investigate how far silencing can go:
> - \GenericError etc. can be overwritten to produce sensible messages (file-line-error style, no line breaks)
> - LuaTeX already has the possibility to suppress page number printing
> - One could switch to \batchmode and then back for every error and warning, but I consider that a hack
> 
Of course you're free to experiment, and I'll be glad to follow your experiments
if you do, but as far as I'm concerned, I'll wait for a newer LuaTeX rather than
hack my way around the current TeX.

Manuel.

From mpg at elzevir.fr  Tue Feb 22 10:07:41 2011
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 22 Feb 2011 10:07:41 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <19810.62357.378129.585778@zaphod.ms25.net>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
 <19810.62357.378129.585778@zaphod.ms25.net>
Message-ID: <4D637CDD.5040706@elzevir.fr>

Le 22/02/2011 00:21, Reinhard Kotucha a ?crit :
> On 2011-02-21 at 23:01:12 +0100, Philipp Stephani wrote:
>  > and even then in a readable format without parentheses etc.
> 
> It's already in a readable format.

Nope, it's not easily (or reliably) parseable. Look at latexmk's code for
parsing the log file, for example. It shouldn't need to be that complicated.

But Hans and Taco are aware on this and this is on their roadmap, so as far a I
am concerned, there's no need to discussit further before they actually get to
implement it.

Manuel.

From luigi.scarso at gmail.com  Tue Feb 22 10:13:35 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 22 Feb 2011 10:13:35 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <4D637C5C.30905@elzevir.fr>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de>
 <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
 <4D637C5C.30905@elzevir.fr>
Message-ID: <AANLkTimkcayXQpfYHHf4jRicr-18LHLoEvETQaucV7=3@mail.gmail.com>

On Tue, Feb 22, 2011 at 10:05 AM, Manuel P?gouri?-Gonnard
<mpg at elzevir.fr> wrote:
> Le 21/02/2011 23:01, Philipp Stephani a ?crit :

>> That would be nice, but only as a temporary solution. (Imagine a
>> recommendation for C++ programmers to put their complete code in one
>> file?such a suggestion would be immediately dismissed as absurd.)
>
> I agree.
It depends: sqlite follows this route
http://sqlite.org/amalgamation.html

-- 
luigi


From news3 at nililand.de  Tue Feb 22 10:28:26 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Tue, 22 Feb 2011 10:28:26 +0100
Subject: [lltx] Patching fonts with the luaotfload callback
	"luaotfload.patch_font"
References: <1ljwcgp8ixgpm.dlg@nililand.de>
 <20110220164851.GA4359@khaled-laptop> <1i0t073jvjurf$.dlg@nililand.de>
 <19810.55755.713681.328828@zaphod.ms25.net>
Message-ID: <c1j2rj8o3ivu.dlg@nililand.de>

Am Mon, 21 Feb 2011 22:31:55 +0100 schrieb Reinhard Kotucha:

>  > This seems to work great. I even can declare the font in the normal
>  > latex way:
>  > 
>  > \documentclass{article}
>  > \usepackage[LSF,T1]{fontenc}
>  > \DeclareFontFamily{LSF}{skaknewOTF}{}
>  >  \DeclareFontShape{LSF}{skaknewOTF}{m}{n}{<->
>  > file:SkakNew-Figurine.otf:chess=yes}{}
>  > 
>  > \usepackage{luaotfload}
>  > \directlua{
>  >  local function chess(tfmdata,value)
>  >      if value then
>  >       tfmdata.indices[75]=14
>  >       table.tofile("filechess.lua", tfmdata, true)
>  >     end
>  >  end
>  >  table.insert(fonts.triggers,"chess")
>  >  fonts.initializers.base.otf.chess = chess
>  >  fonts.initializers.node.otf.chess = chess
>  > }
>  > 
>  > \begin{document}
>  > \fontfamily{skaknewOTF}\fontencoding{LSF}\selectfont KQ
>  > \end{document}
>  > 
>  > 
>  >  
>  > > BTW, you can save "tfmdata" to a file using:
>  > >   table.tofile("file.lua", tfmdata, true)
>  > > 
>  > > If you want to inspect its structure.
>  > 
>  > Well here starts the problems. I can see the structure, but how can
>  > I understand it? Which tables and table entries do I have to copy to
>  > get a clean reencoding? Above I set the "indices" to copy the queen
>  > to the "K" (which normally shows a king in this font). But I doubt
>  > that the bounding box and other things are correct. 
> 
> Hi Ulrike,
> I must admit that it's all quite new to me too, but your example file
> is a good starting point.  Thanks!
> 
> From the output of your example file it's hard to determine whether
> the metrics are correct because the queen and the king have almost the
> same width. 

I was quite certain that are not correct ;-)


> I modified your file a bit.  After replacing the king by a queen, I
> replaced the queen by an uparrow.  It seems that it's necessary to
> replace tfmdata.descriptions too.  Comment out the tfmdata.descriptions 
> lines and see what happens.
> 
> I don't know whether tfmdata.shared.otfdata.glyphs has to be adapted
> too.

Me neither. Also my first example swaps two glyph. One also need to
find out what must be done if one tries to move a glyph to an empty
position. (E.g. to move the queen to the "z", one has to declare
tfmdata.characters[122]={}).

So they are a lot of open questions. The main problem is that it
quite unclear if this questions are answered by understanding the
luatex manual or the context font loading code. (fonts.triggers is
at my knowledge from the context code). 

I will make a context example and ask on the context list.
     
>       tfmdata.descriptions[81]=tfmdata.descriptions[67]

I think that is not the correct way to swap the data. See the
comment of Taco in the same thread:

> The code in the first
> post was good enough, except for a lua misunderstanding:
> 
>    fontdata.characters[0x0061] = fontdata.characters[0x0062]
> 
> is a variable assignment, not a table copy. To create an actual
> copy of fontdata.characters[0x0062], you would need to do something
> like this:
> 
>    fontdata.characters[0x0061]={}
>    -- copy the table from 'b'
>    for a,v in pairs(fontdata.characters[0x0062]) do
>      fontdata.characters[0x0061][a] = v
>    end
> 
> (if you are re-encoding an entire font, it is more efficient to
> use a remap table to actually swap the table entries instead of
> copying all keys.)


(I don't know what he meant by "use a remap table").

-- 
Ulrike Fischer 


From wspr81 at gmail.com  Tue Feb 22 10:53:19 2011
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 22 Feb 2011 20:23:19 +1030
Subject: [lltx] quietening lualatex console output
In-Reply-To: <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
Message-ID: <6CE2E9D4-C3FC-4713-A2F7-3811A6110655@gmail.com>

On 22/02/2011, at 8:31 AM, Philipp Stephani wrote:

>> Future versions of luatexbase may be packed in only one sty file and one lua
>> file, which would reduce output.
> 
> That would be nice, but only as a temporary solution. (Imagine a recommendation for C++ programmers to put their complete code in one file?such a suggestion would be immediately dismissed as absurd.)

This isn't what we're suggesting; rather, to write the modules in multiple dtx files (or whatever) and then combine them into a single .lua file for loading.

-- Will



From mpg at elzevir.fr  Tue Feb 22 11:40:47 2011
From: mpg at elzevir.fr (=?windows-1252?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 22 Feb 2011 11:40:47 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <6CE2E9D4-C3FC-4713-A2F7-3811A6110655@gmail.com>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
 <6CE2E9D4-C3FC-4713-A2F7-3811A6110655@gmail.com>
Message-ID: <4D6392AF.5030600@elzevir.fr>

Le 22/02/2011 10:53, Will Robertson a ?crit :
> On 22/02/2011, at 8:31 AM, Philipp Stephani wrote:
> 
>>> Future versions of luatexbase may be packed in only one sty file and one lua
>>> file, which would reduce output.
>>
>> That would be nice, but only as a temporary solution. (Imagine a
>> recommendation for C++ programmers to put their complete code in one
>> file?such a suggestion would be immediately dismissed as absurd.)
> 
> This isn't what we're suggesting; rather, to write the modules in multiple
> dtx files (or whatever) and then combine them into a single .lua file for
> loading.
> 
This is what I had in mind indeed. Btw, it converges with Luigi's remark about
SQLite, which uses a similar approach.

Manuel.

From st_philipp at yahoo.de  Tue Feb 22 16:45:06 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Tue, 22 Feb 2011 16:45:06 +0100
Subject: [lltx] quietening lualatex console output
In-Reply-To: <6CE2E9D4-C3FC-4713-A2F7-3811A6110655@gmail.com>
References: <D44C50FD-4118-4B3C-8157-EEE3EBE2A798@gmail.com>
 <91D1551F-72CF-4830-96EF-00A482F55766@yahoo.de> <4D5D0F0F.1040703@elzevir.fr>
 <33AB6593-1D77-4FAC-BBA5-B19616F70E29@yahoo.de>
 <6CE2E9D4-C3FC-4713-A2F7-3811A6110655@gmail.com>
Message-ID: <4D63DA02.7090003@yahoo.de>

Am 22.02.2011 10:53, schrieb Will Robertson:
> On 22/02/2011, at 8:31 AM, Philipp Stephani wrote:
> 
>>> Future versions of luatexbase may be packed in only one sty file and one lua
>>> file, which would reduce output.
>>
>> That would be nice, but only as a temporary solution. (Imagine a recommendation for C++ programmers to put their complete code in one file?such a suggestion would be immediately dismissed as absurd.)
> 
> This isn't what we're suggesting; rather, to write the modules in multiple dtx files (or whatever) and then combine them into a single .lua file for loading.
> 
> -- Will
> 

Ah, ok, that is of course completely fine (similar to what L2e or C
linkers already do).

From mailing_list at arcor.de  Thu Feb 24 10:33:57 2011
From: mailing_list at arcor.de (Stephan Hennig)
Date: Thu, 24 Feb 2011 10:33:57 +0100
Subject: [lltx] pattern loading in luatex (was: pTeX-compatible hyphenation
	patterns)
In-Reply-To: <AANLkTi=xoZ99K5g+NzN=k3APb1M7o3n_gjvO6wm4W0fO@mail.gmail.com>
References: <AANLkTim_KEWAc4OGG2x-ke=PmbgDXY4PhPo+Cyx8AAWd@mail.gmail.com>	<20110116.095504.434466674.wl@gnu.org>	<AANLkTi=bbYdMe6mbwjVk8H0NW-KOfAPkxB1sKCwn63Y_@mail.gmail.com>	<20110117.041625.235476367.wl@gnu.org>	<AANLkTi=XQwLhgysX8AuHVrNe2H_tdOunU6tiFkgBxE2=@mail.gmail.com>	<4D61573A.9010802@arcor.de>	<AANLkTi=0CpW8T567rhAXik5PrJ81PL15y6B40mZ+WvXz@mail.gmail.com>	<4D6172B9.50701@arcor.de>	<AANLkTimh7WaErU5XMoqv6X5hRATeDXTQ5G2Z35zuK6C0@mail.gmail.com>	<4D617FB0.8050001@arcor.de>	<AANLkTikMkAYC+vbwx7MF2TpdxX9_=mnFNiKXZT9=6JKu@mail.gmail.com>	<4D624872.3030907@arcor.de>
 <AANLkTi=xoZ99K5g+NzN=k3APb1M7o3n_gjvO6wm4W0fO@mail.gmail.com>
Message-ID: <4D662605.7030009@arcor.de>

[moving to lualatex list]

schrieb Mojca Miklavec:

>> For LuaTeX, are the new German patterns currently held twice in
>> memory, e.g., as language ngerman (via hyph-utf8) and
>> dehyphn-x-2009-06-19 (via dehyph-exptl)?
> 
> They are not held in memory at all (the synonyms are), they are
> loaded on demand. However in XeTeX they are (the same patterns are
> first loaded as ngerman and then as dehyphn-x-2009-06-19; once from
> out package and once from yours).

That is interesting.  With LuaTeX being able to load patterns at
run-time, there are now three different pattern loading strategies
possible (that I can think of):

  1.  Load all patterns in the format.

  2.  Load all patterns unconditionally at start-up, but only
      after loading the format.

  3.  Load requested patterns on demand.

Strategy 2 would already decouple patterns from the format and be a step
into the direction of strategy 3.  My impression was (for whatever
reason), that lualatex uses strategy 2 or at least it did once.  Is it
really true that, now, lualatex loads only requested patterns on demand,
that is, it uses strategy 3?

(Hm, is that what Manuel did before the TL 2010 release?  I'm surely not
following your efforts closely enough.)

Best regards,
Stephan Hennig


From news3 at nililand.de  Thu Feb 24 11:10:46 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 24 Feb 2011 11:10:46 +0100
Subject: [lltx] pattern loading in luatex
References: <AANLkTim_KEWAc4OGG2x-ke=PmbgDXY4PhPo+Cyx8AAWd@mail.gmail.com>	<20110116.095504.434466674.wl@gnu.org>	<AANLkTi=bbYdMe6mbwjVk8H0NW-KOfAPkxB1sKCwn63Y_@mail.gmail.com>	<20110117.041625.235476367.wl@gnu.org>	<AANLkTi=XQwLhgysX8AuHVrNe2H_tdOunU6tiFkgBxE2=@mail.gmail.com>	<4D61573A.9010802@arcor.de>	<AANLkTi=0CpW8T567rhAXik5PrJ81PL15y6B40mZ+WvXz@mail.gmail.com>	<4D6172B9.50701@arcor.de>	<AANLkTimh7WaErU5XMoqv6X5hRATeDXTQ5G2Z35zuK6C0@mail.gmail.com>	<4D617FB0.8050001@arcor.de>	<AANLkTikMkAYC+vbwx7MF2TpdxX9_=mnFNiKXZT9=6JKu@mail.gmail.com>	<4D624872.3030907@arcor.de>
 <AANLkTi=xoZ99K5g+NzN=k3APb1M7o3n_gjvO6wm4W0fO@mail.gmail.com>
 <4D662605.7030009@arcor.de>
Message-ID: <1i0v1svqqf6zm.dlg@nililand.de>

Am Thu, 24 Feb 2011 10:33:57 +0100 schrieb Stephan Hennig:

> [moving to lualatex list]
> 
> schrieb Mojca Miklavec:
> 
>>> For LuaTeX, are the new German patterns currently held twice in
>>> memory, e.g., as language ngerman (via hyph-utf8) and
>>> dehyphn-x-2009-06-19 (via dehyph-exptl)?
>> 
>> They are not held in memory at all (the synonyms are), they are
>> loaded on demand. However in XeTeX they are (the same patterns are
>> first loaded as ngerman and then as dehyphn-x-2009-06-19; once from
>> out package and once from yours).
> 
> That is interesting.  With LuaTeX being able to load patterns at
> run-time, there are now three different pattern loading strategies
> possible (that I can think of):
> 
>   1.  Load all patterns in the format.
> 
>   2.  Load all patterns unconditionally at start-up, but only
>       after loading the format.
> 
>   3.  Load requested patterns on demand.
> 
> Strategy 2 would already decouple patterns from the format and be a step
> into the direction of strategy 3.  My impression was (for whatever
> reason), that lualatex uses strategy 2 or at least it did once.  Is it
> really true that, now, lualatex loads only requested patterns on demand,
> that is, it uses strategy 3?

Yes. lualatex uses a special hyphen.cfg stored in
tex\luatex\hyph-utf8.  It loads only english as default. Other
languages (which must be activated in the language.dat) are loaded
when requested. If you put e.g. somewhere in your document 

\makeatletter \bbl at patterns{ngerman}

You will see a message in the log

luatex-hyphen: loading patterns and exceptions for: ngerman
(\language6)



-- 
Ulrike Fischer 


From mpg at elzevir.fr  Thu Feb 24 14:17:30 2011
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 24 Feb 2011 14:17:30 +0100
Subject: [lltx] pattern loading in luatex
In-Reply-To: <4D662605.7030009@arcor.de>
References: <AANLkTim_KEWAc4OGG2x-ke=PmbgDXY4PhPo+Cyx8AAWd@mail.gmail.com>	<20110116.095504.434466674.wl@gnu.org>	<AANLkTi=bbYdMe6mbwjVk8H0NW-KOfAPkxB1sKCwn63Y_@mail.gmail.com>	<20110117.041625.235476367.wl@gnu.org>	<AANLkTi=XQwLhgysX8AuHVrNe2H_tdOunU6tiFkgBxE2=@mail.gmail.com>	<4D61573A.9010802@arcor.de>	<AANLkTi=0CpW8T567rhAXik5PrJ81PL15y6B40mZ+WvXz@mail.gmail.com>	<4D6172B9.50701@arcor.de>	<AANLkTimh7WaErU5XMoqv6X5hRATeDXTQ5G2Z35zuK6C0@mail.gmail.com>	<4D617FB0.8050001@arcor.de>	<AANLkTikMkAYC+vbwx7MF2TpdxX9_=mnFNiKXZT9=6JKu@mail.gmail.com>	<4D624872.3030907@arcor.de>
 <AANLkTi=xoZ99K5g+NzN=k3APb1M7o3n_gjvO6wm4W0fO@mail.gmail.com>
 <4D662605.7030009@arcor.de>
Message-ID: <4D665A6A.1020900@elzevir.fr>

Le 24/02/2011 10:33, Stephan Hennig a ?crit :
> schrieb Mojca Miklavec:
> 
>> They are not held in memory at all (the synonyms are), they are
>> loaded on demand. However in XeTeX they are (the same patterns are
>> first loaded as ngerman and then as dehyphn-x-2009-06-19; once from
>> out package and once from yours).
> 
> That is interesting.  With LuaTeX being able to load patterns at
> run-time, there are now three different pattern loading strategies
> possible (that I can think of):
> 
>   1.  Load all patterns in the format.
> 
>   2.  Load all patterns unconditionally at start-up, but only
>       after loading the format.
> 
>   3.  Load requested patterns on demand.
> 
I'm afraid "load" is too imprecise to precisely describe what happens with
LuaTeX. There are now two possibly distinct operations:
a. read the patterns (as a string of characters)
b. process them into a form usable by *TeX (a trie)

With LuaTeX you have two options:

1. Read all patterns at initex time and store them as a string of characters in
the format; process them all at startup when the format is loaded.
2. Read and process requested patterns on demand.

Option 1 was used up to TeX Live 2009 and resulted in a long startup time.
Option 2 is implemented since TL 2010.

> Strategy 2 would already decouple patterns from the format and be a step
> into the direction of strategy 3.  My impression was (for whatever
> reason), that lualatex uses strategy 2 or at least it did once.

Sort of. I think it's better to use "read" and "process" rather than "load" to
accurately describe what happens.

>  Is it
> really true that, now, lualatex loads only requested patterns on demand,
> that is, it uses strategy 3?
> 
Yep.

> (Hm, is that what Manuel did before the TL 2010 release?  I'm surely not
> following your efforts closely enough.)
> 
Yep.

Now the next step is about babel: currently languages are statically allocated
(declared) in the format, and then defined (= loading the patterns) on demand.
It would be better to be able to dynamically declare languages at runtime. It
shouldn't be too complicated to do, I hope to get to it soon.

Manuel.

From patrick at gundla.ch  Thu Feb 24 15:06:14 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 24 Feb 2011 15:06:14 +0100
Subject: [lltx] endless loop
In-Reply-To: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
References: <04D1993A-A3F6-44A5-863C-F9F3ED0982C8@gundla.ch>
Message-ID: <211FB726-77A9-46F8-B848-CEB1BFFAF15B@gundla.ch>

Hello,

> I come across this error when using lualatex:
> 
> ------------------------------------------------
> [many messages like these:]
> luaotfload | Font names database not found, generating new one.
>             This can take several minutes; please be patient.
> luaotfload | Updating the font names database:
> ! LuaTeX error ...e2010/texmf-dist/tex/luatex/lualibs/lualibs-file.lua:75: stac
> k overflow.
> <to be read again> 
>                   \scan_stop: 
> l.4 \setmainfont{TeX Gyre Bonum}
> ------------------------------------------------                                


I just want to report that this works for me now (after an update of texlive2010).

Thanks!

Patrick



From khaledhosny at eglug.org  Fri Feb 25 21:41:52 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 25 Feb 2011 22:41:52 +0200
Subject: [lltx] luaotfload and lualibs maintenance
Message-ID: <20110225204152.GA13637@khaled-laptop>

Hi everyone,

Starting sometime around April I might not be able to actively maintain
any TeX package and this may be the case for the next few years (I hope
not, but just in case), so I'd be glade if someone is welling to
maintain them.

I've also some half done packages on github[1] if it any interests
anyone.

[1] https://github.com/khaledhosny

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From till.heilmann at unibas.ch  Sun Feb 27 07:50:48 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Sun, 27 Feb 2011 07:50:48 +0100
Subject: [lltx] Kerning OTF fonts: 2 other problems
Message-ID: <62EDB04F-F8D6-4ACB-9EE0-5B091C52CBC0@unibas.ch>

Thanks to your help, I am making progress adjusting the kerning of  
OpenType fonts. There are still some problems, though ...

1. Curiously, adjusting the kerning does not work for some letter  
pairs and I cannot see a pattern here. Adjusting "ei", for example,  
works just fine but "ev" does not. I got the same results with two  
different fonts (TeX Gyre Bonum and Linux Libertine), so I think it  
is not a font issue but a Lua(La)TeX one.

2. Adjusting the kerning does not work in pairs where an unwanted  
German ligature (e.g. f l instead of fl) is prevented by the  
insertion of "| using babel. I suspect this is babel's fault but I  
wanted to let you know anyway.

Thanks,
- Till

\begin{filecontents*}{mykern.fea}
languagesystem DFLT dflt;
languagesystem latn dflt;
feature kern {
pos f l 500;
pos e [i g n m r s v w] 200;
} kern;
\end{filecontents*}
\documentclass{article}
\usepackage[ngerman]{babel}
\usepackage{fontspec}
\setmainfont[Renderer=Basic,FeatureFile=mykern.fea]{TeX Gyre Bonum}
\begin{document}
flie?t Auf"|lage ei eg en em er es ev ew
\end{document}



From news3 at nililand.de  Sun Feb 27 18:50:04 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Sun, 27 Feb 2011 18:50:04 +0100
Subject: [lltx] Kerning OTF fonts: 2 other problems
References: <62EDB04F-F8D6-4ACB-9EE0-5B091C52CBC0@unibas.ch>
Message-ID: <gub6pdyq44gi$.dlg@nililand.de>

Am Sun, 27 Feb 2011 07:50:48 +0100 schrieb Heilmann, Till A.:

> Thanks to your help, I am making progress adjusting the kerning of  
> OpenType fonts. There are still some problems, though ...
> 
> 1. Curiously, adjusting the kerning does not work for some letter  
> pairs and I cannot see a pattern here. Adjusting "ei", for example,  
> works just fine but "ev" does not. I got the same results with two  
> different fonts (TeX Gyre Bonum and Linux Libertine), so I think it  
> is not a font issue but a Lua(La)TeX one.

I think it is the font. I don't know much about open type fonts and
features etc, but a look at the kerning information of "e" in
fontforge seems to indicate that a kern for "ev" and "ew" already
exists, and I think this kern "wins". 



-- 
Ulrike Fischer 


From till.heilmann at unibas.ch  Mon Feb 28 11:59:27 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Mon, 28 Feb 2011 11:59:27 +0100
Subject: [lltx] Kerning OTF fonts: 2 other problems
Message-ID: <C4355683-BF06-4756-B745-606FDE04563D@unibas.ch>

Am Sun, 27 Feb 2011 18:50:04 +0100 schrieb Ulrike Fischer:

>> Thanks to your help, I am making progress adjusting the kerning of  
>> OpenType fonts. There are still some problems, though ...
>> 1. Curiously, adjusting the kerning does not work for some letter  
>> pairs and I cannot see a pattern here. Adjusting "ei", for example,  
>> works just fine but "ev" does not. I got the same results with two  
>> different fonts (TeX Gyre Bonum and Linux Libertine), so I think it  
>> is not a font issue but a Lua(La)TeX one.
>> 
> 
> I think it is the font. I don't know much about open type fonts and
> features etc, but a look at the kerning information of "e" in
> fontforge seems to indicate that a kern for "ev" and "ew" already
> exists, and I think this kern "wins". 

Okay, I see what you mean (I just checked in FontForge too).

I cannot comment on the technical aspect of this issue but from a "philosophical" standpoint it is somewhat bizarre: What good is a local or user specific feature file that cannot override the standard settings of a font? Is this how OTF features are supposed to (not) work? (I know this is probably not the right place to ask this kind of question.)

Thanks,
-Till

