From khaledhosny at eglug.org  Thu Oct  6 03:22:42 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 03:22:42 +0200
Subject: [lltx] luaotfload update
Message-ID: <20111006012242.GA7891@khaled-laptop>

Hello list,

I managed to finish the long due syncing of luaotfload with ConTeXt,
in the unstable branch:
https://github.com/khaledhosny/luaotfload/tree/unstable

and updated fontspec as well:
https://github.com/wspr/fontspec/tree/otfl-unstable

There are many internal changes in this update which would break any
package depending on internal lua interfaces, also bugs and breakage are
highly probable. I did some basic testing, but more testing are
welcomed.

In this update too the support for non-standard features were dropped,
namely tlig & trep (AKA TeX ligatures) and anum (was anybody using
this?). Hans no longer includes that code in his "plain variant" from
which luaotfload is derived, and even when he did only -- and --- were
supported and I had to patch it to add the rest. Someone have to
convince Hans to implement this in the "plain variant" or implement it
himself, I don't really need this feature myself.

Also loading of OFM fonts is now broken, I don't feel like debugging
this and I doubt anyone is using them, but the above applies here too.

Finally, if someone can put this on tlcontrib, this would be great.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From patrick at gundla.ch  Thu Oct  6 06:45:53 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 06:45:53 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111006012242.GA7891@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
Message-ID: <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>

(I'll leave the full quote for the CC to the luatex list)


Hi Khaled. Many, many thanks to your work with luaotfload! Does that also imply the ff, ... -ligatures? (I guess so). Why can't we (=you) stick to the current master branch? 

Patrick



Am 06.10.2011 um 03:22 schrieb Khaled Hosny:

> Hello list,
> 
> I managed to finish the long due syncing of luaotfload with ConTeXt,
> in the unstable branch:
> https://github.com/khaledhosny/luaotfload/tree/unstable
> 
> and updated fontspec as well:
> https://github.com/wspr/fontspec/tree/otfl-unstable
> 
> There are many internal changes in this update which would break any
> package depending on internal lua interfaces, also bugs and breakage are
> highly probable. I did some basic testing, but more testing are
> welcomed.
> 
> In this update too the support for non-standard features were dropped,
> namely tlig & trep (AKA TeX ligatures) and anum (was anybody using
> this?). Hans no longer includes that code in his "plain variant" from
> which luaotfload is derived, and even when he did only -- and --- were
> supported and I had to patch it to add the rest. Someone have to
> convince Hans to implement this in the "plain variant" or implement it
> himself, I don't really need this feature myself.
> 
> Also loading of OFM fonts is now broken, I don't feel like debugging
> this and I doubt anyone is using them, but the above applies here too.
> 
> Finally, if someone can put this on tlcontrib, this would be great.
> 
> Regards,
> Khaled
> 
> -- 
> Khaled Hosny
> Egyptian
> Arab




From patrick at gundla.ch  Thu Oct  6 06:58:28 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 06:58:28 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111006012242.GA7891@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
Message-ID: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>

Hi,

so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?

Patrick



From p.stephani2 at googlemail.com  Thu Oct  6 08:09:35 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 6 Oct 2011 08:09:35 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
Message-ID: <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>

2011/10/6 Patrick Gundlach <patrick at gundla.ch>:
> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?

The correct solution is to enter these characters directly: ?, ?, ?, ?, etc.


From patrick at gundla.ch  Thu Oct  6 08:12:32 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 08:12:32 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
Message-ID: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>


Am 06.10.2011 um 08:09 schrieb Philipp Stephani:

> 2011/10/6 Patrick Gundlach <patrick at gundla.ch>:
>> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?
> 
> The correct solution is to enter these characters directly: ?, ?, ?, ?, etc.

But a) this breaks TeX compatibility in a big way (IMO) and not everyone has an ffi-ligature on his/her keyboard. There is not a command to insert that into "fluffiest". 

I just tried ConTeXt, the ligatures there still work.

Patrick



From khaledhosny at eglug.org  Thu Oct  6 08:26:16 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 08:26:16 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>
Message-ID: <20111006062616.GA13490@khaled-laptop>

"Real" OpenType features should be fine, any regressions ought to be
fixed.

Regards,
 Khaled

On Thu, Oct 06, 2011 at 06:45:53AM +0200, Patrick Gundlach wrote:
> (I'll leave the full quote for the CC to the luatex list)
> 
> 
> Hi Khaled. Many, many thanks to your work with luaotfload! Does that also imply the ff, ... -ligatures? (I guess so). Why can't we (=you) stick to the current master branch? 
> 
> Patrick
> 
> 
> 
> Am 06.10.2011 um 03:22 schrieb Khaled Hosny:
> 
> > Hello list,
> > 
> > I managed to finish the long due syncing of luaotfload with ConTeXt,
> > in the unstable branch:
> > https://github.com/khaledhosny/luaotfload/tree/unstable
> > 
> > and updated fontspec as well:
> > https://github.com/wspr/fontspec/tree/otfl-unstable
> > 
> > There are many internal changes in this update which would break any
> > package depending on internal lua interfaces, also bugs and breakage are
> > highly probable. I did some basic testing, but more testing are
> > welcomed.
> > 
> > In this update too the support for non-standard features were dropped,
> > namely tlig & trep (AKA TeX ligatures) and anum (was anybody using
> > this?). Hans no longer includes that code in his "plain variant" from
> > which luaotfload is derived, and even when he did only -- and --- were
> > supported and I had to patch it to add the rest. Someone have to
> > convince Hans to implement this in the "plain variant" or implement it
> > himself, I don't really need this feature myself.
> > 
> > Also loading of OFM fonts is now broken, I don't feel like debugging
> > this and I doubt anyone is using them, but the above applies here too.
> > 
> > Finally, if someone can put this on tlcontrib, this would be great.
> > 
> > Regards,
> > Khaled
> > 
> > -- 
> > Khaled Hosny
> > Egyptian
> > Arab
> 
> 

-- 
 Khaled Hosny
 Egyptian
 Arab

From p.stephani2 at googlemail.com  Thu Oct  6 08:29:40 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 6 Oct 2011 08:29:40 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
Message-ID: <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>

2011/10/6 Patrick Gundlach <patrick at gundla.ch>:
>
> Am 06.10.2011 um 08:09 schrieb Philipp Stephani:
>
>> 2011/10/6 Patrick Gundlach <patrick at gundla.ch>:
>>> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?
>>
>> The correct solution is to enter these characters directly: ?, ?, ?, ?, etc.
>
> But a) this breaks TeX compatibility in a big way (IMO)

I think the ConTeXt and LuaTeX people do not care too much about
compatibility (which is the right thing IMO, we have to move forward).

> and not everyone has an ffi-ligature on his/her keyboard.

These typographic ligatures should still work. Only the ligatures that
are input methods in disguise (for dashes, quotation marks etc.)
should break.

> I just tried ConTeXt, the ligatures there still work.

Aha, it's not as easy as I thought. I just tested the following
document with TeX Live 2011's ConTeXt:

\usetypescriptfile[type-vista]
\usetypescript[constantia]
\setupbodyfont[constantia]
\starttext
--- ?
-- ?
`` ?
'' ?
fluffiest
\stoptext

The dash ligatures still work, the others don't. With Latin Modern,
the typographic ligatures (fl, ffi) work as well. The quotation mark
ligatures don't work in any font.


From khaledhosny at eglug.org  Thu Oct  6 08:29:38 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 08:29:38 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
Message-ID: <20111006062938.GB13490@khaled-laptop>

On Thu, Oct 06, 2011 at 06:58:28AM +0200, Patrick Gundlach wrote:
> Hi,
> 
> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?

They were never used in ConTeXt (except -- ---); the official way is to
use \quot and \quotation and they are language sensitive.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Thu Oct  6 08:35:25 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 08:35:25 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
Message-ID: <20111006063524.GC13490@khaled-laptop>

On Thu, Oct 06, 2011 at 08:12:32AM +0200, Patrick Gundlach wrote:
> 
> Am 06.10.2011 um 08:09 schrieb Philipp Stephani:
> 
> > 2011/10/6 Patrick Gundlach <patrick at gundla.ch>:
> >> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?
> > 
> > The correct solution is to enter these characters directly: ?, ?, ?, ?, etc.
> 
> But a) this breaks TeX compatibility in a big way (IMO) and not
> everyone has an ffi-ligature on his/her keyboard. There is not a
> command to insert that into "fluffiest". 

Sorry for confusion, by "TeX ligatures" I was referring to the similarly
named fontspec feature, namely -- --- ``'',, for ? ? ??? (a legacy TeX
hack from middle ages).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Thu Oct  6 08:40:56 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 08:40:56 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
Message-ID: <20111006064056.GA13587@khaled-laptop>

On Thu, Oct 06, 2011 at 08:29:40AM +0200, Philipp Stephani wrote:
> > I just tried ConTeXt, the ligatures there still work.
> 
> Aha, it's not as easy as I thought. I just tested the following
> document with TeX Live 2011's ConTeXt:
> 
> \usetypescriptfile[type-vista]
> \usetypescript[constantia]
> \setupbodyfont[constantia]
> \starttext
> --- ?
> -- ?
> `` ?
> '' ?
> fluffiest
> \stoptext
> 
> The dash ligatures still work,

Hans keeps those two IIRC because em and en dashes are hard to
distinguish in monospaced fonts while editing, but even those are not
supported now in luaotfload as I stated earlier.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From wspr81 at gmail.com  Thu Oct  6 08:48:03 2011
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 6 Oct 2011 17:18:03 +1030
Subject: [lltx] luaotfload update
In-Reply-To: <20111006064056.GA13587@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
Message-ID: <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>

On 06/10/2011, at 5:10 PM, Khaled Hosny wrote:

> Hans keeps those two IIRC because em and en dashes are hard to
> distinguish in monospaced fonts while editing, but even those are not
> supported now in luaotfload as I stated earlier.

Frankly, this is crazy. LuaLaTeX *cannot* drop support entirely for these features. There have been countless requests for how these should be activated in the XeTeX mailing list, even after that feature was implemented there. Can't we just keep the old code lying around?

Otherwise, XeTeX supports these features with its Unicode input mapping feature -- what are the chances this could be written with a Lua callback? It's a useful feature in itself, and the big reason polyglossia is currently XeTeX-only.

-- Will



From patrick at gundla.ch  Thu Oct  6 08:59:07 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 08:59:07 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
Message-ID: <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch>


> what are the chances this could be written with a Lua callback?

I've thought about replacing all "---" by an em-dash and all "--" by an en-dash with a "process_input_buffer" callback. But this won't work. See this example:

\begin{luacode}
  -- a lua comment would be replaced too!
\end{luacode}

So a solution would be more complicated, I assume.

Patrick



From zappathustra at free.fr  Thu Oct  6 08:27:15 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 06 Oct 2011 08:27:15 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
Message-ID: <4E8D4A43.3020805@free.fr>

Le 06/10/2011 08:12, Patrick Gundlach a ?crit :
> Am 06.10.2011 um 08:09 schrieb Philipp Stephani:
>
>> 2011/10/6 Patrick Gundlach<patrick at gundla.ch>:
>>> so what is the ConTeXt solution to this (no TeX ligatures)? Or is this just dropped and nobody cared?
>> The correct solution is to enter these characters directly: ?, ?, ?, ?, etc.
> But a) this breaks TeX compatibility in a big way (IMO) and not everyone has an ffi-ligature on his/her keyboard. There is not a command to insert that into "fluffiest".

If I'm not mistaken, tlig and trep only concern `, ``, ', '', --, and 
---; ff-ligatures and the likes are included in fonts, and a font could 
very well include the previous ligatures and substitutions, as is the 
case with Computer Modern, which is why they exist in the first place.

Best,
Paul

From Arno.Trautmann at gmx.de  Thu Oct  6 09:09:06 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Thu, 06 Oct 2011 09:09:06 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
Message-ID: <4E8D5412.8050900@gmx.de>

Will Robertson wrote:
> On 06/10/2011, at 5:10 PM, Khaled Hosny wrote:
>
>> Hans keeps those two IIRC because em and en dashes are hard to
>> distinguish in monospaced fonts while editing, but even those are not
>> supported now in luaotfload as I stated earlier.
>
> Frankly, this is crazy. LuaLaTeX *cannot* drop support entirely for these features. There have been countless requests for how these should be activated in the XeTeX mailing list, even after that feature was implemented there. Can't we just keep the old code lying around?

I second this. A normal user starting TeX will not be able to input the 
characters directly, and they would use - for ?, or get a double hyphen 
as output etc. The result will be horrible, and they will stick to 
pdfTeX and we will not get any more users for LuaTeX but the very few 
people with full unicode-keyboards or a lot of editor macros or shortcuts.

If this is dropped in luaotfload, maybe it could be implemented in fontspec?

cheers
Arno

From news3 at nililand.de  Thu Oct  6 09:11:46 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 09:11:46 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
Message-ID: <118jk8ny2m1wa.dlg@nililand.de>

Am Thu, 6 Oct 2011 17:18:03 +1030 schrieb Will Robertson:

> On 06/10/2011, at 5:10 PM, Khaled Hosny wrote:
 
>> Hans keeps those two IIRC because em and en dashes are hard to
>> distinguish in monospaced fonts while editing, but even those are not
>> supported now in luaotfload as I stated earlier.
 
> Frankly, this is crazy. LuaLaTeX *cannot* drop support entirely
> for these features. There have been countless requests for how
> these should be activated in the XeTeX mailing list, even after
> that feature was implemented there. Can't we just keep the old
> code lying around?

Well "keeping the old code" means that the development of the font
loader code in lualatex doesn't keep pace with the development of
the code in context. 

But before the discussion gets to hot I think it would be a good
idea to check what works and what doesn't. 

I think there are three cases:

1. "Real" ligatures ff, fi, ffl etc which are features of the fonts
and implemented through "real" open type features. I'm certain that
these still works.

2. The "faked" (so called TeX)-ligatures for en-dash and em-dash: -- 
and ---. Last time I heard about them in the context list Hans just
implemented a fix to get around a bug in connections with this
ligatures. So I'm quite confident that they still work in context
and so too with the newest luaotfload. But it must be tested. 

3. The other "faked" (TeX)-ligatures: ``, `?, and so on: I think
these will no longer work. (I personnally don't care. I even did
find e.g. `? quite irritating.)

> Otherwise, XeTeX supports these features with its Unicode input
> mapping feature -- what are the chances this could be written
> with a Lua callback? It's a useful feature in itself, and the big
> reason polyglossia is currently XeTeX-only.

You could use a fea-file as a replacement, e.g. to implement  such
ligatures. If you search the mailing list you will find some
examples where they have been used to adjust the kerning. Works even
easier than with xetex as you don't have to compile the files, they
are simple text files. 

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 09:20:12 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 09:20:12 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
Message-ID: <20111006072011.GA15625@khaled-laptop>

On Thu, Oct 06, 2011 at 05:18:03PM +1030, Will Robertson wrote:
> On 06/10/2011, at 5:10 PM, Khaled Hosny wrote:
> 
> > Hans keeps those two IIRC because em and en dashes are hard to
> > distinguish in monospaced fonts while editing, but even those are not
> > supported now in luaotfload as I stated earlier.
> 
> Frankly, this is crazy. LuaLaTeX *cannot* drop support entirely for
> these features. There have been countless requests for how these
> should be activated in the XeTeX mailing list, even after that feature
> was implemented there.

If it is up to me I'll just tell them to use csquote or enter the
Unicode quotes directly. But I've nothing against this feature at all, I
just can't right that code myself.

> Can't we just keep the old code lying around?

Old code and new code are incompatible and not having two different
OpenType engines is the very reason I'm hacking luaotfload.

> Otherwise, XeTeX supports these features with its Unicode input
> mapping feature -- what are the chances this could be written with a
> Lua callback? It's a useful feature in itself, and the big reason
> polyglossia is currently XeTeX-only.

My wild guess is it shouldn't be too hard, but someone need to write
that code :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Thu Oct  6 09:26:53 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 09:26:53 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <118jk8ny2m1wa.dlg@nililand.de>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de>
Message-ID: <20111006072653.GB15625@khaled-laptop>

On Thu, Oct 06, 2011 at 09:11:46AM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 17:18:03 +1030 schrieb Will Robertson:
> 
> > On 06/10/2011, at 5:10 PM, Khaled Hosny wrote:
>  
> >> Hans keeps those two IIRC because em and en dashes are hard to
> >> distinguish in monospaced fonts while editing, but even those are not
> >> supported now in luaotfload as I stated earlier.
>  
> > Frankly, this is crazy. LuaLaTeX *cannot* drop support entirely
> > for these features. There have been countless requests for how
> > these should be activated in the XeTeX mailing list, even after
> > that feature was implemented there. Can't we just keep the old
> > code lying around?
> 
> Well "keeping the old code" means that the development of the font
> loader code in lualatex doesn't keep pace with the development of
> the code in context. 
> 
> But before the discussion gets to hot I think it would be a good
> idea to check what works and what doesn't. 
> 
> I think there are three cases:
> 
> 1. "Real" ligatures ff, fi, ffl etc which are features of the fonts
> and implemented through "real" open type features. I'm certain that
> these still works.
> 
> 2. The "faked" (so called TeX)-ligatures for en-dash and em-dash: -- 
> and ---. Last time I heard about them in the context list Hans just
> implemented a fix to get around a bug in connections with this
> ligatures. So I'm quite confident that they still work in context
> and so too with the newest luaotfload. But it must be tested. 

They work in ConTeXt but not in luaotfload. Hans did some refactoring
few months ago and made the font code more split into generic and
ConTeXt only code, as a result the module doing fake ligatures is now
ConTeXt only. This modules officially only supported the dashes, but I
used to patch it to include the quotes, now it is entirely gone.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From zappathustra at free.fr  Thu Oct  6 09:18:22 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 06 Oct 2011 09:18:22 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch>
Message-ID: <4E8D563E.7030806@free.fr>

Le 06/10/2011 08:59, Patrick Gundlach a ?crit :
>> what are the chances this could be written with a Lua callback?
> I've thought about replacing all "---" by an em-dash and all "--" by an en-dash with a "process_input_buffer" callback. But this won't work.

"process_input_buffer" is indeed a bad idea for such a replacement. But 
it can be done while processing a node list: replace sequences of nodes 
(e.g. two hyphen nodes) by something else (an en-dash). That's basically 
how contextual ligatures are implemented (and even simple ligatures when 
luaotfload is in "node" mode, if I remember correctly), so it's no big deal.

Best,
Paul

From patrick at gundla.ch  Thu Oct  6 10:04:58 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 10:04:58 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <4E8D563E.7030806@free.fr>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch> <4E8D563E.7030806@free.fr>
Message-ID: <A61E295A-AC5A-4F23-B004-4665788E1A47@gundla.ch>



> "process_input_buffer" is indeed a bad idea for such a replacement. But it can be done while processing a node list: replace sequences of nodes (e.g. two hyphen nodes) by something else (an en-dash). That's basically how contextual ligatures are implemented (and even simple ligatures when luaotfload is in "node" mode, if I remember correctly), so it's no big deal.

But then things like -{-} won't work as in TeX. 

...

Oh, I just found out that they already don't work as in TeX, and I guess it's on purpose.

Patrick

(confused on the subject)

From zappathustra at free.fr  Thu Oct  6 10:09:24 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 06 Oct 2011 10:09:24 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <A61E295A-AC5A-4F23-B004-4665788E1A47@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch> <4E8D563E.7030806@free.fr>
 <A61E295A-AC5A-4F23-B004-4665788E1A47@gundla.ch>
Message-ID: <4E8D6234.1080906@free.fr>



Le 06/10/2011 10:04, Patrick Gundlach a ?crit :
>
>> "process_input_buffer" is indeed a bad idea for such a replacement. But it can be done while processing a node list: replace sequences of nodes (e.g. two hyphen nodes) by something else (an en-dash). That's basically how contextual ligatures are implemented (and even simple ligatures when luaotfload is in "node" mode, if I remember correctly), so it's no big deal.
> But then things like -{-} won't work as in TeX.
>
> ...
>
> Oh, I just found out that they already don't work as in TeX, and I guess it's on purpose.

Taco once told me that this way of avoiding ligatures, advertised as a 
feature, was actually a nasty side effect and was removed on purpose.

Best,
Paul

From khaledhosny at eglug.org  Thu Oct  6 10:19:57 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 10:19:57 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <4E8D6234.1080906@free.fr>
References: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <070093C7-DC2A-4355-892A-6DED633CAF3E@gundla.ch>
 <4E8D563E.7030806@free.fr>
 <A61E295A-AC5A-4F23-B004-4665788E1A47@gundla.ch>
 <4E8D6234.1080906@free.fr>
Message-ID: <20111006081957.GA16010@khaled-laptop>

On Thu, Oct 06, 2011 at 10:09:24AM +0200, Paul Isambert wrote:
> 
> 
> Le 06/10/2011 10:04, Patrick Gundlach a ?crit :
> >
> >>"process_input_buffer" is indeed a bad idea for such a replacement.
> >>But it can be done while processing a node list: replace sequences
> >>of nodes (e.g. two hyphen nodes) by something else (an en-dash).
> >>That's basically how contextual ligatures are implemented (and even
> >>simple ligatures when luaotfload is in "node" mode, if I remember
> >>correctly), so it's no big deal.
> >But then things like -{-} won't work as in TeX.
> >
> >...
> >
> >Oh, I just found out that they already don't work as in TeX, and I
> >guess it's on purpose.
> 
> Taco once told me that this way of avoiding ligatures, advertised as
> a feature, was actually a nasty side effect and was removed on
> purpose.

Or rather an "accidental feature" :)
http://groups.google.com/group/comp.lang.perl/msg/5580e6f384b33c44

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From news3 at nililand.de  Thu Oct  6 10:24:47 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 10:24:47 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <20111006072653.GB15625@khaled-laptop>
Message-ID: <1uccgwld4w2it.dlg@nililand.de>

Am Thu, 6 Oct 2011 09:26:53 +0200 schrieb Khaled Hosny:

>> 2. The "faked" (so called TeX)-ligatures for en-dash and em-dash: -- 
>> and ---. Last time I heard about them in the context list Hans just
>> implemented a fix to get around a bug in connections with this
>> ligatures. So I'm quite confident that they still work in context
>> and so too with the newest luaotfload. But it must be tested. 
> 
> They work in ConTeXt but not in luaotfload. 

Pity. In this case they need to be reimplemented. I will try if it
works with fea-files. 

I made a small test

\documentclass{article}
\usepackage{fontspec}

\begin{document}
??? -- ---
\end{document}

 and the new code broke on a current miktex:

(I:/TeX-Roots/luaotfload-unstable-neu/tex/latex/fontspec/fontspec.lua)
Lua module: fontspec 2009/12/04 2 Advanced font selection for
LuaLaTeX.

! LuaTeX error
...otfload-unstable-neu/tex/latex/fontspec/fontspec.lua:38: atte
mpt to index field 'hashes' (a nil value)
stack traceback:
	...otfload-unstable-neu/tex/latex/fontspec/fontspec.lua:38: in main
chunk
	[C]: in function 'require'
	J:/MiKTeX2.9/tex/luatex/luatexbase/modutils.lua:52: in function
'require_modul
e'
	<\directlua >:1: in main chunk.
\lltxb at requirelua ...xluaescapestring {#2}" \fi )}
                                                  
l.39 \bool_new:N
                 \l_fontspec_firsttime_bool
? x



Is a new luatexbase needed or something else?





-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 10:32:53 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 10:32:53 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <1uccgwld4w2it.dlg@nililand.de>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de>
 <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de>
Message-ID: <20111006083253.GA16087@khaled-laptop>

On Thu, Oct 06, 2011 at 10:24:47AM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 09:26:53 +0200 schrieb Khaled Hosny:
> 
> >> 2. The "faked" (so called TeX)-ligatures for en-dash and em-dash: -- 
> >> and ---. Last time I heard about them in the context list Hans just
> >> implemented a fix to get around a bug in connections with this
> >> ligatures. So I'm quite confident that they still work in context
> >> and so too with the newest luaotfload. But it must be tested. 
> > 
> > They work in ConTeXt but not in luaotfload. 
> 
> Pity. In this case they need to be reimplemented. I will try if it
> works with fea-files. 
> 
> I made a small test
> 
> \documentclass{article}
> \usepackage{fontspec}
> 
> \begin{document}
> ??? -- ---
> \end{document}
> 
>  and the new code broke on a current miktex:
> 
> (I:/TeX-Roots/luaotfload-unstable-neu/tex/latex/fontspec/fontspec.lua)
> Lua module: fontspec 2009/12/04 2 Advanced font selection for
> LuaLaTeX.
> 
> ! LuaTeX error
> ...otfload-unstable-neu/tex/latex/fontspec/fontspec.lua:38: atte
> mpt to index field 'hashes' (a nil value)
> stack traceback:
> 	...otfload-unstable-neu/tex/latex/fontspec/fontspec.lua:38: in main
> chunk
> 	[C]: in function 'require'
> 	J:/MiKTeX2.9/tex/luatex/luatexbase/modutils.lua:52: in function
> 'require_modul
> e'
> 	<\directlua >:1: in main chunk.
> \lltxb at requirelua ...xluaescapestring {#2}" \fi )}
>                                                   
> l.39 \bool_new:N
>                  \l_fontspec_firsttime_bool
> ? x
> 

Runs fine here.

> Is a new luatexbase needed or something else?

No, the error is luaotfload related, are you sure you are loading the
unstable luaotfload?

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From news3 at nililand.de  Thu Oct  6 11:19:39 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 11:19:39 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de> <20111006083253.GA16087@khaled-laptop>
Message-ID: <89jhs1n3iz7t$.dlg@nililand.de>

Am Thu, 6 Oct 2011 10:32:53 +0200 schrieb Khaled Hosny:


>> I made a small test

>>  and the new code broke on a current miktex:

> No, the error is luaotfload related, are you sure you are loading the
> unstable luaotfload?

No, I recheck and it look as if I grapped the previous version from
CTAN. Now I have khaledhosny-luaotfload-226aa58.

But now lualatex hangs. At the end of the terminal output I see 

lic/lm/lmroman10-regular.otf (hash: lmroman10-regular)fonts : font
loaded okayf
onts : file size: 111536 <loading (extended) adobe glyph list>
lua>

The last line is a prompt. I can type in lua commands but get an
output only after I interrupt with strg+C and then I see also an
error:

lua> print(a)
print(b)
 <--------------------here strg +c
nil
nil
                  
! LuaTeX error
...tex/khaledhosny-luaotfload-226aa58/otfl-font-map.lua:188: att
empt to index local 'unicodevector' (a nil value).
<to be read again>
                   relax
l.100 \fontencoding\encodingdefault\selectfont

?

What's going on? Why is luatex switching to lua mode?

--
Ulrike Fischer 


From news3 at nililand.de  Thu Oct  6 12:03:25 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 12:03:25 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de> <20111006083253.GA16087@khaled-laptop>
 <89jhs1n3iz7t$.dlg@nililand.de>
Message-ID: <17xrjs6f795k8.dlg@nililand.de>

Am Thu, 6 Oct 2011 11:19:39 +0200 schrieb Ulrike Fischer:


> But now lualatex hangs. 

> ! LuaTeX error
> ...tex/khaledhosny-luaotfload-226aa58/otfl-font-map.lua:188: att
> empt to index local 'unicodevector' (a nil value).
> <to be read again>

Well I found the error: the missing table it defined in
otfl-font-enc.lua by loading font-age.lua. This file is not in
luaotfload. When I copied the file from the context (without
renaming it!) luaotfload worked again. I guess you have an
font-age.lua from your (working) context.


> What's going on? Why is luatex switching to lua mode?

Still intested to know why this problem made luatex switch in lua
mode ;-).

-- 
Ulrike Fischer 


From news3 at nililand.de  Thu Oct  6 14:40:51 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 14:40:51 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de>
Message-ID: <xhk62iggf0yd$.dlg@nililand.de>

Am Thu, 6 Oct 2011 09:11:46 +0200 schrieb Ulrike Fischer:

>> Otherwise, XeTeX supports these features with its Unicode input
>> mapping feature -- what are the chances this could be written
>> with a Lua callback? It's a useful feature in itself, and the big
>> reason polyglossia is currently XeTeX-only.
> 
> You could use a fea-file as a replacement, e.g. to implement  such
> ligatures.

This here seems to work. 

\documentclass{article}
\begin{filecontents*}{tex-dash.fea}
languagesystem DFLT dflt ;
languagesystem latn dflt ;
feature tdas {
   sub hyphen hyphen hyphen by emdash;
   sub hyphen hyphen by endash;
} tdas ;
\end{filecontents*}


\usepackage{fontspec}
\setsansfont[FeatureFile=tex-dash.fea, RawFeature=+tdas]{Arial}
\setmainfont[FeatureFile=tex-dash.fea, RawFeature=+tdas]{Times New
Roman}

\begin{document}
 -- --- \sffamily -- --- 
\end{document}

Comments:
1. You must delete the temp-arial-tex-dash.lua etc files in the
luatex-cache after you changed the fea-file or you won't see the
changes.

2. A bit surprisingly the ligatures seem to work with Renderer=Full
(Some month ago kerning features worked only with Renderer = Basic)

3. I'm not quite sure about the "languagesystem" declarations and if
something is missing in the feature file.  

-- 
Ulrike Fischer 


From news3 at nililand.de  Thu Oct  6 14:51:15 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 14:51:15 +0200
Subject: [lltx] filecontents fails with ualatex
Message-ID: <1o5so1mganx8y$.dlg@nililand.de>

This here fails for me with lualatex on the second compilation:

\documentclass{article}


\usepackage{filecontents}
\begin{filecontents*}{test-output3}
abcx
\end{filecontents*}


\begin{document}
blub
\end{document}


! I can't write on file `test-output3.tex'.
<to be read again> 
                   \relax 
l.7 \begin{filecontents*}{test-output3}

There is not problem with pdflatex. 

-- 
Ulrike Fischer 


From Arno.Trautmann at gmx.de  Thu Oct  6 14:57:02 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Thu, 06 Oct 2011 14:57:02 +0200
Subject: [lltx] filecontents fails with ualatex
In-Reply-To: <1o5so1mganx8y$.dlg@nililand.de>
References: <1o5so1mganx8y$.dlg@nililand.de>
Message-ID: <4E8DA59E.9070201@gmx.de>

Ulrike Fischer wrote:
> This here fails for me with lualatex on the second compilation:
>
> \documentclass{article}
>
>
> \usepackage{filecontents}
> \begin{filecontents*}{test-output3}
> abcx
> \end{filecontents*}
>
>
> \begin{document}
> blub
> \end{document}
>
>
> ! I can't write on file `test-output3.tex'.
> <to be read again>
>                     \relax
> l.7 \begin{filecontents*}{test-output3}
>
> There is not problem with pdflatex.

Cannot reproduce, works for me.

This is LuaTeX, Version beta-0.70.1-2011061410 (rev 4277)
  \write18 enabled.


  *File List*
  article.cls    2007/10/19 v1.4h Standard LaTeX document class
   size10.clo    2007/10/19 v1.4h Standard LaTeX file (size option)
filecontents.sty    2009/03/17 v1.2 Create an external file from within 
a LaTeX
  document
  ***********

From heiko.oberdiek at googlemail.com  Thu Oct  6 14:59:42 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 6 Oct 2011 14:59:42 +0200
Subject: [lltx] filecontents fails with ualatex
In-Reply-To: <1o5so1mganx8y$.dlg@nililand.de>
References: <1o5so1mganx8y$.dlg@nililand.de>
Message-ID: <20111006125941.GA24211@oberdiek.my-fqdn.de>

On Thu, Oct 06, 2011 at 02:51:15PM +0200, Ulrike Fischer wrote:

> This here fails for me with lualatex on the second compilation:
> 
> \documentclass{article}
> 
> 
> \usepackage{filecontents}
> \begin{filecontents*}{test-output3}
> abcx
> \end{filecontents*}
> 
> 
> \begin{document}
> blub
> \end{document}
> 
> 
> ! I can't write on file `test-output3.tex'.

Works for me in TL/Linux: beta-0.70.1-2011061416 (rev 4277).

Test file for "luatex --ini":

\catcode`\{=1
\catcode`\}=2
\immediate\openout4=test-output3
\immediate\write4{abcx-1}
\immediate\closeout4
\immediate\openout4=test-output3
\immediate\write4{abcx-2}
\immediate\closeout4
\csname @@\endcsname\end

Yours sincerely
  Heiko Oberdiek

From news3 at nililand.de  Thu Oct  6 15:24:13 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 15:24:13 +0200
Subject: [lltx] filecontents fails with ualatex
References: <1o5so1mganx8y$.dlg@nililand.de>
 <20111006125941.GA24211@oberdiek.my-fqdn.de>
Message-ID: <p0k0gi46nmsl$.dlg@nililand.de>

Am Thu, 6 Oct 2011 14:59:42 +0200 schrieb Heiko Oberdiek:

>> This here fails for me with lualatex on the second compilation:
>> 
>> \documentclass{article}
>> 
>> 
>> \usepackage{filecontents}
>> \begin{filecontents*}{test-output3}
>> abcx
>> \end{filecontents*}
>> 
>> 
>> \begin{document}
>> blub
>> \end{document}
>> 
>> 
>> ! I can't write on file `test-output3.tex'.
> 
> Works for me in TL/Linux: beta-0.70.1-2011061416 (rev 4277).

Fails for me with the luatex from miktex 

This is LuaTeX, Version beta-0.70.1-2011080216 (rev 4277)  

But works with a windows binary from a recent context minimals.

This is LuaTeX, Version beta-0.70.1-2011100107 (rev 4277)

(I wished the miktex luatex would like e.g. xetex say that it is
from miktex. That would be less confusing when comparing versions).

> Test file for "luatex --ini":
> 
> \catcode`\{=1
> \catcode`\}=2
> \immediate\openout4=test-output3
> \immediate\write4{abcx-1}
> \immediate\closeout4
> \immediate\openout4=test-output3
> \immediate\write4{abcx-2}
> \immediate\closeout4
> \csname @@\endcsname\end

Well overwriting an existing file is in itself not a problem. E.g.
there is no problem with aux or toc files. It looks more like a
timing problem. If I remove the inputcheck from filecontents

  \openin\@inputcheck#1 %
  \ifeof\@inputcheck%
    \@latex at warning@no at line%
        {Writing file `\@currdir#1'}%
  \else %
    \@latex at warning@no at line%
        {Overwriting file `\@currdir#1'}%
  \fi %

it works without problem.  

-- 
Ulrike Fischer 


From news3 at nililand.de  Thu Oct  6 15:27:44 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 15:27:44 +0200
Subject: [lltx] filecontents fails with ualatex
References: <1o5so1mganx8y$.dlg@nililand.de>
 <20111006125941.GA24211@oberdiek.my-fqdn.de> <p0k0gi46nmsl$.dlg@nililand.de>
Message-ID: <18e7a0cbvfc6m$.dlg@nililand.de>

Am Thu, 6 Oct 2011 15:24:13 +0200 schrieb Ulrike Fischer:


> 
> Well overwriting an existing file is in itself not a problem. E.g.
> there is no problem with aux or toc files. It looks more like a
> timing problem. If I remove the inputcheck from filecontents

adding an \immediate\closein\@inputcheck works too. So the problem
seems to be that the file is open for reading when filecontents
tries to open it for writing. 

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 16:11:03 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 16:11:03 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <17xrjs6f795k8.dlg@nililand.de>
References: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de>
 <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de>
 <20111006083253.GA16087@khaled-laptop>
 <89jhs1n3iz7t$.dlg@nililand.de> <17xrjs6f795k8.dlg@nililand.de>
Message-ID: <20111006141103.GA1819@khaled-laptop>

On Thu, Oct 06, 2011 at 12:03:25PM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 11:19:39 +0200 schrieb Ulrike Fischer:
> 
> 
> > But now lualatex hangs. 
> 
> > ! LuaTeX error
> > ...tex/khaledhosny-luaotfload-226aa58/otfl-font-map.lua:188: att
> > empt to index local 'unicodevector' (a nil value).
> > <to be read again>
> 
> Well I found the error: the missing table it defined in
> otfl-font-enc.lua by loading font-age.lua. This file is not in
> luaotfload. When I copied the file from the context (without
> renaming it!) luaotfload worked again. I guess you have an
> font-age.lua from your (working) context.

Right, it was using the file from TeXlive, should I include a copy of
that file? (I don't want to patch otfl-fonts-enc.lua, so font-age.lua
won't be renamed).

> > What's going on? Why is luatex switching to lua mode?
> 
> Still intested to know why this problem made luatex switch in lua
> mode ;-).

No idea, though I've seen it before.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Thu Oct  6 16:28:54 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 16:28:54 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <xhk62iggf0yd$.dlg@nililand.de>
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
Message-ID: <20111006142854.GB1819@khaled-laptop>

On Thu, Oct 06, 2011 at 02:40:51PM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 09:11:46 +0200 schrieb Ulrike Fischer:
> 
> >> Otherwise, XeTeX supports these features with its Unicode input
> >> mapping feature -- what are the chances this could be written
> >> with a Lua callback? It's a useful feature in itself, and the big
> >> reason polyglossia is currently XeTeX-only.
> > 
> > You could use a fea-file as a replacement, e.g. to implement  such
> > ligatures.
> 
> This here seems to work. 
> 
> \documentclass{article}
> \begin{filecontents*}{tex-dash.fea}
> languagesystem DFLT dflt ;
> languagesystem latn dflt ;
> feature tdas {
>    sub hyphen hyphen hyphen by emdash;
>    sub hyphen hyphen by endash;
> } tdas ;
> \end{filecontents*}

This looks fine, AFAIC it is essentially how it was implemented (though
ConTeXt is modifying the lua tfm table directly).

> 
> \usepackage{fontspec}
> \setsansfont[FeatureFile=tex-dash.fea, RawFeature=+tdas]{Arial}
> \setmainfont[FeatureFile=tex-dash.fea, RawFeature=+tdas]{Times New
> Roman}
> 
> \begin{document}
>  -- --- \sffamily -- --- 
> \end{document}
> 
> Comments:
> 1. You must delete the temp-arial-tex-dash.lua etc files in the
> luatex-cache after you changed the fea-file or you won't see the
> changes.

I don't need this here, I recall this being fixed for some time now.

> 2. A bit surprisingly the ligatures seem to work with Renderer=Full
> (Some month ago kerning features worked only with Renderer = Basic)

It should work, kerning is a bit tricky because of discretionary nodes
IIRC.

> 3. I'm not quite sure about the "languagesystem" declarations and if
> something is missing in the feature file.  

Here is the tricky part, ConTeXt code have special wild card for script
any language any, but feature files don't have an equivalent for that so
selecting a different script or language will deactivate the ligatures
(I've to check the OTF spec and see if features in DFLT script should be
always be applied or not, if yes may be I can get Hans to implement
that.)

Also this have the same downside as ConTeXt code being dependant on
glyph names being consistent, unlike the XeTeX's mappings which operate
on characters.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From heiko.oberdiek at googlemail.com  Thu Oct  6 16:47:28 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 6 Oct 2011 16:47:28 +0200
Subject: [lltx] filecontents fails with ualatex
In-Reply-To: <p0k0gi46nmsl$.dlg@nililand.de>
References: <1o5so1mganx8y$.dlg@nililand.de>
 <20111006125941.GA24211@oberdiek.my-fqdn.de>
 <p0k0gi46nmsl$.dlg@nililand.de>
Message-ID: <20111006144728.GA24532@oberdiek.my-fqdn.de>

On Thu, Oct 06, 2011 at 03:24:13PM +0200, Ulrike Fischer wrote:

> Well overwriting an existing file is in itself not a problem. E.g.
> there is no problem with aux or toc files. It looks more like a
> timing problem. If I remove the inputcheck from filecontents
> 
>   \openin\@inputcheck#1 %
>   \ifeof\@inputcheck%
>     \@latex at warning@no at line%
>         {Writing file `\@currdir#1'}%
>   \else %
>     \@latex at warning@no at line%
>         {Overwriting file `\@currdir#1'}%
>   \fi %
> 
> it works without problem.  

Package filecontents has the bug that it does not close
the file after the input check with \openin.

This issue is fixed in the LaTeX kernel version of
the environment `filecontents':

% \changes{v1.0m}{1995/04/21}
%         {Close input check stream: latex/1487}

Minimal file for "luatex --ini":

%%% begin test.tex %%%
\catcode`\{=1
\catcode`\}=2

% Open for reading
\openin7=test-output3
\immediate\write16{* File does \ifeof7 not \fi exist}

% \closein7

% Open for writing
\immediate\openout4=test-output3
\immediate\write4{abcx}
\immediate\closeout4
\csname @@\endcsname\end
%%% end test.tex %%%

With \closein7, this should also work in MiKTeX.
Without \closein7 writing will fail, if the operating
system has locked the file.

Yours sincerely
  Heiko Oberdiek

From news3 at nililand.de  Thu Oct  6 16:47:29 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 16:47:29 +0200
Subject: [lltx] luaotfload update
References: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de> <20111006083253.GA16087@khaled-laptop>
 <89jhs1n3iz7t$.dlg@nililand.de> <17xrjs6f795k8.dlg@nililand.de>
 <20111006141103.GA1819@khaled-laptop>
Message-ID: <2050qpbsibs0.dlg@nililand.de>

Am Thu, 6 Oct 2011 16:11:03 +0200 schrieb Khaled Hosny:


>>> But now lualatex hangs. 
 
>>> ! LuaTeX error
>>> ...tex/khaledhosny-luaotfload-226aa58/otfl-font-map.lua:188: att
>>> empt to index local 'unicodevector' (a nil value).
>>> <to be read again>
>> 
>> Well I found the error: the missing table it defined in
>> otfl-font-enc.lua by loading font-age.lua. This file is not in
>> luaotfload. When I copied the file from the context (without
>> renaming it!) luaotfload worked again. I guess you have an
>> font-age.lua from your (working) context.
> 
> Right, it was using the file from TeXlive, should I include a copy of
> that file? (I don't want to patch otfl-fonts-enc.lua, so font-age.lua
> won't be renamed).

Well it is needed so users without context must have a chance to get
it. At least there should be a test and a warning if the file is
missing - I doubt that many miktex or texlive users would know what
to do when suddenly confronted with a lua prompt - I do have quite
good nerves but got a bit shocked nevertheless :-). 

I know that two versions of a file at different locations could be
problematic, but as the file in question is only a sort of database
and each format will find its version first I don't think that there
is much danger.  

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 16:57:04 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 16:57:04 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <2050qpbsibs0.dlg@nililand.de>
References: <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de>
 <20111006072653.GB15625@khaled-laptop>
 <1uccgwld4w2it.dlg@nililand.de>
 <20111006083253.GA16087@khaled-laptop>
 <89jhs1n3iz7t$.dlg@nililand.de> <17xrjs6f795k8.dlg@nililand.de>
 <20111006141103.GA1819@khaled-laptop>
 <2050qpbsibs0.dlg@nililand.de>
Message-ID: <20111006145704.GA2314@khaled-laptop>

On Thu, Oct 06, 2011 at 04:47:29PM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 16:11:03 +0200 schrieb Khaled Hosny:
> 
> 
> >>> But now lualatex hangs. 
>  
> >>> ! LuaTeX error
> >>> ...tex/khaledhosny-luaotfload-226aa58/otfl-font-map.lua:188: att
> >>> empt to index local 'unicodevector' (a nil value).
> >>> <to be read again>
> >> 
> >> Well I found the error: the missing table it defined in
> >> otfl-font-enc.lua by loading font-age.lua. This file is not in
> >> luaotfload. When I copied the file from the context (without
> >> renaming it!) luaotfload worked again. I guess you have an
> >> font-age.lua from your (working) context.
> > 
> > Right, it was using the file from TeXlive, should I include a copy of
> > that file? (I don't want to patch otfl-fonts-enc.lua, so font-age.lua
> > won't be renamed).
> 
> Well it is needed so users without context must have a chance to get
> it. At least there should be a test and a warning if the file is
> missing - I doubt that many miktex or texlive users would know what
> to do when suddenly confronted with a lua prompt - I do have quite
> good nerves but got a bit shocked nevertheless :-). 
> 
> I know that two versions of a file at different locations could be
> problematic, but as the file in question is only a sort of database
> and each format will find its version first I don't think that there
> is much danger.  

That is convincing, I included a cop of it.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From news3 at nililand.de  Thu Oct  6 17:11:27 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 17:11:27 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
 <20111006142854.GB1819@khaled-laptop>
Message-ID: <1eiff2v624r91.dlg@nililand.de>

Am Thu, 6 Oct 2011 16:28:54 +0200 schrieb Khaled Hosny:


>>>> Otherwise, XeTeX supports these features with its Unicode input
>>>> mapping feature -- what are the chances this could be written
>>>> with a Lua callback? It's a useful feature in itself, and the big
>>>> reason polyglossia is currently XeTeX-only.
>>> 
>>> You could use a fea-file as a replacement, e.g. to implement  such
>>> ligatures.
>> 
>> This here seems to work. 
>> 
>> \documentclass{article}
>> \begin{filecontents*}{tex-dash.fea}
>> languagesystem DFLT dflt ;
>> languagesystem latn dflt ;
>> feature tdas {
>>    sub hyphen hyphen hyphen by emdash;
>>    sub hyphen hyphen by endash;
>> } tdas ;
>> \end{filecontents*}
> 
> This looks fine, AFAIC it is essentially how it was implemented (though
> ConTeXt is modifying the lua tfm table directly).

;-) 

Do you know why   "sub a b by c;" works fine (2 glyphs mapped to one
glyph) while  "sub d by e;" (one to one) fails?

 
>> Comments:
>> 1. You must delete the temp-arial-tex-dash.lua etc files in the
>> luatex-cache after you changed the fea-file or you won't see the
>> changes.
> 
> I don't need this here, I recall this being fixed for some time now.

Yes I also recall that at some time it worked. But currently it
doesn't work for me. I have to delete the temp-files. 

How does luaotfload decide if the temp-files should be regenerated?


-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 17:22:06 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 17:22:06 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <1eiff2v624r91.dlg@nililand.de>
References: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
 <20111006142854.GB1819@khaled-laptop>
 <1eiff2v624r91.dlg@nililand.de>
Message-ID: <20111006152205.GA2640@khaled-laptop>

On Thu, Oct 06, 2011 at 05:11:27PM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 16:28:54 +0200 schrieb Khaled Hosny:
> 
> 
> >>>> Otherwise, XeTeX supports these features with its Unicode input
> >>>> mapping feature -- what are the chances this could be written
> >>>> with a Lua callback? It's a useful feature in itself, and the big
> >>>> reason polyglossia is currently XeTeX-only.
> >>> 
> >>> You could use a fea-file as a replacement, e.g. to implement  such
> >>> ligatures.
> >> 
> >> This here seems to work. 
> >> 
> >> \documentclass{article}
> >> \begin{filecontents*}{tex-dash.fea}
> >> languagesystem DFLT dflt ;
> >> languagesystem latn dflt ;
> >> feature tdas {
> >>    sub hyphen hyphen hyphen by emdash;
> >>    sub hyphen hyphen by endash;
> >> } tdas ;
> >> \end{filecontents*}
> > 
> > This looks fine, AFAIC it is essentially how it was implemented (though
> > ConTeXt is modifying the lua tfm table directly).
> 
> ;-) 
> 
> Do you know why   "sub a b by c;" works fine (2 glyphs mapped to one
> glyph) while  "sub d by e;" (one to one) fails?

Are they both in the same feature/lookup block, if so then I recall it
is a bug in FontForge feature file import (one too many and one to one
are different internally and need to go to separate lookups, FontForge
should either complain and reject the file or do the split, but it seems
to just silently ignore the different entries. Moving each type to its
own block should fix it.)

> >> Comments:
> >> 1. You must delete the temp-arial-tex-dash.lua etc files in the
> >> luatex-cache after you changed the fea-file or you won't see the
> >> changes.
> > 
> > I don't need this here, I recall this being fixed for some time now.
> 
> Yes I also recall that at some time it worked. But currently it
> doesn't work for me. I have to delete the temp-files. 
> 
> How does luaotfload decide if the temp-files should be regenerated?

The cashed file name is a hash for font name and any applied feature
files, here I have in my cache temp-dejavusans.lua and
temp-dejavusans-tex-dash.lua.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From news3 at nililand.de  Thu Oct  6 17:39:10 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Thu, 6 Oct 2011 17:39:10 +0200
Subject: [lltx] luaotfload update
References: <0235042F-E426-45D3-B134-3C3C03E58030@gundla.ch>
 <CAArVCkTDfEB_cnubS85240F1Aknm=cDEYZy-hftvbrLfzXNCow@mail.gmail.com>
 <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
 <20111006142854.GB1819@khaled-laptop> <1eiff2v624r91.dlg@nililand.de>
 <20111006152205.GA2640@khaled-laptop>
Message-ID: <187vqrv72l27b.dlg@nililand.de>

Am Thu, 6 Oct 2011 17:22:06 +0200 schrieb Khaled Hosny:


>> Do you know why   "sub a b by c;" works fine (2 glyphs mapped to one
>> glyph) while  "sub d by e;" (one to one) fails?
> 
> Are they both in the same feature/lookup block, if so then I recall it
> is a bug in FontForge feature file import (one too many and one to one
> are different internally and need to go to separate lookups, FontForge
> should either complain and reject the file or do the split, but it seems
> to just silently ignore the different entries. Moving each type to its
> own block should fix it.)

Yes, using a second feature "tsim" worked. 


>>>> Comments:
>>>> 1. You must delete the temp-arial-tex-dash.lua etc files in the
>>>> luatex-cache after you changed the fea-file or you won't see the
>>>> changes.
>>> 
>>> I don't need this here, I recall this being fixed for some time now.
>> 
>> Yes I also recall that at some time it worked. But currently it
>> doesn't work for me. I have to delete the temp-files. 
>> 
>> How does luaotfload decide if the temp-files should be regenerated?
> 
> The cashed file name is a hash for font name and any applied feature
> files, here I have in my cache temp-dejavusans.lua and
> temp-dejavusans-tex-dash.lua.

I too have the two lua files. But if I change something in the fea
file, e.g. add another sub command, - *without changing the name of
the file* - temp-arial-tex-dash.lua is not recreated and the new sub
command is ignored.  

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Thu Oct  6 17:44:58 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 17:44:58 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <187vqrv72l27b.dlg@nililand.de>
References: <254353B3-DE07-4AF2-A999-D8308B14750D@gundla.ch>
 <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
 <20111006142854.GB1819@khaled-laptop>
 <1eiff2v624r91.dlg@nililand.de>
 <20111006152205.GA2640@khaled-laptop>
 <187vqrv72l27b.dlg@nililand.de>
Message-ID: <20111006154458.GA2863@khaled-laptop>

On Thu, Oct 06, 2011 at 05:39:10PM +0200, Ulrike Fischer wrote:
> Am Thu, 6 Oct 2011 17:22:06 +0200 schrieb Khaled Hosny:
> 
> 
> >> Do you know why   "sub a b by c;" works fine (2 glyphs mapped to one
> >> glyph) while  "sub d by e;" (one to one) fails?
> > 
> > Are they both in the same feature/lookup block, if so then I recall it
> > is a bug in FontForge feature file import (one too many and one to one
> > are different internally and need to go to separate lookups, FontForge
> > should either complain and reject the file or do the split, but it seems
> > to just silently ignore the different entries. Moving each type to its
> > own block should fix it.)
> 
> Yes, using a second feature "tsim" worked. 

You can use the same name as well. A feature is kind of a tag for a
number of lookups, though feature files abstract this greatly.

> >>>> Comments:
> >>>> 1. You must delete the temp-arial-tex-dash.lua etc files in the
> >>>> luatex-cache after you changed the fea-file or you won't see the
> >>>> changes.
> >>> 
> >>> I don't need this here, I recall this being fixed for some time now.
> >> 
> >> Yes I also recall that at some time it worked. But currently it
> >> doesn't work for me. I have to delete the temp-files. 
> >> 
> >> How does luaotfload decide if the temp-files should be regenerated?
> > 
> > The cashed file name is a hash for font name and any applied feature
> > files, here I have in my cache temp-dejavusans.lua and
> > temp-dejavusans-tex-dash.lua.
> 
> I too have the two lua files. But if I change something in the fea
> file, e.g. add another sub command, - *without changing the name of
> the file* - temp-arial-tex-dash.lua is not recreated and the new sub
> command is ignored.  

Ah, I thought you are asking about activating/deactivating the feature,
now I remember the original issue. I fixed that by using file
timestamps, but I think this lost in the update. I'll check again.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Fri Oct  7 03:00:28 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 7 Oct 2011 03:00:28 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111006154458.GA2863@khaled-laptop>
References: <CAArVCkT=+v2n9PeNYgwwMRKpskFdB2WL6p-JOqs0DH0RAdmAyA@mail.gmail.com>
 <20111006064056.GA13587@khaled-laptop>
 <EC48C49A-3BDE-4633-B0E9-B56EBC78BA96@gmail.com>
 <118jk8ny2m1wa.dlg@nililand.de> <xhk62iggf0yd$.dlg@nililand.de>
 <20111006142854.GB1819@khaled-laptop>
 <1eiff2v624r91.dlg@nililand.de>
 <20111006152205.GA2640@khaled-laptop>
 <187vqrv72l27b.dlg@nililand.de>
 <20111006154458.GA2863@khaled-laptop>
Message-ID: <20111007010028.GA6025@khaled-laptop>

On Thu, Oct 06, 2011 at 05:44:58PM +0200, Khaled Hosny wrote:
> > >>>> Comments:
> > >>>> 1. You must delete the temp-arial-tex-dash.lua etc files in the
> > >>>> luatex-cache after you changed the fea-file or you won't see the
> > >>>> changes.
> > >>> 
> > >>> I don't need this here, I recall this being fixed for some time now.
> > >> 
> > >> Yes I also recall that at some time it worked. But currently it
> > >> doesn't work for me. I have to delete the temp-files. 
> > >> 
> > >> How does luaotfload decide if the temp-files should be regenerated?
> > > 
> > > The cashed file name is a hash for font name and any applied feature
> > > files, here I have in my cache temp-dejavusans.lua and
> > > temp-dejavusans-tex-dash.lua.
> > 
> > I too have the two lua files. But if I change something in the fea
> > file, e.g. add another sub command, - *without changing the name of
> > the file* - temp-arial-tex-dash.lua is not recreated and the new sub
> > command is ignored.  
> 
> Ah, I thought you are asking about activating/deactivating the feature,
> now I remember the original issue. I fixed that by using file
> timestamps, but I think this lost in the update. I'll check again.

Should work fine now (fixed by Hans.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From scott at pakin.org  Sun Oct  9 02:07:18 2011
From: scott at pakin.org (Scott Pakin)
Date: Sat, 08 Oct 2011 18:07:18 -0600
Subject: [lltx] filecontents fails with ualatex
In-Reply-To: <20111006144728.GA24532@oberdiek.my-fqdn.de>
References: <1o5so1mganx8y$.dlg@nililand.de>
 <20111006125941.GA24211@oberdiek.my-fqdn.de> <p0k0gi46nmsl$.dlg@nililand.de>
 <20111006144728.GA24532@oberdiek.my-fqdn.de>
Message-ID: <4E90E5B6.30901@pakin.org>

On 10/06/2011 08:47 AM, Heiko Oberdiek wrote:
> Package filecontents has the bug that it does not close
> the file after the input check with \openin.
> 
> This issue is fixed in the LaTeX kernel version of
> the environment `filecontents':
> 
> % \changes{v1.0m}{1995/04/21}
> %         {Close input check stream: latex/1487}

I just added a "\closein\@inputcheck" to filecontents and re-uploaded
the package to CTAN.

Thanks for the bug report,
-- Scott

From khaledhosny at eglug.org  Sun Oct 16 19:24:18 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 Oct 2011 19:24:18 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111006012242.GA7891@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
Message-ID: <20111016172418.GA2574@khaled-laptop>

Hi all,

Few updates; the `unstable` branch has been merged into `master` and
further development will take place there, and there have been few more
syncs with ConTeXt and as the result we no longer patch any of original
files (thanks to Hans accepting few luaotfload specific patches), also
we now support byte code compiled font cache files (might do so for font
names database as well) which saves few milliseconds in font loading
(~2s when running `make check` on my machines) but firs time the font is
loaded is a bit slower (because of time used to compile the cache).

Now the main issue holding the new release is the removed tlig and trep
feature, I'm still not sure what to do here.

(BTW, LM and TeX Gyre fonts have this covered by `dlig` feature, which
is how it have always been done in TeX; a font feature implemented in
every individual font that wants it and not some input mapping or engine
feature.)

Regards,
 Khaled

From patrick at gundla.ch  Sun Oct 16 19:31:39 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 16 Oct 2011 19:31:39 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111016172418.GA2574@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
Message-ID: <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>

Hi Khaled,

thanks again very much for your work on luaotfload. It's very useful.

At least one question remains: are there any changes regarding type1 fonts? If they are not supported: do you think that a patch will break the compatibility with Hans' code?

Patrick



From khaledhosny at eglug.org  Sun Oct 16 20:56:25 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 Oct 2011 20:56:25 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
Message-ID: <20111016185624.GA3498@khaled-laptop>

On Sun, Oct 16, 2011 at 07:31:39PM +0200, Patrick Gundlach wrote:
> Hi Khaled,
> 
> thanks again very much for your work on luaotfload. It's very useful.
> 
> At least one question remains: are there any changes regarding type1
> fonts? If they are not supported: do you think that a patch will break
> the compatibility with Hans' code?

I think it is fairly isolated, you need to define a type1 reader
function:

fonts.formats.pfb = "pfb"
function fonts.readers.pfb(specification)
   -- process specification
   -- load the font and process it
   -- may be apply an afm file
   return tfmtable
end

Check otfl-fonts-lua.lua for the simple lua font reader, or
otfl-font-otf.lua for the much more complex opentype readers.

Regards,
 Khaled

From patrick at gundla.ch  Sun Oct 16 22:47:50 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 16 Oct 2011 22:47:50 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111016185624.GA3498@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
 <20111016185624.GA3498@khaled-laptop>
Message-ID: <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>


Am 16.10.2011 um 20:56 schrieb Khaled Hosny:

> On Sun, Oct 16, 2011 at 07:31:39PM +0200, Patrick Gundlach wrote:
>> Hi Khaled,
>> 
>> thanks again very much for your work on luaotfload. It's very useful.
>> 
>> At least one question remains: are there any changes regarding type1
>> fonts? If they are not supported: do you think that a patch will break
>> the compatibility with Hans' code?
> 
> I think it is fairly isolated, you need to define a type1 reader
> function:
> 
> fonts.formats.pfb = "pfb"
> function fonts.readers.pfb(specification)
>   -- process specification
>   -- load the font and process it
>   -- may be apply an afm file
>   return tfmtable
> end


OK, that's cool. I think I can cook something up. Probably "unstable" at the beginning but better than nothing. I already have font loader for type1 fonts here (without ligatures yet).

Patrick



From khaledhosny at eglug.org  Mon Oct 17 05:42:27 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 05:42:27 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
 <20111016185624.GA3498@khaled-laptop>
 <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>
Message-ID: <20111017034226.GA5658@khaled-laptop>

On Sun, Oct 16, 2011 at 10:47:50PM +0200, Patrick Gundlach wrote:
> 
> Am 16.10.2011 um 20:56 schrieb Khaled Hosny:
> 
> > On Sun, Oct 16, 2011 at 07:31:39PM +0200, Patrick Gundlach wrote:
> >> Hi Khaled,
> >> 
> >> thanks again very much for your work on luaotfload. It's very useful.
> >> 
> >> At least one question remains: are there any changes regarding type1
> >> fonts? If they are not supported: do you think that a patch will break
> >> the compatibility with Hans' code?
> > 
> > I think it is fairly isolated, you need to define a type1 reader
> > function:
> > 
> > fonts.formats.pfb = "pfb"
> > function fonts.readers.pfb(specification)
> >   -- process specification
> >   -- load the font and process it
> >   -- may be apply an afm file
> >   return tfmtable
> > end
> 
> 
> OK, that's cool. I think I can cook something up. Probably "unstable"
> at the beginning but better than nothing. I already have font loader
> for type1 fonts here (without ligatures yet).

I hacked up a quick type1 reader that used the existing opentype reader.
Works fine except there is a small bug in the opentype reader which sets
the units_per_em to 0 if it is not set.

The font names indexer need to be extended to index type1 fonts as well
(should be just teaching it a couple more extensions to look for).

Regards,
 Khaled
-------------- next part --------------
A non-text attachment was scrubbed...
Name: type1.diff
Type: text/x-diff
Size: 1232 bytes
Desc: not available
URL: <http://tug.org/pipermail/lualatex-dev/attachments/20111017/fdae03f0/attachment.bin>

From wspr81 at gmail.com  Mon Oct 17 08:42:18 2011
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 17 Oct 2011 17:12:18 +1030
Subject: [lltx] luaotfload update
In-Reply-To: <20111016172418.GA2574@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
Message-ID: <8A499123-FDF6-433D-8C13-F86E68547007@gmail.com>

On 17/10/2011, at 3:54 AM, Khaled Hosny wrote:

> Now the main issue holding the new release is the removed tlig and trep
> feature, I'm still not sure what to do here.

Sorry, I've been away and unable to look into this.

Could we provide a feature-file including the standard TeX ligatures and use that? Is it possible to use more than a single .fea file to construct the additional OpenType information? Even if not, it's not the end of the world, as XeTeX "mapping" files can only be applied single-y and that hasn't been a big impediment.

Otherwise (if all that would be a bad idea for some reason), it would be nice to take the code that implemented tlig and trep and use it somehow in fontspec, but I'm afraid that's outside what I could possibly do in the near term...

-- Will



From khaledhosny at eglug.org  Mon Oct 17 10:19:48 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 10:19:48 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <8A499123-FDF6-433D-8C13-F86E68547007@gmail.com>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <8A499123-FDF6-433D-8C13-F86E68547007@gmail.com>
Message-ID: <20111017081948.GA7517@khaled-laptop>

On Mon, Oct 17, 2011 at 05:12:18PM +1030, Will Robertson wrote:
> On 17/10/2011, at 3:54 AM, Khaled Hosny wrote:
> 
> > Now the main issue holding the new release is the removed tlig and trep
> > feature, I'm still not sure what to do here.
> 
> Sorry, I've been away and unable to look into this.
> 
> Could we provide a feature-file including the standard TeX ligatures
> and use that?

I think we can have a feature file for that, it would even include all
scripts recognised by fontspec so it can work regardless of the chosen
script.

> Is it possible to use more than a single .fea file to construct the
> additional OpenType information? Even if not, it's not the end of the
> world, as XeTeX "mapping" files can only be applied single-y and that
> hasn't been a big impediment.

`featurefile` (should) accept a coma-separated list of files, but this
does not work now. I think I found a fix, though.

> Otherwise (if all that would be a bad idea for some reason), it would
> be nice to take the code that implemented tlig and trep and use it
> somehow in fontspec, but I'm afraid that's outside what I could
> possibly do in the near term...

The problem with such code is that it tend to depend too much on the
internals of ConTeXt font loading code, that why I'm reluctant to
extract it from ConTeXt and maintaining it separately.

Regards,
 Khaled

From patrick at gundla.ch  Mon Oct 17 12:32:10 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 17 Oct 2011 12:32:10 +0200
Subject: [lltx] [Dev-luatex] The explanation of \directlua in the manual
In-Reply-To: <CABCShTiJ4JJk_9-2cQ7uP1FgFurY0u4nVmW-wWOnJvuQwESP4Q@mail.gmail.com>
References: <CABCShTiJ4JJk_9-2cQ7uP1FgFurY0u4nVmW-wWOnJvuQwESP4Q@mail.gmail.com>
Message-ID: <901BC6D2-292E-42EE-9FCF-16A4AA2AF8EE@gundla.ch>


Am 11.10.2011 um 13:53 schrieb Javier M?gica de Rivera:


> Note that the expansion of \directlua is a sequence of characters, not
> of tokens, contrary to all TeX commands. So formally speaking its
> expansion is null, but places material on a pseudo-file to be
> immediately read by TeX, as etex's \scantokens.
> 
> For a description of print functions look at section 4.13.10.

Is that really true? When you assign catcodes (catcode tables) to the print functions, TeX's behavior is different from scantokens. I have never used scantokens, so I am not 100% sure. Take for example:

tex.print(-2, "\\def\\foo{abc}") 

will not define \foo. While you have referenced the section with the print commands, I think that the description is misleading.

Patrick



From patrick at gundla.ch  Mon Oct 17 17:14:50 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 17 Oct 2011 17:14:50 +0200
Subject: [lltx] [Dev-luatex] The explanation of \directlua in the manual
In-Reply-To: <901BC6D2-292E-42EE-9FCF-16A4AA2AF8EE@gundla.ch>
References: <CABCShTiJ4JJk_9-2cQ7uP1FgFurY0u4nVmW-wWOnJvuQwESP4Q@mail.gmail.com>
 <901BC6D2-292E-42EE-9FCF-16A4AA2AF8EE@gundla.ch>
Message-ID: <3B2BA227-49EF-48C8-A6EC-39F4009D1142@gundla.ch>


Am 17.10.2011 um 12:32 schrieb Patrick Gundlach:

(wrong list, sorry)



From news3 at nililand.de  Mon Oct 17 18:23:13 2011
From: news3 at nililand.de (Ulrike Fischer)
Date: Mon, 17 Oct 2011 18:23:13 +0200
Subject: [lltx] luaotfload update
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <8A499123-FDF6-433D-8C13-F86E68547007@gmail.com>
 <20111017081948.GA7517@khaled-laptop>
Message-ID: <1pdcb83ah6txj.dlg@nililand.de>

Am Mon, 17 Oct 2011 10:19:48 +0200 schrieb Khaled Hosny:

 
>>> Now the main issue holding the new release is the removed tlig and trep
>>> feature, I'm still not sure what to do here.
 
>> Sorry, I've been away and unable to look into this.
 
>> Could we provide a feature-file including the standard TeX ligatures
>> and use that?

I sent a small file some days ago which worked fine. It only needs
some polishing on the script/language side where I don't know the
best combinition. 

I personally think a feature file is a good idea. Using lua-code /
virtual fonts or something like this is imho problematic as the
context interfaces are not stable enough.    

> I think we can have a feature file for that, it would even include all
> scripts recognised by fontspec so it can work regardless of the chosen
> script.

>> Is it possible to use more than a single .fea file to construct the
>> additional OpenType information? Even if not, it's not the end of the
>> world, as XeTeX "mapping" files can only be applied single-y and that
>> hasn't been a big impediment.

> `featurefile` (should) accept a coma-separated list of files, but this
> does not work now. I think I found a fix, though.

I have seen some posting where feature files have been used to
change the kerning. Actually I think they will be used more with
luatex as there are text files and so much easier to use. 

So I think it is important that you can use more than one feature
file (or that they can be assembled on-the-fly by fontspec). 
 
-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Oct 17 18:37:49 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 18:37:49 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <1pdcb83ah6txj.dlg@nililand.de>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <8A499123-FDF6-433D-8C13-F86E68547007@gmail.com>
 <20111017081948.GA7517@khaled-laptop>
 <1pdcb83ah6txj.dlg@nililand.de>
Message-ID: <20111017163748.GA9297@khaled-laptop>

On Mon, Oct 17, 2011 at 06:23:13PM +0200, Ulrike Fischer wrote:
> Am Mon, 17 Oct 2011 10:19:48 +0200 schrieb Khaled Hosny:
> 
>  
> >>> Now the main issue holding the new release is the removed tlig and trep
> >>> feature, I'm still not sure what to do here.
>  
> >> Sorry, I've been away and unable to look into this.
>  
> >> Could we provide a feature-file including the standard TeX ligatures
> >> and use that?
> 
> I sent a small file some days ago which worked fine. It only needs
> some polishing on the script/language side where I don't know the
> best combinition. 
> 
> I personally think a feature file is a good idea. Using lua-code /
> virtual fonts or something like this is imho problematic as the
> context interfaces are not stable enough.    

I think it just needs a (not so) few more `languagesystem` statements
with all possible scripts and language `dflt` (though I need to test
what happens if the font have languages other than default).

> > I think we can have a feature file for that, it would even include all
> > scripts recognised by fontspec so it can work regardless of the chosen
> > script.
> 
> >> Is it possible to use more than a single .fea file to construct the
> >> additional OpenType information? Even if not, it's not the end of the
> >> world, as XeTeX "mapping" files can only be applied single-y and that
> >> hasn't been a big impediment.
> 
> > `featurefile` (should) accept a coma-separated list of files, but this
> > does not work now. I think I found a fix, though.
> 
> I have seen some posting where feature files have been used to
> change the kerning. Actually I think they will be used more with
> luatex as there are text files and so much easier to use. 

My opinion too, (unless if someone wants to implement it by direct node
list processing).

> So I think it is important that you can use more than one feature
> file (or that they can be assembled on-the-fly by fontspec). 

In git now one can pass "featurefile=foo,bar,whatever", but fontspec
FeatureFile option need to be updated to "accumulate" all its
invocations and pass it once to luaotfload so it can be used more than
once. Not something I co do, though.

Regards,
 Khaled

From patrick at gundla.ch  Mon Oct 17 19:28:08 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 17 Oct 2011 19:28:08 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111017034226.GA5658@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
 <20111016185624.GA3498@khaled-laptop>
 <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>
 <20111017034226.GA5658@khaled-laptop>
Message-ID: <517E258B-6EA7-4185-ABE5-C43CFD6A1C59@gundla.ch>

Hi Khaled,

> I hacked up a quick type1 reader that used the existing opentype reader.
> Works fine except there is a small bug in the opentype reader which sets
> the units_per_em to 0 if it is not set.

can you give an example usage?
------------------------------------------
\input luaotfload.sty

\font\myfont="file:dollr___.pfb" 
\myfont hello world

\bye
------------------------------------------

fails here with

------------------------------------------
\myfont world |
[1{/opt/texlive2011/texmf-var/fonts/map/pdftex/updmap/pdftex.map}] )
(see the transcript file for additional information)<./dollr___.pfb
!LuaTeX error (file ./dollr___.pfb): Invalid font type
 ==> Fatal error occurred, no output PDF file produced!
------------------------------------------

Patrick


From khaledhosny at eglug.org  Mon Oct 17 20:51:23 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 20:51:23 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <517E258B-6EA7-4185-ABE5-C43CFD6A1C59@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
 <20111016185624.GA3498@khaled-laptop>
 <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>
 <20111017034226.GA5658@khaled-laptop>
 <517E258B-6EA7-4185-ABE5-C43CFD6A1C59@gundla.ch>
Message-ID: <20111017185123.GA9668@khaled-laptop>

On Mon, Oct 17, 2011 at 07:28:08PM +0200, Patrick Gundlach wrote:
> Hi Khaled,
> 
> > I hacked up a quick type1 reader that used the existing opentype reader.
> > Works fine except there is a small bug in the opentype reader which sets
> > the units_per_em to 0 if it is not set.
> 
> can you give an example usage?
> ------------------------------------------
> \input luaotfload.sty
> 
> \font\myfont="file:dollr___.pfb" 
> \myfont hello world
> 
> \bye
> ------------------------------------------

This should work, anyway, my test file is:

\input luaotfload.sty
\font\fpl=file:fplrij8a.pfb
\fpl foo
\bye

> fails here with
> 
> ------------------------------------------
> \myfont world |
> [1{/opt/texlive2011/texmf-var/fonts/map/pdftex/updmap/pdftex.map}] )
> (see the transcript file for additional information)<./dollr___.pfb
> !LuaTeX error (file ./dollr___.pfb): Invalid font type
>  ==> Fatal error occurred, no output PDF file produced!
> ------------------------------------------

Try removing that file cache (I experienced this when I had old cache of
some failed experiment). It means the 'format' key in the returned tfm
table has the wrong value.

Regards,
 Khaled

From patrick at gundla.ch  Mon Oct 17 21:01:52 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 17 Oct 2011 21:01:52 +0200
Subject: [lltx] luaotfload update
In-Reply-To: <20111017185123.GA9668@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
 <20111016172418.GA2574@khaled-laptop>
 <66A401BE-FC63-4824-8600-AE9D600282B3@gundla.ch>
 <20111016185624.GA3498@khaled-laptop>
 <08C2634F-7DAB-48D7-ABAA-60EC0CC2A18D@gundla.ch>
 <20111017034226.GA5658@khaled-laptop>
 <517E258B-6EA7-4185-ABE5-C43CFD6A1C59@gundla.ch>
 <20111017185123.GA9668@khaled-laptop>
Message-ID: <5D22340A-FC4E-496F-9A55-33E8D8DBA2D7@gundla.ch>


Am 17.10.2011 um 20:51 schrieb Khaled Hosny:

> Try removing that file cache (I experienced this when I had old cache of
> some failed experiment). It means the 'format' key in the returned tfm
> table has the wrong value.

That did the trick. Thanks.

Patrick


From patrick at gundla.ch  Tue Oct 18 14:24:02 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 18 Oct 2011 14:24:02 +0200
Subject: [lltx] luacode, %
Message-ID: <C82C5368-F97F-431E-A5E2-A7CDF460C599@gundla.ch>

Hi,

the documentation of luacode tells me (table on page two) that percent signs are not easy to put in the code. I don't understand that. Look at this example:

\documentclass{article}
\usepackage{luacode}
\begin{document}
\luadirect{
tex.print(string.format("\%3f",43.2))
}
\end{document}

This looks fine to me. What am I missing here?

Patrick



From zappathustra at free.fr  Tue Oct 18 15:09:39 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 18 Oct 2011 15:09:39 +0200
Subject: [lltx] luacode, %
In-Reply-To: <C82C5368-F97F-431E-A5E2-A7CDF460C599@gundla.ch>
References: <C82C5368-F97F-431E-A5E2-A7CDF460C599@gundla.ch>
Message-ID: <4E9D7A93.1070602@free.fr>

Le 18/10/2011 14:24, Patrick Gundlach a ?crit :
> Hi,
>
> the documentation of luacode tells me (table on page two) that percent signs are not easy to put in the code. I don't understand that. Look at this example:
>
> \documentclass{article}
> \usepackage{luacode}
> \begin{document}
> \luadirect{
> tex.print(string.format("\%3f",43.2))
> }
> \end{document}
>
> This looks fine to me. What am I missing here?

My two cents is that here you're using "\%" (not %), which is 
\chardef'ined, so not expanded, and is passed as is to the Lua 
interpreter. Try "\luadirect{foo = 25 % 5}" and I think you'll probably 
get trouble.

Best,
Paul

From Arno.Trautmann at gmx.de  Wed Oct 19 12:24:29 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 19 Oct 2011 12:24:29 +0200
Subject: [lltx] Problems with fontspec
Message-ID: <4E9EA55D.5020406@gmx.de>

Hi all,

at the DANTE autumn meeting, Herbert Voss pointed out some problems with 
LuaTeX and fonts. Apart from other problems, one thing is quite 
striking, concerning the Linux Libertine Fonts delivered with TeX Live:

\documentclass{minimal}
\usepackage{fontspec}
\setmainfont{Linux Libertine O} % works, but no slanted
%\setmainfont{Linux Libertine O Italic} % works, but all italic (ok)
%\setmainfont{Linux Libertine Slanted O} % breaks with font-not-found
% \setmainfont{LinLibertineSlantedO} % works, but all slanted (ok)
\setmainfont[SlantedFont=LinLibertineSlantedO]{Linux Libertine O} % does 
the job correctly
\begin{document}
abc \textrm{abc} \textit{abc} \textsl{abc}
\end{document}

The problem is the slanted font. It is neither found automatically, nor 
can it be accessed using its "fullname" ? only the "psname" works. The 
same is true for my system-installed Libertine, but without the ?O? in 
the name. However, with XeTeX, the font is found and used correctly, so 
it seems more to be a otfload-related problem than a fontspec or 
Libertine bug.

Another thing: setting Linux Libertine O Italic as main font results in 
italics everywhere. I'd consider this a feature, but am not sure if it 
should be called a bug.

Finally: fontspec still gobbles spaces in error messages:

! The font "LinuxLibertineSlantedO" cannot be found.

Bug or feature?

cheers
Arno

