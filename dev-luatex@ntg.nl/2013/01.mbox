From taco at elvenkind.com  Wed Jan  2 14:32:13 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Jan 2013 14:32:13 +0100
Subject: [Dev-luatex] [dev-context] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <20121225161116.GD28858@homerow>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
 <20121225150730.GA28858@homerow> <20121225161116.GD28858@homerow>
Message-ID: <50E436DD.7000109@elvenkind.com>

On 12/25/2012 05:11 PM, Marco Patzer wrote:
> On 2012?12?25 Marco Patzer wrote:
>
>> Linking fails due to a call to an undefined function:
>>
>> Undefined			first referenced
>>   symbol  			    in file
>> hstrerror                           libluasocket.a(libluasocket_a-socket.o)
>> ld: fatal: symbol referencing errors. No output written to luatex
>>
>> A patch is attached.
>
> Changing hstrerror (from netdb.h) to strerror might not be a good
> idea, it might result in reporting a wrong error message. This
> should be fixed so that hstrerror is actually found.

hstrerror is in -lresolv, and needs an extra autoconf test, no need
for source patches.

Best wishes,
Taco


From homerow at lavabit.com  Wed Jan  2 15:00:40 2013
From: homerow at lavabit.com (Marco Patzer)
Date: Wed, 2 Jan 2013 15:00:40 +0100
Subject: [Dev-luatex] [dev-context] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <50E436DD.7000109@elvenkind.com>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
 <20121225150730.GA28858@homerow> <20121225161116.GD28858@homerow>
 <50E436DD.7000109@elvenkind.com>
Message-ID: <20130102140040.GB11551@homerow>

On 2013?01?02 Taco Hoekwater wrote:

> >Changing hstrerror (from netdb.h) to strerror might not be a good
> >idea, it might result in reporting a wrong error message. This
> >should be fixed so that hstrerror is actually found.
> 
> hstrerror is in -lresolv, and needs an extra autoconf test, no need
> for source patches.

That makes sense. Thanks for looking into that. Tomorrow I will run a
re-build if it's fixed by then.

Marco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20130102/83a78bd1/attachment.pgp>

From root at mail.boekplan.nl  Wed Jan  2 16:28:17 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed,  2 Jan 2013 16:28:17 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130102152817.AD05640065@mail.boekplan.nl>

------------------------------------------------------------------------
r4545 | taco | 2013-01-02 12:25:53 +0100 (Wed, 02 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luasocket/src/usocket.c

fix luatex on older linux32 (missing EAI_OVERFLOW)

------------------------------------------------------------------------
r4546 | taco | 2013-01-02 15:52:28 +0100 (Wed, 02 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/liolibext.c
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.w

patch from Akira Kakuto to fix dynaloading problems on win32 native

------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Jan  2 22:29:07 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed,  2 Jan 2013 22:29:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130102212907.C672840C7C@mail.boekplan.nl>

------------------------------------------------------------------------
r4547 | taco | 2013-01-02 17:16:32 +0100 (Wed, 02 Jan 2013) | 2 lines
Changed paths:
   D /trunk/source/texk/web2c/luatexdir/luasocket/src/makefile

dont need this makefile

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jan  4 12:29:05 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jan 2013 12:29:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130104112905.5A344407EE@mail.boekplan.nl>

------------------------------------------------------------------------
r4548 | taco | 2013-01-04 10:01:11 +0100 (Fri, 04 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.w

extender objects can (under some circumstances) be zero width

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jan  4 16:28:29 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jan 2013 16:28:29 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130104152829.E576140065@mail.boekplan.nl>

------------------------------------------------------------------------
r4549 | taco | 2013-01-04 13:49:42 +0100 (Fri, 04 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac

attempt to fix problem with -lresolv on solaris

------------------------------------------------------------------------
r4550 | taco | 2013-01-04 13:51:57 +0100 (Fri, 04 Jan 2013) | 2 lines
Changed paths:
   M /tags/beta-0.74.0/source/texk/web2c/configure
   M /tags/beta-0.74.0/source/texk/web2c/configure.ac

same -lresolv fix as for trunk

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jan  4 22:28:09 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jan 2013 22:28:09 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130104212809.29E1F40065@mail.boekplan.nl>

------------------------------------------------------------------------
r4551 | taco | 2013-01-04 17:08:20 +0100 (Fri, 04 Jan 2013) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writecff.w
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/encoding.c
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/splinefont.h
   M /trunk/source/texk/web2c/luatexdir/luatex.c

remove the cidmap callbacks again (let that be done by user lua code after the fact),
remove the fatal error on fonts where num_glyphs is too high (not really fatal anyway),
and bump the version to 0.75.0

------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Jan  7 12:28:52 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon,  7 Jan 2013 12:28:52 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130107112852.B1FD240065@mail.boekplan.nl>

------------------------------------------------------------------------
r4552 | taco | 2013-01-07 10:31:33 +0100 (Mon, 07 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luatex.c

attempt to get rid of assert() popup under mingw32

------------------------------------------------------------------------
r4553 | taco | 2013-01-07 11:02:31 +0100 (Mon, 07 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.w

fix 5.2 loadfile() (extra args)

------------------------------------------------------------------------
r4554 | taco | 2013-01-07 11:07:37 +0100 (Mon, 07 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.w

get rid of C89 warning

------------------------------------------------------------------------
r4555 | taco | 2013-01-07 11:22:28 +0100 (Mon, 07 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luatex.c

nicer solution for making the windows crash popup disappear

------------------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Thu Jan 10 00:55:24 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 10 Jan 2013 00:55:24 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
Message-ID: <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>

On Tue, Dec 25, 2012 at 9:25 PM, luigi scarso wrote:
> On Tue, Dec 25, 2012 at 9:17 PM, Patrick Gundlach wrote:
>>
>>>>
>>>> Can't create the Lua state.
>>>>
>>> Hm what format are you using ?
>>
>> non, I run luatex --ini --lua xxx.lua myfile.tex
> Which platform ?

For me: 64-bit Mac OS X.

> gdb luajittex
GNU gdb 6.3.50-20050815 (Apple version gdb-1752) (Sat Jan 28 03:02:46 UTC 2012)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "x86_64-apple-darwin"...Reading symbols for
shared libraries ... done

(gdb) r --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun"
--script context a.tex
Starting program: /Users/ConTeXt/tex/texmf-osx-64/bin/luajittex
--luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script
context a.tex
Reading symbols for shared libraries ++......................... done
Can't create the Lua state.

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0x0000000000000018
0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
87	  if (size > LUAI_MAXCSTACK || (L->top - L->base + size) > LUAI_MAXCSTACK) {
(gdb) backtrace
#0  0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
#1  0x00000001002e8b75 in luaL_checkstack (L=0x0, size=9,
msg=0x100869811 "too many arguments to script") at lj_api.c:97
#2  0x00000001000b80fd in lua_initialize (ac=6, av=0x7fff5fbffa08) at
luainit.w:856
#3  0x00000001000022a0 in main (ac=6, av=0x7fff5fbffa08) at luatex.c:468
(gdb)

The problem seems to be around
   lj_alloc_create () at lj_alloc.c:1134
1134	  tbase = (char *)(CALL_MMAP(tsize));
(gdb) step
CALL_MMAP [inlined] () at
/Users/ConTeXt/luajittex/buildjit/libs/luajit/luajit-build/src/lj_alloc.c:208
...
222	    void *p = mmap((void *)alloc_hint, size, MMAP_PROT, MMAP_FLAGS, -1, 0);
(gdb) p p
$13 = (void *) 0x1010af000
...
235	  return CMFAIL;
...
1135	  if (tbase != CMFAIL) {
(gdb) p tbase
$18 = 0xffffffffffffffff <Address 0xffffffffffffffff out of bounds>


Possibly related post: http://lua-users.org/lists/lua-l/2012-03/msg00656.html

Mojca

From luigi.scarso at gmail.com  Thu Jan 10 01:40:44 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 01:40:44 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
Message-ID: <CAG5iGsDBPyDBj9Snj8HGR66FaJKPjxsg39Mbnta7nUcVpaRpyA@mail.gmail.com>

On Thu, Jan 10, 2013 at 12:55 AM, Mojca Miklavec
<mojca.miklavec.lists at gmail.com> wrote:
> On Tue, Dec 25, 2012 at 9:25 PM, luigi scarso wrote:
>> On Tue, Dec 25, 2012 at 9:17 PM, Patrick Gundlach wrote:
>>>
>>>>>
>>>>> Can't create the Lua state.
>>>>>
>>>> Hm what format are you using ?
>>>
>>> non, I run luatex --ini --lua xxx.lua myfile.tex
>> Which platform ?
>
> For me: 64-bit Mac OS X.
>
>> gdb luajittex
> GNU gdb 6.3.50-20050815 (Apple version gdb-1752) (Sat Jan 28 03:02:46 UTC 2012)
> Copyright 2004 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "x86_64-apple-darwin"...Reading symbols for
> shared libraries ... done
>
> (gdb) r --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun"
> --script context a.tex
> Starting program: /Users/ConTeXt/tex/texmf-osx-64/bin/luajittex
> --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script
> context a.tex
> Reading symbols for shared libraries ++......................... done
> Can't create the Lua state.
>
> Program received signal EXC_BAD_ACCESS, Could not access memory.
> Reason: KERN_INVALID_ADDRESS at address: 0x0000000000000018
> 0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
> 87        if (size > LUAI_MAXCSTACK || (L->top - L->base + size) > LUAI_MAXCSTACK) {
> (gdb) backtrace
> #0  0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
> #1  0x00000001002e8b75 in luaL_checkstack (L=0x0, size=9,
> msg=0x100869811 "too many arguments to script") at lj_api.c:97
> #2  0x00000001000b80fd in lua_initialize (ac=6, av=0x7fff5fbffa08) at
> luainit.w:856
> #3  0x00000001000022a0 in main (ac=6, av=0x7fff5fbffa08) at luatex.c:468
> (gdb)
>
> The problem seems to be around
>    lj_alloc_create () at lj_alloc.c:1134
> 1134      tbase = (char *)(CALL_MMAP(tsize));
> (gdb) step
> CALL_MMAP [inlined] () at
> /Users/ConTeXt/luajittex/buildjit/libs/luajit/luajit-build/src/lj_alloc.c:208
> ...
> 222         void *p = mmap((void *)alloc_hint, size, MMAP_PROT, MMAP_FLAGS, -1, 0);
> (gdb) p p
> $13 = (void *) 0x1010af000
> ...
> 235       return CMFAIL;
> ...
> 1135      if (tbase != CMFAIL) {
> (gdb) p tbase
> $18 = 0xffffffffffffffff <Address 0xffffffffffffffff out of bounds>
>
>
> Possibly related post: http://lua-users.org/lists/lua-l/2012-03/msg00656.html
I see ... not a simple problem.




--
luigi

From mojca.miklavec.lists at gmail.com  Thu Jan 10 01:41:40 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 10 Jan 2013 01:41:40 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
Message-ID: <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>

On Thu, Jan 10, 2013 at 12:55 AM, Mojca Miklavec wrote:
> On Tue, Dec 25, 2012 at 9:25 PM, luigi scarso wrote:
>> On Tue, Dec 25, 2012 at 9:17 PM, Patrick Gundlach wrote:
>>>
>>>>>
>>>>> Can't create the Lua state.
>>>>>
>>>> Hm what format are you using ?
>>>
>>> non, I run luatex --ini --lua xxx.lua myfile.tex
>> Which platform ?
>
> For me: 64-bit Mac OS X.
>
>> gdb luajittex
> GNU gdb 6.3.50-20050815 (Apple version gdb-1752) (Sat Jan 28 03:02:46 UTC 2012)
> Copyright 2004 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "x86_64-apple-darwin"...Reading symbols for
> shared libraries ... done
>
> (gdb) r --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun"
> --script context a.tex
> Starting program: /Users/ConTeXt/tex/texmf-osx-64/bin/luajittex
> --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script
> context a.tex
> Reading symbols for shared libraries ++......................... done
> Can't create the Lua state.
>
> Program received signal EXC_BAD_ACCESS, Could not access memory.
> Reason: KERN_INVALID_ADDRESS at address: 0x0000000000000018
> 0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
> 87        if (size > LUAI_MAXCSTACK || (L->top - L->base + size) > LUAI_MAXCSTACK) {
> (gdb) backtrace
> #0  0x00000001002e8a8d in lua_checkstack (L=0x0, size=9) at lj_api.c:87
> #1  0x00000001002e8b75 in luaL_checkstack (L=0x0, size=9,
> msg=0x100869811 "too many arguments to script") at lj_api.c:97
> #2  0x00000001000b80fd in lua_initialize (ac=6, av=0x7fff5fbffa08) at
> luainit.w:856
> #3  0x00000001000022a0 in main (ac=6, av=0x7fff5fbffa08) at luatex.c:468
> (gdb)
>
> The problem seems to be around
>    lj_alloc_create () at lj_alloc.c:1134
> 1134      tbase = (char *)(CALL_MMAP(tsize));
> (gdb) step
> CALL_MMAP [inlined] () at
> /Users/ConTeXt/luajittex/buildjit/libs/luajit/luajit-build/src/lj_alloc.c:208
> ...
> 222         void *p = mmap((void *)alloc_hint, size, MMAP_PROT, MMAP_FLAGS, -1, 0);
> (gdb) p p
> $13 = (void *) 0x1010af000

This number (p) seems way behind "if ((uintptr_t)p + size <
MMAP_REGION_END)" where MMAP_REGION_END points to
((uintptr_t)0x80000000).


I have found a partial solution:

Following these instructions:

#elif LJ_TARGET_OSX || defined(__FreeBSD__) ||
defined(__FreeBSD_kernel__) || defined(__OpenBSD__)

/* OSX and FreeBSD mmap() use a naive first-fit linear search.
** That's perfect for us. Except that -pagezero_size must be set for OSX,
** otherwise the lower 4GB are blocked. And the 32GB RLIMIT_DATA needs
** to be reduced to 250MB on FreeBSD.
*/


export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
./buildjit.sh --debug


The code now initialises properly and only breaks much later on at


> luajittex --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script context a.tex

mtx-context     | run 1: luatex
--fmt="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en"
--jobname="a" --lua="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en.lui"
--no-parse-first-line --c:currentrun=1 --c:fulljobname="./a.tex"
--c:input="./a.tex" --c:kindofrun=1 "cont-yes.mkiv"
This is LuaTeX, Version beta-0.74.0-2012122517 (rev 4541)
 \write18 enabled.
This went wrong:
...0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en.lui:107: bad
bytecode register
.
<*>
    cont-yes.mkiv
?

That one needs further inspection (which I'm probably not going to do
right now).

Mojca

From luigi.scarso at gmail.com  Thu Jan 10 01:51:29 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 01:51:29 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
Message-ID: <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>

On Thu, Jan 10, 2013 at 1:41 AM, Mojca Miklavec
<mojca.miklavec.lists at gmail.com> wrote:
> On Thu, Jan 10, 2013 at 12:55 AM, Mojca Miklavec wrote:
> I have found a partial solution:
>
> Following these instructions:
>
> #elif LJ_TARGET_OSX || defined(__FreeBSD__) ||
> defined(__FreeBSD_kernel__) || defined(__OpenBSD__)
>
> /* OSX and FreeBSD mmap() use a naive first-fit linear search.
> ** That's perfect for us. Except that -pagezero_size must be set for OSX,
> ** otherwise the lower 4GB are blocked. And the 32GB RLIMIT_DATA needs
> ** to be reduced to 250MB on FreeBSD.
> */
>
>
> export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
> ./buildjit.sh --debug
I suggest  to build the stock luajit , (see
http://lua-users.org/lists/lua-l/2012-03/msg00756.html
)
if it works than it's a problem of luajittex, otherwise of luajit.




>
>
> The code now initialises properly and only breaks much later on at
>
>
>> luajittex --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script context a.tex
>
> mtx-context     | run 1: luatex
> --fmt="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en"
> --jobname="a" --lua="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en.lui"
> --no-parse-first-line --c:currentrun=1 --c:fulljobname="./a.tex"
> --c:input="./a.tex" --c:kindofrun=1 "cont-yes.mkiv"
> This is LuaTeX, Version beta-0.74.0-2012122517 (rev 4541)
^^^^^^^^^^^^^^^
Why LuaTeX ?

--
luigi

From mojca.miklavec.lists at gmail.com  Thu Jan 10 02:45:01 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 10 Jan 2013 02:45:01 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
Message-ID: <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>

On Thu, Jan 10, 2013 at 1:51 AM, luigi scarso wrote:
> On Thu, Jan 10, 2013 at 1:41 AM, Mojca Miklavec wrote:
>> On Thu, Jan 10, 2013 at 12:55 AM, Mojca Miklavec wrote:
>> I have found a partial solution:
>>
>> Following these instructions:
>>
>> #elif LJ_TARGET_OSX || defined(__FreeBSD__) ||
>> defined(__FreeBSD_kernel__) || defined(__OpenBSD__)
>>
>> /* OSX and FreeBSD mmap() use a naive first-fit linear search.
>> ** That's perfect for us. Except that -pagezero_size must be set for OSX,
>> ** otherwise the lower 4GB are blocked. And the 32GB RLIMIT_DATA needs
>> ** to be reduced to 250MB on FreeBSD.
>> */
>>
>>
>> export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
>> ./buildjit.sh --debug
> I suggest  to build the stock luajit , (see
> http://lua-users.org/lists/lua-l/2012-03/msg00756.html
> )
> if it works than it's a problem of luajittex, otherwise of luajit.

I don't know how to properly test luajit. Simple lua scripts run fine.
I suspect that it's really about missing LDFLAGS in LuaJITTeX (or
about changing the code upstream in such a way that those flags
wouldn't be required ;).

>>> luajittex --luaonly "/Users/ConTeXt/tex/texmf-osx-64/bin/mtxrun" --script context a.tex
>>
>> mtx-context     | run 1: luatex
>> --fmt="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en"
>> --jobname="a" --lua="/Users/ConTeXt/tex/texmf-cache/luatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luajittex/cont-en.lui"
>> --no-parse-first-line --c:currentrun=1 --c:fulljobname="./a.tex"
>> --c:input="./a.tex" --c:kindofrun=1 "cont-yes.mkiv"
>> This is LuaTeX, Version beta-0.74.0-2012122517 (rev 4541)
> ^^^^^^^^^^^^^^^
> Why LuaTeX ?

I'm sorry and thanks for pointing it out. My bad. I only copy-pasted
part of the command (starting with "luajittex") for debugging
purposes. I now tried again with "context a.tex" and it seems to work
properly. So it seems that
    export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
solves the problem completely, at least on hello-world documents. But
those two flags should probably be added by default then?

Mojca

From luigi.scarso at gmail.com  Thu Jan 10 08:29:13 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 08:29:13 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
Message-ID: <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>

On Thu, Jan 10, 2013 at 2:45 AM, Mojca Miklavec
<mojca.miklavec.lists at gmail.com> wrote:
>  So it seems that
>     export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
> solves the problem completely, at least on hello-world documents. But
> those two flags should probably be added by default then?
>

Could be. These flags are already set only for Darwin x64 in the
Makefile  and if you match this configuration than
maybe you can
export LDFLAGS=" -pagezero_size 10000 -image_base 100000000"
and build the binary. And let's see if it fails again.


--
luigi

From patrick at gundla.ch  Thu Jan 10 16:26:23 2013
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 10 Jan 2013 16:26:23 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
Message-ID: <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>

Luigi, 

this looks very promising!!! I've been able to run a simple document with my publisher with it. Great.

Just a question: there seems to be a new bit library included, right? Is this documented anywhere? Is the library itself documented?

It has these functions:

bit = {
  ["rol"] = "function: builtin#71"
  ["rshift"] = "function: builtin#69"
  ["ror"] = "function: builtin#72"
  ["bswap"] = "function: builtin#67"
  ["bxor"] = "function: builtin#75"
  ["bor"] = "function: builtin#74"
  ["arshift"] = "function: builtin#70"
  ["bnot"] = "function: builtin#66"
  ["tobit"] = "function: builtin#65"
  ["lshift"] = "function: builtin#68"
  ["tohex"] = "function: builtin#76"
  ["band"] = "function: builtin#73"
}


Patrick

From minux.ma at gmail.com  Thu Jan 10 16:30:26 2013
From: minux.ma at gmail.com (minux)
Date: Thu, 10 Jan 2013 23:30:26 +0800
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
Message-ID: <CA+db=n0OvhfZvztgjE2GepMGga3fuo+HHeO3HBD=29b0y9F+Qw@mail.gmail.com>

On Thu, Jan 10, 2013 at 11:26 PM, Patrick Gundlach <patrick at gundla.ch>wrote:

> Luigi,
>
> this looks very promising!!! I've been able to run a simple document with
> my publisher with it. Great.
>
> Just a question: there seems to be a new bit library included, right? Is
> this documented anywhere? Is the library itself documented?
>
> It has these functions:
>
> bit = {
>   ["rol"] = "function: builtin#71"
>   ["rshift"] = "function: builtin#69"
>   ["ror"] = "function: builtin#72"
>   ["bswap"] = "function: builtin#67"
>   ["bxor"] = "function: builtin#75"
>   ["bor"] = "function: builtin#74"
>   ["arshift"] = "function: builtin#70"
>   ["bnot"] = "function: builtin#66"
>   ["tobit"] = "function: builtin#65"
>   ["lshift"] = "function: builtin#68"
>   ["tohex"] = "function: builtin#76"
>   ["band"] = "function: builtin#73"
> }
>
http://luajit.org/extensions.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20130110/2470aef2/attachment.html>

From patrick at gundla.ch  Thu Jan 10 16:32:53 2013
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 10 Jan 2013 16:32:53 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CA+db=n0OvhfZvztgjE2GepMGga3fuo+HHeO3HBD=29b0y9F+Qw@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch> <CA+db=n0OvhfZvztgjE2G!
 epMGga3fuo+HHeO3HBD=29b0y9F+Qw@mail.gmail.com>
Message-ID: <2268887E-1AA2-46A7-9DA9-74E8A641EE92@gundla.ch>

> 

> http://luajit.org/extensions.html 


perfect, thanks

Patrick


From luigi.scarso at gmail.com  Thu Jan 10 16:53:58 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 16:53:58 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CA+db=n0OvhfZvztgjE2GepMGga3fuo+HHeO3HBD=29b0y9F+Qw@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
 <CA+db=n0OvhfZvztgjE2GepMGga3fuo+HHeO3HBD=29b0y9F+Qw@mail.gmail.com>
Message-ID: <CAG5iGsDxjwKgB+nEkOyQ3oaPKyhnWgjCkWcmeubFQBb0hP44Ww@mail.gmail.com>

On Thu, Jan 10, 2013 at 4:30 PM, minux <minux.ma at gmail.com> wrote:
>
>
> On Thu, Jan 10, 2013 at 11:26 PM, Patrick Gundlach <patrick at gundla.ch>
> wrote:
>>
>> Luigi,
>>
>> this looks very promising!!! I've been able to run a simple document with
>> my publisher with it. Great.
>>
>> Just a question: there seems to be a new bit library included, right? Is
>> this documented anywhere? Is the library itself documented?
>>
>> It has these functions:
>>
>> bit = {
>>   ["rol"] = "function: builtin#71"
>>   ["rshift"] = "function: builtin#69"
>>   ["ror"] = "function: builtin#72"
>>   ["bswap"] = "function: builtin#67"
>>   ["bxor"] = "function: builtin#75"
>>   ["bor"] = "function: builtin#74"
>>   ["arshift"] = "function: builtin#70"
>>   ["bnot"] = "function: builtin#66"
>>   ["tobit"] = "function: builtin#65"
>>   ["lshift"] = "function: builtin#68"
>>   ["tohex"] = "function: builtin#76"
>>   ["band"] = "function: builtin#73"
>> }
>
> http://luajit.org/extensions.html
This is the standard bit library of luajit
but there is also bit32
Why two bit library ?
bit32 is the bit lib of lua5.2, so it helps the programmer

You can check bit32 with the following code (from H. Hagen).
Please, note that I've not checked that  the bit
gives the same results -- but I would like to know, of course.



print("testing bitwise operations")

assert(bit32.band() == bit32.bnot(0))
assert(bit32.btest() == true)
assert(bit32.bor() == 0)
assert(bit32.bxor() == 0)

assert(bit32.band() == bit32.band(0xffffffff))
assert(bit32.band(1,2) == 0)


-- out-of-range numbers
assert(bit32.band(-1) == 0xffffffff)
assert(bit32.band(2^33 - 1) == 0xffffffff)
assert(bit32.band(-2^33 - 1) == 0xffffffff)
assert(bit32.band(2^33 + 1) == 1)
assert(bit32.band(-2^33 + 1) == 1)
assert(bit32.band(-2^40) == 0)
assert(bit32.band(2^40) == 0)
assert(bit32.band(-2^40 - 2) == 0xfffffffe)
assert(bit32.band(2^40 - 4) == 0xfffffffc)

assert(bit32.lrotate(0, -1) == 0)
assert(bit32.lrotate(0, 7) == 0)
assert(bit32.lrotate(0x12345678, 4) == 0x23456781)
assert(bit32.rrotate(0x12345678, -4) == 0x23456781)
assert(bit32.lrotate(0x12345678, -8) == 0x78123456)
assert(bit32.rrotate(0x12345678, 8) == 0x78123456)
assert(bit32.lrotate(0xaaaaaaaa, 2) == 0xaaaaaaaa)
assert(bit32.lrotate(0xaaaaaaaa, -2) == 0xaaaaaaaa)
for i = -50, 50 do
  assert(bit32.lrotate(0x89abcdef, i) == bit32.lrotate(0x89abcdef, i%32))
end

assert(bit32.lshift(0x12345678, 4) == 0x23456780)
assert(bit32.lshift(0x12345678, 8) == 0x34567800)
assert(bit32.lshift(0x12345678, -4) == 0x01234567)
assert(bit32.lshift(0x12345678, -8) == 0x00123456)
assert(bit32.lshift(0x12345678, 32) == 0)
assert(bit32.lshift(0x12345678, -32) == 0)
assert(bit32.rshift(0x12345678, 4) == 0x01234567)
assert(bit32.rshift(0x12345678, 8) == 0x00123456)
assert(bit32.rshift(0x12345678, 32) == 0)
assert(bit32.rshift(0x12345678, -32) == 0)
assert(bit32.arshift(0x12345678, 0) == 0x12345678)
assert(bit32.arshift(0x12345678, 1) == 0x12345678 / 2)
assert(bit32.arshift(0x12345678, -1) == 0x12345678 * 2)
assert(bit32.arshift(-1, 1) == 0xffffffff)
assert(bit32.arshift(-1, 24) == 0xffffffff)
assert(bit32.arshift(-1, 32) == 0xffffffff)
assert(bit32.arshift(-1, -1) == (-1 * 2) % 2^32)

print("+")
-- some special cases
local c = {0, 1, 2, 3, 10, 0x80000000, 0xaaaaaaaa, 0x55555555,
           0xffffffff, 0x7fffffff}

for _, b in pairs(c) do
  assert(bit32.band(b) == b)
  assert(bit32.band(b, b) == b)
  assert(bit32.btest(b, b) == (b ~= 0))
  assert(bit32.band(b, b, b) == b)
  assert(bit32.btest(b, b, b) == (b ~= 0))
  assert(bit32.band(b, bit32.bnot(b)) == 0)
  assert(bit32.bor(b, bit32.bnot(b)) == bit32.bnot(0))
  assert(bit32.bor(b) == b)
  assert(bit32.bor(b, b) == b)
  assert(bit32.bor(b, b, b) == b)
  assert(bit32.bxor(b) == b)
  assert(bit32.bxor(b, b) == 0)
  assert(bit32.bxor(b, 0) == b)
  assert(bit32.bnot(b) ~= b)
  assert(bit32.bnot(bit32.bnot(b)) == b)
  assert(bit32.bnot(b) == 2^32 - 1 - b)
  assert(bit32.lrotate(b, 32) == b)
  assert(bit32.rrotate(b, 32) == b)
  assert(bit32.lshift(bit32.lshift(b, -4), 4) == bit32.band(b, bit32.bnot(0xf)))
  assert(bit32.rshift(bit32.rshift(b, 4), -4) == bit32.band(b, bit32.bnot(0xf)))
  for i = -40, 40 do
    assert(bit32.lshift(b, i) == math.floor((b * 2^i) % 2^32))
  end
end

assert(not pcall(bit32.band, {}))
assert(not pcall(bit32.bnot, "a"))
assert(not pcall(bit32.lshift, 45))
assert(not pcall(bit32.lshift, 45, print))
assert(not pcall(bit32.rshift, 45, print))

print("+")


-- testing extract/replace

assert(bit32.extract(0x12345678, 0, 4) == 8)
assert(bit32.extract(0x12345678, 4, 4) == 7)
assert(bit32.extract(0xa0001111, 28, 4) == 0xa)
assert(bit32.extract(0xa0001111, 31, 1) == 1)
assert(bit32.extract(0x50000111, 31, 1) == 0)
assert(bit32.extract(0xf2345679, 0, 32) == 0xf2345679)

assert(not pcall(bit32.extract, 0, -1))
assert(not pcall(bit32.extract, 0, 32))
assert(not pcall(bit32.extract, 0, 0, 33))
assert(not pcall(bit32.extract, 0, 31, 2))

assert(bit32.replace(0x12345678, 5, 28, 4) == 0x52345678)
assert(bit32.replace(0x12345678, 0x87654321, 0, 32) == 0x87654321)
assert(bit32.replace(0, 1, 2) == 2^2)
assert(bit32.replace(0, -1, 4) == 2^4)
assert(bit32.replace(-1, 0, 31) == 2^31 - 1)
assert(bit32.replace(-1, 0, 1, 2) == 2^32 - 7)


print'OK'



--
luigi

From pragma at wxs.nl  Thu Jan 10 17:20:54 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 10 Jan 2013 17:20:54 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
Message-ID: <50EEEA66.6070807@wxs.nl>

On 1/10/2013 4:26 PM, Patrick Gundlach wrote:
> Luigi,
>
> this looks very promising!!! I've been able to run a simple document with my publisher with it. Great.
>
> Just a question: there seems to be a new bit library included, right? Is this documented anywhere? Is the library itself documented?
>
> It has these functions:
>
> bit = {
>    ["rol"] = "function: builtin#71"
>    ["rshift"] = "function: builtin#69"
>    ["ror"] = "function: builtin#72"
>    ["bswap"] = "function: builtin#67"
>    ["bxor"] = "function: builtin#75"
>    ["bor"] = "function: builtin#74"
>    ["arshift"] = "function: builtin#70"
>    ["bnot"] = "function: builtin#66"
>    ["tobit"] = "function: builtin#65"
>    ["lshift"] = "function: builtin#68"
>    ["tohex"] = "function: builtin#76"
>    ["band"] = "function: builtin#73"
> }

that one is different from the stock lua 5.2 bit32 library so we decided 
to add bit32 to luajittex as well as that is the standard

(bit32 is documented in the 5.2 manual, and bit on the luajit website)

some functions can be mapped onto the jit bit library (jit will optimize 
build in functions)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Thu Jan 10 18:22:49 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 18:22:49 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <50EEEA66.6070807@wxs.nl>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
 <50EEEA66.6070807@wxs.nl>
Message-ID: <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>

On Thu, Jan 10, 2013 at 5:20 PM, Hans Hagen <pragma at wxs.nl> wrote:
> On 1/10/2013 4:26 PM, Patrick Gundlach wrote:
>>
>> Luigi,
>>
>> this looks very promising!!! I've been able to run a simple document with
>> my publisher with it. Great.
Are you using clang or gcc ?
Did you checked some C module -- i.e. the binding for libxml ?
Remember that it's lua5.1 !!!

PS
the really fun for you is the ffi module...


--
luigi

From patrick at gundla.ch  Thu Jan 10 20:08:25 2013
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 10 Jan 2013 20:08:25 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch> <50EEEA66.6070807@wxs.!
 nl> <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>
Message-ID: <BED64617-0FB6-4911-8123-34005C4A0E5B@gundla.ch>


Am 10.01.2013 um 18:22 schrieb luigi scarso <luigi.scarso at gmail.com>:

> On Thu, Jan 10, 2013 at 5:20 PM, Hans Hagen <pragma at wxs.nl> wrote:
>> On 1/10/2013 4:26 PM, Patrick Gundlach wrote:
>>> 
>>> Luigi,
>>> 
>>> this looks very promising!!! I've been able to run a simple document with
>>> my publisher with it. Great.
> Are you using clang or gcc ?

Neither, I use Mac.

(Seriously: I have no idea - I guess I use gcc :)

$ type gcc
gcc is /usr/bin/gcc
$ type clang
clang is /usr/bin/clang

no mentioning of "clang" in ./buildjit.sh output



> Did you checked some C module -- i.e. the binding for libxml ?

not yet. I will need to make my publisher run with luajittex smoothly first. But I am lying in bed and unable to do serious work. 

> the really fun for you is the ffi module...


I've seen that :)

Patrick



From luigi.scarso at gmail.com  Thu Jan 10 22:50:38 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 10 Jan 2013 22:50:38 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <BED64617-0FB6-4911-8123-34005C4A0E5B@gundla.ch>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
 <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>
 <BED64617-0FB6-4911-8123-34005C4A0E5B@gundla.ch>
Message-ID: <CAG5iGsCAVyfznzqSE1OUK0L5X53uD_-sbSy1eTmgKO9KSv6fcg@mail.gmail.com>

On Thu, Jan 10, 2013 at 8:08 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> not yet. I will need to make my publisher run with luajittex smoothly first. But I am lying in bed and unable to do serious work.
sorry to stress you..
I've added a check of Darwin X86_64, so that the
export LDFLAGS=..
should be  not needed anymore.. can you check ?
(It assumes the gcc compiler)

--
luigi

From luigi.scarso at gmail.com  Fri Jan 11 18:29:56 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 11 Jan 2013 18:29:56 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsCAVyfznzqSE1OUK0L5X53uD_-sbSy1eTmgKO9KSv6fcg@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <3E35387F-4C81-4A7A-8ACD-8421D83BD920@gundla.ch>
 <CAG5iGsDS224o5bzq7TGJdvEd2S6YwnOvjVTvVgNCyT5oULPdgw@mail.gmail.com>
 <E5A4398E-E28B-4DE6-B2C9-8ECB072F5024@gundla.ch>
 <CAG5iGsCiXs1gpws_SWqh+3pcYwq89V6z5M0Zdc32XQkVg8G5Rg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
 <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>
 <BED64617-0FB6-4911-8123-34005C4A0E5B@gundla.ch>
 <CAG5iGsCAVyfznzqSE1OUK0L5X53uD_-sbSy1eTmgKO9KSv6fcg@mail.gmail.com>
Message-ID: <CAG5iGsBqBE71pnbLqWaNJL4+WtB0LQyROniTkkyY-j--qvRLyg@mail.gmail.com>

I've added the script
buildjit-clang.sh

I've checked under linux 64bit, and it works even if there are some
warnings on luajit. The performances are slightly different vs gcc
(gcc is better) but nothing of important.

I've not compiled  the MacOS X Intel x86_64, but there should be no
warnings on luajit.

So we have
buildjit.sh: Linux and Mac, gcc compiler. Under linux is better to use this one.

buildjit-clang.sh:Linux and Mac, clang compiler. Under MaCOS could the
default choice.





--
luigi

From pragma at wxs.nl  Fri Jan 11 19:04:42 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 11 Jan 2013 19:04:42 +0100
Subject: [Dev-luatex] Luajittex 0.72.0 announcement
In-Reply-To: <CAG5iGsBqBE71pnbLqWaNJL4+WtB0LQyROniTkkyY-j--qvRLyg@mail.gmail.com>
References: <CAG5iGsAKOC-qNiCLKY9e13hNFvLwLWccFOiTLnSWKKuMvdBhEg@mail.gmail.com>
 <CALBOmsbNSezD-E8=nwWZ95S2CaXpDwhMmVURQkDS3sp_PLc4Sw@mail.gmail.com>
 <CALBOmsZJnHAvXcC1UF5jKXtKgzEsE-Vj3drX5zvx1y=cZztt-w@mail.gmail.com>
 <CAG5iGsAg5F00riFFArykB1HLh7Bo8raf3BYgegk1yc4eZev7qQ@mail.gmail.com>
 <CALBOmsZct98B3pCk_q=qWaZ5MKxTPwU2chvfw51-AvLcc50ZiQ@mail.gmail.com>
 <CAG5iGsBupS7tG2Jio8jMTGAodVLz-DL1iQ7s-AHnz7-yGuby=Q@mail.gmail.com>
 <D5284085-EB70-4932-885D-4230198C83CA@gundla.ch>
 <CAG5iGsDDAMZNvgQDht4kmCDkk27MV4sr1c8SSGfP5cpi9WAxyw@mail.gmail.com>
 <CAG5iGsCEHEhG3=OZXmhcmc_zDBYnxH-CyOsitEH36yMeNxxmfw@mail.gmail.com>
 <CAG5iGsA2FJgJ8KzYiqaZXC3fuVOCixB4+3C8K_AYmNkmOfyNWA@mail.gmail.com>
 <8CE4E363-40A3-430D-9365-0F0FB48C6899@gundla.ch>
 <CAG5iGsBBjbcZR3TSk0NG_OL7A5kTr5-x0PZ5P=VzTETCo-BXOw@mail.gmail.com>
 <BED64617-0FB6-4911-8123-34005C4A0E5B@gundla.ch>
 <CAG5iGsCAVyfznzqSE1OUK0L5X53uD_-sbSy1eTmgKO9KSv6fcg@mail.gmail.com>
 <CAG5iGsBqBE71pnbLqWaNJL4+WtB0LQyROniTkkyY-j--qvRLyg@mail.gmail.com>
Message-ID: <50F0543A.1000206@wxs.nl>

On 1/11/2013 6:29 PM, luigi scarso wrote:
> I've added the script
> buildjit-clang.sh
>
> I've checked under linux 64bit, and it works even if there are some
> warnings on luajit. The performances are slightly different vs gcc
> (gcc is better) but nothing of important.

btw, we measured just a few % slower processing on our benchmarks so 
it's neglectable, but then: using -O3 on gcc is also faster so speed is 
hard to define

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From blflatex at gmail.com  Sun Jan 13 20:48:49 2013
From: blflatex at gmail.com (Bruno Le Floch)
Date: Sun, 13 Jan 2013 20:48:49 +0100
Subject: [Dev-luatex] LuaTeX segfaults on invalid UTF-8 csnames
Message-ID: <CANQYN6z6iw4ROOSJaG3gQqPgMj_KTCuVJQ764opXYq7Kr470sA@mail.gmail.com>

Hello,

LuaTeX doesn't segfault on invalid UTF-8 appearing in a file: this
simply leads to a fatal error.  However, one can build invalid UTF-8
using the bytes ^^^^^^110000 to ^^^^^^1100ff.  If one builds a control
sequence whose name is invalid UTF-8, then try to convert this
sequence to a string, LuaTeX segfaults.  Namely, both

    \expandafter\string\csname ^^^^^^1100ff\endcsname

and

    \number\expandafter`\csname ^^^^^^1100ff\endcsname

make LuaTeX segfault, but

    \edef\foo{\csname ^^^^^^1100ff\endcsname}
    \show\foo

does not (even though the invalid UTF-8 name is written to the terminal).

Regards,
Bruno

From taco at elvenkind.com  Mon Jan 14 09:58:41 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Jan 2013 09:58:41 +0100
Subject: [Dev-luatex] LuaTeX segfaults on invalid UTF-8 csnames
In-Reply-To: <CANQYN6z6iw4ROOSJaG3gQqPgMj_KTCuVJQ764opXYq7Kr470sA@mail.gmail.com>
References: <CANQYN6z6iw4ROOSJaG3gQqPgMj_KTCuVJQ764opXYq7Kr470sA@mail.gmail.com>
Message-ID: <50F3C8C1.5070907@elvenkind.com>

On 01/13/2013 08:48 PM, Bruno Le Floch wrote:
> Hello,
>
> LuaTeX doesn't segfault on invalid UTF-8 appearing in a file: this
> simply leads to a fatal error.  However, one can build invalid UTF-8
> using the bytes ^^^^^^110000 to ^^^^^^1100ff.  If one builds a control
> sequence whose name is invalid UTF-8, then try to convert this
> sequence to a string, LuaTeX segfaults.  Namely, both  ...

Thanks for the report. Tracker item added:

    http://tracker.luatex.org/view.php?id=802

Best wishes,
Taco



From root at mail.boekplan.nl  Tue Jan 15 22:28:13 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 15 Jan 2013 22:28:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130115212814.031E040065@mail.boekplan.nl>

------------------------------------------------------------------------
r4556 | oneiros | 2013-01-15 18:52:48 +0100 (Tue, 15 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

fix lfs

------------------------------------------------------------------------

From patrick at gundla.ch  Wed Jan 16 14:47:30 2013
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 16 Jan 2013 14:47:30 +0100
Subject: [Dev-luatex] Strange font error
Message-ID: <5DD1365A-A768-4BB5-9C73-A898727CB815@gundla.ch>

Hi all,

I get this strange font error under windows:

node_mem_usage=4895 hlist, 9572 vlist, 13496 glue, 504 kern, 5414 penalty, 48873 glyph, 26463 attribute, 8430 glue_spec, 26460 attribute_list, 1 dir, 3 pdf_refximage
luastate_bytes=116913 )
(see the transcript file for additional information)<C:\Users\.../share/fonts/texgyreheros/texgyreheros-regular.otf
!LuaTeX error (file C:\Users\.../share/fonts/texgyreheros/texgyreheros-regular.otf): Parsing CFF DICT failed. (error=-1)
==> Fatal error occurred, no output PDF file produced!

Has anyone any idea what could be raise a "Parsing CFF DICT failed" error? I cannot reproduce this using Linux.

Patrick

(No, I am unable to reproduce this using regular Lua(La)TeX)


From fabrice.popineau at supelec.fr  Fri Jan 18 09:26:00 2013
From: fabrice.popineau at supelec.fr (Fabrice Popineau)
Date: Fri, 18 Jan 2013 09:26:00 +0100
Subject: [Dev-luatex] Question about LuaTeX
Message-ID: <CAFgFV9MEDp9n+69t3mY_kbqiReH8sy3Zwkhpc9rJvkiPiyf3ig@mail.gmail.com>

I forward this question here:
http://tex.stackexchange.com/questions/94297/are-xetex-and-luatex-platform-dependent


-- 
Fabrice
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20130118/28e78232/attachment.html>

From blflatex at gmail.com  Sat Jan 19 12:01:51 2013
From: blflatex at gmail.com (Bruno Le Floch)
Date: Sat, 19 Jan 2013 12:01:51 +0100
Subject: [Dev-luatex] LuaTeX segfaults on invalid UTF-8 csnames
In-Reply-To: <50F3C8C1.5070907@elvenkind.com>
References: <CANQYN6z6iw4ROOSJaG3gQqPgMj_KTCuVJQ764opXYq7Kr470sA@mail.gmail.com>
 <50F3C8C1.5070907@elvenkind.com>
Message-ID: <CANQYN6wTZaSLFF7Pqytbj4izn6pcEZQ2K3Xa7Bck6_vyefV7TQ@mail.gmail.com>

On 1/14/13, Taco Hoekwater <taco at elvenkind.com> wrote:
> On 01/13/2013 08:48 PM, Bruno Le Floch wrote:
>> Hello,
>>
>> LuaTeX doesn't segfault on invalid UTF-8 appearing in a file: this
>> simply leads to a fatal error.  However, one can build invalid UTF-8
>> using the bytes ^^^^^^110000 to ^^^^^^1100ff.  If one builds a control
>> sequence whose name is invalid UTF-8, then try to convert this
>> sequence to a string, LuaTeX segfaults.  Namely, both  ...
>
> Thanks for the report. Tracker item added:
>
>     http://tracker.luatex.org/view.php?id=802
>
> Best wishes,
> Taco

I should've done that.  Thanks.
Regards,
Bruno

From root at mail.boekplan.nl  Sat Jan 19 12:28:38 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 19 Jan 2013 12:28:38 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130119112838.6B4B840C7C@mail.boekplan.nl>

------------------------------------------------------------------------
r4557 | oneiros | 2013-01-19 00:24:21 +0100 (Sat, 19 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h

fix lfs

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Jan 19 16:28:00 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 19 Jan 2013 16:28:00 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130119152800.A1D6640065@mail.boekplan.nl>

------------------------------------------------------------------------
r4558 | oneiros | 2013-01-19 15:21:59 +0100 (Sat, 19 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h

fix lfs :-{

------------------------------------------------------------------------

From khaledhosny at eglug.org  Sat Jan 19 18:00:14 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 19 Jan 2013 19:00:14 +0200
Subject: [Dev-luatex] [luatex] tex.extraprimitives() and Umath primitives
In-Reply-To: <50ED9966.1060102@elvenkind.com>
References: <20130109143747.GA19289@khaled-laptop>
 <50ED9966.1060102@elvenkind.com>
Message-ID: <20130119170014.GA12680@khaled-laptop>

On Wed, Jan 09, 2013 at 05:23:02PM +0100, Taco Hoekwater wrote:
> On 01/09/2013 03:37 PM, Khaled Hosny wrote:
> >Hi all,
> >
> >Is there a way for tex.extraprimitives() to return only Unicode math
> >primitives? I think not, but I thought to ask anyway.
> 
> No, sorry.

OK, what about the attached patch?

Regards,
Khaled
-------------- next part --------------
A non-text attachment was scrubbed...
Name: extraprimitives_umath.diff
Type: text/x-diff
Size: 28999 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20130119/75e4f537/attachment-0001.diff>

From root at mail.boekplan.nl  Sun Jan 20 22:28:23 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 20 Jan 2013 22:28:23 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130120212823.DEA0940065@mail.boekplan.nl>

------------------------------------------------------------------------
r4559 | hhenkel | 2013-01-20 20:58:26 +0100 (Sun, 20 Jan 2013) | 1 line
Changed paths:
   M /trunk/manual/fdata_epdf.lua
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

implement finding and saving of embedded files
------------------------------------------------------------------------
r4560 | hhenkel | 2013-01-20 21:19:01 +0100 (Sun, 20 Jan 2013) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

more EmbFile methods
------------------------------------------------------------------------

From taco at elvenkind.com  Mon Jan 21 10:01:55 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 21 Jan 2013 10:01:55 +0100
Subject: [Dev-luatex] [luatex] tex.extraprimitives() and Umath primitives
In-Reply-To: <20130119170014.GA12680@khaled-laptop>
References: <20130109143747.GA19289@khaled-laptop>
 <50ED9966.1060102@elvenkind.com> <20130119170014.GA12680@khaled-laptop>
Message-ID: <50FD0403.3050600@elvenkind.com>

On 01/19/2013 06:00 PM, Khaled Hosny wrote:
> On Wed, Jan 09, 2013 at 05:23:02PM +0100, Taco Hoekwater wrote:
>> On 01/09/2013 03:37 PM, Khaled Hosny wrote:
>>> Hi all,
>>>
>>> Is there a way for tex.extraprimitives() to return only Unicode math
>>> primitives? I think not, but I thought to ask anyway.
>>
>> No, sorry.
>
> OK, what about the attached patch?

Not sure. I am thinking perhaps it would be better if 'Umath' was
still also included in 'luatex', and technically that would be simple
by or-ing the options.

It would mean that lualatex would have some 80+ extra primitives
(\luatexUmath ... + \Umath...) which may be undesirable to some
people, but that also might help backward compatibility so I guess
that makes it a tie.

Best wishes,
Taco


From root at mail.boekplan.nl  Mon Jan 21 12:30:00 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 21 Jan 2013 12:30:00 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130121113001.6F6C240065@mail.boekplan.nl>

------------------------------------------------------------------------
r4561 | oneiros | 2013-01-20 22:28:09 +0100 (Sun, 20 Jan 2013) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/texluac.w

cleanup

------------------------------------------------------------------------
r4562 | khaled | 2013-01-21 03:58:59 +0100 (Mon, 21 Jan 2013) | 7 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatoken.w
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/commands.h
   M /trunk/source/texk/web2c/luatexdir/tex/commands.w
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.w
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.h
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.w
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.w
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.w

Remove a bunch of deprecated primitives

* \AlephVersion, \Alephrevision, \Alephversion, \Alephminorversion
* \OmegaVersion, \Omegarevision, \Omegaversion, \Omegaminorversion
* \omathcode, \odelcode, \omathchardef, \omathchar, \omathaccent,
  \odelimiter, \oradical
* \Umathbotaccent, \Umathaccents
------------------------------------------------------------------------
r4563 | khaled | 2013-01-21 04:22:53 +0100 (Mon, 21 Jan 2013) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.w
   M /trunk/source/texk/web2c/luatexdir/tex/errors.w
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.w
   M /trunk/source/texk/web2c/luatexdir/tex/printing.h
   M /trunk/source/texk/web2c/luatexdir/tex/printing.w

Goodbye slow_print(), too much of arch?\195?\166ology
------------------------------------------------------------------------

From khaledhosny at eglug.org  Mon Jan 21 14:38:23 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 21 Jan 2013 15:38:23 +0200
Subject: [Dev-luatex] [luatex] tex.extraprimitives() and Umath primitives
In-Reply-To: <50FD0403.3050600@elvenkind.com>
References: <20130109143747.GA19289@khaled-laptop>
 <50ED9966.1060102@elvenkind.com>
 <20130119170014.GA12680@khaled-laptop>
 <50FD0403.3050600@elvenkind.com>
Message-ID: <20130121133823.GA22428@khaled-laptop>

On Mon, Jan 21, 2013 at 10:01:55AM +0100, Taco Hoekwater wrote:
> On 01/19/2013 06:00 PM, Khaled Hosny wrote:
> >On Wed, Jan 09, 2013 at 05:23:02PM +0100, Taco Hoekwater wrote:
> >>On 01/09/2013 03:37 PM, Khaled Hosny wrote:
> >>>Hi all,
> >>>
> >>>Is there a way for tex.extraprimitives() to return only Unicode math
> >>>primitives? I think not, but I thought to ask anyway.
> >>
> >>No, sorry.
> >
> >OK, what about the attached patch?
> 
> Not sure. I am thinking perhaps it would be better if 'Umath' was
> still also included in 'luatex', and technically that would be simple
> by or-ing the options.

That makes more sense, so I did that and committed the patch.

> It would mean that lualatex would have some 80+ extra primitives
> (\luatexUmath ... + \Umath...) which may be undesirable to some
> people, but that also might help backward compatibility so I guess
> that makes it a tie.

I think the backward compatibility is a plus. TeX Live?s luatex.ini
duplicates the primitives already once prefixed and once not (but
lualatex.ini does not, and it is where the new functionality would be
useful).

Regards,
Khaled

From root at mail.boekplan.nl  Mon Jan 21 16:29:41 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 21 Jan 2013 16:29:41 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130121152941.86EA740065@mail.boekplan.nl>

------------------------------------------------------------------------
r4564 | khaled | 2013-01-21 14:25:53 +0100 (Mon, 21 Jan 2013) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/tex/commands.w
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.h

Support 'umath' in tex.extraprimitives()

So that formats can make \U* primitives unprefixed.
------------------------------------------------------------------------

From root at mail.boekplan.nl  Tue Jan 22 12:28:53 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 22 Jan 2013 12:28:53 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130122112854.1503F40065@mail.boekplan.nl>

------------------------------------------------------------------------
r4565 | hhenkel | 2013-01-21 22:40:47 +0100 (Mon, 21 Jan 2013) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

cosmetics
------------------------------------------------------------------------

From root at mail.boekplan.nl  Tue Jan 22 16:28:31 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 22 Jan 2013 16:28:31 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130122152831.CFDDD40065@mail.boekplan.nl>

------------------------------------------------------------------------
r4566 | khaled | 2013-01-22 14:18:15 +0100 (Tue, 22 Jan 2013) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w

Unused variable

Spotted by Akira Kakuto
------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Jan 27 16:28:09 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 27 Jan 2013 16:28:09 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130127152809.7985E40065@mail.boekplan.nl>

------------------------------------------------------------------------
r4567 | hhenkel | 2013-01-27 13:32:01 +0100 (Sun, 27 Jan 2013) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

cosmetics
------------------------------------------------------------------------
r4568 | hhenkel | 2013-01-27 14:10:11 +0100 (Sun, 27 Jan 2013) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

cosmetics
------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Jan 30 12:28:45 2013
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 30 Jan 2013 12:28:45 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20130130112845.8A40940065@mail.boekplan.nl>

------------------------------------------------------------------------
r4569 | taco | 2013-01-30 11:08:33 +0100 (Wed, 30 Jan 2013) | 6 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatex-api.h
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/directions.w

new version of lnodelib.c with speedups by Hans and Luigi.
Also: disable setting of ref_count fields from lua, and
reporting actual attempted field names in the cantset()
function, and disable setting of non-absolute dir styles
for objects where there cannot be direction ends.

------------------------------------------------------------------------

