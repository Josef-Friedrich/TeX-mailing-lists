From arthur.reutenauer at normalesup.org  Thu Jan  1 21:09:53 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 1 Jan 2009 21:09:53 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495A6D8B.6050601@pytex.org>
References: <495A6D8B.6050601@pytex.org>
Message-ID: <20090101200953.GO18156@phare.normalesup.org>

> As subject.  xdv is the eXtended DVi format used by XeTeX.

  Actually, it can.  LuaTeX produces DVI, which is perfectly palatable
to XeTeX's xdv2pdf and xdvipdfmx.  What features of xdv are you missing
in LuaTeX's output?

	Arthur

From jfine at pytex.org  Thu Jan  1 21:43:54 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 01 Jan 2009 20:43:54 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <20090101200953.GO18156@phare.normalesup.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
Message-ID: <495D2B0A.1070302@pytex.org>

Arthur Reutenauer wrote:
>> As subject.  xdv is the eXtended DVi format used by XeTeX.
> 
>   Actually, it can.  LuaTeX produces DVI, which is perfectly palatable
> to XeTeX's xdv2pdf and xdvipdfmx.  What features of xdv are you missing
> in LuaTeX's output?

Knuth and MacKay were the first to extent DVI, because it does not 
adequately support bidirectional typesetting.

Are you saying, Arthur, that
    Source to PDF using LuaTeX directly
can proceed via
    Source to DVI using LuaTeX
and then
    DVI to PDF using xdv2pdf (or some other tool)
?

I've been told (by Hans Hagen) that even for pdfTeX this is not advisable.

I'm looking for a what might be called a Unicode savvy Device 
Independent binary format.  And I'm looking for XeTeX and LuTeX to share 
code and ideas, when possible.

I'm copying Jonathan Kew (XeTeX's developer in on this).

-- 
Jonathan



From yannis.haralambous at telecom-bretagne.eu  Thu Jan  1 21:53:48 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Thu, 1 Jan 2009 21:53:48 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D2B0A.1070302@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
Message-ID: <C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>

the original DVI format already supports 4-byte character, what more  
Unicode-savviness do you need? Of course one should decide whether DVI  
should contain glyph indexes or Unicode codepoints.

Unless you mean by Unicode-savviness that one should have both glyph  
indexes and Unicode codepoints (I think that's what XeTeX is doing). A  
very bad approach since character and glyph correspondances are many- 
to-many.

On the other hand, if we use just glyph indexes in the DVI file then  
we can hardly do anything with it than print it (going to PDF will be  
difficult since the correspondance with characters is lost).

Le 1 janv. 09 ? 21:43, Jonathan Fine a ?crit :

> I'm looking for a what might be called a Unicode savvy Device  
> Independent binary format.  And I'm looking for XeTeX and LuTeX to  
> share code and ideas, when possible.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| TELECOM  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090101/4bed3cbb/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090101/4bed3cbb/attachment.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090101/4bed3cbb/attachment-0001.html>

From arthur.reutenauer at normalesup.org  Thu Jan  1 22:13:06 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 1 Jan 2009 22:13:06 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D2B0A.1070302@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
Message-ID: <20090101211306.GP18156@phare.normalesup.org>

> Knuth and MacKay were the first to extent DVI, because it does not 
> adequately support bidirectional typesetting.

  Yes, and, as I already tried to communicate to you, this extended
format (I assume you mean DVI-IVD) seems to me like a dead end, because
at the time it was developed, over twenty years ago, there was almost no
foundation for encoding bidirectional text; and it has never been
updated to take Unicode's bidi algorithm into account.

> Are you saying, Arthur, that
>    Source to PDF using LuaTeX directly
> can proceed via
>    Source to DVI using LuaTeX
> and then
>    DVI to PDF using xdv2pdf (or some other tool)
> ?

  Of course it can, depending on the information you put in your DVI.
If you've been attentive to the explanations I sent earlier to this list
about vertical typesetting, you'll know where it can fail.  In this
specific case, though, xdv's extensions would have been of no use at
all: we would need some further extensions of the DVI format.

> I've been told (by Hans Hagen) that even for pdfTeX this is not advisable.

  It certainly isn't advisable.  Nevertheless, in many cases, it's still
possible.

> I'm looking for a what might be called a Unicode savvy Device Independent 
> binary format.  And I'm looking for XeTeX and LuTeX to share code and 
> ideas, when possible.

  Hence, what you're aiming at is for LuaTeX and XeTeX to produce some
common extended DVI format, not for LuaTeX to produce xdv, right?  This
is quite different since, as I said above, LuaTeX has some features that
XeTeX's xdv can't account for.

> I'm copying Jonathan Kew (XeTeX's developer in on this).

  I know who Jonathan Kew is.

	Arthur

From chemoelectric at chemoelectric.org  Thu Jan  1 22:17:12 2009
From: chemoelectric at chemoelectric.org (Barry Schwartz)
Date: Thu, 1 Jan 2009 15:17:12 -0600
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D2B0A.1070302@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
Message-ID: <20090101211712.GA32639@crud.crud.mn.org>

Jonathan Fine <jfine at pytex.org> skribis:
> I'm looking for a what might be called a Unicode savvy Device Independent 
> binary format.  And I'm looking for XeTeX and LuTeX to share code and 
> ideas, when possible.

Glyph indexes plus a ToUnicode map. That's how Unicode-savviness is
done in a PDF: each glyph index is mapped to a Unicode string.

For my own hobby-work I have a slightly hacked xdvipdfmx that reads in
pre-computed ToUnicode maps (made with a FontForge script and put
side-by-side with the font files) in spots where xdvipdfmx wasn't
generating them. Really xdvipdfmx should be doing that on the fly. I
think all the necessary code is there--it already reads my
pre-computed maps and then generates a more efficient version,
magically--the code just needs to be called at the right times, but I
wasn't interested in working on it. (I'm disabled and have to ration
my keyboard time.)

However, LuaTeX should be perfectly capable of doing its own ToUnicode
maps.

Otherwise AFAIK the advantages of xdvipdfmx are that it's already
written, supports various specials, and can use the list of fonts that
is known to fontconfig (which isn't a big deal, and which LuaTeX could
just as easily do).


From jfine at pytex.org  Thu Jan  1 22:55:53 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 01 Jan 2009 21:55:53 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <20090101211306.GP18156@phare.normalesup.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<20090101211306.GP18156@phare.normalesup.org>
Message-ID: <495D3BE9.9040301@pytex.org>

Arthur Reutenauer wrote:

[snip]

>> I'm looking for a what might be called a Unicode savvy Device Independent 
>> binary format.  And I'm looking for XeTeX and LuTeX to share code and 
>> ideas, when possible.
> 
>   Hence, what you're aiming at is for LuaTeX and XeTeX to produce some
> common extended DVI format, not for LuaTeX to produce xdv, right?  This
> is quite different since, as I said above, LuaTeX has some features that
> XeTeX's xdv can't account for.

I think you've got the gist of what I want.  Sharing of code and ideas.

However, your statement seems to contradict your earlier statement 
(snipped) that one can do
     Source transformed by LuaTeX to DVI and hence PDF
and get the same result as
     Source transformed directly to PDF by LuaTeX

 From what you've said, it seems to me that xdv contains some but not 
all of the features that LuaTeX would need to add to the DVI format. 
Are there many such features?

>> I'm copying Jonathan Kew (XeTeX's developer in on this).
> 
>   I know who Jonathan Kew is.

Good.  I'd be surprised and worried if you didn't.  In fact, I know that 
you and he have probably met and, I hope, discussed some of these 
matters, because the three of us were all at TUG 2008 in Cork last year 
(yes, it is 2009 now).

But I put this statement in my message not for you but for others on 
this list who might not recall that Jonathan Kew is XeTeX's developer.

-- 
Jonathan

From jfine at pytex.org  Thu Jan  1 23:09:33 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 01 Jan 2009 22:09:33 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
Message-ID: <495D3F1D.3040909@pytex.org>

Yannis Haralambous wrote:

> the original DVI format already supports 4-byte character, what more 
> Unicode-savviness do you need? Of course one should decide whether DVI 
> should contain glyph indexes or Unicode codepoints.

I'd like bidirectional information to be available.

> Unless you mean by Unicode-savviness that one should have both glyph 
> indexes and Unicode codepoints (I think that's what XeTeX is doing). A 
> very bad approach since character and glyph correspondances are 
> many-to-many.
> 
> On the other hand, if we use just glyph indexes in the DVI file then we 
> can hardly do anything with it than print it (going to PDF will be 
> difficult since the correspondance with characters is lost).

Thank you for this, Yannis.

What I want is for LuaTeX and XeTeX to have a shared 'extended dvi 
format' which is suitable for print, for generating PDF and possibly 
other purposes.

And of course I'd like this format to be of at least satisfactory 
technical quality.

My (inexpert) understanding is that the Unicode code-point to glyph 
index mapping is a property of the font:
    http://www.microsoft.com/typography/otspec/cmap.htm

Yannis:  I admire both yourself and Jonathan Kew as experts in fonts, 
and so it worries me that you say that XeTeX is adopting a "very bad 
approach".

I'm copying this to Jonathan Kew.

-- 
Jonathan

From mojca.miklavec.lists at gmail.com  Thu Jan  1 23:20:31 2009
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 1 Jan 2009 23:20:31 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D3F1D.3040909@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
Message-ID: <6faad9f00901011420s12e4e0d4he223b8ca80603f86@mail.gmail.com>

On Thu, Jan 1, 2009 at 11:09 PM, Jonathan Fine wrote:
>
> What I want is for LuaTeX and XeTeX to have a shared 'extended dvi format'
> which is suitable for print, for generating PDF and possibly other purposes.

Just curious: how do you print xdv (what's wrong with printing pdf?)
and what other purposes do you (or would you) use xdv for?

Mojca

From dak at gnu.org  Thu Jan  1 23:27:43 2009
From: dak at gnu.org (David Kastrup)
Date: Thu, 01 Jan 2009 23:27:43 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D3F1D.3040909@pytex.org> (Jonathan Fine's message of "Thu, 01
	Jan 2009 22:09:33 +0000")
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
Message-ID: <85iqoywtk0.fsf@lola.goethe.zz>

Jonathan Fine <jfine at pytex.org> writes:

> Yannis Haralambous wrote:
>
>> the original DVI format already supports 4-byte character, what more
>> Unicode-savviness do you need? Of course one should decide whether
>> DVI should contain glyph indexes or Unicode codepoints.
>
> I'd like bidirectional information to be available.

Fundamentally DVI describes isolated graphemes on paper.  No sequence is
implied, no relation between glyphs, most certainly not directional.
Not even spaces are discernible, nor is it possible to rejoin hyphenated
words and/or line breaks or even do cut&paste except by heuristics.

So I don't think that the DVI format does not make for a sensible
starting point for embedding such information.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From dak at gnu.org  Thu Jan  1 23:34:38 2009
From: dak at gnu.org (David Kastrup)
Date: Thu, 01 Jan 2009 23:34:38 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <85iqoywtk0.fsf@lola.goethe.zz> (David Kastrup's message of "Thu, 
	01 Jan 2009 23:27:43 +0100")
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org> <85iqoywtk0.fsf@lola.goethe.zz>
Message-ID: <85abaawt8h.fsf@lola.goethe.zz>

David Kastrup <dak at gnu.org> writes:

> So I don't think that the DVI format does not make for a sensible
> starting point for embedding such information.

Read what I mean, not what I write.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From martin at oneiros.de  Fri Jan  2 00:09:03 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 2 Jan 2009 00:09:03 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D3F1D.3040909@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
Message-ID: <68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>

2009/1/1 Jonathan Fine <jfine at pytex.org>:
> What I want is for LuaTeX and XeTeX to have a shared 'extended dvi format'
> which is suitable for print, for generating PDF and possibly other purposes.

Thus loosing the benefits of directly producing PDF. I don't see many
benefits here.
But of course patches implementing this will be considered.

Best
   Martin

From pragma at wxs.nl  Fri Jan  2 09:58:20 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Jan 2009 09:58:20 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D3F1D.3040909@pytex.org>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495D2B0A.1070302@pytex.org>	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
Message-ID: <495DD72C.7050701@wxs.nl>

Jonathan Fine wrote:

> What I want is for LuaTeX and XeTeX to have a shared 'extended dvi 
> format' which is suitable for print, for generating PDF and possibly 
> other purposes.
> 
> And of course I'd like this format to be of at least satisfactory 
> technical quality.

Since luatex is mostly pdftex the code related to the backend is also 
interwoven with functionality (like annotations and objects etc). Most 
if that can be supported via the dvi route too but it's not always as 
efficient. Also, some functionality can be written in lua by parsing 
node lists etc.

Anyhow, it's on the agenda (2009-2010) to rewrite the backend code in 
such a way that more backend can be used (maybe written in lua). 
Although we want luatex to be backward compatible as much as possible 
(as long as it does not complicated the code), it might be that 
redesigning the interface between frontend and backend will lead to 
extensions to the dvi format (or we might as well decide that dvi 
supports only part of the frontend features); specials are always an 
escape at the cost of more macro package code.

So, it's not 'dvi' that sits in the middle of 'print and generating 
pdf', but dvi as one of the (traditional) output formats:

   luatex frontend -> api -> [dvi,pdf,...] [dvi->ps,pdf,...]

of course one can stil go the

   luatex frontend -> api -> [dvi+] [ps,pdf,...]

route then. As said: it's one of the longer term objectives. A quick and 
dirty non-introsve patch to produce xetex compatible dvi is no problem, 
but one never knows if it will stay that way.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Fri Jan  2 10:05:22 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 02 Jan 2009 10:05:22 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <20090101200953.GO18156@phare.normalesup.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
Message-ID: <495DD8D2.2060601@elvenkind.com>


Hi all,

Arthur Reutenauer wrote:
>> As subject.  xdv is the eXtended DVi format used by XeTeX.
> 
>   Actually, it can.  LuaTeX produces DVI, which is perfectly palatable
> to XeTeX's xdv2pdf and xdvipdfmx.  What features of xdv are you missing
> in LuaTeX's output?

As Barry said in another message, ToUnicode information would be
useful. It is true that every DVI is also XDV, but not every XDV
is DVI, and (some of) XeTeX's extensions would be nice to have if
they can be integrated without too much effort.

When it comes to new extensions, there already is at least one
"Unicode-aware extended DVI format" commonly available, and that
is ISO 32000, a.k.a. PDF 1.7.

Note that from the user's point of view, a PDF is also what XeTeX
generates. The backend conversion is hidden inside the executable.

In the luatex engine, that already knows how to generate PDF on its
own, there is no reason to go via DVI and (x)dvipdfmx to generate
a PDF document. Also, the new PDF previewers like the one in
texworks are fast enough to replace DVI previewers in interactive
editing. Metapost is probably the last program that actually needs
DVI for the label typesetting, and that dependency is already planned
for removal. So the usefulness of DVI is limited and diminishing.

In my opinion, it would therefore be a waste of effort to spend a
lot of time working on an extension to the DVI backend. In fact,
I advocate removing the whole possibility to create DVI output at
some point in the future.

Best wishes,
Taco

PS And a Happy New Year to you all!

From root at www.metatex.org  Fri Jan  2 12:26:33 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  2 Jan 2009 12:26:33 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090102112633.6EA821E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1711 | taco | 2009-01-02 11:54:42 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

bump the version number to avoid confusion with 0.31.3

------------------------------------------------------------------------
r1712 | taco | 2009-01-02 11:54:55 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/src/texk/web2c/luatexdir/font/pkin.c
   M /trunk/src/texk/web2c/luatexdir/font/writet3.c

fix reading of PK files

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan  2 16:25:11 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  2 Jan 2009 16:25:11 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090102152511.82E661E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1713 | hhenkel | 2009-01-02 12:15:04 +0100 (Fri, 02 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

change names: pdf_left --> pdf_ann_left...
to prepare pdf_left corresponding to dvi_left...

------------------------------------------------------------------------
r1714 | taco | 2009-01-02 14:45:33 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/libs/luafilesystem/Makefile
   A /trunk/src/libs/luafilesystem/Makefile.win
   A /trunk/src/libs/luafilesystem/README
   M /trunk/src/libs/luafilesystem/config
   A /trunk/src/libs/luafilesystem/config.win
   M /trunk/src/libs/luafilesystem/doc/us/examples.html
   M /trunk/src/libs/luafilesystem/doc/us/index.html
   M /trunk/src/libs/luafilesystem/doc/us/license.html
   M /trunk/src/libs/luafilesystem/doc/us/manual.html
   A /trunk/src/libs/luafilesystem/rockspecs
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-1.3.0-1.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-1.4.0-1.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-1.4.0-2.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-1.4.1-1.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-1.4.1rc1-1.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-cvs-1.rockspec
   A /trunk/src/libs/luafilesystem/rockspecs/luafilesystem-cvs-2.rockspec
   M /trunk/src/libs/luafilesystem/src/lfs.c
   A /trunk/src/libs/luafilesystem/src/lfs.def
   M /trunk/src/libs/luafilesystem/src/lfs.h
   M /trunk/src/libs/luafilesystem/tests/test.lua
   M /trunk/src/libs/luafilesystem/vc6/lfs.def
   M /trunk/src/libs/luafilesystem/vc6/luafilesystem.dsw
   M /trunk/src/libs/luafilesystem/vc6/luafilesystem_dll.dsp

new lfs import (version 1.4.1, as supplied by kepler)

------------------------------------------------------------------------
r1715 | oneiros | 2009-01-02 15:00:05 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   A /vendor/luafilesystem
   A /vendor/luafilesystem/current
   A /vendor/luafilesystem/current/Makefile
   A /vendor/luafilesystem/current/Makefile.win
   A /vendor/luafilesystem/current/README
   A /vendor/luafilesystem/current/config
   A /vendor/luafilesystem/current/config.win
   A /vendor/luafilesystem/current/doc
   A /vendor/luafilesystem/current/doc/us
   A /vendor/luafilesystem/current/doc/us/examples.html
   A /vendor/luafilesystem/current/doc/us/index.html
   A /vendor/luafilesystem/current/doc/us/license.html
   A /vendor/luafilesystem/current/doc/us/luafilesystem.png
   A /vendor/luafilesystem/current/doc/us/manual.html
   A /vendor/luafilesystem/current/rockspecs
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-1.3.0-1.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-1.4.0-1.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-1.4.0-2.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-1.4.1-1.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-1.4.1rc1-1.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-cvs-1.rockspec
   A /vendor/luafilesystem/current/rockspecs/luafilesystem-cvs-2.rockspec
   A /vendor/luafilesystem/current/src
   A /vendor/luafilesystem/current/src/lfs.c
   A /vendor/luafilesystem/current/src/lfs.def
   A /vendor/luafilesystem/current/src/lfs.h
   A /vendor/luafilesystem/current/tests
   A /vendor/luafilesystem/current/tests/test.lua
   A /vendor/luafilesystem/current/vc6
   A /vendor/luafilesystem/current/vc6/lfs.def
   A /vendor/luafilesystem/current/vc6/luafilesystem.dsw
   A /vendor/luafilesystem/current/vc6/luafilesystem_dll.dsp

track luafilesystem through vendor

------------------------------------------------------------------------
r1716 | oneiros | 2009-01-02 15:01:19 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   A /vendor/luafilesystem/1.4.1 (from /vendor/luafilesystem/current:1715)

tag luafilesystem 1.4.1

------------------------------------------------------------------------
r1717 | oneiros | 2009-01-02 15:04:36 +0100 (Fri, 02 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/libs/luafilesystem

Initialized merge tracking via "svnmerge" with revisions "1-1716" from 
http://scm.foundry.supelec.fr/svn/luatex/vendor/luafilesystem/current

------------------------------------------------------------------------
r1718 | oneiros | 2009-01-02 15:06:55 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   D /trunk/src/libs/luafilesystem/rockspecs

no need to distribute the rockspecs

------------------------------------------------------------------------
r1719 | taco | 2009-01-02 15:08:55 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/libs/luafilesystem/src/lfs.c

luatex changes (extensions) to lfs

------------------------------------------------------------------------

From jfine at pytex.org  Fri Jan  2 19:41:14 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Fri, 02 Jan 2009 18:41:14 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495D2B0A.1070302@pytex.org>	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
Message-ID: <495E5FCA.70505@pytex.org>

Martin Schr?der wrote:
> 2009/1/1 Jonathan Fine <jfine at pytex.org>:
>> What I want is for LuaTeX and XeTeX to have a shared 'extended dvi format'
>> which is suitable for print, for generating PDF and possibly other purposes.
> 
> Thus loosing the benefits of directly producing PDF. I don't see many
> benefits here.

Please could I be told, what are the main benefits of directly producing 
PDF?

BTW, Jonathan Kew said recently (on c.t.t) that XeTeX can use two 
processors on a multicore machine precisely because typesetting and PDF 
generation are decoupled, via xdv.

-- 
Jonathan

From jfine at pytex.org  Fri Jan  2 19:42:51 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Fri, 02 Jan 2009 18:42:51 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <6faad9f00901011420s12e4e0d4he223b8ca80603f86@mail.gmail.com>
References: <495A6D8B.6050601@pytex.org>	
	<20090101200953.GO18156@phare.normalesup.org>	
	<495D2B0A.1070302@pytex.org>	
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>	
	<495D3F1D.3040909@pytex.org>
	<6faad9f00901011420s12e4e0d4he223b8ca80603f86@mail.gmail.com>
Message-ID: <495E602B.90809@pytex.org>

Mojca Miklavec wrote:
> On Thu, Jan 1, 2009 at 11:09 PM, Jonathan Fine wrote:
>> What I want is for LuaTeX and XeTeX to have a shared 'extended dvi format'
>> which is suitable for print, for generating PDF and possibly other purposes.
> 
> Just curious: how do you print xdv (what's wrong with printing pdf?)

At present, xdv is mainly an internal format used by XeTeX.

> and what other purposes do you (or would you) use xdv for?

I'd like to be able to view typeset material in a web browser, and 
interact with this material also.

Thank you for these questions.

-- 
Jonathan

From jfine at pytex.org  Fri Jan  2 19:52:56 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Fri, 02 Jan 2009 18:52:56 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495DD8D2.2060601@elvenkind.com>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495DD8D2.2060601@elvenkind.com>
Message-ID: <495E6288.1010503@pytex.org>

Taco Hoekwater wrote:

[discussion of plans snipped]

PDF is very strong in the print field.  However, the web page is also an 
important medium, and as I said in my response to Mojca, I'd like to be 
able to view and interact with typeset material on a more-or-less 
ordinary web page.

I'd also like to have TeX or an extension available as a typesetting 
engine for an interactive graphical typesetting program.

For these reasons, and also so that LuaTeX and XeTeX could share more 
code and ideas, I'd like both systems to use a common extension of DVI.

In some sense, it is this sharing of code and of ideas that is for me 
the key thing.

> PS And a Happy New Year to you all!

Well said.  And from me to.

-- 
Jonathan


From pragma at wxs.nl  Fri Jan  2 21:20:29 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Jan 2009 21:20:29 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495E6288.1010503@pytex.org>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495DD8D2.2060601@elvenkind.com>
	<495E6288.1010503@pytex.org>
Message-ID: <495E770D.6000807@wxs.nl>

Jonathan Fine wrote:
> Taco Hoekwater wrote:
> 
> [discussion of plans snipped]
> 
> PDF is very strong in the print field.  However, the web page is also an 
> important medium, and as I said in my response to Mojca, I'd like to be 

pdf is also quite strong in the preview on the web field; it packages 
all the resources in the file which is quite different from dvi

> able to view and interact with typeset material on a more-or-less 
> ordinary web page.

well, go ahead then and extend your favourite tex variant then; as far 
as i understood you already did something like that; also keep in mind 
that luatex, becoming a flexible machine, most likely becomes slower 
than faster; maybe next year (when we're further with redoing the 
backend) we might discuss dvi again;

> I'd also like to have TeX or an extension available as a typesetting 
> engine for an interactive graphical typesetting program.
> 
> For these reasons, and also so that LuaTeX and XeTeX could share more 
> code and ideas, I'd like both systems to use a common extension of DVI.

well, it makes no sense to put a burdon on both developments; xetex is 
the fast tex variant that uses libraries and has dvi as intermediate 
format, while luatex is the flexible (at the cost of speed and to some 
extend system integration) with a focus currently on pdf; each has its 
use etc etc; if we (luatex team) at some point decide to drop dvi (as 
taco mentioned) then we take that freedom (and might provide an api for 
others to cook up a superdvi backend)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From yannis.haralambous at telecom-bretagne.eu  Fri Jan  2 21:21:54 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Fri, 2 Jan 2009 21:21:54 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495E6288.1010503@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495DD8D2.2060601@elvenkind.com> <495E6288.1010503@pytex.org>
Message-ID: <94F7458E-EE98-4435-8CCB-FE61D8A558E1@telecom-bretagne.eu>

Talking about DVI and PDF, I am the first one to be concerned about  
the programmed extinction of DVI because I have many jobs based on DVI  
post-processing (for example for marginal material, headers, and even  
for parallel texts between two pages). The advantage with DVI is that  
you can very easily now where you are located on the page so that you  
can extract text with positional information, and you can also easily  
insert new text (using pushes and pops).

But I'm confident that I will be able to rewrite all that for the PDF  
format. Multivalent has released some very powerful Java classes which  
convert PDF into a human-readable format and back to binary. Of course  
BT...ET sections are more complex than DVI's SET operator but I think  
it is possible to do simple post-processing.

And with the Mars format there is always hope that all that will be  
written in XML...

So, although many of the tools I depend upon are based on DVI, I'm  
rather for a PDF-only solution.

Nevertheless, a problem that should be solved is the one of adapting  
psfrag to PDF. psfrag is *absolutely essential* when typesetting  
mathematics...

Le 2 janv. 09 ? 19:52, Jonathan Fine a ?crit :

> Taco Hoekwater wrote:
>
> [discussion of plans snipped]
>
> PDF is very strong in the print field.  However, the web page is  
> also an important medium, and as I said in my response to Mojca, I'd  
> like to be able to view and interact with typeset material on a more- 
> or-less ordinary web page.
>
> I'd also like to have TeX or an extension available as a typesetting  
> engine for an interactive graphical typesetting program.
>
> For these reasons, and also so that LuaTeX and XeTeX could share  
> more code and ideas, I'd like both systems to use a common extension  
> of DVI.
>
> In some sense, it is this sharing of code and of ideas that is for  
> me the key thing.
>
>> PS And a Happy New Year to you all!
>
> Well said.  And from me to.
>
> -- 
> Jonathan
>
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex
>

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| TELECOM  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090102/3581e767/attachment-0002.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090102/3581e767/attachment-0001.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090102/3581e767/attachment-0003.html>

From pragma at wxs.nl  Fri Jan  2 21:24:02 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Jan 2009 21:24:02 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495E5FCA.70505@pytex.org>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495D2B0A.1070302@pytex.org>	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>	<495D3F1D.3040909@pytex.org>	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
Message-ID: <495E77E2.5060009@wxs.nl>

Jonathan Fine wrote:

> Please could I be told, what are the main benefits of directly producing 
> PDF?

Convenience since all is packages in one file; also, it's in the spirit 
of good old tex to adapt to developments (like pdf). Nowhere is demanded 
that dvi is to be the output (in a similar fashion: specials and writes 
are examplex of extensions, and pdftex (luatex) adds a couple more.


Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jan  2 21:49:05 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Jan 2009 21:49:05 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <94F7458E-EE98-4435-8CCB-FE61D8A558E1@telecom-bretagne.eu>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495DD8D2.2060601@elvenkind.com>
	<495E6288.1010503@pytex.org>
	<94F7458E-EE98-4435-8CCB-FE61D8A558E1@telecom-bretagne.eu>
Message-ID: <495E7DC1.8020404@wxs.nl>

Yannis Haralambous wrote:
> Talking about DVI and PDF, I am the first one to be concerned about the 
> programmed extinction of DVI because I have many jobs based on DVI 
> post-processing (for example for marginal material, headers, and even 
> for parallel texts between two pages). The advantage with DVI is that 
> you can very easily now where you are located on the page so that you 
> can extract text with positional information, and you can also easily 
> insert new text (using pushes and pops).

i'm not sure if you refer to the same kind of positional info, but 
pdftex (and therefore luatex) hasn pdfsavepos cum suis in both pdf and 
dvi mode so you can store positions (lazy, i.e. write them to file in 
the backend) and then use them in a second pass (it't a rather old 
feature by now, which started as an experiment by Thanh and me and for 
some time was only available in pdf mode and in dvi mode we could use 
specials and the dvipos postprocessor; after a while it was also added 
to dvi mode)

on the agenda is some more positional (runtime, in prerolls using boxes 
and getting pos into afterwards), a kind of pet project in parallel

> And with the Mars format there is always hope that all that will be 
> written in XML...

and xps .. although one might have problems then with packages resources 
(and files become large too)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Fri Jan  2 22:25:12 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  2 Jan 2009 22:25:12 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090102212512.48C3F1E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1720 | taco | 2009-01-02 16:10:13 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/fontforge/fontforge/autotrace.c
   M /trunk/src/libs/luafontforge/fontforge/fontforge/bezctx_ff.c
   M /trunk/src/libs/luafontforge/fontforge/fontforge/http.c
   M /trunk/src/libs/luafontforge/fontforge/fontforge/plugins.c
   M /trunk/src/libs/luafontforge/fontforge/fontforge/print.c
   M /trunk/src/libs/luafontforge/fontforge/fontforge/utils.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagereadgif.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagereadjpeg.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagereadpng.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagereadtiff.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagewritejpeg.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gimagewritepng.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gio.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/giofile.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/gioftp.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/giohosts.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/giothread.c
   M /trunk/src/libs/luafontforge/fontforge/gutils/giotrans.c

fix issue #147 (file something.o has no symbols)

------------------------------------------------------------------------
r1721 | taco | 2009-01-02 16:21:58 +0100 (Fri, 02 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

fix issue #146 (texnodes.c doesnt compile under NDEBUG)

------------------------------------------------------------------------
r1722 | hhenkel | 2009-01-02 19:54:51 +0100 (Fri, 02 Jan 2009) | 8 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

DVI mode: 
* initialize cur_h=0 and cur_v=0 inside hlist_out and vlist_out, as these
  variables anyway have no global consistent meaning in multidirectional system.
* add \pdfsavepos functionality for DVI in all 8 page directions.
  \pdflastxpos and \pdflastypos measured from lower left page edge, as before.
* remove redundant synch_h/synch_v before DVI group end.
* rewrite initial page box placement on page (should be compatible).

------------------------------------------------------------------------

From martin at oneiros.de  Fri Jan  2 23:30:13 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 2 Jan 2009 23:30:13 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495E5FCA.70505@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
Message-ID: <68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>

2009/1/2 Jonathan Fine <jfine at pytex.org>:
> Please could I be told, what are the main benefits of directly producing
> PDF?

Reasoning about and manipulating included PDFs. This is much harder
with a two-pass engine like XeTeX + postprocessor; as an example
compare the knowledge of XeTeX (the program) and pdfTeX about included
PDFs.

> BTW, Jonathan Kew said recently (on c.t.t) that XeTeX can use two processors
> on a multicore machine precisely because typesetting and PDF generation are
> decoupled, via xdv.

I doubt the speed gained from that is high for most documents.

But as I said: Show us your code.

Best
   Martin

From root at www.metatex.org  Sat Jan  3 12:26:18 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat,  3 Jan 2009 12:26:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090103112618.395D91E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1723 | taco | 2009-01-03 11:13:38 +0100 (Sat, 03 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/commands.h
   M /trunk/src/texk/web2c/luatexdir/luatex.web

implement \pageleftoffset and \pagetopoffset primitives

------------------------------------------------------------------------
r1724 | taco | 2009-01-03 11:27:28 +0100 (Sat, 03 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

implement the \pageleftoffset<>\hoffset and \pagetopoffset<>\voffset coupling for lua assignments as well

------------------------------------------------------------------------

From yannis.haralambous at telecom-bretagne.eu  Sat Jan  3 12:44:22 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sat, 3 Jan 2009 12:44:22 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495E7DC1.8020404@wxs.nl>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495DD8D2.2060601@elvenkind.com>
	<495E6288.1010503@pytex.org>
	<94F7458E-EE98-4435-8CCB-FE61D8A558E1@telecom-bretagne.eu>
	<495E7DC1.8020404@wxs.nl>
Message-ID: <A56BBFC6-0509-4A4E-BFA5-9B9F4909249D@telecom-bretagne.eu>

Le 2 janv. 09 ? 21:49, Hans Hagen a ?crit :

> i'm not sure if you refer to the same kind of positional info, but  
> pdftex (and therefore luatex) hasn pdfsavepos cum suis in both pdf  
> and dvi mode so you can store positions (lazy, i.e. write them to  
> file in the backend) and then use them in a second pass (it't a  
> rather old feature by now, which started as an experiment by Thanh  
> and me and for some time was only available in pdf mode and in dvi  
> mode we could use specials and the dvipos postprocessor; after a  
> while it was also added to dvi mode)
>
> on the agenda is some more positional (runtime, in prerolls using  
> boxes and getting pos into afterwards), a kind of pet project in  
> parallel


Well, I'm doing mainly two things:

1) I put tags in the DVI file which allow me to place marginal  
material at (exactly) the same height, during post-processing. In DVI  
it is easy to place a PUSH, make a skip, typeset the material and then  
POP back to the previous position so that the rest of the page remains  
unchanged. I guess this will be harder in PDF.

2) I calculate the height of lines so that I can detect whether a page  
is shorter or taller than the normal. This is very useful to prevent  
accidents.

In a more elaborate project I split my DVI page into lines (lines of  
text, of translation, of footnotes of translation and of one or more  
critical apparati) and I re-assemble these lines into double pages, by  
letting the critical apparati flow under the footnotes, ad by keeping  
parallelism between text and translation. This works fine with DVI,  
maybe everyline can become a BT...ET section in PDF and I can get the  
same result.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| TELECOM  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090103/a5cf5a83/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090103/a5cf5a83/attachment.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090103/a5cf5a83/attachment-0001.html>

From pragma at wxs.nl  Sat Jan  3 14:31:45 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 03 Jan 2009 14:31:45 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <A56BBFC6-0509-4A4E-BFA5-9B9F4909249D@telecom-bretagne.eu>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495DD8D2.2060601@elvenkind.com>	<495E6288.1010503@pytex.org>	<94F7458E-EE98-4435-8CCB-FE61D8A558E1@telecom-bretagne.eu>	<495E7DC1.8020404@wxs.nl>
	<A56BBFC6-0509-4A4E-BFA5-9B9F4909249D@telecom-bretagne.eu>
Message-ID: <495F68C1.6020304@wxs.nl>

Yannis Haralambous wrote:

> 1) I put tags in the DVI file which allow me to place marginal material 
> at (exactly) the same height, during post-processing. In DVI it is easy 
> to place a PUSH, make a skip, typeset the material and then POP back to 
> the previous position so that the rest of the page remains unchanged. I 
> guess this will be harder in PDF.

i do that in pdf by using pdfsavepos cum suis (just calculate the delta 
between several positions and then move the material)

> 2) I calculate the height of lines so that I can detect whether a page 
> is shorter or taller than the normal. This is very useful to prevent 
> accidents.

> In a more elaborate project I split my DVI page into lines (lines of 
> text, of translation, of footnotes of translation and of one or more 
> critical apparati) and I re-assemble these lines into double pages, by 
> letting the critical apparati flow under the footnotes, ad by keeping 
> parallelism between text and translation. This works fine with DVI, 
> maybe everyline can become a BT...ET section in PDF and I can get the 
> same result.

that can be done by looping over the nodelist and manipulating hlist nodes

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Sat Jan  3 16:16:51 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 3 Jan 2009 16:16:51 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <495D3BE9.9040301@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<20090101211306.GP18156@phare.normalesup.org>
	<495D3BE9.9040301@pytex.org>
Message-ID: <20090103151651.GW18156@phare.normalesup.org>

> However, your statement seems to contradict your earlier statement 
> (snipped) that one can do
>     Source transformed by LuaTeX to DVI and hence PDF
> and get the same result as
>     Source transformed directly to PDF by LuaTeX

  I didn't write that you would get the same result.  But in most cases, it
should still work, though.  Again, it all depends on what kind of
information you want to put it your output file, so you should be more
specific.

> From what you've said, it seems to me that xdv contains some but not all of 
> the features that LuaTeX would need to add to the DVI format. Are there 
> many such features?

  I couldn't say for sure, but if you go back to my vertical text
sample, you can see an essential feature that DVI is lacking, as well as
xdv: the ability to include arbitrarily modified metrics for any font.

  In my example, I want to modify the dimensions of glyphs in a font,
much like you would do with a virtual font.  LuaTeX allows us to emulate
this behaviour by using the define_font callback, without going through
an actual .vf file.  You need, roughly, to produce a Lua hash table in
which you put new widths, heights and depths for all the glyphs in that
font.  This only works to a certain extent in DVI mode, because, then, I
would like to modify the vertical placement of some glyphs, and you
can't include that information in the DVI.  Inside LuaTeX, all that
information is contained in your Lua code, but it is lost once you write
the DVI file.  Needless to say, it would also be lost in the xdv format.

  In short, this demontrates that DVI and extensions lack an essential
feature of LuaTeX, which is, not very surprisingly, Lua itself.  Should
we go on adding the possibility of including arbitrary Lua code in a DVI
file?  I shouldn't think so.  The way I see it, Lua is part of the
typesetting engine of LuaTeX, not the end format (whichever one you
use), and whatever you do during the typesetting part should be
discarded in the backend, and transformed into the appropriate form (in
my example, by writing out the modified metrics in the PDF file, and
shifting the glyphs in the embedded font).

  Incidentally, you can probably still try and include arbitrary Lua
code in a DVI file, by using \special's.  You can then produce a DVI
consumer application that would read and execute that code (for example,
by modifying xdvipdfmx).  But if you go on producing PDF instead,
everything is already there for you.

	Arthur

From jfine at pytex.org  Sun Jan  4 08:48:13 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Sun, 04 Jan 2009 07:48:13 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <20090103151651.GW18156@phare.normalesup.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<20090101211306.GP18156@phare.normalesup.org>
	<495D3BE9.9040301@pytex.org>
	<20090103151651.GW18156@phare.normalesup.org>
Message-ID: <496069BD.7020701@pytex.org>

Arthur Reutenauer wrote:

>> However, your statement seems to contradict your earlier statement 
>> (snipped) that one can do
>>     Source transformed by LuaTeX to DVI and hence PDF
>> and get the same result as
>>     Source transformed directly to PDF by LuaTeX
> 
>   I didn't write that you would get the same result.  But in most cases, it
> should still work, though.  Again, it all depends on what kind of
> information you want to put it your output file, so you should be more
> specific.

I thought I'd asked for the same result, and I also thought that you 
were answering my question.  Let me restate (better this time, I hope).

Can, in all important cases, the transformation
     Source to PDF via LuaTeX
proceed via
     Source to xdv (say via a modified LuaTeX)
and then
     xdv to PDF (say by xdvipdfm).

>> From what you've said, it seems to me that xdv contains some but not all of 
>> the features that LuaTeX would need to add to the DVI format. Are there 
>> many such features?
> 
>   I couldn't say for sure, but if you go back to my vertical text
> sample, you can see an essential feature that DVI is lacking, as well as
> xdv: the ability to include arbitrarily modified metrics for any font.
> 
>   In my example, I want to modify the dimensions of glyphs in a font,
> much like you would do with a virtual font.  LuaTeX allows us to emulate
> this behaviour by using the define_font callback, without going through
> an actual .vf file.  You need, roughly, to produce a Lua hash table in
> which you put new widths, heights and depths for all the glyphs in that
> font.  

An aside:  I didn't know that LuaTeX had this capability (and I'm not 
sure that using it is the right way to do vertical typesetting).

What I don't see, from what you've told me, is that xdv is not adequate 
for your example.  I'd need more information.  For example, are you 
putting what you call the emulated vf file into the output PDF?

[snip]

>   In short, this demontrates that DVI and extensions lack an essential
> feature of LuaTeX, which is, not very surprisingly, Lua itself.  

But DVI lacks an essential feature of TeX, which is the TeX macro 
language.  I count this as a benefit of DVI, not a deficiency. 
Standards restrict, and by restricting enable.

[snip]

-- 
Jonathan

From chemoelectric at chemoelectric.org  Sun Jan  4 09:35:12 2009
From: chemoelectric at chemoelectric.org (Barry Schwartz)
Date: Sun, 4 Jan 2009 02:35:12 -0600
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <496069BD.7020701@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<20090101211306.GP18156@phare.normalesup.org>
	<495D3BE9.9040301@pytex.org>
	<20090103151651.GW18156@phare.normalesup.org>
	<496069BD.7020701@pytex.org>
Message-ID: <20090104083511.GA26997@crud.crud.mn.org>

Jonathan Fine <jfine at pytex.org> skribis:
> But DVI lacks an essential feature of TeX, which is the TeX macro language. 
>  I count this as a benefit of DVI, not a deficiency. Standards restrict, 
> and by restricting enable.

This may be a case of 'If you build it, they will come': present a set
of tools making XDVI useful, and then maybe people will want to write
code for it.

Having written the clumsy XDVI support for ant (ant.berlios.de) a few
years ago, and somewhat less clumsy support for unpublished software,
I am trying to recall in what important ways XDVI differs from regular
DVI. I _think_ (my memory may be wrong) the deal was that to use a
non-tfm font you had to use the new glyph-writing opcodes. Otherwise
it's almost exactly like using dvipdfm.

I don't know what XeTeX does but in both the cases mentioned above I
use glyph-index encoding. To make that portable you would have to
include in the xdv file a map from glyph indexes to Unicode strings,
perhaps using specials.


From jfine at pytex.org  Sun Jan  4 09:13:07 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Sun, 04 Jan 2009 08:13:07 +0000
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
References: <495A6D8B.6050601@pytex.org>	<20090101200953.GO18156@phare.normalesup.org>	<495D2B0A.1070302@pytex.org>	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>	<495D3F1D.3040909@pytex.org>	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>	<495E5FCA.70505@pytex.org>
	<68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
Message-ID: <49606F93.5050204@pytex.org>

Martin Schr?der wrote:
> 2009/1/2 Jonathan Fine <jfine at pytex.org>:
>> Please could I be told, what are the main benefits of directly producing
>> PDF?
> 
> Reasoning about and manipulating included PDFs. This is much harder
> with a two-pass engine like XeTeX + postprocessor; as an example
> compare the knowledge of XeTeX (the program) and pdfTeX about included
> PDFs.

I'm sorry, but I don't understand.

Yes, typesetting applications need to know about included objects such 
as images (and fonts).  But from there you conclude that there's a 
benefit in generating PDF directly.  I don't see how this follows.

I'll invent an example (so it's not really an example).  We wish to 
resize an image to fit the measure, but if it's a bitmap image we want 
to  choose a scaling factor that works well with our planned output 
device.  Here's another.  We want to know if the image contains colour, 
because if it does it should appear in the colour plates section.

In both cases we have to open the image file and, as you say, reason 
about it.  Based on this reasoning we come to a conclusion (such as a 
scale factor) and both 9a) typeset the text and (b) process the image 
accordingly.

LuaTeX does (a) and (b) at the same time.  I see no reason why a 
'special' that says 'do (b)' should not be written to the xdv or 
whatever output file.

[Discussion of performance snipped]

> But as I said: Show us your code.

Well, it's not MY code, but I'm sure you're welcome to use it:
    http://scripts.sil.org/svn-public/xetex/TRUNK/
    http://scripts.sil.org/svn-public/xdvipdfmx/TRUNK/

XeTeX is distributed under the X11 free software license.

-- 
Jonathan

From chemoelectric at chemoelectric.org  Sun Jan  4 10:08:48 2009
From: chemoelectric at chemoelectric.org (Barry Schwartz)
Date: Sun, 4 Jan 2009 03:08:48 -0600
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <49606F93.5050204@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
	<68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
	<49606F93.5050204@pytex.org>
Message-ID: <20090104090848.GA11061@crud.crud.mn.org>

Jonathan Fine <jfine at pytex.org> skribis:
> Well, it's not MY code, but I'm sure you're welcome to use it:
>    http://scripts.sil.org/svn-public/xetex/TRUNK/
>    http://scripts.sil.org/svn-public/xdvipdfmx/TRUNK/
>
> XeTeX is distributed under the X11 free software license.

xdvipdfmx is GPL, I believe.


From taco at elvenkind.com  Sun Jan  4 11:37:49 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 04 Jan 2009 11:37:49 +0100
Subject: [Dev-luatex] New luatex mailing list announcement
Message-ID: <4960917D.50806@elvenkind.com>


Hello everybody,

The dev-luatex at ntg.nl list has seem more and more messages per day
over the past months.  We are of course very pleased with the growing
interest in Luatex, and we believe the time has come to create a
general usage mailing list.

Karl Berry at TUG has set up a brand new mailing list for us that
can be subscribed to via this URL:

     http://lists.tug.org/luatex

or by sending an email message to

     luatex-subscribe at tug.org

Of course questions about building and patching the Luatex engine
should stay on dev-luatex, and questions regarding ConTeXt mkiv
should stay on ntg-context.  But the new list will be the best
location for all general Luatex discussion and usage questions.

A request for the people currently on the dev-luatex list: if you
have an interest in Luatex but are not planning on becoming an active
developer, please switch to the new list.  Doing so will make life
a bit easier for the active developers and packagers, not all of
which are necessarily luatex users and interested in discussions.

Have fun,

Taco Hoekwater
For the Luatex team



From martin at oneiros.de  Sun Jan  4 13:01:10 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 4 Jan 2009 13:01:10 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <49606F93.5050204@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
	<68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
	<49606F93.5050204@pytex.org>
Message-ID: <68c491a60901040401p9e0d2c5na15833c7907a7810@mail.gmail.com>

2009/1/4 Jonathan Fine <jfine at pytex.org>:
> Martin Schr?der wrote:
>> 2009/1/2 Jonathan Fine <jfine at pytex.org>:
>>> Please could I be told, what are the main benefits of directly producing
>>> PDF?
>>
>> Reasoning about and manipulating included PDFs. This is much harder
>> with a two-pass engine like XeTeX + postprocessor; as an example
>> compare the knowledge of XeTeX (the program) and pdfTeX about included
>> PDFs.
>
> I'm sorry, but I don't understand.

I think you do. :-)

> I'll invent an example (so it's not really an example).  We wish to resize
> an image to fit the measure, but if it's a bitmap image we want to  choose a
> scaling factor that works well with our planned output device.  Here's
> another.  We want to know if the image contains colour, because if it does
> it should appear in the colour plates section.
>
> In both cases we have to open the image file and, as you say, reason about
> it.  Based on this reasoning we come to a conclusion (such as a scale
> factor) and both 9a) typeset the text and (b) process the image accordingly.
>
> LuaTeX does (a) and (b) at the same time.  I see no reason why a 'special'
> that says 'do (b)' should not be written to the xdv or whatever output file.

A special makes that harder; it needs more code. The backend needs the
code for reasoning about the image anyway; now the frontend also needs
it. You're duplicating code. And you need code for the two parts to
communicate. More code means more errors.

Consider this example: I want to include PDFs with layers and want to
mix layers generated by the document with layers from the PDFs,
controlled by the document. This might be doable in two passes, but it
is much easier in one pass.

> [Discussion of performance snipped]
>
>> But as I said: Show us your code.
>
> Well, it's not MY code, but I'm sure you're welcome to use it:

You don't understand, so I'll be more clear: Shut up and code! :-)
You seem to be the only one here interested in this mythical
luatex + xdv, so why don't you SHOW us what it can do better?

I can see only ONE benefit from your mythical xdv: interchangable
backends. But I don't think the team finds *dvipdfm* so much more
interesting than luaTeX.

Best
   Martin

From taco at elvenkind.com  Sun Jan  4 15:10:09 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 04 Jan 2009 15:10:09 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
Message-ID: <4960C341.8090409@elvenkind.com>


Hi,

In one of the next releases I want to start distributing some
lua files under <texmf>/luatex/lua/

The intentions is that lua modules that are part of the luatex
lua distribution will go there, nothing else. These are files
that can be reached via the Lua require() function using the
default compile-time package.path. Lua scripts have their place
under <texmf>/scripts/lua already, and macro package specific
lua files should remain below <texmf>/tex/, to be found via
kpse.find_file().

The immediate candidates for inclusion are:

from lpeg, currently not distributed at all

   luatex/lua/re.lua

from luasocket, currently compiled into the executable:

   luatex/lua/socket.lua
   luatex/lua/ltn12.lua
   luatex/lua/mime.lua
   luatex/lua/socket/http.lua
   luatex/lua/socket/url.lua
   luatex/lua/socket/tp.lua
   luatex/lua/socket/ftp.lua
   luatex/lua/socket/smtp.lua

Some others may soon arise form the luatex core itself, for example
for the mapping of node (sub)type numbers to strings. These ids are
static for any particular version of the executable, but they are
never actually used inside the engine, so it makes sense to split
them off into a lua module that can be loaded on demand.

One warning and one question.

First the warning, for Hans in particular: make sure you start using
require() for all of the external lua modules that are embedded in
luatex. As soon as this new subsystem is in place, you can no longer
use functions like socket.bind() without require-ing the module first!

Second the question, and that is mostly for Martin: when luatex starts
shipping more stuff than just a single executable, it begins to make
sense to have an installation method. It could be nice to be able

   $ ./configure; make; make install

at toplevel, instead of

   $ ./build.sh ; cp <bunch of whatever to wherever> ; ...

To be able to that, the current build scripts have to be rewritten
into a unified Makefile.in. The new, to-be-created configure script can
be rather stupid and may not even have to be autoconf-generated.

The aim is to get a predictable user interface, not automating the
whole big build process. For example, if "make clean" would delete the
build tree (if there was one), then the  "--make" commandline switch
would no longer be needed. Targets like "make cross" and "make native"
could replace ./build.sh.linux and ./build.sh.cross, etc.

Would you (or anyone else) be willing to work on that?

Best wishes,
Taco












From pragma at wxs.nl  Sun Jan  4 16:24:05 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 04 Jan 2009 16:24:05 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <4960C341.8090409@elvenkind.com>
References: <4960C341.8090409@elvenkind.com>
Message-ID: <4960D495.8060304@wxs.nl>

Taco Hoekwater wrote:

> First the warning, for Hans in particular: make sure you start using
> require() for all of the external lua modules that are embedded in
> luatex. As soon as this new subsystem is in place, you can no longer
> use functions like socket.bind() without require-ing the module first!

ok, no problem for the scripts, but i have to figure out a way to embed 
them in the format

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Sun Jan  4 17:08:19 2009
From: preining at logic.at (Norbert Preining)
Date: Sun, 4 Jan 2009 17:08:19 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <4960C341.8090409@elvenkind.com>
References: <4960C341.8090409@elvenkind.com>
Message-ID: <20090104160819.GA20985@gamma.logic.tuwien.ac.at>

On So, 04 Jan 2009, Taco Hoekwater wrote:
> lua files under <texmf>/luatex/lua/
> 
> The intentions is that lua modules that are part of the luatex
> lua distribution will go there, nothing else. These are files
> that can be reached via the Lua require() function using the
> default compile-time package.path. Lua scripts have their place
> under <texmf>/scripts/lua already, and macro package specific
> lua files should remain below <texmf>/tex/, to be found via
> kpse.find_file().

Hmmm, what about
	<texmf>/scripts/lua/luatex/
? I consider that a better candidate then creating another toplevel
hierarchy. 

Is there a particular need for that?  The above suggestion would serve
the same purpose, and anyone can anyway install into <texmf>/luatex/lua,
too, if one wants to. So I don't see any direct advantage.

> Second the question, and that is mostly for Martin: when luatex starts
> shipping more stuff than just a single executable, it begins to make
> sense to have an installation method. It could be nice to be able
> 
>   $ ./configure; make; make install
> 
> at toplevel, instead of
> 
>   $ ./build.sh ; cp <bunch of whatever to wherever> ; ...

OHHHH PLEASE!!!!!! YES!!!!!

> To be able to that, the current build scripts have to be rewritten
> into a unified Makefile.in. The new, to-be-created configure script can
> be rather stupid and may not even have to be autoconf-generated.

If you do the step please make sure that dropping it into texlive trees
makes it easy already. Maybe that is already planned/done/whatever,
wanted only to remind it ;-)

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
STURRY (n.,vb.)
A token run. Pedestrians who have chosen to cross a road immediately
in front of an approaching vehicle generally give a little wave and
break into a sturry. This gives the impression of hurrying without
having any practical effect on their speed whatsoever.
			--- Douglas Adams, The Meaning of Liff

From pragma at wxs.nl  Sun Jan  4 17:25:57 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 04 Jan 2009 17:25:57 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <20090104160819.GA20985@gamma.logic.tuwien.ac.at>
References: <4960C341.8090409@elvenkind.com>
	<20090104160819.GA20985@gamma.logic.tuwien.ac.at>
Message-ID: <4960E315.4070306@wxs.nl>

Norbert Preining wrote:

> Hmmm, what about
> 	<texmf>/scripts/lua/luatex/
> ? I consider that a better candidate then creating another toplevel
> hierarchy. 

it also depends on the variables set; what happens if one has files with 
the same names in scripts/lua/luatex and scripts/lua/whatever

i think that the idea was to have that toplevel path for libs that 
belong to luatex itself, and not to some package

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Sun Jan  4 17:31:08 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 04 Jan 2009 17:31:08 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <20090104160819.GA20985@gamma.logic.tuwien.ac.at>
References: <4960C341.8090409@elvenkind.com>
	<20090104160819.GA20985@gamma.logic.tuwien.ac.at>
Message-ID: <4960E44C.6090309@elvenkind.com>


Hi Norbert,

Norbert Preining wrote:
> 
> Hmmm, what about
> 	<texmf>/scripts/lua/luatex/
> ? I consider that a better candidate then creating another toplevel
> hierarchy. 

Nothing has been done yet, but I favour <texmf>/luatex, and Karl
agreed with me :-)

The files in question are not scripts. For example, take socket.lua.
This is the lua part of the socket implementation, of which the C side
is compiled into the executable (as socket.a).   socket.lua is not a
standalone package, and it has to have the same version exactly as
the embedded socket.a, both are distributed by luatex itself, and
both come from upstream.

And there is a precedent: bibtex, dvips, omega, all have similar
top-level directories for runtime files that do not depend on macro
packages.

Best wishes,
Taco




From preining at logic.at  Sun Jan  4 17:34:25 2009
From: preining at logic.at (Norbert Preining)
Date: Sun, 4 Jan 2009 17:34:25 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <4960E44C.6090309@elvenkind.com>
References: <4960C341.8090409@elvenkind.com>
	<20090104160819.GA20985@gamma.logic.tuwien.ac.at>
	<4960E44C.6090309@elvenkind.com>
Message-ID: <20090104163425.GA23135@gamma.logic.tuwien.ac.at>

On So, 04 Jan 2009, Taco Hoekwater wrote:
> Nothing has been done yet, but I favour <texmf>/luatex, and Karl
> agreed with me :-)

Ok, that is a good indicator ;-)

> The files in question are not scripts. For example, take socket.lua.
> This is the lua part of the socket implementation, of which the C side
> is compiled into the executable (as socket.a).   socket.lua is not a
> standalone package, and it has to have the same version exactly as
> the embedded socket.a, both are distributed by luatex itself, and
> both come from upstream.

Ok, I see the difference now. Fine with me.

> And there is a precedent: bibtex, dvips, omega, all have similar
> top-level directories for runtime files that do not depend on macro
> packages.

Agreed.

Sorry for the noise.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
YONDER BOGINE (n.)
The kind of restaurant advertised as 'just three minutes from this
cinema' which clearly nobody ever goes to and, even if they had ever
contemplated it, have certainly changed their mind since seeing the
advert.
			--- Douglas Adams, The Meaning of Liff

From H.vanderMeer at uva.nl  Sun Jan  4 17:05:48 2009
From: H.vanderMeer at uva.nl (Hans van der Meer)
Date: Sun, 4 Jan 2009 17:05:48 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <4960C341.8090409@elvenkind.com>
References: <4960C341.8090409@elvenkind.com>
Message-ID: <F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>

I have a few questions about this announcement.

1st question:
> Lua scripts have their place under <texmf>/scripts/lua already,
I thought the lua scripts in the cont-tmf.zip distribution are  
residing in <texmf>/scripts/context/lua/. Is this a change or are they  
different files?

2nd question:
In many instances the system location to place lua libraries is  
somewhere like
/usr/local/lib/lua/5.1/lpeg.so etc. for dynamic libraries
/usr/local/share/lua/5.1/re.lu etc. for lua coded modules
See the discussion on page 140 of the book Programming in Lua by  
Roberto Ierusalimschy.
Will these locations be put on the searchpath too?
Or will the environment variables LUA_PATH and LUA_CPATH, mentioned in  
the above, be included in the search?

Finally a wish related to the build/make process, since that also  
seems to undergo a change. At present each compilation run also  
compiles ctangle. Often that program is already in the TeX  
distribution. Is it possible to use that instead and resort to  
compilation only when it cannot be found?

Hans van der Meer




On 4 jan 2009, at 15:10, Taco Hoekwater wrote:

>
> Hi,
>
> In one of the next releases I want to start distributing some
> lua files under <texmf>/luatex/lua/
>
> The intentions is that lua modules that are part of the luatex
> lua distribution will go there, nothing else. These are files
> that can be reached via the Lua require() function using the
> default compile-time package.path. Lua scripts have their place
> under <texmf>/scripts/lua already, and macro package specific
> lua files should remain below <texmf>/tex/, to be found via
> kpse.find_file().
>
> The immediate candidates for inclusion are:
>
> from lpeg, currently not distributed at all
>
>  luatex/lua/re.lua
>
> from luasocket, currently compiled into the executable:
>
>  luatex/lua/socket.lua
>  luatex/lua/ltn12.lua
>  luatex/lua/mime.lua
>  luatex/lua/socket/http.lua
>  luatex/lua/socket/url.lua
>  luatex/lua/socket/tp.lua
>  luatex/lua/socket/ftp.lua
>  luatex/lua/socket/smtp.lua
>
> Some others may soon arise form the luatex core itself, for example
> for the mapping of node (sub)type numbers to strings. These ids are
> static for any particular version of the executable, but they are
> never actually used inside the engine, so it makes sense to split
> them off into a lua module that can be loaded on demand.
>
> One warning and one question.
>
> First the warning, for Hans in particular: make sure you start using
> require() for all of the external lua modules that are embedded in
> luatex. As soon as this new subsystem is in place, you can no longer
> use functions like socket.bind() without require-ing the module first!
>
> Second the question, and that is mostly for Martin: when luatex starts
> shipping more stuff than just a single executable, it begins to make
> sense to have an installation method. It could be nice to be able
>
>  $ ./configure; make; make install
>
> at toplevel, instead of
>
>  $ ./build.sh ; cp <bunch of whatever to wherever> ; ...
>
> To be able to that, the current build scripts have to be rewritten
> into a unified Makefile.in. The new, to-be-created configure script  
> can
> be rather stupid and may not even have to be autoconf-generated.
>
> The aim is to get a predictable user interface, not automating the
> whole big build process. For example, if "make clean" would delete the
> build tree (if there was one), then the  "--make" commandline switch
> would no longer be needed. Targets like "make cross" and "make native"
> could replace ./build.sh.linux and ./build.sh.cross, etc.
>
> Would you (or anyone else) be willing to work on that?
>
> Best wishes,
> Taco
>
>
>
>
>
>
>
>
>
>
>
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex


From arthur.reutenauer at normalesup.org  Sun Jan  4 20:20:59 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 4 Jan 2009 20:20:59 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <49606F93.5050204@pytex.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
	<68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
	<49606F93.5050204@pytex.org>
Message-ID: <20090104192059.GH18156@phare.normalesup.org>

> Yes, typesetting applications need to know about included objects such as 
> images (and fonts).  But from there you conclude that there's a benefit in 
> generating PDF directly.  I don't see how this follows.

  The key to understanding the ?benefit in generating PDF directly? lies
in the adverb ?directly?, not the noun ?PDF?.  We appreciate having a
single program that has all the necessary knowledge about the end
result.

> LuaTeX does (a) and (b) at the same time.

  Not at the same time, within the same program.  Those actions do not
need to be carried out at the same moment, but it's useful that the
parts of the program that are responsible for them are able to
communicate with each other to exchange knowledge about the material
being typeset, without duplicating code, as Martin said.

>                                            I see no reason why a 'special' 
> that says 'do (b)' should not be written to the xdv or whatever output 
> file.

  Maybe it's time that we turn the question the other way round and ask
you for reasons to *do* so.  What, could you please tell us, is so great
about *not* generating the end result directly that we should force
ourselves to produce an intermediate file first, and even go on about
inventing a new format, because the current extensions to DVI lack some
necessary features?

> [Discussion of performance snipped]

  It's a pity you don't want to discuss this, because it's the only
technical advantage to producing xdv that I have seen mentioned so far.

> Well, it's not MY code, but I'm sure you're welcome to use it:
>    http://scripts.sil.org/svn-public/xetex/TRUNK/
>    http://scripts.sil.org/svn-public/xdvipdfmx/TRUNK/

  That's XeTeX's code.  The LuaTeX developers are well aware of XeTeX's
existence and features, but what you may be missing here is that LuaTeX
is not XeTeX and is not destined to be, nor the other way round, for
that matter.  They simply serve different purposes.  Your insistence in
having LuaTeX produce xdv seems to proceed from the assumption that
XeTeX's novelty resides in xdv, which is in my opinion the wrong angle
on this issue: XeTeX's most valuable asset is XeTeX, the program,
itself, not xdv production.  And xdvipdfmx, the postprocessor, doesn't
have such prominent features that couldn't be implemented within LuaTeX,
as Barry pointed out.  As for LuaTeX's specific features, they would not
be very well expressed by xdv, and can be fully accounted for by
generating PDF.

	Arthur

From arthur.reutenauer at normalesup.org  Sun Jan  4 20:27:08 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 4 Jan 2009 20:27:08 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>
References: <4960C341.8090409@elvenkind.com>
	<F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>
Message-ID: <20090104192708.GI18156@phare.normalesup.org>

> I thought the lua scripts in the cont-tmf.zip distribution are residing in 
> <texmf>/scripts/context/lua/. Is this a change or are they different files?

  Different files, see Taco's message from 17:31.

> Will these locations be put on the searchpath too?
> Or will the environment variables LUA_PATH and LUA_CPATH, mentioned in the 
> above, be included in the search?

  I don't know how the developers will solve that, but it's obvious that
it needs to be handled somehow (maybe through kpathsea?  Yet another
variable name in texmf.cnf ...).

	Arthur

From pragma at wxs.nl  Sun Jan  4 22:03:43 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 04 Jan 2009 22:03:43 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>
References: <4960C341.8090409@elvenkind.com>
	<F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>
Message-ID: <4961242F.9060404@wxs.nl>

Hans van der Meer wrote:
> I have a few questions about this announcement.
> 
> 1st question:
>> Lua scripts have their place under <texmf>/scripts/lua already,
> I thought the lua scripts in the cont-tmf.zip distribution are residing 
> in <texmf>/scripts/context/lua/. Is this a change or are they different 
> files?

only some mtx-* scripts; they use libs that are in tex/context/base and 
that will not change; macro packages should put their code under their 
designated paths (for latex there is also a subpath for authors, for 
context there is the /third etc subpaths for users)

> 2nd question:
> In many instances the system location to place lua libraries is 
> somewhere like
> /usr/local/lib/lua/5.1/lpeg.so etc. for dynamic libraries
> /usr/local/share/lua/5.1/re.lu etc. for lua coded modules
> See the discussion on page 140 of the book Programming in Lua by Roberto 
> Ierusalimschy.
> Will these locations be put on the searchpath too?
> Or will the environment variables LUA_PATH and LUA_CPATH, mentioned in 
> the above, be included in the search?

loading of extra libraries (the core libs will remain statically linked) 
will be looked into later


Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Jan  5 09:25:01 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Jan 2009 09:25:01 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <20090104192708.GI18156@phare.normalesup.org>
References: <4960C341.8090409@elvenkind.com>
	<F59534DF-9F97-4FE2-83A1-0DCA69C0EFAB@uva.nl>
	<20090104192708.GI18156@phare.normalesup.org>
Message-ID: <4961C3DD.1030208@elvenkind.com>

Arthur Reutenauer wrote:
>> I thought the lua scripts in the cont-tmf.zip distribution are residing in 
>> <texmf>/scripts/context/lua/. Is this a change or are they different files?
> 
>   Different files, see Taco's message from 17:31.
> 
>> Will these locations be put on the searchpath too?
>> Or will the environment variables LUA_PATH and LUA_CPATH, mentioned in the 
>> above, be included in the search?
> 
>   I don't know how the developers will solve that, but it's obvious that
> it needs to be handled somehow (maybe through kpathsea?  Yet another
> variable name in texmf.cnf ...).

Kpathsea has no trouble finding lua files in the tex/ path, but I 
remember talking to Karl about a specific variable a while back.
That would not be a big deal, there are so many of them already
that one extra hardly matters.

The issue about <texmf>/luatex/lua is that luatex should be able
to find these files even if kpathsea initialization is off or
delayed. That is why they have to become part of the 'compiled-in'
package.path.

If|Once kpathsea is active, luatex could simply use it for finding
the lua modules, but that may never happen and I want to have a
strong guarantee about the discoverability of the files in
<texmf>/luatex/lua.

Best wishes,
Taco

From root at www.metatex.org  Mon Jan  5 16:22:06 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  5 Jan 2009 16:22:06 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090105152502.AA0DA1E8C2C1@www.metatex.org>

svn: REPORT request failed on '/svn/luatex/!svn/vcc/default'
svn: Can't find a temporary directory: Internal error

From jfine at pytex.org  Mon Jan  5 17:20:49 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Mon, 05 Jan 2009 16:20:49 +0000
Subject: [Dev-luatex] I'll reply to Arthur's and Martin's posts next weekend
	[EOM]
Message-ID: <49623361.4070008@pytex.org>

[EOM] = End Of Message

From root at www.metatex.org  Mon Jan  5 22:22:01 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  5 Jan 2009 22:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090105212454.550091E8C2C1@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From reinhard.kotucha at web.de  Tue Jan  6 02:24:54 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 6 Jan 2009 02:24:54 +0100
Subject: [Dev-luatex] Q: Can LuaTeX produce xdv?
In-Reply-To: <20090104192059.GH18156@phare.normalesup.org>
References: <495A6D8B.6050601@pytex.org>
	<20090101200953.GO18156@phare.normalesup.org>
	<495D2B0A.1070302@pytex.org>
	<C1505D73-983E-49A2-BEF7-B707EFD27EC1@telecom-bretagne.eu>
	<495D3F1D.3040909@pytex.org>
	<68c491a60901011509j26c5014fi8de57d9ee9bcc56a@mail.gmail.com>
	<495E5FCA.70505@pytex.org>
	<68c491a60901021430s38019516y9276f9bf4b1361e@mail.gmail.com>
	<49606F93.5050204@pytex.org>
	<20090104192059.GH18156@phare.normalesup.org>
Message-ID: <18786.45798.56633.638495@zaphod.ms25.net>

Arthur Reutenauer writes:
 
 > Maybe it's time that we turn the question the other way round and ask
 > you for reasons to *do* so.  

Hi Arthur,
as far as I remember, Jonathan explained clearly at the very beginning
of the discussion why he is interested in an intermediate format.

 > What, could you please tell us, is so great about *not* generating
 > the end result directly that we should force ourselves to produce
 > an intermediate file first, [...]

What do you mean with "end result"?  Unless I completely misunderstand
everything, Jonathan does *not* intend to create PDF at all.

I assume that what Jonathan has in mind is something like

   http://www.mathtran.org/toys/jfine/editor2.html

Yes, the PDF backend is extremely expensive in this case, for several
reasons.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From root at www.metatex.org  Tue Jan  6 12:26:29 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  6 Jan 2009 12:26:29 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090106112629.BD4AA1E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1725 | hhenkel | 2009-01-06 11:41:44 +0100 (Tue, 06 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/src/texk/web2c/luatexdir/luatex.web

\pageleftoffset and \pagetopoffset patch from Taco

------------------------------------------------------------------------

From root at www.metatex.org  Tue Jan  6 16:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  6 Jan 2009 16:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090106152502.66DB41E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1726 | taco | 2009-01-06 12:07:49 +0100 (Tue, 06 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/NEWS

inport news from the 0.31.3 tag

------------------------------------------------------------------------
r1727 | taco | 2009-01-06 12:08:23 +0100 (Tue, 06 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/utils.c

add a definition of rint() from 0.31.3

------------------------------------------------------------------------
r1728 | oneiros | 2009-01-06 12:36:44 +0100 (Tue, 06 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/depend.mk

make depend

------------------------------------------------------------------------
r1729 | hhenkel | 2009-01-06 13:36:27 +0100 (Tue, 06 Jan 2009) | 30 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

DVI mode:
Positions of the page box on the page are now controlled by a pair of
variables out of the four \pageleft/right/top/bottomoffset, depending
on the direction of the page box. These offsets are measured from the
corresponding page edge. 

For the TL page box direction this remains compatible with the original
TeX setting by \hoffset and \voffset, as there are automatic links 
(if you upgrade one variable, the linked one changes correspondingly):

\pageleftoffset = \hoffset + 1in
\pagetopoffset  = \voffset + 1in

However for the other page directions this is incompatible (to aleph), 
as formerly also transformed versions of \hoffset and \voffset were used.

Which offsets to use is rather intuitive:

Boxdir. Left Offset     Right Offset     Top Offset     Bottom Offset
------------------------------------------------------ ------------------
TL, LT  \pageleftoffset                  \pagetopoffset
TR, RT                  \pagerightoffset \pagetopoffset
BL, LB  \pageleftoffset                                 \pagebottomoffset
RB, BR                  \pagerightoffset                \pagebottomoffset


TODO:
* PDF mode
* \mag != 1000 is yet to be fixed.

------------------------------------------------------------------------
r1730 | hhenkel | 2009-01-06 13:49:21 +0100 (Tue, 06 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

make \hrule and \vrule depend on the box direction rather than the
font direction

------------------------------------------------------------------------
r1731 | hhenkel | 2009-01-06 14:12:27 +0100 (Tue, 06 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

DVI: new \pagewidth and \pageheight defaults for the pathological cases
\pagewidth <= 0pt or \pageheight <= 0pt

------------------------------------------------------------------------
r1732 | hhenkel | 2009-01-06 15:37:15 +0100 (Tue, 06 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

make dvi movement macros more robust

------------------------------------------------------------------------

From root at www.metatex.org  Tue Jan  6 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  6 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090106212502.9A46F1E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1733 | taco | 2009-01-06 16:42:22 +0100 (Tue, 06 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

cleanup the math noad structures a bit; prepare them for the addition of 
attribute lists as well as the use of true unicode characters (whose ids
do not fit in a quarterword)

------------------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Wed Jan  7 11:40:42 2009
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 7 Jan 2009 11:40:42 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
References: <4960C341.8090409@elvenkind.com> <4960D495.8060304@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5FA972C7@s-yellow.net.silverstroke.de>

Hello, 

> > First the warning, for Hans in particular: make sure you start using
> > require() for all of the external lua modules that are embedded in
> > luatex. As soon as this new subsystem is in place, you can no longer
> > use functions like socket.bind() without require-ing the 
> > module first!
> 
> ok, no problem for the scripts, but i have to figure out a 
> way to embed them in the format

I use a custom package loader and bytecode registers. A toks register
is used to map Lua module names to the number of the bytecode register
the module is stored in. When require()ing a module, this toks register
is checked:

- Module exists: The bytecode register is executed.
- Modules does not exist: A new bytecode register is reserved, the
  module loaded using loadfile(), executed and stored in the bytecode
  register. Finally, the mapping is added to the toks register.

That does it. I also have a macro to do

	<global module var> = require("<module name>")

and add code to \everyjob to do this again at the start of the TeX run
if called in IniTeX.


Maybe this helps,
Jonathan

P.S: My loader is (there is a toks register \LT:T at bytecode@files which
stores the mapping from module name to bytecode register, and a count
register \LT:C at next@bytecode which stores the number of the next unused
bytecode register; ":" and "@" are letters):

local escapeChars = {
  ['^'] = '%^',
  ['$'] = '%$',
  ['('] = '%(',
  [')'] = '%)',
  ['%'] = '%%',
  ['.'] = '%.',
  ['['] = '%[',
  [']'] = '%]',
  ['*'] = '%*',
  ['+'] = '%+',
  ['-'] = '%-',
  ['?'] = '%?'
}

local function loadfile(file, name)
  local f, e = io.open(file)
  if not f then
    return f, e
  end
  local s = f:read('*a')
  f:close()
  return loadstring(s, '@' .. name)
end

local function loader(moduleName)
  local fn = moduleName .. '.klua'
  
  local t = tex.toks['LT:T at bytecode@files']
  local f, n = t:match('|(' .. fn:gsub('.', escapeChars) ..
')|=|([0-9]+)|')
  
  if f then
    texio.write_nl('')
    texio.write('(', fn, ' [from register ', n, '])')
    return lua.bytecode[n]
  else
    rn = kpse.find_file(fn, 'tex', true)
    if rn then
      f, e = loadfile(rn, moduleName)
      if f then
        if tex.formatname == '' then
          local r = tex.count['LT:C at next@bytecode']
          tex.count['LT:C at next@bytecode'] = r + 1
          
          texio.write_nl('')
          texio.write('(', rn, ' [cached in register ', r, '])')
          lua.bytecode[r] = f
          tex.toks['LT:T at bytecode@files'] = t .. '|' .. fn .. '|=|' .. r
.. '|'
        else
          texio.write_nl('')
          texio.write('(', rn, ')')
        end
        return f
      else
        return 'Loader error: ' .. e
      end
    else
      return 'Loader error: Could not find file'
    end
  end
end

package.loaders = { loader }


From pragma at wxs.nl  Wed Jan  7 12:00:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 07 Jan 2009 12:00:39 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <9343542E664B894484613D106D7D3F5FA972C7@s-yellow.net.silverstroke.de>
References: <4960C341.8090409@elvenkind.com> <4960D495.8060304@wxs.nl>
	<9343542E664B894484613D106D7D3F5FA972C7@s-yellow.net.silverstroke.de>
Message-ID: <49648B57.7000200@wxs.nl>

Jonathan Sauer wrote:
> Hello, 
> 
>>> First the warning, for Hans in particular: make sure you start using
>>> require() for all of the external lua modules that are embedded in
>>> luatex. As soon as this new subsystem is in place, you can no longer
>>> use functions like socket.bind() without require-ing the 
>>> module first!
>> ok, no problem for the scripts, but i have to figure out a 
>> way to embed them in the format

sorry for the confusion; in context i already put lots of stuff in 
bytecode registers so it's not a technical problem; more a location 
problem (because i want to be compatible) which in the meantime is 
solved by patching the mkiv file-handling lib and package.load cum suis

(the main issue is actually that all the 'normal' lua modules reside in 
the tree and are located by the file locator, while those special libs 
live somewhere else and not per se known to the environment unless 
special env vars are set/known; fyi: i don't use kpse)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Jan  7 12:10:17 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 07 Jan 2009 12:10:17 +0100
Subject: [Dev-luatex] <texmf>/luatex is coming
In-Reply-To: <9343542E664B894484613D106D7D3F5FA972C7@s-yellow.net.silverstroke.de>
References: <4960C341.8090409@elvenkind.com> <4960D495.8060304@wxs.nl>
	<9343542E664B894484613D106D7D3F5FA972C7@s-yellow.net.silverstroke.de>
Message-ID: <49648D99.40002@elvenkind.com>



Jonathan Sauer wrote:
> 
> package.loaders = { loader }

Once the new /luatex is in place, you while probably want to
change that to

  package.loaders[#package.loaders + 1] = loader

to avoid destroying the internal loaders

Best wishes,
Taco

From root at www.metatex.org  Wed Jan  7 12:26:46 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  7 Jan 2009 12:26:46 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090107112646.E70251E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1734 | taco | 2009-01-07 10:37:46 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

fix description of dir strings

------------------------------------------------------------------------
r1735 | taco | 2009-01-07 10:39:59 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

luafilesystem is now 1.4.1, and the documented version is 0.32.0

------------------------------------------------------------------------
r1736 | taco | 2009-01-07 10:52:15 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

hopefully: fix math noad leaks without introducing double-free errors

------------------------------------------------------------------------
r1737 | taco | 2009-01-07 11:00:28 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Patch for misbehaving rules (from Hartmut)

------------------------------------------------------------------------
r1738 | taco | 2009-01-07 11:02:15 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

different, bertter fix for the same issue (also from Hartmut)

------------------------------------------------------------------------

From root at www.metatex.org  Wed Jan  7 16:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  7 Jan 2009 16:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090107152505.F12AB1E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1739 | taco | 2009-01-07 15:25:51 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c

fix the node.[un]protect_glyph() functions

------------------------------------------------------------------------
r1740 | taco | 2009-01-07 15:26:39 +0100 (Wed, 07 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/src/texk/web2c/luatexdir/lua/luastuff.c
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

introduce a variable lua_active that keeps track of the
current lua call nesting level (not actively used yet)

------------------------------------------------------------------------

From root at www.metatex.org  Wed Jan  7 22:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  7 Jan 2009 22:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090107212504.42F941E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1741 | taco | 2009-01-07 16:20:45 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

minor code readability cleanups

------------------------------------------------------------------------
r1742 | taco | 2009-01-07 16:50:27 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/linebreak.c

prevent redefinition of max_dimen

------------------------------------------------------------------------
r1743 | hhenkel | 2009-01-07 20:09:31 +0100 (Wed, 07 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

ignore optional spaces after three-letter group parameters for \pagedir,
\pardir, and \textdir

------------------------------------------------------------------------
r1744 | hhenkel | 2009-01-07 20:13:16 +0100 (Wed, 07 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

add \pageleftoffset and \pagetopoffset to the manual

------------------------------------------------------------------------

From khaledhosny at eglug.org  Wed Jan  7 22:37:09 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 7 Jan 2009 09:37:09 -1200
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
	directions
Message-ID: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>

The image node placement code doesn't doesn't handle directional
changes, which results in wrong placement of images in right-left (and
other) directions, see the attached simple test suit (all images
should fit into the frames).
This patch attempts to fix this, but it does handle _LT/_LB and
_RT/_RB only, as I can't test the others in PDF mode.

Regards,

-- 
  Khaled
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.zip
Type: application/zip
Size: 11231 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090107/c8a3013a/attachment-0001.zip>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex.web.diff
Type: application/octet-stream
Size: 1067 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090107/c8a3013a/attachment-0001.obj>

From hartmut_henkel at gmx.de  Thu Jan  8 00:51:26 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 8 Jan 2009 00:51:26 +0100 (CET)
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
 directions
In-Reply-To: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>

Hi Khaled,

On Wed, 7 Jan 2009, Khaled Hosny wrote:

> The image node placement code doesn't doesn't handle directional
> changes, which results in wrong placement of images in right-left (and
> other) directions, see the attached simple test suit (all images
> should fit into the frames). This patch attempts to fix this, but it
> does handle _LT/_LB and _RT/_RB only, as I can't test the others in
> PDF mode.

thanks for the patch and test files, looks fine. One question is not
clear to me: Why do you use font_direction() and not box_direction()? E.
g., dir_TL_ instead of dir__LT? Isn't an image something line/page
oriented? Would you run into problems if images would be box_direction()
based? You can still move them perpendicularly to the base line by
height/depth.

(I just switched rule handling to box_direction(), it was also based on
font_direction, but many directions didn't produce a rule at all.)

Regards, Hartmut

From yuleopen at gmail.com  Thu Jan  8 07:30:40 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 8 Jan 2009 06:30:40 +0000
Subject: [Dev-luatex] Cannot use beamer class.
Message-ID: <68bfdc900901072230h34dbf78kf996a6cc84d6f1be@mail.gmail.com>

Hi, Taco:

I am using beamer in TL08, pdflatex runs fine, but luatex produce an error.
I run the sample code from http://latex-beamer.sourceforge.net/. the
code is attached in the mail.

[yue at localhost ~]$ pdflualatex a
This is LuaTeX, Version snapshot-0.25.4-2008071905 (Web2C 7.5.7)
(a.tex
LaTeX2e <2005/12/01>
Babel <v3.8l> and hyphenation patterns for english, usenglishmax, dumylang, noh
yphenation, german-x-2008-06-18, ngerman-x-2008-06-18, ancientgreek, ibycus, ar
abic, basque, bulgarian, catalan, pinyin, coptic, croatian, czech, danish, dutc
h, esperanto, estonian, farsi, finnish, french, galician, german, ngerman, mono
greek, greek, hungarian, icelandic, indonesian, interlingua, irish, italian, la
tin, mongolian, mongolian2a, bokmal, nynorsk, polish, portuguese, romanian, rus
sian, sanskrit, serbian, slovak, slovenian, spanish, swedish, turkish, ukenglis
h, ukrainian, uppersorbian, welsh, loaded.
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamer.cls
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasercs.sty)
Document Class: beamer 2007/03/11 cvs version 3.07 A class for typesetting pres
entations (rcs-revision 1.70)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasemodes.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasedecode.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseoptions.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/graphics/keyval.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/pgf/basiclayer/pgfcore.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/graphics/graphicx.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/graphics/graphics.sty
(/usr/local/texlive/2008/texmf-dist/tex/fontinst/base/trig.sty)
(/usr/local/texlive/2008/texmf/tex/latex/config/graphics.cfg)
(/usr/local/texlive/2008/texmf-dist/tex/latex/pdftex-def/pdftex.def
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/infwarerr.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
(/usr/local/texlive/2008/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua))
(/usr/local/texlive/2008/texmf-dist/scripts/oberdiek/oberdiek.pdftexcmds.lua)))
)) (/usr/local/texlive/2008/texmf-dist/tex/latex/pgf/systemlayer/pgfsys.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/pgf/utilities/pgfrcs.sty
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/utilities/pgfutil-common.te
x)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/utilities/pgfutil-latex.def
) (/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/utilities/pgfrcs.code.tex
))
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgfsys.code.tex
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/utilities/pgfkeys.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgf.cfg)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgfsys-pdftex.d
ef
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgfsys-common-p
df.def)))
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgfsyssoftpath.
code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/systemlayer/pgfsysprotocol.
code.tex)) (/usr/local/texlive/2008/texmf-dist/tex/latex/xcolor/xcolor.sty
(/usr/local/texlive/2008/texmf/tex/latex/config/color.cfg))
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcore.code.tex
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmath.code.tex
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathcalc.code.tex
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathutil.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathparser.code.tex
)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathoperations.code
.tex
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathtrig.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathrnd.code.tex))
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/math/pgfmathbase.code.tex))
)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorepoints.co
de.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorepathconst
ruct.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorepathusage
.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorescopes.co
de.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoregraphicst
ate.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoretransform
ations.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorequick.cod
e.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoreobjects.c
ode.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorepathproce
ssing.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorearrows.co
de.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoreshade.cod
e.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoreimage.cod
e.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorelayers.co
de.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcoretranspare
ncy.code.tex)
(/usr/local/texlive/2008/texmf-dist/tex/generic/pgf/basiclayer/pgfcorepatterns.
code.tex)))
(/usr/local/texlive/2008/texmf-dist/tex/latex/pgf/basiclayer/pgfbaseimage.sty

Package pgf Warning: This package is obsolete and no longer needed on input lin
e 13.

) (/usr/local/texlive/2008/texmf-dist/tex/latex/pgf/utilities/xxcolor.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsfonts/amssymb.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsfonts/amsfonts.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/geometry/geometry.sty
(/usr/local/texlive/2008/texmf-dist/tex/xelatex/xetexconfig/geometry.cfg))
(/usr/local/texlive/2008/texmf-dist/tex/latex/hyperref/hyperref.sty
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/ifpdf.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/ifvtex.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/ifxetex/ifxetex.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/oberdiek/hycolor.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/hyperref/pd1enc.def)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/etexcmds.sty)
(/usr/local/texlive/2008/texmf/tex/latex/config/hyperref.cfg)
(/usr/local/texlive/2008/texmf-dist/tex/latex/oberdiek/kvoptions.sty)
Implicit mode OFF; no redefinition of LaTeX internals
(/usr/local/texlive/2008/texmf-dist/tex/latex/ltxmisc/url.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/bitset.sty
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/intcalc.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/bigintcalc.sty))
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/kvsetkeys.sty)
(/usr/local/texlive/2008/texmf-dist/tex/generic/oberdiek/atbegshi.sty)

Package hyperref Warning: Option `pdfpagelabels' is turned off
(hyperref)                because \thepage is undefined.

Hyperref stopped early
)
*hyperref using default driver hpdftex*
(/usr/local/texlive/2008/texmf-dist/tex/latex/hyperref/hpdftex.def)
(/usr/local/texlive/2008/texmf-dist/tex/latex/base/size11.clo)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasecompatibility.st
y) (/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasefont.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasemisc.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasetwoscreens.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseoverlay.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasetitle.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasesection.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseframe.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseverbatim.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseframesize.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseframecomponents.
sty) (/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasecolor.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasenotes.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasetoc.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasetemplates.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseauxtemplates.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaseboxes.sty)))
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbaselocalstructure.s
ty (/usr/local/texlive/2008/texmf-dist/tex/latex/tools/enumerate.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasenavigation.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasetheorems.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/translator/translator.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/translator/translator-language-ma
ppings.tex)) (/usr/local/texlive/2008/texmf-dist/tex/latex/amsmath/amsmath.sty
For additional information on amsmath, use the `?' option.
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsmath/amstext.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsmath/amsgen.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsmath/amsbsy.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/amsmath/amsopn.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/amscls/amsthm.sty))
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/beamerbasethemes.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/themes/theme/beamerthemede
fault.sty
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/themes/font/beamerfontthem
edefault.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/themes/color/beamercolorth
emedefault.sty)
(/usr/local/texlive/2008/texmf-dist/tex/latex/beamer/themes/inner/beamerinnerth
emedefault.sty
!luaTeX error (file beamericonbook.pdf): PDF inclusion: invalid destination </I
nterpolate false >
 ==> Fatal error occurred, no output PDF file produced!
[yue at localhost ~]$
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.tex
Type: application/x-tex
Size: 518 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090108/1ae00cc4/attachment.tex>

From taco at elvenkind.com  Thu Jan  8 09:10:09 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 08 Jan 2009 09:10:09 +0100
Subject: [Dev-luatex] Cannot use beamer class.
In-Reply-To: <68bfdc900901072230h34dbf78kf996a6cc84d6f1be@mail.gmail.com>
References: <68bfdc900901072230h34dbf78kf996a6cc84d6f1be@mail.gmail.com>
Message-ID: <4965B4E1.3030200@elvenkind.com>

Yue Wang wrote:
> Hi, Taco:
> 
> I am using beamer in TL08, pdflatex runs fine, but luatex produce an error.
> I run the sample code from http://latex-beamer.sourceforge.net/. the
> code is attached in the mail.

Before I dive into this myself, can someone please try with a new
luatex? It is quite possible that the newer pdftex that was merged
into 0.30.X fixes this bug.

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Thu Jan  8 11:28:39 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 08 Jan 2009 11:28:39 +0100
Subject: [Dev-luatex] Cannot use beamer class.
In-Reply-To: <4965B4E1.3030200@elvenkind.com>
References: <68bfdc900901072230h34dbf78kf996a6cc84d6f1be@mail.gmail.com>
	<4965B4E1.3030200@elvenkind.com>
Message-ID: <4965D557.1010206@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Yue Wang wrote:
>> Hi, Taco:
>>
>> I am using beamer in TL08, pdflatex runs fine, but luatex produce an 
>> error.
>> I run the sample code from http://latex-beamer.sourceforge.net/. the
>> code is attached in the mail.
>
> Before I dive into this myself, can someone please try with a new
> luatex? It is quite possible that the newer pdftex that was merged
> into 0.30.X fixes this bug.

Hello,

With a LuaTeX svn rev. 1724, it works fine on my computer in dvi and pdf 
mode. With TL 2007, I had to convert url.sty in UTF-8, but I think it is 
not linked.
-- 
Elie

From taco at elvenkind.com  Thu Jan  8 12:59:51 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 08 Jan 2009 12:59:51 +0100
Subject: [Dev-luatex] Cannot use beamer class.
In-Reply-To: <4965D557.1010206@telecom-bretagne.eu>
References: <68bfdc900901072230h34dbf78kf996a6cc84d6f1be@mail.gmail.com>	<4965B4E1.3030200@elvenkind.com>
	<4965D557.1010206@telecom-bretagne.eu>
Message-ID: <4965EAB7.8020401@elvenkind.com>

Elie Roux wrote:
> With a LuaTeX svn rev. 1724, it works fine on my computer in dvi and pdf 
> mode. With TL 2007, I had to convert url.sty in UTF-8, but I think it is 
> not linked.

Thank you.

Best wishes,
Taco

From root at www.metatex.org  Thu Jan  8 16:25:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  8 Jan 2009 16:25:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090108152507.CD1D01E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1745 | taco | 2009-01-08 14:54:20 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lang/texlang.c

fix a compiler warning

------------------------------------------------------------------------
r1746 | taco | 2009-01-08 14:57:06 +0100 (Thu, 08 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.ch
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

Remove some of the code publication for node types between 
the pascal and C code; and prepare the data structures for the
creation of five new math-related node types

------------------------------------------------------------------------

From khaledhosny at eglug.org  Thu Jan  8 20:50:07 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 8 Jan 2009 07:50:07 -1200
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
	directions
In-Reply-To: <alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
Message-ID: <a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>

On Wed, Jan 7, 2009 at 11:51 AM, Hartmut Henkel <hartmut_henkel at gmx.de> wrote:
> Hi Khaled,
>
> On Wed, 7 Jan 2009, Khaled Hosny wrote:
>
>> The image node placement code doesn't doesn't handle directional
>> changes, which results in wrong placement of images in right-left (and
>> other) directions, see the attached simple test suit (all images
>> should fit into the frames). This patch attempts to fix this, but it
>> does handle _LT/_LB and _RT/_RB only, as I can't test the others in
>> PDF mode.
>
> thanks for the patch and test files, looks fine. One question is not
> clear to me: Why do you use font_direction() and not box_direction()? E.
> g., dir_TL_ instead of dir__LT? Isn't an image something line/page
> oriented? Would you run into problems if images would be box_direction()
> based? You can still move them perpendicularly to the base line by
> height/depth.
>
> (I just switched rule handling to box_direction(), it was also based on
> font_direction, but many directions didn't produce a rule at all.)
>
> Regards, Hartmut
>

I was working on an older svn revision and I tried to follow rule handling.
I redid it to use box_direction instead, I didn't spot any problems so far.

-- 
  Khaled
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex.web.diff
Type: application/octet-stream
Size: 1576 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090108/72a652a2/attachment.obj>

From root at www.metatex.org  Thu Jan  8 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  8 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090108212502.6387B1E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1747 | oneiros | 2009-01-08 16:22:01 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h

fix a compiler warning: expected declaration specifiers or ?\226?\128?\152...?\226?\128?\153 before ?\226?\128?\152(?\226?\128?\153 token

------------------------------------------------------------------------
r1748 | oneiros | 2009-01-08 21:17:50 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

zap some warnings: cast from pointer to integer of different size

------------------------------------------------------------------------
r1749 | oneiros | 2009-01-08 21:24:51 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

indent

------------------------------------------------------------------------
r1750 | oneiros | 2009-01-08 21:32:12 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

s/pdftex/luatex/

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan  9 12:26:35 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  9 Jan 2009 12:26:35 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090109112635.662591E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1751 | oneiros | 2009-01-08 22:31:38 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   A /trunk/NEWS

make the NEWS more prominent

------------------------------------------------------------------------
r1752 | oneiros | 2009-01-08 22:39:33 +0100 (Thu, 08 Jan 2009) | 2 lines
Changed paths:
   D /trunk/src/texk/web2c/luatexdir/macnames.c

rm unneeded symlink

------------------------------------------------------------------------
r1753 | taco | 2009-01-09 10:59:49 +0100 (Fri, 09 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Output the 'There is no X in font' warning as Unicode Hex notation instead of decimal

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan  9 16:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  9 Jan 2009 16:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090109152504.450A11E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1754 | taco | 2009-01-09 12:04:58 +0100 (Fri, 09 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

fix bugs in subscripts and simple nuclei

------------------------------------------------------------------------
r1755 | taco | 2009-01-09 15:52:28 +0100 (Fri, 09 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.h
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

move the definition and initialization of the special node heads to C

------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Fri Jan  9 22:30:02 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri, 9 Jan 2009 22:30:02 +0100 (CET)
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
 directions
In-Reply-To: <a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>

Hi Khaled,

On Thu, 8 Jan 2009, Khaled Hosny wrote:

> I was working on an older svn revision and I tried to follow rule
> handling. I redid it to use box_direction instead, I didn't spot any
> problems so far.

thanks again, i have applied it. But i'm now not sure anymore if it is
allowed to change font_direction to box_direction (as i proposed) in the
output part, since the TeX machinery may assign e. g., height/depth to
"running" \vrules and to the surrounding hboxes depending of orientation
of internal stuff. This needs to be in sync with the output part. I'll
try to check how things are packed. So maybe the font_dir --> box_dir
patch needs to be reverted...

Regards, Hartmut

From root at www.metatex.org  Fri Jan  9 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  9 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090109212502.88B3A1E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1756 | taco | 2009-01-09 16:29:15 +0100 (Fri, 09 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

remove some unneeded @d's 

------------------------------------------------------------------------
r1757 | hhenkel | 2009-01-09 20:59:55 +0100 (Fri, 09 Jan 2009) | 5 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Patch by Khaled Hosny fixes wrong image node placement in RL dir, 
see E-Mail 7 Jan 2009 09:37:09 -1200, To: luatex development list
<dev-luatex at ntg.nl>, Subject: [Dev-luatex] Wrong placement of image
nodes in non left-right directions.

------------------------------------------------------------------------

From khaledhosny at eglug.org  Fri Jan  9 22:24:45 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 9 Jan 2009 23:24:45 +0200
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
	directions
In-Reply-To: <alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
Message-ID: <a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>

On Fri, Jan 9, 2009 at 11:30 PM, Hartmut Henkel <hartmut_henkel at gmx.de> wrote:
> Hi Khaled,
>
> On Thu, 8 Jan 2009, Khaled Hosny wrote:
>
>> I was working on an older svn revision and I tried to follow rule
>> handling. I redid it to use box_direction instead, I didn't spot any
>> problems so far.
>
> thanks again, i have applied it. But i'm now not sure anymore if it is
> allowed to change font_direction to box_direction (as i proposed) in the
> output part, since the TeX machinery may assign e. g., height/depth to
> "running" \vrules and to the surrounding hboxes depending of orientation
> of internal stuff. This needs to be in sync with the output part. I'll
> try to check how things are packed. So maybe the font_dir --> box_dir
> patch needs to be reverted...
>
Thanks!
I'll try to look at it again next week (quite busy now), I'm trying to
understand
I'm trying to understand more how this stuff works.

Regards,

-- 
  Khaled

From root at www.metatex.org  Sat Jan 10 12:26:23 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 10 Jan 2009 12:26:23 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090110112623.B47A41E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1758 | hhenkel | 2009-01-10 10:03:55 +0100 (Sat, 10 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

added symbolic printing of primitives \*dir

------------------------------------------------------------------------

From root at www.metatex.org  Sun Jan 11 12:26:41 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 11 Jan 2009 12:26:41 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090111112641.E4A861E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1759 | hhenkel | 2009-01-10 22:55:50 +0100 (Sat, 10 Jan 2009) | 36 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h

DVI:
The goal is to make dvi_h & dvi_v in DVI mode running similar to pdf_h 
& pdf_v in PDF mode, to have backends working in page coordinates with
similar calculations and positioning:

DVI: cur_h/v --(synch_page_coordinates)--> page_h/v --> dvi_h/v
PDF: cur_h/v --(synch_page_coordinates)--> page_h/v --> pdf_h/v

* cur_h & cur_v are in a local box coordinate system, from there the
transform into global page coordinates page_h & page_v goes by macro
synch_page_coordinates. This uses the current box origin in page
coordinates, which is stored in box_pg_h and box_pg_v.

* dvi_h & dvi_v are now in global page coordinates, measured from the 
lower left page corner (pdf_h & pdf_v will be in the same coordinate
system).

* From page_h & page_v, dvi_h & dvi_v are synchronized by macros synch_h 
& synch_v, simultaneously DVI commands are written to the DVI file,
so that dvi_h & dvi_v keep track of the global position in the DVI file.

* Commands outputting DVI movement codes now also update dvi_h & dvi_v.

* Explicit DVI movements _after_ outputting rules or glyphs have been
removed; they are done automatically with the next item that is output
(sometimes this slightly reduces the DVI file size).

* Procedure movement() has been simplified, as the synch_page_coordinates
macro does the transform now.

* @<Output a reflection instruction...@> is now more similar to @<(PDF)
Output a reflection instruction...@>.  This required to increase the
dir_node_size to 6, see nodes.h.

* Code for macros dvi_right/left/down/up has been put into begin...end.

------------------------------------------------------------------------
r1760 | hhenkel | 2009-01-11 09:28:48 +0100 (Sun, 11 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

remove redundant synch_dvi

------------------------------------------------------------------------

From root at www.metatex.org  Sun Jan 11 16:25:01 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 11 Jan 2009 16:25:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090111152501.DA0261E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1761 | oneiros | 2009-01-11 12:39:52 +0100 (Sun, 11 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

rm unused variables
move copyright to 2009

------------------------------------------------------------------------
r1762 | taco | 2009-01-11 14:08:54 +0100 (Sun, 11 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

allow setting of \bodydir and \pagedir after the first page also

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 12 16:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 12 Jan 2009 16:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090112152504.E4CC01E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1763 | taco | 2009-01-12 15:33:11 +0100 (Mon, 12 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

allow user-defined whatsits to stay in the node lists, and degrade
the confusion() when a value type is unknown to just a tex_error().

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 12 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 12 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090112212502.DC3401E8C2CB@www.metatex.org>

------------------------------------------------------------------------
r1764 | taco | 2009-01-12 16:23:59 +0100 (Mon, 12 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

remove a few unused macros

------------------------------------------------------------------------
r1765 | taco | 2009-01-12 16:34:02 +0100 (Mon, 12 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

fix initex math family initialization for \fams 16-255

------------------------------------------------------------------------

From taco at elvenkind.com  Tue Jan 13 09:21:47 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 13 Jan 2009 09:21:47 +0100
Subject: [Dev-luatex] Check your posts
Message-ID: <496C4F1B.4090502@elvenkind.com>

Hi all,

Since yesterday evening localtime the ntg mail server switched to an
external service for spam filtering. It is already clear that the
mail server indeed handles much less spam now, so it looks like a
great success.

Still, it is a rigorous change, and for the new few days I want
to ask everybody to keep an eye out for disappearing posts.

This message is crossposted. If you want to reply, please do so
to me personally, not to the lists.

Best wishes,
Taco

From root at www.metatex.org  Wed Jan 14 22:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 14 Jan 2009 22:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090114212504.C59AB1E8C2CD@www.metatex.org>

------------------------------------------------------------------------
r1766 | taco | 2009-01-14 17:15:49 +0100 (Wed, 14 Jan 2009) | 20 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/commands.h
   M /trunk/src/texk/web2c/luatexdir/lua/luatoken.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.h
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/managed-sa.c
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

A (fairly large) preliminary patch to clean and extend the math frontend.

* bugfix for \odelcode
* move as much of the math processing out of the web file as is 
  currently possible
* reorganize the parsing of mathcodes and delcodes
* mathcodes and delcodes are now stored in proper structures,
  except when predefined as a mathchardef (the structures cannot
  be stored directly, so the numeric representation is used instead
  for mathchardefs)
* \tracingassings and \tracingrestores now works again for mathcodes
  and delcodes.
* new primitives: \LuaTeXmathchardef, \LuaTeXdelimiter, \LuaTeXmathaccent,
  \LuaTeXmathchar, \LuaTeXmathcharnum, \LuaTeXradical, \LuaTeXmathcode,
  \LuaTeXmathcodenum, \LuaTeXdelcode, \LuaTeXdelcodenum
  (these all follow the \XeTeX... extended syntax)
* a new command code (xmath_given) is added; that was needed for the new 
  \LuaTeXmathchardef


------------------------------------------------------------------------
r1767 | oneiros | 2009-01-14 17:46:02 +0100 (Wed, 14 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

init some variables, signal confusion

------------------------------------------------------------------------
r1768 | oneiros | 2009-01-14 17:48:43 +0100 (Wed, 14 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

indent

------------------------------------------------------------------------
r1769 | oneiros | 2009-01-14 17:49:49 +0100 (Wed, 14 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c

indent

------------------------------------------------------------------------

From martin at oneiros.de  Thu Jan 15 11:45:02 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Thu, 15 Jan 2009 11:45:02 +0100
Subject: [Dev-luatex] buglet in pdftex/luatex
Message-ID: <68c491a60901150245t2fb00001ica30e6833807c332@mail.gmail.com>

Hi,
we just noticed two buglets with \pdfstartlink/\pdfendlink:
- \pdfstartlink nodes are printed as pdflink
- The saved nested level of \pdf*link is only a small_number (0..63),
  while cur_s is an integer. This doesn't work. :-)
  This also means that \pdf*link only work at the first 63 levels (or
  since we are in web2c, they work till level 127 (signed char)). And
  yes, we need this. :-)

Here are patches for both:

@@ -34835,7 +34835,7 @@
     print_mark(pdf_annot_data(p));
 end;
 pdf_start_link_node: begin
-    print_esc("pdflink");
+    print_esc("pdfstartlink");
     @<Display <rule spec> for whatsit node created by \pdfTeX@>;
     if pdf_link_attr(p) <> null then begin
         print(" attr");
@@ -35583,7 +35583,7 @@

 @ @<Types...@>=
 @!pdf_link_stack_record = record
-    nesting_level: small_number;
+    nesting_level: integer;
     link_node: pointer; {holds a copy of the corresponding
|pdf_start_link_node|}
     ref_link_node: pointer; {points to original |pdf_start_link_node|, or a
                              copy of |link_node| created by |append_link| in

From taco at elvenkind.com  Thu Jan 15 12:00:42 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jan 2009 12:00:42 +0100
Subject: [Dev-luatex] buglet in pdftex/luatex
In-Reply-To: <68c491a60901150245t2fb00001ica30e6833807c332@mail.gmail.com>
References: <68c491a60901150245t2fb00001ica30e6833807c332@mail.gmail.com>
Message-ID: <496F175A.6060804@elvenkind.com>



Martin Schr?der wrote:
> Hi,
> we just noticed two buglets with \pdfstartlink/\pdfendlink:
> - \pdfstartlink nodes are printed as pdflink
> - The saved nested level of \pdf*link is only a small_number (0..63),

Applied, thanks.

Best wishes,
Taco

From root at www.metatex.org  Thu Jan 15 12:26:27 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 15 Jan 2009 12:26:27 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090115112627.CA5B81E8C2CD@www.metatex.org>

------------------------------------------------------------------------
r1770 | hhenkel | 2009-01-15 00:41:15 +0100 (Thu, 15 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Work through @<Output node |p| for |hlist_out|...@> for all 16 font
directions, for "natural" and "non-natural" fonts. But procedure hpack()
still handles only the few major cases correctly.

------------------------------------------------------------------------
r1771 | taco | 2009-01-15 11:31:17 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/utils.c

make divide_scaled_n round in the correct direction

------------------------------------------------------------------------
r1772 | taco | 2009-01-15 11:33:42 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

increase size of the pdf_link_stack_record.nesting_level to integer

------------------------------------------------------------------------
r1773 | taco | 2009-01-15 11:37:02 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

the correct show of pdf_start_link_node is \pdfstartlink

------------------------------------------------------------------------

From root at www.metatex.org  Thu Jan 15 16:25:03 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 15 Jan 2009 16:25:03 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090115152503.4C5E21E8C2CD@www.metatex.org>

------------------------------------------------------------------------
r1774 | taco | 2009-01-15 15:47:17 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/utils.c

fix rounding in divide_scaled_n for sure

------------------------------------------------------------------------
r1775 | taco | 2009-01-15 15:48:06 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

the 'rounding' of pdf_font_size() is not safe

------------------------------------------------------------------------

From root at www.metatex.org  Thu Jan 15 22:25:03 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 15 Jan 2009 22:25:03 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090115212503.75CC31E8C2CD@www.metatex.org>

------------------------------------------------------------------------
r1776 | taco | 2009-01-15 15:59:05 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/utils.c

fix some compiler warnings

------------------------------------------------------------------------
r1777 | taco | 2009-01-15 16:11:51 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix handling of non-math items in the second pass of mlist_to_hlist

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan 16 12:26:19 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 16 Jan 2009 12:26:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090116112619.6B7C41E8C3AA@www.metatex.org>

------------------------------------------------------------------------
r1778 | hhenkel | 2009-01-15 23:08:52 +0100 (Thu, 15 Jan 2009) | 2 lines
Changed paths:
   A /trunk/manual/graphics
   A /trunk/manual/graphics/Makefile
   A /trunk/manual/graphics/fontdir.fig
   A /trunk/manual/graphics/fontdir.pdf

font direction sketch (sorry, only .fig, mpost to follow)

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan 16 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 16 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090116212502.B529B1E8C3AA@www.metatex.org>

------------------------------------------------------------------------
r1779 | taco | 2009-01-16 17:03:56 +0100 (Fri, 16 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/linebreak.c

fix a nasty line breaking bug where all lines except the first 
one believed that they where wider then they really were. (This 
affected which nodes were considered active breakpoints)

------------------------------------------------------------------------
r1780 | taco | 2009-01-16 17:05:42 +0100 (Fri, 16 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h

implement a small speedup for add_kern_before and add_kern_after: there is no 
need to do run has_kern() twice

------------------------------------------------------------------------

From root at www.metatex.org  Sat Jan 17 12:26:33 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 17 Jan 2009 12:26:33 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090117112634.00E051E8C3AA@www.metatex.org>

------------------------------------------------------------------------
r1781 | taco | 2009-01-17 11:22:14 +0100 (Sat, 17 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/src/luafflib.c

make feature file application work again

------------------------------------------------------------------------

From root at www.metatex.org  Sun Jan 18 16:25:06 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 18 Jan 2009 16:25:06 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090118152506.279581E8C3EF@www.metatex.org>

------------------------------------------------------------------------
r1782 | oneiros | 2009-01-18 13:45:46 +0100 (Sun, 18 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

add missing declaration

------------------------------------------------------------------------
r1783 | oneiros | 2009-01-18 13:51:01 +0100 (Sun, 18 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/dofont.c
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/src/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/src/texk/web2c/luatexdir/font/subfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h
   M /trunk/src/texk/web2c/luatexdir/font/writefont.c
   M /trunk/src/texk/web2c/luatexdir/font/writetype0.c
   M /trunk/src/texk/web2c/luatexdir/font/writetype2.c
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/utils.c

indent

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 19 22:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 19 Jan 2009 22:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090119212505.61F1A1E8C3AA@www.metatex.org>

------------------------------------------------------------------------
r1784 | taco | 2009-01-19 16:16:46 +0100 (Mon, 19 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

fix unset_attribute

------------------------------------------------------------------------

From root at www.metatex.org  Tue Jan 20 12:26:42 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 20 Jan 2009 12:26:42 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090120112642.94BD61E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1785 | hhenkel | 2009-01-19 22:21:44 +0100 (Mon, 19 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h

DVI mode:
new record type "position" contains h,v:scaled pair.
new variable pos; pos.h and pos.v replace page_h and page_v.

------------------------------------------------------------------------
r1786 | taco | 2009-01-20 09:08:20 +0100 (Tue, 20 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/utils.c

divide_scaled_n should return the rounded result, of course

------------------------------------------------------------------------

From khaledhosny at eglug.org  Tue Jan 20 14:27:34 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 20 Jan 2009 15:27:34 +0200
Subject: [Dev-luatex] Wrong placement of image nodes in non
	left-right	directions
In-Reply-To: <a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
	<a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
Message-ID: <20090120132734.GA15700@khaled-laptop>

On Fri, Jan 09, 2009 at 11:24:45PM +0200, Khaled Hosny wrote:
> > thanks again, i have applied it. But i'm now not sure anymore if it is
> > allowed to change font_direction to box_direction (as i proposed) in the
> > output part, since the TeX machinery may assign e. g., height/depth to
> > "running" \vrules and to the surrounding hboxes depending of orientation
> > of internal stuff. This needs to be in sync with the output part. I'll
> > try to check how things are packed. So maybe the font_dir --> box_dir
> > patch needs to be reverted...
> >
> Thanks!
> I'll try to look at it again next week (quite busy now), I'm trying to
> understand
> I'm trying to understand more how this stuff works.

This new patch fixes BL_ and BR_ directions in vlist, it wasn't working
properly with the former patch.

Regards,

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
Index: luatex.web
===================================================================
--- luatex.web	(revision 1786)
+++ luatex.web	(working copy)
@@ -30106,14 +30106,12 @@
     end;
   dir_BL_: begin
     cur_h:=left_edge;
-    cur_v:=cur_v+pdf_height(p);
     end;
   dir_TR_: begin
-    cur_h:=cur_h-pdf_width(p);
+    cur_h:=left_edge-pdf_width(p);
     end;
   dir_BR_: begin
-    cur_h:=cur_h-pdf_width(p);
-    cur_v:=cur_v+pdf_height(p);
+    cur_h:=left_edge-pdf_width(p);
     end;
   othercases cur_h:=left_edge;
   endcases;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090120/2dc9b761/attachment.bin>

From root at www.metatex.org  Tue Jan 20 22:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 20 Jan 2009 22:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090120212505.97F741E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1787 | hhenkel | 2009-01-20 21:25:58 +0100 (Tue, 20 Jan 2009) | 5 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

PDF mode: Another patch by Khaled Hosny fixes image placement in RL dir
in vlists, see E-Mail 20 Jan 2009 15:27:34 +0200 Cc: luatex development
list <dev-luatex at ntg.nl> Subject: Re: [Dev-luatex] Wrong placement of
image nodes in non left-right directions

------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Wed Jan 21 00:36:49 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed, 21 Jan 2009 00:36:49 +0100 (CET)
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
 directions
In-Reply-To: <20090120132734.GA15700@khaled-laptop>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
	<a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
	<20090120132734.GA15700@khaled-laptop>
Message-ID: <alpine.DEB.1.00.0901210029570.27782@hahepc1.hahe>

On Tue, 20 Jan 2009, Khaled Hosny wrote:

> This new patch fixes BL_ and BR_ directions in vlist, it wasn't
> working properly with the former patch.

thanks a lot, but it seems it's not sufficient. The hpack/vpack
algorithms don't get the right image dimensions, so the surrounding box
sizes aren't calculated right and therefore \hrules and \vrules around
the pictures are not always correct (i won't touch this now).

Regards, Hartmut

From root at www.metatex.org  Wed Jan 21 12:26:42 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 21 Jan 2009 12:26:42 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090121112642.1EB601E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1788 | hhenkel | 2009-01-20 22:07:57 +0100 (Tue, 20 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

DVI mode:
Analog to rev. 1785, dvi_h --> dvi.h, dvi_v --> dvi.v

------------------------------------------------------------------------
r1789 | oneiros | 2009-01-20 23:29:44 +0100 (Tue, 20 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

rm unused variable

------------------------------------------------------------------------
r1790 | oneiros | 2009-01-20 23:31:18 +0100 (Tue, 20 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

add missing declaration

------------------------------------------------------------------------
r1791 | taco | 2009-01-21 10:32:15 +0100 (Wed, 21 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

move print_write_whatsit to C and only dump the page box 
information for pages that are actually shipped out

------------------------------------------------------------------------
r1792 | taco | 2009-01-21 10:38:42 +0100 (Wed, 21 Jan 2009) | 5 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

* change the math nucleus/subscr/supscr node fields to become
standalone nodes.
* fix handling of \XeTeXmathcharnum
* various small other changes to mlist.c and math.c

------------------------------------------------------------------------
r1793 | taco | 2009-01-21 10:43:49 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

bump the version number a bit

------------------------------------------------------------------------
r1794 | taco | 2009-01-21 10:47:11 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

rename the new math primitives from \LuaTeX... to \U....

------------------------------------------------------------------------
r1795 | oneiros | 2009-01-21 11:04:01 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

remove "warning: suggest parentheses around && within ||"

------------------------------------------------------------------------
r1796 | taco | 2009-01-21 11:22:38 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

update the manual for the new primitives

------------------------------------------------------------------------
r1797 | taco | 2009-01-21 11:23:43 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/texmath.h

fix scripts_allowed()

------------------------------------------------------------------------

From root at www.metatex.org  Wed Jan 21 16:25:01 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 21 Jan 2009 16:25:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090121152501.33D741E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1798 | taco | 2009-01-21 13:21:28 +0100 (Wed, 21 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

clean up mathcodes.c for the new primitive names and for the 
wrong handling of  \U..num packing order

------------------------------------------------------------------------
r1799 | taco | 2009-01-21 14:31:28 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

make the delimiter fields standalone nodes also

------------------------------------------------------------------------
r1800 | taco | 2009-01-21 14:34:22 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h

left_noad and right_noad can be one word smaller also

------------------------------------------------------------------------
r1801 | taco | 2009-01-21 14:53:51 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

free delim_nodes

------------------------------------------------------------------------
r1802 | taco | 2009-01-21 15:42:20 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

free accent_chr fields

------------------------------------------------------------------------
r1803 | taco | 2009-01-21 15:54:31 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

flush denominator and numerator of fractions

------------------------------------------------------------------------
r1804 | taco | 2009-01-21 16:18:20 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

free run-of-the-mill nuclei and super/subscipt fields

------------------------------------------------------------------------

From root at www.metatex.org  Wed Jan 21 22:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 21 Jan 2009 22:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090121212504.BEB2C1E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1805 | taco | 2009-01-21 16:25:26 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

flush the math_list of remaining sub_box_nodes

------------------------------------------------------------------------
r1806 | taco | 2009-01-21 16:36:31 +0100 (Wed, 21 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

free the super/subscripts of \mathop\limits

------------------------------------------------------------------------
r1807 | taco | 2009-01-21 16:55:03 +0100 (Wed, 21 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/commands.h
   M /trunk/src/texk/web2c/luatexdir/luatex.ch
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

do away with the local_par and local_par_bool  fields in the nest
(were not used anyway) and rename the C macro local_par() to loc_par()
to avoid confusion

------------------------------------------------------------------------
r1808 | hhenkel | 2009-01-21 20:56:56 +0100 (Wed, 21 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

PDF mode:
1st pieces of multidir positioning patch (not activated yet)

------------------------------------------------------------------------

From yuleopen at gmail.com  Thu Jan 22 05:00:03 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 22 Jan 2009 04:00:03 +0000
Subject: [Dev-luatex] bug in math mode
Message-ID: <68bfdc900901212000o42fffc6eqc7b3c1b84f1c98a0@mail.gmail.com>

Hi, Taco:

I built the trunk today and found one bug.
version:
This is LuaTeX, Version snapshot-0.33.0-2009012203, build

Yue Wang
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a.tex
Type: application/x-tex
Size: 630 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090122/ea2776fb/attachment.tex>

From taco at elvenkind.com  Thu Jan 22 10:01:30 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 22 Jan 2009 10:01:30 +0100
Subject: [Dev-luatex] bug in math mode
In-Reply-To: <68bfdc900901212000o42fffc6eqc7b3c1b84f1c98a0@mail.gmail.com>
References: <68bfdc900901212000o42fffc6eqc7b3c1b84f1c98a0@mail.gmail.com>
Message-ID: <497835EA.30002@elvenkind.com>



Yue Wang wrote:
> Hi, Taco:
> 
> I built the trunk today and found one bug.
> version:
> This is LuaTeX, Version snapshot-0.33.0-2009012203, build

Thank you, found and fixed.

Best wishes,
Taco

From yuleopen at gmail.com  Thu Jan 22 11:35:21 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 22 Jan 2009 18:35:21 +0800
Subject: [Dev-luatex] Don't use sed -r
Message-ID: <68bfdc900901220235m2d836b7bxe8b3a9cb97904c15@mail.gmail.com>

Hi, Taco.

A minor issue: in the file
/src/texk/web2c/luatexdir/get_svnversion.sh, please avoid the -r
option since it is not supported by many sed programs.
see http://www.opengroup.org/onlinepubs/000095399/utilities/sed.html
for the POSIX standard.
(GNU sed support the option, however, BSD style sed (like the one
distributed in FreeBSD or Mac OS X think this is an illegal statement
during compilation)

Yue Wang

From root at www.metatex.org  Thu Jan 22 12:27:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 22 Jan 2009 12:27:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090122112702.74AAD1E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1809 | taco | 2009-01-22 10:02:23 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h

fix a bug in creating delimiter noads (large_fam was always zero)

------------------------------------------------------------------------

From khaledhosny at eglug.org  Thu Jan 22 13:41:04 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 22 Jan 2009 14:41:04 +0200
Subject: [Dev-luatex] Wrong placement of image nodes in non
	left-right	directions
In-Reply-To: <alpine.DEB.1.00.0901210029570.27782@hahepc1.hahe>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
	<a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
	<20090120132734.GA15700@khaled-laptop>
	<alpine.DEB.1.00.0901210029570.27782@hahepc1.hahe>
Message-ID: <20090122124104.GA6990@khaled-laptop>

On Wed, Jan 21, 2009 at 12:36:49AM +0100, Hartmut Henkel wrote:
> On Tue, 20 Jan 2009, Khaled Hosny wrote:
> 
> > This new patch fixes BL_ and BR_ directions in vlist, it wasn't
> > working properly with the former patch.
> 
> thanks a lot, but it seems it's not sufficient. The hpack/vpack
> algorithms don't get the right image dimensions, so the surrounding box
> sizes aren't calculated right and therefore \hrules and \vrules around
> the pictures are not always correct (i won't touch this now).

Ah, I see this, and I think I found why. This patch fixes this (at least
with my simple tests).

Regards,

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
Index: luatex.web
===================================================================
--- luatex.web	(revision 1809)
+++ luatex.web	(working copy)
@@ -30097,7 +30097,9 @@
 end
 
 @ @<Output a Image node in a vlist@>=
-begin cur_v:=cur_v+pdf_height(p)+pdf_depth(p);
+begin 
+  edge_v:=cur_v;
+  cur_v:=cur_v+pdf_height(p)+pdf_depth(p);
   case box_direction(dvi_direction) of
   dir_TL_: begin
     cur_h:=left_edge;
@@ -30114,6 +30116,7 @@
   othercases cur_h:=left_edge;
   endcases;
   output_image(pdf_ximage_idx(p));
+  cur_h:=left_edge; cur_v:=edge_v+pdf_height(p)+pdf_depth(p);
 end
 
 @ @<Output a Form node in a vlist@>=
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090122/c3189c43/attachment.bin>

From taco at elvenkind.com  Thu Jan 22 16:01:29 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 22 Jan 2009 16:01:29 +0100
Subject: [Dev-luatex] Don't use sed -r
In-Reply-To: <68bfdc900901220235m2d836b7bxe8b3a9cb97904c15@mail.gmail.com>
References: <68bfdc900901220235m2d836b7bxe8b3a9cb97904c15@mail.gmail.com>
Message-ID: <49788A49.2010506@elvenkind.com>



Yue Wang wrote:
> Hi, Taco.
> 
> A minor issue: in the file
> /src/texk/web2c/luatexdir/get_svnversion.sh, please avoid the -r
> option since it is not supported by many sed programs.
> see http://www.opengroup.org/onlinepubs/000095399/utilities/sed.html
> for the POSIX standard.
> (GNU sed support the option, however, BSD style sed (like the one
> distributed in FreeBSD or Mac OS X think this is an illegal statement
> during compilation)

Does it work without -r, or does the regex need changing ?

Best wishes,
Taco

From root at www.metatex.org  Thu Jan 22 16:25:16 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 22 Jan 2009 16:25:16 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090122152516.E28591E8C3EC@www.metatex.org>

------------------------------------------------------------------------
r1810 | taco | 2009-01-22 14:38:41 +0100 (Thu, 22 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

* fill in the field names for math nodes and noads
* support deep copying of math lists
* fix node sanity test for fraction noads and add the other types

------------------------------------------------------------------------
r1811 | taco | 2009-01-22 14:41:04 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c

support reading and writing math nodes and noads

------------------------------------------------------------------------
r1812 | taco | 2009-01-22 14:41:53 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

new callback: mlist_to_hlist

------------------------------------------------------------------------
r1813 | taco | 2009-01-22 15:57:07 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

new manual (pdf is somewhat broken)

------------------------------------------------------------------------
r1814 | taco | 2009-01-22 15:58:09 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

name the style node's field style (instead of subtype)

------------------------------------------------------------------------

From texworld at laposte.net  Thu Jan 22 19:39:35 2009
From: texworld at laposte.net (TeXWorld)
Date: Thu, 22 Jan 2009 19:39:35 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
Message-ID: <4978BD67.6050301@laposte.net>

Hello,

I'm new to LuaTeX and Lua in general and I try to find tools to process 
datas stored in XML files.
I want to do this with LaTeX (pdfLuaLaTeX in TeXLive 2008) but there's 
no tool. Contrary to LaTeX, ConTeXt does have abilities to work with XML 
files.
Do you think it could be possible to have LuaTeX equipped with such 
abilities one day ? I read in the LuaTeX reference that LuaTeX comes 
with modules such as LuaZIP that is really a good thing. Do you think it 
would be possible to have something like the LuaXML module added to 
luatex too ?

Jack

From root at www.metatex.org  Thu Jan 22 22:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 22 Jan 2009 22:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090122212504.9AED41E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1815 | oneiros | 2009-01-22 16:42:49 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

add missing declaration

------------------------------------------------------------------------
r1816 | taco | 2009-01-22 17:11:09 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

rename the left and right delimiter fields to "delim"

------------------------------------------------------------------------
r1817 | taco | 2009-01-22 17:16:16 +0100 (Thu, 22 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

small textual changes (outline is still broken)

------------------------------------------------------------------------
r1818 | taco | 2009-01-22 17:41:45 +0100 (Thu, 22 Jan 2009) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf

quick fix to get a valid manual (no outline now, 
bugfix=todo)

------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Thu Jan 22 22:54:29 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 22 Jan 2009 22:54:29 +0100 (CET)
Subject: [Dev-luatex] Wrong placement of image nodes in non left-right
 directions
In-Reply-To: <20090122124104.GA6990@khaled-laptop>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
	<a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
	<20090120132734.GA15700@khaled-laptop>
	<alpine.DEB.1.00.0901210029570.27782@hahepc1.hahe>
	<20090122124104.GA6990@khaled-laptop>
Message-ID: <alpine.DEB.1.00.0901222246460.11926@hahepc1.hahe>

Hi Khaled,

On Thu, 22 Jan 2009, Khaled Hosny wrote:

> Ah, I see this, and I think I found why. This patch fixes this (at
> least with my simple tests).

thanks, but please see page 2 in the attached file: The last pair of
\vrules are not surrounding the image. I guess that's a sign that the
image size isn't properly taken into account when doing the boxing,
which is the task of these hpack and vpack functions. I have never
touched either, and i don't want to risk tweaking them. But if you see a
way to fix it, please go ahead.

Regards, Hartmut
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: text/x-tex
Size: 558 bytes
Desc: test.tex
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090122/e01a80de/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 20266 bytes
Desc: test.pdf
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090122/e01a80de/attachment-0001.pdf>

From yuleopen at gmail.com  Fri Jan 23 07:17:22 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Fri, 23 Jan 2009 14:17:22 +0800
Subject: [Dev-luatex] Don't use sed -r
In-Reply-To: <49788A49.2010506@elvenkind.com>
References: <68bfdc900901220235m2d836b7bxe8b3a9cb97904c15@mail.gmail.com>
	<49788A49.2010506@elvenkind.com>
Message-ID: <68bfdc900901222217i65a51bc2md744b83fd3acd167@mail.gmail.com>

Hi, Taco

I refer to the man pages of GNU sed
:http://www.gnu.org/software/sed/manual/sed.html#Extended-regexps
and it said,
"The only difference between basic and extended regular expressions is
in the behavior of a few characters: `?', `+', parentheses, and braces
(`{}'). While basic regular expressions require these to be escaped if
you want them to behave as special characters, when using extended
regular expressions you must escape them if you want them to match a
literal character."

so I think it is safe to change your expression from
sed -r 's/^([0-9]+).*/\1/'`
into
sed 's/^\([0-9]\+\).*/\1/'`
Please have a test (I have no *nix system with me now)

Yue Wang


On Thu, Jan 22, 2009 at 11:01 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
>
> Yue Wang wrote:
>> Hi, Taco.
>>
>> A minor issue: in the file
>> /src/texk/web2c/luatexdir/get_svnversion.sh, please avoid the -r
>> option since it is not supported by many sed programs.
>> see http://www.opengroup.org/onlinepubs/000095399/utilities/sed.html
>> for the POSIX standard.
>> (GNU sed support the option, however, BSD style sed (like the one
>> distributed in FreeBSD or Mac OS X think this is an illegal statement
>> during compilation)
>
> Does it work without -r, or does the regex need changing ?
>
> Best wishes,
> Taco
>

From taco at elvenkind.com  Fri Jan 23 09:26:29 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 23 Jan 2009 09:26:29 +0100
Subject: [Dev-luatex] Don't use sed -r
In-Reply-To: <68bfdc900901222217i65a51bc2md744b83fd3acd167@mail.gmail.com>
References: <68bfdc900901220235m2d836b7bxe8b3a9cb97904c15@mail.gmail.com>	
	<49788A49.2010506@elvenkind.com>
	<68bfdc900901222217i65a51bc2md744b83fd3acd167@mail.gmail.com>
Message-ID: <49797F35.2080607@elvenkind.com>



Yue Wang wrote:
> 
> so I think it is safe to change your expression from
> sed -r 's/^([0-9]+).*/\1/'`
> into
> sed 's/^\([0-9]\+\).*/\1/'`
> Please have a test (I have no *nix system with me now)

Done and works, thank you.

Best wishes,
Taco

From pragma at wxs.nl  Fri Jan 23 09:53:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 23 Jan 2009 09:53:26 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4978BD67.6050301@laposte.net>
References: <4978BD67.6050301@laposte.net>
Message-ID: <49798586.9080204@wxs.nl>

TeXWorld wrote:
> Hello,
> 
> I'm new to LuaTeX and Lua in general and I try to find tools to process 
> datas stored in XML files.
> I want to do this with LaTeX (pdfLuaLaTeX in TeXLive 2008) but there's 
> no tool. Contrary to LaTeX, ConTeXt does have abilities to work with XML 
> files.
> Do you think it could be possible to have LuaTeX equipped with such 
> abilities one day ? I read in the LuaTeX reference that LuaTeX comes 
> with modules such as LuaZIP that is really a good thing. Do you think it 
> would be possible to have something like the LuaXML module added to 
> luatex too ?

this is not so much related to luatex (typesetting engine) but more to 
the input which can be anything (tex, database, xml, whatever); context 
does not use libraries but does xml in pure lua

adding all kind of 'modules' to lua will make it way too big and 
unmaintainable (apart from philosophical debates about which of the many 
variants to choose)

in the future there will be an option to load libraries (once we've 
sorted out the best way to deal with it in a secure way in the tex tree 
etc) but even then maintainance of libraries is not part of luatex 
itself (the exceptions are the libs we really need for typesetting, like 
fontforge which are also adapted to luatex and therefore part of the 
kernel; luazip and luasocket somehow fit in the core but database 
connectivity, xml handling etc is way off)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Fri Jan 23 10:03:32 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 23 Jan 2009 10:03:32 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <49798586.9080204@wxs.nl>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
Message-ID: <497987E4.6010502@elvenkind.com>



Hans Hagen wrote:
> 
> this is not so much related to luatex (typesetting engine) but more to
> the input which can be anything (tex, database, xml, whatever); context
> does not use libraries but does xml in pure lua

Meanwhile, there is a pure perl XML parser in the lua wiki:

  http://lua-users.org/wiki/LuaXml

Look for "Classic Lua-only version", then "updated for 5.1"

Best wishes,
Taco

From root at www.metatex.org  Fri Jan 23 12:26:31 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 23 Jan 2009 12:26:31 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090123112631.CDD871E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1819 | taco | 2009-01-23 09:26:02 +0100 (Fri, 23 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/get_svnversion.sh

remove the -r switch in the sed call

------------------------------------------------------------------------
r1820 | taco | 2009-01-23 10:06:37 +0100 (Fri, 23 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf

now with outline again (bug found)

------------------------------------------------------------------------
r1821 | taco | 2009-01-23 10:08:32 +0100 (Fri, 23 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web

"action_node" should be defined externally

------------------------------------------------------------------------
r1822 | taco | 2009-01-23 10:16:48 +0100 (Fri, 23 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

don't free invalid kernel nodes inside fetch(); that will
result in a double-free error

------------------------------------------------------------------------
r1823 | taco | 2009-01-23 12:02:50 +0100 (Fri, 23 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

* copy noad/node attributes in math mode into the newly created nodes
* move math_clone() to mlist.c
* fix handing of character codes >65535

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan 23 16:25:13 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 23 Jan 2009 16:25:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090123152513.79F201E8C3EF@www.metatex.org>

------------------------------------------------------------------------
r1824 | taco | 2009-01-23 13:59:28 +0100 (Fri, 23 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

the box+kern+rule for a radical should inherit attributes from the 
left_delimiter instead of the nucleus

------------------------------------------------------------------------
r1825 | taco | 2009-01-23 15:20:52 +0100 (Fri, 23 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

Merge the left_noad and right_noad types into a single fence_noad

------------------------------------------------------------------------

From root at www.metatex.org  Fri Jan 23 22:25:03 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 23 Jan 2009 22:25:03 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090123212503.A6A6B1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1826 | taco | 2009-01-23 16:38:59 +0100 (Fri, 23 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

Extract the \predisplaysize calculations into a separate function
as a preliminary action for \lastlinewidth or so (todo)

------------------------------------------------------------------------
r1827 | taco | 2009-01-23 16:52:13 +0100 (Fri, 23 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c

support node.family_font()

------------------------------------------------------------------------

From root at www.metatex.org  Sat Jan 24 12:26:33 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 24 Jan 2009 12:26:33 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090124112633.E8AAE1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1828 | hhenkel | 2009-01-24 00:04:46 +0100 (Sat, 24 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

replace dvi_right/up/left/down by pos_right/up/left/down and movement()

------------------------------------------------------------------------
r1829 | hhenkel | 2009-01-24 00:52:50 +0100 (Sat, 24 Jan 2009) | 3 lines
Changed paths:
   M /trunk/build.sh
   M /trunk/src/texk/web2c/luatexdir/managed-sa.h
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/ttf2afm.c

robustify a few macros in luatexdir/*.c and luatexdir/*.h
add --nostrip option to build.sh

------------------------------------------------------------------------
r1830 | hhenkel | 2009-01-24 01:07:25 +0100 (Sat, 24 Jan 2009) | 2 lines
Changed paths:
   M /trunk/build.sh

build.sh: replace "==" by "=" for strict POSIX compliance

------------------------------------------------------------------------
r1831 | oneiros | 2009-01-24 01:09:02 +0100 (Sat, 24 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/Makefile.in
   M /trunk/src/texk/web2c/luatexdir/luatex.mk
   D /trunk/src/texk/web2c/luatexdir/pdftosrc.1
   D /trunk/src/texk/web2c/luatexdir/pdftosrc.cc
   D /trunk/src/texk/web2c/luatexdir/pdftosrc.rc
   D /trunk/src/texk/web2c/luatexdir/ttf2afm.c
   D /trunk/src/texk/web2c/luatexdir/ttf2afm.rc

remove ttf2afm and pdftosrc; these are maintained by Thanh in the pdftex project

------------------------------------------------------------------------
r1832 | taco | 2009-01-24 10:14:00 +0100 (Sat, 24 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/depend.mk
   M /trunk/src/texk/web2c/luatexdir/luatexlib.mk

rerun make depend and correct dependencies after removal of
ttf2afm and pdftosrc

------------------------------------------------------------------------
r1833 | taco | 2009-01-24 10:16:17 +0100 (Sat, 24 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/depend.mk

re- rerun make depend :-)

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 26 12:26:25 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 26 Jan 2009 12:26:25 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090126112625.998AD1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1834 | taco | 2009-01-26 10:17:51 +0100 (Mon, 26 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

fix glyph table layout

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 26 16:25:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 26 Jan 2009 16:25:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090126152507.5A3DC1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1835 | taco | 2009-01-26 15:13:36 +0100 (Mon, 26 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

fix a small error in \Uradical documentation

------------------------------------------------------------------------
r1836 | taco | 2009-01-26 15:31:17 +0100 (Mon, 26 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/managed-sa.c

small extension to permit dumping of near-empty sa's, and
to make sure no null's are attempted to be dumped

------------------------------------------------------------------------
r1837 | taco | 2009-01-26 15:40:36 +0100 (Mon, 26 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/commands.h
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

Extract the math font (family) setting and querying to C.
Now it is using a separate sparse array instead of a fixed 
region of 768 fonts inside eqtb. 

------------------------------------------------------------------------
r1838 | taco | 2009-01-26 16:14:14 +0100 (Mon, 26 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

fix print_delimiter() and updated some of the comments

------------------------------------------------------------------------

From root at www.metatex.org  Mon Jan 26 22:25:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 26 Jan 2009 22:25:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090126212504.ABCBE1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1839 | taco | 2009-01-26 16:27:05 +0100 (Mon, 26 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

remove some explicit maketexstring() calls, and 
a small cleanup in after_math()

------------------------------------------------------------------------

From root at www.metatex.org  Tue Jan 27 12:26:33 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 27 Jan 2009 12:26:33 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090127112633.AB22A1E8C3EE@www.metatex.org>

------------------------------------------------------------------------
r1840 | taco | 2009-01-27 09:34:49 +0100 (Tue, 27 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c

print U+ strings instead of decimals in glyph consistency warnings

------------------------------------------------------------------------

From khaledhosny at eglug.org  Tue Jan 27 15:10:31 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 27 Jan 2009 16:10:31 +0200
Subject: [Dev-luatex] Wrong placement of image nodes in non
	left-right	directions
In-Reply-To: <alpine.DEB.1.00.0901222246460.11926@hahepc1.hahe>
References: <a5a1faa10901071337t4d3c19b7ia76c0938f2552110@mail.gmail.com>
	<alpine.DEB.1.00.0901080042570.17665@hahepc1.hahe>
	<a5a1faa10901081150p21f0c4bve06901fabeb8c637@mail.gmail.com>
	<alpine.DEB.1.00.0901092221450.28509@hahepc1.hahe>
	<a5a1faa10901091324u3c720529of711fe881cbaef2a@mail.gmail.com>
	<20090120132734.GA15700@khaled-laptop>
	<alpine.DEB.1.00.0901210029570.27782@hahepc1.hahe>
	<20090122124104.GA6990@khaled-laptop>
	<alpine.DEB.1.00.0901222246460.11926@hahepc1.hahe>
Message-ID: <20090127141031.GA20470@khaled-laptop>

On Thu, Jan 22, 2009 at 10:54:29PM +0100, Hartmut Henkel wrote:
> Hi Khaled,
> 
> On Thu, 22 Jan 2009, Khaled Hosny wrote:
> 
> > Ah, I see this, and I think I found why. This patch fixes this (at
> > least with my simple tests).
> 
> thanks, but please see page 2 in the attached file: The last pair of
> \vrules are not surrounding the image. I guess that's a sign that the
> image size isn't properly taken into account when doing the boxing,
> which is the task of these hpack and vpack functions. I have never
> touched either, and i don't want to risk tweaking them. But if you see a
> way to fix it, please go ahead.

This seem to be another issue than what this patch is trying to fix. I
think it is safe to apply this patch as hpack/vpack issue seems not to
be image specific (I can reproduce it with rules too).

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090127/5f7b0e58/attachment.bin>

From root at www.metatex.org  Tue Jan 27 22:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 27 Jan 2009 22:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090127212505.375921E8C3EF@www.metatex.org>

------------------------------------------------------------------------
r1841 | taco | 2009-01-27 17:29:12 +0100 (Tue, 27 Jan 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

extra math parameter acquisition to dedicated functions (this is a preliminary action 
needed for the coming MATH support)

------------------------------------------------------------------------

From yuleopen at gmail.com  Wed Jan 28 07:57:03 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Wed, 28 Jan 2009 14:57:03 +0800
Subject: [Dev-luatex] A few newbie questions
Message-ID: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>

Hi, Taco:

Last week I stayed in my grandma's home (located in a beautiful
countryside) which has limited internet access. So I planned to study
the luatex source code during the stay. I read a small subsect of the
LuaTeX source and most parts of MetaPost source code and have a few
newbie questions:

I will refer to the mp.w as an example, since it is finished and I am
more familiar with the C programming language.


- wouldn't it be great if we remove the packed data dependency?
Knuth used packed data since memory space was very valuable during the
years when he wrote the TeX and MetaFont program. By doing so, he can
split a memory word (the space needed for a 32bit integer) into two,
three or four so that he can save more spaces. In pdfTeX and MetaPost,
almost all the important data structures (like all kinds of nodes,
boxes, lists) are build on top of the packed data structure. For
example, In TeX's char_node presentation, instead of using one word
for font and one word for character, he can use one word to do so by
defining two web macros font==type and character==subtype. However,
Memory consumption is not that important these years and in LuaTeX
other representations uses much more memory (like parsing a
complicated opentype font and dumping it into a lua table using the
fontforge library). So wouldn't it be bettter if we remove the packed
data? It will make the code more readable at the cost of consuming a
few more memory (the TeX web side is very memory efficient, so there
won't be big memory footprint even if we double the memory
consumption) since we can get rid of the messy web or C macros.

For example, in Part 21, mp.w, we define more than a dozen macros to
get all the variables of a edge which A points to its start. Such code
may confuse modern programmers who learn to program in C after the
mid-1990s. They prefer to do something like this:
typedef fill_node struct {
  path *path_p;
  pen *pen_p;
.....
  int miterlim_var;
};
if we want to create a new fill node, instead of creating its node,
and setting its path_p to a given pointer p using
mp_path_p(t)=p;
it will be more understandable if we can do this:
node * mp_new_fill_node (pointer, p){
  fill_node *fn = malloc (sizeof (fill_node)); /* a fill_node*/
  fn->path_p = p;
  fn->pen_p=NULL;
  fn->red_val=0
....
  return fn
}


-Why can't we use IEEE floating number specification?
TeX/MetaPost have it's own number presentation builtin. But this is a
very complicated and strange floating number system which represent
each number as a integer. I think IEEE floating number specification
is good enough for implementing TeX? Today almost every operating
system support float/double, and the precision is great. If we can do
this, Part 7 of the mp.w and luatex.web can be totally removed, and we
can also clean the conversion macros in the rest of the macros. If we
remove the dependency of part 7 and part 9, maybe we can also make our
code more portable on different machines.

- Why should we do memory management ourselves?
I can see that in mp.w, we maintain a node pool (a fixed continuous
space in physical memory). When we want to allocate a node, we should
call mp_get_node, which does several things like finding available
place for memory allocation, reporting error if the memory is exceed
then it tries to put everything with different structures into the
pool. Wouldn't it be great if we just ask the operating system's C
library to handle these tasks (like using malloc and free as the
example code of mp_new_fill_node shows). Modern operating system's
library is more efficient, and it will also make the luatex code looks
better.

- From the part of the code I read, if I understand correctly, the
only reason of incorporating fontforge is to get the font Metrics
data?
If so, I think FreeType2 is sufficient to accomplish the task? [I
think freetype2 is much smaller and efficient, and fontforge use
freetype2]

Yue Wang

From pragma at wxs.nl  Wed Jan 28 09:52:50 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Jan 2009 09:52:50 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
Message-ID: <49801CE2.4010204@wxs.nl>

Yue Wang wrote:

> - From the part of the code I read, if I understand correctly, the
> only reason of incorporating fontforge is to get the font Metrics
> data?
> If so, I think FreeType2 is sufficient to accomplish the task? [I
> think freetype2 is much smaller and efficient, and fontforge use
> freetype2]

at some time in the future we also want access to the shapes etc because 
we want to experiment with runtime glyph adaption and such

also, by taking the internal ff representation as starting point we have 
the advantage that we can use ff's visual (debugging) capabilities for 
analysing for instance font features

(eventually the amount of ff used will be a bit smaller because we don't 
need the write related code)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From H.vanderMeer at uva.nl  Wed Jan 28 10:21:12 2009
From: H.vanderMeer at uva.nl (Hans van der Meer)
Date: Wed, 28 Jan 2009 10:21:12 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
Message-ID: <90386490-762E-4666-9105-9E1366878B27@uva.nl>

Yue Wang has some good points. I second the motion!

Hans van der Meer

On 28 jan 2009, at 07:57, Yue Wang wrote:

> Hi, Taco:
>
> Last week I stayed in my grandma's home (located in a beautiful
> countryside) which has limited internet access. So I planned to study
> the luatex source code during the stay. I read a small subsect of the
> LuaTeX source and most parts of MetaPost source code and have a few
> newbie questions:
>
> I will refer to the mp.w as an example, since it is finished and I am
> more familiar with the C programming language.
>
>
> - wouldn't it be great if we remove the packed data dependency?
> Knuth used packed data since memory space was very valuable during the
> years when he wrote the TeX and MetaFont program. By doing so, he can
> split a memory word (the space needed for a 32bit integer) into two,
> three or four so that he can save more spaces. In pdfTeX and MetaPost,
> almost all the important data structures (like all kinds of nodes,
> boxes, lists) are build on top of the packed data structure. For
> example, In TeX's char_node presentation, instead of using one word
> for font and one word for character, he can use one word to do so by
> defining two web macros font==type and character==subtype. However,
> Memory consumption is not that important these years and in LuaTeX
> other representations uses much more memory (like parsing a
> complicated opentype font and dumping it into a lua table using the
> fontforge library). So wouldn't it be bettter if we remove the packed
> data? It will make the code more readable at the cost of consuming a
> few more memory (the TeX web side is very memory efficient, so there
> won't be big memory footprint even if we double the memory
> consumption) since we can get rid of the messy web or C macros.
>
> For example, in Part 21, mp.w, we define more than a dozen macros to
> get all the variables of a edge which A points to its start. Such code
> may confuse modern programmers who learn to program in C after the
> mid-1990s. They prefer to do something like this:
> typedef fill_node struct {
>  path *path_p;
>  pen *pen_p;
> .....
>  int miterlim_var;
> };
> if we want to create a new fill node, instead of creating its node,
> and setting its path_p to a given pointer p using
> mp_path_p(t)=p;
> it will be more understandable if we can do this:
> node * mp_new_fill_node (pointer, p){
>  fill_node *fn = malloc (sizeof (fill_node)); /* a fill_node*/
>  fn->path_p = p;
>  fn->pen_p=NULL;
>  fn->red_val=0
> ....
>  return fn
> }
>
>
> -Why can't we use IEEE floating number specification?
> TeX/MetaPost have it's own number presentation builtin. But this is a
> very complicated and strange floating number system which represent
> each number as a integer. I think IEEE floating number specification
> is good enough for implementing TeX? Today almost every operating
> system support float/double, and the precision is great. If we can do
> this, Part 7 of the mp.w and luatex.web can be totally removed, and we
> can also clean the conversion macros in the rest of the macros. If we
> remove the dependency of part 7 and part 9, maybe we can also make our
> code more portable on different machines.
>
> - Why should we do memory management ourselves?
> I can see that in mp.w, we maintain a node pool (a fixed continuous
> space in physical memory). When we want to allocate a node, we should
> call mp_get_node, which does several things like finding available
> place for memory allocation, reporting error if the memory is exceed
> then it tries to put everything with different structures into the
> pool. Wouldn't it be great if we just ask the operating system's C
> library to handle these tasks (like using malloc and free as the
> example code of mp_new_fill_node shows). Modern operating system's
> library is more efficient, and it will also make the luatex code looks
> better.
>
> - From the part of the code I read, if I understand correctly, the
> only reason of incorporating fontforge is to get the font Metrics
> data?
> If so, I think FreeType2 is sufficient to accomplish the task? [I
> think freetype2 is much smaller and efficient, and fontforge use
> freetype2]
>
> Yue Wang
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex


From taco at elvenkind.com  Wed Jan 28 10:22:53 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Jan 2009 10:22:53 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
Message-ID: <498023ED.80302@elvenkind.com>



Yue Wang wrote:
> Hi, Taco:
> 
> Last week I stayed in my grandma's home (located in a beautiful
> countryside) which has limited internet access. So I planned to study
> the luatex source code during the stay. 

Shouldn't you have been out enjoying that same countryside then? ;)

> - wouldn't it be great if we remove the packed data dependency?

Yes, it would be better. It entails a lot of work though, even
for relatively small program like mplib, and there are not only
advantages.

> since we can get rid of the messy web or C macros.

We would be able to get rid of the macros, but we will have to introduce
lots of typecasts or pointer indirections depending on whether the
node structure will be a heterogenous union or a listhead + data.
I have gone through that process for the exported image backend in
mplib (which uses unions, see e.g. psout.w), and it was a fair amount
of work even for that small chunk of code.

I am not saying that it shouldn't be done, just that it is not something
that can be undertaken lightly. I already intend to make metapost's
knots and knot lists use truly dynamic memory (a relatively minor task)
but I have to find a quiet time.

In luatex the problem is more complicated because pascal&web2c does not
like pointers much, so nothing is planned there until after the switch
from pascal to C(web).

> -Why can't we use IEEE floating number specification?

Please do an internet search for "megapost metapost", and you will
find some posts and presentations on the subject (most written by me).

Short summary: future versions of MPlib will incorporate either
the MPFR library ( http://www.mpfr.org/ ) or decNumber
( http://www.alphaworks.ibm.com/tech/decnumber ).

I have yet to decide which one, both have their advantages.

> TeX/MetaPost have it's own number presentation builtin. But this is a
> very complicated and strange floating number system which represent
> each number as a integer. I think IEEE floating number specification
> is good enough for implementing TeX? 

Not really, because there are portability issues wrt rounding. the
normal C "double" data type is not acceptable without an additional
library to make it behave reliably. And for MP, double is not really
precise enough anyway, so it is better jump to something more serious.

> remove the dependency of part 7 and part 9, maybe we can also make our
> code more portable on different machines.

TeX's do-it-yourself integer calculus is the most portable you can get.

> - Why should we do memory management ourselves?

It is still there mostly for the same reason as mentioned above for
the packed memory: it is a lot of work to change it.

>       Wouldn't it be great if we just ask the operating system's C
> library to handle these tasks (like using malloc and free as the
> example code of mp_new_fill_node shows). Modern operating system's
> library is more efficient, and it will also make the luatex code looks
> better.

This is true for mp.w, but I am not so sure that system malloc() will
perform better that texnodes.c (which essentially uses 10 dedicated
avail lists). Anyway, see the remarks above.

> - From the part of the code I read, if I understand correctly, the
> only reason of incorporating fontforge is to get the font Metrics
> data?

Not only that. Stuff that needs doing:

* parsing of Type1 & Type0 (CID composite) fonts
* parsing of sfnt containers (ttc and dfont)
* parsing of TTF and OTF fonts (including AAT)
* bounding box calculations for PostScript-based glyphs
  (because this information is not in the font itself)
* parsing and processing of GPOS & GSUB tables
* font reencoding
* converting to all of this to a lua table

To be honest, I have no idea how many of those things can be done
by freetype2, but I highly doubt its OTF support will be sufficient.

> If so, I think FreeType2 is sufficient to accomplish the task? [I
> think freetype2 is much smaller and efficient, and fontforge use
> freetype2]



From root at www.metatex.org  Wed Jan 28 12:26:41 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 28 Jan 2009 12:26:41 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090128112641.D126C1E8C3F5@www.metatex.org>

------------------------------------------------------------------------
r1842 | taco | 2009-01-28 12:13:43 +0100 (Wed, 28 Jan 2009) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

Add four new primitives to support direct creation of cramped
math styles

------------------------------------------------------------------------

From yuleopen at gmail.com  Wed Jan 28 15:13:51 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Wed, 28 Jan 2009 22:13:51 +0800
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <498023ED.80302@elvenkind.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
Message-ID: <68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>

Hi, Taco:

Thanks very much for the explanation, and I agree with you that
removing packed data and rewrite the memory allocation parts will take
huge amount of work as it is the structures that most code built upon,
and many TeX implementations do not touch that (including Common TeX
which is a hand-conversion of Knuth's TeX, and your original cxtex
which is a hand-conversion of pdfTeX). As far as I know, only NTS and
its successor, ExTeX have modernized TeX's data structures. But what's
the benefit of converting TeX and MP's web source code into c or cweb
if the old-fashioned data structures and algorithms remain unchanged?
And Getting rid of the web2c step and making debugging/extension much
easier are the ultimate goals for the C version? I doubt not.

I think the main reason for TeX's development is not so active as
other famous software projects is that TeX's program is not easy to
read, and only those experienced programmer with highest level of
programming ability (like Taco, of course) know how to write its code.
During LuaTeX's development I found several bugs in LuaTeX but I don't
know how to debug the program and send you the patches. I felt
depressed since I could not understand many parts of the code although
TeX's source code have the best quality documentation. Other projects
like Lua may not have good documentation and source code comments, but
their code is very clear as parser/lexer/various
libs/compiler/interpreter are separated so I can start debugging or
writing extensions after skimming two or three of the source code
files. But in the TeX world things are quite another, All parts in the
program are depended with each other, and one cannot understand some
parts if he had not read the previous parts.

Moreover, as I have pointed out, TeX's data structure and memory
management are not friendly to the newcomer. I start reading TeX: The
Program three years ago (As a university freshman at that time, I only
know how to program in Pascal which is the official language for
NOI[National Olympiad in Informatics], and know a little bit about
data structure and computer algorithms like searching, hashing, and
simple graph algorithms) since some guys recommended it to me saying
that the pascal program is written by Don Knuth. However, after
reading several Parts, I get confused, not because the strange web
notation, but the complicated macros. So I stopped learning the code
at the first try. Then I learned the C programming language when I was
studying in the University and it become my major language, and today
I almost forget about the Pascal language. I was excited when I heard
about the road map of the LuaTeX projects since it say it will
eventually convert all the pascal web code into C in 2010 (2007
version, Taco changed the road map several times during the years. As
I remember right, the first stable version would be released in 2007,
then tabled in 2008, and now postponed to 2009) because I think many
old parts can be replaced and make the program more readable to the
user. However, after reading the cweb version of MetaPost, I still
find understanding the code is somewhat difficult, not to say
debugging/extending it (of course, better than the first try three
years earlier).

So I think the irreplaceable significance of changing the original
TeX's WEB version into C version is to enable TeX as a successful Open
Source projects that more people can join and study its source code,
learn how to design a typography software from scratch, then extend
related algorithms. So I think the huge changing work is worthy (maybe
we can call it metapost 2.0). In fact I don't think it will take too
much amount of work as the rewriting can on the go whenever a part is
move out of the web file. The Java Implementation of TeX, NTS, takes
about (2001-1998=) three years to release a beta which have all the
structures changed. (Of course, It is interesting that all
implementation of TeX except pdfTeX cannot become the mainstream TeX.
Are compatibility the most important issue?).


Just my two cents, Best wishes to you.
Yue Wang

On Wed, Jan 28, 2009 at 5:22 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
>
> Yue Wang wrote:
>> Hi, Taco:
>>
>> Last week I stayed in my grandma's home (located in a beautiful
>> countryside) which has limited internet access. So I planned to study
>> the luatex source code during the stay.
>
> Shouldn't you have been out enjoying that same countryside then? ;)
>
>> - wouldn't it be great if we remove the packed data dependency?
>
> Yes, it would be better. It entails a lot of work though, even
> for relatively small program like mplib, and there are not only
> advantages.
>
>> since we can get rid of the messy web or C macros.
>
> We would be able to get rid of the macros, but we will have to introduce
> lots of typecasts or pointer indirections depending on whether the
> node structure will be a heterogenous union or a listhead + data.
> I have gone through that process for the exported image backend in
> mplib (which uses unions, see e.g. psout.w), and it was a fair amount
> of work even for that small chunk of code.
>
> I am not saying that it shouldn't be done, just that it is not something
> that can be undertaken lightly. I already intend to make metapost's
> knots and knot lists use truly dynamic memory (a relatively minor task)
> but I have to find a quiet time.
>
> In luatex the problem is more complicated because pascal&web2c does not
> like pointers much, so nothing is planned there until after the switch
> from pascal to C(web).
>
>> -Why can't we use IEEE floating number specification?
>
> Please do an internet search for "megapost metapost", and you will
> find some posts and presentations on the subject (most written by me).
>
> Short summary: future versions of MPlib will incorporate either
> the MPFR library ( http://www.mpfr.org/ ) or decNumber
> ( http://www.alphaworks.ibm.com/tech/decnumber ).
>
> I have yet to decide which one, both have their advantages.
>
>> TeX/MetaPost have it's own number presentation builtin. But this is a
>> very complicated and strange floating number system which represent
>> each number as a integer. I think IEEE floating number specification
>> is good enough for implementing TeX?
>
> Not really, because there are portability issues wrt rounding. the
> normal C "double" data type is not acceptable without an additional
> library to make it behave reliably. And for MP, double is not really
> precise enough anyway, so it is better jump to something more serious.
>
>> remove the dependency of part 7 and part 9, maybe we can also make our
>> code more portable on different machines.
>
> TeX's do-it-yourself integer calculus is the most portable you can get.
>
>> - Why should we do memory management ourselves?
>
> It is still there mostly for the same reason as mentioned above for
> the packed memory: it is a lot of work to change it.
>
>>       Wouldn't it be great if we just ask the operating system's C
>> library to handle these tasks (like using malloc and free as the
>> example code of mp_new_fill_node shows). Modern operating system's
>> library is more efficient, and it will also make the luatex code looks
>> better.
>
> This is true for mp.w, but I am not so sure that system malloc() will
> perform better that texnodes.c (which essentially uses 10 dedicated
> avail lists). Anyway, see the remarks above.
>
>> - From the part of the code I read, if I understand correctly, the
>> only reason of incorporating fontforge is to get the font Metrics
>> data?
>
> Not only that. Stuff that needs doing:
>
> * parsing of Type1 & Type0 (CID composite) fonts
> * parsing of sfnt containers (ttc and dfont)
> * parsing of TTF and OTF fonts (including AAT)
> * bounding box calculations for PostScript-based glyphs
>  (because this information is not in the font itself)
> * parsing and processing of GPOS & GSUB tables
> * font reencoding
> * converting to all of this to a lua table
>
> To be honest, I have no idea how many of those things can be done
> by freetype2, but I highly doubt its OTF support will be sufficient.
>
>> If so, I think FreeType2 is sufficient to accomplish the task? [I
>> think freetype2 is much smaller and efficient, and fontforge use
>> freetype2]
>
>
>

From root at www.metatex.org  Wed Jan 28 16:25:03 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 28 Jan 2009 16:25:03 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090128152503.3611E1E8C3F5@www.metatex.org>

------------------------------------------------------------------------
r1843 | taco | 2009-01-28 15:05:32 +0100 (Wed, 28 Jan 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/commands.h
   M /trunk/src/texk/web2c/luatexdir/lua/luatoken.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

This introduces a whole batch of primitives for the setting of math 
parameters. The names are preliminary, and the settings are not used
yet!

------------------------------------------------------------------------

From pragma at wxs.nl  Wed Jan 28 16:39:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Jan 2009 16:39:26 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
Message-ID: <49807C2E.3090509@wxs.nl>

Yue Wang wrote:

> And Getting rid of the web2c step and making debugging/extension much
> easier are the ultimate goals for the C version? I doubt not.

we need to keep a working engine so the luatex project has deliberately 
chosen a stepwise approach (btw, although nts resulted in a working 
version of tex, in practice it was way to slow to be useful; a rewrite 
of tex resulting in a variant many times slower that currently is not 
acceotable)

> files. But in the TeX world things are quite another, All parts in the
> program are depended with each other, and one cannot understand some
> parts if he had not read the previous parts.

an other issue is that patching whatever bit of tex coude should be done 
very careful; this has been proven by adding a backend ... rather strict 
  control over extensions and changes is needed in order to keep tex's 
reputation of stability up; a one line change could result in for 
instance a rounding issue (i mention it because we ran into it some time 
ago) and can have rather drastic consequences; you don't want that to 
happen with a machinery that has to reproduce a document at the pixel level

a patch that might work on ones machine might eventually result in many 
problems all over the world if only because most users don't update 
frequently and depend on formal distributions (btw the same is true for 
fonts and other resources ... small changes can have huge consequences)

> Moreover, as I have pointed out, TeX's data structure and memory
> management are not friendly to the newcomer. I start reading TeX: The

well, lucky us that 99.9% of the users works with tex at the macro level 
  -)

> eventually convert all the pascal web code into C in 2010 (2007
> version, Taco changed the road map several times during the years. As
> I remember right, the first stable version would be released in 2007,
> then tabled in 2008, and now postponed to 2009) because I think many

well, we will probably change the roadmap a few more times; the 2007 and 
2008 versions are rather stable, depending on what one does; keep in 
mind that we aim at pdftex compatibility which means that regular stuff 
(not using lua at all) should just work

later in 2009 we will have another formal release, which opens up a bit 
more (and the reason for openin gup via lua is that users will use lua 
for extensions and not so much start patching the core engine written in 
pascal or c)

> related algorithms. So I think the huge changing work is worthy (maybe
> we can call it metapost 2.0). In fact I don't think it will take too
> much amount of work as the rewriting can on the go whenever a part is

as said before, the idea is that one uses the lua interface to a rather 
abstract engine to extend tex; eentually theremight even be less and 
less core code

> move out of the web file. The Java Implementation of TeX, NTS, takes
> about (2001-1998=) three years to release a beta which have all the
> structures changed. (Of course, It is interesting that all

actually, nts had still the same concepts as tex and was fully 
compatible which made the inner structures somewhat suboptimal

> implementation of TeX except pdfTeX cannot become the mainstream TeX.
> Are compatibility the most important issue?).

indeed. compatibility has been a key concept of tex for over 30 years 
and will remain a key concept; pdftex became a succes because there was 
a rather strict control over releases (officially once per year, with 
code freezed months before tex live code freeze) and eventually luatex 
will end up the same

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Jan 28 16:51:32 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Jan 2009 16:51:32 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
Message-ID: <49807F04.1050302@elvenkind.com>


Hi again,

Yue Wang wrote:
> So I think the huge changing work is worthy (maybe
> we can call it metapost 2.0). In fact I don't think it will take too
> much amount of work as the rewriting can on the go whenever a part is
> move out of the web file.

Actually, the pascal web portion of luatex is steadily shrinking.

If the pascal->C conversion rate stays as it is now, all traces of
pascal will be gone by the summer (but it may take a little longer,
please don't shoot me if I don't live up to the deadline).

Once that is done, the C files will be converted back into Cweb
files (this may take quite some time itself, depending on how much
source layout reorganisation needs to be done).

Best wishes,
Taco

From arthur.reutenauer at normalesup.org  Wed Jan 28 20:27:07 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 28 Jan 2009 20:27:07 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <498023ED.80302@elvenkind.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
Message-ID: <20090128192707.GA13778@phare.normalesup.org>

> To be honest, I have no idea how many of those things can be done
> by freetype2, but I highly doubt its OTF support will be sufficient.

  As a matter of fact, while FreeType 1 came with a few utilities
demonstrating basic OpenType capabilities, FreeType 2 dropped them
entirely, and it seems, from browsing the documentation, that there
there is not even an OpenType-specific API in the latter (whereas there
is one for BDF, PCF, PFR fonts ...)  I've always wondered about this
fact, but couldn't find any reason for it.

  If Werner Lemberg reads the list, maybe he can enlighten us.

	Arthur

From chemoelectric at chemoelectric.org  Wed Jan 28 20:54:33 2009
From: chemoelectric at chemoelectric.org (Barry Schwartz)
Date: Wed, 28 Jan 2009 13:54:33 -0600
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090128192707.GA13778@phare.normalesup.org>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<20090128192707.GA13778@phare.normalesup.org>
Message-ID: <20090128195433.GB19523@crud.crud.mn.org>

Arthur Reutenauer <arthur.reutenauer at normalesup.org> skribis:
>   As a matter of fact, while FreeType 1 came with a few utilities
> demonstrating basic OpenType capabilities, FreeType 2 dropped them
> entirely, and it seems, from browsing the documentation, that there
> there is not even an OpenType-specific API in the latter (whereas there
> is one for BDF, PCF, PFR fonts ...)  I've always wondered about this
> fact, but couldn't find any reason for it.
> 
>   If Werner Lemberg reads the list, maybe he can enlighten us.

There is no real OT support in FreeType2. If you want kerning you'd
better have a kern table. :)


From yannis.haralambous at telecom-bretagne.eu  Wed Jan 28 20:58:57 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Wed, 28 Jan 2009 20:58:57 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090128195433.GB19523@crud.crud.mn.org>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<20090128192707.GA13778@phare.normalesup.org>
	<20090128195433.GB19523@crud.crud.mn.org>
Message-ID: <3A3843D6-2B4C-4A73-AA74-A9B8E81C4828@telecom-bretagne.eu>

And the advantage of using FontForge could also be to have code for  
modifying glyphs and saving them in new fonts...

Le 28 janv. 09 ? 20:54, Barry Schwartz a ?crit :

> Arthur Reutenauer <arthur.reutenauer at normalesup.org> skribis:
>>  As a matter of fact, while FreeType 1 came with a few utilities
>> demonstrating basic OpenType capabilities, FreeType 2 dropped them
>> entirely, and it seems, from browsing the documentation, that there
>> there is not even an OpenType-specific API in the latter (whereas  
>> there
>> is one for BDF, PCF, PFR fonts ...)  I've always wondered about this
>> fact, but couldn't find any reason for it.
>>
>>  If Werner Lemberg reads the list, maybe he can enlighten us.
>
> There is no real OT support in FreeType2. If you want kerning you'd
> better have a kern table. :)
>
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex
>

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090128/ed7aee1e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090128/ed7aee1e/attachment.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090128/ed7aee1e/attachment-0001.html>

From khaledhosny at eglug.org  Wed Jan 28 21:18:01 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 28 Jan 2009 22:18:01 +0200
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090128192707.GA13778@phare.normalesup.org>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<20090128192707.GA13778@phare.normalesup.org>
Message-ID: <20090128201801.GA7476@khaled-laptop>

On Wed, Jan 28, 2009 at 08:27:07PM +0100, Arthur Reutenauer wrote:
> > To be honest, I have no idea how many of those things can be done
> > by freetype2, but I highly doubt its OTF support will be sufficient.
> 
>   As a matter of fact, while FreeType 1 came with a few utilities
> demonstrating basic OpenType capabilities, FreeType 2 dropped them
> entirely, and it seems, from browsing the documentation, that there
> there is not even an OpenType-specific API in the latter (whereas there
> is one for BDF, PCF, PFR fonts ...)  I've always wondered about this
> fact, but couldn't find any reason for it.
> 
>   If Werner Lemberg reads the list, maybe he can enlighten us.

AFAIK, they felt that OpenType layout should be handled by a higher
level layer, that happen to be HarfBuzz (which is based on FreeType1 OT
code).

http://www.freedesktop.org/wiki/Software/HarfBuzz

Regards,

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090128/31a3d2c9/attachment.bin>

From arthur.reutenauer at normalesup.org  Wed Jan 28 21:24:23 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 28 Jan 2009 21:24:23 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090128201801.GA7476@khaled-laptop>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<20090128192707.GA13778@phare.normalesup.org>
	<20090128201801.GA7476@khaled-laptop>
Message-ID: <20090128202423.GA22175@phare.normalesup.org>

> http://www.freedesktop.org/wiki/Software/HarfBuzz

  I didn't know that HarfBuzz was supposed to be a Persian word :-)  I
knew what it was, of course, but I had no idea where the name came from.
And thanks for the explanations!

	Arthur

From root at www.metatex.org  Wed Jan 28 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 28 Jan 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090128212502.535CE1E8C3F5@www.metatex.org>

------------------------------------------------------------------------
r1844 | oneiros | 2009-01-28 16:30:04 +0100 (Wed, 28 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

fix warning "passing argument 1 of ?\226?\128?\152tprint_esc?\226?\128?\153 discards qualifiers from pointer target type"

------------------------------------------------------------------------
r1845 | taco | 2009-01-28 16:41:16 +0100 (Wed, 28 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

improved names for the new math parameter primitives

------------------------------------------------------------------------

From yuleopen at gmail.com  Thu Jan 29 05:18:34 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 29 Jan 2009 12:18:34 +0800
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <49807C2E.3090509@wxs.nl>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
Message-ID: <68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>

Hi,
> an other issue is that patching whatever bit of tex coude should be done
> very careful; this has been proven by adding a backend ... rather strict
>  control over extensions and changes is needed in order to keep tex's
> reputation of stability up; a one line change could result in for instance a
> rounding issue (i mention it because we ran into it some time ago) and can
> have rather drastic consequences; you don't want that to happen with a
> machinery that has to reproduce a document at the pixel level
>
> a patch that might work on ones machine might eventually result in many
> problems all over the world if only because most users don't update
> frequently and depend on formal distributions (btw the same is true for
> fonts and other resources ... small changes can have huge consequences)
>

>From my experience LuaTeX's result is very different from pdfTeX's
result. The most notable one is that they give me different line
breaks even with the same source and tfms given. Last time I was
working on a Chinese translation of Karl's TeX for the Impatients, It
occured to me that LuaTeX's linebreak is so different from pdfTeX's,
and what's worse, LuaTeX gives me more overfull boxes. Of course, I
use an old version of LuaTeX distributed in TeXLive 2008 (0.25.x, if
memory serves). I doubt whether it will be possible for LuaTeX to
produce the similar result as TeX does, (not to say pixel level).

But is compactability that important? XeTeX is not compatible with the
good old TeX, but it is still widely used in Asia (Here we don't use
LuaTeX simply because there is no LaTeX package support). Knuth also
suggested that there are several rounding flaws in recent version of
TeX that he cannot change it, but he recommended that modern
implementations change that (see TUGBoat, Volume 29 (2008) No.2).

Yue Wang

From yuleopen at gmail.com  Thu Jan 29 06:02:26 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 29 Jan 2009 13:02:26 +0800
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <49807C2E.3090509@wxs.nl>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
Message-ID: <68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>

> later in 2009 we will have another formal release, which opens up a bit more
> (and the reason for openin gup via lua is that users will use lua for
> extensions and not so much start patching the core engine written in pascal
> or c)
>

Well, I think without a rough understanding of TeX's algorithms, and
various specifications (including PDF's and various Font's),
mere mortals cannot write the extension code in Lua. The situation in
LaTeX world can prove this. XeTeX's success lies in the fact that it
is simple and easy to use. Without much knowledge of font, one can use
its font mechanism just as other programs like InDesign. So it is easy
to write a higher level wrap up for LaTeX (like fontspec). However,
the situation for LuaTeX is different. LuaTeX's API is rather
complicated, and difficult to understand unless the users have a good
understanding of fonts and TeX's internals. Moreover, instead of using
ATS or ICU directly, the users should write the layout code themselves
which is a huge task. In order to write a fontspec equivalent for
LuaTeX, the macro writer should be familiar with
- layout algorithm (similar to the one used in ICU)
- font structure (especially fontforge API)
- lua language (well, he/she should read the Lua Programming Language at least)
- TeX language (well, he/she should finish reading the TeXBook several times)
- TeX internals (like token, node, font, catcode, hyphenation, line
breaking, font expansion, margin kerning, also noad, mlist if the font
package deal with math fonts)
That might be one of the reasons why there is no such LaTeX package
for LuaTeX. In ConTeXt world this is quite different, since Hans Hagen
is a Lua+TeX+fontforge+MetaPost+whatever expert. So unless there exist
several Hans Hagens in the LaTeX world, ordinary LaTeX users will not
benefit from LuaTeX development.

Yue Wang

From pragma at wxs.nl  Thu Jan 29 09:56:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Jan 2009 09:56:39 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	
	<498023ED.80302@elvenkind.com>	
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>	
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
Message-ID: <49816F47.5000300@wxs.nl>

Yue Wang wrote:
> Hi,
>> an other issue is that patching whatever bit of tex coude should be done
>> very careful; this has been proven by adding a backend ... rather strict
>>  control over extensions and changes is needed in order to keep tex's
>> reputation of stability up; a one line change could result in for instance a
>> rounding issue (i mention it because we ran into it some time ago) and can
>> have rather drastic consequences; you don't want that to happen with a
>> machinery that has to reproduce a document at the pixel level
>>
>> a patch that might work on ones machine might eventually result in many
>> problems all over the world if only because most users don't update
>> frequently and depend on formal distributions (btw the same is true for
>> fonts and other resources ... small changes can have huge consequences)
>>
> 
> From my experience LuaTeX's result is very different from pdfTeX's
> result. The most notable one is that they give me different line
> breaks even with the same source and tfms given. Last time I was
> working on a Chinese translation of Karl's TeX for the Impatients, It
> occured to me that LuaTeX's linebreak is so different from pdfTeX's,
> and what's worse, LuaTeX gives me more overfull boxes. Of course, I
> use an old version of LuaTeX distributed in TeXLive 2008 (0.25.x, if
> memory serves). I doubt whether it will be possible for LuaTeX to
> produce the similar result as TeX does, (not to say pixel level).

we recenetly tested luatex (a more recent version than the one on tex 
live) with the texbook and there are only a few cases where we see 
differences, especially when ligatures occur at linebreaks; this is 
something that will be sorted out; 100% compatibility will never be 
reached because we use a slightly different route (separation of lig 
building, kerning, hyphenation and par building) but in practice this 
should not be a problem

so, best use a recent version

> But is compactability that important? XeTeX is not compatible with the

it is. of course there will be differences e.g. due to different 
hyphenation patterns (more complete since we have utf and > 256 chars 
can be used in patterns), and also because when using font some of 
traditional tex's limitations are gone (number of distinctive heights 
and depths) as well as some parameters in open type variants might 
differ which also leads to different spacing

but in general, the expected behaviour of tex remains; there is so much 
macro code out there that we will not break anything in that respect 
(unless is can be easily compensated, like some of the removed pdftex 
primitives)

> good old TeX, but it is still widely used in Asia (Here we don't use
> LuaTeX simply because there is no LaTeX package support). Knuth also

well, it's as with good old tex ... it will take a few years for 
everyone to catch up; when pdftex came around it took a while too before 
all features were supported by all macro packages; i'm not too worried 
about that

a too fast change would also backfire on users; for context that's not 
so much an issue because they is is a beta-update infrastructure and 
most users are willing to use beta's but with latex you need to keep in 
mind that there are many users out there who depend on a real stable 
system (with no experimental stuff that breaks down your document 
processing every now and then)

> suggested that there are several rounding flaws in recent version of
> TeX that he cannot change it, but he recommended that modern
> implementations change that (see TUGBoat, Volume 29 (2008) No.2).

maybe roundingproblems are less an issue in cjk fonts, but in for 
instance arabic typeetting, where many glyphs are pasted together by 
shifting it really matters; one scaled point might result in a .01bp 
shift in a pdf file which is visible to the sensitive eye

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Jan 29 10:06:41 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Jan 2009 10:06:41 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	
	<498023ED.80302@elvenkind.com>	
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>	
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
Message-ID: <498171A1.7080604@wxs.nl>

Yue Wang wrote:
>> later in 2009 we will have another formal release, which opens up a bit more
>> (and the reason for openin gup via lua is that users will use lua for
>> extensions and not so much start patching the core engine written in pascal
>> or c)
>>
> 
> Well, I think without a rough understanding of TeX's algorithms, and
> various specifications (including PDF's and various Font's),
> mere mortals cannot write the extension code in Lua. The situation in
> LaTeX world can prove this. XeTeX's success lies in the fact that it
> is simple and easy to use. Without much knowledge of font, one can use
> its font mechanism just as other programs like InDesign. So it is easy
> to write a higher level wrap up for LaTeX (like fontspec). However,
> the situation for LuaTeX is different. LuaTeX's API is rather
> complicated, and difficult to understand unless the users have a good
> understanding of fonts and TeX's internals. Moreover, instead of using
> ATS or ICU directly, the users should write the layout code themselves
> which is a huge task. In order to write a fontspec equivalent for
> LuaTeX, the macro writer should be familiar with

well, but even then it's just a (few) macro writer(s) and not all users; 
also keep in mind that in 30 years of tex, fonts have never been easy, 
always demanded some expertise, etc and there was always a small group 
(per macro package) that dealt with it

also, we are aware of xetex being easier to use out-of-the-box with 
respect to fonts, which is great; we definitely do not advocate users to 
use luatex instead of xetex, they should use what fits best and it might 
be that 90% of the users is better of with xetex

> - layout algorithm (similar to the one used in ICU)

well, use xetex then; there will be no hard codes layout extensions; for 
instance, as part of the oriental tex project an alternative line break 
routine is written (a subproject by idris, taco and me) and that's all 
done in lua

> - font structure (especially fontforge API)

sure, but in any case one should be familiar with what a font is; this 
is normally not something that an average user will deal with (and once 
a macro package supports something, it's even more hidden and stays 
forever)

> - lua language (well, he/she should read the Lua Programming Language at least)

that's not too much work as we've chosen a language which is relatively 
easy to learn and is not burdened by tons of libraries that you need to 
keep up with (apart from installation mess that would result from that)

> - TeX language (well, he/she should finish reading the TeXBook several times)

it depens on what one does

> - TeX internals (like token, node, font, catcode, hyphenation, line
> breaking, font expansion, margin kerning, also noad, mlist if the font
> package deal with math fonts)

> That might be one of the reasons why there is no such LaTeX package
> for LuaTeX. In ConTeXt world this is quite different, since Hans Hagen
> is a Lua+TeX+fontforge+MetaPost+whatever expert. So unless there exist
> several Hans Hagens in the LaTeX world, ordinary LaTeX users will not
> benefit from LuaTeX development.

well, eventually it will happen i guess; just look at it from the other 
end ... when i started writing context i didn't have a clue what tex was 
doing, and i simply didn't understand enough of tex to see what happened 
in latex code (we're talking 1992 or so); eventually context catched up 
quite well; this time context happens to be a bit ahead with respect to 
luatex

btw, in pdftex similar things happened ... context has been using some 
features of pdftex before latex did simply because i was involved in the 
development, such is live

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From dak at gnu.org  Thu Jan 29 10:26:43 2009
From: dak at gnu.org (David Kastrup)
Date: Thu, 29 Jan 2009 10:26:43 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <49816F47.5000300@wxs.nl> (Hans Hagen's message of "Thu, 29 Jan
	2009 09:56:39 +0100")
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl>
Message-ID: <86hc3ijwdo.fsf@lola.quinscape.zz>

Hans Hagen <pragma at wxs.nl> writes:

> Yue Wang wrote:
>>
>> From my experience LuaTeX's result is very different from pdfTeX's
>> result. The most notable one is that they give me different line
>> breaks even with the same source and tfms given. Last time I was
>> working on a Chinese translation of Karl's TeX for the Impatients, It
>> occured to me that LuaTeX's linebreak is so different from pdfTeX's,
>> and what's worse, LuaTeX gives me more overfull boxes. Of course, I
>> use an old version of LuaTeX distributed in TeXLive 2008 (0.25.x, if
>> memory serves). I doubt whether it will be possible for LuaTeX to
>> produce the similar result as TeX does, (not to say pixel level).
>
> we recenetly tested luatex (a more recent version than the one on tex
> live) with the texbook and there are only a few cases where we see
> differences, especially when ligatures occur at linebreaks; this is
> something that will be sorted out; 100% compatibility will never be
> reached because we use a slightly different route (separation of lig
> building, kerning, hyphenation and par building) but in practice this
> should not be a problem
>
> so, best use a recent version

I think that 0.25.x might have the big bad hyphenation bug.  However, I
suppose even when using a version where this has been sorted out, TeX's
behavior for things like shelf{}ful will not be imitated (in this case,
TeX separates the ligature unless it does a hyphenation pass on the
paragraph (can be forced with \pretolerance=-10000) in which case the
ligature will get recombined.  That's not something worth imitating.

-- 
David Kastrup

From khaledhosny at eglug.org  Thu Jan 29 10:35:28 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jan 2009 11:35:28 +0200
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
Message-ID: <20090129093528.GB6260@khaled-laptop>

On Thu, Jan 29, 2009 at 01:02:26PM +0800, Yue Wang wrote:
> for LuaTeX. In ConTeXt world this is quite different, since Hans Hagen
> is a Lua+TeX+fontforge+MetaPost+whatever expert. So unless there exist
> several Hans Hagens in the LaTeX world, ordinary LaTeX users will not
> benefit from LuaTeX development.

That is why I believe that we should have some means to share must of
the lower level Lua code across macro packages. For instance writing 2
or 3 OpenType layout modules is a waste of time, is it a big task of its
own especially if you want to cover all scripts, there exists 3 free
OpenType implementations and only one gets it almost right.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090129/e5e3ab29/attachment-0001.bin>

From taco at elvenkind.com  Thu Jan 29 11:10:42 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 29 Jan 2009 11:10:42 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <86hc3ijwdo.fsf@lola.quinscape.zz>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	<498023ED.80302@elvenkind.com>	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>	<49807C2E.3090509@wxs.nl>	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>	<49816F47.5000300@wxs.nl>
	<86hc3ijwdo.fsf@lola.quinscape.zz>
Message-ID: <498180A2.2010105@elvenkind.com>



David Kastrup wrote:
> 
> I think that 0.25.x might have the big bad hyphenation bug.  

It had several of those, in fact.

>                                                             However, I
> suppose even when using a version where this has been sorted out, TeX's
> behavior for things like shelf{}ful will not be imitated (in this case,
> TeX separates the ligature unless it does a hyphenation pass on the
> paragraph (can be forced with \pretolerance=-10000) in which case the
> ligature will get recombined.  That's not something worth imitating.

Last time we checked the typeset output (two weeks ago), there were
some dozens of differences between pdftex and luatex when compiling
the texbook, and these differences were all in one of three categories:

* Missed hyphenations.
  This is a known bug caused by nested discretionaries that will be
  solved eventually (#9 in the tracker)

* Additional hyphenations (in typewriter text).
  These were added because luatex is willing to hyphenate words that
  start with a non-letter: luatex just starts the word at the first
  thing that is a letter. An argument can be made for maintaining
  compatibility, but currenty we do not intent to make that change
  as the new behaviour is desired much more often. (the same can be
  said for hyphenating the first word in a paragraph, but that case
  never arises in the texbook)

* Extra or slightly different ligatures.
  These are caused by stuff like the self{}ful example above, and this
  incompatibity will definately remain. TeX's exact behaviour was an
  implementation artifact that is pretty hard to mimic, and any attempt
  to do so would lead to extremely ugly code.

Best wishes,
Taco




From pragma at wxs.nl  Thu Jan 29 11:17:27 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Jan 2009 11:17:27 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090129093528.GB6260@khaled-laptop>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
	<20090129093528.GB6260@khaled-laptop>
Message-ID: <49818237.9020606@wxs.nl>

Khaled Hosny wrote:
> On Thu, Jan 29, 2009 at 01:02:26PM +0800, Yue Wang wrote:
>> for LuaTeX. In ConTeXt world this is quite different, since Hans Hagen
>> is a Lua+TeX+fontforge+MetaPost+whatever expert. So unless there exist
>> several Hans Hagens in the LaTeX world, ordinary LaTeX users will not
>> benefit from LuaTeX development.
> 
> That is why I believe that we should have some means to share must of
> the lower level Lua code across macro packages. For instance writing 2
> or 3 OpenType layout modules is a waste of time, is it a big task of its

it depends ... in that respect writing two or more macro packages is 
also a waste of time (or even different variants of tables within a 
macro package etc)

concerning writing such an engine ... for me it's part of the fun (esp 
in relation to the oriental tex project) and i'm kind of glad that in 
context we can do it the way that suits context best (which in some 
aspects can be rather different from the way latex does things; for 
instance, we provide extra features on top of what the font does, have 
rather context specific tracing options, etc); personally i start from 
what users which kinds of determines the order of development (so, 
currently arabic and a bit of cjk)

> own especially if you want to cover all scripts, there exists 3 free
> OpenType implementations and only one gets it almost right.

as i've said before, at some point i will provide a kind of generic 
variant of the context open type support, but currently my priority lays 
with getting the oriental projects related font support done (which is 
an interplay between font design and handling features) [so, any generic 
context code would be provided as-is and development driven via the 
context related lists]; with the luatex project we're not that much in a 
hurry anyway: we reimplement parts of tex, honouring the basic design of 
   tex, adding a few things only, and opening things up step by step; 
after all, we have working pdftex's and xetex's so there is not that 
much need to hurry, cook up half solutions, end up in incompatible patch 
mode etc

also, even if much of the low level context mkiv lua code can be seen as 
generic i foresee many problems in reuse simply bcause macro packages 
differ in fundamental ways (otherwise there would not be different macro 
packages at all); also, keep in mind that latex has functionality split 
up over many packages, where redefining low level code is happening, 
which in turn does not really help]

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From dak at gnu.org  Thu Jan 29 11:20:46 2009
From: dak at gnu.org (David Kastrup)
Date: Thu, 29 Jan 2009 11:20:46 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <498180A2.2010105@elvenkind.com> (Taco Hoekwater's message of
	"Thu, 29 Jan 2009 11:10:42 +0100")
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl> <86hc3ijwdo.fsf@lola.quinscape.zz>
	<498180A2.2010105@elvenkind.com>
Message-ID: <86k58eifb5.fsf@lola.quinscape.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> * Additional hyphenations (in typewriter text).
>   These were added because luatex is willing to hyphenate words that
>   start with a non-letter: luatex just starts the word at the first
>   thing that is a letter. An argument can be made for maintaining
>   compatibility, but currenty we do not intent to make that change
>   as the new behaviour is desired much more often. (the same can be
>   said for hyphenating the first word in a paragraph, but that case
>   never arises in the texbook)

Do you have an example where the new behavior would be desired?

> * Extra or slightly different ligatures.
>   These are caused by stuff like the self{}ful example above, and this
>   incompatibity will definately remain. TeX's exact behaviour was an
>   implementation artifact that is pretty hard to mimic, and any attempt
>   to do so would lead to extremely ugly code.

Ugly code and ugly/inconsistent results.

-- 
David Kastrup

From taco at elvenkind.com  Thu Jan 29 13:33:20 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 29 Jan 2009 13:33:20 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <498180A2.2010105@elvenkind.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	<498023ED.80302@elvenkind.com>	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>	<49807C2E.3090509@wxs.nl>	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>	<49816F47.5000300@wxs.nl>	<86hc3ijwdo.fsf@lola.quinscape.zz>
	<498180A2.2010105@elvenkind.com>
Message-ID: <4981A210.2030104@elvenkind.com>

Taco Hoekwater wrote:
> 
> * Additional hyphenations (in typewriter text).

Sorry, I wrote a totally wrong explanation. My brain must have
been temporarily clogged over or something. There was incompatibity
wrt word boundaries in the beginning and so I just assumed that
was still the case.

The actual, true reason is that luatex does not listen to
\hyphenchar=-1 as a means to prevent hyphenation. I am now
reconsidering whether this is a bug or not.

Best wishes,
Taco

From martin at oneiros.de  Thu Jan 29 13:42:26 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Thu, 29 Jan 2009 13:42:26 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <4981A210.2030104@elvenkind.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl> <86hc3ijwdo.fsf@lola.quinscape.zz>
	<498180A2.2010105@elvenkind.com> <4981A210.2030104@elvenkind.com>
Message-ID: <68c491a60901290442y62ddbd06t475adfba85c4cf92@mail.gmail.com>

2009/1/29 Taco Hoekwater <taco at elvenkind.com>:
> The actual, true reason is that luatex does not listen to
> \hyphenchar=-1 as a means to prevent hyphenation. I am now
> reconsidering whether this is a bug or not.

At least it's an incompatability (see TeXbook, p.454, 3rd para).

Best
   Martin

From dak at gnu.org  Thu Jan 29 13:49:28 2009
From: dak at gnu.org (David Kastrup)
Date: Thu, 29 Jan 2009 13:49:28 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68c491a60901290442y62ddbd06t475adfba85c4cf92@mail.gmail.com>
	("Martin =?iso-8859-1?Q?Schr=F6der=22's?= message of "Thu, 29 Jan 2009
	13:42:26 +0100")
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl> <86hc3ijwdo.fsf@lola.quinscape.zz>
	<498180A2.2010105@elvenkind.com> <4981A210.2030104@elvenkind.com>
	<68c491a60901290442y62ddbd06t475adfba85c4cf92@mail.gmail.com>
Message-ID: <863af2i8fb.fsf@lola.quinscape.zz>

Martin Schr?der <martin at oneiros.de> writes:

> 2009/1/29 Taco Hoekwater <taco at elvenkind.com>:
>> The actual, true reason is that luatex does not listen to
>> \hyphenchar=-1 as a means to prevent hyphenation. I am now
>> reconsidering whether this is a bug or not.
>
> At least it's an incompatability (see TeXbook, p.454, 3rd para).

I'd call it a bug since I don't see any situation where ignoring the
documented setting would be an advantage.

-- 
David Kastrup

From yuleopen at gmail.com  Thu Jan 29 15:18:11 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 29 Jan 2009 14:18:11 +0000
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090128195433.GB19523@crud.crud.mn.org>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<20090128192707.GA13778@phare.normalesup.org>
	<20090128195433.GB19523@crud.crud.mn.org>
Message-ID: <68bfdc900901290618o39696caeg25238ab27b68b204@mail.gmail.com>

Hi,

> There is no real OT support in FreeType2. If you want kerning you'd
> better have a kern table. :)

I think OT features are easy to implement? I use LCDF-TypeTool (which
is a very small program, and does not depend on any font library) and
it is easy to convert OpenType fonts with arbitrary features I want to
TFM and Type1 fonts.

btw, There is a small tool called otfdump (which uses a very small and
cpu/memory efficient library, libotf), and it can dump ttf and otf
files (just as how fontforge is used in LuaTeX). dumping TeXGyre Heros
Regular only takes 0.058 second, and Adobe Song Std Light uses 0.140
second.
If we use this library, I think there is no need to implement a font
cache system in ConTeXt---since it is very memory efficient and fast.

If I am wrong, please point out, I am a font newbie and want to learn more

Yue Wang

From yuleopen at gmail.com  Thu Jan 29 15:24:16 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 29 Jan 2009 14:24:16 +0000
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <49816F47.5000300@wxs.nl>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl>
Message-ID: <68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>

Hi,

> so, best use a recent version

Well, I switch to the luatex in the current context minimals(0.31.3, I
believe).
I have a essay (typesetted in ConTeXt using TeXGyre Palatino font)
which only have plain text and math formula.
I compile the document using MKIV and MKII, and the linebreak results
are very different.
Maybe that's because MKIV and MKII are different. I will test some
plain TeX document later.

Yue Wang

From yuleopen at gmail.com  Thu Jan 29 15:38:25 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 29 Jan 2009 14:38:25 +0000
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl>
	<68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
Message-ID: <68bfdc900901290638y3d7d450ax9e5d7f520314a0aa@mail.gmail.com>

btw, Prof. Knuth think compatibility as a very important issue because
he uses plain TeX.
His book usually calculate the page number/cross reference/index
himself (see TeXBook or Concrete Math).
If the line-break algorithm is changed, he should recalculate all the numbers.
With advanced typesetting macros like ConTeXt or LaTeX, document
complication uses serveral passes and the cross-references are always
right.  Moreover, If we cannot make it fully compatible (pixel level),
why should we bother about the issue? Modern users won't care about
them (as Macro packages like ConTeXt are changing more rapidly).

Yue Wang

On Thu, Jan 29, 2009 at 2:24 PM, Yue Wang <yuleopen at gmail.com> wrote:
> Hi,
>
>> so, best use a recent version
>
> Well, I switch to the luatex in the current context minimals(0.31.3, I
> believe).
> I have a essay (typesetted in ConTeXt using TeXGyre Palatino font)
> which only have plain text and math formula.
> I compile the document using MKIV and MKII, and the linebreak results
> are very different.
> Maybe that's because MKIV and MKII are different. I will test some
> plain TeX document later.
>
> Yue Wang
>

From pragma at wxs.nl  Thu Jan 29 15:44:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Jan 2009 15:44:39 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901290618o39696caeg25238ab27b68b204@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	<498023ED.80302@elvenkind.com>	<20090128192707.GA13778@phare.normalesup.org>	<20090128195433.GB19523@crud.crud.mn.org>
	<68bfdc900901290618o39696caeg25238ab27b68b204@mail.gmail.com>
Message-ID: <4981C0D7.9020305@wxs.nl>

Yue Wang wrote:

> If I am wrong, please point out, I am a font newbie and want to learn more

if you only have ligatures and kerning then you can indeed use simple 
approached, but there happens to be more

(indeed caching is not always needed and if i cook up a generic subset 
caching will not be part of the game at all because performance is the 
least of my concerns then)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Jan 29 15:47:08 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Jan 2009 15:47:08 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>	
	<498023ED.80302@elvenkind.com>	
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>	
	<49807C2E.3090509@wxs.nl>	
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>	
	<49816F47.5000300@wxs.nl>
	<68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
Message-ID: <4981C16C.1050001@wxs.nl>

Yue Wang wrote:
> Hi,
> 
>> so, best use a recent version
> 
> Well, I switch to the luatex in the current context minimals(0.31.3, I
> believe).
> I have a essay (typesetted in ConTeXt using TeXGyre Palatino font)
> which only have plain text and math formula.
> I compile the document using MKIV and MKII, and the linebreak results
> are very different.
> Maybe that's because MKIV and MKII are different. I will test some
> plain TeX document later.

this is not a topic for this list so best discuss that at the context list

these differences are known (and have been dsicussed there) ... in mkiv 
we use opentype, don't have the ht/dp limitations and effectively have a 
slight different ex value which in turn determines a couple of thing 
like lineheights

(btw, in context compatibility is less important than in latex which is 
often used in journals that need to be reproduced after tens of years)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Thu Jan 29 15:59:20 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 29 Jan 2009 15:59:20 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282018i7db6317do52078d5fcb40cab1@mail.gmail.com>
	<49816F47.5000300@wxs.nl>
	<68bfdc900901290624r54f533e6i12adefc32b8c776b@mail.gmail.com>
Message-ID: <20090129145919.GC22175@phare.normalesup.org>

> Maybe that's because MKIV and MKII are different.

  Of course that's the reason!  What you're observing is the result of
the macro package, ConTeXt, not the underlying typesetting engines,
pdfTeX and LuaTeX, respectively.  Hence, this particular issue is
ConTeXt's and does not belong here, as Hans points out.

	Arthur

From javier at digi21.eu  Thu Jan 29 18:32:41 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Thu, 29 Jan 2009 18:32:41 +0100
Subject: [Dev-luatex] Generating the sources
Message-ID: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>

Some time ago I had a problem with the fonts when generating the format,
which I posted here. New versions didn't solve it, I always get the annoying

Could not load ec-lmr12.tfm. Inexistent or bad font file,

or something like that.

I decided to compile and debug LuateX myself. Something worth indeed if I
ever plan to become a developper. It was the first time I tangled something.
I saw a luatangle.web (if my memory does not betray me), so I started
tangling that, but I get pascal code, and I don't have a pascal compiler. I
haven't had time ever since, so I simply stopped.

Is there a way of generating c-source, or will I have to wait to September
or so? If there is one, even though I am a programer a step-by-step
explanation will be very wellcome.

Tanks,
--Javier A.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090129/382a7c78/attachment.html>

From taco at elvenkind.com  Thu Jan 29 20:15:56 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 29 Jan 2009 20:15:56 +0100
Subject: [Dev-luatex] Generating the sources
In-Reply-To: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
References: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
Message-ID: <4982006C.5070506@elvenkind.com>

Javier M?gica wrote:
> Some time ago I had a problem with the fonts when generating the format, 
> which I posted here. New versions didn't solve it, I always get the annoying
>  
> Could not load ec-lmr12.tfm. Inexistent or bad font file,
> or something like that.

I fixed the ecrm1000 bug that Javier Bevos hinted that it could be the
same thing, and you never got back to me, so I assumed it was solved.

You have to be more specific than "problem generating the format",
there can be many causes for a failure to find a font. I would
like to know:

* What operating system type are you on?
* Which format are you attempting to generate?
* Which version of luatex do you use?
* Where is the luatex executable on the filesystem?
* Where is the texmf tree (and that font) on the filesystem?

> I decided to compile and debug LuateX myself. Something worth indeed if 
> I ever plan to become a developper. It was the first time I tangled 
> something. I saw a luatangle.web (if my memory does not betray me), so I 
> started tangling that, but I get pascal code, and I don't have a pascal 
> compiler.

In the luatex distribution and the repository, there is a toplevel file
called INSTALL. This explains how to build luatex (albeit briefly).

Even shorter: you should run these two commands

	$ ./build.sh
	<wait for the build to finish>
	$ cp build/texk/web2c/luatex <texmf-bin-dir>

But that just for your information, the luatex source code is almost
certainly not the cause of luatex's inability to find and load
ec-lmr12.tfm.

Best wishes,
Taco

From javier at digi21.eu  Fri Jan 30 11:54:54 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Fri, 30 Jan 2009 11:54:54 +0100
Subject: [Dev-luatex] Generating the sources
In-Reply-To: <4982006C.5070506@elvenkind.com>
References: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
	<4982006C.5070506@elvenkind.com>
Message-ID: <5088e64f0901300254l2ab0c39u82e2e751dd4b899e@mail.gmail.com>

>
>
> In the luatex distribution and the repository, there is a toplevel file
> called INSTALL. This explains how to build luatex (albeit briefly).


I'll try when I have time. I don't have regular acces to the Internet, so I
downloaded the source and then read the readme files at home. That is why I
hadn't seen the INSTALL. Please, do not believe that the first thing I do is
just asking.


> But that just for your information, the luatex source code is almost
> certainly not the cause of luatex's inability to find and load
> ec-lmr12.tfm.


Not so sure, pdftex generates the format without problem. Anyway, debuggin
it will help me find the problem, be it LuaTex fault or mine.


>
> Best wishes,
> Taco
>

Best wishes to you too
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090130/455ed76a/attachment.html>

From mojca.miklavec.lists at gmail.com  Fri Jan 30 15:46:48 2009
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 30 Jan 2009 15:46:48 +0100
Subject: [Dev-luatex] Generating the sources
In-Reply-To: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
References: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
Message-ID: <6faad9f00901300646wbf78e48s8f8d676adf56e18c@mail.gmail.com>

On Thu, Jan 29, 2009 at 6:32 PM, Javier M?gica wrote:
>
> I decided to compile and debug LuateX myself. Something worth indeed if I
> ever plan to become a developper. It was the first time I tangled something.
> I saw a luatangle.web (if my memory does not betray me), so I started
> tangling that, but I get pascal code, and I don't have a pascal compiler. I
> haven't had time ever since, so I simply stopped.
>
> Is there a way of generating c-source, or will I have to wait to September
> or so? If there is one, even though I am a programer a step-by-step
> explanation will be very wellcome.

Hello Javier,

I don't know if this will help you or not, but I used Taco's hint last
time when I had to debug something.

In build.sh script you can comment out "strip" command and then you
can use the resulting binary with gdb debugger. (However you'll
probably need the right compiler as well, but first check if you are
able to run ./build.sh)

Mojca

From root at www.metatex.org  Fri Jan 30 22:25:16 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 30 Jan 2009 22:25:16 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090130212516.D3A021E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1846 | taco | 2009-01-30 16:45:34 +0100 (Fri, 30 Jan 2009) | 4 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

support a MathConstants table while loading fonts via lua,
and make these settings have precedence over traditional 
tfm-style math parameters

------------------------------------------------------------------------
r1847 | taco | 2009-01-30 17:21:53 +0100 (Fri, 30 Jan 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

added a table listing default initializations of math parameters

------------------------------------------------------------------------

From khaledhosny at eglug.org  Sat Jan 31 10:53:09 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 31 Jan 2009 11:53:09 +0200
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <49818237.9020606@wxs.nl>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
	<20090129093528.GB6260@khaled-laptop> <49818237.9020606@wxs.nl>
Message-ID: <20090131095309.GB7529@khaled-laptop>

On Thu, Jan 29, 2009 at 11:17:27AM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
>> On Thu, Jan 29, 2009 at 01:02:26PM +0800, Yue Wang wrote:
>>> for LuaTeX. In ConTeXt world this is quite different, since Hans Hagen
>>> is a Lua+TeX+fontforge+MetaPost+whatever expert. So unless there exist
>>> several Hans Hagens in the LaTeX world, ordinary LaTeX users will not
>>> benefit from LuaTeX development.
>>
>> That is why I believe that we should have some means to share must of
>> the lower level Lua code across macro packages. For instance writing 2
>> or 3 OpenType layout modules is a waste of time, is it a big task of its
>
> it depends ... in that respect writing two or more macro packages is  
> also a waste of time (or even different variants of tables within a  
> macro package etc)

Somehow it is ;), people usually have different needs and thus different
macro packages, but I wonder why someone would need very different low level
OpenType implementation, but I may be wrong.

>> own especially if you want to cover all scripts, there exists 3 free
>> OpenType implementations and only one gets it almost right.
>
> as i've said before, at some point i will provide a kind of generic  
> variant of the context open type support, but currently my priority lays  
> with getting the oriental projects related font support done (which is  
> an interplay between font design and handling features) [so, any generic  
> context code would be provided as-is and development driven via the  
> context related lists]; with the luatex project we're not that much in a  
> hurry anyway: we reimplement parts of tex, honouring the basic design of  
>   tex, adding a few things only, and opening things up step by step;  
> after all, we have working pdftex's and xetex's so there is not that  
> much need to hurry, cook up half solutions, end up in incompatible patch  
> mode etc

But luatex has such great features that I want to use with other macro
packages, I want to typeset some Arabic technical documents with Texinfo
for example. May point is that, it would be great if we can have a kind
of reference implementations of some of the very need functionality like
OpenType, Unicode BiDi algorithm, Indic reordering and such, in a macro
independent way that one can plug anywhere and write some higher level
macro support on top of it. If a macro package don't feel like using it,
they can write their own of course. I can argue this though, I'm not the
one who writes the code here.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090131/eb958a6d/attachment.bin>

From root at www.metatex.org  Sat Jan 31 12:26:34 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 31 Jan 2009 12:26:34 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090131112634.307231E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1848 | oneiros | 2009-01-31 01:02:09 +0100 (Sat, 31 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

add missing declaration

------------------------------------------------------------------------
r1849 | oneiros | 2009-01-31 01:05:23 +0100 (Sat, 31 Jan 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

indent

------------------------------------------------------------------------

From pragma at wxs.nl  Sat Jan 31 18:07:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 31 Jan 2009 18:07:26 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090131095309.GB7529@khaled-laptop>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
	<20090129093528.GB6260@khaled-laptop> <49818237.9020606@wxs.nl>
	<20090131095309.GB7529@khaled-laptop>
Message-ID: <4984854E.3020808@wxs.nl>

Khaled Hosny wrote:

> Somehow it is ;), people usually have different needs and thus different
> macro packages, but I wonder why someone would need very different low level
> OpenType implementation, but I may be wrong.

well, first of all i need the exercise of writing the machinery in order 
to understand open type; also i often want to add extra visualization 
stuff for manuals and such;

>>> own especially if you want to cover all scripts, there exists 3 free
>>> OpenType implementations and only one gets it almost right.
>> as i've said before, at some point i will provide a kind of generic  
>> variant of the context open type support, but currently my priority lays  
>> with getting the oriental projects related font support done (which is  
>> an interplay between font design and handling features) [so, any generic  
>> context code would be provided as-is and development driven via the  
>> context related lists]; with the luatex project we're not that much in a  
>> hurry anyway: we reimplement parts of tex, honouring the basic design of  
>>   tex, adding a few things only, and opening things up step by step;  
>> after all, we have working pdftex's and xetex's so there is not that  
>> much need to hurry, cook up half solutions, end up in incompatible patch  
>> mode etc
> 
> But luatex has such great features that I want to use with other macro
> packages, I want to typeset some Arabic technical documents with Texinfo
> for example. May point is that, it would be great if we can have a kind
> of reference implementations of some of the very need functionality like
> OpenType, Unicode BiDi algorithm, Indic reordering and such, in a macro
> independent way that one can plug anywhere and write some higher level
> macro support on top of it. If a macro package don't feel like using it,
> they can write their own of course. I can argue this though, I'm not the
> one who writes the code here.

well, maybe eventually the mkiv code can serve that purpose, but as said 
before, once it all works ok, i'll split modules and cook up some 
minimal system (this is also part of a more layered context mkiv)

(btw, macro package independent way is non trivial, just look at how 
much independent stuff is there; long ago i made supp-pdf and even for 
something small and isolated like that latex interference problems kept 
coming up so eventually i ended up with stripping some code and having a 
  more extended module for context)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

