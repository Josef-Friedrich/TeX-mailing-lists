From chemoelectric at chemoelectric.org  Sun Feb  1 02:11:04 2009
From: chemoelectric at chemoelectric.org (Barry Schwartz)
Date: Sat, 31 Jan 2009 19:11:04 -0600
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090131095309.GB7529@khaled-laptop>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
	<20090129093528.GB6260@khaled-laptop> <49818237.9020606@wxs.nl>
	<20090131095309.GB7529@khaled-laptop>
Message-ID: <20090201011104.GA804@crud.crud.mn.org>

Khaled Hosny <khaledhosny at eglug.org> skribis:
> Somehow it is ;), people usually have different needs and thus different
> macro packages, but I wonder why someone would need very different low level
> OpenType implementation, but I may be wrong.

I think OpenType is more complicated than people tend to realize, and
less amenable to the 'black box' approach than one might think. I'm
judging from how well applications handle _Latin_ script, which
supposedly is simple. It's better to have Lua code that can be
customized easily.



From yannis.haralambous at telecom-bretagne.eu  Sun Feb  1 11:09:36 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 1 Feb 2009 11:09:36 +0100
Subject: [Dev-luatex] A few newbie questions
In-Reply-To: <20090201011104.GA804@crud.crud.mn.org>
References: <68bfdc900901272257v5e3f8c02he00c512ceed8d869@mail.gmail.com>
	<498023ED.80302@elvenkind.com>
	<68bfdc900901280613l43e38006n30c8c9f1111f7181@mail.gmail.com>
	<49807C2E.3090509@wxs.nl>
	<68bfdc900901282102n7a6cd019n94a07d35c839a256@mail.gmail.com>
	<20090129093528.GB6260@khaled-laptop> <49818237.9020606@wxs.nl>
	<20090131095309.GB7529@khaled-laptop>
	<20090201011104.GA804@crud.crud.mn.org>
Message-ID: <777DD9E0-0EBE-4C4A-8986-1776FE99929C@telecom-bretagne.eu>

Le 1 f?vr. 09 ? 02:11, Barry Schwartz a ?crit :

> I think OpenType is more complicated than people tend to realize, and

Complicated and also quite different from the TeX ligkern model. Also  
let us not forget that OpenType is aimed for a GUI where you can  
activate and deactivate properties, and see what happens. The result  
of a bunch of combined OpenType transformations is not always trivial  
to predict, but when you are on a GUI you don't care about that, you  
just see what happens.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090201/5fdee97c/attachment-0002.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090201/5fdee97c/attachment-0001.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090201/5fdee97c/attachment-0003.html>

From root at www.metatex.org  Sun Feb  1 16:25:28 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun,  1 Feb 2009 16:25:28 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090201152528.ECC9F1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1850 | taco | 2009-02-01 13:48:07 +0100 (Sun, 01 Feb 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

Add eight times eight math parameters (in all styles) for the 
inter-element mu spacing values

------------------------------------------------------------------------
r1851 | taco | 2009-02-01 14:38:55 +0100 (Sun, 01 Feb 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix handling of \the\Umath....spacing, and correct the behaviour for the 
impossible items

------------------------------------------------------------------------
r1852 | taco | 2009-02-01 15:36:13 +0100 (Sun, 01 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

Updated manual descriptions, and added the new 64 primitives

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Sun Feb  1 22:18:24 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 01 Feb 2009 22:18:24 +0100
Subject: [Dev-luatex] Strange behaviour
Message-ID: <498611A0.3070108@telecom-bretagne.eu>

Hello,

here is an example of some behaviours I find quite strange... It is a 
really short and simple example in plainTeX. It shows that if we have 
set \localleftbox or \localrightbox once, every line will have two more 
(empty) nodes. I think this behaviour is quite uncoherent, because 
packages (like GregorioTeX) set some \localleftbox and \localrightbox 
and then unsets them, so if someone wants to count the nodes of a line, 
this result will depend if he has a score in his document or not, even 
if he counts the nodes of a line that has nothing to do with a score... 
I think it would be better if these empty nodes were suppressed...

The other behaviour I find strange is that an attribute on a node can be 
both 1 and -1... It's just a curiosity, as the good way to test if an 
attribute exists is (I think) to call node.has_attribute with only two 
arguments. Also, is there a way to get the value of an attribute on a 
node by doing something else than testing some?

Thank you in advance,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-ll.zip
Type: application/zip
Size: 708 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090201/39244508/attachment.zip>

From root at www.metatex.org  Sun Feb  1 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun,  1 Feb 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090201212502.74FFE1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1853 | oneiros | 2009-02-01 18:01:45 +0100 (Sun, 01 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix a  warning: 'x' may be used uninitialized in this function

------------------------------------------------------------------------
r1854 | oneiros | 2009-02-01 18:07:39 +0100 (Sun, 01 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

indent

------------------------------------------------------------------------

From pragma at wxs.nl  Sun Feb  1 23:59:29 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 01 Feb 2009 23:59:29 +0100
Subject: [Dev-luatex] Strange behaviour
In-Reply-To: <498611A0.3070108@telecom-bretagne.eu>
References: <498611A0.3070108@telecom-bretagne.eu>
Message-ID: <49862951.3010607@wxs.nl>

Elie Roux wrote:

> The other behaviour I find strange is that an attribute on a node can be 
> both 1 and -1... It's just a curiosity, as the good way to test if an 
> attribute exists is (I think) to call node.has_attribute with only two 

setting an attribute to -1 is equivalent unsetting it (so the 
has_attribute test then returns nil); however the attribute node is 
still there since it's more efficient to release it when the node itself 
is released; we experimented with different implementations (sets, etc) 
but the current was the most efficient

we might use other negative values for special purposes (at least that 
was the original idea) so don't make code that depends on negative 
values because at some point we might make use of them

 > arguments. Also, is there a way to get the value of an attribute on a
 > node by doing something else than testing some?

you could follow the linked list of attributes of a node but in general 
the test

local a = node.has_attributes(n,123)

if a then
   ...
end

is more efficient

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Feb  2 10:00:46 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 10:00:46 +0100
Subject: [Dev-luatex] Strange behaviour
In-Reply-To: <498611A0.3070108@telecom-bretagne.eu>
References: <498611A0.3070108@telecom-bretagne.eu>
Message-ID: <4986B63E.6010605@elvenkind.com>



Elie Roux wrote:
> Hello,
> 
> here is an example of some behaviours I find quite strange... It is a
> really short and simple example in plainTeX. It shows that if we have
> set \localleftbox or \localrightbox once, every line will have two more
> (empty) nodes. I think this behaviour is quite uncoherent, because
> packages (like GregorioTeX) set some \localleftbox and \localrightbox
> and then unsets them, so if someone wants to count the nodes of a line,
> this result will depend if he has a score in his document or not, even
> if he counts the nodes of a line that has nothing to do with a score...
> I think it would be better if these empty nodes were suppressed...

The problem is that you can not truly unset the \local{right,left}box
because they were meant for partial use within just a few lines inside
a paragraph.

\localleftbox = {} just assigns an empty \hbox{}, which is not the same
as nothing at all. The only way to get rid of the content is via
grouping.

I have options:

1. delete the empty nodes as you propose and/or make {} mean: unset it
2. switch the input syntax to \box-style format with an explicit \hbox
   (this has my preference)
3. do nothing



Best wishes,
Taco










From elie.roux at telecom-bretagne.eu  Mon Feb  2 15:56:10 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 02 Feb 2009 15:56:10 +0100
Subject: [Dev-luatex] Strange behaviour
In-Reply-To: <4986B63E.6010605@elvenkind.com>
References: <498611A0.3070108@telecom-bretagne.eu>
	<4986B63E.6010605@elvenkind.com>
Message-ID: <4987098A.50606@telecom-bretagne.eu>

I have finally found the bug I was tracking in Gregorio for some time... 
Here is an example where putting empty boxes does not lead to a strange 
behaviour, but to a really buggy behaviour: If an empty \localleftbox is 
set with attribute 1, and after that we set the attribute to -1, the 
lines after the first will still have the attribute set to 1, because 
the empty box will set it... It is I think extremely confusing, and it's 
a bug that is difficult to track (even if now that I have the solution 
it will be a one-liner patch to fix it). So I insist, I think that 
removing the nodes will be much better, because this kind of behaviour 
will certainly appear with a lot of styles using \localleftbox.
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-l.zip
Type: application/zip
Size: 761 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090202/f402c9f3/attachment.zip>

From elie.roux at telecom-bretagne.eu  Mon Feb  2 11:12:20 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 02 Feb 2009 11:12:20 +0100
Subject: [Dev-luatex] Strange behaviour
In-Reply-To: <4986B63E.6010605@elvenkind.com>
References: <498611A0.3070108@telecom-bretagne.eu>
	<4986B63E.6010605@elvenkind.com>
Message-ID: <4986C704.7020304@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> 1. delete the empty nodes as you propose and/or make {} mean: unset it
>   

I still think it's the best solution...

> 2. switch the input syntax to \box-style format with an explicit \hbox
>    (this has my preference)
>   

I don't really like this one, because it totally breaks 
retro-compatibility, to gain something less important...
-- 
Elie

From javier at digi21.eu  Mon Feb  2 10:29:01 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 2 Feb 2009 10:29:01 +0100
Subject: [Dev-luatex] Floating point exception
Message-ID: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>

I don't know whether this is a problem of luatex or of my Linux, but with
the latest version I get this message from the operating system (because it
is in Spanish)

javier at javier-laptop:~$ luatex
Excepci?n de coma flotante
javier at javier-laptop:~$

i.e., "floating point exception". I do not even see the "This is Luatex... "
message.

--Javier A.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090202/1d6ff61b/attachment.html>

From javier at digi21.eu  Mon Feb  2 10:19:55 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 2 Feb 2009 10:19:55 +0100
Subject: [Dev-luatex] Generating the sources
In-Reply-To: <6faad9f00901300646wbf78e48s8f8d676adf56e18c@mail.gmail.com>
References: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>
	<6faad9f00901300646wbf78e48s8f8d676adf56e18c@mail.gmail.com>
Message-ID: <5088e64f0902020119s44bc7e74lb79d496e96158210@mail.gmail.com>

I finally found the reason why was unable to generate the format. It is a
luatex bug. First the report (which I had prepeared before discovering the
cause).

I have experienced the same problem both under Windows (XP) and under Linux
(Ubuntu), and not only with lmr fonts but also with cmr10; and with any
version I have tried since the one from TeXLive 2008.

Here are the last lines of output with kpathsea-debug=-1 for LuaTeX and the
corresponding ones for PdfTeX, as well as the relevant lines from texmf.cnf.
Although the directory is named texlive2007 the executables are from
texlive2008.

LuaTeX:

kdebug:fopen(/usr/local/texlive2007/texfm/fonts/map/fontname/texfonts.map,
r) => 0xcb5590
kdebug:fclose(0x8cb5590) => 0
kdebug:hash_lookup(ec-lmr12.ofm) => (nil)
kdebug:hash_lookup(ec-lmr12) => (nil)
kdebug:hash_lookup(ec-lmr12.tfm) => (nil)
kdebug:hash_lookup(ec-lmr12) => (nil)
kdebug:start search(files=[ec-lmr12.ofm ec-lmr12.tfm], must_exist=0,
find_all=0, path=!!/usr/local/texlive2007/texfm/fonts).
kdebug:hash_lookup(ec-lmr12.ofm) => (nil)
kdebug:hash_lookup(ec-lmr12.tfm) =>
/usr/local/texlive2007/texfm/fonts/tfm/public/lm/
kdebug:start search(files=[ec-lmr12.ofm ec-lmr12.tfm], must_exist=1,
find_all=0, path=!!/usr/local/texlive2007/texfm/fonts).
kdebug:hash_lookup(ec-lmr12.ofm) => (nil)
kdebug:db:match(/usr/local/texlive2007/texfm/fonts/tfm/public/lm/ec-lmr12.tfm,/usr/local/texlive2007/texfm/fonts)
= 0
kdebug:search([ec-lmr12.ofm ec-lmr12.tfm]) =>

! Font \twelverm=ec-lmr12 not loadable: metric data not found or bad.
<to be read again>


PdfTeX:

kdebug:fopen(/usr/local/texlive2007/texfm/fonts/map/fontname/texfonts.map,
r) => 0x83491e8
kdebug:fclose(0x83491e8) => 0
kdebug:hash_lookup(ec-lmr12.tfm) => (nil)
kdebug:hash_lookup(ec-lmr12) => (nil)
kdebug:start search(files=[ec-lmr12.tfm], must_exist=0, find_all=0,
path=.:!!/usr/local/texlive2007/texfm/fonts/tfm//).
kdebug:kpse_normalize_path (.) => 0
kdebug:kpse_normalize_path (./ec-lmr12.tfm) => 0
kdebug:hash_lookup(ec-lmr12.tfm) =>
/usr/local/texlive2007/texfm/fonts/tfm/public/lm/
kdebug:db:match(/usr/local/texlive2007/texmf/fonts/tfm/public/lm/ec-lmr12.tfm,/usr/local/texlive2007/texmf/fonts/tfm//)
= 1
kdebug:search([ec-lmr12.tfm]) =>
/usr/local/texlive2007/texfm/fonts/tfm/public/lm/ec-lmr12.tfm
kdebug:fopen(/usr/local/texlive2007/texfm/fonts/tfm/public/lm/ec-lmr12.tfm,
rb) => 0x834e418
kdebug:fclose(0x834e418) => 0

kdebug:start search(files=[ec-lmr12.ofm ec-lmr12.tfm], must_exist=1,
find_all=0, path=!!/usr/local/texlive2007/texfm/fonts).
kdebug:hash_lookup(ec-lmr12.ofm) => (nil)
kdebug:db:match(/usr/local/texlive2007/texfm/fonts/tfm/public/lm/ec-lmr12.tfm,/usr/local/texlive2007/texfm/fonts)
= 0
kdebug:search([ec-lmr12.ofm ec-lmr12.tfm]) =>


Relevant lines from texmf.cnf:

% A shortcut
TEXFONTS= $TEXMF/fonts

% Device-independent font metric files.
VFFONTS = .;$TEXFONTS/vf//
TFMFONTS = .;$TEXFONTS/tfm//

I don't have the variable OFMFONTS set.



%%%%%%%%%%%%%%    %%%%%%%%%%%%%

I found that the reason was that the OFMFONTS variable is not set, even if I
don't have any ofm file in my computer. Furthermore, setting it to ./ (in
Windows I tried) does not solve the problem. I tryed with a dummy

OFMFONTS = $TFMFONTS

and it works.

Note that my first message some months ago was entitled "Keep looking for
ofm files, why?"

--Javier A.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090202/db2f4485/attachment.html>

From root at www.metatex.org  Mon Feb  2 16:25:08 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  2 Feb 2009 16:25:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090202152508.48E631E8C3FB@www.metatex.org>

------------------------------------------------------------------------
r1855 | taco | 2009-02-02 12:37:48 +0100 (Mon, 02 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

add a paragraph about OFMFONTS vs TFMFONTS

------------------------------------------------------------------------

From root at www.metatex.org  Mon Feb  2 22:25:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  2 Feb 2009 22:25:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090202212507.E7C7E1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1856 | taco | 2009-02-02 18:29:11 +0100 (Mon, 02 Feb 2009) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

don't use the MathConstant AccentBaseHeight unless unavoidable
(accent placement is a font-specific parameter, not a global math
parameter)

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb  2 22:34:58 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 02 Feb 2009 22:34:58 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
Message-ID: <49876702.6050305@telecom-bretagne.eu>

Javier M?gica a ?crit :
> javier at javier-laptop:~$ luatex
> Excepci?n de coma flotante

I'm not a developer, but I think noone can't do anything without knowing 
the exact LuaTeX version you're using and your (precise) OS.
-- 
Elie

From arthur.reutenauer at normalesup.org  Mon Feb  2 22:57:39 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Feb 2009 22:57:39 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
Message-ID: <20090202215739.GG22175@phare.normalesup.org>

> i.e., "floating point exception". I do not even see the "This is Luatex... "
> message.

  I remember we had that when we tried using on 32-bit Linux a binary
that was compiled on 64-bit Linux, or something like that.  I even
remember Luigi Scarso was one of the people who reported it to the
ConTeXt list (probably around August 6th, 2007).  But I can't say much
more.

	Arthur

From taco at elvenkind.com  Mon Feb  2 23:05:59 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 23:05:59 +0100
Subject: [Dev-luatex] Generating the sources
In-Reply-To: <5088e64f0902020119s44bc7e74lb79d496e96158210@mail.gmail.com>
References: <5088e64f0901290932y7212116dle704330f7e060ad2@mail.gmail.com>	<6faad9f00901300646wbf78e48s8f8d676adf56e18c@mail.gmail.com>
	<5088e64f0902020119s44bc7e74lb79d496e96158210@mail.gmail.com>
Message-ID: <49876E47.8010701@elvenkind.com>


Hi,

Javier M?gica wrote:
> 
> %%%%%%%%%%%%%%    %%%%%%%%%%%%%
> 
> I found that the reason was that the OFMFONTS variable is not set, even 
> if I don't have any ofm file in my computer. Furthermore, setting it to 
> ./ (in Windows I tried) does not solve the problem. I tryed with a dummy
> 
> OFMFONTS = $TFMFONTS

For the benefit of the readers here:

Javier and I cracked this issue by email earlier today (while the 
mailing list was still misbehaving itself). I have added a paragraph
to the  manual explaining that proper definitions for the OFMFONTS and
OVFFONTS are vital if you want to run luatex with kpathsea as file
discovery agent.

Best wishes,
Taco

From martin at oneiros.de  Mon Feb  2 23:14:04 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Mon, 2 Feb 2009 23:14:04 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
Message-ID: <68c491a60902021414ya33eca4idfeaee913250b02e@mail.gmail.com>

2009/2/2 Javier M?gica <javier at digi21.eu>:
> I don't know whether this is a problem of luatex or of my Linux, but with
> the latest version I get this message from the operating system (because it
> is in Spanish)
>
> javier at javier-laptop:~$ luatex
> Excepci?n de coma flotante
> javier at javier-laptop:~$
>
> i.e., "floating point exception". I do not even see the "This is Luatex... "
> message.

Probably the architecture of the binary and your kernel don't match.
What say
file `which luatex`
uname -a

Best
   Martin

From taco at elvenkind.com  Mon Feb  2 23:20:49 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 23:20:49 +0100
Subject: [Dev-luatex] Strange behaviour
In-Reply-To: <4986C704.7020304@telecom-bretagne.eu>
References: <498611A0.3070108@telecom-bretagne.eu>	<4986B63E.6010605@elvenkind.com>
	<4986C704.7020304@telecom-bretagne.eu>
Message-ID: <498771C1.9040300@elvenkind.com>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> 1. delete the empty nodes as you propose and/or make {} mean: unset it
>>   
> 
> I still think it's the best solution...

Ok, your bug report convinced me. Even so, it may take a few weeks
before I get around to fixing this, so you will have to be patient
for a bit longer.

Best wishes,
Taco

From taco at elvenkind.com  Mon Feb  2 23:28:24 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 23:28:24 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <68c491a60902021414ya33eca4idfeaee913250b02e@mail.gmail.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
	<68c491a60902021414ya33eca4idfeaee913250b02e@mail.gmail.com>
Message-ID: <49877388.9050603@elvenkind.com>

Martin Schr?der wrote:
> 2009/2/2 Javier M?gica <javier at digi21.eu>:
>> I don't know whether this is a problem of luatex or of my Linux, but with
>> the latest version I get this message from the operating system (because it
>> is in Spanish)
>>
>> javier at javier-laptop:~$ luatex
>> Excepci?n de coma flotante
>> javier at javier-laptop:~$
>>
>> i.e., "floating point exception". I do not even see the "This is Luatex... "
>> message.
> 
> Probably the architecture of the binary and your kernel don't match.

Ah, right. Are you using the binaries from contextgarden.net?

If yes, then the problem is most likely that your linux kernel is still
from the 2.4.x series. After the contextgarden upgrade, the binaries
that are distributed from there are for 2.6.x (it seems nobody has an
"old enough" linux install readily available any more).

Best wishes,
Taco



From mojca.miklavec.lists at gmail.com  Tue Feb  3 10:46:00 2009
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 3 Feb 2009 10:46:00 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <49877388.9050603@elvenkind.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
	<68c491a60902021414ya33eca4idfeaee913250b02e@mail.gmail.com>
	<49877388.9050603@elvenkind.com>
Message-ID: <6faad9f00902030146yb5c1676k630ba6d04dca922e@mail.gmail.com>

On Mon, Feb 2, 2009 at 11:28 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Martin Schr?der wrote:
>>
>> 2009/2/2 Javier M?gica <javier at digi21.eu>:
>>>
>>> I don't know whether this is a problem of luatex or of my Linux, but with
>>> the latest version I get this message from the operating system (because
>>> it
>>> is in Spanish)
>>>
>>> javier at javier-laptop:~$ luatex
>>> Excepci?n de coma flotante
>>> javier at javier-laptop:~$
>>>
>>> i.e., "floating point exception". I do not even see the "This is
>>> Luatex... "
>>> message.
>>
>> Probably the architecture of the binary and your kernel don't match.
>
> Ah, right. Are you using the binaries from contextgarden.net?
>
> If yes, then the problem is most likely that your linux kernel is still
> from the 2.4.x series. After the contextgarden upgrade, the binaries
> that are distributed from there are for 2.6.x (it seems nobody has an
> "old enough" linux install readily available any more).

Let him answer first, but I think that I compiled the binaries on the
old machine and there has been no new LuaTeX release since we switched
the server. So those binaries should still be fine for a while. The
binaries from supelec could suffer from that problem though.

Mojca

From javier at digi21.eu  Wed Feb  4 18:50:53 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 4 Feb 2009 18:50:53 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <20090202215739.GG22175@phare.normalesup.org>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
	<20090202215739.GG22175@phare.normalesup.org>
Message-ID: <5088e64f0902040950y72b58395t6d864767a304f53c@mail.gmail.com>

I should try first which version is the last working for me and which one is
the first not working. But before anything I should update my Ubuntu Linux,
which is some two years old. I won't be able to do that till the summer, but
that is no problem since I usually use Windows on the same computer, and
there I do not get the exception.

So don't worry very much about it, it is llikely to be solved when I install
a newer Linux.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090204/2550c291/attachment.html>

From mojca.miklavec.lists at gmail.com  Wed Feb  4 20:36:05 2009
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 4 Feb 2009 20:36:05 +0100
Subject: [Dev-luatex] Floating point exception
In-Reply-To: <5088e64f0902040950y72b58395t6d864767a304f53c@mail.gmail.com>
References: <5088e64f0902020129l2cb0b52dtbbefd6bc3696d437@mail.gmail.com>
	<20090202215739.GG22175@phare.normalesup.org>
	<5088e64f0902040950y72b58395t6d864767a304f53c@mail.gmail.com>
Message-ID: <6faad9f00902041136u76bda52bh727da00c122a4fab@mail.gmail.com>

On Wed, Feb 4, 2009 at 6:50 PM, Javier M?gica wrote:
> I should try first which version is the last working for me and which one is
> the first not working. But before anything I should update my Ubuntu Linux,
> which is some two years old. I won't be able to do that till the summer, but
> that is no problem since I usually use Windows on the same computer, and
> there I do not get the exception.
>
> So don't worry very much about it, it is llikely to be solved when I install
> a newer Linux.

It's probably not about the wrong version, but about trying to use a
binary compiled on a recent linux on some too old system.

Can you please try the following two binaries:
1.) http://foundry.supelec.fr/frs/download.php/700/luatex-beta-0.30.3-linux2.6-i386.tar.bz2
2.) http://minimals.contextgarden.net/current/bin/luatex/linux/bin/luatex

If I'm suspecting right, the first one should fail and the second one
should work. (And if you compile it yourself, it should work in any
case.)

Mojca

From root at www.metatex.org  Thu Feb  5 12:26:45 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  5 Feb 2009 12:26:45 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090205112645.A666F1E8C404@www.metatex.org>

------------------------------------------------------------------------
r1857 | taco | 2009-02-05 11:00:48 +0100 (Thu, 05 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

allow math_char and math_given in v and h modes

------------------------------------------------------------------------

From root at www.metatex.org  Thu Feb  5 16:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  5 Feb 2009 16:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090205152505.EE5371E8C403@www.metatex.org>

------------------------------------------------------------------------
r1858 | taco | 2009-02-05 14:55:58 +0100 (Thu, 05 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/libs/luafontforge/src/luafflib.c
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix (and extend) math accent horizontal placement

------------------------------------------------------------------------

From root at www.metatex.org  Fri Feb  6 16:25:18 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  6 Feb 2009 16:25:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090206152518.3823B1E8C405@www.metatex.org>

------------------------------------------------------------------------
r1859 | taco | 2009-02-06 15:40:54 +0100 (Fri, 06 Feb 2009) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

implement \Uroot, \Umathradicaldegreebefore, \Umathradicaldegreeafter, 
\Umathradicaldegreeshift, and their font-based counterparts

------------------------------------------------------------------------

From root at www.metatex.org  Fri Feb  6 22:25:09 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  6 Feb 2009 22:25:09 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090206212509.1E9901E8C405@www.metatex.org>

------------------------------------------------------------------------
r1860 | taco | 2009-02-06 16:34:07 +0100 (Fri, 06 Feb 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

make sure the lua stack is restored to its initial state after the 
mlist_to_hlist callback returns

------------------------------------------------------------------------
r1861 | taco | 2009-02-06 17:22:00 +0100 (Fri, 06 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

Support  MinimumDisplayOperatorHeight and add the matching \Umathoperatorsize

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Sat Feb  7 18:31:14 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Feb 2009 18:31:14 +0100
Subject: [Dev-luatex] missing signature in the manual
Message-ID: <498DC562.3040100@telecom-bretagne.eu>

Hello,

In the manual one can read:

This callback allows you to replace the way LuaTeX fetches lexical tokens.
function()
     return <table> token
end

I think that the argument(s) of function are missing. Also about 
buildpage_filter:

function(<string> extrainfo)
end

the function doesn't need to return anything?

Finally the char_exists callback is not documented but is in callback.list()

Thank you!
-- 
Elie

From taco at elvenkind.com  Sat Feb  7 19:00:30 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Feb 2009 19:00:30 +0100
Subject: [Dev-luatex] missing signature in the manual
In-Reply-To: <498DC562.3040100@telecom-bretagne.eu>
References: <498DC562.3040100@telecom-bretagne.eu>
Message-ID: <498DCC3E.4030407@elvenkind.com>

Elie Roux wrote:
> Hello,
> 
> In the manual one can read:
> 
> This callback allows you to replace the way LuaTeX fetches lexical tokens.
> function()
>     return <table> token
> end

The manual is not wrong, but this callback should be renamed
into 'get_token' or so. There is no argument because the intent
is for the lua function to run token.get_next() c.s. to find
the next suitable token. And a bit of extra explanation in the
manual would be good too.

> I think that the argument(s) of function are missing. Also about 
> buildpage_filter:
> 
> function(<string> extrainfo)
> end
> 
> the function doesn't need to return anything?

and it doesn't get any useful arguments either. The manual is correct;
all input and output comes from and goes to various the tex.lists
entries like tex.lists.page_head and tex.lists.contrib_head.

The engine itself needs more work in this area. What is currently
provided is more to 'test the waters' and by no means final yet.
(this type of procedure where all arguments are global variables
is regrettably typical of how the pascal web side of things work)

> Finally the char_exists callback is not documented but is in 
> callback.list()

That one doesn't actually work (it is never called). There are
interesting issues when it comes to the timing of this, and that made
me stop when I first looked at it (seems like a long time ago).
The original goal of this callback was to provide a method to create
missing glyphs on the fly, but it was surprisingly hard to find the
right time to do that check.

Just after hyphenation and before the kerning/ligaturing step would
be a good moment, but since those are all callbacks now themselves,
maybe I should just forget about char_exists completely.

Best wishes,
Taco




Best wishes,
Taco


From elie.roux at telecom-bretagne.eu  Sat Feb  7 19:07:26 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Feb 2009 19:07:26 +0100
Subject: [Dev-luatex] start_run not working
Message-ID: <498DCDDE.7000706@telecom-bretagne.eu>

I tried the following code:

\directlua0{
local function simpleone()
    return "I'm number 1"
end

local function simpletwo()
    texio.write_nl("I'm number 1")
end

callback.register("start_run",simpletwo)
}

and got no result neither by replacing simpletwo by simpleone in the 
callback. Is it normal? The simpletwo function works fine with the 
callbacks "stop_run".
-- 
Elie

From taco at elvenkind.com  Sat Feb  7 19:11:15 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Feb 2009 19:11:15 +0100
Subject: [Dev-luatex] start_run not working
In-Reply-To: <498DCDDE.7000706@telecom-bretagne.eu>
References: <498DCDDE.7000706@telecom-bretagne.eu>
Message-ID: <498DCEC3.2070600@elvenkind.com>

Elie Roux wrote:
> I tried the following code:
> 
> \directlua0{
> local function simpleone()
>    return "I'm number 1"
> end
> 
> local function simpletwo()
>    texio.write_nl("I'm number 1")
> end
> 
> callback.register("start_run",simpletwo)
> }
> 
> and got no result neither by replacing simpletwo by simpleone in the 
> callback. Is it normal? 

The luatex run has started already, so your callback.register comes
too late. You need to define the function and the callback.register
in the startup lua script.

Best wishes,
Taco



From elie.roux at telecom-bretagne.eu  Sat Feb  7 19:17:22 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Feb 2009 19:17:22 +0100
Subject: [Dev-luatex] start_run not working
In-Reply-To: <498DCEC3.2070600@elvenkind.com>
References: <498DCDDE.7000706@telecom-bretagne.eu>
	<498DCEC3.2070600@elvenkind.com>
Message-ID: <498DD032.6040108@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> The luatex run has started already, so your callback.register comes
> too late. You need to define the function and the callback.register
> in the startup lua script.

Ok, thank you for your explanations! I think some words about it in the 
manual would be good, even if now that you say it, it's logical.
-- 
Elie

From pragma at wxs.nl  Sun Feb  8 00:35:08 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 08 Feb 2009 00:35:08 +0100
Subject: [Dev-luatex] missing signature in the manual
In-Reply-To: <498DCC3E.4030407@elvenkind.com>
References: <498DC562.3040100@telecom-bretagne.eu>
	<498DCC3E.4030407@elvenkind.com>
Message-ID: <498E1AAC.8070605@wxs.nl>

Taco Hoekwater wrote:

> That one doesn't actually work (it is never called). There are
> interesting issues when it comes to the timing of this, and that made
> me stop when I first looked at it (seems like a long time ago).
> The original goal of this callback was to provide a method to create
> missing glyphs on the fly, but it was surprisingly hard to find the
> right time to do that check.
> 
> Just after hyphenation and before the kerning/ligaturing step would
> be a good moment, but since those are all callbacks now themselves,
> maybe I should just forget about char_exists completely.

if i remember right we dropped the idea char_exists in favour of the 
ability to add (virtual) characters to a font (only once per char) but 
we put than wish on the long term wishlist

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Feb  8 17:39:15 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 8 Feb 2009 18:39:15 +0200
Subject: [Dev-luatex] bug in \parshape with TRT direction
Message-ID: <20090208163915.GA29938@khaled-laptop>

\parshape doesn't work as expected for TRT direction in PDF mode, it
works fine in DVI mode but in PDF indentation moves the text to the
right instead of to the left. This breaks LaTeX lists in TRT direction.

See the difference between DVI and PDF output of the attached plain TeX
sample file.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: parshape.tex
Type: text/x-tex
Size: 221 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090208/f20ce3d4/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090208/f20ce3d4/attachment-0001.bin>

From elie.roux at telecom-bretagne.eu  Thu Feb 12 14:32:48 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 12 Feb 2009 14:32:48 +0100
Subject: [Dev-luatex] additional argument to kpse.find_file?
Message-ID: <49942500.3090201@telecom-bretagne.eu>

Hello,

I found that a problem in the mplib package was to find mpost.mem in 
TeXLive: It cant be found with kpse.find_file(). I can't be found 
neither with "kpsewhich --format mem --must-exist mpost.mem", but in 
TeXLive 2008, it can be found with "kpsewhich --format mem --engine 
metapost mpost.mem". The problem is that I can't pass the "engine" 
option to kpse.find_file(). Is it is possible to add it? I think it will 
benefit more packages than only mplib.

Thank you in advance,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Thu Feb 12 15:29:41 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 12 Feb 2009 15:29:41 +0100
Subject: [Dev-luatex] Segmentation fault
Message-ID: <49943255.1090704@telecom-bretagne.eu>

Hello,

As kpse.find_file can't get the path of mpost.mem, I made some 
experimentations and got a segmentation fault with texlua (revision 
1858, on debian/sid 32 bit) on the following code:

kpse.set_program_name("toto")

local filename = "/var/lib/texmf/web2c/metapost/mpost.mem"

function finder (name, mode, ftype)
    if mode == "w" then
        return name
    else
        local result = kpse.find_file(name,ftype)
        if not result and name == "mpost.mem" then
           result = filename
        end
        return result
    end
end

local mpx = mplib.new {
    ini_version = false,
    mem_name = "mpost.mem",
    find_file = finder
}

you have to replace filename by the true value of you mpost.mem to get 
the segfault.

Thank you,
-- 
Elie

From root at www.metatex.org  Fri Feb 13 16:25:13 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 13 Feb 2009 16:25:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090213152513.6419E1E8C407@www.metatex.org>

------------------------------------------------------------------------
r1862 | taco | 2009-02-13 13:45:24 +0100 (Fri, 13 Feb 2009) | 1 line
Changed paths:
   M /trunk/src/libs/luafontforge/fontforge/fontforge/parsettf.c

quick fix to greatly reduce memory usage of fontforge.open while loading ttf/otf fonts with a large number of glyphs
------------------------------------------------------------------------
r1863 | taco | 2009-02-13 13:51:50 +0100 (Fri, 13 Feb 2009) | 1 line
Changed paths:
   M /trunk/manual/luatexref-t.pdf

regenerated with a better context mkiv beta
------------------------------------------------------------------------
r1864 | oneiros | 2009-02-13 13:57:01 +0100 (Fri, 13 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/graphics/fontdir.pdf

application/pdf

------------------------------------------------------------------------
r1865 | taco | 2009-02-13 14:18:21 +0100 (Fri, 13 Feb 2009) | 1 line
Changed paths:
   M /trunk/src/texk/web2c/mpdir/mp.w

fix a crash when there is an error found in a mem file that cannot be found in the normal fashion
------------------------------------------------------------------------

From root at www.metatex.org  Sat Feb 14 12:26:39 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 14 Feb 2009 12:26:39 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090214112639.D19CE1E8C408@www.metatex.org>

------------------------------------------------------------------------
r1866 | taco | 2009-02-14 09:58:59 +0100 (Sat, 14 Feb 2009) | 1 line
Changed paths:
   M /trunk/src/libs/luafontforge/fontforge/fontforge/parsettf.c

fix a memory leak deep inside fontforge
------------------------------------------------------------------------

From yuleopen at gmail.com  Sun Feb 15 16:09:53 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Sun, 15 Feb 2009 23:09:53 +0800
Subject: [Dev-luatex] Thank you, Taco!
Message-ID: <68bfdc900902150709w70ca279es8be83eb4329fe8d2@mail.gmail.com>

Hi, Taco:


After my testing the context/experimental with the trunk version of LuaTeX,
the memory usage for loading CJK fonts are much lower than before
(300MB vs. 850MB on Adobe Songti Std Light, Windows XP),
and the loading time is also shorter, too. So thanks a lot for the work!
I think many users on the list will be happy too (like Wolfgang,
Yanrui Li, Dr. Kim, Longming Wang, etc...)

Yue Wang

From taco at elvenkind.com  Mon Feb 16 14:01:15 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 16 Feb 2009 14:01:15 +0100
Subject: [Dev-luatex] Thank you, Taco!
In-Reply-To: <68bfdc900902150709w70ca279es8be83eb4329fe8d2@mail.gmail.com>
References: <68bfdc900902150709w70ca279es8be83eb4329fe8d2@mail.gmail.com>
Message-ID: <4999639B.6010400@elvenkind.com>



Yue Wang wrote:
> Hi, Taco:
> 
> 
> After my testing the context/experimental with the trunk version of LuaTeX,
> the memory usage for loading CJK fonts are much lower than before
> (300MB vs. 850MB on Adobe Songti Std Light, Windows XP),
> and the loading time is also shorter, too. So thanks a lot for the work!
> I think many users on the list will be happy too (like Wolfgang,
> Yanrui Li, Dr. Kim, Longming Wang, etc...)

This patch was coded at the KTS meeting in Seoul. As far as I know, it
is faster only because there is less swapping involved and/or malloc()
is more efficient. The exact same amount of work is done as before. In
particular, the glyph boundingboxes are still correctly calculated.

Best wishes,
Taco

From yuleopen at gmail.com  Mon Feb 16 17:05:23 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 17 Feb 2009 00:05:23 +0800
Subject: [Dev-luatex] Thank you, Taco!
In-Reply-To: <4999639B.6010400@elvenkind.com>
References: <68bfdc900902150709w70ca279es8be83eb4329fe8d2@mail.gmail.com>
	<4999639B.6010400@elvenkind.com>
Message-ID: <68bfdc900902160805j598b18e6j9d50e0649ee5cf88@mail.gmail.com>

Hi, Taco:

> This patch was coded at the KTS meeting in Seoul. As far as I know, it
> is faster only because there is less swapping involved and/or malloc()
> is more efficient. The exact same amount of work is done as before. In
> particular, the glyph boundingboxes are still correctly calculated.

Yes, I know. The bounding boxes are still calculated. Thanks a lot for the
patched code and explanation.
(and you are also right that less swapping is the real cause for less
runtime on my machine,it is the first time that LuaTeX loads big CJK fonts
without swapping on my machine).

btw, I think the bounding boxes (or control boxes) are useful for CJK
languages in some cases.
Remember in MKIV Hans wrote a lot of code and set many constant parameters
to handle the punctuation compression?
These parameters should be font dependent (It will produce ugly result when
the font is changed).
But in fact we can use the boudningbox information for better calculation.
For example, we can compress the "?" and """ by just gluing their bouding
boxes.
It was difficult to make  punctuations like "?" at the end of the line close
to the margin line. but now with bounding box information it is also
possible.
in short, I think we can handle "punctuation compression" and "margin
kerning" using the bounding box information.What do you think of this idea,
Wolfgang?


Yue Wang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20090217/9dffa440/attachment.html>

From pragma at wxs.nl  Mon Feb 16 18:04:51 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Feb 2009 02:04:51 +0900
Subject: [Dev-luatex] Thank you, Taco!
In-Reply-To: <68bfdc900902160805j598b18e6j9d50e0649ee5cf88@mail.gmail.com>
References: <68bfdc900902150709w70ca279es8be83eb4329fe8d2@mail.gmail.com>	<4999639B.6010400@elvenkind.com>
	<68bfdc900902160805j598b18e6j9d50e0649ee5cf88@mail.gmail.com>
Message-ID: <49999CB3.4030903@wxs.nl>

Yue Wang wrote:

> in short, I think we can handle "punctuation compression" and "margin
> kerning" using the bounding box information.What do you think of this idea,
> Wolfgang?

best move that kind of discussions to the context list as it does not
related to luatex dev

Hans

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Mon Feb 16 22:25:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 16 Feb 2009 22:25:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090216212507.D7FE81E8C408@www.metatex.org>

------------------------------------------------------------------------
r1867 | taco | 2009-02-16 16:49:08 +0100 (Mon, 16 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/tounicode.c

allow defaulted tounicode entries (==code point)

------------------------------------------------------------------------

From root at www.metatex.org  Tue Feb 17 12:26:21 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 17 Feb 2009 12:26:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090217112621.3FF6D1E8C408@www.metatex.org>

------------------------------------------------------------------------
r1868 | taco | 2009-02-17 11:40:58 +0100 (Tue, 17 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/src/luafflib.c

simplify MathVariants names

------------------------------------------------------------------------

From root at www.metatex.org  Wed Feb 18 22:25:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 18 Feb 2009 22:25:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090218212505.E97751E8C408@www.metatex.org>

------------------------------------------------------------------------
r1869 | taco | 2009-02-18 17:44:16 +0100 (Wed, 18 Feb 2009) | 9 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

1. Fixup the math parameter error message, it could create crashes
   because of premature free().
2. Switch font internals to the MathVariant model (extension of extensible
   recipe); start interpreting MathConstants.MinConnectorOverlap; add the new
   primitive \Umathconnectoroverlapmin; read in and dump new "hor_variants"
   and "vert_variants" charinfo subtables from lua (oldstyle "extensible" is
   still read in, but no longer written); update the manual source.


------------------------------------------------------------------------

From root at www.metatex.org  Thu Feb 19 12:26:23 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Feb 2009 12:26:23 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090219112623.C04271E8C408@www.metatex.org>

------------------------------------------------------------------------
r1870 | taco | 2009-02-19 11:03:13 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/mathcodes.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/textcodes.c

i do a small bit of memory cleanup

------------------------------------------------------------------------
r1871 | taco | 2009-02-19 11:17:19 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf

Upload the new manual pdf

------------------------------------------------------------------------

From root at www.metatex.org  Thu Feb 19 16:25:25 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Feb 2009 16:25:25 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090219152525.EE78E1E8C408@www.metatex.org>

------------------------------------------------------------------------
r1872 | oneiros | 2009-02-19 16:15:23 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /vendor/libpng/current/ANNOUNCE
   M /vendor/libpng/current/CHANGES
   M /vendor/libpng/current/INSTALL
   M /vendor/libpng/current/KNOWNBUG
   M /vendor/libpng/current/LICENSE
   M /vendor/libpng/current/README
   M /vendor/libpng/current/Y2KINFO
   M /vendor/libpng/current/configure
   M /vendor/libpng/current/example.c
   D /vendor/libpng/current/libpng-1.2.34.txt
   A /vendor/libpng/current/libpng-1.2.35.txt (from /vendor/libpng/current/libpng-1.2.34.txt:1840)
   M /vendor/libpng/current/libpng.3
   M /vendor/libpng/current/libpngpf.3
   M /vendor/libpng/current/png.5
   M /vendor/libpng/current/png.c
   M /vendor/libpng/current/png.h
   M /vendor/libpng/current/pngconf.h
   M /vendor/libpng/current/pngget.c
   M /vendor/libpng/current/pngread.c
   M /vendor/libpng/current/pngrtran.c
   M /vendor/libpng/current/pngrutil.c
   M /vendor/libpng/current/pngset.c
   M /vendor/libpng/current/pngtest.c
   M /vendor/libpng/current/pngwio.c
   M /vendor/libpng/current/pngwrite.c
   M /vendor/libpng/current/scripts/CMakeLists.txt
   M /vendor/libpng/current/scripts/libpng-config-head.in
   M /vendor/libpng/current/scripts/libpng.pc.in
   M /vendor/libpng/current/scripts/makefile.32sunu
   M /vendor/libpng/current/scripts/makefile.64sunu
   M /vendor/libpng/current/scripts/makefile.aix
   M /vendor/libpng/current/scripts/makefile.beos
   M /vendor/libpng/current/scripts/makefile.cygwin
   M /vendor/libpng/current/scripts/makefile.darwin
   M /vendor/libpng/current/scripts/makefile.dec
   M /vendor/libpng/current/scripts/makefile.elf
   M /vendor/libpng/current/scripts/makefile.gcmmx
   M /vendor/libpng/current/scripts/makefile.hp64
   M /vendor/libpng/current/scripts/makefile.hpgcc
   M /vendor/libpng/current/scripts/makefile.hpux
   M /vendor/libpng/current/scripts/makefile.linux
   M /vendor/libpng/current/scripts/makefile.mingw
   M /vendor/libpng/current/scripts/makefile.ne12bsd
   M /vendor/libpng/current/scripts/makefile.netbsd
   M /vendor/libpng/current/scripts/makefile.nommx
   M /vendor/libpng/current/scripts/makefile.openbsd
   M /vendor/libpng/current/scripts/makefile.sco
   M /vendor/libpng/current/scripts/makefile.sggcc
   M /vendor/libpng/current/scripts/makefile.sgi
   M /vendor/libpng/current/scripts/makefile.so9
   M /vendor/libpng/current/scripts/makefile.solaris
   M /vendor/libpng/current/scripts/makefile.solaris-x86
   M /vendor/libpng/current/scripts/pngos2.def
   M /vendor/libpng/current/scripts/pngw32.def

libpng 1.2.35

------------------------------------------------------------------------
r1873 | oneiros | 2009-02-19 16:16:32 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   A /vendor/libpng/1.2.35 (from /vendor/libpng/current:1872)

tag libpng 1.2.35

------------------------------------------------------------------------

From root at www.metatex.org  Thu Feb 19 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Feb 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090219212502.B0FF21E8C408@www.metatex.org>

------------------------------------------------------------------------
r1874 | oneiros | 2009-02-19 16:29:35 +0100 (Thu, 19 Feb 2009) | 11 lines
Changed paths:
   M /trunk/src/libs/libpng
   M /trunk/src/libs/libpng/ANNOUNCE
   M /trunk/src/libs/libpng/CHANGES
   M /trunk/src/libs/libpng/INSTALL
   M /trunk/src/libs/libpng/KNOWNBUG
   M /trunk/src/libs/libpng/LICENSE
   M /trunk/src/libs/libpng/README
   M /trunk/src/libs/libpng/Y2KINFO
   M /trunk/src/libs/libpng/example.c
   D /trunk/src/libs/libpng/libpng-1.2.34.txt
   A /trunk/src/libs/libpng/libpng-1.2.35.txt (from /vendor/libpng/current/libpng-1.2.35.txt:1872)
   M /trunk/src/libs/libpng/libpng.3
   M /trunk/src/libs/libpng/libpngpf.3
   M /trunk/src/libs/libpng/png.5
   M /trunk/src/libs/libpng/png.c
   M /trunk/src/libs/libpng/png.h
   M /trunk/src/libs/libpng/pngconf.h
   M /trunk/src/libs/libpng/pngget.c
   M /trunk/src/libs/libpng/pngread.c
   M /trunk/src/libs/libpng/pngrtran.c
   M /trunk/src/libs/libpng/pngrutil.c
   M /trunk/src/libs/libpng/pngset.c
   M /trunk/src/libs/libpng/pngtest.c
   M /trunk/src/libs/libpng/pngwio.c
   M /trunk/src/libs/libpng/pngwrite.c

import libpng 1.2.35:

Merged revisions 1872 via svnmerge from 
http://scm.foundry.supelec.fr/svn/luatex/vendor/libpng/current

........
  r1872 | oneiros | 2009-02-19 16:15:23 +0100 (Do, 19 Feb 2009) | 2 lines
  
  libpng 1.2.35
........

------------------------------------------------------------------------
r1875 | taco | 2009-02-19 16:49:57 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c

make sure that old-style extensibles clean up any pre-existing new-style variants

------------------------------------------------------------------------
r1876 | taco | 2009-02-19 16:50:46 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

the web needs the prototypes for free_{text,math}_codes

------------------------------------------------------------------------
r1877 | taco | 2009-02-19 16:57:50 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix the loop that decides how many extenders are needed in a vertical variant

------------------------------------------------------------------------
r1878 | hhenkel | 2009-02-19 20:28:24 +0100 (Thu, 19 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/vfpacket.c
   M /trunk/src/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/synctex.c

Analog to rev. 1785 + 1788, cur_h --> cur.h, cur_v --> cur.v

------------------------------------------------------------------------

From root at www.metatex.org  Fri Feb 20 12:26:35 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 20 Feb 2009 12:26:35 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090220112635.0AD331E8C408@www.metatex.org>

------------------------------------------------------------------------
r1879 | oneiros | 2009-02-20 00:02:23 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/depend.mk

make depend

------------------------------------------------------------------------
r1880 | hhenkel | 2009-02-20 00:22:13 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

corrections by -1 (no idea about table in sect. 2.3).

------------------------------------------------------------------------
r1881 | taco | 2009-02-20 09:46:05 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix handling of min_overlap

------------------------------------------------------------------------
r1882 | taco | 2009-02-20 09:48:32 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

guard against large overlaps and small advance 

------------------------------------------------------------------------
r1883 | taco | 2009-02-20 11:30:24 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix a loop, and add a bit of extra safeguarding

------------------------------------------------------------------------

From root at www.metatex.org  Fri Feb 20 16:25:08 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 20 Feb 2009 16:25:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090220152508.2F0171E8C408@www.metatex.org>

------------------------------------------------------------------------
r1884 | taco | 2009-02-20 13:33:12 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

add italic correction for extenders

------------------------------------------------------------------------
r1885 | taco | 2009-02-20 13:46:18 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

convert a few asserts into normal errors

------------------------------------------------------------------------
r1886 | taco | 2009-02-20 13:52:24 +0100 (Fri, 20 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

start preparing for horizontal extensibles

------------------------------------------------------------------------

From root at www.metatex.org  Sat Feb 21 16:25:14 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 21 Feb 2009 16:25:14 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090221152514.9B3471E8C408@www.metatex.org>

------------------------------------------------------------------------
r1887 | taco | 2009-02-21 13:47:50 +0100 (Sat, 21 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix use of \Uroot <rad> {} {x} to be like \radical <rad> {x}

------------------------------------------------------------------------
r1888 | taco | 2009-02-21 13:53:14 +0100 (Sat, 21 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix an assertion for $\dot{}$

------------------------------------------------------------------------
r1889 | taco | 2009-02-21 13:57:36 +0100 (Sat, 21 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

#1887 had the wrong sign for the 'narrow degree' correction

------------------------------------------------------------------------
r1890 | taco | 2009-02-21 15:13:25 +0100 (Sat, 21 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

(provisional) support for horizontal extenders via \Uunderdelimiter and \Uoverdelimiter

------------------------------------------------------------------------
r1891 | taco | 2009-02-21 15:17:11 +0100 (Sat, 21 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix another null attribute

------------------------------------------------------------------------

From root at www.metatex.org  Sun Feb 22 16:25:06 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 22 Feb 2009 16:25:06 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090222152506.C4F211E8C408@www.metatex.org>

------------------------------------------------------------------------
r1892 | taco | 2009-02-22 13:45:23 +0100 (Sun, 22 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

fix lua version typo introduced in #1268

------------------------------------------------------------------------

From javier at digi21.eu  Mon Feb 23 10:41:50 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 23 Feb 2009 10:41:50 +0100
Subject: [Dev-luatex] Patterns
Message-ID: <5088e64f0902230141le48b47ftd8c4455ba1844dfd@mail.gmail.com>

TeX does not allow the appearance of the same pattern twice. LuaTeX, I
think, has just changed the error message:

! Conflicting pattern ignored.

Now with LuaTeX it is possible to add patterns after the format
generation. But one of the reasons why adding patterns in the document
is to override format patterns, so I think that the right behavour for

aa1bb1cc    %in the format

aa2bbcc    %in the document

is to get the maximum number at each point, therefore resulting in

aa2bb1cc


Furthermore, if the user writes somting like

aa8bb  %Do not brake here

it will or will not work according as to the pattern aabb already
exists in the format or does not, which is not certainly what a user
writing this pattern would expect.

Javier A.

From javier at digi21.eu  Mon Feb 23 10:53:44 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 23 Feb 2009 10:53:44 +0100
Subject: [Dev-luatex] Math styles
Message-ID: <5088e64f0902230153t2dfee154r1623933d431b9112@mail.gmail.com>

Here goes a long message...

Some time ago I had the following idea about math styles. I'll first
like to point that I was not just elucubratig about possible
extensions, but I felt the need for it with an actual example.

I was trying to imitate the way a book set its math. It is a common one I think:

-- The style within paragraphs is the same as that of displayed portions.
-- The numerator and denomiator of fractions come out in a smaller
size than the normal one, approximately what would be the \smallsize
of LaTeX.
-- Fractions within fractions appear at same size that the main fraction.
-- Exponents are set in a size that would be the script size of the
fractions text, and the same size is used bor both text-size basis and
fraction-size basis.
-- There is not a subsubscript size; i. e., all levels of
sub/superindexes are displayed at the same size.
-- There are two sizes for operators like \sum, but the selection of
one or the other is not based on display/text style, but on applying
to a big or small formula.

The main problem to solve here is that of the different sizes
normal/fraction/script. I found it impossible with current TeX. The
solution I devised is as follows:


TeX would be at every moment in a current style, as it does now (when
a math list is being converted into a horizontal list), but the set of
possible styles would not be a closed one. So TeX would at every
moment be in a current style in the same way as it has at every moment
outside math a current \font; and as fonts do, styles would also be
declared, but the '= file' part is not necessary. For example

\mathstyle\mystyle

Furthermore, neither the style changing would be hardcoded, and it
would be defined for every style to what style change for fractions
and to what style change for scripts. This would be two among other
"parameters" associated to each style (the others I explain below), in
the same way that each font has some parameters associated to it. For
example

\fractionstyle\mytextstyle=\myfracstyle  %Here \fractionstyle is the primitive
\indexstyle\mytextstyle=\myscriptstyle   %And here it obviously is \indexstyle

This parallels \fontdimen3\myfont= 3pt (say).

The set of triples \textfont<x>, \scriptfont<x>, \scriptscriptfont<x>
is now replaced by a set of singletons, namely, the fonts for the
style:

\mathstylefont0\mytextstyle=\tenrm
\mathstylefont1\mytextstyle=\teni
\mathstylefont2\mytextstyle=\tensy
\mathstylefont3\mytextstyle=\tenex
\newfam\itfam \def\it{\fam\itfam\tenit} % \it is family 4
\mathstylefont\itfam\mytextslyte=\tenit
etc.

There only remains to think, besides compatibiliy, what other
parameters are associated to every style. Here is the three ones I
found.

\displayedlimits\mytextstyle=1 %1=yes, 0=no. Whether limits are placed
at display position
                               %for operators marked with \displaylimits

\usesuccesorop\mutextstyle=0 %Use the successor (bigger) glyph for Op
symbols, if present.

\exponentshigher\mytextstyle=0 %Raise the exponents as in TeX display
sytle or ar in text style.
                               %There is a slight difference. Does not
apply if we are at a cramped style.

There need also be defined the initial style after $, after $$, and
for the equation tag:

\initialtextstyle=\mytextstyle
\initialdisplaystyle=\mydisplaystyle
\initialeqtagstyle=\mtextstyle  %or \mytagstyle if it is a different one

and the primitive \mathstyle would be analogous to \font when used as
argument to another command and when placed after \the; that is, it
would mean the current mathstyle. But unfortunately it would not get
expanded till TeX is converting the math list into a horizontal list,
since till that moment TeX does not know which is the current
style---I think Don's decision about the syntax of \over and its
relatives was not a fortunate one.
But I will use \currentmathstyle instead of \mathstyle for these uses,
in this message, because I find it clearer to read, even if it may
just be a question of getting used to it, as I had to get used to
\font meaning the current font.

The primitives \displaystyle and \textstyle, to which \eqtagstyle
could be added, would make the style change to the current values of
\initialtextstyle, \initialdisplaystyle and \initialeqtagstyle. For
\scriptstyle and \scriptscriptstyle see the note about compatibility
near the end of this message.

Finally, I had thought that the syntax of \mathstyle could allow an
optional equal sign to follow the style, and if it were present then
an existing style would have to follow it and the definitions of the
later would be copied to those of the former:

\mathstyle\tablemathstyle=\textstyle
%
% And now make a some modifications to \tablemathstyle

But rejected the idea because it can be done with \let, which would
still be needed anyway if we want to make the copy later, not at the
time the style is defined.



Appart from suiting my particular need, this also opens the ground to
easy and powerful configurations. For example, a \tablemathsytle could
be defined, with its two corresponding style-changes (for fractions
and indexes). As another example, LaTeX math versions would just be
different styles that the user may simply specify at the beginning of
the formula:

$$\BoldMathStyle \sum\frac{\fib(n)}{2^{n+1}}=1$$

(The actual LaTeX macros would be smarter, and BoldMathStyle would
change to a display or a text style according as the current style
would be a display-one or a text-one, of which LaTeX would also keep
track).


Now follows the complete defintions that mimic the default TeX
settings (omitting the definitions for font families >=4), that I
would place in the hypothetical luaplain.tex; next the definition for
the style I described at the beginning of this message, and finally
some notes addressing compatibility and another suggestion.

%%% TeX default settings for math %%%

\mathstyle\plaindisplaystyle
\mathstyle\plaintextstyle
\mathstyle\plainscriptstyle
\mathstyle\plainsscriptstyle

%Style changes.
\fractionstyle\plaindisplaystyle=\plaintextstyle
\indexstyle\plaindisplaystyle=\plainscriptstyle
%\fractionstyle\plaintextstyle=\plainscriptstyle  %These two will be/get defined
%\indexstyle\plaintextstyle=\plainscriptstyle     %some lines below
\fractionstyle\plainscriptstyle=\plainsscriptstyle
\indexstyle\plaindisplaystyle=\plainsscriptstyle
\fractionstyle\plainsscriptstyle=\plainsscriptstyle
\indexstyle\plaindissplaystyle=\plainsscriptstyle

%Fonts
\mathstylefont0\plaindisplaystyle=\tenrm
\mathstylefont1\plaindisplaystyle=\teni
\mathstylefont2\plaindisplaystyle=\tensy
\mathstylefont3\plaindisplaystyle=\tenex
%etc.

\let\plaintextstyle\plaindisplaystyle  %Thus we avoid the need to
write again the same set of fonts
\fractionstyle\plaintextstyle=\plainscriptstyle

\mathstylefont0\plainscriptstyle=\sevenrm
\mathstylefont1\plainscriptstyle=\seveni
\mathstylefont2\plainscriptstyle=\seveny
\mathstylefont3\plainscriptstyle=\tenex
%etc.

\mathstylefont0\plainsscriptstyle=\sevenrm
\mathstylefont1\plainsscriptstyle=\seveni
\mathstylefont2\plainsscriptstyle=\seveny
\mathstylefont3\plainsscriptstyle=\tenex
%etc.

%Parameters

\displayedlimits\plaindisplaystyle=1
\usesuccesorop\plaindisplaystyle=1
\exponentshigher\plaindisplaystyle=1

\displayedlimits\plaintextstyle=0
\usesuccesorop\plaintextstyle=0
\exponentshigher\plaintextstyle=0

\displayedlimits\plainscriptstyle=0
\usesuccesorop\plainscriptstyle=0
\exponentshigher\plainscriptstyle=0

\displayedlimits\plainsscriptstyle=0
\usesuccesorop\plainsscriptstyle=0
\exponentshigher\plainsscriptstyle=0

%Initial sytles, and we are done

\initialdisplaystyle=\plaindisplaystyle
\initialtextstyle=\plaintextstyle
\initialeqtagstyle=\plaintextstyle


%%% Another common setting for math %%%

\mathstyle\mathmain
\mathstyle\mfracstyle
\mathstyle\mscriptstyle

%Style changes.
\fractionstyle\mathmain=\mfracstyle
\indexstyle\mathmain=\mscriptstyle
\fractionstyle\mfracstyle=\mfracstyle
\indexstyle\mfracstyle=\mscriptstyle
\fractionstyle\mscriptstyle=\mscriptstyle
\indexstyle\mscriptstyle=\mscriptstyle

%Fonts
\mathstylefont0\mathmain=\tenrm
\mathstylefont1\mathmain=\teni
\mathstylefont2\mathmain=\tensy
\mathstylefont3\mathmain=\tenex
%etc.

\mathstylefont0\mfracstyle=\ninerm
\mathstylefont1\mfracstyle=\ninei
\mathstylefont2\mfracstyle=\ninesy
\mathstylefont3\mfracstyle=\tenex
%etc.

\mathstylefont0\mscriptstyle=\sixrm
\mathstylefont1\mscriptstyle=\sisxi
\mathstylefont2\mscriptstyle=\sixsy
\mathstylefont3\mscriptstyle=\tenex
%etc.

%Parameters

\displayedlimits\mathmain=1
\usesuccesorop\mathmain=0
\exponentshigher\mathmain=1

\displayedlimits\mfracstyle=1
\usesuccesorop\mfracstyle=0
\exponentshigher\mfracstyle=0

\displayedlimits\mscriptstyle=0
\usesuccesorop\mscriptstyle=0
\exponentshigher\mscriptstyle=0

%And a style for runing text, equal by default to mathmain

\mathstyle\mathintext=\mathamin
%\exponentshigher\mathintext=0    %Uncomment if your math inside
paragraphs do not usually
                                  %include fractions, it will look better.

%Initial sytles

\initialdisplaystyle=\mathmain
\initialtextstyle=\mathintext
\initialeqtagstyle=\mathmain

%Some additional definitions not present in plain but needed here

\mathchardef\Sum="1358	%Big Sum
\mathchardef\Prod="1359 %Big prod
%etc.


%%% Notes on backward compatibility %%%

The 0th measure taken for compatibility is that of not choosing for
the primitives some other names because they eather are alrady taken:
\displaystyle instead of \initialdisplaystyle, etc., or are likely to
have been definded by the users.
To the later may belong \mathstyle. But I thought better to keep
symmetry with respect to the \font primitive. The other alternative is
to split \mathstyle into \newmathstyle, for the declaration of styles,
and \currentmathstyle, anywhere else.

The 1st one is keeping the primitives \scriptstlye and
\scriptscriptstyle. Indeed, were we deriving the math typing anew, I
may define \scriptstyle as

\def\scriptstyle{\the\indexstyle\currentmathstyle}

and have \scriptscriptstyle not to exist at all.

But precisely because in the new scheme they are not necessary their
definition should be thought just in terms of backwards compatibility.
This concerns both their meaning and they being nonexpandable
primitives. The right meaning for \scriptstyle is to switch to the
\indexstyle of \intialdisplaystyle or \intialtextstyle, according as
TeX is at display or inner math mode; \scriptscriptstyle would switch
to the \initial(display/text)style's \indexstyle's \indexstyle, and
just exist for compatibility.

Giving to \scriptstyle the \the\indexstyle\currentmathstyle meaning,
even if still being a primitive, would work for old code only if this
style were required while TeX were at \displaystyle or \textstyle
(that now would be \plaindisplaystyle and \plaintextstyle), but would
fail if required from scriptstyle itsef or from the scriptscriptstyle.
Note that \scriptscriptstyle would not create any like problem if
defined like \the \currentstyle's \indexstyle's \indexstyle, for it
would always work with the default settings, wherever it is called
from.

Now regarding \textfont<x>, \scriptfont<x> and \scriptscriptfont<x>.
Again for compatibility, the meaning of the first would be to set the
font for both \initialdisplaystyle and \initialtextstyle, i. e.,
\mathstylefont<x>\initialdisplaystyle and \initialtextstyle; that of
the second to set \initial(display & text)style's \indexstyle
\mathstylefont<x>, and for the third the obvious analog.


%%% Style Stack %%%

Thinking about \scriptstyle, I found useful a macro that changed to
the \fracstyle, and also a \mainmathstyle:

\def\mainmathstyle{\ifinner\the\initialtextstyle
\else\the\initaldisplaystyle \fi}
\def\fracstyle{\the\fractionstyle\mainmathstyle}

But this is too rigid. It would not give the desired result if the user writes

$$\myotherstyle ... $$

this applies also to the meaning of \scriptsylte I suggested above.
For high level macro packages, like LaTeX or ConTeXt, this would most
certainly not be a problem since their respective teams would make the
high level user commands, like \BoldMathStyle above, to be smart
enough to redefine the necessary macros.
But I think that a solution that would be welcome by package writers
would be that TeX kept track of a small style stack, just for the
purposes of querying. For example, at the '2' of

\frac{n^2}{k^n}

the stack for the default plain settings would be

\plaindisplaystyle \plaintextstyle \plainscriptstyle %if in dysplayed math
\plaintextstyle \plainscriptstyle \plainsscriptstyle %if in in-text math

while for the other style whose definition I gave would be

\mathmain \mfracstyle \mscriptstyle

If a mathstyle command appears, thus causing TeX to switch to a
different style, it would replace the stack entry corresponding to the
where we are, which would always be the uppermost. Therefore it
appears to me that it would be easy to implement.

Now the definitions of \mainmathstyle... would be

\def\mainmathstyle{\the\mathstackstyle0 }
\def\fracstyle{\the\fractionstyle\mainmathstyle}  %But
\the\fractionstyle\mathstackstyle0
                                                  %would also work, in
the same way that
%\fontdimen\font is the same as \fontdimen\the\font. Furthermore, even
if \the\font is
%expandable while \font is not, both definitions would expand to the
same, if expanded,
%because the first \the causes complete expansion, just as
\edef\a{\the\fontdimen2\font}
%is the same as \edef\b{\the\fontdimen2\the\font}.

and the meaning of \scriptstyle (if not its defintion, for it need be
a nonexpandable primitive)

\the\scriptstyle\mainmathstyle

and the analogous one for \scriptscriptstyle, which preserves
compatibility while still producing the desired result.


If the number following \mathstackstyle were possitive it would refer
to the n'th style from the bottom, starting at the 0th; if it were
negative the count would start from the top of the stack, starting at
1.
So \the\mathstylestack-1 would be an elaborate form of \the\currentmathstyle.

If we won't let the styles in the stack to be changed then the
primitive \mathstylestack would only be allowed to appear after \the.
For coherence this would also apply to \mathstylestack-1, even if $
... \mathstylestack-1=\mystyle ... $ would mean the same as $ ...
\mystyle ... $, which does change de uppermost entry in the stack.



I hope that among all of the above you have found something worth considering

--Javier A.

From pragma at wxs.nl  Mon Feb 23 11:29:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Feb 2009 11:29:39 +0100
Subject: [Dev-luatex] Math styles
In-Reply-To: <5088e64f0902230153t2dfee154r1623933d431b9112@mail.gmail.com>
References: <5088e64f0902230153t2dfee154r1623933d431b9112@mail.gmail.com>
Message-ID: <49A27A93.60002@wxs.nl>

Javier M?gica wrote:
> Here goes a long message...
> 
> Some time ago I had the following idea about math styles. I'll first
> like to point that I was not just elucubratig about possible
> extensions, but I felt the need for it with an actual example.

this week there will be a beta release that has new math support

- opened up math lists as well as a whole lot more style related 
parameters (the manual will mention them)

- in future releases one can also switch sets of style parameters

- there is some more on the agenda but not for the shirt term (first 
stabelize this)

- we model after open type math (cambria and microsoft spec)

- it's beta so some of the interfacing might change

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Feb 23 16:22:45 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 23 Feb 2009 16:22:45 +0100
Subject: [Dev-luatex] Math styles
In-Reply-To: <5088e64f0902230153t2dfee154r1623933d431b9112@mail.gmail.com>
References: <5088e64f0902230153t2dfee154r1623933d431b9112@mail.gmail.com>
Message-ID: <49A2BF45.8060806@elvenkind.com>



Javier M?gica wrote:
> Here goes a long message...

I have to read your message very thoroughly, but at a first glance it
looks like you will be able to do such things by simply assigning a
math font set with different settings to the \textfont0, \scriptfont0,
\scriptscriptfont0 (as all math parameters depend on the math fonts).

There will definately be a way to deal with the style changes inside
{... \over ...} and friends in luatex 0.40, probably via a new set of
primitives:

  \Uover {num} {denom}

and \Uatop and ...withdelims

For a longer reply, I have to do a careful reading of your message,
so: more next week.

Best wishes,
Taco

From root at www.metatex.org  Mon Feb 23 16:25:15 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 23 Feb 2009 16:25:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090223152515.EBE881E8C409@www.metatex.org>

------------------------------------------------------------------------
r1893 | taco | 2009-02-23 12:30:05 +0100 (Mon, 23 Feb 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/src/texk/web2c/luatexdir/texmath.h

implement extensible math top accents (variant parts) and
\Uoverdelimiter and \Uunderdelimiter primitives (experimental)

------------------------------------------------------------------------
r1894 | taco | 2009-02-23 14:13:32 +0100 (Mon, 23 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.h

add a bot_accent field to the charinfo structure

------------------------------------------------------------------------
r1895 | taco | 2009-02-23 14:23:40 +0100 (Mon, 23 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/src/texk/web2c/luatexdir/nodes.h
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c

add bot_accent_chr field to accent noads

------------------------------------------------------------------------
r1896 | taco | 2009-02-23 15:33:22 +0100 (Mon, 23 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/math.c
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

implement \Umathbotaccent and \Umathaccents (placement is provisional)

------------------------------------------------------------------------
r1897 | taco | 2009-02-23 15:44:44 +0100 (Mon, 23 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/src/texk/web2c/luatexdir/luatex.ch
   M /trunk/src/texk/web2c/luatexdir/luatex.defines
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/luatexextra.in
   M /trunk/src/texk/web2c/luatexdir/utils.c

always use "LuaTeX" instead of "luaTeX", and bump the number to 0.34.0

------------------------------------------------------------------------

From root at www.metatex.org  Mon Feb 23 22:25:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 23 Feb 2009 22:25:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090223212502.668971E8C409@www.metatex.org>

------------------------------------------------------------------------
r1898 | taco | 2009-02-23 18:04:07 +0100 (Mon, 23 Feb 2009) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

fix the width of an accented item, and some more 
toying around with the \U{under,over}delimiter code

------------------------------------------------------------------------
r1899 | taco | 2009-02-23 21:09:23 +0100 (Mon, 23 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

initialize the accent variables

------------------------------------------------------------------------
r1900 | taco | 2009-02-23 21:12:25 +0100 (Mon, 23 Feb 2009) | 6 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

* trap endless charlist loops
* fix another attribute list assertion error
* correct \Umathbotaccent and \Umathaccent initializations
* fix the behaviour of \Uoverdelimiter and \Uunderdelimiter


------------------------------------------------------------------------

From root at www.metatex.org  Tue Feb 24 12:26:30 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 24 Feb 2009 12:26:30 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090224112630.243341E8C408@www.metatex.org>

------------------------------------------------------------------------
r1901 | taco | 2009-02-24 10:41:56 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/math.c

fix handling of the upper range of \radical and \oradical

------------------------------------------------------------------------
r1902 | taco | 2009-02-24 11:07:13 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Make the math parameter assignmenrs behave as promised

------------------------------------------------------------------------
r1903 | taco | 2009-02-24 11:31:43 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

Make the math parameter queries (\the) behave as advertised also

------------------------------------------------------------------------

From root at www.metatex.org  Tue Feb 24 16:28:14 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 24 Feb 2009 16:28:14 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090224152814.D31D31E8C408@www.metatex.org>

------------------------------------------------------------------------
r1904 | taco | 2009-02-24 14:04:06 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/tex/mlist.c

bump the version in preparation of the new release

------------------------------------------------------------------------
r1905 | taco | 2009-02-24 14:06:14 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

Update the manual for 0.35.0

------------------------------------------------------------------------
r1906 | taco | 2009-02-24 14:49:02 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/NEWS

New NEWS

------------------------------------------------------------------------
r1907 | taco | 2009-02-24 15:01:11 +0100 (Tue, 24 Feb 2009) | 2 lines
Changed paths:
   A /tags/beta-0.35.0 (from /trunk:1906)

new tag

------------------------------------------------------------------------

From texworld at laposte.net  Wed Feb 25 00:38:49 2009
From: texworld at laposte.net (TeXWorld)
Date: Wed, 25 Feb 2009 00:38:49 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <49798586.9080204@wxs.nl>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
Message-ID: <49A48509.5090008@laposte.net>

Hans Hagen a ?crit :
>
> TeXWorld wrote:
>> Hello,
>>
>> I'm new to LuaTeX and Lua in general and I try to find tools to 
>> process datas stored in XML files.
>> I want to do this with LaTeX (pdfLuaLaTeX in TeXLive 2008) but 
>> there's no tool. Contrary to LaTeX, ConTeXt does have abilities to 
>> work with XML files.
>> Do you think it could be possible to have LuaTeX equipped with such 
>> abilities one day ? I read in the LuaTeX reference that LuaTeX comes 
>> with modules such as LuaZIP that is really a good thing. Do you think 
>> it would be possible to have something like the LuaXML module added 
>> to luatex too ?
>
> this is not so much related to luatex (typesetting engine) but more to 
> the input which can be anything (tex, database, xml, whatever); 
> context does not use libraries but does xml in pure lua
>
Hello Hans, hello everybody

I did not answer since Taco gave me a solution...


> adding all kind of 'modules' to lua will make it way too big and 
> unmaintainable (apart from philosophical debates about which of the 
> many variants to choose)
>
Yes of course

> in the future there will be an option to load libraries (once we've 
> sorted out the best way to deal with it in a secure way in the tex 
> tree etc) 
I was recently thinking about that and that's really good news. I have 
several questions :

-when do you think this option could be available il LuaTeX ? This year ?
-who will decide which lua modules will be available for/used with 
LuaTeX ? Users ?
-could it be possible to install and remove any of them ? Is it the kind 
of thing that could be done with the TeX distribution (I'm thinking of 
tlmgr in TeXLive for example)

> but even then maintainance of libraries is not part of luatex itself 
> (the exceptions are the libs we really need for typesetting, like 
> fontforge which are also adapted to luatex and therefore part of the 
> kernel; luazip and luasocket somehow fit in the core but database 
> connectivity, xml handling etc is way off)
>


From pragma at wxs.nl  Wed Feb 25 01:38:11 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Feb 2009 01:38:11 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <49A48509.5090008@laposte.net>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
	<49A48509.5090008@laposte.net>
Message-ID: <49A492F3.3070800@wxs.nl>

TeXWorld wrote:
> Hans Hagen a ?crit :

> -when do you think this option could be available il LuaTeX ? This year ?

don't expect this too soon; there will be a code freeze for texlive 
(0.40) and later this year (around eurotex) version 0.50 (which a couple 
of pending issues resolved)

at this moment we aim at 2012 for version 1.0, which will have stable 
interfaces and functionality (until then every aspect can change)

> -who will decide which lua modules will be available for/used with 
> LuaTeX ? Users ?

indeed, luatex is just a core with a few modules built in, the ones that 
make most sense and are not debatable (fontforge, a few small helpers, 
and basic io, some of them are patched)

given that we have the ability to load modules a few years from now, 
then maintaining extra modules is not part of the project and up to the 
users or distributers; for instance there are many ways to deal with xml 
and it makes no sense to enforce methods; the same is actually true for 
more aspects of luatex ... we provide the basic system and how it's used 
is up to users and macro packages as all do it their own way

> -could it be possible to install and remove any of them ? Is it the kind 
> of thing that could be done with the TeX distribution (I'm thinking of 
> tlmgr in TeXLive for example)

i don't know; things like that involve compiling, maybe other 
dependencies on libraries, installation mess, distributione policies, etc.

as said: we will make the luatex kernal as small as possible, and any 
prescribed dependencies make it unstable

hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Feb 25 10:07:31 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 25 Feb 2009 10:07:31 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <49A48509.5090008@laposte.net>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
	<49A48509.5090008@laposte.net>
Message-ID: <49A50A53.5090606@elvenkind.com>



TeXWorld wrote:
> 
>> in the future there will be an option to load libraries (once we've
>> sorted out the best way to deal with it in a secure way in the tex
>> tree etc) 
> I was recently thinking about that and that's really good news. I have
> several questions :

We will almost certainly (but nothing is 100% yet) not be shipping
lua libraries as part of the luatex distribution.

Dynamic loading of libraries can not be guaranteed to work everywhere,
and we want the core funtionality available even on platforms that
don't support it, so the core libraries will remain built-in, as
they are now. So far, there are no plans (nor infrastructure) to ship
extra lua libraries.

> -when do you think this option could be available il LuaTeX ? This year ?

Not before texlive 2009, but probably not long after either.

> -who will decide which lua modules will be available for/used with
> LuaTeX ? Users ?
> -could it be possible to install and remove any of them ? Is it the kind
> of thing that could be done with the TeX distribution (I'm thinking of
> tlmgr in TeXLive for example)

If we are assuming for the moment that luatex itself doesn't ship
those libraries, that would automaticlly make it a problem for the
distributions and/or individual users.

But let's get back to this later (end of summer).

Best wishes,
Taco

From root at www.metatex.org  Thu Feb 26 22:25:15 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 26 Feb 2009 22:25:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20090226212515.AE3B11E8C40B@www.metatex.org>

------------------------------------------------------------------------
r1908 | oneiros | 2009-02-26 18:06:02 +0100 (Thu, 26 Feb 2009) | 2 lines
Changed paths:
   D /trunk/src/libs/luafontforge/fontforge/fontforge/FontForge-MenuShortCuts.pot.orig
   D /trunk/src/libs/luafontforge/fontforge/fontforge/FontForge-MenuShortCuts.pot.rej
   D /trunk/src/libs/luafontforge/fontforge/fontforge/nowakowskittfinstr.c.orig
   D /trunk/src/libs/luafontforge/fontforge/fontforge/scstyles.c.orig
   D /trunk/src/libs/luasocket/src/makefile.orig

remove remnants from patch

------------------------------------------------------------------------

From dak at gnu.org  Fri Feb 27 17:56:19 2009
From: dak at gnu.org (David Kastrup)
Date: Fri, 27 Feb 2009 17:56:19 +0100
Subject: [Dev-luatex] Did somebody compile luaexpat into LuaTeX yet?
Message-ID: <86ljrrddjg.fsf@lola.quinscape.zz>


luaexpat would appear to be part of the Kepler project, similar to some
existing LuaTeX modules.  My first naive attempts to drop luaexpat into
the LuaTeX tree were not overly successful.  It is not quite clear to me
what parts of the build structure (from Kepler and/or Luaforge?) are
actually being used in the existing library modules of LuaTeX.

Could someone give a brief summary what files I would be expected to
change in order to drop this into the tree?

Thanks,

-- 
David Kastrup

