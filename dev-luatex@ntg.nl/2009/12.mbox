From root at www.metatex.org  Tue Dec  1 12:30:49 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  1 Dec 2009 12:30:49 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091201113049.68620788014@www.metatex.org>

------------------------------------------------------------------------
r3201 | taco | 2009-12-01 09:57:15 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/PDFDoc.cc

somewhat cleaner version of the locking patch 

------------------------------------------------------------------------
r3202 | taco | 2009-12-01 10:56:31 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

A test patch for bug #282

------------------------------------------------------------------------
r3203 | taco | 2009-12-01 11:18:20 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/commands.c
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

get rid of level_local_dirs (never actually used)

------------------------------------------------------------------------
r3204 | taco | 2009-12-01 11:40:28 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c

clean up the assign_dir_cmd handling

------------------------------------------------------------------------

From root at www.metatex.org  Tue Dec  1 16:28:52 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  1 Dec 2009 16:28:52 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091201152852.6FB08788014@www.metatex.org>

------------------------------------------------------------------------
r3205 | taco | 2009-12-01 13:50:25 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am

apply freebsd patch from Diego Depaoli

------------------------------------------------------------------------
r3206 | taco | 2009-12-01 15:42:25 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

allow setting and querying of pdfcatalog, pdfnames, pdfinfo, pdftrailer

------------------------------------------------------------------------

From root at www.metatex.org  Tue Dec  1 22:28:42 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  1 Dec 2009 22:28:42 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091201212842.E87AA788014@www.metatex.org>

------------------------------------------------------------------------
r3207 | taco | 2009-12-01 16:34:00 +0100 (Tue, 01 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

oops. pdf.pdfnames did assignments to pdf_info_toks

------------------------------------------------------------------------

From root at www.metatex.org  Wed Dec  2 12:30:30 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  2 Dec 2009 12:30:30 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091202113030.26724788014@www.metatex.org>

------------------------------------------------------------------------
r3208 | taco | 2009-12-02 08:37:35 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac

$host_os -> $host

------------------------------------------------------------------------
r3209 | taco | 2009-12-02 08:47:14 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

fix format sharing between 32bit and 64bit architectures

------------------------------------------------------------------------
r3210 | taco | 2009-12-02 09:38:53 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

fix bleeding of unset_attribute in the case where refcount=1 and attrlist==attr_cache

------------------------------------------------------------------------
r3211 | taco | 2009-12-02 11:59:07 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c

Add the correct attributes for inline nodes generated in linebreaking

------------------------------------------------------------------------
r3212 | taco | 2009-12-02 12:07:20 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c

forgot the right-side dir nodes

------------------------------------------------------------------------

From t34www at googlemail.com  Wed Dec  2 12:34:31 2009
From: t34www at googlemail.com (T T)
Date: Wed, 2 Dec 2009 11:34:31 +0000
Subject: [Dev-luatex] procedural vs. object interface to kpathsea
Message-ID: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>

Hi,

Is there any reason to prefer object interface to kpathsea over the
procedural one? I'm asking in particular in the context of
dofile(arbitrary_script), where arbitrary_script may also use kpathsea
(either through procedural or object interface).

Cheers,

Tomek

From taco at elvenkind.com  Wed Dec  2 12:37:33 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Dec 2009 12:37:33 +0100
Subject: [Dev-luatex] procedural vs. object interface to kpathsea
In-Reply-To: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>
References: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>
Message-ID: <4B16517D.8090209@elvenkind.com>

T T wrote:
> Hi,
> 
> Is there any reason to prefer object interface to kpathsea over the
> procedural one? I'm asking in particular in the context of
> dofile(arbitrary_script), where arbitrary_script may also use kpathsea
> (either through procedural or object interface).

The object interface gives you a kpse object that is totally
separate from luatex, the procedural interface reuses the kpse
that luatex itself uses for its own lookups.

Whether the distinction matters to you depends on what you want
to do.

Best wishes,
Taco

From t34www at googlemail.com  Wed Dec  2 13:03:19 2009
From: t34www at googlemail.com (T T)
Date: Wed, 2 Dec 2009 12:03:19 +0000
Subject: [Dev-luatex] procedural vs. object interface to kpathsea
In-Reply-To: <4B16517D.8090209@elvenkind.com>
References: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>
	<4B16517D.8090209@elvenkind.com>
Message-ID: <e7fba2610912020403h354241c3t56204dcc170c8bb3@mail.gmail.com>

2009/12/2 Taco Hoekwater <taco at elvenkind.com>:
>
> The object interface gives you a kpse object that is totally
> separate from luatex, the procedural interface reuses the kpse
> that luatex itself uses for its own lookups.

Thanks for explaining this.

>
> Whether the distinction matters to you depends on what you want
> to do.

I'm working on a script wrapper for TL that runs under texlua. As an
optimization I want to call (tex)lua scripts directly with dofile to
avoid spawning new processes, but I want to make sure that
kpse.set_program_name from my wrapper doesn't impact the invoked
script in any way.

As I understand in this scenario it will be better to use kpse object
and keep it local. Does this incur any performance penalty, i.e. does
kpathsea reinitializes itself from scratch when my object goes out of
scope and set_program_name is called again?

Cheers,

Tomek

From taco at elvenkind.com  Wed Dec  2 13:31:12 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Dec 2009 13:31:12 +0100
Subject: [Dev-luatex] procedural vs. object interface to kpathsea
In-Reply-To: <e7fba2610912020403h354241c3t56204dcc170c8bb3@mail.gmail.com>
References: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>	
	<4B16517D.8090209@elvenkind.com>
	<e7fba2610912020403h354241c3t56204dcc170c8bb3@mail.gmail.com>
Message-ID: <4B165E10.9090505@elvenkind.com>


Hi,

T T wrote:
> 
>> Whether the distinction matters to you depends on what you want
>> to do.
> 
> I'm working on a script wrapper for TL that runs under texlua. As an
> optimization I want to call (tex)lua scripts directly with dofile to
> avoid spawning new processes, but I want to make sure that
> kpse.set_program_name from my wrapper doesn't impact the invoked
> script in any way.
> 
> As I understand in this scenario it will be better to use kpse object
> and keep it local. 

Probably, but:

> Does this incur any performance penalty, i.e. does
> kpathsea reinitializes itself from scratch when my object goes out of
> scope and set_program_name is called again?

When a kpse:new() variable goes out of scope or when you want to change
its program name you will have to start a brand new one.

If you use the procedural interface, kpse.set_program_name() will
keep its cnf and databases files in memory, only the rest is reset.
This kpathsea never goes out of scope, because it is a global luatex
variable.

So, for efficiency reasons, you could opt to only reset the program_name
via the procedural interface, unless the script updates the database
and/or cnf file.

Best wishes,
Taco

From t34www at googlemail.com  Wed Dec  2 14:02:30 2009
From: t34www at googlemail.com (T T)
Date: Wed, 2 Dec 2009 13:02:30 +0000
Subject: [Dev-luatex] procedural vs. object interface to kpathsea
In-Reply-To: <4B165E10.9090505@elvenkind.com>
References: <e7fba2610912020334g5f5d7ce3u99371df8189c4a25@mail.gmail.com>
	<4B16517D.8090209@elvenkind.com>
	<e7fba2610912020403h354241c3t56204dcc170c8bb3@mail.gmail.com>
	<4B165E10.9090505@elvenkind.com>
Message-ID: <e7fba2610912020502n2e295b01r7621e22b014a195c@mail.gmail.com>

2009/12/2 Taco Hoekwater <taco at elvenkind.com>:
>
>> Does this incur any performance penalty, i.e. does
>> kpathsea reinitializes itself from scratch when my object goes out of
>> scope and set_program_name is called again?
>
> When a kpse:new() variable goes out of scope or when you want to change
> its program name you will have to start a brand new one.
>
> If you use the procedural interface, kpse.set_program_name() will
> keep its cnf and databases files in memory, only the rest is reset.
> This kpathsea never goes out of scope, because it is a global luatex
> variable.
>
> So, for efficiency reasons, you could opt to only reset the program_name
> via the procedural interface, unless the script updates the database
> and/or cnf file.

Ah, in that case I will stick with the procedural interface, indeed.
Database loading makes for the most of the start-up time in my tests
and the invoked standalone script has to make its own call to
kpse.set_program_name anyway.

Thanks for all this info.

Cheers,

Tomek

From root at www.metatex.org  Wed Dec  2 16:28:48 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  2 Dec 2009 16:28:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091202152848.501ED788014@www.metatex.org>

------------------------------------------------------------------------
r3213 | taco | 2009-12-02 14:14:23 +0100 (Wed, 02 Dec 2009) | 6 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c

For bug #244: Add the function pdf.registerannot(). This
adds an object number to the /Annots array for the current
page without doing anything else. The fact that there is
no matching internal annot object is signaled by a negative
number in the annot_list info field.

------------------------------------------------------------------------
r3214 | taco | 2009-12-02 14:53:09 +0100 (Wed, 02 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.h

add the Math constants FractionDelimiterSize and FractionDelimiterDisplayStyleSize
to fix bug #206

------------------------------------------------------------------------

From root at www.metatex.org  Thu Dec  3 12:30:46 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  3 Dec 2009 12:30:46 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091203113046.A656C788014@www.metatex.org>

------------------------------------------------------------------------
r3215 | taco | 2009-12-02 23:09:22 +0100 (Wed, 02 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

fix 64bit formats (partner of the previous fix)

------------------------------------------------------------------------
r3216 | taco | 2009-12-03 08:31:02 +0100 (Thu, 03 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac

new attempt at freebsd 

------------------------------------------------------------------------

From root at www.metatex.org  Thu Dec  3 22:25:10 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  3 Dec 2009 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091203213128.8E1CC788014@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at www.metatex.org  Fri Dec  4 12:31:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  4 Dec 2009 12:31:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091204113107.7418C788014@www.metatex.org>

------------------------------------------------------------------------
r3217 | taco | 2009-12-03 17:52:01 +0100 (Thu, 03 Dec 2009) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/font/vfpacket.c
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexiolib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatex-api.h
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.h
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.h
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.c
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c
   M /trunk/source/texk/web2c/luatexdir/tex/printing.h
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.h
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.h
   M /trunk/source/texk/web2c/luatexdir/utils/utils.c
   M /trunk/source/texk/web2c/luatexdir/utils/utils.h

Convert string pool to an array of lstring structures, lots 
of low-level changes.

------------------------------------------------------------------------
r3218 | taco | 2009-12-04 09:21:56 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/dofont.c
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/tounicode.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltokenlib.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c
   M /trunk/source/texk/web2c/luatexdir/utils/synctex.c

fix the mem leaks from makecstring()

------------------------------------------------------------------------
r3219 | taco | 2009-12-04 09:54:09 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.h

reinstate pool_size

------------------------------------------------------------------------
r3220 | taco | 2009-12-04 11:45:36 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c

revert some of the pdf_printf back to pdf_puts (speedup)

------------------------------------------------------------------------
r3221 | taco | 2009-12-04 11:49:35 +0100 (Fri, 04 Dec 2009) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.h
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.h
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h

Some small things:
* clean up use of flush_str()/flush_string() c.s.
* add a function tprint_file_name
* temf_log_name is now a C string

------------------------------------------------------------------------
r3222 | taco | 2009-12-04 11:58:22 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c

oops, accessing texmf_log_name directly crashed

------------------------------------------------------------------------
r3223 | taco | 2009-12-04 12:06:52 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c

make sure tprint() prints unsigned chars

------------------------------------------------------------------------
r3224 | taco | 2009-12-04 12:18:30 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c

add a typecast to avoid a compilerwarning

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec  4 16:28:56 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  4 Dec 2009 16:28:56 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091204152856.B705F788014@www.metatex.org>

------------------------------------------------------------------------
r3225 | taco | 2009-12-04 12:20:53 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.h
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

implement pdf.pdfmapline and pdf.pdfmapfile (write-only strings)

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec  4 22:41:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  4 Dec 2009 22:41:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091204214105.AB62F788014@www.metatex.org>

------------------------------------------------------------------------
r3226 | taco | 2009-12-04 16:50:51 +0100 (Fri, 04 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c

There was a wrong key character for the log name, causing
crashes under win32

------------------------------------------------------------------------
r3227 | taco | 2009-12-04 16:52:36 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c

now that strings can be smarter, so should dump/undump be smarter

------------------------------------------------------------------------
r3228 | taco | 2009-12-04 19:38:08 +0100 (Fri, 04 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c

fix type-punning error in luaescapestring

------------------------------------------------------------------------
r3229 | hhenkel | 2009-12-04 22:09:46 +0100 (Fri, 04 Dec 2009) | 10 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.h

* \pdfobj data and attribute are now stored by lstring/luaL_ref() instead
of token list, pdfobj attr and data strings should be '\0' transparent;
for the TeX interface as well as for old and new Lua interface.
* re-introduce safety check if a pdfobj is already in use.
* shuffle enum obj_type_* a bit and add obj_type field to obj_entry
structure.
* use pdf_create_obj() to give each new object a descriptive type instead
of the default "obj_type_others".
* limit avl tree object search to object types where a search makes sense.

------------------------------------------------------------------------

From root at www.metatex.org  Sat Dec  5 12:30:56 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat,  5 Dec 2009 12:30:56 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091205113056.61137788014@www.metatex.org>

------------------------------------------------------------------------
r3230 | taco | 2009-12-05 07:16:00 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

c99 patches

------------------------------------------------------------------------
r3231 | taco | 2009-12-05 08:05:46 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c

prevent a crash if cs_to_string is accidentally fed a null.

------------------------------------------------------------------------
r3232 | taco | 2009-12-05 08:12:42 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.c

fix runaway messages for scan_action

------------------------------------------------------------------------
r3233 | taco | 2009-12-05 08:19:29 +0100 (Sat, 05 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c

A better fix: patch scan_keyword itself so that it always
restores cur_cs

------------------------------------------------------------------------
r3234 | hhenkel | 2009-12-05 10:56:09 +0100 (Sat, 05 Dec 2009) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pagetree.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c

* extend enum pdf_obj_type by "obj_type_pages", use this to fix now 
wrong obj_type for Pages objects.
* Page objects are now managed through AVL tree, no linked list anymore, 
simplifies pdf_create_obj().

------------------------------------------------------------------------

From root at www.metatex.org  Sat Dec  5 16:29:00 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat,  5 Dec 2009 16:29:00 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091205152900.4F9E9788014@www.metatex.org>

------------------------------------------------------------------------
r3235 | hhenkel | 2009-12-05 12:36:51 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h

add obj_type_pages; reduce struct oentry by a union.

------------------------------------------------------------------------
r3236 | hhenkel | 2009-12-05 12:43:29 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c

one more hard-coded obj_type_others

------------------------------------------------------------------------
r3237 | hhenkel | 2009-12-05 12:50:15 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writejbig2.c
   M /trunk/source/texk/web2c/luatexdir/image/writepng.c

more obj_type_others to fix

------------------------------------------------------------------------
r3238 | hhenkel | 2009-12-05 14:33:45 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c

make a few functions static

------------------------------------------------------------------------
r3239 | hhenkel | 2009-12-05 15:04:44 +0100 (Sat, 05 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c

typo in comment

------------------------------------------------------------------------

From preining at logic.at  Sun Dec  6 12:37:08 2009
From: preining at logic.at (Norbert Preining)
Date: Sun, 6 Dec 2009 12:37:08 +0100
Subject: [Dev-luatex] (fwd) [Aleph] Development of an Open Source
	typesetting system for	scholarly texts: Job postings
Message-ID: <20091206113708.GA22738@gamma.logic.tuwien.ac.at>

What I have found on the aleph list, maybe it is of interest
and we want to contact them and give them a better joice.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
DUNBAR (n.)
A highly specialised fiscal term used solely by turnstile
operatives at Regnet's Part zoo. It refers to the variable amount of
increase in the variable gate takings on a Sunday afternoon, caused by
persons going to the zoo because they are in love and believe that the
feeling of romance will be somehow enhanced by the smell of panther
sweat and rank incontinence in the reptile house.
			--- Douglas Adams, The Meaning of Liff
-------------- next part --------------
An embedded message was scrubbed...
From: Marc <klists at saphor.de>
Subject: [Aleph] Development of an Open Source typesetting system for
	scholarly texts: Job postings
Date: Fri, 4 Dec 2009 06:57:05 +0100
Size: 6812
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091206/e81cfdf4/attachment.mht>

From root at www.metatex.org  Sun Dec  6 22:28:48 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun,  6 Dec 2009 22:28:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091206212848.AC3FD1E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3240 | oneiros | 2009-12-06 21:36:18 +0100 (Sun, 06 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

get_file_checksum: size can be larger then int, use the correct types

------------------------------------------------------------------------

From root at www.metatex.org  Mon Dec  7 12:30:27 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  7 Dec 2009 12:30:27 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091207113027.A41DA1E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3241 | taco | 2009-12-07 11:48:02 +0100 (Mon, 07 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

fix attribute list leak inm unset_attribute

------------------------------------------------------------------------
r3242 | taco | 2009-12-07 11:48:56 +0100 (Mon, 07 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c

clean up the near-static text_dir_ptr node so it wont be mentioned in node statistics

------------------------------------------------------------------------

From root at www.metatex.org  Thu Dec 10 16:28:46 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 10 Dec 2009 16:28:46 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091210152846.97C0D788015@www.metatex.org>

------------------------------------------------------------------------
r3243 | taco | 2009-12-10 13:51:06 +0100 (Thu, 10 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

small changes in the debugging output

------------------------------------------------------------------------
r3244 | taco | 2009-12-10 13:51:42 +0100 (Thu, 10 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c

null paragraphs that consist of only a local_par node should 
free that node

------------------------------------------------------------------------

From root at www.metatex.org  Thu Dec 10 22:28:48 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 10 Dec 2009 22:28:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091210212848.C6601788015@www.metatex.org>

------------------------------------------------------------------------
r3245 | taco | 2009-12-10 16:34:37 +0100 (Thu, 10 Dec 2009) | 2 lines
Changed paths:
   M /trunk/build.sh

the crosscompiled mingw may as well optimize properly (compiler is always known to be gcc 3.4.5)

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec 11 12:30:47 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 11 Dec 2009 12:30:47 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091211113047.88CED788015@www.metatex.org>

------------------------------------------------------------------------
r3246 | hhenkel | 2009-12-10 23:22:21 +0100 (Thu, 10 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c

SlantFont by text-matrix (should work also for TTF, OTF)

------------------------------------------------------------------------
r3247 | oneiros | 2009-12-11 00:57:37 +0100 (Fri, 11 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c

fix some warnings

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec 11 16:28:39 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 11 Dec 2009 16:28:39 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091211152839.E6E8E788015@www.metatex.org>

------------------------------------------------------------------------
r3248 | taco | 2009-12-11 14:39:41 +0100 (Fri, 11 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c

fix typecasts

------------------------------------------------------------------------

From khaledhosny at eglug.org  Sat Dec 12 11:29:10 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 12 Dec 2009 12:29:10 +0200
Subject: [Dev-luatex] Luatex 0.46.0 announcement
In-Reply-To: <4B0E9E54.7070005@elvenkind.com>
References: <4B0E9E54.7070005@elvenkind.com>
Message-ID: <20091212102910.GA3200@khaled-laptop>

On Thu, Nov 26, 2009 at 04:27:16PM +0100, Taco Hoekwater wrote:
> * There is now experimental support for loading external .dll/.so
>   files for lua extension modules.

The manual (p 30) still says "Dynamic loading of .so and .dll files is
disabled on all platforms."

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091212/fcef0059/attachment.pgp>

From root at www.metatex.org  Sat Dec 12 16:28:55 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 12 Dec 2009 16:28:55 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091212152855.693B7788015@www.metatex.org>

------------------------------------------------------------------------
r3249 | hhenkel | 2009-12-12 14:02:17 +0100 (Sat, 12 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c

fix segfault when trying to read nonexistent T1 font file from fontmap

------------------------------------------------------------------------
r3250 | oneiros | 2009-12-12 15:52:43 +0100 (Sat, 12 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c

fix a warning about mixed declarations

------------------------------------------------------------------------

From khaledhosny at eglug.org  Sun Dec 13 11:47:27 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Dec 2009 12:47:27 +0200
Subject: [Dev-luatex] Font id from csname?
Message-ID: <20091213104727.GA21280@khaled-laptop>


Is there a way to retrieve internal font id from its csname, either using
lua or some tex hackary?

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091213/d3e9f1ce/attachment.pgp>

From pragma at wxs.nl  Sun Dec 13 11:52:29 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Dec 2009 11:52:29 +0100
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <20091213104727.GA21280@khaled-laptop>
References: <20091213104727.GA21280@khaled-laptop>
Message-ID: <4B24C76D.5020105@wxs.nl>

Khaled Hosny wrote:
> Is there a way to retrieve internal font id from its csname, either using
> lua or some tex hackary?

{\somefont \directlua{tex.write(font.current())}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Dec 13 12:12:40 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Dec 2009 13:12:40 +0200
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <4B24C76D.5020105@wxs.nl>
References: <20091213104727.GA21280@khaled-laptop>
 <4B24C76D.5020105@wxs.nl>
Message-ID: <20091213111239.GA21698@khaled-laptop>

On Sun, Dec 13, 2009 at 11:52:29AM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
> >Is there a way to retrieve internal font id from its csname, either using
> >lua or some tex hackary?
> 
> {\somefont \directlua{tex.write(font.current())}

Yup, I know about font.current(), but this means I've to activate the
font first which is not some thing I can do (I need this for fontspec;
I want to access the font table of a certain defined font that I only
know it csname).

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091213/71ef6fc2/attachment.pgp>

From pragma at wxs.nl  Sun Dec 13 12:37:00 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Dec 2009 12:37:00 +0100
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <20091213111239.GA21698@khaled-laptop>
References: <20091213104727.GA21280@khaled-laptop> <4B24C76D.5020105@wxs.nl>
	<20091213111239.GA21698@khaled-laptop>
Message-ID: <4B24D1DC.2000708@wxs.nl>

Khaled Hosny wrote:
> On Sun, Dec 13, 2009 at 11:52:29AM +0100, Hans Hagen wrote:
>> Khaled Hosny wrote:
>>> Is there a way to retrieve internal font id from its csname, either using
>>> lua or some tex hackary?
>> {\somefont \directlua{tex.write(font.current())}
> 
> Yup, I know about font.current(), but this means I've to activate the
> font first which is not some thing I can do (I need this for fontspec;
> I want to access the font table of a certain defined font that I only
> know it csname).


i remember that when a while ago taco and i discussed this that there 
were some good reasons for not yet having access to all this specific 
info i.e. i can imagine that tex.somefontcs returns the number but quite 
some of those accessors have to wait till the whole global/local issue 
of the code is resolved.

also, we're not close to 0.50 so it's unlikely that new accessors will 
show up before that stable version is out

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Dec 13 13:29:26 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Dec 2009 14:29:26 +0200
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <4B24D1DC.2000708@wxs.nl>
References: <20091213104727.GA21280@khaled-laptop> <4B24C76D.5020105@wxs.nl>
	<20091213111239.GA21698@khaled-laptop> <4B24D1DC.2000708@wxs.nl>
Message-ID: <20091213122926.GA21952@khaled-laptop>

On Sun, Dec 13, 2009 at 12:37:00PM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
> >On Sun, Dec 13, 2009 at 11:52:29AM +0100, Hans Hagen wrote:
> >>Khaled Hosny wrote:
> >>>Is there a way to retrieve internal font id from its csname, either using
> >>>lua or some tex hackary?
> >>{\somefont \directlua{tex.write(font.current())}
> >
> >Yup, I know about font.current(), but this means I've to activate the
> >font first which is not some thing I can do (I need this for fontspec;
> >I want to access the font table of a certain defined font that I only
> >know it csname).
> 
> 
> i remember that when a while ago taco and i discussed this that
> there were some good reasons for not yet having access to all this
> specific info i.e. i can imagine that tex.somefontcs returns the
> number but quite some of those accessors have to wait till the whole
> global/local issue of the code is resolved.
> 
> also, we're not close to 0.50 so it's unlikely that new accessors
> will show up before that stable version is out

Any way, I tried to implement a font.id() last night, but didn't get it
to work. I get it to work finally (patch attached, in case anyone
interested), just to discover tex.fontidentifier() (what an odd place, I
was only looking under font library!) that can be used to implement the
function I want:

function font_id(str)
    for i=font.max(),0,-1 do
        if tex.fontidentifier(i) == str then
            return i
        end
    end
    return -1
end


Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091213/45e37a22/attachment.pgp>

From taco at elvenkind.com  Sun Dec 13 13:33:06 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Dec 2009 13:33:06 +0100
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <4B24D1DC.2000708@wxs.nl>
References: <20091213104727.GA21280@khaled-laptop>
	<4B24C76D.5020105@wxs.nl>	<20091213111239.GA21698@khaled-laptop>
	<4B24D1DC.2000708@wxs.nl>
Message-ID: <4B24DF02.6070109@elvenkind.com>


Hi,
Hans Hagen wrote:
> 
> i remember that when a while ago taco and i discussed this that there 
> were some good reasons for not yet having access to all this specific 
> info i.e. i can imagine that tex.somefontcs returns the number but quite 
> some of those accessors have to wait till the whole global/local issue 
> of the code is resolved.
> 
> also, we're not close to 0.50 so it's unlikely that new accessors will 

not -> now

> show up before that stable version is out

But actually, it is possible to get the id for a font:

   \directlua {local id = token.create("tenrm")[2]}

This does not (currently) work when you ask for the recent \font and
that font has never been selected yet as 'currently active' font
(token.create() will return zero in [2] in that case, for the 
\nullfont), but it works for all other fonts.

Best wishes,
Taco


From taco at elvenkind.com  Sun Dec 13 13:36:07 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Dec 2009 13:36:07 +0100
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <4B24DF02.6070109@elvenkind.com>
References: <20091213104727.GA21280@khaled-laptop>	<4B24C76D.5020105@wxs.nl>	<20091213111239.GA21698@khaled-laptop>	<4B24D1DC.2000708@wxs.nl>
	<4B24DF02.6070109@elvenkind.com>
Message-ID: <4B24DFB7.3040704@elvenkind.com>

Taco Hoekwater wrote:
> But actually, it is possible to get the id for a font:
> 
>   \directlua {local id = token.create("tenrm")[2]}
> 
> This does not (currently) work when you ask for the recent \font and
> that font has never been selected yet as 'currently active' font

Never mind that, it works always. I confused myself with a bad test.

Best wishes,
Taco

From khaledhosny at eglug.org  Sun Dec 13 14:21:03 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Dec 2009 15:21:03 +0200
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <20091213122926.GA21952@khaled-laptop>
References: <20091213104727.GA21280@khaled-laptop> <4B24C76D.5020105@wxs.nl>
	<20091213111239.GA21698@khaled-laptop> <4B24D1DC.2000708@wxs.nl>
	<20091213122926.GA21952@khaled-laptop>
Message-ID: <20091213132103.GA22107@khaled-laptop>

Oops, forgot the attachment.

On Sun, Dec 13, 2009 at 02:29:26PM +0200, Khaled Hosny wrote:
> On Sun, Dec 13, 2009 at 12:37:00PM +0100, Hans Hagen wrote:
> > Khaled Hosny wrote:
> > >On Sun, Dec 13, 2009 at 11:52:29AM +0100, Hans Hagen wrote:
> > >>Khaled Hosny wrote:
> > >>>Is there a way to retrieve internal font id from its csname, either using
> > >>>lua or some tex hackary?
> > >>{\somefont \directlua{tex.write(font.current())}
> > >
> > >Yup, I know about font.current(), but this means I've to activate the
> > >font first which is not some thing I can do (I need this for fontspec;
> > >I want to access the font table of a certain defined font that I only
> > >know it csname).
> > 
> > 
> > i remember that when a while ago taco and i discussed this that
> > there were some good reasons for not yet having access to all this
> > specific info i.e. i can imagine that tex.somefontcs returns the
> > number but quite some of those accessors have to wait till the whole
> > global/local issue of the code is resolved.
> > 
> > also, we're not close to 0.50 so it's unlikely that new accessors
> > will show up before that stable version is out
> 
> Any way, I tried to implement a font.id() last night, but didn't get it
> to work. I get it to work finally (patch attached, in case anyone
> interested), just to discover tex.fontidentifier() (what an odd place, I
> was only looking under font library!) that can be used to implement the
> function I want:
> 
> function font_id(str)
>     for i=font.max(),0,-1 do
>         if tex.fontidentifier(i) == str then
>             return i
>         end
>     end
>     return -1
> end
> 
> 
> Regards,
>  Khaled
> 
> -- 
>  Khaled Hosny
>  Arabic localiser and member of Arabeyes.org team
>  Free font developer

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Implement-font.id.patch
Type: text/x-diff
Size: 2520 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091213/d5e885fe/attachment.patch>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091213/d5e885fe/attachment.pgp>

From root at www.metatex.org  Sun Dec 13 22:28:45 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 13 Dec 2009 22:28:45 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091213212845.9D9F7788014@www.metatex.org>

------------------------------------------------------------------------
r3251 | hhenkel | 2009-12-13 17:56:51 +0100 (Sun, 13 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

flatten function

------------------------------------------------------------------------
r3252 | hhenkel | 2009-12-13 19:37:37 +0100 (Sun, 13 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

revert 3251 (weird segfault)

------------------------------------------------------------------------

From taco at elvenkind.com  Mon Dec 14 09:48:56 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Dec 2009 09:48:56 +0100
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <20091213132103.GA22107@khaled-laptop>
References: <20091213104727.GA21280@khaled-laptop>
	<4B24C76D.5020105@wxs.nl>	<20091213111239.GA21698@khaled-laptop>
	<4B24D1DC.2000708@wxs.nl>	<20091213122926.GA21952@khaled-laptop>
	<20091213132103.GA22107@khaled-laptop>
Message-ID: <4B25FBF8.5060209@elvenkind.com>


Hi,

Khaled Hosny wrote:
> Oops, forgot the attachment.

This patch is nicer than the more indirect approaches,
so I have committed it which a small change.

Best wishes,
Taco


From root at www.metatex.org  Mon Dec 14 12:30:53 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 14 Dec 2009 12:30:53 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091214113053.ADFF1788014@www.metatex.org>

------------------------------------------------------------------------
r3253 | taco | 2009-12-14 09:44:11 +0100 (Mon, 14 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lfontlib.c

implement font.id (<string>), based on a patch from Khaled Hosny

------------------------------------------------------------------------
r3254 | taco | 2009-12-14 10:04:54 +0100 (Mon, 14 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

Update the manual for the most recent new features

------------------------------------------------------------------------

From root at www.metatex.org  Mon Dec 14 16:28:54 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 14 Dec 2009 16:28:54 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091214152854.5AB8F788014@www.metatex.org>

------------------------------------------------------------------------
r3255 | taco | 2009-12-14 15:24:38 +0100 (Mon, 14 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.h

rm unused #defines

------------------------------------------------------------------------

From khaledhosny at eglug.org  Tue Dec 15 11:14:21 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 15 Dec 2009 12:14:21 +0200
Subject: [Dev-luatex] Font id from csname?
In-Reply-To: <4B25FBF8.5060209@elvenkind.com>
References: <20091213104727.GA21280@khaled-laptop> <4B24C76D.5020105@wxs.nl>
	<20091213111239.GA21698@khaled-laptop> <4B24D1DC.2000708@wxs.nl>
	<20091213122926.GA21952@khaled-laptop>
	<20091213132103.GA22107@khaled-laptop>
	<4B25FBF8.5060209@elvenkind.com>
Message-ID: <20091215101421.GA2628@khaled-laptop>

On Mon, Dec 14, 2009 at 09:48:56AM +0100, Taco Hoekwater wrote:
> 
> Hi,
> 
> Khaled Hosny wrote:
> > Oops, forgot the attachment.
> 
> This patch is nicer than the more indirect approaches,
> so I have committed it which a small change.
Thanks.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091215/b80b4ee0/attachment.pgp>

From root at www.metatex.org  Wed Dec 16 12:30:51 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 16 Dec 2009 12:30:51 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091216113051.3235D788014@www.metatex.org>

------------------------------------------------------------------------
r3256 | hhenkel | 2009-12-15 23:39:14 +0100 (Tue, 15 Dec 2009) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.h
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

A search tree keeping object number mappings for all embedded PDF files
throughout the entire LuaTeX run should now guarantee, that any needed
object from an embedded PDF file ends up exactly once in the PDF output.
This should reduce the size of the resulting PDF file.

------------------------------------------------------------------------
r3257 | hhenkel | 2009-12-16 00:19:55 +0100 (Wed, 16 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

slight optimization

------------------------------------------------------------------------
r3258 | taco | 2009-12-16 11:40:36 +0100 (Wed, 16 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c

fix a massive string leak in \the, and fix the overflow report for strings

------------------------------------------------------------------------

From taco at elvenkind.com  Fri Dec 18 11:02:54 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 18 Dec 2009 11:02:54 +0100
Subject: [Dev-luatex] Luatex 0.47.0 announcement
Message-ID: <4B2B534E.3070800@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.47.0.

This will be the last beta before the next major release (0.50),
so please test this version as thoroughly as you can.

New features:

* New read-write lua variables pdf.pdfcatalog, pdf.pdfnames,
  pdf.pdfinfo, pdf.pdftrailer

* The horizontal mode nodes that are added to lines during line
  breaking now inherit the attributes from the first and last node
  inside the created line.

* The new function pdf.registerannot(<number>) registers an
  annotation object number to be included in the current
  page's /Annots list.

* The variables <metrics>.Mathconstants.FractionDelimiterSize
  and <metrics>.Mathconstants.FractionDelimiterDisplayStyleSize
  are added to the font table. This allows proper setting of the
  size parameters for TeX's ...withdelims math primitives.

* The internal representation of the string pool is reorganized
  (the pool of string characters is now allocated dynamically),
  and as a side-effect the lua variable status.init_pool_ptr
  is deprecated and will be removed in a later version. Also,
  status.pool_ptr now simply returns the current number of bytes
  in use for string characters.

* There are new lua variables pdf.pdfmapline and pdf.pdfmapfile
  (write-only strings that mimic \pdfmapline and \pdfmapfile).

* \pdfobj data and attribute are now stored as C strings instead
  of as token lists (this should speed up cases with a lot of data).

* Artificially slanted fonts now work via the pdf text matrix
  (instead of adjusting the actual font) so that it now also
  works for non-Type1 fonts. The lua <metrics>.slant font key is
  now obeyed in all cases.

* The lua function font.id(<string>) returns the internal font id
  number belonging to a control sequence name.

* Pdf image inclusion is optimized such that objects from an
  external pdf will now be included only once even if they are
  referenced from multiple inclusions.

Bug fixes:

* Protrusion for non-TLT documents did not work properly for
  the hyphenation character.

* \lastbox could not remove the paragraph indent box for non-TLT
  documents.

* Pdf images (\pdfximage) are no longer kept open during the
  whole run, but closed and reopened. An error is raised if
  the file has changed between \pdfximage and \pdfrefximage.
  This prevents the 'too many open files' error when lots of
  images are included.

* On Win32 Pdf image files are locked during the time that it is
  open, to prevent unnoticed file changes by external sources.

* Compilation now again works on FreeBSD.

* Format sharing between 32-bit and 64-bit architectures was
  broken.

* Unsetting attributes from lua could sometimes result in
  the unset state persisting beyond the current group level.

* If something went wrong in the scanning of pdf action items,
  the error message reported the current primitive name
  incorrectly.

* Luatex would crash on non-existant pdfs that were referenced
  from map file entries.


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.47.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco



From root at www.metatex.org  Fri Dec 18 12:33:16 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 18 Dec 2009 12:33:16 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091218113316.24E6F788014@www.metatex.org>

------------------------------------------------------------------------
r3259 | taco | 2009-12-18 10:26:22 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/NEWS

news

------------------------------------------------------------------------
r3260 | taco | 2009-12-18 10:33:05 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   A /tags/beta-0.47.0 (from /trunk:3259)

new tag for beta release

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec 18 16:29:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 18 Dec 2009 16:29:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091218152905.56AFE788014@www.metatex.org>

------------------------------------------------------------------------
r3261 | taco | 2009-12-18 12:38:21 +0100 (Fri, 18 Dec 2009) | 12 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.h
   M /trunk/source/texk/web2c/luatexdir/font/dofont.c
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.h
   M /trunk/source/texk/web2c/luatexdir/font/pkin.c
   M /trunk/source/texk/web2c/luatexdir/font/sfnt.c
   M /trunk/source/texk/web2c/luatexdir/font/sfnt.h
   M /trunk/source/texk/web2c/luatexdir/font/subfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/tounicode.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/font/vfpacket.c
   M /trunk/source/texk/web2c/luatexdir/font/writecff.c
   M /trunk/source/texk/web2c/luatexdir/font/writeenc.c
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c
   M /trunk/source/texk/web2c/luatexdir/font/writettf.c
   M /trunk/source/texk/web2c/luatexdir/font/writettf.h
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.h
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.h
   M /trunk/source/texk/web2c/luatexdir/image/writejpg.c
   M /trunk/source/texk/web2c/luatexdir/image/writepng.c
   M /trunk/source/texk/web2c/luatexdir/lang/texlang.c
   M /trunk/source/texk/web2c/luatexdir/lang/texlang.h
   M /trunk/source/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lfontlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/llualib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltokenlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luagen.c
   M /trunk/source/texk/web2c/luatexdir/lua/luagen.h
   M /trunk/source/texk/web2c/luatexdir/lua/luanode.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatoken.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.h
   M /trunk/source/texk/web2c/luatexdir/ocp/ocplist.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocplist.h
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pagetree.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pagetree.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfshipout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.h
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/arithmetic.c
   M /trunk/source/texk/web2c/luatexdir/tex/arithmetic.h
   M /trunk/source/texk/web2c/luatexdir/tex/buildpage.c
   M /trunk/source/texk/web2c/luatexdir/tex/buildpage.h
   M /trunk/source/texk/web2c/luatexdir/tex/conditional.c
   M /trunk/source/texk/web2c/luatexdir/tex/conditional.h
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.h
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.c
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.h
   M /trunk/source/texk/web2c/luatexdir/tex/errors.c
   M /trunk/source/texk/web2c/luatexdir/tex/errors.h
   M /trunk/source/texk/web2c/luatexdir/tex/expand.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.h
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.c
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.h
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.c
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.h
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.h
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.h
   M /trunk/source/texk/web2c/luatexdir/tex/memoryword.h
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.h
   M /trunk/source/texk/web2c/luatexdir/tex/nesting.c
   M /trunk/source/texk/web2c/luatexdir/tex/nesting.h
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.h
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.c
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.h
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c
   M /trunk/source/texk/web2c/luatexdir/tex/printing.h
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.c
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.h
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.c
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.h
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.c
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.h
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.h
   M /trunk/source/texk/web2c/luatexdir/tex/textcodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/textcodes.h
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.c
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.h
   M /trunk/source/texk/web2c/luatexdir/utils/managed-sa.c
   M /trunk/source/texk/web2c/luatexdir/utils/managed-sa.h
   M /trunk/source/texk/web2c/luatexdir/utils/synctex.c
   M /trunk/source/texk/web2c/luatexdir/utils/synctex.h
   M /trunk/source/texk/web2c/luatexdir/utils/utils.c
   M /trunk/source/texk/web2c/luatexdir/utils/utils.h
   M /trunk/source/texk/web2c/tmf-pool.h

A big patch by Hartmut and me that does nearly nothing:

* replace the C type 'integer' by C native 'int'
  throughout the luatex sources

* add do_zround() function to utils/utils.c
  (to replace the zround() from lib/zround.c)

* drop one of the web2c include files from image/epdf.h
  (no longer needed)


------------------------------------------------------------------------
r3262 | taco | 2009-12-18 14:45:17 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document hlist subtype values 

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec 18 22:31:33 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 18 Dec 2009 22:31:33 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091218213133.40800788014@www.metatex.org>

------------------------------------------------------------------------
r3263 | taco | 2009-12-18 16:55:07 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

wrong variable is used

------------------------------------------------------------------------
r3264 | taco | 2009-12-18 17:10:53 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

stop testing for necessary math fonts (obsolete test)

------------------------------------------------------------------------
r3265 | taco | 2009-12-18 17:21:40 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.h

A first stage of attempting to clean up mlist_to_hlist()

------------------------------------------------------------------------
r3266 | taco | 2009-12-18 17:33:17 +0100 (Fri, 18 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c

fix invalid free in colorstack popping

------------------------------------------------------------------------

From preining at logic.at  Sat Dec 19 12:21:39 2009
From: preining at logic.at (Norbert Preining)
Date: Sat, 19 Dec 2009 12:21:39 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
	there is room	for improvement
Message-ID: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>

Dear Taco,

one of the lua Gurus here at Debian checked the embedded libs and found
that most of the included libs are very similar to upstream, and he
offered to push the few changes in your code to upstream.

What do you say? (See attached email, including the diffs between current
upstream of the lua libs and code in texlua).

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
BULDOOO
a virulent red-coloured pus which generally accompanies clonmult
(q.v.) and sandberge (q.v.)
			--- Douglas Adams, The Meaning of Liff
-------------- next part --------------
An embedded message was scrubbed...
From: Enrico Tassi <gareuselesinge at debian.org>
Subject: Bug#441595: not all libraries are customized, there is room for improvement
Date: Thu, 17 Dec 2009 01:29:54 +0100
Size: 15431
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091219/2f6b27d9/attachment.mht>

From taco at elvenkind.com  Sat Dec 19 12:24:46 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 19 Dec 2009 12:24:46 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room	for improvement
In-Reply-To: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
Message-ID: <4B2CB7FE.7060208@elvenkind.com>

Norbert Preining wrote:
> Dear Taco,
> 
> one of the lua Gurus here at Debian checked the embedded libs and found
> that most of the included libs are very similar to upstream, and he
> offered to push the few changes in your code to upstream.
> 
> What do you say? (See attached email, including the diffs between current
> upstream of the lua libs and code in texlua).

But what happens then? Luatex becomes dependent on an external library
that may or may not be distributed by debian (or anyone else)?

Best wishes,
Taco


From root at www.metatex.org  Sat Dec 19 12:29:38 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 19 Dec 2009 12:29:38 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091219112938.3D832788014@www.metatex.org>

------------------------------------------------------------------------
r3267 | taco | 2009-12-19 08:21:02 +0100 (Sat, 19 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

fix incorrect unset_attribute

------------------------------------------------------------------------

From preining at logic.at  Sat Dec 19 12:28:38 2009
From: preining at logic.at (Norbert Preining)
Date: Sat, 19 Dec 2009 12:28:38 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are	customized,
	there is room for improvement
In-Reply-To: <4B2CB7FE.7060208@elvenkind.com>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
	<4B2CB7FE.7060208@elvenkind.com>
Message-ID: <20091219112838.GY23825@gamma.logic.tuwien.ac.at>

On Sa, 19 Dez 2009, Taco Hoekwater wrote:
> But what happens then? Luatex becomes dependent on an external library
> that may or may not be distributed by debian (or anyone else)?

No, only that as long as the libraries in texlua are the same as upstream
I can reuse the the packages in Debian.

And the advantage for you is that there are less changes if you incorporate
new versions of upstream libraries.

I didn't suggest to actually remove the sources from your code!

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
`Time is an illusion. Lunchtime doubly so.'
you should send that in to the
"Reader's Digest". They've got a page for people like you.'
                 --- Ford convincing Arthur to drink three pints in ten
                 --- minutes at lunchtime.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy

From taco at elvenkind.com  Sat Dec 19 12:36:35 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 19 Dec 2009 12:36:35 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are	customized,
 there is room for improvement
In-Reply-To: <20091219112838.GY23825@gamma.logic.tuwien.ac.at>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
	<4B2CB7FE.7060208@elvenkind.com>
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>
Message-ID: <4B2CBAC3.1020508@elvenkind.com>

Norbert Preining wrote:
> On Sa, 19 Dez 2009, Taco Hoekwater wrote:
>> But what happens then? Luatex becomes dependent on an external library
>> that may or may not be distributed by debian (or anyone else)?
> 
> No, only that as long as the libraries in texlua are the same as upstream
> I can reuse the the packages in Debian.

I don't understand this point. The files are statically linked,
so how can there be any reuse?

> And the advantage for you is that there are less changes if you incorporate
> new versions of upstream libraries.

But that is certainly true. Here is my opinion on those patches:

luafilesystem: that local patch will go away soon (it is possible to
   slide the new functions in elsewhere, where they are not interfering
   with the upstream).

luasocket: this (hstrerror) patch is good thing to go upstream.

luazip: this is not a local patch, I am just using an outdated version.


Best wishes,
Taco

From pragma at wxs.nl  Sat Dec 19 14:21:25 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 19 Dec 2009 14:21:25 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room	for improvement
In-Reply-To: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
Message-ID: <4B2CD355.7000502@wxs.nl>

Norbert Preining wrote:
> Dear Taco,
> 
> one of the lua Gurus here at Debian checked the embedded libs and found
> that most of the included libs are very similar to upstream, and he
> offered to push the few changes in your code to upstream.
> 
> What do you say? (See attached email, including the diffs between current
> upstream of the lua libs and code in texlua).

TeX has alwaye been independent of external libraries, although for 
pdftex it's possible to keep some libs external. Although the 'teams' 
assume statics, its' up to the distributers to decide on external libs; 
kpse has been an example for a long time already but that one lives 
alongside tex.

For luatex it's somewhat different. Take for instance a moving target 
like lpeg. Macro packages depend on the functionality as defined when 
the luatex version came around. If some (maybe more recent) library is 
used it might break things. And it might even be that at some point when 
we have luatex version 1.0, we freeze on libraries (apart from bug fixes 
of course). The same might happen with lua itself. If lua 6 comes around 
we might add an extra lua engine but keep 5 around as well.

Loading libraries in luatex can become a nightmare esp when we thing of 
mixes with luarocks and other distributions. As lua is meant for 
embedding, the libs we use are also kind of internal.

Of course, pushing changes/patches upstream is great.

This is a tricky issue. In principle luatex, once stable, should run 
decades as-is. An independent entity. On th eother hand, progress is 
also a nice thing.

I can imagine a scenario where we have a static luatex as usual, but 
when distributers want to go dynamic they should use the (in terms of 
api) same libs as static. None of us is looking forward to getting bug 
reports like "luatex+macropackage reports an lpeg error" which only 
happens with non statics bins.

Also, i wonder, if luatex demands some specific lib version, how does 
this translate to installation? Currently i can just drop a static 
luatex bin in my tex bin path but what if a bunch of extra libs (maybe 
already present but potentially conflicting) are used? Ok, we can 
control things with the cpath variable, but that also adds another 
variable to the game.

Anyhow, this needs quite a bit of thinking.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sat Dec 19 14:23:00 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 19 Dec 2009 14:23:00 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are	customized,
 there is room for improvement
In-Reply-To: <20091219112838.GY23825@gamma.logic.tuwien.ac.at>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>	<4B2CB7FE.7060208@elvenkind.com>
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>
Message-ID: <4B2CD3B4.1040108@wxs.nl>

Hi Norbert

> No, only that as long as the libraries in texlua are the same as upstream
> I can reuse the the packages in Debian.

what does that mean in practice for your tex live installer? that it has 
to fetch (and compile) extra libs?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From martin at oneiros.de  Sat Dec 19 14:31:01 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sat, 19 Dec 2009 14:31:01 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
	there is room for improvement
In-Reply-To: <4B2CD3B4.1040108@wxs.nl>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
	<4B2CB7FE.7060208@elvenkind.com>
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>
	<4B2CD3B4.1040108@wxs.nl>
Message-ID: <68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>

2009/12/19 Hans Hagen <pragma at wxs.nl>:
> what does that mean in practice for your tex live installer? that it has to
> fetch (and compile) extra libs?

Debian: Dynamic libs.
TeXlive: Mostly static binaries.

Best
    Martin

From pragma at wxs.nl  Sat Dec 19 14:37:12 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 19 Dec 2009 14:37:12 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room for improvement
In-Reply-To: <68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>	
	<4B2CB7FE.7060208@elvenkind.com>	
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>	
	<4B2CD3B4.1040108@wxs.nl>
	<68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>
Message-ID: <4B2CD708.4090401@wxs.nl>

Martin Schr?der wrote:
> 2009/12/19 Hans Hagen <pragma at wxs.nl>:
>> what does that mean in practice for your tex live installer? that it has to
>> fetch (and compile) extra libs?
> 
> Debian: Dynamic libs.
> TeXlive: Mostly static binaries.

yes but how does it check if the libs are functionally the same?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From martin at oneiros.de  Sat Dec 19 14:41:21 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sat, 19 Dec 2009 14:41:21 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
	there is room for improvement
In-Reply-To: <4B2CD708.4090401@wxs.nl>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
	<4B2CB7FE.7060208@elvenkind.com>
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>
	<4B2CD3B4.1040108@wxs.nl>
	<68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>
	<4B2CD708.4090401@wxs.nl>
Message-ID: <68c491a60912190541t6eee0abeh6318c96f9a805aef@mail.gmail.com>

2009/12/19 Hans Hagen <pragma at wxs.nl>:
> yes but how does it check if the libs are functionally the same?

APIs are versioned and checked by the loader.
http://en.wikipedia.org/wiki/Dynamic_library#Dynamic_linking
It works. Mostly.

Best
    Martin

From preining at logic.at  Sat Dec 19 14:48:12 2009
From: preining at logic.at (Norbert Preining)
Date: Sat, 19 Dec 2009 22:48:12 +0900
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room for improvement
In-Reply-To: <68c491a60912190541t6eee0abeh6318c96f9a805aef@mail.gmail.com>
	<4B2CD708.4090401@wxs.nl>
Message-ID: <20091219134812.GA24865@gandalf.dynalias.org>

Hi Hans,

On Sat, 19 Dec 2009, Hans Hagen wrote:
> >Debian: Dynamic libs.
> >TeXlive: Mostly static binaries.
> 
> yes but how does it check if the libs are functionally the same?

md5sum of the source code.

Please do NOT care for what we are doing in Debian, that is our business
and I will care for it.

I only try to get some changes in texlua pushed upstream and maybe
compile some of the libs dynamically *ONLY* in Debian.

Best wishes

Norbert

----------------------------------------------------------------------------
Norbert Preining                preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan               TU Wien, Austria            Debian TeX Task Force
gpg DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
----------------------------------------------------------------------------
KURDISTAN (n.)
Hard stare given by a husband to his wife when he notices a sharp
increase in the number of times he answers the phone to be told,
'Sorry, wrong number.'
			--- Douglas Adams, The Meaning of Liff

From pragma at wxs.nl  Sat Dec 19 14:48:10 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 19 Dec 2009 14:48:10 +0100
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room for improvement
In-Reply-To: <68c491a60912190541t6eee0abeh6318c96f9a805aef@mail.gmail.com>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>	
	<4B2CB7FE.7060208@elvenkind.com>	
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>	
	<4B2CD3B4.1040108@wxs.nl>	
	<68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>	
	<4B2CD708.4090401@wxs.nl>
	<68c491a60912190541t6eee0abeh6318c96f9a805aef@mail.gmail.com>
Message-ID: <4B2CD99A.3030201@wxs.nl>

Martin Schr?der wrote:
> 2009/12/19 Hans Hagen <pragma at wxs.nl>:
>> yes but how does it check if the libs are functionally the same?
> 
> APIs are versioned and checked by the loader.
> http://en.wikipedia.org/wiki/Dynamic_library#Dynamic_linking
> It works. Mostly.

sure, but i wonder what this means for the texlive updater ... will it 
also ship upgraded (or ancient) library versions then?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Sat Dec 19 14:49:32 2009
From: preining at logic.at (Norbert Preining)
Date: Sat, 19 Dec 2009 22:49:32 +0900
Subject: [Dev-luatex] (fwd) Bug#441595: not all libraries are customized,
 there is room for improvement
In-Reply-To: <4B2CD99A.3030201@wxs.nl>
References: <20091219112139.GV23825@gamma.logic.tuwien.ac.at>
	<4B2CB7FE.7060208@elvenkind.com>
	<20091219112838.GY23825@gamma.logic.tuwien.ac.at>
	<4B2CD3B4.1040108@wxs.nl>
	<68c491a60912190531l719129b3raaa4fd36c0484656@mail.gmail.com>
	<4B2CD708.4090401@wxs.nl>
	<68c491a60912190541t6eee0abeh6318c96f9a805aef@mail.gmail.com>
	<4B2CD99A.3030201@wxs.nl>
Message-ID: <20091219134932.GA29604@gandalf.dynalias.org>

On Sat, 19 Dec 2009, Hans Hagen wrote:
> sure, but i wonder what this means for the texlive updater ... will
> it also ship upgraded (or ancient) library versions then?

We are talking only about the Debian packages here. The TeX Live 
(upstream, main) will NOT change to dynamic libs, sure not!!!

Best wishes

Norbert

----------------------------------------------------------------------------
Norbert Preining                preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan               TU Wien, Austria            Debian TeX Task Force
gpg DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
----------------------------------------------------------------------------
FROSSES (pl.n.)
The lecherous looks exchanged between sixteen-year-olds at a party
given by someone's parents.
			--- Douglas Adams, The Meaning of Liff

From root at www.metatex.org  Sat Dec 19 16:29:14 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 19 Dec 2009 16:29:14 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091219152915.1E03D788014@www.metatex.org>

------------------------------------------------------------------------
r3268 | taco | 2009-12-19 12:48:41 +0100 (Sat, 19 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c

copy_font copied one charinfo too few

------------------------------------------------------------------------
r3269 | hhenkel | 2009-12-19 13:10:10 +0100 (Sat, 19 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.h
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.c

fix font slant

------------------------------------------------------------------------
r3270 | hhenkel | 2009-12-19 14:12:15 +0100 (Sat, 19 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c

slightly more general p->tm[2].m calculation

------------------------------------------------------------------------
r3271 | hhenkel | 2009-12-19 14:21:07 +0100 (Sat, 19 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c

remove special case "extend = 0" for unextended font,
this is now "extend = 1000", which is more natural.

------------------------------------------------------------------------

From root at www.metatex.org  Sun Dec 20 22:30:03 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 20 Dec 2009 22:30:03 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091220213003.A141D1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3272 | hhenkel | 2009-12-20 19:58:08 +0100 (Sun, 20 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.h
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h

follow-up to r3246: now also ExtendFont by text matrix (should work also
for TTF, OTF; Type1 fonts are not anymore modified by Extend or Slant)

------------------------------------------------------------------------
r3273 | oneiros | 2009-12-20 20:16:12 +0100 (Sun, 20 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c

rm unused variables

------------------------------------------------------------------------
r3274 | hhenkel | 2009-12-20 20:25:34 +0100 (Sun, 20 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c

fixing r3272, a default value was missing

------------------------------------------------------------------------

From root at www.metatex.org  Mon Dec 21 12:31:04 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 21 Dec 2009 12:31:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091221113104.CFCBB1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3275 | hhenkel | 2009-12-20 23:20:08 +0100 (Sun, 20 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftypes.h

make Tf operator lazy (there were redundant Tf in hz mode)

------------------------------------------------------------------------
r3276 | taco | 2009-12-21 11:51:38 +0100 (Mon, 21 Dec 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c

fix placement of operator scripts of OT MATH fonts cf. Word's 
logic whereby the italic correction is only used to tuck in
the subscript and for nothing else.

------------------------------------------------------------------------
r3277 | taco | 2009-12-21 11:52:28 +0100 (Mon, 21 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luatex.c

bump the version because previous commit was incompatible with 0.47.0

------------------------------------------------------------------------

From root at www.metatex.org  Mon Dec 21 16:29:18 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 21 Dec 2009 16:29:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091221152918.DE3091E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3278 | taco | 2009-12-21 12:26:19 +0100 (Mon, 21 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/src/ffdummies.c

don't write directly to stderr from within luafontloader

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Mon Dec 21 19:24:03 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Mon, 21 Dec 2009 19:24:03 +0100
Subject: [Dev-luatex] assigment to node fields ignored
Message-ID: <4B2FBD43.4010507@gust.org.pl>

Colleagues,

some luatex revisions ago I realised that assigments to pdf_refobj
nodes are ignored. The following assertion fails:

\directlua{

   local ref = node.new(node.id "whatsit", node.subtype "pdf_refobj")
   ref.objnum = 1
   assert(ref.objnum)

}\end

By compiling and trying several revisions back, I found that it is so
sice rev3229. Is the pdf_refobj whatsit intentionally not writable?

By the way, due to the change of pdf metatable, assignments to pdf
library table,

   pdf.whatever = true
   assert(pdf.whatever)

are ignored since rev3206. That doesn't hurt, just wanted to be sure if 
this is acknowledged.
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl


From pragma at wxs.nl  Mon Dec 21 19:40:18 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 21 Dec 2009 19:40:18 +0100
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B2FBD43.4010507@gust.org.pl>
References: <4B2FBD43.4010507@gust.org.pl>
Message-ID: <4B2FC112.9050703@wxs.nl>

Pawe? Jackowski wrote:
> Colleagues,
> 
> some luatex revisions ago I realised that assigments to pdf_refobj
> nodes are ignored. The following assertion fails:
> 
> \directlua{
> 
>   local ref = node.new(node.id "whatsit", node.subtype "pdf_refobj")
>   ref.objnum = 1
>   assert(ref.objnum)
> 
> }\end
> 
> By compiling and trying several revisions back, I found that it is so
> sice rev3229. Is the pdf_refobj whatsit intentionally not writable?

i can imagine that to be on purpose as there is no other safeguard

> By the way, due to the change of pdf metatable, assignments to pdf
> library table,
> 
>   pdf.whatever = true
>   assert(pdf.whatever)
> 
> are ignored since rev3206. That doesn't hurt, just wanted to be sure if 
> this is acknowledged.

that's a bug then as there is no reason not to assing to the pdf table 
(i probably do that anyway)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Mon Dec 21 19:49:02 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 21 Dec 2009 19:49:02 +0100 (CET)
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B2FC112.9050703@wxs.nl>
References: <4B2FBD43.4010507@gust.org.pl> <4B2FC112.9050703@wxs.nl>
Message-ID: <alpine.DEB.1.00.0912211948030.5268@hahepc1.hahe>

On Mon, 21 Dec 2009, Hans Hagen wrote:
> Pawe? Jackowski wrote:
> >
> > some luatex revisions ago I realised that assigments to pdf_refobj
> > nodes are ignored. The following assertion fails:
> >
> > \directlua{
> >
> >   local ref = node.new(node.id "whatsit", node.subtype "pdf_refobj")
> >   ref.objnum = 1
> >   assert(ref.objnum)
> >
> > }\end
> >
> > By compiling and trying several revisions back, I found that it is
> > so sice rev3229. Is the pdf_refobj whatsit intentionally not
> > writable?
>
> i can imagine that to be on purpose as there is no other safeguard

this should work, checking what's wrong...

Regards, Hartmut

From hartmut_henkel at gmx.de  Mon Dec 21 20:56:31 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 21 Dec 2009 20:56:31 +0100 (CET)
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B2FBD43.4010507@gust.org.pl>
References: <4B2FBD43.4010507@gust.org.pl>
Message-ID: <alpine.DEB.1.00.0912212046100.10460@hahepc1.hahe>

Hi Pawe?

On Mon, 21 Dec 2009, Pawe? Jackowski wrote:

> some luatex revisions ago I realised that assigments to pdf_refobj
> nodes are ignored. The following assertion fails:
>
> \directlua{
>
>   local ref = node.new(node.id "whatsit", node.subtype "pdf_refobj")
>   ref.objnum = 1
>   assert(ref.objnum)
>
> }\end
>
> By compiling and trying several revisions back, I found that it is so
> sice rev3229. Is the pdf_refobj whatsit intentionally not writable?

found it, i had misunderstood the meaning of "attr" in texnodes.c, it
should be fixed now in SVN 3279. Many thanks for reporting, and sorry
for the trouble.

Regards, Hartmut

From root at www.metatex.org  Mon Dec 21 22:30:12 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 21 Dec 2009 22:30:12 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091221213012.7CC431E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3279 | hhenkel | 2009-12-21 20:46:33 +0100 (Mon, 21 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

<some pdf_refobj_node>.objnum couldn't be assigned, bug
reported by Pawe? Jackowski on dev-luatex, 21 Dec 2009.

------------------------------------------------------------------------
r3280 | hhenkel | 2009-12-21 21:46:06 +0100 (Mon, 21 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c

pointer to annot info was missing

------------------------------------------------------------------------

From reinhard.kotucha at web.de  Mon Dec 21 23:25:52 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 21 Dec 2009 23:25:52 +0100
Subject: [Dev-luatex] md5.sum
Message-ID: <19247.62960.245638.126943@zaphod.ms25.net>

Dear Sirs,
I wrote a tiny program which calculates the checksum of a file.  It
should provide the the same result as md5sum(1), but it doesn't.

$ ./md5sum.tlu md5sum.tlu 
737d8815930c35e7d112374765dbe01f  md5sum.tlu
$ md5sum md5sum.tlu 
bdab3aa02a33eb91a9e0c1001954a413  md5sum.tlu

This is quite strange, I would expect the same result.

The relevant piece if code is:
----------------------------------------------------------------
file=arg[1]

function md5.hex(s)
  return (string.gsub(md5.sum(s), ".", 
  function (c) return string.format("%02x", string.byte(c)) end))
end

local fh=assert(io.open(file, 'rb'))
content=fh:read("*all")
fh:close()

io.write (md5.hex(content)..'  '..file..'\n')
----------------------------------------------------------------

You can download the complete file from:

  http://tug.org/~kotucha/md5sum.tlu.gz

I'm using md5.sum() in an installer for getnonfreefonts, see:

  http://tug.org/~kotucha/getnonfreefonts

The installer contains the files to install as here-documents.  The
program which inserts the here-documents also creates the checksums.
Since texlua creates checksums which are incompatible with those
created by md5sum(1), I use md5sum.tlu in order to create them.

The installer finally calculates the checksums of the files it
installed.  This works on Unix, but Tomek T. tested it on Windows and
told me that he got checksum mismatches.  For the time beeing, I
commented out the checksum tests.

It's possible that there are problems with line endings.  But I must
admit that I don't remember whether I added the binary flag to the
function install_file(...) before Tomek tested it.  However, the fact
that md5sum.tlu and md5sum(1) provide different results is not what I
expect.

Any idea?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From adityam at umich.edu  Mon Dec 21 23:55:17 2009
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 21 Dec 2009 17:55:17 -0500 (EST)
Subject: [Dev-luatex] md5.sum
In-Reply-To: <19247.62960.245638.126943@zaphod.ms25.net>
References: <19247.62960.245638.126943@zaphod.ms25.net>
Message-ID: <alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>

On Mon, 21 Dec 2009, Reinhard Kotucha wrote:

> Dear Sirs,
> I wrote a tiny program which calculates the checksum of a file.  It
> should provide the the same result as md5sum(1), but it doesn't.
>
>
> It's possible that there are problems with line endings.  But I must
> admit that I don't remember whether I added the binary flag to the
> function install_file(...) before Tomek tested it.  However, the fact
> that md5sum.tlu and md5sum(1) provide different results is not what I
> expect.
>
> Any idea?

Something seems to be wrong with the library:

For example

$echo -n "test" | md5sum 
098f6bcd4621d373cade4e832627b4f6  -

but

print(md5.sumhexa("test")) gives

0944483cd90a293923c8244520132de1

Aditya

From pragma at wxs.nl  Tue Dec 22 00:01:35 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 22 Dec 2009 00:01:35 +0100
Subject: [Dev-luatex] md5.sum
In-Reply-To: <alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
Message-ID: <4B2FFE4F.9020004@wxs.nl>

Aditya Mahajan wrote:
> On Mon, 21 Dec 2009, Reinhard Kotucha wrote:
> 
>> Dear Sirs,
>> I wrote a tiny program which calculates the checksum of a file.  It
>> should provide the the same result as md5sum(1), but it doesn't.
>>
>>
>> It's possible that there are problems with line endings.  But I must
>> admit that I don't remember whether I added the binary flag to the
>> function install_file(...) before Tomek tested it.  However, the fact
>> that md5sum.tlu and md5sum(1) provide different results is not what I
>> expect.
>>
>> Any idea?
> 
> Something seems to be wrong with the library:
> 
> For example
> 
> $echo -n "test" | md5sum 098f6bcd4621d373cade4e832627b4f6  -
> 
> but
> 
> print(md5.sumhexa("test")) gives
> 
> 0944483cd90a293923c8244520132de1

strange, as on my machine (vista) it gives

098f6bcd4621d373cade4e832627b4f6

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Tue Dec 22 00:06:09 2009
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 21 Dec 2009 18:06:09 -0500 (EST)
Subject: [Dev-luatex] md5.sum
In-Reply-To: <4B2FFE4F.9020004@wxs.nl>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
Message-ID: <alpine.LNX.2.01.0912211805170.21855@ybpnyubfg.ybpnyqbznva>

On Tue, 22 Dec 2009, Hans Hagen wrote:

> Aditya Mahajan wrote:
>> On Mon, 21 Dec 2009, Reinhard Kotucha wrote:
>> 
>>> Dear Sirs,
>>> I wrote a tiny program which calculates the checksum of a file.  It
>>> should provide the the same result as md5sum(1), but it doesn't.
>>> 
>>> 
>>> It's possible that there are problems with line endings.  But I must
>>> admit that I don't remember whether I added the binary flag to the
>>> function install_file(...) before Tomek tested it.  However, the fact
>>> that md5sum.tlu and md5sum(1) provide different results is not what I
>>> expect.
>>> 
>>> Any idea?
>> 
>> Something seems to be wrong with the library:
>> 
>> For example
>> 
>> $echo -n "test" | md5sum 098f6bcd4621d373cade4e832627b4f6  -
>> 
>> but
>> 
>> print(md5.sumhexa("test")) gives
>> 
>> 0944483cd90a293923c8244520132de1
>
> strange, as on my machine (vista) it gives
>
> 098f6bcd4621d373cade4e832627b4f6

Hmm... I am using linux 64 bit and

This is LuaTeX, Version beta-0.47.0-2009121815

Aditya

From adityam at umich.edu  Tue Dec 22 00:16:38 2009
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 21 Dec 2009 18:16:38 -0500 (EST)
Subject: [Dev-luatex] md5.sum
In-Reply-To: <alpine.LNX.2.01.0912211805170.21855@ybpnyubfg.ybpnyqbznva>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
	<alpine.LNX.2.01.0912211805170.21855@ybpnyubfg.ybpnyqbznva>
Message-ID: <alpine.LNX.2.01.0912211814210.21855@ybpnyubfg.ybpnyqbznva>

On Mon, 21 Dec 2009, Aditya Mahajan wrote:

> On Tue, 22 Dec 2009, Hans Hagen wrote:
>
>> Aditya Mahajan wrote:
>>> On Mon, 21 Dec 2009, Reinhard Kotucha wrote:
>>> 
>>>> Dear Sirs,
>>>> I wrote a tiny program which calculates the checksum of a file.  It
>>>> should provide the the same result as md5sum(1), but it doesn't.
>>>> 
>>>> 
>>>> It's possible that there are problems with line endings.  But I must
>>>> admit that I don't remember whether I added the binary flag to the
>>>> function install_file(...) before Tomek tested it.  However, the fact
>>>> that md5sum.tlu and md5sum(1) provide different results is not what I
>>>> expect.
>>>> 
>>>> Any idea?
>>> 
>>> Something seems to be wrong with the library:
>>> 
>>> For example
>>> 
>>> $echo -n "test" | md5sum 098f6bcd4621d373cade4e832627b4f6  -
>>> 
>>> but
>>> 
>>> print(md5.sumhexa("test")) gives
>>> 
>>> 0944483cd90a293923c8244520132de1
>> 
>> strange, as on my machine (vista) it gives
>> 
>> 098f6bcd4621d373cade4e832627b4f6
>
> Hmm... I am using linux 64 bit and
>
> This is LuaTeX, Version beta-0.47.0-2009121815

I get the correct result if I use the lua-md5-1.1.2 library

lua -lmd5

but texlua gives incorrect result.

Aditya

From t34www at googlemail.com  Tue Dec 22 00:29:57 2009
From: t34www at googlemail.com (T T)
Date: Mon, 21 Dec 2009 23:29:57 +0000
Subject: [Dev-luatex] md5.sum
In-Reply-To: <4B2FFE4F.9020004@wxs.nl>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
Message-ID: <e7fba2610912211529n38317218rb72772407af880ee@mail.gmail.com>

2009/12/21 Hans Hagen <pragma at wxs.nl>:
>> Something seems to be wrong with the library:
>>
>> For example
>>
>> $echo -n "test" | md5sum 098f6bcd4621d373cade4e832627b4f6 ?-
>>
>> but
>>
>> print(md5.sumhexa("test")) gives
>>
>> 0944483cd90a293923c8244520132de1
>
> strange, as on my machine (vista) it gives
>
> 098f6bcd4621d373cade4e832627b4f6
>

Same here on WinXP with luatex beta-0.40.6-2009110118 & beta-0.46.0-2009112716.

I don't know what gives. I did test Reinhard's installer on the same
machine and with the same binaries and it failed on checksums back
then.

Cheers,

Tomek

From oberdiek at uni-freiburg.de  Tue Dec 22 00:50:46 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 22 Dec 2009 00:50:46 +0100
Subject: [Dev-luatex] md5.sum
In-Reply-To: <19247.62960.245638.126943@zaphod.ms25.net>
References: <19247.62960.245638.126943@zaphod.ms25.net>
Message-ID: <20091221235045.GA6238@irwin.vpn.uni-freiburg.de>

On Mon, Dec 21, 2009 at 11:25:52PM +0100, Reinhard Kotucha wrote:

> I wrote a tiny program which calculates the checksum of a file.  It
> should provide the the same result as md5sum(1), but it doesn't.
> 
> $ ./md5sum.tlu md5sum.tlu 
> 737d8815930c35e7d112374765dbe01f  md5sum.tlu
> $ md5sum md5sum.tlu 
> bdab3aa02a33eb91a9e0c1001954a413  md5sum.tlu
> 
> This is quite strange, I would expect the same result.

$ texlua --version
This is LuaTeX, Version beta-0.40.6-2009100220 (TeX Live 2009) ...
$ texlua md5sum.tlu md5sum.tlu
bdab3aa02a33eb91a9e0c1001954a413  md5sum.tlu

$ /t/context/tex/texmf-linux/bin/texlua --version
This is LuaTeX, Version beta-0.47.0-2009121922
...
$ /t/context/tex/texmf-linux/bin/texlua md5sum.tlu md5sum.tlu
bdab3aa02a33eb91a9e0c1001954a413  md5sum.tlu

Linux/32Bit

Same with win32, beta-0.47.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From hartmut_henkel at gmx.de  Tue Dec 22 01:01:40 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue, 22 Dec 2009 01:01:40 +0100 (CET)
Subject: [Dev-luatex] md5.sum
In-Reply-To: <e7fba2610912211529n38317218rb72772407af880ee@mail.gmail.com>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
	<e7fba2610912211529n38317218rb72772407af880ee@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0912220057050.6910@hahepc1.hahe>

On Mon, 21 Dec 2009, T T wrote:
> 2009/12/21 Hans Hagen <pragma at wxs.nl>:
> >> Something seems to be wrong with the library:
> >>
> >> For example
> >>
> >> $echo -n "test" | md5sum 098f6bcd4621d373cade4e832627b4f6 ?-
> >>
> >> but
> >>
> >> print(md5.sumhexa("test")) gives
> >>
> >> 0944483cd90a293923c8244520132de1
> >
> > strange, as on my machine (vista) it gives
> >
> > 098f6bcd4621d373cade4e832627b4f6
> >
>
> Same here on WinXP with luatex beta-0.40.6-2009110118 &
> beta-0.46.0-2009112716.
>
> I don't know what gives. I did test Reinhard's installer on the same
> machine and with the same binaries and it failed on checksums back
> then.

seems to be a 32/64 bit issue. After sprinkling the md5.c code with 32
bit MASKs (see diff) luatex indeed gives the correct
098f6bcd4621d373cade4e832627b4f6 on an x86_64 AMD debian Linux PC.
Unclear which MASK made it, but i guess it's in the rotate().

Regards, Hartmut
-------------- next part --------------
A non-text attachment was scrubbed...
Name: md5.diff
Type: text/x-diff
Size: 1844 bytes
Desc: md5.diff
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091222/ee9b9ec5/attachment.diff>

From P.Jackowski at gust.org.pl  Tue Dec 22 02:51:45 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Tue, 22 Dec 2009 02:51:45 +0100
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B2FC112.9050703@wxs.nl>
References: <4B2FBD43.4010507@gust.org.pl> <4B2FC112.9050703@wxs.nl>
Message-ID: <4B302631.2010806@gust.org.pl>

>> By compiling and trying several revisions back, I found that it is so
>> sice rev3229. Is the pdf_refobj whatsit intentionally not writable?

Hartmut:
> found it, i had misunderstood the meaning of "attr" in texnodes.c, it
> should be fixed now in SVN 3279.

Checked on 3282; pdf_refobj.objnum works ok.

> Many thanks for reporting, and sorry
> for the trouble.

Many thanks for the fix few hours after my feedback, and me sorry for
the trouble :)

>>   pdf.whatever = true
>>   assert(pdf.whatever)
>>
>> are ignored since rev3206. That doesn't hurt, just wanted to be sure 
>> if this is acknowledged.

Hans:
> that's a bug then as there is no reason not to assing to the pdf table 
> (i probably do that anyway)

OK then, reported to mantis as http://tracker.luatex.org/view.php?id=310
As since this needs touching pdf metatable anyway, two thoughts for your 
consideration.

1. New pdf table fields (pdf.pdftrailer, pdf.pdfinfo, pdf.pdfcatalog, 
pdf.pdfnames) actually do nothing more but assign internal toks lists. 
As we know, their pdftex equivalents weren't generic toks lists, but 
perhaps they should for interface consistency? And perhaps they should 
live in the same place as pdfpageattr and companion?

2. Fontmap-related write-only fields (pdf.mapline, pdf.mapfile) could 
actually be static functions

	pdf.mapline "+font Font ..."
	pdf.mapfile "pdftex.map"

as there is no advantage of having them dynamic. Then one can local them

	local mapline = pdf.mapline

avoiding unnecessary overhead of metacall on every access to pdf table.

Best regards, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Tue Dec 22 09:23:30 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 22 Dec 2009 09:23:30 +0100
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B302631.2010806@gust.org.pl>
References: <4B2FBD43.4010507@gust.org.pl> <4B2FC112.9050703@wxs.nl>
	<4B302631.2010806@gust.org.pl>
Message-ID: <4B308202.900@wxs.nl>

Pawe? Jackowski wrote:

> 1. New pdf table fields (pdf.pdftrailer, pdf.pdfinfo, pdf.pdfcatalog, 
> pdf.pdfnames) actually do nothing more but assign internal toks lists. 
> As we know, their pdftex equivalents weren't generic toks lists, but 
> perhaps they should for interface consistency? And perhaps they should 
> live in the same place as pdfpageattr and companion?

this is on purpose as the interface at the lua end is not modelled after 
the one at the tex end; we will even go further and provide hooks at the 
lua end like pdf.writecatalog(collectedsofar) or so, i.e. even more 
control

> 2. Fontmap-related write-only fields (pdf.mapline, pdf.mapfile) could 
> actually be static functions
> 
>     pdf.mapline "+font Font ..."
>     pdf.mapfile "pdftex.map"
> 
> as there is no advantage of having them dynamic. Then one can local them
> 
>     local mapline = pdf.mapline
> 
> avoiding unnecessary overhead of metacall on every access to pdf table.

well, the whole font/map related bit of the code will be overhauled (not 
before 0.50) as part of other cleanup (type1c etc) but that will not 
happen before 0.50. The overhead you mention is neglectable (after all 
functions also have overhead).

Hans

From P.Jackowski at gust.org.pl  Tue Dec 22 10:12:29 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Tue, 22 Dec 2009 10:12:29 +0100
Subject: [Dev-luatex] assigment to node fields ignored
In-Reply-To: <4B308202.900@wxs.nl>
References: <4B2FBD43.4010507@gust.org.pl> <4B2FC112.9050703@wxs.nl>
	<4B302631.2010806@gust.org.pl> <4B308202.900@wxs.nl>
Message-ID: <4B308D7D.4030206@gust.org.pl>

Hans Hagen wrote:
> Pawe? Jackowski wrote:
> 
>> 1. New pdf table fields (pdf.pdftrailer, pdf.pdfinfo, pdf.pdfcatalog, 
>> pdf.pdfnames) actually do nothing more but assign internal toks lists. 
[...]
> this is on purpose as the interface at the lua end is not modelled after 
> the one at the tex end; we will even go further and provide hooks at the 
> lua end like pdf.writecatalog(collectedsofar) or so, i.e. even more control

Sounds cool!

>> 2. Fontmap-related write-only fields (pdf.mapline, pdf.mapfile) could 
>> actually be static functions
[...]
> well, the whole font/map related bit of the code will be overhauled (not 
> before 0.50) as part of other cleanup (type1c etc) but that will not 
> happen before 0.50. The overhead you mention is neglectable (after all 
> functions also have overhead).

OK, thank you.

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From root at www.metatex.org  Tue Dec 22 12:31:19 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 22 Dec 2009 12:31:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091222113119.9D9191E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3281 | hhenkel | 2009-12-21 22:32:15 +0100 (Mon, 21 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

regression: remove Type1 font replacement during PDF file embedding
(part 1, pdftoepdf.cc view)

------------------------------------------------------------------------
r3282 | hhenkel | 2009-12-21 22:55:47 +0100 (Mon, 21 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.h
   M /trunk/source/texk/web2c/luatexdir/font/writeenc.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h

regression: remove Type1 font replacement during PDF file embedding
(part 2, mapfile.c view)

------------------------------------------------------------------------
r3283 | hhenkel | 2009-12-22 01:10:51 +0100 (Tue, 22 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luamd5/md5.c

quick fix for md5 calculation
print(md5.sumhexa("test")) ---> 098f6bcd4621d373cade4e832627b4f6

------------------------------------------------------------------------
r3284 | hhenkel | 2009-12-22 02:12:25 +0100 (Tue, 22 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luamd5/md5.c

instead of MASK (r3283), use exact-size integer type uint32_t

------------------------------------------------------------------------

From reinhard.kotucha at web.de  Wed Dec 23 00:45:45 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 23 Dec 2009 00:45:45 +0100
Subject: [Dev-luatex] md5.sum
In-Reply-To: <alpine.DEB.1.00.0912220057050.6910@hahepc1.hahe>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
	<e7fba2610912211529n38317218rb72772407af880ee@mail.gmail.com>
	<alpine.DEB.1.00.0912220057050.6910@hahepc1.hahe>
Message-ID: <19249.23081.109317.286553@zaphod.ms25.net>

On 22 December 2009 Hartmut Henkel wrote:

 > seems to be a 32/64 bit issue. After sprinkling the md5.c code with 32
 > bit MASKs (see diff) luatex indeed gives the correct
 > 098f6bcd4621d373cade4e832627b4f6 on an x86_64 AMD debian Linux PC.

Many thanks to everybody who helped to find the bug, and to Hartmut,
who provided a fix.  Hartmut, did you consider already to inform the
Lua developers.  I think that this problem should be fixed upstream.

I surmise that Lua is supposed to work on 16 bit systems as well,
hence I suppose that the code has to be revised anyway.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Wed Dec 23 15:37:34 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Wed, 23 Dec 2009 15:37:34 +0100
Subject: [Dev-luatex] order of node linking matters
Message-ID: <4B322B2E.8080100@gust.org.pl>

Dear Colleagues,

the following code fails assertion (luafont.c, line 1950). But it is
enough to transpone last two lines of lua code to avoid it. Could 
someone explain why the order of node linking matters here?

\nokerns=1 \noligs=1
\setbox100=\hbox{ab\-xx}
\directlua{% here we move glyph b into disc node
	local a = tex.box[100].list % glyph a
	local b = a.next            % glyph b
	local d = b.next            % discretionary
	local _ = d.pre             % prebreak dash

	a.next = d  d.prev = a      % couple glyph a with disc
	d.pre = b                   % let glyph b be prebreak
	b.next = _  _.prev = b      % couple glyph b with dash
}
\hsize0pt \overfullrule0pt \hfuzz\maxdimen % force hyphenation
\unhbox100                                 % flush the list
\end

Apparently the assigment

	discretionary.pre = someglyph
	someglyph.next = someother

and

	someglyph.next = someother
	discretionary.pre = someglyph

is not the same. Why?

Warm greets to u all, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl


From taco at elvenkind.com  Wed Dec 23 17:28:50 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Dec 2009 17:28:50 +0100
Subject: [Dev-luatex] order of node linking matters
In-Reply-To: <4B322B2E.8080100@gust.org.pl>
References: <4B322B2E.8080100@gust.org.pl>
Message-ID: <4B324542.9000301@elvenkind.com>

Pawe? Jackowski wrote:
> 
>     someglyph.next = someother
>     discretionary.pre = someglyph
> 
> is not the same. Why?

Because a discretionary's pre, post, and replace lists are a bit
special: internally the discretionary does not just have a next and
a prev link for each of the head nodes, but also a 'tail' link.
That last one points to the last node in the list for each of
the three fields. That extra link is used during hyphenation and
at end-of-line situations (those parts of the code would be much
more complex == slower without it).

So, when in lua you assign to <disc>.pre, that assingment also has
to fix up that tail link (it does so by running the C equivalent
of the node.tail() function).

If the list you are assigning is well-formed, this is transparent.
But yours isn't yet at that point in the code, because 'b.next' still
points to 'd' at the moment the 'd.pre = b' is seen; and that confuses
the internal code into an assertion failure.

I admit this is obscure, but the general rule is simple: never
assign a list to a node field until you are sure its internal link
structure is correct. (a warning to this effect will be added to
the manual).

Best wishes,
Taco

From P.Jackowski at gust.org.pl  Wed Dec 23 18:29:35 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Wed, 23 Dec 2009 18:29:35 +0100
Subject: [Dev-luatex] order of node linking matters
In-Reply-To: <4B324542.9000301@elvenkind.com>
References: <4B322B2E.8080100@gust.org.pl> <4B324542.9000301@elvenkind.com>
Message-ID: <4B32537F.3050902@gust.org.pl>

Taco Hoekwater wrote:
> Pawe? Jackowski wrote:
>>
>>     someglyph.next = someother
>>     discretionary.pre = someglyph
>>
>> is not the same. Why?

Hans:
> indeed strange ... a quick hack is to use node.copy on b 

Copying the node works in that case, thanks.

Taco:
> Because a discretionary's pre, post, and replace lists are a bit
> special: internally the discretionary does not just have a next and
> a prev link for each of the head nodes, but also a 'tail' link.
> That last one points to the last node in the list for each of
> the three fields. That extra link is used during hyphenation and
> at end-of-line situations (those parts of the code would be much
> more complex == slower without it).

Agh, having the disc.tail link(s) at lua level would simplify processing 
discretionaries a lot! Why you decided not to interface tails?

> So, when in lua you assign to <disc>.pre, that assingment also has
> to fix up that tail link (it does so by running the C equivalent
> of the node.tail() function).
> 
> If the list you are assigning is well-formed, this is transparent.
> But yours isn't yet at that point in the code, because 'b.next' still
> points to 'd' at the moment the 'd.pre = b' is seen; and that confuses
> the internal code into an assertion failure.

Clear.

> I admit this is obscure, but the general rule is simple: never
> assign a list to a node field until you are sure its internal link
> structure is correct. (a warning to this effect will be added to
> the manual).

Sounds neat.

I also noticed that assigning disc sublists introduces nested_list nodes:

	someglyph.prev = nil
	disc.pre = someglyph
	assert(someglyph.prev.id==node.id"nested_list")

Is this related here? Is the user supposed to take care about 
nested_list nodes (to create them, to destroy them)?

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Wed Dec 23 18:38:00 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 23 Dec 2009 18:38:00 +0100
Subject: [Dev-luatex] order of node linking matters
In-Reply-To: <4B32537F.3050902@gust.org.pl>
References: <4B322B2E.8080100@gust.org.pl> <4B324542.9000301@elvenkind.com>
	<4B32537F.3050902@gust.org.pl>
Message-ID: <4B325578.6090503@wxs.nl>

On 23-12-2009 18:29, Pawe? Jackowski wrote:
> Taco Hoekwater wrote:
>> Pawe? Jackowski wrote:
>>>
>>> someglyph.next = someother
>>> discretionary.pre = someglyph
>>>
>>> is not the same. Why?
>
> Hans:
>> indeed strange ... a quick hack is to use node.copy on b
>
> Copying the node works in that case, thanks.
>
> Taco:
>> Because a discretionary's pre, post, and replace lists are a bit
>> special: internally the discretionary does not just have a next and
>> a prev link for each of the head nodes, but also a 'tail' link.
>> That last one points to the last node in the list for each of
>> the three fields. That extra link is used during hyphenation and
>> at end-of-line situations (those parts of the code would be much
>> more complex == slower without it).
>
> Agh, having the disc.tail link(s) at lua level would simplify processing
> discretionaries a lot! Why you decided not to interface tails?

we had node.slide (for making two way linked node lists) and now also 
have node.tail so you can find the tail if needed

tail = node.tail(n.pre)

> I also noticed that assigning disc sublists introduces nested_list nodes:
>
> someglyph.prev = nil
> disc.pre = someglyph
> assert(someglyph.prev.id==node.id"nested_list")
>
> Is this related here? Is the user supposed to take care about
> nested_list nodes (to create them, to destroy them)?

normally not ; similar effects can occur when messing around with boxes 
(.list) ... it is often best to work with a copy and assign the result 
of messing with the copy ... the speed penalty is neglectable

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Dec 23 19:14:42 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Dec 2009 19:14:42 +0100
Subject: [Dev-luatex] order of node linking matters
In-Reply-To: <4B32537F.3050902@gust.org.pl>
References: <4B322B2E.8080100@gust.org.pl> <4B324542.9000301@elvenkind.com>
	<4B32537F.3050902@gust.org.pl>
Message-ID: <4B325E12.1050704@elvenkind.com>

Pawe? Jackowski wrote:
> Taco Hoekwater wrote:
>> Pawe? Jackowski wrote:
>>>
>>>     someglyph.next = someother
>>>     discretionary.pre = someglyph
>>>
>>> is not the same. Why?
> 
> Hans:
>> indeed strange ... a quick hack is to use node.copy on b 
> 
> Copying the node works in that case, thanks.
> 
> Taco:
>> Because a discretionary's pre, post, and replace lists are a bit
>> special: internally the discretionary does not just have a next and
>> a prev link for each of the head nodes, but also a 'tail' link.
>> That last one points to the last node in the list for each of
>> the three fields. That extra link is used during hyphenation and
>> at end-of-line situations (those parts of the code would be much
>> more complex == slower without it).
> 
> Agh, having the disc.tail link(s) at lua level would simplify processing 
> discretionaries a lot! Why you decided not to interface tails?

Because having them would be even more confusing than not having
them. At least, that was Nanning and my feeling about it.



From preining at logic.at  Wed Dec 23 19:31:31 2009
From: preining at logic.at (Norbert Preining)
Date: Wed, 23 Dec 2009 19:31:31 +0100
Subject: [Dev-luatex] Bug#562176: luatex: FTBFS on hurd-i386:
	unconditional PATH_MAX	usage
In-Reply-To: <20091223131414.19685.66146.reportbug@localhost.localdomain>
References: <20091223131414.19685.66146.reportbug@localhost.localdomain>
Message-ID: <20091223183131.GB32656@gamma.logic.tuwien.ac.at>

Hi Taco, 

Pino (in cc) found that luatex does not build on GNU/Hurd, but some
simple changes does fix that.

You might add that to luatex itself. (patch attached)

Thanks a lot and all the best

Norbert

On Mi, 23 Dez 2009, Pino Toscano wrote:
> Hi,
> 
> currently[1] luatex does not build on GNU/Hurd.
> The problem is the unconditional usage of PATH_MAX.
> The attached patch solves the issue, malloc'ing the buffers as needed.
> It also adds a small bit to "recognize" the GNU platform.
> 
> [1] https://buildd.debian.org/fetch.cgi?pkg=luatex&arch=hurd-i386&ver=0.47.0-1&stamp=1261470395&file=log&as=raw
> 
> Thanks,
> -- 
> Pino


Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
`... then I decided that I was a lemon for a couple of
weeks. I kept myself amused all that time jumping in and
out of a gin and tonic.'
Arthur cleared his throat, and then did it again.
did you...?'
I found a
small lake that thought it was a gin and tonic, and jumped
in and out of that. At least, I think it thought it was a
gin and tonic.'
`I may,' he addded with a grin which would have sent sane
men scampering into the trees, `have been imagining it.'
                 --- Ford updating Arthur about what he's been doing for the
                 --- past four years.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy
-------------- next part --------------
--- a/source/texk/web2c/luatexdir/lua/loslibext.c
+++ b/source/texk/web2c/luatexdir/lua/loslibext.c
@@ -81,6 +81,9 @@
 #  elif defined(__MACH__) && defined(__APPLE__)
 #    undef OS_PLATNAME
 #    define OS_PLATNAME "macosx"
+#  elif defined(__GNU__)
+#    undef OS_PLATNAME
+#    define OS_PLATNAME "gnu"
 #  endif
 #endif
 
@@ -117,7 +120,7 @@
 
 static int exec_command(const char *file, char *const *argv, char *const *envp)
 {
-    char path[PATH_MAX];
+    char *path;
     const char *searchpath, *esp;
     size_t prefixlen, filelen, totallen;
 
@@ -125,6 +128,7 @@
         return execve(file, argv, envp);
 
     filelen = strlen(file);
+    path = NULL;
 
     searchpath = getenv("PATH");
     if (!searchpath)
@@ -141,14 +145,20 @@
 
         if (prefixlen == 0 || searchpath[prefixlen - 1] == '/') {
             totallen = prefixlen + filelen;
+#ifdef PATH_MAX
             if (totallen >= PATH_MAX)
                 continue;
+#endif
+            path = malloc(totallen + 1);
             memcpy(path, searchpath, prefixlen);
             memcpy(path + prefixlen, file, filelen);
         } else {
             totallen = prefixlen + filelen + 1;
+#ifdef PATH_MAX
             if (totallen >= PATH_MAX)
                 continue;
+#endif
+            path = malloc(totallen + 1);
             memcpy(path, searchpath, prefixlen);
             path[prefixlen] = '/';
             memcpy(path + prefixlen + 1, file, filelen);
@@ -156,6 +166,8 @@
         path[totallen] = '\0';
 
         execve(path, argv, envp);
+        free(path);
+        path = NULL;
         if (errno == E2BIG || errno == ENOEXEC ||
             errno == ENOMEM || errno == ETXTBSY)
             break;              /* Report this as an error, no more search */

From hartmut_henkel at gmx.de  Wed Dec 23 20:48:33 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed, 23 Dec 2009 20:48:33 +0100 (CET)
Subject: [Dev-luatex] md5.sum
In-Reply-To: <19249.23081.109317.286553@zaphod.ms25.net>
References: <19247.62960.245638.126943@zaphod.ms25.net>
	<alpine.LNX.2.01.0912211744470.21855@ybpnyubfg.ybpnyqbznva>
	<4B2FFE4F.9020004@wxs.nl>
	<e7fba2610912211529n38317218rb72772407af880ee@mail.gmail.com>
	<alpine.DEB.1.00.0912220057050.6910@hahepc1.hahe>
	<19249.23081.109317.286553@zaphod.ms25.net>
Message-ID: <alpine.DEB.1.00.0912232045580.11461@hahepc1.hahe>

Hi Reinhard,

On Wed, 23 Dec 2009, Reinhard Kotucha wrote:

> Hartmut, did you consider already to inform the Lua developers. I
> think that this problem should be fixed upstream.

no need, i just found that they have already fixed it some time ago (in
the same way). The sources in luatex need to be updated.

Regards, Hartmut

From root at www.metatex.org  Wed Dec 23 22:29:07 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 23 Dec 2009 22:29:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091223212907.1E0E51E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3285 | hhenkel | 2009-12-23 20:37:18 +0100 (Wed, 23 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

more on r3281

------------------------------------------------------------------------

From taco at elvenkind.com  Thu Dec 24 11:11:15 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 24 Dec 2009 11:11:15 +0100
Subject: [Dev-luatex] Bug#562176: luatex: FTBFS on
 hurd-i386:	unconditional PATH_MAX	usage
In-Reply-To: <20091223183131.GB32656@gamma.logic.tuwien.ac.at>
References: <20091223131414.19685.66146.reportbug@localhost.localdomain>
	<20091223183131.GB32656@gamma.logic.tuwien.ac.at>
Message-ID: <4B333E43.4040501@elvenkind.com>


Hi,

Thanks, applied.

Best wishes,
Taco

Norbert Preining wrote:
> Hi Taco, 
> 
> Pino (in cc) found that luatex does not build on GNU/Hurd, but some
> simple changes does fix that.
> 
> You might add that to luatex itself. (patch attached)
> 
> Thanks a lot and all the best
> 
> Norbert
> 
> On Mi, 23 Dez 2009, Pino Toscano wrote:
>> Hi,
>>
>> currently[1] luatex does not build on GNU/Hurd.
>> The problem is the unconditional usage of PATH_MAX.
>> The attached patch solves the issue, malloc'ing the buffers as needed.
>> It also adds a small bit to "recognize" the GNU platform.
>>
>> [1] https://buildd.debian.org/fetch.cgi?pkg=luatex&arch=hurd-i386&ver=0.47.0-1&stamp=1261470395&file=log&as=raw
>>
>> Thanks,
>> -- 
>> Pino
> 
> 
> Best wishes
> 
> Norbert
> ------------------------------------------------------------------------
> Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
> JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
> DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
> ------------------------------------------------------------------------
> `... then I decided that I was a lemon for a couple of
> weeks. I kept myself amused all that time jumping in and
> out of a gin and tonic.'
> Arthur cleared his throat, and then did it again.
> did you...?'
> I found a
> small lake that thought it was a gin and tonic, and jumped
> in and out of that. At least, I think it thought it was a
> gin and tonic.'
> `I may,' he addded with a grin which would have sent sane
> men scampering into the trees, `have been imagining it.'
>                  --- Ford updating Arthur about what he's been doing for the
>                  --- past four years.
>                  --- Douglas Adams, The Hitchhikers Guide to the Galaxy
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex

From preining at logic.at  Thu Dec 24 12:14:10 2009
From: preining at logic.at (Norbert Preining)
Date: Thu, 24 Dec 2009 12:14:10 +0100
Subject: [Dev-luatex] Bug#562176: luatex: FTBFS on
	hurd-i386:	unconditional PATH_MAX usage
In-Reply-To: <4B333E43.4040501@elvenkind.com>
References: <20091223131414.19685.66146.reportbug@localhost.localdomain>
	<20091223183131.GB32656@gamma.logic.tuwien.ac.at>
	<4B333E43.4040501@elvenkind.com>
Message-ID: <20091224111410.GL13482@gamma.logic.tuwien.ac.at>

On Do, 24 Dez 2009, Taco Hoekwater wrote:
> Thanks, applied.

Great, thanks!!! It is good to have such a responsive "upstream"!!!

Best wishes, merry christmas, peaceful days, whatever, and a happy new year

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
NANTWICH (n.)
A late-night snack, invented by the Earl of Nantwich, which consists
of the dampest thing in the fridge, pressed between two of the driest
things in the fridge. The Earl, who lived in a flat in Clapham,
invented the nantwich to avoid having to go shopping.
			--- Douglas Adams, The Meaning of Liff

From root at www.metatex.org  Thu Dec 24 12:29:35 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 24 Dec 2009 12:29:35 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091224112935.68A281E8C3FF@www.metatex.org>

------------------------------------------------------------------------
r3286 | hhenkel | 2009-12-23 22:54:13 +0100 (Wed, 23 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

cosmetics

------------------------------------------------------------------------
r3287 | taco | 2009-12-24 11:01:28 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

add node_list integrity warnings where applicable

------------------------------------------------------------------------
r3288 | taco | 2009-12-24 11:05:46 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c

fix compilation on GNU Hurd

------------------------------------------------------------------------
r3289 | taco | 2009-12-24 11:22:42 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/mplibdir/memio.w
   M /trunk/source/texk/web2c/mplibdir/mp.w
   M /trunk/source/texk/web2c/mplibdir/mpost.w
   M /trunk/source/texk/web2c/mplibdir/mpxout.w
   M /trunk/source/texk/web2c/mplibdir/psout.w
   M /trunk/source/texk/web2c/mplibdir/svgout.w

import metapost 1.209

------------------------------------------------------------------------
r3290 | taco | 2009-12-24 11:32:15 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

fix writeability of the lua pdf table (#310)

------------------------------------------------------------------------

From root at www.metatex.org  Thu Dec 24 16:30:12 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 24 Dec 2009 16:30:12 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091224153012.AF5821E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3291 | hhenkel | 2009-12-24 12:34:29 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

fonts are now just otherresources, no special treatment

------------------------------------------------------------------------
r3292 | hhenkel | 2009-12-24 14:14:56 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

fix segfault due to type mismatch, when writing object

------------------------------------------------------------------------
r3293 | hhenkel | 2009-12-24 14:54:24 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

more typecasts on r3292

------------------------------------------------------------------------
r3294 | hhenkel | 2009-12-24 15:37:58 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

remove now wrong warning

------------------------------------------------------------------------
r3295 | taco | 2009-12-24 15:43:31 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/NEWS
   M /trunk/source/texk/web2c/luatexdir/luatex.c

fix the version numbers and update the NEWS/manual

------------------------------------------------------------------------
r3296 | oneiros | 2009-12-24 15:46:37 +0100 (Thu, 24 Dec 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

fix some type conflicts
still remaining: 84: warning: dereferencing type-punned pointer will break strict-aliasing rules

------------------------------------------------------------------------

From taco at elvenkind.com  Thu Dec 24 17:15:09 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 24 Dec 2009 17:15:09 +0100
Subject: [Dev-luatex] Luatex 0.50.0 announcement
Message-ID: <4B33938D.306@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.50.0.

This release starts a new chain of stable beta's.

New features:

* Fonts now listen also to the 'extend' key in the lua font
  metrics table, and the processing for this is done via de
  pdf text matrix instead of via the font matrix, which means
  it now works for all font types.

* The embedded Metapost library is now at version 1.209.

Dropped features:

* It is no longer possible for fonts from embedded pdf files
  to be replaced by / merged with the document fonts of the
  enveloping pdf. This regression may be temporary, depending
  on how the rewritten font backend will look after beta 0.60.

Bug fixes:

* Use of \middle confused the \mathstyle operation.

* \pdfcolorstack handling was broken.

* node.unset_attribute() had a bug whereby it inverted the
  requested result in some cases (the node on which the unset
  was called was sometimes the only node at the current level
  that *kept* the attribute).

* During font expansion, the internal font copy had one character
  information object less than the original, resulting in the
  disappearance of a glyph in some fonts when font expansion
  was active.

* Placement of operator scripts of OT MATH fonts is adjusted
  to be conformant with Word's logic where the italic correction
  is only used to tuck in the subscript and for nothing else.

* luafontloader.open() no longer writes directly to stderr in
  case of internal font errors.

* Any <pdf_refobj_node>.objnum could not be assigned to.

* The lua 'pdf' table could not be assigned to.

* The lua 'md5' library was returning incorrect results on
  64-bit architectures.

* Luatex now compiles on GNU Hurd systems.

* Fix segfault when embedding stream file object (these
  backend segfaults were a side-effect of the string pool
  patches).

The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.50.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco


From javier at digi21.eu  Thu Dec 24 19:27:12 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Thu, 24 Dec 2009 19:27:12 +0100
Subject: [Dev-luatex] Math sizes & styles
Message-ID: <5088e64f0912241027v1a9dcf74pd76c29ac61de80b7@mail.gmail.com>

Can a math layout like the one of the attached image be obtained with
TeX? I think it is impossible. The size of the fractions is slightly
smaller than that of the main text, and the script sizes for both of
them are the same.

When is it planned to make configurable the hardwired set of math
styles as well as the tree of math style changes, if planned at all?
In this example the changes from the main style to fractions and
scripts would need to be decoupled.

Happy Christmas

Javier A. M?gica
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Teubner-1909.pdf
Type: application/pdf
Size: 17093 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091224/70a7f92e/attachment-0001.pdf>

From pragma at wxs.nl  Thu Dec 24 19:37:30 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 24 Dec 2009 19:37:30 +0100
Subject: [Dev-luatex] Math sizes & styles
In-Reply-To: <5088e64f0912241027v1a9dcf74pd76c29ac61de80b7@mail.gmail.com>
References: <5088e64f0912241027v1a9dcf74pd76c29ac61de80b7@mail.gmail.com>
Message-ID: <4B33B4EA.8040109@wxs.nl>

On 24-12-2009 19:27, Javier M?gica wrote:
> Can a math layout like the one of the attached image be obtained with
> TeX? I think it is impossible. The size of the fractions is slightly
> smaller than that of the main text, and the script sizes for both of
> them are the same.
>
> When is it planned to make configurable the hardwired set of math
> styles as well as the tree of math style changes, if planned at all?
> In this example the changes from the main style to fractions and
> scripts would need to be decoupled.

We had some discussions about that a while ago and reached some general 
conclusions that its should be doable without too much overhead, but 
it's not on the short term agenda. Cleaning up the backend, font 
inclusion code, revisioning the multi-directional typesetting, mplib 2, 
c-webbing the code, and opening up more of the internals come first. We 
waited with some of that till 0.50 was out. In 2010 we focus on 
stability and don't want to introduce too many new things at once. But 
more control over math will happen at some point.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Thu Dec 24 22:34:28 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 24 Dec 2009 22:34:28 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091224213428.81C201E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3297 | taco | 2009-12-24 16:47:32 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

use the proper types for objects whose addresses are passed along.

------------------------------------------------------------------------
r3298 | taco | 2009-12-24 16:54:33 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c

oops, previous commit was garbled

------------------------------------------------------------------------
r3299 | taco | 2009-12-24 16:56:46 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   A /tags/beta-0.50.0 (from /trunk:3298)

release tag

------------------------------------------------------------------------
r3300 | taco | 2009-12-24 19:45:49 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/mplibdir/mpost.w

hot patch for getopt.h from metapost

------------------------------------------------------------------------
r3301 | taco | 2009-12-24 19:48:12 +0100 (Thu, 24 Dec 2009) | 2 lines
Changed paths:
   M /tags/beta-0.50.0/source/texk/web2c/mplibdir/mpost.w

hotfix from metapost (from trunk)

------------------------------------------------------------------------

From root at www.metatex.org  Fri Dec 25 16:29:17 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 25 Dec 2009 16:29:17 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091225152917.32D741E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3302 | oneiros | 2009-12-25 13:49:14 +0100 (Fri, 25 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocplist.h
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.h
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/source/texk/web2c/luatexdir/utils/utils.c

indent

------------------------------------------------------------------------

From preining at logic.at  Fri Dec 25 16:41:58 2009
From: preining at logic.at (Norbert Preining)
Date: Fri, 25 Dec 2009 16:41:58 +0100
Subject: [Dev-luatex] Luatex 0.50.0 announcement
In-Reply-To: <4B33938D.306@elvenkind.com>
References: <4B33938D.306@elvenkind.com>
Message-ID: <20091225154158.GP24732@gamma.logic.tuwien.ac.at>

On Do, 24 Dez 2009, Taco Hoekwater wrote:
> I have just uploaded the archives for a new luatex release, 0.50.0.
> This release starts a new chain of stable beta's.

And it is already in Debian/unstable, so enjoy.

Thanks Taco for all your work.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan            TU Wien, Austria           Debian TeX Task Force
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
The major difference between a thing that might go wrong
and a thing that cannot possibly go wrong is that when a
thing that cannot possibly go wrong goes wrong it usually
turns out to be impossible to get at or repair.
                 --- One of the laws of computers and programming revealed.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy

From root at www.metatex.org  Sat Dec 26 22:30:45 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 26 Dec 2009 22:30:45 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091226213045.0D8781E8C3F6@www.metatex.org>

------------------------------------------------------------------------
r3303 | hhenkel | 2009-12-26 18:32:21 +0100 (Sat, 26 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c

remove spurious '\0' in /Type3 font dictionary

------------------------------------------------------------------------
r3304 | hhenkel | 2009-12-26 21:12:43 +0100 (Sat, 26 Dec 2009) | 9 lines
Changed paths:
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/Page.cc
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/Page.h
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.h
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

pdftoepdf.cc cleanup, needed xpdf-3.02 patching:
* /Metadata in /XForm is now indirect object (was direct/illegal before).
* keep indirect /Resources indirect.
* remove unnecessary initDictFromDict().
* copy objects by type once it's known.
* copy cases are now more uniform.
Currently no automatic /Group is generated by PDF in the enclosing /Page 
dictionary, hope that's ok. for now. No idea what to put into this /Group.

------------------------------------------------------------------------
r3305 | hhenkel | 2009-12-26 21:35:02 +0100 (Sat, 26 Dec 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

/Metadata warning was not ok.

------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Dec 28 12:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 28 Dec 2009 12:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091228112814.E33F240045@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From taco at elvenkind.com  Mon Dec 28 16:08:48 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 28 Dec 2009 16:08:48 +0100
Subject: [Dev-luatex] 'My' context & luatex domains have moved
Message-ID: <4B38CA00.1030609@elvenkind.com>

Hi all,

This regards

   context.aanhet.net
   www.metatex.org
   minimals.metatex.org
   www.luatex.org
   tracker.luatex.org


The sites in mentioned above have moved to a new hosting server,
with IP address 195.12.62.12.

This new server has a better net connection and more disk space,
and besides, the old server is going to be powerless in a few
days anyway.

Apart from the changed IP, everything else should function as
before. I you notive any new weirdnesses, please drop me a message.

Best wishes,
Taco

From root at mail.boekplan.nl  Mon Dec 28 16:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 28 Dec 2009 16:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091228152824.5E9C840048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Mon Dec 28 22:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 28 Dec 2009 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091228212800.0CC4240048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Tue Dec 29 12:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 29 Dec 2009 12:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091229112817.4CC4A40048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Tue Dec 29 16:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 29 Dec 2009 16:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091229152757.2974040048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Tue Dec 29 22:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 29 Dec 2009 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091229212757.4209640048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From H.vanderMeer at uva.nl  Tue Dec 29 22:33:28 2009
From: H.vanderMeer at uva.nl (Hans van der Meer)
Date: Tue, 29 Dec 2009 22:33:28 +0100
Subject: [Dev-luatex] MKIV badly wrong on fonts?
Message-ID: <0A130194-D6FD-4973-B3AD-A7D6B5832C56@uva.nl>

Installed contextbeta just a few hours ago.
Running it on the following code gives me (according to Adobe Reader)  
the fonts TeXGyreSchola-Italic and -Regular:

\usemodule[hvdm-cas]
\usetypescript[schoolbook]\setupbodyfont[schoolbook,10pt]
\starttext
Hello world, I'm {\it some} font!
\page
\stoptext

However, using the code in my hvdm-cas module gives me LMMono and  
LMSans, mirabile dictu!

\usemodule[hvdm-cas]
\usetypescript[schoolbook]\setupbodyfont[schoolbook,10pt]
\starttext
\startcase[state=draft]				% <<<<
Hello world, I'm {\it some} font!
\page
\stopcase					% <<<<
\stoptext

I am fairly sure in the module there are no font setups (see the  
module in the accompanying zip). What it does, is putting things in  
framed's within framed's and so. But that shouldn't influence the  
typesetting of fonts!
Could it be that there is something terrible wrong here in context?
I might add that in the older context, I did not encounter this "loss  
of font".

-------------- next part --------------
A non-text attachment was scrubbed...
Name: hvdm-cas.tex.zip
Type: application/zip
Size: 6887 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091229/c112a335/attachment.zip>
-------------- next part --------------



Hans van der Meer





From pragma at wxs.nl  Tue Dec 29 22:38:01 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 29 Dec 2009 22:38:01 +0100
Subject: [Dev-luatex] MKIV badly wrong on fonts?
In-Reply-To: <0A130194-D6FD-4973-B3AD-A7D6B5832C56@uva.nl>
References: <0A130194-D6FD-4973-B3AD-A7D6B5832C56@uva.nl>
Message-ID: <4B3A76B9.6090203@wxs.nl>

Hi

forwarded to the context list, as it is not related to luatex dev

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at mail.boekplan.nl  Wed Dec 30 12:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 30 Dec 2009 12:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091230112819.150DF40048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Wed Dec 30 16:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 30 Dec 2009 16:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091230152803.1DC3640048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Wed Dec 30 22:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 30 Dec 2009 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091230212758.399B340048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Thu Dec 31 12:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 31 Dec 2009 12:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091231112827.A8C6040048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Thu Dec 31 16:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 31 Dec 2009 16:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091231152758.4391F40048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From vafa at users.berlios.de  Thu Dec 31 17:06:54 2009
From: vafa at users.berlios.de (Vafa Khalighi)
Date: Fri, 1 Jan 2010 03:06:54 +1100
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091231152758.4391F40048@mail.boekplan.nl>
References: <20091231152758.4391F40048@mail.boekplan.nl>
Message-ID: <b5215f00912310806w7f75ddc2x69c7bba051262d27@mail.gmail.com>

On Fri, Jan 1, 2010 at 2:25 AM, Cron Daemon <root at mail.boekplan.nl> wrote:

> svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect
> to server (http://foundry.supelec.fr)
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex
>

This is getting annoying!

-- 
Best wishes,
Vafa Khalighi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20100101/42284e5d/attachment.html>

From taco at elvenkind.com  Thu Dec 31 17:16:48 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 31 Dec 2009 17:16:48 +0100
Subject: [Dev-luatex] Cron
	<luatex@boekplan>	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <b5215f00912310806w7f75ddc2x69c7bba051262d27@mail.gmail.com>
References: <20091231152758.4391F40048@mail.boekplan.nl>
	<b5215f00912310806w7f75ddc2x69c7bba051262d27@mail.gmail.com>
Message-ID: <4B3CCE70.4040600@elvenkind.com>

Vafa Khalighi wrote:
> On Fri, Jan 1, 2010 at 2:25 AM, Cron Daemon <root at mail.boekplan.nl> wrote:
> 
>> svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect
>> to server (http://foundry.supelec.fr)

Well, the server is down (that much should be obvious). These messages
will stop as soon as it comes online again.

Best wishes,
Taco

From root at mail.boekplan.nl  Thu Dec 31 22:25:10 2009
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 31 Dec 2009 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091231212757.95E8140048@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

