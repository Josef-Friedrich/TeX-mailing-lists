From reinhard.kotucha at web.de  Sun Nov  1 04:22:55 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 1 Nov 2009 04:22:55 +0100
Subject: [Dev-luatex] kpse.find_file
Message-ID: <19180.65295.726241.57317@zaphod.ms25.net>

Hi,
I just fixed some nasty bugs in texlua wrappers for ppower4 and
pdfthumb which are under texmf-dist/scripts in TeX Live.

There are no problems on Windows:  When I type "ppower4 --help", I get

  PPower4 [-v|-n|-h|-V|--verbose=<n>|--nocompress|--help|--version] infile outfile

On Unix, however, I get a warning message:

  warning: kpathsea: configuration file texmf.cnf not found in these directories: [...]

Here is [...] with colons replaced my linebraeks:

  /usr/local/texlive/2009/texmf-dist/scripts/ppower4
  /usr/local/texlive/2009/texmf-dist/scripts
  /usr/local/texlive/2009/texmf-dist
  /usr/local/texlive/2009/texmf-dist/scripts/ppower4/share/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/share/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/share/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/ppower4/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/texmf-local/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/ppower4/share/texmf/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/share/texmf/web2c
  /usr/local/texlive/2009/texmf-dist/share/texmf/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/ppower4/texmf/web2c
  /usr/local/texlive/2009/texmf-dist/scripts/texmf/web2c
  /usr/local/texlive/2009/texmf-dist/texmf/web2c

...and pp4p.jar is obviously not found, Java then prints its own usage
message.

It seems that texmf.cnf is searched in texmf-dist only, but how can
this happen?  Strange enough, everything works fine on Windows.

I can strip down the texlua script:
------------------------------------------------------------------
#!/usr/bin/env texlua

if os.type == 'windows' then
   kpse.set_program_name('ppower4.exe', 'ppower4')
else 
   kpse.set_program_name('ppower4')
end

jarfile=kpse.find_file('pp4p.jar', 'texmfscripts')

print (jarfile)
------------------------------------------------------------------

On Windows it returns /path/to/pp4p.jar, on Unix it returns "nil".

The command

  kpsewhich -format=texmfscripts pp4p.jar

returns the correct path on both, Unix and Windows.  Hence, I think
it's a LuaTeX problem.
 
I don't think that fixing this problem is urgent.  It's definitely not
worthwhile to delay a TeX Live release.

Karl, I can provide a simple solution for the time being: Because what
we have in TeX Live already works as expected on Windows, we only need
a solution for Unix.  I could simply copy the shell scripts we had in
TeX Live 2005 to texmf-dist/scripts/ppower4 and adapt the symlinks
accordingly.  Then everything works on all platforms.  What do you
think?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Sun Nov  1 08:28:33 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 01 Nov 2009 08:28:33 +0100
Subject: [Dev-luatex] kpse.find_file
In-Reply-To: <19180.65295.726241.57317@zaphod.ms25.net>
References: <19180.65295.726241.57317@zaphod.ms25.net>
Message-ID: <4AED38A1.20703@elvenkind.com>


Hi Reinhard,

You can debug the kpathsea in texlua just like you would a standalone
script by setting KPATHSEA_DEBUG=-1 in the environment before running
the script, perhaps that will help.

Reinhard Kotucha wrote:
> 
> I can strip down the texlua script:
> ------------------------------------------------------------------
> #!/usr/bin/env texlua
> 
> if os.type == 'windows' then
>    kpse.set_program_name('ppower4.exe', 'ppower4')
> else 
>    kpse.set_program_name('ppower4')

Also, have you tried

      kpse.set_program_name('ppower4', 'ppower4')

> The command
> 
>   kpsewhich -format=texmfscripts pp4p.jar
> 
> returns the correct path on both, Unix and Windows.  Hence, I think
> it's a LuaTeX problem.

Or you could try to set the program name to 'kpsewhich' (that is what
I usually do in standalone scripts).

The wrapper luatex provides around kpathsea is really shallow, so
I am just as surprised by this problem as you are.

Best wishes,
Taco

From mpg at elzevir.fr  Sun Nov  1 10:09:14 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 01 Nov 2009 10:09:14 +0100
Subject: [Dev-luatex] kpse.find_file
In-Reply-To: <19180.65295.726241.57317@zaphod.ms25.net>
References: <19180.65295.726241.57317@zaphod.ms25.net>
Message-ID: <4AED503A.8000103@elzevir.fr>

Hi Reinhard,

Reinhard Kotucha a ?crit :
>    kpse.set_program_name('ppower4')

The problem is that kpse resolves symlinks before computing SELFAUTO*
(which is what you want in most cases). So SELFAUTOLOC ends up being
texmf-dist/scripts/ppoxer4 which obviously gives the wrong result.

A general approach to this is to use

kpse.set_program_name(arg[-1], 'ppower4')

which works on all platforms (I'm using it in texdoc and never got any
complaint).  As you probably know, arg[-1] is the name of the Lua
interpreter used for the current script, which gives good results for
computing SELFAUTO*. I guess that's the whole purpose of the
two-arguments form of kpse.set_program_name.

(Btw, at some point there was a bug in kpse so that the first argument
was ignored on GNU platforms and SELFAUTO* set to "correct" values even
if the argument was "wrong" on platform using the GNU libc. So this kind
of problem was hidden on, eg Linux, when this bug was present. After the
bug was fixed, I looked a bit for othe occurences in TeX Live, but
apparently I missed some of them.)

Manuel.

From root at www.metatex.org  Sun Nov  1 12:30:26 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun,  1 Nov 2009 12:30:26 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091101113026.734E81E8C3F8@www.metatex.org>

------------------------------------------------------------------------
r3091 | oneiros | 2009-11-01 01:32:36 +0100 (Sun, 01 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettf.c

unnest some externs

------------------------------------------------------------------------

From khaledhosny at eglug.org  Sun Nov  1 14:00:25 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Nov 2009 15:00:25 +0200
Subject: [Dev-luatex] Luatex 0.44.0 announcement
In-Reply-To: <4AEA9D96.20007@elvenkind.com>
References: <4AE6D421.5090105@elvenkind.com>
	<20091029145259.GA27671@khaled-laptop>
	<4AEA9D96.20007@elvenkind.com>
Message-ID: <20091101130025.GA8814@khaled-laptop>

On Fri, Oct 30, 2009 at 09:02:30AM +0100, Taco Hoekwater wrote:
> 
> Hi,
> 
> Khaled Hosny wrote:
> > On Tue, Oct 27, 2009 at 12:06:09PM +0100, Taco Hoekwater wrote:
> >> * Math delimiters and large operators in new MATH fonts no
> >>   longer apply the italic correction (this fixes placements
> >>   of super- and subscripts on such items for those fonts).
> > 
> > This doesn't sound the correct way to me. The described algorithm in
> > MATH specification is to set subscripts immediately after the base
> > (without italic correction) and shift superscripts horizontally by the
> > amount of italic correction, then apply math kerning if present, this
> > way fonts with no math kerning will still give acceptable output and
> > need for math kerning will be minimized.
> 
> Well, I am clearly doing something wrong, because both the old and
> new outputs look crappy. I'll rethink this.

Office 2007 seems to handle sub/superscripts of big operators
differently; superscript is placed immediately after base glyph while a
negative kern equal to italic correction is inserted between base and
subscript i.e. the reverse of what is described in the spec, and math
kerning is ignored completely.
So I think the current positioning of superscripts is correct, only
subscripts need to be fixed, though I'm not really sure about any of
those conclusions :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091101/225a7e11/attachment.pgp>

From t34www at googlemail.com  Sun Nov  1 21:11:11 2009
From: t34www at googlemail.com (T T)
Date: Sun, 1 Nov 2009 20:11:11 +0000
Subject: [Dev-luatex] echoing system call argument to stderr
Message-ID: <e7fba2610911011211w39d3824dud58416c1d8d95498@mail.gmail.com>

Hi,

I've noticed that os.execute under texlua echos its argument to
stderr. This is not the behaviour under the standard lua interpreter.
Is it a bug or feature (and what would be the reason for it)?

Cheers,

Tomek

From mpg at elzevir.fr  Sun Nov  1 22:02:45 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 01 Nov 2009 22:02:45 +0100
Subject: [Dev-luatex] echoing system call argument to stderr
In-Reply-To: <e7fba2610911011211w39d3824dud58416c1d8d95498@mail.gmail.com>
References: <e7fba2610911011211w39d3824dud58416c1d8d95498@mail.gmail.com>
Message-ID: <4AEDF775.90905@elzevir.fr>

Hi,

T T a ?crit :
> I've noticed that os.execute under texlua echos its argument to
> stderr. This is not the behaviour under the standard lua interpreter.
> Is it a bug or feature (and what would be the reason for it)?
> 
Which version of texlua? I don't observe this behaviour with texlua
0.40.6 from TL09 under x86-64-linux (nor with previous versions).

Manuel.

From reinhard.kotucha at web.de  Sun Nov  1 22:03:37 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 1 Nov 2009 22:03:37 +0100
Subject: [Dev-luatex] kpse.find_file
In-Reply-To: <4AED503A.8000103@elzevir.fr>
References: <19180.65295.726241.57317@zaphod.ms25.net>
	<4AED503A.8000103@elzevir.fr>
Message-ID: <19181.63401.564361.794890@zaphod.ms25.net>

On 1 November 2009 Manuel P?gouri?-Gonnard wrote:

 > Hi Reinhard,
 > 
 > Reinhard Kotucha a ?crit :
 > >    kpse.set_program_name('ppower4')
 > 
 > The problem is that kpse resolves symlinks before computing SELFAUTO*
 > (which is what you want in most cases). So SELFAUTOLOC ends up being
 > texmf-dist/scripts/ppoxer4 which obviously gives the wrong result.
 >
 > A general approach to this is to use
 > 
 > kpse.set_program_name(arg[-1], 'ppower4')
 > 
 > which works on all platforms (I'm using it in texdoc and never got any
 > complaint).  As you probably know, arg[-1] is the name of the Lua
 > interpreter used for the current script, which gives good results for
 > computing SELFAUTO*. I guess that's the whole purpose of the
 > two-arguments form of kpse.set_program_name.

Hi Manuel,
thank you very much for the explanation.  Yes, it's a very good
solution, maybe the best. I fixed it this way.
 
 > (Btw, at some point there was a bug in kpse so that the first argument
 > was ignored on GNU platforms and SELFAUTO* set to "correct" values even
 > if the argument was "wrong" on platform using the GNU libc. So this kind
 > of problem was hidden on, eg Linux, when this bug was present. After the
 > bug was fixed, I looked a bit for othe occurences in TeX Live, but
 > apparently I missed some of them.)

When I checked the stuff in texmf/scripts, I obviously didn't remember
that ppower4 was moved to texmf-dist/scripts.  Maybe you overlooked it
for the same reason.

Regards, and thanks again,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From t34www at googlemail.com  Sun Nov  1 23:11:58 2009
From: t34www at googlemail.com (T T)
Date: Sun, 1 Nov 2009 22:11:58 +0000
Subject: [Dev-luatex] echoing system call argument to stderr
In-Reply-To: <4AEDF775.90905@elzevir.fr>
References: <e7fba2610911011211w39d3824dud58416c1d8d95498@mail.gmail.com>
	<4AEDF775.90905@elzevir.fr>
Message-ID: <e7fba2610911011411g5f0fb864jd0a08bf2c25c8cb1@mail.gmail.com>

2009/11/1 Manuel P?gouri?-Gonnard <mpg at elzevir.fr>:
> Hi,
>
> T T a ?crit :
>> I've noticed that os.execute under texlua echos its argument to
>> stderr. This is not the behaviour under the standard lua interpreter.
>> Is it a bug or feature (and what would be the reason for it)?
>>
> Which version of texlua? I don't observe this behaviour with texlua
> 0.40.6 from TL09 under x86-64-linux (nor with previous versions).

Version 0.40.6-2009103121 but maybe older ones as well. Perhaps it's
only win32. In that case CC Akira.

Cheers,

Tomek

From kakuto at fuk.kindai.ac.jp  Mon Nov  2 03:27:25 2009
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Mon, 02 Nov 2009 11:27:25 +0900
Subject: [Dev-luatex] echoing system call argument to stderr
In-Reply-To: <e7fba2610911011411g5f0fb864jd0a08bf2c25c8cb1@mail.gmail.com>
References: <e7fba2610911011411g5f0fb864jd0a08bf2c25c8cb1@mail.gmail.com>
Message-ID: <125712884643853100006a7b@sniffer>

Hi Tomek,

> >> I've noticed that os.execute under texlua echos its argument to
> >> stderr. This is not the behaviour under the standard lua interpreter.
> >> Is it a bug or feature (and what would be the reason for it)?
> >>
> > Which version of texlua? I don't observe this behaviour with texlua
> > 0.40.6 from TL09 under x86-64-linux (nor with previous versions).
> 
> Version 0.40.6-2009103121 but maybe older ones as well. Perhaps it's
> only win32. In that case CC Akira.

Please update the kpathsea dll to the latest version.
In some version, I fogot to erase a line
for debugging purpose.


From taco at elvenkind.com  Mon Nov  2 08:36:21 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Nov 2009 08:36:21 +0100
Subject: [Dev-luatex] Luatex 0.44.0 announcement
In-Reply-To: <20091101130025.GA8814@khaled-laptop>
References: <4AE6D421.5090105@elvenkind.com>
	<20091029145259.GA27671@khaled-laptop>
	<4AEA9D96.20007@elvenkind.com>
	<20091101130025.GA8814@khaled-laptop>
Message-ID: <4AEE8BF5.2040903@elvenkind.com>



Khaled Hosny wrote:
> 
> Office 2007 seems to handle sub/superscripts of big operators
> differently; superscript is placed immediately after base glyph while a
> negative kern equal to italic correction is inserted between base and
> subscript i.e. the reverse of what is described in the spec, and math
> kerning is ignored completely.

Big sigh. I'll see if I can get my hands on a copy of Word2009.

Best wishes,
Taco

From c.a.rowley at open.ac.uk  Mon Nov  2 13:09:32 2009
From: c.a.rowley at open.ac.uk (c.a.rowley at open.ac.uk)
Date: Mon, 2 Nov 2009 12:09:32 +0000
Subject: [Dev-luatex] Warning re comparing Word and TeX
In-Reply-To: <mailman.3.1257159602.8355.dev-luatex@ntg.nl>
References: <mailman.3.1257159602.8355.dev-luatex@ntg.nl>
Message-ID: <OFD47227F3.8812F7F8-ON80257662.0042CAA4-80257662.0042CAB0@mcs-notes1.open.ac.uk>

Hi guys

Do not forget that Word etc have a different model for microtypography and how they treat font metrics and 'normal horizontal stacking' of glyph sequences.  

The big difference that has a major effect on how math layout is acheived is that they do not use the concept of nested boxes: everything is simply 'positioned glyphs'.

There are other important differences but they are not so likely to affect math typesetting.

If you get Windows 2010, I think that all the math stuff is available 'at the OS level' which I think means that it is also all in an Active-X control for developers use.  But probably with zero documentattion!

Finally, if you want to know about their algorithm, just ask them!
Although they may reply, as I would about details like that, 'we have forgotten'.

Cheers,  chris

>
> Office 2007 seems to handle sub/superscripts of big operators
> differently; superscript is placed immediately after base glyph while a
> negative kern equal to italic correction is inserted between base and
> subscript i.e. the reverse of what is described in the spec, and math
> kerning is ignored completely.

Big sigh. I'll see if I can get my hands on a copy of Word2009.

Best wishes,
Taco


-----dev-luatex-bounces at ntg.nl wrote: -----

To: dev-luatex at ntg.nl
From: dev-luatex-request at ntg.nl
Sent by: dev-luatex-bounces at ntg.nl
Date: 02/11/2009 11:00
Subject: dev-luatex Digest, Vol 46, Issue 2

Send dev-luatex mailing list submissions to
????	dev-luatex at ntg.nl

To subscribe or unsubscribe via the World Wide Web, visit
????	http://www.ntg.nl/mailman/listinfo/dev-luatex
or, via email, send a message with subject or body 'help' to
????	dev-luatex-request at ntg.nl

You can reach the person managing the list at
????	dev-luatex-owner at ntg.nl

When replying, please edit your Subject line so it is more specific
than "Re: Contents of dev-luatex digest..."


Today's Topics:

?? 1. Re: Luatex 0.44.0 announcement (Khaled Hosny)
?? 2. echoing system call argument to stderr (T T)
?? 3. Re: echoing system call argument to stderr
?? ? ?(Manuel P?gouri?-Gonnard)
?? 4. Re: kpse.find_file (Reinhard Kotucha)
?? 5. Re: echoing system call argument to stderr (T T)
?? 6. Re: echoing system call argument to stderr (Akira Kakuto)
?? 7. Re: Luatex 0.44.0 announcement (Taco Hoekwater)


----------------------------------------------------------------------

Message: 1
Date: Sun, 1 Nov 2009 15:00:25 +0200
From: Khaled Hosny <khaledhosny at eglug.org>
To: Taco Hoekwater <taco at elvenkind.com>
Cc: luatex development list <dev-luatex at ntg.nl>
Subject: Re: [Dev-luatex] Luatex 0.44.0 announcement
Message-ID: <20091101130025.GA8814 at khaled-laptop>
Content-Type: text/plain; charset="utf-8"

On Fri, Oct 30, 2009 at 09:02:30AM +0100, Taco Hoekwater wrote:
> 
> Hi,
> 
> Khaled Hosny wrote:
> > On Tue, Oct 27, 2009 at 12:06:09PM +0100, Taco Hoekwater wrote:
> >> * Math delimiters and large operators in new MATH fonts no
> >> ? longer apply the italic correction (this fixes placements
> >> ? of super- and subscripts on such items for those fonts).
> > 
> > This doesn't sound the correct way to me. The described algorithm in
> > MATH specification is to set subscripts immediately after the base
> > (without italic correction) and shift superscripts horizontally by the
> > amount of italic correction, then apply math kerning if present, this
> > way fonts with no math kerning will still give acceptable output and
> > need for math kerning will be minimized.
> 
> Well, I am clearly doing something wrong, because both the old and
> new outputs look crappy. I'll rethink this.

Office 2007 seems to handle sub/superscripts of big operators
differently; superscript is placed immediately after base glyph while a
negative kern equal to italic correction is inserted between base and
subscript i.e. the reverse of what is described in the spec, and math
kerning is ignored completely.
So I think the current positioning of superscripts is correct, only
subscripts need to be fixed, though I'm not really sure about any of
those conclusions :)

Regards,
?Khaled

-- 
?Khaled Hosny
?Arabic localiser and member of Arabeyes.org team
?Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091101/225a7e11/attachment-0001.pgp>

------------------------------

Message: 2
Date: Sun, 1 Nov 2009 20:11:11 +0000
From: T T <t34www at googlemail.com>
To: luatex development list <dev-luatex at ntg.nl>
Subject: [Dev-luatex] echoing system call argument to stderr
Message-ID:
????	<e7fba2610911011211w39d3824dud58416c1d8d95498 at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi,

I've noticed that os.execute under texlua echos its argument to
stderr. This is not the behaviour under the standard lua interpreter.
Is it a bug or feature (and what would be the reason for it)?

Cheers,

Tomek


------------------------------

Message: 3
Date: Sun, 01 Nov 2009 22:02:45 +0100
From: Manuel P?gouri?-Gonnard <mpg at elzevir.fr>
To: T T <t34www at googlemail.com>
Cc: luatex development list <dev-luatex at ntg.nl>
Subject: Re: [Dev-luatex] echoing system call argument to stderr
Message-ID: <4AEDF775.90905 at elzevir.fr>
Content-Type: text/plain; charset=ISO-8859-1

Hi,

T T a ?crit :
> I've noticed that os.execute under texlua echos its argument to
> stderr. This is not the behaviour under the standard lua interpreter.
> Is it a bug or feature (and what would be the reason for it)?
> 
Which version of texlua? I don't observe this behaviour with texlua
0.40.6 from TL09 under x86-64-linux (nor with previous versions).

Manuel.


------------------------------

Message: 4
Date: Sun, 1 Nov 2009 22:03:37 +0100
From: Reinhard Kotucha <reinhard.kotucha at web.de>
To: Manuel P?gouri?-Gonnard <mpg at elzevir.fr>
Cc: tldev at tug.org, dev-luatex at ntg.nl
Subject: Re: [Dev-luatex] kpse.find_file
Message-ID: <19181.63401.564361.794890 at zaphod.ms25.net>
Content-Type: text/plain; charset=iso-8859-1

On 1 November 2009 Manuel P?gouri?-Gonnard wrote:

?> Hi Reinhard,
?> 
?> Reinhard Kotucha a ?crit :
?> > ? ?kpse.set_program_name('ppower4')
?> 
?> The problem is that kpse resolves symlinks before computing SELFAUTO*
?> (which is what you want in most cases). So SELFAUTOLOC ends up being
?> texmf-dist/scripts/ppoxer4 which obviously gives the wrong result.
?>
?> A general approach to this is to use
?> 
?> kpse.set_program_name(arg[-1], 'ppower4')
?> 
?> which works on all platforms (I'm using it in texdoc and never got any
?> complaint). ?As you probably know, arg[-1] is the name of the Lua
?> interpreter used for the current script, which gives good results for
?> computing SELFAUTO*. I guess that's the whole purpose of the
?> two-arguments form of kpse.set_program_name.

Hi Manuel,
thank you very much for the explanation. ?Yes, it's a very good
solution, maybe the best. I fixed it this way.
?
?> (Btw, at some point there was a bug in kpse so that the first argument
?> was ignored on GNU platforms and SELFAUTO* set to "correct" values even
?> if the argument was "wrong" on platform using the GNU libc. So this kind
?> of problem was hidden on, eg Linux, when this bug was present. After the
?> bug was fixed, I looked a bit for othe occurences in TeX Live, but
?> apparently I missed some of them.)

When I checked the stuff in texmf/scripts, I obviously didn't remember
that ppower4 was moved to texmf-dist/scripts. ?Maybe you overlooked it
for the same reason.

Regards, and thanks again,
??Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha????	????	????	 ? ? ? ? ? ? ?Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover????	 ? ? ? ? ? ? ? ? ? ? ?mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


------------------------------

Message: 5
Date: Sun, 1 Nov 2009 22:11:58 +0000
From: T T <t34www at googlemail.com>
To: Manuel P?gouri?-Gonnard <mpg at elzevir.fr>
Cc: luatex development list <dev-luatex at ntg.nl>,????	Akira Kakuto
????	<kakuto at fuk.kindai.ac.jp>
Subject: Re: [Dev-luatex] echoing system call argument to stderr
Message-ID:
????	<e7fba2610911011411g5f0fb864jd0a08bf2c25c8cb1 at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

2009/11/1 Manuel P?gouri?-Gonnard <mpg at elzevir.fr>:
> Hi,
>
> T T a ?crit :
>> I've noticed that os.execute under texlua echos its argument to
>> stderr. This is not the behaviour under the standard lua interpreter.
>> Is it a bug or feature (and what would be the reason for it)?
>>
> Which version of texlua? I don't observe this behaviour with texlua
> 0.40.6 from TL09 under x86-64-linux (nor with previous versions).

Version 0.40.6-2009103121 but maybe older ones as well. Perhaps it's
only win32. In that case CC Akira.

Cheers,

Tomek


------------------------------

Message: 6
Date: Mon, 02 Nov 2009 11:27:25 +0900
From: "Akira Kakuto" <kakuto at fuk.kindai.ac.jp>
To: T T <t34www at googlemail.com>
Cc: Manuel_P?ouri?Gonnard ????	<mpg at elzevir.fr>, luatex development list
????	<dev-luatex at ntg.nl>
Subject: Re: [Dev-luatex] echoing system call argument to stderr
Message-ID: <125712884643853100006a7b at sniffer>
Content-Type: text/plain; charset=iso-2022-jp

Hi Tomek,

> >> I've noticed that os.execute under texlua echos its argument to
> >> stderr. This is not the behaviour under the standard lua interpreter.
> >> Is it a bug or feature (and what would be the reason for it)?
> >>
> > Which version of texlua? I don't observe this behaviour with texlua
> > 0.40.6 from TL09 under x86-64-linux (nor with previous versions).
> 
> Version 0.40.6-2009103121 but maybe older ones as well. Perhaps it's
> only win32. In that case CC Akira.

Please update the kpathsea dll to the latest version.
In some version, I fogot to erase a line
for debugging purpose.



------------------------------

Message: 7
Date: Mon, 02 Nov 2009 08:36:21 +0100
From: Taco Hoekwater <taco at elvenkind.com>
To: Khaled Hosny <khaledhosny at eglug.org>
Cc: luatex development list <dev-luatex at ntg.nl>
Subject: Re: [Dev-luatex] Luatex 0.44.0 announcement
Message-ID: <4AEE8BF5.2040903 at elvenkind.com>
Content-Type: text/plain; charset=UTF-8



Khaled Hosny wrote:
> 
> Office 2007 seems to handle sub/superscripts of big operators
> differently; superscript is placed immediately after base glyph while a
> negative kern equal to italic correction is inserted between base and
> subscript i.e. the reverse of what is described in the spec, and math
> kerning is ignored completely.

Big sigh. I'll see if I can get my hands on a copy of Word2009.

Best wishes,
Taco


------------------------------

_______________________________________________
dev-luatex mailing list
dev-luatex at ntg.nl
http://www.ntg.nl/mailman/listinfo/dev-luatex


End of dev-luatex Digest, Vol 46, Issue 2
*****************************************

---------------------------------------------------------------------------
The Open University is incorporated by Royal Charter (RC 000391), an exempt charity in England & Wales and a charity registered in Scotland (SC 038302)

From root at www.metatex.org  Mon Nov  2 22:28:46 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  2 Nov 2009 22:28:46 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091102212846.C5D4D1E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3092 | pawel | 2009-11-02 16:34:54 +0100 (Mon, 02 Nov 2009) | 1 line
Changed paths:
   M /trunk/manual/luatexref-t.tex

a short note about \pdfxformattr and \pdfxformresources (and my first commit test)
------------------------------------------------------------------------
r3093 | pawel | 2009-11-02 16:54:20 +0100 (Mon, 02 Nov 2009) | 1 line
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/tex/commands.c
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.h

\pdfxformresources \pdfxformattr toks lists added
------------------------------------------------------------------------

From root at www.metatex.org  Tue Nov  3 16:28:39 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  3 Nov 2009 16:28:39 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091103152839.81A411E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3094 | taco | 2009-11-03 12:01:35 +0100 (Tue, 03 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c

Add full font inclusion support for ttf/ttc fonts

------------------------------------------------------------------------

From root at www.metatex.org  Tue Nov  3 22:29:15 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  3 Nov 2009 22:29:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091103212915.14B691E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3095 | taco | 2009-11-03 15:41:38 +0100 (Tue, 03 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

Add support for braced filenames in \input and \openin|\openout

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov  4 12:30:55 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  4 Nov 2009 12:30:55 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091104113055.A38121E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3096 | taco | 2009-11-04 10:13:15 +0100 (Wed, 04 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c

allow \endlinechar to be between 0 and 127

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov  4 16:28:46 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  4 Nov 2009 16:28:46 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091104152846.C78411E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3097 | taco | 2009-11-04 14:49:01 +0100 (Wed, 04 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c

use kpathsea for lua's require() unless explicitly disabled by the user

------------------------------------------------------------------------
r3098 | taco | 2009-11-04 14:56:01 +0100 (Wed, 04 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

updated manual for require() change (and version bump)

------------------------------------------------------------------------
r3099 | taco | 2009-11-04 14:57:22 +0100 (Wed, 04 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luatex.c

bump the version

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov  4 22:28:31 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  4 Nov 2009 22:28:31 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091104212831.AB1FB1E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3100 | taco | 2009-11-04 16:09:57 +0100 (Wed, 04 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/tex/align.h
   M /trunk/source/texk/web2c/luatexdir/tex/commands.c
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.c

implement \aligntab and \alignmark aliases

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov  5 16:28:37 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  5 Nov 2009 16:28:37 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091105152837.05A931E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3101 | taco | 2009-11-05 13:39:00 +0100 (Thu, 05 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/psread.c

queeze out some more speed in SplineCharsToBB

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov  5 22:28:34 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  5 Nov 2009 22:28:34 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091105212834.D34D91E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3102 | taco | 2009-11-05 20:27:16 +0100 (Thu, 05 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettf.c

drop unused code block

------------------------------------------------------------------------
r3103 | taco | 2009-11-05 20:32:37 +0100 (Thu, 05 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/psread.c

remove two (harmless) compiler warnings

------------------------------------------------------------------------
r3104 | taco | 2009-11-05 20:41:48 +0100 (Thu, 05 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/src/luafflib.c

speed up fontloader.to_table for cid fonts (by skipping holes in the glyph table)

------------------------------------------------------------------------

From root at www.metatex.org  Fri Nov  6 22:28:22 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  6 Nov 2009 22:28:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091106212822.B28D01E8C410@www.metatex.org>

------------------------------------------------------------------------
r3105 | taco | 2009-11-06 16:48:11 +0100 (Fri, 06 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/configure
   M /trunk/source/libs/libpng/Makefile.in
   M /trunk/source/libs/libpng/aclocal.m4
   M /trunk/source/libs/libpng/configure
   M /trunk/source/m4/kpse-common.m4
   M /trunk/source/texk/kpathsea/c-auto.in
   M /trunk/source/texk/kpathsea/configure
   M /trunk/source/texk/web2c/c-auto.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/web2c/configure
   M /trunk/source/texk/web2c/web2c/native/kpathsea/c-auto.in

Add tests for mktemp() and mkstemp() to kpse-common.m4
(rest of the commit is autoreconf output)

------------------------------------------------------------------------

From root at www.metatex.org  Sun Nov  8 16:28:22 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun,  8 Nov 2009 16:28:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091108152822.4B8FB1E8C408@www.metatex.org>

------------------------------------------------------------------------
r3106 | hhenkel | 2009-11-08 13:04:04 +0100 (Sun, 08 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.h
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

simplify xform parameter handling

------------------------------------------------------------------------
r3107 | hhenkel | 2009-11-08 14:26:40 +0100 (Sun, 08 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pagetree.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h

flatten print_pdf_pages_attr()

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov  9 12:30:23 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  9 Nov 2009 12:30:23 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091109113023.899731E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3108 | taco | 2009-11-09 09:01:54 +0100 (Mon, 09 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document new boundingbox discovery code

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov  9 16:28:29 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  9 Nov 2009 16:28:29 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091109152829.8E7DC1E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3109 | taco | 2009-11-09 13:13:27 +0100 (Mon, 09 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c

partially revert #3097: now only use kpse when kpathsea is actually
initialized, either by luatex as part of the normal startup, or
 by kpse.set_program_name() in the case of texlua.

------------------------------------------------------------------------
r3110 | taco | 2009-11-09 13:23:31 +0100 (Mon, 09 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document #3109

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov  9 22:28:49 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  9 Nov 2009 22:28:49 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091109212849.1AC5B1E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3111 | taco | 2009-11-09 16:20:03 +0100 (Mon, 09 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c

fix the node.find_dimensions lua function

------------------------------------------------------------------------
r3112 | taco | 2009-11-09 17:16:10 +0100 (Mon, 09 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/subfont.c
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c
   M /trunk/source/texk/web2c/luatexdir/font/writettf.c
   M /trunk/source/texk/web2c/luatexdir/font/writettf.h
   M /trunk/source/texk/web2c/luatexdir/font/writetype0.c
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h

attempt to get rid of nameoffile: font backend

------------------------------------------------------------------------
r3113 | hhenkel | 2009-11-09 20:06:03 +0100 (Mon, 09 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.h
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.h
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.h

\pdfrefximage [width <dimen>] [height <dimen>] [depth <dimen>] <imageref>
overrules settings from \pdfximage for this \pdfrefximage call only

------------------------------------------------------------------------
r3114 | oneiros | 2009-11-09 20:34:01 +0100 (Mon, 09 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.h
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c

add a missing export
rm unused variable

------------------------------------------------------------------------
r3115 | hhenkel | 2009-11-09 20:57:47 +0100 (Mon, 09 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

\pdfrefximage manual text

------------------------------------------------------------------------

From root at www.metatex.org  Tue Nov 10 12:30:00 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 10 Nov 2009 12:30:00 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091110113000.8A6AB1E8C40B@www.metatex.org>

------------------------------------------------------------------------
r3116 | taco | 2009-11-10 09:06:58 +0100 (Tue, 10 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h

attempt to get rid of nameoffile: font frontend.
This adds a new function: luatex_open_input

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov 11 12:30:19 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 11 Nov 2009 12:30:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091111113019.712761E8C40D@www.metatex.org>

------------------------------------------------------------------------
r3117 | hhenkel | 2009-11-10 23:17:26 +0100 (Tue, 10 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.h

fix images in virtual fonts

------------------------------------------------------------------------
r3118 | hhenkel | 2009-11-11 00:21:08 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

more general image scaling function

------------------------------------------------------------------------
r3119 | hhenkel | 2009-11-11 01:13:59 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

objnum --> index

------------------------------------------------------------------------
r3120 | taco | 2009-11-11 09:00:37 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.h

Fix handling of \language=-1

------------------------------------------------------------------------
r3121 | taco | 2009-11-11 09:02:54 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf

regenerated manual

------------------------------------------------------------------------
r3122 | taco | 2009-11-11 09:51:10 +0100 (Wed, 11 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

Changed logic for Lua's tostring(<number>):
Now it uses %.14f for all values that fit in an 32bit int,
and %g for values that do not fit

------------------------------------------------------------------------
r3123 | taco | 2009-11-11 09:58:56 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

improve the description of Glue and muglue parameter lua interface

------------------------------------------------------------------------
r3124 | taco | 2009-11-11 10:16:03 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c

fix tfm/vf handling for unfound files

------------------------------------------------------------------------
r3125 | taco | 2009-11-11 10:41:44 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.h
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c

extra parameter to load_fmt_file to get rid of nameoffile in dumpdata.c

------------------------------------------------------------------------
r3126 | taco | 2009-11-11 11:12:51 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c

fix format loading C compiler warnings

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov 11 16:28:19 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 11 Nov 2009 16:28:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091111152819.B9B971E8C411@www.metatex.org>

------------------------------------------------------------------------
r3127 | taco | 2009-11-11 11:14:11 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.h
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

remove nameoffile from the files in the ocp directory

------------------------------------------------------------------------
r3128 | taco | 2009-11-11 11:21:40 +0100 (Wed, 11 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

remove nameoffile from pdfobj.c

------------------------------------------------------------------------
r3129 | taco | 2009-11-11 11:46:45 +0100 (Wed, 11 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h

clean out ptexlib.h: expand file handling macros, and move the
file functions from luatex.c to texfileio.[ch]

------------------------------------------------------------------------

From root at www.metatex.org  Wed Nov 11 22:28:08 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 11 Nov 2009 22:28:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091111212808.D3BD81E8C411@www.metatex.org>

------------------------------------------------------------------------
r3130 | taco | 2009-11-11 16:28:53 +0100 (Wed, 11 Nov 2009) | 11 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/luatex.h
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/filename.h
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h

A large step in an attempt to clean up the file name handling 
process.

Things that have been removed because of changes in function 
arguments and return values:

  tfmtemp, ocptemp, texinputtype, DUMP_VAR, DUMP_LENGTH_VAR, 
  format_default_length, nameoffile, namelength, name_file_pointer, 
  make_name_string() c.s., pack_cur_name(), pack_buffered_name().


------------------------------------------------------------------------
r3131 | taco | 2009-11-11 17:42:21 +0100 (Wed, 11 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

luatex_open_input should fopen() the file it found itself,
not the one it gets passed as argument (even though they are likely the same)

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov 12 12:29:55 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 12 Nov 2009 12:29:55 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091112112955.2A0BA1E8C411@www.metatex.org>

------------------------------------------------------------------------
r3132 | hhenkel | 2009-11-12 00:12:39 +0100 (Thu, 12 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdftables.h

use pdf_box_spec enum

------------------------------------------------------------------------
r3133 | taco | 2009-11-12 10:32:09 +0100 (Thu, 12 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.c
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.h
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

fix finding files in --output-directory;  
and the handling of --file-line-error

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov 12 22:28:08 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 12 Nov 2009 22:28:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091112212808.513F51E8C416@www.metatex.org>

------------------------------------------------------------------------
r3134 | taco | 2009-11-12 17:52:42 +0100 (Thu, 12 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.c

stop destroying cpath

------------------------------------------------------------------------

From root at www.metatex.org  Sat Nov 14 16:28:10 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sat, 14 Nov 2009 16:28:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091114152810.45CD41E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3135 | taco | 2009-11-14 11:16:08 +0100 (Sat, 14 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c

add a node type check for tex.box[] assignments from lua

------------------------------------------------------------------------
r3136 | taco | 2009-11-14 12:50:34 +0100 (Sat, 14 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

A patch from Akira Kakuto that:
"I implemented in TeXLive 2009 a mechanism that restricts
to write a file with names such as latex.bat etc.on windows."

------------------------------------------------------------------------
r3137 | taco | 2009-11-14 14:30:32 +0100 (Sat, 14 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h

simplify direction handling, first part: input

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Sun Nov 15 02:50:21 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Sun, 15 Nov 2009 02:50:21 +0100
Subject: [Dev-luatex] numbers formatting
Message-ID: <4AFF5E5D.9010007@gust.org.pl>

Folks,

last changes to number formatting in luatex makes things somewhat 
confusing. Please consider the following.

   \directlua{

   local floor = math.floor
   local round = function(n) return floor(10000*n+0.5)/10000 end

   n = math.pi
	
   % generic round doesn't work anymore,
   print()
   io.write(round(n))

   % but explicit conversion to string helps
   print()
   io.write(round(n).."")

   % now lets take more pleasant n
   n = 100.4
   % now the explicit conversion to string doesn't help either
   print()
   print(round(n))
   % same with pdf.print, tex.write
   pdf.print(round(n))
   tex.write(round(n))

   }?\end

This is hardly controlable, as the same operations gives completelly 
different results for n=10.4 and n=100.4. Obviously much depends on 
internal representation of the number, but one never had to bother before.

The reason I'm concerned is that string.format() function allows only 
fixed decimal digits "%.<n>f" or fixed all the digits "%.<n>g". And what 
is actually needed in most cases is "round to <n> digits and omit extra 
zeros at the end". That is why I tend to use floor(scale*n+0.5)/scale 
for rounding, which is not a good solution any longer.

Can one advice how to write rounded numbers without extra zeros?

Thanks, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From taco at elvenkind.com  Sun Nov 15 08:09:56 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 15 Nov 2009 08:09:56 +0100
Subject: [Dev-luatex] numbers formatting
In-Reply-To: <4AFF5E5D.9010007@gust.org.pl>
References: <4AFF5E5D.9010007@gust.org.pl>
Message-ID: <4AFFA944.10608@elvenkind.com>

Pawe? Jackowski wrote:
> Folks,
> 
> last changes to number formatting in luatex makes things somewhat 
> confusing. Please consider the following.

Hans asked for more precision in tostring() for small numbers, and
this was the result. Please try the latest trunk, which uses a somewhat
different approach ands seems to be more reliable.

Best wishes,
Taco

From root at www.metatex.org  Sun Nov 15 12:30:02 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 15 Nov 2009 12:30:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091115113002.56CA31E8C408@www.metatex.org>

------------------------------------------------------------------------
r3138 | taco | 2009-11-15 07:34:49 +0100 (Sun, 15 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

a different attempt at getting better precision for tostring() of small numbers

------------------------------------------------------------------------
r3139 | taco | 2009-11-15 08:07:06 +0100 (Sun, 15 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

previous commit caused crashes for out-of-%.14f-range floats

------------------------------------------------------------------------
r3140 | taco | 2009-11-15 08:14:00 +0100 (Sun, 15 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h

mongolian is LTL, not LTT

------------------------------------------------------------------------
r3141 | taco | 2009-11-15 08:24:38 +0100 (Sun, 15 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/PDFDoc.cc

drop automatic lower- and uppercasing attempts for not found image pdf files

------------------------------------------------------------------------

From pragma at wxs.nl  Sun Nov 15 12:11:29 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 15 Nov 2009 12:11:29 +0100
Subject: [Dev-luatex] numbers formatting
In-Reply-To: <4AFF5E5D.9010007@gust.org.pl>
References: <4AFF5E5D.9010007@gust.org.pl>
Message-ID: <4AFFE1E1.3060900@wxs.nl>

Pawe? Jackowski wrote:

> Can one advice how to write rounded numbers without extra zeros?

%.99g

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Sun Nov 15 16:28:08 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 15 Nov 2009 16:28:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091115152808.D11B51E8C408@www.metatex.org>

------------------------------------------------------------------------
r3142 | taco | 2009-11-15 13:45:18 +0100 (Sun, 15 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c

remove old reference code (too confusing for grep)

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Sun Nov 15 21:01:21 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Sun, 15 Nov 2009 21:01:21 +0100
Subject: [Dev-luatex] numbers formatting
In-Reply-To: <4AFFA944.10608@elvenkind.com>
References: <4AFF5E5D.9010007@gust.org.pl> <4AFFA944.10608@elvenkind.com>
Message-ID: <4B005E11.6040603@gust.org.pl>

Hi,

> Hans asked for more precision in tostring() for small numbers, and
> this was the result. Please try the latest trunk, which uses a somewhat
> different approach ands seems to be more reliable.

All cases I tried gives neat results by now.

> %.99g

Round the number explicitly and use enough digits in %g format to cover 
all. You're right.

Thank you!
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From root at www.metatex.org  Mon Nov 16 12:30:20 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 16 Nov 2009 12:30:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091116113020.617C21E8C408@www.metatex.org>

------------------------------------------------------------------------
r3143 | taco | 2009-11-16 07:46:43 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfshipout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

more cleanup of the direction handling (still partial)

------------------------------------------------------------------------
r3144 | taco | 2009-11-16 09:21:51 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c

Here is the last of the current direction cleanup

------------------------------------------------------------------------
r3145 | taco | 2009-11-16 09:43:39 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document the new directions restriction

------------------------------------------------------------------------
r3146 | taco | 2009-11-16 09:44:25 +0100 (Mon, 16 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

add a missing break in show_node_list that produced spurious 
local_par whatsit prints in the output

------------------------------------------------------------------------
r3147 | taco | 2009-11-16 10:13:22 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c

fix assigment of nil to tex boxes (generated an error because nil was treated as a glue spec)

------------------------------------------------------------------------
r3148 | taco | 2009-11-16 10:39:22 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/align.c
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.h

split scan_spec into two functions and remove the global spec_direction

------------------------------------------------------------------------
r3149 | taco | 2009-11-16 10:59:46 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

there was a gap between 1E-4 and 1E-6 that was still printed by %g

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov 16 16:28:11 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 16 Nov 2009 16:28:11 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091116152811.C317A1E8C408@www.metatex.org>

------------------------------------------------------------------------
r3150 | taco | 2009-11-16 14:39:02 +0100 (Mon, 16 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luanode.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c

add a new #define: pdf_out_block. This uses memcpy, and allows a
much faster version of [lua_]pdf_literal() when the string length
is less than the predefined constant max_single_pdf_print (8kb)

------------------------------------------------------------------------
r3151 | hhenkel | 2009-11-16 14:48:22 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/image.h
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.h
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.h
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.h

cleanup image handling

------------------------------------------------------------------------

From root at www.metatex.org  Tue Nov 17 16:29:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 17 Nov 2009 16:29:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091117152905.4D9541E8C40A@www.metatex.org>

------------------------------------------------------------------------
r3152 | oneiros | 2009-11-16 15:25:54 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c

fix warning: ISO C90 forbids mixed declarations and code

------------------------------------------------------------------------
r3153 | oneiros | 2009-11-16 15:36:23 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c

mark a parameter as unused

------------------------------------------------------------------------
r3154 | oneiros | 2009-11-16 15:37:32 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

rm unused var

------------------------------------------------------------------------
r3155 | taco | 2009-11-16 16:13:58 +0100 (Mon, 16 Nov 2009) | 13 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luanode.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/align.c
   M /trunk/source/texk/web2c/luatexdir/tex/buildpage.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.h
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

Do away with the global pack_direction: 

* hpack(), vpackage() and natural_sizes() now take an extra 
  argument for the desired direction (value -1 == use default).
* the callbacks hpack_filter, vpack_filter and pre_output_filter
  pass on an extra string argument for the direction, when known
  (nil == use default).
* node.hpack, node.vpack and node.dimensions accept an optional
  direction argument (not given == use default).
* new function string_dir() to ease lua push of the string value



------------------------------------------------------------------------
r3156 | hhenkel | 2009-11-16 16:38:26 +0100 (Mon, 16 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.h
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c

\pdfrefxform [width <dimen>] [height <dimen>] [depth <dimen>] <formref>
scales a form object; similar principle as with \pdfximage: depth alone
doesn't scale, it shifts vertically.

------------------------------------------------------------------------
r3157 | oneiros | 2009-11-16 16:48:38 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c

unused parameter...

------------------------------------------------------------------------
r3158 | hhenkel | 2009-11-16 16:53:53 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c

rm unused variable (thanks Martin!)

------------------------------------------------------------------------
r3159 | taco | 2009-11-16 17:14:15 +0100 (Mon, 16 Nov 2009) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h

Add the function font_malloc_charinfo() that allows pre-allocation
of charinfo data, and use that in font_from_lua(). This drastically 
speeds up font loading for large fonts in Windows (whose realloc() 
has horrible performance)

------------------------------------------------------------------------
r3160 | hhenkel | 2009-11-16 17:29:11 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.h

delete function

------------------------------------------------------------------------
r3161 | hhenkel | 2009-11-16 22:00:16 +0100 (Mon, 16 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

\pdfrefxform parameter description

------------------------------------------------------------------------
r3162 | taco | 2009-11-17 08:58:22 +0100 (Tue, 17 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

some formatting fixes

------------------------------------------------------------------------
r3163 | taco | 2009-11-17 13:43:59 +0100 (Tue, 17 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

fix of the openoutnameok patch

------------------------------------------------------------------------

From texworld at laposte.net  Tue Nov 17 19:12:39 2009
From: texworld at laposte.net (TeXWorld)
Date: Tue, 17 Nov 2009 19:12:39 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <49A50A53.5090606@elvenkind.com>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
	<49A48509.5090008@laposte.net> <49A50A53.5090606@elvenkind.com>
Message-ID: <4B02E797.8000201@laposte.net>

Taco Hoekwater a ?crit :
>
> TeXWorld wrote:
>   
>>> in the future there will be an option to load libraries (once we've
>>> sorted out the best way to deal with it in a secure way in the tex
>>> tree etc) 
>>>       
>> I was recently thinking about that and that's really good news. I have
>> several questions :
>>     
>
> We will almost certainly (but nothing is 100% yet) not be shipping
> lua libraries as part of the luatex distribution.
>
> Dynamic loading of libraries can not be guaranteed to work everywhere,
> and we want the core funtionality available even on platforms that
> don't support it, so the core libraries will remain built-in, as
> they are now. So far, there are no plans (nor infrastructure) to ship
> extra lua libraries.
>
>   
>> -when do you think this option could be available il LuaTeX ? This year ?
>>     
>
> Not before texlive 2009, but probably not long after either.
>
>   
>> -who will decide which lua modules will be available for/used with
>> LuaTeX ? Users ?
>> -could it be possible to install and remove any of them ? Is it the kind
>> of thing that could be done with the TeX distribution (I'm thinking of
>> tlmgr in TeXLive for example)
>>     
>
> If we are assuming for the moment that luatex itself doesn't ship
> those libraries, that would automaticlly make it a problem for the
> distributions and/or individual users.
>
> But let's get back to this later (end of summer).
>
> Best wishes,
> Taco
>
>
>   
Hi Taco, hi Hans,

Winter is coming soon.

What about continuing this discussion on dynamic loading lua libraries ?


Jack



From pragma at wxs.nl  Tue Nov 17 19:21:25 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Nov 2009 19:21:25 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B02E797.8000201@laposte.net>
References: <4978BD67.6050301@laposte.net>
	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>
	<49A50A53.5090606@elvenkind.com> <4B02E797.8000201@laposte.net>
Message-ID: <4B02E9A5.6090305@wxs.nl>

TeXWorld wrote:

> What about continuing this discussion on dynamic loading lua libraries ?

in the current luatex beta you can load a library with 'require'

we will not provide nor support libraries ourselves as the luatex engine 
has to be small, maintainable etc etc so it's up to yourself to make 
sure that your library matches the lua version used in luatex

also, future releases will have some restrictions similar to running 
commands using write 18 so it's quite likely that for tex live 2010 
there will be some guards for loading libraries (unless explicitly 
permitted)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Tue Nov 17 22:28:30 2009
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 17 Nov 2009 22:28:30 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091117212830.23CB91E8C411@www.metatex.org>

------------------------------------------------------------------------
r3164 | taco | 2009-11-17 17:22:05 +0100 (Tue, 17 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c

change relative ordering inside fontname discovery for the fd 
(try psname first, as it is much less likely to contain spaces)

------------------------------------------------------------------------
r3165 | taco | 2009-11-17 17:23:05 +0100 (Tue, 17 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c

print the used ttc subfont name and index to the terminal

------------------------------------------------------------------------
r3166 | taco | 2009-11-17 17:23:51 +0100 (Tue, 17 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/luafontloader/src/luafflib.c

force a luatex abort if a ttc subfont cannot be found
by returning -1 (which is always out of range)

------------------------------------------------------------------------
r3167 | taco | 2009-11-17 17:26:57 +0100 (Tue, 17 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

fix some unclarities and errors in the font name field descriptions

------------------------------------------------------------------------

From taco at elvenkind.com  Wed Nov 18 07:46:55 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 18 Nov 2009 07:46:55 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B02E9A5.6090305@wxs.nl>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>
	<4B02E797.8000201@laposte.net> <4B02E9A5.6090305@wxs.nl>
Message-ID: <4B03985F.4040008@elvenkind.com>

Hi,

Hans Hagen wrote:
> TeXWorld wrote:
> 
>> What about continuing this discussion on dynamic loading lua libraries ?
> 
> in the current luatex beta you can load a library with 'require'

FYI, the current status is that require() handles only pure lua
libraries. We hope to extend that to compiled libraries as well, but
Windows is giving me a hard time: I have to alter the luatex build
process rather drastically because Windows requires me to create a
dll out of the embedded lua interpreter. Adding C library support
on other platforms is a breeze.

That new functionality will not invalidate any of Hans' comments.

Best wishes,
Taco



From root at www.metatex.org  Wed Nov 18 12:30:30 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 18 Nov 2009 12:30:30 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091118113030.9E2DE1E8C505@www.metatex.org>

------------------------------------------------------------------------
r3168 | taco | 2009-11-18 09:37:54 +0100 (Wed, 18 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c

fix copy_font() (needed for expansion)

------------------------------------------------------------------------

From taco at elvenkind.com  Wed Nov 18 16:15:10 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 18 Nov 2009 16:15:10 +0100
Subject: [Dev-luatex] Luatex 0.45.0 announcement
Message-ID: <4B040F7E.2060709@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.45.0.

New features:

* Loading big OTF fonts via lua is now much faster than before,
  at the expense of a bit of precision loss in the calculated
  bounding boxes.

* Two new token lists are provided: \pdfxformresources and
  \pdfxformattr, as an alternative to \pdfxform keywords.

* \input and \openin now accept braced filenames.

* The \endlinechar can now be set to any value between 0 and 127.

* Luatex can now optionally use kpathsea to find lua require()
  files.

* The new primitives \aligntab and \alignmark are aliases for
  the use of & and # in alignments.

* \pdfrefximage [width <dimen>] [height <dimen>] [depth <dimen>] <imageref>
  overrules settings from \pdfximage for this \pdfrefximage call only

* The print precision for small numbers in lua code (tostring)
  has been improved.

* Akira Kakuto suppled a patch that restricts writing to files
  with names such as latex.bat etc. (on windows only)

* (un-feature): from now on luatex now only handles 4 direction
  specifiers: TLT (latin), TRT (arabic), RTT (cjk), and LTL
  (mongolian). The other directions now generate an error.

* (un-feature): xpdf's automatic lower- and uppercasing retry attempts
  for nonfound image pdf files has been removed.

* The callbacks hpack_filter, vpack_filter and pre_output_filter
  pass on an extra string argument for the direction, when known
  (nil == use default).

* The lua functions node.hpack(), node.vpack() and node.dimensions()
  now accept an optional direction argument (not given == use default).

* \pdfrefxform [width <dimen>] [height <dimen>] [depth <dimen>] <formref>
  scales a form object; similar principle as with \pdfximage: depth alone
  doesn't scale, it shifts vertically.

* A change to the relative ordering inside font name discovery for use
  by the backend: now it tries <f>.psname first, as that is much less
  likely to contain spaces.

* For ttc fonts, now the used subfont name and its index id are printed
  to the terminal, and if the backend cannot find a ttc subfont, the
  run is aborted.

Bug fixes:

* Prevent crashes for lua-loaded fonts without a (tfm) name.

* Remove spurious newlines in the output pdf that could be the
  result of using \pdfximage for an included pdf figure too early.

* Full font embedding for wide otf and ttf fonts now really
  works (older versions only pretended that it did work).

* node.dimensions() sometimes continued past the 'stop' node.

* Images inside virtual fonts were broken.

* The processing of \language=-1 was wrong, resulting in
  hyphenation attempts even though there was no proper language
  set up.

* Fix for finding files in --output-directory.

* Fix for handling of --file-line-error.

* tex.box[] assignments are now checked to make sure the assigned
  node has the right id (hlist or vlist).

* show_node_list (as in \showbox) produced spurious local_par
  whatsit prints in the output after direction nodes.

* The handling of pdf literals has been sped up.


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.45.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco


From texworld at laposte.net  Wed Nov 18 19:30:57 2009
From: texworld at laposte.net (TeXWorld)
Date: Wed, 18 Nov 2009 19:30:57 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B02E9A5.6090305@wxs.nl>
References: <4978BD67.6050301@laposte.net>
	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>
	<49A50A53.5090606@elvenkind.com> <4B02E797.8000201@laposte.net>
	<4B02E9A5.6090305@wxs.nl>
Message-ID: <4B043D61.8050904@laposte.net>

Hans Hagen a ?crit :
>
> TeXWorld wrote:
>
>> What about continuing this discussion on dynamic loading lua libraries ?
>
> in the current luatex beta you can load a library with 'require'
>
ok. Currently only libraries written in pure lua work with 'require'.
> we will not provide nor support libraries ourselves as the luatex 
> engine has to be small, maintainable etc etc so it's up to yourself to 
> make sure that your library matches the lua version used in luatex
>
yes of course.
> also, future releases will have some restrictions similar to running 
> commands using write 18 so it's quite likely that for tex live 2010 
> there will be some guards for loading libraries (unless explicitly 
> permitted)
>
> Hans
>
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
>
>




From texworld at laposte.net  Wed Nov 18 20:41:05 2009
From: texworld at laposte.net (TeXWorld)
Date: Wed, 18 Nov 2009 20:41:05 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B03985F.4040008@elvenkind.com>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>
	<4B02E797.8000201@laposte.net> <4B02E9A5.6090305@wxs.nl>
	<4B03985F.4040008@elvenkind.com>
Message-ID: <4B044DD1.9020508@laposte.net>

Taco Hoekwater a ?crit :
>
> Hi,
>
> Hans Hagen wrote:
>> TeXWorld wrote:
>>
>>> What about continuing this discussion on dynamic loading lua 
>>> libraries ?
>>
>> in the current luatex beta you can load a library with 'require'
>
> FYI, the current status is that require() handles only pure lua
> libraries. We hope to extend that to compiled libraries as well, 
Fantastic !
> but
> Windows is giving me a hard time: I have to alter the luatex build
> process rather drastically because Windows requires me to create a
> dll out of the embedded lua interpreter. Adding C library support
> on other platforms is a breeze.
>
Yes I see, I tried to use LuaXML with LuaTeX (0.44 with TexLive 2009 
under Vista) and it didn't work.
Do you think this dll will be ready for LuaTeX 0.50 ?

Moreover, where do we have to put the files of the library ? I thnik it 
works when they are put in (under windows) \bin\win32 or bin\win32\lua, 
doesn't it ?
Shouldn't they be installed somewhere else in the tds ?

At last, as Hans said, there will be restrictions of course for this lua 
library loading. In TeX Live 2010 we could set the list of authorized 
external programs (it was planned for TL09 but it's not possible in 
fact). Do you think authorized lua libraries should be set in the same 
list ?

> That new functionality will not invalidate any of Hans' comments.
>
> Best wishes,
> Taco
Thank you Taco, Thank you Hans



From pragma at wxs.nl  Wed Nov 18 21:01:44 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 18 Nov 2009 21:01:44 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B044DD1.9020508@laposte.net>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>	<4B02E797.8000201@laposte.net>
	<4B02E9A5.6090305@wxs.nl>	<4B03985F.4040008@elvenkind.com>
	<4B044DD1.9020508@laposte.net>
Message-ID: <4B0452A8.1060706@wxs.nl>

TeXWorld wrote:

> Yes I see, I tried to use LuaXML with LuaTeX (0.44 with TexLive 2009 
> under Vista) and it didn't work.
> Do you think this dll will be ready for LuaTeX 0.50 ?

you probably need to test the latest version, not the one that ships 
with tex live

> At last, as Hans said, there will be restrictions of course for this lua 
> library loading. In TeX Live 2010 we could set the list of authorized 
> external programs (it was planned for TL09 but it's not possible in 
> fact). Do you think authorized lua libraries should be set in the same 
> list ?

not the same list, but probably an other one as it is not a good idea to 
mix up functionality

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Wed Nov 18 22:31:38 2009
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 18 Nov 2009 22:31:38 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091118213138.8E0301E8C504@www.metatex.org>

------------------------------------------------------------------------
r3169 | taco | 2009-11-18 15:42:25 +0100 (Wed, 18 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/NEWS

update NEWS and regenerate manual

------------------------------------------------------------------------
r3170 | taco | 2009-11-18 15:43:18 +0100 (Wed, 18 Nov 2009) | 2 lines
Changed paths:
   A /tags/beta-0.45.0 (from /trunk:3169)

new tag for release

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Wed Nov 18 21:37:46 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Wed, 18 Nov 2009 21:37:46 +0100
Subject: [Dev-luatex] luatex_find_file(): do not know
Message-ID: <4B045B1A.6010902@gust.org.pl>

Hi,

at rev3168 (possibly quite some earlier) I get the following on attempt
to load opentype font:

luatex_find_file(): do not know how to handle file
c:/TeX/texmf-dist/fonts/opentype/public/lm/LMRoman10-Regular.otf of type 23

For sure I don't use any find-related callbacks and base entirely on
kpse. And for sure the problem is somewhere in my font-related 
callbacks, but after 314159265 blind tries I'm still nowhere. Anyone 
expirienced that?

Regards, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl



From taco at elvenkind.com  Wed Nov 18 23:01:55 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 18 Nov 2009 23:01:55 +0100
Subject: [Dev-luatex] luatex_find_file(): do not know
In-Reply-To: <4B045B1A.6010902@gust.org.pl>
References: <4B045B1A.6010902@gust.org.pl>
Message-ID: <4B046ED3.9050503@elvenkind.com>

Pawe? Jackowski wrote:
> Hi,
> 
> at rev3168 (possibly quite some earlier) I get the following on attempt
> to load opentype font:
> 
> luatex_find_file(): do not know how to handle file
> c:/TeX/texmf-dist/fonts/opentype/public/lm/LMRoman10-Regular.otf of type 23

This is new code, the message is just a reminder for myself. I'll
fix it tomorrow.

Best wishes,
Taco

From preining at logic.at  Thu Nov 19 00:56:52 2009
From: preining at logic.at (Norbert Preining)
Date: Thu, 19 Nov 2009 00:56:52 +0100
Subject: [Dev-luatex] Luatex 0.45.0 announcement
In-Reply-To: <4B040F7E.2060709@elvenkind.com>
References: <4B040F7E.2060709@elvenkind.com>
Message-ID: <20091118235652.GG7080@gamma.logic.tuwien.ac.at>

On Mi, 18 Nov 2009, Taco Hoekwater wrote:
> I have just uploaded the archives for a new luatex release, 0.45.0.

and it can be obtained from Debian/experimental already.


Thanks a lot Taco!

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining                                        Associate Professor
JAIST Japan Advanced Institute of Science and Technology   preining at jaist.ac.jp
Vienna University of Technology                               preining at logic.at
Debian Developer (Debian TeX Task Force)                    preining at debian.org
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
SILLOTH (n.)
Something that was sticky, and is now furry, found on the carpet under
the sofa the morning after a party.
			--- Douglas Adams, The Meaning of Liff

From P.Jackowski at gust.org.pl  Thu Nov 19 01:48:03 2009
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Thu, 19 Nov 2009 01:48:03 +0100
Subject: [Dev-luatex] luatex_find_file(): do not know
In-Reply-To: <4B046ED3.9050503@elvenkind.com>
References: <4B045B1A.6010902@gust.org.pl> <4B046ED3.9050503@elvenkind.com>
Message-ID: <4B0495C3.1090208@gust.org.pl>

Taco Hoekwater wrote:
> Pawe? Jackowski wrote:
>> Hi,
>>
>> at rev3168 (possibly quite some earlier) I get the following on attempt
>> to load opentype font:
>>
>> luatex_find_file(): do not know how to handle file
>> c:/TeX/texmf-dist/fonts/opentype/public/lm/LMRoman10-Regular.otf of 
>> type 23
> 
> This is new code, the message is just a reminder for myself. I'll
> fix it tomorrow.

Agh ok, thank you. This is what worked for me for tonights workaround :)

Index: texfileio.c
===================================================================
--- texfileio.c	(revision 3170)
+++ texfileio.c	(working copy)
@@ -153,6 +153,12 @@
          case find_type1_file_callback:
              ftemp = kpse_find_file(s, kpse_type1_format, 0);
              break;
+        case find_truetype_file_callback:
+            ftemp = kpse_find_file(s, kpse_truetype_format, 0);
+            break;
+        case find_opentype_file_callback:
+            ftemp = kpse_find_file(s, kpse_opentype_format, 0);
+            break;
          case find_ocp_file_callback:
              ftemp = kpse_find_file(s, kpse_ocp_format, 0);
              break;



-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From arthur.reutenauer at normalesup.org  Thu Nov 19 03:11:51 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 19 Nov 2009 03:11:51 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B044DD1.9020508@laposte.net>
References: <4978BD67.6050301@laposte.net> <49798586.9080204@wxs.nl>
	<49A48509.5090008@laposte.net> <49A50A53.5090606@elvenkind.com>
	<4B02E797.8000201@laposte.net> <4B02E9A5.6090305@wxs.nl>
	<4B03985F.4040008@elvenkind.com> <4B044DD1.9020508@laposte.net>
Message-ID: <20091119021151.GB24920@phare.normalesup.org>

> Moreover, where do we have to put the files of the library ? I thnik it  
> works when they are put in (under windows) \bin\win32 or bin\win32\lua,  
> doesn't it ?
> Shouldn't they be installed somewhere else in the tds ?

  Library lookups are controlled by the value of package.cpath inside the Lua
interpreter (http://www.lua.org/manual/5.1/manual.html#pdf-package.cpath).
It's a simple colon-separated list that defaults to a value set in luaconf.h,
and can be overriden by the environment variable LUA_CPATH, so your question is
really what the default value for package.cpath should be.

	Arthur

From texworld at laposte.net  Wed Nov 18 22:19:26 2009
From: texworld at laposte.net (TeXWorld)
Date: Wed, 18 Nov 2009 22:19:26 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B0452A8.1060706@wxs.nl>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>	<4B02E797.8000201@laposte.net>
	<4B02E9A5.6090305@wxs.nl>	<4B03985F.4040008@elvenkind.com>
	<4B044DD1.9020508@laposte.net> <4B0452A8.1060706@wxs.nl>
Message-ID: <4B0464DE.5050801@laposte.net>

Hans Hagen a ?crit :
>
> TeXWorld wrote:
>
>> Yes I see, I tried to use LuaXML with LuaTeX (0.44 with TexLive 2009 
>> under Vista) and it didn't work.
>> Do you think this dll will be ready for LuaTeX 0.50 ?
>
> you probably need to test the latest version, not the one that ships 
> with tex live
>
I've just updated my LuaTeX and it works now with the 0.45 version, 
thank you very much. Actually I have to put my lua library files in the 
current path. I think it also works if I put them in \bin\win32 but it 
doesn't (the system doesn't find the .dll file of the lua library ) if I 
put them in \bin\win23\lua.
In fact, I would like to know where to put my lua library files, 
somewhere LuaTeX could find them but not in the current directory of 
course and not in \bin\win32 mixed up with other TeX Live binaries.
>> At last, as Hans said, there will be restrictions of course for this 
>> lua library loading. In TeX Live 2010 we could set the list of 
>> authorized external programs (it was planned for TL09 but it's not 
>> possible in fact). Do you think authorized lua libraries should be 
>> set in the same list ?
>
> not the same list, but probably an other one as it is not a good idea 
> to mix up functionality
>
> Hans
>
>
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                              | www.pragma-pod.nl
> -----------------------------------------------------------------
>
>




From taco at elvenkind.com  Thu Nov 19 07:23:05 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 19 Nov 2009 07:23:05 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B0464DE.5050801@laposte.net>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>	<4B02E797.8000201@laposte.net>	<4B02E9A5.6090305@wxs.nl>	<4B03985F.4040008@elvenkind.com>	<4B044DD1.9020508@laposte.net>
	<4B0452A8.1060706@wxs.nl> <4B0464DE.5050801@laposte.net>
Message-ID: <4B04E449.9040903@elvenkind.com>

TeXWorld wrote:
> Hans Hagen a ?crit :
>>
>> TeXWorld wrote:
>>
>>> Yes I see, I tried to use LuaXML with LuaTeX (0.44 with TexLive 2009 
>>> under Vista) and it didn't work.
>>> Do you think this dll will be ready for LuaTeX 0.50 ?
>>
>> you probably need to test the latest version, not the one that ships 
>> with tex live
>>
> I've just updated my LuaTeX and it works now with the 0.45 version, 
> thank you very much. 

Earlier versions trashed package.cpath, 0.45 does not do that any more,
so precompiled dlls will now work, sort of.

But there is a potential problem with this: your loaded dll will use
stock lua to run lua code, not the lua inside luatex. That is relevant,
because the lua inside luatex has various patches (coroutines, bytecode
architecture independence, an adjusted tostring) that the stock lua
interpreter does not have. After some pondering (overnight) I now think
that perhaps this is not an actual problem at all, but I have to do
some thinking about it which is why the external dll support is
not official yet.

> In fact, I would like to know where to put my lua library files, 
> somewhere LuaTeX could find them but not in the current directory of 
> course and not in \bin\win32 mixed up with other TeX Live binaries.

For the moment: in one of the directories of package.cpath (just
create a short lua script to print the value, all architectures
have different defaults). In the future, there will be a way to
put those dlls in the TDS structure, but that needs an extension
to the callback mechanism and/or kpathsea, which is not done yet.

The fact that right now you can already load external dlls under
windows is more a side-effect than a feature: it works by virtue
of there being a valid package.cpath, which makes the normal lua
kernel kick in. There is no C support code inside luatex yet.

Best wishes,
Taco


From arthur.reutenauer at normalesup.org  Thu Nov 19 07:59:40 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 19 Nov 2009 07:59:40 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B04E449.9040903@elvenkind.com>
References: <49798586.9080204@wxs.nl> <49A48509.5090008@laposte.net>
	<49A50A53.5090606@elvenkind.com> <4B02E797.8000201@laposte.net>
	<4B02E9A5.6090305@wxs.nl> <4B03985F.4040008@elvenkind.com>
	<4B044DD1.9020508@laposte.net> <4B0452A8.1060706@wxs.nl>
	<4B0464DE.5050801@laposte.net> <4B04E449.9040903@elvenkind.com>
Message-ID: <20091119065940.GH24920@phare.normalesup.org>

>                           In the future, there will be a way to
> put those dlls in the TDS structure, but that needs an extension
> to the callback mechanism and/or kpathsea, which is not done yet.

  Great news, I was about to ask that.

	Arthur

From taco at elvenkind.com  Thu Nov 19 09:05:24 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 19 Nov 2009 09:05:24 +0100
Subject: [Dev-luatex] XML abilities in LuaTeX
In-Reply-To: <4B04E449.9040903@elvenkind.com>
References: <4978BD67.6050301@laposte.net>	<49798586.9080204@wxs.nl>	<49A48509.5090008@laposte.net>	<49A50A53.5090606@elvenkind.com>	<4B02E797.8000201@laposte.net>	<4B02E9A5.6090305@wxs.nl>	<4B03985F.4040008@elvenkind.com>	<4B044DD1.9020508@laposte.net>	<4B0452A8.1060706@wxs.nl>
	<4B0464DE.5050801@laposte.net> <4B04E449.9040903@elvenkind.com>
Message-ID: <4B04FC44.2030802@elvenkind.com>


Hi,

Taco Hoekwater wrote:
> 
> After some pondering (overnight) I now think
> that perhaps this is not an actual problem at all, but I have to do
> some thinking about it which is why the external dll support is
> not official yet.

Based on this assumption, I have committed an experimental patch that
enables dynamic loading for external compiled libraries unless --safer
is given on the command-line.

It is experimental because:

* it assumes that all architectures except windows will be happy with
  using dlopen (windows has its own code which does not need compile-
  time support, but you have to have an installed lua51.dll from e.g.
  http://luabinaries.luaforge.net ).

* I made only minimal changes to kpathsea.

* there may be lua libraries out there that fail horribly.

As with pure lua require() files, luatex will only use kpathsea if the
library is initialized already.


kpathsea changes in detail:

I added the kpse_clua_format identifier that searches for files with
extension .dll and .so. The texmf.cnf setting for this variable is
CLUAINPUTS, and by default it has this value:

CLUAINPUTS=.:$SELFAUTOLOC/lib/{$progname,$engine,}/lua//

This is the best I could do on short notice: the architecture has to
be in the path somewhere, and the fastest way to do that is to search
below the binary directory only.

One level up (lib parallel to bin) would have been nicer, but the
context minimals have arch and bin swapped (texmf-linux/bin instead of
bin/i386-linux) and at this early stage it would be a shame to disable
the largest group of testers by default.

If you know how to compile luatex from scratch, please have a go and
see whether all this works for you!

Best wishes,
Taco



From root at www.metatex.org  Thu Nov 19 12:30:48 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Nov 2009 12:30:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091119113048.778B41E8C505@www.metatex.org>

------------------------------------------------------------------------
r3171 | taco | 2009-11-19 07:05:21 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

fix opentype/truetype use if there are no callbacks defined (thanks Pawe?\197?\130)

------------------------------------------------------------------------
r3172 | taco | 2009-11-19 08:01:55 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/build.sh

support multiple archs on osx (from Mojca)

------------------------------------------------------------------------
r3173 | taco | 2009-11-19 08:47:02 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/kpathsea/ChangeLog
   M /trunk/source/texk/kpathsea/kpathsea.c
   M /trunk/source/texk/kpathsea/tex-file.c
   M /trunk/source/texk/kpathsea/texmf.cnf
   M /trunk/source/texk/kpathsea/types.h
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am
   M /trunk/source/texk/web2c/luatexdir/lua/lkpselib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

Experimental support for dynamic loading of external dlls

------------------------------------------------------------------------
r3174 | taco | 2009-11-19 09:42:55 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

restore printing of full pathnames

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov 19 16:28:40 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Nov 2009 16:28:40 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091119152840.ABB871E8C505@www.metatex.org>

------------------------------------------------------------------------
r3175 | taco | 2009-11-19 11:33:59 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/lua51/loadlib.c

fix kpathsea cpath searching

------------------------------------------------------------------------
r3176 | taco | 2009-11-19 12:22:28 +0100 (Thu, 19 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/dofont.c

cleanup the TIMERS code (no longer needed) and add a test 
for tfm names that are longer than the DVI standard allows

------------------------------------------------------------------------
r3177 | taco | 2009-11-19 12:54:45 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

fall back to kps truetype format if opentype cannot be found

------------------------------------------------------------------------

From root at www.metatex.org  Thu Nov 19 22:28:34 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 19 Nov 2009 22:28:34 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091119212834.0CEFA1E8C507@www.metatex.org>

------------------------------------------------------------------------
r3178 | oneiros | 2009-11-19 17:35:26 +0100 (Thu, 19 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c

missing long attribute

------------------------------------------------------------------------
r3179 | hhenkel | 2009-11-19 20:24:42 +0100 (Thu, 19 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.h

sorry for this silly \pdfxform bug, it should be fixed now,
scaling is still possible.

------------------------------------------------------------------------

From root at www.metatex.org  Fri Nov 20 12:30:40 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 20 Nov 2009 12:30:40 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091120113040.345651E8C507@www.metatex.org>

------------------------------------------------------------------------
r3180 | taco | 2009-11-20 09:45:27 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document new dynamic loading ability

------------------------------------------------------------------------
r3181 | taco | 2009-11-20 10:53:09 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c

add horrible code to attempt to correct bad cambria placements

------------------------------------------------------------------------
r3182 | taco | 2009-11-20 11:08:07 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c

revert #3181 and #3066

------------------------------------------------------------------------

From root at www.metatex.org  Fri Nov 20 16:28:35 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 20 Nov 2009 16:28:35 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091120152835.3251D1E8C507@www.metatex.org>

------------------------------------------------------------------------
r3183 | taco | 2009-11-20 14:22:12 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/luaconf.h

fix native win32 compilation (sorry Akira)

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Fri Nov 20 15:23:03 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Fri, 20 Nov 2009 15:23:03 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
Message-ID: <4B06A647.7050706@gust.org.pl>

Taco,

let me discuss it here instead of reopening the issue.

> I've decided not to attempt to fix this, there are too many tricky scanning
> issues surrounding this.

I understand that and I don't want to type explicit invalid UTF-8 
strings. Nobody writes binary code from the keyboard I guess :)

> If you want to create 8bit strings directly from 
> within a document, create you'll just have to build up the string
> programmatically. 

The point is you actually *cannot* make that programmatically 
(lpdflib.c:406):

if (!lua_isstring(L, -1))   /* !string-s t */
   luaL_error(L,
     "pdf.obj(): \"string\" must be string for stream object");

So once you say

   pdf.obj{type = "stream", string = string.char(255)}
   pdf.obj("stream", string.char(255))

you don't use an explicit string, but you still get the error.
As shown in note 0000309, moving the stuff to external file is not the 
complete solution either.

Since binary streams are not likely to be valid UTF-8, using \pdfobj or 
pdf.obj() with "stream" keyword doesn't seem usable at all.

But since we're not limited to strings, perhaps pdf stream data could be 
provided as:

-- lua function returning the stream once called?
pdf.obj{type = "stream", data = function() return string.char(255) end}

-- array of integers representing bytes to be written?
pdf.obj{type = "stream", data = {255}}

Am I missing some workaround? How do you guys handle it in context?

Regards, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Fri Nov 20 15:51:37 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 20 Nov 2009 15:51:37 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B06A647.7050706@gust.org.pl>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl>
Message-ID: <4B06ACF9.9050704@wxs.nl>

Pawe? Jackowski wrote:

> So once you say
> 
>   pdf.obj{type = "stream", string = string.char(255)}
>   pdf.obj("stream", string.char(255))
> 
> you don't use an explicit string, but you still get the error.
> As shown in note 0000309, moving the stuff to external file is not the 
> complete solution either.

can't you use the

Output in byte-sized chunks can be achieved by using characters just 
outside of the valid Unicode range,
starting at the value 1;114;112 (0x110000). When the times comes to 
print a character c> = 1;114;112,
LuaTEX will actually print the single byte corresponding to c minus 
1,114,112.

trick?


> Since binary streams are not likely to be valid UTF-8, using \pdfobj or 
> pdf.obj() with "stream" keyword doesn't seem usable at all.
> 
> But since we're not limited to strings, perhaps pdf stream data could be 
> provided as:
> 
> -- lua function returning the stream once called?
> pdf.obj{type = "stream", data = function() return string.char(255) end}
> 
> -- array of integers representing bytes to be written?
> pdf.obj{type = "stream", data = {255}}

brrr

> Am I missing some workaround? How do you guys handle it in context?

what exactly do you want to write to the pdf?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From P.Jackowski at gust.org.pl  Fri Nov 20 17:27:18 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Fri, 20 Nov 2009 17:27:18 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B06ACF9.9050704@wxs.nl>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl> <4B06ACF9.9050704@wxs.nl>
Message-ID: <4B06C366.7090307@gust.org.pl>


> can't you use the
> 
> Output in byte-sized chunks can be achieved by using characters just 
> outside of the valid Unicode range,
> starting at the value 1;114;112 (0x110000). When the times comes to 
> print a character c> = 1;114;112,
> LuaTEX will actually print the single byte corresponding to c minus 
> 1,114,112.
> 
> trick?

Meybe, but dunno how to use it for pdf stream generated on my own.

> what exactly do you want to write to the pdf?

Lets take pdf function -- /FunctionType 0 -- a continuous sequence of 
bits forming arbitrary bytes. Or take a lookup of /Indexed color spaces 
that may also contain arbitrary data. How would you write byte 255 to 
those streams?

I cannot find anything smarter then dumping the data to some external 
file and let luatex load it from there using "file" keyword.

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From taco at elvenkind.com  Fri Nov 20 17:43:46 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 20 Nov 2009 17:43:46 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B06A647.7050706@gust.org.pl>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl>
Message-ID: <4B06C742.1090107@elvenkind.com>


Hi,

Pawe? Jackowski wrote:
> 
> So once you say
> 
>   pdf.obj{type = "stream", string = string.char(255)}
>   pdf.obj("stream", string.char(255))
> 
> you don't use an explicit string, but you still get the error.

This error we can avoid with a simple patch to luatex.

Currently the stream is still converted to a token list, while
there is absolutely no reason to do so.

Reopened the tracker

Best wishes,
Taco

From P.Jackowski at gust.org.pl  Fri Nov 20 17:51:17 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Fri, 20 Nov 2009 17:51:17 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B06C742.1090107@elvenkind.com>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl> <4B06C742.1090107@elvenkind.com>
Message-ID: <4B06C905.5080402@gust.org.pl>

Taco Hoekwater wrote:
> Hi,
> 
> Pawe? Jackowski wrote:
>> So once you say
>>
>>   pdf.obj{type = "stream", string = string.char(255)}
>>   pdf.obj("stream", string.char(255))
>>
>> you don't use an explicit string, but you still get the error.
> 
> This error we can avoid with a simple patch to luatex.
> 
> Currently the stream is still converted to a token list, while
> there is absolutely no reason to do so.

And will be just perfect!

>> -- lua function returning the stream once called?
>> pdf.obj{type = "stream", data = function() return string.char(255) end}
>>
>> -- array of integers representing bytes to be written?
>> pdf.obj{type = "stream", data = {255}}
> 
> brrr

And then absolutely agree with Hans brrr ;)

Thank you, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From root at www.metatex.org  Fri Nov 20 22:28:31 2009
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 20 Nov 2009 22:28:31 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091120212831.2E5FE1E8C507@www.metatex.org>

------------------------------------------------------------------------
r3184 | taco | 2009-11-20 15:21:22 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am

attempt to fix osx compilation

------------------------------------------------------------------------
r3185 | taco | 2009-11-20 16:25:40 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac

previous attempt was not good enough, retry

------------------------------------------------------------------------
r3186 | taco | 2009-11-20 16:35:55 +0100 (Fri, 20 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am

third attempt (trying to run piggyback on XETEX test)

------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Mon Nov 23 01:00:58 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 23 Nov 2009 01:00:58 +0100 (CET)
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B06C742.1090107@elvenkind.com>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl> <4B06C742.1090107@elvenkind.com>
Message-ID: <alpine.DEB.1.00.0911230058170.14988@hahepc1.hahe>

On Fri, 20 Nov 2009, Taco Hoekwater wrote:
> Pawe? Jackowski wrote:
> >
> > So once you say
> >
> >   pdf.obj{type = "stream", string = string.char(255)}
> >   pdf.obj("stream", string.char(255))
> >
> > you don't use an explicit string, but you still get the error.
>
> This error we can avoid with a simple patch to luatex.
>
> Currently the stream is still converted to a token list, while
> there is absolutely no reason to do so.
>
> Reopened the tracker

fwiw,

    pdf.obj{type = "stream", immediate=true, string = string.char(255)}

should already work (no token list used). i'll try to fix the
non-immediate case (likely by luaL_ref()).

Regards, Hartmut

From root at www.metatex.org  Mon Nov 23 12:30:13 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 23 Nov 2009 12:30:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091123113014.019DB1E8C3FC@www.metatex.org>

------------------------------------------------------------------------
r3187 | oneiros | 2009-11-22 23:29:05 +0100 (Sun, 22 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.c
   M /trunk/source/texk/web2c/luatexdir/font/dofont.c
   M /trunk/source/texk/web2c/luatexdir/font/luafont.c
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/font/subfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.c
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c
   M /trunk/source/texk/web2c/luatexdir/font/writettf.c
   M /trunk/source/texk/web2c/luatexdir/font/writetype0.c
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.c
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/lua/luanode.c
   M /trunk/source/texk/web2c/luatexdir/lua/luatex.c
   M /trunk/source/texk/web2c/luatexdir/luafontloader/src/luafflib.c
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/tex/buildpage.c
   M /trunk/source/texk/web2c/luatexdir/tex/commands.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.c
   M /trunk/source/texk/web2c/luatexdir/tex/directions.h
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.c
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.h
   M /trunk/source/texk/web2c/luatexdir/tex/filename.c
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.c
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.h
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.c

indent

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov 23 16:28:39 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 23 Nov 2009 16:28:39 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091123152839.59BAB1E8C3F3@www.metatex.org>

------------------------------------------------------------------------
r3188 | taco | 2009-11-23 15:46:20 +0100 (Mon, 23 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c

improvement of mk_suffixlist()  (from PEB, via Akira)

------------------------------------------------------------------------

From t34www at googlemail.com  Mon Nov 23 18:41:37 2009
From: t34www at googlemail.com (T T)
Date: Mon, 23 Nov 2009 17:41:37 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
Message-ID: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>

Hi,

I have encountered a problem with os.spawn(arg) on Windows. If
arg[1]='foo bar' and arg[0]=nil, then the spawned process gets 'foo'
as argv[0] and 'bar' as argv[1]. This might be expected, since
according to docs, os.spawn doesn't do any argument processing.

So I tried double quoting arg[1]='"foo bar"' (i.e. double quotes are
part of arg[1]) but then os.spawn fails with invalid argument error.
Is this expected?

Furthermore, passing a string '"foo bar"' to os.spawn (including the
double quotes) instead of a table, results in spawning 'foo bar' but
again with 'foo' as argv[0] and 'bar' as argv[1]. The only way I found
to properly spawn a command with spaces is by giving arg[0]
explicitly:

 arg={[0]='foo bar', '"foo bar"', ...}

Cheers,

Tomek

From taco at elvenkind.com  Mon Nov 23 18:56:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 23 Nov 2009 18:56:13 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
Message-ID: <4B0ACCBD.6090109@elvenkind.com>


Hi Tomek,

T T wrote:
> Hi,
> 
> I have encountered a problem with os.spawn(arg) on Windows. If
> arg[1]='foo bar' and arg[0]=nil, then the spawned process gets 'foo'
> as argv[0] and 'bar' as argv[1]. This might be expected, since
> according to docs, os.spawn doesn't do any argument processing.

Let's put it this way: windows command line processing does not
agree with my neurons, so I have stayed way from it as much as
possible (and will continue to do so).

A good, clean patch would be welcome of course, but I myself will not
spend any more time on the stuff, not even for bug reports, as all that
would be accomplished by doing so is that it would give me a headache,
and there are much more pleasing ways to reach that state.

Best wishes,
Taco




From pragma at wxs.nl  Mon Nov 23 19:09:21 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Nov 2009 19:09:21 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
Message-ID: <4B0ACFD1.4010400@wxs.nl>

T T wrote:
> Hi,
> 
> I have encountered a problem with os.spawn(arg) on Windows. If
> arg[1]='foo bar' and arg[0]=nil, then the spawned process gets 'foo'
> as argv[0] and 'bar' as argv[1]. This might be expected, since
> according to docs, os.spawn doesn't do any argument processing.
> 
> So I tried double quoting arg[1]='"foo bar"' (i.e. double quotes are
> part of arg[1]) but then os.spawn fails with invalid argument error.
> Is this expected?
> 
> Furthermore, passing a string '"foo bar"' to os.spawn (including the
> double quotes) instead of a table, results in spawning 'foo bar' but
> again with 'foo' as argv[0] and 'bar' as argv[1]. The only way I found
> to properly spawn a command with spaces is by giving arg[0]
> explicitly:
> 
>  arg={[0]='foo bar', '"foo bar"', ...}


arg = {
     "dir",
     "bar",
     '"foo bar"',
}

os.spawn(arg)

works ok, so without arg[0]

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From t34www at googlemail.com  Mon Nov 23 20:17:57 2009
From: t34www at googlemail.com (T T)
Date: Mon, 23 Nov 2009 19:17:57 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0ACFD1.4010400@wxs.nl>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACFD1.4010400@wxs.nl>
Message-ID: <e7fba2610911231117v7f7baaaan8f6efc1b126eb3ec@mail.gmail.com>

2009/11/23 Hans Hagen <pragma at wxs.nl>:
> arg = {
> ? ?"dir",
> ? ?"bar",
> ? ?'"foo bar"',
> }
>
> os.spawn(arg)
>
> works ok, so without arg[0]

Yes, but your arg[1] has no spaces in it. Try running some program
under %ProgramFiles% or other path with spaces.

Cheers,

Tomek

From pragma at wxs.nl  Mon Nov 23 20:47:07 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Nov 2009 20:47:07 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911231117v7f7baaaan8f6efc1b126eb3ec@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	
	<4B0ACFD1.4010400@wxs.nl>
	<e7fba2610911231117v7f7baaaan8f6efc1b126eb3ec@mail.gmail.com>
Message-ID: <4B0AE6BB.7070908@wxs.nl>

T T wrote:
> 2009/11/23 Hans Hagen <pragma at wxs.nl>:
>> arg = {
>>    "dir",
>>    "bar",
>>    '"foo bar"',
>> }
>>
>> os.spawn(arg)
>>
>> works ok, so without arg[0]
> 
> Yes, but your arg[1] has no spaces in it. Try running some program
> under %ProgramFiles% or other path with spaces.

hm, hard to find one, but

  "c:/Program Files/WinRAR/rar.exe",

as arg[1] runs rar

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From t34www at googlemail.com  Mon Nov 23 20:48:15 2009
From: t34www at googlemail.com (T T)
Date: Mon, 23 Nov 2009 19:48:15 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0ACCBD.6090109@elvenkind.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
Message-ID: <e7fba2610911231148t5b090937w7927333508c4e584@mail.gmail.com>

2009/11/23 Taco Hoekwater <taco at elvenkind.com>:
>
> Let's put it this way: windows command line processing does not
> agree with my neurons, so I have stayed way from it as much as
> possible (and will continue to do so).

Yes, I know it's PITA.

>
> A good, clean patch would be welcome of course, but I myself will not
> spend any more time on the stuff, not even for bug reports, as all that
> would be accomplished by doing so is that it would give me a headache,
> and there are much more pleasing ways to reach that state.

OK, I'm looking into that.

Cheers,

Tomek

From t34www at googlemail.com  Mon Nov 23 21:35:47 2009
From: t34www at googlemail.com (T T)
Date: Mon, 23 Nov 2009 20:35:47 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911231148t5b090937w7927333508c4e584@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
	<e7fba2610911231148t5b090937w7927333508c4e584@mail.gmail.com>
Message-ID: <e7fba2610911231235o44a39974vcacb483acadcd5d5@mail.gmail.com>

2009/11/23 T T <t34www at googlemail.com>:
>
> OK, I'm looking into that.

After some digging through the sources and googling around I think the
problem is not with luatex's implementation but with _spawnvpe
function on Windows, which can't handle arguments with spaces (how
pathetic). So I should write to M$ now, I guess. Sigh. At least there
is a workaround with setting arg[0] explicitly, but some note to
unwary in the documentation would be good as well.

Cheers,

Tomek

From pragma at wxs.nl  Mon Nov 23 22:08:46 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Nov 2009 22:08:46 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911231235o44a39974vcacb483acadcd5d5@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	<4B0ACCBD.6090109@elvenkind.com>	<e7fba2610911231148t5b090937w7927333508c4e584@mail.gmail.com>
	<e7fba2610911231235o44a39974vcacb483acadcd5d5@mail.gmail.com>
Message-ID: <4B0AF9DE.9090304@wxs.nl>

T T wrote:
> 2009/11/23 T T <t34www at googlemail.com>:
>> OK, I'm looking into that.
> 
> After some digging through the sources and googling around I think the
> problem is not with luatex's implementation but with _spawnvpe
> function on Windows, which can't handle arguments with spaces (how
> pathetic). So I should write to M$ now, I guess. Sigh. At least there
> is a workaround with setting arg[0] explicitly, but some note to
> unwary in the documentation would be good as well.

maybe it's an option to reserve arg[0] for the (optional) path and set 
the path explicitely

(http://msdn.microsoft.com/en-us/library/aa273351%28VS.60%29.aspx)


Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Mon Nov 23 22:28:31 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 23 Nov 2009 22:28:31 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091123212831.10EF81E8C3F3@www.metatex.org>

------------------------------------------------------------------------
r3189 | taco | 2009-11-23 16:37:01 +0100 (Mon, 23 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c

fix large operator super/subscript relative displacement for OT MATH fonts

------------------------------------------------------------------------
r3190 | taco | 2009-11-23 16:53:47 +0100 (Mon, 23 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.c

fix a lack of negating the automatic italic correction addition in the creation of var_delimiter 
for large operators.

------------------------------------------------------------------------
r3191 | hhenkel | 2009-11-23 22:04:08 +0100 (Mon, 23 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.c

small image cleanup

------------------------------------------------------------------------

From jfine at pytex.org  Mon Nov 23 23:31:27 2009
From: jfine at pytex.org (Jonathan Fine)
Date: Mon, 23 Nov 2009 22:31:27 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0ACCBD.6090109@elvenkind.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
Message-ID: <4B0B0D3F.7000400@pytex.org>

Taco Hoekwater wrote:
> 
> Hi Tomek,
> 
> T T wrote:
>> Hi,
>>
>> I have encountered a problem with os.spawn(arg) on Windows. If
>> arg[1]='foo bar' and arg[0]=nil, then the spawned process gets 'foo'
>> as argv[0] and 'bar' as argv[1]. This might be expected, since
>> according to docs, os.spawn doesn't do any argument processing.
> 
> Let's put it this way: windows command line processing does not
> agree with my neurons, so I have stayed way from it as much as
> possible (and will continue to do so).
> 
> A good, clean patch would be welcome of course, but I myself will not
> spend any more time on the stuff, not even for bug reports, as all that
> would be accomplished by doing so is that it would give me a headache,
> and there are much more pleasing ways to reach that state.

The Python community have solved this problem, with the subprocess module.
     http://docs.python.org/library/subprocess.html

To quote from that URL
====
The subprocess module allows you to spawn new processes, connect to 
their input/output/error pipes, and obtain their return codes. This 
module intends to replace several other, older modules and functions, 
such as:

os.system
os.spawn*
os.popen*
popen2.*
commands.*
====

The specification for subprocess is at
     http://www.python.org/dev/peps/pep-0324/

If anyone would like to create a module for lua to solve the problem of 
filenames with spaces then Python's subprocess would be a good place to 
start.

-- 
Jonathan



From doc.evans at gmail.com  Mon Nov 23 23:38:53 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Mon, 23 Nov 2009 15:38:53 -0700
Subject: [Dev-luatex] compatibility with pdftex
Message-ID: <4B0B0EFD.5040807@gmail.com>

It's my understanding that at some point luatex is intended to be a drop-in
replacement for pdftex.

I wonder if development has reached the stage yet where developers want to
be informed about incompatibilities (i.e., it's at the point where an
incompatibility with pdftex is a bug) or whether it's still too early for that?

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091123/2ff6cde4/attachment.pgp>

From pragma at wxs.nl  Mon Nov 23 23:56:29 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Nov 2009 23:56:29 +0100
Subject: [Dev-luatex] compatibility with pdftex
In-Reply-To: <4B0B0EFD.5040807@gmail.com>
References: <4B0B0EFD.5040807@gmail.com>
Message-ID: <4B0B131D.4030104@wxs.nl>

D. R. Evans wrote:
> It's my understanding that at some point luatex is intended to be a drop-in
> replacement for pdftex.
> 
> I wonder if development has reached the stage yet where developers want to
> be informed about incompatibilities (i.e., it's at the point where an
> incompatibility with pdftex is a bug) or whether it's still too early for that?

we're always interested in aspects of luatex where it differs from 
pdftex but keep in mind that drop-in is not the same as 'compatible'; to 
mention a few aspects:

- wide fonts with more granularity in metric values
- a slightly different hyphenation algorithm also with no 256 char 
limitation
- occasional different log messages
- an optimized backend
- a couple of extensions in the math engine (should remain compatible)

also, directional typesetting is currently under reconstruction so 
that's not yet final

of course some aspects of the luatex machinery are 'work in progress and 
can have bugs (as we find out occasionally)

but anyway, interesting differences are welcome, but of course only with 
small (!) test files

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Tue Nov 24 00:34:04 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 24 Nov 2009 00:34:04 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0ACCBD.6090109@elvenkind.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
Message-ID: <19211.7148.455796.505022@zaphod.ms25.net>

On 23 November 2009 Taco Hoekwater wrote:

 > Let's put it this way: windows command line processing does not
 > agree with my neurons, so I have stayed way from it as much as
 > possible (and will continue to do so).
 > 
 > A good, clean patch would be welcome of course, [...]

Hi Taco,
if you change anything though, please inform the TeX Live team in
advance.  We probably have to adapt our scripts then.  The scripts
already provide a function:

function fixwin (args_unix)
   if os.type == 'windows' then
      local args_win={}  -- new table
      args_win[0]=args_unix[1]
      for i=1, #args_unix do  
	 args_win[i]='"'..args_unix[i]..'"'
      end
      return args_win
   else
      return args_unix
   end
end

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From t34www at googlemail.com  Tue Nov 24 00:53:39 2009
From: t34www at googlemail.com (T T)
Date: Mon, 23 Nov 2009 23:53:39 +0000
Subject: [Dev-luatex] opening up lua interpreter
Message-ID: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>

Hi,

I saw in another post that loading of binary modules has been enabled
in luatex (great!) that requires a stock lua51.dll on Windows. I
wonder if this side-effect that will last or pass?

I'm in the process of rewriting the generic script wrapper for TL on
Windows to replace the current batch script(s). I didn't want to code
everything in C, so I use only a thin binary stub that links with
luatex.dll, sets up the argument list and calls dllluatexmain with
'texlua' and a predefined script as argv[0] and argv[1]. This is nice
as I can implement most of the logic on the lua side but there is
currently no elegant way to return to the C side (luatex exits rather
than return) nor I can easily pass some data back.

This is not a big problem for me ATM (after finding a workaround for
os.spawn I don't need to return to the C side) but it could be useful
in general to have more open access to (tex)lua interpreter from C. Is
anything along these lines on the agenda?

Cheers,

Tomek

From taco at elvenkind.com  Tue Nov 24 08:21:36 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Nov 2009 08:21:36 +0100
Subject: [Dev-luatex] opening up lua interpreter
In-Reply-To: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>
References: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>
Message-ID: <4B0B8980.3060208@elvenkind.com>



T T wrote:
> Hi,
> 
> I saw in another post that loading of binary modules has been enabled
> in luatex (great!) that requires a stock lua51.dll on Windows. I
> wonder if this side-effect that will last or pass?

This is not easy to answer. Right now, it is clearly a side-effect.

If we decide to keep the binary modules support (which is experimental
right now) then in the future, it would be nice to build our 'own' lua
dll. But that will require quite some changes to the build scripts
as well as a conceptual change to the distribution process. Not easy
to integrate that back into texlive.

Best wishes,
Taco

From pragma at wxs.nl  Tue Nov 24 09:34:24 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Nov 2009 09:34:24 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <19211.7148.455796.505022@zaphod.ms25.net>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	<4B0ACCBD.6090109@elvenkind.com>
	<19211.7148.455796.505022@zaphod.ms25.net>
Message-ID: <4B0B9A90.3030804@wxs.nl>

Reinhard Kotucha wrote:
> On 23 November 2009 Taco Hoekwater wrote:
> 
>  > Let's put it this way: windows command line processing does not
>  > agree with my neurons, so I have stayed way from it as much as
>  > possible (and will continue to do so).
>  > 
>  > A good, clean patch would be welcome of course, [...]
> 
> Hi Taco,
> if you change anything though, please inform the TeX Live team in
> advance.  We probably have to adapt our scripts then.  The scripts
> already provide a function:

don't worry changes in these mechanism will never show up in stable 
versions unannounced as it will likely influence many; of course, as 
long as luatex functionality is not declared frozen we take the freedom 
to change things, but in this case the fact that texlua is used for 
scripts in tex distributions asks for extra care

as far as i can see the main problem is *not* in the interface, it's 
just that the underlying windows function cannot deal with spaces in the 
program location specification and that (at some point) probably be 
solved in a compatible way

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Nov 24 09:38:20 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Nov 2009 09:38:20 +0100
Subject: [Dev-luatex] opening up lua interpreter
In-Reply-To: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>
References: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>
Message-ID: <4B0B9B7C.60308@wxs.nl>

T T wrote:

> This is not a big problem for me ATM (after finding a workaround for
> os.spawn I don't need to return to the C side) but it could be useful
> in general to have more open access to (tex)lua interpreter from C. Is
> anything along these lines on the agenda?

we're now about version 0.50 so you can expect more opening up but we 
focus on the tex machinery. also, we're currently aiming at a stable 
version 0.50, and most of next year will be used for cleanup and further 
stabelizing (directionality, backend, etc), cwebbing, as well as 
enhancing mplib which is associated with this project

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From t34www at googlemail.com  Tue Nov 24 11:52:18 2009
From: t34www at googlemail.com (T T)
Date: Tue, 24 Nov 2009 10:52:18 +0000
Subject: [Dev-luatex] opening up lua interpreter
In-Reply-To: <4B0B8980.3060208@elvenkind.com>
References: <e7fba2610911231553q73825594n98ae3683a7e825d5@mail.gmail.com>
	<4B0B8980.3060208@elvenkind.com>
Message-ID: <e7fba2610911240252j2d41f32n42d1436103618233@mail.gmail.com>

2009/11/24 Taco Hoekwater <taco at elvenkind.com>:
>
> If we decide to keep the binary modules support (which is experimental
> right now) then in the future, it would be nice to build our 'own' lua

That would be very welcome, indeed. It could make lua(tex) not only a
common scripting solution, but also a common platform for building
kpathsea/TeX aware applications. There are already a few interesting
lua based applications, e.g. ps_view, ipe v7 (LaTeX friendly vector
graphic editor). I expect projects like these could be quite
interested in more open access to luatex and some very innovative
solutions could emerge in the process.

> dll. But that will require quite some changes to the build scripts
> as well as a conceptual change to the distribution process. Not easy
> to integrate that back into texlive.

I admit that I'm blissfully unaware of these hurdles, so I will
welcome any advancements that can make luatex more accessible to us
mere mortals ;) I see it as a major step in TeX development. Thanks
for all the hard work you put into it.

Cheers,

Tomek

From doc.evans at gmail.com  Tue Nov 24 21:52:32 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Tue, 24 Nov 2009 13:52:32 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
Message-ID: <4B0C4790.4070101@gmail.com>

I'm probably being blind, but I can't find any instructions about
downloading the source from svn and building it.

Can some kind person please point me to such instructions? I want to be
sure I'm running current code before I file any "this works in pdftex but
not in luatex" reports.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/74868566/attachment.pgp>

From schuster.wolfgang at googlemail.com  Tue Nov 24 21:56:00 2009
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 24 Nov 2009 21:56:00 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C4790.4070101@gmail.com>
References: <4B0C4790.4070101@gmail.com>
Message-ID: <8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>


Am 24.11.2009 um 21:52 schrieb D. R. Evans:

> I'm probably being blind, but I can't find any instructions about
> downloading the source from svn and building it.
> 
> Can some kind person please point me to such instructions? I want to be
> sure I'm running current code before I file any "this works in pdftex but
> not in luatex" reports.

server  : svn checkout http://foundry.supelec.fr/svn/luatex
username: anonymous
password:

Wolfgang


From doc.evans at gmail.com  Tue Nov 24 22:45:31 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Tue, 24 Nov 2009 14:45:31 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
Message-ID: <4B0C53FB.5080507@gmail.com>

Wolfgang Schuster said the following at 11/24/2009 01:56 PM :
> Am 24.11.2009 um 21:52 schrieb D. R. Evans:
> 
>> I'm probably being blind, but I can't find any instructions about
>> downloading the source from svn and building it.
>>
>> Can some kind person please point me to such instructions? I want to be
>> sure I'm running current code before I file any "this works in pdftex but
>> not in luatex" reports.
> 
> server  : svn checkout http://foundry.supelec.fr/svn/luatex
> username: anonymous
> password:
> 

Are you sure that's right? 2.2GB downloaded so far, and still going strong.
I'm going to have to kill the download if it goes on much longer, and re-do
it on a larger partition. And if there are any instructions as to what to
do with it all, they aren't obvious.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/f67afeea/attachment.pgp>

From khaledhosny at eglug.org  Tue Nov 24 23:01:39 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 00:01:39 +0200
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C53FB.5080507@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com>
Message-ID: <20091124220139.GA11430@khaled-laptop>

On Tue, Nov 24, 2009 at 02:45:31PM -0700, D. R. Evans wrote:
> Wolfgang Schuster said the following at 11/24/2009 01:56 PM :
> > Am 24.11.2009 um 21:52 schrieb D. R. Evans:
> > 
> >> I'm probably being blind, but I can't find any instructions about
> >> downloading the source from svn and building it.
> >>
> >> Can some kind person please point me to such instructions? I want to be
> >> sure I'm running current code before I file any "this works in pdftex but
> >> not in luatex" reports.
> > 
> > server  : svn checkout http://foundry.supelec.fr/svn/luatex
> > username: anonymous
> > password:
> > 
> 
> Are you sure that's right? 2.2GB downloaded so far, and still going strong.
> I'm going to have to kill the download if it goes on much longer, and re-do
> it on a larger partition. And if there are any instructions as to what to
> do with it all, they aren't obvious.

Should be http://foundry.supelec.fr/svn/luatex/trunk or you will
download all luatex branchs and tags, which you aren't interested in.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/efc9ac21/attachment.pgp>

From khaledhosny at eglug.org  Wed Nov 25 00:02:30 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 01:02:30 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091123212831.10EF81E8C3F3@www.metatex.org>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
Message-ID: <20091124230230.GA13208@khaled-laptop>

On Mon, Nov 23, 2009 at 10:28:31PM +0100, Cron Daemon wrote:
> ------------------------------------------------------------------------
> r3189 | taco | 2009-11-23 16:37:01 +0100 (Mon, 23 Nov 2009) | 2 lines
> Changed paths:
>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
> 
> fix large operator super/subscript relative displacement for OT MATH fonts
> 
> ------------------------------------------------------------------------
> r3190 | taco | 2009-11-23 16:53:47 +0100 (Mon, 23 Nov 2009) | 3 lines
> Changed paths:
>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
> 
> fix a lack of negating the automatic italic correction addition in the creation of var_delimiter 
> for large operators.

Though large operator super/subscript are better now, I think it is
still broken. Compare the attached office2007 and luatex generated PDFs.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: office2007.pdf
Type: application/pdf
Size: 3388 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/1a8f8298/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex.pdf
Type: application/pdf
Size: 3253 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/1a8f8298/attachment-0003.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: text/x-tex
Size: 430 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/1a8f8298/attachment-0001.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/1a8f8298/attachment-0001.pgp>

From doc.evans at gmail.com  Wed Nov 25 00:13:57 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Tue, 24 Nov 2009 16:13:57 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <20091124220139.GA11430@khaled-laptop>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
Message-ID: <4B0C68B5.5020405@gmail.com>

Khaled Hosny said the following at 11/24/2009 03:01 PM :

> Should be http://foundry.supelec.fr/svn/luatex/trunk or you will
> download all luatex branchs and tags, which you aren't interested in.
> 
> 

Much better.

Building with build.sh gives this error after a few minutes:

----

make[5]: Entering directory `/tmp/luatex/trunk/build/texk/web2c'
date >stamp-tangle
srcdir=../../../source/texk/web2c /bin/sh
../../../source/texk/web2c/web2c/convert tangleboot
gcc -DHAVE_CONFIG_H -I. -I../../../source/texk/web2c -I./..
-I/tmp/luatex/trunk/build/texk -I/tmp/luatex/trunk/source/texk    -g -O2
-MT tangleboot.o -MD -MP -MF .deps/tangleboot.Tpo -c -o tangleboot.o
tangleboot.c
mv -f .deps/tangleboot.Tpo .deps/tangleboot.Po
/bin/sh ./libtool --tag=CC   --mode=link gcc  -g -O2   -o tangleboot
tangleboot.o lib/lib.a /tmp/luatex/trunk/build/texk/kpathsea/libkpathsea.la -lm
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: libtool_args+=: not found
eval: 1: libtool_args+=: not found
libtool: link: gcc  lib/lib.a
/tmp/luatex/trunk/build/texk/kpathsea/.libs/libkpathsea.a -lm
lib/lib.a(main.o): In function `main':
/tmp/luatex/trunk/build/texk/web2c/lib/../../../../source/texk/web2c/lib/main.c:26:
undefined reference to `mainbody'
collect2: ld returned 1 exit status

----

FWIW I am on a 64-bit karmic system, fully up to date, with a lot of
development-related stuff installed, but I've never tried to build anything
related to any kind of TeX on this machine before. I've *used* a lot of Tex
stuff on it, but not tried any TeX-related development until now.

Presumably the above error is because I'm missing something?

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/3f061198/attachment.pgp>

From martin at oneiros.de  Wed Nov 25 00:34:45 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 25 Nov 2009 00:34:45 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C68B5.5020405@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com>
Message-ID: <68c491a60911241534j42bb5c80l88ab068d8bf3d571@mail.gmail.com>

2009/11/25 D. R. Evans <doc.evans at gmail.com>:
> Presumably the above error is because I'm missing something?

/bin/sh is probably not a bash. Try to convince the build script to use bash.

Best
   Martin

From taco at elvenkind.com  Wed Nov 25 00:35:28 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 25 Nov 2009 00:35:28 +0100
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091124230230.GA13208@khaled-laptop>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
Message-ID: <4B0C6DC0.9050901@elvenkind.com>

Khaled Hosny wrote:
> On Mon, Nov 23, 2009 at 10:28:31PM +0100, Cron Daemon wrote:
>> ------------------------------------------------------------------------
>> r3189 | taco | 2009-11-23 16:37:01 +0100 (Mon, 23 Nov 2009) | 2 lines
>> Changed paths:
>>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
>>
>> fix large operator super/subscript relative displacement for OT MATH fonts
>>
>> ------------------------------------------------------------------------
>> r3190 | taco | 2009-11-23 16:53:47 +0100 (Mon, 23 Nov 2009) | 3 lines
>> Changed paths:
>>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
>>
>> fix a lack of negating the automatic italic correction addition in the creation of var_delimiter 
>> for large operators.
> 
> Though large operator super/subscript are better now, I think it is
> still broken. Compare the attached office2007 and luatex generated PDFs.

See the last comment on http://tracker.luatex.org/view.php?id=286

Hans has a new beta (on the ftp site only) that corrects this last
glitch as well.


Best wishes,
Taco

From doc.evans at gmail.com  Wed Nov 25 00:51:39 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Tue, 24 Nov 2009 16:51:39 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <68c491a60911241534j42bb5c80l88ab068d8bf3d571@mail.gmail.com>
References: <4B0C4790.4070101@gmail.com>	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>	<4B0C53FB.5080507@gmail.com>
	<20091124220139.GA11430@khaled-laptop>	<4B0C68B5.5020405@gmail.com>
	<68c491a60911241534j42bb5c80l88ab068d8bf3d571@mail.gmail.com>
Message-ID: <4B0C718B.2060802@gmail.com>

Martin Schr?der said the following at 11/24/2009 04:34 PM :
> 2009/11/25 D. R. Evans <doc.evans at gmail.com>:
>> Presumably the above error is because I'm missing something?
> 
> /bin/sh is probably not a bash. Try to convince the build script to use bash.
> 

I was going to reply "of course it's bash"... but then I looked at the link
and found something called dash. I guess I've never noticed before because
I always put an explicit "#! /bin/bash" at the start of my shell scripts.

So I learned something, which is always good. Thank you.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/f837c8af/attachment.pgp>

From doc.evans at gmail.com  Wed Nov 25 00:59:55 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Tue, 24 Nov 2009 16:59:55 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C718B.2060802@gmail.com>
References: <4B0C4790.4070101@gmail.com>	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>	<4B0C53FB.5080507@gmail.com>
	<20091124220139.GA11430@khaled-laptop>	<4B0C68B5.5020405@gmail.com>
	<68c491a60911241534j42bb5c80l88ab068d8bf3d571@mail.gmail.com>
	<4B0C718B.2060802@gmail.com>
Message-ID: <4B0C737B.3070508@gmail.com>

D. R. Evans said the following at 11/24/2009 04:51 PM :
> Martin Schr?der said the following at 11/24/2009 04:34 PM :
>> 2009/11/25 D. R. Evans <doc.evans at gmail.com>:
>>> Presumably the above error is because I'm missing something?
>> /bin/sh is probably not a bash. Try to convince the build script to use bash.
>>

Perhaps the references to "/bin/sh" in .../build/texk/web2c should be
changed to explicit references to bash if it's important to use bash?

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/12a4b591/attachment.pgp>

From khaledhosny at eglug.org  Wed Nov 25 01:12:59 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 02:12:59 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0C6DC0.9050901@elvenkind.com>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
	<4B0C6DC0.9050901@elvenkind.com>
Message-ID: <20091125001259.GA14370@khaled-laptop>

On Wed, Nov 25, 2009 at 12:35:28AM +0100, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> See the last comment on http://tracker.luatex.org/view.php?id=286

From the ticket:
"The result is now still too wide, but that is truly cambria's fault: the
integrals have large italic corrections while in fact they fit in their
bounding boxes."

This isn't Cambria's fault per se, as any font that is to be used with
MS Office as well is going Cambria's route (so does Asana Math and my
two math fonts.) 
So, IMHO this should be the default behaviour for new math fonts, and
old TeX fonts pretending to be new math fonts should compensate for
this, not the other way around.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/c0f0b6f6/attachment.pgp>

From khaledhosny at eglug.org  Wed Nov 25 01:17:49 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 02:17:49 +0200
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C68B5.5020405@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com>
Message-ID: <20091125001749.GB14370@khaled-laptop>

On Tue, Nov 24, 2009 at 04:13:57PM -0700, D. R. Evans wrote:
> Khaled Hosny said the following at 11/24/2009 03:01 PM :
> 
> > Should be http://foundry.supelec.fr/svn/luatex/trunk or you will
> > download all luatex branchs and tags, which you aren't interested in.
> > 
> > 
> 
> Much better.
> 
> Building with build.sh gives this error after a few minutes:

Doing "export CONFIG_SHELL=/bin/bash" is usually enough, as it forces
using bash (no idea why this isn't the default.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/8e17bba4/attachment-0001.pgp>

From taco at elvenkind.com  Wed Nov 25 08:11:53 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 25 Nov 2009 08:11:53 +0100
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091125001259.GA14370@khaled-laptop>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
	<4B0C6DC0.9050901@elvenkind.com>
	<20091125001259.GA14370@khaled-laptop>
Message-ID: <4B0CD8B9.3030702@elvenkind.com>

Khaled Hosny wrote:
> On Wed, Nov 25, 2009 at 12:35:28AM +0100, Taco Hoekwater wrote:
>> Khaled Hosny wrote:
>> See the last comment on http://tracker.luatex.org/view.php?id=286
> 
> From the ticket:
> "The result is now still too wide, but that is truly cambria's fault: the
> integrals have large italic corrections while in fact they fit in their
> bounding boxes."
> 
> This isn't Cambria's fault per se, as any font that is to be used with
> MS Office as well is going Cambria's route (so does Asana Math and my
> two math fonts.) 

> So, IMHO this should be the default behaviour for new math fonts, and
> old TeX fonts pretending to be new math fonts should compensate for
> this, not the other way around.

I am not quite convinced yet. The MATH spec seems to disagree with both
the font metrics and the actual behavior of Word. What would happen
is Word 2010 (say) fixes that?

AFAICS, the only reason for Asana being like Cambria is that it
copies the font literally instead of the looking at the spec.

One thing I could possibly do is to auto-correct in the engine
if there is a big difference between width+italic correction and
actual glyph bounding box.

Best wishes,
Taco

From N7DR at arrl.net  Tue Nov 24 20:36:26 2009
From: N7DR at arrl.net (D. R. Evans)
Date: Tue, 24 Nov 2009 12:36:26 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
Message-ID: <4B0C35BA.6070304@arrl.net>

I'm probably being blind, but I can't find any instructions about
downloading the source from svn and building it.

Can some kind person please point me to such instructions? I want to be
sure I'm running current code before I file any "this works in pdftex but
not in luatex" reports.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091124/016294d6/attachment.pgp>

From pragma at wxs.nl  Wed Nov 25 10:14:07 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Nov 2009 10:14:07 +0100
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091124230230.GA13208@khaled-laptop>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
Message-ID: <4B0CF55F.1050809@wxs.nl>

Khaled Hosny wrote:
> On Mon, Nov 23, 2009 at 10:28:31PM +0100, Cron Daemon wrote:
>> ------------------------------------------------------------------------
>> r3189 | taco | 2009-11-23 16:37:01 +0100 (Mon, 23 Nov 2009) | 2 lines
>> Changed paths:
>>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
>>
>> fix large operator super/subscript relative displacement for OT MATH fonts
>>
>> ------------------------------------------------------------------------
>> r3190 | taco | 2009-11-23 16:53:47 +0100 (Mon, 23 Nov 2009) | 3 lines
>> Changed paths:
>>    M /trunk/source/texk/web2c/luatexdir/tex/mlist.c
>>
>> fix a lack of negating the automatic italic correction addition in the creation of var_delimiter 
>> for large operators.
> 
> Though large operator super/subscript are better now, I think it is
> still broken. Compare the attached office2007 and luatex generated PDFs.

if you look in the font you will notice that the cambria integral signs 
have a wrong boundingbox (too much white at the right); as it happens, 
compensating with the italic correction sort of solves this so we guess 
that word is doing something like that

however, subtractive the italic correction from the width of a glyph 
makes no sense (it can be compensated at th emacro package end for this 
particular set of glyph, which is what we do in context now)

so, the problem is noticed and once there are more official open type 
math fonts out there, we can have a further look at it and see what the 
policies have become

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Nov 25 10:20:14 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Nov 2009 10:20:14 +0100
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091125001259.GA14370@khaled-laptop>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>	<20091124230230.GA13208@khaled-laptop>	<4B0C6DC0.9050901@elvenkind.com>
	<20091125001259.GA14370@khaled-laptop>
Message-ID: <4B0CF6CE.8080500@wxs.nl>

Khaled Hosny wrote:
> On Wed, Nov 25, 2009 at 12:35:28AM +0100, Taco Hoekwater wrote:
>> Khaled Hosny wrote:
>> See the last comment on http://tracker.luatex.org/view.php?id=286
> 
> From the ticket:
> "The result is now still too wide, but that is truly cambria's fault: the
> integrals have large italic corrections while in fact they fit in their
> bounding boxes."
> 
> This isn't Cambria's fault per se, as any font that is to be used with
> MS Office as well is going Cambria's route (so does Asana Math and my
> two math fonts.) 
> So, IMHO this should be the default behaviour for new math fonts, and
> old TeX fonts pretending to be new math fonts should compensate for
> this, not the other way around.

well, as long as there is no standard saying "for integral glyphs (of 
any size) you need to subtract the italic correction from the width" we 
cannot say that this is "expected behaviour"

the fact that Asana etc follow cambria in this is not making it a 
standard either; at least with tex we're able to deal with such bugs and 
i'm pretty sure that other applications also hav ebuilt ion 
compensations and fixes

if we end up in some 'we mimick the first font using some kind of otf 
technology' approach even if it concerns bugs, then what's a standard 
worth (in that respect open type is already a bit of a mess anyway)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Nov 25 10:23:05 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Nov 2009 10:23:05 +0100
Subject: [Dev-luatex] Cron
	<luatex@vz3>	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0CD8B9.3030702@elvenkind.com>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>	<20091124230230.GA13208@khaled-laptop>	<4B0C6DC0.9050901@elvenkind.com>	<20091125001259.GA14370@khaled-laptop>
	<4B0CD8B9.3030702@elvenkind.com>
Message-ID: <4B0CF779.5040601@wxs.nl>

Taco Hoekwater wrote:

> One thing I could possibly do is to auto-correct in the engine
> if there is a big difference between width+italic correction and
> actual glyph bounding box.

And even then it would be some FixItalicWidthThreshold parameter which 
then is font dependent in which case fixing the font at runtime is cleaner

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From t34www at googlemail.com  Wed Nov 25 11:06:07 2009
From: t34www at googlemail.com (T T)
Date: Wed, 25 Nov 2009 10:06:07 +0000
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0C35BA.6070304@arrl.net>
References: <4B0C35BA.6070304@arrl.net>
Message-ID: <e7fba2610911250206n731edee5qd4f46b983b035454@mail.gmail.com>

2009/11/24 D. R. Evans <N7DR at arrl.net>:
> I'm probably being blind, but I can't find any instructions about
> downloading the source from svn and building it.
>
> Can some kind person please point me to such instructions?

I just tried to do it yesterday for the first time. Building  the
trunk under mingw with 'sh build.sh' took a very long time but worked
for me (a very pleasant surprise, I didn't expect the build system to
work on Windows).

Only the final step of stripping the luatex binary failed, because the
file name was given w/o .exe extension.

Cheers,

Tomek

From khaledhosny at eglug.org  Wed Nov 25 12:48:07 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 13:48:07 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0CD8B9.3030702@elvenkind.com>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
	<4B0C6DC0.9050901@elvenkind.com>
	<20091125001259.GA14370@khaled-laptop>
	<4B0CD8B9.3030702@elvenkind.com>
Message-ID: <20091125114807.GA2618@khaled-laptop>

On Wed, Nov 25, 2009 at 08:11:53AM +0100, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >On Wed, Nov 25, 2009 at 12:35:28AM +0100, Taco Hoekwater wrote:
> >>Khaled Hosny wrote:
> >>See the last comment on http://tracker.luatex.org/view.php?id=286
> >
> >From the ticket:
> >"The result is now still too wide, but that is truly cambria's fault: the
> >integrals have large italic corrections while in fact they fit in their
> >bounding boxes."
> >
> >This isn't Cambria's fault per se, as any font that is to be used with
> >MS Office as well is going Cambria's route (so does Asana Math and my
> >two math fonts.)
> 
> >So, IMHO this should be the default behaviour for new math fonts, and
> >old TeX fonts pretending to be new math fonts should compensate for
> >this, not the other way around.
> 
> I am not quite convinced yet. The MATH spec seems to disagree with both
> the font metrics and the actual behavior of Word. What would happen
> is Word 2010 (say) fixes that?

Until office2010 is released, office2007 is the standard implementation
(well, windows 7 does math typesetting system wide, and the bundled
Cambria exhibits the same behaviour, so I doubt there will be a change
anytime soon.) I'll try to talk to Murray Sargent of MS, may be we can
get more clarifications.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/9da7a98d/attachment.pgp>

From khaledhosny at eglug.org  Wed Nov 25 13:28:18 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 14:28:18 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0CF6CE.8080500@wxs.nl>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
	<4B0C6DC0.9050901@elvenkind.com>
	<20091125001259.GA14370@khaled-laptop> <4B0CF6CE.8080500@wxs.nl>
Message-ID: <20091125122818.GB2618@khaled-laptop>

On Wed, Nov 25, 2009 at 10:20:14AM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
> >On Wed, Nov 25, 2009 at 12:35:28AM +0100, Taco Hoekwater wrote:
> >>Khaled Hosny wrote:
> >>See the last comment on http://tracker.luatex.org/view.php?id=286
> >
> >From the ticket:
> >"The result is now still too wide, but that is truly cambria's fault: the
> >integrals have large italic corrections while in fact they fit in their
> >bounding boxes."
> >
> >This isn't Cambria's fault per se, as any font that is to be used with
> >MS Office as well is going Cambria's route (so does Asana Math and my
> >two math fonts.) So, IMHO this should be the default behaviour for
> >new math fonts, and
> >old TeX fonts pretending to be new math fonts should compensate for
> >this, not the other way around.
> 
> well, as long as there is no standard saying "for integral glyphs
> (of any size) you need to subtract the italic correction from the
> width" we cannot say that this is "expected behaviour"

Literally speaking, there is no standard at all, just an unofficial spec
document, so things are a bit stretched, and again office implantation is
the de facto standard here until there is an official published standard
that one can point to (even then, people are likely to follow what MS
implantation does and we will need to adapt to it.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/6e24c11f/attachment.pgp>

From khaledhosny at eglug.org  Wed Nov 25 13:32:16 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 14:32:16 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0CF55F.1050809@wxs.nl>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop> <4B0CF55F.1050809@wxs.nl>
Message-ID: <20091125123216.GC2618@khaled-laptop>

On Wed, Nov 25, 2009 at 10:14:07AM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
> >Though large operator super/subscript are better now, I think it is
> >still broken. Compare the attached office2007 and luatex generated PDFs.
> 
> if you look in the font you will notice that the cambria integral
> signs have a wrong boundingbox (too much white at the right); as it
> happens, compensating with the italic correction sort of solves this
> so we guess that word is doing something like that

I tried to follow the spec, and the result was pretty broken (the sup
and superscripts came effectively behind the operator), so office is
expecting Cambria's behaviour from all fonts, so I can't see why new
fonts will not do the same.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/73f22f48/attachment.pgp>

From pragma at wxs.nl  Wed Nov 25 13:44:08 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Nov 2009 13:44:08 +0100
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <20091125123216.GC2618@khaled-laptop>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop>
	<4B0CF55F.1050809@wxs.nl> <20091125123216.GC2618@khaled-laptop>
Message-ID: <4B0D2698.8090503@wxs.nl>

Khaled Hosny wrote:
> On Wed, Nov 25, 2009 at 10:14:07AM +0100, Hans Hagen wrote:
>> Khaled Hosny wrote:
>>> Though large operator super/subscript are better now, I think it is
>>> still broken. Compare the attached office2007 and luatex generated PDFs.
>> if you look in the font you will notice that the cambria integral
>> signs have a wrong boundingbox (too much white at the right); as it
>> happens, compensating with the italic correction sort of solves this
>> so we guess that word is doing something like that
> 
> I tried to follow the spec, and the result was pretty broken (the sup
> and superscripts came effectively behind the operator), so office is
> expecting Cambria's behaviour from all fonts, so I can't see why new
> fonts will not do the same.

so why only integral and not all characters? what is ms's (otf math) 
definition of italic correction then?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Wed Nov 25 14:22:33 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 25 Nov 2009 15:22:33 +0200
Subject: [Dev-luatex] Cron <luatex@vz3>
 /var/www/luatex.org/www/bin/luatex-svn
In-Reply-To: <4B0D2698.8090503@wxs.nl>
References: <20091123212831.10EF81E8C3F3@www.metatex.org>
	<20091124230230.GA13208@khaled-laptop> <4B0CF55F.1050809@wxs.nl>
	<20091125123216.GC2618@khaled-laptop> <4B0D2698.8090503@wxs.nl>
Message-ID: <20091125132233.GA3531@khaled-laptop>

On Wed, Nov 25, 2009 at 01:44:08PM +0100, Hans Hagen wrote:
> Khaled Hosny wrote:
> >On Wed, Nov 25, 2009 at 10:14:07AM +0100, Hans Hagen wrote:
> >>Khaled Hosny wrote:
> >>>Though large operator super/subscript are better now, I think it is
> >>>still broken. Compare the attached office2007 and luatex generated PDFs.
> >>if you look in the font you will notice that the cambria integral
> >>signs have a wrong boundingbox (too much white at the right); as it
> >>happens, compensating with the italic correction sort of solves this
> >>so we guess that word is doing something like that
> >
> >I tried to follow the spec, and the result was pretty broken (the sup
> >and superscripts came effectively behind the operator), so office is
> >expecting Cambria's behaviour from all fonts, so I can't see why new
> >fonts will not do the same.
> 
> so why only integral and not all characters? what is ms's (otf math)
> definition of italic correction then?

I don't know, this is just what I've found after several hours debugging
the font trying to understand why it doesn't work as expected, it'd have
made my life easier if they followed their own spec from the start.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/de88d829/attachment.pgp>

From doc.evans at gmail.com  Wed Nov 25 22:29:47 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Wed, 25 Nov 2009 14:29:47 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <20091125001749.GB14370@khaled-laptop>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
Message-ID: <4B0DA1CB.7040806@gmail.com>

Khaled Hosny said the following at 11/24/2009 05:17 PM :
> 
> Doing "export CONFIG_SHELL=/bin/bash" is usually enough, as it forces
> using bash (no idea why this isn't the default.)

Yep, that worked. Thank you very much. I spent about half an hour trying to
figure out how to change the shell before I saw your e-mail.

Now to the next question.

The INSTALL file says:

"Post-compilation installation should be a simple matter
of copying the executable to a normal place for web2c
binaries and generating the desired formats."

This might as well say "... should be a simple matter of executing black
magic that you will know if you already know it" :-)

Would anyone care to elaborate on the instructions so that a mere mortal
can accomplish this? [I vaguely recall something about generating a format
file somewhere around 1984. Ampersands played a part, I think. I'm rambling.]

I'm sorry if I'm missing something obvious that I should already know.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/006c7678/attachment.pgp>

From pragma at wxs.nl  Wed Nov 25 22:54:18 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 25 Nov 2009 22:54:18 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DA1CB.7040806@gmail.com>
References: <4B0C4790.4070101@gmail.com>	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>	<4B0C53FB.5080507@gmail.com>
	<20091124220139.GA11430@khaled-laptop>	<4B0C68B5.5020405@gmail.com>
	<20091125001749.GB14370@khaled-laptop> <4B0DA1CB.7040806@gmail.com>
Message-ID: <4B0DA78A.8070405@wxs.nl>

D. R. Evans wrote:
> Khaled Hosny said the following at 11/24/2009 05:17 PM :
>> Doing "export CONFIG_SHELL=/bin/bash" is usually enough, as it forces
>> using bash (no idea why this isn't the default.)
> 
> Yep, that worked. Thank you very much. I spent about half an hour trying to
> figure out how to change the shell before I saw your e-mail.
> 
> Now to the next question.
> 
> The INSTALL file says:
> 
> "Post-compilation installation should be a simple matter
> of copying the executable to a normal place for web2c
> binaries and generating the desired formats."
> 
> This might as well say "... should be a simple matter of executing black
> magic that you will know if you already know it" :-)
> 
> Would anyone care to elaborate on the instructions so that a mere mortal
> can accomplish this? [I vaguely recall something about generating a format
> file somewhere around 1984. Ampersands played a part, I think. I'm rambling.]
> 
> I'm sorry if I'm missing something obvious that I should already know.

i suggest that you download tex live and consult its manual; generating 
formats and putting them in the right spot depends on what macro package 
you use in combination with some distribution

in that case it might be a good idea to start with pdftex etc as that 
has een integrated in distributions for ages

(that kind of support is a bit beyond this list)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Wed Nov 25 22:58:41 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 25 Nov 2009 22:58:41 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DA1CB.7040806@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com>
Message-ID: <20091125215841.GU28824@phare.normalesup.org>

> I'm sorry if I'm missing something obvious that I should already know.

  There's nothing you should already know, but you should be able to look up
that information by yourself.  Installation and distribution are far beyond the
scope of this mailing-list dedicated to LuaTeX developers (and there is a user
list, see http://tug.org/mailman/listinfo/luatex).

  As for your question, you have to understand the basics of kpathsea, the file
lookup library used by most implementations of TeX, and web2c, the actual TeX
implementation.  Documentation should be available as part of your TeX
distribution (if you're using TeX Live, use texdoc to locate documentation),
and also online.  Since you seem to want to use the latest LuaTeX revision
without going through any distribution, you will have to build a tiny
distribution of your own around LuaTeX that suits your needs.

  What I've been using for three years in order to test LuaTeX is to have the
latest LuaTeX binary in some directory, to place symbolic links pointing to TeX
Live's texmf trees two directories higher, and to build the LuaTeX plain format
from the directory where the LuaTeX binary resides, using Knuth's original
plain.tex file.  These days, it's enough to run "./luatex -ini luatex.ini" to
generate the format, where luatex.ini contains

	\input plain
	\directlua{tex.enableprimitives("", tex.extraprimitives())}
	\pdfoutput1
	\dump

  You can then use luatex from the directory where it resides.

	Arthur

From doc.evans at gmail.com  Wed Nov 25 23:46:37 2009
From: doc.evans at gmail.com (D. R. Evans)
Date: Wed, 25 Nov 2009 15:46:37 -0700
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <20091125215841.GU28824@phare.normalesup.org>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com>
	<20091125215841.GU28824@phare.normalesup.org>
Message-ID: <4B0DB3CD.2040109@gmail.com>

Arthur Reutenauer said the following at 11/25/2009 02:58 PM :
>> I'm sorry if I'm missing something obvious that I should already know.
> 
>   There's nothing you should already know, but you should be able to look up
> that information by yourself.  Installation and distribution are far beyond the
> scope of this mailing-list dedicated to LuaTeX developers (and there is a user
> list, see http://tug.org/mailman/listinfo/luatex).
> 

I was going to try to help with development -- at the very least by filing
useful, detailed bug reports but probably by fixing stuff too -- (since I
love TeX and have used C++ since before it was called that) but I had no
idea that it would be so incredibly complicated just to install a current
build in order to make a useful contribution.

I'll go away now. I apologize for interrupting.

  Doc

-- 
Web:  http://www.sff.net/people/N7DR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091125/18cd09a5/attachment.pgp>

From pragma at wxs.nl  Thu Nov 26 00:02:58 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 26 Nov 2009 00:02:58 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DB3CD.2040109@gmail.com>
References: <4B0C4790.4070101@gmail.com>	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>	<4B0C53FB.5080507@gmail.com>
	<20091124220139.GA11430@khaled-laptop>	<4B0C68B5.5020405@gmail.com>
	<20091125001749.GB14370@khaled-laptop>	<4B0DA1CB.7040806@gmail.com>	<20091125215841.GU28824@phare.normalesup.org>
	<4B0DB3CD.2040109@gmail.com>
Message-ID: <4B0DB7A2.9040703@wxs.nl>

D. R. Evans wrote:
> Arthur Reutenauer said the following at 11/25/2009 02:58 PM :
>>> I'm sorry if I'm missing something obvious that I should already know.
>>   There's nothing you should already know, but you should be able to look up
>> that information by yourself.  Installation and distribution are far beyond the
>> scope of this mailing-list dedicated to LuaTeX developers (and there is a user
>> list, see http://tug.org/mailman/listinfo/luatex).
>>
> 
> I was going to try to help with development -- at the very least by filing
> useful, detailed bug reports but probably by fixing stuff too -- (since I
> love TeX and have used C++ since before it was called that) but I had no
> idea that it would be so incredibly complicated just to install a current
> build in order to make a useful contribution.
> 
> I'll go away now. I apologize for interrupting.

if you look at the reguar tex source code base, you will notice that the 
luatex code base already is much simpler as the pascal -> c conversion 
is gone

for the rest: tex is not just a program, but also macros, fonts, and 
other resources and normally a distribution takes care of that, 
including updating formats and those concepts have not changes with 
luatex (although some aspects like fonts and patterns have)

concerning binaries ... right from the start of the luatex project there 
have always been recent binaries and therefore no need for doing 
compilation yourself

for what it's worth ... many context users use luatex in combination 
with a luatex aware version of context and updating to the latest 
greatest is pretty simple due to mostly automated updating of the tree 
and also quite some architectures are supported; the users' biggest 
problem might be that they are testing unstable (new) functionality ...

so, maybe starting at the binary-generating end of the game without some 
experience in updating a regular tex tree (including format generation) 
was not handy; also, having a binary is one thing, using the lua 
interfaces in luatex is yet another step

as texlive ships with the stable version of luatex, why don't you just 
install tex live 2009; dealing with betas is not a good idea if you are 
unfamiliar with luatex anyway

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Thu Nov 26 01:25:09 2009
From: preining at logic.at (Norbert Preining)
Date: Thu, 26 Nov 2009 01:25:09 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DA78A.8070405@wxs.nl>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com> <4B0DA78A.8070405@wxs.nl>
Message-ID: <20091126002509.GI5809@gamma.logic.tuwien.ac.at>

On Mi, 25 Nov 2009, Hans Hagen wrote:
> (that kind of support is a bit beyond this list)

Agreed, far beyond in fact. People playing with luatex *should* have 
a thorough understand of how a TeX system works.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining                                        Associate Professor
JAIST Japan Advanced Institute of Science and Technology   preining at jaist.ac.jp
Vienna University of Technology                               preining at logic.at
Debian Developer (Debian TeX Task Force)                    preining at debian.org
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
KERRY (n.)
The small twist of skin which separated each sausage on a string.
			--- Douglas Adams, The Meaning of Liff

From preining at logic.at  Thu Nov 26 01:26:38 2009
From: preining at logic.at (Norbert Preining)
Date: Thu, 26 Nov 2009 01:26:38 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DB3CD.2040109@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com>
	<20091125215841.GU28824@phare.normalesup.org>
	<4B0DB3CD.2040109@gmail.com>
Message-ID: <20091126002638.GJ5809@gamma.logic.tuwien.ac.at>

On Mi, 25 Nov 2009, D. R. Evans wrote:
> I was going to try to help with development -- at the very least by filing
[...]
> I'll go away now. I apologize for interrupting.

Oh one more of those, the list is getting longer, didn't know they
start to show up even here.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining                                        Associate Professor
JAIST Japan Advanced Institute of Science and Technology   preining at jaist.ac.jp
Vienna University of Technology                               preining at logic.at
Debian Developer (Debian TeX Task Force)                    preining at debian.org
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
NEMPNETT THRUBWELL (n.)
The feeling experienced when driving off for the frist time on a brand
new motorbike.
			--- Douglas Adams, The Meaning of Liff

From khaledhosny at eglug.org  Thu Nov 26 01:38:23 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 26 Nov 2009 02:38:23 +0200
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <4B0DA1CB.7040806@gmail.com>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com>
Message-ID: <20091126003823.GA4824@khaled-laptop>

On Wed, Nov 25, 2009 at 02:29:47PM -0700, D. R. Evans wrote:
> Khaled Hosny said the following at 11/24/2009 05:17 PM :
> > 
> > Doing "export CONFIG_SHELL=/bin/bash" is usually enough, as it forces
> > using bash (no idea why this isn't the default.)
> 
> Yep, that worked. Thank you very much. I spent about half an hour trying to
> figure out how to change the shell before I saw your e-mail.
> 
> Now to the next question.
> 
> The INSTALL file says:
> 
> "Post-compilation installation should be a simple matter
> of copying the executable to a normal place for web2c
> binaries and generating the desired formats."
> 
> This might as well say "... should be a simple matter of executing black
> magic that you will know if you already know it" :-)

Well, I simply do "cp build/texk/web2c/luatex `which luatex`" and then
"fmtutil --byfmt luatex" (or better "fmtutil --byengine luatex" for
texlive 2009) and let the magic work, though this means I'm left with
unstable luatex and no way for the distribution provided version to
coexist.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091126/feac76c4/attachment.pgp>

From preining at logic.at  Thu Nov 26 01:44:08 2009
From: preining at logic.at (Norbert Preining)
Date: Thu, 26 Nov 2009 01:44:08 +0100
Subject: [Dev-luatex] build-latest-code-from-source instructions?
In-Reply-To: <20091126003823.GA4824@khaled-laptop>
References: <4B0C4790.4070101@gmail.com>
	<8CE3F66A-8CDE-473D-B8F6-A8199D10736D@googlemail.com>
	<4B0C53FB.5080507@gmail.com> <20091124220139.GA11430@khaled-laptop>
	<4B0C68B5.5020405@gmail.com> <20091125001749.GB14370@khaled-laptop>
	<4B0DA1CB.7040806@gmail.com> <20091126003823.GA4824@khaled-laptop>
Message-ID: <20091126004408.GN5809@gamma.logic.tuwien.ac.at>

On Do, 26 Nov 2009, Khaled Hosny wrote:
> Well, I simply do "cp build/texk/web2c/luatex `which luatex`" and then
> "fmtutil --byfmt luatex" (or better "fmtutil --byengine luatex" for
> texlive 2009) and let the magic work, though this means I'm left with
> unstable luatex and no way for the distribution provided version to
> coexist.

fmtutil-sys might be the better option. But on a single user system
it doesn't make a difference.

And yes, --byengine is by far the best method for that.
(why didn't I implement that 4 years ago when packaging TL2005 for Debian,
it makes everything much easier ;-)


Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining                                        Associate Professor
JAIST Japan Advanced Institute of Science and Technology   preining at jaist.ac.jp
Vienna University of Technology                               preining at logic.at
Debian Developer (Debian TeX Task Force)                    preining at debian.org
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
ESHER (n.)
One of those push tapes installed in public washrooms enabling the
user to wash their trousers without actually getting into the
basin. The most powerful esher of recent years was 'damped down' by
Red Adair after an incredible sixty-eight days' fight in Manchester's
Piccadilly Station.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Thu Nov 26 15:28:54 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 26 Nov 2009 15:28:54 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <alpine.DEB.1.00.0911230058170.14988@hahepc1.hahe>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl> <4B06C742.1090107@elvenkind.com>
	<alpine.DEB.1.00.0911230058170.14988@hahepc1.hahe>
Message-ID: <4B0E90A6.1060200@elvenkind.com>


Hi,

Hartmut Henkel wrote:
> On Fri, 20 Nov 2009, Taco Hoekwater wrote:
>> Pawe? Jackowski wrote:
>>> So once you say
>>>
>>>   pdf.obj{type = "stream", string = string.char(255)}
>>>   pdf.obj("stream", string.char(255))
>>>
>>> you don't use an explicit string, but you still get the error.
>> This error we can avoid with a simple patch to luatex.
>>
>> Currently the stream is still converted to a token list, while
>> there is absolutely no reason to do so.
>>
>> Reopened the tracker
> 
> fwiw,
> 
>     pdf.obj{type = "stream", immediate=true, string = string.char(255)}
> 
> should already work (no token list used). i'll try to fix the
> non-immediate case (likely by luaL_ref()).

I hope you don't mind that I fixed it. I want to release 0.46 this
afternoon.

Best wishes,
Taco

From taco at elvenkind.com  Thu Nov 26 16:27:16 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 26 Nov 2009 16:27:16 +0100
Subject: [Dev-luatex] Luatex 0.46.0 announcement
Message-ID: <4B0E9E54.7070005@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.46.0.

There are two important reason for this release:

* It fixes an xform bug that is quite serious as it produces
  invalid pdf files (see below)

* There is now experimental support for loading external .dll/.so
  files for lua extension modules. Copied from a message I sent to
  the dev-luatex list a few days ago:

> I have committed an experimental patch that
> enables dynamic loading for external compiled libraries unless --safer
> is given on the command-line.
> 
> It is experimental because:
> 
> * it assumes that all architectures except windows will be happy with
>   using dlopen (windows has its own code which does not need compile-
>   time support, but you have to have an installed lua51.dll from e.g.
>   http://luabinaries.luaforge.net ).
> 
> * I made only minimal changes to kpathsea.
> 
> * there may be lua libraries out there that fail horribly.
> 
> As with pure lua require() files, luatex will only use kpathsea if the
> library is initialized already.
> 
> kpathsea changes in detail:
> 
> I added the kpse_clua_format identifier that searches for files with
> extension .dll and .so. The texmf.cnf setting for this variable is
> CLUAINPUTS, and by default it has this value:
> 
> CLUAINPUTS=.:$SELFAUTOLOC/lib/{$progname,$engine,}/lua//
> 
> This is the best I could do on short notice: the architecture has to
> be in the path somewhere, and the fastest way to do that is to search
> below the binary directory only.
> 
> One level up (lib parallel to bin) would have been nicer, as the
> context minimals have arch and bin swapped (texmf-linux/bin as opposed
> to bin/i386-linux) but that would not have worked in texlive.

If you know how to compile dynamic libraries on your platform,
a good library to play with is Lua BitOp, http://bitop.luajit.org/
(single C source file and comes with a nice test lua script).


And here is the normal list of features and bugfixes in 0.46.0
--------------------------------------------------------------

New features:

* The build.sh script now has better support for new MacOSX-es
  (patch from Mojca).

* Luatex now has experimental support for dynamic loading of
  external compiled lua libraries. Building luatex and loading
  external .so/.dll files is reported to work on Windows,
  linux and osx, other platforms are still unknown.

* pdf.obj{type="stream"} no longer converts its argument to and
  from a tokenlist. This allows the use of binary data in the
  "string" argument. Such data does still have to hidden from
  the normal file parser by putting the code in a dofile()
  or by using string.char(), though.

Bug fixes:

* Luatex 0.45.0 was not able to find truetype nor opentype fonts
  if there were no callbacks defined (patch from Pawel).

* 0.45.0 printed the user input instead of the full pathname
  for \input-ed tex files.

* The TFM reader now rejects fonts with tfm names that are
  longer than 255 characters because such font names cannot
  be stored in a DVI file.

* The combination of \immediate\pdfxform followed by a later
  \pdfrefxform could cause broken pdf output files because
  the box used for the form could have been freed and even
  reused already at that moment in time, sometimes resulting
  in an invalid transformation matrix.

* The placement of super- and subscripts for displaystyle
  \int's in CambriaMath is now better than before. It still
  needs a tweak to the metrics though: in the current version,
  the italic correction has to be substracted from the width
  of the integral sign to get correct placement (context mkiv
  does this).  to be continued ...



The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.46.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco


From root at www.metatex.org  Thu Nov 26 16:31:13 2009
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 26 Nov 2009 16:31:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091126153113.10CD31E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r3192 | taco | 2009-11-26 15:14:10 +0100 (Thu, 26 Nov 2009) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

add a quick and dirty fix for pdfs generated by easyPDF Printer Driver 4.2,
which uses full font dictionaries inside the Font resources instead of 
indirect references.

------------------------------------------------------------------------
r3193 | taco | 2009-11-26 15:16:59 +0100 (Thu, 26 Nov 2009) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.c

For pdf.obj(type='stream'), there is no need to go through a tokenlist.
This patch sets obj_obj_is_stream and perhaps obj_obj_is_file to 2,
which signals that obj_obj_data is a lua registry reference instead
of a tokenlist.

------------------------------------------------------------------------
r3194 | taco | 2009-11-26 16:04:08 +0100 (Thu, 26 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/NEWS
   M /trunk/source/texk/web2c/luatexdir/luatex.c

bump the version and update NEWS for a new release

------------------------------------------------------------------------
r3195 | taco | 2009-11-26 16:06:47 +0100 (Thu, 26 Nov 2009) | 2 lines
Changed paths:
   A /tags/beta-0.46.0 (from /trunk:3194)

new tag

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Thu Nov 26 19:39:16 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Thu, 26 Nov 2009 19:39:16 +0100
Subject: [Dev-luatex] [luatex 0000283]: PDF streams data should not be
 validated in UTF-8 regime
In-Reply-To: <4B0E90A6.1060200@elvenkind.com>
References: <f590b7da05147cc5083d57ac3b4f1384@tracker.luatex.org>
	<4B06A647.7050706@gust.org.pl> <4B06C742.1090107@elvenkind.com>
	<alpine.DEB.1.00.0911230058170.14988@hahepc1.hahe>
	<4B0E90A6.1060200@elvenkind.com>
Message-ID: <4B0ECB54.5070804@gust.org.pl>

Hartmut
>> should already work (no token list used). i'll try to fix the
>> non-immediate case (likely by luaL_ref()).

Taco
> I hope you don't mind that I fixed it. I want to release 0.46 this
> afternoon.

Both immediate and non-immediate cases works perfect.
Thank you!
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From t34www at googlemail.com  Fri Nov 27 00:00:05 2009
From: t34www at googlemail.com (T T)
Date: Thu, 26 Nov 2009 23:00:05 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0B9A90.3030804@wxs.nl>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
	<19211.7148.455796.505022@zaphod.ms25.net> <4B0B9A90.3030804@wxs.nl>
Message-ID: <e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>

2009/11/24 Hans Hagen <pragma at wxs.nl>:
> Reinhard Kotucha wrote:
>>
>> On 23 November 2009 Taco Hoekwater wrote:
>>
>> ?> Let's put it this way: windows command line processing does not
>> ?> agree with my neurons, so I have stayed way from it as much as
>> ?> possible (and will continue to do so).
>> ?> ?> A good, clean patch would be welcome of course, [...]
>>
>> Hi Taco,
>> if you change anything though, please inform the TeX Live team in
>> advance. ?We probably have to adapt our scripts then. ?The scripts
>> already provide a function:
>
> don't worry changes in these mechanism will never show up in stable versions
> unannounced as it will likely influence many; of course, as long as luatex
> functionality is not declared frozen we take the freedom to change things,
> but in this case the fact that texlua is used for scripts in tex
> distributions asks for extra care
>
> as far as i can see the main problem is *not* in the interface, it's just
> that the underlying windows function cannot deal with spaces in the program
> location specification and that (at some point) probably be solved in a
> compatible way

I could it give a go and try to implement something that makes sense
on Windows. The _spawnvpe function takes four arguments and two of
them, cmdname (command path/name) and argv array, are of interest
here.

There are two cases to consider:

(1) String argument cmd_string to os.exec/os.spawn

It doesn't make sense to parse this string into argv, because
_spawnvpe will concatenate it back into single string anyway (because
that's required by CreateProcess API), but any quotation of arguments
will be lost on the way (because _spawnvpe is incredibly dumb).

Instead we can take:
argv[0] := cmd_string
argv[1] := NULL
cmdname = <first argument from cmd_string striped from quotes>

This way we can full _spawnvpe to pass the command string as is
directly to the CreateProcess API.

(2) Table argument cmd_table to os.exec/os.spawn

argv := cmd_table
if argv[0] == NULL {
  argv[0] = <argv[1] striped from quotes>
}


The above changes do not change the behaviour of currently working
cases, only the failing ones and those resulting in wrongly parsed
arguments being passed to the child process are affected.

If that proposal sounds OK to you, I will write a patch implementing it.

Cheers,

Tomek

From taco at elvenkind.com  Fri Nov 27 07:54:52 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 27 Nov 2009 07:54:52 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	<4B0ACCBD.6090109@elvenkind.com>	<19211.7148.455796.505022@zaphod.ms25.net>
	<4B0B9A90.3030804@wxs.nl>
	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>
Message-ID: <4B0F77BC.2040209@elvenkind.com>

T T wrote:
> The above changes do not change the behaviour of currently working
> cases, only the failing ones and those resulting in wrongly parsed
> arguments being passed to the child process are affected.
> 
> If that proposal sounds OK to you, I will write a patch implementing it.

Yes, please do!

Best wishes,
Taco

From t34www at googlemail.com  Fri Nov 27 17:26:52 2009
From: t34www at googlemail.com (T T)
Date: Fri, 27 Nov 2009 16:26:52 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0F77BC.2040209@elvenkind.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
	<19211.7148.455796.505022@zaphod.ms25.net> <4B0B9A90.3030804@wxs.nl>
	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>
	<4B0F77BC.2040209@elvenkind.com>
Message-ID: <e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>

2009/11/27 Taco Hoekwater <taco at elvenkind.com>:
> T T wrote:
>>
>> The above changes do not change the behaviour of currently working
>> cases, only the failing ones and those resulting in wrongly parsed
>> arguments being passed to the child process are affected.
>>
>> If that proposal sounds OK to you, I will write a patch implementing it.
>
> Yes, please do!

OK. I need to test the patch now, so a few questions more.

A few days ago I managed to compile the current trunk on mingw (am I
being lucky or is this officially supported?) but this takes ages. My
changes are limited to just one file (loslibext.c). Is there some way
to quickly rebuild only what's needed?

Cheers,

Tomek

From taco at elvenkind.com  Fri Nov 27 17:30:58 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 27 Nov 2009 17:30:58 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	
	<4B0ACCBD.6090109@elvenkind.com>	
	<19211.7148.455796.505022@zaphod.ms25.net>
	<4B0B9A90.3030804@wxs.nl>	
	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>	
	<4B0F77BC.2040209@elvenkind.com>
	<e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>
Message-ID: <4B0FFEC2.1020203@elvenkind.com>



T T wrote:
> 2009/11/27 Taco Hoekwater <taco at elvenkind.com>:
>> T T wrote:
>>> The above changes do not change the behaviour of currently working
>>> cases, only the failing ones and those resulting in wrongly parsed
>>> arguments being passed to the child process are affected.
>>>
>>> If that proposal sounds OK to you, I will write a patch implementing it.
>> Yes, please do!
> 
> OK. I need to test the patch now, so a few questions more.
> 
> A few days ago I managed to compile the current trunk on mingw (am I
> being lucky or is this officially supported?) but this takes ages. My
> changes are limited to just one file (loslibext.c). Is there some way
> to quickly rebuild only what's needed?

  $ ./build.sh --make

(for a somewhat broad definition of 'only', but still much better than
re-running configure).

Best wishes,
Taco

From P.Jackowski at gust.org.pl  Fri Nov 27 17:35:01 2009
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Fri, 27 Nov 2009 17:35:01 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	<4B0ACCBD.6090109@elvenkind.com>	<19211.7148.455796.505022@zaphod.ms25.net>
	<4B0B9A90.3030804@wxs.nl>	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>	<4B0F77BC.2040209@elvenkind.com>
	<e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>
Message-ID: <4B0FFFB5.8020601@gust.org.pl>

T T wrote:
> 2009/11/27 Taco Hoekwater <taco at elvenkind.com>:
>> T T wrote:
>>> The above changes do not change the behaviour of currently working
>>> cases, only the failing ones and those resulting in wrongly parsed
>>> arguments being passed to the child process are affected.
>>>
>>> If that proposal sounds OK to you, I will write a patch implementing it.
>> Yes, please do!
> 
> OK. I need to test the patch now, so a few questions more.
> 
> A few days ago I managed to compile the current trunk on mingw (am I
> being lucky or is this officially supported?) but this takes ages. My
> changes are limited to just one file (loslibext.c). Is there some way
> to quickly rebuild only what's needed?

build --make

doesn't work for you?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From t34www at googlemail.com  Fri Nov 27 18:30:18 2009
From: t34www at googlemail.com (T T)
Date: Fri, 27 Nov 2009 17:30:18 +0000
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <4B0FFEC2.1020203@elvenkind.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>
	<4B0ACCBD.6090109@elvenkind.com>
	<19211.7148.455796.505022@zaphod.ms25.net> <4B0B9A90.3030804@wxs.nl>
	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>
	<4B0F77BC.2040209@elvenkind.com>
	<e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>
	<4B0FFEC2.1020203@elvenkind.com>
Message-ID: <e7fba2610911270930i30ab6e4ap5ef5e640ee1c1967@mail.gmail.com>

2009/11/27 Taco Hoekwater <taco at elvenkind.com>:
>
>
> T T wrote:
>> 2009/11/27 Taco Hoekwater <taco at elvenkind.com>:
>>> T T wrote:
>>>> The above changes do not change the behaviour of currently working
>>>> cases, only the failing ones and those resulting in wrongly parsed
>>>> arguments being passed to the child process are affected.
>>>>
>>>> If that proposal sounds OK to you, I will write a patch implementing it.
>>> Yes, please do!
>>
>> OK. I need to test the patch now, so a few questions more.
>>
>> A few days ago I managed to compile the current trunk on mingw (am I
>> being lucky or is this officially supported?) but this takes ages. My
>> changes are limited to just one file (loslibext.c). Is there some way
>> to quickly rebuild only what's needed?
>
> ?$ ./build.sh --make
>
> (for a somewhat broad definition of 'only', but still much better than
> re-running configure).

Indeed. The patch is attached. It did work for me as intended, but
please review.

I also made adjustments to build.sh for mingw, see below:

Cheers,

Tomek

Index: build.sh
===================================================================
--- build.sh	(revision 3195)
+++ build.sh	(working copy)
@@ -51,10 +51,10 @@
 STRIP=strip
 LUATEXEXE=luatex

-if [ `uname` = "Darwin" ] ;
-then
-   export MACOSX_DEPLOYMENT_TARGET=10.4
-fi;
+case `uname` in
+  Darwin      ) export MACOSX_DEPLOYMENT_TARGET=10.4 ;;
+  MINGW32*    ) LUATEXEXE=luatex.exe ;;
+esac

 B=build
 CONFHOST=
-------------- next part --------------
A non-text attachment was scrubbed...
Name: loslibext.c.patch
Type: text/patch
Size: 2835 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-luatex/attachments/20091127/8eb1326a/attachment.bin>

From taco at elvenkind.com  Sun Nov 29 11:58:33 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 29 Nov 2009 11:58:33 +0100
Subject: [Dev-luatex] os.spawn and argv[1] with sapces
In-Reply-To: <e7fba2610911270930i30ab6e4ap5ef5e640ee1c1967@mail.gmail.com>
References: <e7fba2610911230941q1b7d86bew8285ea63b19c208a@mail.gmail.com>	
	<4B0ACCBD.6090109@elvenkind.com>	
	<19211.7148.455796.505022@zaphod.ms25.net>
	<4B0B9A90.3030804@wxs.nl>	
	<e7fba2610911261500n7438d1b7jaec9dc222645ecb9@mail.gmail.com>	
	<4B0F77BC.2040209@elvenkind.com>	
	<e7fba2610911270826ne26cbd3k8c778356aa74b1da@mail.gmail.com>	
	<4B0FFEC2.1020203@elvenkind.com>
	<e7fba2610911270930i30ab6e4ap5ef5e640ee1c1967@mail.gmail.com>
Message-ID: <4B1253D9.1000106@elvenkind.com>

T T wrote:
> 
> Indeed. The patch is attached. It did work for me as intended, but
> please review.

Applied and looks ok, but I cannot actually test this.

> I also made adjustments to build.sh for mingw, see below:

Added the MINGW part of that patch also.

Best wishes,
Taco

From root at www.metatex.org  Sun Nov 29 12:31:22 2009
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 29 Nov 2009 12:31:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091129113122.2D986788014@www.metatex.org>

------------------------------------------------------------------------
r3196 | taco | 2009-11-29 11:54:29 +0100 (Sun, 29 Nov 2009) | 2 lines
Changed paths:
   M /trunk/build.sh
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c

os.spawn patch for win32 from Tomek

------------------------------------------------------------------------
r3197 | taco | 2009-11-29 12:07:45 +0100 (Sun, 29 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.h

add lstring type

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov 30 12:30:38 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 30 Nov 2009 12:30:38 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091130113038.867DE788014@www.metatex.org>

------------------------------------------------------------------------
r3198 | taco | 2009-11-30 11:47:37 +0100 (Mon, 30 Nov 2009) | 6 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c

Protruding can always run find_protchar_right these days, because
the discretionaries are unfolded earlier. This is also a bugfix,
because the pre-break text of a discretionary can end with a
dir_node.


------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov 30 16:28:48 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 30 Nov 2009 16:28:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091130152848.F3564788014@www.metatex.org>

------------------------------------------------------------------------
r3199 | taco | 2009-11-30 14:25:17 +0100 (Mon, 30 Nov 2009) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c

fix a bug for \lastbox in the presence of direction nodes
(the direction nodes are now placed before the indentation box)

------------------------------------------------------------------------

From root at www.metatex.org  Mon Nov 30 22:30:05 2009
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 30 Nov 2009 22:30:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20091130213005.3157F788014@www.metatex.org>

------------------------------------------------------------------------
r3200 | taco | 2009-11-30 17:54:23 +0100 (Mon, 30 Nov 2009) | 2 lines
Changed paths:
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/PDFDoc.cc

patch xpdf to prevent bug #294

------------------------------------------------------------------------

