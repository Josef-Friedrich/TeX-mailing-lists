From Jonathan.Sauer at silverstroke.com  Tue Apr  1 09:54:48 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 1 Apr 2008 09:54:48 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
Message-ID: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>

Hello,

the following PlainTeX document produces unexpected results while
hyphenating the word "Streifz?ge":

--------------------------------------------------------------------

\hyphenation{Streif-z?-ge}

Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge

Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge

\showhyphens{Streifz?ge}

\showhyphens{Streif\-z?\-ge}

\bye

--------------------------------------------------------------------

This is LuaTeX, Version snapshot-0.25.0-2008031419 (Web2C 7.5.6) (format=luatex 2008.3.14)  30 MAR 2008 22:29
**HyphenationProblem.tex
(HyphenationProblem.tex
Overfull \hbox (5.02353pt too wide) in paragraph at lines 5--9
\tenrm Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge 
Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge|

\hbox(6.94444+1.94444)x469.75499, glue set - 1.0, direction TLT
.\tenrm S
.\tenrm t
.\tenrm r
.\tenrm e
.\tenrm i
.etc.


Underfull \hbox (badness 10000) in paragraph at lines 15--15
[][] \tenrm Streifz?ge

\hbox(6.94444+1.94444)x16383.99998, glue set 9793.94307, direction TLT []


Underfull \hbox (badness 10000) in paragraph at lines 17--17
[][] \tenrm Streif-z?-ge

\hbox(6.94444+1.94444)x16383.99998, glue set 9793.94307, direction TLT []

[1] )
Output written on HyphenationProblem.dvi (1 page, 1052 bytes).

--------------------------------------------------------------------

As you can see, I explicitly specify the hyphenation points for
"Streifz?ge", but for some reason LuaTeX does not hyphenate it
automatically. Only when I specify the hyphenation points in the
text, does the word get hyphenated.

Am I doing something wrong?


Jonathan


From dak at gnu.org  Tue Apr  1 10:55:06 2008
From: dak at gnu.org (David Kastrup)
Date: Tue, 01 Apr 2008 10:55:06 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Tue, 1 Apr 2008 09:54:48 +0200")
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
Message-ID: <86zlse0xat.fsf@lola.quinscape.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> Hello,
>
> the following PlainTeX document produces unexpected results while
> hyphenating the word "Streifz?ge":
>
> --------------------------------------------------------------------
>
> \hyphenation{Streif-z?-ge}
>
> Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
> Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
> Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
> Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge Streifz?ge
>
> Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
> Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
> Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
> Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge Streif\-z?\-ge
>
> \showhyphens{Streifz?ge}
>
> \showhyphens{Streif\-z?\-ge}
>
> \bye

Actually, there is not much unexpected to me except that the
\hyphenation command gets accepted in spite of ? being a non-letter.

Compare with the results when using standard TeX.

-- 
David Kastrup

From taco at elvenkind.com  Tue Apr  1 10:59:27 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 01 Apr 2008 10:59:27 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <86zlse0xat.fsf@lola.quinscape.zz>
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
	<86zlse0xat.fsf@lola.quinscape.zz>
Message-ID: <47F1F96F.1060902@elvenkind.com>



David Kastrup wrote:
> 
> Actually, there is not much unexpected to me except that the
> \hyphenation command gets accepted in spite of ? being a non-letter.
> 
> Compare with the results when using standard TeX.

That is on purpose, luatex is not TeX.

Best wishes,
Taco



From taco at elvenkind.com  Tue Apr  1 10:47:50 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 01 Apr 2008 10:47:50 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
Message-ID: <47F1F6B6.30608@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> --------------------------------------------------------------------
> 
> As you can see, I explicitly specify the hyphenation points for
> "Streifz?ge", but for some reason LuaTeX does not hyphenate it
> automatically. Only when I specify the hyphenation points in the
> text, does the word get hyphenated.
> 
> Am I doing something wrong?

You are missing two things:

* the \lccode of ? has to be nonzero for it to be a valid
   word constituent
* The font cmr10 doesn't have an ? glyph

With the addition of

   \lccode`?=`?
   \font\tenrm=ec-lmr10 \tenrm

I get proper typesetting (with hyphenation) of your test file.

Best wishes,
Taco



From Jonathan.Sauer at silverstroke.com  Tue Apr  1 11:20:26 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 1 Apr 2008 11:20:26 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
	<47F1F6B6.30608@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>

Hello,

> > Am I doing something wrong?
> 
> You are missing two things:
> 
> * the \lccode of ? has to be nonzero for it to be a valid
>    word constituent

Oh. I thought since hyphenation has been completely been revamped,
the requirement of a non-zero \lccode has been removed. Especially
since I did not get an error message (IIRC, the original TeX
complained about this, at least in \pattern).

> * The font cmr10 doesn't have an ? glyph

Of course. But this should not affect the possible hyphenation
points, or should it?


> Best wishes,
> Taco

Jonathan


From dak at gnu.org  Tue Apr  1 11:58:42 2008
From: dak at gnu.org (David Kastrup)
Date: Tue, 01 Apr 2008 11:58:42 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Tue, 1 Apr 2008 11:20:26 +0200")
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>
	<47F1F6B6.30608@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>
Message-ID: <86iqz128x9.fsf@lola.quinscape.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> Hello,
>
>> > Am I doing something wrong?
>> 
>> You are missing two things:
>> 
>> * the \lccode of ? has to be nonzero for it to be a valid
>>    word constituent
>
> Oh. I thought since hyphenation has been completely been revamped,
> the requirement of a non-zero \lccode has been removed. Especially
> since I did not get an error message (IIRC, the original TeX
> complained about this, at least in \pattern).

That's what I thought as well.  Clarification would be welcome.

-- 
David Kastrup

From taco at elvenkind.com  Tue Apr  1 12:39:45 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 01 Apr 2008 12:39:45 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>	<47F1F6B6.30608@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>
Message-ID: <47F210F1.6000505@elvenkind.com>


Hi,

Jonathan Sauer wrote:
> Hello,
> 
>>> Am I doing something wrong?
>> You are missing two things:
>>
>> * the \lccode of ? has to be nonzero for it to be a valid
>>    word constituent
> 
> Oh. I thought since hyphenation has been completely been revamped,
> the requirement of a non-zero \lccode has been removed. Especially

It actually was gone for a while (\lccodes were not in the new
hyphenation codebase in the initial rewrite), but then I realised that
that gives big problems with words followed by punctuation. So I had
to reinsert the  code in the hyphenation algorithm.

> since I did not get an error message (IIRC, the original TeX
> complained about this, at least in \pattern).

I never bothered to restore the error (or at least not for
\hyphenation), because it was not all that useful an error to
begin with: it is only a potential error at this point,
a following bit of code can still change the \lccodes if
it wants to (even revert to zero).

A better solution for this 'what is a word' problem would be nice.
Perhaps one will be offered by the Google Summer of Code; one of
the proposed projects is "Better unicode support".

>> * The font cmr10 doesn't have an ? glyph
> 
> Of course. But this should not affect the possible hyphenation
> points, or should it?

No, it shouldn't.

Best wishes,
Taco

From root at www.metatex.org  Tue Apr  1 16:22:09 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  1 Apr 2008 16:22:09 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080401142324.48AD21E8C2AA@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/lua/psout.w
 U    svn/trunk/src/texk/web2c/luatexdir/lua/mp.w
 U    svn/trunk/src/texk/web2c/luatexdir/lua/ltexlib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lmplib.c
 U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 1133.

From Jonathan.Sauer at silverstroke.com  Wed Apr  2 09:09:17 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 2 Apr 2008 09:09:17 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>	<47F1F6B6.30608@elvenkind.com><9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>
	<47F210F1.6000505@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABBA@s-yellow.net.silverstroke.de>

Hello,

> >>> Am I doing something wrong?
> >> You are missing two things:
> >>
> >> * the \lccode of ? has to be nonzero for it to be a valid
> >>    word constituent

Now it works perfectly. Thanks!

> A better solution for this 'what is a word' problem would be nice.
> Perhaps one will be offered by the Google Summer of Code; one 
> of the proposed projects is "Better unicode support".

Why not check for catcode 11?


SCNR,
Jonathan


From taco at elvenkind.com  Wed Apr  2 11:33:10 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Apr 2008 11:33:10 +0200
Subject: [Dev-luatex] Problem using umlaut in hyphenation
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABBA@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABB7@s-yellow.net.silverstroke.de>	<47F1F6B6.30608@elvenkind.com><9343542E664B894484613D106D7D3F5F84ABB9@s-yellow.net.silverstroke.de>	<47F210F1.6000505@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABBA@s-yellow.net.silverstroke.de>
Message-ID: <47F352D6.1050106@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
>>>>> Am I doing something wrong?
>>>> You are missing two things:
>>>>
>>>> * the \lccode of ? has to be nonzero for it to be a valid
>>>>    word constituent
> 
> Now it works perfectly. Thanks!
> 
>> A better solution for this 'what is a word' problem would be nice.
>> Perhaps one will be offered by the Google Summer of Code; one 
>> of the proposed projects is "Better unicode support".
> 
> Why not check for catcode 11?

It would still be the same problem, only with a different variable.
And \lccode could not be removed even then, it is needed for
downcasing words. Otherwise, all pattern files would have to contain
all patterns for uppercase letters as well.

Best wishes,
Taco


From root at www.metatex.org  Wed Apr  2 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  2 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080402142320.20F471E8C2AA@www.metatex.org>

U    svn/trunk/src/libs/luapeg/lpeg.c
 U    svn/trunk/src/texk/web2c/luatexdir/makecpool.c
 U    svn/trunk/manual/luatexref-t.tex
 Checked out revision 1137.

From preining at logic.at  Thu Apr  3 18:09:41 2008
From: preining at logic.at (Norbert Preining)
Date: Thu, 3 Apr 2008 18:09:41 +0200
Subject: [Dev-luatex] writing a rmdir function in texlua
Message-ID: <20080403160941.GB2740@gamma.logic.tuwien.ac.at>

Hi all,

for the TeX Live uninstaller I am trying to write a rmdir function for
win32 in texlua which should work like rm -rf on unix.

My first try was:
function rmdir(dirn)
  if os.type == 'windows' then
    -- we have to replace all / with \
    foo = string.gsub(dirn, '/', '\\')
    ret = os.spawn({"rmdir", "/s", "/q", foo})
  else
    ret = os.spawn({"rm", "-rf", dirn})
  end
  if ret then
    return ret
  else
    io.stderr:write(filename..': removing '..dirn.." didn't work\n")
  end
  return ret
end

(No checks by now, will come later ...)

But that didn't work and did spit out always the io.stderr message.

Any suggestion how to do that? Or is there some code already somewhere
around in the ConTeXt project?


Thanks and all the best


Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
Queasy but umbowed. The kind of feeling one gets when discovering a
plastic compartment in a fridge in which thing are growing.
			--- Douglas Adams, The Meaning of Liff

From pragma at wxs.nl  Thu Apr  3 18:24:30 2008
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 03 Apr 2008 18:24:30 +0200
Subject: [Dev-luatex] writing a rmdir function in texlua
In-Reply-To: <20080403160941.GB2740@gamma.logic.tuwien.ac.at>
References: <20080403160941.GB2740@gamma.logic.tuwien.ac.at>
Message-ID: <47F504BE.4030305@wxs.nl>

Norbert Preining wrote:
> Hi all,
> 
> for the TeX Live uninstaller I am trying to write a rmdir function for
> win32 in texlua which should work like rm -rf on unix.
> 
> My first try was:
> function rmdir(dirn)
>   if os.type == 'windows' then
>     -- we have to replace all / with \
>     foo = string.gsub(dirn, '/', '\\')
>     ret = os.spawn({"rmdir", "/s", "/q", foo})
>   else
>     ret = os.spawn({"rm", "-rf", dirn})
>   end
>   if ret then
>     return ret
>   else
>     io.stderr:write(filename..': removing '..dirn.." didn't work\n")
>   end
>   return ret
> end
> 
> (No checks by now, will come later ...)
> 
> But that didn't work and did spit out always the io.stderr message.

rmdir is a system command

(1) use os.execute for system commands
(2) in the case of gnutools (you can never be sure it they are 
installed, use the funny cygwin syntax or so)

anyhow, this works:

function rmdir(name)
     if os.type == 'windows' then
         os.execute("rmdir /s /q " .. name:gsub('/', '\\'))
     else
         os.spawn({"rm", "-rf", dirn})
     end
     local ok = lfs.attributes(name)
     if ok then
         io.stderr:write(string.format("removing '%s' didn't work our 
well\n",name))
     end
     return ok
end

concerning your code:

 >   if os.type == 'windows' then
 >     foo = string.gsub(dirn, '/', '\\')
 >     ret = os.spawn({"rmdir", "/s", "/q", foo})

     local ret
     if os.type == 'windows' then
       local foo = string.gsub(dirn, '/', '\\')
       ret = os.spawn({"rmdir", "/s", "/q", foo})

in order not to polute the global namespace


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Thu Apr  3 18:34:24 2008
From: preining at logic.at (Norbert Preining)
Date: Thu, 3 Apr 2008 18:34:24 +0200
Subject: [Dev-luatex] writing a rmdir function in texlua
In-Reply-To: <47F504BE.4030305@wxs.nl>
References: <20080403160941.GB2740@gamma.logic.tuwien.ac.at>
	<47F504BE.4030305@wxs.nl>
Message-ID: <20080403163424.GC2740@gamma.logic.tuwien.ac.at>

On Do, 03 Apr 2008, Hans Hagen wrote:
> anyhow, this works:

Thanks, also big thnaks for the lua crash course ;-) I will try to
remember using local everywhere ;-)

Later on I will come back with more questions, after testing on my
virtual machine exhibits more problems.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
PIDDLETRENTHIDE (n.)
A trouser stain caused by a wimbledon (q.v.). Not to be confused with
a botley (q.v.)
			--- Douglas Adams, The Meaning of Liff

From preining at logic.at  Thu Apr  3 18:58:11 2008
From: preining at logic.at (Norbert Preining)
Date: Thu, 3 Apr 2008 18:58:11 +0200
Subject: [Dev-luatex] another stupid question ...
Message-ID: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>

... since here are so many so intelligent people ;-)

On unix I can remove the current interpreter, ie I can do
	#!/usr/bin/perl
	unlink("/usr/bin/perl");
and this will succeed (if I have permissions).

On windows (again) this doesn't work. I am running the uninstall program
which is a texlua script but the rmdir /q ... of bin/win32 does not
succeed.

The texlua script is invoked via usual win32 methods, i.e. the extension
.texlua is linked to the texlua interpreter, and the .texlua extension
is added to the PATHEXT to be searched, and bin/win32 is in the PATH env
var.

Well, in the worst case we have to live with a rogue texlua.exe
somewhere.

Any other ideas?

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
EWELME (n.)
The smile bestowed on you by an air hostess.
			--- Douglas Adams, The Meaning of Liff

From arthur.reutenauer at normalesup.org  Thu Apr  3 19:11:07 2008
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 3 Apr 2008 19:11:07 +0200
Subject: [Dev-luatex] writing a rmdir function in texlua
In-Reply-To: <20080403163424.GC2740@gamma.logic.tuwien.ac.at>
References: <20080403160941.GB2740@gamma.logic.tuwien.ac.at>
	<47F504BE.4030305@wxs.nl>
	<20080403163424.GC2740@gamma.logic.tuwien.ac.at>
Message-ID: <20080403171107.GS31022@phare.normalesup.org>

> Thanks, also big thnaks for the lua crash course ;-) I will try to
> remember using local everywhere ;-)

  Once you start, it is impossible to stop; you want to make every
variable local ;-)

	Arthur

From joelcsalomon at gmail.com  Thu Apr  3 21:12:00 2008
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Thu, 3 Apr 2008 15:12:00 -0400
Subject: [Dev-luatex] another stupid question ...
In-Reply-To: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
References: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
Message-ID: <7871fcf50804031212v2236e311m8f333b6bd8f2a9a8@mail.gmail.com>

On Thu, Apr 3, 2008 at 12:58 PM, Norbert Preining <preining at logic.at> wrote:
>  On unix I can remove the current interpreter, ie I can do
>         #!/usr/bin/perl
>         unlink("/usr/bin/perl");
>  and this will succeed (if I have permissions).

On UNIX you can unlink a file while some processes (possibly the same
process) has that file open.  Reads, writes, &c. continue to work,
except the file is no longer in the directory tree.  The file's inode
is only deleted when all processes close their handles to it.  Other
systems don't have that property?deleting an in-use file may fail
(under Windows) or leave the running process in some broken state
(probably some OS operates that way).

On the other hand, various programs' uninstall scripts successfully
delete the entire directory tree, including the uninstaller.  Don't
know how they do it.

Hope that helped some,
--Joel

From fabrice.popineau at free.fr  Thu Apr  3 22:03:14 2008
From: fabrice.popineau at free.fr (Fabrice Popineau)
Date: Thu, 3 Apr 2008 22:03:14 +0200
Subject: [Dev-luatex] another stupid question ...
In-Reply-To: <7871fcf50804031212v2236e311m8f333b6bd8f2a9a8@mail.gmail.com>
References: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
	<7871fcf50804031212v2236e311m8f333b6bd8f2a9a8@mail.gmail.com>
Message-ID: <0CBA37D4926241578B45014DCFD48E95@Sparky>

> On the other hand, various programs' uninstall scripts successfully
> delete the entire directory tree, including the uninstaller.  Don't
> know how they do it.

The uninstaller is an msiexec.exe script. The (un)installer in an integral 
part of the os.
So the problem doesn't happen.

In the old days, InstallShield offered a ugly trick to do what Norbert 
wants.
Simply use luatex to write a .bat file doing a loop to remove your 
luatex.exe and itself. Launch the bat file
from luatex (cmd /c foo.bat) and quit luatex. Ok, it is ugly.

You also have the option to set the file to be removed after the next reboot
(dlls, com components and so). And let the user reboot to finish the 
cleanup.

You won't escape the fact that under Windows,
 any file that for which an open handle exists can't be deleted.

Installation is a native service under Windows. You may want to play
your own game, but expect annoyances.

Regards,

Fabrice








From pragma at wxs.nl  Fri Apr  4 09:19:29 2008
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 04 Apr 2008 09:19:29 +0200
Subject: [Dev-luatex] another stupid question ...
In-Reply-To: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
References: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
Message-ID: <47F5D681.7000006@wxs.nl>

Norbert Preining wrote:
> .... since here are so many so intelligent people ;-)
> 
> On unix I can remove the current interpreter, ie I can do
> 	#!/usr/bin/perl
> 	unlink("/usr/bin/perl");
> and this will succeed (if I have permissions).
> 
> On windows (again) this doesn't work. I am running the uninstall program
> which is a texlua script but the rmdir /q ... of bin/win32 does not
> succeed.
> 
> The texlua script is invoked via usual win32 methods, i.e. the extension
> ..texlua is linked to the texlua interpreter, and the .texlua extension
> is added to the PATHEXT to be searched, and bin/win32 is in the PATH env
> var.
> 
> Well, in the worst case we have to live with a rogue texlua.exe
> somewhere.
> 
> Any other ideas?

just do it in the calling script, say remover.bat:

texlua remover.lua
del /q texlua.exe remover.bat




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Fri Apr  4 10:05:57 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Fri, 4 Apr 2008 10:05:57 +0200
Subject: [Dev-luatex] writing a rmdir function in texlua
References: <20080403160941.GB2740@gamma.logic.tuwien.ac.at><47F504BE.4030305@wxs.nl><20080403163424.GC2740@gamma.logic.tuwien.ac.at>
	<20080403171107.GS31022@phare.normalesup.org>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABBE@s-yellow.net.silverstroke.de>

Hello,

> > Thanks, also big thnaks for the lua crash course ;-) I will try to 
> > remember using local everywhere ;-)
> 
>   Once you start, it is impossible to stop; you want to make 
> every variable local ;-)

That is actually possible. You simply have a module add its
definitions not to the global table, but to a local one which is
then returned:

	local M = { }

	M.foo = function(...) ... end

	...

	return M

The caller then does:

	local mymodule = require("mymodule")
	mymodule.foo(...)

In TeX, you could do the same thing:

	\directlua0{require("mymodule").foo(...)}

(of course this only works because require has a global variable
storing the return value of all loaded modules. So some globals
are still required.)


> 	Arthur

Jonathan


From reinhard.kotucha at web.de  Sun Apr  6 01:03:00 2008
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 6 Apr 2008 01:03:00 +0200
Subject: [Dev-luatex] another stupid question ...
In-Reply-To: <0CBA37D4926241578B45014DCFD48E95@Sparky>
References: <20080403165811.GF2740@gamma.logic.tuwien.ac.at>
	<7871fcf50804031212v2236e311m8f333b6bd8f2a9a8@mail.gmail.com>
	<0CBA37D4926241578B45014DCFD48E95@Sparky>
Message-ID: <18424.1316.853231.355978@zaphod.ms25.net>

Fabrice Popineau writes:

 > The uninstaller is an msiexec.exe script. The (un)installer in an
 > integral part of the os.

Hi Fabrice,
I think that if a particular OS provides such a facility it probably
makes sense to use it.  What I don't know is how to tell the
uninstaller *what* should be removed.

I recently found a file on my Windows machine at work which looked
like something exported from the registry but contained a list of all
files installed.  I thought that this file had been created by the
installer and could be used to uninstall the program.

However, I do not find this file again.  Maybe I deleted it already.
On Friday I tried to find out how Windows removes software packages.

My first attempt was to run control panel -> software.  You get a list
of software packages installed, all accompanied by a "delete" button.

I then looked into the packages and saw that they often provide a file
uninstall.exe.

Fabrice, you are using SVN and maybe you have TortoiseSVN installed.
If true, we have the same environment.

Windows offers me to uninstall TortoiseSVN.  In the
%ProgramFiles%/TortoiseSVN directory I don't see anything which looks
like an uninstaller.  And there is nothing which looks likes a list of
files to be removed.

If Windows is able to remove TortoiseSVN then there must be
instructions *what* to remove somewhere.  I exported the registry and
searched for TortoiseSVN.  Nothing found.

Fabrice, can you enlighten me? 

Is it possible to create a list of files which should be deleted and
instruct Windows to delete all files mentioned in this list?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Apr  8 08:55:22 2008
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 8 Apr 2008 08:55:22 +0200
Subject: [Dev-luatex] Text direction in PDF mode
Message-ID: <115224fb0804072355j1a835886k61a6b803de5604f6@mail.gmail.com>

Hi,

I tried Alephs body and textdir commands with LuaTeX and the output
in DVI mode is as I want (the text is written from top to bottom and left
to right).

The same example in PDF mode did not work, the text is written on the
left side and every new line written over the first line.

%\pdfoutput=1

\hsize=8cm
\vsize=8cm

\bodydir RTR
%\pagedir RTR
\pardir RTR
\textdir RTR

1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9
1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9

\bye

Greetings,
Wolfgang

From taco at elvenkind.com  Tue Apr  8 09:35:15 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 08 Apr 2008 09:35:15 +0200
Subject: [Dev-luatex] Text direction in PDF mode
In-Reply-To: <115224fb0804072355j1a835886k61a6b803de5604f6@mail.gmail.com>
References: <115224fb0804072355j1a835886k61a6b803de5604f6@mail.gmail.com>
Message-ID: <47FB2033.4060708@elvenkind.com>



Wolfgang Schuster wrote:
> Hi,
> 
> I tried Alephs body and textdir commands with LuaTeX and the output
> in DVI mode is as I want (the text is written from top to bottom and left
> to right).
> 
> The same example in PDF mode did not work, the text is written on the
> left side and every new line written over the first line.

This is known to be broken. I've put your test in the tracker item
( http://tracker.luatex.org/view.php?id=17 ), but I cannot say when
I will have time to look at it. Could take a long time, I am afraid.

Best wishes,
Taco

From Jonathan.Sauer at silverstroke.com  Tue Apr  8 10:09:51 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 8 Apr 2008 10:09:51 +0200
Subject: [Dev-luatex] Incorrect UTF-8 decoding in \luaescapestring (+ fix)
Message-ID: <9343542E664B894484613D106D7D3F5F84ABC1@s-yellow.net.silverstroke.de>

Hello,

the following PlainTeX example illustrates the problem:

%&luatex

\directlua0{%
	% The following character is DESERET CAPITAL LETTER LONG I, 
	% Unicode 0x10400, encoded in UTF-8 as F0 90 90 80:
	local s = '\luaescapestring{??}'% A
% 	local s = '??'% B

	for c in string.bytes(s) do texio.write_nl(c) end
}%

\end

(A) results in:

This is LuaTeX, Version snapshot-0.25.0-2008031419 (Web2C 7.5.6)
(EscapeUTF8.tex! Pool contains an invalid utf-8 sequence
.
l.4 	local s = '\luaescapestring{????}
                                      '% A
? 
240
144
144
128
239
191
189 )
No pages of output.
Transcript written on EscapeUTF8.log.



(B) results in:

This is LuaTeX, Version snapshot-0.25.0-2008031419 (Web2C 7.5.6)
(EscapeUTF8.tex
240
144
144
128 )
No pages of output.
Transcript written on EscapeUTF8.log.


It seems that \luaescapestring does not handle long UTF-8 sequences
correctly. The additional three bytes above -- 239-191-189 or EF-BF-BD
-- encode Unicode character FFFD -- REPLACEMENT CHARACTER -- in UTF-8,
the character LuaTeX inserts when encountering an invalid UTF-8
sequence.

I think that the error lies in luatex.web, line 10911:

@d unicode_incr(#)==if str_pool[#]>@"F0 then #:=#+4 else if str_pool[#]>@"E0 
     then #:=#+3 else if str_pool[#]>@"C0 then #:=#+2 else incr(#)

Now instead of skipping the entire four-byte-sequence, only the first
three bytes are skipped and the last byte, hex 80, is left for
processing as the next character. Since 0x80 represents an invalid
UTF-8 sequence, LuaTeX displays above error message and continues with
0xFFFD.

So I think '>=' should be used, instead of '>':

@d unicode_incr(#)==if str_pool[#]>=@"F0 then #:=#+4 else if str_pool[#]>=@"E0 
     then #:=#+3 else if str_pool[#]>=@"C0 then #:=#+2 else incr(#)

I tried this modification, and the error disappeared along with the 
additional three bytes.


Jonathan

P.S: How does the bug tracker work? I tried to register some weeks ago,
but never got the confirmation mail with the password. When trying to
register again now, it says the username is already being used, even
though non-activated accounts should be purged after a week.


From taco at elvenkind.com  Tue Apr  8 10:33:58 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 08 Apr 2008 10:33:58 +0200
Subject: [Dev-luatex] Incorrect UTF-8 decoding in \luaescapestring (+
 fix)
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABC1@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABC1@s-yellow.net.silverstroke.de>
Message-ID: <47FB2DF6.1030202@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
> the following PlainTeX example illustrates the problem:
>  [...]
> 
> So I think '>=' should be used, instead of '>':
> 
> @d unicode_incr(#)==if str_pool[#]>=@"F0 then #:=#+4 else if str_pool[#]>=@"E0 
>      then #:=#+3 else if str_pool[#]>=@"C0 then #:=#+2 else incr(#)
> 
> I tried this modification, and the error disappeared along with the 
> additional three bytes.

Thanks, applied!

> P.S: How does the bug tracker work? I tried to register some weeks ago,
> but never got the confirmation mail with the password. When trying to
> register again now, it says the username is already being used, even
> though non-activated accounts should be purged after a week.

I am having a problem with my service reseller: the server the tracker
runs on doesn't have a reverse hostname yet. That makes your smtp server
(mailer2.silverstroke.com) reject all email from that server. That is
a bit harsh really, but probably nothing you can do about.
I even forwarded you a few bounced messages. But then, those were 
probably filtered out on your side as well. Isn't spam fun?

Look out for a private email message from me in a minute.

Best wishes,
Taco

From ishamid at colostate.edu  Tue Apr  8 17:21:19 2008
From: ishamid at colostate.edu (Idris Samawi Hamid)
Date: Tue, 08 Apr 2008 09:21:19 -0600
Subject: [Dev-luatex] Text direction in PDF mode
Message-ID: <op.t9asxtmxnx1yh1@ihamidnb.libarts.colostate.edu>

Hi Wolfgang,

Wolfgang Schuster wrote:
> Hi,
>I tried Alephs body and textdir commands with LuaTeX and the output
> in DVI mode is as I want (the text is written from top to bottom and left
> to right).
>The same example in PDF mode did not work, the text is written on the
> left side and every new line written over the first line.

Vertical typesetting is not a priority at the moment. At this stage,  
getting bidirectionality as solid as a rock takes precedence (almost there  
IMO). So if you find any bidi bugs... ;-)

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523


From yannis.haralambous at telecom-bretagne.eu  Tue Apr  8 19:11:36 2008
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Tue, 8 Apr 2008 19:11:36 +0200
Subject: [Dev-luatex] Text direction in PDF mode
In-Reply-To: <op.t9asxtmxnx1yh1@ihamidnb.libarts.colostate.edu>
References: <op.t9asxtmxnx1yh1@ihamidnb.libarts.colostate.edu>
Message-ID: <73BF3079-C338-45B3-B980-E6669A585B51@telecom-bretagne.eu>

Le 8 avr. 08 ? 17:21, Idris Samawi Hamid a ?crit :

> Vertical typesetting is not a priority at the moment.


people in China, Japan, Korea or Mongolia would tend to disagree on  
that.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| TELECOM  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080408/e51fa51a/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080408/e51fa51a/attachment.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080408/e51fa51a/attachment-0001.html 

From ishamid at colostate.edu  Tue Apr  8 21:30:23 2008
From: ishamid at colostate.edu (Idris Samawi Hamid)
Date: Tue, 08 Apr 2008 13:30:23 -0600
Subject: [Dev-luatex] Text direction in PDF mode
In-Reply-To: <73BF3079-C338-45B3-B980-E6669A585B51@telecom-bretagne.eu>
References: <op.t9asxtmxnx1yh1@ihamidnb.libarts.colostate.edu>
	<73BF3079-C338-45B3-B980-E6669A585B51@telecom-bretagne.eu>
Message-ID: <op.t9a4gxsrnx1yh1@ihamidnb.libarts.colostate.edu>

Hi,

On Tue, 08 Apr 2008 11:11:36 -0600, Yannis Haralambous  
<yannis.haralambous at telecom-bretagne.eu> wrote:

> Le 8 avr. 08 ? 17:21, Idris Samawi Hamid a ?crit :
>
>> Vertical typesetting is not a priority at the moment.
>
>
> people in China, Japan, Korea or Mongolia would tend to disagree on
> that.

Why would they disagree? There is a huge difference between

a) "Vertical typesetting is not important" (obviously false, is there in  
dvi mode); and
b) "Vertical typesetting [in pdf mode] is not a priority at the moment"  
(facts of development life)

Prioritization is inescapable...

:-)

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523


From reinhard.kotucha at web.de  Wed Apr  9 03:36:13 2008
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 9 Apr 2008 03:36:13 +0200
Subject: [Dev-luatex] Text direction in PDF mode
In-Reply-To: <73BF3079-C338-45B3-B980-E6669A585B51@telecom-bretagne.eu>
References: <op.t9asxtmxnx1yh1@ihamidnb.libarts.colostate.edu>
	<73BF3079-C338-45B3-B980-E6669A585B51@telecom-bretagne.eu>
Message-ID: <18428.7565.541561.345697@zaphod.ms25.net>

Hi Yannis,
is the stupid HTML crap really necessary?

Yannis Haralambous wrote:
 [...]
 word-wrap: break-word; -webkit-nbsp-mode: space;
 -webkit-line-break: after-white-space; "><div><div><html>Le 8 avr. 08
 ? 17:21, Idris Samawi Hamid a ?crit :</html><br
 class="Apple-interchange-newline"><blockquote type="cite"><span
 class="Apple-style-span" style="border-collapse: separate; color:
 rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style:
 normal; font-variant: normal; font-weight: normal; letter-spacing:
 normal; line-height: normal; orphans: 2; text-align: auto;
 text-indent: 0px; text-transform: none; white-space: normal; widows:
 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px;
 -webkit-border-vertical-spacing: 0px;
 [...]

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Thu Apr 10 16:49:56 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 10 Apr 2008 16:49:56 +0200
Subject: [Dev-luatex] Luatex beta 0.25.2 released
Message-ID: <47FE2914.7020704@elvenkind.com>


Hi all,

I have just uploaded the archives for luatex 0.25.2.

* Updated to MPlib 0.40
* Bugfixes and cleanup in the lua img table code
* Fix \pdflastximagepages bug from pdftex
* Fix for very large tex.print strings
* Update to Lpeg 0.8.1
* &D Bugfix for Type1 fonts when out-of-range characters
   are marked as 'used'

The archives (source and binaries) can be downloaded from supelec,
as usual:

      http://foundry.supelec.fr/projects/luatex/

Bugs and feature requests can be added to the issue tracker at

      http://tracker.luatex.org

Have fun,
Taco


From root at www.metatex.org  Fri Apr 11 16:22:26 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 11 Apr 2008 16:22:26 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080411142353.148901E8C2AA@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/ltexlib.c
 Checked out revision 1146.

From yuleopen at gmail.com  Sun Apr 13 08:45:20 2008
From: yuleopen at gmail.com (Yue Wang)
Date: Sun, 13 Apr 2008 14:45:20 +0800
Subject: [Dev-luatex] hyphenating bug
In-Reply-To: <68bfdc900804122340i3dda40a2gceee8e057a987577@mail.gmail.com>
References: <68bfdc900804122330y31430d2cp486f74536e9ccbb5@mail.gmail.com>
	<68bfdc900804122340i3dda40a2gceee8e057a987577@mail.gmail.com>
Message-ID: <68bfdc900804122345u839eab5l33c4da4d497025c4@mail.gmail.com>

Hi Taco and Hans

I was typesetting the manual of a software developed by me using
ConTeXt while the problem occurred.  I try to minimized the problem
and the result is attached.

luatex.pdf --- pdf produced by luatex 0.25.2

It seems luatex forgets to hyphenating capital words.
I am not sure whether it is a bug of LuaTeX or ConTeXt.
the output of pdftex 1.40.3 seems fine using the same output file
described below.


--input file
\starttext

THE SOFTWARE IS PROVIDED ``AS IS'',
WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
IN THE SOFTWARE.

\stoptext

I hope my information helpful.

Yue Wang
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex.pdf
Type: application/pdf
Size: 5750 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080413/c3c029b0/attachment.pdf 

From taco at elvenkind.com  Sun Apr 13 09:52:17 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Apr 2008 09:52:17 +0200
Subject: [Dev-luatex] hyphenating bug
In-Reply-To: <68bfdc900804122345u839eab5l33c4da4d497025c4@mail.gmail.com>
References: <68bfdc900804122330y31430d2cp486f74536e9ccbb5@mail.gmail.com>	<68bfdc900804122340i3dda40a2gceee8e057a987577@mail.gmail.com>
	<68bfdc900804122345u839eab5l33c4da4d497025c4@mail.gmail.com>
Message-ID: <4801BBB1.4070902@elvenkind.com>

Yue Wang wrote:
> Hi Taco and Hans
> 
> I was typesetting the manual of a software developed by me using
> ConTeXt while the problem occurred.  I try to minimized the problem
> and the result is attached.
> 
> luatex.pdf --- pdf produced by luatex 0.25.2
> 
> It seems luatex forgets to hyphenating capital words.
> I am not sure whether it is a bug of LuaTeX or ConTeXt.

It was a bug in luatex. The fix is in the repository already,
and there will be a 0.25.3 sometime next week.

Best wishes,
Taco

From hansm at science.uva.nl  Sun Apr 13 23:59:38 2008
From: hansm at science.uva.nl (Hans van der Meer)
Date: Sun, 13 Apr 2008 23:59:38 +0200
Subject: [Dev-luatex] luatools --ini plain
Message-ID: <78994CA8-E6E0-4384-8DB1-31E40A815638@science.uva.nl>

This is something I don't understand.

In the mk.pdf manual on luatex on page 21 there is the following  
example:

luatools --ini plain

Instead of the expected output 120,808 plain.fmt etc. I get an error:  
"There is no lua initialization file found. ..."
Running "luatools --generate" does not help.
There is a hint: "This file can be forced by the --progname directve,  
or specified with --luaname,..."

How can I get a "lua initialization file" in order to not have the  
error.
And how do I interpret the hint, as the text of the error message is  
too cryptic for me to understand.

Hans van der Meer





From pragma at wxs.nl  Mon Apr 14 00:30:13 2008
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 14 Apr 2008 00:30:13 +0200
Subject: [Dev-luatex] luatools --ini plain
In-Reply-To: <78994CA8-E6E0-4384-8DB1-31E40A815638@science.uva.nl>
References: <78994CA8-E6E0-4384-8DB1-31E40A815638@science.uva.nl>
Message-ID: <48028975.2050103@wxs.nl>

Hans van der Meer wrote:
> This is something I don't understand.
> 
> In the mk.pdf manual on luatex on page 21 there is the following  
> example:
> 
> luatools --ini plain

luatools --make plain

(this will use the context base lua files)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.metatex.org  Mon Apr 14 12:22:08 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 14 Apr 2008 12:22:08 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080414102334.545DD1E8C2AA@www.metatex.org>

D    svn/trunk/source
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lpdflib.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/textoken.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/postlinebreak.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texnodes.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texpdf.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/linebreak.c
 A    svn/trunk/src/texk/web2c/luatexdir/tex/.indent.pro
 Checked out revision 1160.

From root at www.metatex.org  Mon Apr 14 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 14 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080414142325.63BC11E8C2AA@www.metatex.org>

D    svn/trunk/src/texk/web2c/luatexdir/image/.indent.pro
 A    svn/trunk/src/texk/web2c/luatexdir/image/.indent.pro
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 D    svn/trunk/src/texk/web2c/luatexdir/lua/.indent.pro
 A    svn/trunk/src/texk/web2c/luatexdir/lua/.indent.pro
 D    svn/trunk/src/texk/web2c/luatexdir/tex/.indent.pro
 A    svn/trunk/src/texk/web2c/luatexdir/tex/.indent.pro
 D    svn/trunk/src/texk/web2c/luatexdir/font/.indent.pro
 A    svn/trunk/src/texk/web2c/luatexdir/font/.indent.pro
 Checked out revision 1163.

From preining at logic.at  Tue Apr 15 12:30:39 2008
From: preining at logic.at (Norbert Preining)
Date: Tue, 15 Apr 2008 12:30:39 +0200
Subject: [Dev-luatex] Luatex beta 0.25.2 released
In-Reply-To: <47FE2914.7020704@elvenkind.com>
References: <47FE2914.7020704@elvenkind.com>
Message-ID: <20080415103039.GD1738@gamma.logic.tuwien.ac.at>

On Do, 10 Apr 2008, Taco Hoekwater wrote:
> I have just uploaded the archives for luatex 0.25.2.

Debian packages for sid are coming in, for etch as usual under
	deb(-src) http://people.debian.org/~preining/TeX/ luatex/

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
AINSWORTH (n.)
The length of time it takes to get served in a camera shop. Hence,
also, how long we will have to wait for the abolition of income tax or
the Second Coming.
			--- Douglas Adams, The Meaning of Liff

From root at www.metatex.org  Tue Apr 15 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 15 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080415142325.5DECE1E8C2AC@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/lang/texlang.c
 U    svn/trunk/src/texk/web2c/luatexdir/lang/hyphen.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/ltexlib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lmplib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luatoken.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/llualib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/llanglib.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texnodes.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/linebreak.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/luafont.c
 Checked out revision 1168.

From root at www.metatex.org  Tue Apr 15 22:22:07 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 15 Apr 2008 22:22:07 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080415202327.77A641E8C2AA@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/lua/llualib.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/vfpacket.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/vfovf.c
 Checked out revision 1169.

From root at www.metatex.org  Wed Apr 16 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 16 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080416142325.348D71E8C2AA@www.metatex.org>

U    svn/trunk/src/libs/luafontforge/src/luafflib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lfontlib.c
 U    svn/trunk/manual/luatexref-t.tex
 Checked out revision 1172.

From root at www.metatex.org  Thu Apr 17 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 17 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080417142326.EC3091E8C2AA@www.metatex.org>

U    svn/trunk/src/libs/zziplib/zzip/Makefile
 U    svn/trunk/src/libs/luafontforge/fontforge/Unicode/Makefile
 U    svn/trunk/src/libs/luafontforge/fontforge/fontforge/Makefile
 U    svn/trunk/src/libs/luafontforge/Makefile
 U    svn/trunk/src/texk/web2c/Makefile.in
 U    svn/trunk/src/texk/web2c/luatexdir/Makefile.in
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.mk
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/luatexlib.mk
 U    svn/trunk/src/texk/web2c/luatexdir/font/luafont.c
 U    svn/trunk/src/texk/web2c/lib/texmfmp.c
 A    svn/trunk/src/texk/web2c/libsluapdf.mk
 U    svn/trunk/src/texk/web2c/texmfmp.h
 Checked out revision 1175.

From taco at elvenkind.com  Fri Apr 18 11:54:13 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 18 Apr 2008 11:54:13 +0200
Subject: [Dev-luatex] Luatex beta 0.25.3 released
Message-ID: <48086FC5.5020901@elvenkind.com>


Hi all,

I have just uploaded the archives for luatex 0.25.3, yet
another bugfix release to the 0.25 series.

Bugs fixed:
* Pdftex bug no. 936 (sarovar) regarding vertical
   positioning of embedded PDF files if depth parameter is given.
* Luatex gave bogus lua return values for the tex.wd/hd/dp
   values of void boxes
* A few bugfixes in mplib (square pens caused hangs, elliptical
   pens caused confused output)
* Hyphenation of uppercase words (\uchyph) was broken
* Output image placements corrected for all 8 transform cases
   also when artbox etc. is used
* There were missing maketexstring() calls in error messages
* Math display contents were sometimes prematurely freed during
   the placement of the equation number
* Setting \language=-1 could cause crashes due to an array
   index going out-of-bounds

Other news:
* build.sh.ppc is added to the source distribution. This is a
   script that crosscompiles osx ppc binaries from osx intel
* tex.box[<chardef name>] is now supported (but still experimental)
* a bunch of compiler warnings are removed
* The fontforge library now dump AAT feature tags as and
   "<id,flags>" string
* The new function font.nextid() predicts the next assigned font id
* Some source code changes are backported from texlive

The archives (source and binaries) can be downloaded from supelec,
as usual:

      http://foundry.supelec.fr/projects/luatex/

Bugs and feature requests can be added to the issue tracker at

      http://tracker.luatex.org

Have fun,
Taco



From root at www.metatex.org  Fri Apr 18 16:22:04 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 18 Apr 2008 16:22:04 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080418142329.45CCF1E8C2AC@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/makecpool.c
 U    svn/trunk/src/texk/web2c/luatexdir/luatexlib.mk
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.defines
 U    svn/trunk/src/texk/web2c/web2c/texmf.defines
 Checked out revision 1179.

From stefan-husmann at t-online.de  Fri Apr 18 16:27:04 2008
From: stefan-husmann at t-online.de (stefan-husmann at t-online.de)
Date: Fri, 18 Apr 2008 16:27:04 +0200
Subject: [Dev-luatex] md5sums of different releases do not differ
Message-ID: <1JmrYO-1DGAuO0@fwd28.aul.t-online.de>

Hello,

the version number of luatex has been incremented on
http://foundry.supelec.fr/projects/luatex, but the underlying tarball
has exactly the same md5sum as the tarball of release 0.25.2.

Is this correct?

BTW they unpack itself into a directory luatex-beta-0.20.2 (and so did
release 0.25.1, too).

Sincerely Stefan Husmann




From preining at logic.at  Fri Apr 18 16:42:22 2008
From: preining at logic.at (Norbert Preining)
Date: Fri, 18 Apr 2008 16:42:22 +0200
Subject: [Dev-luatex] md5sums of different releases do not differ
In-Reply-To: <1JmrYO-1DGAuO0@fwd28.aul.t-online.de>
References: <1JmrYO-1DGAuO0@fwd28.aul.t-online.de>
Message-ID: <20080418144222.GE8732@gamma.logic.tuwien.ac.at>

On Fr, 18 Apr 2008, stefan-husmann at t-online.de wrote:
> http://foundry.supelec.fr/projects/luatex, but the underlying tarball
> has exactly the same md5sum as the tarball of release 0.25.2.

I cannot confirm that, I have 
d23378e0465c34c3d50e1193e56e2b38  luatex-beta-0.25.2.tar.bz2
02ac022d53f3a89350233f7679e84e21  luatex-beta-0.25.3.tar.bz2


which is different.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
LITTLE URSWICK (n.)
The member of any class who most inclines a teacher towards the view
that capital punishment should be introduced in schools.
			--- Douglas Adams, The Meaning of Liff

From preining at logic.at  Fri Apr 18 17:13:51 2008
From: preining at logic.at (Norbert Preining)
Date: Fri, 18 Apr 2008 17:13:51 +0200
Subject: [Dev-luatex] Debian luatex and context
Message-ID: <20080418151351.GF8732@gamma.logic.tuwien.ac.at>

On Fr, 18 Apr 2008, Taco Hoekwater wrote:
> I have just uploaded the archives for luatex 0.25.3, yet

On Fr, 18 Apr 2008, Taco Hoekwater wrote:
> Hot on the heels of the luatex 0.25.3 release Hans has released
> (yet another) new context current (the sixth or seventh this week).


Debian packages:

context (for sid and etch):
	deb http://people.debian.org/~preining/TeX/ context/
	deb-src http://people.debian.org/~preining/TeX/ context/
	
luatex for sid
	deb http://people.debian.org/~preining/TeX/ luatex-sid/
	deb-src http://people.debian.org/~preining/TeX/ luatex-sid/

luatex for etch
	deb http://people.debian.org/~preining/TeX/ luatex/
	deb-src http://people.debian.org/~preining/TeX/ luatex/

Please give it a test try. After some more tests I will upload the stuff
to sid and sid users will get by normal operation.

I tried this combination with my test cases and context/luatex according
to README.MarkIV in the Debian package.


Next release of TeX Live packages will PROBABLY contain updates to
xetex/xdvipdfmx.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
EWELME (n.)
The smile bestowed on you by an air hostess.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Fri Apr 18 19:57:02 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 18 Apr 2008 19:57:02 +0200
Subject: [Dev-luatex] md5sums of different releases do not differ
In-Reply-To: <1JmrYO-1DGAuO0@fwd28.aul.t-online.de>
References: <1JmrYO-1DGAuO0@fwd28.aul.t-online.de>
Message-ID: <4808E0EE.6010905@elvenkind.com>

stefan-husmann at t-online.de wrote:
> Hello,
> 
> the version number of luatex has been incremented on
> http://foundry.supelec.fr/projects/luatex, but the underlying tarball
> has exactly the same md5sum as the tarball of release 0.25.2.
> 
> Is this correct?
> 
> BTW they unpack itself into a directory luatex-beta-0.20.2 (and so did
> release 0.25.1, too).

The files are definately different. Perhaps your proxy is overeager in
caching them?

Best wishes,
Taco

From root at www.metatex.org  Sun Apr 20 12:22:08 2008
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 20 Apr 2008 12:22:08 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080420102338.161911E8C2AC@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/image/pdftoepdf.cc
 U    svn/trunk/src/texk/web2c/luatexdir/image/image.h
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/limglib.c
 U    svn/trunk/src/texk/web2c/luatexdir/ptexlib.h
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.defines
 Checked out revision 1180.

From root at www.metatex.org  Sun Apr 20 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 20 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080420142330.262AE1E8C2AC@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/image/pdftoepdf.cc
 U    svn/trunk/src/texk/web2c/luatexdir/image/writepng.c
 U    svn/trunk/src/texk/web2c/luatexdir/image/image.h
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/image/writejbig2.c
 U    svn/trunk/src/texk/web2c/luatexdir/image/writejpg.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/limglib.c
 U    svn/trunk/src/texk/web2c/luatexdir/ptexlib.h
 Checked out revision 1184.

From preining at logic.at  Mon Apr 21 08:23:29 2008
From: preining at logic.at (Norbert Preining)
Date: Mon, 21 Apr 2008 08:23:29 +0200
Subject: [Dev-luatex] luatex and ~ support on win32
Message-ID: <20080421062329.GQ31335@gamma.logic.tuwien.ac.at>

Hi Taco,

the current libkpathsea expands
	~
to
	on unix:	$HOME
	on win32:	%USERPROFILE%

Unfortunaltely it seems that luatex/texlua does not follow this, i.e.,
returns a literal ~.

Is there any chance that you fix that?

Thanks and all the best

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
ARDSCALPSIE (n.)
Excuse made by rural Welsh hairdresser for completely massacring your
hair.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Mon Apr 21 08:53:09 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 21 Apr 2008 08:53:09 +0200
Subject: [Dev-luatex] luatex and ~ support on win32
In-Reply-To: <20080421062329.GQ31335@gamma.logic.tuwien.ac.at>
References: <20080421062329.GQ31335@gamma.logic.tuwien.ac.at>
Message-ID: <480C39D5.6000204@elvenkind.com>

Norbert Preining wrote:
> Hi Taco,
> 
> the current libkpathsea expands
> 	~
> to
> 	on unix:	$HOME
> 	on win32:	%USERPROFILE%
> 
> Unfortunaltely it seems that luatex/texlua does not follow this, i.e.,
> returns a literal ~.

> Is there any chance that you fix that?

The version checked in in texlive should do that already, assuming it
is just the library update and no other changes are needed.

The standalone luatex does not have the latest kpathsea. I tried
it a while back for metapost, it turned out not to compile on macosx
10.5, so I decided to hold off.

Best wishes,
Taco

From preining at logic.at  Mon Apr 21 08:55:24 2008
From: preining at logic.at (Norbert Preining)
Date: Mon, 21 Apr 2008 08:55:24 +0200
Subject: [Dev-luatex] luatex and ~ support on win32
In-Reply-To: <480C39D5.6000204@elvenkind.com>
References: <20080421062329.GQ31335@gamma.logic.tuwien.ac.at>
	<480C39D5.6000204@elvenkind.com>
Message-ID: <20080421065524.GY31335@gamma.logic.tuwien.ac.at>

On Mo, 21 Apr 2008, Taco Hoekwater wrote:
> The version checked in in texlive should do that already, assuming it
> is just the library update and no other changes are needed.

Ok, thanks a lot. Good to know.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
COTTERSTOCK (n.)
A piece of wood used to stir paint and thereafter stored uselessly in
a shed in perpetuity.
			--- Douglas Adams, The Meaning of Liff

From root at www.metatex.org  Wed Apr 23 22:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 23 Apr 2008 22:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080423202330.72C521E8C2B1@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/image/image.h
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/limglib.c
 Checked out revision 1188.

From root at www.metatex.org  Thu Apr 24 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 24 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080424142330.9B3771E8C2B1@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/lua/mp.w
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lmplib.c
 U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 1192.

From root at www.metatex.org  Sun Apr 27 12:22:07 2008
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 27 Apr 2008 12:22:07 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080427102337.108071E8C2B1@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/image/image.h
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/limglib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luastuff.c
 U    svn/trunk/src/texk/web2c/luatexdir/ptexlib.h
 U    svn/trunk/src/texk/web2c/luatexdir/luatex-api.h
 U    svn/trunk/src/texk/web2c/luatexdir/font/vfpacket.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/luafont.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/texfont.h
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.defines
 Checked out revision 1197.

From vvv at vsu.ru  Sun Apr 27 14:18:45 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun, 27 Apr 2008 05:18:45 -0700
Subject: [Dev-luatex] portability fixes for luatex
Message-ID: <871w4r7aoq.fsf@external.prs-office.com>

A non-text attachment was scrubbed...
Name: lua.diff
Type: text/x-diff
Size: 23825 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080427/a1449b75/attachment.bin 

From pmlists at free.fr  Sun Apr 27 16:24:13 2008
From: pmlists at free.fr (Peter =?utf-8?Q?M=C3=BCnster?=)
Date: Sun, 27 Apr 2008 16:24:13 +0200
Subject: [Dev-luatex] [tex-live] portability fixes for luatex
In-Reply-To: <871w4r7aoq.fsf@external.prs-office.com>
References: <871w4r7aoq.fsf@external.prs-office.com>
Message-ID: <20080427142413.GA24065@gaston.couberia.bzh>

On Sun, Apr 27 2008, Vladimir Volovich wrote:

> while compiling texlive on AIX, i encountered problems with
> luatex-related files. Most of them are about variable declarations in C
> files which appear not at the beginning of the block.

Hello Vladimir,

Free placement of variable declarations in C is ANSI standard since C99 and
can enhance readability of C-code a lot.

So, wouldn't it be much better, to just update your C-compiler on your
AIX-system?

(I'm not a texlive developer, so this is just my personal opinion.)

Cheers, Peter

-- 
http://pmrb.free.fr/contact/


From vvv at vsu.ru  Sun Apr 27 21:38:59 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun, 27 Apr 2008 12:38:59 -0700
Subject: [Dev-luatex] [tex-live] portability fixes for luatex
In-Reply-To: <20080427142413.GA24065@gaston.couberia.bzh> ("Peter
	=?iso-8859-1?Q?M=FCnster=22's?=
	message of "Sun, 27 Apr 2008 16:24:13 +0200")
References: <871w4r7aoq.fsf@external.prs-office.com>
	<20080427142413.GA24065@gaston.couberia.bzh>
Message-ID: <87lk2z5bqk.fsf@external.prs-office.com>

"PM" == Peter M?nster writes:

 PM> Free placement of variable declarations in C is ANSI standard since
 PM> C99 and can enhance readability of C-code a lot.

 PM> So, wouldn't it be much better, to just update your C-compiler on
 PM> your AIX-system?

that's a good point, but i cannot update the compiler (it's an old AIX
4.3 system with VAC 5 compiler). if the fixes don't reduce readability
of the code, i'd like to get them applied.

plus, there are a few other changes in the patch, not related to
variable declarations.

 PM> (I'm not a texlive developer, so this is just my personal opinion.)

Best,
v.


From vvv at vsu.ru  Sun Apr 27 22:24:22 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun, 27 Apr 2008 13:24:22 -0700
Subject: [Dev-luatex] luatex0.c compile problem
Message-ID: <87lk2z3v2h.fsf@external.prs-office.com>

Hi!

while compiling luatex, i got an error:

xlc -DHAVE_CONFIG_H  -I. -I../../../texk/web2c -I.. -I../../../texk/web2c/..  -I/opt/freeware/include -I../../libs/obsdcompat -I../../libs/obsdcompat/.. -I../../../texk/web2c/../../libs/obsdcompat -I../../../texk/web2c/../../libs/obsdcompat/..  -I../../../texk/web2c/../../libs/zlib -I../../../texk/web2c/../../libs/libpng -I../../../texk/web2c/../../libs/xpdf -Dextra_version_info=`date +-%Y%m%d%H` -O2 -qmaxmem=262144 -qarch=com -qlanglvl=extended -qcpluscmt  -c luatex0.c -o luatex0.o
"luatex0.c", line 8931.5: 1506-117 (S) Operand must be a scalar type.
"luatex0.c", line 8940.3: 1506-117 (S) Operand must be a scalar type.
"luatex0.c", line 9005.5: 1506-117 (S) Operand must be a scalar type.
"luatex0.c", line 9124.11: 1506-117 (S) Operand must be a scalar type.
"luatex0.c", line 9133.11: 1506-117 (S) Operand must be a scalar type.

here are the statements on the referenced lines:

8931: eq_destroy ( eqtb [p ]) ;
8940: eq_destroy ( eqtb [p ]) ;
9005: eq_destroy ( eqtb [p ]) ;
9124: eq_destroy ( save_stack [save_ptr ]) ;
9133: eq_destroy ( eqtb [p ]) ;

does this make sense to you? eqtb and save_stack is a structure.

Best,
v.


From martin at oneiros.de  Mon Apr 28 00:30:30 2008
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Mon, 28 Apr 2008 00:30:30 +0200
Subject: [Dev-luatex] [tex-live] portability fixes for luatex
In-Reply-To: <87lk2z5bqk.fsf@external.prs-office.com>
References: <871w4r7aoq.fsf@external.prs-office.com>
	<20080427142413.GA24065@gaston.couberia.bzh>
	<87lk2z5bqk.fsf@external.prs-office.com>
Message-ID: <68c491a60804271530v48a49f68l6f5082d55fedc5c9@mail.gmail.com>

2008/4/27 Vladimir Volovich <vvv at vsu.ru>:
>  plus, there are a few other changes in the patch, not related to
>  variable declarations.

Methinks we should add this to the CFLAGS:
       -Wdeclaration-after-statement (C only)
           Warn when a declaration is found after a statement in a
block.  This construct, known from
           C++, was introduced with ISO C99 and is by default allowed
in GCC.  It is not supported by
           ISO C90 and was not supported by GCC versions before GCC 3.0.

Best
   Martin

PS: http://marc.info/?l=lua-l&m=120933425827050&w=2 :-)

From vvv at vsu.ru  Mon Apr 28 00:37:49 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Sun, 27 Apr 2008 15:37:49 -0700
Subject: [Dev-luatex] [tex-live] portability fixes for luatex
In-Reply-To: <68c491a60804271530v48a49f68l6f5082d55fedc5c9@mail.gmail.com>
	("Martin =?iso-8859-1?Q?Schr=F6der=22's?= message of "Mon, 28 Apr 2008
	00:30:30 +0200")
References: <871w4r7aoq.fsf@external.prs-office.com>
	<20080427142413.GA24065@gaston.couberia.bzh>
	<87lk2z5bqk.fsf@external.prs-office.com>
	<68c491a60804271530v48a49f68l6f5082d55fedc5c9@mail.gmail.com>
Message-ID: <87lk2y3ow2.fsf@external.prs-office.com>

"MS" == Martin Schr?der writes:

 >> plus, there are a few other changes in the patch, not related to
 >> variable declarations.

 MS> Methinks we should add this to the CFLAGS:
 MS> -Wdeclaration-after-statement

yes, that would be very helpful, if you are willing to be a bit stricter
than C99 is regarding variable declarations. (this option is for gcc
only, and should be used by developers to catch potential problems on
systems which don't support this C99 extension).

BTW, in addition to those luatex-related changes, i attahced a small
patch for texk/web2c/pdftexdir/mapfile.c (we discussed that some time
ago, and this is the proposed change which both works on older compilers
and preserves the assert).

Best,
v.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mapfile.diff
Type: text/x-diff
Size: 566 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20080427/1174ed19/attachment.bin 

From taco at elvenkind.com  Mon Apr 28 09:36:54 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 28 Apr 2008 09:36:54 +0200
Subject: [Dev-luatex] [tex-live] luatex0.c compile problem
In-Reply-To: <87lk2z3v2h.fsf@external.prs-office.com>
References: <87lk2z3v2h.fsf@external.prs-office.com>
Message-ID: <48157E96.10001@elvenkind.com>


Hi Vladimir,

Vladimir Volovich wrote:
> Hi!
> 
> while compiling luatex, i got an error:
> 
> xlc -DHAVE_CONFIG_H  -I. -I../../../texk/web2c -I.. -I../../../.....  
> "luatex0.c", line 8931.5: 1506-117 (S) Operand must be a scalar type.
> "luatex0.c", line 8940.3: 1506-117 (S) Operand must be a scalar type.
> "luatex0.c", line 9005.5: 1506-117 (S) Operand must be a scalar type.
> "luatex0.c", line 9124.11: 1506-117 (S) Operand must be a scalar type.
> "luatex0.c", line 9133.11: 1506-117 (S) Operand must be a scalar type.
> 
> here are the statements on the referenced lines:
> 
> 8931: eq_destroy ( eqtb [p ]) ;
> 8940: eq_destroy ( eqtb [p ]) ;
> 9005: eq_destroy ( eqtb [p ]) ;
> 9124: eq_destroy ( save_stack [save_ptr ]) ;
> 9133: eq_destroy ( eqtb [p ]) ;
> 
> does this make sense to you? eqtb and save_stack is a structure.

It may be complaining about eq_destroy, because these five happen to
be all the calls to that function. Perhaps it misinterprets the
macro in luatexcoerce.h. Not that I see a reason why it should,
this function is converted by web2c just like all others. Or
perhaps it is mis-optimizing something?

Sorry, I am much more lost than you are, and I have knowledge of
nor access to the IBM compiler suite.

Best wishes,
Taco


From dak at gnu.org  Mon Apr 28 09:56:22 2008
From: dak at gnu.org (David Kastrup)
Date: Mon, 28 Apr 2008 09:56:22 +0200
Subject: [Dev-luatex] [tex-live] luatex0.c compile problem
In-Reply-To: <48157E96.10001@elvenkind.com> (Taco Hoekwater's message of "Mon, 
	28 Apr 2008 09:36:54 +0200")
References: <87lk2z3v2h.fsf@external.prs-office.com>
	<48157E96.10001@elvenkind.com>
Message-ID: <857ieis995.fsf@lola.goethe.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> Vladimir Volovich wrote:
>> 
>> while compiling luatex, i got an error:
>> 
>> xlc -DHAVE_CONFIG_H  -I. -I../../../texk/web2c -I.. -I../../../.....  
>> "luatex0.c", line 8931.5: 1506-117 (S) Operand must be a scalar type.
>> "luatex0.c", line 8940.3: 1506-117 (S) Operand must be a scalar type.
>> "luatex0.c", line 9005.5: 1506-117 (S) Operand must be a scalar type.
>> "luatex0.c", line 9124.11: 1506-117 (S) Operand must be a scalar type.
>> "luatex0.c", line 9133.11: 1506-117 (S) Operand must be a scalar type.
>> 
>> here are the statements on the referenced lines:
>> 
>> 8931: eq_destroy ( eqtb [p ]) ;
>> 8940: eq_destroy ( eqtb [p ]) ;
>> 9005: eq_destroy ( eqtb [p ]) ;
>> 9124: eq_destroy ( save_stack [save_ptr ]) ;
>> 9133: eq_destroy ( eqtb [p ]) ;
>> 
>> does this make sense to you? eqtb and save_stack is a structure.
>
> It may be complaining about eq_destroy, because these five happen to
> be all the calls to that function. Perhaps it misinterprets the
> macro in luatexcoerce.h. Not that I see a reason why it should,
> this function is converted by web2c just like all others. Or
> perhaps it is mis-optimizing something?

Ancient compilers did not allow for passing structures to functions.  It
sounds somewhat unlikely that this would be the only case here, though.

Maybe a missing prototype or something for eq_destroy?

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From taco at elvenkind.com  Mon Apr 28 10:27:03 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 28 Apr 2008 10:27:03 +0200
Subject: [Dev-luatex] portability fixes for luatex
In-Reply-To: <871w4r7aoq.fsf@external.prs-office.com>
References: <871w4r7aoq.fsf@external.prs-office.com>
Message-ID: <48158A57.5020003@elvenkind.com>


Hi Vladimir,

Vladimir Volovich wrote:
> 
> *please* fix these portability problems, otherwise it will be painful
> and time consuming to do this again.

> attached patch is only a suggested way to fix the problem; you may
> choose to use slightly different approach in some case(s). please let me
> know if the nature of the problem(s) is not clear from the patch.

I am going through this now. My comments:

xxx/xxx/Makefile: Patches are fine for texlive, but I will not apply
   these changes in the upstream. These packages do not use autoconf
   (yet) and I really need the -Wall etc. while developing.

libs/luafilesystem/src/lfs.c: I changedthat  a bit because your patch
   broke compilation on win32.

libs/luafontforge/fontforge/inc/basics.h: what was the problem? You have
   commented out some typedefs, but these should be harmless.
   (Fontforge is upstream for me myself, so I prefer not to make changes
    to headers unlees absolutely necessary.)

src/texk/web2c/luatexdir/font/luafont.c: one of the new "halfword next"s
   was a level off.

Best wishes,
Taco


From root at www.metatex.org  Mon Apr 28 12:22:07 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 28 Apr 2008 12:22:07 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080428102338.84AB51E8C2B1@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/image/writepng.c
 U    svn/trunk/src/texk/web2c/luatexdir/image/image.h
 U    svn/trunk/src/texk/web2c/luatexdir/image/writeimg.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/limglib.c
 U    svn/trunk/src/texk/web2c/luatexdir/ptexlib.h
 U    svn/trunk/src/texk/web2c/cwebdir/ctangle.w
 U    svn/trunk/src/texk/web2c/cwebdir/common.w
 U    svn/trunk/src/texk/web2c/cwebdir/cweave.w
 Checked out revision 1200.

From vvv at vsu.ru  Mon Apr 28 23:08:17 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Mon, 28 Apr 2008 14:08:17 -0700
Subject: [Dev-luatex] portability fixes for luatex
In-Reply-To: <48158A57.5020003@elvenkind.com> (Taco Hoekwater's message of
	"Mon, 28 Apr 2008 10:27:03 +0200")
References: <871w4r7aoq.fsf@external.prs-office.com>
	<48158A57.5020003@elvenkind.com>
Message-ID: <87iqy1wuv2.fsf@external.prs-office.com>

"TH" == Taco Hoekwater writes:

 TH> I am going through this now. My comments:

 TH> xxx/xxx/Makefile: Patches are fine for texlive, but I will not
 TH> apply these changes in the upstream. These packages do not use
 TH> autoconf (yet) and I really need the -Wall etc. while developing.

 TH> libs/luafilesystem/src/lfs.c: I changedthat a bit because your
 TH> patch broke compilation on win32.

yeah, i didn't notice that this declaration was in the #else
conditional. i should have used this instead:

======================================
--- libs/luafilesystem/src/lfs.c
+++ libs/luafilesystem/src/lfs.c
@@ -256,6 +256,8 @@
 static int dir_iter (lua_State *L) {
 #ifdef _WIN32
 	struct _finddata_t c_file;
+#else
+	struct dirent *entry;
 #endif
 	dir_data *d = (dir_data *)lua_touserdata (L, lua_upvalueindex (1));
 	luaL_argcheck (L, !d->closed, 1, "closed directory");
@@ -281,7 +283,6 @@
 		}
 	}
 #else
-	struct dirent *entry;
 	if ((entry = readdir (d->dir)) != NULL) {
 		lua_pushstring (L, entry->d_name);
 		return 1;
======================================

 TH> libs/luafontforge/fontforge/inc/basics.h: what was the problem? You
 TH> have commented out some typedefs, but these should be harmless.
 TH> (Fontforge is upstream for me myself, so I prefer not to make
 TH> changes to headers unlees absolutely necessary.)

i was getting errors:

xlc -g -c -o splinerefigure.o -I../../../../libs/luafontforge/fontforge/inc -I../../../../libs/luafontforge/fontforge/fontforge -I.  -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_UNISTD_H=1 -D_NO_PYTHON=1 -DHAVE_LANGINFO_H=1 -DX_DISPLAY_MISSING=1 -DHAVE_LONG_DOUBLE=1 -D_HAS_LONGLONG=1 -DNODYNAMIC=1 -D_NO_FREETYPE=1 -D_NO_LIBUNINAMESLIST=1 -DFONTFORGE_CONFIG_NO_WINDOWING_UI=1 -DLUA_FF_LIB=1 -UHAVE_LIBINTL_H ../../../../libs/luafontforge/fontforge/fontforge/splinerefigure.c
"../../../../libs/luafontforge/fontforge/inc/basics.h", line 48.25: 1506-334 (S) Identifier int32 has already been defined on line 624 of "/usr/include/sys/inttypes.h".
"../../../../libs/luafontforge/fontforge/inc/basics.h", line 50.25: 1506-334 (S) Identifier int16 has already been defined on line 623 of "/usr/include/sys/inttypes.h".
"../../../../libs/luafontforge/fontforge/inc/basics.h", line 52.25: 1506-334 (S) Identifier int8 has already been defined on line 622 of "/usr/include/sys/inttypes.h".

because typedefs in libs/luafontforge/fontforge/inc/basics.h
were clashing with typedefs in system header <sys/inttypes.h>

 TH> src/texk/web2c/luatexdir/font/luafont.c: one of the new "halfword
 TH> next"s was a level off.

thanks for looking at this.

Best,
v.


From vvv at vsu.ru  Tue Apr 29 09:05:18 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Tue, 29 Apr 2008 00:05:18 -0700
Subject: [Dev-luatex] [tex-live]   luatex0.c compile problem
In-Reply-To: <857ieis995.fsf@lola.goethe.zz> (David Kastrup's message of "Mon, 
	28 Apr 2008 09:56:22 +0200")
References: <87lk2z3v2h.fsf@external.prs-office.com>
	<48157E96.10001@elvenkind.com> <857ieis995.fsf@lola.goethe.zz>
Message-ID: <87abjduonl.fsf@external.prs-office.com>


>> here are the statements on the referenced lines:
>> 
>> 8931: eq_destroy ( eqtb [p ]) ;
>> 8940: eq_destroy ( eqtb [p ]) ;
>> 9005: eq_destroy ( eqtb [p ]) ;
>> 9124: eq_destroy ( save_stack [save_ptr ]) ;
>> 9133: eq_destroy ( eqtb [p ]) ;
>> 
>> does this make sense to you? eqtb and save_stack is a structure.
>
> It may be complaining about eq_destroy, because these five happen to
> be all the calls to that function. Perhaps it misinterprets the
> macro in luatexcoerce.h. Not that I see a reason why it should,
> this function is converted by web2c just like all others. Or
> perhaps it is mis-optimizing something?

 DK> Ancient compilers did not allow for passing structures to
 DK> functions.  It sounds somewhat unlikely that this would be the only
 DK> case here, though.

 DK> Maybe a missing prototype or something for eq_destroy?

i investigated it further.

after pre-processing,

    eq_destroy ( eqtb [p ]) ;

gets changed to:

    zeq_destroy((memoryword) (eqtb [p ])) ;

i.e. the casts are added to the argument.

it appears that the compiler is not happy about the constructs with such
casts, it has nothing to do with the zeq_destroy function itself.

i.e. if i manually remove the casts after passing the code through a
pre-processor, i.e. change it to

    zeq_destroy( eqtb [p ]) ;

then it compiles fine.

to see further, i created a small test file:

===================================
typedef struct {
  int CINT0, CINT1;
} twoints;

void test (twoints *z) {
  twoints v1 = z[0];
  twoints v2 = (twoints) (z[0]);
  twoints v3 = *z;
  twoints v4 = (twoints) (*z);
}
===================================

$ xlc -c test.c 
"test.c", line 7.17: 1506-117 (S) Operand must be a scalar type.
"test.c", line 9.17: 1506-117 (S) Operand must be a scalar type.

it gives errors for lines with casts and no errors for lines without
casts.

does that make sense to anyone?

Best,
v.


From vvv at vsu.ru  Tue Apr 29 09:31:32 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Tue, 29 Apr 2008 00:31:32 -0700
Subject: [Dev-luatex] [tex-live]   luatex0.c compile problem
In-Reply-To: <87abjduonl.fsf@external.prs-office.com> (Vladimir Volovich's
	message of "Tue, 29 Apr 2008 00:05:18 -0700")
References: <87lk2z3v2h.fsf@external.prs-office.com>
	<48157E96.10001@elvenkind.com> <857ieis995.fsf@lola.goethe.zz>
	<87abjduonl.fsf@external.prs-office.com>
Message-ID: <874p9lunfv.fsf@external.prs-office.com>

"VV" == Vladimir Volovich writes:

 VV> does that make sense to anyone?

i tested this with GCC, and got these warnings with the -pedantic
option:

$ gcc -c -pedantic test.c 
test.c: In function 'test':
test.c:7: warning: ISO C forbids casting nonscalar to the same type
test.c:9: warning: ISO C forbids casting nonscalar to the same type

so i guess xlc's refusal to compile is not completely groundless.

Best,
v.


From taco at elvenkind.com  Tue Apr 29 09:41:52 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 09:41:52 +0200
Subject: [Dev-luatex] [tex-live]   luatex0.c compile problem
In-Reply-To: <874p9lunfv.fsf@external.prs-office.com>
References: <87lk2z3v2h.fsf@external.prs-office.com>	<48157E96.10001@elvenkind.com>
	<857ieis995.fsf@lola.goethe.zz>	<87abjduonl.fsf@external.prs-office.com>
	<874p9lunfv.fsf@external.prs-office.com>
Message-ID: <4816D140.5020701@elvenkind.com>



Vladimir Volovich wrote:
> "VV" == Vladimir Volovich writes:
> 
>  VV> does that make sense to anyone?
> 
> i tested this with GCC, and got these warnings with the -pedantic
> option:
> 
> $ gcc -c -pedantic test.c 
> test.c: In function 'test':
> test.c:7: warning: ISO C forbids casting nonscalar to the same type
> test.c:9: warning: ISO C forbids casting nonscalar to the same type
> 
> so i guess xlc's refusal to compile is not completely groundless.

Ok, found it. Patch is forthcoming.

Best wishes,
Taco

From taco at elvenkind.com  Tue Apr 29 10:04:00 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 10:04:00 +0200
Subject: [Dev-luatex] portability fixes for luatex
In-Reply-To: <87iqy1wuv2.fsf@external.prs-office.com>
References: <871w4r7aoq.fsf@external.prs-office.com>	<48158A57.5020003@elvenkind.com>
	<87iqy1wuv2.fsf@external.prs-office.com>
Message-ID: <4816D670.5030107@elvenkind.com>


Hi,

Vladimir Volovich wrote:
> 
>  TH> libs/luafontforge/fontforge/inc/basics.h: what was the problem? You
>  TH> have commented out some typedefs, but these should be harmless.
>  TH> (Fontforge is upstream for me myself, so I prefer not to make
>  TH> changes to headers unlees absolutely necessary.)
> 
> i was getting errors:

Solved like this:

   #ifndef _AIX
   typedef int32_t		int32;
   typedef int16_t		int16;
   typedef int8_t		int8;
   #endif

For the other problem, there is a patch to web2c/coerce.h. All patched
code should be checked in by the time you read this.

Best wishes,
Taco


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 10:05:59 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 10:05:59 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
Message-ID: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>

Hello,

the following PlainTeX example demonstrates some differences between
LuaTeX and plain Lua concerning the "error"-function:

--------------------------------------------------------------------

%&luatex

\directlua0{error()} % A
% \directlua0{error('')} % B

\end


(A) results in:

This is LuaTeX, Version snapshot-0.25.2-2008041019 (Web2C 7.5.6)
(Error.tex
! LuaTeX error ^^@?V[^^@^^@.
l.4 \directlua0{error()}
                         % A
?  


(B) results in:

This is LuaTeX, Version snapshot-0.25.2-2008041019 (Web2C 7.5.6)
(Error.tex
! LuaTeX error [string "luas[0]"]:1: .
l.5 \directlua0{error('')}
                           % B
? 


Compare with Lua ("error('')" only):

jonathansauer$ lua
Lua 5.1.2  Copyright (C) 1994-2007 Lua.org, PUC-Rio
> error('')
stdin:1: 
stack traceback:
        [C]: in function 'error'
        stdin:1: in main chunk
        [C]: ?
> 

--------------------------------------------------------------------

So there are two issues here:

1. When called in LuaTeX and with no parameters, <error> creates quite
   a creative error message.

2. When called in LuaTeX and with an error message, <error> does not
   display a stack traceback (contrary to the Lua interpreter).

The first one seems to be some kind of invalid pointer error (the
error message is read from somewhere in memory instead of being
omitted). The missing stacktrace is strange though.


Jonathan


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 10:11:35 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 10:11:35 +0200
Subject: [Dev-luatex] The hpack_filter callback
Message-ID: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>

Hello,

in the following PlainTeX example, I try to access all \hboxes
created by TeX by using the hpack_filter callback:

---------------------------------------------------------------

%&luatex
\directlua0{
	callback.register('hpack_filter', function(head, group, size,
ptype)
		print()
		print(group, size / 65536, ptype)
		return true
	end)
}

% From Wikipedia:
Beneath a Steel Sky is a British 1994 science fiction point and click
adventure game in the cyberpunk genre. It featured comedy elements and
was developed by Revolution Software and published by Virgin
Interactive Entertainment. It was initially released for DOS and
Amiga. Underworld was its working title.

The game was the second to use Revolution Software's Virtual Theatre
engine, the first being Lure of the Temptress.

The game's backgrounds and introduction sequence were designed by Dave
Gibbons. The introduction sequence was also included as a separate
promotional comic book in some releases of the game.

The game is considered to be among the true classics in the early era
of graphic adventure games for the early 1990s. This, in part, is
related to the mature science fiction theme that was chosen for this
game as compared to other games of the same era where fantasy themes
(a la King's Quest) had been dominant. Some critics have attributed
this difference to the different visions of the adventure game genre
between American and European developers.

\bye

This results in:


This is LuaTeX, Version snapshot-0.25.2-2008041019 (Web2C 7.5.6)
(HPackFilter.tex
adjusted_hbox	469.75498962402	exactly

adjusted_hbox	469.75498962402	exactly
 [1] )
Output written on HPackFilter.dvi (1 page, 2152 bytes).
Transcript written on HPackFilter.log.

---------------------------------------------------------------

Why does the filter not get called more often, namely once for every
line in the output file?

Background: I want to calculate the width of the last line of a
paragraph so I can adjust spacing following this paragraph
accordingly (a bit like display math does it). I tried the
buildpage_filter but did not know how to calculate the width of
the last \hbox in the list without the \parfillskip glue at the
end.

Which leads me to another question: When having a \hbox node list,
how to I determine the horizontal (when typesetting horizontally)
resp. vertical (when typesetting vertically) position of a node
relative to the left/top edge of the \hbox? I would think that
after line breaking, each node should know this position, but
how do I access it?


Jonathan


From vvv at vsu.ru  Tue Apr 29 10:20:00 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Tue, 29 Apr 2008 01:20:00 -0700
Subject: [Dev-luatex] portability fixes for luatex
In-Reply-To: <4816D670.5030107@elvenkind.com> (Taco Hoekwater's message of
	"Tue, 29 Apr 2008 10:04:00 +0200")
References: <871w4r7aoq.fsf@external.prs-office.com>
	<48158A57.5020003@elvenkind.com>
	<87iqy1wuv2.fsf@external.prs-office.com>
	<4816D670.5030107@elvenkind.com>
Message-ID: <87od7tt6mn.fsf@external.prs-office.com>

"TH" == Taco Hoekwater writes:

 TH> Solved like this:

 TH>   #ifndef _AIX typedef int32_t int32; typedef int16_t int16;
 TH> typedef int8_t int8; #endif

thanks, this will work; though a better approach would be to use
autoconf to test if these types are defined. (but that's not critical,
and needs to be done in the upstream fontforge sources to avoid
maintenance difficulties).

 TH> For the other problem, there is a patch to web2c/coerce.h. All
 TH> patched code should be checked in by the time you read this.

thank you.

Best,
v.


From taco at elvenkind.com  Tue Apr 29 11:01:49 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 11:01:49 +0200
Subject: [Dev-luatex] The hpack_filter callback
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>
Message-ID: <4816E3FD.4090205@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
> in the following PlainTeX example, I try to access all \hboxes
> created by TeX by using the hpack_filter callback:
> 
> ---------------------------------------------------------------
> [deleted]
> ---------------------------------------------------------------
> 
> Why does the filter not get called more often, namely once for every
> line in the output file?

It only gets called for explicit hboxing (that is an optimization,
but it is really needed). The manual should be clearer on this,
sorry about that.

The hpack_filter is not the right callback, at least not for now.
I could make a dedicated callback for line packaging, maybe?

It is possible to get the "prepared paragraph"  using the
"post_linebreak_filter", but then you have a bit of work to do.
Here is the code:

\directlua0{
   callback.register('post_linebreak_filter', function(head)
      % head is the alternating list of hboxes and glues etc.
      for i in node.traverse_id('hlist',head) do
           if i.next == nil then % last line has no next
              v = node.hpack(i.list,'natural')
              print (v.width / 65535)
              % next two lines prevent memory leaks
              v.list = nil
              node.free(v)
            end
         end
      return true
    end)
}

If you want to be 'perfect', you should copy i.list to and remove
the last glue(s) from the copy before hpacking() it: the final
glue(s) may have a non-zero natural width.

> Which leads me to another question: When having a \hbox node list,
> how to I determine the horizontal (when typesetting horizontally)
> resp. vertical (when typesetting vertically) position of a node
> relative to the left/top edge of the \hbox? I would think that
> after line breaking, each node should know this position, but
> how do I access it?

Using the function above, you can calculate the position within a 
paragraph by adding up the various widths and heights and depths.

Exact positions are trickier: Nothing is certain until after \output,
so using the normal position primitives (\pdfsavepos, \pdflastxpos etc)
or \latelua0 {print(pdf.h)} and a two-pass approach is probably easier
to deal with.

Best wishes,
Taco

From vvv at vsu.ru  Tue Apr 29 11:02:25 2008
From: vvv at vsu.ru (Vladimir Volovich)
Date: Tue, 29 Apr 2008 02:02:25 -0700
Subject: [Dev-luatex] .deps dirs in the repository
Message-ID: <878wyxt4ny.fsf@external.prs-office.com>

Hi!

the texlive (and luatex) repository have the .deps directories in the
zziplib package with some junk in them checked in:

Build/source/libs/zziplib/bins/.deps:
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzip-mem.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzipcat-mem.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzipcat.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzipcat-seeko.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzipdir-mem.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzipdir.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 unzzip.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzcat.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzdir.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzip.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zziptest.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzobfuscated.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzxorcat.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzxorcopy.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzxordir.Po

Build/source/libs/zziplib/SDL/.deps:
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 SDL_rwops_zzcat.Po

Build/source/libs/zziplib/test/.deps:
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzipself.Po
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzipsetstub.Po

Build/source/libs/zziplib/zzipwrap/.deps:
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 wrap.Plo
-rw-r--r-- 1 vvv vvv 8 2008-04-07 20:43 zzipwrap.Po

is there a reason for this? normally these .deps directories are created
during build automatically.

Best,
v.


From taco at elvenkind.com  Tue Apr 29 11:29:57 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 11:29:57 +0200
Subject: [Dev-luatex] [tex-live] .deps dirs in the repository
In-Reply-To: <878wyxt4ny.fsf@external.prs-office.com>
References: <878wyxt4ny.fsf@external.prs-office.com>
Message-ID: <4816EA95.9050604@elvenkind.com>



Vladimir Volovich wrote:
> Hi!
> 
> the texlive (and luatex) repository have the .deps directories in the
> zziplib package with some junk in them checked in:
> 
> Build/source/libs/zziplib/bins/.deps:
> Build/source/libs/zziplib/SDL/.deps:
> Build/source/libs/zziplib/test/.deps:
> Build/source/libs/zziplib/zzipwrap/.deps:
> 
> is there a reason for this? normally these .deps directories are created
> during build automatically.

Removed, thanks for the report.

Best wishes,
Taco


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 11:33:40 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 11:33:40 +0200
Subject: [Dev-luatex] The hpack_filter callback
References: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>
	<4816E3FD.4090205@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABDF@s-yellow.net.silverstroke.de>

Hello,

> The hpack_filter is not the right callback, at least not for now.
> I could make a dedicated callback for line packaging, maybe?
> 
> It is possible to get the "prepared paragraph"  using the
> "post_linebreak_filter", but then you have a bit of work to do.
> Here is the code:

Thank you! A few questions, though:

> \directlua0{
>    callback.register('post_linebreak_filter', function(head)
>       % head is the alternating list of hboxes and glues etc.
>       for i in node.traverse_id('hlist',head) do
>            if i.next == nil then % last line has no next
>               v = node.hpack(i.list,'natural')

"v" should be local, of course. The two-parameter form of node.hpack
is a bit strange (since not explained in the manual). Is above line
different from "v = node.hpack(i.list)"?

(Incidentally, the manual also does not note that node.traverse_id
can take a string as its first parameter.)

>               print (v.width / 65535)
>               % next two lines prevent memory leaks
>               v.list = nil

I don't quite understand why this is necessary. Since node.hpack
creates a new node list, why should this list not be freed by
node.free?

>               node.free(v)
>             end
>          end
>       return true
>     end)
> }
> 
> If you want to be 'perfect', you should copy i.list to and remove
> the last glue(s) from the copy before hpacking() it: the final
> glue(s) may have a non-zero natural width.

I'll call that a feature ;-)

> > Which leads me to another question: When having a \hbox node list,
> > how to I determine the horizontal (when typesetting horizontally)
> > resp. vertical (when typesetting vertically) position of a node
> > relative to the left/top edge of the \hbox? I would think that
> > after line breaking, each node should know this position, but
> > how do I access it?
> 
> Using the function above, you can calculate the position within a 
> paragraph by adding up the various widths and heights and depths.

Umm ... in the case of a glyph node, I then would access the font
using font.fonts[glyph.font] and then retrieve the character's
dimensions from the appropriate table? Since as far as I can see,
not all nodes store their dimension directly.


> Best wishes,
> Taco

Thanks in advance,
Jonathan


From taco at elvenkind.com  Tue Apr 29 12:05:25 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 12:05:25 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>
Message-ID: <4816F2E5.3070200@elvenkind.com>



Jonathan Sauer wrote:
> (A) results in:
> 
> This is LuaTeX, Version snapshot-0.25.2-2008041019 (Web2C 7.5.6)
> (Error.tex
> ! LuaTeX error ^^@?V[^^@^^@.

Thanks, fixed this (in repos). The code assumed that there always
was a message.

> (B) results in:
> 
> This is LuaTeX, Version snapshot-0.25.2-2008041019 (Web2C 7.5.6)
> (Error.tex
> ! LuaTeX error [string "luas[0]"]:1: .
> l.5 \directlua0{error('')}
>                            % B
> ? 

I've added the stack traceback to the output. It does not become
less confusing, though:

This is LuaTeX, Version snapshot-0.25.3-2008042911 (Web2C 7.5.6)
(error.tex
! LuaTeX error [string "luas[0]"]:1: test error
stack traceback:
         [C]: in function 'error'
         [string "luas[0]"]:1: in main chunk.
l.4 \directlua0{error('test error')}
                                      % B
?
  )



Best wishes,
Taco

From taco at elvenkind.com  Tue Apr 29 12:20:26 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 12:20:26 +0200
Subject: [Dev-luatex] The hpack_filter callback
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABDF@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>	<4816E3FD.4090205@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABDF@s-yellow.net.silverstroke.de>
Message-ID: <4816F66A.9090406@elvenkind.com>



Jonathan Sauer wrote:
> 
>> \directlua0{
>>    callback.register('post_linebreak_filter', function(head)
>>       % head is the alternating list of hboxes and glues etc.
>>       for i in node.traverse_id('hlist',head) do
>>            if i.next == nil then % last line has no next
>>               v = node.hpack(i.list,'natural')
> 
> "v" should be local, of course. 

Yes, sure. I was rather sloppy in the lua, I only tried what
worked instead of verifying the actual code.

> The two-parameter form of node.hpack
> is a bit strange (since not explained in the manual). Is above line
> different from "v = node.hpack(i.list)"?

No. In fact, my code was wrong, there is no two-argument call
possible (but in this case, that was silently ignored).

> (Incidentally, the manual also does not note that node.traverse_id
> can take a string as its first parameter.)

Same kind of error here. The code only works because
tonumber("hlist") == 0, and that is the same as the type id
of node type hlist. Coincidence.

>>               print (v.width / 65535)
>>               % next two lines prevent memory leaks
>>               v.list = nil
> 
> I don't quite understand why this is necessary. Since node.hpack
> creates a new node list, why should this list not be freed by
> node.free?

Because it is also still present in the paragraph. If you do
not clear the list item, you will get a double-free error later
on in the best case scenario. In the worst case the nodes have
been reallocated already, and the paragraph contains garbage,
potentially resulting in a crash.

A cleaner solution here would have been to hpack a copy, but
that is a lot less efficient.

>> Using the function above, you can calculate the position within a 
>> paragraph by adding up the various widths and heights and depths.
> 
> Umm ... in the case of a glyph node, I then would access the font
> using font.fonts[glyph.font] and then retrieve the character's
> dimensions from the appropriate table? Since as far as I can see,
> not all nodes store their dimension directly.

Either that, or you can hpack() the line-so-far. But in both cases,
you also have to compensate for the glue setting, so the solution
with \pdfsavepos c.s. is much easier in practice.

Best wishes,
Taco



From root at www.metatex.org  Tue Apr 29 12:22:11 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 29 Apr 2008 12:22:11 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080429102342.333EB1E8C2B1@www.metatex.org>

D    svn/trunk/src/libs/zziplib/test/.deps
 D    svn/trunk/src/libs/zziplib/SDL/.deps
 D    svn/trunk/src/libs/zziplib/zzipwrap/.deps
 D    svn/trunk/src/libs/zziplib/bins/.deps
 U    svn/trunk/src/libs/luafilesystem/src/lfs.c
 U    svn/trunk/src/libs/lua51/liolib.c
 U    svn/trunk/src/libs/luafontforge/fontforge/fontforge/namelist.c
 U    svn/trunk/src/libs/luafontforge/fontforge/inc/basics.h
 U    svn/trunk/src/libs/luazlib/lzlib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lang/texlang.c
 U    svn/trunk/src/texk/web2c/luatexdir/lang/hyphen.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/loslibext.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luatoken.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luastuff.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/postlinebreak.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texnodes.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/luafont.c
 U    svn/trunk/src/texk/web2c/web2c/coerce.h
 U    svn/trunk/manual/luatexref-t.tex
 Checked out revision 1205.

From Jonathan.Sauer at silverstroke.com  Tue Apr 29 12:34:08 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 12:34:08 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>
	<4816F2E5.3070200@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>

Hello, 

> I've added the stack traceback to the output. It does not become
> less confusing, though:
> 
> This is LuaTeX, Version snapshot-0.25.3-2008042911 (Web2C 7.5.6)
> (error.tex
> ! LuaTeX error [string "luas[0]"]:1: test error
> stack traceback:
>          [C]: in function 'error'
>          [string "luas[0]"]:1: in main chunk.
> l.4 \directlua0{error('test error')}
>                                       % B
> ?
>   )

Well, the example was a bit contrived, but when deep inside a call
hierarchy, I do not find above traceback confusing. It simply
outputs the name of the chunk (or [C] in native code) and the
function in the chunk.

BTW: loadstring can be passed a chunk name. Is it be possible to do
the same with \directlua? (to replace "[string "luas[0]"]" above)


> Best wishes,
> Taco

Jonathan


From taco at elvenkind.com  Tue Apr 29 12:51:43 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 12:51:43 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>	<4816F2E5.3070200@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>
Message-ID: <4816FDBF.70101@elvenkind.com>

Jonathan Sauer wrote:
> Hello, 
> 
>> I've added the stack traceback to the output. It does not become
>> less confusing, though:
>>
>> This is LuaTeX, Version snapshot-0.25.3-2008042911 (Web2C 7.5.6)
>> (error.tex
>> ! LuaTeX error [string "luas[0]"]:1: test error
>> stack traceback:
>>          [C]: in function 'error'
>>          [string "luas[0]"]:1: in main chunk.
>> l.4 \directlua0{error('test error')}
>>                                       % B
>> ?
>>   )
> 
> Well, the example was a bit contrived, but when deep inside a call
> hierarchy, I do not find above traceback confusing. It simply
> outputs the name of the chunk (or [C] in native code) and the
> function in the chunk.
> 
> BTW: loadstring can be passed a chunk name. Is it be possible to do
> the same with \directlua? (to replace "[string "luas[0]"]" above)

Something like \directlua callback chunk {...} you mean?


>> Best wishes,
>> Taco
> 
> Jonathan
> 
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 13:19:17 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 13:19:17 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>	<4816F2E5.3070200@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>
	<4816FDBF.70101@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABE2@s-yellow.net.silverstroke.de>

Hello,

> > BTW: loadstring can be passed a chunk name. Is it be possible to do
> > the same with \directlua? (to replace "[string "luas[0]"]" above)
> 
> Something like \directlua callback chunk {...} you mean?

Yes. Maybe \directlua cname {My chunk name} {...} (since it is the name
of the chunk, not specifically the name used in the callback/traceback).


Jonathan


From taco at elvenkind.com  Tue Apr 29 14:17:06 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 14:17:06 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ABE2@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>	<4816F2E5.3070200@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>	<4816FDBF.70101@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABE2@s-yellow.net.silverstroke.de>
Message-ID: <481711C2.4090509@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
>>> BTW: loadstring can be passed a chunk name. Is it be possible to do
>>> the same with \directlua? (to replace "[string "luas[0]"]" above)
>> Something like \directlua callback chunk {...} you mean?
> 
> Yes. Maybe \directlua cname {My chunk name} {...} (since it is the name
> of the chunk, not specifically the name used in the callback/traceback).

This idea is very interesting.  I have committed an experimental patch
that extends \directlua syntax so that besides

    \directlua <number> <general text>

it also allows a keyword prefix:

    \directlua name <general text> <number> <general text>

This allows you to do stuff like this:

    \directlua name {\jobname-\the\inputlineno} 0 {error('test')}

Because it is experimental, it only works for \directlua, not
yet for \latelua.

Best wishes,
Taco


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 14:44:51 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 14:44:51 +0200
Subject: [Dev-luatex] The hpack_filter callback
References: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>	<4816E3FD.4090205@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABDF@s-yellow.net.silverstroke.de>
	<4816F66A.9090406@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ADF8@s-yellow.net.silverstroke.de>

Hello,

> >>               print (v.width / 65535)
> >>               % next two lines prevent memory leaks
> >>               v.list = nil
> > 
> > I don't quite understand why this is necessary. Since node.hpack
> > creates a new node list, why should this list not be freed by
> > node.free?
> 
> Because it is also still present in the paragraph. If you do
> not clear the list item, you will get a double-free error later
> on in the best case scenario. In the worst case the nodes have
> been reallocated already, and the paragraph contains garbage,
> potentially resulting in a crash.

Ah, now I understand: node.hpack creates a new node list that
*contains* the original node list.

Maybe this could be noted in the manual: "Note that the new hlist
still references the original node list, so if one wishes to only
free the new hlist, the following code must be used to avoid
deallocating the original list as well:

  hlist.list = nil
  node.free(hlist)


> Best wishes,
> Taco

Jonathan


From taco at elvenkind.com  Tue Apr 29 15:20:33 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 29 Apr 2008 15:20:33 +0200
Subject: [Dev-luatex] The hpack_filter callback
In-Reply-To: <9343542E664B894484613D106D7D3F5F84ADF8@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84ABDE@s-yellow.net.silverstroke.de>	<4816E3FD.4090205@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84ABDF@s-yellow.net.silverstroke.de>	<4816F66A.9090406@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ADF8@s-yellow.net.silverstroke.de>
Message-ID: <481720A1.6060400@elvenkind.com>



Jonathan Sauer wrote:
> 
> Ah, now I understand: node.hpack creates a new node list that
> *contains* the original node list.
> 
> Maybe this could be noted in the manual: "Note that the new hlist
> still references the original node list, so if one wishes to only
> free the new hlist, the following code must be used to avoid
> deallocating the original list as well:

Still planned: a conversion from the current explicit node 
(de)allocation system to automatic garbage collection.
Until then, a remark in the manual is a good idea.

Best wishes,
Taco


From Jonathan.Sauer at silverstroke.com  Tue Apr 29 16:12:07 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 29 Apr 2008 16:12:07 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>	<4816F2E5.3070200@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>	<4816FDBF.70101@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ABE2@s-yellow.net.silverstroke.de>
	<481711C2.4090509@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84ADF9@s-yellow.net.silverstroke.de>

Hello, 

> [setting \directlua's chunk name]
> 
> This allows you to do stuff like this:
> 
>     \directlua name {\jobname-\the\inputlineno} 0 {error('test')}

Great! Thanks! I'll try it this evening (your example is especially
intriguing).


> Best wishes,
> Taco

Jonathan


From root at www.metatex.org  Tue Apr 29 16:22:05 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 29 Apr 2008 16:22:05 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20080429142330.2039A1E8C2B1@www.metatex.org>

U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luastuff.c
 U    svn/trunk/src/texk/web2c/luatexdir/ptexlib.h
 U    svn/trunk/manual/luatexref-t.tex
 Checked out revision 1207.

From Jonathan.Sauer at silverstroke.com  Wed Apr 30 09:54:18 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 30 Apr 2008 09:54:18 +0200
Subject: [Dev-luatex] "error" in LuaTeX and Lua
References: <9343542E664B894484613D106D7D3F5F84ABDD@s-yellow.net.silverstroke.de>	<4816F2E5.3070200@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84ABE0@s-yellow.net.silverstroke.de>	<4816FDBF.70101@elvenkind.com><9343542E664B894484613D106D7D3F5F84ABE2@s-yellow.net.silverstroke.de><481711C2.4090509@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84ADF9@s-yellow.net.silverstroke.de>
Message-ID: <9343542E664B894484613D106D7D3F5F84ABE5@s-yellow.net.silverstroke.de>

Hello,

> > [setting \directlua's chunk name]
> > 
> > This allows you to do stuff like this:
> > 
> >     \directlua name {\jobname-\the\inputlineno} 0 {error('test')}
> 
> Great! Thanks! I'll try it this evening (your example is especially
> intriguing).

Well, I tried it, and apart from some minor nitpicks it works
perfectly, as does <error>'s stack traceback:

--------------------------------------------------------------

%&luatex


% \directlua0{error()} % A
% \directlua0{error('')} % B

\directlua name{Test} 0{ % C
	function a() b() end
	function b() c() end
	function c() d() end
	function d() error('') end
	
	a()
}


\end

--------------------------------------------------------------

(A) results in:

This is LuaTeX, Version snapshot-0.25.3-2008042918 (Web2C 7.5.6)
(Error2.tex
! LuaTeX error .
l.4 \directlua0{error()}
                         % A
? 


(B) results in:

This is LuaTeX, Version snapshot-0.25.3-2008042918 (Web2C 7.5.6)
(Error2.tex
! LuaTeX error [string "\directlua0"]:1: 
stack traceback:
	[C]: in function 'e
rror'
	[string "\directlua0"]:1: in main chunk.
l.5 \directlua0{error('')}
                           % B
? 


Of course, (A) is not a really relevant case, since no-one in their 
right mind would call <error> without an appropriate message. Still, 
it is a bit puzzling why there is no traceback.

Also note how the traceback is wrapped in a slightly weird way. Most 
likely this is because it is written using <texio.write>, which does 
not reset its line length counter at a \r.

This is even more prominent in case (C):


This is LuaTeX, Version snapshot-0.25.3-2008042918 (Web2C 7.5.6)
(Error2.tex
! LuaTeX error [string "Test"]:1: 
stack traceback:
	[C]: in function 'error'
	
[string "Test"]:1: in function 'd'
	[string "Test"]:1: in function 'c'
	[string
 "Test"]:1: in function 'b'
	[string "Test"]:1: in function 'a'
	[string "Test"
]:1: in main chunk.
l.14 }
      
? 

Also, I would have expected the chunk name to be only 'Test'. IMO the
current form is a bit confusing. OTOH, this is also the way Lua
handles chunk names passed to <loadstring>.

Nevertheless (even though I don't know your policy on modifying library
code), I have prepared a patch for lobject.c that changes the chunk's
name (it still encloses it in [ and ] so it can be distinguished from
a 'real' Lua file):

200c200
<     else {  /* out = [string "string"] */
---
>     else {  /* out = [string] */
202c202
<       bufflen -= sizeof(" [string \"...\"] ");
---
>       bufflen -= sizeof(" [...] ");
204c204
<       strcpy(out, "[string \"");
---
>       strcpy(out, "[");
211c211
<       strcat(out, "\"]");
---
>       strcat(out, "]");


This results in:

This is LuaTeX, Version snapshot-0.25.3-2008042921 (Web2C 7.5.6)
(Error2.tex
! LuaTeX error [Test]:1: 
stack traceback:
	[C]: in function 'error'
	[Test]:1:
 in function 'd'
	[Test]:1: in function 'c'
	[Test]:1: in function 'b'
	[Test]:
1: in function 'a'
	[Test]:1: in main chunk.
l.14 }
      
? 

What do you think?


Jonathan


