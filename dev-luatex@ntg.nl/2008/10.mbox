From vext01 at gmail.com  Wed Oct  1 03:16:29 2008
From: vext01 at gmail.com (Edd Barrett)
Date: Wed, 1 Oct 2008 02:16:29 +0100
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <48E221FE.8090502@elvenkind.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
Message-ID: <a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>

Hi,

On Tue, Sep 30, 2008 at 1:56 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Can you try the patch below please?

Patch applied, looks like the same error.

lcoco.c:334:22: ucontext.h: No such file or directory
lcoco.c:372: error: syntax error before "ucontext_t"
lcoco.c: In function `coco_main':
lcoco.c:446: error: structure has no member named `ctx'
lcoco.c:446: error: structure has no member named `back'
lcoco.c: In function `lua_newcthread':
lcoco.c:463: error: structure has no member named `ctx'
lcoco.c:463: error: structure has no member named `ctx'
lcoco.c:463: error: structure has no member named `ctx'
lcoco.c:463: error: structure has no member named `ctx'
lcoco.c:463: error: structure has no member named `ctx'
lcoco.c: In function `luaCOCO_resume':
lcoco.c:479: error: structure has no member named `back'
lcoco.c:479: error: structure has no member named `ctx'
lcoco.c: In function `luaCOCO_yield':
lcoco.c:493: error: structure has no member named `ctx'
lcoco.c:493: error: structure has no member named `back'
gmake[4]: *** [lcoco.o] Error 1
gmake[4]: Leaving directory `/usr/ports/print/texlive/base/w-texlive_base-2008/t
exlive-20080816-source/work/libs/lua51'
gmake[3]: *** [posix] Error 2
gmake[3]: Leaving directory `/usr/ports/print/texlive/base/w-texlive_base-2008/t
exlive-20080816-source/work/libs/lua51'
gmake[2]: *** [../../libs/lua51/liblua.a] Error 2
gmake[2]: Leaving directory `/usr/ports/print/texlive/base/w-texlive_base-2008/t
exlive-20080816-source/work/texk/web2c'
gmake[1]: *** [all] Error 1
gmake[1]: Leaving directory `/usr/ports/print/texlive/base/w-texlive_base-2008/t
exlive-20080816-source/work/texk'
gmake: *** [all] Error 1
*** Error code 2


-- 

Best Regards

Edd

http://students.dec.bournemouth.ac.uk/ebarrett

From taco at elvenkind.com  Wed Oct  1 08:59:55 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 01 Oct 2008 08:59:55 +0200
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>	
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
Message-ID: <48E31FEB.3040104@elvenkind.com>

Edd Barrett wrote:
> Hi,
> 
> On Tue, Sep 30, 2008 at 1:56 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>> Can you try the patch below please?
> 
> Patch applied, looks like the same error.
> 
> lcoco.c:334:22: ucontext.h: No such file or directory

It should have been compiling lua with an extra -DCOCO_USE_SETJMP on the
gcc commandline, but it seems I have created a bugged Makefile. I'll try
to fix this for the next release of luatex, then.

Best wishes,
Taco

From javier at digi21.eu  Wed Oct  1 11:38:41 2008
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 1 Oct 2008 11:38:41 +0200
Subject: [Dev-luatex] How to use an OpenType font.
Message-ID: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>

I am trying to use an open type font. In the manual I can see a piece of Lua
code for loading such a font. I "suppose" that I have to enclose it within
\direclua0{}, so I wrote

\directlua0{function load_font (filename)
 local metrics = nil
 local font = fontforge.open(filename)
 if font then
  metrics = fontforge.to_table(font)
  fontforge.close(font)
 end
 return metrics
end
}
\directlua0{twelverm = load_font('C:/Windows/Fonts/LMRoman12-Regular.otf')}

but it still does not solve the problem. I have no idea of how to make the
font known for TeX.

This is command is expandable. As an example, the following input:
$\pi = \directlua0{tex.print(math.pi)}$

will result in p = 3.1415926535898

But this leaves me none the wiser about fonts. The problem is: which is the
equivalent of

\font\tenrm=cmr10

for OpenType (or TrueType) fonts?

This problem is present to some extent all troughout the manual. It seems as
if you were taking always something for granted about the
interaction between Lua and TeX that is not explained anywhere. You may find
it obvious, but keep in mind that manuals are intended for people who
still don't know.
    For somebody like me who comes from TeX, the impression got when reading
the manual (or at least the impression I had) is as having all the pieces
from a conglomerate rock but not having the cement. And the lack of examples
is exasperating. This I understand given the development state of the
program, but men, since one of the main features of LuaTeX is accesing and
modifing the TeX parameters and state with Lua code, some exemples of this,
even if kept to a minimum, would be very helpful.
   I wouldn't have any problem in taking the time to write them myself... if
knew it, but the LuaTeX manual is still very far from serving to the
learning of LuaTeX in the same way as the TeXBook serves for the learnig TeX
or "the red book" serves for the learning of the postscript language.

Continuing with my problem with using an otf font, I found some pages below
in the manual an example intended for a diferent purpose but that looked
usefull for solving my problem even if not the way it should be done. So
below the avobe mentioned lua code I boldly wrote

\directlua0 {
callback.register('define_font', function (name,size)
 if name == 'LMRoman12-Regular' then
  f = twelverm
 else
  f = font.read_tfm(name,size)
 end
 return f
end
)
}
\font\twelverm= LMRoman12-Regular
it does not work, but it exhibits a bug in LuaTeX: I get a warning at \dump
time:

luaTeX warning: lua-loaded font [1] (<NULL>) has no character table!

but right afterwards the program dies and is closed by Windows.

--Javier A.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081001/b44d3c9e/attachment.html 

From taco at elvenkind.com  Wed Oct  1 11:47:21 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 01 Oct 2008 11:47:21 +0200
Subject: [Dev-luatex] How to use an OpenType font.
In-Reply-To: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
Message-ID: <48E34729.9030108@elvenkind.com>



Javier M?gica wrote:
> I am trying to use an open type font. In the manual I can see a piece of 
> Lua code for loading such a font. I "suppose" that I have to enclose it 
> within \direclua0{}, so I wrote

The table format that is returned by fontforge cannot be used
immediately as a return table from define_font, it needs to be
converted first, that is why your test didn't work out.

There is (or at least used to be) a wiki page about TrueType/OpenType 
loading on the http://luatex.bluwiki.com , and that should help you
get started.

Best wishes,
Taco

From vafa at live.com.au  Wed Oct  1 11:51:45 2008
From: vafa at live.com.au (=?utf-8?B?2YjZgdinINiu2YTbjNmC24zYjCBWYWZhIEtoYWxpZ2hp?=)
Date: Wed, 1 Oct 2008 20:21:45 +1030
Subject: [Dev-luatex] How to use an OpenType font.
In-Reply-To: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
Message-ID: <BLU117-W15F65962933F4E26BDE77A89420@phx.gbl>


I think this should work:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\directlua0{
callback.register('define_font',
  function(name, size)
    fonttype = nil
    filename = kpse.find_file(name,"opentype fonts")
    if (filename)
    then fonttype = 'opentype'
    else filename = kpse.find_file(name, "truetype fonts")
    end
    if filename and not fonttype then fonttype = 'truetype' end
    if fonttype then
      if (size < 0) then size = (- 655.36) * size end
      ttffont = fontforge.to_table(fontforge.open(filename))
      if ttffont then
        f = { }
        f.name = ttffont.fontname
        f.fullname = ttffont.names[1].names.fullname
        f.parameters = { }
        f.designsize = size
        f.size = size
        direction = 0
        f.parameters.slant = 0
        f.parameters.space = size * 0.25
        f.parameters.space_stretch = 0.3 * size
        f.parameters.space_shrink = 0.1 * size
        f.parameters.x_height = 0.4 * size
        f.parameters.quad = 1.0 * size
        f.parameters.extra_space = 0
        f.characters = { }
        mag = size / ttffont.units_per_em

         names_of_char = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_char[ttffont.glyphs[glyph].name]
            = ttffont.map.backmap[glyph]
        end

        names_of_glyph = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_glyph[ttffont.glyphs[glyph].name]
            = glyph
        end

       for char, glyph in pairs(ttffont.map.map)
        do
          glyph_table = ttffont.glyphs[glyph]

          f.characters[char] = {
            index = glyph,
            width = glyph_table.width * mag,
            name = glyph_table.name,
          }
          if glyph_table.kerns then
            local kerns = { }
            for _, kern in pairs(glyph_table.kerns)
            do
              kerns[names_of_char[kern.char]] = kern.off * mag
            end
          f.characters[char].kerns = kerns
          end
        end
        f.filename = filename
        f.type = 'real'
        f.format = fonttype
        f.embedding = "subset"
        f.cidinfo = {
          registry = "Adobe",
          ordering = "Identity",
          supplement = 0,
          version = 1
        }
      end
    else
      f = font.read_tfm(name, size)
    end
  return f
  end
)
}

\font\test=nazli.ttf at 12pt
\test
Hi. This is just a test.
\end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
Hope that helps

________________________________
> Date: Wed, 1 Oct 2008 11:38:41 +0200
> From: javier at digi21.eu
> To: dev-luatex at ntg.nl
> Subject: [Dev-luatex] How to use an OpenType font.
> 
> I am trying to use an open type font. In the manual I can see a piece of Lua code for loading such a font. I "suppose" that I have to enclose it within \direclua0{}, so I wrote
> 
> \directlua0{function load_font (filename)
>  local metrics = nil
>  local font = fontforge.open(filename)
>  if font then
>   metrics = fontforge.to_table(font)
>   fontforge.close(font)
>  end
>  return metrics
> end
> }
> \directlua0{twelverm = load_font('C:/Windows/Fonts/LMRoman12-Regular.otf')}
> 
> but it still does not solve the problem. I have no idea of how to make the font known for TeX.
> 
> This is command is expandable. As an example, the following input:
> $\pi = \directlua0{tex.print(math.pi)}$
> 
> will result in p = 3.1415926535898
> 
> But this leaves me none the wiser about fonts. The problem is: which is the equivalent of
> 
> \font\tenrm=cmr10
> 
> for OpenType (or TrueType) fonts?
> 
> This problem is present to some extent all troughout the manual. It seems as if you were taking always something for granted about the interaction between Lua and TeX that is not explained anywhere. You may find it obvious, but keep in mind that manuals are intended for people who still don't know.
>     For somebody like me who comes from TeX, the impression got when reading the manual (or at least the impression I had) is as having all the pieces from a conglomerate rock but not having the cement. And the lack of examples is exasperating. This I understand given the development state of the program, but men, since one of the main features of LuaTeX is accesing and modifing the TeX parameters and state with Lua code, some exemples of this, even if kept to a minimum, would be very helpful.
>    I wouldn't have any problem in taking the time to write them myself... if knew it, but the LuaTeX manual is still very far from serving to the learning of LuaTeX in the same way as the TeXBook serves for the learnig TeX or "the red book" serves for the learning of the postscript language.
> 
> Continuing with my problem with using an otf font, I found some pages below in the manual an example intended for a diferent purpose but that looked usefull for solving my problem even if not the way it should be done. So below the avobe mentioned lua code I boldly wrote
> 
> \directlua0 {
> callback.register('define_font', function (name,size)
>  if name == 'LMRoman12-Regular' then
>   f = twelverm
>  else
>   f = font.read_tfm(name,size)
>  end
>  return f
> end
> )
> }
> \font\twelverm= LMRoman12-Regular
> it does not work, but it exhibits a bug in LuaTeX: I get a warning at \dump time:
> 
> luaTeX warning: lua-loaded font [1] () has no character table!
> 
> but right afterwards the program dies and is closed by Windows.
> 
> --Javier A.

_________________________________________________________________


From javier at digi21.eu  Wed Oct  1 12:02:41 2008
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 1 Oct 2008 12:02:41 +0200
Subject: [Dev-luatex] How to use an OpenType font.
In-Reply-To: <48E34729.9030108@elvenkind.com>
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
	<48E34729.9030108@elvenkind.com>
Message-ID: <5088e64f0810010302i1d972d50y2c94b4b78abeab6c@mail.gmail.com>

>
>
> Javier M?gica wrote:
>
>>
>
>  [...] lack of examples [...]
>
>
>
> There is (or at least used to be) a wiki page about TrueType/OpenType
> loading on the http://luatex.bluwiki.com , and that should help you
> get started.
>
> Best wishes,
> Taco
>
So the examples I were missing can be found there. You could provide this
link in the page

http://www.luatex.org/documentation.html

it will help a lot.

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081001/51550b89/attachment.html 

From Jonathan.Sauer at silverstroke.com  Wed Oct  1 12:13:45 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 1 Oct 2008 12:13:45 +0200
Subject: [Dev-luatex] How to use an OpenType font.
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
	<BLU117-W15F65962933F4E26BDE77A89420@phx.gbl>
Message-ID: <9343542E664B894484613D106D7D3F5FA9727C@s-yellow.net.silverstroke.de>

Hello, 

a few corrections and annotations (the code, BTW, is taken from
the already mentioned wiki
<http://luatex.bluwiki.com/go/Use_a_TrueType_font>).

>         mag = size / ttffont.units_per_em

This should be "local mag = size / ttffont.units_per_em".

>           f.characters[char] = {
>             index = glyph,
>             width = glyph_table.width * mag,
>             name = glyph_table.name,
>           }

This does not set the height and depth of the character correctly,
which I found results in spacing errors before and after large
display maths. In my code, I have added:

	if glyph_table.boundingbox[4] then
		f.characters[char].height = glyph_table.boundingbox[4] *
mag
	end

	if glyph_table.boundingbox[2] then
		f.characters[char].depth = -glyph_table.boundingbox[2] *
mag
	end

>           if glyph_table.kerns then
>             local kerns = { }
>             for _, kern in pairs(glyph_table.kerns)
>             do
>               kerns[names_of_char[kern.char]] = kern.off * mag
>             end
>           f.characters[char].kerns = kerns
>           end
>         end
>         f.filename = filename
>         f.type = 'real'
>         f.format = fonttype
>         f.embedding = "subset"
>         f.cidinfo = {
>           registry = "Adobe",
>           ordering = "Identity",
>           supplement = 0,
>           version = 1
>         }
>       end
>     else
>       f = font.read_tfm(name, size)
>     end
>   return f
>   end
> )
> }

Also note that the loaded font will not have any ligatures.


Jonathan


From yharalambous at me.com  Wed Oct  1 11:48:14 2008
From: yharalambous at me.com (Yannis Haralambous)
Date: Wed, 01 Oct 2008 11:48:14 +0200
Subject: [Dev-luatex] How to use an OpenType font.
In-Reply-To: <48E34729.9030108@elvenkind.com>
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
	<48E34729.9030108@elvenkind.com>
Message-ID: <39460AE4-E4D3-4F66-B7B9-F73496CD8C04@me.com>

Le 1 oct. 08 ? 11:47, Taco Hoekwater a ?crit :

> There is (or at least used to be) a wiki page about TrueType/OpenType
> loading on the http://luatex.bluwiki.com , and that should help you
> get started.

Indeed, the information is still on the Wiki and you are invited to  
supply more entries...

Yannis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081001/13069d1c/attachment.html 

From list at nililand.de  Wed Oct  1 12:00:27 2008
From: list at nililand.de (Ulrike Fischer)
Date: Wed, 1 Oct 2008 12:00:27 +0200
Subject: [Dev-luatex] How to use an OpenType font.
In-Reply-To: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
Message-ID: <1131873293.20081001120027@nililand.de>

Guten Tag Javier M?gica,

am Mittwoch, 1. Oktober 2008 um 11:38 schrieben Sie:

> I am trying to use an open type font. In the manual I can see a piece of Lua
> code for loading such a font. I "suppose" that I have to enclose it within
> \direclua0{}, so I wrote


> but it still does not solve the problem. I have no idea of how to make the
> font known for TeX.

The example below works for me together with a "lualatex" format.
But is rather crude and  certainly will need extension.


> This problem is present to some extent all troughout the manual. It seems as
> if you were taking always something for granted about the
> interaction between Lua and TeX that is not explained anywhere. You may find
> it obvious, but keep in mind that manuals are intended for people who
> still don't know.
>     For somebody like me who comes from TeX, the impression got when reading
> the manual (or at least the impression I had) is as having all the pieces
> from a conglomerate rock but not having the cement. And the lack of examples
> is exasperating.

luatex is still very beta. So you shouldn't expect its documentation to be
complete.

> This I understand given the development state of the
> program, but men, since one of the main features of LuaTeX is accesing and
> modifing the TeX parameters and state with Lua code, some exemples of this,
> even if kept to a minimum, would be very helpful.

Heiko Oberdiek has made some packages with use lua. They are quite
informativ. There is a lua-inputenc on CTAN. And the wiki-page where I
got the font code has also some example.

The context sources contains a lot of lua code. (But I don't find them
very useful -- to complicated for me.)



\pdfoutput=1
\documentclass{article}
% From http://luatex.bluwiki.com/go/Use_a_TrueType_font
\directlua0{
callback.register('define_font',
  function(name, size)
    fonttype = nil
    filename = kpse.find_file(name,"opentype fonts")
    if (filename)
    then fonttype = 'opentype'
    else filename = kpse.find_file(name, "truetype fonts")
    end
    if filename and not fonttype then fonttype = 'truetype' end
    if fonttype then
      if (size < 0) then size = (- 655.36) * size end
      ttffont = fontforge.to_table(fontforge.open(filename))
      if ttffont then
        f = { }
        f.name = ttffont.fontname
        f.fullname = ttffont.names[1].names.fullname
        f.parameters = { }
        f.designsize = size
        f.size = size
        direction = 0
        f.parameters.slant = 0
        f.parameters.space = size * 0.25
        f.parameters.space_stretch = 0.3 * size
        f.parameters.space_shrink = 0.1 * size
        f.parameters.x_height = 0.4 * size
        f.parameters.quad = 1.0 * size
        f.parameters.extra_space = 0
        f.characters = { }
        mag = size / ttffont.units_per_em

         names_of_char = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_char[ttffont.glyphs[glyph].name]
            = ttffont.map.backmap[glyph]
        end

        names_of_glyph = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_glyph[ttffont.glyphs[glyph].name]
            = glyph
        end

       for char, glyph in pairs(ttffont.map.map)
        do
          glyph_table = ttffont.glyphs[glyph]

          f.characters[char] = {
            index = glyph,
            width = glyph_table.width * mag,
            name = glyph_table.name,
          }
          if glyph_table.kerns then
            local kerns = { }
            for _, kern in pairs(glyph_table.kerns)
            do
              kerns[names_of_char[kern.char]] = kern.off * mag
            end
          f.characters[char].kerns = kerns
          end
        end
        f.filename = filename
        f.type = 'real'
        f.format = fonttype
        f.embedding = "subset"
        f.cidinfo = {
          registry = "Adobe",
          ordering = "Identity",
          supplement = 0,
          version = 1
        }
      end
    else
      f = font.read_tfm(name, size)
    end
  return f
  end
)
}

\begin{document}
\font\lm=lmroman10-regular at 10pt

\lm  This is
Latin Modern in Opentype format This is Latin Modern in Opentype
format This is Latin Modern in Opentype format This is Latin Modern in
Opentype format

\end{document} 


-- 
Mit freundlichen Gr??en
Ulrike Fischer
mailto:list at nililand.de



From martin at oneiros.de  Wed Oct  1 13:43:46 2008
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 1 Oct 2008 13:43:46 +0200
Subject: [Dev-luatex] Fwd: [pdf-devel] Adobe release of ISO32000-1
In-Reply-To: <48E35D7D.7020101@es.gnu.org>
References: <48E35D7D.7020101@es.gnu.org>
Message-ID: <68c491a60810010443q135dd51uf21ea4bee002ff08@mail.gmail.com>

---------- Forwarded message ----------
From: Aleksander Morgado <aleksander at es.gnu.org>
Date: 2008/10/1
Subject: [pdf-devel] Adobe release of ISO32000-1
To: pdf-devel at gnu.org


The Adobe release of ISO32000-1 is now publicly available in their website:

http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf

Cheers,
-Aleksander

From Jonathan.Sauer at silverstroke.com  Wed Oct  1 13:52:35 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 1 Oct 2008 13:52:35 +0200
Subject: [Dev-luatex] How to use an OpenType font.
References: <5088e64f0810010238j46d506bcm4627858824ae73d9@mail.gmail.com>
	<BLU117-W15F65962933F4E26BDE77A89420@phx.gbl>
	<9343542E664B894484613D106D7D3F5FA9727C@s-yellow.net.silverstroke.de>
	<50F22E88-055F-4D45-93DC-01768E6D7CA7@telecom-bretagne.eu>
Message-ID: <9343542E664B894484613D106D7D3F5FA9727E@s-yellow.net.silverstroke.de>

Hello, 

> please feel and change the code on the Wiki, that's the whole of
> having a public Wiki...

Yes, of course. I was thoughtless.

> have you tried to apply the corrections?

I have. The wiki example is now corrected, although I have not
added any code for ligatures. Although I have code that works, it
is very hackish and most likely will not suffice for more than
simple f-f/f-f-i ligatures.

I of course can post my OTF code to the wiki, but caveat emptor
;-)


Jonathan


From root at www.metatex.org  Wed Oct  1 16:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  1 Oct 2008 16:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081001142403.70EA61E8C2C1@www.metatex.org>

------------------------------------------------------------------------
r1525 | taco | 2008-10-01 13:44:46 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/Makefile
   M /trunk/src/libs/luafontforge/src/luafflib.c

make sure the new handling of .notdef does not crash on CID fonts

------------------------------------------------------------------------
r1526 | taco | 2008-10-01 13:45:49 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/Makefile

#1525 had an accidental commit for trunk/src/libs/lua51/Makefile, revert

------------------------------------------------------------------------
r1527 | taco | 2008-10-01 14:44:23 +0200 (Wed, 01 Oct 2008) | 3 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/writettf.c
   M /trunk/src/texk/web2c/luatexdir/font/writetype0.c

always xfree the ttf_buffer after font loading. 
(there was a memory leak that could become quite big)

------------------------------------------------------------------------
r1528 | taco | 2008-10-01 15:39:23 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/writetype2.c

two more leaks

------------------------------------------------------------------------
r1529 | taco | 2008-10-01 16:17:31 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/writet1.c
   M /trunk/src/texk/web2c/luatexdir/font/writetype2.c

more (small) memory leaks plugged 

------------------------------------------------------------------------

From root at www.metatex.org  Wed Oct  1 22:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  1 Oct 2008 22:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081001202403.712B21E8C3A9@www.metatex.org>

------------------------------------------------------------------------
r1530 | oneiros | 2008-10-01 18:32:19 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/fontforge/fontforge/featurefile.c

fix two warnings: field precision should have type ?\226?\128?\152int?\226?\128?\153, but argument 3 has type ?\226?\128?\152long int?\226?\128?\153

------------------------------------------------------------------------
r1531 | oneiros | 2008-10-01 18:44:51 +0200 (Wed, 01 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/luazlib/lzlib.c

fix a lot of warning: pointer targets in assignment differ in signedness

------------------------------------------------------------------------

From root at www.metatex.org  Thu Oct  2 22:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  2 Oct 2008 22:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081002202403.AB1AC1E8C3F0@www.metatex.org>

------------------------------------------------------------------------
r1532 | taco | 2008-10-02 17:13:35 +0200 (Thu, 02 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/liolib.c

attempt to speed up reading whole files via f:read()

------------------------------------------------------------------------

From root at www.metatex.org  Fri Oct  3 12:24:21 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  3 Oct 2008 12:24:21 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081003102421.E57581E8C3F0@www.metatex.org>

------------------------------------------------------------------------
r1533 | oneiros | 2008-10-02 22:39:27 +0200 (Thu, 02 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

indent and add some explicit braces

------------------------------------------------------------------------

From root at www.metatex.org  Fri Oct  3 16:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  3 Oct 2008 16:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081003142403.AA8CB1E8C3F0@www.metatex.org>

------------------------------------------------------------------------
r1534 | taco | 2008-10-03 12:53:54 +0200 (Fri, 03 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/writefont.c
   M /trunk/src/texk/web2c/luatexdir/font/writet1.c
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/src/texk/web2c/luatexdir/lua/luatoken.c
   M /trunk/src/texk/web2c/luatexdir/tex/texnodes.c
   M /trunk/src/texk/web2c/luatexdir/tex/textoken.c

a bunch of small speedups to the C code

------------------------------------------------------------------------
r1535 | oneiros | 2008-10-03 15:41:47 +0200 (Fri, 03 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c

fix a warning: pointer targets in passing argument 1 of ?\226?\128?\152__builtin_strncpy?\226?\128?\153 differ in signedness

------------------------------------------------------------------------
r1536 | oneiros | 2008-10-03 15:42:38 +0200 (Fri, 03 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c

indent

------------------------------------------------------------------------

From root at www.metatex.org  Fri Oct  3 22:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri,  3 Oct 2008 22:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081003202403.815621E8C3F0@www.metatex.org>

------------------------------------------------------------------------
r1537 | taco | 2008-10-03 16:55:38 +0200 (Fri, 03 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web
   M /trunk/src/texk/web2c/luatexdir/textcodes.c

we can gain some more speed by limiting the number of catcode tables to 64KB 

------------------------------------------------------------------------

From root at www.metatex.org  Mon Oct  6 12:24:15 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  6 Oct 2008 12:24:15 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081006102415.E89341E8C3F2@www.metatex.org>

------------------------------------------------------------------------
r1538 | taco | 2008-10-06 11:30:37 +0200 (Mon, 06 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/src/luafflib.c

only fix notdef for pfb/pfa files

------------------------------------------------------------------------
r1539 | taco | 2008-10-06 11:52:07 +0200 (Mon, 06 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/image/pdftoepdf.cc

make sure there actually is a pageGroup before using it 

------------------------------------------------------------------------

From root at www.metatex.org  Mon Oct  6 16:24:03 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  6 Oct 2008 16:24:03 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081006142403.416551E8C3F2@www.metatex.org>

------------------------------------------------------------------------
r1540 | taco | 2008-10-06 14:47:54 +0200 (Mon, 06 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/textcodes.c

fix a leak 

------------------------------------------------------------------------
r1541 | taco | 2008-10-06 14:48:21 +0200 (Mon, 06 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/Makefile

force coco to use setjmp (this improves portability)

------------------------------------------------------------------------

From root at www.metatex.org  Mon Oct  6 22:24:02 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon,  6 Oct 2008 22:24:02 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081006202402.C78951E8C3F2@www.metatex.org>

------------------------------------------------------------------------
r1542 | taco | 2008-10-06 17:17:13 +0200 (Mon, 06 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/mpdir/config.h.in
   M /trunk/src/texk/web2c/mpdir/configure
   M /trunk/src/texk/web2c/mpdir/configure.in
   M /trunk/src/texk/web2c/mpdir/lmplib.c
   M /trunk/src/texk/web2c/mpdir/memio.w
   M /trunk/src/texk/web2c/mpdir/mp.w
   M /trunk/src/texk/web2c/mpdir/mpost.w
   M /trunk/src/texk/web2c/mpdir/mpxout.w
   M /trunk/src/texk/web2c/mpdir/psout.w
   M /trunk/src/texk/web2c/mpdir/tfmin.w

import newer mplib (1.091+dev)

------------------------------------------------------------------------

From root at www.metatex.org  Tue Oct  7 12:24:16 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  7 Oct 2008 12:24:16 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081007102416.4DBD81E8C405@www.metatex.org>

------------------------------------------------------------------------
r1543 | taco | 2008-10-07 09:54:40 +0200 (Tue, 07 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/luafontforge/src/luafflib.c

dont compare nonexisting origname strings

------------------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Tue Oct  7 13:05:25 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 7 Oct 2008 13:05:25 +0200
Subject: [Dev-luatex] # => ## in \directlua
Message-ID: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>

Hello,

take the following PlainTeX file:

%&luatex
\def\recatcode#1{%
	\directlua0{%
		tex.sprint('\luaescapestring{\unexpanded{#1}}')%
		texio.write_nl('\luaescapestring{\unexpanded{#1}}')%
	}%
}

\recatcode{%
	\def\test#1{`#1'}%
}

\bye


This results in

This is LuaTeX, Version snapshot-0.30.0-2008093018 (Web2C 7.5.7)
(MacroParameterCharacter.tex
\def \test ##1{`##1'}
! Parameters must be numbered consecutively.
<to be read again> 
                   ##
l.1 \def \test ##
                 1{`##1'}
\recatcode ...uaescapestring {\unexpanded {#1}}')}
                                                  
l.12 }
      
? x
TeX interrupted.  No pages of output.
Transcript written on MacroParameterCharacter.log.


So `#' is transformed into `##' when passed from TeX to Lua. Is this a
bug or a feature?


Jonathan


From dak at gnu.org  Tue Oct  7 13:31:38 2008
From: dak at gnu.org (David Kastrup)
Date: Tue, 07 Oct 2008 13:31:38 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Tue, 7 Oct 2008 13:05:25 +0200")
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
Message-ID: <863aj8prol.fsf@lola.quinscape.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> take the following PlainTeX file:
>
> %&luatex
> \def\recatcode#1{%
> 	\directlua0{%
> 		tex.sprint('\luaescapestring{\unexpanded{#1}}')%
> 		texio.write_nl('\luaescapestring{\unexpanded{#1}}')%
> 	}%
> }
>
> \recatcode{%
> 	\def\test#1{`#1'}%
> }
>
> \bye
>
>
> This results in
>
> This is LuaTeX, Version snapshot-0.30.0-2008093018 (Web2C 7.5.7)
> (MacroParameterCharacter.tex
> \def \test ##1{`##1'}
> ! Parameters must be numbered consecutively.
> <to be read again> 
>                    ##
> l.1 \def \test ##
>                  1{`##1'}
> \recatcode ...uaescapestring {\unexpanded {#1}}')}
>                                                   
> l.12 }
>       
> ? x
> TeX interrupted.  No pages of output.
> Transcript written on MacroParameterCharacter.log.
>
>
> So `#' is transformed into `##' when passed from TeX to Lua.

No, when TeX prints.

> Is this a bug or a feature?

Feature.  Quite an annoying one in my opinion, but there you are.

-- 
David Kastrup

From mpg at elzevir.fr  Tue Oct  7 13:41:37 2008
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 07 Oct 2008 13:41:37 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <863aj8prol.fsf@lola.quinscape.zz>
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
	<863aj8prol.fsf@lola.quinscape.zz>
Message-ID: <48EB4AF1.7030805@elzevir.fr>

David Kastrup a ?crit :
>> So `#' is transformed into `##' when passed from TeX to Lua.
> 
> No, when TeX prints.
> 
>> Is this a bug or a feature?
> 
> Feature.  Quite an annoying one in my opinion, but there you are.
> 
By the way, using LaTeX, the "ted" package has a command \ShowTokens
which is meant to be handy to examine token lists: is doesn't have this
"funny feature" of doubling ## (nor of addind spaces after some cs
names) and moreover, lets you know about the catcodes and distinguishes
between cs names and plain stings (unlike \show, \showtokens, etc.)

Manuel.


From Jonathan.Sauer at silverstroke.com  Tue Oct  7 13:55:44 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 7 Oct 2008 13:55:44 +0200
Subject: [Dev-luatex] # => ## in \directlua
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
	<863aj8prol.fsf@lola.quinscape.zz> <48EB4D5C.1000000@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>

Hello, 

> >> So `#' is transformed into `##' when passed from TeX to Lua.
> [...]
> This currently uses TeX's tokenlist print function, but I could
> make it behave differently, no problem (after all, this
> generated string is only 'seen' by the lua interpreter).

In that case: Please make it so.


> Best wishes,
> Taco

Thanks in advance,
Jonathan


From taco at elvenkind.com  Tue Oct  7 13:51:56 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 07 Oct 2008 13:51:56 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <863aj8prol.fsf@lola.quinscape.zz>
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
	<863aj8prol.fsf@lola.quinscape.zz>
Message-ID: <48EB4D5C.1000000@elvenkind.com>



David Kastrup wrote:
>>
>> So `#' is transformed into `##' when passed from TeX to Lua.
> 
> No, when TeX prints.

You are saying the same thing. The tokenlist that results from
the <general text> that is read after the \directlua is internally
converted to a string before the lua interpreter gets a look at it.

This currently uses TeX's tokenlist print function, but I could
make it behave differently, no problem (after all, this
generated string is only 'seen' by the lua interpreter).


Best wishes,
Taco



From dak at gnu.org  Tue Oct  7 15:02:14 2008
From: dak at gnu.org (David Kastrup)
Date: Tue, 07 Oct 2008 15:02:14 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Tue, 7 Oct 2008 13:55:44 +0200")
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de>
	<863aj8prol.fsf@lola.quinscape.zz> <48EB4D5C.1000000@elvenkind.com>
	<9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>
Message-ID: <86prmco8x5.fsf@lola.quinscape.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> Hello, 
>
>> >> So `#' is transformed into `##' when passed from TeX to Lua.
>> [...]
>> This currently uses TeX's tokenlist print function, but I could
>> make it behave differently, no problem (after all, this
>> generated string is only 'seen' by the lua interpreter).
>
> In that case: Please make it so.

It is consistent with TeX's printing mechanism.  You could deal with
this problem by placing the resulting string inside of a macro body
(where ## will get collapsed to # while the body is being collected) and
then use it from there.

Disadvantage: this is not an expandible method.

-- 
David Kastrup

From Jonathan.Sauer at silverstroke.com  Tue Oct  7 15:16:28 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 7 Oct 2008 15:16:28 +0200
Subject: [Dev-luatex] # => ## in \directlua
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de><863aj8prol.fsf@lola.quinscape.zz>
	<48EB4D5C.1000000@elvenkind.com><9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>
	<86prmco8x5.fsf@lola.quinscape.zz>
Message-ID: <9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>

Hello, 

> >> >> So `#' is transformed into `##' when passed from TeX to Lua.
> >> [...]
> >> This currently uses TeX's tokenlist print function, but I could
> >> make it behave differently, no problem (after all, this
> >> generated string is only 'seen' by the lua interpreter).
> >
> > In that case: Please make it so.
> 
> It is consistent with TeX's printing mechanism.

Sure. But I don't think that this consistency is necessary. Also,
I would guess that "#" in a token register is not doubled when the
token register is accessed from Lua, so it would be consistent with
how "#" between TeX and Lua is handled there.

> You could deal with this problem by placing the resulting string
> inside of a macro body (where ## will get collapsed to # while the
> body is being collected) and then use it from there.
>
> Disadvantage: this is not an expandible method.

Or I could use gsub in the Lua code.

Disadvantage: It is expandable, but slower. Also, I need two
functions in Lua: One to be called from TeX, and one to be called
from other Lua functions.


Jonathan


From taco at elvenkind.com  Tue Oct  7 16:54:27 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 07 Oct 2008 16:54:27 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de><863aj8prol.fsf@lola.quinscape.zz>	<48EB4D5C.1000000@elvenkind.com><9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>	<86prmco8x5.fsf@lola.quinscape.zz>
	<9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>
Message-ID: <48EB7823.9010506@elvenkind.com>



Jonathan Sauer wrote:
> Hello, 
> 
>>>>>> So `#' is transformed into `##' when passed from TeX to Lua.
>>>> [...]
>>>> This currently uses TeX's tokenlist print function, but I could
>>>> make it behave differently, no problem (after all, this
>>>> generated string is only 'seen' by the lua interpreter).
>>> In that case: Please make it so.
>> It is consistent with TeX's printing mechanism.
> 
> Sure. But I don't think that this consistency is necessary. Also,
> I would guess that "#" in a token register is not doubled when the
> token register is accessed from Lua, so it would be consistent with
> how "#" between TeX and Lua is handled there.

Actually the problem was with \luaescapestring. Commit #1544 changes
the behaviour of \luaescapestring so that it no longer duplicates
characters with catcode 6. Please verify that that does what you want.

Best wishes,
Taco

From root at www.metatex.org  Tue Oct  7 22:24:02 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue,  7 Oct 2008 22:24:02 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@metatex>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081007202402.33BEB1E8C3B0@www.metatex.org>

------------------------------------------------------------------------
r1544 | taco | 2008-10-07 16:53:07 +0200 (Tue, 07 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

do not double mac_params when inside \luaescapestring

------------------------------------------------------------------------
r1545 | taco | 2008-10-07 18:23:52 +0200 (Tue, 07 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/mpdir/mp.w

a new mp.w that speeds up mp string concatenation

------------------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Wed Oct  8 09:48:43 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 8 Oct 2008 09:48:43 +0200
Subject: [Dev-luatex] # => ## in \directlua
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de><863aj8prol.fsf@lola.quinscape.zz>	<48EB4D5C.1000000@elvenkind.com><9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>	<86prmco8x5.fsf@lola.quinscape.zz>
	<9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>
	<48EB7823.9010506@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5FA97287@s-yellow.net.silverstroke.de>

Hello, 

> Actually the problem was with \luaescapestring. Commit #1544 changes
> the behaviour of \luaescapestring so that it no longer duplicates
> characters with catcode 6. Please verify that that does what you want.

Thank you very much! I tried it with the following (simpler) example:

%&luatex

\directlua0{%
	texio.write_nl('\luaescapestring{\unexpanded{#}}')%
	texio.write_nl('\luaescapestring{#}')%
	texio.write_nl('#')%
% 	texio.write_nl(#_VERSION)% A
}

\bye


This is LuaTeX, Version snapshot-0.30.0-2008100718 (Web2C 7.5.7)
(MacroParameterCharacter2.tex
#
#
## )
No pages of output.
Transcript written on MacroParameterCharacter2.log.


So with \luaescapestring, the `#' is not doubled anymore, without it
still is. Although most of the time, strings will be passed to Lua
through \luaescapestring, this behaviour still creates problems when
`#' is used inside Lua code (as in the commented line A above, where I
try to print the length of the _VERSION string); also it is a bit
inconsistent.

What do you think?


> Best wishes,
> Taco

Jonathan


From taco at elvenkind.com  Wed Oct  8 09:53:45 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 08 Oct 2008 09:53:45 +0200
Subject: [Dev-luatex] # => ## in \directlua
In-Reply-To: <9343542E664B894484613D106D7D3F5FA97287@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de><863aj8prol.fsf@lola.quinscape.zz>	<48EB4D5C.1000000@elvenkind.com><9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>	<86prmco8x5.fsf@lola.quinscape.zz>	<9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>	<48EB7823.9010506@elvenkind.com>
	<9343542E664B894484613D106D7D3F5FA97287@s-yellow.net.silverstroke.de>
Message-ID: <48EC6709.3090602@elvenkind.com>



Jonathan Sauer wrote:
> 
> So with \luaescapestring, the `#' is not doubled anymore, without it
> still is. Although most of the time, strings will be passed to Lua
> through \luaescapestring, this behaviour still creates problems when
> `#' is used inside Lua code (as in the commented line A above, where I
> try to print the length of the _VERSION string); also it is a bit
> inconsistent.
> 
> What do you think?

#1546

Best wishes,
Taco

From list at nililand.de  Wed Oct  8 11:41:11 2008
From: list at nililand.de (Ulrike Fischer)
Date: Wed, 8 Oct 2008 11:41:11 +0200
Subject: [Dev-luatex] Problem with a test with ^^-notation.
Message-ID: <207550367.20081008114111@nililand.de>

Hello,


I ran into a problem with the LaTeX-package listing related to the
handling of extendedchars (it can be easily avoid by using
extendedchars=false).


I think I have tracked down the problem to the following difference
between luatex and pdftex/xetex:

\documentclass{article}
\begin{document}
\catcode`\^^00=13
\ifnum`^^00=0 ja \else nein \fi

\end{document}

When processed with LaTeX or XeLaTeX I get a document with "ja".
Luatex gives "nein". Is this difference to be expected?


-- 
Mit freundlichen Gr??en
Ulrike Fischer
mailto:list at nililand.de


From Jonathan.Sauer at silverstroke.com  Wed Oct  8 11:48:37 2008
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 8 Oct 2008 11:48:37 +0200
Subject: [Dev-luatex] # => ## in \directlua
References: <9343542E664B894484613D106D7D3F5FA957A2@s-yellow.net.silverstroke.de><863aj8prol.fsf@lola.quinscape.zz>	<48EB4D5C.1000000@elvenkind.com><9343542E664B894484613D106D7D3F5FA97284@s-yellow.net.silverstroke.de>	<86prmco8x5.fsf@lola.quinscape.zz>	<9343542E664B894484613D106D7D3F5FA97285@s-yellow.net.silverstroke.de>	<48EB7823.9010506@elvenkind.com>
	<9343542E664B894484613D106D7D3F5FA97287@s-yellow.net.silverstroke.de>
	<48EC6709.3090602@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5FA97288@s-yellow.net.silverstroke.de>

Hello, 

> > So with \luaescapestring, the `#' is not doubled anymore, without it
> > still is. Although most of the time, strings will be passed to Lua
> > through \luaescapestring, this behaviour still creates problems when
> > `#' is used inside Lua code (as in the commented line A above, where
I
> > try to print the length of the _VERSION string); also it is a bit
> > inconsistent.
> > 
> > What do you think?
> 
> #1546

Thank you!


> Best wishes,
> Taco

Jonathan


From root at www.metatex.org  Wed Oct  8 12:24:45 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  8 Oct 2008 12:24:45 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081008102445.38D601E8C2AC@www.metatex.org>

------------------------------------------------------------------------
r1546 | taco | 2008-10-08 09:54:08 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/luatoken.c

don't duplicate #'s in \directlua

------------------------------------------------------------------------
r1547 | taco | 2008-10-08 11:50:46 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/mpdir/mp.w
   M /trunk/src/texk/web2c/mpdir/psout.w

incorporate a few small mpost fixes

------------------------------------------------------------------------

From taco at elvenkind.com  Wed Oct  8 12:51:38 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 08 Oct 2008 12:51:38 +0200
Subject: [Dev-luatex] Problem with a test with ^^-notation.
In-Reply-To: <207550367.20081008114111@nililand.de>
References: <207550367.20081008114111@nililand.de>
Message-ID: <48EC90BA.4060005@elvenkind.com>

Hi Ulrike,

Ulrike Fischer wrote:
> 
> \documentclass{article}
> \begin{document}
> \catcode`\^^00=13
> \ifnum`^^00=0 ja \else nein \fi
> 
> \end{document}
> 
> When processed with LaTeX or XeLaTeX I get a document with "ja".
> Luatex gives "nein". Is this difference to be expected?

No, you found a bug. It is fixed in SVN by commit #1548.

Best wishes,
Taco


From root at www.metatex.org  Wed Oct  8 16:24:02 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  8 Oct 2008 16:24:02 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081008142402.DB31F1E8C2AC@www.metatex.org>

------------------------------------------------------------------------
r1548 | taco | 2008-10-08 12:30:25 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/tex/textoken.c

fix handling of active csname ^^00 

------------------------------------------------------------------------
r1549 | taco | 2008-10-08 14:28:19 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

bump the version number

------------------------------------------------------------------------
r1550 | oneiros | 2008-10-08 15:22:18 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/mpdir

ignore generated dir

------------------------------------------------------------------------

From root at www.metatex.org  Wed Oct  8 22:24:02 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed,  8 Oct 2008 22:24:02 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081008202402.A23CC1E8C2AC@www.metatex.org>

------------------------------------------------------------------------
r1551 | taco | 2008-10-08 17:53:52 +0200 (Wed, 08 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lang/texlang.c

possibly fix an access violation on win32

------------------------------------------------------------------------

From taco at elvenkind.com  Thu Oct  9 11:02:02 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 09 Oct 2008 11:02:02 +0200
Subject: [Dev-luatex] Luatex beta 0.30.1 released
Message-ID: <48EDC88A.9030004@elvenkind.com>

Hi all,

I have just uploaded the archives for luatex 0.30.1.
This release matches SVN revision #1552.

There are no new features, just bugfixes and speedups:

* Invalid return values from the linebreak_filter callback
   are now handled gracefully (was crashing)
* a preinstalled ctangle is no longer needed except when
   cross-compiling
* In 0.30.0, the .notdef fix was incorrectly applied to
   truetype / opentype fonts.
* A bunch of all memory leaks is fixed
* In lua, f:read('*a') now uses signicantly less memory
* The number of \catcodetables is now limited to 64KB
   (for speed reasons)
* Luatex could crash if there were PDF images with and
   without page /Group included on the same page
* Lua coco now always uses setjmp (for OpenBSD compatibility)
* The embedded mplib is updated to the latest svn version
* # marks (characters with catcode 6) are no longer doubled
   inside \directlua
* Handling the nul character (U+0000) with catcode 13
   (active) was broken
* Luatex could crash on win32 with an access violation
   because there was one predefined language too few
   (the one matching \language=-1)


The archives (source and binaries) can be downloaded from supelec,
as usual:

      http://foundry.supelec.fr/projects/luatex/

Bugs and feature requests can be added to the issue tracker at

      http://tracker.luatex.org

Have fun,
Taco



From root at www.metatex.org  Thu Oct  9 12:27:08 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  9 Oct 2008 12:27:08 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081009102708.431DF1E8C3B0@www.metatex.org>

------------------------------------------------------------------------
r1552 | taco | 2008-10-09 10:47:20 +0200 (Thu, 09 Oct 2008) | 2 lines
Changed paths:
   A /tags/beta-0.30.1 (from /trunk:1551)

new tag

------------------------------------------------------------------------
r1553 | taco | 2008-10-09 11:36:49 +0200 (Thu, 09 Oct 2008) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

update the manual for 0.30.1 and  context 2008.10.03

------------------------------------------------------------------------
r1554 | taco | 2008-10-09 11:37:31 +0200 (Thu, 09 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/src/texk/web2c/luatexdir/lua/lstatslib.c

added status.callbacks and status.indirect_callbacks

------------------------------------------------------------------------

From root at www.metatex.org  Thu Oct  9 16:24:09 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu,  9 Oct 2008 16:24:09 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081009142409.86E4F1E8C3EB@www.metatex.org>

------------------------------------------------------------------------
r1555 | taco | 2008-10-09 14:28:41 +0200 (Thu, 09 Oct 2008) | 4 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/luafont.c
   M /trunk/src/texk/web2c/luatexdir/font/texfont.c
   M /trunk/src/texk/web2c/luatexdir/lang/texlang.c
   M /trunk/src/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/src/texk/web2c/luatexdir/lua/luanode.c
   M /trunk/src/texk/web2c/luatexdir/lua/luatoken.c
   M /trunk/src/texk/web2c/luatexdir/luatex.h
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

The new function get_callback() replaces inline code that needed a 
bit too much knowledge of the internal structure of lcallbacklib.c.
Also start moving stuff out of "luatex.h"

------------------------------------------------------------------------
r1556 | taco | 2008-10-09 14:31:13 +0200 (Thu, 09 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h

used the wrong lua.h file

------------------------------------------------------------------------

From vext01 at gmail.com  Sat Oct 11 20:36:33 2008
From: vext01 at gmail.com (Edd Barrett)
Date: Sat, 11 Oct 2008 19:36:33 +0100
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <48E31FEB.3040104@elvenkind.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
	<48E31FEB.3040104@elvenkind.com>
Message-ID: <a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>

Hi,

On Wed, Oct 1, 2008 at 7:59 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Edd Barrett wrote:
>>
>> Hi,
>>
>> On Tue, Sep 30, 2008 at 1:56 PM, Taco Hoekwater <taco at elvenkind.com>
>> wrote:
>>>
>>> Can you try the patch below please?
>>
>> Patch applied, looks like the same error.
>>
>> lcoco.c:334:22: ucontext.h: No such file or directory
>
> It should have been compiling lua with an extra -DCOCO_USE_SETJMP on the
> gcc commandline, but it seems I have created a bugged Makefile. I'll try
> to fix this for the next release of luatex, then.
>
> Best wishes,
> Taco
>

Is texlua something to do with luatex?

It looks like someone has changed texdoc from shell to "texlua", which
means my user base will not be able to  use texdoc. I really need
texdoc!

Have you had time to look at this?

Sorry to bug you.

Thanks

-- 

Best Regards

Edd

http://students.dec.bournemouth.ac.uk/ebarrett

From preining at logic.at  Sat Oct 11 20:52:46 2008
From: preining at logic.at (Norbert Preining)
Date: Sat, 11 Oct 2008 20:52:46 +0200
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
	<48E31FEB.3040104@elvenkind.com>
	<a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
Message-ID: <20081011185246.GD2092@gamma.logic.tuwien.ac.at>

On Sa, 11 Okt 2008, Edd Barrett wrote:
> Is texlua something to do with luatex?

texlua = luatex used as interpreter.

> It looks like someone has changed texdoc from shell to "texlua", which

That was discussed in thousands of emails on the list. Yes, texdoc is
now a texlua script and much MUCH better.

> means my user base will not be able to  use texdoc. I really need
> texdoc!

Then get texlua working on your setup.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
LUPPITT (n.)
The piece of leather which hangs off the bottom of your shoe before
you can be bothered to get it mended.
			--- Douglas Adams, The Meaning of Liff

From arthur.reutenauer at normalesup.org  Sat Oct 11 20:54:33 2008
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 11 Oct 2008 20:54:33 +0200
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX	Live
In-Reply-To: <a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
	<48E31FEB.3040104@elvenkind.com>
	<a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
Message-ID: <20081011185433.GE29367@phare.normalesup.org>

> Is texlua something to do with luatex?

  Yes, it's LuaTeX behaving as pure Lua interpreter (equivalent to
"luatex --luaonly" or something like that).  It gives you access to more
functionalities than only Lua, since it has a lot of additional Lua
libraries included (see the LuaTeX reference manual for these).

> It looks like someone has changed texdoc from shell to "texlua"

  If you mean in TeX Live, yes.  This is very useful for Windows users,
in particular, since in we can rely on the same LuaTeX executable being
available there.  Are you really unable to compile LuaTeX on OpenBSD?

	Arthur

From reinhard.kotucha at web.de  Sat Oct 11 23:32:41 2008
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 11 Oct 2008 23:32:41 +0200
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX	Live
In-Reply-To: <20081011185433.GE29367@phare.normalesup.org>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
	<48E31FEB.3040104@elvenkind.com>
	<a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
	<20081011185433.GE29367@phare.normalesup.org>
Message-ID: <18673.7033.89198.237393@zaphod.ms25.net>

Arthur Reutenauer writes:
 > > Is texlua something to do with luatex?
 > 
 >   Yes, it's LuaTeX behaving as pure Lua interpreter (equivalent to
 > "luatex --luaonly" or something like that).  It gives you access to more
 > functionalities than only Lua, since it has a lot of additional Lua
 > libraries included (see the LuaTeX reference manual for these).
 > 
 > > It looks like someone has changed texdoc from shell to "texlua"
 > 
 >   If you mean in TeX Live, yes.  This is very useful for Windows users,
 > in particular, since in we can rely on the same LuaTeX executable being
 > available there.  Are you really unable to compile LuaTeX on OpenBSD?

Maybe only the symlink texlua -> luatex is missing.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Sun Oct 12 09:30:25 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 12 Oct 2008 09:30:25 +0200
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>	
	<48E221FE.8090502@elvenkind.com>	
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>	
	<48E31FEB.3040104@elvenkind.com>
	<a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
Message-ID: <48F1A791.4000509@elvenkind.com>

Edd Barrett wrote:
> It looks like someone has changed texdoc from shell to "texlua", which
> means my user base will not be able to  use texdoc. I really need
> texdoc!
> 
> Have you had time to look at this?

The Makefile in the new luatex should be OK, there was a simple typo
in it that made my patch fail. Line 11 should read

   CFLAGS= -g -O2 -Wall $(XCFLAGS) $(MYCFLAGS) $(COCOCFLAGS)

(COCOCFLAGS, not COCOFLAGS). I've attached the latest version of
src/libs/lua51/Makefile for you, just in case.

Please let me know wether it works with that change.

Best wishes,
Taco
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Makefile
Url: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081012/ad2307e6/attachment.asc 

From vext01 at gmail.com  Sun Oct 12 13:23:14 2008
From: vext01 at gmail.com (Edd Barrett)
Date: Sun, 12 Oct 2008 12:23:14 +0100
Subject: [Dev-luatex] LuaTeX build error on sparc64/amd64 within TeX Live
In-Reply-To: <48F1A791.4000509@elvenkind.com>
References: <a6e8c1d0809300541h1f8f30f4w23826d967b044937@mail.gmail.com>
	<48E221FE.8090502@elvenkind.com>
	<a6e8c1d0809301816q229d7e2fl71a39e6f0605d63f@mail.gmail.com>
	<48E31FEB.3040104@elvenkind.com>
	<a6e8c1d0810111136l48f3e431vabbcfea82ea97c4a@mail.gmail.com>
	<48F1A791.4000509@elvenkind.com>
Message-ID: <a6e8c1d0810120423t186abaecu56c2e488d2883e2a@mail.gmail.com>

Hi,

I seem to have posted this to a list accidentally. It was supposed to
be a private mail to Taco :) Sorry about that. But to fill everyone
in, luatex was not building on 64 bit arches for me.

On Sun, Oct 12, 2008 at 8:30 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Edd Barrett wrote:
>>
>> It looks like someone has changed texdoc from shell to "texlua", which
>> means my user base will not be able to  use texdoc. I really need
>> texdoc!
>>
>> Have you had time to look at this?
>
> The Makefile in the new luatex should be OK, there was a simple typo
> in it that made my patch fail. Line 11 should read
>
>  CFLAGS= -g -O2 -Wall $(XCFLAGS) $(MYCFLAGS) $(COCOCFLAGS)

Great, will give that a try :)

Thanks for the quick reply.

-- 

Best Regards

Edd

http://students.dec.bournemouth.ac.uk/ebarrett

From preining at logic.at  Tue Oct 14 10:20:11 2008
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Oct 2008 10:20:11 +0200
Subject: [Dev-luatex] Luatex beta 0.30.1 released
In-Reply-To: <48EDC88A.9030004@elvenkind.com>
References: <48EDC88A.9030004@elvenkind.com>
Message-ID: <20081014082011.GA21255@gamma.logic.tuwien.ac.at>

Hi all,

On Do, 09 Okt 2008, Taco Hoekwater wrote:
> I have just uploaded the archives for luatex 0.30.1.

It took a bit since my laptop crashed to set up a build environment on
my mother's computer, but here it is, Debian SID package available at
the usual place:
	deb http://people.debian.org/~preining/TeX/ luatex-sid/
	deb-src http://people.debian.org/~preining/TeX/ luatex-sid/

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
SWANAGE (pl.n.)
Swanage is the series of diversionary tactics used when trying to
cover up the existence of a glossop (q.v.) and may include (a)
uttering a high-pitched laugh and pointing out of the window (NB. this
doesn't work more that twice); (b) sneezing as loudly as possible and
wiping the glossop off the table in the same movement as whipping out
your handkerchief; (c) saying 'Christ! I seen to have dropped some
shit on your table' (very unwise); (d) saying 'Christ, who did that?'
(better) (e) pressing your elbow on the glossop itself and working
your arms slowly to the edge of the table; (f) leaving the glossop
where it is but moving a plate over it and putting up with sitting at
an uncomfortable angle the rest of the meal; or, if the glossop is in
too exposed a position, (g) leaving it there unremarked except for the
occasional humorous glance.
			--- Douglas Adams, The Meaning of Liff

From root at www.metatex.org  Tue Oct 14 12:24:55 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 14 Oct 2008 12:24:55 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081014102455.42E9F1E8C2B1@www.metatex.org>

------------------------------------------------------------------------
r1557 | taco | 2008-10-14 11:07:57 +0200 (Tue, 14 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

fix the handling of \latelua : make sure to close a possible open text string in the pdf backend 

------------------------------------------------------------------------

From olli at sopos.org  Tue Oct 14 13:07:24 2008
From: olli at sopos.org (Oliver Heins)
Date: Tue, 14 Oct 2008 13:07:24 +0200
Subject: [Dev-luatex] Bug in \latelua?
Message-ID: <87bpxnqvtf.fsf@sopos.org>

Hi,

while playing around with luatex and ledmac I produced somewhat strange
PDF's.

This is a minimal example:

\pdfcompresslevel=0
\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage{ledmac}
\usepackage{MinionPro}

\makeatletter
\renewcommand*{\do at line}{%
 {\vbadness=10000 \splittopskip=0pt
  \do at linehook
  \l at demptyd@ta
 \global\setbox\one at line=\vsplit\raw at text to\baselineskip}%
 \unvbox\one at line \global\setbox\one at line=\lastbox
 \getline at num
  \affixline at num
  \hb at xt@ \linewidth{%
    \l at dld@ta\add at inserts\affixside at note
    \l at dlsn@te% left side note
    {\ledllfill
      \hb at xt@ \wd\one at line{\new at line\unhbox\one at line}%
      \ledrlfill\l at drd@ta%
      \l at drsn@te}% right side note
  \latelua0{}% <-- This is the new line
  }%
 \add at penalties}
\makeatother

\begin{document}

\beginnumbering
\pstart
\input tufte
\pend
\endnumbering

\end{document}

I'm using the commercial Minion Pro font here, because it visualizes the
faults of the pdf: The last charakter of each line is overprinted by a
crossed rectangle.  In case you don't have Minion Pro on your computer,
I put the pdf on the web: http://sopos.org/olli/examples/lualedmac.pdf
(and http://sopos.org/olli/examples/lualedmac2.pdf for a version done
without the \latelua statement).

Using lmodern the PDF turns out to be still faulty, though one can't see
on screen.

I investigated a little bit and took a look into the pdf.  The pdf
contains extra newlines, which appear *within* the last string of a line
(so, if a line ends with ?ca-?, the pdf file looks like this:

...-241(c)-3(a-
)]TJ...)

Here's the beginning of such a pdf file:

%PDF-1.4
%????
3 0 obj <<
/Length 2672      
>>
stream
BT
/F19 9.9626 Tf 148.712 707.125 Td [(W)96(e)-241(t)-6(hr)-6(i)6(v)8(e)-242(in)-242(inf)8(o)12(r)-5(m)2(a)19(t)-4(io)11(n||t)-5(hic)5(k)-242(w)7(o)12(r)4(ld)3(s)-241(b)-9(e)-5(c)-3(a)18(u)3(s)-7(e)-242(o)11(f)-242(o)10(ur)-241(m)2(a)9(r)-28(v)7(e)4(lo)11(u)3(s)-241(a)8(n)4(d)-242(e)-8(v)7(er)-28(y)7(d)-2(a)17(y)-241(c)-3(a-
)]TJ -14.944 -11.955 Td [(p)-5(aci)11(t)-2(y)-337(t)5(o)-336(s)-8(e)3(le)-4(c)-7(t,)-365(e)-5(di)11(t,)-363(sin)7(g)-6(le)-337(o)10(u)12(t,)-364(s)4(t)-4(r)-10(uc)-7(t)9(ur)13(e)6(,)-363(hig)-7(h)-5(lig)-7(h)18(t,)-364(g)-5(r)12(o)11(u)12(p)29(,)-363(p)-5(a)8(ir)63(,)-364(m)3(er)8(g)8(e)6(,)-363(h)2(a)9(r)-5(m)3(o)12(nize)6(,
)]TJ 0 -11.955 Td [(sy)-3(n)18(t)-5(h)3(esize)6(,)-328(f)8(o)-8(c)-7(u)2(s,)-327(o)11(r)8(ga)9(nize)6(,)-328(co)11(n)4(den)8(s)-7(e)5(,)-327(r)12(e)-4(d)11(uce)6(,)-327(b)-10(o)11(i)-4(l)-308(do)15(w)-2(n,)-328(c)5(h)4(o)-8(os)-8(e)5(,)-328(c)-3(a)18(t)6(eg)8(o)12(r)-5(ize)5(,)-327(c)-3(a)18(t)-5(a)-5(log)-32(,
)]TJ 0 -11.955 Td [(c)5(l)-2(a)2(s)5(sif)-16(y)72(,)-238(li)2(s)5(t,)-238(a)7(bs)5(t)-4(rac)-7(t,)-238(s)-8(c)-3(a)8(n,)-238(lo)-9(o)6(k)-235(in)18(t)6(o)29(,)-238(ide)-6(a)-5(lize)5(,)-238(i)2(s)-7(o)6(l)-2(a)18(t)6(e)6(,)-238(di)2(s)-7(cr)-6(imin)2(a)19(t)6(e)6(,)-237(di)2(s)5(t)-4(in)7(gui)3(s)4(h,)-238(s)-8(cr)12(e)-4(en,
)]TJ/F19 6.9738 Tf -14.905 -11.956 Td [(\242)]TJ/F19 9.9626 Tf 14.905 0 Td [(p)11(ig)8(e)-4(o)11(n)-4(h)3(o)7(le)6(,)-270(p)11(ic)6(k)-261(o)15(v)8(er)63(,)-270(s)-8(o)11(r)-9(t,)-271(in)18(t)6(eg)-4(ra)18(t)6(e)6(,)-269(b)6(len)4(d)6(,)-270(in)7(s)5(p)-8(e)-5(c)-7(t,)-271(\235)-5(l)11(t)6(er)63(,)-270(l)11(um)19(p)29(,)-270(s)3(k)-3(i)11(p)29(,)-269(sm)3(o)-8(o)10(t)-5(h,)-271(c)5(h)19(un)-4(k,
)]TJ 0 -11.955 Td [(a)17(v)8(era)5(g)8(e)6(,)-279(a)18(p)11(p)12(r)13(o)16(xim)3(a)19(t)6(e)6(,)-279(c)5(l)12(u)3(s)5(t)6(er)63(,)-279(a)4(g)-5(g)-5(r)12(ega)19(t)6(e)6(,)-278(o)10(u)12(t)-5(lin)3(e)6(,)-279(s)4(umm)3(a)9(r)-5(ize)5(,)-279(i)11(t)6(emize)6(,)-279(r)12(e)-7(v)-3(ie)-8(w)72(,)-279(di)11(p)-268(in)18(t)6(o)29(,
)]TJ 0 -11.955 Td [(\236i)11(p)-277(t)-6(hr)12(o)11(ug)-6(h,)-291(b)11(r)13(o)16(ws)-7(e)4(,)-290(g)-7(l)-3(a)8(n)4(ce)-277(in)18(t)6(o)29(,)-290(le)-6(a)8(f)-277(t)-6(hr)12(o)11(ug)-6(h,)-292(s)3(k)-3(im,)-291(r)12(e\235n)4(e)6(,)-290(en)18(um)4(era)19(t)6(e)6(,)-290(g)-7(le)-6(a)8(n,)-290(sy)-3(n)3(o)11(p-
)]TJ 0 -11.955 Td [(size)5(,)-226(w)-3(inn)3(o)16(w)-226(t)-6(h)3(e)-226(w)-7(h)3(e)-5(a)18(t)-226(f)-10(r)12(o)12(m)-226(t)-6(h)3(e)-226(c)5(h)3(a)9(\232)-226(a)8(n)4(d)-226(s)-8(ep)-5(a)8(ra)19(t)6(e)-226(t)-6(h)3(e)-226(s)3(h)4(e)-4(ep)-227(f)-10(r)12(o)12(m)-226(t)-6(h)3(e)-226(g)7(o)-4(a)18(ts.
)]TJ 170.162 -484.184 Td [(\325)]TJ
ET
endstream
endobj

Looking in luatex.web, I found that the definition of \latelua contains
a line ?pdf_print_nl?.  Removing this line seems to give the intended
behaviour, though it might break something else.

Best regards,
 olli


--- luatex-beta-0.30.1/src/texk/web2c/luatexdir/luatex.web	2008-10-09 10:48:06.000000000 +0200
+++ luatex-beta-0.30.1-oh/src/texk/web2c/luatexdir/luatex.web	2008-10-10 15:34:17.000000000 +0200
@@ -16990,7 +16990,6 @@
        pdf_out(str_pool[b]);
        incr(b);
     end;
-    pdf_print_nl;
 end;
 
 @* \[32d] The cross-reference table.




-- 
http://www.sopos.org/olli/ GnuPG-Key: gpg --recv-keys 0x9A00D827
GnuPG-Fingerprint: F27A BA8C 1CFB B905 65A8  2544 0F07 B675 9A00 D827
NP: Sham 69 - Give a Dog a Bone
Please avoid sending me Word or PowerPoint attachments.
See http://www.gnu.org/philosophy/no-word-attachments.html

From olli at sopos.org  Tue Oct 14 13:11:35 2008
From: olli at sopos.org (Oliver Heins)
Date: Tue, 14 Oct 2008 13:11:35 +0200
Subject: [Dev-luatex] Bug in \latelua?
In-Reply-To: <87bpxnqvtf.fsf@sopos.org> (Oliver Heins's message of "Tue\,
	14 Oct 2008 13\:07\:24 +0200")
References: <87bpxnqvtf.fsf@sopos.org>
Message-ID: <877i8bqvmg.fsf@sopos.org>

I forgot to mention my system details: TL2008 on Linux, 
$ luatex --version
This is LuaTeX, Version snapshot-0.30.1-2008100910, build 1552

regards,
 olli
-- 
http://www.sopos.org/olli/ GnuPG-Key: gpg --recv-keys 0x9A00D827
GnuPG-Fingerprint: F27A BA8C 1CFB B905 65A8  2544 0F07 B675 9A00 D827
Please avoid sending me Word or PowerPoint attachments.
See http://www.gnu.org/philosophy/no-word-attachments.html

From taco at elvenkind.com  Tue Oct 14 13:14:58 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 14 Oct 2008 13:14:58 +0200
Subject: [Dev-luatex] Bug in \latelua?
In-Reply-To: <87bpxnqvtf.fsf@sopos.org>
References: <87bpxnqvtf.fsf@sopos.org>
Message-ID: <48F47F32.4030702@elvenkind.com>

Hi Oliver,

Oliver Heins wrote:
> 
> Looking in luatex.web, I found that the definition of \latelua contains
> a line ?pdf_print_nl?.  Removing this line seems to give the intended
> behaviour, though it might break something else.

It is funny how sometimes a bug is dormant for months and is then
suddenly and independantly discovered by multiple people. Hans ran
into exactly the same bug yesterday evening, and the svn commit
that fixes it (made two hours ago) looks like this:


Author: taco
Date: 2008-10-14 11:07:57 +0200 (Tue, 14 Oct 2008)
New Revision: 1557

Modified:
    trunk/src/texk/web2c/luatexdir/luatex.web
Log:
fix the handling of \latelua : make sure to close a possible open text 
string in the pdf backend

Modified: trunk/src/texk/web2c/luatexdir/luatex.web
===================================================================
--- trunk/src/texk/web2c/luatexdir/luatex.web	2008-10-09 12:31:13 UTC 
(rev 1556)
+++ trunk/src/texk/web2c/luatexdir/luatex.web	2008-10-14 09:07:57 UTC 
(rev 1557)
@@ -16986,11 +16986,14 @@
  begin
      b := pool_ptr;
      luacall(lua_id,s,r);
-    while b<pool_ptr do begin
-       pdf_out(str_pool[b]);
-       incr(b);
+    if b<pool_ptr then begin
+      pdf_end_text;
+      while b<pool_ptr do begin
+         pdf_out(str_pool[b]);
+         incr(b);
+      end;
+      pdf_print_nl;
      end;
-    pdf_print_nl;
  end;

  @* \[32d] The cross-reference table.




Best wishes,
Taco

From root at www.metatex.org  Tue Oct 14 16:24:09 2008
From: root at www.metatex.org (Cron Daemon)
Date: Tue, 14 Oct 2008 16:24:09 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081014142409.D3CF91E8C2B1@www.metatex.org>

------------------------------------------------------------------------
r1558 | taco | 2008-10-14 12:30:05 +0200 (Tue, 14 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/mapfile.c

fix a buffer overrun

------------------------------------------------------------------------
r1559 | taco | 2008-10-14 13:42:38 +0200 (Tue, 14 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/luatex.web

make \latelua expand its argument at execution time instead of at creation time

------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Tue Oct 14 21:42:10 2008
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue, 14 Oct 2008 21:42:10 +0200 (CEST)
Subject: [Dev-luatex] Bug in \latelua?
In-Reply-To: <48F47F32.4030702@elvenkind.com>
References: <87bpxnqvtf.fsf@sopos.org> <48F47F32.4030702@elvenkind.com>
Message-ID: <alpine.DEB.1.00.0810142129270.8422@hahepc1.hahe>

On Tue, 14 Oct 2008, Taco Hoekwater wrote:

> Oliver Heins wrote:
> >
> > Looking in luatex.web, I found that the definition of \latelua
> > contains a line ?pdf_print_nl?.  Removing this line seems to give
> > the intended behaviour, though it might break something else.
>
> It is funny how sometimes a bug is dormant for months and is then
> suddenly and independantly discovered by multiple people. Hans ran
> into exactly the same bug yesterday evening, and the svn commit that
> fixes it (made two hours ago) looks like this:

that is interesting. In the very 1st version it even used modifiers like
\latelua direct {} (still without the Lua number) and there were proper
pdf_end_text and so on, like this from 10/2005:

procedure latelua(s: str_number; lua_mode: integer; warn: boolean);
var b, j: pool_pointer; {current character code position}
begin
    j:=str_start[s];
    case lua_mode of
    set_origin: begin
        pdf_end_text;
        pdf_set_origin(cur_h, cur_v);
        end;
    direct_page:
        pdf_end_text;
    direct_always:
        pdf_end_string_nl;
    othercases confusion("latelua1")
    endcases;
    b := pool_ptr;
    luacall(s);
    while b<pool_ptr do begin
       pdf_out(str_pool[b]);
       incr(b);
    end;
    pdf_print_nl;
end;

From some time on somehow all these modifiers vanished and the Lua
number went in (i can't even tell now if i threw them out). Currently it
seems to behave as in "page" mode, as there is no pdf_set_origin(),
which would be the default for \pdfliteral. It's not yet clear to me if
\latelua does all the wanted, e. g. whether the timing is right if one
wants to record positions within text on the page...

Regards, Hartmut

From pragma at wxs.nl  Tue Oct 14 23:12:00 2008
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 14 Oct 2008 23:12:00 +0200
Subject: [Dev-luatex] Bug in \latelua?
In-Reply-To: <alpine.DEB.1.00.0810142129270.8422@hahepc1.hahe>
References: <87bpxnqvtf.fsf@sopos.org> <48F47F32.4030702@elvenkind.com>
	<alpine.DEB.1.00.0810142129270.8422@hahepc1.hahe>
Message-ID: <48F50B20.7040401@wxs.nl>

Hartmut Henkel wrote:
> On Tue, 14 Oct 2008, Taco Hoekwater wrote:
> 
>> Oliver Heins wrote:
>>> Looking in luatex.web, I found that the definition of \latelua
>>> contains a line ?pdf_print_nl?.  Removing this line seems to give
>>> the intended behaviour, though it might break something else.
>> It is funny how sometimes a bug is dormant for months and is then
>> suddenly and independantly discovered by multiple people. Hans ran
>> into exactly the same bug yesterday evening, and the svn commit that
>> fixes it (made two hours ago) looks like this:
> 
> that is interesting. In the very 1st version it even used modifiers like
> \latelua direct {} (still without the Lua number) and there were proper
> pdf_end_text and so on, like this from 10/2005:
> 
> procedure latelua(s: str_number; lua_mode: integer; warn: boolean);
> var b, j: pool_pointer; {current character code position}
> begin
>     j:=str_start[s];
>     case lua_mode of
>     set_origin: begin
>         pdf_end_text;
>         pdf_set_origin(cur_h, cur_v);
>         end;
>     direct_page:
>         pdf_end_text;
>     direct_always:
>         pdf_end_string_nl;
>     othercases confusion("latelua1")
>     endcases;
>     b := pool_ptr;
>     luacall(s);
>     while b<pool_ptr do begin
>        pdf_out(str_pool[b]);
>        incr(b);
>     end;
>     pdf_print_nl;
> end;
> 
> From some time on somehow all these modifiers vanished and the Lua
> number went in (i can't even tell now if i threw them out). Currently it
> seems to behave as in "page" mode, as there is no pdf_set_origin(),
> which would be the default for \pdfliteral. It's not yet clear to me if
> \latelua does all the wanted, e. g. whether the timing is right if one
> wants to record positions within text on the page...

the latest version (not sure if checked in) behaves like write so that 
we can do more interesting things (delayed expansion)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Oct 15 09:39:46 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 15 Oct 2008 09:39:46 +0200
Subject: [Dev-luatex] Bug in \latelua?
In-Reply-To: <48F50B20.7040401@wxs.nl>
References: <87bpxnqvtf.fsf@sopos.org> <48F47F32.4030702@elvenkind.com>
	<alpine.DEB.1.00.0810142129270.8422@hahepc1.hahe>
	<48F50B20.7040401@wxs.nl>
Message-ID: <48F59E42.9040901@elvenkind.com>



Hans Hagen wrote:
>>
>> that is interesting. In the very 1st version it even used modifiers like
>> \latelua direct {} (still without the Lua number) and there were proper
>> pdf_end_text and so on, like this from 10/2005:
>>
>> procedure latelua(s: str_number; lua_mode: integer; warn: boolean);
>>     ....
>> end;
>>
>> From some time on somehow all these modifiers vanished and the Lua
>> number went in (i can't even tell now if i threw them out). Currently it
>> seems to behave as in "page" mode, as there is no pdf_set_origin(),
>> which would be the default for \pdfliteral. It's not yet clear to me if
>> \latelua does all the wanted, e. g. whether the timing is right if one
>> wants to record positions within text on the page...

They were dropped in commit #195, back in December 2006.
They could come back ...

> the latest version (not sure if checked in) behaves like write so that 
> we can do more interesting things (delayed expansion)

The delayed expansion should stay, though. It makes the \latelua
much more powerful.

Best wishes,
Taco

From list at nililand.de  Wed Oct 15 20:48:47 2008
From: list at nililand.de (Ulrike Fischer)
Date: Wed, 15 Oct 2008 20:48:47 +0200
Subject: [Dev-luatex] Problems with --lua-switch
Message-ID: <683256783.20081015204847@nililand.de>

Hello,

I have writen a small init.lua-file which sets the package.path so that
the lua-scripts can be found.

I'm calling this init.lua with

luatex --lua=init.lua --fmt=pdfluatex <file>

That works fine but has the side effect that memory settings like e.g.
param_size are no longer taken from the texmf.cnf but are reset to
their default (in this case to 60). Is this expected? Do I have to set
the texconfig-table if I load such a init-file?



-- 
Mit freundlichen Gr??en
Ulrike Fischer
mailto:list at nililand.de


From taco at elvenkind.com  Wed Oct 15 21:51:19 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 15 Oct 2008 21:51:19 +0200
Subject: [Dev-luatex] Problems with --lua-switch
In-Reply-To: <683256783.20081015204847@nililand.de>
References: <683256783.20081015204847@nililand.de>
Message-ID: <48F649B7.9070001@elvenkind.com>

Ulrike Fischer wrote:
> Hello,
> 
> I have writen a small init.lua-file which sets the package.path so that
> the lua-scripts can be found.
> 
> I'm calling this init.lua with
> 
> luatex --lua=init.lua --fmt=pdfluatex <file>
> 
> That works fine but has the side effect that memory settings like e.g.
> param_size are no longer taken from the texmf.cnf but are reset to
> their default (in this case to 60). 

> Is this expected? 

No. I will investigate.

Best wishes,
Taco



From taco at elvenkind.com  Thu Oct 16 10:47:56 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 16 Oct 2008 10:47:56 +0200
Subject: [Dev-luatex] Problems with --lua-switch
In-Reply-To: <48F649B7.9070001@elvenkind.com>
References: <683256783.20081015204847@nililand.de>
	<48F649B7.9070001@elvenkind.com>
Message-ID: <48F6FFBC.2080506@elvenkind.com>



Taco Hoekwater wrote:
> Ulrike Fischer wrote:
>> Hello,
>>
>> I have writen a small init.lua-file which sets the package.path so that
>> the lua-scripts can be found.
>>
>> I'm calling this init.lua with
>>
>> luatex --lua=init.lua --fmt=pdfluatex <file>
>>
>> That works fine but has the side effect that memory settings like e.g.
>> param_size are no longer taken from the texmf.cnf but are reset to
>> their default (in this case to 60). 
> 
>> Is this expected? 
> 
> No. I will investigate.

This should be fixed in trunk now (#1562) and will be in the next
release, sometime next week.

Best wishes,
Taco


From root at www.metatex.org  Thu Oct 16 12:24:19 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 16 Oct 2008 12:24:19 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081016102419.E69211E8C2B1@www.metatex.org>

------------------------------------------------------------------------
r1560 | taco | 2008-10-16 09:52:03 +0200 (Thu, 16 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/liolib.c

fix reading of large files

------------------------------------------------------------------------
r1561 | taco | 2008-10-16 10:06:39 +0200 (Thu, 16 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/Makefile

Allow redefinition of CFLAGS

------------------------------------------------------------------------
r1562 | taco | 2008-10-16 10:47:06 +0200 (Thu, 16 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lua/luainit.c

fix loading of texmf.cnf values if --lua is on the commandline

------------------------------------------------------------------------

From root at www.metatex.org  Thu Oct 16 22:24:09 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 16 Oct 2008 22:24:09 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081016202409.3FAEB1E8C2B1@www.metatex.org>

------------------------------------------------------------------------
r1563 | taco | 2008-10-16 16:48:26 +0200 (Thu, 16 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/src/texk/web2c/luatexdir/font/subfont.c
   M /trunk/src/texk/web2c/luatexdir/font/writet1.c
   M /trunk/src/texk/web2c/luatexdir/font/writet3.c
   M /trunk/src/texk/web2c/luatexdir/font/writettf.h
   M /trunk/src/texk/web2c/luatexdir/font/writetype0.c

Fix font file reading when there is a find callback, but no read callback

------------------------------------------------------------------------

From root at www.metatex.org  Fri Oct 17 16:24:15 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 17 Oct 2008 16:24:15 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081017142415.CF8C01E8C3A9@www.metatex.org>

------------------------------------------------------------------------
r1564 | taco | 2008-10-17 15:58:07 +0200 (Fri, 17 Oct 2008) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf
   M /trunk/src/texk/web2c/luatexdir/font/writefont.c
   M /trunk/src/texk/web2c/luatexdir/ptexlib.h
   M /trunk/src/texk/web2c/luatexdir/utils.c

glyph widths can be negative!

------------------------------------------------------------------------

From root at www.metatex.org  Sun Oct 19 12:24:24 2008
From: root at www.metatex.org (Cron Daemon)
Date: Sun, 19 Oct 2008 12:24:24 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081019102424.225361E8C3B0@www.metatex.org>

------------------------------------------------------------------------
r1565 | taco | 2008-10-19 10:49:19 +0200 (Sun, 19 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/font/mapfile.c

fix fontmap discovery when there is no callback

------------------------------------------------------------------------

From root at www.metatex.org  Mon Oct 20 16:26:31 2008
From: root at www.metatex.org (Cron Daemon)
Date: Mon, 20 Oct 2008 16:26:31 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081020142631.8F5A91E8C3B0@www.metatex.org>

------------------------------------------------------------------------
r1566 | taco | 2008-10-20 15:40:41 +0200 (Mon, 20 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/Makefile
   M /trunk/src/libs/lua51/lcoco.c

revert COCO build change and explicitly stop support for non-intel OpenBSD

------------------------------------------------------------------------
r1567 | taco | 2008-10-20 16:04:49 +0200 (Mon, 20 Oct 2008) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/src/texk/web2c/luatexdir/luatex.web

 version 0.30.2

------------------------------------------------------------------------
r1568 | taco | 2008-10-20 16:05:27 +0200 (Mon, 20 Oct 2008) | 2 lines
Changed paths:
   A /tags/beta-0.30.2 (from /trunk:1567)

new tag

------------------------------------------------------------------------

From taco at elvenkind.com  Mon Oct 20 16:40:17 2008
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 20 Oct 2008 16:40:17 +0200
Subject: [Dev-luatex] Luatex beta 0.30.2 released
Message-ID: <48FC9851.3090901@elvenkind.com>

Hi all,

I have just uploaded the archives for luatex 0.30.2.
This release matches SVN revision #1568.

This release fixes a few (rather serious) bugs:

* The Lua coco change from 0.30.1 is reverted as it gave
   trouble on MacOSX. Lua coco on non-intel OpenBSD platforms
   is now explicitly turned off.

* The lua file reading speedup in 0.30.1 broke reading of
   files larger than 100MB.

* Reading of font-related files was broken when there was a find
   callback, but no read callback.

* The texmf.cnf array size setup values were ignored whenever
   --lua was given on the commandline (instead of only when
   texconfig.kpse_init is set to false).

* glyphs with negative widths resulted in incorrect horizontal
   placement (overlapping) of the string in the output PDF.

* Using \latelua could sometimes result in an invalid output PDF,
   and the argument token list was expanded too early

* There was a read buffer overrun in the mapfile parser

* There are two new variables in the status table:
   status.callbacks and status.indirect_callbacks (execution counts).

The archives (source and binaries) can be downloaded from supelec,
as usual:

       http://foundry.supelec.fr/projects/luatex/

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Taco


_______________________________________________
dev-luatex mailing list
dev-luatex at ntg.nl
http://www.ntg.nl/mailman/listinfo/dev-luatex

From olivier.binda at wanadoo.fr  Tue Oct 28 16:37:19 2008
From: olivier.binda at wanadoo.fr (Olivier Binda)
Date: Tue, 28 Oct 2008 16:37:19 +0100
Subject: [Dev-luatex] string library with utf-8 support
Message-ID: <490731AF.1040106@wanadoo.fr>

Hello, I developped a Japanese dictionnary in XeTeX.
It compiles just fine in luatex but I would like to code the commands in 
Lua instead of TeX.
To make the code faster, cleaner, simpler and more powerfull.

Yet, I need to be able to manipulate utf-8 strings (find, substring, 
replace, length, etc...).
Is there a simple way to do that in LUA ? Will there be one day a luatex 
library for utf8 string managments ?
(because it seems the string library is just for strings with 1 byte 
characters and it is really lacking)

Keep up the good work.
Olivier Binda



From arthur.reutenauer at normalesup.org  Tue Oct 28 18:58:26 2008
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 Oct 2008 18:58:26 +0100
Subject: [Dev-luatex] string library with utf-8 support
In-Reply-To: <490731AF.1040106@wanadoo.fr>
References: <490731AF.1040106@wanadoo.fr>
Message-ID: <20081028175826.GH29367@phare.normalesup.org>

> Is there a simple way to do that in LUA ? Will there be one day a luatex 
> library for utf8 string managments ?

  It's the unicode library, it's been in LuaTeX for years.
unicode.utf8.find corresponds to string.find for UTF-8-encoded strings,
etc.  The complete name is ?Selene Unicode? (slnunico).

> (because it seems the string library is just for strings with 1 byte 
> characters

  Indeed.

	Arthur

From pragma at wxs.nl  Tue Oct 28 19:13:08 2008
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 28 Oct 2008 19:13:08 +0100
Subject: [Dev-luatex] string library with utf-8 support
In-Reply-To: <490731AF.1040106@wanadoo.fr>
References: <490731AF.1040106@wanadoo.fr>
Message-ID: <49075634.6030904@wxs.nl>

Olivier Binda wrote:
> Hello, I developped a Japanese dictionnary in XeTeX.
> It compiles just fine in luatex but I would like to code the commands in 
> Lua instead of TeX.
> To make the code faster, cleaner, simpler and more powerfull.
> 
> Yet, I need to be able to manipulate utf-8 strings (find, substring, 
> replace, length, etc...).
> Is there a simple way to do that in LUA ? Will there be one day a luatex 
> library for utf8 string managments ?
> (because it seems the string library is just for strings with 1 byte 
> characters and it is really lacking)

there is

	unicode.utf.gsub

etc

(you can also use lpeg which is 8 bit clean and for utf manipulations 
that' sgood enough)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From dhj2006 at gmail.com  Wed Oct 29 12:54:03 2008
From: dhj2006 at gmail.com (dhj)
Date: Wed, 29 Oct 2008 19:54:03 +0800
Subject: [Dev-luatex] How to build luatex on Ubuntu 8.04 desktop?
Message-ID: <c31cd79b0810290454k446b2d8hcb6b9ebd5e079070@mail.gmail.com>

I want to build luatex-beta-0.30 on my  Ubuntu 8.04. I run ./build.sh or
./build.sh.linux, it return error.

 ~/luatex-beta-0.30.0$ ./build.sh
Your make is a GNU-make; I will use that
ignore warnings and errors about the main texmf tree
checking whether make sets $(MAKE)... yes
checking for gcc... gcc
checking for C compiler default output file name...
configure: error: C compiler cannot create executables
See `config.log' for more details.


My gcc version is:

:~/luatex-beta-0.30.0$ gcc -v
Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v
--enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
--enable-shared --with-system-zlib --libexecdir=/usr/lib
--without-included-gettext --enable-threads=posix --enable-nls
--with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
--enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --enable-mpfr
--enable-targets=all --enable-checking=release --build=i486-linux-gnu
--host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.2.3 (Ubuntu 4.2.3-2ubuntu7)

Could anyone tell me what's the problem? Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081029/5f5778d2/attachment.html 

From martin at oneiros.de  Wed Oct 29 13:05:44 2008
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 29 Oct 2008 13:05:44 +0100
Subject: [Dev-luatex] How to build luatex on Ubuntu 8.04 desktop?
In-Reply-To: <c31cd79b0810290454k446b2d8hcb6b9ebd5e079070@mail.gmail.com>
References: <c31cd79b0810290454k446b2d8hcb6b9ebd5e079070@mail.gmail.com>
Message-ID: <68c491a60810290505o243524a7wbbdb9638a811c383@mail.gmail.com>

2008/10/29 dhj <dhj2006 at gmail.com>:
> I want to build luatex-beta-0.30 on my  Ubuntu 8.04. I run ./build.sh or
> ./build.sh.linux, it return error.
>
>  ~/luatex-beta-0.30.0$ ./build.sh
> Your make is a GNU-make; I will use that
> ignore warnings and errors about the main texmf tree
> checking whether make sets $(MAKE)... yes
> checking for gcc... gcc
> checking for C compiler default output file name...
> configure: error: C compiler cannot create executables
> See `config.log' for more details.

And what's in config.log?

Best
   Martin

From root at www.metatex.org  Wed Oct 29 22:22:01 2008
From: root at www.metatex.org (Cron Daemon)
Date: Wed, 29 Oct 2008 22:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081029212412.DAF2B1E8C3F9@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From root at www.metatex.org  Thu Oct 30 12:22:01 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 30 Oct 2008 12:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081030112413.C35C91E8C3F8@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From root at www.metatex.org  Thu Oct 30 16:22:01 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 30 Oct 2008 16:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081030152410.495FE1E8C3F9@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From khaledhosny at eglug.org  Thu Oct 30 22:14:53 2008
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 30 Oct 2008 23:14:53 +0200
Subject: [Dev-luatex] Traversing node list
Message-ID: <20081030211453.GA19026@khaled-laptop>

I'm wondering why, in the following code, the first \hbox{} is not seen
by the lua function while the second one is seen i.e. \hbox{} at
paragraph beginning isn't seen.

\directlua0{
local function traverse(h)
  for n in node.traverse (h)
    do texio.write_nl('node id='..node.type(n.id))
    if n.id == node.id('hlist') then
      traverse(n.list)
    end
  end
end
callback.register('pre_linebreak_filter',
  function(h)
    traverse(h)
    return true
  end
)
}

\hbox{Not seen}

Hello \hbox{seen}
\bye

Regards,

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: box.tex
Type: text/x-tex
Size: 337 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081030/e9d68ccb/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081030/e9d68ccb/attachment-0001.bin 

From root at www.metatex.org  Thu Oct 30 22:22:01 2008
From: root at www.metatex.org (Cron Daemon)
Date: Thu, 30 Oct 2008 22:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081030212409.E63B81E8C3F8@www.metatex.org>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From hartmut_henkel at gmx.de  Thu Oct 30 23:32:48 2008
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Oct 2008 23:32:48 +0100 (CET)
Subject: [Dev-luatex] Traversing node list
In-Reply-To: <20081030211453.GA19026@khaled-laptop>
References: <20081030211453.GA19026@khaled-laptop>
Message-ID: <alpine.DEB.1.00.0810302324040.5401@hahepc1.hahe>

On Thu, 30 Oct 2008, Khaled Hosny wrote:

> I'm wondering why, in the following code, the first \hbox{} is not seen
> by the lua function while the second one is seen i.e. \hbox{} at
> paragraph beginning isn't seen.
>
> \directlua0{
> local function traverse(h)
>   for n in node.traverse (h)
>     do texio.write_nl('node id='..node.type(n.id))
>     if n.id == node.id('hlist') then
>       traverse(n.list)
>     end
>   end
> end
> callback.register('pre_linebreak_filter',
>   function(h)
>     traverse(h)
>     return true
>   end
> )
> }
>
> \hbox{Not seen}

that's just a \hbox{} within the page's \vbox{}, it's not starting a
paragraph. A \hbox{} at the beginning of a new paragraph you would get
e. g., by \leavevmode\hbox{Seen}.

>
> Hello \hbox{seen}
> \bye

Regards, Hartmut

From khaledhosny at eglug.org  Thu Oct 30 23:11:58 2008
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 31 Oct 2008 00:11:58 +0200
Subject: [Dev-luatex] Traversing node list
In-Reply-To: <alpine.DEB.1.00.0810302324040.5401@hahepc1.hahe>
References: <20081030211453.GA19026@khaled-laptop>
	<alpine.DEB.1.00.0810302324040.5401@hahepc1.hahe>
Message-ID: <20081030221158.GA22343@khaled-laptop>

On Thu, Oct 30, 2008 at 11:32:48PM +0100, Hartmut Henkel wrote:
> On Thu, 30 Oct 2008, Khaled Hosny wrote:
> >
> > \hbox{Not seen}
> 
> that's just a \hbox{} within the page's \vbox{}, it's not starting a
> paragraph. A \hbox{} at the beginning of a new paragraph you would get
> e. g., by \leavevmode\hbox{Seen}.

Thanks for the explanation, my question is how I go through the nodes in
that \hbox not getting a box at start of paragraph.

Regards,


-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081031/725ed4b7/attachment.bin 

From hartmut_henkel at gmx.de  Fri Oct 31 01:21:24 2008
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Fri, 31 Oct 2008 01:21:24 +0100 (CET)
Subject: [Dev-luatex] Traversing node list
In-Reply-To: <20081030221158.GA22343@khaled-laptop>
References: <20081030211453.GA19026@khaled-laptop>
	<alpine.DEB.1.00.0810302324040.5401@hahepc1.hahe>
	<20081030221158.GA22343@khaled-laptop>
Message-ID: <alpine.DEB.1.00.0810310119150.8755@hahepc1.hahe>

On Fri, 31 Oct 2008, Khaled Hosny wrote:

> On Thu, Oct 30, 2008 at 11:32:48PM +0100, Hartmut Henkel wrote:
> > On Thu, 30 Oct 2008, Khaled Hosny wrote:
> > >
> > > \hbox{Not seen}
> >
> > that's just a \hbox{} within the page's \vbox{}, it's not starting a
> > paragraph. A \hbox{} at the beginning of a new paragraph you would get
> > e. g., by \leavevmode\hbox{Seen}.
>
> my question is how I go through the nodes in that \hbox not getting a
> box at start of paragraph.

seems it works through the hpack_filter:


% just to get rid of header/footer boxes from plain.tex
\catcode`@=11
\def\plainoutput{\shipout\vbox{\pagebody}%
  \advancepageno
  \ifnum\outputpenalty>-\@MM \else\dosupereject\fi}
\catcode`@=12

\directlua0{
local function traverse(h)
  for n in node.traverse (h)
    do texio.write_nl('node id='..node.type(n.id))
    if n.id == node.id('hlist') then
      traverse(n.list)
    end
  end
end
callback.register('hpack_filter',
  function(h,a)
    texio.write_nl("=== "..a)
    traverse(h)
    return true
  end
)
}

\hbox{Also seen}

Hello \hbox{seen}
\bye


Regards, Hartmut

From khaledhosny at eglug.org  Fri Oct 31 01:24:28 2008
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 31 Oct 2008 02:24:28 +0200
Subject: [Dev-luatex] Traversing node list
In-Reply-To: <alpine.DEB.1.00.0810310119150.8755@hahepc1.hahe>
References: <20081030211453.GA19026@khaled-laptop>
	<alpine.DEB.1.00.0810302324040.5401@hahepc1.hahe>
	<20081030221158.GA22343@khaled-laptop>
	<alpine.DEB.1.00.0810310119150.8755@hahepc1.hahe>
Message-ID: <20081031002428.GA26334@khaled-laptop>

On Fri, Oct 31, 2008 at 01:21:24AM +0100, Hartmut Henkel wrote:
> On Fri, 31 Oct 2008, Khaled Hosny wrote:
> 
> > On Thu, Oct 30, 2008 at 11:32:48PM +0100, Hartmut Henkel wrote:
> > > On Thu, 30 Oct 2008, Khaled Hosny wrote:
> > > >
> > > > \hbox{Not seen}
> > >
> > > that's just a \hbox{} within the page's \vbox{}, it's not starting a
> > > paragraph. A \hbox{} at the beginning of a new paragraph you would get
> > > e. g., by \leavevmode\hbox{Seen}.
> >
> > my question is how I go through the nodes in that \hbox not getting a
> > box at start of paragraph.
> 
> seems it works through the hpack_filter:

This did it, thanks for the help.

Regards,

-- 
 Khaled Hosny
 Arabic localizer and member of Arabeyes.org team
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20081031/878f35f8/attachment.bin 

From root at www.metatex.org  Fri Oct 31 16:24:15 2008
From: root at www.metatex.org (Cron Daemon)
Date: Fri, 31 Oct 2008 16:24:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@vz3>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20081031152415.3072C1E8C3FA@www.metatex.org>

------------------------------------------------------------------------
r1569 | taco | 2008-10-31 13:58:55 +0100 (Fri, 31 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/libs/lua51/lcoco.c
   M /trunk/src/libs/lua51/lcoco.h

hardwire a 'disable coco' for  unsupported openbsd configs

------------------------------------------------------------------------
r1570 | taco | 2008-10-31 13:59:20 +0100 (Fri, 31 Oct 2008) | 2 lines
Changed paths:
   M /trunk/src/texk/web2c/luatexdir/lang/texlang.c

fix handling of \language=-1

------------------------------------------------------------------------

