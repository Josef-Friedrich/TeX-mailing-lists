From root at mail.boekplan.nl  Mon Feb  1 12:25:47 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon,  1 Feb 2010 12:25:47 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100201112548.7D0F740053@mail.boekplan.nl>

------------------------------------------------------------------------
r3413 | oneiros | 2010-01-31 23:18:55 +0100 (Sun, 31 Jan 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/tt_glyf.c
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/image/writepng.c
   M /trunk/source/texk/web2c/luatexdir/lang/hnjalloc.c
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c
   M /trunk/source/texk/web2c/luatexdir/lua/luagen.c
   M /trunk/source/texk/web2c/luatexdir/lua/texluac.c
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfrule.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/luatexdir/tex/arithmetic.c
   M /trunk/source/texk/web2c/luatexdir/tex/arithmetic.h
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.c
   M /trunk/source/texk/web2c/luatexdir/utils/synctex.c

indent

------------------------------------------------------------------------
r3414 | taco | 2010-02-01 12:00:05 +0100 (Mon, 01 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.c
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c

A few more complier warning fixes from Javier M?\195?\186gica

------------------------------------------------------------------------

From reinhard.kotucha at web.de  Wed Feb  3 03:06:08 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 3 Feb 2010 03:06:08 +0100
Subject: [Dev-luatex] select()
Message-ID: <19304.55824.336337.603375@zaphod.ms25.net>

Hi,
I encountered a problem with select() in beta-0.40.6-2009100509 
(TeX Live 2009):

------------------------------------------------------------------
#! /usr/bin/env texlua

print (select (1, string.gsub ('abc', 'b', 'X')))
print (select (2, string.gsub ('abc', 'b', 'X')))
------------------------------------------------------------------

 --> aXc	1
 --> 1

This seems to be wrong.  select (1, ....) should only return the first
argument, not both.  I'm wondering why select (2, ....) works as
expected.  I must admit that I couldn't find any specs for select(),
it just appears in some examples in the Lua book.

I can define select() myself, overwriting the built-in function.
Then I get the results I expect:

------------------------------------------------------------------
#! /usr/bin/env texlua

function select (n, ...)
   return arg[n]
end

print (select (1, string.gsub ('abc', 'b', 'X')))
print (select (2, string.gsub ('abc', 'b', 'X')))
------------------------------------------------------------------

 --> aXc
 --> 1

Bug or feature?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Wed Feb  3 07:16:13 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 03 Feb 2010 07:16:13 +0100
Subject: [Dev-luatex] select()
In-Reply-To: <19304.55824.336337.603375@zaphod.ms25.net>
References: <19304.55824.336337.603375@zaphod.ms25.net>
Message-ID: <4B6914AD.9020506@elvenkind.com>

Reinhard Kotucha wrote:
> This seems to be wrong.  select (1, ....) should only return the first
> argument, not both.  I'm wondering why select (2, ....) works as
> expected.  I must admit that I couldn't find any specs for select(),
> it just appears in some examples in the Lua book.

The reference manaul is separate. You can buy it on paper, but
much easier is the free online version, because it conveniently
starts with an index right after the toc:

   http://www.lua.org/manual/5.1/

 From there:

   select (index, ???)

   If index is a number, returns all arguments after argument number 
index. Otherwise, index must be the string "#", and select returns the 
total number of extra arguments it received.

Best wishes,

Taco


From reinhard.kotucha at web.de  Wed Feb  3 10:51:00 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 3 Feb 2010 10:51:00 +0100
Subject: [Dev-luatex] select()
In-Reply-To: <4B6914AD.9020506@elvenkind.com>
References: <19304.55824.336337.603375@zaphod.ms25.net>
	<4B6914AD.9020506@elvenkind.com>
Message-ID: <19305.18180.909757.464159@zaphod.ms25.net>

On 3 February 2010 Taco Hoekwater wrote:

 > Reinhard Kotucha wrote:
 > > This seems to be wrong.  select (1, ....) should only return the first
 > > argument, not both.  I'm wondering why select (2, ....) works as
 > > expected.  I must admit that I couldn't find any specs for select(),
 > > it just appears in some examples in the Lua book.
 > 
 > The reference manaul is separate. You can buy it on paper, but
 > much easier is the free online version, because it conveniently
 > starts with an index right after the toc:

Ahh, it's clear now.  I overlooked it somehow there.

Thanks,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Feb  3 12:25:44 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed,  3 Feb 2010 12:25:44 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100203112544.AF03B40053@mail.boekplan.nl>

------------------------------------------------------------------------
r3415 | taco | 2010-02-03 11:54:09 +0100 (Wed, 03 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writecff.c

fix bug #326

------------------------------------------------------------------------
r3416 | taco | 2010-02-03 12:13:13 +0100 (Wed, 03 Feb 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

document bad behavior of the combination of lua coroutines and random numbers under windows 

------------------------------------------------------------------------

From root at mail.boekplan.nl  Thu Feb  4 16:25:20 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu,  4 Feb 2010 16:25:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100204152520.CFAF040053@mail.boekplan.nl>

------------------------------------------------------------------------
r3417 | taco | 2010-02-04 14:03:20 +0100 (Thu, 04 Feb 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.c
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.c

experimental tweaking of buildpage_filter

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Thu Feb  4 17:35:15 2010
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Thu, 04 Feb 2010 17:35:15 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
Message-ID: <4B6AF743.7090306@gust.org.pl>

Dear collegues,

I'm trying to hook the moment when luatex has just finished \shipout of 
the very last page and there is nothing more to typeset. First thought 
was to use buildpage_filter when it is called with "end" keyword. But 
seemingly the callback is called on occurance of \end, while there still 
may be quite some main list material to be written out. Even if there 
are no insertions, the remaining material may still generate quite some 
pages. Can one propose some way to hook "the last shipout/output is 
over" moment without macros such as \bye?

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Thu Feb  4 17:56:42 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 04 Feb 2010 17:56:42 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
In-Reply-To: <4B6AF743.7090306@gust.org.pl>
References: <4B6AF743.7090306@gust.org.pl>
Message-ID: <4B6AFC4A.6080204@wxs.nl>

On 4-2-2010 17:35, Pawe? Jackowski wrote:
> Dear collegues,
>
> I'm trying to hook the moment when luatex has just finished \shipout of
> the very last page and there is nothing more to typeset. First thought
> was to use buildpage_filter when it is called with "end" keyword. But
> seemingly the callback is called on occurance of \end, while there still
> may be quite some main list material to be written out. Even if there
> are no insertions, the remaining material may still generate quite some
> pages. Can one propose some way to hook "the last shipout/output is
> over" moment without macros such as \bye?

luatex can never know when the last shipout occurs (the last call to the 
output routine can result in multiple shipouts and macro packages can 
call \shipout any time, so you need to register the last page number and 
use that information; only the macro package knows when and what

you could abuse the stop_run callback for some purposes

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From P.Jackowski at gust.org.pl  Thu Feb  4 19:03:27 2010
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Thu, 04 Feb 2010 19:03:27 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
In-Reply-To: <4B6AFC4A.6080204@wxs.nl>
References: <4B6AF743.7090306@gust.org.pl> <4B6AFC4A.6080204@wxs.nl>
Message-ID: <4B6B0BEF.8030908@gust.org.pl>

 >>[...] Can one propose some way to hook "the last shipout/output is
>> over" moment without macros such as \bye?
> 
> luatex can never know when the last shipout occurs (the last call to the 
> output routine can result in multiple shipouts and macro packages can 
> call \shipout any time, so you need to register the last page number and 
> use that information; only the macro package knows when and what
> 
> you could abuse the stop_run callback for some purposes

You're right, luatex cannot know which shipout is last. But finally it 
makes the decision "done, it's high time to die". I wondered if I can 
hook this moment, ie. to make the final update to pdf /Catalog or so. If 
not, will do with macros.

Thank you, Pawe?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Thu Feb  4 19:32:16 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 04 Feb 2010 19:32:16 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
In-Reply-To: <4B6B0BEF.8030908@gust.org.pl>
References: <4B6AF743.7090306@gust.org.pl> <4B6AFC4A.6080204@wxs.nl>
	<4B6B0BEF.8030908@gust.org.pl>
Message-ID: <4B6B12B0.2090002@wxs.nl>

On 4-2-2010 19:03, Pawe? Jackowski wrote:
>  >>[...] Can one propose some way to hook "the last shipout/output is
>>> over" moment without macros such as \bye?
>>
>> luatex can never know when the last shipout occurs (the last call to
>> the output routine can result in multiple shipouts and macro packages
>> can call \shipout any time, so you need to register the last page
>> number and use that information; only the macro package knows when and
>> what
>>
>> you could abuse the stop_run callback for some purposes
>
> You're right, luatex cannot know which shipout is last. But finally it
> makes the decision "done, it's high time to die". I wondered if I can
> hook this moment, ie. to make the final update to pdf /Catalog or so. If
> not, will do with macros.

well, if you do it at the tex end, the 'next' shipout (i.e. the one 
triggered by bye or end) is quite ok as it is unlikely that changes to 
the catalog will happen afterwards (e.g. user will not change info 
fields etc after their last bye)

even if you hook it into some finalizing lua code there are pitfalls

on the agenda, that is once the backend code is mostly redone) there 
will be finalizer callbacks for the catalog, but we delayed that because 
it will be part of more finalizer code (and temporary solutions can 
change and in turn result in messy debugging of existing code because 
timing is so important here)

(hm, i could make a nice technical talk about this for bachotek if there 
is any interest at all in such issues -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From P.Jackowski at gust.org.pl  Thu Feb  4 19:49:34 2010
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Thu, 04 Feb 2010 19:49:34 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
In-Reply-To: <4B6B12B0.2090002@wxs.nl>
References: <4B6AF743.7090306@gust.org.pl> <4B6AFC4A.6080204@wxs.nl>
	<4B6B0BEF.8030908@gust.org.pl> <4B6B12B0.2090002@wxs.nl>
Message-ID: <4B6B16BE.3040208@gust.org.pl>


> well, if you do it at the tex end, the 'next' shipout (i.e. the one 
> triggered by bye or end) is quite ok as it is unlikely that changes to 
> the catalog will happen afterwards (e.g. user will not change info 
> fields etc after their last bye)

But there may be layers (or other interactive stuff that lives in root 
structures) not referenced so far.

> even if you hook it into some finalizing lua code there are pitfalls
> 
> on the agenda, that is once the backend code is mostly redone) there 
> will be finalizer callbacks for the catalog, but we delayed that because 
> it will be part of more finalizer code (and temporary solutions can 
> change and in turn result in messy debugging of existing code because 
> timing is so important here)

Sure.

> (hm, i could make a nice technical talk about this for bachotek if there 
> is any interest at all in such issues -)

Please do! If you haven't got call for papers, you'll get it soon.
On behalf on prog committee.
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Thu Feb  4 22:56:09 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 04 Feb 2010 22:56:09 +0100
Subject: [Dev-luatex] how to hook luatex last shipout
In-Reply-To: <4B6B16BE.3040208@gust.org.pl>
References: <4B6AF743.7090306@gust.org.pl>
	<4B6AFC4A.6080204@wxs.nl>	<4B6B0BEF.8030908@gust.org.pl>
	<4B6B12B0.2090002@wxs.nl> <4B6B16BE.3040208@gust.org.pl>
Message-ID: <4B6B4279.7080609@wxs.nl>

On 4-2-2010 19:49, Pawe? Jackowski wrote:

> But there may be layers (or other interactive stuff that lives in root
> structures) not referenced so far.

you can always create forward references (indirect objects)

> Please do! If you haven't got call for papers, you'll get it soon.
> On behalf on prog committee.

i'm in that committee -)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at mail.boekplan.nl  Fri Feb  5 12:25:47 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  5 Feb 2010 12:25:47 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100205112547.48BA640053@mail.boekplan.nl>

------------------------------------------------------------------------
r3418 | taco | 2010-02-05 08:15:46 +0100 (Fri, 05 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c

patch to detect kfreebsd, from Alan Braslau

------------------------------------------------------------------------
r3419 | taco | 2010-02-05 11:59:58 +0100 (Fri, 05 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/lcoco.c

fix coco stack overflows for lpeg (by making the new C stack much larger)

------------------------------------------------------------------------
r3420 | taco | 2010-02-05 12:05:13 +0100 (Fri, 05 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua51/lcoco.c

ok, so 8M was a bit too much, changed to 1M

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Feb  6 12:25:44 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat,  6 Feb 2010 12:25:44 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100206112544.322AE40054@mail.boekplan.nl>

------------------------------------------------------------------------
r3421 | taco | 2010-02-06 07:40:54 +0100 (Sat, 06 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/kpathsea/mingw32.c

lookp_for_cmd(): remove obsolete 'new' variable

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Feb  6 16:25:09 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat,  6 Feb 2010 16:25:09 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100206152509.EA5BA40054@mail.boekplan.nl>

------------------------------------------------------------------------
r3422 | hhenkel | 2010-02-06 13:34:11 +0100 (Sat, 06 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

pdf_compresslevel wasn't initialized for early immediate object

------------------------------------------------------------------------

From taco at elvenkind.com  Sun Feb  7 08:51:44 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 07 Feb 2010 08:51:44 +0100
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <4B6D1897.9090908@elvenkind.com>
References: <201002052206.o15M6vnl026455@f7.net>
	<4B6D1897.9090908@elvenkind.com>
Message-ID: <4B6E7110.3060205@elvenkind.com>


Hi all,

Karl Berry wondered about the plans for luatex, for texlive 2010
planning. Below is the message I replied him, and in a later message
he set March 31 as an initial deadline for code submissions, so that
is what we have to aim for for 0.60.

The most important immediate decision is what to do about the
literate programming issue, as we explicitly promised that for
the 0.60 release.

Here is the list of serious candidates (in my current opinion):

* Cweb    http://www-cs-faculty.stanford.edu/~knuth/cweb.html
* Doxygen http://www.stack.nl/~dimitri/doxygen/
* Noweb   http://www.cs.tufts.edu/~nr/noweb/

Cweb has a head start because of its relation to WEB (we all like
DEK, the needed tools are in texlive, the retained comments already
use the correct formatting, and perhaps most importantly Hartmut
and I are used to its quirks).

But that does not mean it should automatically be the tool to use.
Doxygen has a number of advantages: it formalizes api documentation,
it supports html output as well as latex, its use is much more common,
and the input keeps looking like normal C files to the build tools
(important for dependency tracking in make).

Finally, noweb is interesting because it is much simpler than cweb
and also (mainly) because Norman Ramsey is/was planning to redo
it in lua, which would mean that in the end it might be possible to use
luatex to generate itself and its documentation. But it has most of the
same build-time drawbacks that cweb has.

I'll be studying these options for the next week or so, and I hope
you will do the same. Also, let me know if there are other candidates
that are worth investigating.

Best wishes,
Taco

PS besides the core luatex team, I put dev-luatex and a bunch of
people in the CC list that may have interesting input to the discussion.


Taco Hoekwater wrote:
> Karl Berry wrote:
>>
>> That leaves LuaTeX.  Taco, what should we aim for shipping in 2010, and
>> when?  (And let's be sure that we update context and luatex in TL at the
>> same time this year, so context mkiv stands a chance.)
> 
> 
> For luatex itself, the two major plans for 0.60 are
>  1. go back to Cweb (or something similar) from plain C
>  2. consolidate binary lua module loading
> unfortunately, it is likely both will affect the build process
> 
> Point 1 still needs a decision to be made (use cweb, use doxygen, or
> write something ourselves), I expect that decision to be made in this
> month, and the initial implementation to follow a few weeks later.
> 
> Point 2 has unsolved issues with the use of the lua core, which
> really should become a dynamic, private dll to avoid problems between
> the lua core symbols use by such external modules  and luatex's
> embedded (patched) lua core symbols. I am not too thrilled about
> implementing this, so I have postponed it until now. (a longer, more
> technical email about this will follow in a few days)
> 
> There are some other things planned for luatex 0.60, but those
> are relatively minor and, most importantly, wont affect the build
> process much. So once the two point above are resolved, the code
> could go into the TL repository. Sounds like end of March would
> be doable for that.
> 
> Meanwhile, don't forget metapost, massive amounts of work going on
> there. But metapost 2 will not be finished before early summer (at
> the very earliest), so I guess the best solution is to stick with
> metapost 1.2 in TL 2010, and possibly also include a pre-release of
> metapost 2, if anything release-able is ready in time.
> 
> I think actually it would help if you set straight deadlines
> for code submissions, that way I can reschedule the development
> work to match those. Both metapost and luatex are actively
> developed: there is a never a point where there are no great
> changes planned.
> 
> Best wishes,
> Taco


From root at mail.boekplan.nl  Sun Feb  7 12:25:48 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun,  7 Feb 2010 12:25:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100207112548.73E4C40054@mail.boekplan.nl>

------------------------------------------------------------------------
r3423 | hhenkel | 2010-02-06 23:34:29 +0100 (Sat, 06 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c

cosmetics

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Feb  7 16:25:20 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun,  7 Feb 2010 16:25:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100207152520.6895840054@mail.boekplan.nl>

------------------------------------------------------------------------
r3424 | hhenkel | 2010-02-07 13:27:47 +0100 (Sun, 07 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/pkin.c

pk font writing was broken

------------------------------------------------------------------------
r3425 | hhenkel | 2010-02-07 15:19:23 +0100 (Sun, 07 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c

use macro for simplification

------------------------------------------------------------------------
r3426 | hhenkel | 2010-02-07 15:44:15 +0100 (Sun, 07 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/mplibdir/mp.w

typo --- just found a >4 years old note on this :-)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Feb  7 22:25:28 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun,  7 Feb 2010 22:25:28 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100207212528.97D9340054@mail.boekplan.nl>

------------------------------------------------------------------------
r3427 | hhenkel | 2010-02-07 19:42:15 +0100 (Sun, 07 Feb 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c

fix slanted fonts with HZ, remove fm side-effect from font_shareable(),
remove unneeded code (an intermediate step only, hopefully stable).

------------------------------------------------------------------------

From peb at mppmu.mpg.de  Mon Feb  8 10:40:13 2010
From: peb at mppmu.mpg.de (Peter Breitenlohner)
Date: Mon, 8 Feb 2010 10:40:13 +0100 (CET)
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <4B6E7110.3060205@elvenkind.com>
References: <201002052206.o15M6vnl026455@f7.net>
	<4B6D1897.9090908@elvenkind.com> <4B6E7110.3060205@elvenkind.com>
Message-ID: <alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>

On Sun, 7 Feb 2010, Taco Hoekwater wrote:

> Here is the list of serious candidates (in my current opinion):
>
> * Cweb    http://www-cs-faculty.stanford.edu/~knuth/cweb.html
> * Doxygen http://www.stack.nl/~dimitri/doxygen/
> * Noweb   http://www.cs.tufts.edu/~nr/noweb/

Hi Taco,

from my point of view Cweb/Noweb generate C code (as do flex and bison),
whereas Doxygen uses (annotated) C code to generate documentation. Thus they
fall into quite different categories.

Cweb is special because it is built as part of TL, but otherwise probably
much like Noweb. Flex/bison are special because they are directly supported
by Automake. Cweb is supported in the TL build system via a shell script
that handles all issues for parallel make, but still needs special build
rules -- Noweb could be handled in a similar way.


From root at mail.boekplan.nl  Mon Feb  8 12:26:45 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon,  8 Feb 2010 12:26:45 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100208112645.152B940054@mail.boekplan.nl>

------------------------------------------------------------------------
r3428 | hhenkel | 2010-02-07 22:39:31 +0100 (Sun, 07 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c

only one getfontmap() call left

------------------------------------------------------------------------
r3429 | hhenkel | 2010-02-08 00:15:11 +0100 (Mon, 08 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.h

make a few functions static

------------------------------------------------------------------------

From darthandrus at gmail.com  Thu Feb 11 23:55:36 2010
From: darthandrus at gmail.com (Ivan Andrus)
Date: Thu, 11 Feb 2010 23:55:36 +0100
Subject: [Dev-luatex] Outputting to TeX
Message-ID: <E8036231-386D-45BE-AD16-89F98A6EE798@gmail.com>

I noticed that version 0.00 of luatex could print back TeX.  Is that still possible?  If not how difficult would it be to implement, and where would I begin?  Could it be done entirely with lua, or would I have to change luatex itself?  I admit I haven't looked into it very much because I wanted to know if it was feasible before I started since I have never looked at the TeX codebase.

I would like it for two quite different reasons.

1. I would like to make an optimized TeX file that will create a dvi very quickly on an embedded device (a la http://river-valley.tv/tex-as-an-ebook-reader-2/)

2. A more useful, though difficult, option would be to mark certain macros, (or those from certain files, etc.) as "expandable", and everything else would be literally passed through (ideally comments as well).  This would allow a person to use their own macros, but create a "standard" (La,Con)TeX file when sharing with a colleague or submitting to a journal etc.

I know other people that have expressed in the latter usage, though it is obviously quite a bit more complex.

Thanks for any pointers,
Ivan Andrus

From pragma at wxs.nl  Fri Feb 12 00:35:22 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 12 Feb 2010 00:35:22 +0100
Subject: [Dev-luatex] Outputting to TeX
In-Reply-To: <E8036231-386D-45BE-AD16-89F98A6EE798@gmail.com>
References: <E8036231-386D-45BE-AD16-89F98A6EE798@gmail.com>
Message-ID: <4B74943A.6090900@wxs.nl>

On 11-2-2010 23:55, Ivan Andrus wrote:

> I noticed that version 0.00 of luatex could print back TeX.  Is that still possible?  If not how difficult would it be to implement, and where would I begin?  Could it be done entirely with lua, or would I have to change luatex itself?  I admit I haven't looked into it very much because I wanted to know if it was feasible before I started since I have never looked at the TeX codebase.

sure, there are several functions for printing back

it's all described in the manual (we're now at version 0.50)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at mail.boekplan.nl  Fri Feb 12 12:25:41 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 12 Feb 2010 12:25:41 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100212112541.3769440053@mail.boekplan.nl>

------------------------------------------------------------------------
r3430 | hhenkel | 2010-02-11 22:42:02 +0100 (Thu, 11 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/dofont.c
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/texfont.c
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.h
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.c

remove obsolete padding of tfm font names by font_expand_ratio

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Feb 13 12:25:10 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 13 Feb 2010 12:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100213112820.D61C640053@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From khaledhosny at eglug.org  Mon Feb 15 20:55:39 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 15 Feb 2010 21:55:39 +0200
Subject: [Dev-luatex] fontloader's memory leaks
Message-ID: <20100215195539.GB9339@khaled-laptop>


We are writing a font indexing script[1] for use with LaTeX and plain
TeX (luaotfload package[2]), in order to gather all the info we need
(mainly, names table and optical size) we are loading the fonts with the
full blown fontloader.open(), now the problem is that memory consumption
is steadily growing to the point that it can hang the whole system (I had
to use a 2 GB swap instead of .5 GB + 1 GB memory to avoid system freeze)
despite the fact that every open() call is followed by a close() call.

It seems that fontloader.close() is not freeing the memory as it should
(valgrind reports too many potential memory leaks). Any idea, is there a
possibility for this to get improved?

[1] http://github.com/mpg/luaotfload/blob/master/luaotfload-fonts.lua
[2] http://github.com/mpg/luaotfload

P.S.
I tried to extend fontloader.info() to return the additional info we need
and I managed to get the names and pfm tables and it was still as fast,
but stopped at optical size info which for a reason beyond to me is
implemented by OpenType specifications as a GPOS feature! and I couldn't
get fontloader to parse GPOS table without parsing glyphs first.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Tue Feb 16 08:02:26 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Feb 2010 08:02:26 +0100
Subject: [Dev-luatex] fontloader's memory leaks
In-Reply-To: <20100215195539.GB9339@khaled-laptop>
References: <20100215195539.GB9339@khaled-laptop>
Message-ID: <4B7A4302.4020009@elvenkind.com>

Khaled Hosny wrote:
> 
> It seems that fontloader.close() is not freeing the memory as it should
> (valgrind reports too many potential memory leaks). Any idea, is there a
> possibility for this to get improved?

I've created a tracker item for this. As you say there is a leak that
valgrind sees, I am sure I will be able to remove (most) of it.

Best wishes,
Taco

From root at mail.boekplan.nl  Wed Feb 17 22:25:18 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 17 Feb 2010 22:25:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100217212518.AED7240053@mail.boekplan.nl>

------------------------------------------------------------------------
r3431 | oneiros | 2010-02-17 21:35:50 +0100 (Wed, 17 Feb 2010) | 5 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

When concatenating content streams, put a space between them (see the
recent discussion on pdftex:
http://tug.org/pipermail/pdftex/2010-February/008330.html )
Seems everybody else does it this way and the standard is a bit unclear.

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Feb 19 16:25:15 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 19 Feb 2010 16:25:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100219152515.0FA6F40053@mail.boekplan.nl>

------------------------------------------------------------------------
r3432 | taco | 2010-02-19 14:47:22 +0100 (Fri, 19 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet1.c

allow pfb lines to end with \r as well as \n (for msam10.pfb)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Feb 20 12:25:48 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 20 Feb 2010 12:25:48 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100220112548.E782340053@mail.boekplan.nl>

------------------------------------------------------------------------
r3433 | hhenkel | 2010-02-20 11:03:04 +0100 (Sat, 20 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/luatexfont.h
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c
   M /trunk/source/texk/web2c/luatexdir/font/writet3.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c

font function call cleanup

------------------------------------------------------------------------
r3434 | hhenkel | 2010-02-20 11:17:42 +0100 (Sat, 20 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writefont.c

another function call cleanup

------------------------------------------------------------------------

From P.Jackowski at gust.org.pl  Sat Feb 20 14:02:59 2010
From: P.Jackowski at gust.org.pl (=?ISO-8859-2?Q?Pawe=B3_Jackowski?=)
Date: Sat, 20 Feb 2010 14:02:59 +0100
Subject: [Dev-luatex] dimension helper
Message-ID: <4B7FDD83.1080609@gust.org.pl>

Dear Team,

it is a common convention in luatex that dimensions are specified either 
as a number (in scaled points) or a string with unit included. But 
unless I'm blind, there is no helper function that converts string 
dimension to a number. Seems that there is a standard dimen_to_number() 
function for that purpose. Would be convenient to have such on aboard. 
If I make such a helper, will you consider adding it to a repo? I'm 
thinking of

	tex.sp'1in' -> 4736286
	tex.sp()    -> error argument must be a string

or more general

	tex.unit('1in', 'cm')  -> 2.54

wdyt?
-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From pragma at wxs.nl  Sat Feb 20 15:31:23 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 20 Feb 2010 15:31:23 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B7FDD83.1080609@gust.org.pl>
References: <4B7FDD83.1080609@gust.org.pl>
Message-ID: <4B7FF23B.4010500@wxs.nl>

On 20-2-2010 14:02, Pawe? Jackowski wrote:
> Dear Team,
>
> it is a common convention in luatex that dimensions are specified either
> as a number (in scaled points) or a string with unit included. But
> unless I'm blind, there is no helper function that converts string
> dimension to a number. Seems that there is a standard dimen_to_number()
> function for that purpose. Would be convenient to have such on aboard.
> If I make such a helper, will you consider adding it to a repo? I'm
> thinking of
>
> tex.sp'1in' -> 4736286
> tex.sp() -> error argument must be a string
>
> or more general
>
> tex.unit('1in', 'cm') -> 2.54
>
> wdyt?

luatex is consistently scaled points and a helper can be written in luq 
quite easily

also, keep in mind that performance wise it's best to do it in lua 
anyway; it's actually just a matter of multiplication (which saves a 
function call too)

such helper functions (if they make sense at all) cna be considered as 
part of adding some kind of float support (which we occasionally consider)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From dak at gnu.org  Sat Feb 20 15:42:16 2010
From: dak at gnu.org (David Kastrup)
Date: Sat, 20 Feb 2010 15:42:16 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B7FF23B.4010500@wxs.nl> (Hans Hagen's message of "Sat, 20 Feb
	2010 15:31:23 +0100")
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
Message-ID: <87aav4ge9j.fsf@lola.goethe.zz>

Hans Hagen <pragma at wxs.nl> writes:

> On 20-2-2010 14:02, Pawe? Jackowski wrote:
>> Dear Team,
>>
>> it is a common convention in luatex that dimensions are specified either
>> as a number (in scaled points) or a string with unit included. But
>> unless I'm blind, there is no helper function that converts string
>> dimension to a number. Seems that there is a standard dimen_to_number()
>> function for that purpose. Would be convenient to have such on aboard.
>> If I make such a helper, will you consider adding it to a repo? I'm
>> thinking of
>>
>> tex.sp'1in' -> 4736286
>> tex.sp() -> error argument must be a string
>>
>> or more general
>>
>> tex.unit('1in', 'cm') -> 2.54
>>
>> wdyt?
>
> luatex is consistently scaled points and a helper can be written in
> luq quite easily
>
> also, keep in mind that performance wise it's best to do it in lua
> anyway; it's actually just a matter of multiplication (which saves a
> function call too)

No, it isn't.  It is a matter of multiplication, division and
truncation.

It is a little-know fact that 2.54cm are 72.2698pt in TeX, 1in is
72.26999pt, and both are different from 72.27pt, while 254cm and 100in
perfectly well are 7227.0pt.

So no, you can't substitute a unit in TeX with a constant.  Units are
_fractions_ of sp, and applying a "multiplier" to them does not work
like one would think.

-- 
David Kastrup

From taco at elvenkind.com  Sat Feb 20 17:40:01 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 20 Feb 2010 17:40:01 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <87aav4ge9j.fsf@lola.goethe.zz>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<87aav4ge9j.fsf@lola.goethe.zz>
Message-ID: <4B801061.3040201@elvenkind.com>

David Kastrup wrote:
> 
> No, it isn't.  It is a matter of multiplication, division and
> truncation.
> 
> It is a little-know fact that 2.54cm are 72.2698pt in TeX, 1in is
> 72.26999pt, and both are different from 72.27pt, while 254cm and 100in
> perfectly well are 7227.0pt.
> 
> So no, you can't substitute a unit in TeX with a constant.  Units are
> _fractions_ of sp, and applying a "multiplier" to them does not work
> like one would think.

Valid points. I don't see much use in a generic converter, but

  tex.sp "string"

is a quick and simple extension.

Although I do fear that dimen_to_number (in ltexlib.c) will need
un-fixing to be totally compatible with TeX82: I am using strtod()
and the documented conversion ratios there instead of the actual
code from Knuth.

Best wishes,
Taco





From P.Jackowski at gust.org.pl  Sat Feb 20 23:56:47 2010
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Sat, 20 Feb 2010 23:56:47 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B7FF23B.4010500@wxs.nl>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
Message-ID: <4B8068AF.3070807@gust.org.pl>

Thank you.

In such moments I always wonder how far I can annoy you until being 
banned. One more try ;)

Hans:
> luatex is consistently scaled points and a helper can be written in luq 
> quite easily

tex.scale() is just a multiplication and a range check, which is 
trivial, much more trivial then what dimen_to_number does. tex.round() 
function is also trivial, but we do have a helper!

Nearly everything can be written in lua. Such a helper is needed not 
because it is difficult to implement, but to let the user have the same 
mechanism that is used internally. It is so generic, that everyone who 
will enter an intimate relationship with luatex will need to have his 
own dimen-to-sp function, unless luatex provide one.

Taco:
> Although I do fear that dimen_to_number (in ltexlib.c) will need
> un-fixing to be totally compatible with TeX82: I am using strtod()
> and the documented conversion ratios there instead of the actual
> code from Knuth. 

And when it will happen, the effects of

	tex.dimen[100] = '123mm'
	image.bbox = {0,0,'100bp','200pt'}

may be slightly different. So be it, noone will cry, because tex.sp() 
function would follow the new behaviour of dimen_to_number()...


Here is what works for me. Accept or deny, I won't insist any longer.

Index: ltexlib.c
===================================================================
--- ltexlib.c	(revision 3434)
+++ ltexlib.c	(working copy)
@@ -1269,6 +1269,24 @@
      return 1;
  }

+static int tex_scaledimen(lua_State * L) /* following vsetdimen() */
+{
+    int sp;
+    if (!lua_isnumber(L, 1)) {
+        if (lua_isstring(L, 1)) {
+            sp = dimen_to_number(L, lua_tostring(L, 1));
+        } else {
+            lua_pushstring(L, "argument must be a string or a number");
+            lua_error(L);
+            return 0;
+        }
+    } else {
+        lua_number2int(sp, lua_tonumber(L, 1));
+    }
+    lua_pushnumber(L, sp);
+    return 1;
+}
+
  #define hash_text(A) hash[(A)].rh

  static int tex_definefont(lua_State * L)
@@ -1571,6 +1589,7 @@
      {"getboxdp", getboxdp},
      {"round", tex_roundnumber},
      {"scale", tex_scaletable},
+    {"sp", tex_scaledimen},
      {"fontname", getfontname},
      {"fontidentifier", getfontidentifier},
      {"pdffontname", getpdffontname},

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From arthur.reutenauer at normalesup.org  Sun Feb 21 03:17:12 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 21 Feb 2010 03:17:12 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B8068AF.3070807@gust.org.pl>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<4B8068AF.3070807@gust.org.pl>
Message-ID: <20100221021712.GA12734@phare.normalesup.org>

> In such moments I always wonder how far I can annoy you until being  
> banned. One more try ;)

  There's always the LuaTeX user list (luatex at tug.org) ;-)

	Arthur

From reinhard.kotucha at web.de  Sun Feb 21 03:57:44 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 21 Feb 2010 03:57:44 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <20100221021712.GA12734@phare.normalesup.org>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<4B8068AF.3070807@gust.org.pl>
	<20100221021712.GA12734@phare.normalesup.org>
Message-ID: <19328.41256.532793.624607@zaphod.ms25.net>

On 21 February 2010 Arthur Reutenauer wrote:

 > > In such moments I always wonder how far I can annoy you until being  
 > > banned. One more try ;)
 > 
 >   There's always the LuaTeX user list (luatex at tug.org) ;-)

Since Pawe? asked Hans and Taco explicitly, I suppose that it doesn't
make any difference on which list he asks.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From dak at gnu.org  Sun Feb 21 09:10:50 2010
From: dak at gnu.org (David Kastrup)
Date: Sun, 21 Feb 2010 09:10:50 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <19328.41256.532793.624607@zaphod.ms25.net> (Reinhard Kotucha's
	message of "Sun, 21 Feb 2010 03:57:44 +0100")
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<4B8068AF.3070807@gust.org.pl>
	<20100221021712.GA12734@phare.normalesup.org>
	<19328.41256.532793.624607@zaphod.ms25.net>
Message-ID: <87zl33dn5h.fsf@lola.goethe.zz>

Reinhard Kotucha <reinhard.kotucha at web.de> writes:

> On 21 February 2010 Arthur Reutenauer wrote:
>
>  > > In such moments I always wonder how far I can annoy you until being  
>  > > banned. One more try ;)
>  > 
>  >   There's always the LuaTeX user list (luatex at tug.org) ;-)
>
> Since Pawe? asked Hans and Taco explicitly, I suppose that it doesn't
> make any difference on which list he asks.

There are significant statistical differences in sports depending on
whether you are playing against the same team on their or on your home
turf, to the unbalanced applause of the respective audience.

And it is routine for comedy features to transmit canned or live
audience laughter for the sake of listeners.  Works too.

"If you can make it there, you can make it anywhere.  It's up to you,
dev- lu- a- tex..."

Thanks, you are too kind.

-- 
David Kastrup

From c.a.rowley at open.ac.uk  Sun Feb 21 13:36:51 2010
From: c.a.rowley at open.ac.uk (c.a.rowley at open.ac.uk)
Date: Sun, 21 Feb 2010 12:36:51 +0000
Subject: [Dev-luatex] helpers
In-Reply-To: <mailman.3.1266750002.15069.dev-luatex@ntg.nl>
References: <mailman.3.1266750002.15069.dev-luatex@ntg.nl>
Message-ID: <OFFC987695.A75F7F26-ON802576D1.00454AEB-802576D1.00454AFF@mcs-notes1.open.ac.uk>

Wow! Humour and even a song or two ... on dev-luatex!!!??

Every little spit helps!

chris
---------------------------------------------------------------------------
The Open University is incorporated by Royal Charter (RC 000391), an exempt charity in England & Wales and a charity registered in Scotland (SC 038302)

From taco at elvenkind.com  Sun Feb 21 14:18:56 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 14:18:56 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B8068AF.3070807@gust.org.pl>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<4B8068AF.3070807@gust.org.pl>
Message-ID: <4B8132C0.3050404@elvenkind.com>


Hi,

Pawe? Jackowski wrote:
> 
> Taco:
>> Although I do fear that dimen_to_number (in ltexlib.c) will need
>> un-fixing to be totally compatible with TeX82: I am using strtod()
>> and the documented conversion ratios there instead of the actual
>> code from Knuth. 
> 
> And when it will happen, the effects of
> 
>     tex.dimen[100] = '123mm'
>     image.bbox = {0,0,'100bp','200pt'}
> 
> may be slightly different. So be it, noone will cry, because tex.sp() 
> function would follow the new behaviour of dimen_to_number()...

I did this, the string dimension scanner now follows the same
rules as TeX82's dimension scanner for 'bare dimensions' (i.e.
no control sequences and no fill units).

So, the conversion from lua string to dimension now follows exactly
the same rules as TeX82 and pdftex.

It also means you can now use 'em', 'ex', 'mu' and 'px' units,
that the conversion takes the current magnification factor into
account (and you can use the 'true' keyword), and that hexadecimal
and octal integer values (prefix " or ') are allowed.

> Here is what works for me. Accept or deny, I won't insist any longer.

Applied, so there now is the new function tex.sp(<string>).
Both changes are in revision #3435.

Best wishes,
Taco


From taco at elvenkind.com  Sun Feb 21 14:45:30 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 14:45:30 +0100
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>
References: <201002052206.o15M6vnl026455@f7.net>
	<4B6D1897.9090908@elvenkind.com> <4B6E7110.3060205@elvenkind.com>
	<alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>
Message-ID: <4B8138FA.7040506@elvenkind.com>


Hi,

Peter Breitenlohner wrote:
> 
> from my point of view Cweb/Noweb generate C code (as do flex and bison),
> whereas Doxygen uses (annotated) C code to generate documentation. Thus 
> they fall into quite different categories.
> 
> Cweb is special because it is built as part of TL, but otherwise probably
> much like Noweb. 

Yes, pretty much the same.

> Flex/bison are special because they are directly supported
> by Automake. Cweb is supported in the TL build system via a shell script
> that handles all issues for parallel make, but still needs special build
> rules -- Noweb could be handled in a similar way.
> 
>  From the build system side, I'd think normal users (i.e., people building
> TL or just luaTeX) should not be required to have either Noweb or Doxygen,
> as they are not required to have Autoconf, Automake, Flex, or Bison.

On that note (and lacking other discussion input), I move we go with
Cweb.

Best wishes,
Taco

From martin at oneiros.de  Sun Feb 21 14:55:40 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 21 Feb 2010 14:55:40 +0100
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <4B8138FA.7040506@elvenkind.com>
References: <201002052206.o15M6vnl026455@f7.net>
	<4B6D1897.9090908@elvenkind.com> <4B6E7110.3060205@elvenkind.com>
	<alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>
	<4B8138FA.7040506@elvenkind.com>
Message-ID: <68c491a61002210555p12442bb6u3b3bba00d40f5ae1@mail.gmail.com>

2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
> Peter Breitenlohner wrote:
>> ?From the build system side, I'd think normal users (i.e., people building
>> TL or just luaTeX) should not be required to have either Noweb or Doxygen,
>> as they are not required to have Autoconf, Automake, Flex, or Bison.
>
> On that note (and lacking other discussion input), I move we go with
> Cweb.

Sorry for my silence. Peter's assumption for Oxygen is false: It
augments the source code, so the only people who would be required to
have it would be those who want to build the documentation. And I
believe it does many things CWeb doesn't (e.g. diagrams, HTML
documentation, ...).

One major problem I have with systems like CWEB is that they need tool
support (e.g. in the debugger), as the code the compiler sees isn't
the one the programmer edits.

Best
   Martin

From taco at elvenkind.com  Sun Feb 21 15:03:42 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 15:03:42 +0100
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <68c491a61002210555p12442bb6u3b3bba00d40f5ae1@mail.gmail.com>
References: <201002052206.o15M6vnl026455@f7.net>	
	<4B6D1897.9090908@elvenkind.com> <4B6E7110.3060205@elvenkind.com>	
	<alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>	
	<4B8138FA.7040506@elvenkind.com>
	<68c491a61002210555p12442bb6u3b3bba00d40f5ae1@mail.gmail.com>
Message-ID: <4B813D3E.1070503@elvenkind.com>


Hi,

Martin Schr?der wrote:
> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
>> Peter Breitenlohner wrote:
>>>  From the build system side, I'd think normal users (i.e., people building
>>> TL or just luaTeX) should not be required to have either Noweb or Doxygen,
>>> as they are not required to have Autoconf, Automake, Flex, or Bison.
>> On that note (and lacking other discussion input), I move we go with
>> Cweb.
> 
> Sorry for my silence. Peter's assumption for Oxygen is false: It
> augments the source code, so the only people who would be required to
> have it would be those who want to build the documentation. And I
> believe it does many things CWeb doesn't (e.g. diagrams, HTML
> documentation, ...).

But we can't have both, I assume. Cweb would be happy with extra
Doxygen comments, but not the other way around (right?). And it is
traditional for all TL users to be able to generate the typeset
documentation.

> One major problem I have with systems like CWEB is that they need tool
> support (e.g. in the debugger), as the code the compiler sees isn't
> the one the programmer edits.

gdb is perfectly happy to work with my mpost sources, so I am not
convinced this is important. For example, I can set breakpoints on the
actual line numbers of the web file. As for @d macros: those are 
converted to standard cpp macros, and behave identically in the
debugger.

Best wishes,
Taco


From P.Jackowski at gust.org.pl  Sun Feb 21 16:05:01 2010
From: P.Jackowski at gust.org.pl (=?UTF-8?B?UGF3ZcWCIEphY2tvd3NraQ==?=)
Date: Sun, 21 Feb 2010 16:05:01 +0100
Subject: [Dev-luatex] dimension helper
In-Reply-To: <4B8132C0.3050404@elvenkind.com>
References: <4B7FDD83.1080609@gust.org.pl> <4B7FF23B.4010500@wxs.nl>
	<4B8068AF.3070807@gust.org.pl> <4B8132C0.3050404@elvenkind.com>
Message-ID: <4B814B9D.30201@gust.org.pl>

Taco:
[...]
>> Here is what works for me. Accept or deny, I won't insist any longer.
> 
> Applied, so there now is the new function tex.sp(<string>).
> Both changes are in revision #3435.

I confirm tex.sp function working as expected, including changed 
behaviour of dimen_to_number() . Thank you!

-- 
Pawe/l Jackowski
P.Jackowski at gust.org.pl

From root at mail.boekplan.nl  Sun Feb 21 16:25:13 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 21 Feb 2010 16:25:13 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100221152513.5220E40053@mail.boekplan.nl>

------------------------------------------------------------------------
r3435 | taco | 2010-02-21 13:00:40 +0100 (Sun, 21 Feb 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c

add tex.sp() function, and patch dimen_to_number() so that it
uses TeX82's rules.

------------------------------------------------------------------------

From taco at elvenkind.com  Sun Feb 21 16:56:14 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 16:56:14 +0100
Subject: [Dev-luatex] svn revision ids
Message-ID: <4B81579E.8050005@elvenkind.com>

Hi,

As of revision 3436, luatex once again reports a svn revision id
in the banner when it has been built on a system with a working
'svn' command. The script that fetches the number is based on
an idea of Reinhard Kotucha, and uses 'svn info URL' to get the
number.

The script is source/texk/web2c/luatexdir/getluatexsvnrevision.sh,
and it is currently run from build.sh and from the tools/luatextag
script. The latter is used to create the source tarballs.

I am curious how it works out for other people, as it is quite
possible that I made a thinking error yet again.

Best wishes,
Taco

From martin at oneiros.de  Sun Feb 21 17:06:09 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 21 Feb 2010 17:06:09 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B81579E.8050005@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
Message-ID: <68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>

2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
> I am curious how it works out for other people, as it is quite
> possible that I made a thinking error yet again.

You are all running systems with LANG=C, it seems...

Best
    Martin

From taco at elvenkind.com  Sun Feb 21 17:06:58 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 17:06:58 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>
Message-ID: <4B815A22.1070708@elvenkind.com>

Martin Schr?der wrote:
> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
>> I am curious how it works out for other people, as it is quite
>> possible that I made a thinking error yet again.
> 
> You are all running systems with LANG=C, it seems...

[taco at ntg tmp]$ echo $LANG
en_US.UTF-8

what's wrong?



From martin at oneiros.de  Sun Feb 21 17:11:36 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 21 Feb 2010 17:11:36 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B815A22.1070708@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>
	<4B815A22.1070708@elvenkind.com>
Message-ID: <68c491a61002210811l5eb76556o55c929a4bfae1468@mail.gmail.com>

2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
> [taco at ntg tmp]$ echo $LANG
> en_US.UTF-8
>
> what's wrong?

You are in the Netherlands and speak Dutch. Why doesn't your computer? :-)

> echo $LANG
de_DE.UTF-8
> svn info http://foundry.supelec.fr/svn/luatex/trunk/source
Pfad: source
URL: http://foundry.supelec.fr/svn/luatex/trunk/source
Basis des Projektarchivs: http://foundry.supelec.fr/svn/luatex
UUID des Projektarchivs: 0b2b3880-5936-4365-a048-eb17d2e5a6bf
Revision: 3436
Knotentyp: Verzeichnis
Letzter Autor: taco
Letzte ge?nderte Rev: 3436
Letztes ?nderungsdatum: 2010-02-21 16:34:00 +0100 (So, 21. Feb 2010)

From martin at oneiros.de  Sun Feb 21 17:13:05 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 21 Feb 2010 17:13:05 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B81579E.8050005@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
Message-ID: <68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>

2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
> The script is source/texk/web2c/luatexdir/getluatexsvnrevision.sh,
> and it is currently run from build.sh and from the tools/luatextag
> script. The latter is used to create the source tarballs.

This uses svn info with an URL, which is SLOW. Wouldn't svnversion be
the better tool to use?

Best
    Martin

From taco at elvenkind.com  Sun Feb 21 17:13:26 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 17:13:26 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <68c491a61002210811l5eb76556o55c929a4bfae1468@mail.gmail.com>
References: <4B81579E.8050005@elvenkind.com>	<68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>	<4B815A22.1070708@elvenkind.com>
	<68c491a61002210811l5eb76556o55c929a4bfae1468@mail.gmail.com>
Message-ID: <4B815BA6.4090309@elvenkind.com>

Martin Schr?der wrote:
> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
>> [taco at ntg tmp]$ echo $LANG
>> en_US.UTF-8
>>
>> what's wrong?
> 
> You are in the Netherlands and speak Dutch. Why doesn't your computer? :-)

While at the computer, I 'speak' English a lot more than Dutch.

Thanks for the patch.

Best wishes,
Taco

From taco at elvenkind.com  Sun Feb 21 17:15:04 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 17:15:04 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
Message-ID: <4B815C08.5060502@elvenkind.com>

Martin Schr?der wrote:
> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
>> The script is source/texk/web2c/luatexdir/getluatexsvnrevision.sh,
>> and it is currently run from build.sh and from the tools/luatextag
>> script. The latter is used to create the source tarballs.
> 
> This uses svn info with an URL, which is SLOW. Wouldn't svnversion be
> the better tool to use?

But that commmand only works if there is a local repository.

Best wishes,
Taco

From taco at elvenkind.com  Sun Feb 21 17:27:49 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 17:27:49 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B815C08.5060502@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com>
Message-ID: <4B815F05.3080109@elvenkind.com>

Taco Hoekwater wrote:
> Martin Schr?der wrote:
>> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
>>> The script is source/texk/web2c/luatexdir/getluatexsvnrevision.sh,
>>> and it is currently run from build.sh and from the tools/luatextag
>>> script. The latter is used to create the source tarballs.
>>
>> This uses svn info with an URL, which is SLOW. Wouldn't svnversion be
>> the better tool to use?
> 
> But that commmand only works if there is a local repository.

But it may be the only option, sigh. As Mojca just pointed out:
svn info URL doesn't know whether the local revision even remotely
matches the URL's current revision.

To make matters worse, 'svnversion' has a bad habit of returning
something that is not a number at all, so it has to be parsed.

I remain convinced that this aspect of subversion is simply broken
by design.

Best wishes,
Taco



From khaledhosny at eglug.org  Sun Feb 21 17:31:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 21 Feb 2010 18:31:43 +0200
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <68c491a61002210811l5eb76556o55c929a4bfae1468@mail.gmail.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210806j2283362erd2c1f50ea4fb36ec@mail.gmail.com>
	<4B815A22.1070708@elvenkind.com>
	<68c491a61002210811l5eb76556o55c929a4bfae1468@mail.gmail.com>
Message-ID: <20100221163143.GA5663@khaled-laptop>

On Sun, Feb 21, 2010 at 05:11:36PM +0100, Martin Schr?der wrote:
> 2010/2/21 Taco Hoekwater <taco at elvenkind.com>:
> > [taco at ntg tmp]$ echo $LANG
> > en_US.UTF-8
> >
> > what's wrong?
> 
> You are in the Netherlands and speak Dutch. Why doesn't your computer? :-)

Though I and my computer speak Arabic, I usually set LC_ALL=en_US.UTF-8
in my ~/.bashrc to avoid such surprises.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From patrick at gundla.ch  Sun Feb 21 17:42:48 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Feb 2010 17:42:48 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B81579E.8050005@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
Message-ID: <4BFD52AA-6723-483A-A4F3-C6E62CC5DEEF@gundla.ch>

Hi Taco,


> I am curious how it works out for other people, as it is quite
> possible that I made a thinking error yet again.


$ git svn rebase
[...]
$ ./build.sh --parallel
[...]
./source/texk/web2c/mplibdir -Dextra_version_info=`date +-%Y%m%d%H`   -g -O2 -MT luatex-luatex.o -MD -MP -MF .deps/luatex-luatex.Tpo -c -o luatex-luatex.o `test -f 'luatexdir/luatex.c' || echo '../../../source/texk/web2c/'`luatexdir/luatex.c
../../../source/texk/web2c/luatexdir/luatex.c:22: error: ?luatex_svn_revision? undeclared here (not in a function)
make[5]: *** [luatex-luatex.o] Error 1
make[4]: *** [all-recursive] Error 1
make[3]: *** [all] Error 2
make[2]: *** [subtexk] Error 1
make[1]: *** [all-recursive] Error 1
make: *** [all-recursive] Error 1
strip: can't open file: build/texk/web2c/luatex (No such file or directory)
ls: build/texk/web2c/luatex: No such file or directory

Patrick

http://www.luatex.de

From taco at elvenkind.com  Sun Feb 21 18:13:11 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 18:13:11 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B815F05.3080109@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>	<4B815C08.5060502@elvenkind.com>
	<4B815F05.3080109@elvenkind.com>
Message-ID: <4B8169A7.5040905@elvenkind.com>

Taco Hoekwater wrote:
> 
> To make matters worse, 'svnversion' has a bad habit of returning
> something that is not a number at all, so it has to be parsed.

Now committed #3439. This is based on svnversion with a sed
command to strip unwanted info and a preceding 'svn up' to
make sure that svn agrees with itself.

Best wishes,
Taco

From karl at freefriends.org  Sun Feb 21 19:00:04 2010
From: karl at freefriends.org (Karl Berry)
Date: Sun, 21 Feb 2010 18:00:04 GMT
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <68c491a61002210555p12442bb6u3b3bba00d40f5ae1@mail.gmail.com>
Message-ID: <201002211800.o1LI04JL027162@f7.net>

    taco> On that note (and lacking other discussion input), I move we
    go with Cweb.

I am all for it.

    ms> One major problem I have with systems like CWEB is that they
    need tool support (e.g. in the debugger), as the code the compiler
    sees isn't the one the programmer edits.

That's true for C, too.  As long as CWEB outputs #line/#file information
(which I believe it does), I don't think there's a problem.

From khaledhosny at eglug.org  Sun Feb 21 19:04:27 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 21 Feb 2010 20:04:27 +0200
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B8169A7.5040905@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
Message-ID: <20100221180427.GA4637@khaled-laptop>

On Sun, Feb 21, 2010 at 06:13:11PM +0100, Taco Hoekwater wrote:
> Taco Hoekwater wrote:
> >
> >To make matters worse, 'svnversion' has a bad habit of returning
> >something that is not a number at all, so it has to be parsed.
> 
> Now committed #3439. This is based on svnversion with a sed
> command to strip unwanted info and a preceding 'svn up' to
> make sure that svn agrees with itself.

And now I'm no longer able to build luatex:

../../../source/texk/web2c/luatexdir/luatex.c:22: error: expected expression before ?;? token
../../../source/texk/web2c/luatexdir/luatex.c: In function ?runsystem?:
../../../source/texk/web2c/luatexdir/luatex.c:384: warning: ignoring return value of ?system?, declared with attribute warn_unused_result
../../../source/texk/web2c/luatexdir/luatex.c:386: warning: ignoring return value of ?system?, declared with attribute warn_unused_result
make[5]: *** [luatex-luatex.o] Error 1

(I'm using git-svn to track the repository rather than svn directly)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Sun Feb 21 19:52:29 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 21 Feb 2010 19:52:29 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <20100221180427.GA4637@khaled-laptop>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
	<20100221180427.GA4637@khaled-laptop>
Message-ID: <4B8180ED.8070301@elvenkind.com>

Khaled Hosny wrote:
> On Sun, Feb 21, 2010 at 06:13:11PM +0100, Taco Hoekwater wrote:
>> Taco Hoekwater wrote:
>>> To make matters worse, 'svnversion' has a bad habit of returning
>>> something that is not a number at all, so it has to be parsed.
>> Now committed #3439. This is based on svnversion with a sed
>> command to strip unwanted info and a preceding 'svn up' to
>> make sure that svn agrees with itself.
> 
> And now I'm no longer able to build luatex:
> 
> ../../../source/texk/web2c/luatexdir/luatex.c:22: error: expected expression before ?;? token

This should have been fixed by #3440 (Patrick had the same problem)

Best wishes,
Taco

From khaledhosny at eglug.org  Sun Feb 21 20:40:06 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 21 Feb 2010 21:40:06 +0200
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B8180ED.8070301@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
	<20100221180427.GA4637@khaled-laptop>
	<4B8180ED.8070301@elvenkind.com>
Message-ID: <20100221194006.GA5033@khaled-laptop>

On Sun, Feb 21, 2010 at 07:52:29PM +0100, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >On Sun, Feb 21, 2010 at 06:13:11PM +0100, Taco Hoekwater wrote:
> >>Taco Hoekwater wrote:
> >>>To make matters worse, 'svnversion' has a bad habit of returning
> >>>something that is not a number at all, so it has to be parsed.
> >>Now committed #3439. This is based on svnversion with a sed
> >>command to strip unwanted info and a preceding 'svn up' to
> >>make sure that svn agrees with itself.
> >
> >And now I'm no longer able to build luatex:
> >
> >../../../source/texk/web2c/luatexdir/luatex.c:22: error: expected expression before ?;? token
> 
> This should have been fixed by #3440 (Patrick had the same problem)

I'm still getting this error with #3441.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From patrick at gundla.ch  Sun Feb 21 20:42:33 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Feb 2010 20:42:33 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <20100221194006.GA5033@khaled-laptop>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
	<20100221180427.GA4637@khaled-laptop>
	<4B8180ED.8070301@elvenkind.com>
	<20100221194006.GA5033@khaled-laptop>
Message-ID: <C152DAA1-B268-4F3C-91F1-85744DB60689@gundla.ch>

Hi,

>>> ../../../source/texk/web2c/luatexdir/luatex.c:22: error: expected expression before ?;? token
>> 
>> This should have been fixed by #3440 (Patrick had the same problem)
> 
> I'm still getting this error with #3441.


make sure you delete source/texk/web2c/luatexdir/luatex_svnversion.h.

Patrick


From khaledhosny at eglug.org  Sun Feb 21 20:50:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 21 Feb 2010 21:50:49 +0200
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <C152DAA1-B268-4F3C-91F1-85744DB60689@gundla.ch>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
	<20100221180427.GA4637@khaled-laptop>
	<4B8180ED.8070301@elvenkind.com>
	<20100221194006.GA5033@khaled-laptop>
	<C152DAA1-B268-4F3C-91F1-85744DB60689@gundla.ch>
Message-ID: <20100221195049.GA5457@khaled-laptop>

On Sun, Feb 21, 2010 at 08:42:33PM +0100, Patrick Gundlach wrote:
> Hi,
> 
> >>> ../../../source/texk/web2c/luatexdir/luatex.c:22: error: expected expression before ?;? token
> >> 
> >> This should have been fixed by #3440 (Patrick had the same problem)
> > 
> > I'm still getting this error with #3441.
> 
> 
> make sure you delete source/texk/web2c/luatexdir/luatex_svnversion.h.

Building fine now (without svn revision though, but this is expected).

Thanks.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From hartmut_henkel at gmx.de  Sun Feb 21 20:59:00 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 21 Feb 2010 20:59:00 +0100 (CET)
Subject: [Dev-luatex] luatex 0.60 literate progamming options
In-Reply-To: <4B8138FA.7040506@elvenkind.com>
References: <201002052206.o15M6vnl026455@f7.net>
	<4B6D1897.9090908@elvenkind.com> <4B6E7110.3060205@elvenkind.com>
	<alpine.LNX.2.00.1002081030540.18595@pcl321.mppmu.mpg.de>
	<4B8138FA.7040506@elvenkind.com>
Message-ID: <alpine.DEB.1.00.1002212051200.6110@hahepc1.hahe>

On Sun, 21 Feb 2010, Taco Hoekwater wrote:
> Peter Breitenlohner wrote:
> >
> > from my point of view Cweb/Noweb generate C code (as do flex and
> > bison), whereas Doxygen uses (annotated) C code to generate
> > documentation. Thus they fall into quite different categories.

yes, and i guess one key difference is that in *web you can use named
chunks _before_ having defined their contents. One can't do this with
"normal" macro languages or Doxygen, so *web add a level of
shuffleability.

> On that note (and lacking other discussion input), I move we go with
> Cweb.

happy with it.

Regards, Hartmut

From reinhard.kotucha at web.de  Sun Feb 21 22:04:37 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 21 Feb 2010 22:04:37 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B8169A7.5040905@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
Message-ID: <19329.40933.981474.298256@zaphod.ms25.net>

On 21 February 2010 Taco Hoekwater wrote:

 > Taco Hoekwater wrote:
 > > 
 > > To make matters worse, 'svnversion' has a bad habit of returning
 > > something that is not a number at all, so it has to be parsed.
 > 
 > Now committed #3439. This is based on svnversion with a sed
 > command to strip unwanted info and a preceding 'svn up' to
 > make sure that svn agrees with itself.

There is one difference to the former script, though.  Because no
directory is specified, the revision number you get is the highest one
of the whole repository.  This means that it is increased also if you
don't change anything in the source tree but update trunk/manual.

If you prefer the highest revision number of any file in trunk/source
only, you could do something like:

svnversion -c ./source |
   sed -ne 's/^[0-9]*:*\([0-9]*\).*/#define luatex_svn_revision \1/p'

I currently get

#define luatex_svn_revision 3441

and I would get the same revision number even if something in the
manual tree was updated meanwhile.

A disadvantage is that svnversion's argument contains a relative path
which doesn't allow you to run build.sh from any other directory but
trunk.  But the file build.sh itself contains relative paths too,
therefore it won't work anyway.

An easy way to allow people to call, for instance,
./svn/trunk/build.sh or ../../../build.sh is this:

--- build.sh	2010-02-21 16:34:00.000000000 +0100
+++ build.sh-new	2010-02-21 20:47:24.000000000 +0100
@@ -19,6 +19,8 @@
  export CONFIG_SHELL
 fi
 
+cd `dirname $0`
+
 # try to find gnu make; we may need it
 MAKE=make;
 if make -v 2>&1| grep "GNU Make" >/dev/null


It's quite likely that it works on MSYS too, but it can't hurt to
test it there.


Martin, your assumption is almost right, I've 

LANG=en_US.UTF-8
LC_COLLATE=C

for the same reason as Taco.  Another reason is that it's not very
useful to get error messages in German because I often have to post
them to international mailing lists.  I'm grateful that Khaled Hosny
doesn't post them in Arabic. :)

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Feb 21 22:25:18 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 21 Feb 2010 22:25:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100221212518.C771840053@mail.boekplan.nl>

------------------------------------------------------------------------
r3436 | taco | 2010-02-21 16:34:00 +0100 (Sun, 21 Feb 2010) | 4 lines
Changed paths:
   M /tools/luatextag
   M /trunk/build.sh
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am
   A /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh
   M /trunk/source/texk/web2c/luatexdir/lua/lstatslib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.c
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.h
   M /trunk/source/texk/web2c/luatexdir/tex/printing.c
   M /trunk/source/texk/web2c/luatexdir/tex/printing.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.c

Add support for revision numbers in the banner and stats library again,
bump the version number to 0.51, and update the manual.
Thanks to Reinhard Kotucha for the idea of getluatexsvnversion.sh.

------------------------------------------------------------------------
r3437 | oneiros | 2010-02-21 17:01:57 +0100 (Sun, 21 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

make it work with non-english systems

------------------------------------------------------------------------
r3438 | taco | 2010-02-21 18:00:03 +0100 (Sun, 21 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

new attempt at version numbers, now using svnversion

------------------------------------------------------------------------
r3439 | taco | 2010-02-21 18:04:34 +0100 (Sun, 21 Feb 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

1. I forgot the `which` in front of svnversion, and
2. Have to do an svn up first.

------------------------------------------------------------------------
r3440 | taco | 2010-02-21 18:18:29 +0100 (Sun, 21 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

add an existence test for the .svn directory

------------------------------------------------------------------------
r3441 | oneiros | 2010-02-21 18:28:43 +0100 (Sun, 21 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir

ignore luatex_svnversion.h

------------------------------------------------------------------------

From taco at elvenkind.com  Mon Feb 22 09:00:22 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 22 Feb 2010 09:00:22 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <19329.40933.981474.298256@zaphod.ms25.net>
References: <4B81579E.8050005@elvenkind.com>	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>	<4B815C08.5060502@elvenkind.com>	<4B815F05.3080109@elvenkind.com>	<4B8169A7.5040905@elvenkind.com>
	<19329.40933.981474.298256@zaphod.ms25.net>
Message-ID: <4B823996.6010401@elvenkind.com>

Reinhard Kotucha wrote:
> On 21 February 2010 Taco Hoekwater wrote:
> 
>  > Taco Hoekwater wrote:
>  > > 
>  > > To make matters worse, 'svnversion' has a bad habit of returning
>  > > something that is not a number at all, so it has to be parsed.
>  > 
>  > Now committed #3439. This is based on svnversion with a sed
>  > command to strip unwanted info and a preceding 'svn up' to
>  > make sure that svn agrees with itself.
> 
> There is one difference to the former script, though.  Because no
> directory is specified, the revision number you get is the highest one
> of the whole repository.  This means that it is increased also if you
> don't change anything in the source tree but update trunk/manual.

Right. I fixed this a little bit differently, though.
getluatexsvnversion.sh now assumes it is run inside source/, so it
has "svnversion -c .", and build.sh does

   (cd source; ./texk/web2c/luatexdir/getluatexsvnversion.sh )

I did it like this because I cannot test relative paths in build.sh
myself (and those build.sh files have had those relative paths
since day one, also in pdftex)

Best wishes,
Taco

From mojca.miklavec.lists at gmail.com  Mon Feb 22 10:24:20 2010
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 22 Feb 2010 10:24:20 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <4B823996.6010401@elvenkind.com>
References: <4B81579E.8050005@elvenkind.com>
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>
	<4B8169A7.5040905@elvenkind.com>
	<19329.40933.981474.298256@zaphod.ms25.net>
	<4B823996.6010401@elvenkind.com>
Message-ID: <6faad9f01002220124o4441ff9yd0253f029a2665fb@mail.gmail.com>

One idea (though I have no idea if it's doable or not): maybe it's
possible to create before-commit or after-commit hook that
automatically changes some configuration file in repository after
every commit and writes commit number to that file. Consequently the
build should not depend on the existence of local svn repository.

Mojca

From taco at elvenkind.com  Mon Feb 22 10:54:48 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 22 Feb 2010 10:54:48 +0100
Subject: [Dev-luatex] svn revision ids
In-Reply-To: <6faad9f01002220124o4441ff9yd0253f029a2665fb@mail.gmail.com>
References: <4B81579E.8050005@elvenkind.com>	
	<68c491a61002210813u3c31ac05w6ac27b1ada81af@mail.gmail.com>	
	<4B815C08.5060502@elvenkind.com> <4B815F05.3080109@elvenkind.com>	
	<4B8169A7.5040905@elvenkind.com>	
	<19329.40933.981474.298256@zaphod.ms25.net>	
	<4B823996.6010401@elvenkind.com>
	<6faad9f01002220124o4441ff9yd0253f029a2665fb@mail.gmail.com>
Message-ID: <4B825468.1090504@elvenkind.com>

Mojca Miklavec wrote:
> One idea (though I have no idea if it's doable or not): maybe it's
> possible to create before-commit or after-commit hook that
> automatically changes some configuration file in repository after
> every commit and writes commit number to that file. Consequently the
> build should not depend on the existence of local svn repository.

I fear that there are two problems with that approach:

1. it meeds server-side scripting
2. each commit then has to be followed by an explicit svn co
    to fetch the newly updated file, otherwise the client does not
    know it has changed.

Best wishes,
Taco

From root at mail.boekplan.nl  Mon Feb 22 12:25:47 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 22 Feb 2010 12:25:47 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100222112547.90A9540053@mail.boekplan.nl>

------------------------------------------------------------------------
r3442 | taco | 2010-02-22 08:50:17 +0100 (Mon, 22 Feb 2010) | 2 lines
Changed paths:
   M /tools/luatextag
   M /trunk/build.sh
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

switch to the source directory before calling getluatexsvnversion.sh

------------------------------------------------------------------------
r3443 | taco | 2010-02-22 10:57:49 +0100 (Mon, 22 Feb 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex

update command line documentation

------------------------------------------------------------------------
r3444 | taco | 2010-02-22 11:01:42 +0100 (Mon, 22 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c

add a pointer to the reference manual in the --help output.

------------------------------------------------------------------------

From javier at digi21.eu  Tue Feb 23 13:01:28 2010
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Tue, 23 Feb 2010 16:31:28 +0430
Subject: [Dev-luatex] luatex 0.60 literate progamming options
Message-ID: <5088e64f1002230401t27732332wdaed037b70fd4d4d@mail.gmail.com>

> Flex/bison are special because they are directly supported
> by Automake. Cweb is supported in the TL build system via a shell script
> that handles all issues for parallel make, but still needs special build
> rules -- Noweb could be handled in a similar way.
>
>  From the build system side, I'd think normal users (i.e., people building
> TL or just luaTeX) should not be required to have either Noweb or Doxygen,
> as they are not required to have Autoconf, Automake, Flex, or Bison.

Yes, please, no more Gnu/Linux specific stuff for we the poor guys who
must work in Windows.

So I like CWeb too.

From root at mail.boekplan.nl  Tue Feb 23 22:25:10 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 23 Feb 2010 22:25:10 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100223212755.2C79F40053@mail.boekplan.nl>

svn: OPTIONS of 'http://foundry.supelec.fr/svn/luatex': could not connect to server (http://foundry.supelec.fr)

From root at mail.boekplan.nl  Thu Feb 25 12:25:51 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 25 Feb 2010 12:25:51 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100225112551.7036F40053@mail.boekplan.nl>

------------------------------------------------------------------------
r3445 | taco | 2010-02-25 07:47:37 +0100 (Thu, 25 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.c

put all the options in the commandline help

------------------------------------------------------------------------
r3446 | taco | 2010-02-25 07:48:31 +0100 (Thu, 25 Feb 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

fix a reference

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Feb 26 16:25:16 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 26 Feb 2010 16:25:16 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100226152516.D0AD340053@mail.boekplan.nl>

------------------------------------------------------------------------
r3447 | taco | 2010-02-26 12:36:26 +0100 (Fri, 26 Feb 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c

allow passing cal_expand_ratio and subst_ex_font to hpack

------------------------------------------------------------------------

