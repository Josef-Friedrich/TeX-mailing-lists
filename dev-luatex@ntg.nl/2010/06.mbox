From root at mail.boekplan.nl  Wed Jun  2 12:27:14 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed,  2 Jun 2010 12:27:14 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100602102714.D0A5A40062@mail.boekplan.nl>

------------------------------------------------------------------------
r3708 | hhenkel | 2010-06-01 22:56:39 +0200 (Tue, 01 Jun 2010) | 6 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lcallbacklib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h

new "finish_pdffile" callback
1. after request by Pawe? Jackowski (Thu Feb 4 17:35:15 CET 2010
Subject: Re: [Dev-luatex] how to hook luatex last shipout),
also using his patch (slightly modified).
2. answer to [luatex 0000412]: finalizer pdf (reminder).

------------------------------------------------------------------------
r3709 | hhenkel | 2010-06-01 23:30:44 +0200 (Tue, 01 Jun 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

fix bad typecast

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jun  4 12:27:07 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jun 2010 12:27:07 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100604102707.1C32540062@mail.boekplan.nl>

------------------------------------------------------------------------
r3710 | taco | 2010-06-04 08:49:09 +0200 (Fri, 04 Jun 2010) | 4 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

patch from Akira Kakuto that ensures that only absolute commands
that are inside the %PATH will be executed in win32's restricted 
\write18

------------------------------------------------------------------------
r3711 | oneiros | 2010-06-04 09:32:25 +0200 (Fri, 04 Jun 2010) | 11 lines
Changed paths:
   M /trunk
   M /trunk/source/texk/web2c/luatexdir/luatex.c

Merged revisions 3710 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3710 | taco | 2010-06-04 08:49:09 +0200 (Fr, 04 Jun 2010) | 4 lines
  
  patch from Akira Kakuto that ensures that only absolute commands
  that are inside the %PATH will be executed in win32's restricted 
  \write18
........

------------------------------------------------------------------------
r3712 | hhenkel | 2010-06-04 10:37:23 +0200 (Fri, 04 Jun 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.w

fix for [luatex 0000414]: message image error

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jun  4 16:26:47 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jun 2010 16:26:47 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100604142647.E92E240062@mail.boekplan.nl>

------------------------------------------------------------------------
r3713 | taco | 2010-06-04 12:47:19 +0200 (Fri, 04 Jun 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/tounicode.w
   M /trunk/source/texk/web2c/luatexdir/font/writecff.w
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.w
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.w
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.w
   M /trunk/source/texk/web2c/luatexdir/utils/utils.w

fix some minor things found by static analysis

------------------------------------------------------------------------
r3714 | taco | 2010-06-04 14:33:50 +0200 (Fri, 04 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

add kpathsea/concatn.h header, remove superfluous typecasts

------------------------------------------------------------------------
r3715 | taco | 2010-06-04 14:39:55 +0200 (Fri, 04 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

remove debug print

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jun  4 22:27:06 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  4 Jun 2010 22:27:06 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100604202706.455C140064@mail.boekplan.nl>

------------------------------------------------------------------------
r3716 | oneiros | 2010-06-04 21:01:19 +0200 (Fri, 04 Jun 2010) | 13 lines
Changed paths:
   M /trunk
   M /trunk/source/texk/web2c/luatexdir/luatex.c

Merged revisions 3714-3715 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3714 | taco | 2010-06-04 14:33:50 +0200 (Fr, 04 Jun 2010) | 2 lines
  
  add kpathsea/concatn.h header, remove superfluous typecasts
........
  r3715 | taco | 2010-06-04 14:39:55 +0200 (Fr, 04 Jun 2010) | 2 lines
  
  remove debug print
........

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Tue Jun  8 16:49:57 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 08 Jun 2010 17:49:57 +0300
Subject: [Dev-luatex] bug in os.execute?
Message-ID: <4C0E5895.5090501@telecom-bretagne.eu>

Hello,

I'm playing with LuaTeX and I found a very strange behaviour that you 
can reproduce with the following steps:

 - compile tetest.c (it's just a tiny program writing utf8 in a file 
with wide characters)
 - 'texlua tetest.lua' (it executes the program and outputs the file)
 - 'lua tetest.lua'
 - compare...

Is there a way for texlua to behave like lua in this case?

Thank you,
-- 
Elie

-------------- next part --------------
A non-text attachment was scrubbed...
Name: tetest.c
Type: text/x-csrc
Size: 363 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20100608/2535559e/attachment.c>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tetest.lua
Type: text/x-lua
Size: 58 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20100608/2535559e/attachment.bin>

From mojca.miklavec.lists at gmail.com  Tue Jun  8 17:00:14 2010
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 8 Jun 2010 17:00:14 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C0E5895.5090501@telecom-bretagne.eu>
References: <4C0E5895.5090501@telecom-bretagne.eu>
Message-ID: <AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>

On Tue, Jun 8, 2010 at 16:49, Elie Roux wrote:
> Hello,
>
> I'm playing with LuaTeX and I found a very strange behaviour that you can
> reproduce with the following steps:
>
> - compile tetest.c (it's just a tiny program writing utf8 in a file with
> wide characters)
> - 'texlua tetest.lua' (it executes the program and outputs the file)
> - 'lua tetest.lua'
> - compare...
>
> Is there a way for texlua to behave like lua in this case?

It does in my case (on Mac).

Mojca

From elie.roux at telecom-bretagne.eu  Tue Jun  8 17:06:15 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 08 Jun 2010 18:06:15 +0300
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
References: <4C0E5895.5090501@telecom-bretagne.eu>
	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
Message-ID: <4C0E5C67.1040203@telecom-bretagne.eu>

Mojca Miklavec a ?crit :
> It does in my case (on Mac).
>   

I should have put more details: I'm on debian/sid 32bit, using a binary 
compiled from svn. Here are the results:

eroux at norgz-laptop:~/booklets/newbenedictiones$ lua tetest.lua
a?a
a?a

eroux at norgz-laptop:~/booklets/newbenedictiones$ texlua tetest.lua
a?a
a
eroux at norgz-laptop:~/booklets/newbenedictiones$

Thank you,
-- 
Elie

From taco at elvenkind.com  Tue Jun  8 17:07:24 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 08 Jun 2010 17:07:24 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
References: <4C0E5895.5090501@telecom-bretagne.eu>
	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
Message-ID: <4C0E5CAC.4050103@elvenkind.com>

Mojca Miklavec wrote:
> On Tue, Jun 8, 2010 at 16:49, Elie Roux wrote:
>> Hello,
>>
>> I'm playing with LuaTeX and I found a very strange behaviour that you can
>> reproduce with the following steps:
>>
>> - compile tetest.c (it's just a tiny program writing utf8 in a file with
>> wide characters)
>> - 'texlua tetest.lua' (it executes the program and outputs the file)
>> - 'lua tetest.lua'
>> - compare...
>>
>> Is there a way for texlua to behave like lua in this case?

I don't think this is a bug, it is documented behavior (p 33 of the manual):

In stock Lua, many things depend on the current locale. In LuaTEX, we 
can't do that, because it makes
documents unportable. While LuaTEX is running if forces the following 
locale settings:
LC_CTYPE=C
LC_COLLATE=C
LC_NUMERIC=C


From elie.roux at telecom-bretagne.eu  Tue Jun  8 17:40:16 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 08 Jun 2010 18:40:16 +0300
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C0E5CAC.4050103@elvenkind.com>
References: <4C0E5895.5090501@telecom-bretagne.eu>
	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
	<4C0E5CAC.4050103@elvenkind.com>
Message-ID: <4C0E6460.9010704@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> I don't think this is a bug, it is documented behavior (p 33 of the 
> manual):
>
> In stock Lua, many things depend on the current locale. In LuaTEX, we 
> can't do that, because it makes
> documents unportable. While LuaTEX is running if forces the following 
> locale settings:
> LC_CTYPE=C
> LC_COLLATE=C
> LC_NUMERIC=C

Ok, thank you! Is there a workaround for this? Or how should I change 
the program so that it works?

Thank you,
-- 
Elie


From taco at elvenkind.com  Tue Jun  8 19:30:10 2010
From: taco at elvenkind.com (taco)
Date: Tue, 08 Jun 2010 19:30:10 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C0E6460.9010704@telecom-bretagne.eu>
References: <4C0E5895.5090501@telecom-bretagne.eu>	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>	<4C0E5CAC.4050103@elvenkind.com>
	<4C0E6460.9010704@telecom-bretagne.eu>
Message-ID: <4C0E7E22.2020004@elvenkind.com>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> I don't think this is a bug, it is documented behavior (p 33 of the 
>> manual):
>>
>> In stock Lua, many things depend on the current locale. In LuaTEX, we 
>> can't do that, because it makes
>> documents unportable. While LuaTEX is running if forces the following 
>> locale settings:
>> LC_CTYPE=C
>> LC_COLLATE=C
>> LC_NUMERIC=C
> 
> Ok, thank you! Is there a workaround for this? Or how should I change 
> the program so that it works?

don't use an empty second argument to setlocale(). If you already
know that you want UTF-8, set it to a suitable value instead.

Best wishes,
Taco

From root at mail.boekplan.nl  Thu Jun 10 16:26:59 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 10 Jun 2010 16:26:59 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100610142659.442FA40064@mail.boekplan.nl>

------------------------------------------------------------------------
r3717 | taco | 2010-06-10 13:35:35 +0200 (Thu, 10 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/lookups.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettf.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettfatt.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/luasocket/src/options.c

extend some sprintf buffers 

------------------------------------------------------------------------
r3718 | taco | 2010-06-10 15:24:58 +0200 (Thu, 10 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafilesystem/src/lfs.c

fix lfs.currentdir() for non-GNU compiler

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Thu Jun 10 17:58:31 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 10 Jun 2010 17:58:31 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C0E7E22.2020004@elvenkind.com>
References: <4C0E5895.5090501@telecom-bretagne.eu>	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>	<4C0E5CAC.4050103@elvenkind.com>
	<4C0E6460.9010704@telecom-bretagne.eu>
	<4C0E7E22.2020004@elvenkind.com>
Message-ID: <4C110BA7.6030807@telecom-bretagne.eu>

taco a ?crit :
> don't use an empty second argument to setlocale(). If you already
> know that you want UTF-8, set it to a suitable value instead.

The problem is that, IIUC, it's weird to put fr_FR.UTF-8 as a locale, as 
it's specific to my system... But I discovered that

os.setenv("LC_CTYPE", nil)
os.execute("myprogram")
os.setenv("LC_CTYPE", "C")

does the trick... with this it's the LANG environment variable 
(fr_FR.UTF-8) that will be set as LC_CTYPE.

Setting     setlocale (LC_CTYPE, "UTF-8"); in tetest.c does not solve 
the problem (strangely...). Is there another way?

Thank you,
-- 
Elie

From khaledhosny at eglug.org  Thu Jun 10 18:10:16 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 10 Jun 2010 19:10:16 +0300
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C110BA7.6030807@telecom-bretagne.eu>
References: <4C0E5895.5090501@telecom-bretagne.eu>
	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
	<4C0E5CAC.4050103@elvenkind.com>
	<4C0E6460.9010704@telecom-bretagne.eu>
	<4C0E7E22.2020004@elvenkind.com>
	<4C110BA7.6030807@telecom-bretagne.eu>
Message-ID: <20100610161015.GA30470@khaled-laptop>

On Thu, Jun 10, 2010 at 05:58:31PM +0200, Elie Roux wrote:
> taco a ?crit :
> >don't use an empty second argument to setlocale(). If you already
> >know that you want UTF-8, set it to a suitable value instead.
> 
> The problem is that, IIUC, it's weird to put fr_FR.UTF-8 as a
> locale, as it's specific to my system... But I discovered that
> 
> os.setenv("LC_CTYPE", nil)
> os.execute("myprogram")
> os.setenv("LC_CTYPE", "C")
> 
> does the trick... with this it's the LANG environment variable
> (fr_FR.UTF-8) that will be set as LC_CTYPE.
> 
> Setting     setlocale (LC_CTYPE, "UTF-8"); in tetest.c does not
> solve the problem (strangely...). Is there another way?

UTF-8 is not a locale, en_US.UTF-8 etc. are.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From elie.roux at telecom-bretagne.eu  Thu Jun 10 18:13:21 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 10 Jun 2010 18:13:21 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <20100610161015.GA30470@khaled-laptop>
References: <4C0E5895.5090501@telecom-bretagne.eu>
	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>
	<4C0E5CAC.4050103@elvenkind.com>
	<4C0E6460.9010704@telecom-bretagne.eu>
	<4C0E7E22.2020004@elvenkind.com>
	<4C110BA7.6030807@telecom-bretagne.eu>
	<20100610161015.GA30470@khaled-laptop>
Message-ID: <4C110F21.4040707@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> UTF-8 is not a locale, en_US.UTF-8 etc. are.

Yes, but I only have fr_FR.UTF-8 as a locale, not en_US.UTF-8, and it 
doesn't seem right to set fr_FR.UTF-8 as a locale... what's the best 
solution?

Sorry to be off-topic...

Thank you,
-- 
Elie

From taco at elvenkind.com  Thu Jun 10 19:03:18 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 10 Jun 2010 19:03:18 +0200
Subject: [Dev-luatex] bug in os.execute?
In-Reply-To: <4C110BA7.6030807@telecom-bretagne.eu>
References: <4C0E5895.5090501@telecom-bretagne.eu>	<AANLkTilwQXIeC2bpvlmw6XH1SIYZ8nQBuh-MzmOxQ2Bq@mail.gmail.com>	<4C0E5CAC.4050103@elvenkind.com>
	<4C0E6460.9010704@telecom-bretagne.eu>
	<4C0E7E22.2020004@elvenkind.com>
	<4C110BA7.6030807@telecom-bretagne.eu>
Message-ID: <4C111AD6.6050307@elvenkind.com>



Elie Roux wrote:
> taco a ?crit :
>> don't use an empty second argument to setlocale(). If you already
>> know that you want UTF-8, set it to a suitable value instead.
> 
> The problem is that, IIUC, it's weird to put fr_FR.UTF-8 as a locale, as
> it's specific to my system... But I discovered that
> 
> os.setenv("LC_CTYPE", nil)
> os.execute("myprogram")
> os.setenv("LC_CTYPE", "C")
> 
> does the trick... with this it's the LANG environment variable
> (fr_FR.UTF-8) that will be set as LC_CTYPE.
> 
> Setting     setlocale (LC_CTYPE, "UTF-8"); in tetest.c does not solve
> the problem (strangely...). Is there another way?

Quite seriously: your C code should not be using libc functions that
depend on the current locale if you want it to produce reproducible
results. That's the core of the problem: LOCALE settings are unreliable,
unless your program explicitly sets the LOCALE itself.

So don't use that 'smart' printf() format, but just write (or reuse) an
int2utf8 C function.

Best wishes,
Taco

From root at mail.boekplan.nl  Thu Jun 10 22:26:40 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 10 Jun 2010 22:26:40 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100610202640.90FCC40062@mail.boekplan.nl>

------------------------------------------------------------------------
r3719 | taco | 2010-06-10 18:58:16 +0200 (Thu, 10 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texfileio.w

inefficient but working version of the swap_items function

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Sat Jun 12 14:35:56 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Sat, 12 Jun 2010 13:35:56 +0100
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
Message-ID: <4C137F2C.7090009@readytext.co.uk>

Dear All

I hope this question is OK to ask on this list.

Quick  background: I routinely compile LuaTeX on Windows
Vista and use my own runtime environment (via texmf.cnf + environment 
variables etc ) which is not based on a standard TDS --- purely a test
environment. Basically it works OK.

My LuaTeX version is beta-0.60.1-2010060119

I'm interested to explore luatextra, luaotfload etc but
am running into a problem I can't resolve.

I have, this morning, downloaded and installed all the very latest 
versions of luainputenc, lualibs, luaotfload, luatexbase and luatextra


Firstly, here is the minimal test file (say luafonts.tex):

\documentclass{article}
\usepackage{luatextra}
\begin{document}
Hello
\end{document}

When I run this:

$ luatex --fmt=pdflatex $TEXMF/luafonts.tex

I get the following error:

-----------------------------------------------
! LuaTeX error <\directlua >:1: Expected an array of names as second 
argument
stack traceback:
         [C]: in function 'enableprimitives'
         <\directlua >:1: in main chunk.
\luatexbase at ensure@primitive ...s('luatex', '#1')}
                                                   \fi
l.82 \luatexbase at ensure@primitive{luaescapestring}

?
---------------------------------------------------

The full run is below: does anyone know what I'm doing wrong?

I appreciate that my runtime environment is not standard
but to date that's not been an issue.

Thanks to all in advance for any help --- and of course
thanks to the team who write luatextra, luaotfload etc.

Warm regards

Graham
============



This is LuaTeX, Version beta-0.60.1-2010060119
(g:/msys/1.0/trunk/build/texk/luafonts.tex
LaTeX2e <2009/09/24>
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/article.cls
Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/size10.clo))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatextra/luatextra.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/ifluatex.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-modutils.s
ty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-loader.sty

(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-compat.sty
)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase.loader.lua
))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/modutils.lua)
! LuaTeX error <\directlua >:1: Expected an array of names as second 
argument
stack traceback:
         [C]: in function 'enableprimitives'
         <\directlua >:1: in main chunk.
\luatexbase at ensure@primitive ...s('luatex', '#1')}
                                                   \fi
l.82 \luatexbase at ensure@primitive{luaescapestring}

?


From adityam at umich.edu  Sat Jun 12 14:42:12 2010
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 12 Jun 2010 08:42:12 -0400 (EDT)
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
In-Reply-To: <4C137F2C.7090009@readytext.co.uk>
References: <4C137F2C.7090009@readytext.co.uk>
Message-ID: <alpine.LNX.2.01.1006120838400.2978@ybpnyubfg.ybpnyqbznva>

On Sat, 12 Jun 2010, Graham Douglas wrote:

> Dear All
>
> I hope this question is OK to ask on this list.
>
> Quick  background: I routinely compile LuaTeX on Windows
> Vista and use my own runtime environment (via texmf.cnf + environment 
> variables etc ) which is not based on a standard TDS --- purely a test
> environment. Basically it works OK.
>
> My LuaTeX version is beta-0.60.1-2010060119
>
> I'm interested to explore luatextra, luaotfload etc but
> am running into a problem I can't resolve.
>
> I have, this morning, downloaded and installed all the very latest versions 
> of luainputenc, lualibs, luaotfload, luatexbase and luatextra
>
>
> Firstly, here is the minimal test file (say luafonts.tex):
>
> \documentclass{article}
> \usepackage{luatextra}
> \begin{document}
> Hello
> \end{document}
>
> When I run this:
>
> $ luatex --fmt=pdflatex $TEXMF/luafonts.tex

Umm.... you need the lualatex (or pdflualatex) fmt. You can also use

lualatex filename

Also it is not a good idea to store arbitrary files in $TEXMF.

Aditya


From graham.douglas at readytext.co.uk  Sat Jun 12 14:52:56 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Sat, 12 Jun 2010 13:52:56 +0100
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
In-Reply-To: <alpine.LNX.2.01.1006120838400.2978@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.01.1006120838400.2978@ybpnyubfg.ybpnyqbznva>
Message-ID: <4C138328.4070703@readytext.co.uk>

Hi, many thanks, sure, it is purely a test/harness environment
for development work + experimentation, hand built from scratch.
At some point I'll rewrite/restructure everything.

I'll try your suggestion, many thanks. I did peruse the docs
but clearly missed that detail somewhere along the line!!

Cheers

Graham


From patrick at gundla.ch  Sat Jun 12 19:33:59 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 12 Jun 2010 19:33:59 +0200
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
In-Reply-To: <4C137F2C.7090009@readytext.co.uk>
References: <4C137F2C.7090009@readytext.co.uk>
Message-ID: <98DC263F-C0B6-4558-B916-F5A3354FB675@gundla.ch>

Hi,

> -----------------------------------------------
> ! LuaTeX error <\directlua >:1: Expected an array of names as second argument
> stack traceback:
>        [C]: in function 'enableprimitives'
>        <\directlua >:1: in main chunk.
> \luatexbase at ensure@primitive ...s('luatex', '#1')}
>                                                  \fi
> l.82 \luatexbase at ensure@primitive{luaescapestring}
> 

This looks like an error in luatexbase-compat.sty to me, but I feel like I've forgotten all about TeX macro programming.:

\luatexbase at directlua{tex.enableprimitives('luatex', '#1')}}

and 

\luatexbase at ensure@primitive{luaescapestring}

The message is, that the second arg to enableprimitives must be an array, but the expansion of 

\luatexbase at ensure@primitive{luaescapestring}

is something like

tex.enableprimitives('luatex', 'luaescapestring')

which does not look like an array (but an error) to me.




Patrick

From root at mail.boekplan.nl  Sun Jun 13 12:26:50 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 13 Jun 2010 12:26:50 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100613102650.85C4C40062@mail.boekplan.nl>

------------------------------------------------------------------------
r3720 | taco | 2010-06-13 10:04:27 +0200 (Sun, 13 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/inputstack.h

force two bitfields to be signed (sun studio compiler issue, spotted and debugged by Vladimir Volovich)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Jun 14 12:26:51 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 14 Jun 2010 12:26:51 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100614102651.1531C40064@mail.boekplan.nl>

------------------------------------------------------------------------
r3721 | oneiros | 2010-06-14 00:28:33 +0200 (Mon, 14 Jun 2010) | 21 lines
Changed paths:
   M /trunk
   M /trunk/source/texk/web2c/luatexdir/luafilesystem/src/lfs.c
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/lookups.c
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettf.c
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/parsettfatt.c
   M /trunk/source/texk/web2c/luatexdir/luasocket/src/options.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.h
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.w

Merged revisions 3717-3720 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3717 | taco | 2010-06-10 13:35:35 +0200 (Do, 10 Jun 2010) | 2 lines
  
  extend some sprintf buffers 
........
  r3718 | taco | 2010-06-10 15:24:58 +0200 (Do, 10 Jun 2010) | 2 lines
  
  fix lfs.currentdir() for non-GNU compiler
........
  r3719 | taco | 2010-06-10 18:58:16 +0200 (Do, 10 Jun 2010) | 2 lines
  
  inefficient but working version of the swap_items function
........
  r3720 | taco | 2010-06-13 10:04:27 +0200 (So, 13 Jun 2010) | 2 lines
  
  force two bitfields to be signed (sun studio compiler issue, spotted and debugged by Vladimir Volovich)
........

------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Jun 14 22:25:59 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 14 Jun 2010 22:25:59 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100614202559.6D02440065@mail.boekplan.nl>

------------------------------------------------------------------------
r3722 | taco | 2010-06-14 17:31:05 +0200 (Mon, 14 Jun 2010) | 3 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-env.tex
   M /branches/0.60.x/manual/luatexref-t.pdf

add \setupinteraction[focus=standard] for better link
behavior in PDF viewers

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Wed Jun 16 23:13:12 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Wed, 16 Jun 2010 22:13:12 +0100
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
In-Reply-To: <98DC263F-C0B6-4558-B916-F5A3354FB675@gundla.ch>
References: <98DC263F-C0B6-4558-B916-F5A3354FB675@gundla.ch>
Message-ID: <4C193E68.5070209@readytext.co.uk>

Hi Patrick

Many thanks. This same issue has stymied trying to use fontspec too.
I'll try to post the question elsewhere to see if the authors can shed 
further light on this. Trying to figure this out is a bit beyond my
expertise, sadly :-(

Many thanks

Graham


From graham.douglas at readytext.co.uk  Thu Jun 17 21:07:44 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Thu, 17 Jun 2010 20:07:44 +0100
Subject: [Dev-luatex] Problems with luatextra, luaotfload etc
In-Reply-To: <4C193E68.5070209@readytext.co.uk>
References: <4C193E68.5070209@readytext.co.uk>
Message-ID: <4C1A7280.7040705@readytext.co.uk>

Hmm, this is probably the issue
luatex-compat.sty
/x{
    /luatexbase at directlua{tex.enableprimitives('luatex', #1)}}

--->

/x{
     /luatexbase at directlua{tex.enableprimitives('luatex', {'#1'})}}

Seems to fix it.

Graham


From root at mail.boekplan.nl  Fri Jun 18 12:27:10 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 18 Jun 2010 12:27:10 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100618102710.773CB40062@mail.boekplan.nl>

------------------------------------------------------------------------
r3723 | taco | 2010-06-18 11:19:27 +0200 (Fri, 18 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/texfont.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/textoken.h

fix (un)dumping of structures (endianness)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Jun 18 16:26:55 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 18 Jun 2010 16:26:55 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100618142655.69C8940062@mail.boekplan.nl>

------------------------------------------------------------------------
r3724 | oneiros | 2010-06-18 12:57:12 +0200 (Fri, 18 Jun 2010) | 14 lines
Changed paths:
   M /trunk
   M /trunk/manual/luatexref-env.tex
   M /trunk/manual/luatexref-t.pdf
   M /trunk/source/texk/web2c/luatexdir/font/texfont.h
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.h

Merged revisions 3722-3723 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3722 | taco | 2010-06-14 17:31:05 +0200 (Mo, 14 Jun 2010) | 3 lines
  
  add \setupinteraction[focus=standard] for better link
  behavior in PDF viewers
........
  r3723 | taco | 2010-06-18 11:19:27 +0200 (Fr, 18 Jun 2010) | 2 lines
  
  fix (un)dumping of structures (endianness)
........

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Jun 20 12:27:01 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 20 Jun 2010 12:27:01 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100620102701.8F03140062@mail.boekplan.nl>

------------------------------------------------------------------------
r3725 | taco | 2010-06-20 10:49:49 +0200 (Sun, 20 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.tex

fix typo in pdftex token register commands

------------------------------------------------------------------------

From root at mail.boekplan.nl  Thu Jun 24 16:26:06 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 24 Jun 2010 16:26:06 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100624142606.C405840062@mail.boekplan.nl>

------------------------------------------------------------------------
r3726 | taco | 2010-06-24 14:13:43 +0200 (Thu, 24 Jun 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/lnodelib.c

don't add to the attribute reference count of null (as that is a glue_spec)

------------------------------------------------------------------------
r3727 | taco | 2010-06-24 14:15:16 +0200 (Thu, 24 Jun 2010) | 13 lines
Changed paths:
   M /trunk
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c

Merged revisions 3725-3726 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3725 | taco | 2010-06-20 10:49:49 +0200 (Sun, 20 Jun 2010) | 2 lines
  
  fix typo in pdftex token register commands
........
  r3726 | taco | 2010-06-24 14:13:43 +0200 (Thu, 24 Jun 2010) | 2 lines
  
  don't add to the attribute reference count of null (as that is a glue_spec)
........

------------------------------------------------------------------------
r3728 | taco | 2010-06-24 15:50:25 +0200 (Thu, 24 Jun 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/writet1.w

make the backend report *which* enc file is giving trouble

------------------------------------------------------------------------

