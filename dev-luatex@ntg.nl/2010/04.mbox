From root at mail.boekplan.nl  Thu Apr  1 12:26:09 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu,  1 Apr 2010 12:26:09 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100401102609.575434005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3565 | taco | 2010-04-01 12:04:17 +0200 (Thu, 01 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/mplibdir/ChangeLog
   M /trunk/source/texk/web2c/mplibdir/am/libmplib.am
   M /trunk/source/texk/web2c/mplibdir/am/mplib.am
   M /trunk/source/texk/web2c/mplibdir/memio.w
   M /trunk/source/texk/web2c/mplibdir/mp.w
   M /trunk/source/texk/web2c/mplibdir/mpost.w
   M /trunk/source/texk/web2c/mplibdir/mpxout.w
   M /trunk/source/texk/web2c/mplibdir/psout.w
   M /trunk/source/texk/web2c/mplibdir/svgout.w
   M /trunk/source/texk/web2c/mplibdir/tfmin.w

import metapost 1.211

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr  2 12:26:12 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  2 Apr 2010 12:26:12 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100402102613.0C8284005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3566 | taco | 2010-04-02 12:01:59 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/sfnt.w
   M /trunk/source/texk/web2c/luatexdir/font/subfont.w
   M /trunk/source/texk/web2c/luatexdir/font/texfont.w
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.w
   M /trunk/source/texk/web2c/luatexdir/font/tounicode.w
   M /trunk/source/texk/web2c/luatexdir/font/tt_glyf.w
   M /trunk/source/texk/web2c/luatexdir/font/tt_table.w
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.w
   M /trunk/source/texk/web2c/luatexdir/font/vfpacket.w
   M /trunk/source/texk/web2c/luatexdir/font/writecff.w
   M /trunk/source/texk/web2c/luatexdir/font/writeenc.w
   M /trunk/source/texk/web2c/luatexdir/font/writefont.w
   M /trunk/source/texk/web2c/luatexdir/font/writet1.w
   M /trunk/source/texk/web2c/luatexdir/font/writet3.w
   M /trunk/source/texk/web2c/luatexdir/font/writettf.w
   M /trunk/source/texk/web2c/luatexdir/font/writetype0.w
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.w

convert the rest of the font/*.w files to a format cweave can handle

------------------------------------------------------------------------
r3567 | hhenkel | 2010-04-02 12:07:12 +0200 (Fri, 02 Apr 2010) | 9 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

fix part of Subject: [luatex 0000368]: pdfpageresources cum suis
pdf.pdfcatalog = pdf.catalog
pdf.pdfinfo = pdf.info
pdf.pdfmapfile = pdf.mapfile
pdf.pdfmapline = pdf.mapline
pdf.pdfnames = pdf.names
pdf.pdftrailer = pdf.trailer
(docu tbd)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr  2 16:25:22 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  2 Apr 2010 16:25:22 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100402142522.66F724005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3568 | hhenkel | 2010-04-02 12:35:43 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

manual update

------------------------------------------------------------------------
r3569 | taco | 2010-04-02 14:14:34 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lang/hnjalloc.w
   M /trunk/source/texk/web2c/luatexdir/lang/hyphen.w
   M /trunk/source/texk/web2c/luatexdir/lang/texlang.w

patch the files in lang/ for use with cweave

------------------------------------------------------------------------
r3570 | taco | 2010-04-02 14:28:49 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.w
   M /trunk/source/texk/web2c/luatexdir/ocp/ocplist.w
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.w
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.w

cweave the ocp/*.w files

------------------------------------------------------------------------
r3571 | taco | 2010-04-02 15:50:45 +0200 (Fri, 02 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   D /trunk/source/texk/web2c/luatexdir/pdf/pagetree.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pagetree.w (from /trunk/source/texk/web2c/luatexdir/pdf/pagetree.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfannot.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfdest.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdffont.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdffont.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfimage.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdflink.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdflink.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfliteral.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfobj.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfoutline.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfpage.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfrule.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfrule.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfrule.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfsaverestore.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfsaverestore.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfsaverestore.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfshipout.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfshipout.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfshipout.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdftables.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdftables.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfthread.c:3564)
   D /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c
   A /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.w (from /trunk/source/texk/web2c/luatexdir/pdf/pdfxform.c:3564)

Conversion of all the luatexdir/pdf/*.c files to cweb,
also removing cweave errors

------------------------------------------------------------------------
r3572 | oneiros | 2010-04-02 16:04:50 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf

ignore some files

------------------------------------------------------------------------
r3573 | hhenkel | 2010-04-02 16:10:54 +0200 (Fri, 02 Apr 2010) | 4 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pagetree.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.h
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

fix Subject: [luatex 0000368]: pdfpageresources cum suis
new:
pdf.pageattributes, pdf.pageresources, pdf.pagesresources

------------------------------------------------------------------------
r3574 | taco | 2010-04-02 16:14:45 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   D /trunk/source/texk/web2c/luatexdir/utils/avlstuff.c
   A /trunk/source/texk/web2c/luatexdir/utils/avlstuff.w (from /trunk/source/texk/web2c/luatexdir/utils/avlstuff.c:3564)
   D /trunk/source/texk/web2c/luatexdir/utils/managed-sa.c
   A /trunk/source/texk/web2c/luatexdir/utils/managed-sa.w (from /trunk/source/texk/web2c/luatexdir/utils/managed-sa.c:3564)
   D /trunk/source/texk/web2c/luatexdir/utils/utils.c
   A /trunk/source/texk/web2c/luatexdir/utils/utils.w (from /trunk/source/texk/web2c/luatexdir/utils/utils.c:3564)

convert selected files from luatexdir/utils to cweb 

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Fri Apr  2 18:01:03 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Fri, 02 Apr 2010 17:01:03 +0100
Subject: [Dev-luatex] Building a minimal luatex runtime environment: DVI is
 OK but PDF is failing
Message-ID: <4BB614BF.9010208@readytext.co.uk>

Dear all

Firstly, my apologies in advance of this post in not appropriate here.
I will (hopefully) give enough background info to
explain my setup.

Windows Vista
LuaTeX, Version beta-0.53.0-2010040120

I've compiled LuaTeX on Windows with MinGW, mysys and
have working debug versions of luatex.exe (using --nostrip)
which function perfectly with gdb. So far so good.
(I use Tortoise SVN to check out the latest source code etc)

Now I want to create a minimal test environment for
LuaTeX which lets me compile some simple .tex files
for working with gdb.

So far I have constructed a minimal working texmf.cnf file
(not pretty --- and I'm sure it is wrong in many ways)
but it does enable some limited functionality. I have been able to
use Hans' example of "lplain" as a starting point but
have stripped this down to the following ("gplain" format):


==========
gplain.tex
===========
\input plain
\directlua {tex.enableprimitives('', tex.extraprimitives())}
\edef\fmtversion{\fmtversion+luatex}

If I run

luatex.exe --ini gplain

(and type \dump)

I get a working gplain.ftm which I can run with

luatex.exe --progname=gplain $TEXMF/ptest2.tex

where "ptest2.tex" contains nothing more than:

\directlua 0 {
tex.print("Hello from gplain")
}
\bye

And ths outputs ptest2.dvi---->

This is LuaTeX, Version beta-0.53.0-2010040120
(c:/msys/1.0/trunk/build/texk/ptest2.tex [1] )
Output written on ptest2.dvi (1 page, 228 bytes).
Transcript written on ptest2.log.

---> which I can view with MikTeX's YAP.

So far so good.

However, if I type

\pdfoutput=1 at the start of my test file:

\pdfoutput=1
\directlua 0 {
tex.print("Hello from gplain")
}
\bye

I get a PDF but it is not functional.

I have the following set in my environment

KPATHSEA_DEBUG=-1
KPATHSEA_DEBUG_OUTPUT=c:/kspsluatex.log
TEXMF=C:/msys/1.0/trunk/build/texk
TEXMFCNF=C:/msys/1.0/trunk/build/texk
TEXMFLOG=c:/texmflog.log

At the end of c:/kspsluatex.log I see:

kpathsea: Running mktexpk --mfmode / --bdpi 72 --mag 1+0/72 --dpi 72 cmr10
luatex.exe: fatal: kpathsea: CreateProcess() failed for `mktexpk 
--mfmode / --bdpi 72 --mag 1+0/72 --dpi 72 cmr10' (Error 2)

So, finally to my question. Clearly, I am missing some steps in getting 
PDF output to work and this is likely to be fonts. Seems like an attempt
to build bitmaps is failing but I have a full collection of Type1 
Computer Modern fonts installed.

Would the list members be able to help me pinpoint the problem
with the PDF output?

What additional information do you need from me
that would help you trace the source of the problem?

With many thanks in advance.

Warm wishes to all.

Graham Douglas


















From patrick at gundla.ch  Fri Apr  2 18:31:48 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 2 Apr 2010 18:31:48 +0200
Subject: [Dev-luatex] Building a minimal luatex runtime environment: DVI
	is OK but PDF is failing
In-Reply-To: <4BB614BF.9010208@readytext.co.uk>
References: <4BB614BF.9010208@readytext.co.uk>
Message-ID: <2FF87E6D-3B36-454E-92E6-841DBCA0843A@gundla.ch>

Hello Graham,

first of all: your setup looks okay to me and I am able to run your testfile (pdf) on a Mac exactly as you described your steps. So I think that we need to do some more bug hunting.

> I have the following set in my environment
> 
> KPATHSEA_DEBUG=-1
> KPATHSEA_DEBUG_OUTPUT=c:/kspsluatex.log
> TEXMF=C:/msys/1.0/trunk/build/texk
> TEXMFCNF=C:/msys/1.0/trunk/build/texk
> TEXMFLOG=c:/texmflog.log
> 
> At the end of c:/kspsluatex.log I see:
> 
> kpathsea: Running mktexpk --mfmode / --bdpi 72 --mag 1+0/72 --dpi 72 cmr10
> luatex.exe: fatal: kpathsea: CreateProcess() failed for `mktexpk --mfmode / --bdpi 72 --mag 1+0/72 --dpi 72 cmr10' (Error 2)


I wonder what your exact output looks like (without the KPATHSEA_DEBUG output). This for example is what I have:

This is LuaTeX, Version beta-0.53.0-2010032418 
(./ptest2.tex [1{/opt/texlive2009/texmf-var/fonts/map/pdftex/updmap/pdftex.map}
] )</opt/texlive2009/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
Output written on ptest2.pdf (1 page, 13391 bytes).
Transcript written on ptest2.log.

I assume that your problem might be due to a missing/incomplete/... pdftex.map. If you repeat your steps with pdftex, does it work OK? What does KPATHSEA_DEBUG tell you about loading pdftex.map file? Can it find one? Does "kpsewhich pdftex.map" gives you any output? Inside the pdftex.map I have

cmr10 CMR10 <cmr10.pfb

and I think (I am not totally sure) that this is the line which makes my example work.

Patrick


From graham.douglas at readytext.co.uk  Fri Apr  2 19:25:30 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Fri, 02 Apr 2010 18:25:30 +0100
Subject: [Dev-luatex] Building a minimal luatex runtime environment: DVI
 is OK but PDF is failing
In-Reply-To: <2FF87E6D-3B36-454E-92E6-841DBCA0843A@gundla.ch>
References: <2FF87E6D-3B36-454E-92E6-841DBCA0843A@gundla.ch>
Message-ID: <4BB6288A.1060804@readytext.co.uk>

<snip>

Hi Patrick, I'll take a look at your suggestion --- and thank you *very 
much* for taking the time to run through the steps. Much appreciated.
I'll report back shotly.

All the best

Graham


From graham.douglas at readytext.co.uk  Fri Apr  2 20:00:59 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Fri, 02 Apr 2010 19:00:59 +0100
Subject: [Dev-luatex] Building a minimal luatex runtime environment: DVI
 is OK but PDF is failing
In-Reply-To: <2FF87E6D-3B36-454E-92E6-841DBCA0843A@gundla.ch>
References: <2FF87E6D-3B36-454E-92E6-841DBCA0843A@gundla.ch>
Message-ID: <4BB630DB.80203@readytext.co.uk>

Patrick Gundlach patrick at gundla.ch
on Fri Apr 2 18:31:48 CEST 2010

very kindly wrote:

<snip>

==========
I assume that your problem might be due to a missing/incomplete/... 
pdftex.map. If you repeat your steps with pdftex, does it work OK? What 
does KPATHSEA_DEBUG tell you about loading pdftex.map file? Can it find 
one? Does "kpsewhich pdftex.map" gives you any output? Inside the 
pdftex.map I have

cmr10 CMR10 <cmr10.pfb

and I think (I am not totally sure) that this is the line which makes my 
example work.

=============

Patrick, thank you! Success !! Yes, it was indeed an incomplete 
pdftex.map file which was causing the problem.

Much appreciated.

Graham



From root at mail.boekplan.nl  Fri Apr  2 22:25:26 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri,  2 Apr 2010 22:25:26 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100402202526.C16EF4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3575 | taco | 2010-04-02 17:00:40 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   D /trunk/source/texk/web2c/luatexdir/image/epdf.c
   A /trunk/source/texk/web2c/luatexdir/image/epdf.w (from /trunk/source/texk/web2c/luatexdir/image/epdf.c:3573)
   D /trunk/source/texk/web2c/luatexdir/image/writeimg.c
   A /trunk/source/texk/web2c/luatexdir/image/writeimg.w (from /trunk/source/texk/web2c/luatexdir/image/writeimg.c:3573)
   D /trunk/source/texk/web2c/luatexdir/image/writejbig2.c
   A /trunk/source/texk/web2c/luatexdir/image/writejbig2.w (from /trunk/source/texk/web2c/luatexdir/image/writejbig2.c:3573)
   D /trunk/source/texk/web2c/luatexdir/image/writejpg.c
   A /trunk/source/texk/web2c/luatexdir/image/writejpg.w (from /trunk/source/texk/web2c/luatexdir/image/writejpg.c:3573)
   D /trunk/source/texk/web2c/luatexdir/image/writepng.c
   A /trunk/source/texk/web2c/luatexdir/image/writepng.w (from /trunk/source/texk/web2c/luatexdir/image/writepng.c:3573)

convert the luatexdir/image/*.c files to cweb

------------------------------------------------------------------------
r3576 | oneiros | 2010-04-02 17:16:22 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   D /trunk/source/texk/web2c/luatexdir/README

rm obsolete file

------------------------------------------------------------------------
r3577 | taco | 2010-04-02 17:27:11 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   D /trunk/source/texk/web2c/luatexdir/lua/luagen.c
   A /trunk/source/texk/web2c/luatexdir/lua/luagen.w (from /trunk/source/texk/web2c/luatexdir/lua/luagen.c:3573)
   D /trunk/source/texk/web2c/luatexdir/lua/luainit.c
   A /trunk/source/texk/web2c/luatexdir/lua/luainit.w (from /trunk/source/texk/web2c/luatexdir/lua/luainit.c:3573)
   D /trunk/source/texk/web2c/luatexdir/lua/luanode.c
   A /trunk/source/texk/web2c/luatexdir/lua/luanode.w (from /trunk/source/texk/web2c/luatexdir/lua/luanode.c:3573)
   D /trunk/source/texk/web2c/luatexdir/lua/luastuff.c
   A /trunk/source/texk/web2c/luatexdir/lua/luastuff.w (from /trunk/source/texk/web2c/luatexdir/lua/luastuff.c:3573)
   D /trunk/source/texk/web2c/luatexdir/lua/luatex.c
   D /trunk/source/texk/web2c/luatexdir/lua/luatoken.c
   A /trunk/source/texk/web2c/luatexdir/lua/luatoken.w (from /trunk/source/texk/web2c/luatexdir/lua/luatoken.c:3573)
   D /trunk/source/texk/web2c/luatexdir/lua/texluac.c
   A /trunk/source/texk/web2c/luatexdir/lua/texluac.w (from /trunk/source/texk/web2c/luatexdir/lua/texluac.c:3573)

convert selected C files from luatexdir/lua to cweb

------------------------------------------------------------------------
r3578 | hhenkel | 2010-04-02 17:31:41 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

corr. pdf.mapfile = pdf.mapfile or pdf.pdfmapfile crash

------------------------------------------------------------------------
r3579 | hhenkel | 2010-04-02 18:02:39 +0200 (Fri, 02 Apr 2010) | 4 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

change variables pdf.mapfile, pdf.pdfmapfile, pdf.mapline, and
pdf.pdfmapline into two lua functions:pdf.mapfile() and pdf.mapline();
docu todo.

------------------------------------------------------------------------
r3580 | oneiros | 2010-04-02 18:12:25 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

rm unused variables

------------------------------------------------------------------------
r3581 | hhenkel | 2010-04-02 18:18:55 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

document pdf.mapfile() and pdf.mapline()

------------------------------------------------------------------------
r3582 | hhenkel | 2010-04-02 18:37:08 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c

typo

------------------------------------------------------------------------
r3583 | hhenkel | 2010-04-02 19:40:44 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luagen.w
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.w
   M /trunk/source/texk/web2c/luatexdir/lua/luanode.w
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.w
   M /trunk/source/texk/web2c/luatexdir/lua/luatoken.w
   M /trunk/source/texk/web2c/luatexdir/lua/texluac.w

propset

------------------------------------------------------------------------
r3584 | hhenkel | 2010-04-02 19:45:55 +0200 (Fri, 02 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/font/dofont.w
   M /trunk/source/texk/web2c/luatexdir/font/luafont.w
   M /trunk/source/texk/web2c/luatexdir/font/mapfile.w
   M /trunk/source/texk/web2c/luatexdir/font/pkin.w
   M /trunk/source/texk/web2c/luatexdir/font/sfnt.w
   M /trunk/source/texk/web2c/luatexdir/font/subfont.w
   M /trunk/source/texk/web2c/luatexdir/font/texfont.w
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.w
   M /trunk/source/texk/web2c/luatexdir/font/tounicode.w
   M /trunk/source/texk/web2c/luatexdir/font/tt_glyf.w
   M /trunk/source/texk/web2c/luatexdir/font/tt_table.w
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.w
   M /trunk/source/texk/web2c/luatexdir/font/vfpacket.w
   M /trunk/source/texk/web2c/luatexdir/font/writecff.w
   M /trunk/source/texk/web2c/luatexdir/font/writeenc.w
   M /trunk/source/texk/web2c/luatexdir/font/writefont.w
   M /trunk/source/texk/web2c/luatexdir/font/writet1.w
   M /trunk/source/texk/web2c/luatexdir/font/writet3.w
   M /trunk/source/texk/web2c/luatexdir/font/writettf.w
   M /trunk/source/texk/web2c/luatexdir/font/writetype0.w
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.w
   M /trunk/source/texk/web2c/luatexdir/image/epdf.w
   M /trunk/source/texk/web2c/luatexdir/image/writeimg.w
   M /trunk/source/texk/web2c/luatexdir/image/writejbig2.w
   M /trunk/source/texk/web2c/luatexdir/image/writejpg.w
   M /trunk/source/texk/web2c/luatexdir/image/writepng.w
   M /trunk/source/texk/web2c/luatexdir/lang/hnjalloc.w
   M /trunk/source/texk/web2c/luatexdir/lang/hyphen.w
   M /trunk/source/texk/web2c/luatexdir/lang/texlang.w
   M /trunk/source/texk/web2c/luatexdir/ocp/ocp.w
   M /trunk/source/texk/web2c/luatexdir/ocp/ocplist.w
   M /trunk/source/texk/web2c/luatexdir/ocp/readocp.w
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfglyph.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfrule.w
   M /trunk/source/texk/web2c/luatexdir/tex/align.w
   M /trunk/source/texk/web2c/luatexdir/tex/filename.w
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.w
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.w
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.w
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.w
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.w
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.w
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.w
   M /trunk/source/texk/web2c/luatexdir/utils/avlstuff.w
   M /trunk/source/texk/web2c/luatexdir/utils/managed-sa.w
   M /trunk/source/texk/web2c/luatexdir/utils/utils.w

more propset

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Apr  3 16:25:25 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat,  3 Apr 2010 16:25:25 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100403142525.993E34005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3585 | taco | 2010-04-03 14:16:45 +0200 (Sat, 03 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

git detection patch from Patrick Gundlach

------------------------------------------------------------------------
r3586 | taco | 2010-04-03 14:18:15 +0200 (Sat, 03 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh

previous patch was broken

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Apr  3 22:25:23 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat,  3 Apr 2010 22:25:23 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100403202523.B5E844005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3587 | taco | 2010-04-03 16:32:25 +0200 (Sat, 03 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/align.w
   M /trunk/source/texk/web2c/luatexdir/tex/arithmetic.w
   M /trunk/source/texk/web2c/luatexdir/tex/buildpage.w
   M /trunk/source/texk/web2c/luatexdir/tex/commands.w
   M /trunk/source/texk/web2c/luatexdir/tex/conditional.w
   M /trunk/source/texk/web2c/luatexdir/tex/directions.w
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.w
   M /trunk/source/texk/web2c/luatexdir/tex/equivalents.w
   M /trunk/source/texk/web2c/luatexdir/tex/errors.w
   M /trunk/source/texk/web2c/luatexdir/tex/expand.w
   M /trunk/source/texk/web2c/luatexdir/tex/extensions.w
   M /trunk/source/texk/web2c/luatexdir/tex/filename.w
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.w
   M /trunk/source/texk/web2c/luatexdir/tex/linebreak.w
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.w
   M /trunk/source/texk/web2c/luatexdir/tex/maincontrol.w
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/memoryword.w
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.w
   M /trunk/source/texk/web2c/luatexdir/tex/nesting.w
   M /trunk/source/texk/web2c/luatexdir/tex/packaging.w
   M /trunk/source/texk/web2c/luatexdir/tex/postlinebreak.w
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.w
   M /trunk/source/texk/web2c/luatexdir/tex/printing.w
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.w
   M /trunk/source/texk/web2c/luatexdir/tex/stringpool.w
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.w
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.w
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.w

fix the cweaving of the cweb files in luatexdir/tex/

------------------------------------------------------------------------

From taco at elvenkind.com  Sun Apr  4 09:16:28 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 04 Apr 2010 09:16:28 +0200
Subject: [Dev-luatex] Luatex 0.60.0 announcement
Message-ID: <4BB83CCC.6060203@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.60.0.

This release starts a new chain of stable beta's, and will be the
version included in this year's TeXLive.

New features:

* os.name now knows about CYGWIN (from Elie Roux)

* Internal handling of direction specifiers is faster now.

* Each glyph node now has three new virtual read-only fields:
   width, height, and depth (values in scaled points, of course)

* There are new functions node.protrusion_skipable() and
   tex.badness() (useful for paragraph breaking in lua)

* Also new: tex.linebreak(). See the manual for details.

* All lua errors now report file and line numbers to aid in
   debugging.

* Import of metapost 1.211.

* pdf.pdfcatalog will be replaced soon by the new pdf.catalog
   pdf.pdfinfo will be replaced soon by the new pdf.info
   pdf.pdfnames will be replaced soon by the new pdf.names
   pdf.pdftrailer will be replaced soon by the new pdf.trailer

* pdf.pdfmapfile and pdf.pdfmapline are replaced by the new
   pdf.mapfile() and pdf.mapline() functions. (a function interface
   fits these parameters better because they never return anything).

* New read-write lua variables: pdf.pageattributes, pdf.pageresources,
   pdf.pagesresources

* getluatexsvnversion.sh now correctly detects git-svn and still
   manages to find a valid SVN revision number (from Patrick Gundlach)

* Many of the source files have been converted to CWEB.

Bug fixes:

* GNU libtool is now used to solve the various technical issues with
   dynamic loading of lua modules.

* Error detection in scan_integer_part was wrong due to missing
   initialization of OK_so_far (spotted by Javier Mugica)

* Synctex was broken in 0.51-0.52.

* \lastlinefit was broken since ... well, nearly forever.

* Reading of binary files with length zero was broken.

* Trapping of unitialized rules (this was for sloppily created
   rule nodes from lua)

* pdf.immediateobj('streamfile') was broken on 64-bit platforms.

* tex.linebreak did not take the given left and right skip, but
   instead used the current TeX-side values (bug #356).

* the found 'MAKE' command in build.sh is now fed into configure to fix
   problems with that not finding GNU make even when it is actually
   installed.

* dofile(<nil>) and loadfile(<nil>) in batch mode now give an
   error and continue instead of pointlessly waiting for user input.

* Reverted commit #3417 (the buildpage experiment) as it causes bad
   things to happen when items are waiting during page breaks.

* Overrule loaders[4] in --safer mode, make require() behave
   closer to normal lua 5.1, and add some nicer error messages
   (based on an email and patches from Manuel Pegourie-Gonnard)

* Added an extra sanity check for GDEF loading in luafontloader,
   based on a crash caused by Linux' AkaashNormal.ttf.

The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.60.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org


Have fun,
Taco



From taco at elvenkind.com  Sun Apr  4 12:20:06 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 04 Apr 2010 12:20:06 +0200
Subject: [Dev-luatex] Luatex 0.40-0.60 delta
Message-ID: <4BB867D6.9000105@elvenkind.com>


Hi,

As some people may be interested in the differences between
the luatex in TL 2009 and the one in the upcoming TL 2010,
so I compiled a list of all non-bugfix changes between
0.40.7 and 0.60.0. Please let me know if I missed something ...


General changes:

* Many of the source files have been converted to CWEB.
* There is now support for revision numbers in the banner again.
* The horizontal mode nodes that are added to lines during line
   breaking now inherit the attributes from the first and last node
   inside the created line.
* All lua errors now report file and line numbers to aid in debugging.
* Luatex can now optionally use kpathsea to find lua require() files.
* The print precision for small numbers in lua code (tostring)
   has been improved.

Embedded libraries and other third-party inclusions:

* Metapost is now at version 1.211.
* New synctex code imported from TeXLive.
* Libpng is now at version 1.2.40.
* The lua file from the luamd5 library (which provides the
   md5.hexsuma() function) is now embedded in the executable.
* The Lua coroutine patch (coco) is now disabled on linux
   powerpc architectures (because it caused crashes)
* Luatex now has support for dynamic loading of
   external compiled lua libraries.

Font related:

* The backend message "cannot open Type 1 font file for reading"
   now reports which Type1 font file it was looking for.
* It is no longer possible for fonts from embedded pdf files
   to be replaced by / merged with the document fonts of the
   enveloping pdf.
* Support for Type3 .pgc files has been removed.
* The variables <metrics>.Mathconstants.FractionDelimiterSize
   and <metrics>.Mathconstants.FractionDelimiterDisplayStyleSize
   are added to the font table. This allows proper setting of the
   size parameters for TeX's ...withdelims math primitives.
* Artificially slanted or extended fonts now work via the pdf text matrix
   so that it now also  works for non-Type1 fonts. The lua <metrics>.slant
   and .extend font keys are now obeyed in all cases.
* A change to the relative ordering inside font name discovery for use
   by the backend: now it tries <f>.psname first, as that is much less
   likely to contain spaces.
* For ttc fonts, now the used subfont name and its index id are printed
   to the terminal, and if the backend cannot find a ttc subfont, the
   run is aborted.
* It is now possible to use Apple dfont font files.
* There is a new allowed key in the table that is returned
   by lua-loaded fonts: <f>.psname. This value should be set
   to the original PostScript font name of the font. Fonts inside
   dfont and ttc collections are fetched using this field
* lua-loaded fonts now support a 'nomath' key to speed up
   loading the lua table.
* The loading speed of large fonts via the fontloader library, and
   the inclusion speed for subsetting in the backend have both been
   improved.

'TeX'-side extensions:

* Two new token lists are provided: \pdfxformresources and
   \pdfxformattr, as an alternative to \pdfxform keywords.
* \input and \openin now accept braced filenames.
* The \endlinechar can now be set to any value between 0 and 127.
* The new primitives \aligntab and \alignmark are aliases for
   the use of & and # in alignments.
* \pdfrefxform [width <dimen>] [height <dimen>] [depth <dimen>] <formref>
   scales a form object; similar principle as with \pdfximage: depth alone
   doesn't scale, it shifts vertically.
* \pdfrefximage [width <dimen>] [height <dimen>] [depth <dimen>] <imageref>
   overrules settings from \pdfximage for this \pdfrefximage call only
* \pdfobj now has an extra optional keyword: 'uncompressed',
   which forces the object to be written to the PDF in plain
   text (see the manual for the exact details).
* \latelua is now allowed inside leaders.
* The new primitive \gleaders provides 'globally aligned' leaders.
* The \pdfcompresslevel is now effectively fixed as soon as
   output to the pdf file has occurred.
* Removed obsolete pdftex primitives:
   \pdfoptionalwaysusepdfpagebox
   \pdfoptionpdfinclusionerrorlevel
   \pdfforcepagebox
   \pdfmovechars
* (un-feature): from now on luatex now only handles 4 direction
   specifiers: TLT (latin), TRT (arabic), RTT (cjk), and LTL
   (mongolian). The other directions now generate an error.

Lua table extensions:

* callback table:
   ** There is a new callback: process_output_buffer
   ** The callbacks hpack_filter, vpack_filter and pre_output_filter
   pass on an extra string argument for the direction, when known.

* fontloader table:
   ** fontloader.open() previously cleared some font names that it
   should not.

* font table:
   ** new function font.id()

* kpse table:
   ** new functions kpse.lookup() and kpse.version()

* lfs table:
   ** new functions lfs.readlink() and lfs.shortname()

* node table:
   ** new function node.vpack()
   ** new function node.protrusion_skipable()
   ** new function node.dimensions().
   ** new function node.tail()
   ** Each glyph node now has three new virtual read-only fields:
   width, height, and depth (values in scaled points)
   ** node.copy_list() now allows the second (optional) argument to be nil.
   ** node.hpack() now accepts "cal_expand_ratio" and "subst_ex_font" 
modifiers.
   ** node.hpack() and node.vpack() also give back the badness of the box.
   ** node.copy_list() now allows a second (stop) argument.
   ** The lua functions node.hpack(), node.vpack() and node.dimensions()
   now accept an optional direction argument.
   ** hlist nodes now have a subtype to distinguish hlists generated
   by the paragraph breaking, explicit \hbox commands, and other sources.
   ** glue_spec nodes now have an extra field: writable.

* os table:
   ** os.name now knows about CYGWIN and kfreebsd.

* pdf table:
   ** new functions: pdf.mapfile(), pdf.mapline()
   ** new function pdf.registerannot()
   ** new functions pdf.obj(), pdf.immediateobj(), pdf.reserveobj()
   ** new read-write string keys: pdf.catalog, pdf.info,
   pdf.names, pdf.trailer, pdf.pageattributes, pdf.pageresources,
   pdf.pagesresources

* tex table:
   ** new function tex.badness()
   ** new function tex.linebreak()
   ** new function tex.sp()
   ** new function tex.tprint()
   ** new function tex.shipout()
   ** new sub-table: tex.nest[] (rw access to the semantic nest state).

From root at mail.boekplan.nl  Sun Apr  4 12:27:12 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun,  4 Apr 2010 12:27:12 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100404102712.A94FD4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3588 | taco | 2010-04-04 08:41:44 +0200 (Sun, 04 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/luatex.c

bump the version numbers for a new release

------------------------------------------------------------------------
r3589 | taco | 2010-04-04 08:52:21 +0200 (Sun, 04 Apr 2010) | 2 lines
Changed paths:
   A /branches/0.60.x (from /trunk:3588)

new branch for the stable release

------------------------------------------------------------------------
r3590 | taco | 2010-04-04 08:52:49 +0200 (Sun, 04 Apr 2010) | 2 lines
Changed paths:
   A /tags/beta-0.60.0 (from /trunk:3589)

new tag for 0.60.0

------------------------------------------------------------------------
r3591 | taco | 2010-04-04 11:24:29 +0200 (Sun, 04 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/NEWS
   M /tags/beta-0.60.0/source/texk/web2c/luatexdir/NEWS
   M /trunk/source/texk/web2c/luatexdir/NEWS

oops, I forgot to update NEWS

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Apr  4 16:25:55 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun,  4 Apr 2010 16:25:55 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100404142555.5B03B4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3592 | taco | 2010-04-04 16:00:55 +0200 (Sun, 04 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/dvi/dvigen.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

IPC fixes from TeXLive

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Mon Apr  5 01:19:17 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Mon, 05 Apr 2010 00:19:17 +0100
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is missing
Message-ID: <4BB91E75.1090809@readytext.co.uk>

Hi

I have experienced a fatal crash with LuaTeX if an encoding file
is missing:

I am using debug versions (built with --nostrip)

Reproducible in

This is LuaTeX, Version beta-0.53.0-2010032719
This is LuaTeX, Version beta-0.60.0-2010040417

--- both are debug versions compiled from source

All you need to do is rename the encoding file to something
different mentioned in pdftex.map and the crash is reproducible
every time.

[1{c:/msys/1.0/trunk/build/texk/fonts/map/pdftex.map}] )
(see the transcript file for additional information)
!LuaTeX error: cannot find encoding file for reading
  ==> Fatal error occurred, no output PDF file produced!

Please let me know anything else I can do which
will help track this down.

I have GNU's gdb installed and would be happy to do whatever
I can to help.

Also, if this is not the right way to report bugs/issues
do please let me know and I'll follow the correct
procedures.

Best wishes

Graham



From khaledhosny at eglug.org  Mon Apr  5 04:31:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 5 Apr 2010 04:31:21 +0200
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is
 missing
In-Reply-To: <4BB91E75.1090809@readytext.co.uk>
References: <4BB91E75.1090809@readytext.co.uk>
Message-ID: <20100405023121.GB2588@khaled-laptop>

On Mon, Apr 05, 2010 at 12:19:17AM +0100, Graham Douglas wrote:
> Hi
> 
> I have experienced a fatal crash with LuaTeX if an encoding file
> is missing:
> 
> I am using debug versions (built with --nostrip)
> 
> Reproducible in
> 
> This is LuaTeX, Version beta-0.53.0-2010032719
> This is LuaTeX, Version beta-0.60.0-2010040417
> 
> --- both are debug versions compiled from source
> 
> All you need to do is rename the encoding file to something
> different mentioned in pdftex.map and the crash is reproducible
> every time.
> 
> [1{c:/msys/1.0/trunk/build/texk/fonts/map/pdftex.map}] )
> (see the transcript file for additional information)
> !LuaTeX error: cannot find encoding file for reading
>  ==> Fatal error occurred, no output PDF file produced!
> 
> Please let me know anything else I can do which
> will help track this down.

A sample file, with clear steps to reproduce the issue would be the
first step to help others track this down.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Apr  5 05:57:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 5 Apr 2010 05:57:59 +0200
Subject: [Dev-luatex] Luatex 0.60.0 announcement
In-Reply-To: <4BB83CCC.6060203@elvenkind.com>
References: <4BB83CCC.6060203@elvenkind.com>
Message-ID: <20100405035759.GA32733@khaled-laptop>

On Sun, Apr 04, 2010 at 09:16:28AM +0200, Taco Hoekwater wrote:
> * getluatexsvnversion.sh now correctly detects git-svn and still
>   manages to find a valid SVN revision number (from Patrick Gundlach)

I don't have ".git/refs/remotes/git-svn" here, so the check fails. The
attached patch makes it work for me too.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: git-svn.diff
Type: text/x-diff
Size: 765 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20100405/b379e151/attachment.diff>

From taco at elvenkind.com  Mon Apr  5 08:16:22 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Apr 2010 08:16:22 +0200
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is
	missing
In-Reply-To: <4BB91E75.1090809@readytext.co.uk>
References: <4BB91E75.1090809@readytext.co.uk>
Message-ID: <4BB98036.8030902@elvenkind.com>

Graham Douglas wrote:
> Hi
> 
> I have experienced a fatal crash with LuaTeX if an encoding file
> is missing:
> 
> I am using debug versions (built with --nostrip)
> 
> Reproducible in
> 
> This is LuaTeX, Version beta-0.53.0-2010032719
> This is LuaTeX, Version beta-0.60.0-2010040417
> 
> --- both are debug versions compiled from source
> 
> All you need to do is rename the encoding file to something
> different mentioned in pdftex.map and the crash is reproducible
> every time.
> 
> [1{c:/msys/1.0/trunk/build/texk/fonts/map/pdftex.map}] )
> (see the transcript file for additional information)
> !LuaTeX error: cannot find encoding file for reading
>  ==> Fatal error occurred, no output PDF file produced!

This is not a crash, it simply a fatal error.

Best wishes,
Taco

From mpg at elzevir.fr  Sun Apr  4 22:45:46 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 04 Apr 2010 22:45:46 +0200
Subject: [Dev-luatex] [luatex] Luatex 0.60.0 announcement
In-Reply-To: <4BB83CCC.6060203@elvenkind.com>
References: <4BB83CCC.6060203@elvenkind.com>
Message-ID: <4BB8FA7A.3040009@elzevir.fr>

Taco Hoekwater a ?crit :
> I have just uploaded the archives for a new luatex release, 0.60.0.
> 
> This release starts a new chain of stable beta's, and will be the
> version included in this year's TeXLive.
> 
Great news! Many thanks.

Sorry for nitpicking, but:

> * There are new functions node.protrusion_skipable() and

Should it be "skippable", or is it intentional? I'm not claiming any
understanding of English vs American or whatever subtleties, so I may be
completely mistaken, but Merriam-Webster only know about skippable.

Thanks again for this new release,
Manuel.

From taco at elvenkind.com  Mon Apr  5 08:28:02 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Apr 2010 08:28:02 +0200
Subject: [Dev-luatex] [luatex]  Luatex 0.60.0 announcement
In-Reply-To: <20100405035759.GA32733@khaled-laptop>
References: <4BB83CCC.6060203@elvenkind.com>
	<20100405035759.GA32733@khaled-laptop>
Message-ID: <4BB982F2.7040502@elvenkind.com>

Khaled Hosny wrote:
> On Sun, Apr 04, 2010 at 09:16:28AM +0200, Taco Hoekwater wrote:
>> * getluatexsvnversion.sh now correctly detects git-svn and still
>>   manages to find a valid SVN revision number (from Patrick Gundlach)
> 
> I don't have ".git/refs/remotes/git-svn" here, so the check fails. The
> attached patch makes it work for me too.

Applied.

Best wishes,
Taco

From taco at elvenkind.com  Mon Apr  5 08:29:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Apr 2010 08:29:37 +0200
Subject: [Dev-luatex] [luatex] Luatex 0.60.0 announcement
In-Reply-To: <4BB8FA7A.3040009@elzevir.fr>
References: <4BB83CCC.6060203@elvenkind.com> <4BB8FA7A.3040009@elzevir.fr>
Message-ID: <4BB98351.3060509@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> 
> Sorry for nitpicking, but:
> 
>> * There are new functions node.protrusion_skipable() and
> 
> Should it be "skippable", or is it intentional? I'm not claiming any
> understanding of English vs American or whatever subtleties, so I may be
> completely mistaken, but Merriam-Webster only know about skippable.

No problem, I'll change that and keep the old one around for a while
(my spellchecker knows neither word, btw).

Best wishes,
Taco

From root at mail.boekplan.nl  Mon Apr  5 12:27:12 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon,  5 Apr 2010 12:27:12 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100405102712.EAC684005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3593 | taco | 2010-04-05 08:21:13 +0200 (Mon, 05 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/getluatexsvnversion.sh

another git discovery patch, this time from Khaled Hosny

------------------------------------------------------------------------
r3594 | taco | 2010-04-05 08:26:39 +0200 (Mon, 05 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.tex
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/lnodelib.c

The correct word is protrusion_skippabler not protrusion_skipable

------------------------------------------------------------------------
r3595 | taco | 2010-04-05 12:06:54 +0200 (Mon, 05 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.tex

fix a typo spotted by Khaled and bump the version number

------------------------------------------------------------------------
r3596 | taco | 2010-04-05 12:12:46 +0200 (Mon, 05 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/scanning.w

fix assigning and aquiring \fontdimen s from TeX code

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Mon Apr  5 12:49:11 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Mon, 05 Apr 2010 11:49:11 +0100
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file
	is	missing
In-Reply-To: <4BB98036.8030902@elvenkind.com>
References: <4BB98036.8030902@elvenkind.com>
Message-ID: <4BB9C027.8050609@readytext.co.uk>

<<snip>>

Hi Taco

I sent you a screenshot showing how Windows Vista
responded with a "Program Stopped Working" dialog
box. I just wondered if this was indicating a more
serious error and thought it was worth raising.

Cheers

Graham


From taco at elvenkind.com  Mon Apr  5 15:02:22 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Apr 2010 15:02:22 +0200
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is
	missing
In-Reply-To: <4BB9BB65.9080508@readytext.co.uk>
References: <4BB91E75.1090809@readytext.co.uk> <4BB98036.8030902@elvenkind.com>
	<4BB9BB65.9080508@readytext.co.uk>
Message-ID: <4BB9DF5E.1090706@elvenkind.com>


Hi Graham,

Graham Douglas wrote:
> Hi Taco
> 
> See attached screenshot. This is what triggered me to think it was
> more than just a fatal error? Maybe not then.

In the case of fatal errors (of the kind below, that remove the
pdf document as well) luatex will call 'exit()' with the return
code 'EX_SOFTWARE' if kpathsea debugging is off, or with 'abort()'
if kpathsea debugging is on. The first form is a pretty normal
exit, the second form is an explicit forced crash (done because
this can be useful when debugging).

Therefore you should only get a popup with kpathsea debugging turned
on (via the command line --kpathsea-debug= parameter, or via a global 
KPATHSEA_DEBUG environment setting). Well, unless windows is not
behaving like unix (which is quite definitely possible, I don't know
*that* much about windows).

Best wishes,
Taco

From graham.douglas at readytext.co.uk  Mon Apr  5 15:54:04 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Mon, 05 Apr 2010 14:54:04 +0100
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is
	missing
In-Reply-To: <4BB9DF5E.1090706@elvenkind.com>
References: <4BB91E75.1090809@readytext.co.uk> <4BB98036.8030902@elvenkind.com>
	<4BB9BB65.9080508@readytext.co.uk> <4BB9DF5E.1090706@elvenkind.com>
Message-ID: <4BB9EB7C.7090607@readytext.co.uk>


Taco Hoekwater wrote:
> 
> Hi Graham,
> 
> Graham Douglas wrote:
>> Hi Taco
>>
>> See attached screenshot. This is what triggered me to think it was
>> more than just a fatal error? Maybe not then.
> 
> In the case of fatal errors (of the kind below, that remove the
> pdf document as well) luatex will call 'exit()' with the return
> code 'EX_SOFTWARE' if kpathsea debugging is off, or with 'abort()'
> if kpathsea debugging is on. The first form is a pretty normal
> exit, the second form is an explicit forced crash (done because
> this can be useful when debugging).
> 
> Therefore you should only get a popup with kpathsea debugging turned
> on (via the command line --kpathsea-debug= parameter, or via a global 
> KPATHSEA_DEBUG environment setting). Well, unless windows is not
> behaving like unix (which is quite definitely possible, I don't know
> *that* much about windows).
> 
> Best wishes,
> Taco
> 
> __________ Information from ESET Smart Security, version of virus 
> signature database 5000 (20100405) __________
> 
> The message was checked by ESET Smart Security.
> 
> http://www.eset.com
> 
> 

Thank you Taco, very, very helpful -- please excuse my naive
questions. I will definitely try *not* bother the list with irrelevant
or trivial issues.

(I do indeed have KPATHSEA_DEBUG =-1 in my environment)

Warm wishes

Graham


> 



From taco at elvenkind.com  Mon Apr  5 15:57:20 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 05 Apr 2010 15:57:20 +0200
Subject: [Dev-luatex] Fatal crash with LuaTeX if an encoding file is
	missing
In-Reply-To: <4BB9EB7C.7090607@readytext.co.uk>
References: <4BB91E75.1090809@readytext.co.uk> <4BB98036.8030902@elvenkind.com>
	<4BB9BB65.9080508@readytext.co.uk> <4BB9DF5E.1090706@elvenkind.com>
	<4BB9EB7C.7090607@readytext.co.uk>
Message-ID: <4BB9EC40.3040305@elvenkind.com>

Graham Douglas wrote:
> 
> Thank you Taco, very, very helpful -- please excuse my naive
> questions. I will definitely try *not* bother the list with irrelevant
> or trivial issues.

It was not irrelevant at all, luatex has somewhat obscure behavior
in this case (as does pdftex, btw.).

Best wishes,
Taco


From root at mail.boekplan.nl  Mon Apr  5 16:25:44 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon,  5 Apr 2010 16:25:44 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100405142544.EA7C44005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3597 | oneiros | 2010-04-05 15:00:45 +0200 (Mon, 05 Apr 2010) | 3 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/getluatexsvnversion.sh
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/tex/scanning.w

merge changes from 0.60x to trunk:
svn merge -r3592:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x .

------------------------------------------------------------------------
r3598 | taco | 2010-04-05 16:01:12 +0200 (Mon, 05 Apr 2010) | 2 lines
Changed paths:
   D /branches/0.60.x/source/texk/web2c/texmfmp.h

luatex is not using texmfmp.h any more

------------------------------------------------------------------------
r3599 | oneiros | 2010-04-05 16:08:48 +0200 (Mon, 05 Apr 2010) | 3 lines
Changed paths:
   D /trunk/source/texk/web2c/texmfmp.h

merge r3598
svn merge -r3597:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x .

------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Apr  7 22:25:40 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed,  7 Apr 2010 22:25:40 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100407202540.DBC364005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3600 | taco | 2010-04-07 16:21:51 +0200 (Wed, 07 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texmath.w

attempt to fix bug #372

------------------------------------------------------------------------

From root at mail.boekplan.nl  Thu Apr  8 12:26:44 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu,  8 Apr 2010 12:26:44 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100408102644.4D8C34005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3601 | oneiros | 2010-04-08 00:23:16 +0200 (Thu, 08 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w

merge r3600 into trunk
svn merge -r 3598:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x/ .

------------------------------------------------------------------------
r3602 | taco | 2010-04-08 10:55:21 +0200 (Thu, 08 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texmath.w

attempt to fix \eqno/\leqno placements

------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Thu Apr  8 14:31:09 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Thu, 8 Apr 2010 15:31:09 +0300
Subject: [Dev-luatex] LuaTeX cygwin build
Message-ID: <t2oeba574421004080531nf9873ae1u7a9d55f9da1e04f8@mail.gmail.com>

Hello,

If I test the LuaTeX 0.60 for mingw32 that I can get on
http://foundry.supelec.fr/gf/project/luatex/frs/, everything is doing
fine, but if I compile my own binary under cygwin, for documents using
a lot of big fonts, I easily run out of memory. I don't think it's a
big deal as I can use mingw32 binaries under cygwin without any
problem, but I think it would be worth documenting it for TeX Live's
cygwin distribution (if binaries are built under cygwin).

Thank you,
-- 
Elie

From taco at elvenkind.com  Thu Apr  8 14:45:10 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 08 Apr 2010 14:45:10 +0200
Subject: [Dev-luatex] [tex-live] LuaTeX cygwin build
In-Reply-To: <t2oeba574421004080531nf9873ae1u7a9d55f9da1e04f8@mail.gmail.com>
References: <t2oeba574421004080531nf9873ae1u7a9d55f9da1e04f8@mail.gmail.com>
Message-ID: <4BBDCFD6.2080404@elvenkind.com>




Hi ?lie,

You wrote:
> If I test the LuaTeX 0.60 for mingw32 that I can get on
> http://foundry.supelec.fr/gf/project/luatex/frs/, everything is doing
> fine, but if I compile my own binary under cygwin, for documents using
> a lot of big fonts, I easily run out of memory. 

Can you check whether this is because of lua garbage collection
that kicks in too slow (the most common cause of high memory usage
so far)? If this is the cause, then it should be fixable by adding

  collectgarbage('collect')

statements at key points in the lua code that loads those big fonts
(one before or after each font should do the trick). But if that
doesn't work, then I suspect something is seriously wrong with the
cygwin executable and you'll need a tool like valgrind to figure
out what is leaking and why.

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Thu Apr  8 15:10:27 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Thu, 8 Apr 2010 16:10:27 +0300
Subject: [Dev-luatex] [tex-live] LuaTeX cygwin build
In-Reply-To: <4BBDCFD6.2080404@elvenkind.com>
References: <t2oeba574421004080531nf9873ae1u7a9d55f9da1e04f8@mail.gmail.com>
	<4BBDCFD6.2080404@elvenkind.com>
Message-ID: <q2jeba574421004080610y57e92b3fsc03bc78432ef11ed@mail.gmail.com>

2010/4/8 Taco Hoekwater <taco at elvenkind.com>:
>
> Can you check whether this is because of lua garbage collection
> that kicks in too slow (the most common cause of high memory usage
> so far)? If this is the cause, then it should be fixable by adding
>
> ?collectgarbage('collect')
>
> statements at key points in the lua code that loads those big fonts
> (one before or after each font should do the trick).

This does not work, sadly...

> But if that
> doesn't work, then I suspect something is seriously wrong with the
> cygwin executable and you'll need a tool like valgrind to figure
> out what is leaking and why.

Another problem is that Valgrind is not working under cygwin... I
won't have time to inquire (especially without any appropriate tool),
so I guess the only option is to document it somewhere...

Thank you,
-- 
Elie

From root at mail.boekplan.nl  Thu Apr  8 16:25:53 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu,  8 Apr 2010 16:25:53 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100408142553.CA0E94005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3603 | oneiros | 2010-04-08 13:32:57 +0200 (Thu, 08 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w

branch -> trunk
svn merge -r 3600:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x/ .

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Apr 10 16:26:45 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 10 Apr 2010 16:26:45 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100410142645.246314005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3604 | hhenkel | 2010-04-10 12:38:42 +0200 (Sat, 10 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

pdftoepdf.cc patch that goes without xpdf nor poppler patch

------------------------------------------------------------------------
r3605 | hhenkel | 2010-04-10 12:52:23 +0200 (Sat, 10 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/Page.cc
   M /trunk/source/libs/xpdf/xpdf-3.02/xpdf/Page.h

revert local xpdf patch from 3304,
it is not needed for pdftoepdf.cc anymore.

------------------------------------------------------------------------
r3606 | taco | 2010-04-10 14:58:25 +0200 (Sat, 10 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/libs/xpdf/xpdf-3.02/xpdf/Page.cc
   M /branches/0.60.x/source/libs/xpdf/xpdf-3.02/xpdf/Page.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/image/pdftoepdf.cc

svn merge -r 3604:HEAD http://foundry.supelec.fr/svn/luatex/trunk .

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Apr 11 16:26:37 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 11 Apr 2010 16:26:37 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100411142637.7EDAD4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3607 | hhenkel | 2010-04-11 13:14:13 +0200 (Sun, 11 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

manual typo

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sun Apr 11 22:26:46 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sun, 11 Apr 2010 22:26:46 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100411202646.6D5784005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3608 | taco | 2010-04-11 17:09:19 +0200 (Sun, 11 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.w

fix the os.selfdir variable on WIN32

------------------------------------------------------------------------
r3609 | taco | 2010-04-11 17:10:43 +0200 (Sun, 11 Apr 2010) | 3 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.tex
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/luainit.w

svn merge -r 3606:HEAD http://foundry.supelec.fr/svn/luatex/trunk .


------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Apr 12 22:25:45 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 12 Apr 2010 22:25:45 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100412202545.8AA184005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3610 | taco | 2010-04-12 19:18:13 +0200 (Mon, 12 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/Makefile.in
   M /branches/0.60.x/source/texk/web2c/luatexdir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/luatexdir/am/libluatex.am
   D /branches/0.60.x/source/texk/web2c/luatexdir/am/libzzip.am
   D /branches/0.60.x/source/texk/web2c/luatexdir/am/luatangle.am
   M /branches/0.60.x/source/texk/web2c/luatexdir/am/luatex.am
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafontloader/ff-config.in

luatexdir changes from TL

------------------------------------------------------------------------

From root at mail.boekplan.nl  Tue Apr 13 12:26:51 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 13 Apr 2010 12:26:51 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100413102651.91ACD4005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3611 | oneiros | 2010-04-12 22:26:02 +0200 (Mon, 12 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/ChangeLog
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   D /trunk/source/texk/web2c/luatexdir/am/libzzip.am
   D /trunk/source/texk/web2c/luatexdir/am/luatangle.am
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am
   M /trunk/source/texk/web2c/luatexdir/luafontloader/ff-config.in

merge r3610 into trunk
svn merge -r 3609:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x/ .

------------------------------------------------------------------------
r3612 | taco | 2010-04-13 11:29:42 +0200 (Tue, 13 Apr 2010) | 4 lines
Changed paths:
   M /branches/0.60.x/build.sh
   M /branches/0.60.x/source/texk/web2c/luatexdir/dvi/dvigen.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/luafont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/texfont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/vfovf.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/writeenc.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/writefont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/writet1.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/writettf.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/writetype2.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/image/writejpg.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/image/writepng.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lang/hnjalloc.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lang/hyphen.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lang/texlang.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/limglib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/llualib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/loslibext.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/luainit.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/luastuff.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/luatex-api.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/texluac.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/macbinary.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/ocp/runocp.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfaction.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfcolorstack.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfgen.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/align.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/dumpdata.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/inputstack.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/mainbody.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/mathcodes.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/mlist.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/nesting.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/primitive.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texdeffont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texfileio.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texmath.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/texnodes.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/textcodes.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/textoken.w
   M /branches/0.60.x/source/texk/web2c/mplibdir/avl.c
   M /branches/0.60.x/source/texk/web2c/mplibdir/avl.h
   M /branches/0.60.x/source/texk/web2c/mplibdir/lmplib.c

* add --warnings=[no|min|yes|max|all] option to build.sh
* fix a bunch of compiler warnings resulting from that
* restore use of swap_items()

------------------------------------------------------------------------
r3613 | taco | 2010-04-13 11:59:11 +0200 (Tue, 13 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/mplibdir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/mplibdir/mptrap.test
   M /branches/0.60.x/source/texk/web2c/tiedir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/tiedir/tie-w2c.ch

a few updates from texlive

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Tue Apr 13 20:23:51 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Tue, 13 Apr 2010 19:23:51 +0100
Subject: [Dev-luatex] Possible issue with input from external libraries
	(page break problem?)
Message-ID: <4BC4B6B7.7050306@readytext.co.uk>

Hi Taco

I have been experimenting with external C libraries by writing
Lua bindings under Windows --- DLLs.

I have noticed something I'd like to ask about ---
to know if it is expected behavior.

When these DLLs return text I'm doing a lot of tex.write(...)
of the data returned from the DLL functions (for testing).

What I've noticed is that when the text data from the DLL calls
is output (by tex.write()) and a page break occurs in the middle
of the tex.write() outputs calls, then the text is lost across the
break.

Here I am guessing....>

It looks like if the page break machinery is called whilst the
text from the DLL is being output by tex.write() then something
temporarily "forgets??" that text data is still coming and so the
page break is losing data --- actually it looks like the incoming
tex.write() text simply carries on and falls off the page so you
lose it. Perhaps the page bbreak machinery is getting out of synch
with the tex.write() input. This is purely
guesswork and I could easily be wrong of course.

I can e-mail you (personally?) a sample PDF which is easier than trying
to explain this.

Is this something to be expected?

A minimal code example may not be that helpful  but
here is one. Here I have a binding to FreeType (I call it luatype)
and in this example it just dumps the glyph names reported
by FreeType:

\directlua {
require "luatype"
local result = 
luatype.fontname("c:/msys/1.0/trunk/build/texk/fonts/type1/lucida/LBD.PFB")
tex.print(result.glyphs) %can also say you["glyphs"], as the same thing
for k,v in pairs(result) do tex.print(v.."  "..k) end
}

Here is binding to an XML library


\directlua 0  {
require "lxp"
text = [[<note>
<to>Tove</to>
<from>Jani</from>
<heading>Reminder <urgent> yes, very</urgent></heading>
<body>Don't forget me this weekend!</body>
</note>]]
local x=0
callbacks = {

     StartElement = function (p, s)
	tex.print("Starting element: ".. "{bf " ..s.. "}" .. " call depth = ".. 
x.. "par")
x=x+1
     end,
     EndElement = function (p, s)
		x=x-1
     		tex.sprint("Finishing element: " .. "{it " ..s.. "}" ..  " call 
depth = ".. x.. "par")
     end,
     CharacterData = function (p, s)
         tex.sprint("Character data (may be white space) =  " .. "{itbf 
" ..s.. "}" .. "par")
    end}

p=lxp.new(callbacks)

}

\directlua{p:parse(text)}!.
\directlua{p:close()}


If the tex.write() from output of either DLLs goes near a page break it
"falls off the page" and gets lost.

Apologies if this is not explained very well.

Please let me know if you want a PDF sample.

All the best

Graham











From patrick at gundla.ch  Tue Apr 13 22:08:49 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 13 Apr 2010 22:08:49 +0200
Subject: [Dev-luatex] defaults for tex.linebreak()?
Message-ID: <08B85B1E-E9E4-4760-A6E9-244D8769682E@gundla.ch>

Hi (Taco),

the function tex.linebreak() is mentioned in the manual, but the defaults are not. Are the ones in the tracker item #340 still valid?

Could it be that the default value for linepenalty is not taken into account? That means: if you set \linepenalty=0 from TeX, tex.linebreak() behaves differently.

Patrick


From taco at elvenkind.com  Tue Apr 13 22:20:31 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 13 Apr 2010 22:20:31 +0200
Subject: [Dev-luatex] defaults for tex.linebreak()?
In-Reply-To: <08B85B1E-E9E4-4760-A6E9-244D8769682E@gundla.ch>
References: <08B85B1E-E9E4-4760-A6E9-244D8769682E@gundla.ch>
Message-ID: <4BC4D20F.1090707@elvenkind.com>

Patrick Gundlach wrote:
> Hi (Taco),
> 
> the function tex.linebreak() is mentioned in the manual, but the
> defaults are not. Are the ones in the tracker item #340 still valid?
> 
> Could it be that the default value for linepenalty is not taken into
> account? That means: if you set \linepenalty=0 from TeX,
> tex.linebreak() behaves differently.

It is basing itself on the current TeX state at that point in
time (at least, that is what it should do). You can look up
tex_run_linebreak() in ltexlib.c, it should be easy to follow.

From root at mail.boekplan.nl  Tue Apr 13 22:26:39 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 13 Apr 2010 22:26:39 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100413202639.92B254005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3614 | taco | 2010-04-13 18:45:00 +0200 (Tue, 13 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/Makefile.am
   M /branches/0.60.x/source/texk/web2c/Makefile.in
   M /branches/0.60.x/source/texk/web2c/configure
   M /branches/0.60.x/source/texk/web2c/configure.ac
   M /branches/0.60.x/source/texk/web2c/doc/Makefile.in
   M /branches/0.60.x/source/texk/web2c/lib/Makefile.in
   M /branches/0.60.x/source/texk/web2c/luatexdir/ChangeLog
   D /branches/0.60.x/source/texk/web2c/luatexdir/Makefile.in
   M /branches/0.60.x/source/texk/web2c/luatexdir/am/libluatex.am
   M /branches/0.60.x/source/texk/web2c/luatexdir/am/luatex.am
   M /branches/0.60.x/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c
   M /branches/0.60.x/source/texk/web2c/man/Makefile.in
   A /branches/0.60.x/source/texk/web2c/ptexdir
   A /branches/0.60.x/source/texk/web2c/ptexdir/am
   A /branches/0.60.x/source/texk/web2c/ptexdir/am/ptex.am
   A /branches/0.60.x/source/texk/web2c/ptexdir/lib
   A /branches/0.60.x/source/texk/web2c/ptexdir/lib/Makefile.in

updated files from texlive, and autoreconf

------------------------------------------------------------------------

From taco at elvenkind.com  Wed Apr 14 07:53:01 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 14 Apr 2010 07:53:01 +0200
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <4BC4B6B7.7050306@readytext.co.uk>
References: <4BC4B6B7.7050306@readytext.co.uk>
Message-ID: <4BC5583D.1040404@elvenkind.com>

Graham Douglas wrote:
> Hi Taco
> 
> I have been experimenting with external C libraries by writing
> Lua bindings under Windows --- DLLs.
> 
> I have noticed something I'd like to ask about ---
> to know if it is expected behavior.

> When these DLLs return text I'm doing a lot of tex.write(...)
> of the data returned from the DLL functions (for testing).
> 
> What I've noticed is that when the text data from the DLL calls
> is output (by tex.write()) and a page break occurs in the middle
> of the tex.write() outputs calls, then the text is lost across the
> break.

I don't think this is supposed to happen, but please send me the pdf
for a closer look and, if possible, a source to go with it that uses a
lua library that is available to me. I am on linux, but lxp should
work for me as well. I can even try to run the test under wine.

Best wishes,
Taco

From taco at elvenkind.com  Wed Apr 14 09:45:30 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 14 Apr 2010 09:45:30 +0200
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <4BC5583D.1040404@elvenkind.com>
References: <4BC4B6B7.7050306@readytext.co.uk> <4BC5583D.1040404@elvenkind.com>
Message-ID: <4BC5729A.8010308@elvenkind.com>

Hi Graham,

Taco Hoekwater wrote:
> 
> I don't think this is supposed to happen, but please send me the pdf
> for a closer look and, if possible, a source to go with it that uses a
> lua library that is available to me. I am on linux, but lxp should
> work for me as well. I can even try to run the test under wine.

I've looked at your file, and it is not related to external
libraries nor the luatex extensions at all: The problem is the 
\immediate\pdfximage.

You can get the exact same problem in pdftex with this input:

\pdfoutput=1
\immediate\pdfximage  width 0.5\hsize {./cow.pdf}
\pdfrefximage\pdflastximage
\input knuth
\input knuth
\input knuth
\input knuth
\input knuth
\input knuth
\input knuth
\bye

In both cases, the problem can be fixed by adding a \hbox around
the \pdfrefximage. But now I have a question for Hartmut: is this
supposed to happen?

Best wishes,
Taco






From root at mail.boekplan.nl  Wed Apr 14 12:26:33 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 14 Apr 2010 12:26:33 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100414102633.590814005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3615 | oneiros | 2010-04-13 23:59:59 +0200 (Tue, 13 Apr 2010) | 3 lines
Changed paths:
   M /trunk/build.sh
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.w
   M /trunk/source/texk/web2c/luatexdir/font/luafont.w
   M /trunk/source/texk/web2c/luatexdir/font/texfont.w
   M /trunk/source/texk/web2c/luatexdir/font/vfovf.w
   M /trunk/source/texk/web2c/luatexdir/font/writeenc.w
   M /trunk/source/texk/web2c/luatexdir/font/writefont.w
   M /trunk/source/texk/web2c/luatexdir/font/writet1.w
   M /trunk/source/texk/web2c/luatexdir/font/writettf.w
   M /trunk/source/texk/web2c/luatexdir/font/writetype2.w
   M /trunk/source/texk/web2c/luatexdir/image/writejpg.w
   M /trunk/source/texk/web2c/luatexdir/image/writepng.w
   M /trunk/source/texk/web2c/luatexdir/lang/hnjalloc.w
   M /trunk/source/texk/web2c/luatexdir/lang/hyphen.w
   M /trunk/source/texk/web2c/luatexdir/lang/texlang.w
   M /trunk/source/texk/web2c/luatexdir/lua/limglib.c
   M /trunk/source/texk/web2c/luatexdir/lua/llualib.c
   M /trunk/source/texk/web2c/luatexdir/lua/lnodelib.c
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/lua/ltexlib.c
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.w
   M /trunk/source/texk/web2c/luatexdir/lua/luastuff.w
   M /trunk/source/texk/web2c/luatexdir/lua/luatex-api.h
   M /trunk/source/texk/web2c/luatexdir/lua/texluac.w
   M /trunk/source/texk/web2c/luatexdir/luafontloader/fontforge/fontforge/macbinary.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ocp/runocp.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfaction.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfcolorstack.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfsetmatrix.w
   M /trunk/source/texk/web2c/luatexdir/tex/align.w
   M /trunk/source/texk/web2c/luatexdir/tex/dumpdata.h
   M /trunk/source/texk/web2c/luatexdir/tex/inputstack.w
   M /trunk/source/texk/web2c/luatexdir/tex/mainbody.h
   M /trunk/source/texk/web2c/luatexdir/tex/mathcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/mlist.w
   M /trunk/source/texk/web2c/luatexdir/tex/nesting.w
   M /trunk/source/texk/web2c/luatexdir/tex/primitive.w
   M /trunk/source/texk/web2c/luatexdir/tex/texdeffont.w
   M /trunk/source/texk/web2c/luatexdir/tex/texfileio.w
   M /trunk/source/texk/web2c/luatexdir/tex/texmath.w
   M /trunk/source/texk/web2c/luatexdir/tex/texnodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textcodes.w
   M /trunk/source/texk/web2c/luatexdir/tex/textoken.w
   M /trunk/source/texk/web2c/mplibdir/ChangeLog
   M /trunk/source/texk/web2c/mplibdir/avl.c
   M /trunk/source/texk/web2c/mplibdir/avl.h
   M /trunk/source/texk/web2c/mplibdir/lmplib.c
   M /trunk/source/texk/web2c/mplibdir/mptrap.test
   M /trunk/source/texk/web2c/tiedir/ChangeLog
   M /trunk/source/texk/web2c/tiedir/tie-w2c.ch

merge into trunk
svn merge -r 3610:HEAD http://foundry.supelec.fr/svn/luatex/branches/0.60.x/ .

------------------------------------------------------------------------
r3616 | oneiros | 2010-04-14 00:11:22 +0200 (Wed, 14 Apr 2010) | 3 lines
Changed paths:
   M /trunk

Initialized merge tracking via "svnmerge" with revisions "1-3614" from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Wed Apr 14 19:26:57 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Wed, 14 Apr 2010 18:26:57 +0100
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <4BC5729A.8010308@elvenkind.com>
References: <4BC4B6B7.7050306@readytext.co.uk> <4BC5583D.1040404@elvenkind.com>
	<4BC5729A.8010308@elvenkind.com>
Message-ID: <4BC5FAE1.50804@readytext.co.uk>

Hi Taco

Taco Hoekwater wrote:
> Hi Graham,
> 
> Taco Hoekwater wrote:
>>
>> I don't think this is supposed to happen, but please send me the pdf
>> for a closer look and, if possible, a source to go with it that uses a
>> lua library that is available to me. I am on linux, but lxp should
>> work for me as well. I can even try to run the test under wine.
> 
> I've looked at your file, and it is not related to external
> libraries nor the luatex extensions at all: The problem is the 
> \immediate\pdfximage.
> 
> You can get the exact same problem in pdftex with this input:
> 
> \pdfoutput=1
> \immediate\pdfximage  width 0.5\hsize {./cow.pdf}
> \pdfrefximage\pdflastximage
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \bye
> 
> In both cases, the problem can be fixed by adding a \hbox around
> the \pdfrefximage. But now I have a question for Hartmut: is this
> supposed to happen?
> 
> Best wishes,
> Taco
> 
>

Many thanks for your rapid diagnosis of the real issue --- never would
that have occurred to me. And apologies for pointing this initially in 
the wrong direction --- though I am pleased to read that it's nothing to 
do with libraries since that is the area I'm especially interested in
and currently exploring in detail.

Best wishes, and much respect!

Graham









From patrick at gundla.ch  Wed Apr 14 20:11:39 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 14 Apr 2010 20:11:39 +0200
Subject: [Dev-luatex] defaults for tex.linebreak()?
In-Reply-To: <4BC4D20F.1090707@elvenkind.com>
References: <08B85B1E-E9E4-4760-A6E9-244D8769682E@gundla.ch>
	<4BC4D20F.1090707@elvenkind.com>
Message-ID: <DDC438CF-3CB5-400E-8EF0-FE233C5AF6C8@gundla.ch>



> You can look up
> tex_run_linebreak() in ltexlib.c, it should be easy to follow.

Yes, absolutely. Thanks for the pointer!

Patrick


From pragma at wxs.nl  Wed Apr 14 20:22:20 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 14 Apr 2010 20:22:20 +0200
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <4BC5729A.8010308@elvenkind.com>
References: <4BC4B6B7.7050306@readytext.co.uk> <4BC5583D.1040404@elvenkind.com>
	<4BC5729A.8010308@elvenkind.com>
Message-ID: <4BC607DC.3080403@wxs.nl>

On 14-4-2010 9:45, Taco Hoekwater wrote:
> Hi Graham,
>
> Taco Hoekwater wrote:
>>
>> I don't think this is supposed to happen, but please send me the pdf
>> for a closer look and, if possible, a source to go with it that uses a
>> lua library that is available to me. I am on linux, but lxp should
>> work for me as well. I can even try to run the test under wine.
>
> I've looked at your file, and it is not related to external
> libraries nor the luatex extensions at all: The problem is the
> \immediate\pdfximage.
>
> You can get the exact same problem in pdftex with this input:
>
> \pdfoutput=1
> \immediate\pdfximage width 0.5\hsize {./cow.pdf}
> \pdfrefximage\pdflastximage
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \input knuth
> \bye
>
> In both cases, the problem can be fixed by adding a \hbox around
> the \pdfrefximage. But now I have a question for Hartmut: is this
> supposed to happen?

definitely looks like a bug to me

\setuppapersize[A4][A1] \setuplayout[location=middle,marking=on]

\starttext

\immediate\pdfximage  width 0.5\hsize {./cow.pdf}
\dorecurse {3}{\pdfrefximage\pdflastximage}
\dorecurse{10}{\the\pagetotal\input knuth \par}

\stoptext

the ref'd image whatsit is added to the mvl but the height is not added 
to pagetotal (at least that's what it looks like) due the fact that no 
paragraph is started

i assume that this bug went unnoticed as macropackages put such material 
normally in a box

i'm not sure if it's the parbuilder or the page builder .. another test:

\dorecurse {5}{\pdfrefximage\pdflastximage x\par}

(i can do some more testing tommorrow)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From hartmut_henkel at gmx.de  Wed Apr 14 20:58:40 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed, 14 Apr 2010 20:58:40 +0200 (CEST)
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <4BC607DC.3080403@wxs.nl>
References: <4BC4B6B7.7050306@readytext.co.uk> <4BC5583D.1040404@elvenkind.com>
	<4BC5729A.8010308@elvenkind.com> <4BC607DC.3080403@wxs.nl>
Message-ID: <alpine.DEB.1.00.1004142056400.9207@hahepc1.hahe>

On Wed, 14 Apr 2010, Hans Hagen wrote:
> On 14-4-2010 9:45, Taco Hoekwater wrote:
> > Taco Hoekwater wrote:
> > >
> > > I don't think this is supposed to happen, but please send me the
> > > pdf for a closer look and, if possible, a source to go with it
> > > that uses a lua library that is available to me. I am on linux,
> > > but lxp should work for me as well. I can even try to run the test
> > > under wine.
> >
> > I've looked at your file, and it is not related to external
> > libraries nor the luatex extensions at all: The problem is the
> > \immediate\pdfximage.
> >
> > You can get the exact same problem in pdftex with this input:
> >
> > \pdfoutput=1
> > \immediate\pdfximage width 0.5\hsize {./cow.pdf}
> > \pdfrefximage\pdflastximage
> > \input knuth
> > \input knuth
> > \input knuth
> > \input knuth
> > \input knuth
> > \input knuth
> > \input knuth
> > \bye
> >
> > In both cases, the problem can be fixed by adding a \hbox around the
> > \pdfrefximage. But now I have a question for Hartmut: is this
> > supposed to happen?
>
> definitely looks like a bug to me
>
> \setuppapersize[A4][A1] \setuplayout[location=middle,marking=on]
>
> \starttext
>
> \immediate\pdfximage  width 0.5\hsize {./cow.pdf}
> \dorecurse {3}{\pdfrefximage\pdflastximage}
> \dorecurse{10}{\the\pagetotal\input knuth \par}
>
> \stoptext
>
> the ref'd image whatsit is added to the mvl but the height is not
> added to pagetotal (at least that's what it looks like) due the fact
> that no paragraph is started

but it is so since ancient pdftex times (and i have also stumbled over
it, and since then i'm wrapping \pdfrefximage in a \hbox, as you
suggest). The \pdfrefximage doesn't do any h or v mode change, it's
neutral. And i guess one should keep it like this to avoid
incompatibilities.

Regards, Hartmut


From pragma at wxs.nl  Wed Apr 14 21:46:46 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 14 Apr 2010 21:46:46 +0200
Subject: [Dev-luatex] Possible issue with input from external libraries
 (page break problem?)
In-Reply-To: <alpine.DEB.1.00.1004142056400.9207@hahepc1.hahe>
References: <4BC4B6B7.7050306@readytext.co.uk> <4BC5583D.1040404@elvenkind.com>
	<4BC5729A.8010308@elvenkind.com> <4BC607DC.3080403@wxs.nl>
	<alpine.DEB.1.00.1004142056400.9207@hahepc1.hahe>
Message-ID: <4BC61BA6.5000102@wxs.nl>

On 14-4-2010 8:58, Hartmut Henkel wrote:

> but it is so since ancient pdftex times (and i have also stumbled over
> it, and since then i'm wrapping \pdfrefximage in a \hbox, as you
> suggest). The \pdfrefximage doesn't do any h or v mode change, it's
> neutral. And i guess one should keep it like this to avoid
> incompatibilities.

indeed, and i can imagine the why, but i can also imagine that in luatex 
we wrap it in an hbox as we're not bound to compatibility in luatex; it 
can even be conditional: if in hmode then no wrapping, else wrap it in 
an hbox; alternatively when issues in vmode we couldl set a flag that 
indicates that in the backend the image is lapped up (tlap) so that the 
effective height in the page stream is zero (actually that would be the 
cleanest solution as something similar happens with annotations)

a comparison with specials is not right as specials are not looked at 
this way

for pdftex i can imagine that a warning is issued, something:

"injecting whatsit node with dimensions into a vertical list; this 
confuses the page builder"

or something like that

actually, it's a problem with all whatsits that cary dimensions so when 
we're further along the luatex road we can consider a special kind of 
hlist subtype for this kind of things

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at mail.boekplan.nl  Thu Apr 15 12:26:28 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 15 Apr 2010 12:26:28 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100415102628.5F07B4005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3617 | hhenkel | 2010-04-15 01:09:24 +0200 (Thu, 15 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

fix "\input tikz hello \bye" bug, plus fix one sign error

------------------------------------------------------------------------
r3618 | taco | 2010-04-15 07:54:45 +0200 (Thu, 15 Apr 2010) | 3 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/lpdflib.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfgen.w

svn merge -r 3616:HEAD http://foundry.supelec.fr/svn/luatex/trunk


------------------------------------------------------------------------
r3619 | taco | 2010-04-15 08:26:21 +0200 (Thu, 15 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdflistout.w

updates from TL

------------------------------------------------------------------------

From t34www at googlemail.com  Thu Apr 15 15:57:26 2010
From: t34www at googlemail.com (T T)
Date: Thu, 15 Apr 2010 14:57:26 +0100
Subject: [Dev-luatex] running scripts from UNC paths
Message-ID: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>

Hi,

I've noticed an odd thing with texlua on Windows, here's the code and
output illistrating it. The test script arg0test.lua is a simple
one-liner:

  print(unpack(arg, 0))

Call with no arguments (note the conversion of \ to /):

  $ texlua H:\DEV\scratch\arg0test.lua
  H:/DEV/scratch/arg0test.lua

Call with arguments (no conversion this time):

  $ texlua H:\DEV\scratch\arg0test.lua arg1
  H:\DEV\scratch\arg0test.lua     arg1

Call with full UNC path (the same behaviour for call with arguments):

  $ texlua \\.\H:\DEV\scratch\arg0test.lua
  No script file given

There is something weird going on with this conversion of \ to /, but
this not so important.  What I don't understand is why it fails for
UNC path (there is no problem to do for example
dofile([[\\.\H:\DEV\scratch\arg0test.lua]]) from within the script).

Cheers,

Tomek

From pragma at wxs.nl  Thu Apr 15 16:09:08 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 15 Apr 2010 16:09:08 +0200
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
Message-ID: <4BC71E04.4040705@wxs.nl>

On 15-4-2010 3:57, T T wrote:

>    $ texlua \\.\H:\DEV\scratch\arg0test.lua
>    No script file given


puting something in front of a drive specification is wrong anyway i 
think, just try

dir ".\c:"



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Apr 15 16:31:21 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Apr 2010 16:31:21 +0200
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
Message-ID: <4BC72339.20101@elvenkind.com>

T T wrote:
> 
>   $ texlua \\.\H:\DEV\scratch\arg0test.lua
>   No script file given

There is a stat() test in luainit.w (the is_readable macro)
which probably fails for UNC files. I can try a patch, but it
would be better if a true windows user would do so
(I can guess but not test).

Best wishes,
Taco

From t34www at googlemail.com  Thu Apr 15 16:34:16 2010
From: t34www at googlemail.com (T T)
Date: Thu, 15 Apr 2010 15:34:16 +0100
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <4BC71E04.4040705@wxs.nl>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
	<4BC71E04.4040705@wxs.nl>
Message-ID: <t2ge7fba2611004150734q3ea8cb19w5ab12ea85ab1ff43@mail.gmail.com>

On 15 April 2010 15:09, Hans Hagen <pragma at wxs.nl> wrote:
> On 15-4-2010 3:57, T T wrote:
>
>> ? $ texlua \\.\H:\DEV\scratch\arg0test.lua
>> ? No script file given
>
>
> puting something in front of a drive specification is wrong anyway i think,
> just try
>
> dir ".\c:"

It should be dir "\\.\c:\" and it works just fine. See also:

http://msdn.microsoft.com/en-us/library/aa365247(VS.85).aspx#namespaces

The UNC syntax is used to access network drives on Windows like so:

  \\ComputerName\SharedFolder\Resource

Stock Lua does not have any problem with UNC paths, so this looks like
a bug in luatex but I couldn't locate it in the sources so far.

Cheers,

Tomek

From t34www at googlemail.com  Thu Apr 15 17:26:39 2010
From: t34www at googlemail.com (T T)
Date: Thu, 15 Apr 2010 16:26:39 +0100
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <4BC72339.20101@elvenkind.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
	<4BC72339.20101@elvenkind.com>
Message-ID: <q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>

On 15 April 2010 15:31, Taco Hoekwater <taco at elvenkind.com> wrote:
> T T wrote:
>>
>> ?$ texlua \\.\H:\DEV\scratch\arg0test.lua
>> ?No script file given
>
> There is a stat() test in luainit.w (the is_readable macro)
> which probably fails for UNC files. I can try a patch, but it
> would be better if a true windows user would do so
> (I can guess but not test).

I can try to patch it but stat() does not seem to be the problem. I've
made a quick test and stat() seems to work OK on UNC paths (gcc &
tcc). I suspect there may be some file parsing doing on but I don't
see where.

I should mention that I tested with TL's texlua
(beta-0.40.6-2009110118) but I get the same with
beta-0.52.0-2010031700 (rev 3515).

Cheers,

Tomek

From taco at elvenkind.com  Thu Apr 15 17:34:18 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Apr 2010 17:34:18 +0200
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>	
	<4BC72339.20101@elvenkind.com>
	<q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>
Message-ID: <4BC731FA.3080509@elvenkind.com>

T T wrote:
> On 15 April 2010 15:31, Taco Hoekwater <taco at elvenkind.com> wrote:
>> T T wrote:
>>>  $ texlua \\.\H:\DEV\scratch\arg0test.lua
>>>  No script file given
>> There is a stat() test in luainit.w (the is_readable macro)
>> which probably fails for UNC files. I can try a patch, but it
>> would be better if a true windows user would do so
>> (I can guess but not test).
> 
> I can try to patch it but stat() does not seem to be the problem. I've
> made a quick test and stat() seems to work OK on UNC paths (gcc &
> tcc). I suspect there may be some file parsing doing on but I don't
> see where.
> 
> I should mention that I tested with TL's texlua
> (beta-0.40.6-2009110118) but I get the same with
> beta-0.52.0-2010031700 (rev 3515).

Or any other older version, I'm sure. All commandline related stuff
is in luainit.w, I think.

And now I suddenly see what is going wrong: your backslash is
intercepted by the code that looks for "luatex \\relax ...".



Best wishes,
Taco

From t34www at googlemail.com  Thu Apr 15 18:12:11 2010
From: t34www at googlemail.com (T T)
Date: Thu, 15 Apr 2010 17:12:11 +0100
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <4BC731FA.3080509@elvenkind.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
	<4BC72339.20101@elvenkind.com>
	<q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>
	<4BC731FA.3080509@elvenkind.com>
Message-ID: <w2we7fba2611004150912ia8c6bf94qf76820399c2d304c@mail.gmail.com>

On 15 April 2010 16:34, Taco Hoekwater <taco at elvenkind.com> wrote:
>
> Or any other older version, I'm sure. All commandline related stuff
> is in luainit.w, I think.

I probably need to svn up, because I can only find luainit.c, no luainit.w.

> And now I suddenly see what is going wrong: your backslash is
> intercepted by the code that looks for "luatex \\relax ...".

OK, you will probably know how to fix this better than I do (still
can't find that in the code).

Another question (two actually). In ex_selfdir function in luainit.c
you derive derive the directory of the executable from argv[0] using
SearchPath(). Is this intended (argv[0] might not correspond to the
actual executable) or are you actually after the real path of the
executable (in which case GetModuleFileName() should be used)?

The second question is what is this path used used for?  It is exposed
on the Lua side through os.selfdir, but this is not documented, so I
wonder if one can rely on it or if it is some internal thing.

Cheers,

Tomek

From taco at elvenkind.com  Thu Apr 15 18:18:32 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Apr 2010 18:18:32 +0200
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <w2we7fba2611004150912ia8c6bf94qf76820399c2d304c@mail.gmail.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>	
	<4BC72339.20101@elvenkind.com>	
	<q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>	
	<4BC731FA.3080509@elvenkind.com>
	<w2we7fba2611004150912ia8c6bf94qf76820399c2d304c@mail.gmail.com>
Message-ID: <4BC73C58.40107@elvenkind.com>

T T wrote:
> On 15 April 2010 16:34, Taco Hoekwater <taco at elvenkind.com> wrote:
>> Or any other older version, I'm sure. All commandline related stuff
>> is in luainit.w, I think.
> 
> I probably need to svn up, because I can only find luainit.c, no luainit.w.
> 
>> And now I suddenly see what is going wrong: your backslash is
>> intercepted by the code that looks for "luatex \\relax ...".
> 
> OK, you will probably know how to fix this better than I do (still
> can't find that in the code).

Should be fixed by #3621 (in branches/0.60.x/, so far) please try
it out.

> Another question (two actually). In ex_selfdir function in luainit.c
> you derive derive the directory of the executable from argv[0] using
> SearchPath(). Is this intended (argv[0] might not correspond to the
> actual executable) or are you actually after the real path of the
> executable (in which case GetModuleFileName() should be used)?

This is most probably on purpose. I inherited the current code from
kpathsea, and I think it makes sense to do what kpathsea does in case
someone wants to replace kpathsea by lua code (like Hans does).

> The second question is what is this path used used for?  It is exposed
> on the Lua side through os.selfdir, but this is not documented, so I
> wonder if one can rely on it or if it is some internal thing.

os.selfdir should have been documented already, it has slipped
through the cracks somehow. I'll fix the manual.

Best wishes,
Taco




From t34www at googlemail.com  Thu Apr 15 18:46:17 2010
From: t34www at googlemail.com (T T)
Date: Thu, 15 Apr 2010 17:46:17 +0100
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <4BC73C58.40107@elvenkind.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
	<4BC72339.20101@elvenkind.com>
	<q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>
	<4BC731FA.3080509@elvenkind.com>
	<w2we7fba2611004150912ia8c6bf94qf76820399c2d304c@mail.gmail.com>
	<4BC73C58.40107@elvenkind.com>
Message-ID: <n2oe7fba2611004150946k4acb9e85t8f2acc8e9804cab8@mail.gmail.com>

On 15 April 2010 17:18, Taco Hoekwater <taco at elvenkind.com> wrote:
> T T wrote:
>>
>> On 15 April 2010 16:34, Taco Hoekwater <taco at elvenkind.com> wrote:
>>>
>>> Or any other older version, I'm sure. All commandline related stuff
>>> is in luainit.w, I think.
>>
>> I probably need to svn up, because I can only find luainit.c, no
>> luainit.w.
>>
>>> And now I suddenly see what is going wrong: your backslash is
>>> intercepted by the code that looks for "luatex \\relax ...".
>>
>> OK, you will probably know how to fix this better than I do (still
>> can't find that in the code).
>
> Should be fixed by #3621 (in branches/0.60.x/, so far) please try
> it out.

Thanks, I'll try to try and report back (I need to checkout the branch first).

>> Another question (two actually). In ex_selfdir function in luainit.c
>> you derive derive the directory of the executable from argv[0] using
>> SearchPath(). Is this intended (argv[0] might not correspond to the
>> actual executable) or are you actually after the real path of the
>> executable (in which case GetModuleFileName() should be used)?
>
> This is most probably on purpose. I inherited the current code from
> kpathsea, and I think it makes sense to do what kpathsea does in case
> someone wants to replace kpathsea by lua code (like Hans does).


From root at mail.boekplan.nl  Thu Apr 15 22:25:41 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 15 Apr 2010 22:25:41 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100415202541.366884005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3620 | taco | 2010-04-15 16:43:11 +0200 (Thu, 15 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/ChangeLog
   M /branches/0.60.x/source/texk/web2c/Makefile.am
   M /branches/0.60.x/source/texk/web2c/Makefile.in
   M /branches/0.60.x/source/texk/web2c/aclocal.m4
   M /branches/0.60.x/source/texk/web2c/c-auto.in
   M /branches/0.60.x/source/texk/web2c/configure
   M /branches/0.60.x/source/texk/web2c/configure.ac
   M /branches/0.60.x/source/texk/web2c/doc/Makefile.in
   M /branches/0.60.x/source/texk/web2c/lib/Makefile.in
   M /branches/0.60.x/source/texk/web2c/man/Makefile.in

new configure.ac/c-auto.in/Makefile.am from  TL + autoreconf

------------------------------------------------------------------------
r3621 | taco | 2010-04-15 18:08:22 +0200 (Thu, 15 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/luainit.w

fix handling of lua files with UNC names (hopefully)

------------------------------------------------------------------------
r3622 | taco | 2010-04-15 18:19:37 +0200 (Thu, 15 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.pdf
   M /branches/0.60.x/manual/luatexref-t.tex

document os.selfdir

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr 16 12:26:26 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 16 Apr 2010 12:26:26 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100416102626.94CE54005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3623 | oneiros | 2010-04-16 10:46:31 +0200 (Fri, 16 Apr 2010) | 9 lines
Changed paths:
   M /trunk

Recorded merge of revisions 3618 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3618 | taco | 2010-04-15 07:54:45 +0200 (Do, 15 Apr 2010) | 3 lines
  
  svn merge -r 3616:HEAD http://foundry.supelec.fr/svn/luatex/trunk
........

------------------------------------------------------------------------
r3624 | taco | 2010-04-16 11:29:37 +0200 (Fri, 16 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.pdf
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/ChangeLog
   M /trunk/source/texk/web2c/Makefile.am
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/aclocal.m4
   M /trunk/source/texk/web2c/c-auto.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac
   M /trunk/source/texk/web2c/doc/Makefile.in
   M /trunk/source/texk/web2c/lib/Makefile.in
   M /trunk/source/texk/web2c/luatexdir/lua/luainit.w
   M /trunk/source/texk/web2c/man/Makefile.in

merge -r r3619:HEAD from branches/0.60.x

------------------------------------------------------------------------
r3625 | taco | 2010-04-16 11:35:28 +0200 (Fri, 16 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/ChangeLog
   M /trunk/source/texk/web2c/luatexdir/luatex.c

rest of tl merge

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr 16 22:25:38 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 16 Apr 2010 22:25:38 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100416202538.61FAD4005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3626 | oneiros | 2010-04-16 16:19:32 +0200 (Fri, 16 Apr 2010) | 21 lines
Changed paths:
   M /trunk

Recorded merge of revisions 3619-3622 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3619 | taco | 2010-04-15 08:26:21 +0200 (Do, 15 Apr 2010) | 2 lines
  
  updates from TL
........
  r3620 | taco | 2010-04-15 16:43:11 +0200 (Do, 15 Apr 2010) | 2 lines
  
  new configure.ac/c-auto.in/Makefile.am from  TL + autoreconf
........
  r3621 | taco | 2010-04-15 18:08:22 +0200 (Do, 15 Apr 2010) | 2 lines
  
  fix handling of lua files with UNC names (hopefully)
........
  r3622 | taco | 2010-04-15 18:19:37 +0200 (Do, 15 Apr 2010) | 2 lines
  
  document os.selfdir
........

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Apr 17 12:26:36 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 17 Apr 2010 12:26:36 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100417102636.72DEF4005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3627 | taco | 2010-04-17 07:46:25 +0200 (Sat, 17 Apr 2010) | 2 lines
Changed paths:
   A /trunk/source/texk/web2c/ptexdir
   A /trunk/source/texk/web2c/ptexdir/am
   A /trunk/source/texk/web2c/ptexdir/am/ptex.am
   A /trunk/source/texk/web2c/ptexdir/lib
   A /trunk/source/texk/web2c/ptexdir/lib/Makefile.in

ptexdir files

------------------------------------------------------------------------
r3628 | taco | 2010-04-17 08:00:53 +0200 (Sat, 17 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/build.sh

add an extra linker switch to allow win32 exes to use 3G instead of 2G of virtual memory

------------------------------------------------------------------------
r3629 | hhenkel | 2010-04-17 08:24:41 +0200 (Sat, 17 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/pdf/pdffont.w
   M /trunk/source/texk/web2c/luatexdir/pdf/pdfgen.w

clean up addto_page_resources()

------------------------------------------------------------------------

From graham.douglas at readytext.co.uk  Sun Apr 18 21:48:53 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Sun, 18 Apr 2010 20:48:53 +0100
Subject: [Dev-luatex] In need of some catcode wizardry...
Message-ID: <4BCB6225.4070600@readytext.co.uk>

Hi All


I hope it's OK to ask this here. I've implemented a Windows version of 
the Directory Iterator as described in "Programming in  Lua"

http://www.lua.org/pil/29.1.html

and can call it with code like this

\directlua{
require "luadir"
for fname in luadir.dir("directory") do tex.print(fname) end
}

(luadir is an add-in DLL)

where "directory" is a path and fname is the returned filename.

fname can contain special characters so naturally, I am having catcode 
problems since I'm not using ConTeXt which provides a lot of tools to 
deal with catcodes etc when running directlua. I'm using a version of 
plain to run this.

So, would anyone have time to suggest the best way to
set this up so that I can run this to resolve the catcode issues --- in 
the directory names and the returned file names?

I know that tex.print can take a catcode table number
but I'm not sure how to best set it up.

An example using \catcodetable 16-bit number
and how to use + save the catcode table would
be very welcome.

Thanks in advance

Graham



From patrick at gundla.ch  Sun Apr 18 22:01:11 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 18 Apr 2010 22:01:11 +0200
Subject: [Dev-luatex] In need of some catcode wizardry...
In-Reply-To: <4BCB6225.4070600@readytext.co.uk>
References: <4BCB6225.4070600@readytext.co.uk>
Message-ID: <5397D751-A892-469B-B50B-0D2C52946D03@gundla.ch>

Hi Graham,

try tex.print(-2,fname). -2 is a "safe" catcode table.

If you want to make sure that in 'luadir.dir("directory")' you don't have problems with catcodes, you should move this part to a separate lua file and include that with dofile("myfile.lua"). Then there are no cat code problems while interpreting this file.

Hope this helps,

Patrick



From graham.douglas at readytext.co.uk  Sun Apr 18 22:13:25 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Sun, 18 Apr 2010 21:13:25 +0100
Subject: [Dev-luatex] In need of some catcode wizardry...
In-Reply-To: <5397D751-A892-469B-B50B-0D2C52946D03@gundla.ch>
References: <5397D751-A892-469B-B50B-0D2C52946D03@gundla.ch>
Message-ID: <4BCB67E5.9040900@readytext.co.uk>

Hi Patrick

"try tex.print(-2,fname). -2 is a "safe" catcode table."

Yes, perfect thank you :-)

---> I just slapped myself very hard... sigh, reading the manual
properly would have told me that... I had been trying 
tex.print(fname,-2) ==> I must get some new glasses ... DOH++

Thanks again Patrick

Warm wishes

Graham


From pragma at wxs.nl  Sun Apr 18 22:31:50 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 18 Apr 2010 22:31:50 +0200
Subject: [Dev-luatex] In need of some catcode wizardry...
In-Reply-To: <4BCB67E5.9040900@readytext.co.uk>
References: <5397D751-A892-469B-B50B-0D2C52946D03@gundla.ch>
	<4BCB67E5.9040900@readytext.co.uk>
Message-ID: <4BCB6C36.5080703@wxs.nl>

On 18-4-2010 10:13, Graham Douglas wrote:
> Hi Patrick
>
> "try tex.print(-2,fname). -2 is a "safe" catcode table."
>
> Yes, perfect thank you :-)
>
> ---> I just slapped myself very hard... sigh, reading the manual
> properly would have told me that... I had been trying
> tex.print(fname,-2) ==> I must get some new glasses ... DOH++

tex.write is also quite ok for this (and faster too although no one will 
notice that i guess)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Sun Apr 18 22:52:04 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 18 Apr 2010 22:52:04 +0200
Subject: [Dev-luatex] In need of some catcode wizardry...
In-Reply-To: <4BCB6225.4070600@readytext.co.uk>
References: <4BCB6225.4070600@readytext.co.uk>
Message-ID: <399CFCBF-8670-4768-AD01-FBC5AEA114B5@gundla.ch>

> An example using \catcodetable 16-bit number
> and how to use + save the catcode table would
> be very welcome.

Before I switched completely to "nodelist based typesetting" I used a special catcode table. As I am no TeX expert at all (I always fight with catcodes), there are probably mistakes or room for improvement in the following code:


\begingroup
\catcode`\^= 12
\catcode`\$= 12
\catcode`\_= 12
\catcode`\{=12
\catcode`\}=12
\catcode`\%=12
\catcode`\&=12
\catcode`\~=12
\catcode`\#=12
\catcode`\?=0
\catcode`\\=12
?savecatcodetable1
?endgroup

This made all characters harmless except for ?, the new escape character. So, this is an example, but don't take this as "the way to go".

Patrick


From root at mail.boekplan.nl  Mon Apr 19 22:25:41 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 19 Apr 2010 22:25:41 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100419202541.D260C40060@mail.boekplan.nl>

------------------------------------------------------------------------
r3630 | taco | 2010-04-19 20:52:02 +0200 (Mon, 19 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

we don't need to load texmfmp-help.h

------------------------------------------------------------------------
r3631 | taco | 2010-04-19 20:56:34 +0200 (Mon, 19 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

remove externs, add actual headers

------------------------------------------------------------------------
r3632 | oneiros | 2010-04-19 21:02:41 +0200 (Mon, 19 Apr 2010) | 17 lines
Changed paths:
   M /trunk
   M /trunk/build.sh
   M /trunk/source/texk/web2c/luatexdir/luatex.c

Merged revisions 3628,3630-3631 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3628 | taco | 2010-04-17 08:00:53 +0200 (Sa, 17 Apr 2010) | 2 lines
  
  add an extra linker switch to allow win32 exes to use 3G instead of 2G of virtual memory
........
  r3630 | taco | 2010-04-19 20:52:02 +0200 (Mo, 19 Apr 2010) | 2 lines
  
  we don't need to load texmfmp-help.h
........
  r3631 | taco | 2010-04-19 20:56:34 +0200 (Mo, 19 Apr 2010) | 2 lines
  
  remove externs, add actual headers
........

------------------------------------------------------------------------
r3633 | taco | 2010-04-19 21:03:59 +0200 (Mon, 19 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.h

no need to keep the mainbody alias anymore

------------------------------------------------------------------------
r3634 | taco | 2010-04-19 21:52:48 +0200 (Mon, 19 Apr 2010) | 3 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/texfont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/font/tfmofm.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/loslibext.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/ptexlib.h

* include lib/lib.h instead of declaring setupboundvariable
* add a few initializations to suppress warnings

------------------------------------------------------------------------
r3635 | oneiros | 2010-04-19 22:07:44 +0200 (Mon, 19 Apr 2010) | 14 lines
Changed paths:
   M /trunk
   M /trunk/source/texk/web2c/luatexdir/font/texfont.w
   M /trunk/source/texk/web2c/luatexdir/font/tfmofm.w
   M /trunk/source/texk/web2c/luatexdir/lua/loslibext.c
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/luatex.h
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h

Merged revisions 3633-3634 via svnmerge from 
http://foundry.supelec.fr/svn/luatex/branches/0.60.x

........
  r3633 | taco | 2010-04-19 21:03:59 +0200 (Mo, 19 Apr 2010) | 2 lines
  
  no need to keep the mainbody alias anymore
........
  r3634 | taco | 2010-04-19 21:52:48 +0200 (Mo, 19 Apr 2010) | 3 lines
  
  * include lib/lib.h instead of declaring setupboundvariable
  * add a few initializations to suppress warnings
........

------------------------------------------------------------------------

From root at mail.boekplan.nl  Tue Apr 20 16:25:52 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 20 Apr 2010 16:25:52 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100420142552.B88584005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3636 | taco | 2010-04-20 15:31:45 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/build.sh
   M /branches/0.60.x/source/ChangeLog
   M /branches/0.60.x/source/Makefile.am
   M /branches/0.60.x/source/Makefile.in
   M /branches/0.60.x/source/README.config
   M /branches/0.60.x/source/aclocal.m4
   M /branches/0.60.x/source/auxdir/auxsub/Makefile.in
   M /branches/0.60.x/source/auxdir/auxsub/aclocal.m4
   M /branches/0.60.x/source/build-aux/config.guess
   M /branches/0.60.x/source/build-aux/config.sub
   M /branches/0.60.x/source/build-aux/texinfo.tex
   M /branches/0.60.x/source/configure
   M /branches/0.60.x/source/configure.ac
   M /branches/0.60.x/source/libs/Makefile.in
   M /branches/0.60.x/source/libs/aclocal.m4
   M /branches/0.60.x/source/libs/configure
   M /branches/0.60.x/source/libs/libpng/Makefile.in
   M /branches/0.60.x/source/libs/libpng/aclocal.m4
   M /branches/0.60.x/source/libs/libpng/include/Makefile.in
   M /branches/0.60.x/source/libs/obsdcompat/Makefile.in
   M /branches/0.60.x/source/libs/obsdcompat/aclocal.m4
   M /branches/0.60.x/source/libs/xpdf/Makefile.in
   M /branches/0.60.x/source/libs/xpdf/aclocal.m4
   M /branches/0.60.x/source/libs/xpdf/fofi/Makefile.in
   M /branches/0.60.x/source/libs/xpdf/goo/Makefile.in
   M /branches/0.60.x/source/libs/xpdf/xpdf/Makefile.in
   M /branches/0.60.x/source/libs/zlib/Makefile.in
   M /branches/0.60.x/source/libs/zlib/aclocal.m4
   M /branches/0.60.x/source/libs/zlib/include/Makefile.in
   M /branches/0.60.x/source/libs/zziplib/Makefile.in
   M /branches/0.60.x/source/libs/zziplib/aclocal.m4
   M /branches/0.60.x/source/libs/zziplib/autom4te.cache/output.1
   M /branches/0.60.x/source/libs/zziplib/autom4te.cache/requests
   M /branches/0.60.x/source/libs/zziplib/autom4te.cache/traces.1
   M /branches/0.60.x/source/libs/zziplib/include/zzip/Makefile.in
   D /branches/0.60.x/source/m4/cho-kpse.m4
   M /branches/0.60.x/source/m4/kpse-common.m4
   M /branches/0.60.x/source/m4/kpse-icu-flags.m4
   M /branches/0.60.x/source/m4/kpse-kpathsea-flags.m4
   M /branches/0.60.x/source/m4/kpse-lt-hack.m4
   M /branches/0.60.x/source/m4/kpse-pkgs.m4
   A /branches/0.60.x/source/m4/kpse-ptexenc-flags.m4
   M /branches/0.60.x/source/m4/kpse-setup.m4
   D /branches/0.60.x/source/m4/maw-time.m4
   M /branches/0.60.x/source/texk/ChangeLog
   M /branches/0.60.x/source/texk/Makefile.in
   M /branches/0.60.x/source/texk/README
   M /branches/0.60.x/source/texk/aclocal.m4
   M /branches/0.60.x/source/texk/configure
   M /branches/0.60.x/source/texk/kpathsea/ChangeLog
   D /branches/0.60.x/source/texk/kpathsea/HIER
   D /branches/0.60.x/source/texk/kpathsea/INSTALL
   M /branches/0.60.x/source/texk/kpathsea/Makefile.am
   M /branches/0.60.x/source/texk/kpathsea/Makefile.in
   M /branches/0.60.x/source/texk/kpathsea/ac/withenable.ac
   M /branches/0.60.x/source/texk/kpathsea/aclocal.m4
   A /branches/0.60.x/source/texk/kpathsea/bsnl.awk
   M /branches/0.60.x/source/texk/kpathsea/c-auto.in
   M /branches/0.60.x/source/texk/kpathsea/c-pathmx.h
   M /branches/0.60.x/source/texk/kpathsea/configure
   M /branches/0.60.x/source/texk/kpathsea/configure.ac
   D /branches/0.60.x/source/texk/kpathsea/configure.in.orig
   M /branches/0.60.x/source/texk/kpathsea/doc/Makefile.in
   M /branches/0.60.x/source/texk/kpathsea/doc/kpathsea.info
   M /branches/0.60.x/source/texk/kpathsea/doc/kpathsea.texi
   M /branches/0.60.x/source/texk/kpathsea/getopt.c
   M /branches/0.60.x/source/texk/kpathsea/getopt1.c
   D /branches/0.60.x/source/texk/kpathsea/kpathsea.h
   M /branches/0.60.x/source/texk/kpathsea/kpsewhich.c
   M /branches/0.60.x/source/texk/kpathsea/lib.h
   M /branches/0.60.x/source/texk/kpathsea/man/Makefile.in
   M /branches/0.60.x/source/texk/kpathsea/man/kpseaccess.man
   M /branches/0.60.x/source/texk/kpathsea/man/kpsestat.man
   M /branches/0.60.x/source/texk/kpathsea/man/mktexpk.man
   M /branches/0.60.x/source/texk/kpathsea/man/mktextfm.man
   M /branches/0.60.x/source/texk/kpathsea/progname.c
   M /branches/0.60.x/source/texk/kpathsea/progname.h
   M /branches/0.60.x/source/texk/kpathsea/tex-file.c
   M /branches/0.60.x/source/texk/kpathsea/texmf.cnf
   M /branches/0.60.x/source/texk/kpathsea/types.h
   M /branches/0.60.x/source/texk/kpathsea/win32lib.h
   M /branches/0.60.x/source/texk/kpathsea/xcalloc.c
   M /branches/0.60.x/source/texk/kpathsea/xmalloc.c
   M /branches/0.60.x/source/texk/kpathsea/xrealloc.c
   M /branches/0.60.x/source/texk/web2c/ChangeLog
   M /branches/0.60.x/source/texk/web2c/Makefile.am
   M /branches/0.60.x/source/texk/web2c/Makefile.in
   M /branches/0.60.x/source/texk/web2c/ac/web2c.ac
   M /branches/0.60.x/source/texk/web2c/aclocal.m4
   M /branches/0.60.x/source/texk/web2c/am/cweb.am
   M /branches/0.60.x/source/texk/web2c/am/web.am
   M /branches/0.60.x/source/texk/web2c/c-auto.in
   D /branches/0.60.x/source/texk/web2c/cftests/lcftest.p
   M /branches/0.60.x/source/texk/web2c/configure
   M /branches/0.60.x/source/texk/web2c/configure.ac
   M /branches/0.60.x/source/texk/web2c/cpascal.h
   M /branches/0.60.x/source/texk/web2c/ctangleboot-sh.in
   M /branches/0.60.x/source/texk/web2c/ctiedir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/ctiedir/ctie-k.ch
   M /branches/0.60.x/source/texk/web2c/cwebdir/comm-w2c.ch
   M /branches/0.60.x/source/texk/web2c/doc/Makefile.in
   M /branches/0.60.x/source/texk/web2c/help.h
   M /branches/0.60.x/source/texk/web2c/lib/ChangeLog
   M /branches/0.60.x/source/texk/web2c/lib/Makefile.am
   M /branches/0.60.x/source/texk/web2c/lib/Makefile.in
   M /branches/0.60.x/source/texk/web2c/lib/basechsuffix.c
   M /branches/0.60.x/source/texk/web2c/lib/chartostring.c
   M /branches/0.60.x/source/texk/web2c/lib/lib.h
   M /branches/0.60.x/source/texk/web2c/lib/main.c
   M /branches/0.60.x/source/texk/web2c/lib/openclose.c
   M /branches/0.60.x/source/texk/web2c/lib/printversion.c
   M /branches/0.60.x/source/texk/web2c/lib/setupvar.c
   M /branches/0.60.x/source/texk/web2c/lib/texmfmp.c
   M /branches/0.60.x/source/texk/web2c/luatexdir/ptexlib.h
   M /branches/0.60.x/source/texk/web2c/man/ChangeLog
   M /branches/0.60.x/source/texk/web2c/man/Makefile.am
   M /branches/0.60.x/source/texk/web2c/man/Makefile.in
   M /branches/0.60.x/source/texk/web2c/man/bibtex.man
   A /branches/0.60.x/source/texk/web2c/man/ctie.man
   M /branches/0.60.x/source/texk/web2c/man/cweb.man
   M /branches/0.60.x/source/texk/web2c/man/dvicopy.man
   M /branches/0.60.x/source/texk/web2c/man/dvitomp.man
   M /branches/0.60.x/source/texk/web2c/man/dvitype.man
   M /branches/0.60.x/source/texk/web2c/man/gftodvi.man
   M /branches/0.60.x/source/texk/web2c/man/gftopk.man
   M /branches/0.60.x/source/texk/web2c/man/gftype.man
   M /branches/0.60.x/source/texk/web2c/man/mft.man
   M /branches/0.60.x/source/texk/web2c/man/ofm2opl.man
   M /branches/0.60.x/source/texk/web2c/man/opl2ofm.man
   M /branches/0.60.x/source/texk/web2c/man/ovf2ovp.man
   M /branches/0.60.x/source/texk/web2c/man/ovp2ovf.man
   M /branches/0.60.x/source/texk/web2c/man/patgen.man
   M /branches/0.60.x/source/texk/web2c/man/pdftosrc.man
   M /branches/0.60.x/source/texk/web2c/man/pktogf.man
   M /branches/0.60.x/source/texk/web2c/man/pktype.man
   M /branches/0.60.x/source/texk/web2c/man/pltotf.man
   M /branches/0.60.x/source/texk/web2c/man/tangle.man
   M /branches/0.60.x/source/texk/web2c/man/tftopl.man
   A /branches/0.60.x/source/texk/web2c/man/tie.man
   M /branches/0.60.x/source/texk/web2c/man/ttf2afm.man
   M /branches/0.60.x/source/texk/web2c/man/vftovp.man
   M /branches/0.60.x/source/texk/web2c/man/vptovf.man
   M /branches/0.60.x/source/texk/web2c/man/weave.man
   D /branches/0.60.x/source/texk/web2c/ptexdir/lib
   M /branches/0.60.x/source/texk/web2c/tangle.ch
   M /branches/0.60.x/source/texk/web2c/texmfmem.h
   M /branches/0.60.x/source/texk/web2c/texmfmp-help.h
   M /branches/0.60.x/source/texk/web2c/tiedir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/web2c/ChangeLog
   M /branches/0.60.x/source/texk/web2c/web2c/Makefile.in
   M /branches/0.60.x/source/texk/web2c/web2c/aclocal.m4
   M /branches/0.60.x/source/texk/web2c/web2c/coerce.h
   M /branches/0.60.x/source/texk/web2c/web2c/common.defines
   M /branches/0.60.x/source/texk/web2c/web2c/configure
   M /branches/0.60.x/source/texk/web2c/web2c/convert
   M /branches/0.60.x/source/texk/web2c/web2c/native/kpathsea/c-auto.in
   M /branches/0.60.x/source/texk/web2c/web2c/splitup.c
   M /branches/0.60.x/source/utils/Makefile.in
   M /branches/0.60.x/source/utils/aclocal.m4
   M /branches/0.60.x/source/utils/configure

new updates from TL

------------------------------------------------------------------------
r3637 | taco | 2010-04-20 15:44:56 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/NEWS
   M /branches/0.60.x/source/texk/web2c/luatexdir/luatex.c

bump versions and news

------------------------------------------------------------------------
r3638 | taco | 2010-04-20 16:00:47 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdffont.w
   M /branches/0.60.x/source/texk/web2c/luatexdir/pdf/pdfgen.w

merge #3629  from trunk (was missed somehow)

------------------------------------------------------------------------
r3639 | taco | 2010-04-20 16:01:30 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/dvi/dvigen.w
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/pdf/pdflistout.w

various slightly older fixes from branches/0.60.x

------------------------------------------------------------------------
r3640 | taco | 2010-04-20 16:13:14 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /trunk/build.sh
   M /trunk/source/ChangeLog
   M /trunk/source/Makefile.am
   M /trunk/source/Makefile.in
   M /trunk/source/README.config
   M /trunk/source/aclocal.m4
   M /trunk/source/auxdir/auxsub/Makefile.in
   M /trunk/source/auxdir/auxsub/aclocal.m4
   M /trunk/source/build-aux/config.guess
   M /trunk/source/build-aux/config.sub
   M /trunk/source/build-aux/texinfo.tex
   M /trunk/source/configure
   M /trunk/source/configure.ac
   M /trunk/source/libs/Makefile.in
   M /trunk/source/libs/aclocal.m4
   M /trunk/source/libs/configure
   M /trunk/source/libs/libpng/Makefile.in
   M /trunk/source/libs/libpng/aclocal.m4
   M /trunk/source/libs/libpng/include/Makefile.in
   M /trunk/source/libs/obsdcompat/Makefile.in
   M /trunk/source/libs/obsdcompat/aclocal.m4
   M /trunk/source/libs/xpdf/Makefile.in
   M /trunk/source/libs/xpdf/aclocal.m4
   M /trunk/source/libs/xpdf/fofi/Makefile.in
   M /trunk/source/libs/xpdf/goo/Makefile.in
   M /trunk/source/libs/xpdf/xpdf/Makefile.in
   M /trunk/source/libs/zlib/Makefile.in
   M /trunk/source/libs/zlib/aclocal.m4
   M /trunk/source/libs/zlib/include/Makefile.in
   M /trunk/source/libs/zziplib/Makefile.in
   M /trunk/source/libs/zziplib/aclocal.m4
   M /trunk/source/libs/zziplib/autom4te.cache/output.1
   M /trunk/source/libs/zziplib/autom4te.cache/requests
   M /trunk/source/libs/zziplib/autom4te.cache/traces.1
   M /trunk/source/libs/zziplib/include/zzip/Makefile.in
   M /trunk/source/m4/kpse-common.m4
   M /trunk/source/m4/kpse-icu-flags.m4
   M /trunk/source/m4/kpse-kpathsea-flags.m4
   M /trunk/source/m4/kpse-lt-hack.m4
   M /trunk/source/m4/kpse-pkgs.m4
   A /trunk/source/m4/kpse-ptexenc-flags.m4
   M /trunk/source/m4/kpse-setup.m4
   M /trunk/source/texk/ChangeLog
   M /trunk/source/texk/Makefile.in
   M /trunk/source/texk/README
   M /trunk/source/texk/aclocal.m4
   M /trunk/source/texk/configure
   M /trunk/source/texk/kpathsea/ChangeLog
   M /trunk/source/texk/kpathsea/Makefile.am
   M /trunk/source/texk/kpathsea/Makefile.in
   M /trunk/source/texk/kpathsea/ac/withenable.ac
   M /trunk/source/texk/kpathsea/aclocal.m4
   A /trunk/source/texk/kpathsea/bsnl.awk
   M /trunk/source/texk/kpathsea/c-auto.in
   M /trunk/source/texk/kpathsea/c-pathmx.h
   M /trunk/source/texk/kpathsea/configure
   M /trunk/source/texk/kpathsea/configure.ac
   M /trunk/source/texk/kpathsea/doc/Makefile.in
   M /trunk/source/texk/kpathsea/doc/kpathsea.info
   M /trunk/source/texk/kpathsea/doc/kpathsea.texi
   M /trunk/source/texk/kpathsea/getopt.c
   M /trunk/source/texk/kpathsea/getopt1.c
   M /trunk/source/texk/kpathsea/kpsewhich.c
   M /trunk/source/texk/kpathsea/lib.h
   M /trunk/source/texk/kpathsea/man/Makefile.in
   M /trunk/source/texk/kpathsea/man/kpseaccess.man
   M /trunk/source/texk/kpathsea/man/kpsestat.man
   M /trunk/source/texk/kpathsea/man/mktexpk.man
   M /trunk/source/texk/kpathsea/man/mktextfm.man
   M /trunk/source/texk/kpathsea/progname.c
   M /trunk/source/texk/kpathsea/progname.h
   M /trunk/source/texk/kpathsea/tex-file.c
   M /trunk/source/texk/kpathsea/texmf.cnf
   M /trunk/source/texk/kpathsea/types.h
   M /trunk/source/texk/kpathsea/win32lib.h
   M /trunk/source/texk/kpathsea/xcalloc.c
   M /trunk/source/texk/kpathsea/xmalloc.c
   M /trunk/source/texk/kpathsea/xrealloc.c
   M /trunk/source/texk/web2c/ChangeLog
   M /trunk/source/texk/web2c/Makefile.am
   M /trunk/source/texk/web2c/Makefile.in
   M /trunk/source/texk/web2c/ac/web2c.ac
   M /trunk/source/texk/web2c/aclocal.m4
   M /trunk/source/texk/web2c/am/cweb.am
   M /trunk/source/texk/web2c/am/web.am
   M /trunk/source/texk/web2c/c-auto.in
   M /trunk/source/texk/web2c/configure
   M /trunk/source/texk/web2c/configure.ac
   M /trunk/source/texk/web2c/cpascal.h
   M /trunk/source/texk/web2c/ctangleboot-sh.in
   M /trunk/source/texk/web2c/ctiedir/ChangeLog
   M /trunk/source/texk/web2c/ctiedir/ctie-k.ch
   M /trunk/source/texk/web2c/cwebdir/comm-w2c.ch
   M /trunk/source/texk/web2c/doc/Makefile.in
   M /trunk/source/texk/web2c/help.h
   M /trunk/source/texk/web2c/lib/ChangeLog
   M /trunk/source/texk/web2c/lib/Makefile.am
   M /trunk/source/texk/web2c/lib/Makefile.in
   M /trunk/source/texk/web2c/lib/basechsuffix.c
   M /trunk/source/texk/web2c/lib/chartostring.c
   M /trunk/source/texk/web2c/lib/lib.h
   M /trunk/source/texk/web2c/lib/main.c
   M /trunk/source/texk/web2c/lib/openclose.c
   M /trunk/source/texk/web2c/lib/printversion.c
   M /trunk/source/texk/web2c/lib/setupvar.c
   M /trunk/source/texk/web2c/lib/texmfmp.c
   M /trunk/source/texk/web2c/luatexdir/NEWS
   M /trunk/source/texk/web2c/luatexdir/am/libluatex.am
   M /trunk/source/texk/web2c/luatexdir/am/luatex.am
   M /trunk/source/texk/web2c/luatexdir/luatex.c
   M /trunk/source/texk/web2c/luatexdir/ptexlib.h
   M /trunk/source/texk/web2c/man/ChangeLog
   M /trunk/source/texk/web2c/man/Makefile.am
   M /trunk/source/texk/web2c/man/Makefile.in
   M /trunk/source/texk/web2c/man/bibtex.man
   A /trunk/source/texk/web2c/man/ctie.man
   M /trunk/source/texk/web2c/man/cweb.man
   M /trunk/source/texk/web2c/man/dvicopy.man
   M /trunk/source/texk/web2c/man/dvitomp.man
   M /trunk/source/texk/web2c/man/dvitype.man
   M /trunk/source/texk/web2c/man/gftodvi.man
   M /trunk/source/texk/web2c/man/gftopk.man
   M /trunk/source/texk/web2c/man/gftype.man
   M /trunk/source/texk/web2c/man/mft.man
   M /trunk/source/texk/web2c/man/ofm2opl.man
   M /trunk/source/texk/web2c/man/opl2ofm.man
   M /trunk/source/texk/web2c/man/ovf2ovp.man
   M /trunk/source/texk/web2c/man/ovp2ovf.man
   M /trunk/source/texk/web2c/man/patgen.man
   M /trunk/source/texk/web2c/man/pdftosrc.man
   M /trunk/source/texk/web2c/man/pktogf.man
   M /trunk/source/texk/web2c/man/pktype.man
   M /trunk/source/texk/web2c/man/pltotf.man
   M /trunk/source/texk/web2c/man/tangle.man
   M /trunk/source/texk/web2c/man/tftopl.man
   A /trunk/source/texk/web2c/man/tie.man
   M /trunk/source/texk/web2c/man/ttf2afm.man
   M /trunk/source/texk/web2c/man/vftovp.man
   M /trunk/source/texk/web2c/man/vptovf.man
   M /trunk/source/texk/web2c/man/weave.man
   M /trunk/source/texk/web2c/tangle.ch
   M /trunk/source/texk/web2c/texmfmem.h
   M /trunk/source/texk/web2c/texmfmp-help.h
   M /trunk/source/texk/web2c/tiedir/ChangeLog
   M /trunk/source/texk/web2c/web2c/ChangeLog
   M /trunk/source/texk/web2c/web2c/Makefile.in
   M /trunk/source/texk/web2c/web2c/aclocal.m4
   M /trunk/source/texk/web2c/web2c/coerce.h
   M /trunk/source/texk/web2c/web2c/common.defines
   M /trunk/source/texk/web2c/web2c/configure
   M /trunk/source/texk/web2c/web2c/convert
   M /trunk/source/texk/web2c/web2c/native/kpathsea/c-auto.in
   M /trunk/source/texk/web2c/web2c/splitup.c
   M /trunk/source/utils/Makefile.in
   M /trunk/source/utils/aclocal.m4
   M /trunk/source/utils/configure

blunt copy of branches/0.60.x 

------------------------------------------------------------------------

From t34www at googlemail.com  Tue Apr 20 17:38:33 2010
From: t34www at googlemail.com (T T)
Date: Tue, 20 Apr 2010 16:38:33 +0100
Subject: [Dev-luatex] running scripts from UNC paths
In-Reply-To: <n2oe7fba2611004150946k4acb9e85t8f2acc8e9804cab8@mail.gmail.com>
References: <k2ye7fba2611004150657u10ff9f68o7f10307e8380429f@mail.gmail.com>
	<4BC72339.20101@elvenkind.com>
	<q2pe7fba2611004150826vd50b49cepb426254ec49eb074@mail.gmail.com>
	<4BC731FA.3080509@elvenkind.com>
	<w2we7fba2611004150912ia8c6bf94qf76820399c2d304c@mail.gmail.com>
	<4BC73C58.40107@elvenkind.com>
	<n2oe7fba2611004150946k4acb9e85t8f2acc8e9804cab8@mail.gmail.com>
Message-ID: <q2ye7fba2611004200838i3e656db1x408ebe18a0502c38@mail.gmail.com>

On 15 April 2010 17:46, T T <t34www at googlemail.com> wrote:
> On 15 April 2010 17:18, Taco Hoekwater <taco at elvenkind.com> wrote:
>> T T wrote:
>>>
>>> On 15 April 2010 16:34, Taco Hoekwater <taco at elvenkind.com> wrote:
>>>>
>>>> Or any other older version, I'm sure. All commandline related stuff
>>>> is in luainit.w, I think.
>>>
>>> I probably need to svn up, because I can only find luainit.c, no
>>> luainit.w.
>>>
>>>> And now I suddenly see what is going wrong: your backslash is
>>>> intercepted by the code that looks for "luatex \\relax ...".
>>>
>>> OK, you will probably know how to fix this better than I do (still
>>> can't find that in the code).
>>
>> Should be fixed by #3621 (in branches/0.60.x/, so far) please try
>> it out.

It is fixed.

Thanks,

Tomek

From root at mail.boekplan.nl  Tue Apr 20 22:25:42 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 20 Apr 2010 22:25:42 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100420202542.BDAC74005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3641 | oneiros | 2010-04-20 16:29:18 +0200 (Tue, 20 Apr 2010) | 2 lines
Changed paths:
   M /trunk

merging isn't used anyway :-(

------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Apr 21 12:26:32 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 21 Apr 2010 12:26:32 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100421102632.E2C714005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3642 | taco | 2010-04-21 09:52:13 +0200 (Wed, 21 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/build.sh

reinsert the -g -O2 CFLAGS while crosscompiling for macosx

------------------------------------------------------------------------
r3643 | taco | 2010-04-21 10:08:18 +0200 (Wed, 21 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/build.sh

as mojca pointed out, --arch needs a different argument than -g ;)

------------------------------------------------------------------------

From t34www at googlemail.com  Thu Apr 22 17:13:33 2010
From: t34www at googlemail.com (T T)
Date: Thu, 22 Apr 2010 16:13:33 +0100
Subject: [Dev-luatex] os.spawn and AR crash mystery resolved
Message-ID: <q2qe7fba2611004220813k6e6c630el9fb6f53264fc3d73@mail.gmail.com>

Continuation of thread from:

http://tug.org/pipermail/tex-live/2010-April/025466.html

On 22 April 2010 00:03, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> T T a ?crit :
>> Yes, I'm quite familiar by now how those things work in texlua and
>> perl. ?Still, I'm really baffled how those problems can propagate
>> farther down to child processes. ?I started cmd.exe from perl that was
>> spawned from texlua and AR9 just wouldn't run from that cmd.exe no
>> matter what (nor from any other process started from there).
>>
> Yeah, that's really amazing. Maybe something with the environment that would
> propagate differently using spawn/exec vs execute?

Manuel, you've been on the right track all along.  I finally (almost)
got to the bottom of it.

The problem is the same as reported in the past for texdoc:

http://www.ntg.nl/pipermail/dev-luatex/2008-September/001771.html

It comes from kpathsea, which changes \ to / in USERPRIFILE var and
this leads to the dreaded AR crash with "internal error occurred".
I've been unable so far to locate at which point this substitution
happens, but at least there is an easy fix for that, which I will
commit shortly:

  os.setenv("USERPROFILE", os.getenv("USERPROFILE"):gsub('/', '\\'))

But it gets even more interesting.  This change doesn't seem to happen
really in the environment but only in the environ variable exported
from the kpathsea lib.  This explains why os.execute() works (as
reported in the texdoc thread referenced above) and os.spawn()
doesn't. With os.execute() the child process inherits the environment
automatically from its parent, while os.spawn() is implemented using
_spawnvpe() with the environ variable passed for the environment.

What's more, this USERPROFILE manipulation happens only with w32tex
builds.  For my private mingw static build this doesn't happen.  Also,
the same substitution of \ to / happens sometimes for the command line
arguments, which should be fixed too.

Now, I'm not sure if using the environ variable in os.spawn() is
actually intended.  It is certainly not consistent to use it there and
not use it in os.execute().  I would suggest to remove this entirely
with this one line change in luatex:

Index: loslibext.c
===================================================================
--- loslibext.c	(revision 3635)
+++ loslibext.c	(working copy)
@@ -113,7 +113,7 @@

 #ifdef _WIN32
 #  include <process.h>
-#  define spawn_command(a,b,c) _spawnvpe(_P_WAIT,(const char
*)a,(const char* const*)b,(const char* const*)c)
+#  define spawn_command(a,b,c) _spawnvp(_P_WAIT,(const char
*)a,(const char* const*)b)
 #  if DONT_REALLY_EXIT
 #    define exec_command(a,b,c) exit(spawn_command((a),(b),(c)))
 #  else

Cheers,

Tomek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: loslibext.c.diff
Type: application/octet-stream
Size: 513 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20100422/080ce12f/attachment.obj>

From mpg at elzevir.fr  Thu Apr 22 17:30:52 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 22 Apr 2010 17:30:52 +0200
Subject: [Dev-luatex] os.spawn and AR crash mystery resolved
In-Reply-To: <q2qe7fba2611004220813k6e6c630el9fb6f53264fc3d73@mail.gmail.com>
References: <q2qe7fba2611004220813k6e6c630el9fb6f53264fc3d73@mail.gmail.com>
Message-ID: <4BD06BAC.10002@elzevir.fr>

Hi Tomek,

T T a ?crit :
> On 22 April 2010 00:03, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
>> Yeah, that's really amazing. Maybe something with the environment that would
>> propagate differently using spawn/exec vs execute?
> 
> Manuel, you've been on the right track all along.  I finally (almost)
> got to the bottom of it.
> 
> The problem is the same as reported in the past for texdoc:
> 
> http://www.ntg.nl/pipermail/dev-luatex/2008-September/001771.html
> 
> It comes from kpathsea, which changes \ to / in USERPRIFILE var and
> this leads to the dreaded AR crash with "internal error occurred".

Very nice catch!

> I've been unable so far to locate at which point this substitution
> happens, but at least there is an easy fix for that, which I will
> commit shortly:
> 
>   os.setenv("USERPROFILE", os.getenv("USERPROFILE"):gsub('/', '\\'))
> 
Sounds good, while waiting for a proper fix in the engine.

> But it gets even more interesting.  This change doesn't seem to happen
> really in the environment but only in the environ variable exported
> from the kpathsea lib.  This explains why os.execute() works (as
> reported in the texdoc thread referenced above) and os.spawn()
> doesn't. With os.execute() the child process inherits the environment
> automatically from its parent, while os.spawn() is implemented using
> _spawnvpe() with the environ variable passed for the environment.
> 
Nice catch again!

I'm very glad to finally understand this so mysterious problem. Thank you for
getting to the bottom of it, Tomek!

Manuel.

From javier at digi21.eu  Thu Apr 22 20:28:04 2010
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Thu, 22 Apr 2010 20:28:04 +0200
Subject: [Dev-luatex] Problem with hyphenation
Message-ID: <n2w5088e64f1004221128nfd18f434x68c77389d2b2e64b@mail.gmail.com>

I am using version 0.50.0, so I apologize in advance in case this has
already been fixed.

Input (utf-8, of course):

\font\tenrm=ec-lmr10 \tenrm
%\catcode`?=11  %doesn't make any difference
\hyphenation{c?-ma-ra}
\showhyphens{c?mara}
\lccode`?=`?
\showhyphens{c?mara}
\end

Output (log):

Underfull \hbox (badness 10000) in paragraph at lines 4--4
[][] \tenrm c?mar-a

\hbox(6.81725+0.0)x16383.99998, glue set 9797.44336, direction TLT []

Underfull \hbox (badness 10000) in paragraph at lines 6--6
[][] \tenrm c?-ma-ra

\hbox(6.81725+0.0)x16383.99998, glue set 9797.44336, direction TLT []

The first case is wrong, but it is specially bad that luatex ignores
\lefthyphenmin

Regards,
Javier A. M?gica

From taco at elvenkind.com  Thu Apr 22 20:52:16 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 22 Apr 2010 20:52:16 +0200
Subject: [Dev-luatex] Problem with hyphenation
In-Reply-To: <n2w5088e64f1004221128nfd18f434x68c77389d2b2e64b@mail.gmail.com>
References: <n2w5088e64f1004221128nfd18f434x68c77389d2b2e64b@mail.gmail.com>
Message-ID: <4BD09AE0.503@elvenkind.com>


Hi,

Javier M?gica wrote:
> I am using version 0.50.0, so I apologize in advance in case this has
> already been fixed.

With 0.60:

(./hyph.tex
Underfull \hbox (badness 10000) in paragraph at lines 4--4
[][] \tenrm c?mara

Underfull \hbox (badness 10000) in paragraph at lines 6--6
[][] \tenrm c?-ma-ra
  )

Which is how it should be, I think.

Best wishes,
Taco


From javier at digi21.eu  Thu Apr 22 21:31:00 2010
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Thu, 22 Apr 2010 21:31:00 +0200
Subject: [Dev-luatex] Problem with hyphenation
In-Reply-To: <4BD09AE0.503@elvenkind.com>
References: <n2w5088e64f1004221128nfd18f434x68c77389d2b2e64b@mail.gmail.com>
	<4BD09AE0.503@elvenkind.com>
Message-ID: <t2h5088e64f1004221231yb512c460x60aacb4cbd100bb5@mail.gmail.com>

I have updated and still get the same output. I attach you de format
file I'm using (in a separate message)

From javier at digi21.eu  Thu Apr 22 21:32:45 2010
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Thu, 22 Apr 2010 21:32:45 +0200
Subject: [Dev-luatex] Problem with hyphenation
In-Reply-To: <4BD09AE0.503@elvenkind.com>
References: <n2w5088e64f1004221128nfd18f434x68c77389d2b2e64b@mail.gmail.com>
	<4BD09AE0.503@elvenkind.com>
Message-ID: <g2q5088e64f1004221232t9771b5e4kab57006e04a9b6a4@mail.gmail.com>

I have updated and still get the same output. I'm using a format of
mine which defaults to Spanish, but writing \language=0 at the
beginning doesn't change it. I attach you the format file I'm using
(in a separate message)

From reinhard.kotucha at web.de  Thu Apr 22 22:33:24 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 22 Apr 2010 22:33:24 +0200
Subject: [Dev-luatex] os.spawn and AR crash mystery resolved
In-Reply-To: <q2qe7fba2611004220813k6e6c630el9fb6f53264fc3d73@mail.gmail.com>
References: <q2qe7fba2611004220813k6e6c630el9fb6f53264fc3d73@mail.gmail.com>
Message-ID: <19408.45716.792952.692639@zaphod.ms25.net>

On 22 April 2010 T T wrote:

 > Manuel, you've been on the right track all along.  I finally (almost)
 > got to the bottom of it.
 > 
 > The problem is the same as reported in the past for texdoc:
 > 
 > http://www.ntg.nl/pipermail/dev-luatex/2008-September/001771.html
 > 
 > It comes from kpathsea, which changes \ to / in USERPRIFILE var and
 > this leads to the dreaded AR crash with "internal error occurred".
 > I've been unable so far to locate at which point this substitution
 > happens, but at least there is an easy fix for that, which I will
 > commit shortly:

Thanks, this is great.

 > What's more, this USERPROFILE manipulation happens only with w32tex
 > builds.  For my private mingw static build this doesn't happen.

This is curious because Akira couldn't reproduce the problem.  

Thanks again,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr 23 22:26:55 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 23 Apr 2010 22:26:55 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100423202655.D941D4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3644 | taco | 2010-04-23 18:35:00 +0200 (Fri, 23 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/loslibext.c

patch dealing with os.exec vs os.execute differences on Win32, from Tomek

------------------------------------------------------------------------
r3645 | taco | 2010-04-23 21:00:42 +0200 (Fri, 23 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/loslibext.c

correct a bug in 3644

------------------------------------------------------------------------

From root at mail.boekplan.nl  Sat Apr 24 12:26:28 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 24 Apr 2010 12:26:28 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100424102628.6BF5A4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3646 | hhenkel | 2010-04-23 23:35:42 +0200 (Fri, 23 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

inspective PDF library

------------------------------------------------------------------------
r3647 | hhenkel | 2010-04-24 06:47:19 +0200 (Sat, 24 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

remove a few WTFs (thanks, Martin!)

------------------------------------------------------------------------
r3648 | taco | 2010-04-24 10:04:50 +0200 (Sat, 24 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua/loslibext.c

taco-is-an-idiot

------------------------------------------------------------------------

From mpg at elzevir.fr  Sat Apr 24 14:32:09 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 24 Apr 2010 14:32:09 +0200
Subject: [Dev-luatex] cross-compiling: CONFHOST setting
Message-ID: <4BD2E4C9.3010400@elzevir.fr>

Hi Taco,

While trying to cross-compile luatex from linux to win32 using mingw, I got a 
failure due to the --host setting not matching what is installed on my machine. 
I changed that in build.sh and got a second, but less serious error, about 
mingw32-strip no being found.

I suggest the attached patch to build.sh to make cross-compilation more 
configurable. Hopefully, ./build.sh --mingw will continue to work were it used 
to, but the platforms will also be configurable with, eg

./build.sh --mingw --host=i586-mingw32msvc --build=x84_64-linux-gnu

This command line works on my platform, but I couldn't test if just --mingw 
still works elsewhere, so you may want to test that on your machine.

Thanks,
Manuel.

From mpg at elzevir.fr  Sat Apr 24 14:35:55 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 24 Apr 2010 14:35:55 +0200
Subject: [Dev-luatex] cross-compiling: CONFHOST setting
In-Reply-To: <4BD2E4C9.3010400@elzevir.fr>
References: <4BD2E4C9.3010400@elzevir.fr>
Message-ID: <4BD2E5AB.10405@elzevir.fr>

Le 24/04/2010 14:32, Manuel P?gouri?-Gonnard a ?crit :
> I suggest the attached patch

Did I write "attached"?

m
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mingw-cross.patch
Type: text/x-patch
Size: 2317 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-luatex/attachments/20100424/4982a432/attachment.bin>

From taco at elvenkind.com  Sat Apr 24 15:14:25 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 24 Apr 2010 15:14:25 +0200
Subject: [Dev-luatex] cross-compiling: CONFHOST setting
In-Reply-To: <4BD2E5AB.10405@elzevir.fr>
References: <4BD2E4C9.3010400@elzevir.fr> <4BD2E5AB.10405@elzevir.fr>
Message-ID: <4BD2EEB1.8020509@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Le 24/04/2010 14:32, Manuel P?gouri?-Gonnard a ?crit :
>> I suggest the attached patch
> 
> Did I write "attached"?

Thanks, applied after testing.

Best wishes,
Taco

From root at mail.boekplan.nl  Sat Apr 24 16:25:37 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Sat, 24 Apr 2010 16:25:37 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100424142537.E22154005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3649 | taco | 2010-04-24 15:06:56 +0200 (Sat, 24 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/build.sh

Retargetable cross compilation patch from Manuel P?\195?\169gouri?\195?\169-Gonnard

------------------------------------------------------------------------

From root at mail.boekplan.nl  Mon Apr 26 12:26:46 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Mon, 26 Apr 2010 12:26:46 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100426102646.59EF64005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3650 | taco | 2010-04-26 10:13:41 +0200 (Mon, 26 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/ChangeLog
   M /branches/0.60.x/source/texk/web2c/luatexdir/image/epdf.h
   M /branches/0.60.x/source/texk/web2c/luatexdir/lua51/luaconf.h

header location fix from PEB (needed for a TL build system change)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Tue Apr 27 12:26:33 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Tue, 27 Apr 2010 12:26:33 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100427102633.5A6ED4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3651 | taco | 2010-04-27 11:57:40 +0200 (Tue, 27 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/manual/luatexref-t.pdf
   M /branches/0.60.x/manual/luatexref-t.tex

document tex.tprint()

------------------------------------------------------------------------

From taco at elvenkind.com  Wed Apr 28 10:04:19 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Apr 2010 10:04:19 +0200
Subject: [Dev-luatex] Luatex 0.60.1 announcement
Message-ID: <4BD7EC03.7020400@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.60.1,
a bugfix release for the 0.60 branch.

New features:

* renamed node.skipable() to node.skippable().

* More git discovery patches in getluatexsvnversion.sh.

* Added --warnings=[no|min|yes|max|all] option to build.sh.

* While cross-compiling, build.sh now adds an extra linker switch
   to allow win32 exes to use 3G instead of 2G of virtual memory.

Bugfixes:

* os.exec() & os.spawn() handled the environment differently from
   os.execute() on Win32 (patch from Tomek)

* Builds with --enable-ipc were broken.

* Assigning and acquiring \fontdimen s from TeX code was broken.

* An initial attempt at fixing bug #372 (\predisplaydirection).

* An attempt to fix \eqno/\leqno placements in mixed direction
   \mathdir/\textdir.

* Our local xpdf patch is reverted, it is not needed any more.

* The os.selfdir variable was not documented, as well as broken
   on WIN32.

* Fix "\input tikz hello \bye" bug, plus fix one sign error.

* Fix handling of lua script files with UNC names.



The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.60.1

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org


Have fun,
Taco


From root at mail.boekplan.nl  Wed Apr 28 12:27:12 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 28 Apr 2010 12:27:12 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100428102712.4213C4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3652 | hhenkel | 2010-04-27 23:18:12 +0200 (Tue, 27 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

if PDF document could not be opened by lepdflib, instead of ending
with fatal luatex error, epdf.open("filename") returns nil.

------------------------------------------------------------------------
r3653 | hhenkel | 2010-04-28 00:03:57 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

use more Lua-style typecheck (simplify)

------------------------------------------------------------------------
r3654 | hhenkel | 2010-04-28 01:18:35 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

very rough documentation of the epdf library

------------------------------------------------------------------------
r3655 | hhenkel | 2010-04-28 01:31:03 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex

typo

------------------------------------------------------------------------
r3656 | hhenkel | 2010-04-28 07:45:42 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /trunk/manual/luatexref-t.tex
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

typo and variable init

------------------------------------------------------------------------
r3657 | taco | 2010-04-28 08:32:19 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/NEWS

update news

------------------------------------------------------------------------
r3658 | taco | 2010-04-28 08:33:21 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   A /tags/beta-0.60.1 (from /branches/0.60.x:3657)

new tag (for release)

------------------------------------------------------------------------

From root at mail.boekplan.nl  Wed Apr 28 22:26:34 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Wed, 28 Apr 2010 22:26:34 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100428202634.69D9E4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3659 | taco | 2010-04-28 17:10:32 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /branches/0.60.x/source/texk/web2c/luatexdir/tex/maincontrol.w

add \protected to an error message

------------------------------------------------------------------------

From root at mail.boekplan.nl  Thu Apr 29 12:27:12 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 29 Apr 2010 12:27:12 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100429102712.99F244005F@mail.boekplan.nl>

------------------------------------------------------------------------
r3660 | hhenkel | 2010-04-28 22:55:45 +0200 (Wed, 28 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

more functions

------------------------------------------------------------------------
r3661 | hhenkel | 2010-04-29 00:10:52 +0200 (Thu, 29 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

more macros

------------------------------------------------------------------------
r3662 | hhenkel | 2010-04-29 07:30:22 +0200 (Thu, 29 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

another macro

------------------------------------------------------------------------

From root at mail.boekplan.nl  Thu Apr 29 22:26:27 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Thu, 29 Apr 2010 22:26:27 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100429202627.47E634005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3663 | hhenkel | 2010-04-29 20:27:39 +0200 (Thu, 29 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/epdf.h
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc

replace PdfObject class by xpdf's original Object class

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr 30 12:27:17 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 30 Apr 2010 12:27:17 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100430102717.39AF84005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3664 | hhenkel | 2010-04-29 22:46:51 +0200 (Thu, 29 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

more functions

------------------------------------------------------------------------
r3665 | hhenkel | 2010-04-29 23:08:06 +0200 (Thu, 29 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

typos

------------------------------------------------------------------------
r3666 | oneiros | 2010-04-30 09:11:19 +0200 (Fri, 30 Apr 2010) | 3 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

rm unused variables
add a return statement

------------------------------------------------------------------------

From root at mail.boekplan.nl  Fri Apr 30 22:26:02 2010
From: root at mail.boekplan.nl (Cron Daemon)
Date: Fri, 30 Apr 2010 22:26:02 +0200 (CEST)
Subject: [Dev-luatex] Cron <luatex@boekplan>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20100430202602.C156A4005E@mail.boekplan.nl>

------------------------------------------------------------------------
r3667 | hhenkel | 2010-04-30 20:42:47 +0200 (Fri, 30 Apr 2010) | 2 lines
Changed paths:
   M /trunk/source/texk/web2c/luatexdir/image/pdftoepdf.cc
   M /trunk/source/texk/web2c/luatexdir/lua/lepdflib.cc

one obj1.free() was missing

------------------------------------------------------------------------

