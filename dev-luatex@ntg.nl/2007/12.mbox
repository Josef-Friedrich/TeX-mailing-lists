From root at www.bittext.nl  Sat Dec  1 12:22:01 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Sat,  1 Dec 2007 12:22:01 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071201112240.6FFF31E8C2B4@www.bittext.nl>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From root at www.bittext.nl  Sat Dec  1 16:22:02 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Sat,  1 Dec 2007 16:22:02 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071201152246.2422D1E8C2B4@www.bittext.nl>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': 500 Internal Server Error (http://scm.foundry.supelec.fr)

From Jonathan.Sauer at silverstroke.com  Tue Dec  4 09:03:23 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 4 Dec 2007 09:03:23 +0100
Subject: [Dev-luatex] LuaTeX manual: Hyperlinked TOC and PDF bookmarks?
Message-ID: <9343542E664B894484613D106D7D3F5F84AAFF@s-yellow.net.silverstroke.de>

Hello,

right now, LuaTeX's manual has neither a TOC with hyperlinks
nor PDF bookmarks (the document outline displayed by (some) PDF
viewers). Since the manual is typeset using Context, adding
these should not be difficult, and it would improve its
usability quite a lot.


Thanks in advance,
Jonathan


From martin at oneiros.de  Wed Dec  5 09:44:17 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 5 Dec 2007 09:44:17 +0100
Subject: [Dev-luatex] LuaTeX manual: Hyperlinked TOC and PDF bookmarks?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AAFF@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AAFF@s-yellow.net.silverstroke.de>
Message-ID: <68c491a60712050044s26eafe44ld221c0167ff7dbf2@mail.gmail.com>

2007/12/4, Jonathan Sauer <Jonathan.Sauer at silverstroke.com>:
> these should not be difficult, and it would improve its
> usability quite a lot.

Patches are welcome. :-)

Best
   Martin

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 10:01:37 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 10:01:37 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
Message-ID: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>

Hello,

if I understand the svn version of the manual correctly, after
hyphenation, character nodes are converted to glyph nodes (BTW:
The new section 5 is very good, as it is very detailed). During
this step, first ligatures are created, then kerning is applied.

Now, LuaTeX uses Unicode internally, but current font need not
be Unicode. Given the letter "?" and a font in OT1-encoding,
how would I convert this "?" to an accented glyph *after*
hyphenation has happened (to be able to hyphenate words
containing "?")?

I looked into the manual, but found only two callbacks for
inserting ligatures and kerning, not for converting characters
to glyphs (incidentally, the documentation for these callbacks
is very meager). Is this done using one of the font tables?
If so, how do I set it up correctly?


Thanks in advance,
Jonathan


From taco at elvenkind.com  Wed Dec  5 10:14:37 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 10:14:37 +0100
Subject: [Dev-luatex] LuaTeX manual: Hyperlinked TOC and PDF bookmarks?
In-Reply-To: <68c491a60712050044s26eafe44ld221c0167ff7dbf2@mail.gmail.com>
References: <9343542E664B894484613D106D7D3F5F84AAFF@s-yellow.net.silverstroke.de>
	<68c491a60712050044s26eafe44ld221c0167ff7dbf2@mail.gmail.com>
Message-ID: <47566BFD.2090306@elvenkind.com>



Martin Schr?der wrote:
> 2007/12/4, Jonathan Sauer <Jonathan.Sauer at silverstroke.com>:
>> these should not be difficult, and it would improve its
>> usability quite a lot.
> 
> Patches are welcome. :-)

No problem, this is easy.

Best wishes,
Taco

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 11:06:01 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 11:06:01 +0100
Subject: [Dev-luatex] LuaTeX manual: Hyperlinked TOC and PDF bookmarks?
References: <9343542E664B894484613D106D7D3F5F84AAFF@s-yellow.net.silverstroke.de><68c491a60712050044s26eafe44ld221c0167ff7dbf2@mail.gmail.com>
	<47566BFD.2090306@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB04@s-yellow.net.silverstroke.de>

Hello,

> >> these should not be difficult, and it would improve its usability 
> >> quite a lot.
> > 
> > Patches are welcome. :-)
> 
> No problem, this is easy.

Now that was quick!


Thanks!
Jonathan


From taco at elvenkind.com  Wed Dec  5 11:38:39 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 11:38:39 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>
Message-ID: <47567FAF.1090705@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
> if I understand the svn version of the manual correctly, after
> hyphenation, character nodes are converted to glyph nodes (BTW:
> The new section 5 is very good, as it is very detailed). During
> this step, first ligatures are created, then kerning is applied.
> 
> Now, LuaTeX uses Unicode internally, but current font need not
> be Unicode. 

However, by default it is assumed to be. This assumption has to be
made because there is no way to get the required mappings from a
tfm file if this were not the case. So for remapping to happen,
you have to write and register a bit of lua code. (there was a
choice between this assumption and inventing a new dedicated
font-related file format)

> Given the letter "?" and a font in OT1-encoding,
> how would I convert this "?" to an accented glyph *after*
> hyphenation has happened (to be able to hyphenate words
> containing "?")?

The logical place is in the ligaturing callback, because
for tfm-based fonts, the actual ligature insertions can be
done in one line via the node.ligaturing() built-in function.

\directlua0{
   callback.register('ligaturing', function (head, tail)
       convert_to_glyphs(head)
       node.ligaturing(head)
       return
     end)
}

Note: you don't have to worry about return values because the head
node that is passed on to the callback is guaranteed not to be a
glyph_node (if need be, a temporary node will be inserted), and
therefore it cannot be affected by the mutations that take place.
In this case, the 'tail' node is not used (the link of 'tail' is
guaranteed to be 'nil').

You have to write the convert_to_glyphs function of course,
and it could look like this:

\directlua0{
   function find_font_glyph (f,c)
     % you should do some real work here!
     return c
   end

   function convert_to_glyphs (head)
      for v in node.traverse_id(head) do
        if v.subtype=1 then
           v.character = find_font_glyph(v.font,v.character)
           v.subtype=0
        end
      end
   end
}


> I looked into the manual, but found only two callbacks for
> inserting ligatures and kerning, not for converting characters
> to glyphs (incidentally, the documentation for these callbacks
> is very meager). 

The manual was not finished yet, I have just added a few paragraphs
on this subject.

Best wishes,
Taco


From root at www.bittext.nl  Wed Dec  5 12:22:06 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Wed,  5 Dec 2007 12:22:06 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071205112245.9DDE91E8C2B8@www.bittext.nl>

U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-env.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 934.

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 12:26:22 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 12:26:22 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>
	<47567FAF.1090705@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>

Hello,

thanks for your quick and detailed reply!

> [...]
> > Given the letter "?" and a font in OT1-encoding,
> > how would I convert this "?" to an accented glyph *after*
> > hyphenation has happened (to be able to hyphenate words
> > containing "?")?
> 
> The logical place is in the ligaturing callback, because
> for tfm-based fonts, the actual ligature insertions can be
> done in one line via the node.ligaturing() built-in function.
> 
> [...]
>
> Note: you don't have to worry about return values because the head
> node that is passed on to the callback is guaranteed not to be a
> glyph_node (if need be, a temporary node will be inserted), and
> therefore it cannot be affected by the mutations that take place.
> In this case, the 'tail' node is not used (the link of 'tail' is
> guaranteed to be 'nil').

You mean if I insert additional nodes inbetween? If I only modify
the nodes themselves without touching the list, this should not be
a problem anyway.

> You have to write the convert_to_glyphs function of course,
> and it could look like this:
> 
> \directlua0{
>    function find_font_glyph (f,c)
>      % you should do some real work here!
>      return c
>    end
> 
>    function convert_to_glyphs (head)
>       for v in node.traverse_id(head) do
>         if v.subtype=1 then
>            v.character = find_font_glyph(v.font,v.character)
>            v.subtype=0
>         end
>       end
>    end
> }

Shouldn't the subtype be "2"? In setion 7.1.2.12, bit 1 is used
to denote a glyph, if I understand the manual correctly. Since
I convert the character to a glyph in the font, this bit should
be set afterwards.

Also, in the manual the field is called "char", not "character".
Which one is correct? (both?)

Anyway, now I have a place where to start. Still, I am a bit
clueless on how to create an accented character node. Or do I
have to insert another character node in the list containing
the accent (i.e. '"' to create an '?' from an 'a')? How do I
tell this new node to overlap the 'a'?


> Best wishes,
> Taco

Thanks in advance,
Jonathan


From pragma at wxs.nl  Wed Dec  5 12:29:55 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 05 Dec 2007 12:29:55 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>
Message-ID: <47568BB3.9090005@wxs.nl>

Jonathan Sauer wrote:

> Anyway, now I have a place where to start. Still, I am a bit
> clueless on how to create an accented character node. Or do I
> have to insert another character node in the list containing
> the accent (i.e. '"' to create an '?' from an 'a')? How do I
> tell this new node to overlap the 'a'?

depends ... one of

(1) use \accent
(2) insert an glyph node (") after the current glyph node (a) and put a 
kern nonde in between, or use the x/y offsets in the glyph nodes
(3) make a virtual character in the font and change the glyphs (a) 
reference to the one of the virtual char



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Dec  5 12:37:53 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 12:37:53 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>
Message-ID: <47568D91.6080804@elvenkind.com>

> 
> You mean if I insert additional nodes inbetween? If I only modify
> the nodes themselves without touching the list, this should not be
> a problem anyway.

right.

> Shouldn't the subtype be "2"? In setion 7.1.2.12, bit 1 is used
> to denote a glyph, if I understand the manual correctly. Since
> I convert the character to a glyph in the font, this bit should
> be set afterwards.

I am somewhat in doubt about that. The manual and my coding
practise do not quite agree on what the value really should be,
but bit zero should definately be cleared (in fact, that is
the only test made, right now).

Probably, the best approach will be to clear bit zero here (just
before ligaturing), and set bit one *after* both ligaturing and
kerning have happened. Comments and suggestions are welcome.

> Also, in the manual the field is called "char", not "character".
> Which one is correct? (both?)

"char" is correct. Sorry, bad typing.

> Anyway, now I have a place where to start. Still, I am a bit
> clueless on how to create an accented character node. Or do I
> have to insert another character node in the list containing
> the accent (i.e. '"' to create an '?' from an 'a')? 

A virtual font would be easier, but: yes, you can do it that
way.

>  How do I tell this new node to overlap the 'a'?

By adding some extra kerning around it, and/or tweaking the
values of the "xoffset" and "yoffset" fields (the need for such
node list manipulations is the main reason why a virtual font
is easier).

Best wishes,
Taco

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 13:25:21 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 13:25:21 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>
	<47568D91.6080804@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>

Hello,

> > Shouldn't the subtype be "2"? In setion 7.1.2.12, bit 1 is used
> > to denote a glyph, if I understand the manual correctly. Since
> > I convert the character to a glyph in the font, this bit should
> > be set afterwards.
> 
> I am somewhat in doubt about that. The manual and my coding
> practise do not quite agree on what the value really should be,
> but bit zero should definately be cleared (in fact, that is
> the only test made, right now).

Mmm ... if the subtype is a bitfield, IMO one bit should be set;
otherwise the subtype would be undefined.

Still, why is the subtype ia bitfield anyway? Can a glyph node
i.e. be both a character node as well as a ligature node?

> [...]
> > Anyway, now I have a place where to start. Still, I am a bit
> > clueless on how to create an accented character node. Or do I
> > have to insert another character node in the list containing
> > the accent (i.e. '"' to create an '?' from an 'a')? 
> 
> A virtual font would be easier, but: yes, you can do it that
> way.

Let me see if I get this right:

1. I load the font, i.e. in OT1-encoding, just like any other TeX
   font.

2. I modify the font's table (i.e. by using the "define_font" callback):
   I add all characters I want to support to the font's "characters"
   array. Each of these new characters contains a "commands" field 
   which constructs the character from several others in the font.

3. I use the (artificial, as described in section 6.2.1) font and am
   a happy clam.

Questions:

- Section 6 of the manual states that the key of the "characters"
  table is the "internal code TeX knows this character by". How do
  I determine this code? Is this simply the Unicode code point?

- If I handle accented characters this way, I do not have to create
  a "ligaturing" callback, do I?

- Does the "char" font command move the output pointer?

> >  How do I tell this new node to overlap the 'a'?
> 
> By adding some extra kerning around it, and/or tweaking the
> values of the "xoffset" and "yoffset" fields (the need for such
> node list manipulations is the main reason why a virtual font
> is easier).

It seems like it, especially since I would need some kind of
data structure to describe the character-replacements anyway.
Also, a virtual font would most likely be easier on the garbage
collector.


> Best wishes,
> Taco

Jonathan


From pragma at wxs.nl  Wed Dec  5 13:40:11 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 05 Dec 2007 13:40:11 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>	<47568D91.6080804@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>
Message-ID: <47569C2B.6030800@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
>>> Shouldn't the subtype be "2"? In setion 7.1.2.12, bit 1 is used
>>> to denote a glyph, if I understand the manual correctly. Since
>>> I convert the character to a glyph in the font, this bit should
>>> be set afterwards.
>> I am somewhat in doubt about that. The manual and my coding
>> practise do not quite agree on what the value really should be,
>> but bit zero should definately be cleared (in fact, that is
>> the only test made, right now).
> 
> Mmm ... if the subtype is a bitfield, IMO one bit should be set;
> otherwise the subtype would be undefined.
> 
> Still, why is the subtype ia bitfield anyway? Can a glyph node
> i.e. be both a character node as well as a ligature node?

a ligature is not really a character -)

anyhow, zero means 'nothing done', while other values < 256 means, 
something done; you can use bits >= 256 for your own usage since luatex 
only looks at the first 8 bits


> Let me see if I get this right:
> 
> 1. I load the font, i.e. in OT1-encoding, just like any other TeX
>    font.
> 
> 2. I modify the font's table (i.e. by using the "define_font" callback):
>    I add all characters I want to support to the font's "characters"
>    array. Each of these new characters contains a "commands" field 
>    which constructs the character from several others in the font.
> 
> 3. I use the (artificial, as described in section 6.2.1) font and am
>    a happy clam.

indeed; of course you can also make the virtual font independent of luatex

> Questions:
> 
> - Section 6 of the manual states that the key of the "characters"
>   table is the "internal code TeX knows this character by". How do
>   I determine this code? Is this simply the Unicode code point?

your choice, as long as you also provide the index i.e. where to find 
the glyph in the font file

> - If I handle accented characters this way, I do not have to create
>   a "ligaturing" callback, do I?

no, this is controlled by the ligature subtable; if such a table is 
there (in the font that is) then things happen automatically (same for 
kerning)

> - Does the "char" font command move the output pointer?

?

>>>  How do I tell this new node to overlap the 'a'?
>> By adding some extra kerning around it, and/or tweaking the
>> values of the "xoffset" and "yoffset" fields (the need for such
>> node list manipulations is the main reason why a virtual font
>> is easier).
> 
> It seems like it, especially since I would need some kind of
> data structure to describe the character-replacements anyway.
> Also, a virtual font would most likely be easier on the garbage
> collector.

fonts are not garbage collected (well, at the lua end the table may be 
collected of course) but in tex itself it's allocated permanently

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 14:07:21 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 14:07:21 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>	<47568D91.6080804@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>
	<47569C2B.6030800@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB0A@s-yellow.net.silverstroke.de>

Hello,

> [...]
> > Questions:
> > 
> > - Section 6 of the manual states that the key of the "characters"
> >   table is the "internal code TeX knows this character by". How do
> >   I determine this code? Is this simply the Unicode code point?
> 
> your choice, as long as you also provide the index i.e. where to find 
> the glyph in the font file

Now I'm back to confused. How is this my choice? Let's say I have an
input file with character "?". Would its "internal code TeX knows
this character by" be Unicode's "LATIN CAPITAL LETTER A WITH DIAERESIS"
(00C4)? If yes: So in order to add this character to an OT1-font, would
I simply add it to the "characters" table with key hex C4 (and an
appropriate command table)?

> > - Does the "char" font command move the output pointer?
> 
> ?

If I have a command table "char 23; char 42", will character number 42
be typeset on top of character 23, or to the right? (yes, it does, as
Taco answered) Could this be added to the manual, to make the behaviour
of the "char" font command clearer? (since some other commands explicitely
state of they move the output pointer)


> Hans

Jonathan


From taco at elvenkind.com  Wed Dec  5 14:26:36 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 14:26:36 +0100
Subject: [Dev-luatex] beta 0.20.0 released
Message-ID: <4756A70C.2030107@elvenkind.com>

Hi,


Hi all,

I have just released the new beta for luatex, with version
number now at 0.20.0. This will be the last beta with big
changes in it for a while: I will start work on the mplib
project now, and that will be my main focus for the coming
two/three months. I have planned for bug-fix releases for
this beta, though.

Actually, there certainly will be a 0.20.1 pretty soon,
because: there are some pretty nasty bugs in the bidirectional
algorithm that need fixing (sorry Idris, my brain is too
blurry to solve these right now, I'll try again in a day
or two); there is a node memory leak in math mode (not
bad enough to be a shopstopper, but it needs fixing); the manual
can be improved quite a bi (as the question from Jonathan
prove!).

News compared to the last beta (0.11.2) is as follows:

* Completely overhauled hyphenation and ligkern application,
   including the addition of a new "lang" table in lua to
   interface to the language parameters, some extra functions
   in the "node" table, and a few extra callbacks ("hyphenate",
   "ligaturing", "kerning", "post_linebreak_filter").

   There is a new chapter in the manual to document all the
   changes to the hyphenation and line breaking algorithms,
   it is simply too much to list here.

* the interface of the pre_linebreak_filter,hpack_filter,
   vpack_filter, and pre_output_filter has changed slightly.

* boxes can now get explicit attributes different from the
   currently active set, using a syntax like

   \hbox attr2=12 attr3=-1 to 12pt {Hi!}

* lpeg is now at version 0.7

* a whole series of exotic bugs and compiler warnings are
   fixed, mostly thanks to the watchful eye of Fabrice.

* texio.print now accepts multiple strings as arguments.

* the lua functions os.sleep(), os.times(), os.gettimeofday()
   and os.tmpdir() have been added.

* lua now comes with the coroutine (coco) patches from the
   luajit project applied.

* the banner line no longer claims to be TeX.

* a bunch of bugs reported on the mailing list have been
   fixed (I hope all of them).

* (internal) we found lots of small ways to speed up lua
   node processing.

* (internal) the node (de)allocation functions have been
   rewritten, so that absolutely all nodes now have a type,
   even the ones with variable sizes.

I have uploaded source and linux/win32 binaries to

     http://foundry.supelec.fr/projects/luatex/

Have fun,

Taco



From taco at elvenkind.com  Wed Dec  5 13:51:02 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 13:51:02 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <47569C2B.6030800@wxs.nl>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>	<47568D91.6080804@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>
	<47569C2B.6030800@wxs.nl>
Message-ID: <47569EB6.20605@elvenkind.com>



Hans Hagen wrote:
>>
>> Still, why is the subtype ia bitfield anyway? Can a glyph node
>> i.e. be both a character node as well as a ligature node?
> 
> a ligature is not really a character -)
> 
> anyhow, zero means 'nothing done', while other values < 256 means, 
> something done; you can use bits >= 256 for your own usage since luatex 
> only looks at the first 8 bits

A glyph_node is either a pre-hyphenation character (only bit 0 is set
== its value is 1), or it is something else.  Some of the "something
elses" really make more sense when subtype is a bit field (ligatures
and ghosts).

The advantage of using a the first and second bit for "character"
and "glyph", is that we could make tests like: is this a pre-ligkern
node (0 and 1 both unset), or a post-ligkern glyph node (with bit 1
set), or a character (bit 0 set). Such a split allows speedups as
some processing steps can be skipped. Currently however, only the
character test is implemented.

>> - If I handle accented characters this way, I do not have to create
>>   a "ligaturing" callback, do I?

correct.

>> - Does the "char" font command move the output pointer?

yes.

Best wishes,
Taco

From taco at elvenkind.com  Wed Dec  5 15:06:43 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 15:06:43 +0100
Subject: [Dev-luatex] Chars to glyphs. How to?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0A@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB01@s-yellow.net.silverstroke.de>	<47567FAF.1090705@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB07@s-yellow.net.silverstroke.de>	<47568D91.6080804@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB09@s-yellow.net.silverstroke.de>	<47569C2B.6030800@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0A@s-yellow.net.silverstroke.de>
Message-ID: <4756B073.30903@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
>> [...]
>>> Questions:
>>>
>>> - Section 6 of the manual states that the key of the "characters"
>>>   table is the "internal code TeX knows this character by". How do
>>>   I determine this code? Is this simply the Unicode code point?

You do not have to determine that code, you are defining it by
feeding a specific 'characters' array back into the define_font
callback.

If your text has to be hyphenated and your hyphenation patterns are
true Unicode, then this had better be a Unicode code point.

Proper Unicode patterns is our recommended practise, but characters
array deviations are useful for symbolic fonts and for language+font
combinations that are hard to express in Unicode (patterns have to
be UTF-8 encoded, but there is no strict requirement for Unicode
compliance).

> Now I'm back to confused. How is this my choice? Let's say I have an
> input file with character "?". Would its "internal code TeX knows
> this character by" be Unicode's "LATIN CAPITAL LETTER A WITH DIAERESIS"
> (00C4)? If yes: So in order to add this character to an OT1-font, would
> I simply add it to the "characters" table with key hex C4 (and an
> appropriate command table)?

Yes, spot on.

> If I have a command table "char 23; char 42", will character number 42
> be typeset on top of character 23, or to the right? (yes, it does, as
> Taco answered) Could this be added to the manual, to make the behaviour
> of the "char" font command clearer? (since some other commands explicitely
> state of they move the output pointer)

I will be fixing the manual in the coming weeks. Your questions are
helping a lot in that they make it clear where further explanations
are needed.

Best wishes,
Taco

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 15:52:58 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 15:52:58 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <4756A70C.2030107@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>

Hello,

> I have just released the new beta for luatex, with version 
> number now at 0.20.0. This will be the last beta with big 
> changes in it for a while: I will start work on the mplib 
> project now, and that will be my main focus for the coming 
> two/three months. I have planned for bug-fix releases for 
> this beta, though.

Great news!

What does this mean for the further development of LuaTeX?
I would guess that the fourth stage, as defined on LuaTeX's
homepage, is now finished. Still:

- Apart from integrating MetaPost and the TODO list in the
  manual, is LuaTeX feature-complete?

- Can the Lua interface be considered as being (more or less)
  stable?

- What is planned between 2008 and 2010?

> * Completely overhauled hyphenation and ligkern application,
>    including the addition of a new "lang" table in lua to
>    interface to the language parameters, some extra functions
>    in the "node" table, and a few extra callbacks ("hyphenate",
>    "ligaturing", "kerning", "post_linebreak_filter").

This is a really, really great change from the original TeX,
especially:

- "--" does not insert a discretionary (well, if \exhyphenchar
  is set to 0).

- \hyphenation can contain complex discretionaries, thus allowing
  automatic changes such as backen => bak-ken ("to bake").

> * a bunch of bugs reported on the mailing list have been
>    fixed (I hope all of them).

I'm afraid to ask: What about font expansion? ;-)

> Have fun,

I will. I guess I will dump eTeX as the required engine for my
private format and use LuaTeX all the way. No more active characters
for input and output encoding, better key-value processing ...
nice!

Well, as soon as I have figured out how to correctly load OpenType
fonts ... incidentally, that is an place the manual could use some
work: Section 4.12.2 explains how to get a metrics table from an
OpenType font -- but now, what this metrics table contains. That
makes it quite difficult to convert it to a tfm font table.


> Taco

Jonathan


From yannis.haralambous at enst-bretagne.fr  Wed Dec  5 15:57:42 2007
From: yannis.haralambous at enst-bretagne.fr (Yannis Haralambous)
Date: Wed, 5 Dec 2007 15:57:42 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
Message-ID: <33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr>

check <http://luatex.bluwiki.com/>

Le 5 d?c. 07 ? 15h52, Jonathan Sauer a ?crit :

> Well, as soon as I have figured out how to correctly load OpenType
> fonts ... incidentally, that is an place the manual could use some
> work: Section 4.12.2 explains how to get a metrics table from an
> OpenType font -- but now, what this metrics table contains. That
> makes it quite difficult to convert it to a tfm font table.

--
+--------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at enst-bretagne.fr |
| Directeur d'?tudes                   http://omega.enstb.org/yannis |
|                                          Tel. +33 (0)2.29.00.14.27 |
|                                          Fax  +33 (0)2.29.00.12.82 |
| D?partement Informatique                                           |
| T?L?COM Bretagne                                                   |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3, France  |
| Coordonn?es Google-Earth : 48?21'31.57"N 4?34'16.76"W              |
+--------------------------------------------------------------------+
                          ...pour distinguer l'ext?rieur d'un aquarium,
                                         mieux vaut n'?tre pas poisson

                         ...the ball I threw while playing in the park
                                        has not yet reached the ground

            Es gab eine Zeit, wo ich nur ungern ?ber Schubert sprechen,
         nur N?chtens den B?umen und Sternen von ihm vorerz?hlen m?gen.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071205/e6ff9824/attachment.html 

From arthur.reutenauer at normalesup.org  Wed Dec  5 15:37:02 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 5 Dec 2007 15:37:02 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <4756A70C.2030107@elvenkind.com>
References: <4756A70C.2030107@elvenkind.com>
Message-ID: <20071205143702.GA15825@phare.normalesup.org>

> I have just released the new beta for luatex, with version
> number now at 0.20.0.

  Great news!  The Mac OS binaries are up on the Sup?lec foundry.

	Arthur

From arthur.reutenauer at normalesup.org  Wed Dec  5 16:07:40 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 5 Dec 2007 16:07:40 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr>
Message-ID: <20071205150740.GC15825@phare.normalesup.org>

> check <http://luatex.bluwiki.com/>

  Especially http://luatex.bluwiki.com/go/Use_a_TrueType_font ... it's
quite basic, but it should give you the idea.  After defining the
callback, you can use \font with any OpenType or TrueType font file name
(provided it's found by kpathsea).

  It fails to address CFF-based composite fonts, that said (a format
mostly used for CJK fonts, I guess).

	Arthur

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 16:08:31 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 16:08:31 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <4756A70C.2030107@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB0C@s-yellow.net.silverstroke.de>

Hello,

[loading OpenType fonts]	

> check <http://luatex.bluwiki.com/> 

I did. Unfortunately, the result was a PDF file with invisible
text. Also, the example seems to be quite incomplete, i.e.
slanted fonts are not handled correctly. That's why I'm
interested in the format of the OTF font metrics table: To
be able to take a more complete and also more systematic
approach. I want to understand what I am copying where and
why.


Jonathan


From pragma at wxs.nl  Wed Dec  5 16:11:33 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 05 Dec 2007 16:11:33 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
Message-ID: <4756BFA5.6050206@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
>> I have just released the new beta for luatex, with version 
>> number now at 0.20.0. This will be the last beta with big 
>> changes in it for a while: I will start work on the mplib 
>> project now, and that will be my main focus for the coming 
>> two/three months. I have planned for bug-fix releases for 
>> this beta, though.
> 
> Great news!
> 
> What does this mean for the further development of LuaTeX?
> I would guess that the fourth stage, as defined on LuaTeX's
> homepage, is now finished. Still:
> 
> - Apart from integrating MetaPost and the TODO list in the
>   manual, is LuaTeX feature-complete?

No, there will be more callbacks, for instance in the page building 
stage, more control over inserts, etc. Also, the backend will be redone 
(separation, more control over pdf, image inclusions). Parts will be 
rewritten in C instead of pascal. Font data structures will be extended 
(esp protruding and hz vectors), etc etc

> - Can the Lua interface be considered as being (more or less)
>   stable?

no, it's a beta after all, but for the existing features and interfaces 
no fundamental changes will take place; between the previous and current 
beta there have been changes; around tug 2008 much will be stable (first 
formal release), at eurotex 2009 we plan to release the version where at 
least documented parts of the interface are frozen.

> - What is planned between 2008 and 2010?

well, we have a wish list, but hen we have enough lua callbacks we may 
not need to add much; eventually there will be a tex kernel (in c) with 
a c interface; currently global properties will become structures, maybe 
we will be abel to run multiple instances .. who knowns

>> * Completely overhauled hyphenation and ligkern application,
>>    including the addition of a new "lang" table in lua to
>>    interface to the language parameters, some extra functions
>>    in the "node" table, and a few extra callbacks ("hyphenate",
>>    "ligaturing", "kerning", "post_linebreak_filter").
> 
> This is a really, really great change from the original TeX,
> especially:

intended -)

> - "--" does not insert a discretionary (well, if \exhyphenchar
>   is set to 0).
> 
> - \hyphenation can contain complex discretionaries, thus allowing
>   automatic changes such as backen => bak-ken ("to bake").
> 
>> * a bunch of bugs reported on the mailing list have been
>>    fixed (I hope all of them).
> 
> I'm afraid to ask: What about font expansion? ;-)

next year ... data tables (currently global) will move to fonts, maybe 
real alternative glyph support, etc

>> Have fun,
> 
> I will. I guess I will dump eTeX as the required engine for my
> private format and use LuaTeX all the way. No more active characters
> for input and output encoding, better key-value processing ...
> nice!

> Well, as soon as I have figured out how to correctly load OpenType
> fonts ... incidentally, that is an place the manual could use some
> work: Section 4.12.2 explains how to get a metrics table from an
> OpenType font -- but now, what this metrics table contains. That
> makes it quite difficult to convert it to a tfm font table.

this is not for the manual, since there are many implementations 
possible and the whole idea behind luatex is that we only provide 
interfaces, no solutions; we have plans to write a luatex book (starting 
next year) that may contain example code

so, for the moment, consider it an experiment, next year, consider it 
reality and after that integration with macropackages will follow (well, 
up to he macro package writers of course)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Wed Dec  5 16:15:37 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 5 Dec 2007 16:15:37 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0C@s-yellow.net.silverstroke.de>
References: <33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr>
	<9343542E664B894484613D106D7D3F5F84AB0C@s-yellow.net.silverstroke.de>
Message-ID: <20071205151537.GD15825@phare.normalesup.org>

> I did. Unfortunately, the result was a PDF file with invisible
> text.

  That's interesting :-)  What font did you use?  Could you maybe send
it offline?

> slanted fonts are not handled correctly.

  Again, what sort of slanted fonts?  Any font with a non-zero slant?

	Arthur

From preining at logic.at  Wed Dec  5 16:21:31 2007
From: preining at logic.at (Norbert Preining)
Date: Wed, 5 Dec 2007 16:21:31 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <4756A70C.2030107@elvenkind.com>
References: <4756A70C.2030107@elvenkind.com>
Message-ID: <20071205152131.GA30712@gamma.logic.tuwien.ac.at>

Hi Taco!

Thanks a lot for the new release, soon there will be packages for linux
build on various archs on Debian.

On point:

On Mi, 05 Dez 2007, Taco Hoekwater wrote:
> * the lua functions os.sleep(), os.times(), os.gettimeofday()
>    and os.tmpdir() have been added.

os.tmpdir always tries to create a directory in . which is bad if it
happens that you are in /.

I changed the function so that it takes an argument = template, and in
case there is no argument tries . as before:

change os.tmpdir so that it takes an argument for template
Author: Norbert Preining <preining at logic.at>
License: GPLv2
---
 src/texk/web2c/luatexdir/lua/loslibext.c |   11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

Index: luatex-0.20.0/src/texk/web2c/luatexdir/lua/loslibext.c
===================================================================
--- luatex-0.20.0.orig/src/texk/web2c/luatexdir/lua/loslibext.c	2007-12-05 13:41:29.000000000 +0100
+++ luatex-0.20.0/src/texk/web2c/luatexdir/lua/loslibext.c	2007-12-05 16:12:20.000000000 +0100
@@ -305,7 +305,16 @@
 
 static int os_tmpdir (lua_State *L) {
   char *s; 
-  char tempdir[] = "luatex.XXXXXX";
+  char *ret = (char *)luaL_optstring(L, 1, "luatex.XXXXXX");
+  char *tempdir;
+  if (ret) {
+    tempdir = strdup(ret);
+  } else {
+    int en = errno;
+    lua_pushnil(L);
+    lua_pushfstring(L, "%s", strerror(en));
+    return 2;
+  }
 #ifdef HAVE_MKDTEMP
   s = mkdtemp(tempdir);
 #else

I have NO idea whatsoever on lua programming, parts of it were copied
from other sources and adapted etc. Please use whatever you need and fix
the errors. I tested it with texdoclua and 
	os.tmpdir("/tmp/texdoc.XXXXXX")
and it worked.

It would be nice if you could include that into upstream, thanks

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
TUMBY (n.)
The involuntary abdominal gurgling which fills the silence following
someone else's intimate personal revelation.
			--- Douglas Adams, The Meaning of Liff

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 16:22:31 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 16:22:31 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <33ADC055-AE8B-46FD-9A54-9A3826E4E90C@enst-bretagne.fr><9343542E664B894484613D106D7D3F5F84AB0C@s-yellow.net.silverstroke.de>
	<20071205151537.GD15825@phare.normalesup.org>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>

Hello,

> > I did. Unfortunately, the result was a PDF file with invisible text.
> 
> That's interesting :-)  What font did you use?  Could you 
> maybe send it offline?

Tomorrow, after incorporating some fixes from this mailing list. I
used Latin Modern Roman. The characters were in the PDF, the font
as well, but they were invisible and all at the same position.

> > slanted fonts are not handled correctly.
> 
>   Again, what sort of slanted fonts?  Any font with a non-zero slant?

Well, any italic font should have a non-zero slant to be used by TeX
for italic correction. At least as far as I remember.


> 	Arthur

Jonathan


From arthur.reutenauer at normalesup.org  Wed Dec  5 16:34:46 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 5 Dec 2007 16:34:46 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>
References: <20071205151537.GD15825@phare.normalesup.org>
	<9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>
Message-ID: <20071205153445.GF15825@phare.normalesup.org>

> Tomorrow, after incorporating some fixes from this mailing list. I
> used Latin Modern Roman. The characters were in the PDF, the font
> as well, but they were invisible and all at the same position.

  Strange, that's not what I have here with a very simple test.  If you
could send an exact example file some day, I would be very interested,
and I'm sure Taco would be as well.

> Well, any italic font should have a non-zero slant to be used by TeX
> for italic correction. At least as far as I remember.

  Oh, italic correction.  Then sure :-)

	Arthur

From Jonathan.Sauer at silverstroke.com  Wed Dec  5 16:41:33 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 5 Dec 2007 16:41:33 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<4756BFA5.6050206@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>

Hello,

> > - What is planned between 2008 and 2010?
> 
> well, we have a wish list, but hen we have enough lua callbacks we may

> not need to add much; eventually there will be a tex kernel (in c)
with 
> a c interface; currently global properties will become structures,
maybe 
> we will be abel to run multiple instances .. who knowns

What do you mean by the latter?

> > Well, as soon as I have figured out how to correctly load OpenType
> > fonts ... incidentally, that is an place the manual could use some
> > work: Section 4.12.2 explains how to get a metrics table from an
> > OpenType font -- but now, what this metrics table contains. That
> > makes it quite difficult to convert it to a tfm font table.
> 
> this is not for the manual, since there are many implementations 
> possible and the whole idea behind luatex is that we only provide 
> interfaces, no solutions;

Sure, but examples on how to use these interfaces can go a long way.
And IMO a documentation of the OpenType font metrics table is indeed
for the manual. Otherwise, how should one be able to create a solution?

> we have plans to write a luatex book (starting next year) that
> may contain example code

A book on dead trees? Considering the pace at which LuaTeX develops
(and most likely will continue to develop, considering above roadmap),
I wonder if this book will not either be in the stores too late or
out of date.

> so, for the moment, consider it an experiment, next year, consider it 
> reality and after that integration with macropackages will 
> follow (well, up to he macro package writers of course)

Who can only write code if they have the documentation.


> Hans

Jonathan


From taco at elvenkind.com  Wed Dec  5 17:41:16 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 05 Dec 2007 17:41:16 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <20071205152131.GA30712@gamma.logic.tuwien.ac.at>
References: <4756A70C.2030107@elvenkind.com>
	<20071205152131.GA30712@gamma.logic.tuwien.ac.at>
Message-ID: <4756D4AC.6050406@elvenkind.com>



Norbert Preining wrote:
> 
> It would be nice if you could include that into upstream, thanks

Sure, that functionality will be added.

Best wishes,

Taco



From pragma at wxs.nl  Wed Dec  5 22:52:51 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 05 Dec 2007 22:52:51 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <20071205153445.GF15825@phare.normalesup.org>
References: <20071205151537.GD15825@phare.normalesup.org>	<9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>
	<20071205153445.GF15825@phare.normalesup.org>
Message-ID: <47571DB3.3040203@wxs.nl>

Arthur Reutenauer wrote:

>   Oh, italic correction.  Then sure :-)

there is no such feature in open type but we're discussing (tex gyre 
team) to register such a feature

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Dec  5 22:58:53 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 05 Dec 2007 22:58:53 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
Message-ID: <47571F1D.2030403@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
>>> - What is planned between 2008 and 2010?
>> well, we have a wish list, but hen we have enough lua callbacks we may
> 
>> not need to add much; eventually there will be a tex kernel (in c)
> with 
>> a c interface; currently global properties will become structures,
> maybe 
>> we will be abel to run multiple instances .. who knowns
> 
> What do you mean by the latter?

if a tex engine can be properly isolated one can think of starting a new 
instance

> Sure, but examples on how to use these interfaces can go a long way.
> And IMO a documentation of the OpenType font metrics table is indeed
> for the manual. Otherwise, how should one be able to create a solution?

by consulting documentation (fontforge, ms site, adobe) ... of just 
looking into the lua table ... there are many variations in fonts and 
features; type 1, open type, what-comes-next ...  such standards (sic) 
have their own documentation

> A book on dead trees? Considering the pace at which LuaTeX develops
> (and most likely will continue to develop, considering above roadmap),
> I wonder if this book will not either be in the stores too late or
> out of date.

well, at some point luatex will be pretty stable ... just like tex 
itself; what macro packages do with luatex is not part of that kin dof 
documentation

> Who can only write code if they have the documentation.

indeed, but look at good old tex ... eventually macro packages evolved 
that go way behind plain tex; also, i could write thousands of pages 
about how *i* do thinsg but that may not be the way you want to do it 
(and i'm pretty sure that the context mkiv color model is different from 
what e.g. latex does).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From yannis.haralambous at enst-bretagne.fr  Wed Dec  5 23:26:43 2007
From: yannis.haralambous at enst-bretagne.fr (Yannis Haralambous)
Date: Wed, 5 Dec 2007 23:26:43 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <47571DB3.3040203@wxs.nl>
References: <20071205151537.GD15825@phare.normalesup.org>	<9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>
	<20071205153445.GF15825@phare.normalesup.org>
	<47571DB3.3040203@wxs.nl>
Message-ID: <546C4F66-E023-4D87-B853-8135009CA1BB@enst-bretagne.fr>

You don't need it if you put italic and roman glyphs in the same font.

Le 5 d?c. 07 ? 22h52, Hans Hagen a ?crit :

> there is no such feature in open type but we're discussing (tex gyre
> team) to register such a feature

--
+--------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at enst-bretagne.fr |
| Directeur d'?tudes                   http://omega.enstb.org/yannis |
|                                          Tel. +33 (0)2.29.00.14.27 |
|                                          Fax  +33 (0)2.29.00.12.82 |
| D?partement Informatique                                           |
| T?L?COM Bretagne                                                   |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3, France  |
| Coordonn?es Google-Earth : 48?21'31.57"N 4?34'16.76"W              |
+--------------------------------------------------------------------+
                          ...pour distinguer l'ext?rieur d'un aquarium,
                                         mieux vaut n'?tre pas poisson

                         ...the ball I threw while playing in the park
                                        has not yet reached the ground

            Es gab eine Zeit, wo ich nur ungern ?ber Schubert sprechen,
         nur N?chtens den B?umen und Sternen von ihm vorerz?hlen m?gen.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071205/977542ed/attachment.html 

From dak at gnu.org  Thu Dec  6 00:38:24 2007
From: dak at gnu.org (David Kastrup)
Date: Thu, 06 Dec 2007 00:38:24 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <47571F1D.2030403@wxs.nl> (Hans Hagen's message of "Wed, 05 Dec
	2007 22:58:53 +0100")
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<4756BFA5.6050206@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
	<47571F1D.2030403@wxs.nl>
Message-ID: <85k5nssoen.fsf@lola.goethe.zz>

Hans Hagen <pragma at wxs.nl> writes:

> Jonathan Sauer wrote:
>
>> A book on dead trees? Considering the pace at which LuaTeX develops
>> (and most likely will continue to develop, considering above
>> roadmap), I wonder if this book will not either be in the stores too
>> late or out of date.
>
> well, at some point luatex will be pretty stable ... just like tex
> itself; what macro packages do with luatex is not part of that kin dof
> documentation

I think that would be a bad idea.  The TeXbook, for example, does not
restrict itself to documenting only primitives.  Instead, a reasonable
working macro set plainTeX (including allocation and user-level accent
generating macros and lots of other basic stuff built from primitives)
is the basis of the book throughout.

>> Who can only write code if they have the documentation.
>
> indeed, but look at good old tex ... eventually macro packages evolved
> that go way behind plain tex;

But plain TeX is a macro package, too.  It has become more or less
ubiquitous in its interface (though internals like \loop, \tt and other
stuff obviously are not the original definitions of plain TeX), but it
certainly still _is_ a macro package.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From arthur.reutenauer at normalesup.org  Thu Dec  6 09:00:29 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 09:00:29 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <85k5nssoen.fsf@lola.goethe.zz>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<4756BFA5.6050206@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
	<47571F1D.2030403@wxs.nl> <85k5nssoen.fsf@lola.goethe.zz>
Message-ID: <20071206080029.GC25182@phare.normalesup.org>

> I think that would be a bad idea.  The TeXbook, for example, does not
> restrict itself to documenting only primitives.  Instead, a reasonable
> working macro set plainTeX (including allocation and user-level accent
> generating macros and lots of other basic stuff built from primitives)
> is the basis of the book throughout.

  So the obvious solution would be Hans and Yannis sitting down together
to write a book about both the technical and theoretical aspects, with
Hans describing ConTeXt and Yannis enhancing _Fonts and Encodings_
And Taco supervising :-)

  (Yeah, never gonna happen.  *I know*)

	Arthur ;-)

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 09:18:20 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 09:18:20 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
Message-ID: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>

Hello,

while typesetting a document of mine (just to check if my documents
still work with the new LuaTeX beta), I got the following result
(I used Arthur's build for OS X):

-----------------------------------------------------------------

This is LuaTeX, Version snapshot-0.20.0-2007120515 (Web2C 7.5.6)
(Schwarzfahren.tex
(/Dokumente/Writing/trunk/Writing/DerProzess/TeX/tex/prozess.kprj
[more included files]
(Schwarzfahren.aux../../../../src/texk/web2c/luatexdir/tex/linebreak.c:215: failed assertion `vlink(alink(r))==r'
))Abort trap

-----------------------------------------------------------------

I was unable to determine what exactly caused the assertion.
Unfortunately, the document uses neither LaTeX nor Context nor
PlainTeX, so I am also unable to post it here (unless I would post
the macros as well). The raw text (without umlauts and headings)
can be typeset correctly using PlainTeX.

A more detailed log (with TeX's tracing turned on):

-----------------------------------------------------------------

\BT:centerLine #1->\:noindent \BT:strut \:hfill #1\:hfill \BT:strut \:par 
#1<-Schwarzfahren
{\noindent}

\BT:strut ->\:relax \:ifmmode \:copy \:strutbox \:else \:unhcopy \:strutbox \:f
i 
{horizontal mode: \relax}
{\ifmmode}
{false}
{\unhcopy}
{\fi}
{\hfill}
{the letter S}
{\hfill}

\BT:strut ->\:relax \:ifmmode \:copy \:strutbox \:else \:unhcopy \:strutbox \:f
i 
{\relax}
{\ifmmode}
{false}
{\unhcopy}
{\fi}
{\par}
@firstpass
[]| \FS:O at font@t1/lmss/r/r/n/n/10 at font Schwarz-fah-ren 
@ via @@0 b=0 p=0 d=100
@@1: line 1.2 t=100 -> @@0
| 
@\par via @@0 b=0 p=-10000 d=100
@\par via @@1 b=0 p=-10000 d=100
@@2: line 1.2- t=100 -> @@0

../../../../src/texk/web2c/luatexdir/tex/linebreak.c:215: failed assertion `vlink(alink(r))==r'
Abort trap

-----------------------------------------------------------------

Also a little bit above this trace, while creating the current
strut box, there are some weird "reassigning" messages:

-----------------------------------------------------------------

{\setbox}
{entering hbox group (level 2) at line 33}
{reassigning [unknown integer parameter!]=0}
{reassigning [unknown integer parameter!]=0}
{reassigning [unknown integer parameter!]=0}
{changing [level_local_dir]=1}
{into [level_local_dir]=3}
{restricted horizontal mode: \vrule}

-----------------------------------------------------------------

If I disable font switches, a little bit more text is typeset before
LuaTeX aborts with the same assertion. The text fragment typeset is
(the \section results in "Einziges Kapitel: Berufswahl..." as seen
below):

-----------------------------------------------------------------

\chapter{Schwarzfahren}<
	preamble=	{Februar `12},
	label=	{12.Schwarzfahren},
>

\section{Berufswahl per Ausschlu?verfahren}<
	preamble=	{Worin ein ungest?rtes Pl?tzchen (noch) eine 
			Stra?enbahnreise entfernt ist; ein Generalverdacht 
			wird bedenkenlos akzeptiert; ein Gl?cksspieler 
			verliert das Spiel; und eine Frage wird lieber nicht 
			gestellt.},
	datewritten={????/??/??, 2007/11/26},
>

-----------------------------------------------------------------

And the trace (also note how TeX's primitives are traced with
their original name and not the name they have in the macros):

-----------------------------------------------------------------

[now the \chapter's title is typeset]

\BT:centerLine #1->\:noindent \BT:strut \:hfill #1\:hfill \BT:strut \:par 
#1<-Schwarzfahren
{\noindent}

\BT:strut ->\:relax \:ifmmode \:copy \:strutbox \:else \:unhcopy \:strutbox \:f
i 
{horizontal mode: \relax}
{\ifmmode}
{false}
{\unhcopy}
{\fi}
{\hfill}
{the letter S}
{\hfill}

\BT:strut ->\:relax \:ifmmode \:copy \:strutbox \:else \:unhcopy \:strutbox \:f
i 
{\relax}
{\ifmmode}
{false}
{\unhcopy}
{\fi}
{\par}
@firstpass
[] Schwarz-fah-ren 
@\par via @@0 b=0 p=-10000 d=100
@@1: line 1.2- t=100 -> @@0

%% goal height=431.24408, max depth=4.0
% t=0.0 g=431.24408 b=10000 p=0 c=100000#

\BT:suppressNextParIndent ->\:begingroup \:edef \:Mi {\:the \:everypar }\:expan
dafter \:endgroup \:ifx \:Mi \:empty \:global \:everypar {\:global \:everypar {
}{\:setbox \:z \:lastbox }}\:else \:global \:everypar \:expandafter {\:expandaf
ter \:global \:expandafter \:everypar \:expandafter {\:the \:everypar }{\:setbo
x \:z \:lastbox }\:the \:everypar }\:fi 

[about 10000 lines of trace inbetween, mostly key-value processing]

[now the \section's title immediately after the \chapter is typeset]

\CF:first:b #1->#1
#1<-: Berufswahl per Ausschlu?verfahren
{blank space  }
{the letter B}
{blank space  }
{the letter p}
{blank space  }
{the letter A}

?->\EX:protect \OE:ssharp 

\EX:protect ->

\OE:ssharp ->\:char 255 
{\par}
@firstpass
[]Ein-zi-ges
@ via @@0 b=0 p=0 d=100
@@1: line 1.2 t=100 -> @@0
Ka-pi-tel:
@ via @@0 b=0 p=0 d=100
@ via @@1 b=0 p=0 d=100
@@2: line 1.2 t=100 -> @@0
Be-rufs-wahl
@ via @@0 b=0 p=0 d=100
@ via @@1 b=0 p=0 d=100
@ via @@2 b=0 p=0 d=100
@@3: line 1.2 t=100 -> @@0
per
@ via @@0 b=0 p=0 d=100
@ via @@1 b=0 p=0 d=100
@ via @@2 b=0 p=0 d=100
@ via @@3 b=0 p=0 d=100
@@4: line 1.2 t=100 -> @@0
Aus-schlu?-ver-fah-ren 
@\par via @@0 b=0 p=-10000 d=100
@\par via @@1 b=0 p=-10000 d=100
@\par via @@2 b=0 p=-10000 d=100
@\par via @@3 b=0 p=-10000 d=100
@\par via @@4 b=0 p=-10000 d=100
@@5: line 1.2- t=100 -> @@0

../../../../src/texk/web2c/luatexdir/tex/linebreak.c:215: failed assertion `vlink(alink(r))==r'
Abort trap

-----------------------------------------------------------------

(LuaTeX beta 0.11.2 worked correctly)

@Taco: What do you need to narrow this down? I can try to create a
PlainTeX document exhibiting the same behaviour. Or maybe you could
include some more tracing of the line breaking algorithm (just
temporarily, in the trunk), and I send you the log file of the run.

The document uses the "process_input_buffer" callback to convert
vom MacRoman to UTF-8. It uses Latin Modern, T1 encoding. It uses a
simple OTR with a single column as well as a simple header and footer.
It does not use any specials, but the pdfTeX color stack. It uses
Context's UTF-8 hyphenation patterns for traditional german, slightly
modified to include "y diaresis" as a synonym for "s sharp".


Jonathan


From taco at elvenkind.com  Thu Dec  6 09:23:13 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 09:23:13 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
Message-ID: <4757B171.2070409@elvenkind.com>

Jonathan Sauer wrote:
> 
> - What is planned between 2008 and 2010?

A really long vacation ;-)

> I'm afraid to ask: What about font expansion? ;-)

I will *try* to get back to this inbetween mplib work, as it is
really just a bug that it doesn't work. But I'm afraid to make
promises, as it turned out to be a lot more hairy then I expected
originally thought. Sorry about the false hope.

> Well, as soon as I have figured out how to correctly load OpenType
> fonts ... incidentally, that is an place the manual could use some
> work: Section 4.12.2 explains how to get a metrics table from an
> OpenType font -- but now, what this metrics table contains. That
> makes it quite difficult to convert it to a tfm font table.

There is a pretty long section on the fontforge font format, but
it has almost no explanatory text yet. I'll be working on that.

Best wishes,
Taco

From adityam at umich.edu  Thu Dec  6 10:34:20 2007
From: adityam at umich.edu (Aditya Mahajan)
Date: Thu, 6 Dec 2007 04:34:20 -0500 (EST)
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <20071206080029.GC25182@phare.normalesup.org>
References: <4756A70C.2030107@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>
	<4756BFA5.6050206@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
	<47571F1D.2030403@wxs.nl> <85k5nssoen.fsf@lola.goethe.zz>
	<20071206080029.GC25182@phare.normalesup.org>
Message-ID: <alpine.DEB.0.9999.0712060430370.17414@nqv-yncgbc>

On Thu, 6 Dec 2007, Arthur Reutenauer wrote:

>> I think that would be a bad idea.  The TeXbook, for example, does not
>> restrict itself to documenting only primitives.  Instead, a reasonable
>> working macro set plainTeX (including allocation and user-level accent
>> generating macros and lots of other basic stuff built from primitives)
>> is the basis of the book throughout.
>
>  So the obvious solution would be Hans and Yannis sitting down together
> to write a book about both the technical and theoretical aspects, with
> Hans describing ConTeXt and Yannis enhancing _Fonts and Encodings_
> And Taco supervising :-)
>
>  (Yeah, never gonna happen.  *I know*)

Lets make things simpler. How about a book just explaining the techincal 
aspects of ConTeXt MkIV (yeah, yeah, I know ... but worth a try :-)

Aditya

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 09:08:06 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 09:08:06 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <20071205151537.GD15825@phare.normalesup.org><9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>
	<20071205153445.GF15825@phare.normalesup.org>
Message-ID: <9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>

Hello,

> > Tomorrow, after incorporating some fixes from this mailing list. I
> > used Latin Modern Roman. The characters were in the PDF, the font
> > as well, but they were invisible and all at the same position.
> 
> Strange, that's not what I have here with a very simple test.  If you
> could send an exact example file some day, I would be very interested,
> and I'm sure Taco would be as well.

First of all, an apology: While complaining about a missing fontforge
table documentation, I completely overlooked section 13.

Now, after incorporating the fixes (concerning scaling), everything
worked. I attached the PlainTeX source as a UTF-8 document (please
remove the BOM at the beginning to prevent LuaTeX from
complaining about a missing character 65xxx).

However (an excerpt from the attached document, I hope the diacritics
are not lost):

----------------------------------------------------------------------

\font\textfont=lmroman10-regular at 10pt % (A)
% \font\textfont=lmroman10-bold scaled 1000 % (B)
% \font\textfont=lmroman10-bold % (C)

\textfont

L??t?x s?r? ?s gr??t! fi ffi AV


\bye

----------------------------------------------------------------------

(A) works perfectly.


(B) and (C) produce (C most likely because 'scaled 1000' is the default):

This is LuaTeX, Version snapshot-0.20.0-2007120515 (Web2C 7.5.6)
(OTFTest.texLoading font /usr/local/teTeX/share/texmf.tetex/fonts/opentype/publ
ic/lm/lmroman10-bold.otf [1{/usr/local/teTeX/share/texmf.local/fonts/map/pdftex
/updmap/pdftex.map}
! pdfTeX error (arithmetic): divided by zero.
\plainoutput ...headline \pagebody \makefootline }
                                                  \advancepageno \ifnum \out...
<output> {\plainoutput 
                       }
\supereject ->\par \penalty -\@MM 
                                  
\bye ->\par \vfill \supereject 
                               \end 
l.91 \bye
         
!  ==> Fatal error occurred, no output PDF file produced

Changing the output routine to '\output{}' only changes the "stack trace".


(D) creates some strange output:

 012345678901234567890123456789
 012345678901234567890123456789
 0
12345678901234567890123456789
 012345678901234567890123456789

It seems that texio.write does not reset its internal line length counter
then writing a "\n". Also, there is a leading space for some reason.

BTW: Is it possible to add a function which does not wrap after 80
characters? Or maybe the wrapping is completely obsolete (though I am
not sure about tracing TeX code).


Another weird thing: The Latin Modern font contains ligatures, but they are
not put inside a "ligatures" table. Example: "f" (simple output of the
fontforge glyph table using code from the Lua wiki):

[{boundingbox={33,0,357,705},kerns={{char="quotedblright.cm",off=28,lookup="pp_
l_1_s"},{char="quotedblleft.cm",off=28,lookup="pp_l_1_s"},{char="quotedblright"
,off=28,lookup="pp_l_1_s"},{char="quotedblleft",off=28,lookup="pp_l_1_s"},{char
="quoteright",off=28,lookup="pp_l_1_s"},{char="quoteleft",off=28,lookup="pp_l_1
_s"},{char="bracketright",off=28,lookup="pp_l_1_s"},{char="question",off=28,loo
kup="pp_l_1_s"},{char="parenright",off=28,lookup="pp_l_1_s"},{char="exclam",off
=28,lookup="pp_l_1_s"}},name="f",unicodeenc=102,width=306}]

"f" contains a "fi" ligature:

[{lookups={ls_l_10_s={{type="ligature",specification={char="f_i",components="f 
i"}}}},boundingbox={27,0,527,705},name="f_i",unicodeenc=64257,width=556}]

But this ligature is not associated with the "f" letter in any way. Is this a
bug in the font? In LuaTeX? In the manual?

I installed the font in OS X 10.4 and used it in TextEdit (which supports
OpenType ligatures), and fi and other ligatures were inserted correctly.
So I would guess that the font is OK.

The font's version is 1.010.


And finally: "design_size" vs. "designsize" ...


> 	Arthur

Jonathan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: OTFTest_ML.tex
Type: application/octet-stream
Size: 5774 bytes
Desc: OTFTest_ML.tex
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071206/0163d992/attachment.obj 

From pragma at wxs.nl  Thu Dec  6 11:19:23 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 11:19:23 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <alpine.DEB.0.9999.0712060430370.17414@nqv-yncgbc>
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>	<47571F1D.2030403@wxs.nl>
	<85k5nssoen.fsf@lola.goethe.zz>	<20071206080029.GC25182@phare.normalesup.org>
	<alpine.DEB.0.9999.0712060430370.17414@nqv-yncgbc>
Message-ID: <4757CCAB.9090503@wxs.nl>

Aditya Mahajan wrote:

> Lets make things simpler. How about a book just explaining the techincal 
> aspects of ConTeXt MkIV (yeah, yeah, I know ... but worth a try :-)

maybe ... combined with a practical mkiv manual ... definitely not a 
one-author project, but also not something to discuss on this list -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Dec  6 09:18:40 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 09:18:40 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <85k5nssoen.fsf@lola.goethe.zz>
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>	<47571F1D.2030403@wxs.nl>
	<85k5nssoen.fsf@lola.goethe.zz>
Message-ID: <4757B060.60203@elvenkind.com>

David Kastrup wrote:
> 
> The TeXbook, for example, does not restrict itself to documenting 
> only primitives. 

Opinions about the TeXbook vary, but it is definately true that the
user-manual and reference-manual are intertwined in a way that makes
it less than ideal on both accounts. For luatex, we really want two
separate books, much like the lua manuals.

Actually, there is little point in starting to write a user manual
right now, because so much still changes (0.20 is one-fifth of one).

Best wishes,
Taco

From root at www.bittext.nl  Thu Dec  6 12:22:04 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Thu,  6 Dec 2007 12:22:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071206112250.81B8B1E8C2BC@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/lua/luainit.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/loslibext.c
 Checked out revision 937.

From taco at elvenkind.com  Thu Dec  6 12:36:21 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 12:36:21 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
Message-ID: <4757DEB5.9050803@elvenkind.com>



Jonathan Sauer wrote:
> -----------------------------------------------------------------
> 
> I was unable to determine what exactly caused the assertion.

The assertion is triggered by \pdfprotrudechars. I will try
to find the bug, more later.

Best wishes,
Taco



From pragma at wxs.nl  Thu Dec  6 12:39:03 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 12:39:03 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
References: <20071205151537.GD15825@phare.normalesup.org><9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>	<20071205153445.GF15825@phare.normalesup.org>
	<9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
Message-ID: <4757DF57.6040904@wxs.nl>

Jonathan Sauer wrote:

> (B) and (C) produce (C most likely because 'scaled 1000' is the default):

-1000 is the default (representing design size)

> It seems that texio.write does not reset its internal line length counter
> then writing a "\n". Also, there is a leading space for some reason.
> 
> BTW: Is it possible to add a function which does not wrap after 80
> characters? Or maybe the wrapping is completely obsolete (though I am
> not sure about tracing TeX code).

texconfig.max_print_line   = 100000

> Another weird thing: The Latin Modern font contains ligatures, but they are
> not put inside a "ligatures" table. Example: "f" (simple output of the
> fontforge glyph table using code from the Lua wiki):
> 
> [{boundingbox={33,0,357,705},kerns={{char="quotedblright.cm",off=28,lookup="pp_
> l_1_s"},{char="quotedblleft.cm",off=28,lookup="pp_l_1_s"},{char="quotedblright"
> ,off=28,lookup="pp_l_1_s"},{char="quotedblleft",off=28,lookup="pp_l_1_s"},{char
> ="quoteright",off=28,lookup="pp_l_1_s"},{char="quoteleft",off=28,lookup="pp_l_1
> _s"},{char="bracketright",off=28,lookup="pp_l_1_s"},{char="question",off=28,loo
> kup="pp_l_1_s"},{char="parenright",off=28,lookup="pp_l_1_s"},{char="exclam",off
> =28,lookup="pp_l_1_s"}},name="f",unicodeenc=102,width=306}]
> 
> "f" contains a "fi" ligature:
> 
> [{lookups={ls_l_10_s={{type="ligature",specification={char="f_i",components="f 
> i"}}}},boundingbox={27,0,527,705},name="f_i",unicodeenc=64257,width=556}]
> 
> But this ligature is not associated with the "f" letter in any way. Is this a
> bug in the font? In LuaTeX? In the manual?

you need to locate the lookup associated to the 'liga' feature and use 
that one in reverse lookups, i.e. at f_f there is a lookup that shows 
what components make up the ligature

(you could consider ignoring the lookup and just apply certain ligature 
rules anyway, say f_f, f_i etc)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Thu Dec  6 12:43:37 2007
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 6 Dec 2007 12:43:37 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
Message-ID: <6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com>

On 12/6/07, Jonathan Sauer wrote:
> Hello,
>
> while typesetting a document of mine (just to check if my documents
> still work with the new LuaTeX beta), I got the following result
> (I used Arthur's build for OS X):
>
> -----------------------------------------------------------------
>
> This is LuaTeX, Version snapshot-0.20.0-2007120515 (Web2C 7.5.6)
> (Schwarzfahren.tex
> (/Dokumente/Writing/trunk/Writing/DerProzess/TeX/tex/prozess.kprj
> [more included files]
> (Schwarzfahren.aux../../../../src/texk/web2c/luatexdir/tex/linebreak.c:215: failed assertion `vlink(alink(r))==r'
> ))Abort trap

I hope you don't mind some unrelated, off-topic jokes :)

I guess it fails because of the title (and/or content). You really
aren't supposed to take public lines or connections (links) between
them when "Schwarzfahren" :p

Mojca

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 12:51:20 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 12:51:20 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
	<4757DEB5.9050803@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB15@s-yellow.net.silverstroke.de>

Hello,

> > -----------------------------------------------------------------
> > 
> > I was unable to determine what exactly caused the assertion.
> 
> The assertion is triggered by \pdfprotrudechars. I will try 
> to find the bug, more later.

That might well be, since I use protrusion. I will verify it this
evening, when I'm at home.


> Best wishes,
> Taco

Jonathan


From Jonathan.Sauer at silverstroke.com  Thu Dec  6 13:01:50 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 13:01:50 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
Message-ID: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>

Hello,

> > This is LuaTeX, Version snapshot-0.20.0-2007120515 (Web2C 7.5.6) 
> > (Schwarzfahren.tex 
> > (/Dokumente/Writing/trunk/Writing/DerProzess/TeX/tex/prozess.kprj
> > [more included files]
> > 
> (Schwarzfahren.aux../../../../src/texk/web2c/luatexdir/tex/lin
> ebreak.c:215: failed assertion `vlink(alink(r))==r'
> > ))Abort trap
> 
> I hope you don't mind some unrelated, off-topic jokes :)
> 
> I guess it fails because of the title (and/or content). You 
> really aren't supposed to take public lines or connections 
> (links) between them when "Schwarzfahren" :p

Well, the protagonists just talk about "Schwarzfahren", they of
course have a ticket. So I think it a bit unfair of LuaTeX to
simply *assert* they don't.

Note that it also failed with a file called "UeberDemMensch.tex".
Guess LuaTeX does not like Nietzsche either.

But why? "What is Word to TeX?  A laughing-stock, a thing of shame.
And just the same shall TeX be to LuaTeX:  a laughing-stock, a thing
of shame." ;-)


> Mojca

Jonathan


From arthur.reutenauer at normalesup.org  Thu Dec  6 13:10:08 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 13:10:08 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
References: <20071205153445.GF15825@phare.normalesup.org>
	<9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
Message-ID: <20071206121008.GA6793@phare.normalesup.org>

> Now, after incorporating the fixes (concerning scaling), everything
> worked.

  Thanks, that's reassuring.  Probably in an earlier version (where I used
completely ad hoc numbers) the glyphs were reduced to 1/1000th or so :-)

  I'll look into the rest later.

	Arthur

From arthur.reutenauer at normalesup.org  Thu Dec  6 13:14:00 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 13:14:00 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
Message-ID: <20071206121400.GB6793@phare.normalesup.org>

> Well, the protagonists just talk about "Schwarzfahren", they of
> course have a ticket. So I think it a bit unfair of LuaTeX to
> simply *assert* they don't.

  Sei doch nicht so sauer, Jonathan.

  Sorry, I had to do it once :-)

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 13:21:45 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 13:21:45 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
	<20071206121400.GB6793@phare.normalesup.org>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB17@s-yellow.net.silverstroke.de>

Hello,

Arthur Reutenauer wrote:

> > Well, the protagonists just talk about "Schwarzfahren", they of
course 
> > have a ticket. So I think it a bit unfair of LuaTeX to simply
*assert* 
> > they don't.
> 
>   Sei doch nicht so sauer, Jonathan.

I'm sorry, My King!


>   Sorry, I had to do it once :-)

The same :-)


Jonathan


From taco at elvenkind.com  Thu Dec  6 13:21:59 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 13:21:59 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
Message-ID: <4757E967.4080209@elvenkind.com>

Jonathan Sauer wrote:
> 
> Well, the protagonists just talk about "Schwarzfahren", they of
> course have a ticket. So I think it a bit unfair of LuaTeX to
> simply *assert* they don't.

Actually, the assert says that the carriage that is towed around
by us is not pushing us at the same time, which is a pretty
bad thing when all those Schwarzfahrer make our engine quit
due to excessive workload; and the train therefore comes to a
grinding halt.



From arthur.reutenauer at normalesup.org  Thu Dec  6 13:26:07 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 13:26:07 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <4757E967.4080209@elvenkind.com>
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
	<4757E967.4080209@elvenkind.com>
Message-ID: <20071206122607.GA8288@phare.normalesup.org>

>                                           which is a pretty
> bad thing when all those Schwarzfahrer make our engine quit
> due to excessive workload

  So you mean this was pretty much like a "bus error: passengers dumped"?

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 13:30:31 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 13:30:31 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>
	<4757E967.4080209@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB18@s-yellow.net.silverstroke.de>

Hello,

> > Well, the protagonists just talk about "Schwarzfahren", they of
course 
> > have a ticket. So I think it a bit unfair of LuaTeX to simply
*assert* 
> > they don't.
> 
> Actually, the assert says that the carriage that is towed 
> around by us is not pushing us at the same time, which is a 
> pretty bad thing when all those Schwarzfahrer make our engine 
> quit due to excessive workload; and the train therefore comes 
> to a grinding halt.

Wait a minute. You say even though I have a ticket I have to
push the carriage? Sounds like a scam to me. Are you sure that
"NTG" does not mean "Nigeria TeX Group"?


Jonathan


From yannis.haralambous at enst-bretagne.fr  Thu Dec  6 13:43:35 2007
From: yannis.haralambous at enst-bretagne.fr (Yannis Haralambous)
Date: Thu, 6 Dec 2007 13:43:35 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
	<6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com>
Message-ID: <8C691E38-642B-422D-8C64-482AA67B9673@enst-bretagne.fr>

Le 6 d?c. 07 ? 12h43, Mojca Miklavec a ?crit :

> On 12/6/07, Jonathan Sauer wrote:
>> Hello,
>>
>> while typesetting a document of mine (just to check if my documents
>> still work with the new LuaTeX beta), I got the following result
>> (I used Arthur's build for OS X):
>>
>> -----------------------------------------------------------------
>>
>> This is LuaTeX, Version snapshot-0.20.0-2007120515 (Web2C 7.5.6)
>> (Schwarzfahren.tex
>> (/Dokumente/Writing/trunk/Writing/DerProzess/TeX/tex/prozess.kprj
>> [more included files]
>> (Schwarzfahren.aux../../../../src/texk/web2c/luatexdir/tex/ 
>> linebreak.c:215: failed assertion `vlink(alink(r))==r'
>> ))Abort trap
>
> I hope you don't mind some unrelated, off-topic jokes :)

Well, if Jonathan doesn't like the joke, he will become even more  
sauer ;-)


--
+--------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at enst-bretagne.fr |
| Directeur d'?tudes                   http://omega.enstb.org/yannis |
|                                          Tel. +33 (0)2.29.00.14.27 |
|                                          Fax  +33 (0)2.29.00.12.82 |
| D?partement Informatique                                           |
| T?L?COM Bretagne                                                   |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest CEDEX 3, France  |
| Coordonn?es Google-Earth : 48?21'31.57"N 4?34'16.76"W              |
+--------------------------------------------------------------------+
                          ...pour distinguer l'ext?rieur d'un aquarium,
                                         mieux vaut n'?tre pas poisson

                         ...the ball I threw while playing in the park
                                        has not yet reached the ground

            Es gab eine Zeit, wo ich nur ungern ?ber Schubert sprechen,
         nur N?chtens den B?umen und Sternen von ihm vorerz?hlen m?gen.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071206/699eeb90/attachment.html 

From arthur.reutenauer at normalesup.org  Thu Dec  6 13:47:38 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 13:47:38 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <8C691E38-642B-422D-8C64-482AA67B9673@enst-bretagne.fr>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
	<6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com>
	<8C691E38-642B-422D-8C64-482AA67B9673@enst-bretagne.fr>
Message-ID: <20071206124738.GC8288@phare.normalesup.org>

> Well, if Jonathan doesn't like the joke, he will become even more  
> sauer ;-)

  Trop tard :-?

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 13:58:21 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 13:58:21 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de><6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com><8C691E38-642B-422D-8C64-482AA67B9673@enst-bretagne.fr>
	<20071206124738.GC8288@phare.normalesup.org>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB1A@s-yellow.net.silverstroke.de>

Salut!

> > Well, if Jonathan doesn't like the joke, he will become even more 
> > sauer ;-)
> 
>   Trop tard :-?
              ^^^
Est-ce la fameuse ?p?e Excalibur?

Mais pourquoi "trop tard"? Jusqu'? ce quelqu'un discouvre le comparativ
de "sauer", il n'y a pas de danger. En tout cas si l'Hypoth?se Sapir-Whorf
est correcte.


Jonathan

P.S: Please pardon my french (no pun intended), it has been years since I
last wrote/spoke it.


From dak at gnu.org  Thu Dec  6 14:08:12 2007
From: dak at gnu.org (David Kastrup)
Date: Thu, 06 Dec 2007 14:08:12 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB1A@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Thu, 6 Dec 2007 13:58:21 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
	<6faad9f00712060343n7518add7la61457315bff20c0@mail.gmail.com>
	<8C691E38-642B-422D-8C64-482AA67B9673@enst-bretagne.fr>
	<20071206124738.GC8288@phare.normalesup.org>
	<9343542E664B894484613D106D7D3F5F84AB1A@s-yellow.net.silverstroke.de>
Message-ID: <85odd4ots3.fsf@lola.goethe.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> Salut!
>
>> > Well, if Jonathan doesn't like the joke, he will become even more 
>> > sauer ;-)
>> 
>>   Trop tard :-?
>               ^^^
> Est-ce la fameuse ?p?e Excalibur?
>
> Mais pourquoi "trop tard"? Jusqu'? ce quelqu'un discouvre le comparativ
> de "sauer", il n'y a pas de danger.

Sauron?

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From pragma at wxs.nl  Thu Dec  6 14:51:30 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 14:51:30 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB18@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>	<4757E967.4080209@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB18@s-yellow.net.silverstroke.de>
Message-ID: <4757FE62.2060603@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
>>> Well, the protagonists just talk about "Schwarzfahren", they of
> course 
>>> have a ticket. So I think it a bit unfair of LuaTeX to simply
> *assert* 
>>> they don't.
>> Actually, the assert says that the carriage that is towed 
>> around by us is not pushing us at the same time, which is a 
>> pretty bad thing when all those Schwarzfahrer make our engine 
>> quit due to excessive workload; and the train therefore comes 
>> to a grinding halt.
> 
> Wait a minute. You say even though I have a ticket I have to
> push the carriage? Sounds like a scam to me. Are you sure that
> "NTG" does not mean "Nigeria TeX Group"?

actually, it means Nomore TeX Group

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From Jonathan.Sauer at silverstroke.com  Thu Dec  6 14:55:21 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 6 Dec 2007 14:55:21 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>	<4757E967.4080209@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB18@s-yellow.net.silverstroke.de>
	<4757FE62.2060603@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB1C@s-yellow.net.silverstroke.de>

Hello, 

> > Wait a minute. You say even though I have a ticket I have to push
the 
> > carriage? Sounds like a scam to me. Are you sure that "NTG" does not

> > mean "Nigeria TeX Group"?
> 
> actually, it means Nomore TeX Group

So ... should I use Word?


> Hans

Jonathan


From pragma at wxs.nl  Thu Dec  6 14:59:03 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 14:59:03 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB1C@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AD26@s-yellow.net.silverstroke.de>	<4757E967.4080209@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB18@s-yellow.net.silverstroke.de>	<4757FE62.2060603@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB1C@s-yellow.net.silverstroke.de>
Message-ID: <47580027.6040509@wxs.nl>

Jonathan Sauer wrote:

> So ... should I use Word?

sure, actually a few years ago the then-tug president started the tug 
conference (newark, delaware) with a powerpoint presentation so ...

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.bittext.nl  Thu Dec  6 16:22:04 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Thu,  6 Dec 2007 16:22:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071206152248.60BA31E8C2BD@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/lang/texlang.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luainit.c
 U    svn/trunk/src/texk/web2c/luatexdir/font/texfont.c
 Checked out revision 940.

From arthur.reutenauer at normalesup.org  Thu Dec  6 16:28:36 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 16:28:36 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
Message-ID: <20071206152836.GC14264@phare.normalesup.org>

  Hey guys, I wanted to add a useful bit of information to that
half-delirious thread: here on Mac OS I have a reproducible case of
failed assertion---but obviously a different one---as texlua fails on
lines like "tfm = font.read_tfm('ec-lmr10.tfm', 42)" with

../../../src/texk/kpathsea/variable.c:37: failed assertion `kpse_program_name'

  Of course ec-lmr10 can be found by kpsewhich but this doesn't seem to
make any difference (unless blah-lmr10.tfm also is installed somewhere
in my TeX installation, because this gives the exact same error).

	Arthur

From taco at elvenkind.com  Thu Dec  6 16:36:52 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 16:36:52 +0100
Subject: [Dev-luatex] Assertion while typesetting: vlink(alink(r))==r
In-Reply-To: <20071206152836.GC14264@phare.normalesup.org>
References: <9343542E664B894484613D106D7D3F5F84AB11@s-yellow.net.silverstroke.de>
	<20071206152836.GC14264@phare.normalesup.org>
Message-ID: <47581714.80809@elvenkind.com>



Arthur Reutenauer wrote:
>   Hey guys, I wanted to add a useful bit of information to that
> half-delirious thread: here on Mac OS I have a reproducible case of
> failed assertion---but obviously a different one---as texlua fails on
> lines like "tfm = font.read_tfm('ec-lmr10.tfm', 42)" with
> 
> ../../../src/texk/kpathsea/variable.c:37: failed assertion `kpse_program_name'

You have to do a call like this:

   kpse.set_program_name('luatex')

I actually thought I had documented that, damn.

Best wishes,
Taco

From taco at elvenkind.com  Thu Dec  6 17:54:33 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 06 Dec 2007 17:54:33 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
References: <20071205151537.GD15825@phare.normalesup.org><9343542E664B894484613D106D7D3F5F84AB0D@s-yellow.net.silverstroke.de>	<20071205153445.GF15825@phare.normalesup.org>
	<9343542E664B894484613D106D7D3F5F84AD22@s-yellow.net.silverstroke.de>
Message-ID: <47582949.7060101@elvenkind.com>



Jonathan Sauer wrote:
> 
> However (an excerpt from the attached document, I hope the diacritics
> are not lost):
> 
> It seems that texio.write does not reset its internal line length counter
> then writing a "\n". Also, there is a leading space for some reason.

TeX's low-level io really is 'low-level', you have to use
texio.write_ln() if you want to start a new line properly.

> And finally: "design_size" vs. "designsize" ...

Yea, that is ugly. I will probably change the one returned from
fontforge at some point in the future (I am not completely happy
about the fontforge font table anyway).

Best wishes,
Taco

From joelcsalomon at gmail.com  Thu Dec  6 19:48:26 2007
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Thu, 6 Dec 2007 13:48:26 -0500
Subject: [Dev-luatex] LuaTeX dependencies
Message-ID: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>

I'm considering porting LuaT?? to a new, vaguely U??x-like, operating
system.  (Plan 9 from Bell Labs, if anyone cares.)   What
libraries/compilers/interpreters does the system have to have for this
to work?  E.g., I know that texexec is currently written in Ruby
(which Plan 9 lacks), but Lua is straight C (which Plan 9 is built
around).

(If you tell me to wait a few months until things stabilize, that's fine too.)

--Joel

From pragma at wxs.nl  Thu Dec  6 19:55:50 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 19:55:50 +0100
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
References: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
Message-ID: <475845B6.7080108@wxs.nl>

Joel C. Salomon wrote:
> I'm considering porting LuaT?? to a new, vaguely U??x-like, operating
> system.  (Plan 9 from Bell Labs, if anyone cares.)   What
> libraries/compilers/interpreters does the system have to have for this
> to work?  E.g., I know that texexec is currently written in Ruby
> (which Plan 9 lacks), but Lua is straight C (which Plan 9 is built
> around).
> 
> (If you tell me to wait a few months until things stabilize, that's fine too.)

texexec is just a runner for context (taking care of process management 
and index sortign and a few more things) and in that sense not related 
to luatex

i think that the biggest hurdle is the somewhat complex tex source code 
tree but luatex needs only bits and pieces and the source tree in the 
repository is already a subset

if lua compiles then you're halfway i guess

maybe ask on the tex live list for plan 9 experiences; i cc to karl, who 
knows all those things

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Thu Dec  6 21:43:46 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 6 Dec 2007 21:43:46 +0100
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <475845B6.7080108@wxs.nl>
References: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
	<475845B6.7080108@wxs.nl>
Message-ID: <20071206204346.GA1547@phare.normalesup.org>

  Hello, Karl :-)

> texexec is just a runner for context (taking care of process management 
> and index sortign and a few more things) and in that sense not related 
> to luatex

  By the way, how stable is mtxrun nowadays?  Can it be used to
completely replace texexec yet?

  Back to Joel's question, I don't know if my experience in compiling
LuaTeX on Solaris can be of any help, but I wish to say it was amazingly
straightforward ... of course there were minor issues, but all of them
could be set aside with enough patience.  Actually the worst problems
were caused by the build system (autoconf ...), not the C code itself (I
wrote down every change I had to make in my notebooks, but I doubt the
exact list be of any interest); many other programs don't build as
nicely on Solaris 9, so to me this is a hint that LuaTeX is programmed
in a remarkably portable way :-)

  Probably the most serious problem was caused by Solaris' annoying
/bin/sh, and---oh, yes!---/usr/bin/grep doesn't know about a '-q' switch
(which is called by the pdfTeX-inherited build.sh at the top of the
build tree), so instead of not being quiet it protested loudly, and the
script exited.  But really, nothing serious, it's only a matter of time
to adapt the scripts.

  Of course I don't claim this is of any interest for Plan 9;  I don't
know how "far" it is from other Unices.

  But LuaTeX on Plan 9! The future's TeX running on the future's Unix :-)
Next we have to port it to Hurd ;-)

	Arthur

From pragma at wxs.nl  Thu Dec  6 22:07:51 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Dec 2007 22:07:51 +0100
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <20071206204346.GA1547@phare.normalesup.org>
References: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>	<475845B6.7080108@wxs.nl>
	<20071206204346.GA1547@phare.normalesup.org>
Message-ID: <475864A7.2010400@wxs.nl>

Arthur Reutenauer wrote:
>   Hello, Karl :-)
> 
>> texexec is just a runner for context (taking care of process management 
>> and index sortign and a few more things) and in that sense not related 
>> to luatex
> 
>   By the way, how stable is mtxrun nowadays?  Can it be used to
> completely replace texexec yet?

mtxrun --script context

should be able to replace texexec but it has some untested bits and pieces

(mtx-context is just one of the scripts ... eventually i will replace 
most ruby scripts, although texexec will be needed for pdftex/xetex)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From root at www.bittext.nl  Thu Dec  6 22:22:05 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Thu,  6 Dec 2007 22:22:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071206212248.DC30E1E8C2BD@www.bittext.nl>

U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 941.

From martin at oneiros.de  Fri Dec  7 10:32:53 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 7 Dec 2007 10:32:53 +0100
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
References: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
Message-ID: <68c491a60712070132m7161caccn606fda472c70cf30@mail.gmail.com>

2007/12/6, Joel C. Salomon <joelcsalomon at gmail.com>:
> I'm considering porting LuaT?? to a new, vaguely U??x-like, operating
> system.  (Plan 9 from Bell Labs, if anyone cares.)   What
> libraries/compilers/interpreters does the system have to have for this
> to work?  E.g., I know that texexec is currently written in Ruby

Compilers: c and c++.

Do the configure scripts work on Plan 9?

Best
   Martin

From root at www.bittext.nl  Fri Dec  7 12:22:15 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Fri,  7 Dec 2007 12:22:15 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071207112300.3891A1E8C2BD@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.h
 U    svn/trunk/src/texk/web2c/luatexdir/tex/postlinebreak.c
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.defines
 Checked out revision 944.

From taco at elvenkind.com  Fri Dec  7 17:07:24 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 07 Dec 2007 17:07:24 +0100
Subject: [Dev-luatex]  beta 0.20.1 released
Message-ID: <47596FBC.3080102@elvenkind.com>


Hi all,

I have just uploaded the archives for luatex 0.20.1. This
is a bugfix release for wednesday's beta, and it fixes
the following issues:

* texlua was broken on Solaris because the some C header
   files were loaded in the wrong order.
* os.tmpdir() now accepts an argument, making it easier
   to use. It now generates more unique filenames when
   it is called repeatedly in one run.
* The --luaconly commandline switch is now documented
   in the --help text.
* The new extended hyphenation exceptions were severely
   broken.
* \pdfprotrudechars could cause luatex to abort with an
   assertion failure.
* There was a bug in the  \span code that could cause endless
   loops.
* The simple forms of \leaders were messed up on windows
   because a variable was not properly initialized.
* Non-grouped \textdir commands created invalid output.
* e-TeX's pseudo files were not closed properly in ini mode.
* The luatex.web now weaves properly again.
* I made some small improvements to the manual.

I have uploaded source and linux/win32 binaries to

      http://foundry.supelec.fr/projects/luatex/

Have fun,

Taco


_______________________________________________
dev-luatex mailing list
dev-luatex at ntg.nl
http://www.ntg.nl/mailman/listinfo/dev-luatex

From joelcsalomon at gmail.com  Fri Dec  7 18:29:25 2007
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Fri, 7 Dec 2007 12:29:25 -0500
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <68c491a60712070132m7161caccn606fda472c70cf30@mail.gmail.com>
References: <7871fcf50712061048i3b622d5cy63c2635a21106b14@mail.gmail.com>
	<68c491a60712070132m7161caccn606fda472c70cf30@mail.gmail.com>
Message-ID: <7871fcf50712070929w56dddd7rc46e717d4766ce75@mail.gmail.com>

On Dec 7, 2007 4:32 AM, Martin Schr?der <martin at oneiros.de> wrote:
> 2007/12/6, Joel C. Salomon <joelcsalomon at gmail.com>:
> > I'm considering porting LuaT?? to Plan 9.  What libraries/compilers/
> > interpreters does the system have to have for this to work?
>
> Compilers: c and c++.

There's C++ code?  I looked through the source tree and was glad not
to see any.  Plan 9 uses a C compiler written by Ken Thompson and
doesn't have a C++ compiler.  (Well, someone just revived some ancient
cfront, but that doesn't count for much.)

Oh, I just found C++ code in lib/xpdf.  That's gonna be a problem.

> Do the configure scripts work on Plan 9?

Sort of, but they're really not considered useful for porting.

When I get my Plan 9 system up & running, I'll start trying to compile
the library components individually and will report on troubles here.
(And to the relevant library people, if applicable.)

Till then,
--Joel

From oberdiek at uni-freiburg.de  Sat Dec  8 00:07:13 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sat, 8 Dec 2007 00:07:13 +0100
Subject: [Dev-luatex] How to insert at start of hlist/vlist?
Message-ID: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>

Hello,

I have some trouble to insert something at the start
of a list.

Example (complete example file after PS):

\setbox0=\hbox{XY}
\directlua0{
  do
    local hlist = tex.box[0]
    local pdf_literal = node.new(8,8)% \pdfliteral
    pdf_literal.mode = 2 % direct
    pdf_literal.data = "1 0 0 rg 1 0 0 RG"
    local head = hlist.list
    % local current = hlist.list.next % works
    local current = hlist.list % fails  
    hlist.list = node.insert_before(head, current, pdf_literal)  
  end
}

! LuaTeX error Attempt to node.insert_before() a non-existing node.

Have I misunderstood node.insert_before()?

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

PS: Complete example file that can be used with
    iniTeX, plain-TeX and LaTeX:

\ifnum\catcode`\{=1
\else
  \catcode`\{=1
  \catcode`\}=2
  \hsize=6.5in
  \vsize=8.9in
  \parfillskip=0pt plus 1fil
\fi
\font\f=cmr10
\f
\pdfoutput=1

\setbox0=\hbox{XY}
\directlua0{
  do
    local hlist = tex.box[0]
    local pdf_literal = node.new(8,8)% \pdfliteral
    pdf_literal.mode = 2 % direct
    pdf_literal.data = "1 0 0 rg 1 0 0 RG"
    local head = hlist.list
    % local current = hlist.list.next % works
    local current = hlist.list % fails  
    hlist.list = node.insert_before(head, current, pdf_literal)  
  end
}
\shipout\hbox{[\box0]}

\csname @@end\endcsname
\end

From pragma at wxs.nl  Sat Dec  8 00:31:59 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 08 Dec 2007 00:31:59 +0100
Subject: [Dev-luatex] How to insert at start of hlist/vlist?
In-Reply-To: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>
References: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>
Message-ID: <4759D7EF.4060806@wxs.nl>

Heiko Oberdiek wrote:
> Hello,
> 
> I have some trouble to insert something at the start
> of a list.
> 

weird message indeed; this works

   do
     local hlist = tex.box[0]
     local pdf_literal = node.new(8,8)% \pdfliteral
     pdf_literal.mode = 2 % direct
     pdf_literal.data = "1 0 0 rg 1 0 0 RG"
     pdf_literal.next = hlist.list
     hlist.list = pdf_literal
   end

current assigning to a box (or operating on box related lists are 
somewhat tricky, internal invisible pointers and such; this interface 
will probably change a bit; it helps to copy the list, work on the copy 
and hpack the result


> Example (complete example file after PS):
> 
> \setbox0=\hbox{XY}
> \directlua0{
>   do
>     local hlist = tex.box[0]
>     local pdf_literal = node.new(8,8)% \pdfliteral
>     pdf_literal.mode = 2 % direct
>     pdf_literal.data = "1 0 0 rg 1 0 0 RG"
>     local head = hlist.list
>     % local current = hlist.list.next % works
>     local current = hlist.list % fails  
>     hlist.list = node.insert_before(head, current, pdf_literal)  
>   end
> }
> 
> ! LuaTeX error Attempt to node.insert_before() a non-existing node.
> 
> Have I misunderstood node.insert_before()?
> 
> Yours sincerely
>   Heiko <oberdiek at uni-freiburg.de>
> 
> PS: Complete example file that can be used with
>     iniTeX, plain-TeX and LaTeX:
> 
> \ifnum\catcode`\{=1
> \else
>   \catcode`\{=1
>   \catcode`\}=2
>   \hsize=6.5in
>   \vsize=8.9in
>   \parfillskip=0pt plus 1fil
> \fi
> \font\f=cmr10
> \f
> \pdfoutput=1
> 
> \setbox0=\hbox{XY}
> \directlua0{
>   do
>     local hlist = tex.box[0]
>     local pdf_literal = node.new(8,8)% \pdfliteral
>     pdf_literal.mode = 2 % direct
>     pdf_literal.data = "1 0 0 rg 1 0 0 RG"
>     local head = hlist.list
>     % local current = hlist.list.next % works
>     local current = hlist.list % fails  
>     hlist.list = node.insert_before(head, current, pdf_literal)  
>   end
> }
> \shipout\hbox{[\box0]}
> 
> \csname @@end\endcsname
> \end
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oberdiek at uni-freiburg.de  Sat Dec  8 03:16:25 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Sat, 8 Dec 2007 03:16:25 +0100
Subject: [Dev-luatex] How to insert at start of hlist/vlist?
In-Reply-To: <4759D7EF.4060806@wxs.nl>
References: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>
	<4759D7EF.4060806@wxs.nl>
Message-ID: <20071208021625.GA19484@irwin.vpn.uni-freiburg.de>

On Sat, Dec 08, 2007 at 12:31:59AM +0100, Hans Hagen wrote:

> Heiko Oberdiek wrote:
> > Hello,
> > 
> > I have some trouble to insert something at the start
> > of a list.
> > 
> 
> weird message indeed; this works
> 
>    do
>      local hlist = tex.box[0]
>      local pdf_literal = node.new(8,8)% \pdfliteral
>      pdf_literal.mode = 2 % direct
>      pdf_literal.data = "1 0 0 rg 1 0 0 RG"
>      pdf_literal.next = hlist.list
>      hlist.list = pdf_literal
>    end

Thanks.

What about "prev"?
* insert_before seems to set this entry, too.
* I have seen, the head of the list (variable "hlist/tex.box[0]") has
  a node "prev" with id "temp" in the example (I have also
  seen "attribute_list", "if_stack" and the expected "nil").
  Is this a bug not being "nil"?
  Or must the new head node inherit the prev entry from the
  old head node?

> current assigning to a box (or operating on box related lists are 
> somewhat tricky, internal invisible pointers and such; this interface 
> will probably change a bit; it helps to copy the list, work on the copy 
> and hpack the result

The there is the problem with freeing the old node list.
The internal invisible pointers remain invisible, thus it is unknown
whether it is safe to call node.free().

What about global/local box contents?

Or is the copy strategy more safe, if two box registers are used?

  \begingroup
    \setbox1=\box1
  \endgroup
  % box 1 is void and takes the result
  \setbox0=\hbox{XY}
  \directlua0{
    do
      local hlist = node.copy(tex.box[0])
      % manipulating hlist
      tex.box[1] = hlist
    end
  }%
  \setbox0=\box1

But insert_before also don't work on the copied list.
And I would want to avoid copying the whole list, because
it would mean copying the whole document:
I am experimenting with color support based on an attribute.
At some time the shipout material needs transforming to add
pdf_literals with color setting. BTW, I haven't found a
direct callback function for this (page shipout/xform generation).
The way via a box register requires catching the shipout box
at TeX level (package atbegshi). But \pdfxform can't catched
in an easy and reliable way.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Sat Dec  8 13:29:34 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 08 Dec 2007 13:29:34 +0100
Subject: [Dev-luatex] How to insert at start of hlist/vlist?
In-Reply-To: <4759D7EF.4060806@wxs.nl>
References: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>
	<4759D7EF.4060806@wxs.nl>
Message-ID: <475A8E2E.4050408@elvenkind.com>

Hans Hagen wrote:
> Heiko Oberdiek wrote:
>> Hello,
>>
>> I have some trouble to insert something at the start
>> of a list.
>>
> 
> weird message indeed; this works
> 

The message (and even the error itself) is accidental, but there is
a deeper problem indeed. There are two different possible approaches:

1. make the lua user responsible for nodelist consistency
2. prevent the lua user from doing stupid things, giving
    as much help as possible (including garbage collection)

The current code is almost completely using approach 1, because that
is fastest both in development time and runnning time, approach 2 is
(in the end) more user-friendly.

In this particluar case, the error is simply an oversight: the
insert_before should have worked, with all the mentioned caveats.

Best wishes,
Taco




From pragma at wxs.nl  Sun Dec  9 00:11:39 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 09 Dec 2007 00:11:39 +0100
Subject: [Dev-luatex] How to insert at start of hlist/vlist?
In-Reply-To: <20071208021625.GA19484@irwin.vpn.uni-freiburg.de>
References: <20071207230712.GA17226@irwin.vpn.uni-freiburg.de>	<4759D7EF.4060806@wxs.nl>
	<20071208021625.GA19484@irwin.vpn.uni-freiburg.de>
Message-ID: <475B24AB.7020807@wxs.nl>

Hi Heiko

> On Sat, Dec 08, 2007 at 12:31:59AM +0100, Hans Hagen wrote:
> 
>> Heiko Oberdiek wrote:
>>> Hello,
>>>
>>> I have some trouble to insert something at the start
>>> of a list.
>>>
>> weird message indeed; this works
>>
>>    do
>>      local hlist = tex.box[0]
>>      local pdf_literal = node.new(8,8)% \pdfliteral
>>      pdf_literal.mode = 2 % direct
>>      pdf_literal.data = "1 0 0 rg 1 0 0 RG"
>>      pdf_literal.next = hlist.list
>>      hlist.list = pdf_literal
>>    end
> 
> Thanks.
> 
> What about "prev"?
> * insert_before seems to set this entry, too.
> * I have seen, the head of the list (variable "hlist/tex.box[0]") has
>   a node "prev" with id "temp" in the example (I have also
>   seen "attribute_list", "if_stack" and the expected "nil").
>   Is this a bug not being "nil"?
>   Or must the new head node inherit the prev entry from the
>   old head node?

at the tex end double linked lists are not needed, but at the lua end it 
can be handy and the insertion functions assume it; a handy helper is ...

tail = node.slide(head)

sliding == make a list double linked

> What about global/local box contents?

always global, same for registers; lua calls have no grouping

so, when using boxes with lua, reserve dedicated ones

> Or is the copy strategy more safe, if two box registers are used?
> 
>   \begingroup
>     \setbox1=\box1
>   \endgroup
>   % box 1 is void and takes the result
>   \setbox0=\hbox{XY}
>   \directlua0{
>     do
>       local hlist = node.copy(tex.box[0])
>       % manipulating hlist
>       tex.box[1] = hlist
>     end
>   }%
>   \setbox0=\box1

copying indeed, or using a dedicated set for lua manipulations

> But insert_before also don't work on the copied list.

because of a bug -)

> And I would want to avoid copying the whole list, because
> it would mean copying the whole document:

assigning the page box to a private (for lua) box is fast

btw, in practice pages do not have that many nodes and the node.copy and 
  access calls (node.next and such) are quite optimized by now

> I am experimenting with color support based on an attribute.
> At some time the shipout material needs transforming to add
> pdf_literals with color setting. BTW, I haven't found a
> direct callback function for this (page shipout/xform generation).

next year callnbacks for shipout and backend related things will be 
added (after mplib, so after februari)

the vpack calbacks, in addition to head, get additional information 
passed so sometimes that can be used to determine what to do

> The way via a box register requires catching the shipout box
> at TeX level (package atbegshi). But \pdfxform can't catched
> in an easy and reliable way.

pdf backend functions will be implemented next year

hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From karl at freefriends.org  Sun Dec  9 02:56:20 2007
From: karl at freefriends.org (Karl Berry)
Date: Sat, 8 Dec 2007 19:56:20 -0600
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <20071206204346.GA1547@phare.normalesup.org>
Message-ID: <200712090156.lB91uKj32497@f7.net>

      Probably the most serious problem was caused by Solaris' annoying
    /bin/sh, and---oh, yes!---/usr/bin/grep doesn't know about a '-q' switch
    (which is called by the pdfTeX-inherited build.sh at the top of the
    build tree), 

Maybe this has already been fixed and I didn't see the mail, but FWIW,
looking at metapost's build.sh (which I'm guessing is similar :), I see:
if make -v 2>&1| grep -q "GNU Make"

Taco, grep -q just isn't portable.  Instead, just use redirection:
if make -v 2>&1| grep "GNU Make" >/dev/null

(Arthur or anyone, if there are such portability problems anywhere in
the TeX Live build, please tell me.)

karl

From karl at freefriends.org  Sun Dec  9 02:56:20 2007
From: karl at freefriends.org (Karl Berry)
Date: Sat, 8 Dec 2007 19:56:20 -0600
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <475845B6.7080108@wxs.nl>
Message-ID: <200712090156.lB91uKk32523@f7.net>

Joel, all,

    maybe ask on the tex live list for plan 9 experiences; 

I'm unaware of any attempts to compile TeX Live on Plan 9, but I imagine
it should be doable.  If you have any interest in giving it a try (we'd
surely be happy to distribute them), see the file Build/README
(http://tug.org/svn/texlive/trunk/Build/README) in the repository for
starting points.  http://tug.org/texlive/svn explains various ways to
retrieve the repo.

Best,
Karl

From taco at elvenkind.com  Sun Dec  9 10:48:01 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 09 Dec 2007 10:48:01 +0100
Subject: [Dev-luatex] LuaTeX dependencies
In-Reply-To: <200712090156.lB91uKj32497@f7.net>
References: <200712090156.lB91uKj32497@f7.net>
Message-ID: <475BB9D1.1090907@elvenkind.com>

Karl Berry wrote:
>       Probably the most serious problem was caused by Solaris' annoying
>     /bin/sh, and---oh, yes!---/usr/bin/grep doesn't know about a '-q' switch
>     (which is called by the pdfTeX-inherited build.sh at the top of the
>     build tree), 
> 
> Maybe this has already been fixed and I didn't see the mail, but FWIW,
> looking at metapost's build.sh (which I'm guessing is similar :), I see:
> if make -v 2>&1| grep -q "GNU Make"
> 
> Taco, grep -q just isn't portable.  Instead, just use redirection:
> if make -v 2>&1| grep "GNU Make" >/dev/null
> 
> (Arthur or anyone, if there are such portability problems anywhere in
> the TeX Live build, please tell me.)

I will fix that (it started out as a copy of pdftex's build.sh).

In texlive, I only import the metapost makefile fragment, so there
should not be a problem.

Best wishes,
Taco


From root at www.bittext.nl  Sun Dec  9 12:22:18 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Sun,  9 Dec 2007 12:22:18 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071209112310.BC3A11E8C2C3@www.bittext.nl>

U    svn/trunk/build.sh.cross
 U    svn/trunk/build.sh.linux
 U    svn/trunk/build.sh
 Checked out revision 951.

From preining at logic.at  Mon Dec 10 11:13:31 2007
From: preining at logic.at (Norbert Preining)
Date: Mon, 10 Dec 2007 11:13:31 +0100
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <47596FBC.3080102@elvenkind.com>
References: <47596FBC.3080102@elvenkind.com>
Message-ID: <20071210101331.GG7003@gamma.logic.tuwien.ac.at>

On Fr, 07 Dez 2007, Taco Hoekwater wrote:
> I have just uploaded the archives for luatex 0.20.1. This

Debian sid users will get 0.20.1 soon by normal update.
Debian etch users can add
	deb http://people.debian.org/~preining/TeX/ luatex/
	deb-src http://people.debian.org/~preining/TeX/ luatex/

This release of luatex for Debian ships an improved texdoc written in
texlua by Frank K?ster. Please report any strange things to
	debian-tex-maint at lists.debian.org

Thanks Taco!

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
CLATHY (adj.)
Nervously indecisive about how safely to dispose of a dud lightbulb.
			--- Douglas Adams, The Meaning of Liff

From adityam at umich.edu  Mon Dec 10 17:19:03 2007
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 10 Dec 2007 11:19:03 -0500 (EST)
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <20071210101331.GG7003@gamma.logic.tuwien.ac.at>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
Message-ID: <alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>

On Mon, 10 Dec 2007, Norbert Preining wrote:

> On Fr, 07 Dez 2007, Taco Hoekwater wrote:
>> I have just uploaded the archives for luatex 0.20.1. This
>
> Debian sid users will get 0.20.1 soon by normal update.
> Debian etch users can add
> 	deb http://people.debian.org/~preining/TeX/ luatex/
> 	deb-src http://people.debian.org/~preining/TeX/ luatex/
>
> This release of luatex for Debian ships an improved texdoc written in
> texlua by Frank K?ster. Please report any strange things to
> 	debian-tex-maint at lists.debian.org

Excuse my ignorance, but is it safe to use these sources for ubuntu gusty 
as well?

Aditya

From oberdiek at uni-freiburg.de  Mon Dec 10 22:11:33 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Mon, 10 Dec 2007 22:11:33 +0100
Subject: [Dev-luatex] Module searching
Message-ID: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>

Hello,

in the TeX world scripts are usually installed below TDS:scripts.

Lua does know a module system.

Example: There is a package "foobar" with module "foobar.hello".
Lua then searches in some standard places for
  foobar/hello.lua

However LuaTeX neglects the texmf trees. Thus "package.loaders"
could be extended by a kpse loader, e.g.:

  function kpse.module_loader(module) 
    local file
    if string.find(module, ".", 1, true) then
      -- What to do?
      -- the following is just an unreliable emergency workaround:
      module = string.gsub(module, "^.*\%.", "")
      file = kpse.find_file(module .. ".lua", "texmfscripts")
    else
      file = kpse.find_file(module .. ".lua", "texmfscripts")
    end
    if file then
      local loader, error = loadfile(file)
      if loader then
        return loader
      end
      return "\n\t KPSE loading error:\n" .. error
    end
    return "\n\t KPSE search failed"
  end
  table.insert(package.loaders, kpse.module_loader) 

However, the problem are modules with dots.
I haven't find a solution using kpse functions.
  kpsewhich --format=texmfscripts foobar/hello.lua
doesn't find the file.

Perhaps a search path could be hacked by using the output of
  kpsewhich --show-path=texmfscripts
and appending the module directories to each path component.
But:
* LuaTeX's kpse library doesn't have a "show_path" function.
* os.execute is not available in safer mode.
* Last but not least, a kpse function is missing for
  searching along the modified path specification.
* Portability among different operating systems.
  (directory specificator, ..., LUA_DIRSEP isn't available, ...)

Ideas?

Something like "foobar_hello.lua" isn't the best solution:
* Redundancy in the full name:
  TDS:scripts/foobar/foobar_hello.lua
* It doesn't scale well, e.g. it pollutes "package.loaded".

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From preining at logic.at  Mon Dec 10 22:53:37 2007
From: preining at logic.at (Norbert Preining)
Date: Mon, 10 Dec 2007 22:53:37 +0100
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
Message-ID: <20071210215337.GB6157@gamma.logic.tuwien.ac.at>

On Mo, 10 Dez 2007, Aditya Mahajan wrote:
> >	deb http://people.debian.org/~preining/TeX/ luatex/
> >	deb-src http://people.debian.org/~preining/TeX/ luatex/
> >
> >This release of luatex for Debian ships an improved texdoc written in
> >texlua by Frank K?ster. Please report any strange things to
> >	debian-tex-maint at lists.debian.org
> 
> Excuse my ignorance, but is it safe to use these sources for ubuntu gusty 
> as well?

Safe for sure, but you have to check whether it compiles. It depends on
the version of libpoppler present in Ubuntu Gutsy.

For libpoppler 0.4.X (X <= 8) take the etch variant
For libpoppler 0.4.9 or 0.5.X you have to unpack the source package,
	change the debian/patches/series file to list the
	libpoppler-0.5 patch and comment the libpoppler-0.4 and -0.6
For libpoppler 0.6.X take the sid variant (available at the same
	location as the etch variant but with terminal
		luatex-sid
	instead of luatex)

Sorry for being of not so much help, but I don't have a gutsy around and
I never could find out which versions of Ubuntu ship which versions of
libraries.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
I'm going to have a look.'
He glanced round at the others.
`Is no one going to say, "No you can't possibly, let me go
instead"?'
They all shook their heads.
`Oh well.'
                 --- Ford attempting to be heroic whilst being seiged by
                 --- Shooty and Bangbang.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy

From adityam at umich.edu  Mon Dec 10 23:50:09 2007
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 10 Dec 2007 17:50:09 -0500 (EST)
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <20071210215337.GB6157@gamma.logic.tuwien.ac.at>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
	<20071210215337.GB6157@gamma.logic.tuwien.ac.at>
Message-ID: <alpine.DEB.0.99.0712101720400.6946@nqv-yncgbc>

On Mon, 10 Dec 2007, Norbert Preining wrote:

> On Mo, 10 Dez 2007, Aditya Mahajan wrote:
>>> 	deb http://people.debian.org/~preining/TeX/ luatex/
>>> 	deb-src http://people.debian.org/~preining/TeX/ luatex/
>>>
>>> This release of luatex for Debian ships an improved texdoc written in
>>> texlua by Frank K?ster. Please report any strange things to
>>> 	debian-tex-maint at lists.debian.org
>>
>> Excuse my ignorance, but is it safe to use these sources for ubuntu gusty
>> as well?
>
> Safe for sure, but you have to check whether it compiles. It depends on
> the version of libpoppler present in Ubuntu Gutsy.
>
> For libpoppler 0.4.X (X <= 8) take the etch variant
> For libpoppler 0.4.9 or 0.5.X you have to unpack the source package,
> 	change the debian/patches/series file to list the
> 	libpoppler-0.5 patch and comment the libpoppler-0.4 and -0.6
> For libpoppler 0.6.X take the sid variant (available at the same
> 	location as the etch variant but with terminal
> 		luatex-sid
> 	instead of luatex)
>
> Sorry for being of not so much help, but I don't have a gutsy around and
> I never could find out which versions of Ubuntu ship which versions of
> libraries.

Ubuntu gusty ships with libpoppler 0.6.2.1. However, I do not get any 
suggested updates because I am using amd64 architecture, and I see that 
you do not have amd64 packages on your website. I will wait for the new 
packages to trickle through to ubuntu repositories.

Aditya

From pragma at wxs.nl  Mon Dec 10 23:51:28 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 10 Dec 2007 23:51:28 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
Message-ID: <475DC2F0.3090500@wxs.nl>

Heiko Oberdiek wrote:
> Hello,
> 
> in the TeX world scripts are usually installed below TDS:scripts.
> 
> Lua does know a module system.
> 
> Example: There is a package "foobar" with module "foobar.hello".
> Lua then searches in some standard places for
>   foobar/hello.lua
> 
> However LuaTeX neglects the texmf trees. Thus "package.loaders"
> could be extended by a kpse loader, e.g.:
> 
>   function kpse.module_loader(module) 
>     local file
>     if string.find(module, ".", 1, true) then
>       -- What to do?
>       -- the following is just an unreliable emergency workaround:
>       module = string.gsub(module, "^.*\%.", "")
>       file = kpse.find_file(module .. ".lua", "texmfscripts")
>     else
>       file = kpse.find_file(module .. ".lua", "texmfscripts")
>     end
>     if file then
>       local loader, error = loadfile(file)
>       if loader then
>         return loader
>       end
>       return "\n\t KPSE loading error:\n" .. error
>     end
>     return "\n\t KPSE search failed"
>   end
>   table.insert(package.loaders, kpse.module_loader) 
> 
> However, the problem are modules with dots.
> I haven't find a solution using kpse functions.
>   kpsewhich --format=texmfscripts foobar/hello.lua
> doesn't find the file.

well, maybe you could ask for the path variable, and loop over it

there's also luainputs

> Perhaps a search path could be hacked by using the output of
>   kpsewhich --show-path=texmfscripts
> and appending the module directories to each path component.
> But:
> * LuaTeX's kpse library doesn't have a "show_path" function.
> * os.execute is not available in safer mode.
> * Last but not least, a kpse function is missing for
>   searching along the modified path specification.

can't you use lua for that?

> * Portability among different operating systems.
>   (directory specificator, ..., LUA_DIRSEP isn't available, ...)
> 
> Ideas?

we explicitly didn't hard code these things because each user and/or 
macro package may want to do it different (the same for suffixes of lua 
files)

> Something like "foobar_hello.lua" isn't the best solution:
> * Redundancy in the full name:
>   TDS:scripts/foobar/foobar_hello.lua
> * It doesn't scale well, e.g. it pollutes "package.loaded".

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Dec 11 08:41:05 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 08:41:05 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <475DC2F0.3090500@wxs.nl>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl>
Message-ID: <475E3F11.3020101@elvenkind.com>


>> Perhaps a search path could be hacked by using the output of
>>   kpsewhich --show-path=texmfscripts
>> and appending the module directories to each path component.
>> But:
>> * LuaTeX's kpse library doesn't have a "show_path" function.

If you want that (or any other access to existing kpathsea stuff)
just let me know, it easy to add extra bindings.

>> * Last but not least, a kpse function is missing for
>>   searching along the modified path specification.

That could be a bit harder, because kpathsea does not normally
change variables after they have been defined, and I am not
easier to actually extend the kpathsea library itself.


Best wishes,
Taco

From taco at elvenkind.com  Tue Dec 11 08:49:28 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 08:49:28 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <475E3F11.3020101@elvenkind.com>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>	<475DC2F0.3090500@wxs.nl>
	<475E3F11.3020101@elvenkind.com>
Message-ID: <475E4108.7020609@elvenkind.com>

Taco Hoekwater wrote:
>>> Perhaps a search path could be hacked by using the output of
>>>   kpsewhich --show-path=texmfscripts
>>> and appending the module directories to each path component.
>>> But:
>>> * LuaTeX's kpse library doesn't have a "show_path" function.
> 
> If you want that (or any other access to existing kpathsea stuff)
> just let me know, it easy to add extra bindings.
> 
>>> * Last but not least, a kpse function is missing for
>>>   searching along the modified path specification.
> 
> That could be a bit harder, because kpathsea does not normally
> change variables after they have been defined, and I am not
> easier to actually extend the kpathsea library itself.

Sorry, please read "not eager".



From Jonathan.Sauer at silverstroke.com  Tue Dec 11 09:06:04 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 09:06:04 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
Message-ID: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>

Okay, this is weird (and long), but it gets clearer near the end:


The following test using lpeg to split a comma-separated values works
perfectly (never mind that subpattern B does not do anything):

----------------------------------------------------------------------

% A:
% \catcode`\:=11
% \def\FM:ifFileIncluded#1{\message{whatever}}
% 
% \FM:ifFileIncluded{}

\directlua0{\unexpanded{
	whiteSpace = lpeg.S(" \t\n")
	splitComma = lpeg.P({
		lpeg.Ct(lpeg.V("elem") * (lpeg.V("sep") *
lpeg.V("elem"))^0),
		
		sep =	lpeg.S(",{}"),
		elem =	whiteSpace^0 *
				lpeg.C((1 - lpeg.V("sep"))^1) *
				whiteSpace^0, % B
	})
}}

\def\splitComma#1{%
	\directlua0{%
		local s = '\luaescapestring{\unexpanded{#1}}'
		local t = lpeg.match(splitComma,s)
		for k,v in ipairs(t) do
			texio.write_nl('[' .. v .. ']')
		end
	}%
}

\splitComma{A, B, C, D, E, F}

% `print' is not documented, but prints a compiled pattern's bytecode
% to the console
\directlua0{lpeg.print(splitComma)}

\end

-----------------------------------------------------------------------

The pattern created is:

[1 = elem  2 = sep  3 = elem  4 = sep  ]
00: call -> 2
01: jmp -> 51
02: opencapture table(n = 0) (0)
03: call -> 10
04: choice -> 8 (0)
05: call -> 41
06: call -> 10
07: partial_commit -> 5
08: closecapture close(n = 0) (0)
09: ret 
10: span [(09-0a)(20)]
19: opencapture simple(n = 0) (0)
20: choice -> 23 (0)
21: call -> 41
22: failtwice 
23: any * 1
24: choice -> 30 (0)
25: choice -> 28 (0)
26: call -> 41
27: failtwice 
28: any * 1
29: partial_commit -> 25
30: closecapture close(n = 0) (0)
31: span [(09-0a)(20)]
40: ret 
41: set [(2c)(7b)(7d)]
50: ret 
51: end 


However, if I run this with my own format, the pattern is:

[1 = elem  2 = sep  3 = elem  4 = sep  ]
00: call -> 2
01: jmp -> 51
02: opencapture table(n = 0) (0)
03: call -> 10
04: choice -> 8 (0)
05: call -> 41
06: call -> 10
07: partial_commit -> 5
08: closecapture close(n = 0) (0)
09: ret 
10: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
19: opencapture simple(n = 0) (0)
20: choice -> 23 (0)
21: call -> 41
22: failtwice 
23: any * 1
24: choice -> 30 (0)
25: choice -> 28 (0)
26: call -> 41
27: failtwice 
28: any * 1
29: partial_commit -> 25
30: closecapture close(n = 0) (0)
31: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
40: ret 
41: set [(2c)(7b)(7d)]
50: ret 
51: end 

So instead of checking for whitespace in instructions 10 and 31, input
is checked against the character set "\n .BEILMOPS" (and splitting the
list fails almost completely). I know what a "Beil" is (an axe), and I
know what a "Mops" is (some kind of weird animal, a bit like a
groundhog [think Bill Murray]), but what is a "Beilmops"? And a "dot
Beilmops"? Is is written in C# or what?

Now you'll say "yeah, sure, who cares what weird stuff that weird
Jonathan does in that weird format of his", but: This only happens if
a macro "\FM:ifFileIncluded" is defined or referenced. If this macro
is called "\FM:ifFileLoadeded" (the same length) or
"\FM:ifFileIlcluded" ("l" instead of "n"), the pattern is compiled
correctly. "\FM:ifFileLncluded" works, too. But the moment a control
sequence called "\FM:ifFileIncluded" is used (defined or referenced),
the lpeg pattern contains that strange animal.

I tried to use Lua state 1 instead of 0 to make sure there were no
definitions that could create a side-effect, but the pattern remained
the same.

I tried to uncomment (A) in above PlainTeX code, but the pattern is
still correct. So I first suspected some kind of overflow in TeX's
hash table that only occurs when there already exist a lot of control
sequences and one of them has a very specific name and thus hash
value (this does not seem to be the case, though).

I tried moving the definition of "\FM:ifFileIncluded" to the beginning
of my format (right after setting the catcodes), but without success.
I tried defining it in the PlainTeX format, but again to no avail. I
tried removing all unnecessary files from my format, with the same
result.

More weirdness that I more or less accidentally stumbled upon:

	\directlua1{\unexpanded{lpeg.print(lpeg.S(" \t\n"))}}

results in

	set [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]

which is wrong, but

	\directlua1{\detokenize{lpeg.print(lpeg.S(" \t\n"))}}

results in

	set [(09-0a)(20)]
	
which is correct. And the equivalent, but slightly longer

	\directlua1{lpeg.print(lpeg.S(" \string\t\string\n"))}

again results in the correct

	set [(09-0a)(20)]

And indeed: If I replace "\unexpanded" in the code example above by
"\detokenize" (and remove the empty lines which for some reason result
in "\par" when "\detokenize" is used, but not with "\unexpanded"), the
pattern is compiled correctly and works as expected.

The plot thickens. Let's look further; how about simply telling Lua to
print the string " \t\n"?

	\directlua1{\detokenize{texio.write_nl("[ \t\n]")}}

results in

	[        
	 ]

but

	\directlua1{\unexpanded{texio.write_nl("[ \t\n]")}}

results in

	[ IMPOSSIBLE.
	 ]

Not so weird anymore: "IMPOSSIBLE." is printed by procedure "print_cs"
in luatex.web if the control sequence's pointer is below
"active_base", that is zero or negative, or >= the pointer to the
undefined control sequence (at least as far as I understand it).

And "IMPOSSIBLE." sorted and stripped of duplicates is ...
".BEILMOPS"!

Also note that "\t" is defined in PlainTeX, but not in my format. If I
define it at the beginning of the code example above, nothing changes.
But if I define it before defining "\FM:ifFileIncluded", everything
works as expected, and

	\directlua1{\unexpanded{texio.write_nl("[ \t\n]")}}

results in

	[        
	 ]

Not "IMPOSSIBLE." anymore.

Now: If the control passed to "print_cs" (or "tokenlist_to_cstring" in
luatoken.c) is undefined, "IMPOSSIBLE." is printed. As "\t" is indeed
undefined, this is completely expected. What's not expected, is that
this only happens if the macro "\FM:ifFileIncluded" is not defined
before "\t" is defined (if at all).

And weird again: "\n" is defined by neither PlainTeX nor my format,
but does not result in "IMPOSSIBLE.".

Side note:

	\immediate\write16{\detokenize{[ \t\n]}}
	\immediate\write16{\unexpanded{[ \t\n]}}

both correctly display "[ \t \n ]". So it seems that "\unexpanded" 
works as expected, but something else does not.

And finally: If I say "\let\t\t" at the beginning of my format,
everything works as well. So "\t" may well be undefined, as long as it
is entered into TeX's hash table before "\FM:ifFileIncluded" is.


Jonathan


From Jonathan.Sauer at silverstroke.com  Tue Dec 11 09:07:31 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 09:07:31 +0100
Subject: [Dev-luatex] UTF-16 in \pdfoutline
Message-ID: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>

% The following code converts a string to UTF-16 big endian with BOM
% and outputs it using \message:

% We change the catcode of '%' so we can use it for modulo calculations:
\begingroup
\catcode`\%=12
\directlua0{\unexpanded{
	function convertToUTF16(str)
		local result = string.char(0xFE) .. string.char(0xFF)
		for c in string.utfvalues(str) do
			if c < 0x10000 then
				result = result ..
						 string.char(c / 256) ..
						 string.char(c % 256)
			else
				c = c - 0x10000
				local c1 = c / 1024 + 0xD800
				local c2 = c % 1024 + 0xDC00
				result = result ..
						 string.char(c1 / 256) ..
						 string.char(c1 % 256) ..
						 string.char(c2 / 256) ..
						 string.char(c2 % 256)
			end
		end
		tex.print('\\message{' .. result .. '}')
	end
	
	
	convertToUTF16('A???B!')
}}
\endgroup



\bye

This fails with 'Text line contains an invalid utf-8 sequence.' (not
surprising, since the text is UTF-16 big endian). If I want to pass the
UTF-16-encoded string i.e. to \pdfoutline (since PDF bookmarks can be
encoded in UTF-16), how do I do this?

(Maybe a callback would be useful, i.e. `convert_pdf_text')


Thanks in advance,
Jonathan


From Jonathan.Sauer at silverstroke.com  Tue Dec 11 09:10:50 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 09:10:50 +0100
Subject: [Dev-luatex] Additions to the manual
Message-ID: <9343542E664B894484613D106D7D3F5F84AD33@s-yellow.net.silverstroke.de>

Hello,

The appended .diff contains a few additions I made to the
manual, revision 941 (fixed some typos, added a few notes,
made one or two corrections).


HTH,
Jonathan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatexref-t.diff
Type: application/octet-stream
Size: 5049 bytes
Desc: luatexref-t.diff
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071211/7499c072/attachment.obj 

From Jonathan.Sauer at silverstroke.com  Tue Dec 11 09:11:57 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 09:11:57 +0100
Subject: [Dev-luatex] Notes
Message-ID: <9343542E664B894484613D106D7D3F5F84AB26@s-yellow.net.silverstroke.de>

Hello,

some miscellaneous notes while playing with LuaTeX 0.20.0:

-	Currently, the 'open_read_file' callback is only used if a
	'find_read_file' callback is registered as well. Since on Apr 24
2007,
	Taco wrote on the mailing list (subject '\input does not look at

	open_read_file callback?') that this would be fixed, I suspect
that 
	this is a bug.

-	I want to register an open_read_file callback that is called to
open 
	the job file. \everyjob is executed after the job file has been 
	opened, so I cannot use it to register the callback. Also,
callbacks 
	are not dumped into the format file, so I cannot register the
callback 
	while creating the format.

	What now?

	-	I could use the command line switch "--lua" to execute a
special
		script which registers the callbacks (and deal with the
fact that
		I cannot use kpathsea to locate this script)?

	-	I could call luatex not with the file name but like
this:

			luatex -jobname <filename> '\input <filename>'

	-	[insert simple and elegant solution]

	(On Apr 02 2007, Taco wrote on the mailing list (subject 'LaTeX
and 
	LuaTeX'), that dumping of callbacks could be added. If there was
a 
	vote on this, I would vote with 'yes' :-)

-	The following command line crashes LuaTeX with a bus error (yes,
yes
	the bus that people are riding on without a ticket):

		luatex '\directlua0{texio.write("term and
log","Hello")}'

	No destination or destination "term" works.

	The problem seems to be that LuaTeX wants to log to the log
file, but 
	the log file is not open yet.

	Stacktrace (not very useful, I'm afraid, since the symbols are
missing):

	0   libSystem.B.dylib 	0x9003fd9c putc + 60
	1   luatex            	0x0000d3e4 0x1000 + 50148
	2   luatex            	0x0000d9e8 0x1000 + 51688
	3   luatex            	0x000a74bc 0x1000 + 681148
	4   luatex            	0x0015c5d0 0x1000 + 1422800
	5   luatex            	0x00164310 0x1000 + 1454864
	6   luatex            	0x0015c6a4 0x1000 + 1423012
	7   luatex            	0x0015bab4 0x1000 + 1419956
	8   luatex            	0x0015ca6c 0x1000 + 1423980
	9   luatex            	0x0015ab10 0x1000 + 1415952
	10  luatex            	0x000a5878 0x1000 + 673912
	11  luatex            	0x0003c850 0x1000 + 243792
	12  luatex            	0x000238b4 0x1000 + 141492
	13  luatex            	0x00023de4 0x1000 + 142820
	14  luatex            	0x00068004 0x1000 + 421892
	15  luatex            	0x0000cf04 0x1000 + 48900
	16  luatex            	0x00070694 0x1000 + 456340
	17  luatex            	0x00001d54 0x1000 + 3412
	18  luatex            	0x00001bfc 0x1000 + 3068

-	Is it sensible to point the string functions, which are not
	Unicode-aware, to unicode.utf8, or are there situations (due to
	differences in functionality) that still require the original
string
	functions? (I would suspect that the original functions are a
bit
	faster)

-	lpeg does not seem to be UTF-8-aware. Is this impression
correct? If
	so, how should one proceed to use it safely? I would estimate
that this
	is mainly a problem when matching using a set ("lpeg.S")
containing
	characters outside the first 256 code points, since when
matching, a
	character is checked against each *byte* in the set string, not
each
	character.


Jonathan


From Jonathan.Sauer at silverstroke.com  Tue Dec 11 09:13:16 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 09:13:16 +0100
Subject: [Dev-luatex] Hyphenation pattern information are not logged?
Message-ID: <9343542E664B894484613D106D7D3F5F84AB27@s-yellow.net.silverstroke.de>

Hello,

LuaTeX does not seem to log the hyphenation memory usage anymore when
in IniTeX mode.

pdfTeX:

------------------------------------------------------------------------

This is pdfTeX, Version 3.141592-1.40.3 (Web2C 7.5.6) (INITEX)
entering extended mode
[...]
Beginning to dump on file ../web2c/ktex.fmt
 (format=ktex 2007.12.8)
3245 strings of total length 50066
8638 memory locations dumped; current usage is 64&8395
1676 multiletter control sequences
\font\nullfont=nullfont
0 words of font info for 0 preloaded fonts
14 hyphenation exceptions
Hyphenation trie of length 13987 has 388 ops out of 35111
  207 for language 1
  181 for language 0

------------------------------------------------------------------------

LuaTeX:

------------------------------------------------------------------------

This is LuaTeX, Version snapshot-0.20.0-2007120716 (Web2C 7.5.6)
(INITEX)
[...]
Beginning to dump on file ../web2c/luaktex.fmt
 (format=luaktex 2007.12.8)
2970 strings of total length 47739
45428 memory locations dumped; current usage is 48&8787
1788 multiletter control sequences
\font\nullfont=nullfont
0 preloaded fonts
0 words of active ocps
\ocp\nullocp=nullocp
0 preloaded ocps
\ocplist\nullocplist=[]

------------------------------------------------------------------------

I do not know if the new hyphenation mechanism still allows for logging
its memory usage, and if it is still deemed useful/necessary. I just
noticed this change since 0.11.2.


Jonathan


From pragma at wxs.nl  Tue Dec 11 09:26:00 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 09:26:00 +0100
Subject: [Dev-luatex] Hyphenation pattern information are not logged?
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB27@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB27@s-yellow.net.silverstroke.de>
Message-ID: <475E4998.5070209@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
> LuaTeX does not seem to log the hyphenation memory usage anymore when
> in IniTeX mode.

> I do not know if the new hyphenation mechanism still allows for logging
> its memory usage, and if it is still deemed useful/necessary. I just
> noticed this change since 0.11.2.

patterns and exceptions are stored differently now and no longer have to 
be loaded at runtime; when a macro package preloads patterns, it can 
write a message to the log (more meaningful than abstract numbers); whan 
patterns are loaded at runtime, the message can be issued then

maybe eventually even

\font\nullfont=nullfont
0 preloaded fonts
0 words of active ocps
\ocp\nullocp=nullocp
0 preloaded ocps
\ocplist\nullocplist=[]

will go away (does not tell the user that much); in a later stage of the 
development more messages may change (overhaul of error message system)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Dec 11 09:32:35 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 09:32:35 +0100
Subject: [Dev-luatex] Notes
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB26@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB26@s-yellow.net.silverstroke.de>
Message-ID: <475E4B23.4020802@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
> some miscellaneous notes while playing with LuaTeX 0.20.0:
> 
> -	Currently, the 'open_read_file' callback is only used if a
> 	'find_read_file' callback is registered as well. Since on Apr 24
> 2007,
> 	Taco wrote on the mailing list (subject '\input does not look at
> 
> 	open_read_file callback?') that this would be fixed, I suspect
> that 
> 	this is a bug.
> 
> -	I want to register an open_read_file callback that is called to
> open 
> 	the job file. \everyjob is executed after the job file has been 
> 	opened, so I cannot use it to register the callback. Also,
> callbacks 
> 	are not dumped into the format file, so I cannot register the
> callback 
> 	while creating the format.

> 	What now?

put the initialization code in a bytecode register and initialize that 
in everyjob

> 
> 	-	I could use the command line switch "--lua" to execute a
> special
> 		script which registers the callbacks (and deal with the
> fact that
> 		I cannot use kpathsea to locate this script)?

write a small wrapper (startup script) or load the initialization code 
after loading the format

> 	-	I could call luatex not with the file name but like
> this:
> 
> 			luatex -jobname <filename> '\input <filename>'
> 
> 	-	[insert simple and elegant solution]
> 
> 	(On Apr 02 2007, Taco wrote on the mailing list (subject 'LaTeX
> and 
> 	LuaTeX'), that dumping of callbacks could be added. If there was
> a 
> 	vote on this, I would vote with 'yes' :-)
> 
> -	The following command line crashes LuaTeX with a bus error (yes,
> yes
> 	the bus that people are riding on without a ticket):
> 
> 		luatex '\directlua0{texio.write("term and
> log","Hello")}'
> 
> 	No destination or destination "term" works.

hard to read this funny formatted remark -)

> 	The problem seems to be that LuaTeX wants to log to the log
> file, but 
> 	the log file is not open yet.
> 
> 	Stacktrace (not very useful, I'm afraid, since the symbols are
> missing):
> 
> 	0   libSystem.B.dylib 	0x9003fd9c putc + 60
> 	1   luatex            	0x0000d3e4 0x1000 + 50148
> 	2   luatex            	0x0000d9e8 0x1000 + 51688
> 	3   luatex            	0x000a74bc 0x1000 + 681148
> 	4   luatex            	0x0015c5d0 0x1000 + 1422800
> 	5   luatex            	0x00164310 0x1000 + 1454864
> 	6   luatex            	0x0015c6a4 0x1000 + 1423012
> 	7   luatex            	0x0015bab4 0x1000 + 1419956
> 	8   luatex            	0x0015ca6c 0x1000 + 1423980
> 	9   luatex            	0x0015ab10 0x1000 + 1415952
> 	10  luatex            	0x000a5878 0x1000 + 673912
> 	11  luatex            	0x0003c850 0x1000 + 243792
> 	12  luatex            	0x000238b4 0x1000 + 141492
> 	13  luatex            	0x00023de4 0x1000 + 142820
> 	14  luatex            	0x00068004 0x1000 + 421892
> 	15  luatex            	0x0000cf04 0x1000 + 48900
> 	16  luatex            	0x00070694 0x1000 + 456340
> 	17  luatex            	0x00001d54 0x1000 + 3412
> 	18  luatex            	0x00001bfc 0x1000 + 3068
> 
> -	Is it sensible to point the string functions, which are not
> 	Unicode-aware, to unicode.utf8, or are there situations (due to
> 	differences in functionality) that still require the original
> string
> 	functions? (I would suspect that the original functions are a
> bit
> 	faster)

you can overload the *standardized* string functions

string.char = unicode.utf8.char

and it's up to the user to decide; we just provide the standardized lua 
engien + some extra libs

> -	lpeg does not seem to be UTF-8-aware. Is this impression
> correct? If
> 	so, how should one proceed to use it safely? I would estimate
> that this
> 	is mainly a problem when matching using a set ("lpeg.S")
> containing
> 	characters outside the first 256 code points, since when
> matching, a
> 	character is checked against each *byte* in the set string, not
> each
> 	character.

you can write utf parsing in lpeg (see roberto's web page on lpeg) ...
so a solution is to combine techniques; native utf8 support would slow 
down lpeg and also make it less generic; it's basically a byte parsing 
engine (no assumptions about characters, sequences and their meaning)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Dec 11 09:34:37 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 09:34:37 +0100
Subject: [Dev-luatex] UTF-16 in \pdfoutline
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>
Message-ID: <475E4B9D.3000303@wxs.nl>

Jonathan Sauer wrote:
> % The following code converts a string to UTF-16 big endian with BOM
> % and outputs it using \message:
> 
> % We change the catcode of '%' so we can use it for modulo calculations:
> \begingroup
> \catcode`\%=12
> \directlua0{\unexpanded{
> 	function convertToUTF16(str)
> 		local result = string.char(0xFE) .. string.char(0xFF)
> 		for c in string.utfvalues(str) do
> 			if c < 0x10000 then
> 				result = result ..
> 						 string.char(c / 256) ..
> 						 string.char(c % 256)
> 			else
> 				c = c - 0x10000
> 				local c1 = c / 1024 + 0xD800
> 				local c2 = c % 1024 + 0xDC00
> 				result = result ..
> 						 string.char(c1 / 256) ..
> 						 string.char(c1 % 256) ..
> 						 string.char(c2 / 256) ..
> 						 string.char(c2 % 256)
> 			end
> 		end
> 		tex.print('\\message{' .. result .. '}')
> 	end
> 	
> 	
> 	convertToUTF16('A???B!')
> }}
> \endgroup
> 
> 
> 
> \bye
> 
> This fails with 'Text line contains an invalid utf-8 sequence.' (not
> surprising, since the text is UTF-16 big endian). If I want to pass the
> UTF-16-encoded string i.e. to \pdfoutline (since PDF bookmarks can be
> encoded in UTF-16), how do I do this?
> 
> (Maybe a callback would be useful, i.e. `convert_pdf_text')

you can move all 'bytes' to a reserved private area (see manual) and 
then luatex will write them with that offset subtracted; think of a 
private 256 slot area representing bytes

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Dec 11 09:41:52 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 09:41:52 +0100
Subject: [Dev-luatex] UTF-16 in \pdfoutline
In-Reply-To: <475E4B9D.3000303@wxs.nl>
References: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>
	<475E4B9D.3000303@wxs.nl>
Message-ID: <475E4D50.4050405@elvenkind.com>



Hans Hagen wrote:
>>
>> This fails with 'Text line contains an invalid utf-8 sequence.' (not
>> surprising, since the text is UTF-16 big endian). If I want to pass the
>> UTF-16-encoded string i.e. to \pdfoutline (since PDF bookmarks can be
>> encoded in UTF-16), how do I do this?
>>
>> (Maybe a callback would be useful, i.e. `convert_pdf_text')
> 
> you can move all 'bytes' to a reserved private area (see manual) and 
> then luatex will write them with that offset subtracted; think of a 
> private 256 slot area representing bytes

For now, that is what will have to be done. But I agree that is ugly,
and either a callback or primitive or lua pdf.outline() access is
called for.

Best wishes,
Taco

From preining at logic.at  Tue Dec 11 09:42:18 2007
From: preining at logic.at (Norbert Preining)
Date: Tue, 11 Dec 2007 09:42:18 +0100
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <alpine.DEB.0.99.0712101720400.6946@nqv-yncgbc>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
	<20071210215337.GB6157@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.99.0712101720400.6946@nqv-yncgbc>
Message-ID: <20071211084218.GF8114@gamma.logic.tuwien.ac.at>

Hi Aditya,

On Mo, 10 Dez 2007, Aditya Mahajan wrote:
> Ubuntu gusty ships with libpoppler 0.6.2.1. However, I do not get any 
> suggested updates because I am using amd64 architecture, and I see that 

Ok, for you
	deb http://people.debian.org/~preining/TeX/ luatex-sid/
	deb-src http://people.debian.org/~preining/TeX/ luatex-sid/

I will upload amd64 as soon as I can build them. In the meantime you can
do:

- add the above to /etc/apt/sources
- aptitude update
- apt-get source luatex
- cd luatex-0.20.1
- dpkg-buildpackage -us -uc -rfakeroot -b
- cd ..
- dpkg -i luatex*.deb

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
AINSWORTH (n.)
The length of time it takes to get served in a camera shop. Hence,
also, how long we will have to wait for the abolition of income tax or
the Second Coming.
			--- Douglas Adams, The Meaning of Liff

From oberdiek at uni-freiburg.de  Tue Dec 11 09:43:19 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 11 Dec 2007 09:43:19 +0100
Subject: [Dev-luatex] UTF-16 in \pdfoutline
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB24@s-yellow.net.silverstroke.de>
Message-ID: <20071211084319.GA17544@irwin.vpn.uni-freiburg.de>

On Tue, Dec 11, 2007 at 09:07:31AM +0100, Jonathan Sauer wrote:

> % The following code converts a string to UTF-16 big endian with BOM
> % and outputs it using \message:

> 	function convertToUTF16(str)
> 		local result = string.char(0xFE) .. string.char(0xFF)
> 		for c in string.utfvalues(str) do
> 			if c < 0x10000 then
> 				result = result ..
> 						 string.char(c / 256) ..
> 						 string.char(c % 256)
> 			else

> 		tex.print('\\message{' .. result .. '}')

> This fails with 'Text line contains an invalid utf-8 sequence.' (not
> surprising, since the text is UTF-16 big endian). If I want to pass the
> UTF-16-encoded string i.e. to \pdfoutline (since PDF bookmarks can be
> encoded in UTF-16), how do I do this?

In package "pdftexcmds" I had a similar problem with the reprogramming
of \pdfunescapehex. Here also 8bit bytes are possible as result.
My solution was:
* Use of a token register (avoids catcode troubles), principle:
    \newtoks\foobartoks
    \directlua0{
        ...
        function convert(str)
          ...
          tex.settoks("foobartoks", <result>)
          ...
        end
    }
    \def\convert#1{%
      \the\directlua0{%
        convert("\luaescapestring{#1}")
      }\foobartoks
    }
  Alternatively tex.print may be used, but it requires a catcode table
  to avoid trouble with unexpected catcode settings. (Currently
  I am writing a package for this purpose.)
* The convert function in Lua first calculates the byte string.
  Then it have replaced the bytes in the lua string by its
  multi-byte sequence in UTF-8. Then LuaTeX will see proper
  UTF-8 input and converts it back.

Of course, I want to add support for hyperref. But currently I don't
know, what a char token between 128 and 256 means:
* Proper Unicode?
* A byte of other encoding?
* Meaning of catcode (11, 12, 13)?

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Tue Dec 11 09:48:45 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 09:48:45 +0100
Subject: [Dev-luatex] Additions to the manual
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD33@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AD33@s-yellow.net.silverstroke.de>
Message-ID: <475E4EED.9070903@elvenkind.com>



Jonathan Sauer wrote:
> Hello,
> 
> The appended .diff contains a few additions I made to the
> manual, revision 941 (fixed some typos, added a few notes,
> made one or two corrections).

Thanks! applied

Best wishes,
Taco

From pragma at wxs.nl  Tue Dec 11 09:45:10 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 09:45:10 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
Message-ID: <475E4E16.3000501@wxs.nl>

Jonathan Sauer wrote:
> Okay, this is weird (and long), but it gets clearer near the end:
> The pattern created is:

(this list is not really the place for indepth lua discussions -)

> [1 = elem  2 = sep  3 = elem  4 = sep  ]
> 00: call -> 2
> 01: jmp -> 51
> 02: opencapture table(n = 0) (0)
> 03: call -> 10
> 04: choice -> 8 (0)
> 05: call -> 41
> 06: call -> 10
> 07: partial_commit -> 5
> 08: closecapture close(n = 0) (0)
> 09: ret 
> 10: span [(09-0a)(20)]
> 19: opencapture simple(n = 0) (0)
> 20: choice -> 23 (0)
> 21: call -> 41
> 22: failtwice 
> 23: any * 1
> 24: choice -> 30 (0)
> 25: choice -> 28 (0)
> 26: call -> 41
> 27: failtwice 
> 28: any * 1
> 29: partial_commit -> 25
> 30: closecapture close(n = 0) (0)
> 31: span [(09-0a)(20)]
> 40: ret 
> 41: set [(2c)(7b)(7d)]
> 50: ret 
> 51: end 
> 
> 
> However, if I run this with my own format, the pattern is:
                                  ^^^^^^^^^^

> [1 = elem  2 = sep  3 = elem  4 = sep  ]
> 00: call -> 2
> 01: jmp -> 51
> 02: opencapture table(n = 0) (0)
> 03: call -> 10
> 04: choice -> 8 (0)
> 05: call -> 41
> 06: call -> 10
> 07: partial_commit -> 5
> 08: closecapture close(n = 0) (0)
> 09: ret 
> 10: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
> 19: opencapture simple(n = 0) (0)
> 20: choice -> 23 (0)
> 21: call -> 41
> 22: failtwice 
> 23: any * 1
> 24: choice -> 30 (0)
> 25: choice -> 28 (0)
> 26: call -> 41
> 27: failtwice 
> 28: any * 1
> 29: partial_commit -> 25
> 30: closecapture close(n = 0) (0)
> 31: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
> 40: ret 
> 41: set [(2c)(7b)(7d)]
> 50: ret 
> 51: end 

when i run it in context i get:

[A]
[B]
[C]
[D]
[E]
[F][1 = elem  2 = sep  3 = elem  4 = sep  ]
00: call -> 2
01: jmp -> 51
02: opencapture table(n = 0) (0)
03: call -> 10
04: choice -> 8 (0)
05: call -> 41
06: call -> 10
07: partial_commit -> 5
08: closecapture close(n = 0) (0)
09: ret
10: span [(09-0a)(20)]
19: opencapture simple(n = 0) (0)
20: choice -> 23 (0)
21: call -> 41
22: failtwice
23: any * 1
24: choice -> 30 (0)
25: choice -> 28 (0)
26: call -> 41
27: failtwice
28: any * 1
29: partial_commit -> 25
30: closecapture close(n = 0) (0)
31: span [(09-0a)(20)]
40: ret
41: set [(2c)(7b)(7d)]
50: ret
51: end

so it looks like you have to track down what your format is doing

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oberdiek at uni-freiburg.de  Tue Dec 11 03:10:05 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 11 Dec 2007 03:10:05 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <475DC2F0.3090500@wxs.nl>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl>
Message-ID: <20071211021005.GA14110@irwin.vpn.uni-freiburg.de>

On Mon, Dec 10, 2007 at 11:51:28PM +0100, Hans Hagen wrote:

> Heiko Oberdiek wrote:
> > Example: There is a package "foobar" with module "foobar.hello".

> > I haven't found a solution using kpse functions.
> >   kpsewhich --format=texmfscripts foobar/hello.lua
> > doesn't find the file.
> 
> well, maybe you could ask for the path variable, and loop over it

* "kpsewhich --show-path-name" doesn't help much:
  * It's not available in library "kpse".
  * It contains unwanted stuff (!!, //, ...)
* kpse.expand_path (kpsewhich --expand-path)
  does not expand extra colons:
    texmf.cnf: TEXMFSCRIPTS=$TEXMF/scripts//
  then
    TEXMFSCRIPTS=.: kpsewhich --expand-path '$TEXMFSCRIPTS'
  only returns
    .
* No ls-R lookup.

> there's also luainputs

I don't see, how it could help here.

> > Perhaps a search path could be hacked by using the output of
> >   kpsewhich --show-path=texmfscripts
> > and appending the module directories to each path component.
> > But:
> > * LuaTeX's kpse library doesn't have a "show_path" function.
> > * os.execute is not available in safer mode.
> > * Last but not least, a kpse function is missing for
> >   searching along the modified path specification.
> 
> can't you use lua for that?

Reimplementing kpse library in Lua with analyzing texmf.cnf
files, path expansion, ls-R lookup, ...?

> > * Portability among different operating systems.
> >   (directory specificator, ..., LUA_DIRSEP isn't available, ...)
> > 
> > Ideas?
> 
> we explicitly didn't hard code these things because each user and/or 
> macro package may want to do it different (the same for suffixes of lua 
> files)

The other file types are covered: TeX files, tfm files, type 1 files, ...
Missing is a proper support for lua scripts.

A user/macro writer says for example:
  \documentclass{article}
  \usepackage{longtable}
  \usepackage[T1]{fontenc}
  \usepackage{lmodern}
But he doesn't implement a search algorithm for
finding article.cls or longtable.sty or the latin modern fonts.

Also Lua has a module system, thus a user/macro writer wants to write:
  \directlua0{
    require("foobar.hello")
    -- ...
  }
without implementing, how the module is found.

Lua provides four search strategies by default.
These can be changed and exended, see the table "package.loader"
(latest Lua docu for 5.1)

> > Something like "foobar_hello.lua" isn't the best solution:

Currently I am using
  TDS:scripts/foobar/foobar.hello.lua
This doesn't follow Lua's conventions (TDS:scripts/foobar/hello.lua).
But the search is easier:

  function kpse.module_loader(module)
    local script = module .. ".lua"
    local file = kpse.find_file(script, "texmfscripts")
    if file then
      local loader, error = loadfile(file)
      if loader then
        return loader
      end
      return "\n\tKPSE loading error:\n" .. error
    end
    return "\n\tKPSE search failed"
  end
  table.insert(package.loaders, kpse.module_loader)

and avoids at least:
> > * It doesn't scale well, e.g. it pollutes "package.loaded".

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From Jonathan.Sauer at silverstroke.com  Tue Dec 11 10:16:33 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 10:16:33 +0100
Subject: [Dev-luatex] beta 0.20.0 released
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>
	<47571F1D.2030403@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5F84AD36@s-yellow.net.silverstroke.de>

Hello,

> >> we will be abel to run multiple instances .. who knowns
> > 
> > What do you mean by the latter?
> 
> if a tex engine can be properly isolated one can think of 
> starting a new instance

I'm still confused. Right now, I can run luatex several times in
different consoles, typesetting different documents. It also should
be possible to use os.execute to run luatex out of luatex, since
the operating system gives each instance its own memory etc.

> > Sure, but examples on how to use these interfaces can go a long way.
> > And IMO a documentation of the OpenType font metrics table is indeed

> > for the manual. Otherwise, how should one be able to create a
solution?
> 
> by consulting documentation (fontforge, ms site, adobe) ... 

Well, fontforge's documentation mostly deals with the font designer
itself. I found a little bit about the data structures, but that only
dealt with the internal data structures, not how a font is "exported".

> of just looking into the lua table ...

That amounts to reverse-engineering. The tables can be mis-interpreted.

> there are many variations in fonts and features; type 1, open type, 
> what-comes-next ...  such standards (sic) have their own documentation

Of course. But this documentation does not tell me how LuaTeX
maps the font's data structures to Lua tables.

> > Who can only write code if they have the documentation.
> 
> indeed, but look at good old tex ... eventually macro 
> packages evolved that go way behind plain tex; also, i could 
> write thousands of pages about how *i* do thinsg but that may 
> not be the way you want to do it (and i'm pretty sure that 
> the context mkiv color model is different from what e.g. latex does).

Sure. But it would still be useful to have this information just
to see how others (you, in that case) solved a given problem. That
way, the wheel does not need to be reinvented all the time.


> Hans

Jonathan


From pragma at wxs.nl  Tue Dec 11 10:25:57 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 10:25:57 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <20071211021005.GA14110@irwin.vpn.uni-freiburg.de>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>	<475DC2F0.3090500@wxs.nl>
	<20071211021005.GA14110@irwin.vpn.uni-freiburg.de>
Message-ID: <475E57A5.6070000@wxs.nl>

Heiko Oberdiek wrote:

> Reimplementing kpse library in Lua with analyzing texmf.cnf
> files, path expansion, ls-R lookup, ...?

in this case i was more thinking of looking in the paths reported by 
kpse (given that the path variable can be expanded), so, no lookup, but 
looling at the file system; another option is that you just put the file 
alongside the tex file, lookup the tex file, replace the suffix and load 
the file; personally i see no need to put lua files that belong to tex 
in the scripts path;

> The other file types are covered: TeX files, tfm files, type 1 files, ...
> Missing is a proper support for lua scripts.

lua scripts as such are like perl, ruby, whatever scripts; the 
texmfscript path is not for tex related (runtime embedded or whatever) 
scripts ... makes packaging a mess when we get a duplicate tree there, 
apart from clashes

> A user/macro writer says for example:
>   \documentclass{article}
>   \usepackage{longtable}
>   \usepackage[T1]{fontenc}
>   \usepackage{lmodern}
> But he doesn't implement a search algorithm for
> finding article.cls or longtable.sty or the latin modern fonts.
> 
> Also Lua has a module system, thus a user/macro writer wants to write:
>   \directlua0{
>     require("foobar.hello")
>     -- ...
>   }
> without implementing, how the module is found.

i'd say .. overload require, and put the modules in the tex tree

> Lua provides four search strategies by default.
> These can be changed and exended, see the table "package.loader"
> (latest Lua docu for 5.1)

sure

>>> Something like "foobar_hello.lua" isn't the best solution:
> 
> Currently I am using
>   TDS:scripts/foobar/foobar.hello.lua
> This doesn't follow Lua's conventions (TDS:scripts/foobar/hello.lua).
> But the search is easier:
> 
>   function kpse.module_loader(module)
>     local script = module .. ".lua"
>     local file = kpse.find_file(script, "texmfscripts")
>     if file then
>       local loader, error = loadfile(file)
>       if loader then
>         return loader
>       end
>       return "\n\tKPSE loading error:\n" .. error
>     end
>     return "\n\tKPSE search failed"
>   end
>   table.insert(package.loaders, kpse.module_loader)
> 
> and avoids at least:
>>> * It doesn't scale well, e.g. it pollutes "package.loaded".

a solution indeed, but as said ... i wonder if texmfscripts is meant for 
that (not sure how easy it is for packaging too)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Dec 11 10:31:09 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 10:31:09 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD36@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>	<47571F1D.2030403@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AD36@s-yellow.net.silverstroke.de>
Message-ID: <475E58DD.8040503@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
>>>> we will be abel to run multiple instances .. who knowns
>>> What do you mean by the latter?
>> if a tex engine can be properly isolated one can think of 
>> starting a new instance
> 
> I'm still confused. Right now, I can run luatex several times in
> different consoles, typesetting different documents. It also should
> be possible to use os.execute to run luatex out of luatex, since
> the operating system gives each instance its own memory etc.

sure, but then passing info between the instances is somewhat cumbersome 
; this is what mplib is about ... passing info between tex and mp

> Well, fontforge's documentation mostly deals with the font designer
> itself. I found a little bit about the data structures, but that only
> dealt with the internal data structures, not how a font is "exported".

welcome to open type ... not much info about it anyway ... also, you're 
pretty dependent on what font designers put in there (completeness)

>> of just looking into the lua table ...
> 
> That amounts to reverse-engineering. The tables can be mis-interpreted.

well, to some extend it is reverse engeneering ... but as said, 
eventually we will come up with some documentation (we've quite some 
fonts on my machine, but we're still running into new things)

>> there are many variations in fonts and features; type 1, open type, 
>> what-comes-next ...  such standards (sic) have their own documentation
> 
> Of course. But this documentation does not tell me how LuaTeX
> maps the font's data structures to Lua tables.

once that format is frozen (may change again in upcoming luatex's) we 
will explain that in more detail

>>> Who can only write code if they have the documentation.
>> indeed, but look at good old tex ... eventually macro 
>> packages evolved that go way behind plain tex; also, i could 
>> write thousands of pages about how *i* do thinsg but that may 
>> not be the way you want to do it (and i'm pretty sure that 
>> the context mkiv color model is different from what e.g. latex does).
> 
> Sure. But it would still be useful to have this information just
> to see how others (you, in that case) solved a given problem. That
> way, the wheel does not need to be reinvented all the time.

indeed, but i expect the wheel to be reinvented ... it's how the tex 
community works -)

sometime next year i hope to have the font related lua code in such a 
state (cleaned up) that i can describe it

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Dec 11 10:37:21 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 10:37:21 +0100
Subject: [Dev-luatex] Notes
In-Reply-To: <475E4B23.4020802@wxs.nl>
References: <9343542E664B894484613D106D7D3F5F84AB26@s-yellow.net.silverstroke.de>
	<475E4B23.4020802@wxs.nl>
Message-ID: <475E5A51.9060607@elvenkind.com>



Hans Hagen wrote:
> Jonathan Sauer wrote:
>> Hello,
>> 
>> some miscellaneous notes while playing with LuaTeX 0.20.0:
>> 
>> -	Currently, the 'open_read_file' callback is only used if a 
>> 'find_read_file' callback is registered as well. Since on Apr 24 
>> 2007, Taco wrote on the mailing list (subject '\input does not look
>> at
>> 
>> open_read_file callback?') that this would be fixed, I suspect that
>>  this is a bug.

Yes, that is a bug. I had forgotten about it, and will fix it soon.
It is on my shortlist now (but not for today).

>> -	The following command line crashes LuaTeX with a bus error (yes, 
>> yes the bus that people are riding on without a ticket):
>> 
>> luatex '\directlua0{texio.write("term and log","Hello")}'
>> 
>> No destination or destination "term" works.

Found and fixed (an extra test was needed to make sure the log file
is actually open).

Best wishes,
Taco

From taco at elvenkind.com  Tue Dec 11 10:44:44 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 10:44:44 +0100
Subject: [Dev-luatex] beta 0.20.0 released
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD36@s-yellow.net.silverstroke.de>
References: <4756A70C.2030107@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB0B@s-yellow.net.silverstroke.de>	<4756BFA5.6050206@wxs.nl>	<9343542E664B894484613D106D7D3F5F84AB0E@s-yellow.net.silverstroke.de>	<47571F1D.2030403@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AD36@s-yellow.net.silverstroke.de>
Message-ID: <475E5C0C.6040100@elvenkind.com>



Jonathan Sauer wrote:
> 
>> of just looking into the lua table ...
> 
> That amounts to reverse-engineering. The tables can be mis-interpreted.

The lua table from fontforge.to_table() is written by me only (not
George), and it is currently just a serialization of the fontforge
internal data structure.

The resulting table is about as "documented" as the internal data
structure is, which is not very much.

The end goal is to have a nicely documented return table that is not
as reliant on the fontforge internals, but the available time for
both development and documentation is limited (as always ...)

Best wishes,
Taco


From taco at elvenkind.com  Tue Dec 11 10:53:14 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 10:53:14 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
Message-ID: <475E5E0A.60809@elvenkind.com>



Jonathan Sauer wrote:
> Okay, this is weird (and long), but it gets clearer near the end:

Definately weird.

> 
> However, if I run this with my own format, the pattern is:

How does that work, running this example in your format?
I saved your example as weird.tex (attached), but

   luatex -fmt=luaktex weird

gives me:

This is LuaTeX, Version snapshot-0.20.1-2007121015 (Web2C 7.5.6)
(weird.tex
! Undefined control sequence.
l.7 \directlua
               0{\unexpanded{
? x


Best wishes,
Taco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: weird.tex
Type: application/x-tex
Size: 704 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071211/840250f6/attachment.tex 

From Jonathan.Sauer at silverstroke.com  Tue Dec 11 10:59:00 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 10:59:00 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475E5E0A.60809@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>

Hello,

> > However, if I run this with my own format, the pattern is:
> 
> How does that work, running this example in your format?
> I saved your example as weird.tex (attached), but
> 
>    luatex -fmt=luaktex weird
> 
> gives me:
> 
> This is LuaTeX, Version snapshot-0.20.1-2007121015 (Web2C 7.5.6)
> (weird.tex
> ! Undefined control sequence.
> l.7 \directlua
>                0{\unexpanded{
> ? x

I'm sorry, I forgot to note that for "weird.tex" to run with luaktex,
all primitives have to be prefixed with ":":

------------------------------------------------------------------------

\:directlua0{\:unexpanded{
	whiteSpace = lpeg.S(" \t\n")
	splitComma = lpeg.P({
		lpeg.Ct(lpeg.V("elem") * (lpeg.V("sep") *
lpeg.V("elem"))^0),
		
		sep =	lpeg.S(",{}"),
		elem =	whiteSpace^0 *
				lpeg.C((1 - lpeg.V("sep"))^1) *
				whiteSpace^0, % B
	})
}}

\:def\splitComma#1{%
	\:directlua0{%
		local s = '\:luaescapestring{\:unexpanded{#1}}'
		local t = lpeg.match(splitComma,s)
		for k,v in ipairs(t) do
			texio.write_nl('[' .. v .. ']')
		end
	}%
}

\splitComma{A, B, C, D, E, F}

% `print' is not documented, but prints a compiled pattern's bytecode
% to the console
\:directlua0{lpeg.print(splitComma)}

------------------------------------------------------------------------

This should work.


> Best wishes,
> Taco

Jonathan


From taco at elvenkind.com  Tue Dec 11 11:13:39 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 11:13:39 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
Message-ID: <475E62D3.7070302@elvenkind.com>



Jonathan Sauer wrote:
> 
> I'm sorry, I forgot to note that for "weird.tex" to run with luaktex,
> all primitives have to be prefixed with ":":

Ok, it runs fine now using your format. Better than expected, actually:
with my latest local executable I get the correct output (no bug):

[1 = elem  2 = sep  3 = elem  4 = sep  ]
00: call -> 2
01: jmp -> 51
02: opencapture table(n = 0) (0)
03: call -> 10
04: choice -> 8 (0)
05: call -> 41
06: call -> 10
07: partial_commit -> 5
08: closecapture close(n = 0) (0)
09: ret
10: span [(09-0a)(20)]
19: opencapture simple(n = 0) (0)
20: choice -> 23 (0)
21: call -> 41
22: failtwice
23: any * 1
24: choice -> 30 (0)
25: choice -> 28 (0)
26: call -> 41
27: failtwice
28: any * 1
29: partial_commit -> 25
30: closecapture close(n = 0) (0)
31: span [(09-0a)(20)]
40: ret
41: set [(2c)(7b)(7d)]
50: ret
51: end

Perhaps the IMPOSSSIBLE. error was just a side-effect of another bug
that is already fixed (that is possible, and not even all that unlikely,
as there were some "uninitialized memory" errors in 0.20.0) or possibly
the behaviour depends on the used texmf.cnf and/or architecture (also
possible, but those would be bad).

Best wishes,
Taco


From Jonathan.Sauer at silverstroke.com  Tue Dec 11 11:21:36 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Tue, 11 Dec 2007 11:21:36 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
	<475E62D3.7070302@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB2A@s-yellow.net.silverstroke.de>

Hello,

> > I'm sorry, I forgot to note that for "weird.tex" to run with
luaktex,
> > all primitives have to be prefixed with ":":
> 
> Ok, it runs fine now using your format. Better than expected, 
> actually:
> with my latest local executable I get the correct output (no bug):
> [...]
> Perhaps the IMPOSSSIBLE. error was just a side-effect of another bug
> that is already fixed (that is possible, and not even all that
unlikely,
> as there were some "uninitialized memory" errors in 0.20.0) or
possibly
> the behaviour depends on the used texmf.cnf and/or architecture (also
> possible, but those would be bad).

I'll try it again this evening using 0.20.1 (or should I use the current
trunk?).


> Best wishes,
> Taco

Jonathan


From oberdiek at uni-freiburg.de  Tue Dec 11 11:45:09 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 11 Dec 2007 11:45:09 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <475E3F11.3020101@elvenkind.com>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl> <475E3F11.3020101@elvenkind.com>
Message-ID: <20071211104509.GA27906@irwin.vpn.uni-freiburg.de>

On Tue, Dec 11, 2007 at 08:41:05AM +0100, Taco Hoekwater wrote:

> 
> >> Perhaps a search path could be hacked by using the output of
> >>   kpsewhich --show-path=texmfscripts
> >> and appending the module directories to each path component.
> >> But:
> >> * LuaTeX's kpse library doesn't have a "show_path" function.
> 
> If you want that (or any other access to existing kpathsea stuff)
> just let me know, it easy to add extra bindings.

"kpse.show_path" is worth a try.

Then the result can be divided in separate path specifications.
Under Linux I have ":" as path separator.
How does --show-path behaves under other operating systems
(windows, ...)? Does it use a different path separator?
If yes, then a function for getting the path separator
the kpathsea library uses:
  kpse.path_separator
  (either a string or a function that returns a string)

The directory part of the module name is now added
to each path specification. Again, is "/" the correct
directory separator, also under other operating systems
for kpathsea?

Then the modified path specifications are merged
and passed to kpse.expand_path.

The result is a path list for direct script lookup.

Better than kpse.expand_path would be a kpse.find_file
That uses the path specification list directly for finding
the script. Then the ls-R lookup speed up the process.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Tue Dec 11 11:49:56 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2007 11:49:56 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB2A@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB2A@s-yellow.net.silverstroke.de>
Message-ID: <475E6B54.1050603@elvenkind.com>



Jonathan Sauer wrote:
> 
> I'll try it again this evening using 0.20.1 (or should I use the current
> trunk?).

Trunk would be better.

Best wishes,
Taco

From oberdiek at uni-freiburg.de  Tue Dec 11 12:03:44 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 11 Dec 2007 12:03:44 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <475E57A5.6070000@wxs.nl>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl>
	<20071211021005.GA14110@irwin.vpn.uni-freiburg.de>
	<475E57A5.6070000@wxs.nl>
Message-ID: <20071211110344.GA28234@irwin.vpn.uni-freiburg.de>

On Tue, Dec 11, 2007 at 10:25:57AM +0100, Hans Hagen wrote:

> Heiko Oberdiek wrote:
> 
> > Reimplementing kpse library in Lua with analyzing texmf.cnf
> > files, path expansion, ls-R lookup, ...?
> 
> in this case i was more thinking of looking in the paths reported by 
> kpse (given that the path variable can be expanded), so, no lookup, but 
> looling at the file system; another option is that you just put the file 
> alongside the tex file, lookup the tex file, replace the suffix and load 
> the file; personally i see no need to put lua files that belong to tex 
> in the scripts path;

That is not the ide behind TDS. File searching in large trees
is expensive. Thus the directory structure of TDS differentiates
between file types to reduce the search space.

> > The other file types are covered: TeX files, tfm files, type 1 files, ...
> > Missing is a proper support for lua scripts.
> 
> lua scripts as such are like perl, ruby, whatever scripts; the 
> texmfscript path is not for tex related (runtime embedded or whatever) 
> scripts ... makes packaging a mess when we get a duplicate tree there, 
> apart from clashes

A TeX distribution could precompile lua scripts and put them
in a definite place, e.g.
  TDS:scripts/lua-compiled//
(eventually adding a os component, afaik precompiled scripts
aren't portable).

Then texmf.cnf could contain:
  TEXMFSCRIPTS.lua = $TEXMF/scripts/lua-compiled//:$TEXMF/scripts//

Then as first component only contains compiled lua files, few
files, compared to all files below TDS:/scripts// or even
TDS:tex//.

Also not all Lua scripts must depend on LuaTeX. There could be
standalone variants, libraries for stuff not directly related to TeX.

> a solution indeed, but as said ... i wonder if texmfscripts is meant for 
> that [...]

Using TDS:tex// you will have the same problem, if a module wants
to have path components. At least TDS has stricter unique constraints
below TDS:tex//. Two packages of the same format must not share
same file names.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From dak at gnu.org  Tue Dec 11 12:19:45 2007
From: dak at gnu.org (David Kastrup)
Date: Tue, 11 Dec 2007 12:19:45 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <20071211104509.GA27906@irwin.vpn.uni-freiburg.de> (Heiko
	Oberdiek's message of "Tue, 11 Dec 2007 11:45:09 +0100")
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl> <475E3F11.3020101@elvenkind.com>
	<20071211104509.GA27906@irwin.vpn.uni-freiburg.de>
Message-ID: <857ijllbqm.fsf@lola.goethe.zz>

Heiko Oberdiek <oberdiek at uni-freiburg.de> writes:

> On Tue, Dec 11, 2007 at 08:41:05AM +0100, Taco Hoekwater wrote:
>
>> 
>> >> Perhaps a search path could be hacked by using the output of
>> >>   kpsewhich --show-path=texmfscripts
>> >> and appending the module directories to each path component.
>> >> But:
>> >> * LuaTeX's kpse library doesn't have a "show_path" function.
>> 
>> If you want that (or any other access to existing kpathsea stuff)
>> just let me know, it easy to add extra bindings.
>
> "kpse.show_path" is worth a try.
>
> Then the result can be divided in separate path specifications.

kpse.get_path could possibly just return an already separated table.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From root at www.bittext.nl  Tue Dec 11 12:22:07 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Tue, 11 Dec 2007 12:22:07 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071211112256.142971E8C2B8@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/lua/ltexiolib.c
 U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 955.

From pragma at wxs.nl  Tue Dec 11 12:26:02 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 11 Dec 2007 12:26:02 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <20071211110344.GA28234@irwin.vpn.uni-freiburg.de>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>	<475DC2F0.3090500@wxs.nl>	<20071211021005.GA14110@irwin.vpn.uni-freiburg.de>	<475E57A5.6070000@wxs.nl>
	<20071211110344.GA28234@irwin.vpn.uni-freiburg.de>
Message-ID: <475E73CA.3090104@wxs.nl>

Heiko Oberdiek wrote:

> That is not the ide behind TDS. File searching in large trees
> is expensive. Thus the directory structure of TDS differentiates
> between file types to reduce the search space.

sure, but tds is somewhat outdated anyway, personally i tend to 
flattening, for instance fonts ... i tend to use

../fonts/data/vendor/collection

and put everything there -)

>>> The other file types are covered: TeX files, tfm files, type 1 files, ...
>>> Missing is a proper support for lua scripts.
>> lua scripts as such are like perl, ruby, whatever scripts; the 
>> texmfscript path is not for tex related (runtime embedded or whatever) 
>> scripts ... makes packaging a mess when we get a duplicate tree there, 
>> apart from clashes
> 
> A TeX distribution could precompile lua scripts and put them
> in a definite place, e.g.
>   TDS:scripts/lua-compiled//
> (eventually adding a os component, afaik precompiled scripts
> aren't portable).

or one could use a different suffix (which is what i do, but then, i'm 
sure that everyone has his/her preferences)

> Then texmf.cnf could contain:
>   TEXMFSCRIPTS.lua = $TEXMF/scripts/lua-compiled//:$TEXMF/scripts//

no, if you want that route, the idea was/is

LUAINPUTS.latex=$TEXMFSCRIPTS/latex/{lua-compiled,}//

or something like that, since this is a macro package specific thing

> Then as first component only contains compiled lua files, few
> files, compared to all files below TDS:/scripts// or even
> TDS:tex//.
> 
> Also not all Lua scripts must depend on LuaTeX. There could be
> standalone variants, libraries for stuff not directly related to TeX.

those can go into scripts indeed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oberdiek at uni-freiburg.de  Tue Dec 11 13:46:53 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Tue, 11 Dec 2007 13:46:53 +0100
Subject: [Dev-luatex] Module searching
In-Reply-To: <857ijllbqm.fsf@lola.goethe.zz>
References: <20071210211133.GA10371@irwin.vpn.uni-freiburg.de>
	<475DC2F0.3090500@wxs.nl> <475E3F11.3020101@elvenkind.com>
	<20071211104509.GA27906@irwin.vpn.uni-freiburg.de>
	<857ijllbqm.fsf@lola.goethe.zz>
Message-ID: <20071211124652.GA29708@irwin.vpn.uni-freiburg.de>

On Tue, Dec 11, 2007 at 12:19:45PM +0100, David Kastrup wrote:

> Heiko Oberdiek <oberdiek at uni-freiburg.de> writes:
> 
> > "kpse.show_path" is worth a try.
> >
> > Then the result can be divided in separate path specifications.
> 
> kpse.get_path could possibly just return an already separated table.

Good idea. Then
  kpse.find_file(string filename, table pathspecs, [boolean mustexist])
could actually find the file.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From root at www.bittext.nl  Tue Dec 11 16:22:04 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Tue, 11 Dec 2007 16:22:04 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071211152253.047411E8C2B8@www.bittext.nl>

U    svn/trunk/src/libs/lua51/llimits.h
 U    svn/trunk/src/libs/lua51/luaconf.h
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/ltexlib.c
 U    svn/trunk/src/texk/web2c/luatexdir/lua/lnodelib.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texnodes.c
 Checked out revision 958.

From adityam at umich.edu  Tue Dec 11 18:15:52 2007
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 11 Dec 2007 12:15:52 -0500 (EST)
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <20071211084218.GF8114@gamma.logic.tuwien.ac.at>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
	<20071210215337.GB6157@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.99.0712101720400.6946@nqv-yncgbc>
	<20071211084218.GF8114@gamma.logic.tuwien.ac.at>
Message-ID: <alpine.DEB.0.9999.0712111210210.5719@nqv-yncgbc>

On Tue, 11 Dec 2007, Norbert Preining wrote:

> Hi Aditya,
>
> On Mo, 10 Dez 2007, Aditya Mahajan wrote:
>> Ubuntu gusty ships with libpoppler 0.6.2.1. However, I do not get any
>> suggested updates because I am using amd64 architecture, and I see that
>
> Ok, for you
> 	deb http://people.debian.org/~preining/TeX/ luatex-sid/
> 	deb-src http://people.debian.org/~preining/TeX/ luatex-sid/
>
> I will upload amd64 as soon as I can build them. In the meantime you can
> do:
>
> - add the above to /etc/apt/sources
> - aptitude update
> - apt-get source luatex
> - cd luatex-0.20.1
> - dpkg-buildpackage -us -uc -rfakeroot -b
> - cd ..
> - dpkg -i luatex*.deb

Thank you. I needed to install a few packages (libpoppler-dev, quilt, 
fakeroot), and after that everything compiled correctly.

What is required for building a .deb file for amd64 for distribution. Can 
the luatex_0.20.1-1_amd64.deb that I built by the above process be used on 
other amd64 machines? If so, then maybe I can upload the file somewhere.

Aditya

From preining at logic.at  Wed Dec 12 07:18:14 2007
From: preining at logic.at (Norbert Preining)
Date: Wed, 12 Dec 2007 07:18:14 +0100
Subject: [Dev-luatex] beta 0.20.1 released
In-Reply-To: <alpine.DEB.0.9999.0712111210210.5719@nqv-yncgbc>
References: <47596FBC.3080102@elvenkind.com>
	<20071210101331.GG7003@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712101118120.5890@nqv-yncgbc>
	<20071210215337.GB6157@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.99.0712101720400.6946@nqv-yncgbc>
	<20071211084218.GF8114@gamma.logic.tuwien.ac.at>
	<alpine.DEB.0.9999.0712111210210.5719@nqv-yncgbc>
Message-ID: <20071212061814.GB26010@gamma.logic.tuwien.ac.at>

On Di, 11 Dez 2007, Aditya Mahajan wrote:
> Thank you. I needed to install a few packages (libpoppler-dev, quilt, 
> fakeroot), and after that everything compiled correctly.

Not surprising ;-)

> What is required for building a .deb file for amd64 for distribution. Can 
> the luatex_0.20.1-1_amd64.deb that I built by the above process be used on 

Yes. You can send it to other Hardy users, or put it up somewhere. I
will build an amd64 version for Debian/sid

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
He stood up straight and looked the world squarely in the
fields and hills. To add weight to his words he stuck the
rabbit bone in his hair. He spread his arms out wide. `I
will go mad!' he announced.
                 --- Arthur discovering a way of coping with life on
                 --- Prehistoric Earth.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy

From Jonathan.Sauer at silverstroke.com  Wed Dec 12 08:59:12 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 08:59:12 +0100
Subject: [Dev-luatex] More additions to the manual
Message-ID: <9343542E664B894484613D106D7D3F5F84AD39@s-yellow.net.silverstroke.de>

Hello,

some more additions to the manual, diff against 954.


Jonathan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatexref-t.diff
Type: application/octet-stream
Size: 939 bytes
Desc: luatexref-t.diff
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071212/569b4a7c/attachment.obj 

From Jonathan.Sauer at silverstroke.com  Wed Dec 12 09:03:37 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 09:03:37 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
	<475E62D3.7070302@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>

Hello,

> Perhaps the IMPOSSSIBLE. error was just a side-effect of another bug
> that is already fixed (that is possible, and not even all 
> that unlikely, as there were some "uninitialized memory" errors
> in 0.20.0) or possibly the behaviour depends on the used
> texmf.cnf and/or architecture (also possible, but those would be bad).

Well, the bad news is: The bug is still in the trunk as of yesterday
morning/noon.

The good news is: I narrowed down the problem to a simple format and
a simple test file (attached):

1.	Create the format `weird_format' using this command line:

	luatex --fmt=weird_format --ini --jobname=weird_format
weird_format


2.	Typeset 'weird_plain.tex' using this format:

	luatex --fmt=weird_format weird_plain


3.	Observe the result:

	luatex --fmt=weird_format weird_plain
	This is LuaTeX, Version snapshot-0.20.1-2007121117 (Web2C 7.5.6)
	(weird_plain.tex
	[A][1 = elem  2 = sep  3 = elem  4 = sep  ]
	00: call -> 2
	01: jmp -> 51
	02: opencapture table(n = 0) (0)
	03: call -> 10
	04: choice -> 8 (0)
	05: call -> 41
	06: call -> 10
	07: partial_commit -> 5
	08: closecapture close(n = 0) (0)
	09: ret 
	10: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
	19: opencapture simple(n = 0) (0)
	20: choice -> 23 (0)
	21: call -> 41
	22: failtwice 
	23: any * 1
	24: choice -> 30 (0)
	25: choice -> 28 (0)
	26: call -> 41
	27: failtwice 
	28: any * 1
	29: partial_commit -> 25
	30: closecapture close(n = 0) (0)
	31: span [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
	40: ret 
	41: set [(2c)(7b)(7d)]
	50: ret 
	51: end 
	 (undefined) (macro:#1->) [0] )
	Output written on weird_plain.dvi (1 page, 144 bytes).
	Transcript written on weird_plain.log


4.	Change \unexpanded to \detokenize and observe:

	luatex --fmt=weird_format weird_plain
	This is LuaTeX, Version snapshot-0.20.1-2007121117 (Web2C 7.5.6)
	(weird_plain.tex
	[A]
	[B]
	[C]
	[D]
	[E]
	[F][1 = elem  2 = sep  3 = elem  4 = sep  ]
	00: call -> 2
	01: jmp -> 51
	02: opencapture table(n = 0) (0)
	03: call -> 10
	04: choice -> 8 (0)
	05: call -> 41
	06: call -> 10
	07: partial_commit -> 5
	08: closecapture close(n = 0) (0)
	09: ret 
	10: span [(09-0a)(20)]
	19: opencapture simple(n = 0) (0)
	20: choice -> 23 (0)
	21: call -> 41
	22: failtwice 
	23: any * 1
	24: choice -> 30 (0)
	25: choice -> 28 (0)
	26: call -> 41
	27: failtwice 
	28: any * 1
	29: partial_commit -> 25
	30: closecapture close(n = 0) (0)
	31: span [(09-0a)(20)]
	40: ret 
	41: set [(2c)(7b)(7d)]
	50: ret 
	51: end 
	 (undefined) (macro:#1->) [0] )
	Output written on weird_plain.dvi (1 page, 144 bytes).
	Transcript written on weird_plain.log.


5.	Wonder why a .dvi file is created, even though there is no
output ;-)


6.	Try running weird_initex.tex in IniTeX:

	luatex --ini --jobname=weird_initex weird_initex
	This is LuaTeX, Version snapshot-0.20.1-2007121117 (Web2C 7.5.6)
(INITEX)
	(weird_initex.tex
	[A]
	[B]
	[C]
	[D]
	[E]
	[F][1 = elem  2 = sep  3 = elem  4 = sep  ]
	00: call -> 2
	01: jmp -> 51
	02: opencapture table(n = 0) (0)
	03: call -> 10
	04: choice -> 8 (0)
	05: call -> 41
	06: call -> 10
	07: partial_commit -> 5
	08: closecapture close(n = 0) (0)
	09: ret 
	10: span [(09-0a)(20)]
	19: opencapture simple(n = 0) (0)
	20: choice -> 23 (0)
	21: call -> 41
	22: failtwice 
	23: any * 1
	24: choice -> 30 (0)
	25: choice -> 28 (0)
	26: call -> 41
	27: failtwice 
	28: any * 1
	29: partial_commit -> 25
	30: closecapture close(n = 0) (0)
	31: span [(09-0a)(20)]
	40: ret 
	41: set [(2c)(7b)(7d)]
	50: ret 
	51: end 
	 (undefined) (macro::ifFileIncluded#1->:ifFileIncluded) [0] )
	Output written on weird_initex.dvi (1 page, 144 bytes).
	Transcript written on weird_initex.log.


7.	Play with the two commented 'introductions' of \t in
weird_format.tex
	(since '\t' is only introduced, not defined there).


So: The problem only manifests itself, if '\t' is not in TeX's cs hash
table when '\FM:ifFileIncluded' is defined, and if '\FM:ifFileIncluded'
is
defined in the format.

Hypothesis: A bug during format dumping/loading.

@Taco: If you cannot reproduce the bug, maybe it is an issue with
endianness: Intel processors use little endian, while PPCs (used in
the old macs) use big endian.


> Best wishes,
> Taco

Jonathan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Taco-20071211.zip
Type: application/x-zip-compressed
Size: 3985 bytes
Desc: Taco-20071211.zip
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071212/0239f17e/attachment-0001.zip 

From pragma at wxs.nl  Wed Dec 12 09:56:41 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 12 Dec 2007 09:56:41 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
Message-ID: <475FA249.9050005@wxs.nl>

Jonathan Sauer wrote:

... zip file ...

when using lpeg an dmatching, keep in mind that \unexpanded has the side 
effect of introducing spaces

\edef\oeps{\unexpanded{\t\n}} \meaning\oeps
\edef\oeps{\string\t\string\n} \meaning\oeps

indeed your weird file produces an empty page but that due to your macro 
... the simple example

\pdfoutput1 \pdfcompresslevel=0

\def\splitComma{%
	\directlua0{s=1}%
}

\splitComma

also produces an empty page, just call

\show\splitComma

this has to do with the fact that you use tabs in your file and you have 
not handled tab in your format

btw, if you change \unexpanded by \detokenize you get the desired result

a simple test shows ...

\directlua0{lpeg.print(lpeg.S(" \string\t\string\n"))}
\directlua0{\unexpanded{lpeg.print(lpeg.S(" \t\n"))}}
\directlua0{\detokenize{lpeg.print(lpeg.S(" \t\n"))}}

00: set [(09-0a)(20)]
09: end
[]
00: set [(0a)(20)(2e)(42)(45)(49)(4c-4d)(4f-50)(53)]
09: end
[]
00: set [(09-0a)(20)]
09: end

a simpler test is:

\directlua0{print("1 \string\t\string\n")}
\directlua0{\unexpanded{print("2 \t\n")}}
\directlua0{\detokenize{print("3 \t\n")}}

this gives

1

2 IMPOSSIBLE.

3

a simple write as in

\immediate\write16{1 \string\t\string\n}
\immediate\write16{\unexpanded{2 \t\n}}
\immediate\write16{\detokenize{3 \t\n}}

1 \t\n
2 \t \n
3 \t \n

(so, your problem is unrelated to lpeg)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Dec 12 10:04:35 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 12 Dec 2007 10:04:35 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
Message-ID: <475FA423.6010703@elvenkind.com>

Hi,

Jonathan Sauer wrote:
> 
> 5.	Wonder why a .dvi file is created, even though there is no
> output ;-)

Let me answer this first, as this question is easy: there is an
explicit tab character in the input file, here:

\def\splitComma#1{%
	\directlua0{%
^^^^^^^^

Because the minimalistic format does not have plain's \catcode`\^^I=10,
that ^^I gets category code 12, and so is typeset (in the \nullfont).


> 
> Hypothesis: A bug during format dumping/loading.

(Un)fortunately, I still get the correct output. But there are lots
of valgrind warnings while dumping the format, so I will investigate
those next. A bug during the format dumping seems most likely.

> @Taco: If you cannot reproduce the bug, maybe it is an issue with
> endianness: Intel processors use little endian, while PPCs (used in
> the old macs) use big endian.

Wouldn't be the first one, either. Perhaps I should write a funding
proposal for ppc hardware.

Best wishes,
Taco

From Jonathan.Sauer at silverstroke.com  Wed Dec 12 10:05:14 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 10:05:14 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
	<475FA249.9050005@wxs.nl>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>

Hello, 

> when using lpeg an dmatching, keep in mind that \unexpanded 
> has the side effect of introducing spaces

Oh. I used \unexpanded, because sometime someone on this mailing
list noted that it was faster than \detokenize.

> this has to do with the fact that you use tabs in your file 
> and you have not handled tab in your format

Ups. Right. Thanks!

Note to self: Catcodes are evil.

> btw, if you change \unexpanded by \detokenize you get the 
> desired result

I know.

> (so, your problem is unrelated to lpeg)

I know :-) I just stayed with the lpeg example for some reason.


> Hans

Jonathan


From dak at gnu.org  Wed Dec 12 10:10:37 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 12 Dec 2007 10:10:37 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Wed, 12 Dec 2007 10:05:14 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
	<475FA249.9050005@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
Message-ID: <85sl286zxu.fsf@lola.goethe.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

>> when using lpeg an dmatching, keep in mind that \unexpanded 
>> has the side effect of introducing spaces
>
> Oh. I used \unexpanded, because sometime someone on this mailing
> list noted that it was faster than \detokenize.

Should make no difference, I guess.  \detokenize should introduce the
same spaces, using the same algorithm.

>> btw, if you change \unexpanded by \detokenize you get the 
>> desired result
>
> I know.

Oops.  Why would that be?

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From taco at elvenkind.com  Wed Dec 12 10:13:11 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 12 Dec 2007 10:13:11 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <85sl286zxu.fsf@lola.goethe.zz>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475E5E0A.60809@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>	<475E62D3.7070302@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>	<475FA249.9050005@wxs.nl>	<9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
	<85sl286zxu.fsf@lola.goethe.zz>
Message-ID: <475FA627.6090902@elvenkind.com>



David Kastrup wrote:
> "Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:
> 
>>> when using lpeg an dmatching, keep in mind that \unexpanded 
>>> has the side effect of introducing spaces
>> Oh. I used \unexpanded, because sometime someone on this mailing
>> list noted that it was faster than \detokenize.
> 
> Should make no difference, I guess.  \detokenize should introduce the
> same spaces, using the same algorithm.
> 
>>> btw, if you change \unexpanded by \detokenize you get the 
>>> desired result
>> I know.
> 
> Oops.  Why would that be?

Well, it could be a bug, perhaps. :-)








From Jonathan.Sauer at silverstroke.com  Wed Dec 12 10:15:58 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 10:15:58 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de><475E5E0A.60809@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de><475E62D3.7070302@elvenkind.com><9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de><475FA249.9050005@wxs.nl><9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
	<85sl286zxu.fsf@lola.goethe.zz>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>

Hello,

> >> when using lpeg an dmatching, keep in mind that \unexpanded has the

> >> side effect of introducing spaces
> >
> > Oh. I used \unexpanded, because sometime someone on this mailing
list 
> > noted that it was faster than \detokenize.
> 
> Should make no difference, I guess.  \detokenize should 
> introduce the same spaces, using the same algorithm.

Well, currently it makes a difference, three actually:

1.	\unexpanded introduces "IMPOSSIBLE."

2.	\unexpanded introduces spaces after control sequences.

3.	\unexpanded ignores \par's, while \detokenize does not. So empty
	lines in \directlua are no problem with \unexpanded, but result
	in a (Lua) parse error when \detokenize is used.

At least in the context of \directlua.

Also, in terms of speed: \unexpanded only marks all tokens as
unexpandable, while \detokenize creates new character tokens. So the
latter should be somewhat slower.

> >> btw, if you change \unexpanded by \detokenize you get the desired 
> >> result
> >
> > I know.
> 
> Oops.  Why would that be?

Because of a bug? :-)


> --
> David Kastrup, Kriemhildstr. 15, 44793 Bochum

Jonathan


From dak at gnu.org  Wed Dec 12 10:26:53 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 12 Dec 2007 10:26:53 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Wed, 12 Dec 2007 10:15:58 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
	<475FA249.9050005@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
	<85sl286zxu.fsf@lola.goethe.zz>
	<9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>
Message-ID: <85lk806z6q.fsf@lola.goethe.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> Hello,
>
>> >> when using lpeg an dmatching, keep in mind that \unexpanded has the
>
>> >> side effect of introducing spaces
>> >
>> > Oh. I used \unexpanded, because sometime someone on this mailing list 
>> > noted that it was faster than \detokenize.
>> 
>> Should make no difference, I guess.  \detokenize should 
>> introduce the same spaces, using the same algorithm.
>
> Well, currently it makes a difference, three actually:
>
> 1.	\unexpanded introduces "IMPOSSIBLE."

Hm.

> 2.	\unexpanded introduces spaces after control sequences.

Why wouldn't \detokenize do the same?  Wait, it does:

dak at lola:~$ etex
This is pdfTeXk, Version 3.141592-1.40.3 (Web2C 7.5.6)
 %&-line parsing enabled.
**\message{\detokenize{\a b}}
entering extended mode
\a b
*\message{\unexpanded{\a b}}
\a b
*\message{\detokenize{\:x}}
\:x
*\message{\unexpanded{\:x}}
\:x
*\end
No pages of output.
Transcript written on texput.log.

> 3.	\unexpanded ignores \par's, while \detokenize does not. So empty
> 	lines in \directlua are no problem with \unexpanded, but result
> 	in a (Lua) parse error when \detokenize is used.
>
> At least in the context of \directlua.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

I guess that this may be the real reason.

> Also, in terms of speed: \unexpanded only marks all tokens as
> unexpandable, while \detokenize creates new character tokens. So the
> latter should be somewhat slower.

No question about that.

>> >> btw, if you change \unexpanded by \detokenize you get the desired 
>> >> result
>> >
>> > I know.
>> 
>> Oops.  Why would that be?
>
> Because of a bug? :-)

I should think so.  Not sure whether this behavioral difference is
intended, but it certainly feels wrong to me.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From Jonathan.Sauer at silverstroke.com  Wed Dec 12 10:44:18 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 10:44:18 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de><475E5E0A.60809@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de><475E62D3.7070302@elvenkind.com><9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de><475FA249.9050005@wxs.nl><9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de><85sl286zxu.fsf@lola.goethe.zz><9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>
	<85lk806z6q.fsf@lola.goethe.zz>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB30@s-yellow.net.silverstroke.de>

Hello,

[\unexpanded vs \detokenize]

> > Well, currently it makes a difference, three actually:
> >
> > 1.	\unexpanded introduces "IMPOSSIBLE."
> 
> Hm.

Addition: Only in the very specific situation created by the format
weird_format.tex (see my mail from 09:06 this morning).

> > 2.	\unexpanded introduces spaces after control sequences.
> 
> Why wouldn't \detokenize do the same?  Wait, it does:
>
> > At least in the context of \directlua.
> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> 
> I guess that this may be the real reason.

I thought a bit about this, and I think that it is quite useful if
\detokenize does not introduce spaces when used in \directlua, as
opposed to \unexpanded, since sometimes (i.e. when used as a set
in lpeg.S) spaces are completely undesired.

Of course, in these situations \string could be used as an alternative.
But since \detokenize is equivalent (at least as I understand it) to
prefixing each token with \string, \detokenize should not introduce
spaces. IMO.

> >> >> btw, if you change \unexpanded by \detokenize you get 
> >> >> the desired result
> >> >
> >> > I know.
> >> 
> >> Oops.  Why would that be?
> >
> > Because of a bug? :-)
> 
> I should think so.  Not sure whether this behavioral difference is
> intended, but it certainly feels wrong to me.

I think we are talking about slightly different things: You about the
introduction of spaces by \unexpanded and \detokenize, me about the
"IMPOSSIBLE.". The latter most certainly is a bug :-)


> -- 
> David Kastrup, Kriemhildstr. 15, 44793 Bochum

Jonathan


From dak at gnu.org  Wed Dec 12 10:58:37 2007
From: dak at gnu.org (David Kastrup)
Date: Wed, 12 Dec 2007 10:58:37 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB30@s-yellow.net.silverstroke.de>
	(Jonathan Sauer's message of "Wed, 12 Dec 2007 10:44:18 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475E5E0A.60809@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de>
	<475E62D3.7070302@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de>
	<475FA249.9050005@wxs.nl>
	<9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de>
	<85sl286zxu.fsf@lola.goethe.zz>
	<9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>
	<85lk806z6q.fsf@lola.goethe.zz>
	<9343542E664B894484613D106D7D3F5F84AB30@s-yellow.net.silverstroke.de>
Message-ID: <85fxy86xpu.fsf@lola.goethe.zz>

"Jonathan Sauer" <Jonathan.Sauer at silverstroke.com> writes:

> [\unexpanded vs \detokenize]
>
>> > 2.	\unexpanded introduces spaces after control sequences.
>> 
>> Why wouldn't \detokenize do the same?  Wait, it does:
>>
>> > At least in the context of \directlua.
>> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>> 
>> I guess that this may be the real reason.
>
> I thought a bit about this, and I think that it is quite useful if
> \detokenize does not introduce spaces when used in \directlua, as
> opposed to \unexpanded, since sometimes (i.e. when used as a set in
> lpeg.S) spaces are completely undesired.
>
> Of course, in these situations \string could be used as an
> alternative.  But since \detokenize is equivalent (at least as I
> understand it)

Your understanding is wrong.

etex
This is pdfTeXk, Version 3.141592-1.40.3 (Web2C 7.5.6)
 %&-line parsing enabled.
**\message{\detokenize{\x}a}
entering extended mode
\x a
*\message{\string\x a}
\xa
*\end
No pages of output.
Transcript written on texput.log.

> to prefixing each token with \string, \detokenize should not introduce
> spaces. IMO.

I disagree.  I don't think that \detokenize should behave differently
within \directlua.  Not least of all since "within" is very fuzzy to
define when macro expansion is involved.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From pragma at wxs.nl  Wed Dec 12 11:24:55 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 12 Dec 2007 11:24:55 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB30@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de><475E5E0A.60809@elvenkind.com><9343542E664B894484613D106D7D3F5F84AB29@s-yellow.net.silverstroke.de><475E62D3.7070302@elvenkind.com><9343542E664B894484613D106D7D3F5F84AD3A@s-yellow.net.silverstroke.de><475FA249.9050005@wxs.nl><9343542E664B894484613D106D7D3F5F84AB2D@s-yellow.net.silverstroke.de><85sl286zxu.fsf@lola.goethe.zz><9343542E664B894484613D106D7D3F5F84AB2E@s-yellow.net.silverstroke.de>	<85lk806z6q.fsf@lola.goethe.zz>
	<9343542E664B894484613D106D7D3F5F84AB30@s-yellow.net.silverstroke.de>
Message-ID: <475FB6F7.9090109@wxs.nl>

Jonathan Sauer wrote:
> Hello,
> 
> [\unexpanded vs \detokenize]
> 
>>> Well, currently it makes a difference, three actually:
>>>
>>> 1.	\unexpanded introduces "IMPOSSIBLE."
>> Hm.
> 
> Addition: Only in the very specific situation created by the format
> weird_format.tex (see my mail from 09:06 this morning).

there is indeed something going on with \t; we're looking into it

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Dec 12 15:51:12 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 12 Dec 2007 15:51:12 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
Message-ID: <475FF560.2060408@elvenkind.com>


Hi Jonathan,

Jonathan Sauer wrote:
> Okay, this is weird (and long), but it gets clearer near the end:

It turned out that this bug was related to having a non-zero
value for hash_extra in texmf.cnf. The current svn trunk should
run OK.

Best wishes,
Taco


From root at www.bittext.nl  Wed Dec 12 16:22:05 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Wed, 12 Dec 2007 16:22:05 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071212152254.5D91A1E8C2B8@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/luatex.ch
 U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/lua/luatoken.c
 U    svn/trunk/src/texk/web2c/luatexdir/tex/texnodes.c
 U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 962.

From Jonathan.Sauer at silverstroke.com  Wed Dec 12 16:23:23 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Wed, 12 Dec 2007 16:23:23 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AB31@s-yellow.net.silverstroke.de>

Hello Taco, 

> > Okay, this is weird (and long), but it gets clearer near the end:
> 
> It turned out that this bug was related to having a non-zero 
> value for hash_extra in texmf.cnf. The current svn trunk 
> should run OK.

Great! I will test it this evening.


> Best wishes,
> Taco

Thanks,
Jonathan


From Jonathan.Sauer at silverstroke.com  Thu Dec 13 09:29:34 2007
From: Jonathan.Sauer at silverstroke.com (Jonathan Sauer)
Date: Thu, 13 Dec 2007 09:29:34 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
Message-ID: <9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>

Hello,

> > Okay, this is weird (and long), but it gets clearer near the end:
> 
> It turned out that this bug was related to having a non-zero 
> value for hash_extra in texmf.cnf. The current svn trunk 
> should run OK.

To quote an old Tugboat column: "Hey, it works!" :-)


However, there still is another little thing concerning \par inside
\unexpanded and \detokenize inside \directlua. The following PlainTeX
example:

---------------------------------------------------------------------

\def\example{}

\directlua0{texio.write_nl("1: \detokenize{\par}")}
\directlua0{texio.write_nl("2: \unexpanded{\par}")}
\directlua0{texio.write_nl("3: \par")}

\directlua0{texio.write_nl("4: \luaescapestring{\detokenize{\par}}")}
\directlua0{texio.write_nl("5: \luaescapestring{\unexpanded{\par}}")}
\directlua0{texio.write_nl("6: \luaescapestring{\par}")}


\immediate\write16{7: \detokenize{\par}}
\immediate\write16{8: \unexpanded{\par}}

\immediate\write16{9: \meaning\par}

\directlua0{texio.write_nl("A: \detokenize{\if}")}
\directlua0{texio.write_nl("B: \unexpanded{\if}")}

\directlua0{texio.write_nl("C: \detokenize{\example}")}
\directlua0{texio.write_nl("D: \unexpanded{\example}")}

\end

---------------------------------------------------------------------

results in:

---------------------------------------------------------------------

luatex weird_par.tex
This is LuaTeX, Version snapshot-0.20.1-2007121218 (Web2C 7.5.6)
(weird_par.tex
1: par 
2: 
3: 
4: \par 
5: \par 
6: \par 
7: \par 
8: \par 
9: \par
A: if 
B: if 
C: example 
D: example  )
No pages of output.
Transcript written on weird_par.log.

---------------------------------------------------------------------

So the primitive \par is gobbled if inside \directlua unless is has
been detokenized using \detokenize or escaped using \luaescapestring,
but neither are the primitive \if nor the macro \example (the
backslashes are gobbled, because Lua interprets `\p' as `p', `\i' as
`i' and `\e' as `e' when inside a string [not documented, but an
implementation artefact]). This only happens when inside \directlua,
inside \write the result is the same.

This means that if I use \directlua alone or with \unexpanded, I
can have empty lines in the Lua source, since they are ignored. If I
use \detokenize, however, they result in a \par and consequently a
parse error (unless in a Lua string, then they result in an inserted
"par ").

Is this a bug? A feature?

I attached my texmf.cnf ("user" overrides "base") in case this
phenomenon is related to the configuration.


> Best wishes,
> Taco

Jonathan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: texmf_base.cnf
Type: application/octet-stream
Size: 21350 bytes
Desc: texmf_base.cnf
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071213/45cfbbdf/attachment-0002.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: texmf_user.cnf
Type: application/octet-stream
Size: 3079 bytes
Desc: texmf_user.cnf
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071213/45cfbbdf/attachment-0003.obj 

From taco at elvenkind.com  Thu Dec 13 14:40:07 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 13 Dec 2007 14:40:07 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
Message-ID: <47613637.7010402@elvenkind.com>



Jonathan Sauer wrote:
> 
> This means that if I use \directlua alone or with \unexpanded, I
> can have empty lines in the Lua source, since they are ignored. If I
> use \detokenize, however, they result in a \par and consequently a
> parse error (unless in a Lua string, then they result in an inserted
> "par ").
> 
> Is this a bug? A feature?

My current guess is 'feature'. The tokentostring function for
\directlua has 'inhibit_par' turned on, so that you don't get
those pesky \par's that confuse the lua parser.

The output from \detokenize is simply passed on, because it
is not a \par token.

General remark: suck attempts to squeeze tex input to behave
like lua source code are hard to debug and even harder to
predict. It is much less confusing if you create either an
environment like

   \startluacode
   ..
   \stopluacode

with appropriate catcode changes, or if you put the lua code
in a separate file and dofile('thefile').

Best wishes in any case,

Taco

From root at www.bittext.nl  Thu Dec 13 16:22:08 2007
From: root at www.bittext.nl (Cron Daemon)
Date: Thu, 13 Dec 2007 16:22:08 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@www>
	/var/www/luatex.org/www/bin/luatex-svn
Message-ID: <20071213152256.D52561E8C2B4@www.bittext.nl>

U    svn/trunk/src/texk/web2c/luatexdir/luatex.web
 U    svn/trunk/src/texk/web2c/luatexdir/font/luafont.c
 U    svn/trunk/manual/luatexref-t.tex
 U    svn/trunk/manual/luatexref-t.pdf
 Checked out revision 966.

From oberdiek at uni-freiburg.de  Thu Dec 13 17:34:03 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 13 Dec 2007 17:34:03 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <47613637.7010402@elvenkind.com>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
Message-ID: <20071213163403.GA25345@irwin.vpn.uni-freiburg.de>

On Thu, Dec 13, 2007 at 02:40:07PM +0100, Taco Hoekwater wrote:

> General remark: suck attempts to squeeze tex input to behave
> like lua source code are hard to debug and even harder to
> predict. It is much less confusing if you create either an
> environment like
> 
>    \startluacode
>    ..
>    \stopluacode
> 
> with appropriate catcode changes, 

And \endlinechar=10 \catcode10=12 to enable the Lua parser
seeing multiple lines instead of one merged huge line.

> or if you put the lua code
> in a separate file and dofile('thefile').

Or use Lua's module management and make a separate file as module:
  module('foobar', package.seeall)
  ...
That get's loaded via
  require('foobar')

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From dak at gnu.org  Thu Dec 13 18:18:24 2007
From: dak at gnu.org (David Kastrup)
Date: Thu, 13 Dec 2007 18:18:24 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <20071213163403.GA25345@irwin.vpn.uni-freiburg.de> (Heiko
	Oberdiek's message of "Thu, 13 Dec 2007 17:34:03 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>
Message-ID: <85ve72y0m7.fsf@lola.goethe.zz>

Heiko Oberdiek <oberdiek at uni-freiburg.de> writes:

> On Thu, Dec 13, 2007 at 02:40:07PM +0100, Taco Hoekwater wrote:
>
>> General remark: suck attempts to squeeze tex input to behave
>> like lua source code are hard to debug and even harder to
>> predict. It is much less confusing if you create either an
>> environment like
>> 
>>    \startluacode
>>    ..
>>    \stopluacode
>> 
>> with appropriate catcode changes, 
>
> And \endlinechar=10 \catcode10=12 to enable the Lua parser
> seeing multiple lines instead of one merged huge line.

What's the beef with that?  Except inside of strings (where \n will work
fine), the Lua parser does not consider line endings to be different
from spaces.

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From oberdiek at uni-freiburg.de  Thu Dec 13 18:53:21 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 13 Dec 2007 18:53:21 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <85ve72y0m7.fsf@lola.goethe.zz>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>
	<85ve72y0m7.fsf@lola.goethe.zz>
Message-ID: <20071213175320.GA2910@irwin.vpn.uni-freiburg.de>

On Thu, Dec 13, 2007 at 06:18:24PM +0100, David Kastrup wrote:

> Heiko Oberdiek <oberdiek at uni-freiburg.de> writes:
> 
> > On Thu, Dec 13, 2007 at 02:40:07PM +0100, Taco Hoekwater wrote:
> >
> >> General remark: suck attempts to squeeze tex input to behave
> >> like lua source code are hard to debug and even harder to
> >> predict. It is much less confusing if you create either an
> >> environment like
> >> 
> >>    \startluacode
> >>    ..
> >>    \stopluacode
> >> 
> >> with appropriate catcode changes, 
> >
> > And \endlinechar=10 \catcode10=12 to enable the Lua parser
> > seeing multiple lines instead of one merged huge line.
> 
> What's the beef with that?  Except inside of strings (where \n will work
> fine), the Lua parser does not consider line endings to be different
> from spaces.

\catcode`\{=1
\catcode`\}=2
\directlua0{
  do
    local foo
    error("Error in third line")
  end
}
\endlinechar=10 %
\directlua0{%
  do
    local foo
    error("Same line, but useful line number")
  end
}%
\endlinechar=13 %
\end

luatex --ini test
This is LuaTeX, Version snapshot-0.20.0-2007120612 (Web2C 7.5.6) (INITEX)
(test.tex
! LuaTeX error [string "luas[0]"]:1: Error in third line.
l.8 }
     
? 
! LuaTeX error [string "luas[0]"]:3: Same line, but useful line number.
l.15 }
      %
? 
 )
No pages of output.
Transcript written on test.log.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Thu Dec 13 19:00:31 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 13 Dec 2007 19:00:31 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
 Source
In-Reply-To: <20071213175320.GA2910@irwin.vpn.uni-freiburg.de>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>	<475FF560.2060408@elvenkind.com>	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>	<47613637.7010402@elvenkind.com>	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>	<85ve72y0m7.fsf@lola.goethe.zz>
	<20071213175320.GA2910@irwin.vpn.uni-freiburg.de>
Message-ID: <4761733F.70207@elvenkind.com>



Heiko Oberdiek wrote:
> 
> \catcode`\{=1
> \catcode`\}=2
> \directlua0{
>   do
>     local foo
>     error("Error in third line")
>   end
> }
> \endlinechar=10 %

Also:

\directlua0{
    do
      local foo -- not used
      error("File gives an error because the comment does not end")
    end
  }

Best wishes,
Taco

From dak at gnu.org  Thu Dec 13 20:42:05 2007
From: dak at gnu.org (David Kastrup)
Date: Thu, 13 Dec 2007 20:42:05 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <4761733F.70207@elvenkind.com> (Taco Hoekwater's message of "Thu, 
	13 Dec 2007 19:00:31 +0100")
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>
	<85ve72y0m7.fsf@lola.goethe.zz>
	<20071213175320.GA2910@irwin.vpn.uni-freiburg.de>
	<4761733F.70207@elvenkind.com>
Message-ID: <8563z2xtyq.fsf@lola.goethe.zz>

Taco Hoekwater <taco at elvenkind.com> writes:

> Heiko Oberdiek wrote:
>> 
>> \catcode`\{=1
>> \catcode`\}=2
>> \directlua0{
>>   do
>>     local foo
>>     error("Error in third line")
>>   end
>> }
>> \endlinechar=10 %
>
> Also:
>
> \directlua0{
>     do
>       local foo -- not used
>       error("File gives an error because the comment does not end")
>     end
>   }

Well, it's LuaTeX, not Luaweb or so.  So just use

\directlua0{
    do
      local foo % not used
      error("File gives an error because the comment does end")
    end
  }

-- 
David Kastrup, Kriemhildstr. 15, 44793 Bochum

From oberdiek at uni-freiburg.de  Thu Dec 13 21:18:39 2007
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 13 Dec 2007 21:18:39 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <8563z2xtyq.fsf@lola.goethe.zz>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>
	<85ve72y0m7.fsf@lola.goethe.zz>
	<20071213175320.GA2910@irwin.vpn.uni-freiburg.de>
	<4761733F.70207@elvenkind.com> <8563z2xtyq.fsf@lola.goethe.zz>
Message-ID: <20071213201838.GA2882@irwin.vpn.uni-freiburg.de>

On Thu, Dec 13, 2007 at 08:42:05PM +0100, David Kastrup wrote:

> Taco Hoekwater <taco at elvenkind.com> writes:
> 
> > Heiko Oberdiek wrote:
> >> 
> >> \catcode`\{=1
> >> \catcode`\}=2
> >> \directlua0{
> >>   do
> >>     local foo
> >>     error("Error in third line")
> >>   end
> >> }
> >> \endlinechar=10 %
> >
> > Also:
> >
> > \directlua0{
> >     do
> >       local foo -- not used
> >       error("File gives an error because the comment does not end")
> >     end
> >   }
> 
> Well, it's LuaTeX, not Luaweb or so.  So just use
> 
> \directlua0{
>     do
>       local foo % not used
>       error("File gives an error because the comment does end")
>     end
>   }

  local s = "abc.def.ghi"
  string.gsub(s, "%.", "/") % ups

;-)

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From arthur.reutenauer at normalesup.org  Thu Dec 13 21:48:05 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 13 Dec 2007 21:48:05 +0100
Subject: [Dev-luatex] .BEILMOPS or how I stopped worrying and love Open
	Source
In-Reply-To: <8563z2xtyq.fsf@lola.goethe.zz>
References: <9343542E664B894484613D106D7D3F5F84AB23@s-yellow.net.silverstroke.de>
	<475FF560.2060408@elvenkind.com>
	<9343542E664B894484613D106D7D3F5F84AD41@s-yellow.net.silverstroke.de>
	<47613637.7010402@elvenkind.com>
	<20071213163403.GA25345@irwin.vpn.uni-freiburg.de>
	<85ve72y0m7.fsf@lola.goethe.zz>
	<20071213175320.GA2910@irwin.vpn.uni-freiburg.de>
	<4761733F.70207@elvenkind.com> <8563z2xtyq.fsf@lola.goethe.zz>
Message-ID: <20071213204805.GA20328@phare.normalesup.org>

> Well, it's LuaTeX, not Luaweb or so.  So just use
> 
> \directlua0{
>     do
>       local foo % not used
>       error("File gives an error because the comment does end")
>     end
>   }

  And you would have us write

\directlua0{
  function print_with_exclam(str) % Prints 'str' with an exclamation mark
    texio.write_nl(string.format("\string\%s!\string\n", str))
  end

  print_with_exclam("Hello, world")
}

  rather than

\startluacode
  function print_with_exclam(str) -- Prints 'str' with an exclamation mark
    texio.write_nl(string.format("%s!\n", str))
  end
\stopluacode

  ?

  That's not very readable and extremely error-prone, I find.

	Arthur

From taco at elvenkind.com  Mon Dec 17 15:43:26 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 17 Dec 2007 15:43:26 +0100
Subject: [Dev-luatex]   beta 0.20.2 released
Message-ID: <47668B0E.6060307@elvenkind.com>


Hi all,

I have just uploaded the archives for luatex 0.20.2. This
is a simple bugfix release for last week's beta:

* some portability fixes to the build scripts
* a fix for multi-\span in alignments causing unbreakable
   loops
* manual improvements from Jonathan Sauer
* fix for undefined csnames in \directlua if
   web2c's hash_extra is nonzero
* fix for LR text inside of a RL document
* fix for open_read_file callback not being called
   unless find_read_file was also registered
* removed the ocp status message when \ocps are not
   actually used
* "unicodeenc" in the fontforge to_table renamed to
   "unicode" for improved consistency

I have uploaded source and linux/win32 binaries to

       http://foundry.supelec.fr/projects/luatex/

Have fun,

Taco


From martin at oneiros.de  Tue Dec 18 11:00:38 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 18 Dec 2007 11:00:38 +0100
Subject: [Dev-luatex] Fwd: CTAN Update: ant
In-Reply-To: <Pine.LNX.4.64.0712181012460.2531@bk-ng-05.proteosys>
References: <200712180849.lBI8n1Hx011733@comedy.dante.de>
	<Pine.LNX.4.64.0712181012460.2531@bk-ng-05.proteosys>
Message-ID: <68c491a60712180200j1556b42bu4a23aff88fccf3fa@mail.gmail.com>

It's alive :-)

---------- Forwarded message ----------
From: CTAN Announcements <ctan-ann at dante.de>
Date: 18.12.2007 10:13
Subject: CTAN Update: ant
To: ctan-ann at dante.de


On Tue, 18 Dec 2007, Achim Blumensath submitted an update to the

  ant

package.

Location on CTAN: /systems/ant
Summary description: ant is not TeX
License type: pd

Announcement text:
----------------------------------------------------------------------
I'm pleased to announce the release of ant version 0.8. The archive can be
found at

  http://ant.berlios.de

ant is a typesetting system inspired by TeX. It does not aim at
complete compatibility with TeX but focuses instead on a flexible,
clean, and modular design. ant is public domain.

New in this release are:

  o support for margin kerning
  o many improvements of the built in scripting language
  o various bug fixes and minor improvements

----------------------------------------------------------------------

This package is located at
   http://mirror.ctan.org/systems/ant
.  More information is at
   http://tug.ctan.org/info/?id=ant
(if the package is new it may take a day for that information to
appear).  We are supported by the TeX Users Group http://www.tug.org .
Please join a users group; see http://www.tug.org/usergroups.html .
_______________________________________________

Thanks for the upload.

For the CTAN Team
  Rainer Sch?pf

From pragma at wxs.nl  Tue Dec 18 11:05:33 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 18 Dec 2007 11:05:33 +0100
Subject: [Dev-luatex] Fwd: CTAN Update: ant
In-Reply-To: <68c491a60712180200j1556b42bu4a23aff88fccf3fa@mail.gmail.com>
References: <200712180849.lBI8n1Hx011733@comedy.dante.de>	<Pine.LNX.4.64.0712181012460.2531@bk-ng-05.proteosys>
	<68c491a60712180200j1556b42bu4a23aff88fccf3fa@mail.gmail.com>
Message-ID: <47679B6D.60908@wxs.nl>

Martin Schr?der wrote:

> It's alive :-)

i must admit that i only know it by name and never looked at it

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Dec 18 11:25:16 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 18 Dec 2007 11:25:16 +0100
Subject: [Dev-luatex] Fwd: CTAN Update: ant
In-Reply-To: <47679B6D.60908@wxs.nl>
References: <200712180849.lBI8n1Hx011733@comedy.dante.de>	<Pine.LNX.4.64.0712181012460.2531@bk-ng-05.proteosys>	<68c491a60712180200j1556b42bu4a23aff88fccf3fa@mail.gmail.com>
	<47679B6D.60908@wxs.nl>
Message-ID: <4767A00C.8090700@elvenkind.com>



Hans Hagen wrote:
> Martin Schr?der wrote:
> 
>> It's alive :-)
> 
> i must admit that i only know it by name and never looked at it

I saw Patrick played with it a bit.

Best wishes,
Taco

From martin at oneiros.de  Tue Dec 18 11:37:28 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 18 Dec 2007 11:37:28 +0100
Subject: [Dev-luatex] Fwd: CTAN Update: ant
In-Reply-To: <47679B6D.60908@wxs.nl>
References: <200712180849.lBI8n1Hx011733@comedy.dante.de>
	<Pine.LNX.4.64.0712181012460.2531@bk-ng-05.proteosys>
	<68c491a60712180200j1556b42bu4a23aff88fccf3fa@mail.gmail.com>
	<47679B6D.60908@wxs.nl>
Message-ID: <68c491a60712180237u677605e2h91c55adae979eafb@mail.gmail.com>

2007/12/18, Hans Hagen <pragma at wxs.nl>:
> i must admit that i only know it by name and never looked at it

Same for me. Check out the manual. ant seems to be geared towards
LaTeX, but that of course can be changed,

Btw: Achim of course lives in Darmstadt. :-)

Best
   Martin

From preining at logic.at  Thu Dec 20 09:22:07 2007
From: preining at logic.at (Norbert Preining)
Date: Thu, 20 Dec 2007 09:22:07 +0100
Subject: [Dev-luatex] build failure on arm
Message-ID: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>

Hi Taco!

We have a build failure of luatex 0.20.1 on ARM when building the lua51
code:
gcc -g -O2 -Wall  -DLUA_USE_POSIX    -c -o lcoco.o lcoco.c
lcoco.c: In function 'lua_newcthread':
lcoco.c:460: error: '__JMP_BUF_SP' undeclared (first use in this function)
lcoco.c:460: error: (Each undeclared identifier is reported only once
lcoco.c:460: error: for each function it appears in.)
make[3]: *** [lcoco.o] Error 1

>From the compile run:
checking for gcc... (cached) gcc
checking whether the C compiler (gcc  ) works... yes
checking whether the C compiler (gcc  ) is a cross-compiler... no
checking whether we are using GNU C... (cached) yes
checking whether gcc accepts -g... (cached) yes
checking host system type... armv5tel-unknown-linux-gnu
checking target system type... armv5tel-unknown-linux-gnu
checking build system type... armv5tel-unknown-linux-gnu
checking for a BSD compatible install... (cached) /usr/bin/install -c
[...]
OpenBSD-Compat has been configured with the following options:

              Host: armv5tel-unknown-linux-gnu
          Compiler: gcc
    Compiler flags: -g -O2 -Wall -Wpointer-arith -Wuninitialized -Wsign-compare -Wno-pointer-sign -std=gnu99 


The full build log can be found at
http://buildd.debian.org/fetch.cgi?&pkg=luatex&ver=0.20.1-1&arch=arm&stamp=1197282661&file=log


Do you have any idea how that could be fixed?

Thanks a lot and all the best

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
FLODIGARRY (n. Scots)
An ankle-length gabardine or oilskin tarpaulin worn by deep-sea
herring fishermen in Arbroath and publicans in Glasgow.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Thu Dec 20 09:35:24 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 20 Dec 2007 09:35:24 +0100
Subject: [Dev-luatex] build failure on arm
In-Reply-To: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
References: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
Message-ID: <476A294C.4030804@elvenkind.com>


Hi Mike,

Norbert Preining reported that the latest luatex has compile problems
on ARM. It seems to me that some of the automatic detections in
lcoco.c go wrong. I had a quick look but I do not really understand
any of it, so would you be so kind as to have a look and make a guess
about the problem and a possible solution?

I am including COCO 1.1.3 as-is, no patches whatsoever.

Best wishes,
Taco

Norbert Preining wrote:
> Hi Taco!
> 
> We have a build failure of luatex 0.20.1 on ARM when building the lua51
> code:
> gcc -g -O2 -Wall  -DLUA_USE_POSIX    -c -o lcoco.o lcoco.c
> lcoco.c: In function 'lua_newcthread':
> lcoco.c:460: error: '__JMP_BUF_SP' undeclared (first use in this function)
> lcoco.c:460: error: (Each undeclared identifier is reported only once
> lcoco.c:460: error: for each function it appears in.)
> make[3]: *** [lcoco.o] Error 1
> 
>>From the compile run:
> checking for gcc... (cached) gcc
> checking whether the C compiler (gcc  ) works... yes
> checking whether the C compiler (gcc  ) is a cross-compiler... no
> checking whether we are using GNU C... (cached) yes
> checking whether gcc accepts -g... (cached) yes
> checking host system type... armv5tel-unknown-linux-gnu
> checking target system type... armv5tel-unknown-linux-gnu
> checking build system type... armv5tel-unknown-linux-gnu
> checking for a BSD compatible install... (cached) /usr/bin/install -c
> [...]
> OpenBSD-Compat has been configured with the following options:
> 
>               Host: armv5tel-unknown-linux-gnu
>           Compiler: gcc
>     Compiler flags: -g -O2 -Wall -Wpointer-arith -Wuninitialized -Wsign-compare -Wno-pointer-sign -std=gnu99 
> 
> 
> The full build log can be found at
> http://buildd.debian.org/fetch.cgi?&pkg=luatex&ver=0.20.1-1&arch=arm&stamp=1197282661&file=log
> 
> 
> Do you have any idea how that could be fixed?
> 
> Thanks a lot and all the best
> 
> Norbert
> 
> -------------------------------------------------------------------------------
> Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
> Debian Developer <preining at debian.org>                         Debian TeX Group
> gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
> -------------------------------------------------------------------------------
> FLODIGARRY (n. Scots)
> An ankle-length gabardine or oilskin tarpaulin worn by deep-sea
> herring fishermen in Arbroath and publicans in Glasgow.
> 			--- Douglas Adams, The Meaning of Liff


From taco at elvenkind.com  Thu Dec 20 16:45:02 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 20 Dec 2007 16:45:02 +0100
Subject: [Dev-luatex] build failure on arm
In-Reply-To: <20071220145958.GA15868@mike.de>
References: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
	<476A294C.4030804@elvenkind.com> <20071220145958.GA15868@mike.de>
Message-ID: <476A8DFE.5050305@elvenkind.com>



Mike Pall wrote:
> Taco Hoekwater wrote:
>> Norbert Preining reported that the latest luatex has compile problems
>> on ARM. It seems to me that some of the automatic detections in
>> lcoco.c go wrong. I had a quick look but I do not really understand
>> any of it, so would you be so kind as to have a look and make a guess
>> about the problem and a possible solution?
> 
> Looks like the glibc-ports guys stripped an important define. It
> still works with uClibc. Can't blame them really, since we're
> messing with internal structures.
> 
> Quick patch to lcoco.c (the final file, not the coco patch):

Thank you very for this!

Norbert, I have committed that patch to the luatex trunk, #971.
I hope you can somehow contact the original reporter, I have no
way of testing this myself.

Best wishes to all,
Taco

From preining at logic.at  Thu Dec 20 17:54:54 2007
From: preining at logic.at (Norbert Preining)
Date: Thu, 20 Dec 2007 17:54:54 +0100
Subject: [Dev-luatex] build failure on arm
In-Reply-To: <476A8DFE.5050305@elvenkind.com>
References: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
	<476A294C.4030804@elvenkind.com> <20071220145958.GA15868@mike.de>
	<476A8DFE.5050305@elvenkind.com>
Message-ID: <20071220165454.GC14454@gamma.logic.tuwien.ac.at>

Hi Taco, hi Mike,

first thanks for the quick response!

On Do, 20 Dez 2007, Taco Hoekwater wrote:
> Norbert, I have committed that patch to the luatex trunk, #971.
> I hope you can somehow contact the original reporter, I have no
> way of testing this myself.

I will upload luatex 0.20.2 together with this patch and we will see if
the Debian auto builders will succeed or not ;-)

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
BEREPPER
The irrevocable and sturdy fart released in the presence of royalty,
which sounds quite like a small motorbike passing by (but not enough
to be confused with one).
			--- Douglas Adams, The Meaning of Liff

From mikelu-0712 at mike.de  Thu Dec 20 15:59:58 2007
From: mikelu-0712 at mike.de (Mike Pall)
Date: Thu, 20 Dec 2007 15:59:58 +0100
Subject: [Dev-luatex] build failure on arm
In-Reply-To: <476A294C.4030804@elvenkind.com>
References: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
	<476A294C.4030804@elvenkind.com>
Message-ID: <20071220145958.GA15868@mike.de>

Taco Hoekwater wrote:
> Norbert Preining reported that the latest luatex has compile problems
> on ARM. It seems to me that some of the automatic detections in
> lcoco.c go wrong. I had a quick look but I do not really understand
> any of it, so would you be so kind as to have a look and make a guess
> about the problem and a possible solution?

Looks like the glibc-ports guys stripped an important define. It
still works with uClibc. Can't blame them really, since we're
messing with internal structures.

Quick patch to lcoco.c (the final file, not the coco patch):

--- lcoco.c.orig	2007-12-20 15:47:54 +0100
+++ lcoco.c	2007-12-20 15:47:39 +0100
@@ -286,6 +286,9 @@
 #elif defined(__arm__) || defined(__ARM__)
 
 #if __GLIBC__ == 2 || defined(__UCLIBC__)	/* arm-linux-glibc2 */
+#ifndef __JMP_BUF_SP
+#define __JMP_BUF_SP	((sizeof(__jmp_buf)/sizeof(int))-2)
+#endif
 #define COCO_PATCHCTX(coco, buf, func, stack, a0) \
   buf->__jmpbuf[__JMP_BUF_SP+1] = (int)(func); /* pc */ \
   buf->__jmpbuf[__JMP_BUF_SP] = (int)(stack); /* sp */ \

It compiles now with headers from glibc-ports. I'm quite
confident that this runs ok, but can't test this right now
without setting up a complete ARM-glibc environment (eeek).

You might want to run the tests included with the Coco patchset
as part of the installation procedure to make sure the stack
switching works. Mainly cotest.lua, but also the other tests with
a lower number of threads/messages.

--Mike

From preining at logic.at  Fri Dec 21 13:47:12 2007
From: preining at logic.at (Norbert Preining)
Date: Fri, 21 Dec 2007 13:47:12 +0100
Subject: [Dev-luatex] build failure on arm
In-Reply-To: <476A8DFE.5050305@elvenkind.com>
References: <20071220082207.GH24900@gamma.logic.tuwien.ac.at>
	<476A294C.4030804@elvenkind.com> <20071220145958.GA15868@mike.de>
	<476A8DFE.5050305@elvenkind.com>
Message-ID: <20071221124712.GB7051@gamma.logic.tuwien.ac.at>

Hi Taco, hi Mike,

On Do, 20 Dez 2007, Taco Hoekwater wrote:
> Norbert, I have committed that patch to the luatex trunk, #971.
> I hope you can somehow contact the original reporter, I have no
> way of testing this myself.

The new packages was build successfully on ARM now, see
http://buildd.debian.org/fetch.cgi?&pkg=luatex&ver=0.20.2-1&arch=arm&stamp=1198234726&file=log

Thanks a lot.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
KALAMI (n.)
The ancient Eastern art of being able to fold road-maps properly.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Fri Dec 21 16:27:09 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 21 Dec 2007 16:27:09 +0100
Subject: [Dev-luatex] [NTG-context] luatex not compiling
In-Reply-To: <op.t3oxq3icnx1yh1@your-b27fb1c401>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>
	<op.t3oxq3icnx1yh1@your-b27fb1c401>
Message-ID: <476BDB4D.1010405@elvenkind.com>




Idris Samawi Hamid wrote:
> Hi guys,
> 
> On Fri, 21 Dec 2007 03:50:04 -0700, Martin Schr?der <martin at oneiros.de>  
> wrote:
> 
>> 2007/12/20, Hans van der Meer <hansm at science.uva.nl>:
>>> Probably changing the code into:
>>> #include <signal.h>
>>> #ifndef _SIGNAL_H_
>>> #include <sys/signal.h>
>>> #endif
>>> might help, but I have not tested this (some of the pie should be left
>>> for Taco c.s. ;-)
>> Just curious: What does the man page of signal.h say how to include
>> it on OSX? On linux it's <signal.h> ...
> 
> Should'nt this discssion go to the dev-luatex list? :-)

But did not CC the list himself. :-)

This:   http://www.hmug.org/man/2/sigaltstack.php

looks like a Mac OS X manual page. However, Thomas reported that
using stack_t (as the man page says) did not actually help either.

I do not have a recent Macintosh, so I can not test this. If this
issue can not be resolved, I will simply remove the signal trapping
code in the next beta.

Best wishes,
Taco


From gzjjgod at gmail.com  Sun Dec 23 21:25:50 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Mon, 24 Dec 2007 04:25:50 +0800 (CST)
Subject: [Dev-luatex] [NTG-context] luatex not compiling
In-Reply-To: <476BDB4D.1010405@elvenkind.com>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>
	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>
	<op.t3oxq3icnx1yh1@your-b27fb1c401>
	<476BDB4D.1010405@elvenkind.com>
Message-ID: <alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>


On Fri, 21 Dec 2007, Taco Hoekwater wrote:
>>> it on OSX? On linux it's <signal.h> ...
>> 
>> Should'nt this discssion go to the dev-luatex list? :-)
>
> But did not CC the list himself. :-)
>
> This:   http://www.hmug.org/man/2/sigaltstack.php
>
> looks like a Mac OS X manual page. However, Thomas reported that
> using stack_t (as the man page says) did not actually help either.
>
> I do not have a recent Macintosh, so I can not test this. If this
> issue can not be resolved, I will simply remove the signal trapping
> code in the next beta.

Will you please elaborate? I'm not quite sure what you guys are talking
about, but <signal.h> (/usr/include/signal.h) in current Mac OS X (10.5,
10.4 at least) already included <sys/signal.h>.

- Jiang

From preining at logic.at  Sun Dec 23 22:57:58 2007
From: preining at logic.at (Norbert Preining)
Date: Sun, 23 Dec 2007 22:57:58 +0100
Subject: [Dev-luatex] luatex and context for Debian
Message-ID: <20071223215758.GB27216@gamma.logic.tuwien.ac.at>

Dear all,

I have updated luatex and context so currently I can even run MkIV
documents ;-)

Debian/sid users should have them already.

Debian/etch users should get luatex 0.20.2-1 from
        deb http://people.debian.org/~preining/TeX/ luatex/
        deb-src http://people.debian.org/~preining/TeX/ luatex/
Currently I have only i386 packages, but will build amd64 for etch soon.
And maybe powerpc builds can be organized.

For context 2007.12.18-1 please add
        deb http://people.debian.org/~preining/TeX/ context/
        deb-src http://people.debian.org/~preining/TeX/ context/

Just for completeness, it is good to have:
texlive:
        deb http://people.debian.org/~preining/TeX/ tl2007/
        deb-src http://people.debian.org/~preining/TeX/ src/

latin modern:
        deb http://people.debian.org/~preining/TeX/ lmodern/
        deb-src http://people.debian.org/~preining/TeX/ lmodern/


For Ubuntu users of the development version (i.e., that tracking sid
more or less) luatex can be found at
        deb http://people.debian.org/~preining/TeX/ luatex-sid/
        deb-src http://people.debian.org/~preining/TeX/ luatex-sid/

Please comment if you find something missing.

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
HASSOP (n.)
The pocket down the back of an armchair used for storing two-shilling
bits and pieces of Lego.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Mon Dec 24 21:50:39 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 24 Dec 2007 21:50:39 +0100
Subject: [Dev-luatex] [NTG-context]   luatex not compiling
In-Reply-To: <alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>	<op.t3oxq3icnx1yh1@your-b27fb1c401>	<476BDB4D.1010405@elvenkind.com>
	<alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
Message-ID: <47701B9F.3010303@elvenkind.com>

Jjgod Jiang wrote:
> On Fri, 21 Dec 2007, Taco Hoekwater wrote:
>>>> it on OSX? On linux it's <signal.h> ...
>>> Should'nt this discssion go to the dev-luatex list? :-)
>> But did not CC the list himself. :-)
>>
>> This:   http://www.hmug.org/man/2/sigaltstack.php
>>
>> looks like a Mac OS X manual page. However, Thomas reported that
>> using stack_t (as the man page says) did not actually help either.
>>
>> I do not have a recent Macintosh, so I can not test this. If this
>> issue can not be resolved, I will simply remove the signal trapping
>> code in the next beta.
> 
> Will you please elaborate? I'm not quite sure what you guys are talking
> about, but <signal.h> (/usr/include/signal.h) in current Mac OS X (10.5,
> 10.4 at least) already included <sys/signal.h>.

Perhaps not any more in 10.5? Something changed from 10.4 to 10.5 that
broke luatex's build process. Just the building though, pre-compiled
binaries work fine. What exactly has changed is a mystery so far.

Best wishes,
Taco

From gzjjgod at gmail.com  Tue Dec 25 04:14:24 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Tue, 25 Dec 2007 11:14:24 +0800 (CST)
Subject: [Dev-luatex] [NTG-context]   luatex not compiling
In-Reply-To: <47701B9F.3010303@elvenkind.com>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>
	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>
	<op.t3oxq3icnx1yh1@your-b27fb1c401>
	<476BDB4D.1010405@elvenkind.com>
	<alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
	<47701B9F.3010303@elvenkind.com>
Message-ID: <alpine.OSX.1.00.0712251110490.47078@jjgod-computer-2.local>

Hi Taco,

On Mon, 24 Dec 2007, Taco Hoekwater wrote:
> Perhaps not any more in 10.5? Something changed from 10.4 to 10.5 that
> broke luatex's build process. Just the building though, pre-compiled
> binaries work fine. What exactly has changed is a mystery so far.

You're right, I think it has been changed in 10.5, the following text
is copied from sigaltstack(2) in 10.5:

     LEGACY SYNOPSIS
          #include <sys/types.h>
          #include <signal.h>

          The include file <sys/types.h> is necessary.

          struct sigaltstack {
                  char   *ss_sp;
                  int     ss_size;
                  int     ss_flags;
          };

          int
          sigaltstack(const struct sigaltstack *ss,
                      struct sigaltstack *oss);

          The variable types have changed.  Specifically, the
          sigaltstack struct is no longer used.

     COMPATIBILITY
          Use of the (obsolete) sigaltstack struct will cause
          compiler diagnostics.  Use stack_t, defined in
          <signal.h>.

I just checked out the latest luatex source from svn, with
the following patch, luatex builds fine on 10.5:

Index: src/texk/web2c/lib/texmfmp.c
===================================================================
--- src/texk/web2c/lib/texmfmp.c	(revision 972)
+++ src/texk/web2c/lib/texmfmp.c	(working copy)
@@ -405,7 +405,11 @@
  #ifdef WIN32
      SetUnhandledExceptionFilter ((LPTOP_LEVEL_EXCEPTION_FILTER) 
&segv_handler_filter);
  #else
+#if __DARWIN_UNIX03
+    stack_t sigstk;
+#else
      struct sigaltstack sigstk;
+#endif
      struct sigaction segv_act;
      sigstk.ss_sp = xmalloc(SIGSTKSZ);
      sigstk.ss_size = SIGSTKSZ;

HTH.

- Jiang

From martin at oneiros.de  Tue Dec 25 05:25:31 2007
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 25 Dec 2007 05:25:31 +0100
Subject: [Dev-luatex] [NTG-context] luatex not compiling
In-Reply-To: <alpine.OSX.1.00.0712251110490.47078@jjgod-computer-2.local>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>
	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>
	<op.t3oxq3icnx1yh1@your-b27fb1c401> <476BDB4D.1010405@elvenkind.com>
	<alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
	<47701B9F.3010303@elvenkind.com>
	<alpine.OSX.1.00.0712251110490.47078@jjgod-computer-2.local>
Message-ID: <68c491a60712242025k574addf7ydc00068e96e38165@mail.gmail.com>

2007/12/25, Jjgod Jiang <gzjjgod at gmail.com>:
>           #include <sys/types.h>
>           #include <signal.h>

This seems to be a BSDism; OpenBSD has the same includes. But trunk
compiles without problems.

Best
   Martin

From taco at elvenkind.com  Tue Dec 25 08:43:58 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 25 Dec 2007 08:43:58 +0100
Subject: [Dev-luatex] [NTG-context]   luatex not compiling
In-Reply-To: <alpine.OSX.1.00.0712251110490.47078@jjgod-computer-2.local>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>
	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>
	<op.t3oxq3icnx1yh1@your-b27fb1c401>
	<476BDB4D.1010405@elvenkind.com>
	<alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
	<47701B9F.3010303@elvenkind.com>
	<alpine.OSX.1.00.0712251110490.47078@jjgod-computer-2.local>
Message-ID: <4770B4BE.9080605@elvenkind.com>

Jjgod Jiang wrote:
> 
> I just checked out the latest luatex source from svn, with
> the following patch, luatex builds fine on 10.5:

Thank you very much. Patch applied to trunk.

Best wishes,
Taco

From yannis.haralambous at telecom-bretagne.eu  Tue Dec 25 11:13:54 2007
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Tue, 25 Dec 2007 11:13:54 +0100
Subject: [Dev-luatex] [NTG-context]   luatex not compiling
In-Reply-To: <47701B9F.3010303@elvenkind.com>
References: <6386DDEB-CBFF-447E-8517-D97B734CC170@science.uva.nl>	<68c491a60712210250y29b0ef31y4e01fe54e848ba41@mail.gmail.com>	<op.t3oxq3icnx1yh1@your-b27fb1c401>	<476BDB4D.1010405@elvenkind.com>
	<alpine.OSX.1.00.0712240423420.35238@jjgod-computer-2.local>
	<47701B9F.3010303@elvenkind.com>
Message-ID: <A06E01B1-2F10-45C3-8C1A-8CFB4DA70070@telecom-bretagne.eu>

Le 24 d?c. 07 ? 21h50, Taco Hoekwater a ?crit :

> Something changed from 10.4 to 10.5

I spent 30 minutes installing 10.5 and after ten minutes decided to  
return to 10.4 (which took me a few hours).
Nothing worked anymore, neither X, nor Classic. And to install Time  
Machine I needed twice the hard disk I had...

Now I'm desperately trying to install SheepShaver so that I'll still  
be able to run my Classic application (FontStudio!)
when I finally switch to 10.5... Anhyone has tried it?


--
+----------------------------------------------------------------------- 
+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Professor                               http://omega.enstb.org/ 
yannis |
|                                             Tel. +33 (0) 
2.29.00.14.27 |
|                                             Fax  +33 (0) 
2.29.00.12.82 |
| Computer Science  
Department                                           |
| TELECOM  
Bretagne                                                      |
| Technopole de Brest Iroise, CS 83818, 29238 Brest CEDEX 3,  
France     |
| Google-Earth coordinates: 48?21'31.57"N 4? 
34'16.76"W                  |
+----------------------------------------------------------------------- 
+
                             ...pour distinguer l'exterieur d'un  
aquarium,
                                            mieux vaut n'etre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

              Es gab eine Zeit, wo ich nur ungern ueber Schubert  
sprechen,
        nur Naechtens den Baeumen und Sternen von ihm vorerzaehlen  
moegen.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.ntg.nl/mailman/private/dev-luatex/attachments/20071225/dac4f659/attachment.html 

From hansm at science.uva.nl  Wed Dec 26 14:40:13 2007
From: hansm at science.uva.nl (Hans van der Meer)
Date: Wed, 26 Dec 2007 14:40:13 +0100
Subject: [Dev-luatex] subscribe
Message-ID: <A38BACD2-CB81-42A1-9F9C-BD908192CCA5@science.uva.nl>



met vriendelijke groet
Hans van der Meer




