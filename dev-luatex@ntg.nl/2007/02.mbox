From root at aanhet.net  Fri Feb  2 12:22:28 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri,  2 Feb 2007 12:22:28 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070202112228.294A228000BA@server.aanhet.net>

U  luatex/build.sh.cross
 U  luatex/build.sh.linux
 U  luatex/src/configure
 U  luatex/src/configure.in
 U  luatex/src/libs/xpdf/xpdf/config.h
 U  luatex/src/texk/configure
 U  luatex/src/texk/configure.in
 U  luatex/src/texk/config.guess
 U  luatex/src/texk/config.sub
 U  luatex/src/texk/kpathsea/kpathsea.info
 U  luatex/src/texk/kpathsea/kpsewhich.man
 U  luatex/src/texk/kpathsea/cnf.c
 U  luatex/src/texk/kpathsea/texmf.in
 U  luatex/src/texk/web2c/Makefile.in
 U  luatex/src/texk/web2c/luatexdir/image/pdftoepdf.cc
 U  luatex/src/texk/web2c/luatexdir/image/epdf.h
 U  luatex/src/texk/web2c/luatexdir/image/writeimg.c
 U  luatex/src/texk/web2c/luatexdir/avl.c
 U  luatex/src/texk/web2c/luatexdir/avl.h
 U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/lstatslib.c
 U  luatex/src/texk/web2c/luatexdir/lua/lfontlib.c
 U  luatex/src/texk/web2c/luatexdir/ptexlib.h
 U  luatex/src/texk/web2c/luatexdir/font/writet1.c
 U  luatex/src/texk/web2c/luatexdir/font/vfpacket.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/mapfile.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 U  luatex/src/texk/web2c/luatexdir/luatex.defines
 U  luatex/src/texk/web2c/doc/web2c.info
 U  luatex/src/texk/web2c/man/mpost.man
 U  luatex/src/texk/web2c/man/latex.man
 U  luatex/src/texk/web2c/man/ChangeLog
 U  luatex/src/texk/web2c/man/dvitomp.man
 U  luatex/src/texk/web2c/man/pdftex.man
 U  luatex/src/texk/web2c/man/pdfetex.man
 U  luatex/src/texk/web2c/cwebdir/ctangle.w
 U  luatex/src/texk/web2c/cwebdir/Makefile
 U  luatex/src/texk/web2c/cwebdir/cwebmac.tex
 U  luatex/src/texk/web2c/cwebdir/cwebman.tex
 U  luatex/src/texk/web2c/ChangeLog
 U  luatex/src/texk/web2c/fmtutil.in
 U  luatex/src/texk/withenable.ac
 U  luatex/src/texk/make/common.mk
 U  luatex/build.sh
 Checked out revision 267.

From taco at elvenkind.com  Fri Feb  2 12:26:16 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 02 Feb 2007 12:26:16 +0100
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
In-Reply-To: <20070202112228.294A228000BA@server.aanhet.net>
References: <20070202112228.294A228000BA@server.aanhet.net>
Message-ID: <45C31FD8.7020404@elvenkind.com>


(esp. for Hartmut)

more updates to come, later today there will be a snapshot as well.

Taco



From taco at elvenkind.com  Fri Feb  2 22:01:32 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 02 Feb 2007 22:01:32 +0100
Subject: [Dev-luatex]   Snapshot 20070202
Message-ID: <45C3A6AC.7030700@elvenkind.com>

Hi all,

This week was at least one workday too short, but I really wanted to get 
some code out, so I decided to do a snapshot anyway. I've spent quite a
bit of the past week chasing pdftex bugs, and while that is very useful,
it is also very time-consuming, so the current snapshot is (even more
than normal) rough around the edges.

* The pdftex stuff is now updated to 1.40.2, and on top of that, it has

   - an extra patch from Han The Thanh that adds a primitive to control
     the merging of fonts from external pdf images (\pdfreplacefonts),
     and a bugfix for virtual font handling.

   - an extra patch by Hartmut Henkel that removes a number of malloc()s
     and free()s from the calls to the compression library, thereby
     making luatex run a bit faster.

* luatex now happily accepts the following low-level syntax:
	
    \font\myfont = <general text> <at specifier>

   It feeds the <general text> to either kpathsea or a lua script for
   further processing after stripping the braces.

   In itself, this is not all that useful, but the reason for this
   syntax extension is that it paves the road for a macro package
   to do something like this:

    \font\myfont = {font="Times New Roman", color="\darkred",
                    encoding="ec", features="liga", size=10bp}

   without having to resort to system-specific quoting mechanisms.
   Macro (and other) expansion takes inside the braced argument.

   (I am considering adding this extension to \input as well).

* It is now possible to define a font into the font.fonts[]
   directly from lua, but becayse use is limited, I am only
   mentioning it to be complete.
	
   Syntax:	
	<number> id = font.define(<table> font)

* There is a (not very reliable yet) virtual font parser accessible
   from lua.

   Syntax:
	<table> vfdata = font.read_vf(<string> name, <number> size)

   The interpreter tries to give a reasonable representation of a
   virtual font file (the .vf file). Besides a few simple top-level
   items:

     designsize  -- in scaled points
     size        -- also in sp
     name        -- the file name
     checksum    -- the vf checksum
     header      -- the header comment  (if any)

   it also has a top-level array 'fonts' wherein each item is a mini-
   array describing one of te mapped fonts. An example makes this
   easy to understand

    "fonts" = { {"ptmr8a",655360}, {"psyr", 600000} }

   says that the first referenced font (index 1) in this virtual font
   is ptrmr8a.tfm loaded at 10pt,  and the second is psyr.tfm loaded
   at a little over 9pt. These index numbers are used by the character
   command definitions that follow.

   At top level, there is a 'characters' array, just as for a normal
   font, except that each item has only two keys:

     "width"    -- the tfm width (as stored in the .vf)
     "commands" -- an array of virtual font commands for a character.

   each of the items in the 'commands' array is itself a tiny hash.

   Each of those mini-hashes represents a single character packet
   command. Here is a 'commands' entry that contains every possible
   one at least once:

     "commands" = {
        {"push"},                     -- remember where we are
        {"right", 5000},              -- move right 0.08pt
        {"font", 1},                  -- select the fonts[1] entry
        {"setchar", 97},              -- place character 97 'a'
        {"pop"},                      -- go all the way back
        {"down", -200000},            -- move *up* about 3pt
        {"special", "pdf: 1 0 0 rg"}  -- switch to red color
        {"rule", 500000, 20000}       -- draw a bar
        {'special',"pdf: 0 g"}        -- back to black
      }


* But the big news is that you can now define your own virtual fonts
   on the fly, by adding a few statements to the table returned to
   the 'define_font' callback.

   There are a few requirements:

   - The table has to have a top-level key 'type', and it's value
     must be 'virtual'.

     The presence of this key with the specific value 'virtual'
     will trigger handling of the rest of the special virtual font
     fields in the table, but the mere existance of 'type' is
     enough to prevent luatex from looking for a virtual font
     on its own.

     Therefore, this also works 'in reverse': if you are absolutely
     certain that a font is not a virtual font, assigning the value
     'base' or 'real' to 'type' will inhibit tex from looking for a
     virtual font file, thereby saving you a disk search.

   - There must be a top-level 'fonts' array, as explained above.
     Any fonts that are not yet known to luatex at that moment,
     will be loaded automatically (Warning: do not ever use a font
     in 'fonts' with the same name you will return in the table you
     are defining right now!).

   - Each and every character in the fonts needs to have a 'commands'
     key, as explained above.

   The main point behind these restrictions is that a font is
   *either* a base font *or* a virtual font. It cannot be both
   at the same time.


Because it is not that easy to grasp these things immediately --and
from the reference documentation at that-- here is a nice little
example that is suitable for luatex --ini (adapted from Hans Hagen):

% start of virtual-demo.tex
\input plain
\pdfoutput=1
\directlua0 {
   callback.register("define_font",
     function (name,area,size)
        if name == 'cmr10-red' then
            f = font.read_tfm('cmr10',size)
            f.name = 'cmr10-red'
            f.type = 'virtual'
            f.fonts = {{'cmr10', size}}
            for i,v in pairs(f.characters) do
                if (string.char(i)):find("[tacohanshartmut]") then
                    v.commands = {
                        {'special','pdf: 1 0 0 rg'},
                        {'char',i},
                        {'special','pdf: 0 g'},
                    }
                else
                    v.commands = {
                        {'font',1},
                        {'char',i},
                    }
                end
            end
        else
          f = font.tfm_read(name,size)
        end
        return f
        end )
     }

\font\myfont = cmr10-red \myfont  This is a line of text \par
\font\myfontx= cmr10 \myfontx Here is another line of text \par

\bye
% end of virtual-demo.tex


That's it for now. Be careful. Like I said in the beginning of this
message already, there are still quite a few rough edges, and
segfaults are (unfortunately) rather likely still.

Happy TeXing,

Taco


-----

Downloading and installation details:

If you go to

      https://foundry.supelec.fr/frs/?group_id=10

you will see that there are three new released files:

* luatex-snapshot-20070202.tar.bz2
      This is the source tree.

* luatex-snapshot-20070202-win32.zip
      A cross-compiled (mingw) windows binary. This is a web2c
      based binary, so it needs a texmf.cnf file (It will NOT
      work if you have only miktex installed).

* luatex-snapshot-20070202-linux-i386.tar.bz2
      An intel 32 linux binary (linux 2.6.20-rc6, libc 2.3.5)

From root at aanhet.net  Fri Feb  2 22:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri,  2 Feb 2007 22:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070202212221.EFE7D28000B1@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/lfontlib.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 Checked out revision 268.

From arthur.reutenauer at normalesup.org  Sat Feb  3 01:23:09 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 3 Feb 2007 01:23:09 +0100
Subject: [Dev-luatex] Snapshot 20070202
In-Reply-To: <45C3A6AC.7030700@elvenkind.com>
References: <45C3A6AC.7030700@elvenkind.com>
Message-ID: <20070203002309.GA11077@clipper.ens.fr>

> * But the big news is that you can now define your own virtual fonts
>    on the fly, by adding a few statements to the table returned to
>    the 'define_font' callback.

  Brilliant! That's simply great...
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vf.pdf
Type: application/pdf
Size: 9820 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20070203/4fc00678/attachment-0001.pdf 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vf.tex
Type: application/x-tex
Size: 1003 bytes
Desc: not available
Url : http://www.ntg.nl/mailman/private/dev-luatex/attachments/20070203/4fc00678/attachment-0001.tex 

From preining at logic.at  Sat Feb  3 07:23:59 2007
From: preining at logic.at (Norbert Preining)
Date: Sat, 3 Feb 2007 07:23:59 +0100
Subject: [Dev-luatex] Snapshot 20070202
In-Reply-To: <45C3A6AC.7030700@elvenkind.com>
References: <45C3A6AC.7030700@elvenkind.com>
Message-ID: <20070203062359.GB13039@gamma.logic.tuwien.ac.at>

On Fre, 02 Feb 2007, Taco Hoekwater wrote:
> * luatex-snapshot-20070202.tar.bz2

New Debian packages as usual
	deb http://www.tug.org/Debian/ luatex/
	deb-src http://www.tug.org/Debian/ luatex/
Enjoy.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>                    Universit? di Siena
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
CLATHY (adj.)
Nervously indecisive about how safely to dispose of a dud lightbulb.
			--- Douglas Adams, The Meaning of Liff

From taco at elvenkind.com  Sat Feb  3 10:51:17 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 03 Feb 2007 10:51:17 +0100
Subject: [Dev-luatex] Snapshot 20070202
In-Reply-To: <20070203002309.GA11077@clipper.ens.fr>
References: <45C3A6AC.7030700@elvenkind.com>
	<20070203002309.GA11077@clipper.ens.fr>
Message-ID: <45C45B15.2080300@elvenkind.com>

Arthur Reutenauer wrote:
>>* But the big news is that you can now define your own virtual fonts
>>   on the fly, by adding a few statements to the table returned to
>>   the 'define_font' callback.
> 
>   Brilliant! That's simply great...

Glad you like it!

Offlist, Hans and Hartmut were already thinking about an extension
command to allow a virtual font to reference a pdf xform (or perhaps
even a tex box register).



Best, taco

From taco at elvenkind.com  Sat Feb  3 16:01:50 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 03 Feb 2007 16:01:50 +0100
Subject: [Dev-luatex] Snapshot 20070202
In-Reply-To: <45C3A6AC.7030700@elvenkind.com>
References: <45C3A6AC.7030700@elvenkind.com>
Message-ID: <45C4A3DE.50804@elvenkind.com>



Two small things:

Taco Hoekwater wrote:
>    Each of those mini-hashes represents a single character packet
>    command. Here is a 'commands' entry that contains every possible
>    one at least once:
> 
>      "commands" = {
>         {"push"},                     -- remember where we are
>         {"right", 5000},              -- move right 0.08pt
>         {"font", 1},                  -- select the fonts[1] entry
>         {"setchar", 97},              -- place character 97 'a'

That is a typo. The correct command name is "char", without prefix.

And I have just committed an updated manual with the same extra
documentation as was in the announcement message to this list.

Taco

From root at aanhet.net  Sat Feb  3 16:22:22 2007
From: root at aanhet.net (Cron Daemon)
Date: Sat,  3 Feb 2007 16:22:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070203152222.286F328000BE@server.aanhet.net>

U  luatex/manual/luatexref-t.tex
 U  luatex/manual/luatexref-t.pdf
 Checked out revision 269.

From pragma at wxs.nl  Sat Feb  3 21:19:57 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 03 Feb 2007 21:19:57 +0100
Subject: [Dev-luatex] Snapshot 20070202
In-Reply-To: <20070203002309.GA11077@clipper.ens.fr>
References: <45C3A6AC.7030700@elvenkind.com>
	<20070203002309.GA11077@clipper.ens.fr>
Message-ID: <45C4EE6D.8010508@wxs.nl>

Arthur Reutenauer wrote:
>> * But the big news is that you can now define your own virtual fonts
>>    on the fly, by adding a few statements to the table returned to
>>    the 'define_font' callback.
>>     
>
>   Brilliant! That's simply great...
>   
how about this one then

    f = fonts.tfm.read('ec-lmr10',area,size)
    if f then
        f.name = name
        f.type = 'virtual'
        f.fonts = {
            {'ec-lmr10' , size},
            {'ec-lmss10', size},
            {'ec-lmtt10', size}
        }
        for i,v in pairs(f.characters) do
            if i and v then
                local chr = string.char(i)
                if chr:find("[A-Z]") then
                    v.commands = {
                        {'special','pdf: 1 0 0 rg'},
                        {'font',2},
                        {'char',i},
                        {'special','pdf: 0 g'},
                    }
                elseif chr:find("[0-9]") then
                    v.commands = {
                        {'special','pdf: 0 0 1 rg'},
                        {'font',3},
                        {'char',i},
                        {'special','pdf: 0 g'},
                    }
                else
                    v.commands = {
                        {'font',1},
                        {'char',i},
                    }
                end
            end
            if i == 255 then break end
        end
    end

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From root at aanhet.net  Sat Feb  3 22:22:20 2007
From: root at aanhet.net (Cron Daemon)
Date: Sat,  3 Feb 2007 22:22:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070203212220.7063728000F6@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/utils.c
 U  luatex/src/texk/web2c/luatexdir/image/epdf.c
 U  luatex/src/texk/web2c/luatexdir/font/writet1.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/writettf.c
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 Checked out revision 272.

From root at aanhet.net  Sun Feb  4 12:22:20 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun,  4 Feb 2007 12:22:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070204112220.41B502800089@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 274.

From root at aanhet.net  Sun Feb  4 16:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun,  4 Feb 2007 16:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070204152221.5B5B42800105@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/utils.c
 U  luatex/src/texk/web2c/luatexdir/ptexmac.h
 U  luatex/src/texk/web2c/luatexdir/ptexlib.h
 U  luatex/src/texk/web2c/luatexdir/font/vfpacket.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 280.

From root at aanhet.net  Sun Feb  4 22:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun,  4 Feb 2007 22:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070204212221.5802A28000B2@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/manual/luatexref-t.tex
 U  luatex/manual/luatexref-t.pdf
 Checked out revision 284.

From root at aanhet.net  Mon Feb  5 12:22:20 2007
From: root at aanhet.net (Cron Daemon)
Date: Mon,  5 Feb 2007 12:22:20 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070205112220.38E2128000BD@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.ch
 U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/luainit.c
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 U  luatex/manual/luatexref-t.tex
 Checked out revision 287.

From root at aanhet.net  Fri Feb  9 22:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri,  9 Feb 2007 22:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070209212221.DD1F6280008A@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/Makefile.in
 U  luatex/src/texk/web2c/luatexdir/lua/lfontlib.c
 A  luatex/src/texk/web2c/luatexdir/font/ttfspecial.c
 A  luatex/src/texk/web2c/luatexdir/font/ttflua.c
 A  luatex/src/texk/web2c/luatexdir/font/ustring.h
 A  luatex/src/texk/web2c/luatexdir/font/cjk.c
 A  luatex/src/texk/web2c/luatexdir/font/basics.h
 A  luatex/src/texk/web2c/luatexdir/font/sd.h
 A  luatex/src/texk/web2c/luatexdir/font/chardata.h
 A  luatex/src/texk/web2c/luatexdir/font/charset.h
 A  luatex/src/texk/web2c/luatexdir/font/ttf.h
 A  luatex/src/texk/web2c/luatexdir/font/gwwiconv.c
 A  luatex/src/texk/web2c/luatexdir/font/ttfencoding.c
 A  luatex/src/texk/web2c/luatexdir/font/ttfotf.c
 A  luatex/src/texk/web2c/luatexdir/font/ttfatt.c
 A  luatex/src/texk/web2c/luatexdir/font/gwwiconv.h
 A  luatex/src/texk/web2c/luatexdir/font/namelist.c
 A  luatex/src/texk/web2c/luatexdir/font/psfont.h
 A  luatex/src/texk/web2c/luatexdir/font/psread.c
 A  luatex/src/texk/web2c/luatexdir/font/alphabet.c
 A  luatex/src/texk/web2c/luatexdir/font/pua.c
 A  luatex/src/texk/web2c/luatexdir/font/fvfonts.c
 A  luatex/src/texk/web2c/luatexdir/font/splinefont.h
 Checked out revision 288.

From arthur.reutenauer at normalesup.org  Sun Feb 11 16:48:56 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 11 Feb 2007 16:48:56 +0100
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
In-Reply-To: <20070209212221.DD1F6280008A@server.aanhet.net>
References: <20070209212221.DD1F6280008A@server.aanhet.net>
Message-ID: <20070211154856.GA28737@clipper.ens.fr>

>  Checked out revision 288.

  This does not compile right away, the Makefile stops here:

gcc -DHAVE_CONFIG_H  -I. -I../../../../src/texk/web2c/luatexdir -I..
-I../../../../src/texk/web2c/luatexdir/../..  -I..
-I../../../../src/texk/web2c/luatexdir/.. -I../..
-I../../../../src/texk/web2c/luatexdir/../.. -I../../../libs/md5
-I../../../../src/texk/web2c/luatexdir/../../../libs/md5 -I../../../libs/libpng
-I../../../../src/texk/web2c/luatexdir/../../../libs/libpng -I../../../libs/zlib
-I../../../../src/texk/web2c/luatexdir/../../../libs/zlib -I../../../libs/xpdf
-I../../../libs/xpdf/..
-I../../../../src/texk/web2c/luatexdir/../../../libs/xpdf
-I../../../../src/texk/web2c/luatexdir/../../../libs/xpdf/..
-I../../../libs/obsdcompat -I../../../libs/obsdcompat/..
-I../../../../src/texk/web2c/luatexdir/../../../libs/obsdcompat
-I../../../../src/texk/web2c/luatexdir/../../../libs/obsdcompat/.. -DpdfTeX -g
-O2  -c ../../../../src/texk/web2c/luatexdir/font/ttfotf.c -o font/ttfotf.o
../../../../src/texk/web2c/luatexdir/font/ttfotf.c:3141: error: conflicting types for ?getsid?
/usr/include/unistd.h:510: error: previous declaration of ?getsid? was
here
../../../../src/texk/web2c/luatexdir/font/ttfotf.c: In function ?MMFillFromVAR?:
../../../../src/texk/web2c/luatexdir/font/ttfotf.c:5272: warning: passing argument 1 of ?copy? from incompatible pointer type
../../../../src/texk/web2c/luatexdir/font/ttfotf.c:5272: warning: assignment from incompatible pointer type
../../../../src/texk/web2c/luatexdir/font/ttfotf.c:5279: warning: passing argument 1 of ?copy? from incompatible pointer type
../../../../src/texk/web2c/luatexdir/font/ttfotf.c:5279: warning: assignment from incompatible pointer type
make[1]: *** [font/ttfotf.o] Error 1
make: *** [luatexdir/libpdf.a] Error 2

From taco at elvenkind.com  Sun Feb 11 17:12:00 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 11 Feb 2007 17:12:00 +0100
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
In-Reply-To: <20070211154856.GA28737@clipper.ens.fr>
References: <20070209212221.DD1F6280008A@server.aanhet.net>
	<20070211154856.GA28737@clipper.ens.fr>
Message-ID: <45CF4050.6050406@elvenkind.com>

Arthur Reutenauer wrote:
> -O2  -c ../../../../src/texk/web2c/luatexdir/font/ttfotf.c -o font/ttfotf.o
> ../../../../src/texk/web2c/luatexdir/font/ttfotf.c:3141: error: conflicting types for ?getsid?
> /usr/include/unistd.h:510: error: previous declaration of ?getsid? was
> here

Ah, ok. It seems OSX has a getsid function thanks to XOOPEN.
Luckily, that was easy to fix, because luatex's function is something
completely different. I would be happy if you could try again, I
committed a one-line fix.

Btw, this code implements

	font.read_ttf("filename")
and
	font.read_otf("filename")

if it succeeds, the return value is a table containing a lua
representation of the font, with a bit of preprocessing applied.

I am not totally happy with the interface, and that is why I have
not created a snapshot yet.

Best,

Taco

From arthur.reutenauer at normalesup.org  Sun Feb 11 17:54:11 2007
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 11 Feb 2007 17:54:11 +0100
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
In-Reply-To: <45CF4050.6050406@elvenkind.com>
References: <20070209212221.DD1F6280008A@server.aanhet.net>
	<20070211154856.GA28737@clipper.ens.fr>
	<45CF4050.6050406@elvenkind.com>
Message-ID: <20070211165411.GA11242@clipper.ens.fr>

> Ah, ok. It seems OSX has a getsid function thanks to XOOPEN.
> Luckily, that was easy to fix, because luatex's function is something
> completely different. I would be happy if you could try again, I
> committed a one-line fix.

  It works, thanks for the quick update.

> Btw, this code implements
> 
> 	font.read_ttf("filename")
> and
> 	font.read_otf("filename")

  Sounds great.

From root at aanhet.net  Sun Feb 11 22:22:19 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun, 11 Feb 2007 22:22:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070211212219.3A3A328000E7@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/ttf.h
 Checked out revision 289.

From root at aanhet.net  Mon Feb 12 22:22:24 2007
From: root at aanhet.net (Cron Daemon)
Date: Mon, 12 Feb 2007 22:22:24 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070212212224.48A3C28000A1@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/ttflua.c
 U  luatex/src/texk/web2c/luatexdir/font/ttfotf.c
 U  luatex/src/texk/web2c/luatexdir/font/splinefont.h
 Checked out revision 291.

From root at aanhet.net  Tue Feb 13 16:22:14 2007
From: root at aanhet.net (Cron Daemon)
Date: Tue, 13 Feb 2007 16:22:14 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070213152214.E72292800106@server.aanhet.net>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': could not connect to server (https://scm.foundry.supelec.fr)

From root at aanhet.net  Wed Feb 14 12:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Wed, 14 Feb 2007 12:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070214112221.2F65F2800119@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/llualib.c
 U  luatex/src/texk/web2c/luatexdir/lua/lfontlib.c
 U  luatex/src/texk/web2c/luatexdir/lua/luastuff.c
 U  luatex/src/texk/web2c/luatexdir/font/ttflua.c
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/ttf.h
 U  luatex/src/texk/web2c/luatexdir/font/ttfotf.c
 U  luatex/src/texk/web2c/luatexdir/font/ttfatt.c
 U  luatex/src/texk/web2c/luatexdir/font/tfmofm.c
 Checked out revision 298.

From root at aanhet.net  Wed Feb 14 22:22:22 2007
From: root at aanhet.net (Cron Daemon)
Date: Wed, 14 Feb 2007 22:22:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070214212222.8B2F828000AF@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 300.

From root at aanhet.net  Thu Feb 15 12:22:19 2007
From: root at aanhet.net (Cron Daemon)
Date: Thu, 15 Feb 2007 12:22:19 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070215112219.ADB762800088@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 Checked out revision 301.

From root at aanhet.net  Thu Feb 15 16:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Thu, 15 Feb 2007 16:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070215152221.96A6428000BC@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/lua/ltexlib.c
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/managed-sa.c
 Checked out revision 304.

From root at aanhet.net  Thu Feb 15 22:22:35 2007
From: root at aanhet.net (Cron Daemon)
Date: Thu, 15 Feb 2007 22:22:35 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070215212235.CCED2280009E@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 Checked out revision 306.

From taco at elvenkind.com  Fri Feb 16 19:00:38 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 16 Feb 2007 19:00:38 +0100
Subject: [Dev-luatex] opentype font support
Message-ID: <45D5F146.2020708@elvenkind.com>

Hi all,

A quick note from me. I did not do anything useful on three out of the 
past seven days, thanks to a short-lived but nasty virus. As a result,
I am a little bit behind on my schedule.

== opentype font writing ==

The current code can actually already produce a syntactically correct
PDF with wholesale embedded OpenType font, but any kind of metrics or
ToUnicode information is still totally absent.

As a result of that each character is exactly 1em wide, and cut&paste
produces absolute rubbish. This is too ugly to be usable for anything
at all, so you have to wait a little bit longer. As soon as I can get
the Metrics for OpenType fonts correctly into the PDF, there will be
a new snapshot (probably on sunday, this is not rocket science).

Subsetting and ToUnicode is something to worry a little later, it is
a bit less urgent than having valid output one can look at.

== Opentype font reading ==

What is still missing from the otf-to-lua parser is any kind of Apple
support. The code does not handle Mac names properly yet, not does
it understand anything about AAT or Apple MM fonts.

I would be happy if someone knowledgeable could borrow me an OpenType
font with AAT features so I could implement and test support for that
next week. I actually own an OS X Tiger license, so it would probably
even be legal ;-)

== Aleph bidi support ==

I have started work on supporting Aleph's bidi typesetting in PDF
mode as well, simple text seems to be largely ok now. More complicated
documents will no doubt still show some bugs, but fixing those will
be easy (once they are discovered). Exactly what happens with specials
is not yet investigated.

Omega (16-bit wide) virtual fonts now work OK in PDF mode.

== Other known bugs ==

The following problems are still open and will need attention next
week:

* Word-boundary ligatures are corrupt. This is a result of
   differences in the internal data structure.
* Font expansion is current disabled, also because of data structure
   issues
* The experimental \letterspacefont is also non-functional, but I
   am very tempted to leave that alone for the moment.
* The font-character arrays can eat up quite a lot of memory now that
   encodings can be 21bits wide, I will have to re-implement the
   storage to be more memory-efficient.


So far,

Taco






From root at aanhet.net  Fri Feb 16 22:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri, 16 Feb 2007 22:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070216212221.B9C432800098@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 U  luatex/src/texk/web2c/luatexdir/luatex.defines
 Checked out revision 313.

From root at aanhet.net  Sat Feb 17 22:22:21 2007
From: root at aanhet.net (Cron Daemon)
Date: Sat, 17 Feb 2007 22:22:21 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070217212221.73C232800101@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/ptexmac.h
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 317.

From root at aanhet.net  Sun Feb 18 12:22:22 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun, 18 Feb 2007 12:22:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070218112222.2845D2800161@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/vfpacket.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 321.

From root at aanhet.net  Sun Feb 18 16:22:22 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun, 18 Feb 2007 16:22:22 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070218152222.B4A552800167@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/font/ttflua.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/manual/luatexref-t.tex
 U  luatex/manual/luatexref-t.pdf
 Checked out revision 324.

From taco at elvenkind.com  Sun Feb 18 16:59:49 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 18 Feb 2007 16:59:49 +0100
Subject: [Dev-luatex]   Snapshot 20070218
Message-ID: <45D877F5.3040007@elvenkind.com>

Hi all,

Finally, a new snapshot. Or something close to that, at least: I do not
have all the required scripts on this machine, so I cannot create the
source tarball from here, I'll do that tomorrow from the office.

That should not matter much though, because I have uploaded windows
and linux binaries, the source is properly checked in, and the updated
manual can be fetched from here:

   http://context.aanhet.net/svn/luatex/manual/luatexref-t.pdf

Most of the news was already in the posting I made fridaynight, but in
case you missed that, here is a rerun and updated summary:

* The pdftex stuff is now updated to 1.40.3
   (and on top of that, it still has those extra patches announced in
   snapshot 20070202)

* The virtual font parser is debugged and now appears rather stable.

* There is one extra virtual command:

     "commands" = {
        {"slot", 1, 97}, -- place character 97 'a' in local font 1.
      }

   This is just a shortcut for {"font",1}, {"char", 97}

* Some small memory leaks have been fixed. Luatex does not leak big
   time, but I'd like to get back to valgrind reporting '0 out of 0',
   instead of the current 800 bytes or so (that is a slow process).

* You can read a truetype or opentype font from within lua code
   using font.read_ttf() or font.read_otf(), respectively.

   This feature uses a fair bit of the fontforge code, making the
   binary rather a bit larger than before. Just so you know.

   Apple (AAT, as well as encoding) support is still largely missing,
   and bitmap-only and old Multiple-Master truetype fonts are not
   supported at all (and never will be).

   The output format is (shadily) documented in the reference manual.
   At the moment, it very closely resembles the internal font stucture
   that is used by fontforge.

* LuaTeX can now write wide OpenType fonts to the PDF file.

   There is no subsetting support yet, and a ToUnicode CMap is also
   still missing, but nevertheless it is already somewhat useful. The
   rule is very simple: if a font uses code points above 255, then it
   is considered to be a `wide' font, and it will be written out as
   a Type0 CID-keyed font to the PDF.

   Caveat: Getting suitable metrics into LuaTeX can be a bit of problem
   right now, because font.read_otf() does not produce anything that
   can be fed back into define_font without extra processing.  Hans has
   some experimental Lua code for ConTeXt (of course :-)) and that is
   how I know it works.  You can expect a nicer interface soon,
   hopefully next week, in the form of a simplistic table conversion
   routine.

* I have started work on supporting Aleph's bidi typesetting in PDF
   mode as well, simple text seems to be largely ok. More complicated
   documents will no doubt still show some bugs, but fixing those will
   be easy (once they are discovered). Exactly what happens with specials
   is not yet investigated.

* Omega's (16-bit) wide virtual fonts now work OK in PDF mode. This
   means that many Aleph files can now be run in PDF mode directly.
   (the documents that use UTF-8 input encoding)



Happy TeXing,

Taco


-----

Downloading and installation details:

If you go to

      https://foundry.supelec.fr/frs/?group_id=10

you will see that there are three new released files:

* luatex-snapshot-20070218.tar.bz2
      This is the source tree.

* luatex-snapshot-20070218-win32.zip
      A cross-compiled (mingw) windows binary. This is a web2c
      based binary, so it needs a texmf.cnf file (It will NOT
      work if you have only miktex installed).

* luatex-snapshot-20070218-linux-i386.tar.bz2
      An intel 32 linux binary (2.6.17)


From taco at elvenkind.com  Mon Feb 19 10:54:39 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 19 Feb 2007 10:54:39 +0100
Subject: [Dev-luatex] Snapshot 20070218
In-Reply-To: <45D877F5.3040007@elvenkind.com>
References: <45D877F5.3040007@elvenkind.com>
Message-ID: <45D973DF.3020700@elvenkind.com>



Taco Hoekwater wrote:
> Hi all,
> 
> Finally, a new snapshot. Or something close to that, at least: I do not
> have all the required scripts on this machine, so I cannot create the
> source tarball from here, I'll do that tomorrow from the office.

I just did that. The file is luatex-snapshot-20070218.tar.bz2

Also, Arthur has pointed out there is a severe error in the manual.
In the virtual font example on page 55, it reads:

          f = font.tfm_read(name,size)

there is no such function. The correct text is:

          f = font.read_tfm(name,size)

Best wishes,
Taco

From gzjjgod at gmail.com  Tue Feb 20 01:35:09 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Tue, 20 Feb 2007 08:35:09 +0800
Subject: [Dev-luatex] register a callback on macro expansion?
Message-ID: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>

Hi,

I'm wondering if I can register a Lua function as callback on the
expansion of a specific macro? I'm expecting something like this:

\def\hello#1{#1}

callback.register("macro.hello",lua_func_hello)

when using \hello{abc}, the lua_func_hello will get called and have
access to the arguments of \hello (abc).

In this way, we can implement loop structure in lua (which I think
is a cleaner way than tail recursion in TeX).

- jjgod.

From taco at elvenkind.com  Tue Feb 20 10:08:23 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 20 Feb 2007 10:08:23 +0100
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
Message-ID: <45DABA87.3020603@elvenkind.com>


Hi Jjgod,

Jjgod Jiang wrote:
> Hi,
> 
> I'm wondering if I can register a Lua function as callback on the
> expansion of a specific macro? I'm expecting something like this:
> 
> \def\hello#1{#1}
> 
> callback.register("macro.hello",lua_func_hello)
> 
> when using \hello{abc}, the lua_func_hello will get called and have
> access to the arguments of \hello (abc).
> 
> In this way, we can implement loop structure in lua (which I think
> is a cleaner way than tail recursion in TeX).

Not right now, but soon. (perhaps using a slighly different interface,
because your example makes the macro definition body pointless, and
that can be confusing).

Cheers, Taco






From pragma at wxs.nl  Tue Feb 20 09:49:14 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Feb 2007 09:49:14 +0100
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
Message-ID: <45DAB60A.5030506@wxs.nl>

Jjgod Jiang wrote:
> Hi,
>
> I'm wondering if I can register a Lua function as callback on the
> expansion of a specific macro? I'm expecting something like this:
>
> \def\hello#1{#1}
>
> callback.register("macro.hello",lua_func_hello)
>
> when using \hello{abc}, the lua_func_hello will get called and have
> access to the arguments of \hello (abc).
>   
\def\hello#1{\directlua 0 {YourFunction("#1")}}


Hans  

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From gzjjgod at gmail.com  Tue Feb 20 12:07:20 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Tue, 20 Feb 2007 19:07:20 +0800
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <45DAB60A.5030506@wxs.nl>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
	<45DAB60A.5030506@wxs.nl>
Message-ID: <ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>

Hi,

2007/2/20, Hans Hagen <pragma at wxs.nl>:
> \def\hello#1{\directlua 0 {YourFunction("#1")}}

Yep. That works (but not for lua state 0, I use state 1 instead.)
But I'll need the slunicode library to process string like this, is
it available now? I have not found it on luatexref-t.pdf.

Thanks.

- jjgod.

From pragma at wxs.nl  Tue Feb 20 12:18:18 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Feb 2007 12:18:18 +0100
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
	<45DAB60A.5030506@wxs.nl>
	<ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>
Message-ID: <45DAD8FA.4010304@wxs.nl>

Jjgod Jiang wrote:
> Hi,
>
> 2007/2/20, Hans Hagen <pragma at wxs.nl>:
>> \def\hello#1{\directlua 0 {YourFunction("#1")}}
>
> Yep. That works (but not for lua state 0, I use state 1 instead.)
> But I'll need the slunicode library to process string like this, is
> it available now? I have not found it on luatexref-t.pdf.
this is state independent, so state 1 should work; indeed the slunicode lib is there as is lfs

Hans 

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From gzjjgod at gmail.com  Tue Feb 20 12:33:52 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Tue, 20 Feb 2007 19:33:52 +0800
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <45DAD8FA.4010304@wxs.nl>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
	<45DAB60A.5030506@wxs.nl>
	<ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>
	<45DAD8FA.4010304@wxs.nl>
Message-ID: <ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>

Hi,

2007/2/20, Hans Hagen <pragma at wxs.nl>:
> this is state independent, so state 1 should work; indeed the slunicode lib is there as is lfs

I've tried with

\directlua 0 {
    function hello(str)
        tex.print(str)
    end
}

\def\hello#1{\directlua 0 {hello("#1")}}

\hello{hi}
\bye

But only got:

! LuaTeX error [string "luas[0]"]:1: attempt to index global 'tex' (a nil value
).
\hello #1->\directlua 0 {hello("#1")}

l.9 \hello{hi}

- jjgod.

From taco at elvenkind.com  Tue Feb 20 12:52:17 2007
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 20 Feb 2007 12:52:17 +0100
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>	<45DAB60A.5030506@wxs.nl>	<ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>	<45DAD8FA.4010304@wxs.nl>
	<ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>
Message-ID: <45DAE0F1.8010805@elvenkind.com>

Jjgod Jiang wrote:
> 
> But only got:
> 
> ! LuaTeX error [string "luas[0]"]:1: attempt to index global 'tex' (a nil value
> ).

Which snapshot are you using? It looks like a bug that was present a
month or so ago.

Cheers,

Taco


From pragma at wxs.nl  Tue Feb 20 12:56:29 2007
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Feb 2007 12:56:29 +0100
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
	<45DAB60A.5030506@wxs.nl>
	<ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>
	<45DAD8FA.4010304@wxs.nl>
	<ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>
Message-ID: <45DAE1ED.1080500@wxs.nl>

Jjgod Jiang wrote:
> Hi,
>
> 2007/2/20, Hans Hagen <pragma at wxs.nl>:
>> this is state independent, so state 1 should work; indeed the 
>> slunicode lib is there as is lfs
>
> I've tried with
>
> \directlua 0 {
>    function hello(str)
>        tex.print(str)
>    end
> }
>
> \def\hello#1{\directlua 0 {hello("#1")}}
>
> \hello{hi}
> \bye
>
> But only got:
>
> ! LuaTeX error [string "luas[0]"]:1: attempt to index global 'tex' (a 
> nil value
> ).
> \hello #1->\directlua 0 {hello("#1")}
>
> l.9 \hello{hi}
\starttext

\directlua 0 { function hello(str) tex.print(str) end }
\directlua 5 { function hello(str) tex.print(str) end }

\directlua 0 { tex.print("HELLO") }
\directlua 5 { tex.print("HELLO") }

\directlua 0 { hello("HELLO") }
\directlua 5 { hello("HELLO") }

\def\hello#1{\directlua 5 {hello("#1")}}

\hello{HELLO}

\stoptext

works ok here (1 too) so there is another problem; it could be that luatex is not in luatex mode or that somehow the tex table gets messed up 

Hans 

-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------


From gzjjgod at gmail.com  Tue Feb 20 14:12:28 2007
From: gzjjgod at gmail.com (Jjgod Jiang)
Date: Tue, 20 Feb 2007 21:12:28 +0800
Subject: [Dev-luatex] register a callback on macro expansion?
In-Reply-To: <45DAE0F1.8010805@elvenkind.com>
References: <ddd65cda0702191635qb0faa8ak13382d1cd37fbb44@mail.gmail.com>
	<45DAB60A.5030506@wxs.nl>
	<ddd65cda0702200307p47895eb1jf4bfa7c994dd3a45@mail.gmail.com>
	<45DAD8FA.4010304@wxs.nl>
	<ddd65cda0702200333s41b3d459va8367fd3c9f5dd58@mail.gmail.com>
	<45DAE0F1.8010805@elvenkind.com>
Message-ID: <ddd65cda0702200512t60a8495cve813548bf31e5386@mail.gmail.com>

Hi,

2007/2/20, Taco Hoekwater <taco at elvenkind.com>:
> Which snapshot are you using? It looks like a bug that was present a
> month or so ago.

I was using snapshot-20070202 just then. It's ok now in snapshot-20070218.

Thanks.

- jjgod.

From preining at logic.at  Tue Feb 20 22:46:26 2007
From: preining at logic.at (Norbert Preining)
Date: Tue, 20 Feb 2007 22:46:26 +0100
Subject: [Dev-luatex] Snapshot 20070218
In-Reply-To: <45D973DF.3020700@elvenkind.com>
References: <45D877F5.3040007@elvenkind.com> <45D973DF.3020700@elvenkind.com>
Message-ID: <20070220214626.GC19009@gamma.logic.tuwien.ac.at>

On Mon, 19 Feb 2007, Taco Hoekwater wrote:
> I just did that. The file is luatex-snapshot-20070218.tar.bz2

Debian package as usual at
	deb http://www.tug.org/texlive/Debian/ luatex/
	deb-src http://www.tug.org/texlive/Debian/ luatex/
Enjoy

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>                    Universit? di Siena
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
GREAT TOSSON (n.)
A fat book containing four words and six cartoons which cost ?6.95.
			--- Douglas Adams, The Meaning of Liff

From root at aanhet.net  Fri Feb 23 16:25:32 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri, 23 Feb 2007 16:25:32 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070223152532.D8E24280017B@server.aanhet.net>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': could not connect to server (https://scm.foundry.supelec.fr)

From root at aanhet.net  Fri Feb 23 22:22:34 2007
From: root at aanhet.net (Cron Daemon)
Date: Fri, 23 Feb 2007 22:22:34 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070223212234.B2FCD280009F@server.aanhet.net>

svn: PROPFIND request failed on '/svn/luatex'
svn: PROPFIND of '/svn/luatex': Could not resolve hostname `scm.foundry.supelec.fr': Temporary failure in name resolution (https://scm.foundry.supelec.fr)

From root at aanhet.net  Sat Feb 24 12:22:24 2007
From: root at aanhet.net (Cron Daemon)
Date: Sat, 24 Feb 2007 12:22:24 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070224112224.65FAA28000A2@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/managed-sa.h
 U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/lstatslib.c
 U  luatex/src/texk/web2c/luatexdir/lua/luatex.c
 U  luatex/src/texk/web2c/luatexdir/lua/lfontlib.c
 U  luatex/src/texk/web2c/luatexdir/lua/ltexiolib.c
 U  luatex/src/texk/web2c/luatexdir/ptexlib.h
 U  luatex/src/texk/web2c/luatexdir/font/ttflua.c
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/writet3.c
 U  luatex/src/texk/web2c/luatexdir/font/vfpacket.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/writefont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/tfmofm.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 U  luatex/src/texk/web2c/luatexdir/managed-sa.c
 U  luatex/src/texk/web2c/luatexdir/luatex.defines
 U  luatex/manual/luatexref-t.tex
 Checked out revision 325.

From root at aanhet.net  Sun Feb 25 22:22:25 2007
From: root at aanhet.net (Cron Daemon)
Date: Sun, 25 Feb 2007 22:22:25 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070225212225.59BF128000AE@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/utils.c
 U  luatex/src/texk/web2c/luatexdir/luatex.ch
 U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfpacket.c
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/tfmofm.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 U  luatex/src/texk/web2c/luatexdir/luatex.defines
 Checked out revision 330.

From root at aanhet.net  Mon Feb 26 22:22:25 2007
From: root at aanhet.net (Cron Daemon)
Date: Mon, 26 Feb 2007 22:22:25 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070226212225.8CA3428000F5@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/tfmofm.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 U  luatex/src/texk/web2c/luatexdir/luatex.defines
 U  luatex/manual/luatexref-t.tex
 Checked out revision 332.

From root at aanhet.net  Tue Feb 27 22:22:23 2007
From: root at aanhet.net (Cron Daemon)
Date: Tue, 27 Feb 2007 22:22:23 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070227212223.1B1262800098@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/font/luafont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 333.

From root at aanhet.net  Wed Feb 28 22:22:26 2007
From: root at aanhet.net (Cron Daemon)
Date: Wed, 28 Feb 2007 22:22:26 +0100 (CET)
Subject: [Dev-luatex] Cron <luatex@server> /home/luatex/luatex-svn
Message-ID: <20070228212226.6B0D42800098@server.aanhet.net>

U  luatex/src/texk/web2c/luatexdir/luatex.ch
 U  luatex/src/texk/web2c/luatexdir/luatex.web
 U  luatex/src/texk/web2c/luatexdir/lua/lcallbacklib.c
 U  luatex/src/texk/web2c/luatexdir/lua/luainit.c
 U  luatex/src/texk/web2c/luatexdir/font/dofont.c
 U  luatex/src/texk/web2c/luatexdir/font/vfovf.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.c
 U  luatex/src/texk/web2c/luatexdir/font/tfmofm.c
 U  luatex/src/texk/web2c/luatexdir/font/texfont.h
 Checked out revision 337.

