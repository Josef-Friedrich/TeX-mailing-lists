From taco at elvenkind.com  Wed Jan  2 14:32:13 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Jan 2013 14:32:13 +0100
Subject: [dev-context] [Dev-luatex] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <20121225161116.GD28858@homerow>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
 <20121225150730.GA28858@homerow> <20121225161116.GD28858@homerow>
Message-ID: <50E436DD.7000109@elvenkind.com>

On 12/25/2012 05:11 PM, Marco Patzer wrote:
> On 2012?12?25 Marco Patzer wrote:
>
>> Linking fails due to a call to an undefined function:
>>
>> Undefined			first referenced
>>   symbol  			    in file
>> hstrerror                           libluasocket.a(libluasocket_a-socket.o)
>> ld: fatal: symbol referencing errors. No output written to luatex
>>
>> A patch is attached.
>
> Changing hstrerror (from netdb.h) to strerror might not be a good
> idea, it might result in reporting a wrong error message. This
> should be fixed so that hstrerror is actually found.

hstrerror is in -lresolv, and needs an extra autoconf test, no need
for source patches.

Best wishes,
Taco


From homerow at lavabit.com  Wed Jan  2 15:00:40 2013
From: homerow at lavabit.com (Marco Patzer)
Date: Wed, 2 Jan 2013 15:00:40 +0100
Subject: [dev-context] [Dev-luatex] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <50E436DD.7000109@elvenkind.com>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
 <20121225150730.GA28858@homerow> <20121225161116.GD28858@homerow>
 <50E436DD.7000109@elvenkind.com>
Message-ID: <20130102140040.GB11551@homerow>

On 2013?01?02 Taco Hoekwater wrote:

> >Changing hstrerror (from netdb.h) to strerror might not be a good
> >idea, it might result in reporting a wrong error message. This
> >should be fixed so that hstrerror is actually found.
> 
> hstrerror is in -lresolv, and needs an extra autoconf test, no need
> for source patches.

That makes sense. Thanks for looking into that. Tomorrow I will run a
re-build if it's fixed by then.

Marco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130102/83a78bd1/attachment.pgp>

From wolfgang.schuster at gmail.com  Thu Jan  3 00:52:05 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 3 Jan 2013 00:52:05 +0100
Subject: [dev-context] \startbuffer
Message-ID: <06D77730-012F-4518-8A2B-81C9D7387735@gmail.com>

Hi Hans,

can you add a second (dummy) argument to \startbuffer.

\setuvalue{\e!start\v!buffer}%
  {\begingroup % (3)
   \obeylines
-  \dosingleempty\buff_start}
+  \dodoubleempty\buff_start}

-\def\buff_start[#1]%
+\def\buff_start[#1][#2]%
  {\buff_start_indeed{}{#1}{\e!start\v!buffer}{\e!stop\v!buffer}}


In the following example the space after the right bracket in ?\startbuffer[test]? results in a empty first line in the buffer content and with a optional second argument this wouldn?t happen.

\starttext

\def\starttest{\grabbufferdata[test][starttest][stoptest]}

\startbuffer[test]
Text in a normal buffer.
\stopbuffer

?\getbufferdata[test]\removeunwantedspaces?

\starttest
Text in a customized buffer.
\stoptest

?\getbufferdata[test]\removeunwantedspaces?

\stoptext

Wolfgang

From schuster.wolfgang at gmail.com  Thu Jan  3 17:23:22 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 3 Jan 2013 17:23:22 +0100
Subject: [dev-context] \getbufferparagraphs
In-Reply-To: <50E1D95D.7020205@wxs.nl>
References: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>
 <50E1D95D.7020205@wxs.nl>
Message-ID: <4027FBBE-EBDF-457B-803C-8C2E200C3474@gmail.com>


Am 31.12.2012 um 19:28 schrieb Hans Hagen <pragma at wxs.nl>:

> On 12/30/2012 11:41 AM, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> do you plan to add the \getbufferparagraphs command to MkIV or is it marked obsolete?
> 
> if needed i can do that (not much work) but i need to figure out the specs -)

I don?t need it, I was only interested what?s the purpose of the command and how it works (not so hard after reading the source).

Wolfgang

From pragma at wxs.nl  Thu Jan  3 18:43:12 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 03 Jan 2013 18:43:12 +0100
Subject: [dev-context] \getbufferparagraphs
In-Reply-To: <4027FBBE-EBDF-457B-803C-8C2E200C3474@gmail.com>
References: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>
 <50E1D95D.7020205@wxs.nl> <4027FBBE-EBDF-457B-803C-8C2E200C3474@gmail.com>
Message-ID: <50E5C330.6020703@wxs.nl>

On 1/3/2013 5:23 PM, Wolfgang Schuster wrote:
>
> Am 31.12.2012 um 19:28 schrieb Hans Hagen <pragma at wxs.nl>:
>
>> On 12/30/2012 11:41 AM, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> do you plan to add the \getbufferparagraphs command to MkIV or is it marked obsolete?
>>
>> if needed i can do that (not much work) but i need to figure out the specs -)
>
> I don?t need it, I was only interested what?s the purpose of the command and how it works (not so hard after reading the source).

we were typesetting examns where there is a large text and students have 
to answer questions about a specific paragraph so that one was repeated 
with the question (so: filtering, keeping line numbers right, etc)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pmlists at free.fr  Fri Jan  4 00:00:35 2013
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Fri, 04 Jan 2013 00:00:35 +0100
Subject: [dev-context] "65436": special meaning or typo?
Message-ID: <87bod598j0.fsf@micropit.couberia.selfip.net>

Hi,

Does the value 65436 have a special meaning, or is it a type?


-*- mode: grep; default-directory: "/opt/context/tex/texmf-context/tex/context/base/" -*-
Grep started at Thu Jan  3 23:59:25

grep -nH -e 65436 *
font-age.lua:3268:    ["wakatakanahalfwidth"]=65436,
m-chart.lua:39:        width           = 100*65436,
m-chart.lua:40:        height          = 50*65436,
m-chart.lua:41:        dx              = 30*65436,
m-chart.lua:42:        dy              = 30*65436,
m-chart.lua:50:        labeloffset     = 5*65436,
m-chart.lua:51:        commentoffset   = 5*65436,
m-chart.lua:56:        rulethickness   = 65436,
m-chart.lua:62:        rulethickness   = 65436,
m-chart.lua:67:        rulethickness   = 65436,
m-chart.lua:68:        radius          = 10*65436,
m-steps.lua:20:        dx              = 10*65436,
m-steps.lua:21:        dy              = 10*65436,
m-steps.lua:25:        offset          = 2*65436,
m-steps.lua:26:        rulethickness   = 65436,
m-steps.lua:32:        offset          = 2*65436,
m-steps.lua:33:        distance        = 4*65436,
m-steps.lua:34:        rulethickness   = 65436,
m-steps.lua:40:        rulethickness   = 65436,
m-steps.lua:41:        height          = 30*65436,
m-steps.lua:42:        distance        = 10*65436,
m-steps.lua:43:        offset          = 5*65436,

Grep finished (matches found) at Thu Jan  3 23:59:25

-- 
           Peter

From pmlists at free.fr  Fri Jan  4 00:15:23 2013
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Fri, 04 Jan 2013 00:15:23 +0100
Subject: [dev-context] small patch for grph-inc.lua
Message-ID: <877gnt97uc.fsf@micropit.couberia.selfip.net>

Hi Hans,

Could you please add the following little patch (or something similar)
to grph-inc.lua:

--- grph-inc.lua~  2013-01-03 23:32:37.297732874 +0100
+++ grph-inc.lua   2013-01-03 23:42:18.237157620 +0100
@@ -571,6 +571,9 @@
                 if resolution and resolution ~= "" then -- the order might change
                     newbase = newbase .. "_" .. resolution
                 end
+                local width = figures.current().request.width or ""
+                local height = figures.current().request.height or ""
+                newbase = newbase .. "_" .. width .. "_" .. height
                 --
                 -- see *, we had:
                 --


The image-downsampling-module? would work much better then, because when
the name of the file includes the width and the height, there will be a
new conversion when the figure dimensions change.

? http://modules.contextgarden.net/grph-downsample

-- 
           Peter

From schuster.wolfgang at gmail.com  Fri Jan  4 17:00:17 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 4 Jan 2013 17:00:17 +0100
Subject: [dev-context] \getbufferparagraphs
In-Reply-To: <50E5C330.6020703@wxs.nl>
References: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>
 <50E1D95D.7020205@wxs.nl> <4027FBBE-EBDF-457B-803C-8C2E200C3474@gmail.com>
 <50E5C330.6020703@wxs.nl>
Message-ID: <41D93074-8C18-4B3A-A424-48C0B9E6C632@gmail.com>


Am 03.01.2013 um 18:43 schrieb Hans Hagen <pragma at wxs.nl>:

> On 1/3/2013 5:23 PM, Wolfgang Schuster wrote:
>> 
>> Am 31.12.2012 um 19:28 schrieb Hans Hagen <pragma at wxs.nl>:
>> 
>>> On 12/30/2012 11:41 AM, Wolfgang Schuster wrote:
>>>> Hi Hans,
>>>> 
>>>> do you plan to add the \getbufferparagraphs command to MkIV or is it marked obsolete?
>>> 
>>> if needed i can do that (not much work) but i need to figure out the specs -)
>> 
>> I don?t need it, I was only interested what?s the purpose of the command and how it works (not so hard after reading the source).
> 
> we were typesetting examns where there is a large text and students have to answer questions about a specific paragraph so that one was repeated with the question (so: filtering, keeping line numbers right, etc)

Would a MkIV solution also work with nested buffers or limited or limited to unseated buffers like the MkII solution?

There are also a few points in the setup which aren?t perfect:

- Before and after values for each paragraph is set with \setupbuffer[before=?,after=?] but \setupbufferparagraph[before=?,after=?] seems better because it separates between the buffer as a single block and between the individual paragraphs.

- The offset for the paragraphs to be skipped is set with \setupbuffer[paragraph=<number>] but ?start=<number>? fits better in the normal numbering system.

- Allow certain setups for individual paragraphs, e.g.

  \setupbufferparagraph[3][..,..=..,..]
  \setupbufferparagraph[first][..,..=..,..]
  \setupbufferparagraph[last][..,..=..,..]

Wolfgang

From pragma at wxs.nl  Sat Jan  5 13:16:01 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 05 Jan 2013 13:16:01 +0100
Subject: [dev-context] small patch for grph-inc.lua
In-Reply-To: <877gnt97uc.fsf@micropit.couberia.selfip.net>
References: <877gnt97uc.fsf@micropit.couberia.selfip.net>
Message-ID: <50E81981.2040803@wxs.nl>

On 1/4/2013 12:15 AM, Peter M?nster wrote:
> Hi Hans,
>
> Could you please add the following little patch (or something similar)
> to grph-inc.lua:
>
> --- grph-inc.lua~  2013-01-03 23:32:37.297732874 +0100
> +++ grph-inc.lua   2013-01-03 23:42:18.237157620 +0100
> @@ -571,6 +571,9 @@
>                   if resolution and resolution ~= "" then -- the order might change
>                       newbase = newbase .. "_" .. resolution
>                   end
> +                local width = figures.current().request.width or ""
> +                local height = figures.current().request.height or ""
> +                newbase = newbase .. "_" .. width .. "_" .. height
>                   --
>                   -- see *, we had:
>                   --

I don't like that figures.current reference there; also, the image isn't 
always scanned yet so the original dimensions are not known.

The code a bit below that checks for a time change so that should cover 
an update of an image and trigger a resample.

Now, if it is the target width/height you want to be part of the name, 
then it should be some option, because the one thing you don't want is 
for instance an eps to pdf converter to be applied 10 times if the same 
image (logo or so) is included 10 times in a different size.

> The image-downsampling-module? would work much better then, because when
> the name of the file includes the width and the height, there will be a
> new conversion when the figure dimensions change.
>
> ? http://modules.contextgarden.net/grph-downsample

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sat Jan  5 13:17:49 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 05 Jan 2013 13:17:49 +0100
Subject: [dev-context] "65436": special meaning or typo?
In-Reply-To: <87bod598j0.fsf@micropit.couberia.selfip.net>
References: <87bod598j0.fsf@micropit.couberia.selfip.net>
Message-ID: <50E819ED.1000301@wxs.nl>

On 1/4/2013 12:00 AM, Peter M?nster wrote:
> Hi,
>
> Does the value 65436 have a special meaning, or is it a type?

typo (probably a wrong global replace)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sat Jan  5 15:43:42 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 5 Jan 2013 15:43:42 +0100
Subject: [dev-context] \savebuffer
Message-ID: <E6A8299F-ACEC-4A2F-8AFC-1DF5066A0FA5@gmail.com>

Hi Hans,

can you add braces around the argument for the list key otherwise \savebuffer[a,b,?][?] won?t work.

buff-ini.mkiv:

\def\buff_save[#1][#2]%
  {\begingroup
   \doifassignmentelse{#1}
     {\setupcurrentsavebuffer[#1]}%
-    {\setupcurrentsavebuffer[\c!list=#1,\c!file=#2]}%
+    {\setupcurrentsavebuffer[\c!list={#1},\c!file=#2]}%
   \ctxcommand{savebuffer("\directsavebufferparameter\c!list","\directsavebufferparameter\c!file","\directsavebufferparameter\c!prefix")}%
   \endgroup}

Wolfgang


From pmlists at free.fr  Sat Jan  5 19:07:48 2013
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Sat, 05 Jan 2013 19:07:48 +0100
Subject: [dev-context] small patch for grph-inc.lua
References: <877gnt97uc.fsf@micropit.couberia.selfip.net>
 <50E81981.2040803@wxs.nl>
Message-ID: <878v87sdu3.fsf@micropit.couberia.selfip.net>

On Sat, Jan 05 2013, Hans Hagen wrote:

> I don't like that figures.current reference there;

I don't know any other method...


> also, the image isn't always scanned yet so the original dimensions
> are not known.

Doesn't matter for this use-case: I just want to make sure, that a new
conversion is triggered, when the requested dimensions change.


> The code a bit below that checks for a time change so that should cover an
> update of an image and trigger a resample.

That's why I want to use your conversion-framework :)


> Now, if it is the target width/height you want to be part of the name, then it
> should be some option, because the one thing you don't want is for instance an
> eps to pdf converter to be applied 10 times if the same image (logo or so) is
> included 10 times in a different size.

All right, I can make a new patch with an option (defaults to "no"), but
please tell me, how I can avoid "figures.current"?  And what's a good
name for such an option?

-- 
           Peter

From wolfgang.schuster at gmail.com  Sun Jan 13 19:06:17 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Jan 2013 19:06:17 +0100
Subject: [dev-context] Leaders
Message-ID: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>

Hi Hans,

what?s your opinion to redefine the leaders command to take a optional name which loads a predefined setup?

<code>
% use \doifsymbolelse for the symbol key?

\unprotect

\installcorenamespace{leaders}
\installcorenamespace{leadersalternative}

\installdefinehandler    \??leaders {leaders} \??leaders
\installparameterhandler \??leaders {leaders}
\installsetuphandler     \??leaders {leaders}

\def\leaders
  {\doifnextoptionalelse\leaders_indeed\normalleaders}

\def\leaders_indeed[#1]%
  {\def\currentleaders{#1}%
   \expandcheckedcsname\??leadersalternative{\leadersparameter\c!alternative}\s!default}

\setvalue{\??leadersalternative\s!default}%
  {\leadersparameter\c!left
   \normalleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
   \leadersparameter\c!right}

\setvalue{\??leadersalternative\s!default}%
  {\leadersparameter\c!left
   \normalleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
   \leadersparameter\c!right}

\setvalue{\??leadersalternative\v!global}%
  {\leadersparameter\c!left
   \normalgleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
   \leadersparameter\c!right}

\setupleaders
  [\c!width=1em,
   \c!symbol=.,
   \c!alternative=\s!default]

\protect

\defineleaders[test]%[symbol=x]

\starttext

text\leaders\hbox to 1em{\hss .\hss}\hfill text

text\leaders[test]text

\stoptext
</code>

This method would be cleaner for user defined list layouts where one want to change the filler between the text and the page number because a setup like this isn?t something for a normal user.

<code source="strc-lst.mkvi">
\definelistalternative
  [c]
  [\c!distance=5em,
   \c!width=0pt,
   \c!stretch=10em,
   \c!filler=\hskip.5em\gleaders\hbox to .5em{\hss.\hss}\hfill\hskip.5em\relax,
   \c!renderingsetup=\??listrenderings:abc]
</code>

Wolfgang

From pragma at wxs.nl  Sun Jan 13 20:43:22 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Jan 2013 20:43:22 +0100
Subject: [dev-context] Leaders
In-Reply-To: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
References: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
Message-ID: <50F30E5A.7050602@wxs.nl>

On 1/13/2013 7:06 PM, Wolfgang Schuster wrote:

> what?s your opinion to redefine the leaders command to take a optional name which loads a predefined setup?

We should avoid redefining a primitive (esp one that is used in math).

> <code>
> % use \doifsymbolelse for the symbol key?
>
> \unprotect
>
> \installcorenamespace{leaders}
> \installcorenamespace{leadersalternative}
>
> \installdefinehandler    \??leaders {leaders} \??leaders
> \installparameterhandler \??leaders {leaders}
> \installsetuphandler     \??leaders {leaders}
>
> \def\leaders
>    {\doifnextoptionalelse\leaders_indeed\normalleaders}
>
> \def\leaders_indeed[#1]%
>    {\def\currentleaders{#1}%
>     \expandcheckedcsname\??leadersalternative{\leadersparameter\c!alternative}\s!default}
>
> \setvalue{\??leadersalternative\s!default}%
>    {\leadersparameter\c!left
>     \normalleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
>     \leadersparameter\c!right}
>
> \setvalue{\??leadersalternative\s!default}%
>    {\leadersparameter\c!left
>     \normalleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
>     \leadersparameter\c!right}
>
> \setvalue{\??leadersalternative\v!global}%
>    {\leadersparameter\c!left
>     \normalgleaders\hbox to \leadersparameter\c!width{\hss\leadersparameter\c!symbol\hss}\hfill
>     \leadersparameter\c!right}
>
> \setupleaders
>    [\c!width=1em,
>     \c!symbol=.,
>     \c!alternative=\s!default]
>
> \protect
>
> \defineleaders[test]%[symbol=x]
>
> \starttext
>
> text\leaders\hbox to 1em{\hss .\hss}\hfill text
>
> text\leaders[test]text
>
> \stoptext
> </code>
>
> This method would be cleaner for user defined list layouts where one want to change the filler between the text and the page number because a setup like this isn?t something for a normal user.

As we have a few more leader primitives, I generalized your code a bit 
and also made the box alignment configurable:

\installcorenamespace{fillers}
\installcorenamespace{fillersalternative}

\installcommandhandler \??fillers {fillers} \??fillers

\unexpanded\def\fillers
   {\dosingleempty\spac_fillers_indeed}

\def\spac_fillers_indeed[#1]%
   {\begingroup
    \edef\currentleaders{#1}%
    \fillersparameter\c!left
 
\expandcheckedcsname\??fillersalternative{\fillersparameter\c!alternative}\v!local
       \simplealignedbox
         {\fillersparameter\c!width}%
         {\fillersparameter\c!align}%
         {\fillersparameter\c!symbol}%
    \hfill
    \fillersparameter\c!right
    \endgroup}

\letvalue{\??fillersalternative\s!local  }\normalleaders  % overflow 
ends up inbetween (current box)
\letvalue{\??fillersalternative\v!global }\normalgleaders % overflow 
ends up inbetween (outermost box)
\letvalue{\??fillersalternative\v!middle }\normalcleaders % overflow 
ends up before, after (current box)
\letvalue{\??fillersalternative\v!broad  }\normalxleaders % overflow 
ends up before, inbetween, after (current box)

\setupfillers
   [\c!width=\emwidth,
    \c!symbol=.,
    \c!align=\v!middle,
    \c!alternative=\s!local]

\protect

\definefillers[test][symbol=!]

\starttext

text\leaders\hbox to 1em{\hss .\hss}\hfill text

text\fillers[test]text

\stoptext

> <code source="strc-lst.mkvi">
> \definelistalternative
>    [c]
>    [\c!distance=5em,
>     \c!width=0pt,
>     \c!stretch=10em,
>     \c!filler=\hskip.5em\gleaders\hbox to .5em{\hss.\hss}\hfill\hskip.5em\relax,
>     \c!renderingsetup=\??listrenderings:abc]
> </code>

before we add this kind of code, how about a more extensive mechanism so 
that we can say filler=periods

for this we need to generalize the above even more i.e. we could have:

alternative=rule    (height width depth)
alternative=box     (the leaders)
alternative=stretch (hfill

and then methods, for leaders, so now we get:

\unprotect

\installcorenamespace{fillers}
\installcorenamespace{fillersalternative}
\installcorenamespace{fillersleadermethod}

\installcommandhandler \??fillers {fillers} \??fillers

\unexpanded\def\fillers
   {\dosingleempty\spac_fillers_indeed}

\def\spac_fillers_indeed[#1]%
   {\begingroup
    \edef\currentfillers{#1}%
    \scratchdimen\fillersparameter\c!leftmargin\relax
    \ifdim\scratchdimen=\zeropoint\else
      \hskip\scratchdimen
    \fi
    \fillersparameter\c!left\relax
    \getvalue{\??fillersalternative\fillersparameter\c!alternative}\relax
    \fillersparameter\c!right\relax
    \scratchdimen\fillersparameter\c!rightmargin\relax
    \ifdim\scratchdimen=\zeropoint\else
      \hskip\scratchdimen
    \fi
    \endgroup}

\setvalue{\??fillersalternative\s!box}%
 
{\expandcheckedcsname\??fillersleadermethod{\fillersparameter\c!method}\v!local
       \simplealignedbox
         {\fillersparameter\c!width}%
         {\fillersparameter\c!align}%
         {\fillersparameter\c!symbol}%
    \hfill}

\setvalue{\??fillersalternative\c!stretch}%
   {\hfill}

\setvalue{\??fillersalternative\c!rule}%
 
{\expandcheckedcsname\??fillersleadermethod{\fillersparameter\c!method}\v!local
      \hrule
        \!!height\fillersparameter\c!height
        \!!depth \fillersparameter\c!depth
    \hfill}

\letvalue{\??fillersleadermethod\s!local }\normalleaders  % overflow 
ends up inbetween (current box)
\letvalue{\??fillersleadermethod\v!global}\normalgleaders % overflow 
ends up inbetween (outermost box)
\letvalue{\??fillersleadermethod\v!middle}\normalcleaders % overflow 
ends up before, after (current box)
\letvalue{\??fillersleadermethod\v!broad }\normalxleaders % overflow 
ends up before, inbetween, after (current box)

\setupfillers
   [\c!width=\emwidth,
    \c!symbol=.,
    \c!align=\v!middle,
    \c!height=.1\exheight,
    \c!depth=\zeropoint,
    \c!leftmargin=\zeropoint,
    \c!rightmargin=\zeropoint,
    \c!alternative=\s!box,
    \c!method=\s!local]

% maybe box -> symbol

\protect

\definefillers[test-a][alternative=stretch]
\definefillers[test-b][alternative=box,symbol=!]
\definefillers[test-c][alternative=rule,height=.1ex,leftmargin=.5em,rightmargin=.25em]

\starttext

text\leaders\hbox to 1em{\hss .\hss}\hfill text

text\fillers[test-a]text

text\fillers[test-b]text

text\fillers[test-c]text

\stoptext

maybe box should be symbol (no \v!symbol yet)

maybe some more tricks can be added

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun Jan 13 21:34:53 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Jan 2013 21:34:53 +0100
Subject: [dev-context] Leaders
In-Reply-To: <50F30E5A.7050602@wxs.nl>
References: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
 <50F30E5A.7050602@wxs.nl>
Message-ID: <E812410C-6B5A-4C91-87EC-4B1FF6ABF78A@gmail.com>


Am 13.01.2013 um 20:43 schrieb Hans Hagen <pragma at wxs.nl>:

> On 1/13/2013 7:06 PM, Wolfgang Schuster wrote:
> 
>> what?s your opinion to redefine the leaders command to take a optional name which loads a predefined setup?
> 
> We should avoid redefining a primitive (esp one that is used in math).

No problem.

>> [?]
> 
> before we add this kind of code, how about a more extensive mechanism so that we can say filler=periods
> 
> for this we need to generalize the above even more i.e. we could have:
> 
> alternative=rule    (height width depth)
> alternative=box     (the leaders)
> alternative=stretch (hfill
> 
> and then methods, for leaders, so now we get:
> 
> \unprotect
> 
> \installcorenamespace{fillers}
> \installcorenamespace{fillersalternative}
> \installcorenamespace{fillersleadermethod}
> 
> \installcommandhandler \??fillers {fillers} \??fillers
> 
> \unexpanded\def\fillers
>  {\dosingleempty\spac_fillers_indeed}
> 
> \def\spac_fillers_indeed[#1]%
>  {\begingroup
>   \edef\currentfillers{#1}%
>   \scratchdimen\fillersparameter\c!leftmargin\relax
>   \ifdim\scratchdimen=\zeropoint\else
>     \hskip\scratchdimen
>   \fi
>   \fillersparameter\c!left\relax
>   \getvalue{\??fillersalternative\fillersparameter\c!alternative}\relax
>   \fillersparameter\c!right\relax
>   \scratchdimen\fillersparameter\c!rightmargin\relax
>   \ifdim\scratchdimen=\zeropoint\else
>     \hskip\scratchdimen
>   \fi
>   \endgroup}
> 
> \setvalue{\??fillersalternative\s!box}%
> {\expandcheckedcsname\??fillersleadermethod{\fillersparameter\c!method}\v!local
>      \simplealignedbox
>        {\fillersparameter\c!width}%
>        {\fillersparameter\c!align}%
>        {\fillersparameter\c!symbol}%
>   \hfill}
> 
> \setvalue{\??fillersalternative\c!stretch}%
>  {\hfill}
> 
> \setvalue{\??fillersalternative\c!rule}%
> {\expandcheckedcsname\??fillersleadermethod{\fillersparameter\c!method}\v!local
>     \hrule
>       \!!height\fillersparameter\c!height
>       \!!depth \fillersparameter\c!depth
>   \hfill}
> 
> \letvalue{\??fillersleadermethod\s!local }\normalleaders  % overflow ends up inbetween (current box)
> \letvalue{\??fillersleadermethod\v!global}\normalgleaders % overflow ends up inbetween (outermost box)
> \letvalue{\??fillersleadermethod\v!middle}\normalcleaders % overflow ends up before, after (current box)
> \letvalue{\??fillersleadermethod\v!broad }\normalxleaders % overflow ends up before, inbetween, after (current box)
> 
> \setupfillers
>  [\c!width=\emwidth,
>   \c!symbol=.,
>   \c!align=\v!middle,
>   \c!height=.1\exheight,
>   \c!depth=\zeropoint,
>   \c!leftmargin=\zeropoint,
>   \c!rightmargin=\zeropoint,
>   \c!alternative=\s!box,
>   \c!method=\s!local]
> 
> % maybe box -> symbol
> 
> \protect
> 
> \definefillers[test-a][alternative=stretch]
> \definefillers[test-b][alternative=box,symbol=!]
> \definefillers[test-c][alternative=rule,height=.1ex,leftmargin=.5em,rightmargin=.25em]
> 
> \starttext
> 
> text\leaders\hbox to 1em{\hss .\hss}\hfill text
> 
> text\fillers[test-a]text
> 
> text\fillers[test-b]text
> 
> text\fillers[test-c]text
> 
> \stoptext
> 
> maybe box should be symbol (no \v!symbol yet)
> 
> maybe some more tricks can be added

That version is even better, maybe remove spaces before/after the command to avoid unwanted spaces.

Even though the \fillers command is slower than direct use of leaders it?s in my opinion more user friendly.

Wolfgang

From pragma at wxs.nl  Sun Jan 13 22:00:45 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Jan 2013 22:00:45 +0100
Subject: [dev-context] Leaders
In-Reply-To: <E812410C-6B5A-4C91-87EC-4B1FF6ABF78A@gmail.com>
References: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
 <50F30E5A.7050602@wxs.nl> <E812410C-6B5A-4C91-87EC-4B1FF6ABF78A@gmail.com>
Message-ID: <50F3207D.1010306@wxs.nl>

On 1/13/2013 9:34 PM, Wolfgang Schuster wrote:

> That version is even better, maybe remove spaces before/after the command to avoid unwanted spaces.

Ok, added (spac-flt.mkiv).

> Even though the \fillers command is slower than direct use of leaders it?s in my opinion more user friendly.

I've added it to the beta (ftp):

\setupbodyfont[dejavu]

\definefiller[test-a][alternative=stretch]
\definefiller[test-b][alternative=symbol,symbol=!]
\definefiller[test-c][alternative=rule,height=.1ex,leftmargin=.5em,rightmargin=.25em]

\starttext

     text\filler[test-a]text \par
     text\filler[test-b]text \par
     text\filler[test-c]text \par
     text\checkedfiller{<nothing>}text \par

\stoptext

Up to you to suggest list replacements. Concerning speed:

\setupbodyfont[dejavu]

\definefiller[test][alternative=symbol,symbol=!]

\starttext

dummy \page

\testfeatureonce{1000} { % 0.19  | 0.60
%     \setbox0
         \hbox to \hsize
             {text
             \removeunwantedspaces\leaders\hbox to 1em{\hss 
!\hss}\hfill\ignorespaces
             text}
}

\page

\testfeatureonce{1000} { % 0.27 | 0.65
%     \setbox0
         \hbox to \hsize
             {text
              \filler[test]
              text}
}

\stoptext

so it's neglectable on a document (most documents don't have 1000 such 
fillers): 0.0008 seconds per filler and that's an old machine. The 
performance of the commandhandler code is quite ok given what it does.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun Jan 13 22:23:17 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Jan 2013 22:23:17 +0100
Subject: [dev-context] Leaders
In-Reply-To: <50F3207D.1010306@wxs.nl>
References: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
 <50F30E5A.7050602@wxs.nl> <E812410C-6B5A-4C91-87EC-4B1FF6ABF78A@gmail.com>
 <50F3207D.1010306@wxs.nl>
Message-ID: <1FD275C9-1B4B-4D56-8462-664702FA4BAF@gmail.com>


Am 13.01.2013 um 22:00 schrieb Hans Hagen <pragma at wxs.nl>:

> On 1/13/2013 9:34 PM, Wolfgang Schuster wrote:
> 
>> That version is even better, maybe remove spaces before/after the command to avoid unwanted spaces.
> 
> Ok, added (spac-flt.mkiv).
> 
>> Even though the \fillers command is slower than direct use of leaders it?s in my opinion more user friendly.
> 
> I've added it to the beta (ftp):
> 
> \setupbodyfont[dejavu]
> 
> \definefiller[test-a][alternative=stretch]
> \definefiller[test-b][alternative=symbol,symbol=!]
> \definefiller[test-c][alternative=rule,height=.1ex,leftmargin=.5em,rightmargin=.25em]
> 
> \starttext
> 
>    text\filler[test-a]text \par
>    text\filler[test-b]text \par
>    text\filler[test-c]text \par
>    text\checkedfiller{<nothing>}text \par
> 
> \stoptext

The colon after #1 is missing.

\unexpanded\def\checkedfiller#1%
- {\ifcsname\??filler#1\s!parent\endcsname
+ {\ifcsname\namedfillerhash{#1}\s!parent\endcsname
     \spac_fillers_indeed[#1]%
     \expandafter\gobbleoneargument
   \else
     \expandafter\firstofoneargument
   \fi{#1}}

> Up to you to suggest list replacements. Concerning speed:
> 
> \setupbodyfont[dejavu]

Is there a reason why you always use DejaVu in your example?

Wolfgang

From pragma at wxs.nl  Sun Jan 13 23:10:17 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Jan 2013 23:10:17 +0100
Subject: [dev-context] Leaders
In-Reply-To: <1FD275C9-1B4B-4D56-8462-664702FA4BAF@gmail.com>
References: <F85AB81F-E0DC-4076-AB40-7A729591024A@gmail.com>
 <50F30E5A.7050602@wxs.nl> <E812410C-6B5A-4C91-87EC-4B1FF6ABF78A@gmail.com>
 <50F3207D.1010306@wxs.nl> <1FD275C9-1B4B-4D56-8462-664702FA4BAF@gmail.com>
Message-ID: <50F330C9.10305@wxs.nl>

On 1/13/2013 10:23 PM, Wolfgang Schuster wrote:

> The colon after #1 is missing.
>
> \unexpanded\def\checkedfiller#1%
> - {\ifcsname\??filler#1\s!parent\endcsname
> + {\ifcsname\namedfillerhash{#1}\s!parent\endcsname

yes, i was lazy

>> Up to you to suggest list replacements. Concerning speed:
>>
>> \setupbodyfont[dejavu]
>
> Is there a reason why you always use DejaVu in your example?

there was: fonts load .2 sec faster when we didn't have real lm math yet 
(and in timing / testing i want as less overhead as possible)

to some extend there still is: looks slightly better on my high res 
monitors (lm is somewhat spiny)

in the editor and on the console i use dejavu mono as it supports many 
characters (lm mono is also ok but has less coverage) so for manuals 
dejavu mono is better when more than latin is involved

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Thu Jan 17 15:39:58 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 17 Jan 2013 15:39:58 +0100
Subject: [dev-context] spac-hor.mkiv
Message-ID: <FB99F488-8E75-4A58-9372-53745CE073EC@gmail.com>

Hi Hans,

can you make the \spac_indentation_check_next_indentation command unexpanded?

Wolfgang

From schuster.wolfgang at gmail.com  Thu Jan 17 15:42:54 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 17 Jan 2013 15:42:54 +0100
Subject: [dev-context] \autoinsertnextspace (spac-hor.mkiv)
Message-ID: <5062CFF0-0BE6-45AF-B0CB-CB86D5BB26B8@gmail.com>

Hi Hans,

the \autoinsertnextspace command fails when it gets a \par token.

\starttext
\dontleavehmode\autoinsertnextspace\par
\stoptext

The error disappears when you pass the argument to lua as a long string:

\def\spac_spaces_auto_insert_next
- {\ctxcommand{autonextspace("\meaning\nexttoken")}} % todo, just consult nexttoken at the lua end
+ {\ctxcommand{autonextspace(\!!bs\meaning\nexttoken\!!es)}} % todo, just consult nexttoken at the lua end

Wolfgang

From adityam at umich.edu  Wed Jan 23 06:31:41 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 Jan 2013 00:31:41 -0500 (EST)
Subject: [dev-context] Error with mtx-tools
Message-ID: <alpine.DEB.2.02.1301230029500.27590@nqv-guvaxcnq>

Hi,

Running

     mtxrun --script tools --dirtoxml

gives an error.

...minimals/texmf-context/scripts/context/lua/mtx-tools.lua:127: attempt to call global 'extname' (a nil value)

Adding

     local extname = file.extname

fixed this issue.

Aditya

From pragma at wxs.nl  Wed Jan 23 09:21:55 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 23 Jan 2013 09:21:55 +0100
Subject: [dev-context] Error with mtx-tools
In-Reply-To: <alpine.DEB.2.02.1301230029500.27590@nqv-guvaxcnq>
References: <alpine.DEB.2.02.1301230029500.27590@nqv-guvaxcnq>
Message-ID: <50FF9DA3.2080706@wxs.nl>

On 1/23/2013 6:31 AM, Aditya Mahajan wrote:
> Hi,
>
> Running
>
>      mtxrun --script tools --dirtoxml
>
> gives an error.
>
> ....minimals/texmf-context/scripts/context/lua/mtx-tools.lua:127:
> attempt to call global 'extname' (a nil value)
>
> Adding
>
>      local extname = file.extname
>
> fixed this issue.

or replace the "extname" by "suffixonly" (fixed here)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Wed Jan 23 20:49:41 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 Jan 2013 14:49:41 -0500 (EST)
Subject: [dev-context] Error with mtx-tools
In-Reply-To: <50FF9DA3.2080706@wxs.nl>
References: <alpine.DEB.2.02.1301230029500.27590@nqv-guvaxcnq>
 <50FF9DA3.2080706@wxs.nl>
Message-ID: <alpine.LNX.2.02.1301231447300.6688@ybpnyubfg.ybpnyqbznva>

On Wed, 23 Jan 2013, Hans Hagen wrote:

> On 1/23/2013 6:31 AM, Aditya Mahajan wrote:
>> Hi,
>> 
>> Running
>>
>>      mtxrun --script tools --dirtoxml
>> 
>> gives an error.
>> 
>> ....minimals/texmf-context/scripts/context/lua/mtx-tools.lua:127:
>> attempt to call global 'extname' (a nil value)
>> 
>> Adding
>>
>>      local extname = file.extname
>> 
>> fixed this issue.
>
> or replace the "extname" by "suffixonly" (fixed here)

Is the generated output supposed to work with MkIV as well? After saving 
the output to figures.xml, I tried

    context --input=figures.xml auto:x-res-01.mkiv

but only got a pdf with file names. The wiki claims that the XML format 
for MkIV has changed, but I haven't used that in a while.

Aditya

From pragma at wxs.nl  Thu Jan 24 10:14:40 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 24 Jan 2013 10:14:40 +0100
Subject: [dev-context] Error with mtx-tools
In-Reply-To: <alpine.LNX.2.02.1301231447300.6688@ybpnyubfg.ybpnyqbznva>
References: <alpine.DEB.2.02.1301230029500.27590@nqv-guvaxcnq>
 <50FF9DA3.2080706@wxs.nl>
 <alpine.LNX.2.02.1301231447300.6688@ybpnyubfg.ybpnyqbznva>
Message-ID: <5100FB80.6040605@wxs.nl>

On 1/23/2013 8:49 PM, Aditya Mahajan wrote:
> On Wed, 23 Jan 2013, Hans Hagen wrote:
>
>> On 1/23/2013 6:31 AM, Aditya Mahajan wrote:
>>> Hi,
>>>
>>> Running
>>>
>>>      mtxrun --script tools --dirtoxml
>>>
>>> gives an error.
>>>
>>> ....minimals/texmf-context/scripts/context/lua/mtx-tools.lua:127:
>>> attempt to call global 'extname' (a nil value)
>>>
>>> Adding
>>>
>>>      local extname = file.extname
>>>
>>> fixed this issue.
>>
>> or replace the "extname" by "suffixonly" (fixed here)
>
> Is the generated output supposed to work with MkIV as well? After saving
> the output to figures.xml, I tried
>
>     context --input=figures.xml auto:x-res-01.mkiv
>
> but only got a pdf with file names. The wiki claims that the XML format
> for MkIV has changed, but I haven't used that in a while.

You need to make a 'database'. I've added d-res-01.xml as example to the 
distribution. When I checked the generator, I noticed that I hadn't 
adapted ye to the slightly different index definition so I fixed that.

In MKiV support for resource libraries is built in, although I didn't 
check that now.

(Willi has always been using these mechanisms so he might have 
suggestions.)


Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Thu Jan 24 23:23:16 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 24 Jan 2013 23:23:16 +0100
Subject: [dev-context] pack-lyr.mkiv
Message-ID: <11E72C4D-3C8A-43D4-AA95-54239287E838@gmail.com>

Hi,

\def\pack_layers_set[#1][#2][#3]% #4 == box do \fi is ok
  {\bgroup
   \edef\currentlayer{#1}%
-  \edef\p_pack_layers_state{\layerparameter{#1}\c!state}%
+  \edef\p_pack_layers_state{\layerparameter\c!state}%
   \ifx\p_pack_layers_state\v!stop
     \dowithnextboxcs\egroup\hbox
   \else\ifthirdargument
     \pack_layers_set_indeed[#1][#2][#3]%
   \else
     \doifassignmentelse{#2}
       {\pack_layers_set_indeed[#1][][#2]}%
       {\pack_layers_set_indeed[#1][#2][]}%
   \fi\fi}

Wolfgang

From adityam at umich.edu  Mon Feb 11 02:18:05 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 10 Feb 2013 20:18:05 -0500 (EST)
Subject: [dev-context] Difference between LM and CM font size
Message-ID: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>

Hi,

While checking my context article for tugboat, Karl Berry found that 
typewriter fonts were coming out a bit smaller than expected. The 
following test file shows this:

\starttext
{\font\myfont = cmtt9 \myfont externalfigure[logo.pdf][width=1cm]}

{\font\myfont = ec-lmtt9 \myfont externalfigure[logo.pdf][width=1cm]}
\stoptext

With ConTeXt MkIV 2013.01.27 (and also with ConTeXt TL), I get the 
attached output. Notice that the first and second line are of different 
height.

Both lines are of the same height and width with MkII and with plain TeX.

Any ideas on what is happening here? And more specifically, how can I get 
a typing environment whose font size is the same as that of cmtt9. Using

\setuptyping[bodyfont=9pt]

switches to font size that is the same as ec-lmtt9 in the above example.

Aditya
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 10269 bytes
Desc: 
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130210/094bd8a6/attachment.pdf>

From pragma at wxs.nl  Mon Feb 11 10:21:54 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 11 Feb 2013 10:21:54 +0100
Subject: [dev-context] Difference between LM and CM font size
In-Reply-To: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>
Message-ID: <5118B832.3070301@wxs.nl>

On 2/11/2013 2:18 AM, Aditya Mahajan wrote:
> Hi,
>
> While checking my context article for tugboat, Karl Berry found that
> typewriter fonts were coming out a bit smaller than expected. The
> following test file shows this:
>
> \starttext
> {\font\myfont = cmtt9 \myfont externalfigure[logo.pdf][width=1cm]}
>
> {\font\myfont = ec-lmtt9 \myfont externalfigure[logo.pdf][width=1cm]}
> \stoptext
>
> With ConTeXt MkIV 2013.01.27 (and also with ConTeXt TL), I get the
> attached output. Notice that the first and second line are of different
> height.
>
> Both lines are of the same height and width with MkII and with plain TeX.

In context it all depends on how the lineheight (ratio ht/dp) is defined 
which is:

\setupinterlinespace
   [height=.72,
    depth=.28,
    line=2.8ex]

Also, in the opentype fonts we don't have the limitations of tfm with 
respect to the number of different heights and depths - in fact, the 
ht/dp can be derived from either the boundingbox or from the line 
properties defined in the font.

So, as soon as one uses opentype fonts one is also incompatible with 
respect to spacing (and even with type one there can be differences as 
one can decide to overload dimensions in the afm -> tfm conversion, 
although in mkii we always stuck to these automatically generated ones, 
and not the hand-tweaked ones).


> Any ideas on what is happening here? And more specifically, how can I
> get a typing environment whose font size is the same as that of cmtt9.
> Using

Maybe tweak the interlinespace related settings as they also dictate the 
struts (that are often put in front of verbatim lines).

> \setuptyping[bodyfont=9pt]
>
> switches to font size that is the same as ec-lmtt9 in the above example.

(I found out that I couldn't test the cmtt9 because I haven't installed 
these pfb files any longer. I'm surprised that I still did have some 
cmtt9 tfm file, but that one gets mapped onto an lm counterpart visa the 
map file.)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Mon Feb 11 11:14:50 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 11 Feb 2013 11:14:50 +0100
Subject: [dev-context] Difference between LM and CM font size
In-Reply-To: <5118B832.3070301@wxs.nl>
References: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>
 <5118B832.3070301@wxs.nl>
Message-ID: <CALBOmsY13AK___6p_oMkra3ZGkwLPvAQQJ43HH_+y6zL0ioFoA@mail.gmail.com>

On Mon, Feb 11, 2013 at 10:21 AM, Hans Hagen wrote:
>
> (I found out that I couldn't test the cmtt9 because I haven't installed
> these pfb files any longer. I'm surprised that I still did have some cmtt9
> tfm file, but that one gets mapped onto an lm counterpart visa the map
> file.)

Yes, that has been done on purpose long ago. Most probably because
pdfTeX still hardcodes cm fonts to generate the format, or maybe cm
fonts have been used somewhere else, I don't remember.

I wasn't too keen to ship EC fonts or the proper metafont sources with minimals.

Mojca

From pragma at wxs.nl  Mon Feb 11 11:55:23 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 11 Feb 2013 11:55:23 +0100
Subject: [dev-context] Difference between LM and CM font size
In-Reply-To: <CALBOmsY13AK___6p_oMkra3ZGkwLPvAQQJ43HH_+y6zL0ioFoA@mail.gmail.com>
References: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>
 <5118B832.3070301@wxs.nl>
 <CALBOmsY13AK___6p_oMkra3ZGkwLPvAQQJ43HH_+y6zL0ioFoA@mail.gmail.com>
Message-ID: <5118CE1B.5090704@wxs.nl>

On 2/11/2013 11:14 AM, Mojca Miklavec wrote:
> On Mon, Feb 11, 2013 at 10:21 AM, Hans Hagen wrote:
>>
>> (I found out that I couldn't test the cmtt9 because I haven't installed
>> these pfb files any longer. I'm surprised that I still did have some cmtt9
>> tfm file, but that one gets mapped onto an lm counterpart visa the map
>> file.)
>
> Yes, that has been done on purpose long ago. Most probably because
> pdfTeX still hardcodes cm fonts to generate the format, or maybe cm
> fonts have been used somewhere else, I don't remember.
>
> I wasn't too keen to ship EC fonts or the proper metafont sources with minimals.

no need for it as it won't be used unless someone defines his/her own 
font instances and then one can as well pick up the old stuff from ctan

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Mon Feb 11 19:22:03 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 11 Feb 2013 13:22:03 -0500 (EST)
Subject: [dev-context] Difference between LM and CM font size
In-Reply-To: <5118B832.3070301@wxs.nl>
References: <alpine.LNX.2.02.1302102004370.1783@ybpnyubfg.ybpnyqbznva>
 <5118B832.3070301@wxs.nl>
Message-ID: <alpine.LNX.2.02.1302111259090.20049@ybpnyubfg.ybpnyqbznva>

On Mon, 11 Feb 2013, Hans Hagen wrote:

> On 2/11/2013 2:18 AM, Aditya Mahajan wrote:
>> Hi,
>> 
>> While checking my context article for tugboat, Karl Berry found that
>> typewriter fonts were coming out a bit smaller than expected. The
>> following test file shows this:
>> 
>> \starttext
>> {\font\myfont = cmtt9 \myfont externalfigure[logo.pdf][width=1cm]}
>> 
>> {\font\myfont = ec-lmtt9 \myfont externalfigure[logo.pdf][width=1cm]}
>> \stoptext
>> 
>> With ConTeXt MkIV 2013.01.27 (and also with ConTeXt TL), I get the
>> attached output. Notice that the first and second line are of different
>> height.
>> 
>> Both lines are of the same height and width with MkII and with plain TeX.
>
> In context it all depends on how the lineheight (ratio ht/dp) is defined 
> which is:
>
> \setupinterlinespace
>  [height=.72,
>   depth=.28,
>   line=2.8ex]
>
> Also, in the opentype fonts we don't have the limitations of tfm with respect 
> to the number of different heights and depths - in fact, the ht/dp can be 
> derived from either the boundingbox or from the line properties defined in 
> the font.

I don't think that this has anything to do with height/depth radio. The 
physical size of the glyphs is smaller.

> So, as soon as one uses opentype fonts one is also incompatible with respect 
> to spacing (and even with type one there can be differences as one can decide 
> to overload dimensions in the afm -> tfm conversion, although in mkii we 
> always stuck to these automatically generated ones, and not the hand-tweaked 
> ones).
>
>> Any ideas on what is happening here? And more specifically, how can I
>> get a typing environment whose font size is the same as that of cmtt9.
>> Using
>
> Maybe tweak the interlinespace related settings as they also dictate the 
> struts (that are often put in front of verbatim lines).
>
>> \setuptyping[bodyfont=9pt]
>> 
>> switches to font size that is the same as ec-lmtt9 in the above example.
>
> (I found out that I couldn't test the cmtt9 because I haven't installed these 
> pfb files any longer. I'm surprised that I still did have some cmtt9 tfm 
> file, but that one gets mapped onto an lm counterpart visa the map file.)

FWIW, the size of lmtt10.tfm (or lmmono10-regular.otf) matches that of 
cmtt9! At least that suggests a workaround.

@Karl: Does,

\setuptyping[bodyfont=10pt]

or

\setuptyping[bodyfont=small, style=\tta]

give the right size, visually?

Aditya

From taco at elvenkind.com  Sun Feb 17 18:03:53 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 17 Feb 2013 18:03:53 +0100
Subject: [dev-context] [mp-implementors] MetaPost 1.790
Message-ID: <51210D79.5010406@elvenkind.com>


I am happy to announce a new test release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.790
----------------------------------------------------------------------

This is a third test release for the new functionality planned in
MetaPost 1.800. Besides a few bug fixes, this version has lots of
internal speed-ups so that its running times should now be comparable
to the MetaPost 1.50x series.

All the reported new bugs in 1.780 have been fixed, but I may have
introduced new problems while adding the speed optimizations. Use with
care, and *do* let me know if something is wrong!

This version will not be uploaded to CTAN / TLcontrib yet. The plan is
to wait another for a few weeks before releasing 1.800. That will then
be an official end-user release.

The win32 binary can be downloaded immediately from files section at

   https://foundry.supelec.fr/projects/metapost/

The new foundry software is still not quite up to speed, so there
is no source tarball uploaded yet (it was too large for the web form).
If you want to build this latest MetaPost either wait a few days while
Fabrice fixes foundry, or do an anonymous subversion checkout yourself:

   $ svn checkout --username anonsvn 
https://foundry.supelec.fr/svn/metapost/tags/1.790

The password is anonsvn

----------------------------------------------------------------------
What is new in MetaPost version 1.790:
----------------------------------------------------------------------

* Lots of speed-ups.

* Fixed bug in division expressions that started with a literal number.

* A few problems with bad deallocations were solved.

* A bug where after saving and redefinition of primitives, they later
   were restored to 'undefined' instead of to their primitive meaning.

* The "double" literal number parser now only accepts scientific
   notation if the character following 'E' or 'e' is '+', '-', or
   a digit.

----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
https://foundry.supelec.fr/projects/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, February 17, 2013.

From taco at elvenkind.com  Fri Mar  1 14:54:50 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 01 Mar 2013 14:54:50 +0100
Subject: [dev-context] Luatex 0.75.0 announcement
Message-ID: <5130B32A.4020600@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.75.0.

Most noticeable changes:

* New expandable primitive \Uchar.

* Metapost 1.790.

* New version of lnodelib.c with speedups by Hans and Luigi.
   Also added some extra sanity checks to the Lua node field
   setting functions.

* Support 'umath' in tex.extraprimitives(), so that formats can
   make the \Umath* primitives unprefixed, now that they will be
   provided by XeTeX as well.

* Removed a bunch of deprecated primitives
   * \AlephVersion, \Alephrevision, \Alephversion, \Alephminorversion
   * \OmegaVersion, \Omegarevision, \Omegaversion, \Omegaminorversion
   * \omathcode, \odelcode, \omathchardef, \omathchar, \omathaccent,
     \odelimiter, \oradical
   * \Umathbotaccent, \Umathaccents

* Fix large file support.

* Fix Lua's loadfile().

* Removed the cidmap callbacks again (let that be done by user lua
   code after the fact).

* Removed the fatal error on fonts where num_glyphs is too high,
   as that problem is actually harmless.

* Some compilation issues under Win32 and Solaris resolved.
   NOTE: You still need an 'installed' pkg-config while building
   luatex. Either install pkg-config for your platform, or make
   sure there is a binary linking to /bin/true while configuring.
   The requirement is for the executable 'pkg-config' itself, not
   for any particular package.

* Allow math extender objects to be zero width.

* The 'epdf' library has been extended to deal with finding and
   saving embedded files (catalog:numEmbeddedFiles() and catalog:
   embeddedFile, new EmbFile object).


The archives can be downloaded from supelec as usual:

         https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

   svn co --username anonsvn --password anonsvn              \
       https://foundry.supelec.fr/svn/luatex/tags/beta-0.75.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco

From luigi.scarso at gmail.com  Fri Mar  1 17:15:15 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 1 Mar 2013 17:15:15 +0100
Subject: [dev-context] Luajittex 0.75.0 announcement
Message-ID: <CAG5iGsDQf-Uhe2bA8ZzVP88cn0gAt5gNMgZnjf1HSccuPuw+Mw@mail.gmail.com>

New beta release of luajittex.
It's in sync with luatex beta 0.75.0, plus Luajit 2.0.1


The project is hosted as usual at
https://foundry.supelec.fr/projects/luajittex/

A Tracker for bugs/features and a mailing list for commits are enabled.



--
luigi

From mailing_list at arcor.de  Fri Mar  1 18:33:28 2013
From: mailing_list at arcor.de (Stephan Hennig)
Date: Fri, 01 Mar 2013 18:33:28 +0100
Subject: [dev-context] [luatex] Luatex 0.75.0 announcement
In-Reply-To: <5130B32A.4020600@elvenkind.com>
References: <5130B32A.4020600@elvenkind.com>
Message-ID: <5130E668.8030209@arcor.de>

Am 01.03.2013 14:54, schrieb Taco Hoekwater:

> I have just uploaded the archives for a new luatex release, 0.75.0.
> 
> Most noticeable changes:

There are some patches by Akira the TL repository that result in a
significant speed-up when using piped input (io.popen) on Windows.
Please sync with the TL repository before releasing LuaTeX for TL2013.

Best regards,
Stephan Hennig


From taco at elvenkind.com  Mon Mar  4 09:18:30 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 4 Mar 2013 09:18:30 +0100
Subject: [dev-context] [luatex] Luatex 0.75.0 announcement
In-Reply-To: <5130E668.8030209@arcor.de>
References: <5130B32A.4020600@elvenkind.com> <5130E668.8030209@arcor.de>
Message-ID: <1DF5F6CD-59CB-4EFA-AE20-D0CDE53C1D9B@elvenkind.com>


On Mar 1, 2013, at 6:33 PM, Stephan Hennig <mailing_list at arcor.de> wrote:

> Am 01.03.2013 14:54, schrieb Taco Hoekwater:
> 
>> I have just uploaded the archives for a new luatex release, 0.75.0.
>> 
>> Most noticeable changes:
> 
> There are some patches by Akira the TL repository that result in a
> significant speed-up when using piped input (io.popen) on Windows.
> Please sync with the TL repository before releasing LuaTeX for TL2013.

Always do ;)

Best wishes,
Taco

From luigi.scarso at gmail.com  Fri Mar  8 17:11:50 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 8 Mar 2013 17:11:50 +0100
Subject: [dev-context] Luajittex 0.75.0.1 announcement
Message-ID: <CAG5iGsASzjZiyXDLXn6sLmK9U0Ey9s3ymsx55K+Z2H-9r4pmiw@mail.gmail.com>

New beta release of luajittex  with luajit 2.0.1 patched with  Hotfix#1
(see http://luajit.org/download.html).

--
luigi

From pragma at wxs.nl  Thu Mar 14 16:49:07 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 14 Mar 2013 16:49:07 +0100
Subject: [dev-context] new font trickery
Message-ID: <5141F173.4030402@wxs.nl>

Hi,

I implemented this:

\setupbodyfont[pagella]

\starttext

\dorecurse{10}{
     \dorecurse{20}{
         \start
             What \recursedepth\recurselevel\space
             \feature{smallcaps}
             What \recursedepth\recurselevel\space
             \feature{oldstyle}
             What \recursedepth\recurselevel\space
         \stop
     }
     \par
}

\stoptext

A reasonable fast cummulative feature switcher (so its different from 
addff cum suis). I'm not aure about the name yet. Also, such features 
have a semi-global nature in the sense that redefining 'oldstyle' has no 
effect, but that's sort of natural. Of course it's somewhat slower than 
defining a font with specific features enabled.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Mar 19 11:23:02 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 19 Mar 2013 11:23:02 +0100
Subject: [dev-context] MetaPost 1.800 announcement
Message-ID: <51483C86.3@elvenkind.com>


I am happy to announce a new release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.800
----------------------------------------------------------------------

This version will be the one included in TeXLive 2013. The major
changes compared to MetaPost 1.504 that was in TeXLive 2012 are:

* Support for IEEE double (64 bit) internal calculations as well as
   traditional 32-bit scaled arithmetic, by means of a command-line
   switch (--numbersystem=double).

* Bitmap (png) output support.

* The C and lua APIs have been extended to allow path control point
   resolution without going through the Metapost input language.

* The code for picture shipout now uses "double" for all floating point
   values. This can give small differences in the actual output files in
   traditional mode due to the required scaled -> double conversion, but
   it was necessary to support the new numerical backend code.


The win32 binary as well as a source archive can be downloaded
immediately from the files section at

   https://foundry.supelec.fr/projects/metapost/

If you want to build MetaPost yourself, you can also do an anonymous
subversion checkout:

   $ svn checkout --username anonsvn 
https://foundry.supelec.fr/svn/metapost/tags/1.800

The password is anonsvn


----------------------------------------------------------------------
What is new in MetaPost version 1.800:
----------------------------------------------------------------------

* A new string valued internal "outputformatoptions" is used by 'png'
   output format to control the png file format. In the future, this
   internal may become used for options to the other output formats
   as well.

   The syntax for "outputformatoptions" is a space-separated list of
   settings. Individual settings are keyword+'='+value. The only
   currently allowed ones are:
     format=[rgba|rgb|graya|gray]
     antialias=[none|fast|good|best]
   No spaces are allowed on the left, nor on the right, of the equals
   sign inside a setting.

   The assignment that would match the compiled-in default setup is:
     outputformatoptions := "format=rgba antialias=fast";
   however, "outputformatoptions" is initially the empty string.

   Some notes on the (new) PNG output formats:
   - The 'rgb' and 'gray' subformats have a white background. The
     'rgba' and 'graya' subformats have a transparent background.
   - Bitdepth is always 8.
   - In all cases, the image is initially created in 8-bit RGB
     mode. For 'gray' and 'graya', the RGB colors are reduced just
     before the actual PNG file is written, using a standard rule:
       g = 0.2126*r + 0.7152*g + 0.0722*b
   - CMYK colors are always converted to RGB during generation of
     the output image using:
       r = 1 - (c+k>1 ? 1 : c+k);
       g = 1 - (m+k>1 ? 1 : m+k);
       b = 1 - (y+k>1 ? 1 : y+k);
    - If you care about color conversions, you should be doing a
      "within <pic>" loop inside "extra_endfig". The built-in
      conversions are more of a fallback.

* A new string-valued internal "outputfilename", which is set by
   "shipout" to the value of the just created file name. Until the
   first shipout has occurred, it is the empty string.


----------------------------------------------------------------------
What is fixed in MetaPost version 1.800:
----------------------------------------------------------------------

* Fixed a number of bugs where Metapost loaded the default font map
   file multiple times, resulting in lots of "fontmap entry for
   `<fontname>' already exists, duplicates ignored" warnings.

* The "glyph <> of <>" operation could crash on fonts with empty
   subpaths in the charstrings.

* Fixed a bug in the postscript encoding reader that caused a buffer
   overflow (fatal error) for encoding files that do not end with a
   newline.

* Sped up png creation a bit by using smarter libpng options.

* In the 'double' numbersystem, lots of precision was lost due to a bad
   internal conversion of fractions to scaled values. This affected the
   "rotated by", "directiontime", "sind" and "cosd" primitives, as well
   as internal dependency calculations.

* In the 'double' numbersystem, an internal rounding error caused
   "directiontime" to return bad results for requests near zero.

* There was a big scaling miscalculation while outputting glyphs in SVG
   mode with "prologues:=3". The output labels were so big that they
   fell completely outside of the generated image.

* A problem resulting in 'This can't happen (endinput)' caused by a
   missing "end" at the end of the run was fixed.

----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
https://foundry.supelec.fr/projects/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, March 19, 2013.


From schuster.wolfgang at gmail.com  Mon Mar 25 19:02:24 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 25 Mar 2013 19:02:24 +0100
Subject: [dev-context] strc-ren.mkiv
Message-ID: <9FF10DED-CD09-4976-AEB8-7C87BA4E8FE0@gmail.com>

Hi,

\unexpanded\def\strc_rendering_initialize_alternatives
  {\edef\currentheadalternative         {\headparameter           \c!alternative}%
-  \ifcsname\??headplacementalternative\currentheadalternative\endcsname \else
+  \ifcsname\currentheadalternativehash\s!parent\endcsname \else
      \let\currentheadalternative\v!normal % cf. mkii
   \fi
   \edef\currentheadrenderingsetup      {\headalternativeparameter\c!renderingsetup}%
   \edef\currentheadrenderingalternative{\headalternativeparameter\c!alternative}%
   \ifx\currentheadrenderingalternative\empty
     \let\currentheadrenderingalternative\v!vertical
   \fi
   \ifx\currentheadrenderingalternative\v!horizontal
     \global\setfalse\headisdisplay % global
   \else
     \global\settrue\headisdisplay  % global
   \fi}

Wolfgang

From schuster.wolfgang at gmail.com  Tue Mar 26 19:11:41 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 26 Mar 2013 19:11:41 +0100
Subject: [dev-context] Nested \setupXXX commands
Message-ID: <1A1D98C0-EE74-4BDA-80AD-690DD5E50D00@gmail.com>

Hi Hans,

there is a problem with the command handler and nested \setup? commands.

In the following example the setting for the ?two? environment are ignored.

<example>
\defineenumeration[one][text=One]
\defineenumeration[two][text=Two]

\setupenumeration[one,two][alternative=serried,color=red]

\starttext

	\startone
	First enumeration.
	\stopone

	\starttwo
	Second enumeration.
	\stoptwo

\stoptext
</example>

The reason for this behavior is the \setupcounter call in \everysetupenumeration.

When you look at the internal code for \setupenumeration (mult-aux.mkiv) you see that the first
element in \setupernumeration (i.e. ?one?) is processed with \mult_interfaces_with_comma_list_element,
at the end of this macro \everysetupenumeration. At this point \setupcounter is used which
redefines \mult_interfaces_with_comma_list_element. This redefined version is used for the next
element (i.e. ?two?) in \setupenumeration and the values are no passed (?alternative? and ?color?)
to \setupcounter.

\unexpanded\def\mult_interfaces_install_setup_handler#1#2#3#4#5#6#7#8%
  {\ifx#3\relax\let#3\empty\fi
   \unexpanded\def#2{\dodoubleempty#4}%
   \unexpanded\def#6{\mult_interfaces_get_parameters{#1#3:}}% no every ! don't change it
   \newtoks#5%
   \newtoks#8%
   \unexpanded\def#4[##1][##2]% maybe helper
     {\let#7#3%
      \ifsecondargument
        \def\mult_interfaces_with_comma_list_element####1% we will have a simple one as well
          {\edef#3{####1}%
           \mult_interfaces_get_parameters{#1#3:}[##2]%
           \the#5}%
        \processcommalist[##1]\mult_interfaces_with_comma_list_element
      \else
        \let#3\empty
        \mult_interfaces_get_parameters{#1:}[##1]%
        \the#5%
      \fi
      \let#3#7%
      \the#8}}

Wolfgang

From pragma at wxs.nl  Tue Mar 26 22:51:37 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 26 Mar 2013 22:51:37 +0100
Subject: [dev-context] Nested \setupXXX commands
In-Reply-To: <1A1D98C0-EE74-4BDA-80AD-690DD5E50D00@gmail.com>
References: <1A1D98C0-EE74-4BDA-80AD-690DD5E50D00@gmail.com>
Message-ID: <51521869.20705@wxs.nl>

On 3/26/2013 7:11 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> there is a problem with the command handler and nested \setup? commands.
>
> In the following example the setting for the ?two? environment are ignored.
>
> <example>
> \defineenumeration[one][text=One]
> \defineenumeration[two][text=Two]
>
> \setupenumeration[one,two][alternative=serried,color=red]
>
> \starttext
>
> 	\startone
> 	First enumeration.
> 	\stopone
>
> 	\starttwo
> 	Second enumeration.
> 	\stoptwo
>
> \stoptext
> </example>
>
> The reason for this behavior is the \setupcounter call in \everysetupenumeration.
>
> When you look at the internal code for \setupenumeration (mult-aux.mkiv) you see that the first
> element in \setupernumeration (i.e. ?one?) is processed with \mult_interfaces_with_comma_list_element,
> at the end of this macro \everysetupenumeration. At this point \setupcounter is used which
> redefines \mult_interfaces_with_comma_list_element. This redefined version is used for the next
> element (i.e. ?two?) in \setupenumeration and the values are no passed (?alternative? and ?color?)
> to \setupcounter.
>
> \unexpanded\def\mult_interfaces_install_setup_handler#1#2#3#4#5#6#7#8%
>    {\ifx#3\relax\let#3\empty\fi
>     \unexpanded\def#2{\dodoubleempty#4}%
>     \unexpanded\def#6{\mult_interfaces_get_parameters{#1#3:}}% no every ! don't change it
>     \newtoks#5%
>     \newtoks#8%
>     \unexpanded\def#4[##1][##2]% maybe helper
>       {\let#7#3%
>        \ifsecondargument
>          \def\mult_interfaces_with_comma_list_element####1% we will have a simple one as well
>            {\edef#3{####1}%
>             \mult_interfaces_get_parameters{#1#3:}[##2]%
>             \the#5}%
>          \processcommalist[##1]\mult_interfaces_with_comma_list_element
>        \else
>          \let#3\empty
>          \mult_interfaces_get_parameters{#1:}[##1]%
>          \the#5%
>        \fi
>        \let#3#7%
>        \the#8}}

So we need something like this (lucky us, no performance penalty):

\unexpanded\def\mult_interfaces_install_setup_handler#1#2#3#4#5#6#7#8#9%
   {\ifx#3\relax\let#3\empty\fi
    \unexpanded\def#2{\dodoubleempty#4}%
    \unexpanded\def#6{\mult_interfaces_get_parameters{#1#3:}}% no every 
! don't change it
    \newtoks#5%
    \newtoks#8%
    \unexpanded\def#4[##1][##2]% maybe helper
      {\let#7#3%
       \ifsecondargument
         \def#9####1% we will have a simple one as well
           {\edef#3{####1}%
            \mult_interfaces_get_parameters{#1#3:}[##2]%
            \the#5}%
         \processcommalist[##1]#9%
       \else
         \let#3\empty
         \mult_interfaces_get_parameters{#1:}[##1]%
         \the#5%
       \fi
       \let#3#7%
       \the#8}}

\unexpanded\def\installsetuphandler#1#2%
   {\normalexpanded
      {\mult_interfaces_install_setup_handler
         {\noexpand#1}% \??aa
         \expandafter\noexpand\csname setup#2\endcsname
         \expandafter\noexpand\csname current#2\endcsname
         \expandafter\noexpand\csname setup_#2\endcsname % semi-public
         \expandafter\noexpand\csname everysetup#2\endcsname
         \expandafter\noexpand\csname setupcurrent#2\endcsname
         \expandafter\noexpand\csname saved_setup_current#2\endcsname
         \expandafter\noexpand\csname everysetup#2root\endcsname
         \expandafter\noexpand\csname nested_setup_current#2\endcsname}}

\unexpanded

\def\mult_interfaces_install_auto_setup_handler#1#2#3#4#5#6#7#8#9%
   {\ifx#3\relax\let#3\empty\fi
    \unexpanded\def#2{\dotripleempty#4}%
    \unexpanded\def#6{\mult_interfaces_get_parameters{#1#3:}}%
    \newtoks#5%
    \def#4[##1][##2][##3]%
      {\let#8#3%
       \ifthirdargument
         \def#9####1%
           {\edef#3{####1}%
            \expandafter\def\csname#1#3:\s!parent\endcsname{#1##2}%
            \mult_interfaces_get_parameters{#1#3:}[##3]% always sets parent
            \the#5}%
         \processcommalist[##1]#9%
       \else\ifsecondargument
         \def#9####1%
           {\edef#3{####1}%
            #7% checks parent and sets if needed
            \mult_interfaces_get_parameters{#1#3:}[##2]%
            \the#5}%
         \processcommalist[##1]#9%
       \else
         \let#3\empty
         \mult_interfaces_get_parameters{#1:}[##1]%
         \the#5%
       \fi\fi
       \let#3#8}}

\unexpanded\def\installautosetuphandler#1#2%
   {\normalexpanded
      {\mult_interfaces_install_auto_setup_handler
         {\noexpand#1}% \??aa
         \expandafter\noexpand\csname setup#2\endcsname
         \expandafter\noexpand\csname current#2\endcsname
         \expandafter\noexpand\csname setup_#2\endcsname % semi-public
         \expandafter\noexpand\csname everysetup#2\endcsname
         \expandafter\noexpand\csname setupcurrent#2\endcsname
         \expandafter\noexpand\csname check#2parent\endcsname
         \expandafter\noexpand\csname saved_setup_current#2\endcsname
         \expandafter\noexpand\csname nested_setup_current#2\endcsname}}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at docwolves.nl  Fri Apr  5 11:57:14 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Fri, 05 Apr 2013 11:57:14 +0200
Subject: [dev-context] MetaPost 1.801 announcement
Message-ID: <515E9FFA.3030002@docwolves.nl>


I am happy to announce a new release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.801
----------------------------------------------------------------------

This is a bugfix release for 1.800.

The win32 binary as well as a source archive can be downloaded
immediately from the files section at

   https://foundry.supelec.fr/projects/metapost/

If you want to build MetaPost yourself, you can also do an anonymous
subversion checkout:

   $ svn checkout --username anonsvn 
https://foundry.supelec.fr/svn/metapost/tags/1.801

The password is anonsvn

----------------------------------------------------------------------
What is new in MetaPost version 1.801:
----------------------------------------------------------------------

* fixed an off-by-one error in the SVG output that prevented the last
   font's glyphs from actually being output to the svg file under
   prologues:=3;

* fixed a bug in bbox calculations in that caused the max y to be set
   based on the maximum x coordinate internal value instead of the
   maximum y coordinate.

* fixed a bug where metapost incorrectly produced a 'degenerate spec'
   error.

* build fixes for various platforms imported from TeXLive 2013, as
   well as the latest kpathsea development etc.

Have fun!


Taco Hoekwater, for the MetaPost team, April 5, 2013.


From taco at docwolves.nl  Fri Apr  5 13:09:06 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Fri, 05 Apr 2013 13:09:06 +0200
Subject: [dev-context] Luatex 0.76.0 announcement
Message-ID: <515EB0D2.1070105@docwolves.nl>

Hi,

I have just uploaded the archives for a new luatex release, 0.76.0,
which has a few fixes for beta 0.75.0, and synchronizes the code
with the development version of TeXLive 2013.

Changes:

* Metapost 1.801.

* Small patches from TeXLive 2013, as well as an update to the
   latest libraries (libpng, poppler, etc.)

* Speed up printing (of TeX strings) to the terminal and log.

* New lua function node.end_of_math().

* Fixed a memory leak in the lua function pdfscanner.scan().



The archives can be downloaded from supelec as usual:

         https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

   svn co --username anonsvn --password anonsvn              \
       https://foundry.supelec.fr/svn/luatex/tags/beta-0.76.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco

From luigi.scarso at gmail.com  Sat Apr  6 17:29:00 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 6 Apr 2013 17:29:00 +0200
Subject: [dev-context] Luajittex 0.76.0 announcement
Message-ID: <CAG5iGsB0qwkVmVw6N1dzq8eBAMC-UhUmtcKrmkgUMjjz-1ucWA@mail.gmail.com>

New beta release of luajittex.
Site:
https://foundry.supelec.fr/projects/luajittex/

svn repo.:
svn checkout --username anonsvn
https://foundry.supelec.fr/svn/luajittex/tags/beta-0.76.0


--
luigi

From adityam at umich.edu  Sun Apr  7 17:45:08 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 7 Apr 2013 11:45:08 -0400 (EDT)
Subject: [dev-context] Merging font support modules
Message-ID: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>

Hi everyone,

I was browsing through the third party modules, and noticed that there are 
a few packages that provide typescripts for fonts. I think that it will be 
worthwhile to clean up and merge these modules, so as to reduce the amount 
of clutter.

I am listing all the font related modules below, and asking if these are 
still needed; or should some of these be moved to an obsolete/ branch or 
merged with other modules.

- Chinese font support (by Wolfgang Schuster; provides fonts, perhaps 
merge with cwTeX font module, also by Wolfgang)

- GFSDidot Opentype fonts (I cannot browse through that! Should this be 
moved to obsolete branch?)

- Greek (by Thomas Schmitz; provides fonts as well as typescripts, so this 
module cannot be merged)

- Storm font support (Again, I cannot browse through that. Should this be 
moved to obsolete branch?)

- Lucida bright font support (by Vit Zyka: do we still need these support 
files, or can this be moved to obsolete?)

-  Support for cwTeX fonts (by Wolfgang Schuster provides fonts and 
typescripts. Can this be merged with Chinese font support?)

- Typescript (by Wolfgang Schuster, provides typescripts for a variety of 
fonts. I think that all modules that only distribute font typescripts 
should be merged with this one.)

- URW Garamond support (by Peter M?nster; is this still needed? If so, 
this should be merged with the typescript module)

- URW Gothic support (by Taco Hoekwater; is this still needed? If so, this 
should be merged with the typescript module).

What do others feel about such pruning and merging of packages?

Aditya

From pmlists at free.fr  Sun Apr  7 21:06:07 2013
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Sun, 07 Apr 2013 21:06:07 +0200
Subject: [dev-context] Merging font support modules
In-Reply-To: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
 (Aditya Mahajan's message of "Sun, 7 Apr 2013 11:45:08 -0400 (EDT)")
References: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
Message-ID: <87y5curwio.fsf@micropit.couberia.selfip.net>

On Sun, Apr 07 2013, Aditya Mahajan wrote:

> - URW Garamond support (by Peter M?nster; is this still needed?

Hi Aditya,

I don't think so. It's very old and only for mkii.

-- 
           Peter

From adityam at umich.edu  Sun Apr  7 21:25:50 2013
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 7 Apr 2013 15:25:50 -0400 (EDT)
Subject: [dev-context] Merging font support modules
In-Reply-To: <87y5curwio.fsf@micropit.couberia.selfip.net>
References: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
 <87y5curwio.fsf@micropit.couberia.selfip.net>
Message-ID: <alpine.LNX.2.03.1304071525100.9007@hzvpu.rqh>

On Sun, 7 Apr 2013, Peter M?nster wrote:

> On Sun, Apr 07 2013, Aditya Mahajan wrote:
>
>> - URW Garamond support (by Peter M?nster; is this still needed?
>
> Hi Aditya,
>
> I don't think so. It's very old and only for mkii.

I am not against supporting MkII :)

If the typescripts are needed for MkII, they can still be part of the 
typescript module by Wolfgang.

Aditya

From pragma at wxs.nl  Sun Apr  7 21:41:13 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 07 Apr 2013 21:41:13 +0200
Subject: [dev-context] Merging font support modules
In-Reply-To: <alpine.LNX.2.03.1304071525100.9007@hzvpu.rqh>
References: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
 <87y5curwio.fsf@micropit.couberia.selfip.net>
 <alpine.LNX.2.03.1304071525100.9007@hzvpu.rqh>
Message-ID: <5161CBD9.8070204@wxs.nl>

On 4/7/2013 9:25 PM, Aditya Mahajan wrote:
> On Sun, 7 Apr 2013, Peter M?nster wrote:
>
>> On Sun, Apr 07 2013, Aditya Mahajan wrote:
>>
>>> - URW Garamond support (by Peter M?nster; is this still needed?
>>
>> Hi Aditya,
>>
>> I don't think so. It's very old and only for mkii.
>
> I am not against supporting MkII :)
>
> If the typescripts are needed for MkII, they can still be part of the
> typescript module by Wolfgang.

as long as they get an .mkii suffix


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun Apr  7 21:53:46 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 7 Apr 2013 21:53:46 +0200
Subject: [dev-context] Merging font support modules
In-Reply-To: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
Message-ID: <3E6C1DDB-3C8C-436F-A123-A030F70BD6C9@gmail.com>


Am 07.04.2013 um 17:45 schrieb Aditya Mahajan <adityam at umich.edu>:

> Hi everyone,
> 
> I was browsing through the third party modules, and noticed that there are a few packages that provide typescripts for fonts. I think that it will be worthwhile to clean up and merge these modules, so as to reduce the amount of clutter.
> 
> I am listing all the font related modules below, and asking if these are still needed; or should some of these be moved to an obsolete/ branch or merged with other modules.
> 
> - Chinese font support (by Wolfgang Schuster; provides fonts, perhaps merge with cwTeX font module, also by Wolfgang)
> 
> -  Support for cwTeX fonts (by Wolfgang Schuster provides fonts and typescripts. Can this be merged with Chinese font support?)

It would be interesting to know if these files are still needed because with MkIV it?s simple to use CJK fonts and one doesn?t need all these files (tfm etc.) anymore.

Wolfgang

From pmlists at free.fr  Sun Apr  7 22:21:15 2013
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Sun, 07 Apr 2013 22:21:15 +0200
Subject: [dev-context] Merging font support modules
In-Reply-To: <alpine.LNX.2.03.1304071525100.9007@hzvpu.rqh> (Aditya Mahajan's
 message of "Sun, 7 Apr 2013 15:25:50 -0400 (EDT)")
References: <alpine.LNX.2.02.1304071127360.1913@ybpnyubfg.ybpnyqbznva>
 <87y5curwio.fsf@micropit.couberia.selfip.net>
 <alpine.LNX.2.03.1304071525100.9007@hzvpu.rqh>
Message-ID: <87txnirt1g.fsf@micropit.couberia.selfip.net>

On Sun, Apr 07 2013, Aditya Mahajan wrote:

> If the typescripts are needed for MkII, they can still be part of the
> typescript module by Wolfgang.

Of course. But I don't have URW Garamond installed on my system, so I
can't test if it still works with latest mkii.
(Now I use GaramondPremrPro (OTF) with simplefonts.)

-- 
           Peter

From wolfgang.schuster at gmail.com  Wed Apr 10 09:18:30 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 10 Apr 2013 09:18:30 +0200
Subject: [dev-context] math-ali.mkiv
Message-ID: <4C399F56-4196-4856-B060-2D915A7F8CD1@gmail.com>

Hi,

the redefinition of \startalignment in math-ali.mkiv doesn?t cover \stopalignment.


\ifdefined \startalignment

    \let\align_math_normal_start\startalign
    \let\align_math_normal_stop \stopalign

    \let\align_text_normal_start\startalignment
    \let\align_text_normal_stop \stopalignment

    \unexpanded\def\startalign
      {\ifmmode
-        \let\stopalign\align_math_normal_stop % cannot be an unexpanded def ... lookahead in align
+        \let\stopalign    \align_math_normal_stop % cannot be an unexpanded def ... lookahead in align
+        \let\stopalignment\align_math_normal_stop % cannot be an unexpanded def ... lookahead in align
         \expandafter\align_math_normal_start
       \else
-        \let\stopalign\align_text_normal_stop
+        \let\stopalign    \align_text_normal_stop
+        \let\stopalignment\align_text_normal_stop
         \expandafter\align_text_normal_start
       \fi}

    \let\stopalign    \relax
+   \let\stopalignment\relax

    \let\startalignment\startalign
-   \let\stopalignment \stopalign

\fi


Wolfgang

From sanjoy at olin.edu  Thu Apr 11 21:34:45 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Thu, 11 Apr 2013 15:34:45 -0400
Subject: [dev-context] PATCH: fix meta-pdf.lua choking on grayscale metapost
	output
Message-ID: <87hajcq2sq.fsf@approx.mit.edu>

I am converting myself to MkIV, and ran into the following error:

  ! LuaTeX error /usr/share/texmf/tex/context/base/meta-pdf.lua:355: attempt to call global 'pdfgrayliteral' (a nil value)
  stack traceback:
          /usr/share/texmf/tex/context/base/meta-pdf.lua:355: in function </usr/share/texmf/tex/context/base/meta-pdf.lua:353>
          [C]: in function 'lpegmatch'
          /usr/share/texmf/tex/context/base/meta-pdf.lua:519: in function 'parse'
          /usr/share/texmf/tex/context/base/meta-pdf.lua:539: in function 'convertmpstopdf'
          <main ctx instance>:1: in main chunk.

It was during converting metapost to pdf.  The metapost source
has:

  defaultcolormodel := 3;  % grayscale

which may be why this problem wasn't noticed before.  But the patch
below fixes it for me (after regenerating the format, which took me a
while to realize):


--- /usr/share/texmf/tex/context/base/meta-pdf.lua	2012-05-14 13:38:55.000000000 -0400
+++ /usr/share/texmf/tex/context/base/meta-pdf.lua	2013-04-11 14:54:45.000000000 -0400
@@ -352,7 +352,7 @@
 
 function mps.setgray(s)
     pdfcode(pdffinishtransparencycode())
-    pdfcode(pdfgrayliteral(mps.colormodel,s))
+    pdfcode(pdfgraycode(mps.colormodel,s))
 end
 
 function mps.specials(version,signal,factor) -- 2.0 123 1000

From sanjoy at olin.edu  Sun Apr 14 12:37:13 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Sun, 14 Apr 2013 06:37:13 -0400
Subject: [dev-context] MkIV "isolated expression" with
	\(start|stop|use)staticMPfigure
Message-ID: <87ip3po0ti.fsf@approx.mit.edu>

With the attached test file, which uses MPinclusions for a
staticMPfigure, I get an "Isolated expression".  I think it's a parser
bug somewhere, because deleting almost any word in the file removes the
error.

The file itself looks a bit crazy.  It is a minimal example generated by
a program to help with debugging.  The program randomly deletes a word
in the file, then tests whether the error still happens.  If yes, it
deletes another word.  If no, it restores the word, and tries again by
choosing another word to delete.  That process reduced the file from 4KB
to 2KB.

Here's the relevant piece of the transcript.  The same error happens at
live.contextgarden.net (so I don't think it's a Debian-specific issue).

  ! terminal: >> r_ladder
  ! Isolated expression.
  <to be read again> 
                     ;
  <*>  r_ladder;
                 ;

  .

  system          > tex > error on line 73 in file test-mpfigures.tex: terminal: >> r_ladder
  ! Isolated expression.
  <to be read again> 
                     ;
  <*>  r_ladder;
                 ;

   ...

  63     
  64     \startMPinclusions
  65     def r_ladder := draw unitsquare; enddef;
  66     \stopMPinclusions
  67     
  68     \startstaticMPfigure{resistiveladder}
  69       r_ladder;
  70     \stopstaticMPfigure
  71     
  72     \usestaticMPfigure[resistiveladder]
  73 >>  
  74     \stoptext
  75     

  <inserted text> ...0;;]===], [===[;;]===], false)}

  \meta_process_graphic ...!!es , \MPaskedfigure )}}
                                                    \egroup \placeMPgraphic \m...
  \meta_handle_reusable_graphic ...cess_graphic {#3}
                                                    }\setxvalue {\??mpgraphic ...
  \meta_use_graphic ...aphic \currentMPgraphicname }
                                                    \empty \meta_end_graphic_g...
  <to be read again> 
                     \fi 
  \dodoubleemptyonespaced #1#2->#1[{#2}][]

  ...
  l.73 

And the start of the output, showing the version information:     

  mtx-context     | run 1: luatex --fmt="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/cont-en" --lua="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/cont-en.lui" --backend="pdf" "./test-mpfigures.tex" \stoptext
  This is LuaTeX, Version beta-0.70.2-2012070301 (TeX Live 2012/Debian)
   \write18 enabled.
  (test-mpfigures.tex

  ConTeXt  ver: 2012.05.30 11:26 MKIV  fmt: 2013.4.11  int: english/english

  system          > cont-new.mkiv loaded

If you can think of further tests to run, I'll be happy to try them.
-- 
-Sanjoy

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-mpfigures.tex
Type: text/x-tex
Size: 1942 bytes
Desc: minimal test file
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130414/5bfa097f/attachment.tex>

From pragma at wxs.nl  Sun Apr 14 13:32:43 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 Apr 2013 13:32:43 +0200
Subject: [dev-context] MkIV "isolated expression" with
	\(start|stop|use)staticMPfigure
In-Reply-To: <87ip3po0ti.fsf@approx.mit.edu>
References: <87ip3po0ti.fsf@approx.mit.edu>
Message-ID: <516A93DB.10203@wxs.nl>

On 4/14/2013 12:37 PM, Sanjoy Mahajan wrote:

>    63
>    64     \startMPinclusions
>    65     def r_ladder := draw unitsquare; enddef;

wrong mp: no := but =


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From sanjoy at olin.edu  Sun Apr 14 14:36:20 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Sun, 14 Apr 2013 08:36:20 -0400
Subject: [dev-context] MkIV "isolated expression" with
	\(start|stop|use)staticMPfigure
In-Reply-To: <516A93DB.10203@wxs.nl>
References: <87ip3po0ti.fsf@approx.mit.edu> <516A93DB.10203@wxs.nl>
Message-ID: <8761zpz3uj.fsf@approx.mit.edu>

>>    65     def r_ladder := draw unitsquare; enddef;
>
> wrong mp: no := but =

Oh, you're right.  Though why does it work most of the time, but fails
depending on the exact surrounding .tex text (outside of the MP code)?

Maybe related: mpost never noticed my syntax error before.  That
function defn has used the := syntax for about 3 years (the vcs tells 
me that I put in that function in March, 2010).

With my mpost today, it also works.  Here's a minimal .mp file that
worked (using MetaPost version 1.504):

def r_ladder :=
  draw unitsquare scaled 1cm
enddef;  

beginfig(1)
  r_ladder;
endfig;
end

From pragma at wxs.nl  Sun Apr 14 15:50:09 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 Apr 2013 15:50:09 +0200
Subject: [dev-context] MkIV "isolated expression" with
	\(start|stop|use)staticMPfigure
In-Reply-To: <8761zpz3uj.fsf@approx.mit.edu>
References: <87ip3po0ti.fsf@approx.mit.edu> <516A93DB.10203@wxs.nl>
 <8761zpz3uj.fsf@approx.mit.edu>
Message-ID: <516AB411.3050803@wxs.nl>

On 4/14/2013 2:36 PM, Sanjoy Mahajan wrote:
>>>     65     def r_ladder := draw unitsquare; enddef;
>>
>> wrong mp: no := but =
>
> Oh, you're right.  Though why does it work most of the time, but fails
> depending on the exact surrounding .tex text (outside of the MP code)?
>
> Maybe related: mpost never noticed my syntax error before.  That
> function defn has used the := syntax for about 3 years (the vcs tells
> me that I put in that function in March, 2010).
>
> With my mpost today, it also works.  Here's a minimal .mp file that
> worked (using MetaPost version 1.504):
>
> def r_ladder :=
>    draw unitsquare scaled 1cm
> enddef;
>
> beginfig(1)
>    r_ladder;
> endfig;
> end

hm, interesting, i wonder what the difference is in = and := in such a def

Hans

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Fri Apr 19 13:41:52 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 19 Apr 2013 13:41:52 +0200
Subject: [dev-context] type interference with \placefigure
Message-ID: <CALBOmsYxFB9Vsw_Nz8XAj3Cf=6HgP6xbaNbbw+k6Pnb-y9j0AQ@mail.gmail.com>

Hello,

maybe this has never worked, but

\placefigure[force]{Second page from \type{fullpage-example}, included
with \type+\externalfigure+}{\externalfigure[fullpage-example][page=2]}

fails in MKII with

figures         : dimensions of fullpage-example loaded from figurefile itself
(./gnuplot-context-doc.tuo)
! Missing } inserted.
<inserted text>
                }
<to be read again>
                   \endgroup
\putcompletecaption ...trut #2\endstrut \endgraf }
                                                  \fi \dostopattributes \doi...

\docheckcaptioncontent ...completecaption {#1}{#2}
                                                  }\ifdim \wd \tempcaptionbo...

\dosetpagfloat ... \docheckcaptioncontent {#2}{#3}
                                                  \ifcase \floatparameter \c...

\dosetfloatbox ... \dosetpagfloat \fi {#1}{#2}{#3}
                                                  \setlocalfloatdimensions {...
...
l.195 ...externalfigure[fullpage-example][page=2]}

?

I'm not asking to fix it, but I'm unable to compile the document with MKIV.

Mojca

From pragma at wxs.nl  Fri Apr 19 14:30:28 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 19 Apr 2013 14:30:28 +0200
Subject: [dev-context] type interference with \placefigure
In-Reply-To: <CALBOmsYxFB9Vsw_Nz8XAj3Cf=6HgP6xbaNbbw+k6Pnb-y9j0AQ@mail.gmail.com>
References: <CALBOmsYxFB9Vsw_Nz8XAj3Cf=6HgP6xbaNbbw+k6Pnb-y9j0AQ@mail.gmail.com>
Message-ID: <517138E4.9030406@wxs.nl>

On 4/19/2013 1:41 PM, Mojca Miklavec wrote:
> Hello,
>
> maybe this has never worked, but
>
> \placefigure[force]{Second page from \type{fullpage-example}, included
> with \type+\externalfigure+}{\externalfigure[fullpage-example][page=2]}
>
> fails in MKII with

in the case of \type+...+ the catcode needs to be changed of + (ok, i 
could propbably do it differently in special cases, but anyway, catcode 
changes don't work in arguments

so, it never worked ...

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Fri Apr 19 14:36:32 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 19 Apr 2013 14:36:32 +0200
Subject: [dev-context] type interference with \placefigure
In-Reply-To: <517138E4.9030406@wxs.nl>
References: <CALBOmsYxFB9Vsw_Nz8XAj3Cf=6HgP6xbaNbbw+k6Pnb-y9j0AQ@mail.gmail.com>
 <517138E4.9030406@wxs.nl>
Message-ID: <CALBOmsYEnjd=n5pRC_ayv6YJMqSt00dnZC9bT-wwV=q7DNcwrg@mail.gmail.com>

On Fri, Apr 19, 2013 at 2:30 PM, Hans Hagen wrote:
>
> so, it never worked ...

OK, thank you. It seems that I was using MKIV for that document all the time.

Mojca

From taco at docwolves.nl  Sun Jun 16 17:52:23 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Sun, 16 Jun 2013 17:52:23 +0200
Subject: [dev-context] MetaPost 1.803 announcement
Message-ID: <51BDDF37.7060401@docwolves.nl>


I am happy to announce a new release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.803
----------------------------------------------------------------------

This is a bugfix release for 1.802.

The win32 binary as well as a source archive can be downloaded
immediately from the files section at

   https://foundry.supelec.fr/projects/metapost/

If you want to build MetaPost yourself, you can also do an anonymous
subversion checkout:

   $ svn checkout --username anonsvn 
https://foundry.supelec.fr/svn/metapost/tags/1.803

The password is anonsvn

----------------------------------------------------------------------
What is new in MetaPost version 1.803:
----------------------------------------------------------------------

* Fixed a bug in the path tension handling that sometimes caused
   distorted output.

* A number of small alterations to the build system making it easier
   to integrate metapost with W32TEX.

* Fix the internal rounding functions in --numbersystem=double so that
   they round exactly like in --numbersystem=scaled mode.

* From Elie Roux: a fix to graph.mp to prevent log-scaled graphs with
   large ranges from causing the "Value is too large" error.

Have fun!


Taco Hoekwater, for the MetaPost team, April 5, 2013.


From taco at elvenkind.com  Sun Jun 16 17:55:30 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 16 Jun 2013 17:55:30 +0200
Subject: [dev-context] MetaPost 1.803 announcement
In-Reply-To: <51BDDF37.7060401@docwolves.nl>
References: <51BDDF37.7060401@docwolves.nl>
Message-ID: <51BDDFF2.9030508@elvenkind.com>

On 06/16/2013 05:52 PM, Taco Hoekwater wrote:
>
> Taco Hoekwater, for the MetaPost team, April 5, 2013.

Sorry about that, obviously today is June 16.

Best wishes,
Taco


From sanjoy at olin.edu  Sun Jun 30 16:24:21 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Sun, 30 Jun 2013 10:24:21 -0400
Subject: [dev-context] internal mptopdf not found in Context MkIV 2013.04.20
Message-ID: <8761wvismi.fsf@approx.mit.edu>

Partly to test Norbert's TeXLive 2013 packages for Debian, I just
installed the whole set of packages, which include Context MkIV
2013.04.20.  With it I get an error not present with the older (2012)
format, namely that the internal conversion of mps files to pdf fails.

I don't know whether it is a Debian-specific problem or shared with
upstream, hence I am also sending this to dev-context.

Here's the minimal example (mytest.tex):

  \enabletrackers[graphics.conversion]
  \starttext
  \externalfigure[fig/whole-tree.1]
  \stoptext

(You'll need an actual mps file of that name to get the error below.)

Then running it with

  $ context --trackers=list mytest

produces the error

  graphics        > inclusion > no converter for 'mps' to 'pdf'
  [MP to PDF]
  ! LuaTeX error [string "\directlua "]:1: attempt to index field 'mptopdf' (a nil value)

Here's the full log:

mtx-context     | warning: no (local) file './mytest', proceeding
mtx-context     | run 1: luatex --fmt="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/luatex/cont-en" --jobname="mytest" --lua="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/luatex/cont-en.lui" --no-parse-first-line --c:currentrun=1 --c:fulljobname="./mytest" --c:input="./mytest" --c:kindofrun=1 --c:maxnofruns=8 --c:trackers="list" "cont-yes.mkiv"
This is LuaTeX, Version beta-0.76.0-2013052015 (rev 4627) 
 \write18 enabled.
(/usr/share/texmf/tex/context/base/cont-yes.mkiv

ConTeXt  ver: 2013.04.20 01:15 MKIV current  fmt: 2013.6.28  int: english/english

system          > 'cont-new.mkiv' loaded
(/usr/share/texmf/tex/context/base/cont-new.mkiv)
system          > files > jobname 'mytest', input './mytest', result 'mytest'
fonts           > latin modern fonts are not preloaded
languages       > language 'en' is active
(/home/sanjoy/sfse/mytest.tex{/usr/share/texmf/fonts/map/pdftex/context/mkiv-base.map}
fonts           > preloading latin modern fonts (second stage)
fonts           > typescripts > unknown library 'loc'
{/usr/share/texmf/fonts/map/dvips/lm/lm-math.map}{/usr/share/texmf/fonts/map/dvips/lm/lm-rm.map}
fonts           > 'fallback modern rm 12pt' is loaded
graphics        > inclusion > checking conversion of 'fig/whole-tree.1', fullname 'fig/whole-tree.1', old format 'mps', new format 'pdf', conversion 'default', resolution 'default'
graphics        > inclusion > no converter for 'mps' to 'pdf'
[MP to PDF]
! LuaTeX error [string "\directlua "]:1: attempt to index field 'mptopdf' (a nil value)
stack traceback:
	[string "\directlua "]:1: in main chunk.

system          > tex > error on line 4 in file /home/sanjoy/sfse/mytest.tex: LuaTeX error  ...

1     \enabletrackers[graphics.conversion]
2     \starttext
3     \externalfigure[fig/whole-tree.1]
4 >>  \stoptext
5     


\convertMPtoPDF ...onvertmpstopdf("\MPfilename ")}
                                                  \removeunwantedspaces \egr...
\grph_include_process_mps ...convertMPtoPDF {#1}11
                                                  }
l.4 }
   
\grph_include_place ...e \ctxlua {figures.check()}
                                                  \ctxlua {figures.include()...
\grph_include_figure ...include_place [#1][#2][#3]
                                                  \fi 
\syst_helpers_triple_empty_two_spaced ...{#2}][][]
                                                   
...
l.4 \stoptext
           
? X

mkiv lua stats  > used config file: selfautodir:/share/texmf/web2c/texmfcnf.lua
mkiv lua stats  > used cache path: readable: '/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b' | readable+writable: '/home/sanjoy/.texmf-var/luatex-cache/context/f919750633122078d706dd10f1cfd39b'
mkiv lua stats  > resource resolver: loadtime 0.113 seconds, 0 scans with scantime 0.000 seconds, 0 shared scans, 12 found files, scanned paths: <none>
mkiv lua stats  > stored bytecode data: 326 modules (0.400 sec), 69 tables (0.000 sec), 395 chunks (0.400 sec)
mkiv lua stats  > cleaned up reserved nodes: 38 nodes, 9 lists of 441
mkiv lua stats  > node memory usage: 2 hlist, 12 attribute, 21 glue_spec, 4 attribute_list, 3 temp, 3 if_stack, 4 dir
mkiv lua stats  > used backend: pdf (backend for directly generating pdf output)
mkiv lua stats  > loaded patterns: en::2
mkiv lua stats  > jobdata time: 0.000 seconds saving, 0.002 seconds loading
mkiv lua stats  > callbacks: 38 direct, 179 indirect, 217 total
mkiv lua stats  > randomizer: resumed with value 0.27778996726395
mkiv lua stats  > result saved in file: mytest.pdf, compresslevel 3, objectcompreslevel 3
mkiv lua stats  > loaded fonts: 2 files: latinmodern-math.otf lmroman12-regular.otf
mkiv lua stats  > fonts load time: 0.320 seconds 
mkiv lua stats  > luatex banner: this is luatex, version beta-0.76.0-2013052015  (tex live 2013/dev/debian)(rev 4627)
mkiv lua stats  > control sequences: 37286 of 65536 + 100000
mkiv lua stats  > current memory usage: 25 MB (ctx: 24 MB)
mkiv lua stats  > runtime: 277.615 seconds

mtx-context     | fatal error: return code: 1


From pragma at wxs.nl  Mon Jul  1 11:13:13 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 01 Jul 2013 11:13:13 +0200
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <8761wvismi.fsf@approx.mit.edu>
References: <8761wvismi.fsf@approx.mit.edu>
Message-ID: <51D14829.6090709@wxs.nl>

On 6/30/2013 4:24 PM, Sanjoy Mahajan wrote:
> Partly to test Norbert's TeXLive 2013 packages for Debian, I just
> installed the whole set of packages, which include Context MkIV
> 2013.04.20.  With it I get an error not present with the older (2012)
> format, namely that the internal conversion of mps files to pdf fails.
>
> I don't know whether it is a Debian-specific problem or shared with
> upstream, hence I am also sending this to dev-context.
>
> Here's the minimal example (mytest.tex):
>
>    \enabletrackers[graphics.conversion]
>    \starttext
>    \externalfigure[fig/whole-tree.1]
>    \stoptext
>
> (You'll need an actual mps file of that name to get the error below.)

is there a file meta-pdf.lua in your tree?

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Mon Jul  1 14:01:19 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 1 Jul 2013 14:01:19 +0200
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <8761wvismi.fsf@approx.mit.edu>
References: <8761wvismi.fsf@approx.mit.edu>
Message-ID: <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>

I don't get the error (I'm using MacTeX 2013 which is almost pure TL
2013 installed to the default location).

Mojca

On Sun, Jun 30, 2013 at 4:24 PM, Sanjoy Mahajan <sanjoy at olin.edu> wrote:
> Partly to test Norbert's TeXLive 2013 packages for Debian, I just
> installed the whole set of packages, which include Context MkIV
> 2013.04.20.  With it I get an error not present with the older (2012)
> format, namely that the internal conversion of mps files to pdf fails.
>
> I don't know whether it is a Debian-specific problem or shared with
> upstream, hence I am also sending this to dev-context.
>
> Here's the minimal example (mytest.tex):
>
>   \enabletrackers[graphics.conversion]
>   \starttext
>   \externalfigure[fig/whole-tree.1]
>   \stoptext
>
> (You'll need an actual mps file of that name to get the error below.)
>
> Then running it with
>
>   $ context --trackers=list mytest
>
> produces the error
>
>   graphics        > inclusion > no converter for 'mps' to 'pdf'
>   [MP to PDF]
>   ! LuaTeX error [string "\directlua "]:1: attempt to index field 'mptopdf' (a nil value)
>
> Here's the full log:
>
> mtx-context     | warning: no (local) file './mytest', proceeding
> mtx-context     | run 1: luatex --fmt="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/luatex/cont-en" --jobname="mytest" --lua="/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b/formats/luatex/cont-en.lui" --no-parse-first-line --c:currentrun=1 --c:fulljobname="./mytest" --c:input="./mytest" --c:kindofrun=1 --c:maxnofruns=8 --c:trackers="list" "cont-yes.mkiv"
> This is LuaTeX, Version beta-0.76.0-2013052015 (rev 4627)
>  \write18 enabled.
> (/usr/share/texmf/tex/context/base/cont-yes.mkiv
>
> ConTeXt  ver: 2013.04.20 01:15 MKIV current  fmt: 2013.6.28  int: english/english
>
> system          > 'cont-new.mkiv' loaded
> (/usr/share/texmf/tex/context/base/cont-new.mkiv)
> system          > files > jobname 'mytest', input './mytest', result 'mytest'
> fonts           > latin modern fonts are not preloaded
> languages       > language 'en' is active
> (/home/sanjoy/sfse/mytest.tex{/usr/share/texmf/fonts/map/pdftex/context/mkiv-base.map}
> fonts           > preloading latin modern fonts (second stage)
> fonts           > typescripts > unknown library 'loc'
> {/usr/share/texmf/fonts/map/dvips/lm/lm-math.map}{/usr/share/texmf/fonts/map/dvips/lm/lm-rm.map}
> fonts           > 'fallback modern rm 12pt' is loaded
> graphics        > inclusion > checking conversion of 'fig/whole-tree.1', fullname 'fig/whole-tree.1', old format 'mps', new format 'pdf', conversion 'default', resolution 'default'
> graphics        > inclusion > no converter for 'mps' to 'pdf'
> [MP to PDF]
> ! LuaTeX error [string "\directlua "]:1: attempt to index field 'mptopdf' (a nil value)
> stack traceback:
>         [string "\directlua "]:1: in main chunk.
>
> system          > tex > error on line 4 in file /home/sanjoy/sfse/mytest.tex: LuaTeX error  ...
>
> 1     \enabletrackers[graphics.conversion]
> 2     \starttext
> 3     \externalfigure[fig/whole-tree.1]
> 4 >>  \stoptext
> 5
>
>
> \convertMPtoPDF ...onvertmpstopdf("\MPfilename ")}
>                                                   \removeunwantedspaces \egr...
> \grph_include_process_mps ...convertMPtoPDF {#1}11
>                                                   }
> l.4 }
>
> \grph_include_place ...e \ctxlua {figures.check()}
>                                                   \ctxlua {figures.include()...
> \grph_include_figure ...include_place [#1][#2][#3]
>                                                   \fi
> \syst_helpers_triple_empty_two_spaced ...{#2}][][]
>
> ...
> l.4 \stoptext
>
> ? X
>
> mkiv lua stats  > used config file: selfautodir:/share/texmf/web2c/texmfcnf.lua
> mkiv lua stats  > used cache path: readable: '/var/lib/texmf/luatex-cache/context/f919750633122078d706dd10f1cfd39b' | readable+writable: '/home/sanjoy/.texmf-var/luatex-cache/context/f919750633122078d706dd10f1cfd39b'
> mkiv lua stats  > resource resolver: loadtime 0.113 seconds, 0 scans with scantime 0.000 seconds, 0 shared scans, 12 found files, scanned paths: <none>
> mkiv lua stats  > stored bytecode data: 326 modules (0.400 sec), 69 tables (0.000 sec), 395 chunks (0.400 sec)
> mkiv lua stats  > cleaned up reserved nodes: 38 nodes, 9 lists of 441
> mkiv lua stats  > node memory usage: 2 hlist, 12 attribute, 21 glue_spec, 4 attribute_list, 3 temp, 3 if_stack, 4 dir
> mkiv lua stats  > used backend: pdf (backend for directly generating pdf output)
> mkiv lua stats  > loaded patterns: en::2
> mkiv lua stats  > jobdata time: 0.000 seconds saving, 0.002 seconds loading
> mkiv lua stats  > callbacks: 38 direct, 179 indirect, 217 total
> mkiv lua stats  > randomizer: resumed with value 0.27778996726395
> mkiv lua stats  > result saved in file: mytest.pdf, compresslevel 3, objectcompreslevel 3
> mkiv lua stats  > loaded fonts: 2 files: latinmodern-math.otf lmroman12-regular.otf
> mkiv lua stats  > fonts load time: 0.320 seconds
> mkiv lua stats  > luatex banner: this is luatex, version beta-0.76.0-2013052015  (tex live 2013/dev/debian)(rev 4627)
> mkiv lua stats  > control sequences: 37286 of 65536 + 100000
> mkiv lua stats  > current memory usage: 25 MB (ctx: 24 MB)
> mkiv lua stats  > runtime: 277.615 seconds
>
> mtx-context     | fatal error: return code: 1

From sanjoy at olin.edu  Mon Jul  1 17:51:18 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Mon, 1 Jul 2013 11:51:18 -0400
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
References: <8761wvismi.fsf@approx.mit.edu>
 <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
Message-ID: <8738ryb7nt.fsf@approx.mit.edu>

> I don't get the error (I'm using MacTeX 2013 which is almost pure TL
> 2013 installed to the default location).

Thanks, good to know.  I will install vanilla TL 2013 and compare.

-Sanjoy


From preining at logic.at  Tue Jul  2 09:18:03 2013
From: preining at logic.at (Norbert Preining)
Date: Tue, 2 Jul 2013 16:18:03 +0900
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
 <51D14829.6090709@wxs.nl> <8761wvismi.fsf@approx.mit.edu>
References: <8761wvismi.fsf@approx.mit.edu>
 <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
 <8761wvismi.fsf@approx.mit.edu> <51D14829.6090709@wxs.nl>
 <8761wvismi.fsf@approx.mit.edu>
Message-ID: <20130702071803.GA4542@gamma.logic.tuwien.ac.at>

Hi everyone,

On So, 30 Jun 2013, Sanjoy Mahajan wrote:
> I don't know whether it is a Debian-specific problem or shared with
> upstream, hence I am also sending this to dev-context.

I just updated Debian's context to the latest version in TeX Live,
and I also get an error (see below)

There seems to be a typo in meta-pdf.lua:87:

The error is:
[MP to PDF]
! LuaTeX error ...norbert/tl/2013/texmf-dist/tex/context/base/meta-pdf.lua:87: attempt to call global 'f_concatm' (a nil value)

the line 87 is:
	mpscode(f_concatm(unpack(m_stack_concat)))

when I change it to 
	mpscode(f_concat(unpack(m_stack_concat)))

(delete the "m") it works suddenly without any problem..

Norbert

PS: Mojca, maybe you cheated ;-)

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------

From pragma at wxs.nl  Tue Jul  2 09:59:56 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 02 Jul 2013 09:59:56 +0200
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <20130702071803.GA4542@gamma.logic.tuwien.ac.at>
References: <8761wvismi.fsf@approx.mit.edu>
 <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
 <8761wvismi.fsf@approx.mit.edu> <51D14829.6090709@wxs.nl>
 <8761wvismi.fsf@approx.mit.edu>
 <20130702071803.GA4542@gamma.logic.tuwien.ac.at>
Message-ID: <51D2887C.9040309@wxs.nl>

On 7/2/2013 9:18 AM, Norbert Preining wrote:
> Hi everyone,
>
> On So, 30 Jun 2013, Sanjoy Mahajan wrote:
>> I don't know whether it is a Debian-specific problem or shared with
>> upstream, hence I am also sending this to dev-context.
>
> I just updated Debian's context to the latest version in TeX Live,
> and I also get an error (see below)
>
> There seems to be a typo in meta-pdf.lua:87:
>
> The error is:
> [MP to PDF]
> ! LuaTeX error ...norbert/tl/2013/texmf-dist/tex/context/base/meta-pdf.lua:87: attempt to call global 'f_concatm' (a nil value)
>
> the line 87 is:
> 	mpscode(f_concatm(unpack(m_stack_concat)))
>
> when I change it to
> 	mpscode(f_concat(unpack(m_stack_concat)))
>
> (delete the "m") it works suddenly without any problem..
>
> Norbert
>
> PS: Mojca, maybe you cheated ;-)

ah, thanks for noticing

that code is only seen in some cases (pens)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Tue Jul  2 10:42:08 2013
From: preining at logic.at (Norbert Preining)
Date: Tue, 2 Jul 2013 17:42:08 +0900
Subject: [dev-context] internal mptopdf not found in Context MkIV
	2013.04.20
In-Reply-To: <51D2887C.9040309@wxs.nl>
References: <8761wvismi.fsf@approx.mit.edu>
 <CALBOmsa66i6qSn3ohidnTxJ00GH_NoF2+=4sWpj_TpTfqMVzig@mail.gmail.com>
 <8761wvismi.fsf@approx.mit.edu> <51D14829.6090709@wxs.nl>
 <8761wvismi.fsf@approx.mit.edu>
 <20130702071803.GA4542@gamma.logic.tuwien.ac.at> <51D2887C.9040309@wxs.nl>
Message-ID: <20130702084208.GD4542@gamma.logic.tuwien.ac.at>

On Di, 02 Jul 2013, Hans Hagen wrote:
>> (delete the "m") it works suddenly without any problem..

> that code is only seen in some cases (pens)

So is that the correct fix? I am not sure...

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------

From sanjoy at olin.edu  Sat Jul  6 00:36:36 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Fri, 5 Jul 2013 18:36:36 -0400
Subject: [dev-context] palatino at 10.5pt bold not found when using project
	structure w/ MkIV
Message-ID: <8738rs8wi3.fsf@approx.mit.edu>

>From what I can tell, the bold font is not found if all of the following
are true:

1. using the Palatino typescript
2. setting the body font to 10.5pt (but 11pt or 12pt works fine)
3. using MkIV
4. using components (project structure)

Here's the minimal example (mytest.tex):

============================================================
\startmode[ascomponent]
  \startcomponent mytest
\stopmode

\usetypescript[palatino][ec]
\setupbodyfont[palatino,10.5pt]

\startmode[standalone]
  \starttext
\stopmode

{\bold hello}

\startmode[standalone]
  \stoptext
\stopmode

\startmode[ascomponent]
  \stopcomponent
\stopmode
============================================================

Compile the two variants with:

  context --mode=ascomponent --result=mytest-ascomponent.pdf mytest.tex
  context --mode=standalone --result=mytest-standalone.pdf mytest.tex

mytest-standalone.pdf is fine (the "hello" is in bold), but
mytest-ascomponent.pdf has the "hello" in roman.

The particular roman font in mytest-ascomponent.pdf is also funny:

  $ pdffonts mytest-ascomponent.pdf
  name                                 type              emb sub uni object ID
  ------------------------------------ ----------------- --- --- --- ---------
  TZNKGE+TeXGyrePagellaMath-Regular    CID Type 0C       yes yes yes     18  0

Why is it the math font?

(A slightly more complex example, using \project to include a project
file, which includes an environment file that asks for palatino,
produced the same problem.  But the version above needs just one file,
mytest.tex, so for simplicity I am describing the problem using it.)

What I think is happening is that, when running as a component, the
typescript loading happens too late (after the equivalent of
"\starttext"), and not everything gets set up properly.  In support of
that idea, if I shift the two environment lines ("\usetypescript ...")
to just before the "{\bold hello}"---thus, after the "\starttext"---then
the standalone version gets the same problem ("hello" in roman).

What puzzles me is that this problem shows up only with 10.5pt and using
palatino.  If I just use 10.5pt (i.e. w/ modern), then there's no
problem.  Or 11pt in Palatino is fine.  There's also no problem using MkII.

I tested with the context in vanilla TL2013 and in Norbert's latest
Debian packages--the problem happens in both.

I'm attaching the two log files.

-Sanjoy

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mytest-standalone.log
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130705/76f56f6f/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mytest-ascomponent.log
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130705/76f56f6f/attachment-0001.ksh>

From schuster.wolfgang at gmail.com  Sat Jul  6 08:11:52 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 6 Jul 2013 08:11:52 +0200
Subject: [dev-context] palatino at 10.5pt bold not found when using
	project structure w/ MkIV
In-Reply-To: <8738rs8wi3.fsf@approx.mit.edu>
References: <8738rs8wi3.fsf@approx.mit.edu>
Message-ID: <3E3C010F-F61D-4098-9F74-F486822BAB60@gmail.com>


Am 06.07.2013 um 00:36 schrieb Sanjoy Mahajan <sanjoy at olin.edu>:

> From what I can tell, the bold font is not found if all of the following
> are true:
> 
> 1. using the Palatino typescript
> 2. setting the body font to 10.5pt (but 11pt or 12pt works fine)
> 3. using MkIV
> 4. using components (project structure)
> 
> Here's the minimal example (mytest.tex):
> 
> ============================================================
> \startmode[ascomponent]
>  \startcomponent mytest
> \stopmode
> 
> \usetypescript[palatino][ec]
> \setupbodyfont[palatino,10.5pt]
> 
> \startmode[standalone]
>  \starttext
> \stopmode
> 
> {\bold hello}
> 
> \startmode[standalone]
>  \stoptext
> \stopmode
> 
> \startmode[ascomponent]
>  \stopcomponent
> \stopmode
> ============================================================
> 
> Compile the two variants with:
> 
>  context --mode=ascomponent --result=mytest-ascomponent.pdf mytest.tex
>  context --mode=standalone --result=mytest-standalone.pdf mytest.tex
> 
> mytest-standalone.pdf is fine (the "hello" is in bold), but
> mytest-ascomponent.pdf has the "hello" in roman.
> 
> The particular roman font in mytest-ascomponent.pdf is also funny:
> 
>  $ pdffonts mytest-ascomponent.pdf
>  name                                 type              emb sub uni object ID
>  ------------------------------------ ----------------- --- --- --- ---------
>  TZNKGE+TeXGyrePagellaMath-Regular    CID Type 0C       yes yes yes     18  0
> 
> Why is it the math font?
> 
> (A slightly more complex example, using \project to include a project
> file, which includes an environment file that asks for palatino,
> produced the same problem.  But the version above needs just one file,
> mytest.tex, so for simplicity I am describing the problem using it.)
> 
> What I think is happening is that, when running as a component, the
> typescript loading happens too late (after the equivalent of
> "\starttext"), and not everything gets set up properly.  In support of
> that idea, if I shift the two environment lines ("\usetypescript ...")
> to just before the "{\bold hello}"---thus, after the "\starttext"---then
> the standalone version gets the same problem ("hello" in roman).
> 
> What puzzles me is that this problem shows up only with 10.5pt and using
> palatino.  If I just use 10.5pt (i.e. w/ modern), then there's no
> problem.  Or 11pt in Palatino is fine.  There's also no problem using MkII.
> 
> I tested with the context in vanilla TL2013 and in Norbert's latest
> Debian packages--the problem happens in both.

1. Use the normal and not the developer list for such a question.

2. You can omit the \usetypescript line.

3. Move the \setupbodyfont setting *before* \startcomponent.

4. Add \definebodyfontenvironment[10.5pt] to your document.

Wolfgang

From sanjoy at olin.edu  Sat Jul  6 12:33:07 2013
From: sanjoy at olin.edu (Sanjoy Mahajan)
Date: Sat, 6 Jul 2013 06:33:07 -0400
Subject: [dev-context] palatino at 10.5pt bold not found when using
	project structure w/ MkIV
In-Reply-To: <3E3C010F-F61D-4098-9F74-F486822BAB60@gmail.com>
References: <8738rs8wi3.fsf@approx.mit.edu>
 <3E3C010F-F61D-4098-9F74-F486822BAB60@gmail.com>
Message-ID: <87wqp46krg.fsf@approx.mit.edu>

Wolfgang,

Thank you for all your solutions!

> 2. You can omit the \usetypescript line.

Good to know.  Does the "palatino" keyword in \setupbodyfont
automatically do that now (in Mark IV)?

Should I wikify that bit of information (as MkIV-only)?  (Since I don't
really understand how the fonts work, I am hesitant to wikify much about
it and put up incorrect information.)

> 3. Move the \setupbodyfont setting *before* \startcomponent.

Right, I found that by experiment.  But how should you do that with
projects?  The \setupbodyfont is usually part of an environment file,
which is loaded by the project file.  Should the "\project project_file"
line be placed before the "\startcomponent"?  Like this:

  \project project_file
  \startcomponent component_name

If that's the recommended way, I can update
<http://wiki.contextgarden.net/Project_structure>

> 4. Add \definebodyfontenvironment[10.5pt] to your document.

Thanks, that fixes everything.  On the theory of teaching a man to fish,
how did you learn so much about making ConTeXt do just the right thing?

> 1. Use the normal and not the developer list for such a question.

I thought it was a bug (and it might be, though your
definebodyfontenvironment solution makes me wonder if it is just my not
knowing enough).  In general, should bug reports go to the regular list?

Best,
-Sanjoy

From schuster.wolfgang at gmail.com  Sun Jul  7 22:38:50 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 7 Jul 2013 22:38:50 +0200
Subject: [dev-context] palatino at 10.5pt bold not found when using
	project structure w/ MkIV
In-Reply-To: <87wqp46krg.fsf@approx.mit.edu>
References: <8738rs8wi3.fsf@approx.mit.edu>
 <3E3C010F-F61D-4098-9F74-F486822BAB60@gmail.com>
 <87wqp46krg.fsf@approx.mit.edu>
Message-ID: <C4A06BE9-2D23-49BE-9C78-318FAC7D9240@gmail.com>


Am 06.07.2013 um 12:33 schrieb Sanjoy Mahajan <sanjoy at olin.edu>:

> Wolfgang,
> 
> Thank you for all your solutions!
> 
>> 2. You can omit the \usetypescript line.
> 
> Good to know.  Does the "palatino" keyword in \setupbodyfont
> automatically do that now (in Mark IV)?
> 
> Should I wikify that bit of information (as MkIV-only)?  (Since I don't
> really understand how the fonts work, I am hesitant to wikify much about
> it and put up incorrect information.)

The normal way to load a new font from a external typescript is

\usetypescriptfile[<name>]
\usetypescript[<name>]
\setupbofyfont[<name>]

In MkII you don?t need \usetypescriptfile to load the default fonts (times,
palatino etc.) because context loads them when it generates the format
but MkIV loads them the fonts are used to save memory.

Because in many cases the name of the file is the same (with a ?type-? prefix)
as the font context tries to load the file itself when you enable the font with
\setupbodyfont, even the \usetypescript call (the second argument isn?t needed
because we aren?t restricted to 256 anymore with LuaTeX) isn?t necessary
because this is also done by \setupbodyfont.

>> 3. Move the \setupbodyfont setting *before* \startcomponent.
> 
> Right, I found that by experiment.  But how should you do that with
> projects?  The \setupbodyfont is usually part of an environment file,
> which is loaded by the project file.  Should the "\project project_file"
> line be placed before the "\startcomponent"?  Like this:
> 
>  \project project_file
>  \startcomponent component_name
> 
> If that's the recommended way, I can update
> <http://wiki.contextgarden.net/Project_structure>

You can do this. It?s always better to make the setup of the document before
\starttext, startcomponent etc. because some values are set/reset with \starttext.

>> 4. Add \definebodyfontenvironment[10.5pt] to your document.
> 
> Thanks, that fixes everything.  On the theory of teaching a man to fish,
> how did you learn so much about making ConTeXt do just the right thing?
> 
>> 1. Use the normal and not the developer list for such a question.
> 
> I thought it was a bug (and it might be, though your
> definebodyfontenvironment solution makes me wonder if it is just my not
> knowing enough).  In general, should bug reports go to the regular list?


The only things which are posted on the developer list nowadays are bug reports
with possible fixes or extensions to the context programing language.

Wolfgang

From tim.steenvoorden at gmail.com  Sun Aug  4 23:19:35 2013
From: tim.steenvoorden at gmail.com (Tim Steenvoorden)
Date: Sun, 4 Aug 2013 23:19:35 +0200
Subject: [dev-context] BibTeX auxiliaries
Message-ID: <CAJjcFnLMtTHj5K5L6ampzvmzXVqZ6+_3-eZDxs1t8-HM0R4TGA@mail.gmail.com>

Hi all,

Could *.aux, *.bbl, *.blg be added to the context --purge command?
They are created when using BibTeX for publications. I'm using my own
script to do it now, but it would be nice to delete all auxiliaries
with one command.

Cheers,
Tim

From tim.steenvoorden at gmail.com  Mon Aug  5 11:37:44 2013
From: tim.steenvoorden at gmail.com (Tim Steenvoorden)
Date: Mon, 5 Aug 2013 11:37:44 +0200
Subject: [dev-context] BibTeX auxiliaries
In-Reply-To: <CAJjcFnLMtTHj5K5L6ampzvmzXVqZ6+_3-eZDxs1t8-HM0R4TGA@mail.gmail.com>
References: <CAJjcFnLMtTHj5K5L6ampzvmzXVqZ6+_3-eZDxs1t8-HM0R4TGA@mail.gmail.com>
Message-ID: <CAJjcFnL4hQjDaS62okt1vNJ+Cxut5Sf28dvYQScU3NXU2Y2FXA@mail.gmail.com>

Made a patch for mtx-context. Just tell me if it is worth applying ;-)

Cheers,
Tim

2013/8/4 Tim Steenvoorden <tim.steenvoorden at gmail.com>:
> Hi all,
>
> Could *.aux, *.bbl, *.blg be added to the context --purge command?
> They are created when using BibTeX for publications. I'm using my own
> script to do it now, but it would be nice to delete all auxiliaries
> with one command.
>
> Cheers,
> Tim
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mtx-context.patch
Type: application/octet-stream
Size: 523 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20130805/2fbfd0f9/attachment.obj>

From pragma at wxs.nl  Mon Aug  5 11:52:56 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Aug 2013 11:52:56 +0200
Subject: [dev-context] BibTeX auxiliaries
In-Reply-To: <CAJjcFnL4hQjDaS62okt1vNJ+Cxut5Sf28dvYQScU3NXU2Y2FXA@mail.gmail.com>
References: <CAJjcFnLMtTHj5K5L6ampzvmzXVqZ6+_3-eZDxs1t8-HM0R4TGA@mail.gmail.com>
 <CAJjcFnL4hQjDaS62okt1vNJ+Cxut5Sf28dvYQScU3NXU2Y2FXA@mail.gmail.com>
Message-ID: <51FF75F8.4060804@wxs.nl>

On 8/5/2013 11:37 AM, Tim Steenvoorden wrote:
> Made a patch for mtx-context. Just tell me if it is worth applying ;-)

as i dont't use bibtex ... do others agree?

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From alan.braslau at cea.fr  Mon Aug  5 12:08:42 2013
From: alan.braslau at cea.fr (Alan BRASLAU)
Date: Mon, 5 Aug 2013 12:08:42 +0200
Subject: [dev-context] BibTeX auxiliaries
In-Reply-To: <51FF75F8.4060804@wxs.nl>
References: <CAJjcFnLMtTHj5K5L6ampzvmzXVqZ6+_3-eZDxs1t8-HM0R4TGA@mail.gmail.com>
 <CAJjcFnL4hQjDaS62okt1vNJ+Cxut5Sf28dvYQScU3NXU2Y2FXA@mail.gmail.com>
 <51FF75F8.4060804@wxs.nl>
Message-ID: <20130805120842.1f76488c@sole>

On Mon, 5 Aug 2013 11:52:56 +0200
Hans Hagen <pragma at wxs.nl> wrote:

> On 8/5/2013 11:37 AM, Tim Steenvoorden wrote:
> > Made a patch for mtx-context. Just tell me if it is worth applying ;-)
> 
> as i dont't use bibtex ... do others agree?

I believe that purging .bbl and .blg (and .aux) could be useful.
I tend to do this manually, sometimes, when I bother cleaning-up
(which can prove to be potentially dangerous through a sloppy use of wildcards...)

Alan

From wolfgang.schuster at gmail.com  Fri Sep 20 06:40:11 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Fri, 20 Sep 2013 06:40:11 +0200
Subject: [dev-context] font-ini.mkvi
Message-ID: <E0A955EE-8EB9-4512-82A8-639171E39E0C@gmail.com>

Hi,

\unexpanded\def\font_basics_define_body_font_name_identifier_a#name#identifier#style%
  {%\writestatus\m!fonts{[#name:#style] => [##identifier:#style]}%
-  \ifcsname\csname\??fontdefinitions#name:#style\endcsname
+  \ifcsname\??fontdefinitions#name:#style\endcsname
     \expandafter\let\csname\??fontdefinitions#name:#style\expandafter\endcsname\csname\??fontdefinitions#identifier:#style\endcsname
   \else
     \expandafter\def\csname\??fontdefinitions#name:#style\endcsname{\csname\??fontdefinitions#identifier:#style\endcsname}%
   \fi}

Wolfgang

From wolfgang.schuster at gmail.com  Mon Sep 23 17:09:05 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 23 Sep 2013 17:09:05 +0200
Subject: [dev-context] math-rad.mkvi
Message-ID: <0AA74758-4740-450E-AFA6-4387B2B423FF@gmail.com>

Hi,

\setvalue{\??mathradicalalternative\v!normal}#body%
  {\edef\p_color{\mathradicalparameter\c!color}%
   \ifx\p_color\empty
-    \rootradical\currentmathradicaldegree{#body}%
+    \rootradical{\currentmathradicaldegree}{#body}%
   \else\ifx\currentmathradicaldegree\empty
     \pushcolor[\p_color]%
     \rootradical\currentmathradicaldegree
     {\popcolor#body}%
   \else
     \pushcolor[\p_color]%
     \rootradical{\popcolor\currentmathradicaldegree\pushcolor[\p_color]}%
     {\popcolor#body}%
   \fi\fi}

Wolfgang

From pragma at wxs.nl  Mon Sep 23 18:39:46 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Sep 2013 18:39:46 +0200
Subject: [dev-context] math-rad.mkvi
In-Reply-To: <0AA74758-4740-450E-AFA6-4387B2B423FF@gmail.com>
References: <0AA74758-4740-450E-AFA6-4387B2B423FF@gmail.com>
Message-ID: <52406ED2.8060107@wxs.nl>

On 9/23/2013 5:09 PM, Wolfgang Schuster wrote:
> Hi,
>
> \setvalue{\??mathradicalalternative\v!normal}#body%
>    {\edef\p_color{\mathradicalparameter\c!color}%
>     \ifx\p_color\empty
> -    \rootradical\currentmathradicaldegree{#body}%
> +    \rootradical{\currentmathradicaldegree}{#body}%
>     \else\ifx\currentmathradicaldegree\empty
>       \pushcolor[\p_color]%
>       \rootradical\currentmathradicaldegree

^^ here too

>       {\popcolor#body}%
>     \else
>       \pushcolor[\p_color]%
>       \rootradical{\popcolor\currentmathradicaldegree\pushcolor[\p_color]}%
>       {\popcolor#body}%
>     \fi\fi}
>
> Wolfgang
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-context
>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Wed Sep 25 15:32:24 2013
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 25 Sep 2013 15:32:24 +0200
Subject: [dev-context] font-ini.mkvi
Message-ID: <DB8865A4-0876-40B4-9B56-C5CF7094DD1B@gmail.com>

Hi,

\unexpanded\def\font_helpers_set_font_set_font_option_body#method#body#message%
  {\normalizebodyfontsize\normalizedsetfont{#body}% redundant for some calls
   \ifcsname\??fontbodyknown\normalizedsetfont\endcsname \else
-    \font_helpers_define_unknown_font{#body}%
+    \font_helpers_define_unknown_font\normalizedsetfont
   \fi
   \ifcsname\??fontbodyknown\normalizedsetfont\endcsname
     \localbodyfontsize\normalizedsetfont
     \let\normalizedbodyfontsize\normalizedsetfont
   \else
     \showmessage\m!fonts4{#message}%
    %\font_helpers_set_font_set_font_option_body_fallbacks{#method}{#body}%
   \fi}

Wolfgang

From schuster.wolfgang at gmail.com  Sun Sep 29 09:42:54 2013
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 29 Sep 2013 09:42:54 +0200
Subject: [dev-context] tabl-nte.mkiv
Message-ID: <4E337D69-A4F0-45DC-BDFC-D94F605787DB@gmail.com>

Hi,

the files uses the old names for the token lists of the natural table mechanism.

-\def\tabl_nte_start_head[#1]#2\stopTABLEhead{\appendtoks\doTABLEsection[#1]{#2}\to\TBLhead}
-\def\tabl_nte_start_next[#1]#2\stopTABLEnext{\appendtoks\doTABLEsection[#1]{#2}\to\TBLnext}
-\def\tabl_nte_start_body[#1]#2\stopTABLEbody{\appendtoks\doTABLEsection[#1]{#2}\to\TBLbody}
-\def\tabl_nte_start_foot[#1]#2\stopTABLEfoot{\appendtoks\doTABLEsection[#1]{#2}\to\TBLfoot}
+\def\tabl_nte_start_head[#1]#2\stopTABLEhead{\appendtoks\tabl_ntb_section[#1]{#2}\to\t_tabl_ntb_head}
+\def\tabl_nte_start_next[#1]#2\stopTABLEnext{\appendtoks\tabl_ntb_section[#1]{#2}\to\t_tabl_ntb_next}
+\def\tabl_nte_start_body[#1]#2\stopTABLEbody{\appendtoks\tabl_ntb_section[#1]{#2}\to\t_tabl_ntb_body}
+\def\tabl_nte_start_foot[#1]#2\stopTABLEfoot{\appendtoks\tabl_ntb_section[#1]{#2}\to\t_tabl_ntb_foot}

Wolfgang

From taco at bittext.nl  Tue Dec 31 17:09:05 2013
From: taco at bittext.nl (Taco Hoekwater)
Date: Tue, 31 Dec 2013 17:09:05 +0100
Subject: [dev-context] Luatex 0.78.0 announcement
Message-ID: <52C2EC21.9070102@bittext.nl>

Hi,

I have just uploaded the archives for a new luatex release, 0.78.0.
This release merges some experimental branches, and fixes a few of the 
outstanding bugs.

Changes:

* Instead of using expanded fonts, just calculate the expanded
   width of glyphs where needed, and carry expand info in the
   glyph nodes (all based on Hans' suggestions). All font expansion
   functions are disabled and most are removed.

* New, faster (but limited) direct node access from lua, see
   the manual for details

* Support for Apple Advanced Typography (AAT) information in
   fonts is dropped

* Extended build script for mingw/msys (includes 64-bit support)

* Various patches from/via Akira Kakuta for better Win32
   integration

* Fixes for some bugs in de pdfscanner library (mostly related
   to inline images)

* Maximum hyphenated word length is now 64Kb characters.

* Various patches from Khaled Hosny and Luigi Scarso for the
   luafontloader subsystem

* Fix for a crash when re-dumping formats

* Fix for a Selene unicode library bug where some characters in
   UTF-8 were incorrectly flagged as having the 'Space' property

* Some smaller fixes


The archives can be downloaded from supelec as usual:

         https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

   svn co --username anonsvn --password anonsvn              \
       https://foundry.supelec.fr/svn/luatex/tags/beta-0.78.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun, and a happy new year!

Taco

