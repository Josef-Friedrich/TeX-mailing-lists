From taco at elvenkind.com  Thu Jan 15 14:54:24 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jan 2015 14:54:24 +0100
Subject: [dev-context] cld feature request
Message-ID: <6ABD3DA0-4856-409F-8B26-FAAF4C2CB496@elvenkind.com>

Hi Hans,

Lately, I am doing quite a lot of work with CLD, and sometimes I do not
trust my Lua code completely. To allow some rudimentary debugging, 
I have patched my local  cldf-ini.lua to contain this:

local dumpfile = io.open('dumpfile.txt', 'w')
local function flush (z,...)
   if type(z) == 'number' then
      dumpfile:write(string.format('%02d ', z))
   else
      dumpfile:write('   ')
      dumpfile:write(z)
   end
   for _,v in ipairs({...}) do
      dumpfile:write (v)
   end
   dumpfile:write ('\n')
   texsprint(z,...)
end 

instead of the normal 

  local flush = texsprint

That way, I can look in dumpfile.txt to make sure that the correct ConTeXt 
code is generated. Is there any chance that you could offer a tracker/messaging 
feature with similar functionality? Patching cldf-ini.lua is not nice ;)

Best wishes,
Taco


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150115/f25637b6/attachment.html>

From pragma at wxs.nl  Thu Jan 15 15:21:00 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 15 Jan 2015 15:21:00 +0100
Subject: [dev-context] cld feature request
In-Reply-To: <6ABD3DA0-4856-409F-8B26-FAAF4C2CB496@elvenkind.com>
References: <6ABD3DA0-4856-409F-8B26-FAAF4C2CB496@elvenkind.com>
Message-ID: <54B7CCCC.9010407@wxs.nl>

On 1/15/2015 2:54 PM, Taco Hoekwater wrote:
> Hi Hans,
>
> Lately, I am doing quite a lot of work with CLD, and sometimes I do not
> trust my Lua code completely. To allow some rudimentary debugging,
> I have patched my local  cldf-ini.lua to contain this:
>
> local dumpfile = io.open('dumpfile.txt', 'w')
> local function flush (z,...)
>     if type(z) == 'number' then
>        dumpfile:write(string.format('%02d ', z))
>     else
>        dumpfile:write('   ')
>        dumpfile:write(z)
>     end
>     for _,v in ipairs({...}) do
>        dumpfile:write (v)
>     end
>     dumpfile:write ('\n')
>     texsprint(z,...)
> end
>
> instead of the normal
>
>    local flush = texsprint
>
> That way, I can look in dumpfile.txt to make sure that the correct ConTeXt
> code is generated. Is there any chance that you could offer a
> tracker/messaging
> feature with similar functionality? Patching cldf-ini.lua is not nice ;)

\enabletrackers[context.*]


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Jan 15 15:37:20 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jan 2015 15:37:20 +0100
Subject: [dev-context] cld feature request
In-Reply-To: <54B7CCCC.9010407@wxs.nl>
References: <6ABD3DA0-4856-409F-8B26-FAAF4C2CB496@elvenkind.com>
 <54B7CCCC.9010407@wxs.nl>
Message-ID: <CDBC48B1-567B-45A6-AFBB-AB6BACC7A56E@elvenkind.com>


> On 15 Jan 2015, at 15:21, Hans Hagen <pragma at wxs.nl> wrote:
> 
> \enabletrackers[context.*]

Nice, thanks. (Now I wonder how I missed that).

Best wishes,
Taco


From pragma at wxs.nl  Thu Jan 15 16:10:30 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 15 Jan 2015 16:10:30 +0100
Subject: [dev-context] cld feature request
In-Reply-To: <CDBC48B1-567B-45A6-AFBB-AB6BACC7A56E@elvenkind.com>
References: <6ABD3DA0-4856-409F-8B26-FAAF4C2CB496@elvenkind.com>
 <54B7CCCC.9010407@wxs.nl>
 <CDBC48B1-567B-45A6-AFBB-AB6BACC7A56E@elvenkind.com>
Message-ID: <54B7D866.7080803@wxs.nl>

On 1/15/2015 3:37 PM, Taco Hoekwater wrote:
>
>> On 15 Jan 2015, at 15:21, Hans Hagen <pragma at wxs.nl> wrote:
>>
>> \enabletrackers[context.*]
>
> Nice, thanks. (Now I wonder how I missed that).

probably because it's an overload and not an "if tracing then else end" 
in the source and that's easy to overlook

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ishamid at colostate.edu  Mon Feb  9 02:11:17 2015
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 08 Feb 2015 18:11:17 -0700
Subject: [dev-context] Bibliography bug: edition
Message-ID: <op.xtrmwzq0fkrasx@ishamid-pc>

Dear gang,

There is a typo in bibl-apa.tex, line 201:

\insertedition{ }{ edition}{}%

Occurs again on line 285. It needs to be corrected to

\insertedition{ }{ edition.}{}% ADD A PERIOD!

Other parts of this file do this correctly. I've corrected the file  
manually but it needs to be fixed for the next beta; thanks!

Best wishes
Idris
-- 
Idris Samawi Hamid
Professor of Philosophy
Colorado State University
Fort Collins, CO 80523

From alan.braslau at cea.fr  Mon Feb  9 09:36:31 2015
From: alan.braslau at cea.fr (Alan BRASLAU)
Date: Mon, 9 Feb 2015 09:36:31 +0100
Subject: [dev-context] Bibliography bug: edition
In-Reply-To: <op.xtrmwzq0fkrasx@ishamid-pc>
References: <op.xtrmwzq0fkrasx@ishamid-pc>
Message-ID: <20150209093631.052bb173@iram-ha-003840.extra.cea.fr>

edition gets abbreviated "ed." according to the APA standard.

p.203 of the 2013 edition of the APA style guide:

\startquotation
* Place information about editions, volume numbers, and page numbers
(such as revised edition, volume number, or chapter page range) in
parentheses following the title, with the period after the parentheses:
(Rev. ed.) or (Vol. xx, pp. xxxâxxx). As with periodicals, for any
nonroutine information that is important for identification and
retrieval, place a description of content in brackets following the
title: [Brochure]. 
\stopquotation

Now, the mkii bibliography uses a sort of hybrid APA-like style, but
normally there would NOT be a period after "edition" (unless it is
abbreviated "ed.") as it should be followed either by a comma or by a
right parenthesis.

Alan






On Sun, 8 Feb 2015 18:11:17 -0700
Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <ishamid at colostate.edu> wrote:

> Dear gang,
> 
> There is a typo in bibl-apa.tex, line 201:
> 
> \insertedition{ }{ edition}{}%
> 
> Occurs again on line 285. It needs to be corrected to
> 
> \insertedition{ }{ edition.}{}% ADD A PERIOD!
> 
> Other parts of this file do this correctly. I've corrected the file  
> manually but it needs to be fixed for the next beta; thanks!
> 
> Best wishes
> Idris



-- 
Alan Braslau
CEA DSM-IRAMIS-SPEC
CNRS URA 2464
Orme des Merisiers
91191 Gif-sur-Yvette cedex FRANCE
tel: +33 1 69 08 73 15
fax: +33 1 69 08 87 86
mailto:alan.braslau at cea.fr

From ishamid at colostate.edu  Mon Feb  9 13:06:17 2015
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Mon, 09 Feb 2015 05:06:17 -0700
Subject: [dev-context] Bibliography bug: edition
In-Reply-To: <20150209093631.052bb173@iram-ha-003840.extra.cea.fr>
References: <op.xtrmwzq0fkrasx@ishamid-pc>
 <20150209093631.052bb173@iram-ha-003840.extra.cea.fr>
Message-ID: <op.xtsg8qaifkrasx@ishamid-pc>

On Mon, 09 Feb 2015 01:36:31 -0700, Alan BRASLAU <alan.braslau at cea.fr>  
wrote:

> Now, the mkii bibliography uses a sort of hybrid APA-like style, but
> normally there would NOT be a period after "edition" (unless it is
> abbreviated "ed.") as it should be followed either by a comma or by a
> right parenthesis.

In that case, 'edition' should be replaced by 'ed.'. Try this:

\startpublication[k=haq,
                   t=book,
                   a=Haq,
                   y=1994,
                   s=SNHq94]
\author[]{Syed Nomanul}[S.]{}{Haq}
\title{Names, Natures, and Things}
\pubname{Kluwer}
\edition{2\high{nd}}
\note{Two volumes}
\city{Dordrecht}
\pubyear{1994}
\stoppublication

In the output there is 'edition' followed by 'Dordrecht'. Now that just  
can't be right -)

Best wishes
Idris
-- 
Idris Samawi Hamid
Professor of Philosophy
Colorado State University
Fort Collins, CO 80523

From schuster.wolfgang at gmail.com  Fri Mar  6 15:16:10 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 6 Mar 2015 15:16:10 +0100
Subject: [dev-context] \setupreferencestructureprefix
Message-ID: <74A2DDC9-1D30-496B-A749-72DBA555E7CF@gmail.com>

Hi Hans,

can you extend the \setupreferencestructureprefix command with number (e.g. numberconversion) keys.


In strc-ref.mkvi the definition of \getreferencestructureprefix should be changed to
(besides the number keys I added starter and stopper keys to the prefix)

\def\getreferencestructureprefix#kind#name#category% name will change
  {{
        prefix        =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefix",
        separatorset  =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixseparatorset",
        conversion    =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixconversion",
        conversionset =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixconversionset",
        starter       = \!!bs\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixstarter\!!es,
        stopper       = \!!bs\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixstopper\!!es,
        set           =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixset",
        segments      =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixsegments",
        connector     = \!!bs\referencestructureprefixparameter{#kind}{#name}{#category}\c!prefixconnector\!!es,
  },
  {
        separatorset  =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!numberseparatorset",
        conversion    =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!numberconversion",
        conversionset =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!numberconversionset",
        starter       = \!!bs\referencestructureprefixparameter{#kind}{#name}{#category}\c!numberstarter\!!es,
        stopper       = \!!bs\referencestructureprefixparameter{#kind}{#name}{#category}\c!numberstopper\!!es,
        segments      =     "\referencestructureprefixparameter{#kind}{#name}{#category}\c!numbersegments",
  }}


In the Lua file src-ref.lua a small change is necessary to use this extra table:

-function genericfilters.number(data,what,prefixspec) -- todo: spec and then no stopper
+function genericfilters.number(data,what,prefixspec,numberspec) -- todo: spec and then no stopper
    if data then
        numberdata = lists.reordered(data) -- data.numberdata
        if numberdata then
            helpers.prefix(data,prefixspec)
-           sections.typesetnumber(numberdata,"number",numberdata)
+           sections.typesetnumber(numberdata,"number",numberspec,numberdata)
        else
            local useddata = data.useddata
            if useddata and useddata.number then
                context(useddata.number)
            end
        end
    end
end


BTW: The \setupreferencestructureprefix command needs a better name


%%%% begin example
\setupreferencestructureprefix[default][prefixstopper={\symbol[none]},numberstopper={\symbol[none]}]
%\setupreferencestructureprefix[section][default][prefixconversion=A]
%\setupreferencestructureprefix[float]  [default][numberconversion=A]

\setuphead   [chapter][sectionstopper=.]
\setupcaption[figure] [numberstopper=:]

\starttext

\chapter[sec:dummy]{Dummy chapter}

\placefigure[][fig:dummy]{Dummy figure}{\externalfigure[dummy]}

Section: \in[sec:dummy]

Float: \in[fig:dummy]

\stoptext
%%%% end example


Wolfgang

From schuster.wolfgang at gmail.com  Fri Mar  6 15:18:39 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 6 Mar 2015 15:18:39 +0100
Subject: [dev-context] page-mak.mkvi
Message-ID: <C431AA41-C69F-4044-936F-288EA02571F4@gmail.com>

Hi,

\def\page_makeup_start_indeed[#name][#settings]%
  {% the next grouping hack is somewhat messy:
   \begingroup
   % we need to figure out the current layout
   \xdef\m_page_makeup_name{#name}%
   \let\currentmakeup\m_page_makeup_name
   \let\currentlayout\m_page_makeup_name
   \xdef\m_page_makeup_layout_parent{\layoutparameter\s!parent}%
   \setupcurrentmakeup[#settings]%
   \edef\p_page{\makeupparameter\c!page}%
   \ifx\p_page\empty
     \endgroup
     \page % new, so best not have dangling mess here like references (we could capture then and flush embedded)
   \else\ifx\p_page\v!no
     % nothing
     \endgroup
   \else
-    \endgroup
-    \page[\p_page]%
+    \normalexpanded{\endgroup\page[\p_page]}%
   \fi\fi
   â¦

Wolfgang

From pragma at wxs.nl  Fri Mar  6 20:04:55 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2015 20:04:55 +0100
Subject: [dev-context] page-mak.mkvi
In-Reply-To: <C431AA41-C69F-4044-936F-288EA02571F4@gmail.com>
References: <C431AA41-C69F-4044-936F-288EA02571F4@gmail.com>
Message-ID: <54F9FA57.3020101@wxs.nl>

On 3/6/2015 3:18 PM, Wolfgang Schuster wrote:
> Hi,
>
> \def\page_makeup_start_indeed[#name][#settings]%
>    {% the next grouping hack is somewhat messy:
>     \begingroup
>     % we need to figure out the current layout
>     \xdef\m_page_makeup_name{#name}%
>     \let\currentmakeup\m_page_makeup_name
>     \let\currentlayout\m_page_makeup_name
>     \xdef\m_page_makeup_layout_parent{\layoutparameter\s!parent}%
>     \setupcurrentmakeup[#settings]%
>     \edef\p_page{\makeupparameter\c!page}%
>     \ifx\p_page\empty
>       \endgroup
>       \page % new, so best not have dangling mess here like references (we could capture then and flush embedded)
>     \else\ifx\p_page\v!no
>       % nothing
>       \endgroup
>     \else
> -    \endgroup
> -    \page[\p_page]%
> +    \normalexpanded{\endgroup\page[\p_page]}%
>     \fi\fi
>     â¦

ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  6 20:08:10 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2015 20:08:10 +0100
Subject: [dev-context] \setupreferencestructureprefix
In-Reply-To: <74A2DDC9-1D30-496B-A749-72DBA555E7CF@gmail.com>
References: <74A2DDC9-1D30-496B-A749-72DBA555E7CF@gmail.com>
Message-ID: <54F9FB1A.3000807@wxs.nl>

On 3/6/2015 3:16 PM, Wolfgang Schuster wrote:

> can you extend the \setupreferencestructureprefix command with number (e.g. numberconversion) keys.

sure, thanks for figuring it out

> In strc-ref.mkvi the definition of \getreferencestructureprefix should be changed to
> (besides the number keys I added starter and stopper keys to the prefix)

ok

> In the Lua file src-ref.lua a small change is necessary to use this extra table:

ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Tue Mar 10 13:32:12 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 10 Mar 2015 13:32:12 +0100
Subject: [dev-context] page-brk.mkvi
Message-ID: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>

Hi Hans,

the \page command needs a small for to reset the statues values for \page[blank]
which results in disappearing page numbers and backgrounds.

%% begin example
\setuppagenumbering[alternative=doublesided]

\setuphead[chapter][page={yes,blank,right}]

\setupbackgrounds[page][background=color,backgroundcolor=green]

\starttext

\dorecurse{2}
  {\chapter{Chapter \convertnumber{word}{#1}}
   \dorecurse{10}{\input knuth\par}}

\stoptext
%% end example


\def\page_breaks_process[#1]% so, page ornaments are reset after a pagebreak command, unless set
  {\par % always before group so that we clear hangs etc (as in side floats)
   \ifvmode % extra check
     \begingroup
     \the\everybeforepagebreak
     \c_page_breaks_prevpage\realpageno
     \ifcase\pageornamentstate \or
       % disable reset after shipout
       \global\pageornamentstate\plustwo
     \fi
     \iffirstargument % or if empty i.e. []
       \page_breaks_handle{#1}%
     \else % so, no pagebreak when \pagebreak[] ! ! !
       \page_breaks_handle_direct\v!yes
     \fi
     \relax
     \ifnum\c_page_breaks_prevpage<\realpageno
       \global\pageornamentstate\zerocount
-    \fi
+    \else\ifnum\c_page_breaks_prevpage=\realpageno
+      \global\pageornamentstate\zerocount
+    \fi\fi
     \the\everyafterpagebreak
     \endgroup
   \fi}


Wolfgang

From pragma at wxs.nl  Tue Mar 10 15:05:31 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2015 15:05:31 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
Message-ID: <54FEFA2B.3080201@wxs.nl>

On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>       \ifnum\c_page_breaks_prevpage<\realpageno
>         \global\pageornamentstate\zerocount
> -    \fi
> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
> +      \global\pageornamentstate\zerocount
> +    \fi\fi

so

      \ifnum\c_page_breaks_prevpage>\realpageno \else
        \global\pageornamentstate\zerocount
      \fi


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Tue Mar 10 15:12:28 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 10 Mar 2015 15:12:28 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <54FEFA2B.3080201@wxs.nl>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl>
Message-ID: <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>


> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl>:
> 
> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>      \ifnum\c_page_breaks_prevpage<\realpageno
>>        \global\pageornamentstate\zerocount
>> -    \fi
>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>> +      \global\pageornamentstate\zerocount
>> +    \fi\fi
> 
> so
> 
>     \ifnum\c_page_breaks_prevpage>\realpageno \else
>       \global\pageornamentstate\zerocount
>     \fi

In this case you can drop the check because \pageornamentstate will be reset anyway and

    \global\pageornamentstate\zerocount

alone is enough.

Wolfgang

From pragma at wxs.nl  Tue Mar 10 15:28:01 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2015 15:28:01 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl> <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
Message-ID: <54FEFF71.8020806@wxs.nl>

On 3/10/2015 3:12 PM, Wolfgang Schuster wrote:
>
>> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl>:
>>
>> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>>       \ifnum\c_page_breaks_prevpage<\realpageno
>>>         \global\pageornamentstate\zerocount
>>> -    \fi
>>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>>> +      \global\pageornamentstate\zerocount
>>> +    \fi\fi
>>
>> so
>>
>>      \ifnum\c_page_breaks_prevpage>\realpageno \else
>>        \global\pageornamentstate\zerocount
>>      \fi
>
> In this case you can drop the check because \pageornamentstate will be reset anyway and
>
>      \global\pageornamentstate\zerocount
>
> alone is enough.

makes me wonder why there was this test

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar 10 22:30:30 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2015 22:30:30 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl> <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
Message-ID: <54FF6276.8040909@wxs.nl>

On 3/10/2015 3:12 PM, Wolfgang Schuster wrote:
>
>> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl>:
>>
>> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>>       \ifnum\c_page_breaks_prevpage<\realpageno
>>>         \global\pageornamentstate\zerocount
>>> -    \fi
>>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>>> +      \global\pageornamentstate\zerocount
>>> +    \fi\fi
>>
>> so
>>
>>      \ifnum\c_page_breaks_prevpage>\realpageno \else
>>        \global\pageornamentstate\zerocount
>>      \fi
>
> In this case you can drop the check because \pageornamentstate will be reset anyway and
>
>      \global\pageornamentstate\zerocount
>
> alone is enough.

no it's reset elsewhere (after shipout) .. anyway say we have

\def\page_breaks_process[#1]% so, page ornaments are reset after a 
pagebreak command, unless set
   {\par % always before group so that we clear hangs etc (as in side 
floats)
    \ifvmode % extra check
      \begingroup
      \the\everybeforepagebreak
      \ifcase\pageornamentstate \or
        % disable reset after shipout
        \global\pageornamentstate\plustwo
      \fi
      \iffirstargument % or if empty i.e. []
        \page_breaks_handle{#1}%
      \else % so, no pagebreak when \pagebreak[] ! ! !
        \page_breaks_handle_direct\v!yes
      \fi
      \relax
      \the\everyafterpagebreak
      \endgroup
    \fi}

this works ok with

\setuphead
   [chapter]
   [page={yes,right,blank}]

watch the order: yes and right are done in sequence and when we're om a 
right page we bloek the ornaments for one page

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Wed Mar 11 00:55:38 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 11 Mar 2015 00:55:38 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <54FF6276.8040909@wxs.nl>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl> <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
 <54FF6276.8040909@wxs.nl>
Message-ID: <4C1AC4CF-7AD9-4B99-BE92-41970C7F3476@gmail.com>


> Am 10.03.2015 um 22:30 schrieb Hans Hagen <pragma at wxs.nl>:
> 
> On 3/10/2015 3:12 PM, Wolfgang Schuster wrote:
>> 
>>> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl>:
>>> 
>>> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>>>      \ifnum\c_page_breaks_prevpage<\realpageno
>>>>        \global\pageornamentstate\zerocount
>>>> -    \fi
>>>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>>>> +      \global\pageornamentstate\zerocount
>>>> +    \fi\fi
>>> 
>>> so
>>> 
>>>     \ifnum\c_page_breaks_prevpage>\realpageno \else
>>>       \global\pageornamentstate\zerocount
>>>     \fi
>> 
>> In this case you can drop the check because \pageornamentstate will be reset anyway and
>> 
>>     \global\pageornamentstate\zerocount
>> 
>> alone is enough.
> 
> no it's reset elsewhere (after shipout) .. anyway say we have
> 
> \def\page_breaks_process[#1]% so, page ornaments are reset after a pagebreak command, unless set
>  {\par % always before group so that we clear hangs etc (as in side floats)
>   \ifvmode % extra check
>     \begingroup
>     \the\everybeforepagebreak
>     \ifcase\pageornamentstate \or
>       % disable reset after shipout
>       \global\pageornamentstate\plustwo
>     \fi
>     \iffirstargument % or if empty i.e. []
>       \page_breaks_handle{#1}%
>     \else % so, no pagebreak when \pagebreak[] ! ! !
>       \page_breaks_handle_direct\v!yes
>     \fi
>     \relax
>     \the\everyafterpagebreak
>     \endgroup
>   \fi}
> 
> this works ok with
> 
> \setuphead
>  [chapter]
>  [page={yes,right,blank}]
> 
> watch the order: yes and right are done in sequence and when we're om a right page we bloek the ornaments for one page

It depends which result you expect, do you want to hide all backgrounds
elements on the first page of the chapter or from the empty left page
before the chapter.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150311/96fecd91/attachment-0001.html>

From pragma at wxs.nl  Wed Mar 11 09:30:52 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2015 09:30:52 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <4C1AC4CF-7AD9-4B99-BE92-41970C7F3476@gmail.com>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl> <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
 <54FF6276.8040909@wxs.nl> <4C1AC4CF-7AD9-4B99-BE92-41970C7F3476@gmail.com>
Message-ID: <54FFFD3C.2080303@wxs.nl>

On 3/11/2015 12:55 AM, Wolfgang Schuster wrote:
>
>> Am 10.03.2015 um 22:30 schrieb Hans Hagen <pragma at wxs.nl
>> <mailto:pragma at wxs.nl>>:
>>
>> On 3/10/2015 3:12 PM, Wolfgang Schuster wrote:
>>>
>>>> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl
>>>> <mailto:pragma at wxs.nl>>:
>>>>
>>>> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>>>>      \ifnum\c_page_breaks_prevpage<\realpageno
>>>>>        \global\pageornamentstate\zerocount
>>>>> -    \fi
>>>>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>>>>> +      \global\pageornamentstate\zerocount
>>>>> +    \fi\fi
>>>>
>>>> so
>>>>
>>>>     \ifnum\c_page_breaks_prevpage>\realpageno \else
>>>>       \global\pageornamentstate\zerocount
>>>>     \fi
>>>
>>> In this case you can drop the check because \pageornamentstate will
>>> be reset anyway and
>>>
>>>     \global\pageornamentstate\zerocount
>>>
>>> alone is enough.
>>
>> no it's reset elsewhere (after shipout) .. anyway say we have
>>
>> \def\page_breaks_process[#1]% so, page ornaments are reset after a
>> pagebreak command, unless set
>>  {\par % always before group so that we clear hangs etc (as in side
>> floats)
>>   \ifvmode % extra check
>>     \begingroup
>>     \the\everybeforepagebreak
>>     \ifcase\pageornamentstate \or
>>       % disable reset after shipout
>>       \global\pageornamentstate\plustwo
>>     \fi
>>     \iffirstargument % or if empty i.e. []
>>       \page_breaks_handle{#1}%
>>     \else % so, no pagebreak when \pagebreak[] ! ! !
>>       \page_breaks_handle_direct\v!yes
>>     \fi
>>     \relax
>>     \the\everyafterpagebreak
>>     \endgroup
>>   \fi}
>>
>> this works ok with
>>
>> \setuphead
>>  [chapter]
>>  [page={yes,right,blank}]
>>
>> watch the order: yes and right are done in sequence and when we're om
>> a right page we bloek the ornaments for one page
>
> It depends which result you expect, do you want to hide all backgrounds
> elements on the first page of the chapter or from the empty left page
> before the chapter.

hm, the last one is tricky and more like:

\page
\doifoddpageelse
   \relax
   {\page[blank,right}

or so, so we'd need a new key for it (what key)

Hans


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Wed Mar 11 16:09:08 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 11 Mar 2015 16:09:08 +0100
Subject: [dev-context] page-brk.mkvi
In-Reply-To: <54FFFD3C.2080303@wxs.nl>
References: <635BA166-E08F-4A69-BCA6-F84C8DF27D81@gmail.com>
 <54FEFA2B.3080201@wxs.nl> <A5B5909E-D0E9-45F9-B63D-615AFBEED653@gmail.com>
 <54FF6276.8040909@wxs.nl> <4C1AC4CF-7AD9-4B99-BE92-41970C7F3476@gmail.com>
 <54FFFD3C.2080303@wxs.nl>
Message-ID: <7A615221-E4C0-4FC9-AB1C-E147F3789AB4@gmail.com>


> Am 11.03.2015 um 09:30 schrieb Hans Hagen <pragma at wxs.nl>:
> 
> On 3/11/2015 12:55 AM, Wolfgang Schuster wrote:
>> 
>>> Am 10.03.2015 um 22:30 schrieb Hans Hagen <pragma at wxs.nl <mailto:pragma at wxs.nl>
>>> <mailto:pragma at wxs.nl <mailto:pragma at wxs.nl>>>:
>>> 
>>> On 3/10/2015 3:12 PM, Wolfgang Schuster wrote:
>>>> 
>>>>> Am 10.03.2015 um 15:05 schrieb Hans Hagen <pragma at wxs.nl <mailto:pragma at wxs.nl>
>>>>> <mailto:pragma at wxs.nl <mailto:pragma at wxs.nl>>>:
>>>>> 
>>>>> On 3/10/2015 1:32 PM, Wolfgang Schuster wrote:
>>>>>>     \ifnum\c_page_breaks_prevpage<\realpageno
>>>>>>       \global\pageornamentstate\zerocount
>>>>>> -    \fi
>>>>>> +    \else\ifnum\c_page_breaks_prevpage=\realpageno
>>>>>> +      \global\pageornamentstate\zerocount
>>>>>> +    \fi\fi
>>>>> 
>>>>> so
>>>>> 
>>>>>    \ifnum\c_page_breaks_prevpage>\realpageno \else
>>>>>      \global\pageornamentstate\zerocount
>>>>>    \fi
>>>> 
>>>> In this case you can drop the check because \pageornamentstate will
>>>> be reset anyway and
>>>> 
>>>>    \global\pageornamentstate\zerocount
>>>> 
>>>> alone is enough.
>>> 
>>> no it's reset elsewhere (after shipout) .. anyway say we have
>>> 
>>> \def\page_breaks_process[#1]% so, page ornaments are reset after a
>>> pagebreak command, unless set
>>> {\par % always before group so that we clear hangs etc (as in side
>>> floats)
>>>  \ifvmode % extra check
>>>    \begingroup
>>>    \the\everybeforepagebreak
>>>    \ifcase\pageornamentstate \or
>>>      % disable reset after shipout
>>>      \global\pageornamentstate\plustwo
>>>    \fi
>>>    \iffirstargument % or if empty i.e. []
>>>      \page_breaks_handle{#1}%
>>>    \else % so, no pagebreak when \pagebreak[] ! ! !
>>>      \page_breaks_handle_direct\v!yes
>>>    \fi
>>>    \relax
>>>    \the\everyafterpagebreak
>>>    \endgroup
>>>  \fi}
>>> 
>>> this works ok with
>>> 
>>> \setuphead
>>> [chapter]
>>> [page={yes,right,blank}]
>>> 
>>> watch the order: yes and right are done in sequence and when we're om
>>> a right page we bloek the ornaments for one page
>> 
>> It depends which result you expect, do you want to hide all backgrounds
>> elements on the first page of the chapter or from the empty left page
>> before the chapter.
> 
> hm, the last one is tricky and more like:
> 
> \page
> \doifoddpageelse
>  \relax
>  {\page[blank,right}
> 
> or so, so we'd need a new key for it (what key)

When I follow the description from the manual [1] on page 75 which reads
âinsert a completely blank pageâ I expect something similar like

    \setuphead[chapter][page={yes,header,footer,right}]

with the exception that backgrounds are disabled as well.

[1] http://pragma-ade.com/general/manuals/cont-enp.pdf <http://pragma-ade.com/general/manuals/cont-enp.pdf>

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150311/7cf42555/attachment.html>

From schuster.wolfgang at gmail.com  Thu Mar 12 16:40:19 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 12 Mar 2015 16:40:19 +0100
Subject: [dev-context] file-job.mkvi
Message-ID: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>

Hi Hans,

can \starttext and \stoptext can be removed from \startproject and \stopproject!

\unexpanded\def\startprojectindeed
- {\starttext
-  \pushsystemmode\v!project
+ {\pushsystemmode\v!project
   \setsystemmode\v!project}

\unexpanded\def\stopprojectindeed
  {\popsystemmode\v!project
-  \stoptext
   \signalendofinput\v!project}


When you have a document like this

%% begin example
\project[projectfile]

\startproduct[productfile]

â¦

\stopproduct
%% end example

the project file ends the document before the actual content is reached.

Wolfgang

From pragma at wxs.nl  Fri Mar 13 00:33:51 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 13 Mar 2015 00:33:51 +0100
Subject: [dev-context] file-job.mkvi
In-Reply-To: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
References: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
Message-ID: <5502225F.8000406@wxs.nl>

On 3/12/2015 4:40 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> can \starttext and \stoptext can be removed from \startproject and \stopproject!
>
> \unexpanded\def\startprojectindeed
> - {\starttext
> -  \pushsystemmode\v!project
> + {\pushsystemmode\v!project
>     \setsystemmode\v!project}
>
> \unexpanded\def\stopprojectindeed
>    {\popsystemmode\v!project
> -  \stoptext
>     \signalendofinput\v!project}
>
>
> When you have a document like this
>
> %% begin example
> \project[projectfile]
>
> \startproduct[productfile]
>
> â¦
>
> \stopproduct
> %% end example
>
> the project file ends the document before the actual content is reached.

ok, but keep in mind that they were there because in some usage 
scenarios there can now be side effects due to starttext related actions 
being delayed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar 13 00:35:49 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 13 Mar 2015 00:35:49 +0100
Subject: [dev-context] file-job.mkvi
In-Reply-To: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
References: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
Message-ID: <550222D5.10709@wxs.nl>

On 3/12/2015 4:40 PM, Wolfgang Schuster wrote:

> the project file ends the document before the actual content is reached.

btw, there are people who complained that their old stuff didn't run 
because they ran projects as main document (composed of products) so we 
might get questions

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Fri Mar 13 00:41:20 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 13 Mar 2015 00:41:20 +0100
Subject: [dev-context] file-job.mkvi
In-Reply-To: <550222D5.10709@wxs.nl>
References: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
 <550222D5.10709@wxs.nl>
Message-ID: <7AA25F92-C897-4080-B8A5-109D4645E419@gmail.com>


> Am 13.03.2015 um 00:35 schrieb Hans Hagen <pragma at wxs.nl>:
> 
> On 3/12/2015 4:40 PM, Wolfgang Schuster wrote:
> 
>> the project file ends the document before the actual content is reached.
> 
> btw, there are people who complained that their old stuff didn't run because they ran projects as main document (composed of products) so we might get questions

How should this work with MkIV, project files donât load product files anymore.

Wolfgang

From pragma at wxs.nl  Fri Mar 13 11:43:09 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 13 Mar 2015 11:43:09 +0100
Subject: [dev-context] file-job.mkvi
In-Reply-To: <7AA25F92-C897-4080-B8A5-109D4645E419@gmail.com>
References: <67D7C238-72E9-4316-998C-AACBF71B9FE2@gmail.com>
 <550222D5.10709@wxs.nl> <7AA25F92-C897-4080-B8A5-109D4645E419@gmail.com>
Message-ID: <5502BF3D.9020604@wxs.nl>

On 3/13/2015 12:41 AM, Wolfgang Schuster wrote:
>
>> Am 13.03.2015 um 00:35 schrieb Hans Hagen <pragma at wxs.nl>:
>>
>> On 3/12/2015 4:40 PM, Wolfgang Schuster wrote:
>>
>>> the project file ends the document before the actual content is reached.
>>
>> btw, there are people who complained that their old stuff didn't run because they ran projects as main document (composed of products) so we might get questions
>
> How should this work with MkIV, project files donât load product files anymore.

there were cases out there like

\startproject

text

\stopproject

so when someone complains we should educate

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Wed Mar 18 10:58:59 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 18 Mar 2015 10:58:59 +0100
Subject: [dev-context] typo-del.mkvi
Message-ID: <AAEF9BC0-AA35-4441-A9DC-D999F39D6A9B@gmail.com>

Hi Hans,

there is a \aftergroup necessary to let the indentation check work when \setupdelimitedtext[â¦][indentnext=auto] is set.

\def\typo_delimited_stop_par
  {\removeunwantedspaces
   \removelastskip
   \rightdelimitedtextmark
   \carryoverpar\endgroup % new per 2013-01-21 ... please left floats
   \popmacro\checkindentation
   \typo_delimited_stop_par_indeed
   \delimitedtextparameter\c!after
   \edef\p_delimited_spaceafter{\delimitedtextparameter\c!spaceafter}%
   \ifx\p_delimited_spaceafter\empty \else
     \blank[\p_delimited_spaceafter]%
   \fi
   \useindentnextparameter\delimitedtextparameter
-  \dorechecknextindentation}% AM: This was missing!
+  \aftergroup\dorechecknextindentation}% AM: This was missing!

Wolfgang

From schuster.wolfgang at gmail.com  Sat Mar 28 19:46:04 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 28 Mar 2015 19:46:04 +0100
Subject: [dev-context] lang-hyp.mkiv
Message-ID: <D8D0AC74-B251-4C6E-8849-DFC579E6B4AD@gmail.com>

Hi,

there is a typo in lang-hyp.mkiv

\unexpanded\def\sethyphenationfeatures[#1]%
- {\cclf_sethyphenationfeatures{#1}}
+ {\clf_sethyphenationfeatures{#1}}

Wolfgang

From wolfgang.schuster at gmail.com  Mon Mar 30 17:07:15 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 30 Mar 2015 17:07:15 +0200
Subject: [dev-context] Bug in \MPr position macro
Message-ID: <DDA77266-7808-48C0-AD72-F79B1F16C9E2@gmail.com>

Hi Hans,

the \MPr gives an empty string when the page and paper size are the same.

The first papersize setups gives the wrong output while the second setup
with different sizes gives the right output.

\setuppapersize[A6][A6] % wrong.pdf
%\setuppapersize[A6][A5] % right.pdf

\starttext

\dontleavehmode\xypos{testposition}

\startlines[style=mono]
X: \MPx{testposition}
Y: \MPy{testposition}
R: \MPr{testposition}
\stoplines

\stoptext

Wolfgang
-------------- next part --------------
A non-text attachment was scrubbed...
Name: right.pdf
Type: application/pdf
Size: 7898 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150330/fa0b65fd/attachment.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: wrong.pdf
Type: application/pdf
Size: 7295 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150330/fa0b65fd/attachment-0001.pdf>

From pragma at wxs.nl  Mon Mar 30 21:39:26 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 30 Mar 2015 21:39:26 +0200
Subject: [dev-context] Bug in \MPr position macro
In-Reply-To: <DDA77266-7808-48C0-AD72-F79B1F16C9E2@gmail.com>
References: <DDA77266-7808-48C0-AD72-F79B1F16C9E2@gmail.com>
Message-ID: <5519A66E.3060303@wxs.nl>

On 3/30/2015 5:07 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \MPr gives an empty string when the page and paper size are the same.
>
> The first papersize setups gives the wrong output while the second setup
> with different sizes gives the right output.
>
> \setuppapersize[A6][A6] % wrong.pdf
> %\setuppapersize[A6][A5] % right.pdf
>
> \starttext
>
> \dontleavehmode\xypos{testposition}
>
> \startlines[style=mono]
> X: \MPx{testposition}
> Y: \MPy{testposition}
> R: \MPr{testposition}
> \stoplines
>
> \stoptext

this is because the page region is only used fpr special pusposed and 
only flushed when a page is mapped onto a larger papersize

anyway, as you seem to need it i'll make a virtual region out of it

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Tue Mar 31 06:44:13 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 31 Mar 2015 06:44:13 +0200
Subject: [dev-context] Bug in \MPr position macro
In-Reply-To: <5519A66E.3060303@wxs.nl>
References: <DDA77266-7808-48C0-AD72-F79B1F16C9E2@gmail.com>
 <5519A66E.3060303@wxs.nl>
Message-ID: <89DA1D68-E197-4191-82A9-AAF0DFDF26ED@gmail.com>


> Am 30.03.2015 um 21:39 schrieb Hans Hagen <pragma at wxs.nl>:
> 
> On 3/30/2015 5:07 PM, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> the \MPr gives an empty string when the page and paper size are the same.
>> 
>> The first papersize setups gives the wrong output while the second setup
>> with different sizes gives the right output.
>> 
>> \setuppapersize[A6][A6] % wrong.pdf
>> %\setuppapersize[A6][A5] % right.pdf
>> 
>> \starttext
>> 
>> \dontleavehmode\xypos{testposition}
>> 
>> \startlines[style=mono]
>> X: \MPx{testposition}
>> Y: \MPy{testposition}
>> R: \MPr{testposition}
>> \stoplines
>> 
>> \stoptext
> 
> this is because the page region is only used fpr special pusposed and only flushed when a page is mapped onto a larger papersize
> 
> anyway, as you seem to need it i'll make a virtual region out of it


The \MPr value is needed for the layer mechanism when you use âposition=yesâ.

\definelayer[mylayer]

\setupbackgrounds[page][background=mylayer]

\starttext

a \setlayer[mylayer][position=yes]{b} c

\stoptext

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150331/0a850fe5/attachment-0001.html>

From schuster.wolfgang at gmail.com  Mon Apr 13 22:04:10 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 13 Apr 2015 22:04:10 +0200
Subject: [dev-context] strc-flt.mkvi
Message-ID: <7E75B254-8032-4A91-901B-56DE5FC21922@gmail.com>

Hi,

\unexpanded\def\startplacefloat
  {\flushnotes
   \page_otr_command_flush_side_floats % here !
   \strc_floats_begin_group
-  \dodoubleempty\strc_floats_start_place_float}
+  \dotripleempty\strc_floats_start_place_float}

Wolfgang

From oinos at gmx.es  Fri Apr 24 07:37:38 2015
From: oinos at gmx.es (Pablo Rodriguez)
Date: Fri, 24 Apr 2015 07:37:38 +0200
Subject: [dev-context] two new paper sizes for imposition
Message-ID: <5539D6A2.6020203@gmx.es>

Hans,

would it be possible to add the invoice and half invoice papersizes for
impositions similar to this one
(https://archive.org/download/ensayo-escritura/ensayo-escritura.pdf)
with letter paper sizes?

I attach the diff file.

Many thanks for your help,


Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: invoice-papersize.diff
Type: text/x-patch
Size: 559 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150424/34aaffcc/attachment.bin>

From schuster.wolfgang at gmail.com  Thu May 14 16:29:06 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 14 May 2015 16:29:06 +0200
Subject: [dev-context] font-sty.mkvi
Message-ID: <FFED8CB1-BF04-4E9F-810A-759CAC771B90@gmail.com>

Hi,

\def\font_styles_define_style_instance[#instance][#2][#3][#4]% [name] [rm|ss|tt|..] [sl|bf|...] [whatever]
  {\iffirstargument
-    \ifcsname#1\endcsname\else\font_styles_define_style_collection[#instance]\fi
+    \ifcsname#instance\endcsname\else\font_styles_define_style_collection[#instance]\fi
   \fi
   \iffourthargument
     \setvalue{\??stylecollection#instance:#2:#3}{#4}%
   \else\ifthirdargument
     \setvalue{\??stylecollection#instance::#2}{#3}%
   \else\ifsecondargument
     \letvalueempty{\??stylecollection#instance::#2}%
   \fi\fi\fi}

Wolfgang

From schuster.wolfgang at gmail.com  Fri May 15 14:44:36 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 15 May 2015 14:44:36 +0200
Subject: [dev-context] core-con.lua
Message-ID: <3A21DC3B-1DE1-4B78-B00D-6591DD051006@gmail.com>

Hi,

implement {
    name      = "ordinal",
    actions   = ctxordinal,
-   arguments = { "string", "string" }
+   arguments = { "integer", "string" }
}

Wolfgang

From luigi.scarso at gmail.com  Sat Jun 13 14:54:38 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 13 Jun 2015 14:54:38 +0200
Subject: [dev-context] Luatex 0.80.0 announcement
Message-ID: <CAG5iGsBS71YvEDOMs62kuxS-jFeNR5KN8DEzYM-fdDheYG+VcA@mail.gmail.com>

New luatex release, 0.80.0
This is the release of TeXLive 2015, which is now available for downloading
(see http://tug.org/texlive/ for more info).


Changes:

* New library newtokenlib. It will replace the current token lib.
* Fixed a bug on the normal random generator for double/decimal/binary
  number systems.
* Several others bugs fixed.


The archives can be downloaded from supelec as usual:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.80.0
<https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.1>

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Hans, Taco, Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150613/922a6081/attachment.html>

From schuster.wolfgang at gmail.com  Sat Jun 20 18:49:21 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 20 Jun 2015 18:49:21 +0200
Subject: [dev-context] strc-ref.lua
Message-ID: <55859991.2090508@gmail.com>

Hi Hans,

there is a extra âtaâ in âmetadataâ.

local function getcurrentprefixspec(default)
local data = currentreference and currentreference.i
local metadata = data and data.metadata
print(metatadata and metadata.kind or "?")
return
- metatadata and metadata.kind or "?",
- metatadata and metadata.name or "?",
- default or "?"
+ metadata and metadata.kind or "?",
+ metadata and metadata.name or "?",
+ default or "?"
end

Wolfgang

From pragma at wxs.nl  Sun Jun 21 12:34:43 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 21 Jun 2015 12:34:43 +0200
Subject: [dev-context] strc-ref.lua
In-Reply-To: <55859991.2090508@gmail.com>
References: <55859991.2090508@gmail.com>
Message-ID: <55869343.9010305@wxs.nl>

On 6/20/2015 6:49 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> there is a extra âtaâ in âmetadataâ.
>
> local function getcurrentprefixspec(default)
> local data = currentreference and currentreference.i
> local metadata = data and data.metadata
> print(metatadata and metadata.kind or "?")
> return
> - metatadata and metadata.kind or "?",
> - metatadata and metadata.name or "?",
> - default or "?"
> + metadata and metadata.kind or "?",
> + metadata and metadata.name or "?",
> + default or "?"
> end

thanks, will be fixed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Fri Jun 26 20:20:27 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 26 Jun 2015 20:20:27 +0200
Subject: [dev-context] \xfrac and \xxfrac
Message-ID: <558D97EB.9000704@gmail.com>

Hi Hans,

the commands \xfrac and \xxfrac donât work because the use the undefined 
command \math_frac_alternative.


\unexpanded\def\xfrac 
{\begingroup\let\xfrac\xxfrac\math_frac_alternative\scriptstyle}
\unexpanded\def\xxfrac{\begingroup \math_frac_alternative\scriptscriptstyle}


%% begin example
\starttext

\startformula
\frac{1}{2} \quad \xfrac{1}{2} \quad \xxfrac{1}{2}
\stopformula

\stoptext
%% end example

Wolfgang

From schuster.wolfgang at gmail.com  Tue Jun 30 14:31:18 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 30 Jun 2015 14:31:18 +0200
Subject: [dev-context] Reset counters at page breaks
Message-ID: <55928C16.6070704@gmail.com>

Hi Hans,

the setting âway=bypageâ is ignored with the current defintion of the 
\incrementcounter defintion.


Can you add the folowing defintions to strc-num.mkiv which will bring 
back the feature.

\def\strc_counters_increment_two 
[#1][#2]{\strc_counters_increment_sub{#1}{#2}}
\def\strc_counters_increment_one 
[#1][#2]{\strc_counters_increment_sub{#1}\plusone}
\unexpanded\def\strc_counters_increment 
#1{\strc_counters_increment_sub{#1}\plusone}


%%%% begin example
\definecounter[testcounter][way=bypage]

\define\TestCounter
{\incrementcounter[testcounter]
%\convertedcounter[testcounter]
\rawcountervalue [testcounter]}

\starttext
\dorecurse{3}{\TestCounter\page}
\stoptext
%%%% end example

Wolfgang

From schuster.wolfgang at gmail.com  Mon Jul 27 13:03:09 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 27 Jul 2015 13:03:09 +0200
Subject: [dev-context] x-set-11.mkiv
Message-ID: <55B60FED.5000908@gmail.com>

Hi,

the module x-set-11.mkiv creates a few custom \type command with \v!type 
as parent which produces a warning (missing parent command) because 
there is no \definetype[\v!type].

These three defintions are the problem:

\definetype[parametercommand][\v!type]
\definetype[parameterkey]    [\v!type]
\definetype[parametervalue]  [\v!type][\c!space=\v!on]

Wolfgang

From brian at landy.cx  Wed Aug  5 22:12:04 2015
From: brian at landy.cx (Brian R. Landy)
Date: Wed, 05 Aug 2015 16:12:04 -0400 (EDT)
Subject: [dev-context] patch: \definegraphictypesynonym
Message-ID: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>

Hi, I noticed on recent betas (I'm not sure when this first began) that 
the command \definegraphictypesynonym no longer works.  I corrected it in 
grph-inc.lua:

--- a/tex/texmf-context/tex/context/base/grph-inc.lua
+++ b/tex/texmf-context/tex/context/base/grph-inc.lua
@@ -429,8 +429,8 @@ end
  function figures.registersuffix (suffix, target) register('list',   target,suffix ) end
  function figures.registerpattern(pattern,target) register('pattern',target,pattern) end

-implement { name = "registerfiguresuffix",  actions = register, arguments = { "'list'",    "string", "string" } }
-implement { name = "registerfigurepattern", actions = register, arguments = { "'pattern'", "string", "string" } }
+implement { name = "registerfiguresuffix",  actions = figures.registersuffix,  arguments = { "string", "string" } }
+implement { name = "registerfigurepattern", actions = figures.registerpattern, arguments = { "string", "string" } }

I believe I only needed to fix "registerfiguresuffix" but also patched 
"registerfigurepattern" since the code looks like it isn't working, 
either.  This was tested on 20150805.

Best regards,
Brian

From pragma at wxs.nl  Wed Aug  5 23:55:48 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 5 Aug 2015 23:55:48 +0200
Subject: [dev-context] patch: \definegraphictypesynonym
In-Reply-To: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>
References: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>
Message-ID: <55C28664.3090200@wxs.nl>

On 8/5/2015 10:12 PM, Brian R. Landy wrote:
> Hi, I noticed on recent betas (I'm not sure when this first began) that
> the command \definegraphictypesynonym no longer works.  I corrected it
> in grph-inc.lua:
>
> --- a/tex/texmf-context/tex/context/base/grph-inc.lua
> +++ b/tex/texmf-context/tex/context/base/grph-inc.lua
> @@ -429,8 +429,8 @@ end
>   function figures.registersuffix (suffix, target) register('list',
> target,suffix ) end
>   function figures.registerpattern(pattern,target)
> register('pattern',target,pattern) end
>
> -implement { name = "registerfiguresuffix",  actions = register,
> arguments = { "'list'",    "string", "string" } }
> -implement { name = "registerfigurepattern", actions = register,
> arguments = { "'pattern'", "string", "string" } }
> +implement { name = "registerfiguresuffix",  actions =
> figures.registersuffix,  arguments = { "string", "string" } }
> +implement { name = "registerfigurepattern", actions =
> figures.registerpattern, arguments = { "string", "string" } }
>
> I believe I only needed to fix "registerfiguresuffix" but also patched
> "registerfigurepattern" since the code looks like it isn't working,
> either.  This was tested on 20150805.

Are you sure about this? Can you give an example where the original fails?

local function register(tag,target,what)
print(">>",tag,target,what)
     local data = figures_formats[target] -- resolver etc

can be uses for testing

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From brian at landy.cx  Thu Aug  6 03:02:55 2015
From: brian at landy.cx (Brian R. Landy)
Date: Wed, 05 Aug 2015 21:02:55 -0400
Subject: [dev-context] patch: \definegraphictypesynonym
In-Reply-To: <55C28664.3090200@wxs.nl>
References: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>
 <55C28664.3090200@wxs.nl>
Message-ID: <2E4C771A-84EA-45E2-B3F9-ECB0A7F1C33B@landy.cx>


> On Aug 5, 2015, at 5:55 PM, Hans Hagen <pragma at wxs.nl> wrote:
> 
> On 8/5/2015 10:12 PM, Brian R. Landy wrote:
>> Hi, I noticed on recent betas (I'm not sure when this first began) that
>> the command \definegraphictypesynonym no longer works.  I corrected it
>> in grph-inc.lua:
>> 
>> --- a/tex/texmf-context/tex/context/base/grph-inc.lua
>> +++ b/tex/texmf-context/tex/context/base/grph-inc.lua
>> @@ -429,8 +429,8 @@ end
>>  function figures.registersuffix (suffix, target) register('list',
>> target,suffix ) end
>>  function figures.registerpattern(pattern,target)
>> register('pattern',target,pattern) end
>> 
>> -implement { name = "registerfiguresuffix",  actions = register,
>> arguments = { "'list'",    "string", "string" } }
>> -implement { name = "registerfigurepattern", actions = register,
>> arguments = { "'pattern'", "string", "string" } }
>> +implement { name = "registerfiguresuffix",  actions =
>> figures.registersuffix,  arguments = { "string", "string" } }
>> +implement { name = "registerfigurepattern", actions =
>> figures.registerpattern, arguments = { "string", "string" } }
>> 
>> I believe I only needed to fix "registerfiguresuffix" but also patched
>> "registerfigurepattern" since the code looks like it isn't working,
>> either.  This was tested on 20150805.
> 
> Are you sure about this? Can you give an example where the original fails?
> 
> local function register(tag,target,what)
> print(">>",tag,target,what)
>    local data = figures_formats[target] -- resolver etc
> 
> can be uses for testing
> 
> Hans
> 
> -----------------------------------------------------------------
>                                          Hans Hagen | PRAGMA ADE
>              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>    tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
>                                             | www.pragma-pod.nl
> -----------------------------------------------------------------
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-context

I copied the sample cow.pdf into the local directory as cow_brl.brl, and saved the below as test.tex.  The resulting pdf is attached.  With my patch the graphic is included.

  \definegraphictypesynonym[brl][pdf]
  \starttext
  \externalfigure[cow_brl]
  \stoptext

Brian

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 7410 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150805/b2da380d/attachment.pdf>
-------------- next part --------------



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150805/b2da380d/attachment.sig>

From pragma at wxs.nl  Thu Aug  6 09:33:42 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 6 Aug 2015 09:33:42 +0200
Subject: [dev-context] patch: \definegraphictypesynonym
In-Reply-To: <2E4C771A-84EA-45E2-B3F9-ECB0A7F1C33B@landy.cx>
References: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>
 <55C28664.3090200@wxs.nl> <2E4C771A-84EA-45E2-B3F9-ECB0A7F1C33B@landy.cx>
Message-ID: <55C30DD6.1010106@wxs.nl>

On 8/6/2015 3:02 AM, Brian R. Landy wrote:
>
>> On Aug 5, 2015, at 5:55 PM, Hans Hagen <pragma at wxs.nl> wrote:
>>
>> On 8/5/2015 10:12 PM, Brian R. Landy wrote:
>>> Hi, I noticed on recent betas (I'm not sure when this first began) that
>>> the command \definegraphictypesynonym no longer works.  I corrected it
>>> in grph-inc.lua:
>>>
>>> --- a/tex/texmf-context/tex/context/base/grph-inc.lua
>>> +++ b/tex/texmf-context/tex/context/base/grph-inc.lua
>>> @@ -429,8 +429,8 @@ end
>>>   function figures.registersuffix (suffix, target) register('list',
>>> target,suffix ) end
>>>   function figures.registerpattern(pattern,target)
>>> register('pattern',target,pattern) end
>>>
>>> -implement { name = "registerfiguresuffix",  actions = register,
>>> arguments = { "'list'",    "string", "string" } }
>>> -implement { name = "registerfigurepattern", actions = register,
>>> arguments = { "'pattern'", "string", "string" } }
>>> +implement { name = "registerfiguresuffix",  actions =
>>> figures.registersuffix,  arguments = { "string", "string" } }
>>> +implement { name = "registerfigurepattern", actions =
>>> figures.registerpattern, arguments = { "string", "string" } }
>>>
>>> I believe I only needed to fix "registerfiguresuffix" but also patched
>>> "registerfigurepattern" since the code looks like it isn't working,
>>> either.  This was tested on 20150805.
>>
>> Are you sure about this? Can you give an example where the original fails?
>>
>> local function register(tag,target,what)
>> print(">>",tag,target,what)
>>     local data = figures_formats[target] -- resolver etc
>>
>> can be uses for testing
>>
>> Hans
>>
>> -----------------------------------------------------------------
>>                                           Hans Hagen | PRAGMA ADE
>>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>>     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
>>                                              | www.pragma-pod.nl
>> -----------------------------------------------------------------
>> _______________________________________________
>> dev-context mailing list
>> dev-context at ntg.nl
>> http://www.ntg.nl/mailman/listinfo/dev-context
>
> I copied the sample cow.pdf into the local directory as cow_brl.brl, and saved the below as test.tex.  The resulting pdf is attached.  With my patch the graphic is included.
>
>    \definegraphictypesynonym[brl][pdf]
>    \starttext
>    \externalfigure[cow_brl]
>    \stoptext

we need to swap target in the reghister function: M

local function register(tag,what,target)

function figures.registersuffix (suffix, target) 
register('list',suffix,target) end
function figures.registerpattern(pattern,target) 
register('pattern',pattern,target) end

then the implementers are ok

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From brian at landy.cx  Mon Aug 10 16:23:52 2015
From: brian at landy.cx (Brian R. Landy)
Date: Mon, 10 Aug 2015 10:23:52 -0400 (EDT)
Subject: [dev-context] patch: \definegraphictypesynonym
In-Reply-To: <55C30DD6.1010106@wxs.nl>
References: <alpine.BSO.2.20.1508051606001.25377@firefly.landy.cx>
 <55C28664.3090200@wxs.nl> <2E4C771A-84EA-45E2-B3F9-ECB0A7F1C33B@landy.cx>
 <55C30DD6.1010106@wxs.nl>
Message-ID: <alpine.BSO.2.20.1508101018240.6885@firefly.landy.cx>

On Thu, 6 Aug 2015, Hans Hagen wrote:

> On 8/6/2015 3:02 AM, Brian R. Landy wrote:
>> 
>>> On Aug 5, 2015, at 5:55 PM, Hans Hagen <pragma at wxs.nl> wrote:
>>> 
>>> On 8/5/2015 10:12 PM, Brian R. Landy wrote:
>>>> Hi, I noticed on recent betas (I'm not sure when this first began) 
>>>> that
>>>> the command \definegraphictypesynonym no longer works.  I corrected 
>>>> it
>>>> in grph-inc.lua:
>>>> 
>>>> --- a/tex/texmf-context/tex/context/base/grph-inc.lua
>>>> +++ b/tex/texmf-context/tex/context/base/grph-inc.lua
>>>> @@ -429,8 +429,8 @@ end
>>>>   function figures.registersuffix (suffix, target) register('list',
>>>> target,suffix ) end
>>>>   function figures.registerpattern(pattern,target)
>>>> register('pattern',target,pattern) end
>>>> 
>>>> -implement { name = "registerfiguresuffix",  actions = register,
>>>> arguments = { "'list'",    "string", "string" } }
>>>> -implement { name = "registerfigurepattern", actions = register,
>>>> arguments = { "'pattern'", "string", "string" } }
>>>> +implement { name = "registerfiguresuffix",  actions =
>>>> figures.registersuffix,  arguments = { "string", "string" } }
>>>> +implement { name = "registerfigurepattern", actions =
>>>> figures.registerpattern, arguments = { "string", "string" } }
>>>> 
>>>> I believe I only needed to fix "registerfiguresuffix" but also 
>>>> patched
>>>> "registerfigurepattern" since the code looks like it isn't working,
>>>> either.  This was tested on 20150805.
>>> 
>>> Are you sure about this? Can you give an example where the original 
>>> fails?
>>> 
>>> local function register(tag,target,what)
>>> print(">>",tag,target,what)
>>>     local data = figures_formats[target] -- resolver etc
>>> 
>>> can be uses for testing
>>> 
>>> Hans
>>> 
>>> -----------------------------------------------------------------
>>>                                           Hans Hagen | PRAGMA ADE
>>>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>>>     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
>>>                                              | www.pragma-pod.nl
>>> -----------------------------------------------------------------
>>> _______________________________________________
>>> dev-context mailing list
>>> dev-context at ntg.nl
>>> http://www.ntg.nl/mailman/listinfo/dev-context
>> 
>> I copied the sample cow.pdf into the local directory as cow_brl.brl, 
>> and saved the below as test.tex.  The resulting pdf is attached. 
>> With my patch the graphic is included.
>>
>>    \definegraphictypesynonym[brl][pdf]
>>    \starttext
>>    \externalfigure[cow_brl]
>>    \stoptext
>
> we need to swap target in the reghister function: M
>
> local function register(tag,what,target)
>
> function figures.registersuffix (suffix, target) 
> register('list',suffix,target) end
> function figures.registerpattern(pattern,target) 
> register('pattern',pattern,target) end
>
> then the implementers are ok
>
> Hans
>
> -----------------------------------------------------------------
>                                          Hans Hagen | PRAGMA ADE
>              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>    tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
>                                             | www.pragma-pod.nl
> -----------------------------------------------------------------

Yes, that takes care of the problem as well.  Thanks.

Best regards,
Brian

From schuster.wolfgang at gmail.com  Sat Aug 15 19:03:01 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 15 Aug 2015 19:03:01 +0200
Subject: [dev-context] attr-eff.mkiv
Message-ID: <55CF70C5.9070103@gmail.com>

Hi,

\appendtoks
     \edef\p_method{\effectparameter\c!method}%
-   \ifx\p_method\v!method
+   \ifx\p_method\v!command
         \setuxvalue{\e!start\currenteffect}{\starteffect[#1]}%
         \setuxvalue{\e!stop \currenteffect}{\stopeffect}%
     \fi
\to \everydefineeffect

Wolfgang

From schuster.wolfgang at gmail.com  Wed Aug 26 11:47:47 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 26 Aug 2015 11:47:47 +0200
Subject: [dev-context] core-con.mkiv: \doifelseconversionnumber
Message-ID: <55DD8B43.2070905@gmail.com>

Hi,

the command \doifelseconversionnumber doesnât work with MkIV.


%%%% begin example
\starttext

\defineconversion[ctx][c,o,n,t,e,x,t]

ctx: 
\doloop{\doifelseconversionnumber{ctx}{\recurselevel}{[\recurselevel]}{\exitloop}}

\stoptext
%%%% end example

Wolfgang

From schuster.wolfgang at gmail.com  Sun Aug 30 22:30:29 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 30 Aug 2015 22:30:29 +0200
Subject: [dev-context] core-env.mkvi
Message-ID: <55E367E5.9080506@gmail.com>

Hi,

the two commands \setupwithargument and \fastsetupwithargument (same 
thing with the \...swapped commands) take their arguments in different 
order, i.e. we have

\setupwithargument{<IDENTIFIER>}{<CONTENT>}

and

\fastsetupwithargument{<CONTENT>}{<IDENTIFIER>}


Canât the \fastsetupwithargument command take its arguments in the same 
order (I think this is easier to change because the command isnât used 
in the source) as the \setupwithargument command.

Wolfgang

From schuster.wolfgang at gmail.com  Sun Aug 30 22:34:46 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 30 Aug 2015 22:34:46 +0200
Subject: [dev-context] font-fea.mkvi
Message-ID: <55E368E6.8070605@gmail.com>

Hi,

there is a mix of named and numbered parameters (which just looks odd) 
in the defintion of the following two command.

\unexpanded\def\font_feature_yes[#method]{\csname\??featureyes\ifcsname\??featureyes#1\endcsname#1\else\s!unknown\fi\endcsname}
\unexpanded\def\font_feature_nop  
#method{\csname\??featurenop\ifcsname\??featurenop#1\endcsname#1\else\s!unknown\fi\endcsname}

Wolfgang

From pragma at wxs.nl  Sun Aug 30 22:46:18 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 30 Aug 2015 22:46:18 +0200
Subject: [dev-context] core-env.mkvi
In-Reply-To: <55E367E5.9080506@gmail.com>
References: <55E367E5.9080506@gmail.com>
Message-ID: <55E36B9A.9010109@wxs.nl>

On 8/30/2015 10:30 PM, Wolfgang Schuster wrote:
> Hi,
>
> the two commands \setupwithargument and \fastsetupwithargument (same
> thing with the \...swapped commands) take their arguments in different
> order, i.e. we have
>
> \setupwithargument{<IDENTIFIER>}{<CONTENT>}
>
> and
>
> \fastsetupwithargument{<CONTENT>}{<IDENTIFIER>}
>
>
> Canât the \fastsetupwithargument command take its arguments in the same
> order (I think this is easier to change because the command isnât used
> in the source) as the \setupwithargument command.
ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Fri Sep  4 23:52:50 2015
From: adityam at umich.edu (Aditya Mahajan)
Date: Fri, 4 Sep 2015 17:52:50 -0400 (EDT)
Subject: [dev-context] Typo in page-set.mkiv
Message-ID: <alpine.LNX.2.03.1509041751240.7186@hzvpu.rqh>

In the definition:

\def\page_set_setup[#1][#2][#3]%
   {\ifthirdargument
      \unexpanded\def\page_set_setup_step##1%
        {\doifelse{##1}\v!each
           {\dorecurse{\namedcolumnsetparameter{#1}\c!n}{\page_set_setup_step\recurselevel}}
           {\normalexpanded{\page_set_setup_saved[#1:\recurselevel]}[#3]}}%
      \processcommalist[#2]\page_set_setup_step
    \else
      \page_set_setup_saved[#1][#2]%
    \fi}


#1:\recurselevel should be replaced by #1:##1


Aditya

From pragma at wxs.nl  Sat Sep  5 14:39:24 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 5 Sep 2015 14:39:24 +0200
Subject: [dev-context] Typo in page-set.mkiv
In-Reply-To: <alpine.LNX.2.03.1509041751240.7186@hzvpu.rqh>
References: <alpine.LNX.2.03.1509041751240.7186@hzvpu.rqh>
Message-ID: <55EAE27C.5030802@wxs.nl>

On 9/4/2015 11:52 PM, Aditya Mahajan wrote:
> In the definition:
>
> \def\page_set_setup[#1][#2][#3]%
>    {\ifthirdargument
>       \unexpanded\def\page_set_setup_step##1%
>         {\doifelse{##1}\v!each
>
> {\dorecurse{\namedcolumnsetparameter{#1}\c!n}{\page_set_setup_step\recurselevel}}
>
>            {\normalexpanded{\page_set_setup_saved[#1:\recurselevel]}[#3]}}%
>       \processcommalist[#2]\page_set_setup_step
>     \else
>       \page_set_setup_saved[#1][#2]%
>     \fi}
>
>
> #1:\recurselevel should be replaced by #1:##1

ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon Sep  7 19:17:57 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 07 Sep 2015 19:17:57 +0200
Subject: [dev-context] lang-hyp.mkiv
Message-ID: <55EDC6C5.9050907@gmail.com>

Hi,

\unexpanded\def\atleastoneword#1%
   {\begingroup
-  \starthyphenation[\c!method=traditional]% this might become default 
or a faster switch
+  \starthyphenation[traditional]% this might become default or a faster 
switch
    \sethyphenationfeatures[words]%
    #1\par
-  \stopthyphenation
+  \stophyphenation
    \endgroup}

Wolfgang

From schuster.wolfgang at gmail.com  Tue Sep  8 17:40:38 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 08 Sep 2015 17:40:38 +0200
Subject: [dev-context] Font key for \language
Message-ID: <55EF0176.3010403@gmail.com>

Hi Hans,

the processing of the font key for \language doesnât work because 
\feature takes the value as an unknown argument.

\appendtoks
\edef\p_language_font{\languageparameter\s!font}%
\ifx\p_language_font\v!auto
- \feature\currentlanguage
+ \doaddfeature\currentlanguage
\fi
\to \everylanguage

Wolfgang

From pragma at wxs.nl  Tue Sep  8 18:28:56 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 8 Sep 2015 18:28:56 +0200
Subject: [dev-context] Font key for \language
In-Reply-To: <55EF0176.3010403@gmail.com>
References: <55EF0176.3010403@gmail.com>
Message-ID: <55EF0CC8.4090807@wxs.nl>

On 9/8/2015 5:40 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> the processing of the font key for \language doesnât work because
> \feature takes the value as an unknown argument.
>
> \appendtoks
> \edef\p_language_font{\languageparameter\s!font}%
> \ifx\p_language_font\v!auto
> - \feature\currentlanguage
> + \doaddfeature\currentlanguage
> \fi
> \to \everylanguage

ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Wed Sep  9 19:08:16 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 09 Sep 2015 19:08:16 +0200
Subject: [dev-context] lang-lab.mkiv: \commalistsentence
Message-ID: <55F06780.6040605@gmail.com>

Hi Hans,

the \commalistsentence doesnât use the default language dependant 
separator because
the Lua function expects âseparator" and âlast" as variable names but 
you pass them
from TeX with the variables "first" and "second".


\def\typo_helpers_concat_comma_list[#1][#2]%
{\clf_concatcommalist
text {#1}%
separators {#2}%
first {\detokenize\expandafter{\normalexpanded{\labeltext{and-1}}}}%
second {\detokenize\expandafter{\normalexpanded{\labeltext{and-2}}}}%
\relax}

Wolfgang

From pragma at wxs.nl  Wed Sep  9 19:21:45 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 9 Sep 2015 19:21:45 +0200
Subject: [dev-context] lang-lab.mkiv: \commalistsentence
In-Reply-To: <55F06780.6040605@gmail.com>
References: <55F06780.6040605@gmail.com>
Message-ID: <55F06AA9.5050001@wxs.nl>

On 9/9/2015 7:08 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \commalistsentence doesnât use the default language dependant
> separator because
> the Lua function expects âseparator" and âlast" as variable names but
> you pass them
> from TeX with the variables "first" and "second".
>
>
> \def\typo_helpers_concat_comma_list[#1][#2]%
> {\clf_concatcommalist
> text {#1}%
> separators {#2}%
> first {\detokenize\expandafter{\normalexpanded{\labeltext{and-1}}}}%
> second {\detokenize\expandafter{\normalexpanded{\labeltext{and-2}}}}%
> \relax}

i'll fix it

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun Sep 13 12:09:54 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Sep 2015 12:09:54 +0200
Subject: [dev-context] lxml-ini.lua: \clf_xmlafterdocumentsetup
Message-ID: <55F54B72.1090101@gmail.com>

Hi,

the command \clf_xmlafterdocumentsetup takes three arguments and not two.

-implement { name = "xmlafterdocumentsetup",   actions = 
lxml.installsetup,      arguments = { 4, "string", "string" } }
+implement { name = "xmlafterdocumentsetup",   actions = 
lxml.installsetup,      arguments = { 4, "string", "string", "string" } }

Wolfgang

From schuster.wolfgang at gmail.com  Mon Sep 14 16:15:33 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 16:15:33 +0200
Subject: [dev-context] math-arr.mkiv: \singlebond
Message-ID: <55F6D685.9080009@gmail.com>

Hi,

the \singlebond (as well as the \doublebond and \triplebond) command 
doesnât produce a symbol when you put a number after it.

\starttext

$ l\singlebond r $\crlf
$ 1\singlebond 2 $\crlf
%$ 1\doublebond 2 $\crlf
%$ 1\triplebond 2 $

\stoptext

Wolfgang

From schuster.wolfgang at gmail.com  Mon Sep 14 16:21:24 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 16:21:24 +0200
Subject: [dev-context] math-def.mkiv
Message-ID: <55F6D7E4.6010901@gmail.com>

Hi,

the mathcommand defintion in line 151 misses a "colon" in its name.

\definemathcommand [approxcoloncolon] [rel] {\approx\coloncolon\colonsep}
-\definemathcommand [colonsim]         [rel] {\coloncolon\colonsep\sim}
+\definemathcommand [coloncolonsim]         [rel] {\coloncolon\colonsep\sim}
\definemathcommand [simcoloncolon]    [rel] {\sim\coloncolon\colonsep}

Wolfgang

From schuster.wolfgang at gmail.com  Mon Sep 14 16:25:21 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 16:25:21 +0200
Subject: [dev-context] font-ini.mkvi: \bodyfontenvironmentlist
Message-ID: <55F6D8D1.6060903@gmail.com>

Hi,

the allocation of the token list \bodyfontenvironmentlist on line 1192

     \newtoks\bodyfontenvironmentlist

can be removed because the command is redefined a few lines below.

Wolfgang


From alan.braslau at cea.fr  Mon Sep 14 16:37:44 2015
From: alan.braslau at cea.fr (Alan BRASLAU)
Date: Mon, 14 Sep 2015 16:37:44 +0200
Subject: [dev-context] math-arr.mkiv: \singlebond
In-Reply-To: <55F6D685.9080009@gmail.com>
References: <55F6D685.9080009@gmail.com>
Message-ID: <20150914163744.145d2cb3@iram-hb-003386.extra.cea.fr>

On Mon, 14 Sep 2015 16:15:33 +0200
Wolfgang Schuster <schuster.wolfgang at gmail.com> wrote:

> Hi,
> 
> the \singlebond (as well as the \doublebond and \triplebond) command 
> doesnât produce a symbol when you put a number after it.
> 
> \starttext
> 
> $ l\singlebond r $\crlf
> $ 1\singlebond 2 $\crlf
> %$ 1\doublebond 2 $\crlf
> %$ 1\triplebond 2 $
> 
> \stoptext
> 
> Wolfgang

I am not familiar with $\singlebond$ etc.


In ConTeXt, one can also use a different mechanism (chem-str.mkiv):

\chemical{1,SINGLE,2,DOUBLE,3,TRIPLE,4}

Looking at the result of the above, I find that the spacing of DOUBLE
should be modified (to .25ex rather than .5ex), a question of
aesthetics?

Compare this with a third mechanism (mp-chem.mpiv, drawing a chemical
structure rather than writing an inline chemical formula):

\startchemical
  \chemical[ONE,Z0,SB1,Z1,MOV1,Z1,DB1,MOV1,Z1,TB1,MOV1,Z1] [1,2,3,4]
\stopchemical

Ignore that the horizontal spacing is different, too, for the structure
ONE.

Alan

From schuster.wolfgang at gmail.com  Mon Sep 14 16:59:38 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 16:59:38 +0200
Subject: [dev-context] math-stc.mkvi: \singlebond (was: math-arr.mkiv:
	\singlebond)
Message-ID: <55F6E0DA.9040105@gmail.com>

> Alan BRASLAU <mailto:alan.braslau at cea.fr>
> 14. September 2015 16:37
> On Mon, 14 Sep 2015 16:15:33 +0200
>
> I am not familiar with $\singlebond$ etc.
>
>
> In ConTeXt, one can also use a different mechanism (chem-str.mkiv):
>
> \chemical{1,SINGLE,2,DOUBLE,3,TRIPLE,4}
>
> Looking at the result of the above, I find that the spacing of DOUBLE
> should be modified (to .25ex rather than .5ex), a question of
> aesthetics?
>
> Compare this with a third mechanism (mp-chem.mpiv, drawing a chemical
> structure rather than writing an inline chemical formula):
>
> \startchemical
> \chemical[ONE,Z0,SB1,Z1,MOV1,Z1,DB1,MOV1,Z1,TB1,MOV1,Z1] [1,2,3,4]
> \stopchemical
>
> Ignore that the horizontal spacing is different, too, for the 
> structure ONE.
I have no need for the commands, I was only surprised why this happened 
because
it made no sense when you look at the definition of \singlebond in 
math-arr.mkiv.

What I noticed now that Hans redefines the command later in 
math-stc.mkvi where
a number delimiter is missing. When you stop TeXâs number scanner with a 
\relax
you get the right output even with a number after \singlebond.

-\unexpanded\edef\singlebond{\mathematics{\mathsurround\zeropoint\char\number"002D}}
-\unexpanded\edef\doublebond{\mathematics{\mathsurround\zeropoint\char\number"003D}}
-\unexpanded\edef\triplebond{\mathematics{\mathsurround\zeropoint\char\number"2261}}
+\unexpanded\edef\singlebond{\mathematics{\mathsurround\zeropoint\char\number"002D\relax}}
+\unexpanded\edef\doublebond{\mathematics{\mathsurround\zeropoint\char\number"003D\relax}}
+\unexpanded\edef\triplebond{\mathematics{\mathsurround\zeropoint\char\number"2261\relax}}

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150914/ec2dfa36/attachment.html>

From wolfgang.schuster at gmail.com  Mon Sep 14 18:41:34 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 18:41:34 +0200
Subject: [dev-context] math-fen.mkvi: \fenced
Message-ID: <55F6F8BE.7000603@gmail.com>

Hi,

the \fenced command doesnât decrement the nesting counter at the end.

\unexpanded\def\math_fenced_fenced[#1]#2%
{\math_fenced_fenced_start{#1}%
#2%
\math_fenced_right
\stopusemathstyleparameter
- \endgroup}
+ \endgroup
+ \advance\c_math_fenced_nesting\minusone}

Wolfgang

From schuster.wolfgang at gmail.com  Mon Sep 14 23:56:07 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 14 Sep 2015 23:56:07 +0200
Subject: [dev-context] math-fen.mkvi
Message-ID: <55F74277.8040900@gmail.com>

Hi Hans,

is it intended that you used the same names for \left and \right in the 
defintions below?

\installmathfencepair \ulcorner   \Luppercorner \ulcorner   \Ruppercorner
\installmathfencepair \llcorner   \Llowercorner \llcorner   \Rlowercorner
\installmathfencepair \lmoustache \Lmoustache   \lmoustache \Rmoustache
\installmathfencepair \llbracket  \Lopenbracket \llbracket  \Ropenbracket
\installmathfencepair \lgroup     \Lgroup       \lgroup     \Rgroup

Wolfgang

From schuster.wolfgang at gmail.com  Tue Sep 15 13:23:04 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 15 Sep 2015 13:23:04 +0200
Subject: [dev-context] math-fen.mkiv: \lfence, \rfence and \mfence
Message-ID: <55F7FF98.9040602@gmail.com>

Hi,

when you pass a undefined argument to \lfence (or \rfence and \mfence) 
you get the "unknown" alternative

     \setvalue{\??mathleft 
\s!unknown}{\setfalse\c_math_fenced_done\ifconditional\c_math_fenced_unknown\normalleft 
\nexttoken\fi}

which doesnât work here because \nexttoken is never set by \lfence but 
only by \left.

Wolfgang

From schuster.wolfgang at gmail.com  Tue Sep 15 15:01:10 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 15 Sep 2015 15:01:10 +0200
Subject: [dev-context] XML Manual
Message-ID: <55F81696.3080106@gmail.com>

Hi Hans,

a few commands in the XML Manual [1] donât match with their definitions 
in lxml-ini.mkiv.


The commands

- xmlremovedocumentsetup (page 20)
- xmlflushdocumentsetups (page 20)

take two arguments instead of the document single argument.



The command

\xmlregistereddocumentsetups (page 16 and 20)

takes two arguments as well but the document specifies none.



The commands

- \xmldoifelseselfempty (page 21)
- \xmlremapnamespace (page 21)

take only three argument and not four.



The commands

- \xmlinlineverbatim (page 17)
- \xmldisplayverbatim (page 17)
- \xmldirectives (page 19)
- \xmldirectivesbefore (page 19)
- \xmldirectivesafter (page 19)
- \xmllast (page 16)

take only a single argument and not two.



The commands

- \xmltags (page 17)
- \xmlnofelements (page 17)
- \xmlcontextdirective (page 19)

donât exist but are mentioned in the manual.



The arguments for the \xmlsetup command on page 19 are shown in the 
wrong order because itâs \xmlsetup{node}{name}.



[1] http://pragma-ade.com/general/manuals/xml-mkiv.pdf

Wolfgang

From schuster.wolfgang at gmail.com  Thu Sep 17 00:49:12 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 17 Sep 2015 00:49:12 +0200
Subject: [dev-context] math-stc.mkvi: moffset key
Message-ID: <55F9F1E8.1090303@gmail.com>

Hi Hans,

what is the purpose of the moffset key for \setupmathstackers?


There is a definition where you assign a dimension to the key

\definemathstackers [\v!wide] [\c!moffset=\thickmuskip,\c!mathclass=\s!rel]

but this makes no sense as can be seen in the code below because it 
isnât used.


\unexpanded\def\math_stackers_unstacked_normal#category#codepoint%
{\begingroup
\edef\currentmathstackers{#category}%
\edef\p_moffset{\mathstackersparameter\c!moffset}%
\ifx\p_moffset\empty \else
\mskip\scratchmuskip
\fi
\ifmmode\math_class_by_parameter\mathstackersparameter\else\dontleavehmode\fi
{\usemathstackerscolorparameter\c!color
\Umathchar\zerocount\defaultmathfamily#codepoint}%
\ifx\p_moffset\empty \else
\mskip\scratchmuskip
\fi
\endgroup}


Wolfgang

From schuster.wolfgang at gmail.com  Thu Sep 17 12:59:31 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 17 Sep 2015 12:59:31 +0200
Subject: [dev-context] math-stc.mkvi: \mathdouble
Message-ID: <55FA9D13.1070207@gmail.com>

Hi Hans,

the definition for \mathdouble is wrong (I guess you did this because 
itâs not really used) because
it takes only a code point instead of two (the second always takes the 
default value 0):

\unexpanded\def\mathdouble{\begingroup\dodoubleempty\math_stackers_handle_double}

\def\math_stackers_handle_double[#category]%
{\math_stackers_direct_double\plusone\plusone 
{\iffirstargument#category\else\v!bottom\fi}} % will be defined later on

\def\math_stackers_direct_double#top#bottom#category#codepoint#text%
{\math_stackers_make_double#top#bottom{#category}{#codepoint}{0}{#text}%
\endgroup}

Wolfgang

From schuster.wolfgang at gmail.com  Sun Sep 20 22:35:40 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 20 Sep 2015 22:35:40 +0200
Subject: [dev-context] meta-ini.mkiv: \useMPenvironmentbuffer
Message-ID: <55FF189C.3080301@gmail.com>

Hi Hans,

there are two bugs with the \useMPenvironmentbuffer command.


1. The TeX command uses the wrong name to pass the name to Lua:

\unexpanded\def\useMPenvironmentbuffer[#1]%
- {\clf_mpsetfrombuffer{#1}}
+ {\clf_mptexsetfrombuffer{#1}}


2. The Lua function in mlib-ctx.lua uses a non existing function to load 
the buffer content:

function mptex.setfrombuffer(name)
-   environments[#environments+1] = buffers.content(name)
+   environments[#environments+1] = buffers.getcontent(name)
end

Wolfgang

From pragma at wxs.nl  Mon Sep 21 18:49:25 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 21 Sep 2015 18:49:25 +0200
Subject: [dev-context] XML Manual
In-Reply-To: <55F81696.3080106@gmail.com>
References: <55F81696.3080106@gmail.com>
Message-ID: <56003515.6020509@wxs.nl>

On 9/15/2015 3:01 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> a few commands in the XML Manual [1] donât match with their definitions
> in lxml-ini.mkiv.

ok, thanks

btw, i/we really need to update/finish this manual soon

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Sep 23 11:30:51 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Sep 2015 11:30:51 +0200
Subject: [dev-context] live.contextgarden.net
Message-ID: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>

Hi all,

I have re-enabled live.contextgarden.net, with a few changes:

* it now always runs mkiv
* the actual run happens in a chroot environment, for better security

Please try it and see how it works out. 

(context used is the current from May 2015)

Best wishes,
Taco


From luigi.scarso at gmail.com  Wed Sep 23 11:40:10 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 23 Sep 2015 11:40:10 +0200
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
Message-ID: <CAG5iGsCZK+z6cnNr9rMovV3DVVYcOXyBU4OpDzc8pHuYMoMRsQ@mail.gmail.com>

On Wed, Sep 23, 2015 at 11:30 AM, Taco Hoekwater <taco at elvenkind.com> wrote:

> Hi all,
>
> I have re-enabled live.contextgarden.net, with a few changes:
>
> * it now always runs mkiv
> * the actual run happens in a chroot environment, for better security
>
> Please try it and see how it works out.
>
> (context used is the current from May 2015)
>
> Best wishes,
> Taco
>
>
hitting typeset google-chrome alerts about a popup -- which is  about:blank

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150923/4639b2fd/attachment.html>

From taco at elvenkind.com  Wed Sep 23 11:56:17 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Sep 2015 11:56:17 +0200
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <CAG5iGsCZK+z6cnNr9rMovV3DVVYcOXyBU4OpDzc8pHuYMoMRsQ@mail.gmail.com>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
 <CAG5iGsCZK+z6cnNr9rMovV3DVVYcOXyBU4OpDzc8pHuYMoMRsQ@mail.gmail.com>
Message-ID: <40AF86AD-E9A2-4D3E-84BA-693927A4847C@elvenkind.com>


> On 23 Sep 2015, at 11:40, luigi scarso <luigi.scarso at gmail.com> wrote:
> 
> hitting typeset google-chrome alerts about a popup -- which is  about:blank


That would be the window that will eventually display the output log, I assume.

The index.php (and in fact almost all of the other scripting) is still Patrickâs code.

There is still plenty to improve on, I just added the chroot() stuff to make it safe(r) to use luatex.

Best wishes,
Taco



From taco at elvenkind.com  Wed Sep 23 14:48:41 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Sep 2015 14:48:41 +0200
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
Message-ID: <93A8E853-2551-45B4-BB36-4F72E116F6A6@elvenkind.com>


> On 23 Sep 2015, at 11:30, Taco Hoekwater <taco at elvenkind.com> wrote:
> 
> Hi all,
> 
> I have re-enabled live.contextgarden.net, with a few changes:
> 
> * it now always runs mkiv
> * the actual run happens in a chroot environment, for better security

I also changed the wiki <context> extension so that it now uses the scripts
from âliveâ to do typesetting. I also changed it to use âmkivâ as default,
but mode=âmkiiâ works too.


Best wishes,
Taco


> Please try it and see how it works out. 

From adityam at umich.edu  Wed Sep 23 17:45:09 2015
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 Sep 2015 11:45:09 -0400 (EDT)
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <93A8E853-2551-45B4-BB36-4F72E116F6A6@elvenkind.com>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
 <93A8E853-2551-45B4-BB36-4F72E116F6A6@elvenkind.com>
Message-ID: <alpine.LNX.2.03.1509231143180.26418@hzvpu.rqh>

On Wed, 23 Sep 2015, Taco Hoekwater wrote:

>
>> On 23 Sep 2015, at 11:30, Taco Hoekwater <taco at elvenkind.com> wrote:
>> 
>> Hi all,
>> 
>> I have re-enabled live.contextgarden.net, with a few changes:
>> 
>> * it now always runs mkiv
>> * the actual run happens in a chroot environment, for better security
>
> I also changed the wiki <context> extension so that it now uses the scripts
> from âliveâ to do typesetting. I also changed it to use âmkivâ as default,
> but mode=âmkiiâ works too.

Thanks a lot for these! Having an recent version  that runs on the wiki 
definitely makes it easier to generate examples.

I am in favor of changing the default to mkiv, but it does mean that some 
of the mkii only examples might no longer compile and we will need to 
manually add "mode=mkii" to them.

Aditya

From schuster.wolfgang at gmail.com  Wed Sep 23 17:58:02 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 23 Sep 2015 17:58:02 +0200
Subject: [dev-context] pack-box.mkiv: \placelayeredtext
Message-ID: <5602CC0A.2020001@gmail.com>

Hi Hans,

you have to add a parent check to the \placelayeredtext command.

\unexpanded\def\placelayeredtext[#1]%
   {\bgroup
    \edef\currentlayeredtext{#1}%
-  \checklayeredtextparent
    \dodoubleempty\pack_layeredtexts_place}

Wolfgang

From taco at elvenkind.com  Wed Sep 23 18:36:12 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 23 Sep 2015 18:36:12 +0200
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <alpine.LNX.2.03.1509231143180.26418@hzvpu.rqh>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
 <93A8E853-2551-45B4-BB36-4F72E116F6A6@elvenkind.com>
 <alpine.LNX.2.03.1509231143180.26418@hzvpu.rqh>
Message-ID: <3D3E9B66-1A2C-4298-B1D9-D537CD772748@elvenkind.com>

Hi,

> On 23 Sep 2015, at 17:45, Aditya Mahajan <adityam at umich.edu> wrote:
> 
> I am in favor of changing the default to mkiv, but it does mean that some of the mkii only examples might no longer compile and we will need to manually add "mode=mkii" to them.

Yes. But then, at the meeting we decided that the wiki should be mkiv, with mkii only mentioned as a footnote (where applicable) so most pages need to be edited anyway. 

Best wishes,
Taco

From adityam at umich.edu  Wed Sep 23 18:54:36 2015
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 Sep 2015 12:54:36 -0400 (EDT)
Subject: [dev-context] live.contextgarden.net
In-Reply-To: <3D3E9B66-1A2C-4298-B1D9-D537CD772748@elvenkind.com>
References: <C7E1C00B-74F4-4402-AFF4-D10F983D1F84@elvenkind.com>
 <93A8E853-2551-45B4-BB36-4F72E116F6A6@elvenkind.com>
 <alpine.LNX.2.03.1509231143180.26418@hzvpu.rqh>
 <3D3E9B66-1A2C-4298-B1D9-D537CD772748@elvenkind.com>
Message-ID: <alpine.LNX.2.03.1509231253452.26418@hzvpu.rqh>

On Wed, 23 Sep 2015, Taco Hoekwater wrote:

>> On 23 Sep 2015, at 17:45, Aditya Mahajan <adityam at umich.edu> wrote:
>>
>> I am in favor of changing the default to mkiv, but it does mean that some of the mkii only examples might no longer compile and we will need to manually add "mode=mkii" to them.
>
> Yes. But then, at the meeting we decided that the wiki should be mkiv, 
> with mkii only mentioned as a footnote (where applicable) so most pages 
> need to be edited anyway.

I agree.

Aditya

From pragma at wxs.nl  Wed Sep 23 22:48:40 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 23 Sep 2015 22:48:40 +0200
Subject: [dev-context] pack-box.mkiv: \placelayeredtext
In-Reply-To: <5602CC0A.2020001@gmail.com>
References: <5602CC0A.2020001@gmail.com>
Message-ID: <56031028.8020705@wxs.nl>

On 9/23/2015 5:58 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> you have to add a parent check to the \placelayeredtext command.
>
> \unexpanded\def\placelayeredtext[#1]%
>    {\bgroup
>     \edef\currentlayeredtext{#1}%
> -  \checklayeredtextparent
>     \dodoubleempty\pack_layeredtexts_place}

ok, but no beta yet (in the middle of things)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Sep 24 13:19:43 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 24 Sep 2015 13:19:43 +0200
Subject: [dev-context] pdf bookmarks remarks
Message-ID: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>

Hi,

I was writing up my pdf bookmarks article. Two remarks:


1. (for Hans)

  âWith a long heading in a huge font, you might want to add linebreaks by hand. No problem, just use \\. The bookmark code ignores \\, so the bookmark itself won't have a linebreak.â 

That is not actually true at the moment. Somehow the \\ got converted into a single \, instead of an empty space.

Adding 

 \appendtoks
     \let\\\space
 \to \simplifiedcommands

fixed it, but it would be nice if that was corrected inside ConTeXtâ¦


2. While at it, I also updated the wiki page 

  http://wiki.contextgarden.net/PDF_Bookmarks_and_Headers

not much to do, since not much has changed. However, I did add a wiki template for âmkiiâ (a bit ugly) and split off all mkii remarks into that template. Please have a look. It would be really nice if someone could improve on the template visuals a bit.

Best wishes,
Taco


From pragma at wxs.nl  Tue Sep 29 10:22:01 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 29 Sep 2015 10:22:01 +0200
Subject: [dev-context] pdf bookmarks remarks
In-Reply-To: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
References: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
Message-ID: <560A4A29.1050203@wxs.nl>

On 9/24/2015 1:19 PM, Taco Hoekwater wrote:
> Hi,
>
> I was writing up my pdf bookmarks article. Two remarks:
>
>
> 1. (for Hans)
>
>    âWith a long heading in a huge font, you might want to add linebreaks by hand. No problem, just use \\. The bookmark code ignores \\, so the bookmark itself won't have a linebreak.â
>
> That is not actually true at the moment. Somehow the \\ got converted into a single \, instead of an empty space.
>
> Adding
>
>   \appendtoks
>       \let\\\space
>   \to \simplifiedcommands
>
> fixed it, but it would be nice if that was corrected inside ConTeXtâ¦

i've added in typo-wrp.mkiv:

\appendtoks
     \let\spac_crlf\space
\to \everysimplifycommands

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Sep 30 09:44:10 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 30 Sep 2015 09:44:10 +0200
Subject: [dev-context] pdf bookmarks remarks
In-Reply-To: <560A4A29.1050203@wxs.nl>
References: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
 <560A4A29.1050203@wxs.nl>
Message-ID: <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>


> On 29 Sep 2015, at 10:22, Hans Hagen <pragma at wxs.nl> wrote:
> 
> On 9/24/2015 1:19 PM, Taco Hoekwater wrote:
>> Hi,
>> 
>> I was writing up my pdf bookmarks article. Two remarks:
>> 
>> 
>> 1. (for Hans)
>> 
>>   âWith a long heading in a huge font, you might want to add linebreaks by hand. No problem, just use \\. The bookmark code ignores \\, so the bookmark itself won't have a linebreak.â
>> 
>> That is not actually true at the moment. Somehow the \\ got converted into a single \, instead of an empty space.
>> 
>> Adding
>> 
>>  \appendtoks
>>      \let\\\space
>>  \to \simplifiedcommands
>> 
>> fixed it, but it would be nice if that was corrected inside ConTeXtâ¦
> 
> i've added in typo-wrp.mkiv:
> 
> \appendtoks
>    \let\spac_crlf\space
> \to \everysimplifycommands

Dat zit nog niet in de laatste beta he? (als wel, dan werkt het niet)

Groetjes,
Taco



From taco at elvenkind.com  Wed Sep 30 09:47:21 2015
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 30 Sep 2015 09:47:21 +0200
Subject: [dev-context] pdf bookmarks remarks
In-Reply-To: <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>
References: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
 <560A4A29.1050203@wxs.nl>
 <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>
Message-ID: <DD374B69-8680-4DC9-9F0A-101801865818@elvenkind.com>


> On 30 Sep 2015, at 09:44, Taco Hoekwater <taco at elvenkind.com> wrote:
> 
> Dat zit nog niet in de laatste beta he? (als wel, dan werkt het niet)
> 

Sorry about the Dutch, I was just asking Hans whether his patch was distributed already.

Best wishes,
Taco



From luigi.scarso at gmail.com  Wed Sep 30 09:47:42 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 30 Sep 2015 09:47:42 +0200
Subject: [dev-context] pdf bookmarks remarks
In-Reply-To: <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>
References: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
 <560A4A29.1050203@wxs.nl>
 <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>
Message-ID: <CAG5iGsCFkyKzz_n73ofi3+W-MHXTO6UdrLnowRAhW_6yJJfdug@mail.gmail.com>

On Wed, Sep 30, 2015 at 9:44 AM, Taco Hoekwater <taco at elvenkind.com> wrote:

>
> > On 29 Sep 2015, at 10:22, Hans Hagen <pragma at wxs.nl> wrote:
> >
> > On 9/24/2015 1:19 PM, Taco Hoekwater wrote:
> >> Hi,
> >>
> >> I was writing up my pdf bookmarks article. Two remarks:
> >>
> >>
> >> 1. (for Hans)
> >>
> >>   âWith a long heading in a huge font, you might want to add linebreaks
> by hand. No problem, just use \\. The bookmark code ignores \\, so the
> bookmark itself won't have a linebreak.â
> >>
> >> That is not actually true at the moment. Somehow the \\ got converted
> into a single \, instead of an empty space.
> >>
> >> Adding
> >>
> >>  \appendtoks
> >>      \let\\\space
> >>  \to \simplifiedcommands
> >>
> >> fixed it, but it would be nice if that was corrected inside ConTeXtâ¦
> >
> > i've added in typo-wrp.mkiv:
> >
> > \appendtoks
> >    \let\spac_crlf\space
> > \to \everysimplifycommands
>
> Dat zit nog niet in de laatste beta he? (als wel, dan werkt het niet)
>
> Groetjes,
> Taco
>
>
>
maybe on the ftp site ?


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20150930/93fb184f/attachment.html>

From pragma at wxs.nl  Wed Sep 30 09:58:00 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 30 Sep 2015 09:58:00 +0200
Subject: [dev-context] pdf bookmarks remarks
In-Reply-To: <CAG5iGsCFkyKzz_n73ofi3+W-MHXTO6UdrLnowRAhW_6yJJfdug@mail.gmail.com>
References: <599BEDB2-7302-4AAE-8361-BDB973EB50FE@elvenkind.com>
 <560A4A29.1050203@wxs.nl>
 <37C00AB2-E0E5-4732-98CD-F703BC214235@elvenkind.com>
 <CAG5iGsCFkyKzz_n73ofi3+W-MHXTO6UdrLnowRAhW_6yJJfdug@mail.gmail.com>
Message-ID: <560B9608.6030107@wxs.nl>

On 9/30/2015 9:47 AM, luigi scarso wrote:
>
>
> On Wed, Sep 30, 2015 at 9:44 AM, Taco Hoekwater <taco at elvenkind.com
> <mailto:taco at elvenkind.com>> wrote:
>
>
>     > On 29 Sep 2015, at 10:22, Hans Hagen <pragma at wxs.nl <mailto:pragma at wxs.nl>> wrote:
>     >
>     > On 9/24/2015 1:19 PM, Taco Hoekwater wrote:
>     >> Hi,
>     >>
>     >> I was writing up my pdf bookmarks article. Two remarks:
>     >>
>     >>
>     >> 1. (for Hans)
>     >>
>     >>   âWith a long heading in a huge font, you might want to add linebreaks by hand. No problem, just use \\. The bookmark code ignores \\, so the bookmark itself won't have a linebreak.â
>     >>
>     >> That is not actually true at the moment. Somehow the \\ got converted into a single \, instead of an empty space.
>     >>
>     >> Adding
>     >>
>     >>  \appendtoks
>     >>      \let\\\space
>     >>  \to \simplifiedcommands
>     >>
>     >> fixed it, but it would be nice if that was corrected inside ConTeXtâ¦
>     >
>     > i've added in typo-wrp.mkiv:
>     >
>     > \appendtoks
>     >    \let\spac_crlf\space
>     > \to \everysimplifycommands
>
>     Dat zit nog niet in de laatste beta he? (als wel, dan werkt het niet)

no beta yet

(i'm going over the luatex manual now, splitting it up, formatting all, 
checking with recent changes, etc)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Wed Sep 30 17:30:29 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 30 Sep 2015 17:30:29 +0200
Subject: [dev-context] pack-rul.mkiv: \fastlocalframed
Message-ID: <560C0015.3040903@gmail.com>

Hi,

\unexpanded\def\fastlocalframed[#1]#2[#3]#4% 3-4
   {\bgroup
    \edef\currentframed{#1}%
    \pack_framed_initialize
    \setbox\b_framed_normal\hbox{#4}%
    \edef\p_framed_region{\framedparameter\c!region}%
    \ifx\p_framed_region\v!yes % maybe later named
      \pack_framed_add_region
    \fi
-  \getparameters[\currentframed][#3]% no \expanded !
+  \setupcurrentframed[#3]%
    \edef\p_framed_rulethickness{\framedparameter\c!rulethickness}% also 
used in backgrounds
    \d_framed_frameoffset\framedparameter\c!frameoffset\relax     % also 
used in backgrounds
    \edef\p_framed_frame{\framedparameter\c!frame}%
    \edef\p_framed_background{\framedparameter\c!background}%
    % not here, in calling macro: setups
    \pack_framed_remove_depth
    \ifx\p_framed_frame\v!overlay \else \ifx\p_framed_frame\v!none \else
      \ifx\p_framed_rulethickness\empty\else
         \d_framed_linewidth\p_framed_rulethickness\relax
      \fi
      \pack_framed_add_outline % real or invisible frame
    \fi\fi
    \ifx\p_framed_background\empty \else
      \edef\p_framed_backgroundoffset{\framedparameter\c!backgroundoffset}%
      \d_framed_backgroundoffset
        \ifx\p_framed_backgroundoffset\v!frame
          \d_framed_frameoffset
        \else
          \p_framed_backgroundoffset
        \fi
      \edef\p_framed_component{\framedparameter\c!component}%
      \pack_framed_add_background
    \fi
    \pack_framed_restore_depth
    \box\b_framed_normal
    \egroup}

Wolfgang

From luigi.scarso at gmail.com  Wed Oct  7 22:12:27 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 7 Oct 2015 22:12:27 +0200
Subject: [dev-context] Luatex 0.81.0 announcement
Message-ID: <CAG5iGsCOkvzX6CN3kEMcsjKQA6+qPRk9jMwyP811ua9Npp97tA@mail.gmail.com>

New luatex release, 0.81.0

Hans already explained the changes on primitives;
I only add
* new epdf.openMemStream(s,l,docid)
to create a pdf from a lightuserdata or  string.
(experimental, do not use in production.)

* uniform random generator in mplib is now specific for each numbersystem;

* too_precise implemented for binary number system;

* several bug fixes.



The archives can be downloaded from supelec as usual:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.81.0
<https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.1>

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org



Have fun,
Hans, Taco, Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20151007/82d19dee/attachment.html>

From schuster.wolfgang at gmail.com  Sun Oct 11 16:52:55 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 11 Oct 2015 16:52:55 +0200
Subject: [dev-context] page-imp.mkiv
Message-ID: <561A77C7.4090108@gmail.com>

Hi,

\installpagearrangement 1*2-Conference
    {\dosetuparrangement{1}{2}{4}{3}{2}% X,Y,Total,hcutmarks,vcutmarks
-       \pusharrangedpageCONFERENCE2\poparrangedpagesAB\relax}
+       \pusharrangedpageCONFERENCETWO\poparrangedpagesAB\relax}

-\def\pusharrangedpageCONFERENCE2#1%
+\def\pusharrangedpageCONFERENCETWO#1%
   {\advancearrangedpageN
    \reportarrangedpage\arrangedpageN
    \ifcase\arrangedpageN
    \or \handlearrangedpageXandY{#1}001\arrangedpageA %  1  rot,hskip,vskip
    \or \handlearrangedpageXandY{#1}100\arrangedpageA %  2
        \poparrangedpages
    \fi}

%D Implementation with 4 pages for conference-name-display
%D Coding: [1*4-Conference]

\installpagearrangement 1*4-Conference
    {\dosetuparrangement{1}{2}{4}{3}{2}% X,Y,Total,hcutmarks,vcutmarks
-       \pusharrangedpageCONFERENCE4\poparrangedpagesAB\relax}
+       \pusharrangedpageCONFERENCEFOUR\poparrangedpagesAB\relax}

-\def\pusharrangedpageCONFERENCE4#1%
+\def\pusharrangedpageCONFERENCEFOUR#1%
   {\advancearrangedpageN
    \reportarrangedpage\arrangedpageN
    \ifcase\arrangedpageN
    \or \handlearrangedpageXandY{#1}001\arrangedpageA %  1  rot,hskip,vskip
    \or \handlearrangedpageXandY{#1}100\arrangedpageA %  2
    \or \handlearrangedpageXandY{#1}011\arrangedpageB %  3
    \or \handlearrangedpageXandY{#1}110\arrangedpageB %  4
        \poparrangedpages
    \fi}

Wolfgang

From schuster.wolfgang at gmail.com  Wed Oct 21 18:18:11 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 21 Oct 2015 18:18:11 +0200
Subject: [dev-context] page-lin.mkvi
Message-ID: <5627BAC3.2020406@gmail.com>

Hi,

\def\page_lines_start_zero[#1][#2]%
   {\edef\m_argument{\linenumberingparameter\c!continue}%
-  \ifx\m_argument\v!continue
+  \ifx\m_argument\v!yes
      \c_page_lines_mode\zerocount
    \else
      \c_page_lines_mode\plusone
    \fi
    \page_lines_start_followup}

Wolfgang

From schuster.wolfgang at gmail.com  Thu Oct 22 14:27:11 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 22 Oct 2015 14:27:11 +0200
Subject: [dev-context] strc-mar.mkiv
Message-ID: <5628D61F.4020100@gmail.com>

Hi,

the wrong parameter is passed to the Lua function.


% the fetchers are fully expandable: [name][method]

-\def\fetchonemark[#1]#2[#3]{\ifconditional\inhibitgetmarking\else\clf_fetchonemark 
{#1}{\v!page}{#2}\fi}
+\def\fetchonemark[#1]#2[#3]{\ifconditional\inhibitgetmarking\else\clf_fetchonemark 
{#1}{\v!page}{#3}\fi}
\def\fetchtwomarks     
[#1]{\ifconditional\inhibitgetmarking\else\clf_fetchtwomarks{#1}{\v!page}\fi}
\def\fetchallmarks     
[#1]{\ifconditional\inhibitgetmarking\else\clf_fetchallmarks{#1}{\v!page}\fi}



Wolfgang

From schuster.wolfgang at gmail.com  Sun Nov  1 22:36:31 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 01 Nov 2015 22:36:31 +0100
Subject: [dev-context] page-set.mkiv
Message-ID: <563685DF.1000801@gmail.com>

Hi,

there is a extra 1 after the arguments 3 and 7.

\def\OTRSETstoreincolumnslotindeed#1#2#3#4#5#6#7#8#9%
   {\OTRSETcheckprefered
    \enoughcolumncellsfalse
    \donefalse
-  \dostepwiserecurse{#1}{#2}{#31}
+  \dostepwiserecurse{#1}{#2}{#3}
      {\ifdone
         \exitloop
       \else
         #4=\recurselevel
-       \dostepwiserecurse{#5}{#6}{#71}
+       \dostepwiserecurse{#5}{#6}{#7}
       ...

Wolfgang

From schuster.wolfgang at gmail.com  Tue Nov  3 23:20:40 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 03 Nov 2015 23:20:40 +0100
Subject: [dev-context] page-txt.mkvi
Message-ID: <56393338.30309@gmail.com>

Hi,

-\letvalue{\??layouttextcontent\c!middle:\v!text}\c!middletext
-\letvalue{\??layouttextcontent\c!left  :\v!text}\c!lefttext
-\letvalue{\??layouttextcontent\c!right :\v!text}\c!righttext
+\letvalue{\??layouttextcontent\v!text:\c!middle}\c!middletext
+\letvalue{\??layouttextcontent\v!text:\c!left  }\c!lefttext
+\letvalue{\??layouttextcontent\v!text:\c!right }\c!righttext

Wolfgang

From wolfgang.schuster at gmail.com  Sun Nov  8 17:24:31 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 08 Nov 2015 17:24:31 +0100
Subject: [dev-context] scrn-but.mkvi
Message-ID: <563F773F.3010702@gmail.com>

Hi,

\unexpanded\def\scrn_menu_nop_start#text\stopnop
   {\scrn_menu_action_start
    \letinteractionmenuparameter\c!frame\v!off
    \letinteractionmenuparameter\c!background\empty
-  \letinteractionmenuparameter\v!yes
+  \letinteractionmenuparameter\c!empty\v!yes
    
\inheritedinteractionmenuframed{\ignorespaces#text\removeunwantedspaces}%
    \scrn_menu_action_stop}

Wolfgang

From schuster.wolfgang at gmail.com  Sun Nov  8 21:12:19 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 08 Nov 2015 21:12:19 +0100
Subject: [dev-context] scrn-but.lua
Message-ID: <563FACA3.9070109@gmail.com>

Hi,

there is a misspelled "data" variable.

local function registerbuttons(tag,register,language)
     local data = sorters.definitions[language]
-   local orders = daya and data.orders or 
sorters.definitions.default.orders
+   local orders = data and data.orders or 
sorters.definitions.default.orders
     local tag = tag == "" and { "" } or { tag }
     for i=1,#orders do
         local order = orders[i]
         context.menubutton(tag,f_two_colon(register,order),order)
     end
end

Wolfgang

From adityam at umich.edu  Mon Nov  9 02:53:05 2015
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 8 Nov 2015 20:53:05 -0500 (EST)
Subject: [dev-context] scrn-but.lua
In-Reply-To: <563FACA3.9070109@gmail.com>
References: <563FACA3.9070109@gmail.com>
Message-ID: <alpine.OSX.2.02.1511082052100.26460@nqv-znpobbx>

On Sun, 8 Nov 2015, Wolfgang Schuster wrote:

> Hi,
>
> there is a misspelled "data" variable.
>
> local function registerbuttons(tag,register,language)
>     local data = sorters.definitions[language]
> -   local orders = daya and data.orders or 
> sorters.definitions.default.orders
> +   local orders = data and data.orders or 
> sorters.definitions.default.orders
>     local tag = tag == "" and { "" } or { tag }
>     for i=1,#orders do
>         local order = orders[i]
>         context.menubutton(tag,f_two_colon(register,order),order)
>     end
> end

I am not too familiar with the lua toolchain, but would it be possible to 
run a lua static analyzer (such as luacheck 
https://github.com/mpeterv/luacheck) on the context sources?

Aditya

From pragma at wxs.nl  Mon Nov  9 11:05:21 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 9 Nov 2015 11:05:21 +0100
Subject: [dev-context] scrn-but.lua
In-Reply-To: <alpine.OSX.2.02.1511082052100.26460@nqv-znpobbx>
References: <563FACA3.9070109@gmail.com>
 <alpine.OSX.2.02.1511082052100.26460@nqv-znpobbx>
Message-ID: <56406FE1.3070103@wxs.nl>

On 11/9/2015 2:53 AM, Aditya Mahajan wrote:
> On Sun, 8 Nov 2015, Wolfgang Schuster wrote:
>
>> Hi,
>>
>> there is a misspelled "data" variable.
>>
>> local function registerbuttons(tag,register,language)
>>     local data = sorters.definitions[language]
>> -   local orders = daya and data.orders or
>> sorters.definitions.default.orders
>> +   local orders = data and data.orders or
>> sorters.definitions.default.orders
>>     local tag = tag == "" and { "" } or { tag }
>>     for i=1,#orders do
>>         local order = orders[i]
>>         context.menubutton(tag,f_two_colon(register,order),order)
>>     end
>> end
>
> I am not too familiar with the lua toolchain, but would it be possible
> to run a lua static analyzer (such as luacheck
> https://github.com/mpeterv/luacheck) on the context sources?

I don't know (nor have time to look into it) but we have Wolfgang as 
dynamic analyzer which is hard to beat.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun Nov 15 12:36:24 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 15 Nov 2015 12:36:24 +0100
Subject: [dev-context] scrn-hlp.mkvi
Message-ID: <56486E38.5000404@gmail.com>

Hi,

\def\scrn_help_argument_indeed[#reference]#text#target%
   {\edef\currenthelpreference{#reference}%
    \dontleavehmode \hbox \bgroup
      \dontcomplain
      \setbox\b_scrn_help_box\hbox{\strut#text}%
-    \doregisterhelp{#target}%
+    \scrn_help_register{#target}%
    \egroup % can be usernode instead
    \goto
      {\helpsignal{\number\c_scrn_help_n}#target}%
      [\helpaction{\number\c_scrn_help_n}]}

Wolfgang


From schuster.wolfgang at gmail.com  Sun Nov 15 12:38:31 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 15 Nov 2015 12:38:31 +0100
Subject: [dev-context] scrn-ref.lua
Message-ID: <56486EB7.2060908@gmail.com>

Hi,

the value of the calculate key from \setupinteraction is passed to the 
\doregistercalculationse macro which doesnât exist in MkIV.

scrn-ref.mkvi (line 20-25):

\appendtoks
\doifsomething{\interactionparameter\c!calculate}{\doregistercalculationset{\interactionparameter\c!calculate}}%
\doifelse{\interactionparameter\c!click }\v!yes \settrue \setfalse 
\highlighthyperlinks
\doifelse{\interactionparameter\c!display}\v!new \settrue \setfalse 
\gotonewwindow
\doifnot {\interactionparameter\c!page }\v!no 
\scrn_reference_enable_page_destinations
\to \everysetupinteraction

Wolfgang

From schuster.wolfgang at gmail.com  Sun Nov 15 18:22:30 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 15 Nov 2015 18:22:30 +0100
Subject: [dev-context] scrn-wid.mkvi
Message-ID: <5648BF56.4000607@gmail.com>

Hi,

\def\scrn_attachment_use[#tag][#title][#name][#file]%
   {\iffourthargument
      \registerattachment[#tag][title=#title,name=#name,file=#file]%
    \else\ifthirdargument
      \registerattachment[#tag][title=#title,name=#title,file=#name]%
    \else\ifsecondargument
      \registerattachment[#tag][title=#title,name=#title,file=#title]%
    \else
-    \registerattachment[#tag][title=#title,name=#tag,file=#tag]%
+    \registerattachment[#tag][title=#tag,name=#tag,file=#tag]%
    \fi\fi\fi}

Wolfgang

From pragma at wxs.nl  Mon Nov 16 00:02:09 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Nov 2015 00:02:09 +0100
Subject: [dev-context] scrn-ref.lua
In-Reply-To: <56486EB7.2060908@gmail.com>
References: <56486EB7.2060908@gmail.com>
Message-ID: <56490EF1.1090604@wxs.nl>

On 11/15/2015 12:38 PM, Wolfgang Schuster wrote:
> Hi,
>
> the value of the calculate key from \setupinteraction is passed to the
> \doregistercalculationse macro which doesnât exist in MkIV.
>
> scrn-ref.mkvi (line 20-25):
>
> \appendtoks
> \doifsomething{\interactionparameter\c!calculate}{\doregistercalculationset{\interactionparameter\c!calculate}}%
>
> \doifelse{\interactionparameter\c!click }\v!yes \settrue \setfalse
> \highlighthyperlinks
> \doifelse{\interactionparameter\c!display}\v!new \settrue \setfalse
> \gotonewwindow
> \doifnot {\interactionparameter\c!page }\v!no
> \scrn_reference_enable_page_destinations
> \to \everysetupinteraction

ok, we need \clf_setfieldcalculationset


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Tue Nov 17 13:10:52 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 17 Nov 2015 13:10:52 +0100
Subject: [dev-context] spac-ali.mkiv
Message-ID: <564B194C.2060100@gmail.com>

Hi,

-\unexpanded\def\ibox#1#2#3%
+\unexpanded\def\ibox
   {\vbox\bgroup
      \forgetall
      \let\\=\endgraf
      \ifdoublesided\signalinnerrealign\fi
      
\doifelserightpage\spac_align_set_horizontal_right\spac_align_set_horizontal_left
      \let\next}

-\unexpanded\def\obox#1#2#3%
+\unexpanded\def\obox
   {\vbox\bgroup
      \forgetall
      \let\\=\endgraf
      \ifdoublesided\signalouterrealign\fi
      
\doifelserightpage\c_spac_align_state_horizontal_left\spac_align_set_horizontal_right
      \let\next}

Wolfgang

From schuster.wolfgang at gmail.com  Thu Nov 19 12:47:11 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 19 Nov 2015 12:47:11 +0100
Subject: [dev-context] spac-hor.mkiv
Message-ID: <564DB6BF.80107@gmail.com>

Hi,

line 157 uses the no longer existing \simplesetupindenting command:

\installindentingmethod \v!normal{\ifx\normalindentation\empty\else
                                     
\let\v_spac_indentation_current\normalindentation
-                                   \simplesetupindenting
+                                   \spac_indentation_setup_size
                                   \fi}


Line 1090 has to be removed

     \definecomplexorsimple\widened

because \widened is already defined a few lines above.


Wolfgang

From luigi.scarso at gmail.com  Sat Nov 21 11:03:31 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 21 Nov 2015 11:03:31 +0100
Subject: [dev-context] Luatex 0.85.0 announcement
Message-ID: <CAG5iGsDHK45GZO5NwmkHBLhK7AX1mF6exPrayfYrq74wGz+T+w@mail.gmail.com>

New luatex release, 0.85.0

It's really a big change respect to 0.81.0
(see NEWS for a full report)
and, well,   there can be bugs (that of course we will solve).


The archives can be downloaded from supelec as usual:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.85.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

When you use context or latex you need an updated format. The latest
version of
context can be fetched from the context garden, latex from ctan. For latex
you can contact David and Joseph as they are dealing with the update.

Have fun,
Hans, Taco, Luigi (in this order :-) )
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20151121/5074ca95/attachment.html>

From wolfgang.schuster at gmail.com  Sun Nov 22 18:08:46 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 22 Nov 2015 18:08:46 +0100
Subject: [dev-context] spac-ver.mkiv
Message-ID: <5651F69E.2060203@gmail.com>

Hi,

\unexpanded\def\dosynchronizestrut#1% no [] parsing, faster for internal
   {\ifcsname\??struts#1\endcsname
      \csname\??struts#1\endcsname
    \else
-    \setcharstrut\m_strut
+    \setcharstrut{#1}%
    \fi}

Wolfgang


From joseph.wright at morningstar2.co.uk  Mon Nov 23 12:57:44 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 23 Nov 2015 11:57:44 +0000
Subject: [dev-context] Luatex 0.85.0 announcement
In-Reply-To: <CAG5iGsDHK45GZO5NwmkHBLhK7AX1mF6exPrayfYrq74wGz+T+w@mail.gmail.com>
References: <CAG5iGsDHK45GZO5NwmkHBLhK7AX1mF6exPrayfYrq74wGz+T+w@mail.gmail.com>
Message-ID: <5652FF38.1040409@morningstar2.co.uk>

On 21/11/2015 10:03, luigi scarso wrote:
> New luatex release, 0.85.0
> 
> It's really a big change respect to 0.81.0
> (see NEWS for a full report)
> and, well,   there can be bugs (that of course we will solve).
> 
> 
> The archives can be downloaded from supelec as usual:
> 
>         https://foundry.supelec.fr/projects/luatex/
> 
> You could also check out the sources via anonymous svn:
> 
>   svn co --username anonsvn --password anonsvn              \
>       https://foundry.supelec.fr/svn/luatex/tags/beta-0.85.0
> 
> Bugs and feature requests can be added to the issue tracker at
> 
>        http://tracker.luatex.org
> 
> When you use context or latex you need an updated format. The latest
> version of
> context can be fetched from the context garden, latex from ctan. For latex
> you can contact David and Joseph as they are dealing with the update.

For those wishing to be on the 'burning edge' in LaTeX terms, we have
put some *very experimental* support code on GitHub:

  https://github.com/josephwright/luatex85

David and I are working with the rest of the LaTeX team to make the
changes transparent to end users: we hope to have all of this to CTAN
and into TeX Live well before any binary changes in the release version,
and will co-ordinate the same with MiKTeX.

Joseph


From schuster.wolfgang at gmail.com  Mon Nov 30 19:07:45 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 30 Nov 2015 19:07:45 +0100
Subject: [dev-context] strc-ind.mkiv: \startindentedtext
Message-ID: <565C9071.8050505@gmail.com>

Hi Hans,

is there something missing in the file strc-ind.mkiv because it contains 
on line 107

     \let\stopindentedtext\strc_indentedtexts_stop

but there is no definition for a \startindentedtext command.

Wolfgang

From pragma at wxs.nl  Wed Dec  2 22:36:22 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 2 Dec 2015 22:36:22 +0100
Subject: [dev-context] strc-ind.mkiv: \startindentedtext
In-Reply-To: <565C9071.8050505@gmail.com>
References: <565C9071.8050505@gmail.com>
Message-ID: <565F6456.4020507@wxs.nl>

On 11/30/2015 7:07 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> is there something missing in the file strc-ind.mkiv because it contains
> on line 107
>
>      \let\stopindentedtext\strc_indentedtexts_stop
>
> but there is no definition for a \startindentedtext command.

maybe something like:

\unexpanded\def\startindentedtext
   {\dosingleempty\strc_indentedtexts_start_direct}

\def\strc_indentedtexts_start_direct[#1]%
   {\strc_indentedtexts_start{#1}\c_strc_indentedtexts_nesting}

(i forget about these commands -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Fri Dec  4 19:16:08 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 04 Dec 2015 19:16:08 +0100
Subject: [dev-context] strc-lnt.mkvi
Message-ID: <5661D868.2000103@gmail.com>

Hi,

the following definitions in strc-lnt.mkvi (line 259â266) should be in 
reverse order with \definelinenote[linenote] before 
\let\fromlinenote\startlinenote.


%D Use these when not properly nested:

\let\fromlinenote\startlinenote
\let\tolinenote \stoplinenote

% We predefine one, namely \type {\linenote} cum suis.

\definelinenote[\v!linenote]


Wolfgang

From schuster.wolfgang at gmail.com  Wed Dec  9 12:47:14 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 09 Dec 2015 12:47:14 +0100
Subject: [dev-context] strc-mat.mkiv
Message-ID: <566814C2.8060205@gmail.com>

Hi,

there is a 's' missing in \currentformulasreference:

\def\strc_formulas_handle_number % formulas
- 
{\strc_formulas_check_reference\c_strc_formulas_number_mode\currentformulareference}
+ 
{\strc_formulas_check_reference\c_strc_formulas_number_mode\currentformulasreference}

Wolfgang

From schuster.wolfgang at gmail.com  Wed Dec  9 12:54:16 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 09 Dec 2015 12:54:16 +0100
Subject: [dev-context] strc-mat.mkiv
Message-ID: <56681668.7080401@gmail.com>

Hi,

\def\strc_formulas_number_again[#1]%
   {\def\currentformulareference{#1}%
-  \dosinglegroupempty\strc_formulas_number_indeed}
+  \strc_formulas_number_indeed}

Wolfgang

From schuster.wolfgang at gmail.com  Wed Dec  9 13:07:19 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 09 Dec 2015 13:07:19 +0100
Subject: [dev-context] strc-mat.mkiv
Message-ID: <56681977.4080406@gmail.com>

Hi,

\def\strc_formulas_place[#1]%
   {\def\currentplaceformulareference{#1}%
    \let\currentplaceformulasuffix\empty
-  
\doifelsenextbgroup\strc_formulas_place_yes\strc_formulas_place_nop\strc_formulas_place_nop} 
% [ref]{}
+  \doifelsenextbgroup\strc_formulas_place_yes\strc_formulas_place_nop} 
% [ref]{}

Wolfgang

From pragma at wxs.nl  Thu Dec 10 09:30:29 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 10 Dec 2015 09:30:29 +0100
Subject: [dev-context] strc-mat.mkiv
In-Reply-To: <56681977.4080406@gmail.com>
References: <56681977.4080406@gmail.com>
Message-ID: <56693825.70202@wxs.nl>

On 12/9/2015 1:07 PM, Wolfgang Schuster wrote:
> Hi,
>
> \def\strc_formulas_place[#1]%
>    {\def\currentplaceformulareference{#1}%
>     \let\currentplaceformulasuffix\empty
> -
> \doifelsenextbgroup\strc_formulas_place_yes\strc_formulas_place_nop\strc_formulas_place_nop}
> % [ref]{}
> +  \doifelsenextbgroup\strc_formulas_place_yes\strc_formulas_place_nop}
> % [ref]{}

all fixed ... no upload yet (in sync with luatex 0.86)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Thu Dec 10 13:17:07 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 10 Dec 2015 13:17:07 +0100
Subject: [dev-context] strc-not.mkvi: \startfootnote
Message-ID: <56696D43.3060604@gmail.com>

Hi Hans,

the \startfootnote command doesnât work well when you use the assignment 
method to set the reference.

\starttext

First note.
\startfootnote[note_one]
This is the first footnote.
\stopfootnote

Second note.
\startfootnote[reference=note_two]
This is the second footnote.
\stopfootnote

\stoptext

Wolfgang

From schuster.wolfgang at gmail.com  Sat Dec 12 12:34:37 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 12 Dec 2015 12:34:37 +0100
Subject: [dev-context] strc-not.mkvi: \doifelsenoteonsamepage
Message-ID: <566C064D.8050501@gmail.com>

Hi Hans,

shouldnât the first argument of the \doifelsenoteonsamepage command 
(line 1775) be {â¦} and not [â¦] like all other \doifelseâ¦ commands?

-\def\doifelsenoteonsamepage[#tag]{\clf_doifnoteonsamepageasprevious{#tag}}
+\def\doifelsenoteonsamepage#tag{\clf_doifnoteonsamepageasprevious{#tag}}

Since the command is only used by a single user this shouldnât be a problem.

Wolfgang

From schuster.wolfgang at gmail.com  Sun Dec 13 13:15:31 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Dec 2015 13:15:31 +0100
Subject: [dev-context] strc-num.mkiv
Message-ID: <566D6163.1000409@gmail.com>

Hi,

-\unexpanded\def\savecounter       {\dodoubleempty   
\strc_counters_save_interfaced}
-\unexpanded\def\restorecounter    {\dodoubleempty   
\strc_counters_restore_interfaced}
+\unexpanded\def\savecounter       {\dosingleempty   
\strc_counters_save_interfaced}
+\unexpanded\def\restorecounter    {\dosingleempty   
\strc_counters_restore_interfaced}

Wolfgang


From schuster.wolfgang at gmail.com  Sun Dec 13 13:18:51 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Dec 2015 13:18:51 +0100
Subject: [dev-context] strc-num.mkiv
Message-ID: <566D622B.1040106@gmail.com>

Hi,

should the expandable counter commmands (line 327â331) allow spaces 
between the arguments?

-\let\rawsubcountervalue \strc_counters_raw_two
-\let\lastsubcountervalue \strc_counters_last_two
-\let\firstsubcountervalue \strc_counters_first_two
-\let\nextsubcountervalue \strc_counters_next_two
-\let\prevsubcountervalue \strc_counters_prev_two
+\def\rawsubcountervalue [#1]#2[#3]{\clf_subcountervalue 
{\namedcounterparameter{#1}\s!name}\numexpr#3\relax}
+\def\lastsubcountervalue [#1]#2[#3]{\clf_lastsubcountervalue 
{\namedcounterparameter{#1}\s!name}\numexpr#3\relax}
+\def\firstsubcountervalue[#1]#2[#3]{\clf_firstsubcountervalue 
{\namedcounterparameter{#1}\s!name}\numexpr#3\relax}
+\def\nextsubcountervalue [#1]#2[#3]{\clf_nextsubcountervalue 
{\namedcounterparameter{#1}\s!name}\numexpr#3\relax}
+\def\prevsubcountervalue 
[#1]#2[#3]{\clf_previoussubcountervalue{\namedcounterparameter{#1}\s!name}\numexpr#3\relax}

Wolfgang

From schuster.wolfgang at gmail.com  Sun Dec 13 19:07:58 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 13 Dec 2015 19:07:58 +0100
Subject: [dev-context] strc-ref.mkvi: \contentreference
Message-ID: <566DB3FE.1030903@gmail.com>

Hi,

\def\strc_references_content_pickup
   {\ifsecondargument
      \expandafter\strc_references_content_pickup_yes
    \else
-    \expandafter\strc_references_content_pickup_yes
+    \expandafter\strc_references_content_pickup_nop
    \fi}

Wolfgang

From pragma at wxs.nl  Sun Dec 13 19:53:24 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Dec 2015 19:53:24 +0100
Subject: [dev-context] strc-not.mkvi: \doifelsenoteonsamepage
In-Reply-To: <566C064D.8050501@gmail.com>
References: <566C064D.8050501@gmail.com>
Message-ID: <566DBEA4.6080305@wxs.nl>

On 12/12/2015 12:34 PM, Wolfgang Schuster wrote:
> Hi Hans,
>
> shouldnât the first argument of the \doifelsenoteonsamepage command
> (line 1775) be {â¦} and not [â¦] like all other \doifelseâ¦ commands?
>
> -\def\doifelsenoteonsamepage[#tag]{\clf_doifnoteonsamepageasprevious{#tag}}
> +\def\doifelsenoteonsamepage#tag{\clf_doifnoteonsamepageasprevious{#tag}}
>
> Since the command is only used by a single user this shouldnât be a
> problem.

ok


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Sun Dec 20 13:36:12 2015
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 20 Dec 2015 13:36:12 +0100
Subject: [dev-context] option for single sided printing
Message-ID: <5676A0BC.7040508@gmx.es>

Hans,

in some printers in which duplex printing is enabled by default, a
"single" value for duplex printing is required to disable it.

I attach the patch that implements this.

Many thanks for your help,


Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: duplex-single.diff
Type: text/x-patch
Size: 885 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20151220/623f6fd6/attachment.bin>

From luigi.scarso at gmail.com  Sun Dec 20 22:54:30 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 20 Dec 2015 22:54:30 +0100
Subject: [dev-context] Luatex 0.87.0 announcement
Message-ID: <CAG5iGsD7-cqbVpT+CJXCwhpMuj4aq4w5Q4eooBZO5NS2e704Tg@mail.gmail.com>

New luatex release, 0.87.0
>From NEWS:

==================================================
This is a next step upto 0.90 and it has the following changes:

- image data is no longer stored in the format (it was fragile anyway)

- pdf backend data generated when in ini mode is no longer stored in  the
format

- (incomplete) \mag support removed from pdf backend (this functionality is
  kept in dvi mode)

- there are a couple of improvements that should make luatex run a little
bit faster
  (but of course that depends on the job at hand)

- some further pending issues / cleanup has been done (but this is not
reflected in the
  interface)

- there is a new primitive \nospace:

  \nospace=1   do now not inject glue for spaces (not even zero glue)
  \nospace=2   inject zero glue for spaces

- there are new primitives \hpack, \vpack and \tpack that are like \hbox,
\vbox and
  \vtop but they don't trigger callbacks

- we no longer keep track of older math character and delimiter definition
states,
  but this should normally go unnoticed

- from now on only ^^XX, ^^C, ^^^^XXXX and ^^^^^^XXXXXX are supported so no
funny odd
  values (three and five)

- texio.setescape(0) disables escaping to terminal (a matter of taste)

- the (current) lc codes are now saved with the (current) language when
patterns are
  loaded unless one hs used \hjcode instead of \lccode; overloading of
\hjcodes is
  possible (but of course goes ahead of hyphenation which is delayed till
parbuilding or
  packaging

- active characters can now be set with: \letcharcode123=\foo (experimental)

- there are some experimental new primitives but these will be described
when they are
  stable (currently being tested)

- there is more backend error reporting and all error messages adn warnings
(the non-tex
  ones) have been normalized

- of course there are the usual small fixes and additional setters and
getters in libraries
  (see manual)
==================================================

Last minute note:
 --synctex
doesn't work. It will be fixed in the next release.

As usual,
the archives can be downloaded from supelec:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.87.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

When you use context or latex you need an updated format. The latest
version of
context can be fetched from the context garden, latex from ctan. For latex
you can contact David and Joseph as they are dealing with the update.






Have fun,
Hans, Luigi, Taco (in alphabetical order this time)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20151220/49895a9a/attachment.html>

From schuster.wolfgang at gmail.com  Mon Dec 21 15:14:54 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 21 Dec 2015 15:14:54 +0100
Subject: [dev-context] math-ini.mkiv
Message-ID: <5678095E.9060102@gmail.com>

Hi,

the \??mathstylecache (line 2010) shouldnât be there.

\def\math_style_set_mathstyle_mathstyle
{\ifcsname\??mathstylecache\m_math_style_asked\endcsname
\lastnamedcs
\else
\math_style_set_mathstyle_mathstylecache
- \??mathstylecache
\fi}

Wolfgang

From pragma at wxs.nl  Tue Dec 22 09:45:20 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 22 Dec 2015 09:45:20 +0100
Subject: [dev-context] option for single sided printing
In-Reply-To: <5676A0BC.7040508@gmx.es>
References: <5676A0BC.7040508@gmx.es>
Message-ID: <56790DA0.9070202@wxs.nl>

On 12/20/2015 1:36 PM, Pablo Rodriguez wrote:
> Hans,
>
> in some printers in which duplex printing is enabled by default, a
> "single" value for duplex printing is required to disable it.
>
> I attach the patch that implements this.

we don't have a single keyword so i'll make it 'page' and you document 
all these options on the wiki

local pagespecs = {
     [variables.max]         = { mode = "FullScreen",  layout = false, 
           fit = false, fixed = false, duplex = false },
     [variables.bookmark]    = { mode = "UseOutlines", layout = false, 
           fit = false, fixed = false, duplex = false },
     [variables.fit]         = { mode = "UseNone",     layout = false, 
           fit = true,  fixed = false, duplex = false },
     [variables.doublesided] = { mode = "UseNone",     layout = 
"TwoColumnRight", fit = true,  fixed = false, duplex = false },
     [variables.singlesided] = { mode = "UseNone",     layout = false, 
           fit = false, fixed = false, duplex = false },
     [variables.default]     = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = false, duplex = false },
     [variables.auto]        = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = false, duplex = false },
     [variables.none]        = { mode = false,         layout = false, 
           fit = false, fixed = false, duplex = false },
     -- new
     [variables.fixed]       = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = true,  duplex = false }, -- noscale
     [variables.landscape]   = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = true,  duplex = "DuplexFlipShortEdge" },
     [variables.portrait]    = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = true,  duplex = "DuplexFlipLongEdge" },
     [variables.page]        = { mode = "UseNone",     layout = "auto", 
           fit = false, fixed = true,  duplex = "Simplex" },
}
-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Tue Dec 22 20:32:56 2015
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 22 Dec 2015 20:32:56 +0100
Subject: [dev-context] option for single sided printing
In-Reply-To: <56790DA0.9070202@wxs.nl>
References: <5676A0BC.7040508@gmx.es> <56790DA0.9070202@wxs.nl>
Message-ID: <5679A568.3050502@gmx.es>

On 12/22/2015 09:45 AM, Hans Hagen wrote:
> On 12/20/2015 1:36 PM, Pablo Rodriguez wrote:
>> Hans,
>>
>> in some printers in which duplex printing is enabled by default, a
>> "single" value for duplex printing is required to disable it.
>>
>> I attach the patch that implements this.
> 
> we don't have a single keyword so i'll make it 'page' and you document 
> all these options on the wiki

Many thanks for the option, Hans.

Of course, I will document all options on the wiki.

Many thanks for your help,


Pablo
-- 
http://www.ousia.tk

From schuster.wolfgang at gmail.com  Mon Dec 28 10:34:55 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 28 Dec 2015 10:34:55 +0100
Subject: [dev-context] scrn-pag.mkvi: \setuppapersize
Message-ID: <5681023F.3010407@gmail.com>

Hi Hans,

these settings in scrn-pag.mkvi to change the paperwidth and paperheight 
values in the PDF file have to be done also for the \setupapersize command.

\appendtoks
\global\let\scrn_canvas_synchronize_simple 
\scrn_canvas_synchronize_simple_indeed
\global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed
\to \everysetuplayout


As seen in this example the size for the second page isnât changed from 
A4 to A5 because of the missing changes above which are done by 
\setuplayout.

%%%% begin example
\starttext

\input ward

\page \setuppapersize[A5][A5]

% uncomment this to have the correct page size in the pdf
% \setuplayout

\input ward

\stoptext
%%%% end example



BTW: Are these settings for \setupinteractionscreen (also in 
scrn-pag.mkvi) correct because nothing changes?

\appendtoks
\global\let\scrn_canvas_synchronize_simple \scrn_canvas_synchronize_simple
\global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex
\to \everysetupinteractionscreen


Wolfgang

From schuster.wolfgang at gmail.com  Mon Dec 28 13:37:48 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 28 Dec 2015 13:37:48 +0100
Subject: [dev-context] lpdf-ini.lua
Message-ID: <56812D1C.4040601@gmail.com>

Hi,

there is a "to" missing in the names for the ...addtopage... commands 
(line 1242-1244):

implement { name = 
"lpdf_collectedresources",                             actions = { 
lpdf.collectedresources, context } }
implement { name = "lpdf_addtocatalog",          arguments = 
two_strings, actions = lpdf.addtocatalog }
implement { name = "lpdf_addtoinfo",             arguments = 
two_strings, actions = lpdf.addtoinfo }
implement { name = "lpdf_addtonames",            arguments = 
two_strings, actions = lpdf.addtonames }
-implement { name = "lpdf_addpageattributes",     arguments = 
two_strings, actions = lpdf.addtopageattributes }
-implement { name = "lpdf_addpagesattributes",    arguments = 
two_strings, actions = lpdf.addtopagesattributes }
-implement { name = "lpdf_addpageresources",      arguments = 
two_strings, actions = lpdf.addtopageresources }
+implement { name = "lpdf_addtopageattributes",   arguments = 
two_strings, actions = lpdf.addtopageattributes }
+implement { name = "lpdf_addtopagesattributes",  arguments = 
two_strings, actions = lpdf.addtopagesattributes }
+implement { name = "lpdf_addtopageresources",    arguments = 
two_strings, actions = lpdf.addtopageresources }

Wolfgang

From pragma at wxs.nl  Mon Dec 28 15:05:09 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 Dec 2015 15:05:09 +0100
Subject: [dev-context] scrn-pag.mkvi: \setuppapersize
In-Reply-To: <5681023F.3010407@gmail.com>
References: <5681023F.3010407@gmail.com>
Message-ID: <56814195.3000902@wxs.nl>

On 12/28/2015 10:34 AM, Wolfgang Schuster wrote:
> Hi Hans,
>
> these settings in scrn-pag.mkvi to change the paperwidth and paperheight
> values in the PDF file have to be done also for the \setupapersize command.
>
> \appendtoks
> \global\let\scrn_canvas_synchronize_simple
> \scrn_canvas_synchronize_simple_indeed
> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed
>
> \to \everysetuplayout

so

\appendtoks
     \global\let\scrn_canvas_synchronize_simple 
\scrn_canvas_synchronize_simple_indeed
 
\global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed
\to \everysetuplayouttarget


>
> As seen in this example the size for the second page isnât changed from
> A4 to A5 because of the missing changes above which are done by
> \setuplayout.
>
> %%%% begin example
> \starttext
>
> \input ward
>
> \page \setuppapersize[A5][A5]
>
> % uncomment this to have the correct page size in the pdf
> % \setuplayout
>
> \input ward
>
> \stoptext
> %%%% end example
>
>
>
> BTW: Are these settings for \setupinteractionscreen (also in
> scrn-pag.mkvi) correct because nothing changes?
>
> \appendtoks
> \global\let\scrn_canvas_synchronize_simple \scrn_canvas_synchronize_simple
> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex
> \to \everysetupinteractionscreen
>
>
> Wolfgang
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> http://mailman.ntg.nl/mailman/listinfo/dev-context


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon Dec 28 15:11:52 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 28 Dec 2015 15:11:52 +0100
Subject: [dev-context] scrn-pag.mkvi: \setuppapersize
In-Reply-To: <56814195.3000902@wxs.nl>
References: <5681023F.3010407@gmail.com> <56814195.3000902@wxs.nl>
Message-ID: <56814328.3050002@gmail.com>

> Hans Hagen <mailto:pragma at wxs.nl>
> 28. Dezember 2015 um 15:05
> On 12/28/2015 10:34 AM, Wolfgang Schuster wrote:
>> Hi Hans,
>>
>> these settings in scrn-pag.mkvi to change the paperwidth and paperheight
>> values in the PDF file have to be done also for the \setupapersize 
>> command.
>>
>> \appendtoks
>> \global\let\scrn_canvas_synchronize_simple
>> \scrn_canvas_synchronize_simple_indeed
>> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed 
>>
>>
>> \to \everysetuplayout
>
> so
>
> \appendtoks
>     \global\let\scrn_canvas_synchronize_simple 
> \scrn_canvas_synchronize_simple_indeed
>
> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed 
>
> \to \everysetuplayouttarget
This wonât work because \setuppapersize uses \setupcurrentlayouttarget 
which doesnât flush the \everysetuplayouttarget register.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20151228/1c682afd/attachment.html>

From pragma at wxs.nl  Mon Dec 28 15:14:51 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 Dec 2015 15:14:51 +0100
Subject: [dev-context] scrn-pag.mkvi: \setuppapersize
In-Reply-To: <56814328.3050002@gmail.com>
References: <5681023F.3010407@gmail.com> <56814195.3000902@wxs.nl>
 <56814328.3050002@gmail.com>
Message-ID: <568143DB.8090704@wxs.nl>

On 12/28/2015 3:11 PM, Wolfgang Schuster wrote:
>> Hans Hagen <mailto:pragma at wxs.nl>
>> 28. Dezember 2015 um 15:05
>> On 12/28/2015 10:34 AM, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> these settings in scrn-pag.mkvi to change the paperwidth and paperheight
>>> values in the PDF file have to be done also for the \setupapersize
>>> command.
>>>
>>> \appendtoks
>>> \global\let\scrn_canvas_synchronize_simple
>>> \scrn_canvas_synchronize_simple_indeed
>>> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed
>>>
>>>
>>> \to \everysetuplayout
>>
>> so
>>
>> \appendtoks
>>     \global\let\scrn_canvas_synchronize_simple
>> \scrn_canvas_synchronize_simple_indeed
>>
>> \global\let\scrn_canvas_synchronize_complex\scrn_canvas_synchronize_complex_indeed
>>
>> \to \everysetuplayouttarget
> This wonât work because \setuppapersize uses \setupcurrentlayouttarget
> which doesnât flush the \everysetuplayouttarget register.

hm, but i saw a size change in your test

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon Dec 28 15:27:27 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 28 Dec 2015 15:27:27 +0100
Subject: [dev-context] scrn-pag.mkvi: \setuppapersize
In-Reply-To: <568143DB.8090704@wxs.nl>
References: <5681023F.3010407@gmail.com> <56814195.3000902@wxs.nl>
 <56814328.3050002@gmail.com> <568143DB.8090704@wxs.nl>
Message-ID: <568146CF.8090201@gmail.com>

> Hans Hagen <mailto:pragma at wxs.nl>
> 28. Dezember 2015 um 15:14
>
>
> hm, but i saw a size change in your test
Not for me, only the layout changes but the paper has always the same size.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20151228/fd917098/attachment.html>

From schuster.wolfgang at gmail.com  Tue Dec 29 11:43:29 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 29 Dec 2015 11:43:29 +0100
Subject: [dev-context] strc-reg.mkiv: \stopstructurepageregister
Message-ID: <568263D1.7060607@gmail.com>

Hi,

\def\strc_registers_stop[#1][#2]%
- {\normalexpanded{\ctxlatelua{structures.registers.extend("#1","#2")}}}
+ {\normalexpanded{\ctxlatecommand{extendregister("#1","#2")}}}

Wolfgang

From schuster.wolfgang at gmail.com  Thu Dec 31 13:44:03 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 31 Dec 2015 13:44:03 +0100
Subject: [dev-context] Typo: strc-sec.mkiv + strc-ren.mkiv
Message-ID: <56852313.6050504@gmail.com>

Hi,

there is a "s" missing in "structure".


strc-sec.mkiv:

-\def\dosettructureheadnumbercontent
+\def\dosetstructureheadnumbercontent
   {\setsystemmode\v!sectionnumber
    \settrue\headshownumber} % why ?

-\def\doresettructureheadnumbercontent
+\def\doresetstructureheadnumbercontent
   {\resetsystemmode\v!sectionnumber
    \setfalse\headshownumber} % why ?


strc-ren.mkiv

\unexpanded\def\strc_rendering_place_head_text
   {\strc_rendering_start_placement
    \setheadmarking
-  \doresettructureheadnumbercontent
+  \doresetstructureheadnumbercontent
    \ifconditional\c_strc_sectioning_empty
      \setbox\b_strc_rendering_head\hbox \headreferenceattributes to 
\zeropoint{\strut}%
    \else
      \docheckheadreference
      \setbox\b_strc_rendering_head\hbox \headreferenceattributes
        {\spac_grids_set_local_snapping{\headparameter\c!internalgrid}%
-       \doresettructureheadnumbercontent
+       \doresetstructureheadnumbercontent
         \useheadstyleparameter\c!style
         \setinlineheadreferenceattributes
         \strc_rendering_inject_text}%
    \fi
    \strc_rendering_stop_placement}

\unexpanded\def\strc_rendering_place_head_number_and_text
   {\strc_rendering_start_placement
    \setheadmarking
    \doifelsetext\getheadnumber
-    \dosettructureheadnumbercontent
-    \doresettructureheadnumbercontent
+    \dosetstructureheadnumbercontent
+    \doresetstructureheadnumbercontent
    \ifconditional\c_strc_sectioning_empty
      \setbox\b_strc_rendering_head\hbox \headreferenceattributes to 
\zeropoint{\strut}%
    \else % = needed
      \docheckheadreference
      \setbox\b_strc_rendering_head\hbox \headreferenceattributes
        {\spac_grids_set_local_snapping{\headparameter\c!internalgrid}%
         \useheadstyleparameter\c!style
         \setinlineheadreferenceattributes
         \strc_rendering_inject_number_and_text}%
    \fi
    \strc_rendering_stop_placement}


Wolfgang


From schuster.wolfgang at gmail.com  Thu Dec 31 13:52:20 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 31 Dec 2015 13:52:20 +0100
Subject: [dev-context] strc-syn.mkiv
Message-ID: <56852504.1080706@gmail.com>

Hi,

\def\strc_synonyms_define_entry[#1][#2][#3]#4#5%
   {\begingroup
    \edef\currentsynonym{#2}%
    \edef\currentsynonymtag{#3}%
-  \let\currentsimplelist\currentsimplelist
+  \let\currentsimplelist\currentsynonym
    ...
    \fi
    \endgroup}

Wolfgang

From wolfgang.schuster at gmail.com  Thu Dec 31 16:10:21 2015
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 31 Dec 2015 16:10:21 +0100
Subject: [dev-context] strc-syn.mkiv
Message-ID: <5685455D.6080906@gmail.com>

Hi,

a simple check for the value of \setupsynonyms[alternative=â¦] can be 
usefull because
when the synonym is shown in the running text only a limited set is 
allowed but when
you flush the list with all entries the \placelistofsynonyms command 
accepts all arguments
(e.g. serried or left) from the construction mechanism.

\unexpanded\def\strc_synonyms_insert#1#2% name tag
{\begingroup
\edef\currentsimplelist{#1}%
\let \currentsynonym\currentsimplelist % for a while
\def \currentsynonymtag{#2}%
\edef\currentsimplelistalternative{\simplelistparameter\c!alternative}%
+ 
\doifnotcommandhandler\??simplelistalternative\currentsimplelistalternative
+ {\let\currentsimplelistalternative\v!normal}%
\fastsetup{\??simplelistrenderings:\v!synonym:\currentsimplelistalternative}%
\normalexpanded{\endgroup\simplelistparameter\c!next}}

Wolfgang

