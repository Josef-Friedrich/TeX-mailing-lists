From schuster.wolfgang at googlemail.com  Wed Jan  5 13:33:29 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 5 Jan 2011 13:33:29 +0100
Subject: [dev-context] Bugs regarding module documentation
Message-ID: <11FF0D7D-06A2-44DA-AE1D-C4F820499A13@gmail.com>

Hi Hans,

1. Typo (s-mod-01.mkii|mkiv)

    Line 40: two ! in the stretch value

    [\v!verytolerant,\v!!stretch]

2. It?s not possible to produce a pdf from mkvi file (mtx-modules.lua)

    Line 121: Add ?mkvi? to the list of suffixes

    local suffixes = table.tohash { 'tex','mkii','mkiv','mp' }

Kind regards,
Wolfgang


From pragma at wxs.nl  Thu Jan  6 12:36:37 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 06 Jan 2011 12:36:37 +0100
Subject: [dev-context] Bugs regarding module documentation
In-Reply-To: <11FF0D7D-06A2-44DA-AE1D-C4F820499A13@gmail.com>
References: <11FF0D7D-06A2-44DA-AE1D-C4F820499A13@gmail.com>
Message-ID: <4D25A945.2060109@wxs.nl>

On 5-1-2011 1:33, Wolfgang Schuster wrote:
> Hi Hans,
>
> 1. Typo (s-mod-01.mkii|mkiv)
>
>      Line 40: two ! in the stretch value
>
>      [\v!verytolerant,\v!!stretch]
>
> 2. It?s not possible to produce a pdf from mkvi file (mtx-modules.lua)
>
>      Line 121: Add ?mkvi? to the list of suffixes
>
>      local suffixes = table.tohash { 'tex','mkii','mkiv','mp' }

ok

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Jan 10 13:53:40 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 10 Jan 2011 13:53:40 +0100
Subject: [dev-context] new beta
Message-ID: <4D2B0154.8060706@wxs.nl>

Hi,

I uploaded a new beta:

The character definitions have been updated (esp math, thanks to Aditya).

After some testing by Wolfgang the decision was made to permit _ in 
macronames in modules. So, the following works:

\unprotect
   \def\test_test_test#1#2{#1+#2=whatever}
   \test_test_test{1}{2}
\protect

In principle we can also support ^. The mkiv code base no longer uses _ 
and ^ in math in modules and those who write modules should avoid them 
as well. So, when writing macros in unprotected mode, one schould use:

$x\normalsuperscript2\normalsubscript n$

Taco and I think that we can safely switch to \nonknuthmode in mkiv so 
this might happen soon (which means that _ and ^ become normal 
characters in text mode). Actually, being permanently in \nonknuthmode 
would permit _ and ^ in modules again.

We could even make _ and ^ always letters outside math in which case 
\text_test etc would become possible everywhere but that needs some more 
consideration. In that case

\def\make_subscript#1#2{\mathematics{#1_{#2}}}

\make_subscript{x}{2}

becomes valid everywhere. We can discuss this in detail at the dev list.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From netuse at lavabit.com  Mon Jan 10 17:02:54 2011
From: netuse at lavabit.com (Marco)
Date: Mon, 10 Jan 2011 17:02:54 +0100
Subject: [dev-context] new beta
References: <4D2B0154.8060706@wxs.nl>
Message-ID: <20110110170254.0502c580@glyph>

> Taco and I think that we can safely switch to \nonknuthmode in mkiv so 
> this might happen soon (which means that _ and ^ become normal 
> characters in text mode). Actually, being permanently in \nonknuthmode 
> would permit _ and ^ in modules again.
I like the idea.

Regards
Marco



From juliuscanute at gmail.com  Sun Jan 16 09:17:53 2011
From: juliuscanute at gmail.com (Julius Canute)
Date: Sun, 16 Jan 2011 13:47:53 +0530
Subject: [dev-context] Help regarding context architecture and compilation
Message-ID: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>

Hi,
I am doing a study about context. I wanted to understand context and its interaction with other components in the system. 

Is there a architecture diagram that could describe it ? 

Also i want to make context available through fink. For which i need to understand the dependencies of context. 

Looking for a way to build context from the source manually without using minimal context?
Can anyone help me do the compilation manually from source or at-least point to some references to do that?

Regards
A.Julius Canute


From mojca.miklavec.lists at gmail.com  Sun Jan 16 10:38:11 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 16 Jan 2011 10:38:11 +0100
Subject: [dev-context] Help regarding context architecture and
	compilation
In-Reply-To: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
Message-ID: <AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>

Dear Julius,

On Sun, Jan 16, 2011 at 09:17, Julius Canute wrote:
>
> Also i want to make context available through fink. For which i need to understand the dependencies of context.

Fink? (I hope that you are joking?)

Well, seriously, if you want to install ConTeXt in fink, the very
first thing that you have to do is to create a package for TeX Live
2010. Come on ... they still have teTeX in their package repository.
And if one wants to instal fink's gnuplot, one needs to have teTeX in
PATH. I ran away from it due to it being entirely out-of-date.

There is a package unicode-tex. Dated 2004, which is pretty much
useless in 2011.

In theory you could create a package for LuaTeX and then only support
ConTeXt MkIV, in any other case (unless you create texlive2010) you
would litteraly have to create a rule saying that packages context and
tetex conflict with each other, so if you want to have one, you cannot
have the other.

> Looking for a way to build context from the source manually without using minimal context?
> Can anyone help me do the compilation manually from source or at-least point to some references to do that?

Do you want to have support for MKIV only or also for MKII? The only
things that you need to compile from source are:
- MKIV: just luatex
- MKII: pdftex, xetex, metapost and some of the files in
http://minimals.contextgarden.net/current/bin/common/osx-64/bin/, in
particular kpsewhich

You might definitely want to compile luatex from source. See
http://wiki.contextgarden.net/ConTeXt_Minimals/Implementation for the
list. The files are available here:
http://foundry.supelec.fr/gf/project/luatex/frs/

If you want to compile the other files from source, the least I can
say is that you will have to figure it out by yourself or take the
binaries from TeX Live. I would definitely suggest you to simply copy
the binaries from TeX Live (you can find them in SVN or on CTAN under
systems/texlive/ ... as tar.xz packages, you can ask for details). If
you want to compile it yourself, you are pretty much on your own. See
http://www.tug.org/texlive/build.html for details.

Once you have the binaries set up, you will need different bits and
pieces from all over the place. You can have a look at
http://minimals.contextgarden.net/current to get the idea of what
exactly you might need (I can also tell you what comes from where),
but you won't find it at a single place. It is like asking for
"sources for a linux distribution". Each distribution has to carefully
collect bits and pieces and each one does it in a different way.

Either way: creating a package for Fink is asking for troubles unless
you create a proper TeX Live package first to replace teTeX. It will
simplify things enormously for you.

A short list of dependencies:
- binaries (from TeX Live + latest luatex)
- base files for TeX, metapost (I take them from TeX Live)
- fonts (I take them from TeX Live)
- texmf.cnf, texmfcnf.lua (you will have to write your own)
- context itself (you can fetch it from pragma-ade.com)
- optional: modules (you can fetch them from
dl.contextgarden.net/modules or from CTAN)

Mojca

From pragma at wxs.nl  Sun Jan 16 16:10:55 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 16 Jan 2011 16:10:55 +0100
Subject: [dev-context] Help regarding context architecture
	and	compilation
In-Reply-To: <AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
Message-ID: <4D330A7F.3000404@wxs.nl>

On 16-1-2011 10:38, Mojca Miklavec wrote:

.....

> Either way: creating a package for Fink is asking for troubles unless
> you create a proper TeX Live package first to replace teTeX. It will
> simplify things enormously for you.
>
> A short list of dependencies:
> - binaries (from TeX Live + latest luatex)
> - base files for TeX, metapost (I take them from TeX Live)
> - fonts (I take them from TeX Live)
> - texmf.cnf, texmfcnf.lua (you will have to write your own)
> - context itself (you can fetch it from pragma-ade.com)
> - optional: modules (you can fetch them from
> dl.contextgarden.net/modules or from CTAN)

Just an additional remark: The minimals started as a (local) subset of 
tex live. Then Mojca cum suis planted it in the garden, set up a 
compilation etc infrastructure, and it by now the minimals are the 
standard installation. As the directory structure is similar to texlive 
it's easy to support context there as well. The minimals also support 
additional modules as well as updates to evolving binaries etc.

Anyway: being the reference, the garden minimals are the starting point. 
If one chooses for luatex/mkiv only only a fraction is needed: it could 
be nice study to see how small it can get.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Sun Jan 16 16:31:57 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 16 Jan 2011 15:31:57 +0000
Subject: [dev-context] Help regarding context architecture
	and	compilation
In-Reply-To: <AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
Message-ID: <20110116153157.GA7484@phare.normalesup.org>

	Hello,

  Hans has already said that, but I want to stress it: the most
reasonable way to package ConTeXt in a distribution (Fink, or any other,
for that matter), is to start from the "Minimals": http://minimals.contextgarden.net/.
This is a (relatively) lightweight, stand-alone distribution for
ConTeXt, and there shouldn't be any theoretical problems adapting it
into a system like Fink (which doesn't mean it wouldn't need some
effort!)

  Of all people, Mojca, you should have mentioned that!

  In any case, I don't believe that is true:

> Well, seriously, if you want to install ConTeXt in fink, the very
> first thing that you have to do is to create a package for TeX Live
> 2010.

  Why?  If the TeX distributionn in Fink is so outdated (according to
you; I haven't checked), why bother bringing it up-to-date when we don't
need it in the first place?

> Either way: creating a package for Fink is asking for troubles unless
> you create a proper TeX Live package first to replace teTeX. It will
> simplify things enormously for you.

  Or you just create a stand-alone package for ConTeXt, mark it as
incompatible with the rest of the TeX-related packages in Fink, and use
it as such; just as you said yourself, actually.

	Arthur

From arthur.reutenauer at normalesup.org  Sun Jan 16 16:44:09 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 16 Jan 2011 15:44:09 +0000
Subject: [dev-context] Help regarding context architecture
	and	compilation
In-Reply-To: <4D330A7F.3000404@wxs.nl>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
	<4D330A7F.3000404@wxs.nl>
Message-ID: <20110116154409.GB7484@phare.normalesup.org>

> Anyway: being the reference, the garden minimals are the starting point.  
> If one chooses for luatex/mkiv only only a fraction is needed: it could  
> be nice study to see how small it can get.

  I think the point is that if you want to do nice typography and / or
support many different scripts and languages, you need a lot of fonts,
which have the potential to make the size explode with virtually no
limits (think CJKV...).  That is anyway one of the conclusions that have
been reached during the recent thread on the TeX Live list (about a
hypothetical "modern" scheme for TeX Live).

	Arthur

From pragma at wxs.nl  Sun Jan 16 16:57:08 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 16 Jan 2011 16:57:08 +0100
Subject: [dev-context] Help regarding context architecture
	and	compilation
In-Reply-To: <20110116154409.GB7484@phare.normalesup.org>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
	<4D330A7F.3000404@wxs.nl>
	<20110116154409.GB7484@phare.normalesup.org>
Message-ID: <4D331554.5060903@wxs.nl>

On 16-1-2011 4:44, Arthur Reutenauer wrote:
>> Anyway: being the reference, the garden minimals are the starting point.
>> If one chooses for luatex/mkiv only only a fraction is needed: it could
>> be nice study to see how small it can get.
>
>    I think the point is that if you want to do nice typography and / or
> support many different scripts and languages, you need a lot of fonts,
> which have the potential to make the size explode with virtually no
> limits (think CJKV...).  That is anyway one of the conclusions that have
> been reached during the recent thread on the TeX Live list (about a
> hypothetical "modern" scheme for TeX Live).

sure, but I think that texlive fonts sort of got out of hands ... all 
those encodings and split type 1 files (for cjk etc) ... with the modern 
engines we can do with way less fonts

btw, personally i now only use <texroot>/fonts/data/vendor/collection 
and not the afm/tfm/type1/vf/... structure which already makes it more 
convenient to manage fonts

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Jan 16 16:58:49 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 16 Jan 2011 16:58:49 +0100
Subject: [dev-context] Help regarding context
	architecture	and	compilation
In-Reply-To: <20110116153157.GA7484@phare.normalesup.org>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
	<20110116153157.GA7484@phare.normalesup.org>
Message-ID: <4D3315B9.2070502@wxs.nl>

On 16-1-2011 4:31, Arthur Reutenauer wrote:

>    Why?  If the TeX distributionn in Fink is so outdated (according to
> you; I haven't checked), why bother bringing it up-to-date when we don't
> need it in the first place?

if it also ships tetex, one also need to get rid of interferences due to 
set environment variables

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Sun Jan 16 17:21:43 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 16 Jan 2011 17:21:43 +0100
Subject: [dev-context] Help regarding context architecture and
	compilation
In-Reply-To: <20110116153157.GA7484@phare.normalesup.org>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
	<20110116153157.GA7484@phare.normalesup.org>
Message-ID: <AANLkTikoU8gA=tucE4ZtOp4NUSLBiiaBFVtuEXtuQcHX@mail.gmail.com>

On Sun, Jan 16, 2011 at 16:31, Arthur Reutenauer wrote:
>
> ?In any case, I don't believe that is true:
>
>> Well, seriously, if you want to install ConTeXt in fink, the very
>> first thing that you have to do is to create a package for TeX Live
>> 2010.
>
> ?Why? ?If the TeX distributionn in Fink is so outdated (according to
> you; I haven't checked), why bother bringing it up-to-date when we don't
> need it in the first place?

If he wanted to support MKII, it would conflict with the version of
pdfTeX shipped with tetex. And environment variables could conflict as
well. For MKIV it is doable.

>> Either way: creating a package for Fink is asking for troubles unless
>> you create a proper TeX Live package first to replace teTeX. It will
>> simplify things enormously for you.
>
> ?Or you just create a stand-alone package for ConTeXt, mark it as
> incompatible with the rest of the TeX-related packages in Fink, and use
> it as such; just as you said yourself, actually.

The problem is a different one. I was not able to install gnuplot
without installing tetex. And many other packages depend on tetex for
no particular reason. If I was still using fink, packaged ConTeXt MKII
would be of no use to me since other packages would depened on tetex.

Mojca

PS: If some Mac addict would be willing to help, it would be very
useful to create ConTeXt.app.

PPS: I really don't like fink, that's why my negative reactions were there ...

From pragma at wxs.nl  Sun Jan 16 17:39:08 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 16 Jan 2011 17:39:08 +0100
Subject: [dev-context] Help regarding context architecture
	and	compilation
In-Reply-To: <AANLkTikoU8gA=tucE4ZtOp4NUSLBiiaBFVtuEXtuQcHX@mail.gmail.com>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>	<20110116153157.GA7484@phare.normalesup.org>
	<AANLkTikoU8gA=tucE4ZtOp4NUSLBiiaBFVtuEXtuQcHX@mail.gmail.com>
Message-ID: <4D331F2C.8060102@wxs.nl>

On 16-1-2011 5:21, Mojca Miklavec wrote:

> The problem is a different one. I was not able to install gnuplot
> without installing tetex. And many other packages depend on tetex for
> no particular reason. If I was still using fink, packaged ConTeXt MKII
> would be of no use to me since other packages would depened on tetex.

the old setuptex shell script contain some 'env overloads' that concern 
tetex so that can be of help

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jan 17 16:13:47 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 17 Jan 2011 16:13:47 +0100
Subject: [dev-context] \usemodule and prtcatcodes
Message-ID: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>

Hi,

why does \usemodule load the requested file with ?prtcatcodes? settings
when nearly each module has \unprotect and \protect at the begin and
end of the file?

I ask this because of a recent question [1] on the list where a user
defined shortcuts for math. Maybe a module isn?t the perfect thing
for these things and he can put them in a environment but now comes
the next problem.

When you load a environment in this way:

  \environment myenvironment
  \starttext
  ?
  \stoptext

the file is loaded again with prtcatcodes while in the following form

  \startproduct myproduct
  \environment myenvironment
  ?
  \stopproduct

the environment is loaded with ctxcatcodes. While prtcatcodes make sense
for a module i can?t understand why they are used for environments.

[1] http://www.ntg.nl/pipermail/ntg-context/2011/055915.html

Wolfgang

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20110117/7ecafbf5/attachment.html>

From pragma at wxs.nl  Mon Jan 17 17:00:08 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 17 Jan 2011 17:00:08 +0100
Subject: [dev-context] \usemodule and prtcatcodes
In-Reply-To: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
References: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
Message-ID: <4D346788.6060502@wxs.nl>

On 17-1-2011 4:13, Wolfgang Schuster wrote:
> Hi,
>
> why does \usemodule load the requested file with ?prtcatcodes? settings
> when nearly each module has \unprotect and \protect at the begin and
> end of the file?
>
> I ask this because of a recent question [1] on the list where a user
> defined shortcuts for math. Maybe a module isn?t the perfect thing
> for these things and he can put them in a environment but now comes
> the next problem.
>
> When you load a environment in this way:
>
>    \environment myenvironment
>    \starttext
>    ?
>    \stoptext
>
> the file is loaded again with prtcatcodes while in the following form
>
>    \startproduct myproduct
>    \environment myenvironment
>    ?
>    \stopproduct
>
> the environment is loaded with ctxcatcodes. While prtcatcodes make sense
> for a module i can?t understand why they are used for environments.

much of this goes back a long time .. we used to have only m-* and 
styles were normally environments; and when defining interface 
independent environments unprotect makes sense ... we can consider 
removing that (but then need to check for environments on our machines 
that use ! etc)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jan 17 19:15:37 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 17 Jan 2011 19:15:37 +0100
Subject: [dev-context] \usemodule and prtcatcodes
In-Reply-To: <4D346788.6060502@wxs.nl>
References: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
	<4D346788.6060502@wxs.nl>
Message-ID: <FD605F48-8027-4229-94AC-574E531FB8DA@gmail.com>


Am 17.01.2011 um 17:00 schrieb Hans Hagen:

> much of this goes back a long time .. we used to have only m-* and styles were normally environments; and when defining interface independent environments unprotect makes sense ... we can consider removing that (but then need to check for environments on our machines that use ! etc)

Remove prtcatcodes from modules and environments or only environments?

If such a change happens we can do this for mkiv only because mkii hasn?t a problem with _

Wolfgang



From schuster.wolfgang at googlemail.com  Mon Jan 17 19:20:44 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 17 Jan 2011 19:20:44 +0100
Subject: [dev-context] ConTeXt.app (was: Help regarding context architecture
	and compilation)
In-Reply-To: <AANLkTikoU8gA=tucE4ZtOp4NUSLBiiaBFVtuEXtuQcHX@mail.gmail.com>
References: <2844B164-BEB0-4D16-9E5D-4A261924F39D@gmail.com>
	<AANLkTi=dyJieVe04QZEzK3tLrXbVR5cXr0_zKKSPmNCz@mail.gmail.com>
	<20110116153157.GA7484@phare.normalesup.org>
	<AANLkTikoU8gA=tucE4ZtOp4NUSLBiiaBFVtuEXtuQcHX@mail.gmail.com>
Message-ID: <137ADFAC-613D-4560-82DC-53E4C8C8AAD5@gmail.com>


Am 16.01.2011 um 17:21 schrieb Mojca Miklavec:

> PS: If some Mac addict would be willing to help, it would be very
> useful to create ConTeXt.app.

Sounds like Hans standalone distributions for windows with scite as editor.

Wolfgang


From pragma at wxs.nl  Tue Jan 18 15:26:43 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 18 Jan 2011 15:26:43 +0100
Subject: [dev-context] \usemodule and prtcatcodes
In-Reply-To: <FD605F48-8027-4229-94AC-574E531FB8DA@gmail.com>
References: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
	<4D346788.6060502@wxs.nl>
	<FD605F48-8027-4229-94AC-574E531FB8DA@gmail.com>
Message-ID: <4D35A323.8080104@wxs.nl>

On 17-1-2011 7:15, Wolfgang Schuster wrote:
>
> Am 17.01.2011 um 17:00 schrieb Hans Hagen:
>
>> much of this goes back a long time .. we used to have only m-* and styles were normally environments; and when defining interface independent environments unprotect makes sense ... we can consider removing that (but then need to check for environments on our machines that use ! etc)
>
> Remove prtcatcodes from modules and environments or only environments?
>
> If such a change happens we can do this for mkiv only because mkii hasn?t a problem with _

you can have a look at the version on the ftp server (i checked all 
modules)

in that beta protection is no longer enforced but i think that in some 
cases maybe it should

bibl-bib.mkiv    458:      {\startreadingfile
colo-ini.mkiv    223:   {\startreadingfile
java-ini.mkiv    149:           \startreadingfile
meta-ini.mkiv    643:    \startreadingfile
meta-ini.mkiv    843:      \startreadingfile
symb-ini.mkiv    259:   {\startreadingfile
type-ini.mkiv    171:   {\startreadingfile

currently only the last one has it (already had it) as we have these 
\s!file etc mem savers there

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Jan 18 17:41:49 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 18 Jan 2011 17:41:49 +0100
Subject: [dev-context] \usemodule and prtcatcodes
In-Reply-To: <4D35A323.8080104@wxs.nl>
References: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
	<4D346788.6060502@wxs.nl>
	<FD605F48-8027-4229-94AC-574E531FB8DA@gmail.com>
	<4D35A323.8080104@wxs.nl>
Message-ID: <58357D31-86D8-4641-9ED5-7629BEBC3C2D@gmail.com>


Am 18.01.2011 um 15:26 schrieb Hans Hagen:

> On 17-1-2011 7:15, Wolfgang Schuster wrote:
>> 
>> Remove prtcatcodes from modules and environments or only environments?
>> 
>> If such a change happens we can do this for mkiv only because mkii hasn?t a problem with _
> 
> you can have a look at the version on the ftp server (i checked all modules)

x-res-08.tex

\doifnotmode{\systemmodeprefix\v!first}{\endinput}

\unprotect

Wolfgang


From pragma at wxs.nl  Tue Jan 18 18:12:24 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 18 Jan 2011 18:12:24 +0100
Subject: [dev-context] \usemodule and prtcatcodes
In-Reply-To: <58357D31-86D8-4641-9ED5-7629BEBC3C2D@gmail.com>
References: <F9568625-14B2-42FE-8085-CFFA76E4C58B@gmail.com>
	<4D346788.6060502@wxs.nl>
	<FD605F48-8027-4229-94AC-574E531FB8DA@gmail.com>
	<4D35A323.8080104@wxs.nl>
	<58357D31-86D8-4641-9ED5-7629BEBC3C2D@gmail.com>
Message-ID: <4D35C9F8.4040303@wxs.nl>

On 18-1-2011 5:41, Wolfgang Schuster wrote:
>
> Am 18.01.2011 um 15:26 schrieb Hans Hagen:
>
>> On 17-1-2011 7:15, Wolfgang Schuster wrote:
>>>
>>> Remove prtcatcodes from modules and environments or only environments?
>>>
>>> If such a change happens we can do this for mkiv only because mkii hasn?t a problem with _
>>
>> you can have a look at the version on the ftp server (i checked all modules)
>
> x-res-08.tex
>
> \doifnotmode{\systemmodeprefix\v!first}{\endinput}
>
> \unprotect


ah, a tricky one ...

\unprotect \doifnotmode{\systemmodeprefix\v!first}{\protect\endinput}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From juliuscanute at gmail.com  Sat Jan 22 20:34:02 2011
From: juliuscanute at gmail.com (Julius Canute)
Date: Sun, 23 Jan 2011 01:04:02 +0530
Subject: [dev-context] Help regarding Kpsewhich and mtxrun
Message-ID: <6028B0E5-9842-4D40-83F5-A40CFB63BD62@gmail.com>

Please correct me if i am wrong.
If kpsewhich is not used and replaced by mtxrun why is it included in context minimals??

Doubt:
Inside texexec file i find this line:

mtxrun --usekpse --execute texexec "$@"


Suppose say  i type the following command.

texexec --pdf sample.tex

It will somehow call mtxrun which in turn will invoke 'texmfstart.rb' i guess.

The above command somehow invokes 'pdftex' which processes  sample.tex file.

But pdftex is a binary how does it come to know about location of fonts and all other information unless there is some interface that is hard coded???


From mojca.miklavec.lists at gmail.com  Sat Jan 22 21:00:28 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 22 Jan 2011 21:00:28 +0100
Subject: [dev-context] Help regarding Kpsewhich and mtxrun
In-Reply-To: <6028B0E5-9842-4D40-83F5-A40CFB63BD62@gmail.com>
References: <6028B0E5-9842-4D40-83F5-A40CFB63BD62@gmail.com>
Message-ID: <AANLkTi=ev72yci5ghECsWcmNtCY-0V5tmjJjc903S6JV@mail.gmail.com>

On Sat, Jan 22, 2011 at 20:34, Julius Canute wrote:
> Please correct me if i am wrong.
> If kpsewhich is not used and replaced by mtxrun why is it included in context minimals??

If nothing else it is included because of MKII. It is entirely
replaced only in MKIV.

I'm not sure whether MKII can be convinced to use mtxrun or not, but
at least under windows pdfTeX binary is somehow linked to kpathsea and
I'm almost sure that running pdfTeX would not run without kpathsea.
(But I may be wrong.)

Mojca

From pragma at wxs.nl  Sun Jan 23 20:30:02 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 23 Jan 2011 20:30:02 +0100
Subject: [dev-context] Help regarding Kpsewhich and mtxrun
In-Reply-To: <AANLkTi=ev72yci5ghECsWcmNtCY-0V5tmjJjc903S6JV@mail.gmail.com>
References: <6028B0E5-9842-4D40-83F5-A40CFB63BD62@gmail.com>
	<AANLkTi=ev72yci5ghECsWcmNtCY-0V5tmjJjc903S6JV@mail.gmail.com>
Message-ID: <4D3C81BA.5050208@wxs.nl>

On 22-1-2011 9:00, Mojca Miklavec wrote:
> On Sat, Jan 22, 2011 at 20:34, Julius Canute wrote:
>> Please correct me if i am wrong.
>> If kpsewhich is not used and replaced by mtxrun why is it included in context minimals??
>
> If nothing else it is included because of MKII. It is entirely
> replaced only in MKIV.
>
> I'm not sure whether MKII can be convinced to use mtxrun or not, but
> at least under windows pdfTeX binary is somehow linked to kpathsea and
> I'm almost sure that running pdfTeX would not run without kpathsea.
> (But I may be wrong.)

indeed, pdftex and mpost need the kpse lib, as does the previous 
texmfstart; texexec still uses it (and caches lookups) but could proably 
do without now

(in a mkiv minimals only kpse* is not needed)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jan 28 20:33:02 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 28 Jan 2011 20:33:02 +0100
Subject: [dev-context] beta
Message-ID: <4D4319EE.5030302@wxs.nl>

Hi,

[for those with access to the ftp server]

There have been some changes to the resolver code. In order to make
trees relocatable (handy if you run from a usb stick or so), the texroot 
is now more abstract. The final implemention might change but it seems 
to work ok (here).

It can be tested with an existing minimal:

- delete the context path under texmf-cache
- unzip cont-tmf.zip in texmf-context
- copy mtxrun.lua from the scripts path to the bin path
- update the texmfcnf.lua file (just copy contextcnf.lua)
- remake the file database

In logs you will notice prefixes like selfautoparent:texmf which comes 
from the texmfcnf.lua file (plus a preset TEXMF). That abstraction is 
used in cached names and is resolved at runtime. It might change to an 
url like syntax at some point.

I hope that Mojca does not get too fed up after this change -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Sat Jan 29 12:36:22 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 29 Jan 2011 12:36:22 +0100
Subject: [dev-context] beta
In-Reply-To: <4D4319EE.5030302@wxs.nl>
References: <4D4319EE.5030302@wxs.nl>
Message-ID: <AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>

On Fri, Jan 28, 2011 at 20:33, Hans Hagen <pragma at wxs.nl> wrote:
> Hi,
>
> I hope that Mojca does not get too fed up after this change -)

It was me who was asking for the "troubles" anyway :) :) :) So I'm the
last one who should be complaining.

However here are two settings I'm not sure about (I didn't test them,
I only looked at them):

    TEXMFOS         = "selfautodir:",

Let's assume that somebody installs binaries on USB stick for three
different platforms. mtxrun --generate will then alway create the
database into the same folder for all three different platforms.

    TEXMFHOME       = "home:texmf",

Let's assume that there are two users using the minimals (it probably
won't happen for minimals, but it might happen for TeX Live). Will the
database overwrite each other's data? (On the other hand the home
folder is not supposed to generate the database at all ...)

Mojca

From mojca.miklavec.lists at gmail.com  Sat Jan 29 12:39:04 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 29 Jan 2011 12:39:04 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>
	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
Message-ID: <AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>

Hans,

is this intentional (after removing texmf-cache completely)?

> context --version

MTXrun | forcing cache reload
MTXrun | resolvers: warning: no lua configuration files found
MTXrun | resolvers
MTXrun | resolvers
MTXrun | the resolver databases are not present or outdated
MTXrun | resolvers: using suffix based filetype 'lua'
MTXrun | resolvers: using suffix based filetype 'lua'
MTXrun | resolvers: remembering file 'mtx-context.lua'
MTXrun | resolvers: using suffix based filetype 'lua'
MTXrun | unknown script 'context.lua' or 'mtx-context.lua'

You do seem to try to regenerate the database, but the attempt to do
so seems to fail for some reason.

Mojca

From mojca.miklavec.lists at gmail.com  Sat Jan 29 13:00:56 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 29 Jan 2011 13:00:56 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>
	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
	<AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
Message-ID: <AANLkTi=aVA42jZD_hQdzgb8ps6qZLgMV+te1RsyBiSZ7@mail.gmail.com>

It is actually even more fun ...

> mtxrun --generate

MTXrun | resolvers: variable 'SELFAUTOLOC' set to
'/Users/mojca/context/tex/texmf-osx-64/bin'
MTXrun | resolvers: variable 'SELFAUTODIR' set to
'/Users/mojca/context/tex/texmf-osx-64'
MTXrun | resolvers: variable 'SELFAUTOPARENT' set to '/Users/mojca/context/tex'
MTXrun | resolvers: variable 'TEXMFCNF' set to ''
MTXrun | resolvers: variable 'TEXMF' set to ''
MTXrun | resolvers: variable 'TEXOS' set to 'texmf-osx-64'
MTXrun | resolvers
MTXrun | resolvers: warning: no lua configuration files found
MTXrun | resolvers
MTXrun | resolvers

So unless I have screwed something up ... not even "mtxrun --generate" works.

Mojca

From pragma at wxs.nl  Sun Jan 30 13:51:51 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 30 Jan 2011 13:51:51 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>
	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
Message-ID: <4D455EE7.6030706@wxs.nl>

On 29-1-2011 12:36, Mojca Miklavec wrote:
> On Fri, Jan 28, 2011 at 20:33, Hans Hagen<pragma at wxs.nl>  wrote:
>> Hi,
>>
>> I hope that Mojca does not get too fed up after this change -)
>
> It was me who was asking for the "troubles" anyway :) :) :) So I'm the
> last one who should be complaining.

actually, you asked for other troubles, some of which already were 
covered a while ago, these root relocation related are my troubles so 
you can blame me (afaik no one ever asked for it so it can even stay 
undocumented).

> However here are two settings I'm not sure about (I didn't test them,
> I only looked at them):
>
>      TEXMFOS         = "selfautodir:",

should work ok, just resolves to $SELFAUTODIR but at runtime only (not 
in stored files)

> Let's assume that somebody installs binaries on USB stick for three
> different platforms. mtxrun --generate will then alway create the
> database into the same folder for all three different platforms.
>
>      TEXMFHOME       = "home:texmf",

idem, so one can use a differen home, this is somewhat more dangerous 
indeed as:

> Let's assume that there are two users using the minimals (it probably
> won't happen for minimals, but it might happen for TeX Live). Will the
> database overwrite each other's data? (On the other hand the home
> folder is not supposed to generate the database at all ...)

right, so normally it's harmless

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Jan 30 13:52:42 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 30 Jan 2011 13:52:42 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>
	<AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
Message-ID: <4D455F1A.10701@wxs.nl>

On 29-1-2011 12:39, Mojca Miklavec wrote:
> Hans,
>
> is this intentional (after removing texmf-cache completely)?
>
>> context --version
>
> MTXrun | forcing cache reload
> MTXrun | resolvers: warning: no lua configuration files found
> MTXrun | resolvers
> MTXrun | resolvers
> MTXrun | the resolver databases are not present or outdated
> MTXrun | resolvers: using suffix based filetype 'lua'
> MTXrun | resolvers: using suffix based filetype 'lua'
> MTXrun | resolvers: remembering file 'mtx-context.lua'
> MTXrun | resolvers: using suffix based filetype 'lua'
> MTXrun | unknown script 'context.lua' or 'mtx-context.lua'
>
> You do seem to try to regenerate the database, but the attempt to do
> so seems to fail for some reason.

hm, i need to check why the configuration file is not found (maybe more 
tracing)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Jan 30 22:45:58 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 30 Jan 2011 22:45:58 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTi=aVA42jZD_hQdzgb8ps6qZLgMV+te1RsyBiSZ7@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>	<AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
	<AANLkTi=aVA42jZD_hQdzgb8ps6qZLgMV+te1RsyBiSZ7@mail.gmail.com>
Message-ID: <4D45DC16.3080504@wxs.nl>

On 29-1-2011 1:00, Mojca Miklavec wrote:

> So unless I have screwed something up ... not even "mtxrun --generate" works.

ok, i see what goes wrong ... on unix : is a path separator (which makes 
me wonder if I need to  support : as separator in the configuration but 
that's another matter)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Jan 31 00:00:05 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 31 Jan 2011 00:00:05 +0100
Subject: [dev-context] beta
In-Reply-To: <AANLkTi=aVA42jZD_hQdzgb8ps6qZLgMV+te1RsyBiSZ7@mail.gmail.com>
References: <4D4319EE.5030302@wxs.nl>	<AANLkTik66OtJiW-wijsuSriDv7eLQMTA1d-=N2f9B7Oh@mail.gmail.com>	<AANLkTikN-AwmC2Ss8nZuga1pL59XTicm2fjDyS_qhcrn@mail.gmail.com>
	<AANLkTi=aVA42jZD_hQdzgb8ps6qZLgMV+te1RsyBiSZ7@mail.gmail.com>
Message-ID: <4D45ED75.4020408@wxs.nl>

On 29-1-2011 1:00, Mojca Miklavec wrote:

> So unless I have screwed something up ... not even "mtxrun --generate" works.

another beta ... no longer : as path separator (Just ; and tables and 
even ; might go as we move to urls. At some point I might treat env vars 
differently as they cannot be tables but that needs a bit more work).

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Feb  2 10:43:32 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 2 Feb 2011 10:43:32 +0100
Subject: [dev-context] \nonknuthmode breaks _ in protected mode
Message-ID: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>

Hi Hans,

the \nonknuthmode in core-def.mkiv breaks _ in modules:

\starttext

\the\catcode`\_

\unprotect
\the\catcode`\_
\protect

\the\catcode`\_

\stoptext

It helps when you enable \nonknuthmode with \everystarttext (or \everyjob), e.g.

\appendtoks \nonknuthmode \to \everystarttext

Wolfgang

From pragma at wxs.nl  Wed Feb  2 13:26:35 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 02 Feb 2011 13:26:35 +0100
Subject: [dev-context] \nonknuthmode breaks _ in protected mode
In-Reply-To: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
References: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
Message-ID: <4D494D7B.2000001@wxs.nl>

On 2-2-2011 10:43, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \nonknuthmode in core-def.mkiv breaks _ in modules:
>
> \starttext
>
> \the\catcode`\_
>
> \unprotect
> \the\catcode`\_
> \protect
>
> \the\catcode`\_
>
> \stoptext
>
> It helps when you enable \nonknuthmode with \everystarttext (or \everyjob), e.g.
>
> \appendtoks \nonknuthmode \to \everystarttext

so it's time to move the letter catcodes into the other catcode vectors

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Feb  2 13:37:43 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 2 Feb 2011 13:37:43 +0100
Subject: [dev-context] \nonknuthmode breaks _ in protected mode
In-Reply-To: <4D494D7B.2000001@wxs.nl>
References: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
	<4D494D7B.2000001@wxs.nl>
Message-ID: <DAB5DCC3-85A4-4040-B2A5-CED4FA468871@gmail.com>


Am 02.02.2011 um 13:26 schrieb Hans Hagen:

> so it's time to move the letter catcodes into the other catcode vectors

well, i thought to keep _ for internal names only but if users stick to camel case it should work to make _ letter

Wolfgang 

From pragma at wxs.nl  Wed Feb  2 13:39:20 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 02 Feb 2011 13:39:20 +0100
Subject: [dev-context] \nonknuthmode breaks _ in protected mode
In-Reply-To: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
References: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
Message-ID: <4D495078.1080708@wxs.nl>

On 2-2-2011 10:43, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \nonknuthmode in core-def.mkiv breaks _ in modules:
>
> \starttext
>
> \the\catcode`\_
>
> \unprotect
> \the\catcode`\_
> \protect
>
> \the\catcode`\_
>
> \stoptext
>
> It helps when you enable \nonknuthmode with \everystarttext (or \everyjob), e.g.
>
> \appendtoks \nonknuthmode \to \everystarttext

ah, interesting, indeed it changes the catcodes in the wrong vector

\def\nonknuthmode
   {\pushcatcodes
    \setcatcodetable\ctxcatcodes
    \the\everynonknuthmode
    \let\nonknuthmode\relax
    \popcatcodes}

\def\donknuthmode
   {\pushcatcodes
    \setcatcodetable\ctxcatcodes
    \the\everydonknuthmode
    \popcatcodes}

is better


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Feb  2 13:59:04 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 02 Feb 2011 13:59:04 +0100
Subject: [dev-context] \nonknuthmode breaks _ in protected mode
In-Reply-To: <DAB5DCC3-85A4-4040-B2A5-CED4FA468871@gmail.com>
References: <35ECE334-B5C3-4ED1-9C47-F5EAB36D8CEC@gmail.com>
	<4D494D7B.2000001@wxs.nl>
	<DAB5DCC3-85A4-4040-B2A5-CED4FA468871@gmail.com>
Message-ID: <4D495518.6070608@wxs.nl>

On 2-2-2011 1:37, Wolfgang Schuster wrote:
>
> Am 02.02.2011 um 13:26 schrieb Hans Hagen:
>
>> so it's time to move the letter catcodes into the other catcode vectors
>
> well, i thought to keep _ for internal names only but if users stick to camel case it should work to make _ letter

no, 'other', as it is supposed to be a normal symbol in regular ctx 
mode; so, unprotect sets _ to letter temporary

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Feb  8 00:05:54 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 08 Feb 2011 00:05:54 +0100
Subject: [dev-context] beta
Message-ID: <4D507AD2.401@wxs.nl>

Hi,

I uploaded a beta to the ftp server. Changes are:

-- cleaned up logging, consistently using logs.new
-- this makes it possible to disable log categories (using --silent or 
using directive logs.blocked)
-- cleaned up regime code (also a hack to force loading under utf)
-- as a side effect some code moved to lfg files

I probably made some types as logging happens all over the place.  I 
hope that it does not break third party modules.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Wed Feb  9 10:17:07 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 9 Feb 2011 10:17:07 +0100
Subject: [dev-context] context installation/setup/texmfcnf.lua
Message-ID: <AANLkTinnLZR1yXzgwPd3hs3Q_FtVHny7tsL9QPJtJzwi@mail.gmail.com>

Hans,

I was away for a while. What exactly is the current status of ConTeXt
beta and what exactly do I need to change? Is the change for
"selfautoparent:" ready now? Is there anything else that I should do
right away?

Mojca

From pragma at wxs.nl  Wed Feb  9 14:53:37 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 09 Feb 2011 14:53:37 +0100
Subject: [dev-context] context installation/setup/texmfcnf.lua
In-Reply-To: <AANLkTinnLZR1yXzgwPd3hs3Q_FtVHny7tsL9QPJtJzwi@mail.gmail.com>
References: <AANLkTinnLZR1yXzgwPd3hs3Q_FtVHny7tsL9QPJtJzwi@mail.gmail.com>
Message-ID: <4D529C61.9060206@wxs.nl>

On 9-2-2011 10:17, Mojca Miklavec wrote:

> I was away for a while. What exactly is the current status of ConTeXt

Ah, therefore the silence.

> beta and what exactly do I need to change? Is the change for
> "selfautoparent:" ready now? Is there anything else that I should do
> right away?

The self stuff is already in the scripts. I think that you can just 
replace texmfcnf.lua by contextcnf.lua.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Feb  9 15:37:32 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 09 Feb 2011 15:37:32 +0100
Subject: [dev-context] modules
Message-ID: <4D52A6AC.1030607@wxs.nl>

Hi,

Something new. If you add a section like this in a module:

% begin info
%
% title   : show character data
%
% comment : show some info about characters in the character database
% status  : experimental, used for luatex testing
%
% end info

context --modules

will report this. It only works with modules in the trees (the path 
where context.mkiv sits is also taken as I want my dev path to be 
included).

Another 'change' is in messaging. Eventually all messages will be 
redone, but we will have a transition stage. See mult-mes.lua for how it 
will be (currently a hybrid approach). I will post some more about this 
later.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Feb  9 16:23:14 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 9 Feb 2011 16:23:14 +0100
Subject: [dev-context] modules
In-Reply-To: <4D52A6AC.1030607@wxs.nl>
References: <4D52A6AC.1030607@wxs.nl>
Message-ID: <7086F7D3-D515-460F-A495-FA5CBC71E806@gmail.com>


Am 09.02.2011 um 15:37 schrieb Hans Hagen:

> Hi,
> 
> Something new. If you add a section like this in a module:
> 
> % begin info
> %
> % title   : show character data
> %
> % comment : show some info about characters in the character database
> % status  : experimental, used for luatex testing
> %
> % end info
> 
> context --modules
> 
> will report this. It only works with modules in the trees (the path where context.mkiv sits is also taken as I want my dev path to be included).

Does not work when the module has ?mkvi? as file extension.

Wolfgang


From pragma at wxs.nl  Wed Feb  9 16:40:04 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 09 Feb 2011 16:40:04 +0100
Subject: [dev-context] modules
In-Reply-To: <7086F7D3-D515-460F-A495-FA5CBC71E806@gmail.com>
References: <4D52A6AC.1030607@wxs.nl>
	<7086F7D3-D515-460F-A495-FA5CBC71E806@gmail.com>
Message-ID: <4D52B554.5060003@wxs.nl>

On 9-2-2011 4:23, Wolfgang Schuster wrote:
>
> Am 09.02.2011 um 15:37 schrieb Hans Hagen:
>
>> Hi,
>>
>> Something new. If you add a section like this in a module:
>>
>> % begin info
>> %
>> % title   : show character data
>> %
>> % comment : show some info about characters in the character database
>> % status  : experimental, used for luatex testing
>> %
>> % end info
>>
>> context --modules
>>
>> will report this. It only works with modules in the trees (the path where context.mkiv sits is also taken as I want my dev path to be included).
>
> Does not work when the module has ?mkvi? as file extension.

ok, i'll add that

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Wed Feb  9 18:16:58 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 9 Feb 2011 18:16:58 +0100
Subject: [dev-context] modules
In-Reply-To: <4D52A6AC.1030607@wxs.nl>
References: <4D52A6AC.1030607@wxs.nl>
Message-ID: <AANLkTi=6e2Fjb3=PiFMs7Vyhw2GGnLmuZ7JkN8xjLmMZ@mail.gmail.com>

On Wed, Feb 9, 2011 at 15:37, Hans Hagen wrote:
> Hi,
>
> Something new. If you add a section like this in a module:
>
> % begin info
> %
> % title ? : show character data
> %
> % comment : show some info about characters in the character database
> % status ?: experimental, used for luatex testing
> %
> % end info
>
> context --modules
>
> will report this. It only works with modules in the trees (the path where
> context.mkiv sits is also taken as I want my dev path to be included).

How exactly does this work? If I modify t-gnuplot.tex by adding this
after the header, it doesn't make any difference. (What command do I
need to run to make ConTeXt aware of the change in sources? mtxrun
--generate?)

Mojca

From schuster.wolfgang at googlemail.com  Wed Feb  9 18:42:10 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 9 Feb 2011 18:42:10 +0100
Subject: [dev-context] modules
In-Reply-To: <AANLkTi=6e2Fjb3=PiFMs7Vyhw2GGnLmuZ7JkN8xjLmMZ@mail.gmail.com>
References: <4D52A6AC.1030607@wxs.nl>
	<AANLkTi=6e2Fjb3=PiFMs7Vyhw2GGnLmuZ7JkN8xjLmMZ@mail.gmail.com>
Message-ID: <49E4AE9D-1CDD-4339-96A0-7C69BBDDF481@gmail.com>


Am 09.02.2011 um 18:16 schrieb Mojca Miklavec:

> On Wed, Feb 9, 2011 at 15:37, Hans Hagen wrote:
>> Hi,
>> 
>> Something new. If you add a section like this in a module:
>> 
>> % begin info
>> %
>> % title   : show character data
>> %
>> % comment : show some info about characters in the character database
>> % status  : experimental, used for luatex testing
>> %
>> % end info
>> 
>> context --modules
>> 
>> will report this. It only works with modules in the trees (the path where
>> context.mkiv sits is also taken as I want my dev path to be included).
> 
> How exactly does this work? If I modify t-gnuplot.tex by adding this
> after the header, it doesn't make any difference. (What command do I
> need to run to make ConTeXt aware of the change in sources? mtxrun
> --generate?)

mtxrun --generate
mtxrun --modules

Wolfgang


From mojca.miklavec.lists at gmail.com  Wed Feb  9 21:48:25 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 9 Feb 2011 21:48:25 +0100
Subject: [dev-context] context installation/setup/texmfcnf.lua
In-Reply-To: <4D529C61.9060206@wxs.nl>
References: <AANLkTinnLZR1yXzgwPd3hs3Q_FtVHny7tsL9QPJtJzwi@mail.gmail.com>
	<4D529C61.9060206@wxs.nl>
Message-ID: <AANLkTikKe9w8CN8tFLmzymbQ8ecMJk5A6z5Jb8Ssxnwn@mail.gmail.com>

On Wed, Feb 9, 2011 at 14:53, Hans Hagen <pragma at wxs.nl> wrote:
> On 9-2-2011 10:17, Mojca Miklavec wrote:
>
>> I was away for a while. What exactly is the current status of ConTeXt
>
> Ah, therefore the silence.
>
>> beta and what exactly do I need to change? Is the change for
>> "selfautoparent:" ready now? Is there anything else that I should do
>> right away?
>
> The self stuff is already in the scripts. I think that you can just replace
> texmfcnf.lua by contextcnf.lua.

OK. Just a few questions:

1.) [low priority] Is there some elegant way to assign
TEXMFHOME=home:Library/texmf just on Mac OS X? (Or maybe
TEXMFHOME={home:Library/texmf,home:texmf} would work ...)

2.) [higher priority] I don't know why, but until I deleted the old
caches entirely, I kept getting a weird long list of messages:

fonts           > defining > source file
'/Users/mojca/context/context-test/tex/texmf/fonts/opentype/public/lm/lmroman12-regular.otf'
is not found
fonts           > defining > using source file
'/Users/mojca/context/context-test2/tex/texmf/fonts/opentype/public/lm/lmroman12-regular.otf'
(cache mismatch)
fonts           > defining > source file
'/Users/mojca/context/context-test/tex/texmf/fonts/opentype/public/lm/lmroman7-regular.otf'
is not found
fonts           > defining > using source file
'/Users/mojca/context/context-test2/tex/texmf/fonts/opentype/public/lm/lmroman7-regular.otf'
(cache mismatch)
fonts           > defining > source file
'/Users/mojca/context/context-test/tex/texmf/fonts/type1/hoekwater/stmaryrd/stmary10.pfb'
is not found
fonts           > defining > using source file
'/Users/mojca/context/context-test2/tex/texmf/fonts/type1/hoekwater/stmaryrd/stmary10.pfb'
(cache mismatch)

3.) What exactly does the following information in contextcnf.lua stand for?

    version = "1.0.2",
    date    = "2010-06-07",
    time    = "14:49:00",

(format changes in an almost incompatible way ... but the version
stays the same :) :) :)

4.) I just realized that TEXMFEXTRA is present in MKII, but absent in
MKIV (that is probably why fixing the module didn't work earlier).
Would it make sense to unify that?

Mojca

From pragma at wxs.nl  Wed Feb  9 22:59:08 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 09 Feb 2011 22:59:08 +0100
Subject: [dev-context] context installation/setup/texmfcnf.lua
In-Reply-To: <AANLkTikKe9w8CN8tFLmzymbQ8ecMJk5A6z5Jb8Ssxnwn@mail.gmail.com>
References: <AANLkTinnLZR1yXzgwPd3hs3Q_FtVHny7tsL9QPJtJzwi@mail.gmail.com>	<4D529C61.9060206@wxs.nl>
	<AANLkTikKe9w8CN8tFLmzymbQ8ecMJk5A6z5Jb8Ssxnwn@mail.gmail.com>
Message-ID: <4D530E2C.9030807@wxs.nl>

On 9-2-2011 9:48, Mojca Miklavec wrote:

> OK. Just a few questions:
>
> 1.) [low priority] Is there some elegant way to assign
> TEXMFHOME=home:Library/texmf just on Mac OS X? (Or maybe
> TEXMFHOME={home:Library/texmf,home:texmf} would work ...)

We sort of expect home to be just one path .. I can imagine that we have

TEXMFHOME=home:{,Library}/texmf

and resolve that one in an early stage to the first valid path ... I 
have to play with this if really needed.

But, we can do this:

TEXMFHOME = os.name == "macosx" and "home:Library/texmf" or "home:texmf"

If this is working ok, I'll add it to contextcnf.lua.

> 2.) [higher priority] I don't know why, but until I deleted the old
> caches entirely, I kept getting a weird long list of messages:
>
> fonts>  defining>  source file
> '/Users/mojca/context/context-test/tex/texmf/fonts/opentype/public/lm/lmroman12-regular.otf'
> is not found
> fonts>  defining>  using source file
> '/Users/mojca/context/context-test2/tex/texmf/fonts/opentype/public/lm/lmroman12-regular.otf'
> (cache mismatch)
> fonts>  defining>  source file
> '/Users/mojca/context/context-test/tex/texmf/fonts/opentype/public/lm/lmroman7-regular.otf'
> is not found
> fonts>  defining>  using source file
> '/Users/mojca/context/context-test2/tex/texmf/fonts/opentype/public/lm/lmroman7-regular.otf'
> (cache mismatch)
> fonts>  defining>  source file
> '/Users/mojca/context/context-test/tex/texmf/fonts/type1/hoekwater/stmaryrd/stmary10.pfb'
> is not found
> fonts>  defining>  using source file
> '/Users/mojca/context/context-test2/tex/texmf/fonts/type1/hoekwater/stmaryrd/stmary10.pfb'
> (cache mismatch)

hm, there will be an old cache but the hash should be used, so it's 
somewhat weird

> 3.) What exactly does the following information in contextcnf.lua stand for?
>
>      version = "1.0.2",
>      date    = "2010-06-07",
>      time    = "14:49:00",
>
> (format changes in an almost incompatible way ... but the version
> stays the same :) :) :)

well, the older variant is still supported, i'll jump the number

> 4.) I just realized that TEXMFEXTRA is present in MKII, but absent in
> MKIV (that is probably why fixing the module didn't work earlier).
> Would it make sense to unify that?

no, let's forget about TEXMFEXTRA, it originates on older texlives where 
there was something with new stuff not yet in the main tree (some fonts 
if i remember right)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From oliver.buerschaper at mpq.mpg.de  Sun Feb 13 23:26:30 2011
From: oliver.buerschaper at mpq.mpg.de (Oliver Buerschaper)
Date: Sun, 13 Feb 2011 23:26:30 +0100
Subject: [dev-context] Automatic generation of filename database
Message-ID: <D593AEDF-C4D3-4517-BBC0-CD0B51BAF04E@mpq.mpg.de>

Hi,

it seems that the minimals have lost their ability to automatically generate the luatex filename database? now

mtxrun --generate

is needed (again) before anything else works. Formats are still generated automatically though.

I'm afraid I can't pin down when that change happened but it's present at least in

2011.02.11 18:18
2011.02.05 11:37

Would it be much work to (re)enable this? I'm aware that all things configuration files have undergone a massive overhaul recently but this feature would really be nice to have again :-)

Best,
Oliver

From mojca.miklavec.lists at gmail.com  Mon Feb 14 09:05:35 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 14 Feb 2011 09:05:35 +0100
Subject: [dev-context] Automatic generation of filename database
In-Reply-To: <D593AEDF-C4D3-4517-BBC0-CD0B51BAF04E@mpq.mpg.de>
References: <D593AEDF-C4D3-4517-BBC0-CD0B51BAF04E@mpq.mpg.de>
Message-ID: <AANLkTimEpRjQEDp_RUAwYw7Kyh6-Xb-v5L6mKbHwpbep@mail.gmail.com>

On Sun, Feb 13, 2011 at 23:26, Oliver Buerschaper wrote:
> Hi,
>
> it seems that the minimals have lost their ability to automatically generate the luatex filename database? now
>
> mtxrun --generate
>
> is needed (again) before anything else works. Formats are still generated automatically though.

Do you talk about the lost ability when running first-setup.sh or
something else? How do you update?
(mtxrun --generate was never automatic from what I remember; well, it
was in mtx-update, but it was updating the wrong tree)

I had some problems with updates after changes in texmfcnf.lua, but
after I deleted the cache, everything worked again. (But my problem
was slightly different than yours. It happened when renaming the
root.)

Mojca

From oliver.buerschaper at mpq.mpg.de  Mon Feb 14 11:38:47 2011
From: oliver.buerschaper at mpq.mpg.de (Oliver Buerschaper)
Date: Mon, 14 Feb 2011 11:38:47 +0100
Subject: [dev-context] Automatic generation of filename database
In-Reply-To: <AANLkTimEpRjQEDp_RUAwYw7Kyh6-Xb-v5L6mKbHwpbep@mail.gmail.com>
References: <D593AEDF-C4D3-4517-BBC0-CD0B51BAF04E@mpq.mpg.de>
	<AANLkTimEpRjQEDp_RUAwYw7Kyh6-Xb-v5L6mKbHwpbep@mail.gmail.com>
Message-ID: <70E4EA0A-E5B7-4B84-9274-B97D21E39B60@mpq.mpg.de>

>> it seems that the minimals have lost their ability to automatically generate the luatex filename database? now
>> 
>> mtxrun --generate
>> 
>> is needed (again) before anything else works. Formats are still generated automatically though.
> 
> Do you talk about the lost ability when running first-setup.sh or
> something else? How do you update?

Pardon me, I should have been more specific? it's not the update mechanism of the minimals itself, rather the behaviour of the (minimals) distribution. In detail:

1. The distribution is obtained (in the standard way?) by first rsyncing minimals/setup/osx-64/bin and then running mtx-update.lua from there. After cleaning up the local bin directory and status-of-update.lua this leaves me with a bare minimals distribution for the beta branch and osx-64 platform.

2. The configuration files are adapted in such a way that TEXMFCACHE points to a single directory which does not exist yet.

3. The problem occurs once the command "context" is first invoked. Previous versions generated the luatex filename database on demand, built the format if missing and then proceeded with normal compilation. Now a kick-start with "mtxrun --generate" is needed before "context" can automatically build the format and start typesetting.

Oliver

From pragma at wxs.nl  Tue Feb 22 00:27:14 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 22 Feb 2011 00:27:14 +0100
Subject: [dev-context] beta
Message-ID: <4D62F4D2.2040505@wxs.nl>

Hi,

For those with access to the ftp version ... I replaced the margin text 
code. There is now a split between

margindata
marginframed

The first takes care of placement, the second (when defined) adds framed 
support to it. See end of typo-mar.mkiv for definitions.

There is new stacking and offset code, alignment methods, new 
inner/outer code, name based overload etc. Basically all is written from 
scratch with the existing mechanism in mind. (One reason for the rewrite 
is that I needed some specific features myself.)

No documentation (of course). Lets first see if it breaks or fails. 
Still pretty beta so expect more the coming days. Probably not 
production code.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Wed Feb 23 23:26:24 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 Feb 2011 17:26:24 -0500 (EST)
Subject: [dev-context] modules
In-Reply-To: <4D52A6AC.1030607@wxs.nl>
References: <4D52A6AC.1030607@wxs.nl>
Message-ID: <alpine.LNX.2.01.1102231716380.1239@ybpnyubfg.ybpnyqbznva>

Hi Hans,

On Wed, 9 Feb 2011, Hans Hagen wrote:

> Something new. If you add a section like this in a module:
>
> % begin info
> %
> % title   : show character data
> %
> % comment : show some info about characters in the character database
> % status  : experimental, used for luatex testing
> %
> % end info
>
> context --modules
>
> will report this. It only works with modules in the trees (the path where 
> context.mkiv sits is also taken as I want my dev path to be included).

Can you add support for filtering the results? That is,

context --modules plot

should retun the help file of all modules that have "plot" in their 
filename (or if it is not too expensive, have plot in their description).

Also, some of this information is also part of \module[...] header in the 
beginning. Is it possible to merge the two? That is, can I just write:

%I title: ....
%I author: ....
%I email: ....
%I version: ...
%I license: ...
%I copyright: ...
%I comment: ...
%I status: ...

Then, if I run

context --modules filter

I will see the above information, and if I run

mtxrun --script modules --process t-filter.tex

the above info will be converted to

\module
   [title=....,
    author=....,
    ....]

at the top of the ted file.

Aditya

From pragma at wxs.nl  Fri Feb 25 22:32:37 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 25 Feb 2011 22:32:37 +0100
Subject: [dev-context] modules
In-Reply-To: <alpine.LNX.2.01.1102231716380.1239@ybpnyubfg.ybpnyqbznva>
References: <4D52A6AC.1030607@wxs.nl>
	<alpine.LNX.2.01.1102231716380.1239@ybpnyubfg.ybpnyqbznva>
Message-ID: <4D681FF5.40001@wxs.nl>

On 23-2-2011 11:26, Aditya Mahajan wrote:
> Hi Hans,
>
> On Wed, 9 Feb 2011, Hans Hagen wrote:
>
>> Something new. If you add a section like this in a module:
>>
>> % begin info
>> %
>> % title : show character data
>> %
>> % comment : show some info about characters in the character database
>> % status : experimental, used for luatex testing
>> %
>> % end info
>>
>> context --modules
>>
>> will report this. It only works with modules in the trees (the path
>> where context.mkiv sits is also taken as I want my dev path to be
>> included).
>
> Can you add support for filtering the results? That is,
>
> context --modules plot
>
> should retun the help file of all modules that have "plot" in their
> filename (or if it is not too expensive, have plot in their description).
>
> Also, some of this information is also part of \module[...] header in
> the beginning. Is it possible to merge the two? That is, can I just write:
>
> %I title: ....
> %I author: ....
> %I email: ....
> %I version: ...
> %I license: ...
> %I copyright: ...
> %I comment: ...
> %I status: ...
>
> Then, if I run
>
> context --modules filter
>
> I will see the above information, and if I run
>
> mtxrun --script modules --process t-filter.tex
>
> the above info will be converted to
>
> \module
> [title=....,
> author=....,
> ....]
>
> at the top of the ted file.

I have been thinking about that, but it would come from the begin info 
section then (or do you propose to make %I equivalent to the info 
section? Thinking of it we could have multiple info sections so that you 
can spread help over the file if it make sense. Anyhow, it needs a bit 
of thinking as I want to keep it clean.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Wed Mar  2 13:47:45 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 2 Mar 2011 14:47:45 +0200
Subject: [dev-context] Can't use OTF font with more than 1000 em units
Message-ID: <20110302124744.GA9562@khaled-laptop>

With last betas (minimals) I can't use CFF flavoured OpenType fonts with
more than 1000 em units, the backed reports the error:

!LuaTeX error (file /pth/to/file.otf): Invalid font type

It appears this error is reported when luatex encounters a non TTF
flavoured font when it expects one (a more explicit error message or at
least reporting the invalid type would be more helpful, I think).

Checking ConTeXt, I see in font-otf.lua:

if units > 1000  then
   fileformat = "truetype"
end

Which IMO don't make sense at all since CFF fonts can very well have >
1000 em units. I think this was to work around the bug reported earlier
about TTF fonts with .otf file extension, but this is likely to break
more other fonts. Renaming the other font is easier, meanwhile neither
file extension nor em units is a reliable way to detect spline type
(which I think is already known, since Taco has a tracker item for
that).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From pragma at wxs.nl  Wed Mar  2 16:04:34 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 02 Mar 2011 16:04:34 +0100
Subject: [dev-context] Can't use OTF font with more than 1000 em units
In-Reply-To: <20110302124744.GA9562@khaled-laptop>
References: <20110302124744.GA9562@khaled-laptop>
Message-ID: <4D6E5C82.3070307@wxs.nl>

On 2-3-2011 1:47, Khaled Hosny wrote:
> With last betas (minimals) I can't use CFF flavoured OpenType fonts with
> more than 1000 em units, the backed reports the error:
>
> !LuaTeX error (file /pth/to/file.otf): Invalid font type
>
> It appears this error is reported when luatex encounters a non TTF
> flavoured font when it expects one (a more explicit error message or at
> least reporting the invalid type would be more helpful, I think).
>
> Checking ConTeXt, I see in font-otf.lua:
>
> if units>  1000  then
>     fileformat = "truetype"
> end
>
> Which IMO don't make sense at all since CFF fonts can very well have>
> 1000 em units. I think this was to work around the bug reported earlier
> about TTF fonts with .otf file extension, but this is likely to break
> more other fonts. Renaming the other font is easier, meanwhile neither
> file extension nor em units is a reliable way to detect spline type
> (which I think is already known, since Taco has a tracker item for
> that).

ok, so we can assume that the backend will deal with it and stay away 
from checking at the frontend, in the meantime we advise users to rename

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Mar 13 23:51:33 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Mar 2011 00:51:33 +0200
Subject: [dev-context] Math accents
Message-ID: <20110313225133.GA11874@khaled-laptop>

Math accents seems to be broken in all OpenType math fonts:

* wide accents don't show at all; ConTeXt is looking for non-existent
  characters (U+FE302 for example).
* regular accents don't work with Asana because ConTeXt is looking for
  the spacing accents which it does not have

I think this is left over from the hack of using modifier accents for
non-growing ones and combining accents for the growing.

Now since luatex introduced new keywords to handle this, I propose that
all math accents use the combining accents (which is the right thing
to do for all fonts any way) and non growing one would use the new
"fixed" keyword.

Attached a simple test file.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab
-------------- next part --------------
A non-text attachment was scrubbed...
Name: accents.tex
Type: text/x-tex
Size: 320 bytes
Desc: not available
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20110314/9c065cce/attachment.tex>

From pragma at wxs.nl  Fri Mar 18 14:22:49 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Mar 2011 14:22:49 +0100
Subject: [dev-context] beta
Message-ID: <4D835CA9.1000207@wxs.nl>

Hi,

For those with ftp access .. the new beta version there is somewhat 
experimental as I rewrote some of the (lua) font code

- alternative basemode definitions (context only, experimental)
- cleaned up node mode initialization
- less memory usage due to adapted data structures
- a bit smaller files in the cache
- some speedup due to more efficient accessibility
- different organization and carry-over of tfm information

There will probably be some more changes but I would not be surprised if 
certain features don't work. This is no big deal and mostly a matter of 
wrong data access then as nothing changed in the otf processing itself.

No testing has been done for the generic variant. This will happen when 
I'm satisfied with the changes. As the information available in the tfm 
instance is organized differently one can expect that code that uses it 
has to be adapted. Anyhow, even after we publish a new beta it is 
probably good to wait with adapting generic usage till we are stable 
again.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Fri Mar 18 14:42:01 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 18 Mar 2011 15:42:01 +0200
Subject: [dev-context] beta
In-Reply-To: <4D835CA9.1000207@wxs.nl>
References: <4D835CA9.1000207@wxs.nl>
Message-ID: <20110318134201.GA6062@khaled-laptop>

On Fri, Mar 18, 2011 at 02:22:49PM +0100, Hans Hagen wrote:
> Hi,
> 
> For those with ftp access .. the new beta version there is somewhat
> experimental as I rewrote some of the (lua) font code
> 
> - alternative basemode definitions (context only, experimental)
> - cleaned up node mode initialization

No time for testing, but a suggestion I'd for a while: currently
features supported in base mode need to be registered explicitly based
on assumption that certain features tags will be used with lookup types
supported in base mode. But in practice a feature tag can contain any
lookup, e.g. I know fonts that use contextual alternates under 'liga'
tag. My suggestion is to allow any feature tag in base mode and then
check the actual type of the registered lookups (which might already be
the case).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From pragma at wxs.nl  Fri Mar 18 14:58:23 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Mar 2011 14:58:23 +0100
Subject: [dev-context] beta
In-Reply-To: <20110318134201.GA6062@khaled-laptop>
References: <4D835CA9.1000207@wxs.nl> <20110318134201.GA6062@khaled-laptop>
Message-ID: <4D8364FF.4000806@wxs.nl>

On 18-3-2011 2:42, Khaled Hosny wrote:
> On Fri, Mar 18, 2011 at 02:22:49PM +0100, Hans Hagen wrote:
>> Hi,
>>
>> For those with ftp access .. the new beta version there is somewhat
>> experimental as I rewrote some of the (lua) font code
>>
>> - alternative basemode definitions (context only, experimental)
>> - cleaned up node mode initialization
>
> No time for testing, but a suggestion I'd for a while: currently
> features supported in base mode need to be registered explicitly based
> on assumption that certain features tags will be used with lookup types
> supported in base mode. But in practice a feature tag can contain any
> lookup, e.g. I know fonts that use contextual alternates under 'liga'
> tag. My suggestion is to allow any feature tag in base mode and then
> check the actual type of the registered lookups (which might already be
> the case).

this is somewhat tricky as basemode is a frozen approach: we set up the 
ligatures once and no real analysis later on takes place

indeed checking takes place so in principle any feature that has 
ligature, alternate of substitution is dealt with;

of course it's no problem to enable 'all' features in basemode, as long 
as we let complaints about funny side effects go into the void; i'll 
have to think about how to provide that variant efficiently

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Fri Mar 18 15:16:17 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 18 Mar 2011 16:16:17 +0200
Subject: [dev-context] beta
In-Reply-To: <4D8364FF.4000806@wxs.nl>
References: <4D835CA9.1000207@wxs.nl> <20110318134201.GA6062@khaled-laptop>
	<4D8364FF.4000806@wxs.nl>
Message-ID: <20110318141616.GA6864@khaled-laptop>

On Fri, Mar 18, 2011 at 02:58:23PM +0100, Hans Hagen wrote:
> On 18-3-2011 2:42, Khaled Hosny wrote:
> >On Fri, Mar 18, 2011 at 02:22:49PM +0100, Hans Hagen wrote:
> >>Hi,
> >>
> >>For those with ftp access .. the new beta version there is somewhat
> >>experimental as I rewrote some of the (lua) font code
> >>
> >>- alternative basemode definitions (context only, experimental)
> >>- cleaned up node mode initialization
> >
> >No time for testing, but a suggestion I'd for a while: currently
> >features supported in base mode need to be registered explicitly based
> >on assumption that certain features tags will be used with lookup types
> >supported in base mode. But in practice a feature tag can contain any
> >lookup, e.g. I know fonts that use contextual alternates under 'liga'
> >tag. My suggestion is to allow any feature tag in base mode and then
> >check the actual type of the registered lookups (which might already be
> >the case).
> 
> this is somewhat tricky as basemode is a frozen approach: we set up
> the ligatures once and no real analysis later on takes place
> 
> indeed checking takes place so in principle any feature that has
> ligature, alternate of substitution is dealt with;
> 
> of course it's no problem to enable 'all' features in basemode, as
> long as we let complaints about funny side effects go into the void;
> i'll have to think about how to provide that variant efficiently

My real use case is that I've stylistic sets that I need to use in base
mode (for math) but I need to manually register ss01..ss20 features in
base mode first though they all are gsub_single lookups, so if context
would simply check if the feature is gsub_single (or gpos_pair etc.) and
reject it if not, it would be more efficient than hand picking certain
features as the check will be done anyway.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From pragma at wxs.nl  Fri Mar 18 15:24:28 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Mar 2011 15:24:28 +0100
Subject: [dev-context] beta
In-Reply-To: <20110318141616.GA6864@khaled-laptop>
References: <4D835CA9.1000207@wxs.nl> <20110318134201.GA6062@khaled-laptop>
	<4D8364FF.4000806@wxs.nl> <20110318141616.GA6864@khaled-laptop>
Message-ID: <4D836B1C.5040002@wxs.nl>

On 18-3-2011 3:16, Khaled Hosny wrote:

> My real use case is that I've stylistic sets that I need to use in base
> mode (for math) but I need to manually register ss01..ss20 features in
> base mode first though they all are gsub_single lookups, so if context
> would simply check if the feature is gsub_single (or gpos_pair etc.) and
> reject it if not, it would be more efficient than hand picking certain
> features as the check will be done anyway.

indeed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sun Mar 20 08:59:21 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 20 Mar 2011 08:59:21 +0100
Subject: [dev-context] Bug: node-rul.mkiv
Message-ID: <39D6CF66-4468-45D1-9A81-2FC23F40F8B6@gmail.com>

Hi Hans,

missing namespaces in the parent keys

\def\dodefinebar[#1][#2][#3]%
  {\ifthirdargument
-    \getparameters[\??on#1][\s!parent=#2,#3]%
+    \getparameters[\??on#1][\s!parent=\??on#2,#3]%
   \else
-    \getparameters[\??on#1][\s!parent=,#2]%
+    \getparameters[\??on#1][\s!parent=\??on,#2]%
   \fi
   %
   %\setvalue{\??on:#1}{0}%
   %
   \ifcsname\??on:#1:c\endcsname
     \csname\??on:#1:c\endcsname\zerocount
   \else
     \expandafter\newcount\csname\??on:#1:c\endcsname
   \fi
   \normalexpanded{\checkalldefinedbars{\noexpand\doredefinebar{#1}\the\checkalldefinedbars}}%
   \dodefinebarindeed{#1}%
   \setuvalue{#1}{\doruled{#1}}}

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Mar 20 09:04:15 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 20 Mar 2011 09:04:15 +0100
Subject: [dev-context] Bug: strc-syn.mkiv
Message-ID: <EEC72D9B-0415-4275-AC18-5BAB86EAA4C9@gmail.com>

Hi,

wrong name for \doplacelistofsorts (\do is missing) and missing \unexpanded for \completelistofsorts

- \unexpanded\def\placelistofsorts[#1][#2]% NOG EEN RUWE VERSIE MAKEN ZONDER WITRUIMTE ETC ETC
+ \def\doplacelistofsorts[#1][#2]%
  {\begingroup
   \def\currentsorting{#1}%
   \getparameters[\??so#1][#2]%
   \startpacked
     \ctxlua{structures.synonyms.process('#1',{
        criterium = "\sortingparameter\c!criterium",
        language  = "\sortingparameter\s!language",
        method    = "\sortingparameter\c!method",
     })}%
   \stoppacked
   \endgroup}

- \def\completelistofsorts
+ \unexpanded\def\completelistofsorts
  {\dodoubleempty\docompletelistofsorts}

Wolfgang


From pragma at wxs.nl  Sun Mar 20 14:08:25 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 20 Mar 2011 14:08:25 +0100
Subject: [dev-context] Bug: strc-syn.mkiv
In-Reply-To: <EEC72D9B-0415-4275-AC18-5BAB86EAA4C9@gmail.com>
References: <EEC72D9B-0415-4275-AC18-5BAB86EAA4C9@gmail.com>
Message-ID: <4D85FC49.9080308@wxs.nl>

On 20-3-2011 9:04, Wolfgang Schuster wrote:

> wrong name for \doplacelistofsorts (\do is missing) and missing \unexpanded for \completelistofsorts

ok fixed,

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Mar 20 14:10:09 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 20 Mar 2011 14:10:09 +0100
Subject: [dev-context] Bug: node-rul.mkiv
In-Reply-To: <39D6CF66-4468-45D1-9A81-2FC23F40F8B6@gmail.com>
References: <39D6CF66-4468-45D1-9A81-2FC23F40F8B6@gmail.com>
Message-ID: <4D85FCB1.2060301@wxs.nl>

On 20-3-2011 8:59, Wolfgang Schuster wrote:

> \def\dodefinebar[#1][#2][#3]%
>    {\ifthirdargument
> -    \getparameters[\??on#1][\s!parent=#2,#3]%
> +    \getparameters[\??on#1][\s!parent=\??on#2,#3]%
>     \else
> -    \getparameters[\??on#1][\s!parent=,#2]%
> +    \getparameters[\??on#1][\s!parent=\??on,#2]%

fixed ... in the next beta (on ftp, probably later today) ... i made 
framedtexts also using the parent chain so it probably needs checking (i 
also had to patch the placement code to do inheritance)

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Apr  1 08:40:45 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 1 Apr 2011 08:40:45 +0200
Subject: [dev-context] \definenamespace
Message-ID: <15FFB7D5-6DF4-4C4D-9E38-3C354CB55CDD@googlemail.com>

Hi Hans,

the \definenamespace command don?t use the \installparametersethandler command, can you add it because i need the generated \let...parameter in a module.

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Apr  3 18:27:33 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 3 Apr 2011 18:27:33 +0200
Subject: [dev-context] \definenamespace
In-Reply-To: <4D985A5D.8090908@wxs.nl>
References: <15FFB7D5-6DF4-4C4D-9E38-3C354CB55CDD@googlemail.com>
	<4D985A5D.8090908@wxs.nl>
Message-ID: <5C8D910A-56B6-4990-A1A4-3B347D24EA92@googlemail.com>


Am 03.04.2011 um 13:30 schrieb Hans Hagen:

> On 1-4-2011 8:40, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> the \definenamespace command don?t use the \installparametersethandler command, can you add it because i need the generated \let...parameter in a module.
> ok

Thanks but there is a typo in mult-aux.lua:

    local set = ns.set
    if set == v_yes then
-       context.installsethandler(self,name)
+       context.installparametersethandler(self,name)
        if trace_namespaces then
            report_namespaces("installing set/let/reset command for '%s' (single)",name)
        end
    elseif set == v_list then
-       context.installsethandler(self,name)
+       context.installparametersethandler(self,name)
        if trace_namespaces then
            report_namespaces("installing set/let/reset command for '%s' (multiple)",name)
        end
    end

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Apr  3 19:56:37 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 3 Apr 2011 19:56:37 +0200
Subject: [dev-context] scrn-pag.mkvi
Message-ID: <EA316546-34E9-4789-865F-AA5777401F2A@googlemail.com>

Hi Hans,

shouldn?t the result for Lua from the delay key be 0 or 1?

\def\scrn_transitions_set_indeed
  {\begingroup
   \edef\currentinteractionscreendelay{\interactionscreenparameter\c!delay}%
   \ctxcommand{setpagetransition{
      n     = "\scrn_transitions_list",
      delay = "\ifx\currentinteractionscreendelay\v!none 0\else\currentinteractionscreendelay\v!none\fi"
   }}%
   \endgroup}

Wolfgang


From schuster.wolfgang at googlemail.com  Thu Apr  7 15:37:35 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 7 Apr 2011 15:37:35 +0200
Subject: [dev-context] x-set-11.mkiv
Message-ID: <503966DB-AB6E-4A79-9A3C-15CA4DF0567C@googlemail.com>

Hi Hans,

there are two \enabblemode?s missing.

\startxmlsetups xml:setups:typeset
    \getvalue{\e!start setuptext}
        \tttf
        \nohyphens
        \veryraggedright
        \doglobal\newcounter\currentSETUPargument
        \xdef\maximumSETUPargument{\xmlcount{#1}{/arguments/*}}
        \bgroup
+           \enablemode[setups-pass-one]
            \doif {\xmlatt{#1}{generated}} {yes} {
                \ttsl
            }
            \doifelse {\xmlatt{#1}{type}} {environment} {
                \tex{\e!start}
            } {
                \tex{}
            }
            \xmlfilter{#1}{/sequence/first()}
            \ignorespaces
        \egroup
        \xmldoif{#1}{/arguments} {
            \bgroup
+               \enablemode[setups-pass-one]
                \doglobal\newcounter\currentSETUPargument
                \ignorespaces
                \xmlfilter{#1}{/arguments/text()}
            \egroup
        }
        \doif {\xmlatt{#1}{type}} {environment} {
            \bgroup
                \enablemode[setups-pass-one]
                \hskip.5em\unknown\hskip.5em
                \doif {\xmlatt{#1}{generated}} {yes} {
                    \ttsl
                }
                \tex{\e!stop}
                \xmlfilter{#1}{/sequence/first()}
                \ignorespaces
            \egroup
        }
        \endgraf
        \xmldoif{#1}{/arguments} {
            \bgroup
                \enablemode[setups-pass-two]
                \doglobal\newcounter\currentSETUPargument
                \blank[\v!line]
                \switchtobodyfont[small]
                \ignorespaces\xmlfilter{#1}{/arguments/text()}\endgraf
            \egroup
        }
    \getvalue{\e!stop setuptext}
\stopxmlsetups


What?s also missing is support for the ?generated? and ?variant? attributes, the code below doesn?t work but it shows what is missing.

%\def\showsetupindeed#1%
%  {\xmlfilterlist{\loadedsetups}{/interface/command['#1' == (@type=='environment' and 'start' or '') .. @name]/command(xml:setups:typeset)}}

\def\showsetupindeed#1%
  {\xmlfilterlist{\loadedsetups}{/interface/command['#1' == (@type=='environment' and 'start' or '') .. @name .. (@generated=='yes' and '*' or '') .. (@variant~='' and ':@variant' or '')]/command(xml:setups:typeset)}}


<cd:command name="framedtext">                                            -> \showsetups{framedtext}
<cd:command name="framedtext"  type="environment">                        -> \showsetups{startframedtext}
<cd:command name="framedtext" generated="yes">                            -> \showsetups{framedtext*}
<cd:command name="framedtext" type="environment" generated="yes">         -> \showsetups{startframedtext*}
<cd:command name="interlinespace" variant="1">                            -> \showsetups{setupinterlinespace:1}
<cd:command name="typing" type="environment" generated="yes" variant="1"> -> \showsetups{starttyping*:1}


Wolfgang


From schuster.wolfgang at googlemail.com  Thu Apr  7 20:22:48 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 7 Apr 2011 20:22:48 +0200
Subject: [dev-context] MkVI: Delimited Arguments
Message-ID: <D87B9FAD-58C5-44B9-837D-99DBB31EF3C2@googlemail.com>

Hi Hans,

the following example fails with named parameters, is this a limitation of mkvi?

% macros=mkvi

\def\definefoo[#1]%
 {\setvalue{start#1}{\dostartfoo{#1}}}

\def\dostartfoo#1%
 {\normalexpanded{\def\noexpand\next##1\expandafter\noexpand\csname stop#1\endcsname}{#1 : ##1}%
  \next}

%\def\definefoo[#name]%
%  {\setvalue{start#name}{\dostartfoo{#name}}}
%
%\def\dostartfoo#name%
%  {\normalexpanded{\def\noexpand\next#content\expandafter\noexpand\csname stop#name\endcsname}{#name : #content}%
%   \next}

\starttext

\definefoo[foo]

\startfoo bar\stopfoo

\stoptext

Wolfgang


From schuster.wolfgang at googlemail.com  Thu Apr  7 21:38:54 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 7 Apr 2011 21:38:54 +0200
Subject: [dev-context] MkVI: Delimited Arguments
In-Reply-To: <4D9E0C8F.5060503@wxs.nl>
References: <D87B9FAD-58C5-44B9-837D-99DBB31EF3C2@googlemail.com>
	<4D9E0C8F.5060503@wxs.nl>
Message-ID: <6218C24E-E3C4-46B2-B61E-94295322B4F4@googlemail.com>


Am 07.04.2011 um 21:12 schrieb Hans Hagen:

> it's the \normalexpanded{ } ... i could probably catch that but i wonder if we should go that route

Should i then use in this case TeX?s normal numbered arguments. It?s no big deal
because i have this odd case only at one place in my annotation module where
i grab the content between from a environment.

Wolfgang


From schuster.wolfgang at googlemail.com  Sat Apr  9 07:45:49 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 9 Apr 2011 07:45:49 +0200
Subject: [dev-context] spac-ali.mkiv
Message-ID: <6A97EDEA-8808-42B3-AB02-B29EE2E692F8@googlemail.com>

Hi,

the \setraggedparagraphmode command miss a few \expandafter

% \def\setraggedparagraphmode
%   {\doifrightpageelse
%      {\ifdoublesided\signalinnerrealign\firstoftwoarguments \fi}
%      {\ifdoublesided\signalouterrealign\secondoftwoarguments\fi}}

\def\setraggedparagraphmode
  {\doifrightpageelse
     {\ifdoublesided\signalinnerrealign\expandafter\firstoftwoarguments \fi}
     {\ifdoublesided\signalouterrealign\expandafter\secondoftwoarguments\fi}}

Wolfgang


From adityam at umich.edu  Sat Apr  9 21:23:49 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 9 Apr 2011 15:23:49 -0400 (EDT)
Subject: [dev-context] newpair in mp-tool
Message-ID: <alpine.LNX.2.01.1104091522250.3220@ybpnyubfg.ybpnyqbznva>

Hans,

Should the following be added to mp-tool for completeness?

def newpair    text v = forsuffixes i=v : save i ; pair    i ; endfor ; enddef ;

Aditya


From taco at elvenkind.com  Tue Apr 12 14:29:36 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 12 Apr 2011 14:29:36 +0200
Subject: [dev-context] Luatex 0.66.0 announcement
Message-ID: <4DA445B0.2040006@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.66.0.

This release has ongoing work on the 'epdf' lua interface by
Hartmut (and that interface now has documentation as well). Besides
that, the release fixes a number of the bugs that have been reported
over the past months (mostly the smaller/easier ones).

Luatex 0.66.0 will be the last release in the 0.6X series. The next
release will be luatex 0.70.0;that will be the version on texlive 2011.

Expect no major differences there either, the tracker has just
a few items remaining for 0.70.0. Over the last half year, I personally
have been much too busy with MetaPost to do any real work on luatex,
hence the somewhat disappointing amount of feature progress.

I have uploaded the 0.66.0 base package to tlcontrib as well, but
please give the builders a few days to create actual platform-
specific binaries.

News:

* fixed: linebreak_filter doesn't do its default job when
   tex.linebreak is used

* fixed: \escapechar ignored by \meaning

* fixed: wrong px default

* fixed: font kern attribute inheritance

* fixed: "nop" unrecognized in virtual fonts

* fixed: assertion failure in dviluatex when font ptmr8t used

* fixed: tex.settoks for with strings with embedded zeroes

* fixed: an indexing problem with nonexistent font glyphs

* fixed: some crashes and other bugs on the 'subtype' and 'prev'
   fields (not all node types have those fields)

* fixed: crash on  token.csname_id ("")

* fixed: initialize the statically allocated node's type ids

* fixed: fencepost error in math parameter counting

* fixed: math family numbers > 255 are allowed

* fixed: compilation failure on Hurd

* fixed: a small bug leading to displacements when reading
   the AccentTop table

* fixed: \directlua followed by \pdfximage generates error if
   draft mode is active

* fixed: a problem with \vadjust pre in alignments

* fixed: a lua stack growing problem in the backend in 0.65.0,
   resulting in an inability to create more than a few thousand
   generated pages

* fixed: inclusion of Scribus-generated pdfs

* adapt: the default form margin is now zero (was 1bp before)

* adapt: libpng 1.4.4, zzuplib 0.13.60, mplib 1.504

* adapt: small changes to the build system and new imports from
   the texlive repository

* feature: new function node.currentattr() queries the current
   active attribute list

* feature: Lua font loading; ignore unknown enumeration keys in
   MathConstants

* feature: JPEG 2000 image support

* feature: continuing work on the 'epdf' library

* doc: the 'epdf' lua library is now documented

* doc: various other manual corrections


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.66.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From schuster.wolfgang at googlemail.com  Sat Apr 16 16:13:19 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 16 Apr 2011 16:13:19 +0200
Subject: [dev-context] DefaultFont
Message-ID: <6CF4433F-65A6-41AA-9941-DC1C3914BBC0@googlemail.com>

Hi Hans,

can you change the defintion of DefaultFont because it doesn?t work when you apply font features to it:

\starttext
\definedfont[DefaultFont]DefaultFont % works
%\definedfont[DefaultFont*default]DefaultFont % breaks
\stoptext


type-set.mkiv

- \definefontsynonym [DefaultFont] [cmvtt10]
+ \definefontsynonym [DefaultFont] [\s!file:lmmonoprop10-regular]


Wolfgang


From pragma at wxs.nl  Sat Apr 16 23:32:11 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 16 Apr 2011 23:32:11 +0200
Subject: [dev-context] DefaultFont
In-Reply-To: <6CF4433F-65A6-41AA-9941-DC1C3914BBC0@googlemail.com>
References: <6CF4433F-65A6-41AA-9941-DC1C3914BBC0@googlemail.com>
Message-ID: <4DAA0ADB.2060007@wxs.nl>

On 16-4-2011 4:13, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you change the defintion of DefaultFont because it doesn?t work when you apply font features to it:
>
> \starttext
> \definedfont[DefaultFont]DefaultFont % works
> %\definedfont[DefaultFont*default]DefaultFont % breaks
> \stoptext
>
>
> type-set.mkiv
>
> - \definefontsynonym [DefaultFont] [cmvtt10]
> + \definefontsynonym [DefaultFont] [\s!file:lmmonoprop10-regular]

ok ... should we apply default feautures? or maybe just kerns (not sure 
if there are any)

(sticking to cm probably had a reason some time e.g. for mp but afaiks 
there is no conflict anywhere)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Sun Apr 17 00:21:15 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 17 Apr 2011 00:21:15 +0200
Subject: [dev-context] bash vs sh in installation script
Message-ID: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>

Hello,

Alan wrote me about the following issue. I don't know anything about
bash/sh issues (except that sh is indeed more likely to be present and
that I had to change many occurencies of /bin/sh to /bin/bash on
garden because /bin/sh was a symlink to dash which didn't work). Does
anyone object the change from bash to sh?

Mojca

On Wed, Apr 13, 2011 at 21:16, Alan BRASLAU wrote:
> Mojca,
>
> Back at home and following the mailing list
> after a gruesome hunt for the Apple Store in Paris?
>
> One request (not just for me :))
> in first-setup.sh, please change
> #!/bin/bash
> to
> #!/bin/sh
>
> This is more general.
> 1. Not everyone has bash installed on their machine
> ? (but *everyone* always has /bin/sh, [sometimes as a link to bash])
> 2. Bash is not always to be found as /bin/bash
> ? (it could be /usr/local/bin/bash, for example).
>
> Of course, I cannot speak for MacOS, known to be weird.
>
> Alan

From mojca.miklavec.lists at gmail.com  Sun Apr 17 00:26:20 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 17 Apr 2011 00:26:20 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
Message-ID: <BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>

On Sun, Apr 17, 2011 at 00:21, Mojca Miklavec wrote:
> Hello,
>
> Alan wrote me about the following issue. I don't know anything about
> bash/sh issues (except that sh is indeed more likely to be present and
> that I had to change many occurencies of /bin/sh to /bin/bash on
> garden because /bin/sh was a symlink to dash which didn't work). Does
> anyone object the change from bash to sh?

Dear Alan,

at the same time a question for you: do you also experience any issues
with ./do-all.sh and other scripts in "build the latest binaries"? I
just checked and they start with
    #!/usr/bin/env bash
How does that compare? (I agree that it probably makes sense to do the
change, I just wanted to hear from others and maybe I need to find a
good reference to what is not allowed in sh that works in bash.)

On mac it is:
> sh --version
GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin10.0)

Mojca

From adityam at umich.edu  Sun Apr 17 00:47:35 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 16 Apr 2011 18:47:35 -0400 (EDT)
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
	<BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>
Message-ID: <alpine.LNX.2.01.1104161842570.3823@ybpnyubfg.ybpnyqbznva>

On Sun, 17 Apr 2011, Mojca Miklavec wrote:

> change, I just wanted to hear from others and maybe I need to find a
> good reference to what is not allowed in sh that works in bash.)

The bash user manual:

http://www.faqs.org/docs/bashman/bashref_122.htmlhttp://www.faqs.org/docs/bashman/bashref_122.html

> On mac it is:
>> sh --version
> GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin10.0)

On linux, sh either links to bash or dash.

Aditya

From taco at elvenkind.com  Sun Apr 17 08:28:44 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 17 Apr 2011 08:28:44 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <alpine.LNX.2.01.1104161842570.3823@ybpnyubfg.ybpnyqbznva>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>	<BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>
	<alpine.LNX.2.01.1104161842570.3823@ybpnyubfg.ybpnyqbznva>
Message-ID: <4DAA889C.7090009@elvenkind.com>

On 04/17/2011 12:47 AM, Aditya Mahajan wrote:
> On Sun, 17 Apr 2011, Mojca Miklavec wrote:
>
>> change, I just wanted to hear from others and maybe I need to find a
>> good reference to what is not allowed in sh that works in bash.)

> The bash user manual:
>
> http://www.faqs.org/docs/bashman/bashref_122.htmlhttp://www.faqs.org/docs/bashman/bashref_122.html

Alan is right that not everyone has bash, but on the other hand, *nobody 
at all* has the actual /bin/sh from the Unix manual, so finding 
documentation on what it could and could not do is hard and a little 
pointless, but the autoconf manual has a rather good chapter on 
"portable shell scripting":

   http://www.gnu.org/s/hello/manual/autoconf/Portable-Shell.html

Also, since almost all people that have trouble with bash these days 
seem to be running dash, I would guess this man page is useful:

   http://linux.die.net/man/1/dash

and perhaps you could install a /bin/dash for testing.

Best wishes,
Taco

From patrick at gundla.ch  Sun Apr 17 08:52:03 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 17 Apr 2011 08:52:03 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
Message-ID: <CFD45CA7-F1E5-4F5A-B43F-BED24ECE6FFF@gundla.ch>

Hi,

just try it on an ubuntu machine and see if it works. I think that dash (on ubunutu /bin/sh) is the "most incompatible" sh you will be able to get. If it runs on ubuntu with /bin/sh then it will work everywhere with /bin/sh, I'd assume.

Patrick


From karl at huftis.org  Sun Apr 17 09:45:51 2011
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Sun, 17 Apr 2011 09:45:51 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
Message-ID: <201104170945.53482.karl@huftis.org>

Sundag 17. april 2011 skreiv Mojca Miklavec:
>Alan wrote me about the following issue. I don't know anything about
>bash/sh issues (except that sh is indeed more likely to be present and
>that I had to change many occurencies of /bin/sh to /bin/bash on
>garden because /bin/sh was a symlink to dash which didn't work). Does
>anyone object the change from bash to sh?

What you would want to do is change bash to sh, and ensure that all the 
scripts follows the POSIX standard 100%. Then it will work in both bash,
dash, ksh and *any other* POSIX-compatible shells.

You can read the POSIX standard in HTML format at
http://pubs.opengroup.org/onlinepubs/9699919799/
(You may have to register to view it, but it?s completely free.)

If you have the POSIX man pages installed (you may already have them without 
knowing), you can read the POSIX version documentation of various commands. 
For example, instead of writing

  man mkdir
or
  man 1 mkdir

type

  man 1p mkdir

As you see, the POSIX man pages are *much* more precise (and verbose!), using 
the word ?shall? often, leaving no doubt of exactly what each command and 
options should do, in all edge cases. That may make them harder to read, but 
some times they?re actually more clear than the normal man pages.

bash is POSIX compatible (all POSIX commands should work 100%), but you may 
have to set

  export POSIXLY_CORRECT=1

to ensure that bash follows the spec in some rare special cases. (This also 
has an effect on other utilities, like (g)awk.)

bash will still support non-POSIX constructs, though (like using two equals 
sign in tests), so you really should test the scripts in dash, which *doesn?t* 
allow non-POSIX constructs (AFAIK), and is faster too.

This Web page may be useful:
http://mywiki.wooledge.org/Bashism

There also is a ?checkbashisms? scripts, which I haven?t tried.

-- 
Karl Ove Hufthammer
http://huftis.org/
Jabber: karl at huftis.org

From taco at elvenkind.com  Sun Apr 17 10:50:18 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 17 Apr 2011 10:50:18 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <201104170945.53482.karl@huftis.org>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
	<201104170945.53482.karl@huftis.org>
Message-ID: <4DAAA9CA.1060401@elvenkind.com>

On 04/17/2011 09:45 AM, Karl Ove Hufthammer wrote:
> Sundag 17. april 2011 skreiv Mojca Miklavec:
>> Alan wrote me about the following issue. I don't know anything about
>> bash/sh issues (except that sh is indeed more likely to be present and
>> that I had to change many occurencies of /bin/sh to /bin/bash on
>> garden because /bin/sh was a symlink to dash which didn't work). Does
>> anyone object the change from bash to sh?
>
> What you would want to do is change bash to sh, and ensure that all the
> scripts follows the POSIX standard 100%. Then it will work in both bash,
> dash, ksh and *any other* POSIX-compatible shells.

Everything except 'sh', then ? ;)


From karl at huftis.org  Sun Apr 17 11:10:43 2011
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Sun, 17 Apr 2011 11:10:43 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <4DAAA9CA.1060401@elvenkind.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
	<201104170945.53482.karl@huftis.org> <4DAAA9CA.1060401@elvenkind.com>
Message-ID: <201104171110.44562.karl@huftis.org>

Sundag 17. april 2011 skreiv Taco Hoekwater:
>> What you would want to do is change bash to sh, and ensure that all the
>> scripts follows the POSIX standard 100%. Then it will work in both bash,
>> dash, ksh and any other POSIX-compatible shells.
>
>Everything except 'sh', then ? ;)

Well, I doubt the orginal Bourne shell from 1977 is POSIX compatible. ;-)

But the POSIX standard actually defines the name of the shell utility ?sh?, 
so all POSIX-compatible must have a ?sh?.

It may not be placed in /usr/bin, of course, though on most sane platforms
it is. :) If you *really* want to be general, you can use the POSIX command

  command -v sh

to find it. (No, don?t use ?which?; it is not POSIX, and will only work if the 
command is an application, not a built-in.)

-- 
Karl Ove Hufthammer
http://huftis.org/
Jabber: karl at huftis.org

From alan.braslau at cea.fr  Sun Apr 17 08:48:31 2011
From: alan.braslau at cea.fr (Alan Braslau)
Date: Sun, 17 Apr 2011 08:48:31 +0200
Subject: [dev-context] bash vs sh in installation script
In-Reply-To: <BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>
References: <BANLkTikACaoT3eS4yppOaA0QX9VtS9NrsA@mail.gmail.com>
	<BANLkTim2ZNb+dpWofook6T9e_Dc2TO7vSQ@mail.gmail.com>
Message-ID: <201104170848.31507.alan.braslau@cea.fr>

On Sunday 17 April 2011 00:26:20 Mojca Miklavec wrote:
> On Sun, Apr 17, 2011 at 00:21, Mojca Miklavec wrote:
> > Hello,
> > 
> > Alan wrote me about the following issue. I don't know anything about
> > bash/sh issues (except that sh is indeed more likely to be present and
> > that I had to change many occurencies of /bin/sh to /bin/bash on
> > garden because /bin/sh was a symlink to dash which didn't work). Does
> > anyone object the change from bash to sh?
> 
> Dear Alan,
> 
> at the same time a question for you: do you also experience any issues
> with ./do-all.sh and other scripts in "build the latest binaries"? I
> just checked and they start with
>     #!/usr/bin/env bash
> How does that compare? (I agree that it probably makes sense to do the
> change, I just wanted to hear from others and maybe I need to find a
> good reference to what is not allowed in sh that works in bash.)
> 
> On mac it is:
> > sh --version
> 
> GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin10.0)
> 
> Mojca

This is one solution that would probably work (if bash is present, but, again, 
it is not by default on many systems).

Another would be to write clean shell scripts, whenever possible, that do not 
rely on bash-isms, and would work everywhere, even with dash:

"DASH is a POSIX-compliant implementation of /bin/sh that aims to be as small 
as possible. It does this without sacrificing speed where possible. In fact, 
it is significantly faster than bash (the GNU Bourne-Again SHell) for most 
tasks."

This should not be much of a constraint.

Alan
-- 
Alan Braslau
CEA DSM-IRAMIS-SPEC
CNRS URA 2464
Orme des Merisiers
91191 Gif-sur-Yvette cedex FRANCE
tel: +33 1 69 08 73 15
fax: +33 1 69 08 87 86
mailto:alan.braslau at cea.fr

 .''`.
: :'  :
`. `'`
  `-

From schuster.wolfgang at googlemail.com  Tue Apr 26 16:08:23 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 26 Apr 2011 16:08:23 +0200
Subject: [dev-context] \newconditional and Lua
Message-ID: <CC3C4CCA-21DA-4579-B295-0B23E56140BB@googlemail.com>

Hi Hans,

is there a simple way to change the status from commands created with \newconditional id \newif from, e.g. in the following example it?s easy to pass the value of the conditional from TeX to Lua but not in the reverse way.

\newconditional\test

\starttext

\settrue\test

TeX: \ifconditional\test TRUE\else FALSE\fi

Lua:
\startluacode
if \luaconditional\test then
	context("TRUE")
else
	context("FALSE")
end
\stopluacode

TeX: \ifconditional\test TRUE\else FALSE\fi

\stoptext

When i change \newconditional to \newcount it?s easy but not very elegant.

\newcount\test

\starttext

\settrue\test

TeX: \ifconditional\test TRUE\else FALSE\fi

Lua:
\startluacode
if \luaconditional\test then
	context("TRUE")
else
	context("FALSE")
end
tex.count['test'] = 1 ;
\stopluacode

TeX: \ifconditional\test TRUE\else FALSE\fi

\stoptext

Wolfgang



From pragma at wxs.nl  Tue Apr 26 16:15:06 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 26 Apr 2011 16:15:06 +0200
Subject: [dev-context] \newconditional and Lua
In-Reply-To: <CC3C4CCA-21DA-4579-B295-0B23E56140BB@googlemail.com>
References: <CC3C4CCA-21DA-4579-B295-0B23E56140BB@googlemail.com>
Message-ID: <4DB6D36A.90305@wxs.nl>

On 26-4-2011 4:08, Wolfgang Schuster wrote:
> Hi Hans,
>
> is there a simple way to change the status from commands created with \newconditional id \newif from, e.g. in the following example it?s easy to pass the value of the conditional from TeX to Lua but not in the reverse way.

if tex.conditionals.whatever ...

(virtual table, maybe I'll change the namespace)

there are also tex.constants and tex.modes

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Apr 26 16:31:39 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 26 Apr 2011 16:31:39 +0200
Subject: [dev-context] \newconditional and Lua
In-Reply-To: <4DB6D36A.90305@wxs.nl>
References: <CC3C4CCA-21DA-4579-B295-0B23E56140BB@googlemail.com>
	<4DB6D36A.90305@wxs.nl>
Message-ID: <A43D3209-65D9-4243-8763-D0CBB41F9485@googlemail.com>


Am 26.04.2011 um 16:15 schrieb Hans Hagen:

> On 26-4-2011 4:08, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> is there a simple way to change the status from commands created with \newconditional id \newif from, e.g. in the following example it?s easy to pass the value of the conditional from TeX to Lua but not in the reverse way.
> 
> if tex.conditionals.whatever ...

Is there also a lua version of \settrue and \setfalse or \?true and \?false (because i saw the ?tex.ifs? metatable)?

Wolfgang


From pragma at wxs.nl  Tue Apr 26 17:15:15 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 26 Apr 2011 17:15:15 +0200
Subject: [dev-context] \newconditional and Lua
In-Reply-To: <A43D3209-65D9-4243-8763-D0CBB41F9485@googlemail.com>
References: <CC3C4CCA-21DA-4579-B295-0B23E56140BB@googlemail.com>
	<4DB6D36A.90305@wxs.nl>
	<A43D3209-65D9-4243-8763-D0CBB41F9485@googlemail.com>
Message-ID: <4DB6E183.9040402@wxs.nl>

On 26-4-2011 4:31, Wolfgang Schuster wrote:
>
> Am 26.04.2011 um 16:15 schrieb Hans Hagen:
>
>> On 26-4-2011 4:08, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> is there a simple way to change the status from commands created with \newconditional id \newif from, e.g. in the following example it?s easy to pass the value of the conditional from TeX to Lua but not in the reverse way.
>>
>> if tex.conditionals.whatever ...
>
> Is there also a lua version of \settrue and \setfalse or \?true and \?false (because i saw the ?tex.ifs? metatable)?

we can add tex.settrue ... but I think that we should get rid of \if... 
as much as possible

\starttext

\newconditional\TestConditional

\startluacode
function tex.settrue(name)
     tex.count[name] = 0
end

function tex.setfalse(name)
     tex.count[name] = 1
end

-- tex.settrue("TestConditional")
\stopluacode


\ifconditional\TestConditional
   YES
\else
   NOP
\fi

\stoptext

I'll add the two definitions.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Apr 27 10:39:23 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 27 Apr 2011 10:39:23 +0200
Subject: [dev-context] MetaPost 1.750 (alpha version)
Message-ID: <4DB7D63B.4070507@elvenkind.com>


Hi all,

Finally, I can release the first attempt at getting to metapost 2.0.

----------------------------------------------------------------------
MetaPost 1.750
----------------------------------------------------------------------

The standalone distribution package and a win32 binary can be downloaded
immediately from the 'experimental' files section at

   http://foundry.supelec.fr/gf/project/metapost/

*** This is an pre-alpha release for testing / experimenting only! ***

It is able to process the images from mpman.mp (the metapost manual)
but that is about the extent of the testing done so far, so expect
lots and lots of bugs!.

The win32 binary is intended for texlive or a similar web2c-based
installation, this executable will *not* work for miktex.

Of course, we welcome any comments (either good or bad) that you may
have. Simply replying to this message is fine, but see the bottom of
the message for a more formal way to report bugs and feature requests.

----------------------------------------------------------------------
What is new in MetaPost version 1.750:
----------------------------------------------------------------------

* The mpost executable now accepts --math=double as an argument. This
   switches the internal arithmetic functions from using a scaled 32-bit
   data type to 64-bit floating point.

* With --math=double, the input scanner has been changed to allow
     a := 1.0E20
   as input format for a (any) numerical value

----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
http://foundry.supelec.fr/gf/project/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, April 27, 2011

From taco at elvenkind.com  Fri May  6 11:44:50 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 May 2011 11:44:50 +0200
Subject: [dev-context] Luatex 0.70.0 announcement
Message-ID: <4DC3C312.3070007@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.70.0.

This release will be the one on TeXLive 2011 (barring show-stopping
bugs). Compared to 0.66, there is not a lot of news, just a few
bug-fixes.

News:


* fixed: various changes needed for libpng 1.5.2.

* fixed: node.fields() for nodes without subtype.

* fixed: non-argument use of os.execute().

* fixed: tex.[s|t|]print() with invalid catcode table arguments.

* fixed: recorder filename location with --output-directory.

* fixed: display alignment in TRT mode.

* luatex now uses the standard synctex files from J?rome Laurens.


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.70.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From taco at elvenkind.com  Fri May  6 12:04:52 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 May 2011 12:04:52 +0200
Subject: [dev-context] MetaPost 1.504
Message-ID: <4DC3C7C4.6010609@elvenkind.com>


We are happy to announce a new release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.504
----------------------------------------------------------------------

The standalone distribution package and a win32 binary can be downloaded
immediately from

   http://foundry.supelec.fr/gf/project/metapost/

This is a bugfix release following the major internal rewrite done
for 1.500. In fact, this will be the version of metapost that will
be on TeXLive 2011.

The win32 binary is intended for texlive or a similar web2c-based
installation, this executable will *not* work for miktex.

Of course, we welcome any comments (either good or bad) that you may
have. Simply replying to this message is fine, but see the bottom of
the message for a more formal way to report bugs and feature requests.

----------------------------------------------------------------------
What is new in MetaPost version 1.504:
----------------------------------------------------------------------

* A fix to the automatic detection of 'dvitomp' mode based on the
   executable name (proposed by PEB).

* A better way to discover the end of the preload file is used now.

* A memory release bug that caused metapost to crash on exit when
   fontmaking:=1 has been fixed.

* A memory leak in the string concatenation code has been removed.

* Again, a set of improvements to the manual.

* Updated the manual page mpost.man

----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
http://foundry.supelec.fr/gf/project/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, May 6, 2011.

From pragma at wxs.nl  Mon May 16 12:25:43 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 May 2011 12:25:43 +0200
Subject: [dev-context] current
Message-ID: <4DD0FBA7.7010100@wxs.nl>

Hi,

As I expect some incompatible luatex dev soon (lua level) I'd like to 
make a current.

Any known showstoppers?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Mon May 16 19:16:36 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 16 May 2011 19:16:36 +0200
Subject: [dev-context] current
In-Reply-To: <4DD0FBA7.7010100@wxs.nl>
References: <4DD0FBA7.7010100@wxs.nl>
Message-ID: <BANLkTimYNz_6gBiDXkCq_gjxxZiD02SE5g@mail.gmail.com>

On Mon, May 16, 2011 at 12:25, Hans Hagen wrote:
> Hi,
>
> As I expect some incompatible luatex dev soon (lua level) I'd like to make a
> current.
>
> Any known showstoppers?

My only request is to keep the current around for at least a while
(even if a very short one) before introducing incompatible changes ...
to allow for fixing any bugs that might show up and to fix them before
TL freeze.

Mojca

From taco at elvenkind.com  Thu May 19 07:56:04 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 19 May 2011 07:56:04 +0200
Subject: [dev-context] Luatex 0.70.1 announcement
Message-ID: <4DD4B0F4.5060003@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.70.1.

About a dozen or so bugfixes that were mostly discovered while
working on TeXLive 2011.

News:

* fixed: recorder file location from TL.

* fixed: missing newline on 'No output' line.

* fixed: relative names in synctex file.

* fixed: 16bit png images in generated %!PDF-1.4.

* fixed: building with (installed) libpng < 1.5.0

* fixed: year in --version output.

* fixed: box output to synctex.

* fixed: FontDescriptor for non-embedded OpenType fonts has an
  invalid FontFile3 entry (#654)

* fixed: crash on non-existent images.

* fixed: small memory leak in the ipc code.

* fixed: tex.print() and tex.sprint() don't recognize -2 as the
  first argument (#659)


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.70.1

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Taco




From mojca.miklavec.lists at gmail.com  Wed May 25 10:57:24 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 25 May 2011 10:57:24 +0200
Subject: [dev-context] composing characters in MKIV: adding "mark" feature
Message-ID: <BANLkTimr-n_wu748sizmw-DNkm1yrDMteQ@mail.gmail.com>

Dear Hans,

as a follow up to the topic I brought up again last week (and as it
was partially brought up on the tex-font mailing list as well), here
are some of my thoughts (for discussion).


When thinking a bit about it, it appears to me that the best approach
for fixing accent positioning would be to implement "mark"/"mkmk"
feature for both Type1 and OpenType fonts using lfg files.

The things that come to my mind and would have to be done are the following:

1.) with some configuration, but universal accross fonts: One might
have to copy a normal caron into combining caron (and copy all other
accents as well), to enable <c><combining caron> to work properly.
(Arthur would probably argue about normalization at this point, but
I'm also talking about combinations that don't exist in Unicode; maybe
<eogonek><combining caron> etc.)

2.) universal accross fonts: Let TeX determine "bottom marks" and "top
marks" for all letters (that is: eogonek and scedilla also need at
least the "top mark"). The code to calculate those values is already
there.
It would be helpful to have both graphical output displaying those
marks on top of letters as well as an option to output those settings
into a file (to enable easy manual editing of values and loading them
again).

3.1.) Allow editing the values that TeX returned (from point 2) and
loading them.
3.2.) Allow shifting "top marks" separately on
lowercase/uppercase/smallcaps. Among those, allow exceptions for
single letters (like lowercase l in Lucida which is taller than
uppercase letters and requires special handling). Allow shifting
"bottom marks" and allow exceptions.

4.) Allow shifting both marks to left/right (I'm not sure about units,
but they may be the same units as used for bounding boxes; people who
want to fix that have to experiment anyway).

5.) Allow shifting positioning marks on accents. There is some
confusion since some accents come with their "natural bounding box",
while combining accents don't.

6.) Low priority: For fonts that do have mark/mkmk feature, allow
fixing mark positions on single letters and allow adding new marks on
letters that lack them.

7.) Very low priority: Allow "faking accents" (creating bottom
circumflex out of top circumflex).

8.) Lower priority, but might be kept in mind: this has to be done for
Latin, but other scripts (like Cyrillic) might want to have that
functionality on request as well. It makes little sense to add marks
on all glyphs, including Chinese etc. The autocomposing feature should
probably be switched off by default, but if one wants to switch it on
and if one wants to add positioning marks, it might make sense to "ask
the user" to which glyphs those marks have to be added.


I can try to come up with more precise specification, but to start
with: how would one add mark/mkmk features to lfg files? (I'm asking
for some minimal example of syntax which doesn't have to work.)

Mojca

From arthur.reutenauer at normalesup.org  Wed May 25 11:15:22 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 25 May 2011 10:15:22 +0100
Subject: [dev-context] composing characters in MKIV: adding "mark"
 feature
In-Reply-To: <BANLkTimr-n_wu748sizmw-DNkm1yrDMteQ@mail.gmail.com>
References: <BANLkTimr-n_wu748sizmw-DNkm1yrDMteQ@mail.gmail.com>
Message-ID: <20110525091522.GH4231@phare.normalesup.org>

> (Arthur would probably argue about normalization at this point, but
> I'm also talking about combinations that don't exist in Unicode; maybe
> <eogonek><combining caron> etc.)

  No, what you're proposing is independent of any processing of the
character stream, since it happens later, in the font.  This is distinct
from normalisation.

  (I think normalisation should be done anyway when you're processing
some text in any system, using the form that best fits the expectation,
but that is a separate issue.)

	Arthur

From schuster.wolfgang at googlemail.com  Sun May 29 19:21:56 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 29 May 2011 19:21:56 +0200
Subject: [dev-context] \getscaledglyph
Message-ID: <D5E44973-2F65-4C89-A2C8-F955D0DF2F93@googlemail.com>

Isn?t there a \fontbody missing as first argument of \setscaledstyledsymbolicfont?

font-ini.mkiv:

\unexpanded\def\getscaledglyph   #1#2#3{{\setscaledstyledsymbolicfont{#1}{#2}\doifnumberelse{#3}\char\donothing#3}}

Wolfgang


From pragma at wxs.nl  Sun May 29 20:00:39 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 29 May 2011 20:00:39 +0200
Subject: [dev-context] \getscaledglyph
In-Reply-To: <D5E44973-2F65-4C89-A2C8-F955D0DF2F93@googlemail.com>
References: <D5E44973-2F65-4C89-A2C8-F955D0DF2F93@googlemail.com>
Message-ID: <4DE289C7.2040608@wxs.nl>

On 29-5-2011 7:21, Wolfgang Schuster wrote:
> Isn?t there a \fontbody missing as first argument of \setscaledstyledsymbolicfont?
>
> font-ini.mkiv:
>
> \unexpanded\def\getscaledglyph   #1#2#3{{\setscaledstyledsymbolicfont{#1}{#2}\doifnumberelse{#3}\char\donothing#3}}

Just check 'm all and send me a patch (I'm in tricky math export mode).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Thu Jun  2 01:06:20 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 1 Jun 2011 19:06:20 -0400 (EDT)
Subject: [dev-context] Structure syntax for enumerations
Message-ID: <alpine.LNX.2.02.1106011854130.28997@ybpnyubfg.ybpnyqbznva>

Hi,

I will like to propose a new command, \definestructureenumeration, which 
is similar to \defineenumeration, but follows the conventions of 
\definestructuresection, that is, allows one to write

\definestructureenumeration[theorem]

\starttheorem[title={An important theorem}, list={Not so important}]
   ...
\stoptheorem

The \start<enumeration> command takes the same arguments as \startsection.

What do you think?

Aditya

From schuster.wolfgang at googlemail.com  Thu Jun  2 05:37:01 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 2 Jun 2011 05:37:01 +0200
Subject: [dev-context] Structure syntax for enumerations
In-Reply-To: <alpine.LNX.2.02.1106011854130.28997@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1106011854130.28997@ybpnyubfg.ybpnyqbznva>
Message-ID: <B0CFF760-0D6D-4078-82F7-C40DD7D126E5@googlemail.com>


Am 02.06.2011 um 01:06 schrieb Aditya Mahajan:

> Hi,
> 
> I will like to propose a new command, \definestructureenumeration, which is similar to \defineenumeration, but follows the conventions of \definestructuresection, that is, allows one to write
> 
> \definestructureenumeration[theorem]
> 
> \starttheorem[title={An important theorem}, list={Not so important}]
>  ...
> \stoptheorem
> 
> The \start<enumeration> command takes the same arguments as \startsection.
> 
> What do you think?

Good idea but two commands aren?t a good idea, the best is to rewrite
the enumeration system with a key-val-system and keep the optional
argument for backward compatibility (see the annotation module).

Wolfgang

From pragma at wxs.nl  Sat Jun  4 00:26:50 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 04 Jun 2011 00:26:50 +0200
Subject: [dev-context] Structure syntax for enumerations
In-Reply-To: <B0CFF760-0D6D-4078-82F7-C40DD7D126E5@googlemail.com>
References: <alpine.LNX.2.02.1106011854130.28997@ybpnyubfg.ybpnyqbznva>
	<B0CFF760-0D6D-4078-82F7-C40DD7D126E5@googlemail.com>
Message-ID: <4DE95FAA.6070407@wxs.nl>

On 2-6-2011 5:37, Wolfgang Schuster wrote:
>
> Am 02.06.2011 um 01:06 schrieb Aditya Mahajan:
>
>> Hi,
>>
>> I will like to propose a new command, \definestructureenumeration, which is similar to \defineenumeration, but follows the conventions of \definestructuresection, that is, allows one to write
>>
>> \definestructureenumeration[theorem]
>>
>> \starttheorem[title={An important theorem}, list={Not so important}]
>>   ...
>> \stoptheorem
>>
>> The \start<enumeration>  command takes the same arguments as \startsection.
>>
>> What do you think?
>
> Good idea but two commands aren?t a good idea, the best is to rewrite
> the enumeration system with a key-val-system and keep the optional
> argument for backward compatibility (see the annotation module).

remind me in a few months


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Jun  7 13:02:47 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 7 Jun 2011 13:02:47 +0200
Subject: [dev-context] pack-mis.mkiv
Message-ID: <1FB9EC23-513A-4A5B-B142-603FE09ADF11@googlemail.com>

Hi Hans,

there?s a typo in pack-mis.mkvi

\def\pack_placement_indeed[#settings]% set test can be sped up but non critical
  {\iffirstargument
-    \setupcurrentplacement[#settings]%
+    \setupplacement[\currentplacement][#settings]%
   \fi
   \dowithnextboxcontent{\forgetall}{\pack_placement_flush\egroup}\vbox}

Wolfgang


From schuster.wolfgang at googlemail.com  Tue Jun  7 13:18:56 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 7 Jun 2011 13:18:56 +0200
Subject: [dev-context] pack-mis.mkiv
In-Reply-To: <1FB9EC23-513A-4A5B-B142-603FE09ADF11@googlemail.com>
References: <1FB9EC23-513A-4A5B-B142-603FE09ADF11@googlemail.com>
Message-ID: <C85D93F0-8950-44CE-9A69-2BF976879071@googlemail.com>


Am 07.06.2011 um 13:02 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> there?s a typo in pack-mis.mkvi
> 
> \def\pack_placement_indeed[#settings]% set test can be sped up but non critical
>  {\iffirstargument
> -    \setupcurrentplacement[#settings]%
> +    \setupplacement[\currentplacement][#settings]%

Sorry for the noise, i just missed that you also define \setupcurrent... in mult-aux.mkiv

Wolfgang

From netuse at lavabit.com  Sat Jun 11 17:32:03 2011
From: netuse at lavabit.com (Marco)
Date: Sat, 11 Jun 2011 17:32:03 +0200
Subject: [dev-context] No updates for SunOS
Message-ID: <20110611173203.4c322709@glyph>

On my SunOS box I'm still stuck with

mtx-context     | current version: 2011.05.05 12:10
This is LuaTeX, Version beta-0.66.0-2011041313

What's wrong?

Marco



From mojca.miklavec.lists at gmail.com  Sat Jun 11 17:38:55 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 11 Jun 2011 17:38:55 +0200
Subject: [dev-context] No updates for SunOS
In-Reply-To: <20110611173203.4c322709@glyph>
References: <20110611173203.4c322709@glyph>
Message-ID: <BANLkTimWMvQrEu21pLs40Y47EPTkHnWZFw@mail.gmail.com>

On Sat, Jun 11, 2011 at 17:32, Marco <netuse at lavabit.com> wrote:
> On my SunOS box I'm still stuck with
>
> mtx-context ? ? | current version: 2011.05.05 12:10
> This is LuaTeX, Version beta-0.66.0-2011041313
>
> What's wrong?

On my computer:
> md5sum solaris-intel/luatex/beta-0.70.1/luatex
a3b988cd9eabcb2c66048efc4638b269  solaris-intel/luatex/beta-0.70.1/luatex

On server (http://minimals.contextgarden.net/current/bin/luatex/solaris-intel/bin/luatex):
$ md5sum current/bin/luatex/solaris-intel/bin/luatex
a3b988cd9eabcb2c66048efc4638b269  current/bin/luatex/solaris-intel/bin/luatex

I wouldn't know. Do you have some other luatex somewhere else?

Mojca

From netuse at lavabit.com  Sat Jun 11 17:56:34 2011
From: netuse at lavabit.com (Marco)
Date: Sat, 11 Jun 2011 17:56:34 +0200
Subject: [dev-context] No updates for SunOS
References: <20110611173203.4c322709@glyph>
	<BANLkTimWMvQrEu21pLs40Y47EPTkHnWZFw@mail.gmail.com>
Message-ID: <20110611175634.399606bf@glyph>

On 2011-06-11 Mojca Miklavec <mojca.miklavec.lists at gmail.com> wrote:

> On Sat, Jun 11, 2011 at 17:32, Marco <netuse at lavabit.com> wrote:
> > On my SunOS box I'm still stuck with
> >
> > mtx-context ? ? | current version: 2011.05.05 12:10
> > This is LuaTeX, Version beta-0.66.0-2011041313
> >
> > What's wrong?
> 
> On my computer:
> > md5sum solaris-intel/luatex/beta-0.70.1/luatex
> a3b988cd9eabcb2c66048efc4638b269  solaris-intel/luatex/beta-0.70.1/luatex
> 
> On server
> (http://minimals.contextgarden.net/current/bin/luatex/solaris-intel/bin/luatex):
> $ md5sum current/bin/luatex/solaris-intel/bin/luatex
> a3b988cd9eabcb2c66048efc4638b269
> current/bin/luatex/solaris-intel/bin/luatex
> 
> I wouldn't know. Do you have some other luatex somewhere else?

bin/texlua --version
This is LuaTeX, Version beta-0.70.1-2011051911 (rev 4277)

tex/texmf-solaris-intel/bin/luatex --version
This is LuaTeX, Version beta-0.66.0-2011041313

context --version
mtx-context ? ? | current version: 2011.05.05 12:10

I updated again, and now I get

bin/texlua --version
This is LuaTeX, Version beta-0.70.1-2011051911 (rev 4277)

tex/texmf-solaris-intel/bin/luatex --version
This is LuaTeX, Version beta-0.70.1-2011051911 (rev 4277)

context --version
mtx-context     | current version: 2011.06.11 16:45

Weird, seems that the update didn't run properly. However,
now it works :)

Thanks anyway
Marco



From luigi.scarso at gmail.com  Tue Jun 14 12:19:47 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 14 Jun 2011 12:19:47 +0200
Subject: [dev-context] \rotation is broken
Message-ID: <BANLkTimOgdaGz=8-VSqtgyvYTg0qQ61XoQ@mail.gmail.com>

! Undefined control sequence.
\starttext \rotate[rotation=90]{FOO}    \stoptext



system          > tex > error on line 1 in file test.tex: Undefined
control sequence ...

 1 >>  \starttext \rotate[rotation=90]{FOO} \stoptext


\dodorotatenextbox ...ta \fi \dododorotatenextbox
                                                  \wd \nextbox \if!!donea \s...
\dorotatenextbox ...otatenextbox \@@rorotation #2}
                                                  \hbox {\boxcursor \flushne...
\dodowithnextbox ...xtbox \@@rorotation \!!counta
                                                  \egroup
l.1 \starttext \rotate[rotation=90]{FOO}
                                         \stoptext



core-mis.mkiv:

% We can completely do this in lua .. when 'I'm bored ...

% \def\dododorotatenextbox
%   {\setbox\nextbox\vbox to \@@layerysiz
%      {\vfill
%       \hbox to \@@layerxsiz
%         {\dostartrotation\@@rorotation
%            \nextboxwd\zeropoint
%            \nextboxht\zeropoint
%            \flushnextbox
%          \dostoprotation
%          \hfill}%
%       \kern\@@layerypos}%
%   \setbox\nextbox\hbox
%     {\kern\@@layerxpos
%      \kern\@@layerxoff
%      \lower\@@layeryoff\flushnextbox



-- 
luigi

From schuster.wolfgang at googlemail.com  Tue Jun 14 12:31:54 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Jun 2011 12:31:54 +0200
Subject: [dev-context] x-set-11.mkiv
Message-ID: <151E5367-D622-4A7F-A275-0B87C18725E8@googlemail.com>

Hi Hans,

the \blank command is ignored when the complete list is printed with \placesetups
because packed mode is used, with a normal \vskip this doesn?t happen. I reduced
the skip because ?.75\lineheight? looks better for commands without optional arguments.

\startxmlsetups xml:setups:typeset
    \getvalue{\e!start setuptext}
        ...
        \xmldoif{#1}{/arguments} {
            \bgroup
                \enablemode[setups-pass-two]
                \doglobal\newcounter\currentSETUPargument
-               \blank[\v!line]
+               \godown[.75\lineheight]
                \switchtobodyfont[small]
                \ignorespaces\xmlfilter{#1}{/arguments/text()}\endgraf
            \egroup
        }
    \getvalue{\e!stop setuptext}
\stopxmlsetups

Wolfgang


From schuster.wolfgang at googlemail.com  Tue Jun 14 13:58:18 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Jun 2011 13:58:18 +0200
Subject: [dev-context] ConTeXt equivalent of \line
Message-ID: <D79145BC-AB16-42C5-93B3-0789C6BA82E3@googlemail.com>

Hi Hans,

can you add a ConTeXt version of plain TeX?s \line (\hbox to \hsize) command.

I think this should do it: \def\fullaligned{\doalignline \relax \relax}

Wolfgang


From pragma at wxs.nl  Tue Jun 14 15:43:20 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 14 Jun 2011 15:43:20 +0200
Subject: [dev-context] ConTeXt equivalent of \line
In-Reply-To: <D79145BC-AB16-42C5-93B3-0789C6BA82E3@googlemail.com>
References: <D79145BC-AB16-42C5-93B3-0789C6BA82E3@googlemail.com>
Message-ID: <4DF76578.8010005@wxs.nl>

On 14-6-2011 1:58, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you add a ConTeXt version of plain TeX?s \line (\hbox to \hsize) command.
>
> I think this should do it: \def\fullaligned{\doalignline \relax \relax}

sure, but shouldn't we also add this then?

\letvalue{\s!do\v!line\v!max}\fullaligned


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Jun 14 16:07:08 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Jun 2011 16:07:08 +0200
Subject: [dev-context] ConTeXt equivalent of \line
In-Reply-To: <4DF76578.8010005@wxs.nl>
References: <D79145BC-AB16-42C5-93B3-0789C6BA82E3@googlemail.com>
	<4DF76578.8010005@wxs.nl>
Message-ID: <D9731567-1363-4D60-BF63-B82A7350ACFE@googlemail.com>


Am 14.06.2011 um 15:43 schrieb Hans Hagen:

> On 14-6-2011 1:58, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> can you add a ConTeXt version of plain TeX?s \line (\hbox to \hsize) command.
>> 
>> I think this should do it: \def\fullaligned{\doalignline \relax \relax}
> 
> sure, but shouldn't we also add this then?
> 
> \letvalue{\s!do\v!line\v!max}\fullaligned

Yes, it makes sense.

Wolfgang


From schuster.wolfgang at googlemail.com  Tue Jun 14 18:00:18 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Jun 2011 18:00:18 +0200
Subject: [dev-context] strc-ren.mkiv
Message-ID: <BACC2661-1C25-4999-8447-D58F0282808B@googlemail.com>

\def\doplaceheadnumbercomponent#1%
  {\begingroup
     \setupheadcomponentfont\c!numberstyle\c!numbercolor
     \placeheadmargintexts
     \ifcsname\??nh\currentstructurehead\c!deepnumbercommand\endcsname
-      \expandafter\let\expandafter\deepstructurenumbercommand\csname\??nh\currentstructurehead\c!deeptextcommand\endcsname
+      \expandafter\let\expandafter\deepstructurenumbercommand\csname\??nh\currentstructurehead\c!deepnumbercommand\endcsname
     \fi
     \ifconditional\structureheadisdisplay % \ifdisplaysectionhead
       % can be nilled with \setnostrut
       \structureheadparameter\c!numbercommand{\setstrut\begstrut#1\endstrut}%
     \else
       \structureheadparameter\c!numbercommand{#1}%
     \fi
   \endgroup}

Wolfgang


From schuster.wolfgang at googlemail.com  Tue Jun 14 18:03:36 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Jun 2011 18:03:36 +0200
Subject: [dev-context] pack-box.mkiv
Message-ID: <74896083-DC08-4F9D-A68C-85358E4E926C@googlemail.com>

\def\nonoanchor[#1]%
- {}
+ {\csname\??an#1\endcsname}

otherwise \defineanchor is useless.

Wolfgang


From luigi.scarso at gmail.com  Wed Jun 15 12:59:53 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 15 Jun 2011 12:59:53 +0200
Subject: [dev-context] \rotation is broken
In-Reply-To: <BANLkTimOgdaGz=8-VSqtgyvYTg0qQ61XoQ@mail.gmail.com>
References: <BANLkTimOgdaGz=8-VSqtgyvYTg0qQ61XoQ@mail.gmail.com>
Message-ID: <BANLkTim3XNBAzPy=ZcgDWC4+198d89Cd4Q@mail.gmail.com>

Still broken in latest beta.

On Tue, Jun 14, 2011 at 12:19 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> ! Undefined control sequence.
> \starttext \rotate[rotation=90]{FOO} ? ?\stoptext
>
>
>
> system ? ? ? ? ?> tex > error on line 1 in file test.tex: Undefined
> control sequence ...
>
> ?1 >> ?\starttext \rotate[rotation=90]{FOO} \stoptext
>
>
> \dodorotatenextbox ...ta \fi \dododorotatenextbox
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\wd \nextbox \if!!donea \s...
> \dorotatenextbox ...otatenextbox \@@rorotation #2}
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\hbox {\boxcursor \flushne...
> \dodowithnextbox ...xtbox \@@rorotation \!!counta
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\egroup
> l.1 \starttext \rotate[rotation=90]{FOO}
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? \stoptext
>
>
>
> core-mis.mkiv:
>
> % We can completely do this in lua .. when 'I'm bored ...
>
> % \def\dododorotatenextbox
> % ? {\setbox\nextbox\vbox to \@@layerysiz
> % ? ? ?{\vfill
> % ? ? ? \hbox to \@@layerxsiz
> % ? ? ? ? {\dostartrotation\@@rorotation
> % ? ? ? ? ? ?\nextboxwd\zeropoint
> % ? ? ? ? ? ?\nextboxht\zeropoint
> % ? ? ? ? ? ?\flushnextbox
> % ? ? ? ? ?\dostoprotation
> % ? ? ? ? ?\hfill}%
> % ? ? ? \kern\@@layerypos}%
> % ? \setbox\nextbox\hbox
> % ? ? {\kern\@@layerxpos
> % ? ? ?\kern\@@layerxoff
> % ? ? ?\lower\@@layeryoff\flushnextbox
>
>
>
> --
> luigi
>



-- 
luigi

From schuster.wolfgang at googlemail.com  Wed Jun 15 18:36:50 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 15 Jun 2011 18:36:50 +0200
Subject: [dev-context] spac-ali.mkiv
Message-ID: <42C4B4B7-6E6D-41E9-B503-817DD6D6E085@googlemail.com>

Missind do?s:

\def\dosetraggedvbox#1% can be more keys
  {\let\raggedbox\vbox
-  \processcommacommand[#1]\dosetraggedvbox}
+  \processcommacommand[#1]\dodosetraggedvbox}

\def\dosetraggedhbox#1% can be more keys
  {\let\raggedbox\hbox
-  \processcommacommand[#1]\dosetraggedhbox}
+  \processcommacommand[#1]\dodosetraggedhbox}

-\def\dosetraggedvbox#1%
+\def\dodosetraggedvbox#1%
  {\ifcsname\@@ragged@@vbox#1\endcsname
     \csname\@@ragged@@vbox#1\endcsname
     \quitcommalist
   \fi}

-\def\dosetraggedhbox#1%
+\def\dodosetraggedhbox#1%
  {\ifcsname\@@ragged@@hbox#1\endcsname
     \csname\@@ragged@@hbox#1\endcsname
     \quitcommalist
   \fi}

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jun 15 18:38:29 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 15 Jun 2011 18:38:29 +0200
Subject: [dev-context] spac-ver.mkiv
Message-ID: <0321774F-5690-4BE1-9629-A72186C47E5F@googlemail.com>

Hi Hans,

-\setvalue{@strut@\s!empty  }{\setstrut}
+\setvalue{@strut@\empty    }{\setstrut}

This should be \empty otherwise \setupstrut (without arguments) expands to \setcharstrut without any content.

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jun 15 18:34:28 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 15 Jun 2011 18:34:28 +0200
Subject: [dev-context] font-ini.mkiv
Message-ID: <DC557A09-619E-4254-9F51-C6E63232C889@googlemail.com>

\def\dodefinestylecollection[#1]%
  {\iffirstargument
     \setuvalue{#1}{\styleinstance[#1]}%
     \def\docommand##1%
-      {\def\dodocommand####1{\letbeundefined{\??sx##1:####1:\commalistelement}}%
+      {\def\dodocommand####1{\letbeundefined{\??sx#1:##1:####1}}%
        \processcommacommand[\fontalternativelist,\s!default]\dodocommand}%
     \processcommacommand[\fontstylelist,\s!default]\docommand
   \fi}

Wolfgang


From pragma at wxs.nl  Wed Jun 15 19:03:38 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 15 Jun 2011 19:03:38 +0200
Subject: [dev-context] spac-ali.mkiv
In-Reply-To: <42C4B4B7-6E6D-41E9-B503-817DD6D6E085@googlemail.com>
References: <42C4B4B7-6E6D-41E9-B503-817DD6D6E085@googlemail.com>
Message-ID: <4DF8E5EA.4090100@wxs.nl>

On 15-6-2011 6:36, Wolfgang Schuster wrote:
> Missind do?s:
>
> \def\dosetraggedvbox#1% can be more keys
>    {\let\raggedbox\vbox
> -  \processcommacommand[#1]\dosetraggedvbox}
> +  \processcommacommand[#1]\dodosetraggedvbox}
>
> \def\dosetraggedhbox#1% can be more keys
>    {\let\raggedbox\hbox
> -  \processcommacommand[#1]\dosetraggedhbox}
> +  \processcommacommand[#1]\dodosetraggedhbox}
>
> -\def\dosetraggedvbox#1%
> +\def\dodosetraggedvbox#1%
>    {\ifcsname\@@ragged@@vbox#1\endcsname
>       \csname\@@ragged@@vbox#1\endcsname
>       \quitcommalist
>     \fi}
>
> -\def\dosetraggedhbox#1%
> +\def\dodosetraggedhbox#1%
>    {\ifcsname\@@ragged@@hbox#1\endcsname
>       \csname\@@ragged@@hbox#1\endcsname
>       \quitcommalist
>     \fi}

ok. fixed (interesting old typos)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Thu Jun 16 00:01:10 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 15 Jun 2011 18:01:10 -0400 (EDT)
Subject: [dev-context] --iftouched not working
Message-ID: <alpine.LNX.2.01.1106151754200.11712@ybpnyubfg.ybpnyqbznva>

Hi,

mtxrun --iftouched does not work. The reason is that line 147000 of 
mtxrun.lua has

     local oldname, newname = string.split(touchname, ",")

This sets oldname to be equal to a table and newname to nil. Consequently, 
the next test

     if oldname and newname and oldname ~= "" and newname ~= "" then

fails. An easy fix is to wrap string.split inside a unpack.

     local oldname, newname = unwrap(string.split(touchname, ","))

but there might be more canonical ways of fixing this.

Aditya



From wolfgang.schuster at gmail.com  Wed Jun 15 18:31:59 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Wed, 15 Jun 2011 18:31:59 +0200
Subject: [dev-context] spac-ver.mkiv
Message-ID: <EF49DEF5-9AFB-4A77-BEC9-D480EA4F45C8@gmail.com>

Hi Hans,

-\setvalue{@strut@\s!empty  }{\setstrut}
+\setvalue{@strut@\empty    }{\setstrut}

This should be \empty otherwise \setupstrut (without arguments) expands to \setcharstrut without any content.

Wolfgang


From pragma at wxs.nl  Thu Jun 16 13:12:58 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 16 Jun 2011 13:12:58 +0200
Subject: [dev-context] --iftouched not working
In-Reply-To: <alpine.LNX.2.01.1106151754200.11712@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.01.1106151754200.11712@ybpnyubfg.ybpnyqbznva>
Message-ID: <4DF9E53A.1080704@wxs.nl>

On 16-6-2011 12:01, Aditya Mahajan wrote:
> Hi,
>
> mtxrun --iftouched does not work. The reason is that line 147000 of
> mtxrun.lua has
>
> local oldname, newname = string.split(touchname, ",")
>
> This sets oldname to be equal to a table and newname to nil.
> Consequently, the next test
>
> if oldname and newname and oldname ~= "" and newname ~= "" then
>
> fails. An easy fix is to wrap string.split inside a unpack.
>
> local oldname, newname = unwrap(string.split(touchname, ","))
>
> but there might be more canonical ways of fixing this.

I've made a string.splitup(str,",") for this (saves a temp table).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Jun 16 16:30:46 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 16 Jun 2011 16:30:46 +0200
Subject: [dev-context] spac-ver.mkiv
Message-ID: <4EC557B2-ABB0-4685-A796-6391C680668A@googlemail.com>

-\def\dodomoveongrid[#1]%
+\def\domoveongrid[#1]%
  {} % gone, unless we set an attribute

Wolfgang


From schuster.wolfgang at googlemail.com  Thu Jun 16 16:32:32 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 16 Jun 2011 16:32:32 +0200
Subject: [dev-context] cont-new.mkiv
Message-ID: <682A1035-1CA1-420D-960C-A57C7A515981@googlemail.com>

\def\dostartgridcorrection[#1]%
  {\ifgridsnapping
-    \iffirstargument\doifsomething{#1}{\moveongrid[#1]}\fi
-    \snaptogrid\vbox\bgroup
+    \snaptogrid[#1]\vbox\bgroup
   \else
     \startbaselinecorrection
   \fi}

Wolfgang


From wolfgang.schuster at gmail.com  Thu Jun 16 21:18:05 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 16 Jun 2011 21:18:05 +0200
Subject: [dev-context] \defineheadplacement
Message-ID: <0D7C2930-D429-4819-9377-B9B32DCEE119@gmail.com>

Hi Hans,

is it possible to integrate the two parameters for the number and text in the definition of the command?

%\def\dodefineheadplacement[#1][#2]% #3#4
%  {\setvalue{\??ns:#1}{#2}%
%   \setvalue{\??ns::#1}}

\def\dodefineheadplacement[#1][#2]%
  {\setvalue{\??ns:#1}{#2}%
   \setvalue{\??ns::#1}##1##2}


As \defineheadplacement is a user command it should be possible to use it in the form

  \defineheadplacement[test][horizontal]{\inleft{#1 #2}}


Wolfgang


From schuster.wolfgang at googlemail.com  Thu Jun 16 21:19:51 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 16 Jun 2011 21:19:51 +0200
Subject: [dev-context] \defineheadplacement
Message-ID: <DA1F5EF2-77EB-4355-B3B0-38F08FAD0774@googlemail.com>

Hi Hans,

is it possible to integrate the two parameters for the number and text in the definition of the command?

%\def\dodefineheadplacement[#1][#2]% #3#4
%  {\setvalue{\??ns:#1}{#2}%
%   \setvalue{\??ns::#1}}

\def\dodefineheadplacement[#1][#2]%
 {\setvalue{\??ns:#1}{#2}%
  \setvalue{\??ns::#1}##1##2}


As \defineheadplacement is a user command it should be possible to use it in the form

 \defineheadplacement[test][horizontal]{\inleft{#1 #2}}


Wolfgang


From pragma at wxs.nl  Thu Jun 16 23:27:47 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 16 Jun 2011 23:27:47 +0200
Subject: [dev-context] \defineheadplacement
In-Reply-To: <0D7C2930-D429-4819-9377-B9B32DCEE119@gmail.com>
References: <0D7C2930-D429-4819-9377-B9B32DCEE119@gmail.com>
Message-ID: <4DFA7553.5050208@wxs.nl>

On 16-6-2011 9:18, Wolfgang Schuster wrote:
> Hi Hans,
>
> is it possible to integrate the two parameters for the number and text in the definition of the command?
>
> %\def\dodefineheadplacement[#1][#2]% #3#4
> %  {\setvalue{\??ns:#1}{#2}%
> %   \setvalue{\??ns::#1}}
>
> \def\dodefineheadplacement[#1][#2]%
>    {\setvalue{\??ns:#1}{#2}%
>     \setvalue{\??ns::#1}##1##2}
>
>
> As \defineheadplacement is a user command it should be possible to use it in the form
>
>    \defineheadplacement[test][horizontal]{\inleft{#1 #2}}

I grepped all my projects and if you want that we need a more clever patch:

\def\dodefineheadplacementyes[#1][#2]%#3#4%
   {\setvalue{\??ns:#1}{#2}%
    \setvalue{\??ns::#1}##1##2}

\def\dodefineheadplacementnop[#1][#2]%
   {\setvalue{\??ns:#1}{#2}%
    \setvalue{\??ns::#1}}

\def\dodefineheadplacement[#1][#2]%
   {\doifnextbgroupelse
      {\dodefineheadplacementyes[#1][#2]}%
      {\dodefineheadplacementnop[#1][#2]}}

% \dodefineheadplacement[sectiona][vertical]{#1->#2}
% \dodefineheadplacement[sectionb][vertical]#1#2{#1->#2}

% \setuphead[section][alternative=sectiona]
% \setuphead[subsection][alternative=sectionb]

Can you check that?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Jun 17 07:08:06 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 17 Jun 2011 07:08:06 +0200
Subject: [dev-context] strc-sec.mkiv
Message-ID: <612F5056-B69B-4091-8BD8-BF5A593C4C3A@googlemail.com>

-\ifdefined \else \let\presetnumberheadalternative\relax \fi
+\ifdefined\presetnumberheadalternative \else \let\presetnumberheadalternative\relax \fi

Wolfgang


From wolfgang.schuster at gmail.com  Fri Jun 17 07:20:09 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Fri, 17 Jun 2011 07:20:09 +0200
Subject: [dev-context] \defineheadplacement
In-Reply-To: <4DFA7553.5050208@wxs.nl>
References: <0D7C2930-D429-4819-9377-B9B32DCEE119@gmail.com>
	<4DFA7553.5050208@wxs.nl>
Message-ID: <58C7A749-072F-4E42-B6B0-045F038D078C@gmail.com>


Am 16.06.2011 um 23:27 schrieb Hans Hagen:

> I grepped all my projects and if you want that we need a more clever patch:
> 
> [?]
> 
> Can you check that?

It works with and without parameters.

As the command is at user level it?s better to get rid of the arguments (like \define[2]\Command and \def\Command#1#2).

Wolfgang


From pragma at wxs.nl  Fri Jun 17 09:21:47 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 17 Jun 2011 09:21:47 +0200
Subject: [dev-context] \defineheadplacement
In-Reply-To: <58C7A749-072F-4E42-B6B0-045F038D078C@gmail.com>
References: <0D7C2930-D429-4819-9377-B9B32DCEE119@gmail.com>
	<4DFA7553.5050208@wxs.nl>
	<58C7A749-072F-4E42-B6B0-045F038D078C@gmail.com>
Message-ID: <4DFB008B.8060302@wxs.nl>

On 17-6-2011 7:20, Wolfgang Schuster wrote:
>
> Am 16.06.2011 um 23:27 schrieb Hans Hagen:
>
>> I grepped all my projects and if you want that we need a more clever patch:
>>
>> [?]
>>
>> Can you check that?
>
> It works with and without parameters.
>
> As the command is at user level it?s better to get rid of the arguments (like \define[2]\Command and \def\Command#1#2).

sure, but eventually the preferred way will be no arguments and all and 
calling up data with commands (as there can be more now than number and 
title e.g. userdata)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sat Jun 18 18:14:32 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 18 Jun 2011 18:14:32 +0200
Subject: [dev-context] grph-fig.mkiv
Message-ID: <5C764FCD-55EB-4C4C-A2AF-F47815A55ADC@googlemail.com>

Hi Hans,

can you add

  \ifdefined\dotagfigure \else \let\dotagfigure\relax \fi

to grph-fig.mkiv, otherwise \externalfigure fails.

Wolfgang


From schuster.wolfgang at googlemail.com  Sat Jun 18 18:43:27 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 18 Jun 2011 18:43:27 +0200
Subject: [dev-context] tabl-tab.mkiv
Message-ID: <2F249EB4-B163-4226-86CA-9E414D0E2F01@googlemail.com>

Line 1385:

-\let\stoptabel\relax
+\let\stoptable\relax

Wolfgang


From mojca.miklavec.lists at gmail.com  Sat Jun 18 20:31:30 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 18 Jun 2011 20:31:30 +0200
Subject: [dev-context] tabl-tab.mkiv
In-Reply-To: <2F249EB4-B163-4226-86CA-9E414D0E2F01@googlemail.com>
References: <2F249EB4-B163-4226-86CA-9E414D0E2F01@googlemail.com>
Message-ID: <BANLkTi=qNXK=qw2HU8Nz2WxKYhUdiqrCfw@mail.gmail.com>

Wolfgang,

you have sent a dozen of patches to the list recently.

For those that apply to TL, it might make sense to patch TL before
it's being released (depending on how much work that means and how
serious bug it is).

What do you think? (We could ask Karl to give you SVN account.)

Mojca


On Sat, Jun 18, 2011 at 18:43, Wolfgang Schuster wrote:
> Line 1385:
>
> -\let\stoptabel\relax
> +\let\stoptable\relax
>
> Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jun 19 16:46:08 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 19 Jun 2011 16:46:08 +0200
Subject: [dev-context] \startunpacked (spac-ver.mkiv)
Message-ID: <6561893E-58A5-42EF-A0E8-42FEE6B793AA@googlemail.com>

Hi Hans,

shouldn?t \startunpacked set \noblankinpacked to false?

\unexpanded\def\startunpacked
  {\blank
-  \bgroup}
+  \bgroup
+  \setfalse\noblankinpacked}

Wolfgang


From pragma at wxs.nl  Mon Jun 20 10:57:10 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 20 Jun 2011 10:57:10 +0200
Subject: [dev-context] bidi math
Message-ID: <4DFF0B66.3040509@wxs.nl>

Hi Khaled,

I extended the font mechanism to deal with bidirectional math fonts in 
such a way that we can have a mixed document (probably mostly usefull 
for testing fonts). I've put a beta on the ftp server. Hopefully I 
didn't mess up regular math too much.

% example from the xits suite

% \setupbodyfont[xits]
\setupbodyfont[xitsbidi]

\setupalign[r2l]

\starttext

\setupmathematics[align=r2l]

\startformula
\sqrt{?^2\over 4?} \eqno(1)
\stopformula

\setupmathematics[align=l2r]

\startformula
\sqrt{x^2\over 4x} \eqno(1)
\stopformula

\stoptext

The magic is in defining the font i.e. a typescript needs to define it. 
In font-otf I patched the definition:

     \starttypescript [math] [xits,xitsbidi] [name]
         \definefontsynonym[MathRoman] 
[\s!file:xits-math.otf][\s!features=\s!math\mathsizesuffix,\s!goodies=xits-math]
 
\definefontsynonym[MathRomanL2R][\s!file:xits-math.otf][\s!features=\s!math\mathsizesuffix-l2r,\s!goodies=xits-math]
 
\definefontsynonym[MathRomanR2L][\s!file:xits-math.otf][\s!features=\s!math\mathsizesuffix-r2l,\s!goodies=xits-math]
     \stoptypescript

There are some extra predefined featuresets. The R2L and L2R names are 
just symbolic and used here:

\definebodyfont [default] [mm]
   [mr=MathRoman mo 1,
    mrlr=MathRomanL2R mo 1,
    mrrl=MathRomanR2L mo 1]

Now, bidi is explicitly enabled by setting the direction parameter:

     \starttypescript[xitsbidi]
         \definetypeface [xitsbidi] [rm] [\s!serif] [xits]     [\s!default]
         \definetypeface [xitsbidi] [ss] [\s!sans]  [heros] 
[\s!default] [\s!rscale=0.9]
         \definetypeface [xitsbidi] [tt] [\s!mono]  [modern] 
[\s!default] [\s!rscale=1.05]
         %definetypeface [xitsbidi] [mm] [\s!math]  [xitsbidi] [bidi] 
[\s!direction=\s!both]
         \definetypeface [xitsbidi] [mm] [\s!math]  [xitsbidi] 
[\s!default] [\s!direction=\s!both]
     \stoptypescript

Maybe at some point we can just default to bidi for xits.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jun 22 15:30:50 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 22 Jun 2011 15:30:50 +0200
Subject: [dev-context] strc-lev.lua
Message-ID: <73C26A7B-5C3A-4F06-BE61-0E337C8EBF15@googlemail.com>

function sections.startautolevel(category)
   category = category ~= "" and category or default
   level = level + 1
   local lc = levels[category]
   if not lc or level > #lc then
-       context.nostartstructurehead { format("%s:%s",category,level) }
+       context.nostarthead { format("%s:%s",category,level) }
   else
-       context.dostartstructurehead { lc[level] }
+       context.dostarthead { lc[level] }
   end
   insert(categories,category)
end

function sections.stopautolevel()
   local category = remove(categories)
   local lc = levels[category]
   if not lc or level > #lc then
-       context.nostopstructurehead { format("%s:%s",category,level) }
+       context.nostophead { format("%s:%s",category,level) }
   else
-       context.dostopstructurehead { lc[level] }
+       context.dostophead { lc[level] }
   end
   level = level - 1
end

Wolfgang


From mojca.miklavec.lists at gmail.com  Wed Jun 22 19:20:57 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 22 Jun 2011 19:20:57 +0200
Subject: [dev-context] mtxrun problems again
Message-ID: <BANLkTimKYGhA=0y+f7ysb4wbqyA95hrcSw@mail.gmail.com>

Hello Taco,

I installed the latest TL (whithout your last minute changes today)
and saved x.tex into /tmp (I always do that with tests, so that
machine deletes them when I get reboot).

Running texexec on it results in:

matej:/tmp$ texexec x.tex
/home/matej/soft/texlive/2011/bin/i386-linux/mtxrun:10211: cannot open
./kde-kdm/: Permission denied
matej:/tmp$ ll
total 84
drwxrwxrwt 17 root  root    4096 2011-06-22 20:20 ./
drwxr-xr-x 22 root  root    4096 2011-06-22 17:52 ../
drwx------  2 kdm   nogroup 4096 2011-06-22 19:22 kde-kdm/
drwx------  2 matej matej   4096 2011-06-22 19:23 kde-matej/
drwx------  2 root  root    4096 2011-06-22 19:31 kde-root/
...
-rw-r--r--  1 matej matej     25 2011-06-22 20:20 x.tex

Mojca

From pragma at wxs.nl  Wed Jun 22 20:08:57 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 22 Jun 2011 20:08:57 +0200
Subject: [dev-context] mtxrun problems again
In-Reply-To: <BANLkTimKYGhA=0y+f7ysb4wbqyA95hrcSw@mail.gmail.com>
References: <BANLkTimKYGhA=0y+f7ysb4wbqyA95hrcSw@mail.gmail.com>
Message-ID: <4E022FB9.7080601@wxs.nl>

On 22-6-2011 7:20, Mojca Miklavec wrote:
> Hello Taco,
>
> I installed the latest TL (whithout your last minute changes today)
> and saved x.tex into /tmp (I always do that with tests, so that
> machine deletes them when I get reboot).


and with todays patches?

Hans
-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Jun 22 20:29:25 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 22 Jun 2011 20:29:25 +0200
Subject: [dev-context] mtxrun problems again
In-Reply-To: <4E022FB9.7080601@wxs.nl>
References: <BANLkTimKYGhA=0y+f7ysb4wbqyA95hrcSw@mail.gmail.com>
	<4E022FB9.7080601@wxs.nl>
Message-ID: <4E023485.1070801@elvenkind.com>



On 06/22/11 20:08, Hans Hagen wrote:
> On 22-6-2011 7:20, Mojca Miklavec wrote:
>> Hello Taco,
>>
>> I installed the latest TL (whithout your last minute changes today)
>> and saved x.tex into /tmp (I always do that with tests, so that
>> machine deletes them when I get reboot).
> 
> and with todays patches?

Good question, as I think that today's patches are quite relevant
for this issue.

Best wishes,
Taco

From pragma at wxs.nl  Wed Jun 22 23:31:23 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 22 Jun 2011 23:31:23 +0200
Subject: [dev-context] strc-lev.lua
In-Reply-To: <73C26A7B-5C3A-4F06-BE61-0E337C8EBF15@googlemail.com>
References: <73C26A7B-5C3A-4F06-BE61-0E337C8EBF15@googlemail.com>
Message-ID: <4E025F2B.3060902@wxs.nl>

On 22-6-2011 3:30, Wolfgang Schuster wrote:

> -       context.nostartstructurehead { format("%s:%s",category,level) }
> +       context.nostarthead { format("%s:%s",category,level) }

Ah, yes, everytime we now change a name we need to check the lua files 
as well; I also fall in the trap not checking the mkvi files.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Thu Jun 23 18:20:36 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 23 Jun 2011 18:20:36 +0200
Subject: [dev-context] ConTeXt for MikTeX
Message-ID: <BANLkTin8MY2_OkbWQ_-B53yzGgfEoWHxSA@mail.gmail.com>

Taco,

there have been quite some TeX Live-only changes made in ConTeXt to
enable it to work in acceptable way.

What do you suggest about MikTeX (which is currently, not
surprizingly, broken again after LuaTeX has been updated)? I think
that a hotfixed version is needed for MikTeX as well (as long as
LuaTeX is compatible in MikTeX and TL - an at the moment it is exactly
the same version - we could use the same version, but it might be that
MikTeX will need tiny adjustments again for one reason or the other).

It might help to have some independent repository somewhere with TeX
Live and MikTeX branch (and maybe one will be needed for Minimals as
well :), to patch stable ConTeXt versions with the most critical
patches. Those patches should be applied upstream anyway, but we
cannot afford to just take the latest version of ConTeXt into MikTeX.

What do you suggest? Creating some repository, patch ConTeXt there and
submit that one to CTAN? Ask Christian to fetch from there? Any better
idea?

Mojca

From pragma at wxs.nl  Thu Jun 23 19:07:00 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 23 Jun 2011 19:07:00 +0200
Subject: [dev-context] ConTeXt for MikTeX
In-Reply-To: <BANLkTin8MY2_OkbWQ_-B53yzGgfEoWHxSA@mail.gmail.com>
References: <BANLkTin8MY2_OkbWQ_-B53yzGgfEoWHxSA@mail.gmail.com>
Message-ID: <4E0372B4.6040001@wxs.nl>

On 23-6-2011 6:20, Mojca Miklavec wrote:
> Taco,
>
> there have been quite some TeX Live-only changes made in ConTeXt to
> enable it to work in acceptable way.
>
> What do you suggest about MikTeX (which is currently, not
> surprizingly, broken again after LuaTeX has been updated)? I think
> that a hotfixed version is needed for MikTeX as well (as long as
> LuaTeX is compatible in MikTeX and TL - an at the moment it is exactly
> the same version - we could use the same version, but it might be that
> MikTeX will need tiny adjustments again for one reason or the other).
>
> It might help to have some independent repository somewhere with TeX
> Live and MikTeX branch (and maybe one will be needed for Minimals as
> well :), to patch stable ConTeXt versions with the most critical
> patches. Those patches should be applied upstream anyway, but we
> cannot afford to just take the latest version of ConTeXt into MikTeX.
>
> What do you suggest? Creating some repository, patch ConTeXt there and
> submit that one to CTAN? Ask Christian to fetch from there? Any better
> idea?

I'll update a beta ... that one probably works as it has all hotfixes as 
well as some other things Taco and I played with last days.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Fri Jun 24 21:47:31 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Fri, 24 Jun 2011 15:47:31 -0400 (EDT)
Subject: [dev-context] Units
Message-ID: <alpine.LNX.2.02.1106241546310.19254@ybpnyubfg.ybpnyqbznva>

Math letters do not work with the new units module.

\unit{micro ohm}

gives nothing.

Aditya


From pragma at wxs.nl  Fri Jun 24 22:57:31 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 24 Jun 2011 22:57:31 +0200
Subject: [dev-context] Units
In-Reply-To: <alpine.LNX.2.02.1106241546310.19254@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1106241546310.19254@ybpnyubfg.ybpnyqbznva>
Message-ID: <4E04FA3B.2030905@wxs.nl>

On 24-6-2011 9:47, Aditya Mahajan wrote:
> Math letters do not work with the new units module.
>
> \unit{micro ohm}
>
> gives nothing.

i'll add alternative=mathematics

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sat Jun 25 11:44:58 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 25 Jun 2011 11:44:58 +0200
Subject: [dev-context] Units
In-Reply-To: <4E04FA3B.2030905@wxs.nl>
References: <alpine.LNX.2.02.1106241546310.19254@ybpnyubfg.ybpnyqbznva>
	<4E04FA3B.2030905@wxs.nl>
Message-ID: <9040AB0C-7FC7-47AB-B781-EBB75480DF6C@googlemail.com>


Am 24.06.2011 um 22:57 schrieb Hans Hagen:

> On 24-6-2011 9:47, Aditya Mahajan wrote:
>> Math letters do not work with the new units module.
>> 
>> \unit{micro ohm}
>> 
>> gives nothing.
> 
> i'll add alternative=mathematics

Or use ? and ? as symbols, this way it works in text and math mode
while you force one to use math for these two symbols.

Wolfgang


From pragma at wxs.nl  Sat Jun 25 12:11:21 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 25 Jun 2011 12:11:21 +0200
Subject: [dev-context] Units
In-Reply-To: <9040AB0C-7FC7-47AB-B781-EBB75480DF6C@googlemail.com>
References: <alpine.LNX.2.02.1106241546310.19254@ybpnyubfg.ybpnyqbznva>	<4E04FA3B.2030905@wxs.nl>
	<9040AB0C-7FC7-47AB-B781-EBB75480DF6C@googlemail.com>
Message-ID: <4E05B449.6050009@wxs.nl>

On 25-6-2011 11:44, Wolfgang Schuster wrote:
>
> Am 24.06.2011 um 22:57 schrieb Hans Hagen:
>
>> On 24-6-2011 9:47, Aditya Mahajan wrote:
>>> Math letters do not work with the new units module.
>>>
>>> \unit{micro ohm}
>>>
>>> gives nothing.
>>
>> i'll add alternative=mathematics
>
> Or use ? and ? as symbols, this way it works in text and math mode
> while you force one to use math for these two symbols.

Ok. Let's try this then (in phys-dim.lua):

long_prefixes.Micro = [[\textmu]]
long_units   .Ohm   = [[\textohm]]



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Jun 26 13:25:55 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 26 Jun 2011 13:25:55 +0200
Subject: [dev-context] migrating inserts
Message-ID: <4E071743.2010407@wxs.nl>

Hi,

Messing around with inserts is somewhat special in the interference with 
page building (at some point in luatex we will get more control over 
triggering the pagebuilder to recalculate things). I patches float 
flushing a bit so that the following works, but I'm not sure about side 
effects (there might be none) so we need to keep an eye on it.

% test related to 2011.06.24.001

\automigrateinserts

\setupnote[footnote][split=verystrict]

\starttext

     \chapter{A chapter with a note \footnote{chapter note}}

     Inline text with a note \footnote{inline note}.\par
     Inline text with a note \footnote{inline note}.\par
     Inline text with a note \footnote{inline note}.\par
     Inline text with a note \footnote{inline note}.\par
     Inline text with a note \footnote{inline note}.\par
     Inline text with a note \footnote{inline note}.\par

     \placefigure{A caption with a note \footnote{caption 
note}.}{\externalfigure[cow][height=3cm]}
     \placefigure{A caption with a note \footnote{caption 
note}.}{\externalfigure[cow][height=3cm]}
     \placefigure{A caption with a note \footnote{caption 
note}.}{\externalfigure[cow][height=3cm]}
     \placefigure{A caption with a note \footnote{caption 
note}.}{\externalfigure[cow][height=3cm]}
     \placefigure{A caption with a note \footnote{caption 
note}.}{\externalfigure[cow][height=3cm]}

     \section{A section with a note \footnote{section not}}

     Inline text with a note \footnote{inline note}.\par

\stoptext


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jun 27 10:16:20 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 27 Jun 2011 10:16:20 +0200
Subject: [dev-context] strc-sec.mkiv
Message-ID: <96A6D1D2-0333-4CA3-B578-BC6378405296@googlemail.com>

\appendtoks
    ...
        \doifelselist\currenthead\donothing
-         {\definelist[\currenthead][\currentheadparent][\c!prefix=\v!no]}%
+         {\normalexpanded{\definelist[\currenthead][\currentheadparent][\c!prefix=\v!no]}}%
    ...
\to \everydefinehead

Wolfgang


From schuster.wolfgang at googlemail.com  Tue Jun 28 11:30:48 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 28 Jun 2011 11:30:48 +0200
Subject: [dev-context] core-con.mkiv
Message-ID: <3C600458-C514-4508-A989-84A0D472398D@googlemail.com>

core-con.mkiv: missing ?)"

-\def\ordinaldaynumber   #1{\ctxcommand{ordinal(#1,"\currentlanguage"}}
+\def\ordinaldaynumber   #1{\ctxcommand{ordinal(#1,"\currentlanguage")}}


core-con.lua: missing ?w? in the last two

local ordinals = {
    english = function(n)
        local two = n % 100
-       if two == 11 or two == 12 or to == 13 then
+       if two == 11 or two == 12 or two == 13 then


core-con.lua: print the number!

function commands.ordinal(n,language)
    local t = language and ordinals[language]
    local o = t and t(n)
+   context(n) -- is this the right place?
    if o then
        context.highordinalstr(o)
    end
end

Wolfgang


From pragma at wxs.nl  Tue Jun 28 13:25:03 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 28 Jun 2011 13:25:03 +0200
Subject: [dev-context] core-con.mkiv
In-Reply-To: <3C600458-C514-4508-A989-84A0D472398D@googlemail.com>
References: <3C600458-C514-4508-A989-84A0D472398D@googlemail.com>
Message-ID: <4E09BA0F.7000405@wxs.nl>

On 28-6-2011 11:30, Wolfgang Schuster wrote:
> core-con.mkiv: missing ?)"
>
> -\def\ordinaldaynumber   #1{\ctxcommand{ordinal(#1,"\currentlanguage"}}
> +\def\ordinaldaynumber   #1{\ctxcommand{ordinal(#1,"\currentlanguage")}}

maybe that one should be unexpandable

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jun 29 00:04:55 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 29 Jun 2011 00:04:55 +0200
Subject: [dev-context] strc-sec.mkiv
Message-ID: <DF9A9913-91EE-4230-B5AD-BD6EBF670A47@googlemail.com>

Line 773: \def\currentheadnumber  {\currentheadnumber}

A leftover from the time where internal commands had ?structure? in their name and the above was

  \def\currentheadnumber  {\currentstructureheadnumber}

that can be removed.

Wolfgang




From pragma at wxs.nl  Wed Jun 29 00:09:00 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 29 Jun 2011 00:09:00 +0200
Subject: [dev-context] strc-sec.mkiv
In-Reply-To: <DF9A9913-91EE-4230-B5AD-BD6EBF670A47@googlemail.com>
References: <DF9A9913-91EE-4230-B5AD-BD6EBF670A47@googlemail.com>
Message-ID: <4E0A50FC.3060608@wxs.nl>

On 29-6-2011 12:04, Wolfgang Schuster wrote:
> Line 773: \def\currentheadnumber  {\currentheadnumber}
>
> A leftover from the time where internal commands had ?structure? in their name and the above was
>
>    \def\currentheadnumber  {\currentstructureheadnumber}
>
> that can be removed.

Indeed, pretty circular otherwise.

I'll upload a beta. BTW, I also updated char-def.lua (larger now).

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Jul  1 13:00:06 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 1 Jul 2011 13:00:06 +0200
Subject: [dev-context] strc-flt.mkiv
Message-ID: <151BA3C0-74AC-4DA1-9F38-78CC35E9A48A@googlemail.com>

I?m not sure about this:

\def\movedownsidefloat[#1]% already in core
  {\bgroup
   \cleanupfeatures
   \doifinstringelse{:}{#1}
     \donothing
     {\def\docommand##1%
        {\processaction
           [##1]%
           [ \v!line=>\dodocommand+,%
            +\v!line=>\dodocommand+,%
            -\v!line=>\dodocommand-]}%
      \def\dodocommand##1%
        {\ifdone\else\global\sidefloatdownshift\zeropoint\donetrue\fi
         \global\advance\sidefloatdownshift##1\lineheight}%
      \donefalse\normalexpanded{\noexpand\dorepeatwithcommand[#1]}\docommand
      \def\docommand##1%
        {\processaction
           [##1]%
           [ \v!hang=>\dodocommand+,%
            +\v!hang=>\dodocommand+,%
            -\v!hang=>\dodocommand-]}%
      \def\dodocommand##1% inefficient but who cares
-       {\ifdone\else\global\sidefloatsidelines\zeropoint\donetrue\fi
-        \global\advance\sidefloatsidelines\plusone\relax}%
+       {\ifdone\else\global\sidefloatsidelines\zerocount\donetrue\fi
+        \global\advance\sidefloatsidelines##1\plusone\relax}%
      \donefalse\normalexpanded{\noexpand\dorepeatwithcommand[#1]}\docommand}%
   \egroup}

Wolfgang


From pragma at wxs.nl  Fri Jul  1 17:35:46 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 01 Jul 2011 17:35:46 +0200
Subject: [dev-context] strc-flt.mkiv
In-Reply-To: <151BA3C0-74AC-4DA1-9F38-78CC35E9A48A@googlemail.com>
References: <151BA3C0-74AC-4DA1-9F38-78CC35E9A48A@googlemail.com>
Message-ID: <4E0DE952.7070101@wxs.nl>

On 1-7-2011 1:00, Wolfgang Schuster wrote:

> -       {\ifdone\else\global\sidefloatsidelines\zeropoint\donetrue\fi
> -        \global\advance\sidefloatsidelines\plusone\relax}%
> +       {\ifdone\else\global\sidefloatsidelines\zerocount\donetrue\fi
> +        \global\advance\sidefloatsidelines##1\plusone\relax}%

looks ok, changed


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jul  1 17:57:06 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 01 Jul 2011 17:57:06 +0200
Subject: [dev-context] beta
Message-ID: <4E0DEE52.1070105@wxs.nl>

Hi,

For those with access to the ftp server: there is a new beta. There are 
two important changes:

- When a font is not found (by file) the file database is regenerated if 
there is a mismatch with the format version.

- All (most) file related code has been moved to the file-* files. In 
the process more activity is delegated to lua and some obscure helper 
macros have been removed (were only needed deep down).

Willi: You have to test the project code as I'm not sure if all works as 
expected. You can now do things like:

\environment environment-1.lua
\environment environment-1.tex
\environment environment-2

\startproduct product-1

     \component component-1.lua
     \component component-1.tex
     \component component-2.tex
     \component component-3.cld

     \component component-1
     \component component-2

\stopproduct

You can also play with

\loadluafile[yourfile]
\loadluafileonce[yourfile]
\loadluafile[loc:///yourfile]
\loadluafileonce[loc:///yourfile]

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jul  6 14:46:16 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 6 Jul 2011 14:46:16 +0200
Subject: [dev-context] \definelistplacement
Message-ID: <B40D8B95-E02E-4222-BFAF-96CB6D09D460@googlemail.com>

Hi Hans,

after the change for \defineheadplacement i suggest to remove the parameters from \definelistplacement too.

\unprotect

\unexpanded\def\definelistplacement
  {\dodoubleempty\dodefinelistplacement}

\def\dodefinelistplacement[#1][#2]%
  {\doifnextbgroupelse
     {\dodefinelistplacementyes[#1][#2]}
     {\dodefinelistplacementnop[#1][#2]}}

\def\dodefinelistplacementyes[#1][#2]%
  {\dodefinelistplacementnop[#1][#2]##1##2##3}

\def\dodefinelistplacementnop[#1][#2]%
  {\setvalue{\@@dodolistelement#1}%
     {\doifelsenothing{#2}
        {\getvalue{\@@dodolistelement\v!command}}%
        {\executeifdefined{\@@dodolistelement#2}{\getvalue{\@@dodolistelement\v!command}}}%
      \setvalue{\??li\currentlist\c!command}{\getvalue{\@@dodolistelement::#1}}}%
   \setvalue{\@@dodolistelement::#1}}

\protect

\definehead[sectiona][section]
\definehead[sectionb][section]

\setuplist[sectiona][alternative=ListA,before=\blank,after=\blank]
\setuplist[sectionb][alternative=ListB,before=\blank,after=\blank]

\definelistplacement[ListA][none]#1#2#3%
  {(#1) (#2) (#3)}

\definelistplacement[ListB][none]%
  {[#1] [#2] [#3]}

\starttext

\placelist[sectiona,sectionb]

\sectiona{A}
\sectionb{B}

\stoptext

Wolfgang


From pragma at wxs.nl  Thu Jul  7 15:01:12 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 07 Jul 2011 15:01:12 +0200
Subject: [dev-context] asciimode
Message-ID: <4E15AE18.6040406@wxs.nl>

Hi,

As I needed ascii mode for some style, I played a bit more with it. In 
the process I realized that it was interfering with environment and 
module loading so I took care of that. Then there is the problem of 
commenting. As it is unlikely that a double % ends up in a document, I 
made a mechanism to deal with that:

\asciimode

\usemodule[x][mathml]

\starttext

10% interest %% is way too much

ABC%%
DEF

\mathematics{x^2}

\startMPcode
     fill fullcircle scaled 10cm withcolor red ; %% test
\stopMPcode

\starttyping
test test %% test
\stoptyping

\stoptext

So, as with -- in lua or // in c we have %% in ascii tex. I hope that 
this makes sense. (The beta on the ftp server has it.)

It might make sense to use a different way to trigger asciimode, with 
some setup command.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Jul  8 16:24:06 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 8 Jul 2011 16:24:06 +0200
Subject: [dev-context] strc-mat.mkiv
Message-ID: <2EA9CBC8-FD2A-4980-A1C4-A230B86EA357@googlemail.com>

\unexpanded\def\stopsubformulas
  {\nonoindentation
-  \checknextindentation[\formulaparameter\c!indentnext]%
+  \checknextindentation[\subformulaparameter\c!indentnext]%
   \the\everyresetformulas % to be checked
   \global\setfalse\insidesubformulas
   \dorechecknextindentation} % here ?

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jul 10 10:13:27 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 10 Jul 2011 10:13:27 +0200
Subject: [dev-context] strc-syn.mkiv
Message-ID: <2F548A8C-58D6-4B89-8BD5-E8B6ACC8E65A@googlemail.com>

-\def\registersynonym[#1][#2]%
+\def\doregistersynonym[#1][#2]%
  {\ctxlua{structures.synonyms.registerused("#1","#2")}}

Wolfgang


From wolfgang.schuster at gmail.com  Sun Jul 10 11:13:14 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 10 Jul 2011 11:13:14 +0200
Subject: [dev-context] strc-syn.mkiv
Message-ID: <7664B739-668A-4B85-9667-D60737A61A21@gmail.com>

\def\docompletelistofsorts[#1][#2]%
- {\normalexpanded{\systemsuppliedchapter[#1]{\noexpand\headtext{#2}}}%
+ {\edef\currentsorting{#1}%
+  \normalexpanded{\systemsuppliedchapter[#1]{\noexpand\headtext{\sortingparameter\s!multi}}}%
   \doplacelistofsorts[#1][#2]%
   \page[\v!yes]}

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Jul 10 11:20:32 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 10 Jul 2011 11:20:32 +0200
Subject: [dev-context] strc-syn.mkiv
Message-ID: <0245515A-B1CD-40C5-AAE9-C59DC19588DB@googlemail.com>

\def\docompletelistofsorts[#1][#2]%
- {\normalexpanded{\systemsuppliedchapter[#1]{\noexpand\headtext{#2}}}%
+ {\edef\currentsorting{#1}%
+  \normalexpanded{\systemsuppliedchapter[#1]{\noexpand\headtext{\sortingparameter\s!multi}}}%
  \doplacelistofsorts[#1][#2]%
  \page[\v!yes]}

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Jul 10 12:30:15 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 10 Jul 2011 12:30:15 +0200
Subject: [dev-context] strc-syn.mkiv
Message-ID: <94E75599-C49E-4023-BC69-64AC629F5754@googlemail.com>

-\def\registersort[#1][#2]%
+\def\doregistersort[#1][#2]%
  {\ctxlua{structures.synonyms.registerused("#1","#2")}}

Wolfgang

From pragma at wxs.nl  Sun Jul 10 13:33:26 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 10 Jul 2011 13:33:26 +0200
Subject: [dev-context] beta
Message-ID: <4E198E06.50007@wxs.nl>

Hi,

For those with access to it, I've put a new beta on the ftp server. The 
main 'change' is that I changed all (still left) tex.sprint etc calls 
into calls in the context namespace. Todo is to create a namespace for 
helpers. The advantage (and reason for doing it) is that tracing with

\enabletrackers[context.trace]

shows all data passed from lua to tex. This also concerns xml handling. 
Hopefully it does not have an impact on performance (at least I tried to 
make sure of that). In the process some code has been cleaned up with 
respect to handling of newlines (always kind of tricky in tex) and I 
might have missed something. In addition to the context(..) and 
context.command(..) comman done can use context.sprint(optional catcode 
regime, ...).

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jul 11 11:02:06 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 11 Jul 2011 11:02:06 +0200
Subject: [dev-context] strc-ref.mkiv
Message-ID: <66E601E5-C985-4375-8BC2-BBB87267CE45@googlemail.com>

Missing ?do? in the else branch:

-\unexpanded\def\directgoto{\ifconditional\uselocationstrut\expandafter\dodirectgoto\else\expandafter\directgotohtdp\fi}
-\unexpanded\def\goto      {\ifconditional\uselocationstrut\expandafter\dogoto      \else\expandafter\gotohtdp      \fi}
+\unexpanded\def\directgoto{\ifconditional\uselocationstrut\expandafter\dodirectgoto\else\expandafter\dodirectgotohtdp\fi}
+\unexpanded\def\goto      {\ifconditional\uselocationstrut\expandafter\dogoto      \else\expandafter\dogotohtdp      \fi}

Wolfgang


From schuster.wolfgang at googlemail.com  Mon Jul 11 19:47:50 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 11 Jul 2011 19:47:50 +0200
Subject: [dev-context] sort-ini.lua
Message-ID: <7183CED9-89D0-446A-9E89-94A966679EA8@googlemail.com>

local function setlanguage(l,m,d,u)
    ...
    method = predefinedmethods[variables[method]] or method
    data.method  = method
    --
-   data.digits  = digite
+   data.digits  = digits
    --
    local seq = utilities.parsers.settings_to_array(method or "") -- check the list
    ...
end

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jul 13 18:00:49 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 13 Jul 2011 18:00:49 +0200
Subject: [dev-context] strc-num.mkiv
Message-ID: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>

Hi Hans,

what?s the status of the \reset command, is it a valid command or obsolete.

When it is a usable command you should change the definition, i think this should for \definenumber created counters (functions like enumeration already provide their own mechanism).

\def\reset
  {\dosingleargument\doreset}

\def\doreset[#1]%
  {\processcommalistwithparameters[#1]\resetstructurecounter}

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jul 13 19:18:43 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 13 Jul 2011 19:18:43 +0200
Subject: [dev-context] strc-num.mkiv
Message-ID: <D47872BA-764A-4509-A620-29AD262B15C6@googlemail.com>

Hi Hans,

can you make \setupnumbering a synonym for \setupstructurecountering?

  \let\setupnumbering\setupstructurecountering

Wolfgang


From pragma at wxs.nl  Wed Jul 13 19:56:36 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 13 Jul 2011 19:56:36 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <D47872BA-764A-4509-A620-29AD262B15C6@googlemail.com>
References: <D47872BA-764A-4509-A620-29AD262B15C6@googlemail.com>
Message-ID: <4E1DDC54.2000507@wxs.nl>

On 13-7-2011 7:18, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you make \setupnumbering a synonym for \setupstructurecountering?
>
>    \let\setupnumbering\setupstructurecountering

sure (still not sure about dropping the structurecounter names)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Jul 13 19:58:48 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 13 Jul 2011 19:58:48 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
References: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
Message-ID: <4E1DDCD8.9060706@wxs.nl>

On 13-7-2011 6:00, Wolfgang Schuster wrote:
> Hi Hans,
>
> what?s the status of the \reset command, is it a valid command or obsolete.
>
> When it is a usable command you should change the definition, i think this should for \definenumber created counters (functions like enumeration already provide their own mechanism).
>
> \def\reset
>    {\dosingleargument\doreset}
>
> \def\doreset[#1]%
>    {\processcommalistwithparameters[#1]\resetstructurecounter}

Actually I wanted to get rid of it ... but we can make this one 
\resetnumber (at least it's clear then what gets reset)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jul 13 20:02:42 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 13 Jul 2011 20:02:42 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <4E1DDC54.2000507@wxs.nl>
References: <D47872BA-764A-4509-A620-29AD262B15C6@googlemail.com>
	<4E1DDC54.2000507@wxs.nl>
Message-ID: <F7F50ABB-EAF9-4708-9B9C-E1F1C9F6B203@googlemail.com>


Am 13.07.2011 um 19:56 schrieb Hans Hagen:

> On 13-7-2011 7:18, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> can you make \setupnumbering a synonym for \setupstructurecountering?
>> 
>>   \let\setupnumbering\setupstructurecountering
> 
> sure (still not sure about dropping the structurecounter names)

I?ll document only \definenumber, \setupnumber etc. The structure variants are internal commands and unimportant for the command reference.

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jul 13 20:04:19 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 13 Jul 2011 20:04:19 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <4E1DDCD8.9060706@wxs.nl>
References: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
	<4E1DDCD8.9060706@wxs.nl>
Message-ID: <9CB2622F-640E-4F34-A388-07D0EC8A2180@googlemail.com>


Am 13.07.2011 um 19:58 schrieb Hans Hagen:

> On 13-7-2011 6:00, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> what?s the status of the \reset command, is it a valid command or obsolete.
>> 
>> When it is a usable command you should change the definition, i think this should for \definenumber created counters (functions like enumeration already provide their own mechanism).
>> 
>> \def\reset
>>   {\dosingleargument\doreset}
>> 
>> \def\doreset[#1]%
>>   {\processcommalistwithparameters[#1]\resetstructurecounter}
> 
> Actually I wanted to get rid of it ... but we can make this one \resetnumber (at least it's clear then what gets reset)

In this case I?m going to ignore it because there is already a \resetnumber command:

  \let \resetnumber           \resetstructurecounter     % [name]

Wolfang


From pragma at wxs.nl  Wed Jul 13 20:13:37 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 13 Jul 2011 20:13:37 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <9CB2622F-640E-4F34-A388-07D0EC8A2180@googlemail.com>
References: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
	<4E1DDCD8.9060706@wxs.nl>
	<9CB2622F-640E-4F34-A388-07D0EC8A2180@googlemail.com>
Message-ID: <4E1DE051.7010402@wxs.nl>

On 13-7-2011 8:04, Wolfgang Schuster wrote:
>
> Am 13.07.2011 um 19:58 schrieb Hans Hagen:
>
>> On 13-7-2011 6:00, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> what?s the status of the \reset command, is it a valid command or obsolete.
>>>
>>> When it is a usable command you should change the definition, i think this should for \definenumber created counters (functions like enumeration already provide their own mechanism).
>>>
>>> \def\reset
>>>    {\dosingleargument\doreset}
>>>
>>> \def\doreset[#1]%
>>>    {\processcommalistwithparameters[#1]\resetstructurecounter}
>>
>> Actually I wanted to get rid of it ... but we can make this one \resetnumber (at least it's clear then what gets reset)
>
> In this case I?m going to ignore it because there is already a \resetnumber command:
>
>    \let \resetnumber           \resetstructurecounter     % [name]

ok; the only difference then would be that it can be a list but we can 
as well get rid of that

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jul 13 20:26:25 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 13 Jul 2011 20:26:25 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <4E1DE051.7010402@wxs.nl>
References: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
	<4E1DDCD8.9060706@wxs.nl>
	<9CB2622F-640E-4F34-A388-07D0EC8A2180@googlemail.com>
	<4E1DE051.7010402@wxs.nl>
Message-ID: <12B36BF7-7276-4983-AF74-614EA385A2D0@googlemail.com>


Am 13.07.2011 um 20:13 schrieb Hans Hagen:

>>> Actually I wanted to get rid of it ... but we can make this one \resetnumber (at least it's clear then what gets reset)
>> 
>> In this case I?m going to ignore it because there is already a \resetnumber command:
>> 
>>   \let \resetnumber           \resetstructurecounter     % [name]
> 
> ok; the only difference then would be that it can be a list but we can as well get rid of that

as none of the number commands accepts a list it shouldn?t matter

Wolfgang


From pragma at wxs.nl  Wed Jul 13 20:43:41 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 13 Jul 2011 20:43:41 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <12B36BF7-7276-4983-AF74-614EA385A2D0@googlemail.com>
References: <978C3C20-FDEB-40FE-9383-C27E75FCC4C0@googlemail.com>
	<4E1DDCD8.9060706@wxs.nl>
	<9CB2622F-640E-4F34-A388-07D0EC8A2180@googlemail.com>
	<4E1DE051.7010402@wxs.nl>
	<12B36BF7-7276-4983-AF74-614EA385A2D0@googlemail.com>
Message-ID: <4E1DE75D.4090901@wxs.nl>

On 13-7-2011 8:26, Wolfgang Schuster wrote:
>
> Am 13.07.2011 um 20:13 schrieb Hans Hagen:
>
>>>> Actually I wanted to get rid of it ... but we can make this one \resetnumber (at least it's clear then what gets reset)
>>>
>>> In this case I?m going to ignore it because there is already a \resetnumber command:
>>>
>>>    \let \resetnumber           \resetstructurecounter     % [name]
>>
>> ok; the only difference then would be that it can be a list but we can as well get rid of that
>
> as none of the number commands accepts a list it shouldn?t matter

ok, new beta .. this one will also be uploaded

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Sun Aug  7 10:56:40 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 7 Aug 2011 10:56:40 +0200
Subject: [dev-context] \ifsectionnumber
Message-ID: <16A2CC0D-AED1-4DAE-A9E1-713086432375@gmail.com>

Hi Hans,

is \ifsectionnumber really needed?

When you run the following example \setuphead sets \ifsectionnumber to false and this disables are heading numbers:

\setuphead[section][number=no]%\sectionnumbertrue

\starttext

\chapter{Chapter}
\section{Section}

\stoptext

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Aug  7 11:07:08 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 7 Aug 2011 11:07:08 +0200
Subject: [dev-context] \ifsectionnumber
Message-ID: <AABB5587-A58A-44E8-B27F-2BAB79B896C9@googlemail.com>

Hi Hans,

is \ifsectionnumber really needed?

When you run the following example \setuphead sets \ifsectionnumber to false and this disables are heading numbers:

\setuphead[section][number=no]%\sectionnumbertrue

\starttext

\chapter{Chapter}
\section{Section}

\stoptext

Wolfgang

From ishamid at colostate.edu  Sun Aug 14 22:23:06 2011
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMgICDYs9mF2KfZiNmKIA==?= =?utf-8?B?2K3Yp9mF2K8=?=)
Date: Sun, 14 Aug 2011 14:23:06 -0600
Subject: [dev-context] ConTeXt Book: Request for help!
Message-ID: <op.vz7z8sdvpw6hmh@ishamid-pc>

Dear gang,

As some of you may know, I'm working on a professional introductory book  
for learning ConTeXt. Part of the philosophy of this book is to be as  
self-contained as possible, so we'll be using a preferred editor.

Not one editor/ide out there is ideal for ConTeXt (including bidi editing  
and other user-friendly configurability). The best balance I could find is  
Notepad++ (Npp), and that's what I'm going with. I have done a lot of work  
to contextify it, and I have added some new features, such as a  
context-menu where one can right-click and get a list of ConTeXt  
typography and description options, experimental support for tooltips  
(giving options for commands etc), no more manual braces (so far less run  
errors) etc.

To take this to the next level I need help: Is there anyone on the list  
who knows how to write and compile lexers for scintilla-based editors?  
Also, how to compile C++ for M$-Windows based applications such as Npp?

Npp has a rich user-defined dialog, and I have been able to do a lot with  
it, but it has some serious limitations. So I'd like to port my  
user-definitions to a lexer. We can probably start with the code for the  
included TeX lexer, de-latexify it, and add the needed functions for  
ConTeXt, including a few other features.

If anyone is interested, please contact me!

Best wishes
Idris
-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Sh??? Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From pragma at wxs.nl  Sun Aug 14 22:46:53 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 Aug 2011 22:46:53 +0200
Subject: [dev-context] \ifsectionnumber
In-Reply-To: <AABB5587-A58A-44E8-B27F-2BAB79B896C9@googlemail.com>
References: <AABB5587-A58A-44E8-B27F-2BAB79B896C9@googlemail.com>
Message-ID: <4E48343D.7040609@wxs.nl>

On 7-8-2011 11:07, Wolfgang Schuster wrote:
> Hi Hans,
>
> is \ifsectionnumber really needed?
>
> When you run the following example \setuphead sets \ifsectionnumber to false and this disables are heading numbers:
>
> \setuphead[section][number=no]%\sectionnumbertrue
>
> \starttext
>
> \chapter{Chapter}
> \section{Section}
>
> \stoptext

it can probably go away (it's the global setting) but we have an 
inheritance problem (took me a while to figure it out)

\setuphead[section][number=yes]

is clashing with

\c!sectionnumber=\v!yes,

needs a bit of thinking

(as we don't use \@@xxname here we can probably add an : to currenthead 
without too problems; we had something similar with framed)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Aug 15 08:51:56 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 15 Aug 2011 08:51:56 +0200
Subject: [dev-context] ConTeXt Book: Request for help!
In-Reply-To: <op.vz7z8sdvpw6hmh@ishamid-pc>
References: <op.vz7z8sdvpw6hmh@ishamid-pc>
Message-ID: <CAG5iGsCz9Nb4tcZ9GNPre+r6hhVjZtTu=c1JixB05zaV1Us-3g@mail.gmail.com>

2011/8/14 Idris Samawi Hamid ?????   ????? ???? <ishamid at colostate.edu>:
> Dear gang,
>
> As some of you may know, I'm working on a professional introductory book for
> learning ConTeXt. Part of the philosophy of this book is to be as
> self-contained as possible, so we'll be using a preferred editor.
>
> Not one editor/ide out there is ideal for ConTeXt (including bidi editing
> and other user-friendly configurability). The best balance I could find is
> Notepad++ (Npp), and that's what I'm going with. I have done a lot of work
> to contextify it, and I have added some new features, such as a context-menu
> where one can right-click and get a list of ConTeXt typography and
> description options, experimental support for tooltips (giving options for
> commands etc), no more manual braces (so far less run errors) etc.
>
> To take this to the next level I need help: Is there anyone on the list who
> knows how to write and compile lexers for scintilla-based editors? Also, how
> to compile C++ for M$-Windows based applications such as Npp?

I've used gub
http://lilypond.org/gub/
to cross-compile object modules
from linux to windows

Under Windows there is mingw
http://www.mingw.org
but I don't know about something similar to gub

There is also the  express edition of the microsoft compiler,see
http://www.microsoft.com/express


-- 
luigi

From ishamid at colostate.edu  Mon Aug 15 11:51:56 2011
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMgICDYs9mF2KfZiNmKIA==?= =?utf-8?B?2K3Yp9mF2K8=?=)
Date: Mon, 15 Aug 2011 03:51:56 -0600
Subject: [dev-context] ConTeXt Book: Request for help!
In-Reply-To: <CAG5iGsCz9Nb4tcZ9GNPre+r6hhVjZtTu=c1JixB05zaV1Us-3g@mail.gmail.com>
References: <op.vz7z8sdvpw6hmh@ishamid-pc>
	<CAG5iGsCz9Nb4tcZ9GNPre+r6hhVjZtTu=c1JixB05zaV1Us-3g@mail.gmail.com>
Message-ID: <op.vz81ouwqpw6hmh@ishamid-pc>

Hi Luigi,

On Mon, 15 Aug 2011 00:51:56 -0600, luigi scarso <luigi.scarso at gmail.com>  
wrote:

> I've used gub
> http://lilypond.org/gub/
> to cross-compile object modules
> from linux to windows
> Under Windows there is mingw
> http://www.mingw.org
> but I don't know about something similar to gub
> There is also the  express edition of the microsoft compiler,see
> http://www.microsoft.com/express

Would you be willing to help me develop a ConTeXt lexer?

:D

Idris
-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Sh??? Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From schuster.wolfgang at googlemail.com  Sun Sep 11 18:29:13 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 11 Sep 2011 18:29:13 +0200
Subject: [dev-context] scrn-fld.mkvi
Message-ID: <D03527AC-A291-4789-A7AC-B0A5336BCA8C@googlemail.com>

Hi,

\def\scrn_fieldstack_add#tag#settings#symbol%
  {\advance\scratchcounter\plusone
   \edef\currentfieldstackname{#tag:\number\scratchcounter}%
-  \ifnum\scratchcounter=\ifnum\scratchcounter=\fieldcategoryparameter\c!start\relax
+  \ifnum\scratchcounter=\fieldcategoryparameter\c!start\relax
     \definefieldbody[\currentfieldstackname][\c!type=check,\c!values={#symbol,\empty},\c!default={#symbol}]%
   \else
     \definefieldbody[\currentfieldstackname][\c!type=check,\c!values={#symbol,\empty},\c!default=]%
   \fi
   \setbox\scrn_fieldstack_box\hbox{\symbol[#symbol]}%
   \setcollector
     [fieldstack]
     {\fieldbody
        [\currentfieldstackname]
        [\c!option=\v!readonly,
         \c!width=\wd\scrn_fieldstack_box,
         \c!height=\ht\scrn_fieldstack_box,
         \c!depth=\dp\scrn_fieldstack_box,
         #settings]}}

Wolfgang

From adityam at umich.edu  Sat Oct  1 08:38:45 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 1 Oct 2011 02:38:45 -0400 (EDT)
Subject: [dev-context] multi-level counters
Message-ID: <alpine.LNX.2.02.1110010231020.26779@ybpnyubfg.ybpnyqbznva>

I was experimenting with multi-level counters when I noticed that
\rawsubstructurecounter[..][...] fails because 
commands.valuestructurecounter is not defined.

I think that \dorawsubstructure counter should use 'structurecountervalue' 
rather than 'valuestructurecounter'. Thus, its definition should be

\def\dorawsubstructurecounter    [#1][#2]{\ctxcommand{structurecountervalue("\@@thestructurecounter{#1}",#2)}}

Minimal example:

\definestructurecounter[test]
\starttext
\incrementsubstructurecounter[test][2]
\rawsubstructurecounter[test][1]
\rawsubstructurecounter[test][2]
\stoptext

Aditya


From pragma at wxs.nl  Sat Oct  1 14:28:46 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 01 Oct 2011 14:28:46 +0200
Subject: [dev-context] multi-level counters
In-Reply-To: <alpine.LNX.2.02.1110010231020.26779@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1110010231020.26779@ybpnyubfg.ybpnyqbznva>
Message-ID: <4E87077E.2010302@wxs.nl>

On 1-10-2011 08:38, Aditya Mahajan wrote:
> def\dorawsubstructurecounter
> [#1][#2]{\ctxcommand{structurecountervalue("\@@thestructurecounter{#1}",#2)}}
>

fixed

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Sun Oct  2 04:58:36 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 1 Oct 2011 22:58:36 -0400 (EDT)
Subject: [dev-context] Changing font and color using \processisolatedwords
Message-ID: <alpine.LNX.2.02.1110012256260.2978@ybpnyubfg.ybpnyqbznva>

Why can't I change the color and style when using processisolatedwords?

\defineframed[colored][foregroundcolor=red,foregroundstyle=\bfc,location=low]
\starttext
\colored{What}
\processisolatedwords {\input ward \relax } \colored
\stoptext

Also \processwords is defined twice, first in syst-aux which is then 
overwritten by the definition in supp-box.

Aditya

From pragma at wxs.nl  Sun Oct  2 14:39:29 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 02 Oct 2011 14:39:29 +0200
Subject: [dev-context] Changing font and color using
	\processisolatedwords
In-Reply-To: <alpine.LNX.2.02.1110012256260.2978@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1110012256260.2978@ybpnyubfg.ybpnyqbznva>
Message-ID: <4E885B81.8070701@wxs.nl>

On 2-10-2011 04:58, Aditya Mahajan wrote:
> Why can't I change the color and style when using processisolatedwords?
>
> \defineframed[colored][foregroundcolor=red,foregroundstyle=\bfc,location=low]
>
> \starttext
> \colored{What}
> \processisolatedwords {\input ward \relax } \colored
> \stoptext
>
> Also \processwords is defined twice, first in syst-aux which is then
> overwritten by the definition in supp-box.

indeed as the supp-box one has some advantages

anyhow, I tried to fix it (qualifies as dirty trick)

\defineframed[colored][foregroundcolor=red,foregroundstyle=\bfc\underbar,location=low]

\starttext

\colored{What}

\processisolatedwords {\input ward \relax} \colored

\stoptext

should work ok now. Of course you can consider other approaches:

(wifiyable):

\startluacode

     local words = 
lpeg.split(lpeg.patterns.spacer,io.loaddata(resolvers.findfile("ward.tex")) 
or "")

     for i=1,#words do
         if i == 1 then
             context.dontleavehmode()
         else
             context.space()
         end
         context.colored(words[i])
     end

\stopluacode

or without temporary array:

\startluacode
     local i = 0

     local function reset()
         i = 0
     end

     local function apply(s)
         i = i + 1
         if i == 1 then
             context.dontleavehmode()
         else
             context.space()
         end
         context.colored(words[i])
     end

     local splitter = lpeg.P(true)/reset * 
lpeg.splitter(lpeg.patterns.spacer,apply)

     lpeg.match(splitter,io.loaddata(resolvers.findfile("ward.tex")) or "")

\stopluacode

maybe I should add this variant ..

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Oct  3 14:02:47 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 3 Oct 2011 14:02:47 +0200
Subject: [dev-context] page-one.mkiv
Message-ID: <EE027B6E-AAE0-459D-94A4-B3C02CC0D47F@googlemail.com>

Hi,

page-one.mkiv:

\def\OTRONEdosetbothinserts
  {\global\topinserted\zeropoint
   \global\botinserted\zeropoint
   \ifflushingfloats \else
     \OTRONEdosettopinserts
     \OTRONEdosetbotinserts
     \ifsomefloatwaiting
-       \doif\rootfloatparameter\c!cache\v!no\doflushfloats
+       \doif{\rootfloatparameter\c!cache}\v!no\doflushfloats
     \fi
   \fi}

Wolfgang

From pmlists at free.fr  Tue Sep 27 21:45:22 2011
From: pmlists at free.fr (Peter =?utf-8?Q?M=C3=BCnster?=)
Date: Tue, 27 Sep 2011 21:45:22 +0200
Subject: [dev-context] [NTG-context] upload file on wiki
Message-ID: <87aa9prcq5.fsf@micropit.couberia.bzh>

Hello,

The upload seems to be broken:

        Upload warning
        The upload directory (public) is not writable by the webserver.

-- 
           Peter
___________________________________________________________________________________
If your question is of interest to others as well, please add an entry to the Wiki!

maillist : ntg-context at ntg.nl / http://www.ntg.nl/mailman/listinfo/ntg-context
webpage  : http://www.pragma-ade.nl / http://tex.aanhet.net
archive  : http://foundry.supelec.fr/projects/contextrev/
wiki     : http://contextgarden.net
___________________________________________________________________________________


From schuster.wolfgang at googlemail.com  Fri Oct 14 12:59:39 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 14 Oct 2011 12:59:39 +0200
Subject: [dev-context] \dostructurecountercomponent
Message-ID: <11E085F4-5C61-4D8A-8134-4722C7696027@googlemail.com>

Hi Hans,

how can i use the \dostructurecountercomponent command for my own macros?

I tried it with the following code but nothing appear in the tuc file.

\starttexcode

\installnamespace                {test}
\installcommandhandler \????test {test} \????test

\installstructurelistprocessor{test}{\usestructurelistprocessor{number+title}}

\unexpanded\def\test_cmd[#1]#2#3%
  {\begingroup
   \edef\currenttest{#1}%
   \dostructurecountercomponent
     {test}%
     \setupcurrenttest
     \testparameter
     \detokenizedtestparameter
     \relax
     \relax
     \relax
     [\c!name=\currenttest,%
      \s!counter=\currenttest,%
      \s!hascaption=\v!yes,%
      \s!hasnumber=\v!yes,%
      \s!hastitle=\v!yes,%
      \c!reference=#2,%
      \c!title=#3,
      \c!bookmark=]%
     []%
   \endgroup}

\appendtoks
  \setuevalue\currenttest{\test_cmd[\currenttest]}%
\to \everydefinetest

\appendtoks
  \definenumber[\currenttest]%
% \definelist  [\currenttest]%
\to \everydefinetest

\stoptexcode

\definetest[test]

\starttext

\test{test:1}{This is the title!}

\getnumber[test]

\test{test:2}{This is the next title!}

\getnumber[test]

\stoptext

Wolfgang


From schuster.wolfgang at googlemail.com  Mon Oct 17 15:39:37 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 17 Oct 2011 15:39:37 +0200
Subject: [dev-context] \dostructurecountercomponent
In-Reply-To: <11E085F4-5C61-4D8A-8134-4722C7696027@googlemail.com>
References: <11E085F4-5C61-4D8A-8134-4722C7696027@googlemail.com>
Message-ID: <10EC8180-F81F-4A15-95E6-6DF19C2982EE@googlemail.com>

Hans,

can you give me a top what?t missing in the code below.

Wolfgang

Am 14.10.2011 um 12:59 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> how can i use the \dostructurecountercomponent command for my own macros?
> 
> I tried it with the following code but nothing appear in the tuc file.
> 
> \starttexcode
> 
> \installnamespace                {test}
> \installcommandhandler \????test {test} \????test
> 
> \installstructurelistprocessor{test}{\usestructurelistprocessor{number+title}}
> 
> \unexpanded\def\test_cmd[#1]#2#3%
>  {\begingroup
>   \edef\currenttest{#1}%
>   \dostructurecountercomponent
>     {test}%
>     \setupcurrenttest
>     \testparameter
>     \detokenizedtestparameter
>     \relax
>     \relax
>     \relax
>     [\c!name=\currenttest,%
>      \s!counter=\currenttest,%
>      \s!hascaption=\v!yes,%
>      \s!hasnumber=\v!yes,%
>      \s!hastitle=\v!yes,%
>      \c!reference=#2,%
>      \c!title=#3,
>      \c!bookmark=]%
>     []%
>   \endgroup}
> 
> \appendtoks
>  \setuevalue\currenttest{\test_cmd[\currenttest]}%
> \to \everydefinetest
> 
> \appendtoks
>  \definenumber[\currenttest]%
> % \definelist  [\currenttest]%
> \to \everydefinetest
> 
> \stoptexcode
> 
> \definetest[test]
> 
> \starttext
> 
> \test{test:1}{This is the title!}
> 
> \getnumber[test]
> 
> \test{test:2}{This is the next title!}
> 
> \getnumber[test]
> 
> \stoptext
> 
> Wolfgang
> 


From schuster.wolfgang at googlemail.com  Mon Oct 17 21:03:07 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 17 Oct 2011 21:03:07 +0200
Subject: [dev-context] \dostructurecountercomponent
In-Reply-To: <11E085F4-5C61-4D8A-8134-4722C7696027@googlemail.com>
References: <11E085F4-5C61-4D8A-8134-4722C7696027@googlemail.com>
Message-ID: <AB050921-F6C2-4313-AECE-129CC69AC365@googlemail.com>


Am 14.10.2011 um 12:59 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> how can i use the \dostructurecountercomponent command for my own macros?
> 
> I tried it with the following code but nothing appear in the tuc file.
> 
> \starttexcode
> 
> \installnamespace                {test}
> \installcommandhandler \????test {test} \????test
> 
> \installstructurelistprocessor{test}{\usestructurelistprocessor{number+title}}
> 
> \unexpanded\def\test_cmd[#1]#2#3%
>  {\begingroup
>   \edef\currenttest{#1}%
>   \dostructurecountercomponent
>     {test}%
>     \setupcurrenttest
>     \testparameter
>     \detokenizedtestparameter
>     \relax
>     \relax
>     \relax
>     [\c!name=\currenttest,%
>      \s!counter=\currenttest,%
>      \s!hascaption=\v!yes,%
>      \s!hasnumber=\v!yes,%
>      \s!hastitle=\v!yes,%
>      \c!reference=#2,%
>      \c!title=#3,
>      \c!bookmark=]%
>     []%
>   \endgroup}

I found now the reason why the code don?t work, there is \laststructurecountersynchronize
after I set the value, when I add it I have the information in the tuc file and when I
uncomment \definelist I can also use \placelist to get a list with all entries :)

Wolfgang

From adityam at umich.edu  Tue Oct 18 04:43:31 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 17 Oct 2011 22:43:31 -0400 (EDT)
Subject: [dev-context] range in \typefile
Message-ID: <alpine.LNX.2.02.1110172238040.20604@ybpnyubfg.ybpnyqbznva>

Hi,

\typefile[range={1,3}]{...} does not work. My guess is that this is 
because the variable `range` is never initialized in `filter` function in 
buff-ver.lua. A

     local range = settings.range

should be added to the `filter` function.

Aditya

From pragma at wxs.nl  Tue Oct 18 10:17:25 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 18 Oct 2011 10:17:25 +0200
Subject: [dev-context] range in \typefile
In-Reply-To: <alpine.LNX.2.02.1110172238040.20604@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1110172238040.20604@ybpnyubfg.ybpnyqbznva>
Message-ID: <4E9D3615.4050907@wxs.nl>

On 18-10-2011 04:43, Aditya Mahajan wrote:
> Hi,
>
> \typefile[range={1,3}]{...} does not work. My guess is that this is
> because the variable `range` is never initialized in `filter` function
> in buff-ver.lua. A
>
> local range = settings.range
>
> should be added to the `filter` function.

indeed

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Oct 19 13:07:49 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 19 Oct 2011 13:07:49 +0200
Subject: [dev-context] strc-num.mkiv
Message-ID: <6BD20D50-B8CD-4967-90CB-FE10A57B8BCD@googlemail.com>

Hi Hans,

shouldn?t the inner test be ?\ifx\hasstructurecounternumber\v!yes??

\def\dostructurecountercomponent#1#2#3#4#5#6#7[#8][#9]%
  {\begingroup
   ?
   \ifx\hasstructurecountercaption\v!yes
    ?
    \ifx\hasstructurecountercaption\v!yes
        prefixdata = {
            prefix        = "#3\c!prefix",
            separatorset  = "#3\c!prefixseparatorset",
            conversion    = \!!bs#3\c!prefixconversion\!!es,
            conversionset = "#3\c!prefixconversionset",
            set           = "#3\c!prefixset",
        %   segments      = "#3\c!prefixsegments",
            segments      = "\askedprefixsegments",
            connector     = \!!bs#3\c!prefixconnector\!!es,
        },
        numberdata = {
            numbers       = structures.counters.compact("\currentcounter",nil,true),
            separatorset  = "#3\c!numberseparatorset",
            conversion    = \!!bs#3\c!numberconversion\!!es,
            conversionset = "#3\c!numberconversionset",
            starter       = \!!bs#3\c!numberstarter\!!es,
            stopper       = \!!bs#3\c!numberstopper\!!es,
            segments      = "#3\c!numbersegments",
        },
    \fi
   ?
   \fi
   \endgroup}

Wolfgang

From pragma at wxs.nl  Wed Oct 19 18:24:09 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 19 Oct 2011 18:24:09 +0200
Subject: [dev-context] strc-num.mkiv
In-Reply-To: <6BD20D50-B8CD-4967-90CB-FE10A57B8BCD@googlemail.com>
References: <6BD20D50-B8CD-4967-90CB-FE10A57B8BCD@googlemail.com>
Message-ID: <4E9EF9A9.7020103@wxs.nl>

On 19-10-2011 13:07, Wolfgang Schuster wrote:

> shouldn?t the inner test be ?\ifx\hasstructurecounternumber\v!yes??

makes sense indeed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Oct 21 07:07:41 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 21 Oct 2011 07:07:41 +0200
Subject: [dev-context] References and \dostructurecountercomponent
Message-ID: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>

Hi Hans,

I try to set and access a reference in the example below but both
\in and \at result in a fatal error. What?s missing in my code,
I looked in the float and math code but I can?t find a solution.

\starttexcode

\installnamespace                {test}
\installcommandhandler \????test {test} \????test

\installstructurelistprocessor{test}{\usestructurelistprocessor{number+title}}

\unexpanded\def\test_cmd[#1]#2#3%
  {\begingroup
   \edef\currenttest{#1}%
   \dostructurecountercomponent
     {test}%
     \setupcurrenttest
     \testparameter
     \detokenizedtestparameter
     \relax
     \relax
     \relax
     [\c!name=\currenttest,%
      \s!counter=\currenttest,%
      \s!hascaption=\v!yes,%
      \s!hasnumber=\v!yes,%
      \s!hastitle=\v!yes,%
      \c!reference=#2,%
      \c!title={#3},
      \c!bookmark=]%
     []%
   \laststructurecountersynchronize
   \attribute\destinationattribute\laststructurecounterattribute\emptyhbox
   \endgroup}

\appendtoks
  \setuevalue\currenttest{\test_cmd[\currenttest]}%
\to \everydefinetest

\appendtoks
  \definenumber[\currenttest]%
  \definelist  [\currenttest]%
\to \everydefinetest

\stoptexcode

\definetest[test]

\setupnumber[test][prefix=yes]

\starttext

\placelist[test]

\blank

\test{test:1}{This is the title!}

Test 1: \getnumber[test]

\test{test:2}{This is the next title!}

Test 2: \getnumber[test]

\blank

\in{test}[test:2] \at{page}[test:2]

\stoptext

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20111021/a5cbffe1/attachment.html>

From adityam at umich.edu  Sat Oct 22 23:07:42 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 22 Oct 2011 17:07:42 -0400 (EDT)
Subject: [dev-context] Add toggle method to indent
Message-ID: <alpine.LNX.2.00.1110221703140.9659@ybpnyubfg.ybpnyqbznva>

Hi Hans,

Can you add a `toggle` key to `\setupindenting`. This will 
allow one to easily write poety where alternative stanzas are to 
be indented.

defineindentingmethod [toggle] {\ifdim\parindent=\zeropoint\relax
                                     \parindent\ctxparindent\relax
                                   \else
 				    \parindent\zeropoint\relax
                                   \fi}

\setuplines
  [inbetween={\blank[preference,line]\setupindenting[toggle]},
   indenting=no]

\startlines
....
\stoplines

Thanks,
Aditya

From pragma at wxs.nl  Mon Oct 24 14:18:00 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 24 Oct 2011 14:18:00 +0200
Subject: [dev-context] References and \dostructurecountercomponent
In-Reply-To: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>
References: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>
Message-ID: <4EA55778.3030802@wxs.nl>

On 21-10-2011 07:07, Wolfgang Schuster wrote:
> Hi Hans,
>
> I try to set and access a reference in the example below but both
> \in and \at result in a fatal error. What?s missing in my code,
> I looked in the float and math code but I can?t find a solution.

you need to set a resolver for the internal reference as it can come 
from anywhere

references.resolvers.test = references.resolvers.section -- take from list

but anyhow, I made that the fallback resolver now so your problem should 
go away

Hans





-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Oct 24 14:32:28 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 24 Oct 2011 14:32:28 +0200
Subject: [dev-context] Add toggle method to indent
In-Reply-To: <alpine.LNX.2.00.1110221703140.9659@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.00.1110221703140.9659@ybpnyubfg.ybpnyqbznva>
Message-ID: <4EA55ADC.2080009@wxs.nl>

On 22-10-2011 23:07, Aditya Mahajan wrote:
> Hi Hans,
>
> Can you add a `toggle` key to `\setupindenting`. This will allow one to
> easily write poety where alternative stanzas are to be indented.
>
> defineindentingmethod [toggle] {\ifdim\parindent=\zeropoint\relax
> \parindent\ctxparindent\relax
> \else
> \parindent\zeropoint\relax
> \fi}
>
> \setuplines
> [inbetween={\blank[preference,line]\setupindenting[toggle]},
> indenting=no]
>
> \startlines
> .....
> \stoplines

I've added

\defineindentingmethod [\v!toggle] {\parindent\ifdim\parindent=\zeropoint
                                       \ctxparindent
                                     \else
                                       \zeropoint
                                     \fi\relax}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Oct 24 23:24:30 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 24 Oct 2011 23:24:30 +0200
Subject: [dev-context] References and \dostructurecountercomponent
In-Reply-To: <4EA55778.3030802@wxs.nl>
References: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>
	<4EA55778.3030802@wxs.nl>
Message-ID: <F9C76849-276A-433E-B3A3-C7D3A04FD323@googlemail.com>


Am 24.10.2011 um 14:18 schrieb Hans Hagen:

> On 21-10-2011 07:07, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> I try to set and access a reference in the example below but both
>> \in and \at result in a fatal error. What?s missing in my code,
>> I looked in the float and math code but I can?t find a solution.
> 
> you need to set a resolver for the internal reference as it can come from anywhere
> 
> references.resolvers.test = references.resolvers.section -- take from list
> 
> but anyhow, I made that the fallback resolver now so your problem should go away

Thanks, the error message is now gone but I don?t get a number from the \in reference unless I add

\startluacode
structures.references.filters.test = { default = structures.references.filters.generic.number }
\stopluacode

to my code. Can the reference code take care of this itself or do I really need the line?

Wolfgang

From pragma at wxs.nl  Tue Oct 25 10:34:07 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 25 Oct 2011 10:34:07 +0200
Subject: [dev-context] References and \dostructurecountercomponent
In-Reply-To: <F9C76849-276A-433E-B3A3-C7D3A04FD323@googlemail.com>
References: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>
	<4EA55778.3030802@wxs.nl>
	<F9C76849-276A-433E-B3A3-C7D3A04FD323@googlemail.com>
Message-ID: <4EA6747F.8070002@wxs.nl>

On 24-10-2011 23:24, Wolfgang Schuster wrote:
>
> Am 24.10.2011 um 14:18 schrieb Hans Hagen:
>
>> On 21-10-2011 07:07, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> I try to set and access a reference in the example below but both
>>> \in and \at result in a fatal error. What?s missing in my code,
>>> I looked in the float and math code but I can?t find a solution.
>>
>> you need to set a resolver for the internal reference as it can come from anywhere
>>
>> references.resolvers.test = references.resolvers.section -- take from list
>>
>> but anyhow, I made that the fallback resolver now so your problem should go away
>
> Thanks, the error message is now gone but I don?t get a number from the \in reference unless I add
>
> \startluacode
> structures.references.filters.test = { default = structures.references.filters.generic.number }
> \stopluacode
>
> to my code. Can the reference code take care of this itself or do I really need the line?

I'll add a default

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Oct 26 13:23:48 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 26 Oct 2011 13:23:48 +0200
Subject: [dev-context] syst-aux.mkiv: \processcommalistwithparameters
Message-ID: <3820A904-6041-40ED-BA0B-1010CB377B9B@googlemail.com>

Hans,

can you make \processcommalistwithparameters unexpandable or add a \processcomma*command*withparameters.

Wolfgang

From schuster.wolfgang at googlemail.com  Wed Oct 26 13:25:32 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 26 Oct 2011 13:25:32 +0200
Subject: [dev-context] References and \dostructurecountercomponent
In-Reply-To: <4EA6747F.8070002@wxs.nl>
References: <68EF09C2-FEBF-45B6-BE9F-EAF3CBD9F366@googlemail.com>
	<4EA55778.3030802@wxs.nl>
	<F9C76849-276A-433E-B3A3-C7D3A04FD323@googlemail.com>
	<4EA6747F.8070002@wxs.nl>
Message-ID: <05A59C18-A7C4-4F92-B6C1-18D2F52A53CA@googlemail.com>


Am 25.10.2011 um 10:34 schrieb Hans Hagen:

> On 24-10-2011 23:24, Wolfgang Schuster wrote:
>> 
>> Am 24.10.2011 um 14:18 schrieb Hans Hagen:
>> 
>>> On 21-10-2011 07:07, Wolfgang Schuster wrote:
>>>> Hi Hans,
>>>> 
>>>> I try to set and access a reference in the example below but both
>>>> \in and \at result in a fatal error. What?s missing in my code,
>>>> I looked in the float and math code but I can?t find a solution.
>>> 
>>> you need to set a resolver for the internal reference as it can come from anywhere
>>> 
>>> references.resolvers.test = references.resolvers.section -- take from list
>>> 
>>> but anyhow, I made that the fallback resolver now so your problem should go away
>> 
>> Thanks, the error message is now gone but I don?t get a number from the \in reference unless I add
>> 
>> \startluacode
>> structures.references.filters.test = { default = structures.references.filters.generic.number }
>> \stopluacode
>> 
>> to my code. Can the reference code take care of this itself or do I really need the line?
> 
> I'll add a default

Thank you.

Wolfgang

From mojca.miklavec.lists at gmail.com  Fri Oct 28 15:16:17 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 28 Oct 2011 15:16:17 +0200
Subject: [dev-context] announcing server change, possible downtime
Message-ID: <CALBOmsbHY=BVzi7pAqG-4-gEbf6tSJWg_UCJi7FzsRiTPfnRKA@mail.gmail.com>

Dear ConTeXt-ers,

in the following days we will piecewise move parts of old server to a
new machine (this will happen once again, but this time it might be
slightly more dramatic change). Thus I would like to ask you to be
patient if something stops working.

The wiki has already been moved, so this should not be a problem. Some
sites will be reorganized, but I will inform you about details. In
particular, minimals will also change, but details will follow.

One thing that might be a tiny bit problematic are SVN repositories.
We need to upgrade them from SVN 1.5 to 1.7, so anyone using SVN
repositories from garden *might* need to do a fresh checkout. I didn't
test anything yet though, I only know that I had problems with the
client on my machine now that MacPorts upgraded SVN. (I have also
found a weird bug in 1.7.1 client.) I have no idea how server-side
upgrades behave on clients. This should more or less affect only me,
Taco and those who build binaries for minimals. Plus those who work on
meeting/group website occasionally.

Mojca

From schuster.wolfgang at googlemail.com  Mon Nov  7 09:46:24 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 7 Nov 2011 09:46:24 +0100
Subject: [dev-context] \dowithbuffer adds unwanted space
Message-ID: <28FCE5C1-844A-4024-AF68-609D10C93A99@googlemail.com>

Hi Hans,

there is a extra space at the end of the buffer content.

\def\starttest
  {\dowithbuffer{testbuffer}{starttest}{stoptest}\relax\processtest}

\def\processtest{?\ctxcommand{getbuffer("testbuffer")}?}
%\def\processtest{?\ctxcommand{getbuffer("testbuffer")}\removeunwantedspaces?}

\starttext

\starttest TEST\stoptest

\starttest TEST \stoptest

\stoptext

Wolfgang


From schuster.wolfgang at googlemail.com  Mon Nov  7 15:10:02 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 7 Nov 2011 15:10:02 +0100
Subject: [dev-context] tabl-tab.mkiv
Message-ID: <6D7543A7-DFB8-417E-8054-7BAF4C185C1E@googlemail.com>

Missing ?t? in \dorestarttable

\gdef\secondstagestarttable[#1]% brr nested mess
  {\bgroup
   \@@useotherbar
   \global\setfalse\tableactionstatepermitted
   \global\setfalse\hassometablehead
   \global\setfalse\hassometabletail
   \expanded{\doifinstringelse{|}{#1}}
     {\xdef\restarttable{\noexpand\dorestarttable{\noexpand\thirdstagestarttable{#1}}}}
     {\doifdefinedelse{\s!TaBlE#1}
        {\gdef\restarttable{\getvalue{\s!TaBlE#1}}}
-       {\gdef\restarttable{\dorestartable{\getvalue{#1}}}}}%
+       {\gdef\restarttable{\dorestarttable{\getvalue{#1}}}}}%
   \egroup
   \restarttable}

Wolfgang

From pragma at wxs.nl  Tue Nov  8 18:59:13 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 08 Nov 2011 18:59:13 +0100
Subject: [dev-context] \dowithbuffer adds unwanted space
In-Reply-To: <28FCE5C1-844A-4024-AF68-609D10C93A99@googlemail.com>
References: <28FCE5C1-844A-4024-AF68-609D10C93A99@googlemail.com>
Message-ID: <4EB96DF1.7060301@wxs.nl>

On 7-11-2011 09:46, Wolfgang Schuster wrote:
> Hi Hans,
>
> there is a extra space at the end of the buffer content.
>
> \def\starttest
>    {\dowithbuffer{testbuffer}{starttest}{stoptest}\relax\processtest}
>
> \def\processtest{?\ctxcommand{getbuffer("testbuffer")}?}
> %\def\processtest{?\ctxcommand{getbuffer("testbuffer")}\removeunwantedspaces?}
>
> \starttext
>
> \starttest TEST\stoptest
>
> \starttest TEST \stoptest
>
> \stoptext

It's a side effect of going through a file as tex then adds an 
endlinechar to the end of the file; you can try that with:

\endlinechar=-1 just before the test code

The \scantokens command has the same side effect.

I've added \enabletrackers[buffers.grab] to track what gets into the buffer.

The reason for this space is probably look-ahead although it makes 
perfect sense to have a mode for tex where no such space is added 
(probably then on a per file basis, maybe as part of the opener callback 
in luatex.

In vmode the space is basically a nil, in hmode a \removeunwantedspaces 
is needed (as with other files).

You can use buffers.getcontent to get the content directly (which might 
have catcode side effects.

\def\processtest{?\ctxlua{context(buffers.getcontent("testbuffer"))}?}


Hans





-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Nov  8 20:13:06 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 8 Nov 2011 20:13:06 +0100
Subject: [dev-context] \dowithbuffer adds unwanted space
In-Reply-To: <4EB96DF1.7060301@wxs.nl>
References: <28FCE5C1-844A-4024-AF68-609D10C93A99@googlemail.com>
	<4EB96DF1.7060301@wxs.nl>
Message-ID: <71D95A46-4C16-497E-93E9-21099A03A860@googlemail.com>


Am 08.11.2011 um 18:59 schrieb Hans Hagen:

> On 7-11-2011 09:46, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> there is a extra space at the end of the buffer content.
>> 
>> \def\starttest
>>   {\dowithbuffer{testbuffer}{starttest}{stoptest}\relax\processtest}
>> 
>> \def\processtest{?\ctxcommand{getbuffer("testbuffer")}?}
>> %\def\processtest{?\ctxcommand{getbuffer("testbuffer")}\removeunwantedspaces?}
>> 
>> \starttext
>> 
>> \starttest TEST\stoptest
>> 
>> \starttest TEST \stoptest
>> 
>> \stoptext
> 
> It's a side effect of going through a file as tex then adds an endlinechar to the end of the file; you can try that with:
> 
> \endlinechar=-1 just before the test code
> 
> The \scantokens command has the same side effect.
> 
> I've added \enabletrackers[buffers.grab] to track what gets into the buffer.
> 
> The reason for this space is probably look-ahead although it makes perfect sense to have a mode for tex where no such space is added (probably then on a per file basis, maybe as part of the opener callback in luatex.
> 
> In vmode the space is basically a nil, in hmode a \removeunwantedspaces is needed (as with other files).
> 
> You can use buffers.getcontent to get the content directly (which might have catcode side effects.
> 
> \def\processtest{?\ctxlua{context(buffers.getcontent("testbuffer"))}?}

Thanks for the explanation, buffers.getcontent does help in my case.

Wolfgang

From schuster.wolfgang at googlemail.com  Fri Nov 11 16:03:44 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 11 Nov 2011 16:03:44 +0100
Subject: [dev-context] file-job.mkvi
Message-ID: <789462F8-9433-4043-B2C0-AEAE9B25D482@googlemail.com>

Hi Hans,

\def\stopenvironmentindeed
- {\signalendofinput\v!project}
+ {\signalendofinput\v!environment}

Wolfgang

From schuster.wolfgang at googlemail.com  Mon Nov 14 11:54:08 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 14 Nov 2011 11:54:08 +0100
Subject: [dev-context] file-job.mkvi
Message-ID: <09D5711E-5403-44E5-A78A-A9D40397F6D2@googlemail.com>

Hi,

-\ifdefined\else \newcount\textlevel \fi % might go away
+\ifdefined\textlevel \else \newcount\textlevel \fi % might go away

Wolfgang


From adityam at umich.edu  Sat Nov 19 23:11:40 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 19 Nov 2011 17:11:40 -0500 (EST)
Subject: [dev-context] Additional framed fences
Message-ID: <alpine.LNX.2.00.1111191704200.21486@ybpnyubfg.ybpnyqbznva>

Hans,

Can you change the definition of setinstalledframeddimensions in 
pack-fen.mkiv to:

\def\setinstalledframedimensions
   {\edef\overlaywidth {\the\frameddimenwd\space}%
    \edef\overlayheight{\the\dimexpr\frameddimenht+\frameddimendp\relax\space}%
    \edef\overlaydepth {\the\frameddimendp\space}%
    \edef\overlaycolor {\framedparameter\c!backgroundcolor}%
    \edef\overlaylinecolor{\framedparameter\c!framecolor}%
    \edef\overlaylinewidth{\the\ruledlinewidth}}


and include the attached file as part of meta-imp-fen.mkiv?

This is based on an example by Marcin on TeX.se: 
http://tex.stackexchange.com/questions/34482/contest-show-off-your-skillz-in-tex-friends-tex-sx-birthday/35211#35211

Thanks,
Aditya
-------------- next part --------------
\unprotect

% Hooked fences: lefthook, righthook, tophook, and bottomhook.
% The parameter \type{radius} determine the radius of the hook.
% The parameter \type{hook} determines the length of the hook.

\startMPextensions
    vardef BasicHook (expr size, radius, hook) =
        ((0,0) --- (size - radius, 0){right} .. {up}(size, radius) --- (size, hook))
    enddef;
\stopMPextensions

\startuseMPgraphic{bottom_right_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayWidth, radius, hook)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{bottom_left_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayWidth, radius, hook) 
        reflectedabout ((0.5OverlayWidth, 0), (0.5OverlayWidth, OverlayHeight))
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{top_right_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayWidth, radius, hook) 
        reflectedabout ((0,0),(OverlayWidth,0))
        shifted (0,OverlayHeight)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{left_top_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayWidth, radius, hook) 
        reflectedabout ((0.5OverlayWidth, 0), (0.5OverlayWidth, OverlayHeight))
        reflectedabout ((0,0),(OverlayWidth,0))
        shifted (0,OverlayHeight)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{left_bottom_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayHeight, radius, hook) 
        rotated -90
        shifted (0,OverlayHeight)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{left_top_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayHeight, radius, hook) 
        reflectedabout ((0,0),(OverlayWidth,0))
        rotated 90
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{right_top_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayHeight, radius, hook) 
        rotated 90
        shifted (OverlayWidth,0)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic

\startuseMPgraphic{right_bottom_hook}
  save radius, hook ;
  radius := \the\dimexpr\framedparameter\c!frameradius\relax;
  hook   := \the\dimexpr\framedparameter{hook}\relax;
  
   draw BasicHook(OverlayHeight, radius, hook) 
        reflectedabout ((0,0),(OverlayWidth,0))
        rotated -90
        shifted (OverlayWidth,OverlayHeight)
        withpen pencircle scaled OverlayLineWidth
        withcolor OverlayLineColor;

   setbounds currentpicture to OverlayBox;
\stopuseMPgraphic


\installtopframerenderer    {righthook}{\useMPgraphic{top_right_hook}}
\installtopframerenderer     {lefthook}{\useMPgraphic{top_left_hook}}

\installbottomframerenderer {righthook}{\useMPgraphic{bottom_right_hook}}
\installbottomframerenderer  {lefthook}{\useMPgraphic{bottom_left_hook}}

\installleftframerenderer  {bottomhook}{\useMPgraphic{left_bottom_hook}}
\installleftframerenderer     {tophook}{\useMPgraphic{left_top_hook}}

\installrightframerenderer {bottomhook}{\useMPgraphic{right_bottom_hook}}
\installrightframerenderer    {tophook}{\useMPgraphic{right_top_hook}}

\setupframed
  [hook=\framedparameter\c!radius]

\protect

\continueifinputfile{meta-imp-hooks.mkiv}

\setupcolors[state=start]
% \setupframed[offset=none]
\starttext
\framed[frame=off,bottomframe=righthook]{Bottom right hook}

\framed[frame=off,bottomframe=lefthook,rulethickness=2bp]{Bottom left hook}

\blank

\framed[frame=off,topframe=righthook,rulethickness=2bp]{Top right hook}

\blank

\framed[frame=off,topframe=lefthook,rulethickness=2bp]{Top left hook}

\framed[frame=off,bottomframe=righthook,framecolor=green,rulethickness=2bp]{Changing colors}

\framed[align=normal,frame=off, hook=1cm, leftframe=bottomhook]{\input zapf \endgraf}

\blank
\framed[align=normal,frame=off, hook=1cm, leftframe=tophook]{\input zapf \endgraf}

\blank
\framed[align=normal,frame=off, hook=1cm, rightframe=tophook]{\input zapf \endgraf}

\blank
\framed[align=normal,frame=off, hook=1cm, rightframe=bottomhook]{\input zapf \endgraf}
\stoptext


From pragma at wxs.nl  Sun Nov 20 14:17:52 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 20 Nov 2011 14:17:52 +0100
Subject: [dev-context] Additional framed fences
In-Reply-To: <alpine.LNX.2.00.1111191704200.21486@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.00.1111191704200.21486@ybpnyubfg.ybpnyqbznva>
Message-ID: <4EC8FE00.1070400@wxs.nl>

On 19-11-2011 23:11, Aditya Mahajan wrote:

> and include the attached file as part of meta-imp-fen.mkiv?

ok (but I added a namespace to the mp code)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Nov 23 14:30:01 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 23 Nov 2011 14:30:01 +0100
Subject: [dev-context] Expansion
Message-ID: <D3822C4A-DA72-4BA7-8087-27F1F3967C5E@googlemail.com>

Hi Hans,

can you make \leftaligned, \rightaligned, midaligned and \maxaligned unexpanded.

Wolfgang

From pragma at wxs.nl  Wed Nov 23 16:30:54 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 23 Nov 2011 16:30:54 +0100
Subject: [dev-context] Expansion
In-Reply-To: <D3822C4A-DA72-4BA7-8087-27F1F3967C5E@googlemail.com>
References: <D3822C4A-DA72-4BA7-8087-27F1F3967C5E@googlemail.com>
Message-ID: <4ECD11AE.1030705@wxs.nl>

On 23-11-2011 14:30, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you make \leftaligned, \rightaligned, midaligned and \maxaligned unexpanded.

Sure (i did a few more in spac-ali as well). As you're using it ... I 
sped up the alignment settings parser, so in case you see any problems 
there you know where it comes from (I also added a 'table' preset which 
saves quite some parsing in bTABLE cum suis). (We should now change the 
namespace \@@ragged@@command as over the years it evolved to more that 
simple alignments).

Beta on ftp.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ishamid at colostate.edu  Fri Nov 25 00:53:46 2011
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMgICDYs9mF2KfZiNmKIA==?= =?utf-8?B?2K3Yp9mF2K8=?=)
Date: Thu, 24 Nov 2011 16:53:46 -0700
Subject: [dev-context] Feature request: criterium=component
Message-ID: <op.v5g5zwcbpw6hmh@ishamid-pc>

Dear inner circle,

I have two components, each a book in its own right, and each with  
multiple \part's, \chapter's, \section's etc. Through products and  
components I have all crossreferences between the two books set up, thanks  
to the mechanisms put in place this fall by Hans.

I compile both components through the product file. Problem: I cannot  
separate the list of Tables in component~1 from those in component~2. So a  
list of Tables in component~1 contains the tables in component~ and vice  
versa.

For TOC I was able to get around this by defining, for component~2, mirror  
section heads with different names but identical functionality to those in  
component~1. But for tables I have not been able to get this work-around  
to work:

http://archive.contextgarden.net/message/20111124.203204.79333c77.en.html

So, in any case, it sames that adding a criterium=component option would  
be the most user-friendly way to handle this kind of case. Is it feasible?  
Thnx in advance and

Best wishes
Idris
-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Sh??? Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From pragma at wxs.nl  Fri Nov 25 11:34:07 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 25 Nov 2011 11:34:07 +0100
Subject: [dev-context] Feature request: criterium=component
In-Reply-To: <op.v5g5zwcbpw6hmh@ishamid-pc>
References: <op.v5g5zwcbpw6hmh@ishamid-pc>
Message-ID: <4ECF6F1F.2080406@wxs.nl>

On 25-11-2011 00:53, Idris Samawi Hamid ?????   ????? ???? wrote:
> Dear inner circle,
>
> I have two components, each a book in its own right, and each with
> multiple \part's, \chapter's, \section's etc. Through products and
> components I have all crossreferences between the two books set up,
> thanks to the mechanisms put in place this fall by Hans.
>
> I compile both components through the product file. Problem: I cannot
> separate the list of Tables in component~1 from those in component~2. So
> a list of Tables in component~1 contains the tables in component~ and
> vice versa.
>
> For TOC I was able to get around this by defining, for component~2,
> mirror section heads with different names but identical functionality to
> those in component~1. But for tables I have not been able to get this
> work-around to work:
>
> http://archive.contextgarden.net/message/20111124.203204.79333c77.en.html
>
> So, in any case, it sames that adding a criterium=component option would
> be the most user-friendly way to handle this kind of case. Is it
> feasible? Thnx in advance and

Incredible what users come up with ... anyhow, it's that I can provide 
this with 10 lines of code, otherwise it was a no-go (unless for a 
project).

\startproduct example-1-product

    \component example-1-component-a
    \component example-1-component-b

\stopproduct

\startcomponent example-1-component-a

     \starttitle[title=Contents]
         \placelist[chapter][criterium=component]
     \stoptitle

     \startchapter[title=Ward]
         \input ward
     \stopchapter

\stopcomponent

\startcomponent example-1-component-b

     \starttitle[title=Contents]
         \placelist[chapter][criterium=component]
     \stoptitle

     \startchapter[title=Zapf]
         \input zapf
     \stopchapter

\stopcomponent

Will be in the next beta. And *you* are going to wikify it!

Hans
-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From ishamid at colostate.edu  Sat Nov 26 03:24:07 2011
From: ishamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMgICDYs9mF2KfZiNmKIA==?= =?utf-8?B?2K3Yp9mF2K8=?=)
Date: Fri, 25 Nov 2011 19:24:07 -0700
Subject: [dev-context] Feature request: criterium=component
In-Reply-To: <4ECF6F1F.2080406@wxs.nl>
References: <op.v5g5zwcbpw6hmh@ishamid-pc> <4ECF6F1F.2080406@wxs.nl>
Message-ID: <op.v5i7mhxqpw6hmh@ishamid-pc>

On Fri, 25 Nov 2011 03:34:07 -0700, Hans Hagen <pragma at wxs.nl> wrote:

> Will be in the next beta. And *you* are going to wikify it!

Ok, done :-)

http://wiki.contextgarden.net/Table_of_Contents#Tables_of_contents_.28and_other_lists.29_via_project_structures

And thanks for implementing this!

Best wishes
Idris
-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Sh??? Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From schuster.wolfgang at googlemail.com  Sat Nov 26 17:08:07 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 26 Nov 2011 17:08:07 +0100
Subject: [dev-context] strc-flt.mkvi
Message-ID: <3DF9A759-AF2F-4129-B5AB-15AF666D8035@googlemail.com>

Hi,

\ifemptyfloatcaption should always be false when there is a text for the caption

\def\check_float_caption_content
  {\ifnofloatcaption \else
     \setbox\float_caption_box\hbox
       {\settrialtypesetting
        \notesenabledfalse
        \float_make_complete_caption}%
     % new, \placefigure{\xmlfirst{#1}{somecaption}}{} passes earlier empty check
     % so here we misuse the scratch box; actually this means that the previous
     % test can go away (some day, when i redo this module)
     \ifdim\wd\float_caption_box=\zeropoint
       \global\emptyfloatcaptiontrue
       \ifnofloatnumber
         \global\nofloatcaptiontrue
       \fi
     \else
+     \global\emptyfloatcaptionfalse
       \setbox\float_caption_box\hbox{\hskip\leftskip\box\float_caption_box}%
     \fi
   \fi}

Wolfgang


From wolfgang.schuster at gmail.com  Sun Nov 27 12:14:14 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 27 Nov 2011 12:14:14 +0100
Subject: [dev-context] strc-flt.mkvi
Message-ID: <910AA9E8-4AD2-4EE7-8A2F-12D146AD173C@gmail.com>

Hi,

there is a \ifnofloatcaption test missing to prevent the counter to increase when captions are hidden with the ?none? keyword.

\unprotected\def\float_place_packaged_boxes
  {\bgroup
   \ifconditional\usesamefloatnumber
      \globallet\currentfloatnumber     \previousfloatnumber
      \globallet\currentfloatattribute  \empty
      \globallet\currentfloatsynchronize\relax
   \else
-    \ifnofloatnumber \else
-      \doincrementsubstructurecounter[\@@thestructurecounter\currentfloat][1]%
-    \fi
+    \ifnofloatnumber \else \ifnofloatcaption \else
+      \doincrementsubstructurecounter[\@@thestructurecounter\currentfloat][1]%
+    \fi \fi
     \dostructurecountercomponent
       {float}%
       \setupcurrentfloatcaption
       \floatcaptionparameter
       \detokenizedfloatcaptionparameter
       \relax
       \relax
       \relax
       [\c!name=\currentfloat,%
        \s!counter=\@@thestructurecounter\currentfloat,%
        \s!hascaption=\ifnofloatcaption \v!no\else\v!yes\fi,%
        \s!hasnumber=\ifnofloatnumber   \v!no\else\v!yes\fi,%
        \s!hastitle=\ifemptyfloatcaption\v!no\else\v!yes\fi]%
       []%
     \globallet\previousfloatnumber    \laststructurecounternumber
     \globallet\currentfloatnumber     \laststructurecounternumber
     \globallet\currentfloatattribute  \laststructurecounterattribute
     \globallet\currentfloatsynchronize\laststructurecountersynchronize
   \fi
   %
   \global\setfalse\usesamefloatnumber % one shot
   % check float box
   \float_set_natural_dimensions\nextbox
   \global\setbox\floatbox\vbox{\floatparameter\c!command{\box\nextbox}}%
   \float_set_natural_dimensions\floatbox
   \ifdim\htdp\floatbox=\zeropoint
     \showmessage\m!floatblocks{11}\empty
     \global\setbox\floatbox\vbox
       {\dostarttagged\t!floatcontent\empty
        \float_place_empty_box
        \dostoptagged}%
   \fi
   % deal with lack of caption
   \global\setbox\floatbox\vbox \floatcaptionattribute
     {\doifelsemainfloatbody\currentfloatsynchronize\donothing
      \unvbox\floatbox
      \ifnofloatcaption
        \vss
      \fi}% gets rid of the depth (unless tabulate)
   \egroup
   % place the float
   \float_set_box
   \float_get_box
   \global\insidefloatfalse}

\starttext
\placefigure{First}{\framed{One}}
\placefigure[none]{Second}{\framed{Two}}
\placefigure{Third}{\framed{Three}}
\stoptext

Wolfgang


From schuster.wolfgang at googlemail.com  Sun Nov 27 18:42:52 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 27 Nov 2011 18:42:52 +0100
Subject: [dev-context] strc-flt.mkvi
Message-ID: <F0DE90CD-0524-4F37-8519-3F0542D89603@googlemail.com>

Hi,

there is a \ifnofloatcaption test missing to prevent the counter to increase when captions are hidden with the ?none? keyword.

\unprotected\def\float_place_packaged_boxes
 {\bgroup
  \ifconditional\usesamefloatnumber
     \globallet\currentfloatnumber     \previousfloatnumber
     \globallet\currentfloatattribute  \empty
     \globallet\currentfloatsynchronize\relax
  \else
-    \ifnofloatnumber \else
-      \doincrementsubstructurecounter[\@@thestructurecounter\currentfloat][1]%
-    \fi
+    \ifnofloatnumber \else \ifnofloatcaption \else
+      \doincrementsubstructurecounter[\@@thestructurecounter\currentfloat][1]%
+    \fi \fi
    \dostructurecountercomponent
      {float}%
      \setupcurrentfloatcaption
      \floatcaptionparameter
      \detokenizedfloatcaptionparameter
      \relax
      \relax
      \relax
      [\c!name=\currentfloat,%
       \s!counter=\@@thestructurecounter\currentfloat,%
       \s!hascaption=\ifnofloatcaption \v!no\else\v!yes\fi,%
       \s!hasnumber=\ifnofloatnumber   \v!no\else\v!yes\fi,%
       \s!hastitle=\ifemptyfloatcaption\v!no\else\v!yes\fi]%
      []%
    \globallet\previousfloatnumber    \laststructurecounternumber
    \globallet\currentfloatnumber     \laststructurecounternumber
    \globallet\currentfloatattribute  \laststructurecounterattribute
    \globallet\currentfloatsynchronize\laststructurecountersynchronize
  \fi
  %
  \global\setfalse\usesamefloatnumber % one shot
  % check float box
  \float_set_natural_dimensions\nextbox
  \global\setbox\floatbox\vbox{\floatparameter\c!command{\box\nextbox}}%
  \float_set_natural_dimensions\floatbox
  \ifdim\htdp\floatbox=\zeropoint
    \showmessage\m!floatblocks{11}\empty
    \global\setbox\floatbox\vbox
      {\dostarttagged\t!floatcontent\empty
       \float_place_empty_box
       \dostoptagged}%
  \fi
  % deal with lack of caption
  \global\setbox\floatbox\vbox \floatcaptionattribute
    {\doifelsemainfloatbody\currentfloatsynchronize\donothing
     \unvbox\floatbox
     \ifnofloatcaption
       \vss
     \fi}% gets rid of the depth (unless tabulate)
  \egroup
  % place the float
  \float_set_box
  \float_get_box
  \global\insidefloatfalse}

\starttext
\placefigure{First}{\framed{One}}
\placefigure[none]{Second}{\framed{Two}}
\placefigure{Third}{\framed{Three}}
\stoptext

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Dec  7 20:00:28 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 7 Dec 2011 20:00:28 +0100
Subject: [dev-context] file-job.mkvi
Message-ID: <56524E42-6F73-46AD-9A24-D57C2054727E@googlemail.com>

Hi,

-\unexpanded\def\loadtexfile       [#name]{\cxtcommand{usetexfile("#name")}}
+\unexpanded\def\loadtexfile       [#name]{\ctxcommand{usetexfile("#name")}}

Wolfgang

From schuster.wolfgang at googlemail.com  Wed Dec  7 22:27:18 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 7 Dec 2011 22:27:18 +0100
Subject: [dev-context] page-lay.mkiv: \changetolayout
Message-ID: <F1770CD1-23D2-42E3-9EDE-7270D173C8DE@googlemail.com>

Hi Hans,

can you add

  \let\changetolayout\page_layouts_change

to page-lay.mkiv. I use the command in my letter module and with the new beta from the ftp you made this a internal command only.

Wolfgang

From pragma at wxs.nl  Fri Dec  9 14:54:29 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 09 Dec 2011 14:54:29 +0100
Subject: [dev-context] page-lay.mkiv: \changetolayout
In-Reply-To: <F1770CD1-23D2-42E3-9EDE-7270D173C8DE@googlemail.com>
References: <F1770CD1-23D2-42E3-9EDE-7270D173C8DE@googlemail.com>
Message-ID: <4EE21315.6040108@wxs.nl>

On 7-12-2011 22:27, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you add
>
>    \let\changetolayout\page_layouts_change
>
> to page-lay.mkiv. I use the command in my letter module and with the new beta from the ftp you made this a internal command only.

ok, will do


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Dec 13 13:29:11 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 13 Dec 2011 13:29:11 +0100
Subject: [dev-context] typo-par.mkiv
Message-ID: <BEBBB999-9BF6-402D-9E01-1664CA4C28CA@googlemail.com>

Hi,

there is a typo in the following command.

\def\place_initial[#1]% todo: optional text
  {\par
   \begingroup
   \edef\currentinitial{#1}%
   \begingroup
   \useinitialcolorparameter\c!color
   \ctxlua{typesetters.paragraphs.droppers.set {
     location = "\initialparameter\c!location",
     enabled  = true,
     n        = \number\initialparameter\c!n,
     distance = \number\dimexpr\initialparameter\c!distance,
     hoffset  = \number\dimexpr\initialparameter\c!hoffset,
     voffset  = \number\dimexpr\initialparameter\c!voffset,
     ma       = \the\attribute\colormodelattribute  ,
     ca       = \the\attribute\colorattribute       ,
     ta       = \the\attribute\transparencyattribute
   }}%
   \stopluacode
   \endgroup
   \begingroup
   \doifelsenothing{\initialparameter\c!style}
     {\definedfont[\initialparameter\s!font]}
-    {\initialstyleparameter\c!style}%
+    {\useinitialstyleparameter\c!style}%
   \ctxlua{typesetters.paragraphs.droppers.freeze()}%
   \endgroup
   \endgroup
   \setparagraphspecial[1]%
   \namedinitialparameter{#1}\c!before}

Wolfgang

From pragma at wxs.nl  Tue Dec 13 13:39:14 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 13 Dec 2011 13:39:14 +0100
Subject: [dev-context] typo-par.mkiv
In-Reply-To: <BEBBB999-9BF6-402D-9E01-1664CA4C28CA@googlemail.com>
References: <BEBBB999-9BF6-402D-9E01-1664CA4C28CA@googlemail.com>
Message-ID: <4EE74772.2090500@wxs.nl>

On 13-12-2011 13:29, Wolfgang Schuster wrote:
> Hi,
>
> there is a typo in the following command.

Indeed, I noticed it when running Hraban's test -)

Fixed.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Tue Dec 13 21:33:39 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 13 Dec 2011 21:33:39 +0100
Subject: [dev-context] mult-aux.lua
Message-ID: <678B6EAB-CA42-4E32-98B2-D70D8BCE7FFF@googlemail.com>

Hi,

?context.installattributehandler? has to be changed to ?context.installstyleandcolorhandler?

function namespaces.define(namespace,settings)
    ?
    local style = ns.style
    if style == v_yes then
--      context.installattributehandler(self,name)
        context.installstyleandcolorhandler(self,name)
        if trace_namespaces then
            report_namespaces("installing attribute handler for '%s'",name)
        end
    end
    ?
end

Wolfgang

From schuster.wolfgang at googlemail.com  Wed Dec 14 20:05:22 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 14 Dec 2011 20:05:22 +0100
Subject: [dev-context] \installframedcommandhandler
Message-ID: <4D74659A-FB3F-4892-B94E-90AD385B1AD3@googlemail.com>

Hi Hans,

can you add a \installsimpleframedcommandhandler command to pack-rul.mkiv!

\unexpanded\def\installsimpleframedcommandhandler#1#2#3%
  {\installsimplecommandhandler{#1}{#2}{#3}%
   \installinheritedframed{#2}}

Wolfgang

From pragma at wxs.nl  Wed Dec 14 20:09:34 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 14 Dec 2011 20:09:34 +0100
Subject: [dev-context] \installframedcommandhandler
In-Reply-To: <4D74659A-FB3F-4892-B94E-90AD385B1AD3@googlemail.com>
References: <4D74659A-FB3F-4892-B94E-90AD385B1AD3@googlemail.com>
Message-ID: <4EE8F46E.1090507@wxs.nl>

On 14-12-2011 20:05, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you add a \installsimpleframedcommandhandler command to pack-rul.mkiv!
>
> \unexpanded\def\installsimpleframedcommandhandler#1#2#3%
>    {\installsimplecommandhandler{#1}{#2}{#3}%
>     \installinheritedframed{#2}}

sure


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Dec 15 14:40:03 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 15 Dec 2011 14:40:03 +0100
Subject: [dev-context] supp-box.mkiv
Message-ID: <75784549-5E9D-4B3C-92A1-04FF2CAF40AE@googlemail.com>

Hi Hans,

-\unexpanded\def\righttopbox_finish
+\def\boxes_righttopbox_finish
  {\global\boxhdisplacement\boxoffset
   \global\boxvdisplacement-\dp\nextbox
   \global\advance\boxvdisplacement-\boxoffset
   \boxcursor\hskip\boxhdisplacement\raise-\boxvdisplacement\box\nextbox
   \egroup}

Wolfgang

From adityam at umich.edu  Sat Dec 17 19:45:47 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 17 Dec 2011 13:45:47 -0500 (EST)
Subject: [dev-context] Typo in grph-fil.lua
Message-ID: <alpine.LNX.2.02.1112171343060.10802@nqv-gnoyrg.tngrjnl.2jver.arg>

--- grph-fil.lua	2011-12-17 13:44:00.791168436 -0500
+++ grph-fil.lua	2011-12-17 13:44:26.158322675 -0500
@@ -46,7 +46,7 @@
          if a == "function" then
              a(name)
          elseif a == "string" and action ~= "" then
-            os.execute(a)
+            os.execute(action)
          else
              report_run("processing file, no action given for processing '%s'",name)
          end


Aditya

From pragma at wxs.nl  Sun Dec 18 14:28:45 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 18 Dec 2011 14:28:45 +0100
Subject: [dev-context] Typo in grph-fil.lua
In-Reply-To: <alpine.LNX.2.02.1112171343060.10802@nqv-gnoyrg.tngrjnl.2jver.arg>
References: <alpine.LNX.2.02.1112171343060.10802@nqv-gnoyrg.tngrjnl.2jver.arg>
Message-ID: <4EEDEA8D.6060805@wxs.nl>

On 17-12-2011 19:45, Aditya Mahajan wrote:
> --- grph-fil.lua 2011-12-17 13:44:00.791168436 -0500
> +++ grph-fil.lua 2011-12-17 13:44:26.158322675 -0500
> @@ -46,7 +46,7 @@
> if a == "function" then
> a(name)
> elseif a == "string" and action ~= "" then
> - os.execute(a)
> + os.execute(action)
> else
> report_run("processing file, no action given for processing '%s'",name)
> end

actually two buglets:

         local ta = type(action)
         if ta == "function" then
             action(name)
         elseif ta == "string" and action ~= "" then
             os.execute(action)
         else
             report_run("processing file, no action given for processing 
'%s'",name)
         end



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Dec 21 23:26:39 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 21 Dec 2011 23:26:39 +0100
Subject: [dev-context] beta
Message-ID: <4EF25D1F.3060806@wxs.nl>

Hi Wolfgang et al,

I cleaned up mkiv'd pack-rul, meta-ini, anch-pgr etc and for sure there 
have been bugs introduced. A couple of mkii artefacts have been removed 
and some speedups were possible (important as framed is a core macro so 
especially backgrounds have been redone a bit). I still have to look 
into framed using the commandhandler but let's first check if the 
current variant is ok.

I'll put a beta on the ftp server, so you might want to test,

Hans

PS. A few observations: \vbox -> hbox (less callback overhead), kern -> 
glue (less memory and calback overhead) i.e. some boxing has changed but 
hopefully for the best.

PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, 
namespaces, etc).


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Dec 22 01:13:54 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 01:13:54 +0100
Subject: [dev-context] beta
In-Reply-To: <4EF25D1F.3060806@wxs.nl>
References: <4EF25D1F.3060806@wxs.nl>
Message-ID: <12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>


Am 21.12.2011 um 23:26 schrieb Hans Hagen:

> Hi Wolfgang et al,
> 
> I cleaned up mkiv'd pack-rul, meta-ini, anch-pgr etc and for sure there have been bugs introduced. A couple of mkii artefacts have been removed and some speedups were possible (important as framed is a core macro so especially backgrounds have been redone a bit). I still have to look into framed using the commandhandler but let's first check if the current variant is ok.
> 
> I'll put a beta on the ftp server, so you might want to test,

pack-rul.mkiv \startframed nice:)

Tested with a large document and a few test files and they run fine.

> Hans
> 
> PS. A few observations: \vbox -> hbox (less callback overhead), kern -> glue (less memory and calback overhead) i.e. some boxing has changed but hopefully for the best.
> 
> PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, namespaces, etc).

Can we now consider the following prefixes for registers as the suggested method to name them:

\newcount: \c_?
\newdimen: \d_?
\newskip: \s_?
\newbox: \b_?
\newtoks: \t_?

Wolfgang

From schuster.wolfgang at googlemail.com  Thu Dec 22 01:15:50 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 01:15:50 +0100
Subject: [dev-context] type-mar.mkvi
Message-ID: <EE3A9B3E-9971-4CAF-B01C-0C210172AE53@googlemail.com>

Hi Hans,

the \margindata commands still used the no longer available \dosetupstrut command.

Wolfgang

From adityam at umich.edu  Thu Dec 22 01:19:54 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 21 Dec 2011 19:19:54 -0500 (EST)
Subject: [dev-context] beta
In-Reply-To: <12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
Message-ID: <alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>

On Thu, 22 Dec 2011, Wolfgang Schuster wrote:

>> PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, namespaces, etc).
>
> Can we now consider the following prefixes for registers as the suggested method to name them:
>
> \newcount: \c_?
> \newdimen: \d_?
> \newskip: \s_?
> \newbox: \b_?
> \newtoks: \t_?

I hope you don't converge to LaTeX3 syntax after all the rewrite is over 
:)

Aditya

From schuster.wolfgang at googlemail.com  Thu Dec 22 01:22:12 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 01:22:12 +0100
Subject: [dev-context] beta
In-Reply-To: <alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
	<alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
Message-ID: <D1BD940C-49D3-443D-95E9-CB591537F5D6@googlemail.com>


Am 22.12.2011 um 01:19 schrieb Aditya Mahajan:

> On Thu, 22 Dec 2011, Wolfgang Schuster wrote:
> 
>>> PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, namespaces, etc).
>> 
>> Can we now consider the following prefixes for registers as the suggested method to name them:
>> 
>> \newcount: \c_?
>> \newdimen: \d_?
>> \newskip: \s_?
>> \newbox: \b_?
>> \newtoks: \t_?
> 
> I hope you don't converge to LaTeX3 syntax after all the rewrite is over :)

Don?t you already use your own syntax?

Wolfgang

From adityam at umich.edu  Thu Dec 22 01:38:20 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 21 Dec 2011 19:38:20 -0500 (EST)
Subject: [dev-context] beta
In-Reply-To: <D1BD940C-49D3-443D-95E9-CB591537F5D6@googlemail.com>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
	<alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
	<D1BD940C-49D3-443D-95E9-CB591537F5D6@googlemail.com>
Message-ID: <alpine.LNX.2.02.1112211937060.15767@nqv-gnoyrg>

On Thu, 22 Dec 2011, Wolfgang Schuster wrote:

>
> Am 22.12.2011 um 01:19 schrieb Aditya Mahajan:
>
>> On Thu, 22 Dec 2011, Wolfgang Schuster wrote:
>>
>>>> PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, namespaces, etc).
>>>
>>> Can we now consider the following prefixes for registers as the suggested method to name them:
>>>
>>> \newcount: \c_?
>>> \newdimen: \d_?
>>> \newskip: \s_?
>>> \newbox: \b_?
>>> \newtoks: \t_?
>>
>> I hope you don't converge to LaTeX3 syntax after all the rewrite is over :)
>
> Don?t you already use your own syntax?

No. I reverted to the new internal syntax last week. Now I am using 
\modulename at macro_name etc.

Aditya

From schuster.wolfgang at googlemail.com  Thu Dec 22 01:51:01 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 01:51:01 +0100
Subject: [dev-context] beta
In-Reply-To: <alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
	<alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
Message-ID: <6BA194E0-803E-4625-8DFE-8265EBF87D0F@googlemail.com>


Am 22.12.2011 um 01:19 schrieb Aditya Mahajan:

> On Thu, 22 Dec 2011, Wolfgang Schuster wrote:
> 
>>> PS. I hope that in 2012 I've redone all the code (consistency, mkiv'd, namespaces, etc).
>> 
>> Can we now consider the following prefixes for registers as the suggested method to name them:
>> 
>> \newcount: \c_?
>> \newdimen: \d_?
>> \newskip: \s_?
>> \newbox: \b_?
>> \newtoks: \t_?
> 
> I hope you don't converge to LaTeX3 syntax after all the rewrite is over :)

No, i think there code is too complicated to understand without an knowledge about the syntax.

The original purpose of the underscore in context was for modules to provide a namespace for macros. With the prefixes for registers there is a easy method to see whether a register is a counter, a dimension or a box (i know \c_? could also stand for a conditional and \s_? for a signal) but they are only used for internal code.

All public command which can be used should remain without underscores, e.g. \doifelsenextbgroup etc.

Wolfgang

From pragma at wxs.nl  Thu Dec 22 09:03:19 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 09:03:19 +0100
Subject: [dev-context] beta
In-Reply-To: <12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
Message-ID: <4EF2E447.3000403@wxs.nl>

On 22-12-2011 01:13, Wolfgang Schuster wrote:

> Can we now consider the following prefixes for registers as the suggested method to name them:
>
> \newcount: \c_?
> \newdimen: \d_?
> \newskip: \s_?
> \newbox: \b_?
> \newtoks: \t_?

I also use \c for constants and conditionals (as they are in fact also 
numbers). I use \m_ for temporary macros and \p_ for expanded parameters 
(not yet consistently). So we get:

%D Conventions:
%D
%D \starttyping
%D \newcount       \c_class_whatever
%D \newconditional \c_class_whatever
%D \newconstant    \c_class_whatever
%D \newdimen       \d_class_whatever
%D \newskip        \s_class_whatever
%D \newmuskip      \s_class_whatever
%D \newbox         \b_class_whatever
%D \newtoks        \t_class_whatever
%D
%D \edef\p_class_whatever{\classparameter\c!whatever}
%D \edef\m_class_whatever{whatever}
%D \stoptyping

(coment appended to mult-aux.mkiv)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Dec 22 09:09:29 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 09:09:29 +0100
Subject: [dev-context] beta
In-Reply-To: <alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
	<alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
Message-ID: <4EF2E5B9.3030903@wxs.nl>

On 22-12-2011 01:19, Aditya Mahajan wrote:
> On Thu, 22 Dec 2011, Wolfgang Schuster wrote:
>
>>> PS. I hope that in 2012 I've redone all the code (consistency,
>>> mkiv'd, namespaces, etc).
>>
>> Can we now consider the following prefixes for registers as the
>> suggested method to name them:
>>
>> \newcount: \c_?
>> \newdimen: \d_?
>> \newskip: \s_?
>> \newbox: \b_?
>> \newtoks: \t_?
>
> I hope you don't converge to LaTeX3 syntax after all the rewrite is over :)

I have no clue what that syntax is anyway (apart from some obscure 
shortcuts I saw at a presentation ). There are no plans for such over 
the top command defining and parsing. I'd rather like to go simpler i.e. 
less esceptions.

The prefixes Wolfgang mentions are just an addition to the already used 
class_name scheme and it's less code that appending _box _count etc, so
it's just simple naming:

   \framed_width_dimen -> \d_framed_width

and

   \edef\p_framed_width{\framedparameter\c!width}

and such. Alternatively we can use

   \edef\framed_p_width

I can change the existing code easily. Of course no scheme is imposed on 
module writers.

(One reason for some system is that it permits parsing the files for 
official helpers: anything without _ is a potential user command of 
variable).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Dec 22 09:10:53 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 09:10:53 +0100
Subject: [dev-context] beta
In-Reply-To: <alpine.LNX.2.02.1112211937060.15767@nqv-gnoyrg>
References: <4EF25D1F.3060806@wxs.nl>
	<12C360E9-9C87-4F8A-9053-AC1E96E89995@googlemail.com>
	<alpine.LNX.2.02.1112211918560.15767@nqv-gnoyrg>
	<D1BD940C-49D3-443D-95E9-CB591537F5D6@googlemail.com>
	<alpine.LNX.2.02.1112211937060.15767@nqv-gnoyrg>
Message-ID: <4EF2E60D.3060305@wxs.nl>

On 22-12-2011 01:38, Aditya Mahajan wrote:

> No. I reverted to the new internal syntax last week. Now I am using
> \modulename at macro_name etc.

Personally I try to get rid of the @ as it looks so ugly (:: would look 
better).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Dec 22 09:32:13 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 09:32:13 +0100
Subject: [dev-context] type-mar.mkvi
In-Reply-To: <EE3A9B3E-9971-4CAF-B01C-0C210172AE53@googlemail.com>
References: <EE3A9B3E-9971-4CAF-B01C-0C210172AE53@googlemail.com>
Message-ID: <4EF2EB0D.3040605@wxs.nl>

On 22-12-2011 01:15, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \margindata commands still used the no longer available \dosetupstrut command.

I've added:

\def\synchronizestrut#1% no [] parsing, faster for internal
   {\ifcsname\??ut:#1\endcsname
      \csname\??ut:#1\endcsname
    \else
      \setcharstrut{#1}%
    \fi}

(no [] checking)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Dec 22 14:29:54 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 14:29:54 +0100
Subject: [dev-context] \installpagehandler
Message-ID: <996822F0-D34E-422B-BFB2-6818C388F5D2@googlemail.com>

Hi Hans,

can you add a \pagehandler command to access the defined commands

  \def\pagehandler#1%
    {\expandcheckedcsname{\??pp:h:}{#1}\v!normal}

In the following examples from the past the only method to shipout the saved pages was (the no longer available) \actualshipout and this was never nice but with the above command one could write ?\pagehandler\v!normal{?}?.

Examples:

- http://archive.contextgarden.net/message/20090522.174337.1bc2d583.en.html
- http://archive.contextgarden.net/message/20090523.173455.72a58128.en.html

Wolfgang


From pragma at wxs.nl  Thu Dec 22 14:42:48 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 14:42:48 +0100
Subject: [dev-context] \installpagehandler
In-Reply-To: <996822F0-D34E-422B-BFB2-6818C388F5D2@googlemail.com>
References: <996822F0-D34E-422B-BFB2-6818C388F5D2@googlemail.com>
Message-ID: <4EF333D8.1040502@wxs.nl>

On 22-12-2011 14:29, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you add a \pagehandler command to access the defined commands
>
>    \def\pagehandler#1%
>      {\expandcheckedcsname{\??pp:h:}{#1}\v!normal}
>
> In the following examples from the past the only method to shipout the saved pages was (the no longer available) \actualshipout and this was never nice but with the above command one could write ?\pagehandler\v!normal{?}?.
>
> Examples:
>
> - http://archive.contextgarden.net/message/20090522.174337.1bc2d583.en.html
> - http://archive.contextgarden.net/message/20090523.173455.72a58128.en.html

As I want such special commands to stand out, how about:

\unexpanded\def\invokepagehandler#1%
   {\expandcheckedcsname{\??pp:h:}{#1}\v!normal}

\let\pagehandler\invokepagehandler % only provided for downward 
compatibility



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Dec 22 14:52:16 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Dec 2011 14:52:16 +0100
Subject: [dev-context] \installpagehandler
In-Reply-To: <4EF333D8.1040502@wxs.nl>
References: <996822F0-D34E-422B-BFB2-6818C388F5D2@googlemail.com>
	<4EF333D8.1040502@wxs.nl>
Message-ID: <575ECB4D-D493-4BE5-B506-545763C7CC3B@googlemail.com>


Am 22.12.2011 um 14:42 schrieb Hans Hagen:

> On 22-12-2011 14:29, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> can you add a \pagehandler command to access the defined commands
>> 
>>   \def\pagehandler#1%
>>     {\expandcheckedcsname{\??pp:h:}{#1}\v!normal}
>> 
>> In the following examples from the past the only method to shipout the saved pages was (the no longer available) \actualshipout and this was never nice but with the above command one could write ?\pagehandler\v!normal{?}?.
>> 
>> Examples:
>> 
>> - http://archive.contextgarden.net/message/20090522.174337.1bc2d583.en.html
>> - http://archive.contextgarden.net/message/20090523.173455.72a58128.en.html
> 
> As I want such special commands to stand out, how about:
> 
> \unexpanded\def\invokepagehandler#1%
>  {\expandcheckedcsname{\??pp:h:}{#1}\v!normal}

Fine with me.

> \let\pagehandler\invokepagehandler % only provided for downward compatibility

Not necessary because there was no command for this in the past.

Wolfgang

From pragma at wxs.nl  Thu Dec 22 14:56:18 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Dec 2011 14:56:18 +0100
Subject: [dev-context] \installpagehandler
In-Reply-To: <575ECB4D-D493-4BE5-B506-545763C7CC3B@googlemail.com>
References: <996822F0-D34E-422B-BFB2-6818C388F5D2@googlemail.com>
	<4EF333D8.1040502@wxs.nl>
	<575ECB4D-D493-4BE5-B506-545763C7CC3B@googlemail.com>
Message-ID: <4EF33702.6060309@wxs.nl>

On 22-12-2011 14:52, Wolfgang Schuster wrote:

>> \let\pagehandler\invokepagehandler % only provided for downward compatibility
>
> Not necessary because there was no command for this in the past.

ok, removed

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sun Dec 25 10:22:35 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 25 Dec 2011 10:22:35 +0100
Subject: [dev-context] l-math.lua
Message-ID: <35642BCC-DA4E-497B-9D7D-D094D267F26B@googlemail.com>

Hi Hans,

if not math.odd then
-   function math.odd (n) return n % 2 == 0 end
-   function math.even(n) return n % 2 ~= 0 end
+   function math.odd (n) return n % 2 ~= 0 end
+   function math.even(n) return n % 2 == 0 end
end

Wolfgang

From pragma at wxs.nl  Wed Dec 28 00:10:12 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Dec 2011 00:10:12 +0100
Subject: [dev-context] new beta
Message-ID: <4EFA5054.8050600@wxs.nl>

Hi,

Just in case you wonder about new bugs showing up ... I changed a bunch 
of \??xx into \??longername using the (new) \installcorenamespace command.

Wolfgang: there's now also \installdirectcommandhandler for dumb, not 
inheriting cases. It's somewhat slower but not that much and the time 
consuming cases are the ones with inheritance anyway.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Dec 28 16:59:45 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 28 Dec 2011 16:59:45 +0100
Subject: [dev-context] new beta
In-Reply-To: <4EFA5054.8050600@wxs.nl>
References: <4EFA5054.8050600@wxs.nl>
Message-ID: <142C3A31-3A3E-488C-9AD8-BAA91D9FCEEE@googlemail.com>


Am 28.12.2011 um 00:10 schrieb Hans Hagen:

> Hi,
> 
> Just in case you wonder about new bugs showing up ... I changed a bunch of \??xx into \??longername using the (new) \installcorenamespace command.
> 
> Wolfgang: there's now also \installdirectcommandhandler for dumb, not inheriting cases. It's somewhat slower but not that much and the time consuming cases are the ones with inheritance anyway.

colo-ini.mkiv

\installdirectcommandhandler \??color {colors}

but the definition in mult-aux.mkiv expects three parameters:

\unexpanded\def\installdirectcommandhandler#1#2#3%
  {?}

Wolfgang

From pragma at wxs.nl  Wed Dec 28 18:43:20 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Dec 2011 18:43:20 +0100
Subject: [dev-context] new beta
In-Reply-To: <142C3A31-3A3E-488C-9AD8-BAA91D9FCEEE@googlemail.com>
References: <4EFA5054.8050600@wxs.nl>
	<142C3A31-3A3E-488C-9AD8-BAA91D9FCEEE@googlemail.com>
Message-ID: <4EFB5538.5050804@wxs.nl>

On 28-12-2011 16:59, Wolfgang Schuster wrote:
>
> Am 28.12.2011 um 00:10 schrieb Hans Hagen:
>
>> Hi,
>>
>> Just in case you wonder about new bugs showing up ... I changed a bunch of \??xx into \??longername using the (new) \installcorenamespace command.
>>
>> Wolfgang: there's now also \installdirectcommandhandler for dumb, not inheriting cases. It's somewhat slower but not that much and the time consuming cases are the ones with inheritance anyway.
>
> colo-ini.mkiv
>
> \installdirectcommandhandler \??color {colors}
>
> but the definition in mult-aux.mkiv expects three parameters:
>
> \unexpanded\def\installdirectcommandhandler#1#2#3%
>    {?}

ah, ok ... we only need two commands


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Fri Dec 30 09:52:31 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Fri, 30 Dec 2011 09:52:31 +0100
Subject: [dev-context] mult-dim.mkvi
Message-ID: <80693C78-4C5E-4E71-9755-53959E783B86@gmail.com>

Hi Hans,

there is \setbox missing before the \b_assign_width\emptybox assignments.

\setvalue{\??dimensionwidth          }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
\setvalue{\??dimensionwidth\v!fit    }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
\setvalue{\??dimensionwidth\v!broad  }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\dimexpr\wd\b_assign_width+#extra\relax\b_assign_width\emptybox}

Wolfgang

From schuster.wolfgang at googlemail.com  Fri Dec 30 10:15:07 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 30 Dec 2011 10:15:07 +0100
Subject: [dev-context] mult-dim.mkvi
Message-ID: <90EC23E6-9EDD-4B99-95EB-4A730111AABD@googlemail.com>

Hi Hans,

there is \setbox missing before the \b_assign_width\emptybox assignments.

\setvalue{\??dimensionwidth          }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
\setvalue{\??dimensionwidth\v!fit    }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
\setvalue{\??dimensionwidth\v!broad  }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\dimexpr\wd\b_assign_width+#extra\relax\b_assign_width\emptybox}

Wolfgang

From mamidogad at gmail.com  Sun Dec 25 10:35:14 2011
From: mamidogad at gmail.com (Mohamed Gad)
Date: Sun, 25 Dec 2011 11:35:14 +0200
Subject: [dev-context] context MathML2PDF
Message-ID: <CALOjjyqdPue0RQYCsnc0Z5dwPbFg5LuWiqre4CKVvkpS99kYxQ@mail.gmail.com>

Dear sir,

I really appreciate that you did the tool of converting MathML to PDF, but
when I tried to convert MathML to pdf found problem in the following:

<mml:math>
    <mml:mtable columnlines="solid" rowlines="solid">
        <mml:mtr>
            <mml:mtd>
                <mml:mn>1</mml:mn>
            </mml:mtd>
            <mml:mtd>
                <mml:mn>2</mml:mn>
            </mml:mtd>
        </mml:mtr>
        <mml:mtr>
            <mml:mtd>
                <mml:mn>3</mml:mn>
            </mml:mtd>
            <mml:mtd>
                <mml:mn>4</mml:mn>
            </mml:mtd>
        </mml:mtr>
    </mml:mtable>
</mml:math>

the column line and row line is vanished in pdf. I think you didn't insert
this case.

Thanks


-- 
Muhammad Gad
Production Developer
Hindawi Publishing Corporation
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20111225/f2090ef9/attachment.html>

From r.hassel1 at chello.nl  Mon Dec 26 16:26:00 2011
From: r.hassel1 at chello.nl (Rene van Hassel)
Date: Mon, 26 Dec 2011 16:26:00 +0100
Subject: [dev-context] djvu-file
Message-ID: <20111226162600.5SHCS.63111.root@viefep12>

Hello NTG-members,


with MKiv the djview plugin crashed. 
Have you any idea how to solve that?

This works with MKii:
\useURL[Something-1-url][/book-library/Something.djvu][][djvu-file]
but with MKiv I got the message, that the djview plugin has 
crashed. ( pdf-file gives no problem, if you want to look 
to a pdf-file(!)).

Who knows how to get a djvu-file readable,


Kind regards,


Rene' van Hassel






From pragma at wxs.nl  Sat Dec 31 01:06:12 2011
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 31 Dec 2011 01:06:12 +0100
Subject: [dev-context] beta on ftp
Message-ID: <4EFE51F4.2000803@wxs.nl>

Hi,

The beta on the ftp server has 'redone' alignment. Two setters have been 
merged (as they overlapped mostly) and some caching takes place. As a 
result switching alignments is about twice as fast (or more depending on 
how much keys are passed). However, it is hard to predict if there are 
side effects. Nothing that can't be solved, but nevertheless ...

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Sat Dec 31 14:06:48 2011
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sat, 31 Dec 2011 14:06:48 +0100
Subject: [dev-context] mult-dim.mkvi
In-Reply-To: <90EC23E6-9EDD-4B99-95EB-4A730111AABD@googlemail.com>
References: <90EC23E6-9EDD-4B99-95EB-4A730111AABD@googlemail.com>
Message-ID: <D34F6300-2241-4C3F-AADE-F8092C963B6E@gmail.com>


Am 30.12.2011 um 10:15 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> there is \setbox missing before the \b_assign_width\emptybox assignments.
> 
> \setvalue{\??dimensionwidth          }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
> \setvalue{\??dimensionwidth\v!fit    }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\wd\b_assign_width\b_assign_width\emptybox}
> \setvalue{\??dimensionwidth\v!broad  }#value#dimension#content#extra{\setbox\b_assign_width\hbox{#content}#dimension\dimexpr\wd\b_assign_width+#extra\relax\b_assign_width\emptybox}

This bug isn?t fixed yet.

Wolfgang

From bogus@does.not.exist.com  Mon Oct 10 19:20:21 2011
From: bogus@does.not.exist.com ()
Date: Mon, 10 Oct 2011 17:20:21 -0000
Subject: No subject
Message-ID: <mailman.2.1330724097.4225.dev-context@ntg.nl>

Issue: According to a native Greek speaker, the lower-greek and
upper-greek styles aren't actually used. I've removed upper-greek for
now, but kept lower-greek because CSS2.1 included the keyword. Do
these have actual use-cases?

@counter-style lower-greek {
        type: alphabetic;
        glyphs: '\3B1' '\3B2' '\3B3' '\3B4' '\3B5' '\3B6' '\3B7' '\3B8'
 '\3B9' '\3BA' '\3BB' '\3BC' '\3BD' '\3BE' '\3BF' '\3C0' '\3C1' '\3C3'
 '\3C4' '\3C5' '\3C6' '\3C7' '\3C8' '\3C9';
        /* '=CE=B1' '=CE=B2' '=CE=B3' '=CE=B4' '=CE=B5' '=CE=B6' '=CE=B7' '=
=CE=B8' '=CE=B9' '=CE=BA' '=CE=BB' '=CE=BC' '=CE=BD' '=CE=BE' '=CE=BF'
'=CF=80' '=CF=81' '=CF=83' '=CF=84' '=CF=85' '=CF=86' '=CF=87' '=CF=88' '=
=CF=89' */
        /* This style is only defined because CSS2.1 has it.  It
doesn't appear to actually be used in Greek texts. */
}

(However there is lower-serbo-croatian and upper-serbo-croation,
lower-macedonian and upper-macedonian. I should ask for
lower-slovenian and upper-slovenian ;)

You need to ask Thomas about his opinion, but I see no reason for not
using lowercase greek for mathematical purposes.

Mojca

