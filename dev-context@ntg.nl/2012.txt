From schuster.wolfgang at googlemail.com  Tue Jan  3 12:49:36 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 3 Jan 2012 12:49:36 +0100
Subject: [dev-context] pack-mrl.mkiv
Message-ID: <70C1495A-5AFC-4EE6-BA34-3299404AB8F3@googlemail.com>

Hi Hans,

there is a @ missing for the style and color parameters.

\def\docomplextextrule#1%
  {\bgroup
   \advance\hsize\dimexpr-\rightskip-\leftskip\relax
   \setbox\scratchbox\hbox to \hsize
     {\dimen4\dimexpr .5ex+.5\linewidth\relax
      \dimen6\dimexpr-.5ex+.5\linewidth\relax
      \doifsomething{#1}
        {\doifelse\@@tllocation\v!inmargin
           {\llap
              {\dousestyleparameter\@@tlstyle
               \dousecolorparameter\@@tlcolor
               #1%
               \hskip\leftmargindistance}}
           {\color[\@@tlrulecolor]
              {\vrule\!!height\dimen4\!!depth\dimen6\!!width\@@tlwidth}%
            \hbox spread 2\dimexpr\@@tldistance\relax
              {\hss
-              \dousestyleparameter\@tlstyle
+              \dousestyleparameter\@@tlstyle
-              \dousecolorparameter\@tlcolor
+              \dousecolorparameter\@@tlcolor
               \strut#1%
               \hss}}}%
      \color[\@@tlrulecolor]
        {\leaders\hrule\!!height\dimen4\!!depth\dimen6\hfill}}%
   \ht\scratchbox\strutht
   \dp\scratchbox\strutdp
   \noindent\box\scratchbox
%\nobreak\verticalstrut\kern-\struttotal
% evt \witruimte
   \egroup}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Jan  8 12:01:13 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 8 Jan 2012 12:01:13 +0100
Subject: [dev-context] font-ini.mkvi: \mapfontsize
Message-ID: <7882884B-79BA-4B6C-9205-08FAC69A67C3@gmail.com>

Hi Hans,

there is \dimexpr missing otherwise \mapfontsize has no effect.

%\def\font_basics_set_mapped_fontsize#from%
%  {\ifcsname\??mappedfontsize#from\endcsname
%     \csname\??mappedfontsize#from\endcsname\else#from%
%   \fi}

\def\font_basics_set_mapped_fontsize#from%
  {\ifcsname\??mappedfontsize\the\dimexpr#from\relax\endcsname
     \csname\??mappedfontsize\the\dimexpr#from\relax\endcsname\else#from%
   \fi}

Example:

\mapfontsize[12pt][24pt]

\starttext
12pt\par
\definedfont[Serif mo 1]12pt
\stoptext

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jan  8 12:07:12 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 8 Jan 2012 12:07:12 +0100
Subject: [dev-context] font-ini.mkvi: \mapfontsize
Message-ID: <8D8A00D3-4391-486D-8280-1569C6250C57@googlemail.com>

Hi Hans,

there is \dimexpr missing otherwise \mapfontsize has no effect.

%\def\font_basics_set_mapped_fontsize#from%
%  {\ifcsname\??mappedfontsize#from\endcsname
%     \csname\??mappedfontsize#from\endcsname\else#from%
%   \fi}

\def\font_basics_set_mapped_fontsize#from%
 {\ifcsname\??mappedfontsize\the\dimexpr#from\relax\endcsname
    \csname\??mappedfontsize\the\dimexpr#from\relax\endcsname\else#from%
  \fi}

Example:

\mapfontsize[12pt][24pt]

\starttext
12pt\par
\definedfont[Serif mo 1]12pt
\stoptext

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jan  8 15:18:30 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 8 Jan 2012 15:18:30 +0100
Subject: [dev-context] font-ini.mkvi: \definefrozenfont
Message-ID: <E47004ED-9C38-4A4F-B28B-3BF45FB1EC5A@googlemail.com>

Hi Hans,

is there any reason to keep \definefrozenfont because it doesn?t work.

\definefrozenfont[test][Sans sa 1]

\starttext

\test Test % \expandafter\let\csname\lastfontidentifier\expandafter\endcsname\csname\rawfontidentifier\endcsname

\switchtobodyfont[20pt]

\test Test

\stoptext

Wolfgang

From pragma at wxs.nl  Sun Jan  8 18:09:16 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 08 Jan 2012 18:09:16 +0100
Subject: [dev-context] font-ini.mkvi: \definefrozenfont
In-Reply-To: <E47004ED-9C38-4A4F-B28B-3BF45FB1EC5A@googlemail.com>
References: <E47004ED-9C38-4A4F-B28B-3BF45FB1EC5A@googlemail.com>
Message-ID: <4F09CDBC.6000701@wxs.nl>

On 8-1-2012 15:18, Wolfgang Schuster wrote:
> Hi Hans,
>
> is there any reason to keep \definefrozenfont because it doesn?t work.
>
> \definefrozenfont[test][Sans sa 1]
>
> \starttext
>
> \test Test % \expandafter\let\csname\lastfontidentifier\expandafter\endcsname\csname\rawfontidentifier\endcsname
>
> \switchtobodyfont[20pt]
>
> \test Test
>
> \stoptext

\def\font_basics_define_frozen_font[#name][#specification][#settings]%
   {\begingroup
    \font_basics_define_font[#name][#specification][#settings]%
    \csname#name\endcsname
    \expandafter\endgroup
    \expandafter\let\csname#name\endcsname\lastrawfontcall}

of course one might wonder if it ever gets used


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sun Jan  8 19:03:19 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 8 Jan 2012 19:03:19 +0100
Subject: [dev-context] font-ini.mkvi: \definefrozenfont
In-Reply-To: <4F09CDBC.6000701@wxs.nl>
References: <E47004ED-9C38-4A4F-B28B-3BF45FB1EC5A@googlemail.com>
	<4F09CDBC.6000701@wxs.nl>
Message-ID: <8605D7FB-BD30-42DB-93E1-AD7D0390CBDD@googlemail.com>


Am 08.01.2012 um 18:09 schrieb Hans Hagen:

> On 8-1-2012 15:18, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> is there any reason to keep \definefrozenfont because it doesn?t work.
>> 
>> \definefrozenfont[test][Sans sa 1]
>> 
>> \starttext
>> 
>> \test Test % \expandafter\let\csname\lastfontidentifier\expandafter\endcsname\csname\rawfontidentifier\endcsname
>> 
>> \switchtobodyfont[20pt]
>> 
>> \test Test
>> 
>> \stoptext
> 
> \def\font_basics_define_frozen_font[#name][#specification][#settings]%
>  {\begingroup
>   \font_basics_define_font[#name][#specification][#settings]%
>   \csname#name\endcsname
>   \expandafter\endgroup
>   \expandafter\let\csname#name\endcsname\lastrawfontcall}
> 
> of course one might wonder if it ever gets used

I don?t think so because this bug is also in the mkii code.

Wolfgang

From pragma at wxs.nl  Sun Jan  8 19:27:53 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 08 Jan 2012 19:27:53 +0100
Subject: [dev-context] font-ini.mkvi: \definefrozenfont
In-Reply-To: <8605D7FB-BD30-42DB-93E1-AD7D0390CBDD@googlemail.com>
References: <E47004ED-9C38-4A4F-B28B-3BF45FB1EC5A@googlemail.com>
	<4F09CDBC.6000701@wxs.nl>
	<8605D7FB-BD30-42DB-93E1-AD7D0390CBDD@googlemail.com>
Message-ID: <4F09E029.6030908@wxs.nl>

On 8-1-2012 19:03, Wolfgang Schuster wrote:

>> of course one might wonder if it ever gets used
>
> I don?t think so because this bug is also in the mkii code.

Then I wonder where I use it myself ... it's actually faster which might 
matter in a critical workflow with many font switches. Let's keep it as 
undocumented feature.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sat Jan 14 19:55:59 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 14 Jan 2012 19:55:59 +0100
Subject: [dev-context] \setupnote
Message-ID: <9163E15D-2874-41A5-8740-EC30CFC8E0DA@googlemail.com>

Hi Hans,

When \setupnote is called in preamble footnotes are placed wrong.

%\setuppapersize[A4]
\setupnote[footnote][]
\starttext
Text\footnote{Note}.
\stoptext

This happens because \dimen\currentnoteins is set to 1pt (the current value of \textheight before \starttext).

The problem is the following setting in page-app.mkiv

   \setuplayout
     [fittingpage]
     [\c!width=\d_page_fitting_width,
      \c!height=\d_page_fitting_height,
      \c!location=\v!middle]

which changes the \textheight dimension (from the value set in page-lay.mkiv).

Merging \definelayout and \setuplayout from

   \definelayout
     [fittingpage]
     [\v!page]

   \setuplayout
     [fittingpage]
     [\c!width=\d_page_fitting_width,
      \c!height=\d_page_fitting_height,
      \c!location=\v!middle]

to

   \definelayout
     [fittingpage]
     [\v!page]
     [\c!width=\d_page_fitting_width,
      \c!height=\d_page_fitting_height,
      \c!location=\v!middle]

solves the problem.

Wolfgang

From adityam at umich.edu  Sat Jan 14 20:43:33 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 14 Jan 2012 14:43:33 -0500 (EST)
Subject: [dev-context] ReadFile introduces a space before reading file
Message-ID: <alpine.LNX.2.02.1201141442180.24267@nqv-gnoyrg.tngrjnl.2jver.arg>

Hi,

In the current version \ReadFile introduces an extra space before reading 
the file.

\starttext
A\ReadFile{ward}
\stoptext

No such space is produced by \input

\starttext
A\input ward
\stoptext

Bug?

Aditya

From adityam at umich.edu  Sat Jan 14 20:46:43 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 14 Jan 2012 14:46:43 -0500 (EST)
Subject: [dev-context] ReadFile introduces a space before reading file
In-Reply-To: <alpine.LNX.2.02.1201141442180.24267@nqv-gnoyrg.tngrjnl.2jver.arg>
References: <alpine.LNX.2.02.1201141442180.24267@nqv-gnoyrg.tngrjnl.2jver.arg>
Message-ID: <alpine.LNX.2.02.1201141446140.24267@nqv-gnoyrg.tngrjnl.2jver.arg>

On Sat, 14 Jan 2012, Aditya Mahajan wrote:

> Hi,
>
> In the current version \ReadFile introduces an extra space before reading the 
> file.
>
> \starttext
> A\ReadFile{ward}
> \stoptext
>
> No such space is produced by \input
>
> \starttext
> A\input ward
> \stoptext
>
> Bug?

In file-res.mkvi:

\def\syst_files_read_file_indeed#true#false%
   {#true% <--- AM: % was missing
    \relax
    \normalinput{\readfilename}%
    \relax}

Aditya

From schuster.wolfgang at googlemail.com  Sun Jan 15 15:31:19 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 15 Jan 2012 15:31:19 +0100
Subject: [dev-context] Buffers again
Message-ID: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>

Hi Hans,

in the new beta buffers are fixed but one \endgroup is on the wrong position.

In the following macros \endgroup has to be before \buff_stop{#4}.

\def\buff_start_indeed#1#2#3#4% \donothing needed !
  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}\endgroup}}} % (3 & 4 & 5 & 6)

A cleaner solution would be to remove \endgroup above and put it back into \buff_stop.

\def\buff_start_indeed#1#2#3#4%
  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}}}}

\unexpanded\def\buff_stop#1%
  {\endgroup
   \getvalue{#1}}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Jan 15 15:37:49 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 15 Jan 2012 15:37:49 +0100
Subject: [dev-context] Buffers again
In-Reply-To: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
References: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
Message-ID: <9D075762-671A-449F-B784-55DBE2B7C334@gmail.com>


Am 15.01.2012 um 15:31 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> in the new beta buffers are fixed but one \endgroup is on the wrong position.
> 
> In the following macros \endgroup has to be before \buff_stop{#4}.
> 
> \def\buff_start_indeed#1#2#3#4% \donothing needed !
>  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}\endgroup}}} % (3 & 4 & 5 & 6)
> 
> A cleaner solution would be to remove \endgroup above and put it back into \buff_stop.
> 
> \def\buff_start_indeed#1#2#3#4%
>  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}}}}
> 
> \unexpanded\def\buff_stop#1%
>  {\endgroup
>   \getvalue{#1}}

Can you also add a direct version of \getbuffer, e.g.

   \let\getbufferdirect\buff_get_stored_indeed % Would be \getbufferdata a better name?

or

  \def\getbufferdirect[#1]{\buff_get_stored_indeed{#1}}

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jan 15 15:38:27 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 15 Jan 2012 15:38:27 +0100
Subject: [dev-context] Buffers again
In-Reply-To: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
References: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
Message-ID: <3A2847E6-805E-4EEC-BAD4-11AAF6A24A96@googlemail.com>


Am 15.01.2012 um 15:31 schrieb Wolfgang Schuster:

> Hi Hans,
> 
> in the new beta buffers are fixed but one \endgroup is on the wrong position.
> 
> In the following macros \endgroup has to be before \buff_stop{#4}.
> 
> \def\buff_start_indeed#1#2#3#4% \donothing needed !
> {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}\endgroup}}} % (3 & 4 & 5 & 6)
> 
> A cleaner solution would be to remove \endgroup above and put it back into \buff_stop.
> 
> \def\buff_start_indeed#1#2#3#4%
> {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}}}}
> 
> \unexpanded\def\buff_stop#1%
> {\endgroup
>  \getvalue{#1}}

Can you also add a direct version of \getbuffer, e.g.

  \let\getbufferdirect\buff_get_stored_indeed % Would be \getbufferdata a better name?

or

 \def\getbufferdirect[#1]{\buff_get_stored_indeed{#1}}

Wolfgang

From pragma at wxs.nl  Sun Jan 15 16:21:49 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 15 Jan 2012 16:21:49 +0100
Subject: [dev-context] Buffers again
In-Reply-To: <9D075762-671A-449F-B784-55DBE2B7C334@gmail.com>
References: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
	<9D075762-671A-449F-B784-55DBE2B7C334@gmail.com>
Message-ID: <4F12EF0D.9000001@wxs.nl>

On 15-1-2012 15:37, Wolfgang Schuster wrote:
>
> Am 15.01.2012 um 15:31 schrieb Wolfgang Schuster:
>
>> Hi Hans,
>>
>> in the new beta buffers are fixed but one \endgroup is on the wrong position.
>>
>> In the following macros \endgroup has to be before \buff_stop{#4}.
>>
>> \def\buff_start_indeed#1#2#3#4% \donothing needed !
>>   {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}\endgroup}}} % (3&  4&  5&  6)
>>
>> A cleaner solution would be to remove \endgroup above and put it back into \buff_stop.
>>
>> \def\buff_start_indeed#1#2#3#4%
>>   {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}}}}
>>
>> \unexpanded\def\buff_stop#1%
>>   {\endgroup
>>    \getvalue{#1}}
>
> Can you also add a direct version of \getbuffer, e.g.
>
>     \let\getbufferdirect\buff_get_stored_indeed % Would be \getbufferdata a better name?
>
> or
>
>    \def\getbufferdirect[#1]{\buff_get_stored_indeed{#1}}

how about

\def\getbufferdata[#1]{\buff_get_stored_indeed{#1}}



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Sun Jan 15 16:47:00 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 15 Jan 2012 16:47:00 +0100
Subject: [dev-context] Buffers again
In-Reply-To: <4F12EF0D.9000001@wxs.nl>
References: <3EE4C85F-71CE-48C9-9B88-882DA8621843@googlemail.com>
	<9D075762-671A-449F-B784-55DBE2B7C334@gmail.com>
	<4F12EF0D.9000001@wxs.nl>
Message-ID: <A8D6F9EF-A204-4874-8254-0A135668AED4@gmail.com>


Am 15.01.2012 um 16:21 schrieb Hans Hagen:

> On 15-1-2012 15:37, Wolfgang Schuster wrote:
>> 
>> Am 15.01.2012 um 15:31 schrieb Wolfgang Schuster:
>> 
>>> Hi Hans,
>>> 
>>> in the new beta buffers are fixed but one \endgroup is on the wrong position.
>>> 
>>> In the following macros \endgroup has to be before \buff_stop{#4}.
>>> 
>>> \def\buff_start_indeed#1#2#3#4% \donothing needed !
>>>  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}\endgroup}}} % (3&  4&  5&  6)
>>> 
>>> A cleaner solution would be to remove \endgroup above and put it back into \buff_stop.
>>> 
>>> \def\buff_start_indeed#1#2#3#4%
>>>  {\normalexpanded{\buff_pickup{#2}{#3}{#4}{}{\buff_stop{#4}}}}
>>> 
>>> \unexpanded\def\buff_stop#1%
>>>  {\endgroup
>>>   \getvalue{#1}}
>> 
>> Can you also add a direct version of \getbuffer, e.g.
>> 
>>    \let\getbufferdirect\buff_get_stored_indeed % Would be \getbufferdata a better name?
>> 
>> or
>> 
>>   \def\getbufferdirect[#1]{\buff_get_stored_indeed{#1}}
> 
> how about
> 
> \def\getbufferdata[#1]{\buff_get_stored_indeed{#1}}

Yes.

Wolfgang

From pragma at wxs.nl  Sun Jan 15 18:14:48 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 15 Jan 2012 18:14:48 +0100
Subject: [dev-context] \setupnote
In-Reply-To: <9163E15D-2874-41A5-8740-EC30CFC8E0DA@googlemail.com>
References: <9163E15D-2874-41A5-8740-EC30CFC8E0DA@googlemail.com>
Message-ID: <4F130988.4020002@wxs.nl>

On 14-1-2012 19:55, Wolfgang Schuster wrote:

> The problem is the following setting in page-app.mkiv
>
>     \setuplayout
>       [fittingpage]
>       [\c!width=\d_page_fitting_width,
>        \c!height=\d_page_fitting_height,
>        \c!location=\v!middle]
>
> which changes the \textheight dimension (from the value set in page-lay.mkiv).
>
> Merging \definelayout and \setuplayout from
>
>     \definelayout
>       [fittingpage]
>       [\v!page]
>
>     \setuplayout
>       [fittingpage]
>       [\c!width=\d_page_fitting_width,
>        \c!height=\d_page_fitting_height,
>        \c!location=\v!middle]
>
> to
>
>     \definelayout
>       [fittingpage]
>       [\v!page]
>       [\c!width=\d_page_fitting_width,
>        \c!height=\d_page_fitting_height,
>        \c!location=\v!middle]
>
> solves the problem.

aha, I had noticed some weird side effects in other cases ... so I 
wonder when this was introduced, but it's a more serious issue then

So, in the next beta check

\installswitchsetuphandler

In the switch variant we now have a dedicated token register for 
synchronization.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sun Jan 15 20:05:31 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 15 Jan 2012 20:05:31 +0100
Subject: [dev-context] \setupnote
In-Reply-To: <4F130988.4020002@wxs.nl>
References: <9163E15D-2874-41A5-8740-EC30CFC8E0DA@googlemail.com>
	<4F130988.4020002@wxs.nl>
Message-ID: <684F3989-25CC-482E-8B81-D93E1577B5F8@googlemail.com>


Am 15.01.2012 um 18:14 schrieb Hans Hagen:

> On 14-1-2012 19:55, Wolfgang Schuster wrote:
> 
>> The problem is the following setting in page-app.mkiv
>> 
>>    \setuplayout
>>      [fittingpage]
>>      [\c!width=\d_page_fitting_width,
>>       \c!height=\d_page_fitting_height,
>>       \c!location=\v!middle]
>> 
>> which changes the \textheight dimension (from the value set in page-lay.mkiv).
>> 
>> Merging \definelayout and \setuplayout from
>> 
>>    \definelayout
>>      [fittingpage]
>>      [\v!page]
>> 
>>    \setuplayout
>>      [fittingpage]
>>      [\c!width=\d_page_fitting_width,
>>       \c!height=\d_page_fitting_height,
>>       \c!location=\v!middle]
>> 
>> to
>> 
>>    \definelayout
>>      [fittingpage]
>>      [\v!page]
>>      [\c!width=\d_page_fitting_width,
>>       \c!height=\d_page_fitting_height,
>>       \c!location=\v!middle]
>> 
>> solves the problem.
> 
> aha, I had noticed some weird side effects in other cases ... so I wonder when this was introduced, but it's a more serious issue then
> 
> So, in the next beta check
> 
> \installswitchsetuphandler
> 
> In the switch variant we now have a dedicated token register for synchronization.

Why is \previouslayout defined as token register when it?s later only used to save the value of \currentlayout?

Wolfgang

From pragma at wxs.nl  Mon Jan 16 10:16:53 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Jan 2012 10:16:53 +0100
Subject: [dev-context] \setupnote
In-Reply-To: <684F3989-25CC-482E-8B81-D93E1577B5F8@googlemail.com>
References: <9163E15D-2874-41A5-8740-EC30CFC8E0DA@googlemail.com>
	<4F130988.4020002@wxs.nl>
	<684F3989-25CC-482E-8B81-D93E1577B5F8@googlemail.com>
Message-ID: <4F13EB05.80702@wxs.nl>

On 15-1-2012 20:05, Wolfgang Schuster wrote:

> Why is \previouslayout defined as token register when it?s later only used to save the value of \currentlayout?

a left-over from a previous variant (where i has everyswitchsetup)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jan 16 16:06:33 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 16 Jan 2012 16:06:33 +0100
Subject: [dev-context] \setnumber
Message-ID: <E0D4868B-163A-4CBC-A50E-1A6D58439CB2@googlemail.com>

Hi,

can the \setnumber/\setstructurecounter syntax be changed to allow also

  \setnumber[?][3]

besides the current

  \setnumber[?]{3}

The first form fits better with the other setup commands etc.


\unprotect

\unexpanded\def\setstructurecounter
  {\dodoubleempty\dosetstructurecounter}

\def\dosetstructurecounter
  {\ifsecondargument
     \expandafter\dosetstructurecounteryes
   \else
     \expandafter\dosetstructurecounternop
   \fi}

\def\dosetstructurecounteryes[#1][#2]{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}
\def\dosetstructurecounternop[#1][]#2{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}

\let\setnumber\setstructurecounter

\protect

\definenumber[test]

\starttext

\setnumber[test]{3}

\getnumber[test]

\setnumber[test][7]

\getnumber[test]

\stoptext

Wolfgang


From pragma at wxs.nl  Mon Jan 16 19:26:19 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Jan 2012 19:26:19 +0100
Subject: [dev-context] \setnumber
In-Reply-To: <E0D4868B-163A-4CBC-A50E-1A6D58439CB2@googlemail.com>
References: <E0D4868B-163A-4CBC-A50E-1A6D58439CB2@googlemail.com>
Message-ID: <4F146BCB.7060702@wxs.nl>

On 16-1-2012 16:06, Wolfgang Schuster wrote:
> Hi,
>
> can the \setnumber/\setstructurecounter syntax be changed to allow also
>
>    \setnumber[?][3]
>
> besides the current
>
>    \setnumber[?]{3}
>
> The first form fits better with the other setup commands etc.
>
>
> \unprotect
>
> \unexpanded\def\setstructurecounter
>    {\dodoubleempty\dosetstructurecounter}
>
> \def\dosetstructurecounter
>    {\ifsecondargument
>       \expandafter\dosetstructurecounteryes
>     \else
>       \expandafter\dosetstructurecounternop
>     \fi}
>
> \def\dosetstructurecounteryes[#1][#2]{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}
> \def\dosetstructurecounternop[#1][]#2{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}
>
> \let\setnumber\setstructurecounter

another option is to combine them with the subs and have three arguments 
(one being optional) and drop the {} variant (not used that often in the 
core anyway and I will provide a fast {}{} variant anyway)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jan 16 19:39:55 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 16 Jan 2012 19:39:55 +0100
Subject: [dev-context] \setnumber
In-Reply-To: <4F146BCB.7060702@wxs.nl>
References: <E0D4868B-163A-4CBC-A50E-1A6D58439CB2@googlemail.com>
	<4F146BCB.7060702@wxs.nl>
Message-ID: <8EFC6047-0E9D-412A-AE76-F20F8AECABBF@googlemail.com>


Am 16.01.2012 um 19:26 schrieb Hans Hagen:

> On 16-1-2012 16:06, Wolfgang Schuster wrote:
>> Hi,
>> 
>> can the \setnumber/\setstructurecounter syntax be changed to allow also
>> 
>>   \setnumber[?][3]
>> 
>> besides the current
>> 
>>   \setnumber[?]{3}
>> 
>> The first form fits better with the other setup commands etc.
>> 
>> 
>> \unprotect
>> 
>> \unexpanded\def\setstructurecounter
>>   {\dodoubleempty\dosetstructurecounter}
>> 
>> \def\dosetstructurecounter
>>   {\ifsecondargument
>>      \expandafter\dosetstructurecounteryes
>>    \else
>>      \expandafter\dosetstructurecounternop
>>    \fi}
>> 
>> \def\dosetstructurecounteryes[#1][#2]{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}
>> \def\dosetstructurecounternop[#1][]#2{\ctxcommand{setstructurecounter    ("\@@thestructurecounter{#1}",1,\number#2)}}
>> 
>> \let\setnumber\setstructurecounter
> 
> another option is to combine them with the subs and have three arguments (one being optional) and drop the {} variant (not used that often in the core anyway and I will provide a fast {}{} variant anyway)

+1

Wolfgang

From pragma at wxs.nl  Mon Jan 16 22:59:59 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Jan 2012 22:59:59 +0100
Subject: [dev-context] numbers
Message-ID: <4F149DDF.3020609@wxs.nl>

Hi Wolfgang,

I redid some of strc-num so you'd better test it. One difference is that 
the 'user variants' do some checking due to the dodouble etc

An alternative is to have different ones for normal and sub and do 
something like \def\xxx[#1]#2[#3]{...{#1}{#3}} i.e. hard tex errors
instead of warnings.

A problem might be that users use \raw*counter which was expandable 
while now we have ...value alternatives for that (could be done 
consistently for more commands. Ok, we could keep old ones and use 
*value for checked ones instead. It all boils down to how compatible we 
want to be.

So ... just an ftp beta and no public one yet.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon Jan 16 23:46:21 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 16 Jan 2012 23:46:21 +0100
Subject: [dev-context] numbers
In-Reply-To: <4F149DDF.3020609@wxs.nl>
References: <4F149DDF.3020609@wxs.nl>
Message-ID: <F59D0D82-5188-4C46-BE42-C6A177B85814@googlemail.com>


Am 16.01.2012 um 22:59 schrieb Hans Hagen:

> Hi Wolfgang,
> 
> I redid some of strc-num so you'd better test it. One difference is that the 'user variants' do some checking due to the dodouble etc
> 
> An alternative is to have different ones for normal and sub and do something like \def\xxx[#1]#2[#3]{...{#1}{#3}} i.e. hard tex errors
> instead of warnings.
> 
> A problem might be that users use \raw*counter which was expandable while now we have ...value alternatives for that (could be done consistently for more commands. Ok, we could keep old ones and use *value for checked ones instead. It all boils down to how compatible we want to be.
> 
> So ... just an ftp beta and no public one yet.

There are a few names wrong, e.g.

\def\strc_counters_raw_interfaced
  {\ifsecondargument
     \singleexpandafter\strc_counters_raw_sub
   \else\iffirstargument
     \doubleexpandafter\strc_counters_raw_yes
   \else
     \doubleexpandafter\gobbletwooptionals
   \fi\fi}

call \strc_counters_raw_sub or \strc_counters_raw_yes but then the yes form calls the hop form (now with braces)

  \def\strc_counters_raw_yes  [#1][#2]{\strc_counters_raw_sub  {#1}\plusone}

and the hop form is defined twice

\def\strc_counters_raw_sub  [#1][#2]{\strc_counters_raw  {#1}{#2}}
\def\strc_counters_raw_sub  #1#2{\ctxcommand{structurecountervalue("\strc_counters_the{#1}",\number#2)}}



Another mistake is that the \*structurecountervalue expects two arguments, to fix this the following

\let\rawstructurecountervalue     \strc_counters_raw_yes
\let\laststructurecountervalue    \strc_counters_last_yes
\let\firststructurecountervalue   \strc_counters_first_yes
\let\nextstructurecountervalue    \strc_counters_next_yes
\let\prevstructurecountervalue    \strc_counters_prev_yes

should be changed to this

\def\rawstructurecountervalue  [#1]{\strc_counters_raw_yes  [#1][]}
\def\laststructurecountervalue [#1]{\strc_counters_last_yes [#1][]}
\def\firststructurecountervalue[#1]{\strc_counters_first_yes[#1][]}
\def\nextstructurecountervalue [#1]{\strc_counters_next_yes [#1][]}
\def\prevstructurecountervalue [#1]{\strc_counters_prev_yes [#1][]}

Wolfgang

From pragma at wxs.nl  Tue Jan 17 00:42:35 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Jan 2012 00:42:35 +0100
Subject: [dev-context] numbers
In-Reply-To: <F59D0D82-5188-4C46-BE42-C6A177B85814@googlemail.com>
References: <4F149DDF.3020609@wxs.nl>
	<F59D0D82-5188-4C46-BE42-C6A177B85814@googlemail.com>
Message-ID: <4F14B5EB.7050802@wxs.nl>

On 16-1-2012 23:46, Wolfgang Schuster wrote:

> There are a few names wrong, e.g.
>
> \def\strc_counters_raw_sub  [#1][#2]{\strc_counters_raw  {#1}{#2}}
> \def\strc_counters_raw_sub  #1#2{\ctxcommand{structurecountervalue("\strc_counters_the{#1}",\number#2)}}

indeed, I ran into it ... after a few days of underscores (doing font 
stuff) they start shimmering before my eyes ...

> Another mistake is that the \*structurecountervalue expects two arguments, to fix this the following
>
> \let\rawstructurecountervalue     \strc_counters_raw_yes
> \let\laststructurecountervalue    \strc_counters_last_yes
> \let\firststructurecountervalue   \strc_counters_first_yes
> \let\nextstructurecountervalue    \strc_counters_next_yes
> \let\prevstructurecountervalue    \strc_counters_prev_yes
>
> should be changed to this
>
> \def\rawstructurecountervalue  [#1]{\strc_counters_raw_yes  [#1][]}
> \def\laststructurecountervalue [#1]{\strc_counters_last_yes [#1][]}
> \def\firststructurecountervalue[#1]{\strc_counters_first_yes[#1][]}
> \def\nextstructurecountervalue [#1]{\strc_counters_next_yes [#1][]}
> \def\prevstructurecountervalue [#1]{\strc_counters_prev_yes [#1][]}

ah, in that case we can also just dup them

new beta (sorry for bothering you with this checking it)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Jan 18 00:02:49 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 18 Jan 2012 00:02:49 +0100
Subject: [dev-context] \definelistplacement
Message-ID: <F215E9F6-B236-462C-A9A5-01C43C3C5FD3@googlemail.com>

Hi,

can the \defineplistplacement command in the same way be modified as the \defineheadplacement command to allow

  \definelistplacement[?][?]#1#2#3{?} % old form with parameters

and

  \definelistplacement[?][?]{?} % new form without parameters


\unexpanded\def\definelistplacement
  {\dodoubleempty\dodefinelistplacement}
 
\def\dodefinelistplacement[#1][#2]%
  {\setvalue{\??listelement#1}%
     {\doifelsenothing{#2}
        {\getvalue{\??listelement\v!command}}%
        {\expandcheckedcsname\??listelement{#2}\v!command}%
      \setlistparameter\c!command{\getvalue{\??listelementcommand#1}}}%
   \doifnextbgroupelse
     {\dodefinelistplacementyes{#1}}
     {\dodefinelistplacementnop{#1}}}

\def\dodefinelistplacementyes#1%
  {\setvalue{\??listelementcommand#1}##1##2}

\def\dodefinelistplacementnop#1%
  {\setvalue{\??listelementcommand#1}}

Wolfgang


From schuster.wolfgang at googlemail.com  Wed Jan 18 10:19:15 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 18 Jan 2012 10:19:15 +0100
Subject: [dev-context] strc-num.mkiv
Message-ID: <4C293C59-6EFB-4BA5-84F9-79306757EA86@googlemail.com>

Hi Hans,

another block with wrong names (missing _sub)

%\def\strc_counters_set_one           [#1][#2][#3]{\strc_counters_set          {#1}\plusone{#2}}
%\def\strc_counters_setown_one        [#1][#2][#3]{\strc_counters_setown       {#1}\plusone{#2}}
%\def\strc_counters_restart_one       [#1][#2][#3]{\strc_counters_restart      {#1}\plusone{#2}}
%\def\strc_counters_reset_one             [#1][#2]{\strc_counters_reset        {#1}\plusone}
%\def\strc_counters_increment_one         [#1][#2]{\strc_counters_increment    {#1}\plusone}
%\def\strc_counters_decrement_one         [#1][#2]{\strc_counters_decrement    {#1}\plusone}

\def\strc_counters_set_one           [#1][#2][#3]{\strc_counters_set_sub      {#1}\plusone{#2}}
\def\strc_counters_setown_one        [#1][#2][#3]{\strc_counters_setown_sub   {#1}\plusone{#2}}
\def\strc_counters_restart_one       [#1][#2][#3]{\strc_counters_restart_sub  {#1}\plusone{#2}}
\def\strc_counters_reset_one             [#1][#2]{\strc_counters_reset_sub    {#1}\plusone}
\def\strc_counters_increment_one         [#1][#2]{\strc_counters_increment_sub{#1}\plusone}
\def\strc_counters_decrement_one         [#1][#2]{\strc_counters_decrement_sub{#1}\plusone}

Wolfgang

From luigi.scarso at gmail.com  Wed Jan 18 12:33:29 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 18 Jan 2012 12:33:29 +0100
Subject: [dev-context] \c!suffixstopper undefined
Message-ID: <CAG5iGsDx5qti9xJK5nSy29SVyYHhYcDPvCW4j5AZbpkkx3SLAA@mail.gmail.com>

In strc-flt.mkvi \c!suffixstopper is undefined

\unexpanded\def\thecurrentfloatnumbersuffix
  {\doifsomething{\floatcaptionparameter\c!suffix}
     {\floatcaptionparameter\c!suffixseparator
      \floatcaptionparameter\c!suffix
      \floatcaptionparameter\c!suffixstopper}}

Perhaps it need to be added  to \setupcaptions ?

\setupcaptions
  [\c!location=\v!bottom,
   \c!grid=,
   \c!before=, % not used (yet)
   \c!inbetween={\blank[\v!medium]},
   \c!after=, % not used (yet)
   \c!spacebefore=,
   \c!spaceinbetween=, % replaces fuzzy inbetween dual usage
   \c!spaceafter=,
   \c!width=\v!fit,
   \c!minwidth=\v!fit, % id est: the width of the floatbox in some cases
   \c!headstyle=\v!bold,
   \c!headcolor=,
   \c!leftmargin=\zeropoint,
   \c!rightmargin=\zeropoint,
   \c!outermargin=\zeropoint,
   \c!innermargin=\zeropoint,
   \c!setups=,
   \c!style=\v!normal,
   \c!color=,
   \c!textstyle=,
   \c!textcolor=,
   \c!align=,
   \c!number=\v!yes,
 % \c!expansion=\v!no
 % \c!prefix=\v!no,
 % \c!prefixconnector=.,
 % \c!way=\v!by\v!chapter,
 % \c!prefixsegments=2:2,
 % \c!way=\@@nrway,
 % \c!blockway=\@@nrblockway,
 % \c!sectionnumber=\@@nrsectionnumber,
 % \c!separator=\@@koseparator,
 % \c!starter=\@@kostarter,
 % \c!stopper=\@@kostopper,
   \c!suffixseparator=, % currently rather hard coded
   \c!suffixstopper=, %% added
   \c!suffix=\floatcaptionsuffix,
   \c!distance=1em,
   \c!conversion=\v!numbers,
   \c!command=]

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120118/d49d0ca7/attachment.html>

From pragma at wxs.nl  Wed Jan 18 13:35:56 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 18 Jan 2012 13:35:56 +0100
Subject: [dev-context] \c!suffixstopper undefined
In-Reply-To: <CAG5iGsDx5qti9xJK5nSy29SVyYHhYcDPvCW4j5AZbpkkx3SLAA@mail.gmail.com>
References: <CAG5iGsDx5qti9xJK5nSy29SVyYHhYcDPvCW4j5AZbpkkx3SLAA@mail.gmail.com>
Message-ID: <4F16BCAC.4000705@wxs.nl>

On 18-1-2012 12:33, luigi scarso wrote:

> Perhaps it need to be added  to \setupcaptions ?

no, unset keys are considered empty so there is no need to initialize them



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Jan 19 20:05:20 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 19 Jan 2012 20:05:20 +0100
Subject: [dev-context] beta on ftp
Message-ID: <4F186970.2050508@wxs.nl>

Hi,

For those with access to the ftp server .. there is a new beta with 
quite some low level changes in the font subsystem (leaner, faster, 
design sizes dealt with differently). Also type-otf.mkiv has been split 
up (mostly more will follow) which gives a faster startup.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Jan 19 23:21:54 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 19 Jan 2012 23:21:54 +0100
Subject: [dev-context] \definelistplacement
In-Reply-To: <F215E9F6-B236-462C-A9A5-01C43C3C5FD3@googlemail.com>
References: <F215E9F6-B236-462C-A9A5-01C43C3C5FD3@googlemail.com>
Message-ID: <4F189782.1010205@wxs.nl>

On 18-1-2012 00:02, Wolfgang Schuster wrote:
> Hi,
>
> can the \defineplistplacement command in the same way be modified as the \defineheadplacement command to allow
>
>    \definelistplacement[?][?]#1#2#3{?} % old form with parameters
>
> and
>
>    \definelistplacement[?][?]{?} % new form without parameters
>
>
> \unexpanded\def\definelistplacement
>    {\dodoubleempty\dodefinelistplacement}
>
> \def\dodefinelistplacement[#1][#2]%
>    {\setvalue{\??listelement#1}%
>       {\doifelsenothing{#2}
>          {\getvalue{\??listelement\v!command}}%
>          {\expandcheckedcsname\??listelement{#2}\v!command}%
>        \setlistparameter\c!command{\getvalue{\??listelementcommand#1}}}%
>     \doifnextbgroupelse
>       {\dodefinelistplacementyes{#1}}
>       {\dodefinelistplacementnop{#1}}}
>
> \def\dodefinelistplacementyes#1%
>    {\setvalue{\??listelementcommand#1}##1##2}
>
> \def\dodefinelistplacementnop#1%
>    {\setvalue{\??listelementcommand#1}}

ok, done (btw, that module is on the to do list anyway)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Fri Jan 20 11:28:02 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 20 Jan 2012 11:28:02 +0100
Subject: [dev-context] beta on ftp
In-Reply-To: <4F186970.2050508@wxs.nl>
References: <4F186970.2050508@wxs.nl>
Message-ID: <CAG5iGsBYob4fnMkbEtLzZW=1sjwsyCKrZoATcBkP61mV2qTwag@mail.gmail.com>

On Thu, Jan 19, 2012 at 8:05 PM, Hans Hagen <pragma at wxs.nl> wrote:

> Hi,
>
> For those with access to the ftp server .. there is a new beta with quite
> some low level changes in the font subsystem (leaner, faster, design sizes
> dealt with differently). Also type-otf.mkiv has been split up (mostly more
> will follow) which gives a faster startup.
>


! Missing number, treated as zero.

                   ,
<argument> ...t_face , "\number \relativefontid ",
Sorry, no help file --- I've just seen it.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120120/9b611b26/attachment.html>

From pragma at wxs.nl  Fri Jan 20 13:01:57 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 20 Jan 2012 13:01:57 +0100
Subject: [dev-context] beta on ftp
In-Reply-To: <CAG5iGsBYob4fnMkbEtLzZW=1sjwsyCKrZoATcBkP61mV2qTwag@mail.gmail.com>
References: <4F186970.2050508@wxs.nl>
	<CAG5iGsBYob4fnMkbEtLzZW=1sjwsyCKrZoATcBkP61mV2qTwag@mail.gmail.com>
Message-ID: <4F1957B5.2080002@wxs.nl>

On 20-1-2012 11:28, luigi scarso wrote:
> On Thu, Jan 19, 2012 at 8:05 PM, Hans Hagen<pragma at wxs.nl>  wrote:
>
>> Hi,
>>
>> For those with access to the ftp server .. there is a new beta with quite
>> some low level changes in the font subsystem (leaner, faster, design sizes
>> dealt with differently). Also type-otf.mkiv has been split up (mostly more
>> will follow) which gives a faster startup.
>>
>
>
> ! Missing number, treated as zero.
>
>                     ,
> <argument>  ...t_face , "\number \relativefontid ",
> Sorry, no help file --- I've just seen it.

can you try again?

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jan 20 14:43:21 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 20 Jan 2012 14:43:21 +0100
Subject: [dev-context] next beta
Message-ID: <4F196F79.1010202@wxs.nl>

Hi,

new in next beta:

\enablemode[two]

\startmodeset
     [one]     {1}
     [two]     {2}
     [two]     {2}
     [three]   {3}
     [default] {?}
\stopmodeset

\startmodeset
     [one]     {1}
     [three]   {3}
     [default] {?}
\stopmodesv

\startmodeset
     [one] {
         \input tufte
     }
     [two] {
         \startmodeset
             [one]     {A}
             [two]     {B}
             [two]     {B}
             [three]   {C}
             [default] {!}
         \stopmodeset
     }
     [three] {
         \input zapf
     }
     [default] {
         \input ward
     }
\stopmodes

nicer and more efficient than nesting a lot of \doifmodeelse's

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sat Jan 21 19:40:56 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 21 Jan 2012 19:40:56 +0100
Subject: [dev-context] core-mis.mkiv: \items
Message-ID: <3B47DEB2-264A-4AD2-8346-DC6F6772ABAB@googlemail.com>

Hi,

\def\complexitems[#1]%
  {\bgroup
   \setupitems[#1]%
   \parindent\zeropoint
   \setlocalhsize
   \hsize\localhsize
   \dontcomplain
  %\doifundefined{doitems\@@islocation}%
  %  {\let\@@islocation\v!left}%
  %\getvalue{doitems\@@islocation}}
-  \executeifdefined{doitems\@@islocation}{\let\@@islocation\v!left}}
+  \executeifdefined{doitems\@@islocation}{\getvalue{doitems\v!left}}}

Wolfgang

From sbbrouwer at gmail.com  Sun Jan 22 22:41:20 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Sun, 22 Jan 2012 22:41:20 +0100
Subject: [dev-context] context.starttyping() prints two hash marks iff first
 printed character is a hash mark
Message-ID: <CAF=dkzwcMbj-aMte7ohJ29vjzvy-yHkKkokz8dQAxFSoVKoAdA@mail.gmail.com>

Hi all,

I'm doing some stuff with verbatim text and LuaTex, and found the
following problem:

After context.starttyping(), a hash mark in the first position gets
printed twice. A hash mark in any other position gets printed
normally.
This bug does not occur after tex.print("\\starttyping"),

See the code below.

Cheers,

Sietse Brouwer

\starttext

\startluacode
    -- incorrectly prints two hash marks
    context.starttyping()
    tex.print("#")
    tex.print("\\stoptyping")

    -- correctly prints one hash mark
    context.starttyping()
    tex.print("asdf")
    tex.print("#")
    tex.print("\\stoptyping")

    -- correctly prints one hash mark
    tex.print("\\starttyping")
    tex.print("#")
    tex.print("\\stoptyping")
\stopluacode

\stoptext


--
Sietse Brouwer -- sbbrouwer at gmail.com -- +31 6 13.456.848
Verlengde Wassenaarseweg 4a -- 2342 BG Oegstgeest -- the Netherlands
MSN: sietse at gawab.com -- ICQ: 341232104

From pragma at wxs.nl  Sun Jan 22 23:08:56 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 22 Jan 2012 23:08:56 +0100
Subject: [dev-context] context.starttyping() prints two hash marks iff
 first printed character is a hash mark
In-Reply-To: <CAF=dkzwcMbj-aMte7ohJ29vjzvy-yHkKkokz8dQAxFSoVKoAdA@mail.gmail.com>
References: <CAF=dkzwcMbj-aMte7ohJ29vjzvy-yHkKkokz8dQAxFSoVKoAdA@mail.gmail.com>
Message-ID: <4F1C88F8.3030009@wxs.nl>

On 22-1-2012 22:41, Sietse Brouwer wrote:

> After context.starttyping(), a hash mark in the first position gets
> printed twice. A hash mark in any other position gets printed
> normally.
> This bug does not occur after tex.print("\\starttyping"),

It's not so much a bug as a side effect of catcode regimes, tex 
interpreting hashes and either or not delayed flushing. You can use

tex.print(tex.vrbcatcodes,"#")

(or context.verbatim cum suis)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Jan 23 19:52:17 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Jan 2012 19:52:17 +0100
Subject: [dev-context] lists redone
Message-ID: <4F1DAC61.90500@wxs.nl>

Hi,

Just a warning: the next beta (already on ftp) has much of the list 
rendering macros redone. Hopefully with not too many side effects.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Tue Jan 24 18:06:02 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Jan 2012 18:06:02 +0100
Subject: [dev-context] showframe is unknown
Message-ID: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>

\showframe put
 [unknown command \showframe]
but it  doesn'h stop halt the run.
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120124/1f7ccd28/attachment.html>

From schuster.wolfgang at googlemail.com  Tue Jan 24 18:33:53 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 24 Jan 2012 18:33:53 +0100
Subject: [dev-context] showframe is unknown
In-Reply-To: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>
References: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>
Message-ID: <61769CC7-51AA-4D6B-85E4-C887B82A174F@googlemail.com>


Am 24.01.2012 um 18:06 schrieb luigi scarso:

> \showframe put
>  [unknown command \showframe]
> but it  doesn'h stop halt the run.

file-mod.mkvi (change \setgvalue to \letgvalue):

\def\dofetchruntimecommand#1#2% actually a test on #1 being define would be ok as well
  {\ifcsname\??runtimeloaded#2\endcsname
     % already loaded
   \else
     \global\let#1\undefined
     \startreadingfile
     \startnointerference % \bgroup
     \cleanupfeatures % better \setnormalcatcodes / test first
     \readfile{#2.\mksuffix}\donothing\donothing
     \stopnointerference  % \egroup
     \stopreadingfile
-    \setgvalue{\??runtimeloaded#2}\empty
+    \letgvalue{\??runtimeloaded#2}\empty
   \fi
   \ifx#1\undefined
     \writestatus\m!system{command \string#1 not found in file #2}%
     \unexpanded\gdef#1{{\infofont[unknown command \string#1]}}%
   \fi
   #1}

Wolfgang

From pragma at wxs.nl  Tue Jan 24 18:37:36 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Jan 2012 18:37:36 +0100
Subject: [dev-context] showframe is unknown
In-Reply-To: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>
References: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>
Message-ID: <4F1EEC60.3060601@wxs.nl>

On 24-1-2012 18:06, luigi scarso wrote:
> \showframe put
>   [unknown command \showframe]
> but it  doesn'h stop halt the run.


\setgvalue =>

      \letgvalue{\??runtimeloaded#2}\empty

in file-mod.mkiv



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Wed Jan 25 11:29:36 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 25 Jan 2012 11:29:36 +0100
Subject: [dev-context] showframe is unknown
In-Reply-To: <61769CC7-51AA-4D6B-85E4-C887B82A174F@googlemail.com>
References: <CAG5iGsATWweF7D-BX54HLOnG5F49zqVB3dWuOXJzxFPPHAqFdQ@mail.gmail.com>
	<61769CC7-51AA-4D6B-85E4-C887B82A174F@googlemail.com>
Message-ID: <CAG5iGsBaHLKWy7yGoDEQXF72xFGp6PjcB85j92iiDC=S1+0xPA@mail.gmail.com>

On Tue, Jan 24, 2012 at 6:33 PM, Wolfgang Schuster <
schuster.wolfgang at googlemail.com> wrote:

>
> Am 24.01.2012 um 18:06 schrieb luigi scarso:
>
> > \showframe put
> >  [unknown command \showframe]
> > but it  doesn'h stop halt the run.
>
> file-mod.mkvi (change \setgvalue to \letgvalue):
>
> \def\dofetchruntimecommand#1#2% actually a test on #1 being define would
> be ok as well
>  {\ifcsname\??runtimeloaded#2\endcsname
>     % already loaded
>   \else
>     \global\let#1\undefined
>     \startreadingfile
>     \startnointerference % \bgroup
>     \cleanupfeatures % better \setnormalcatcodes / test first
>     \readfile{#2.\mksuffix}\donothing\donothing
>     \stopnointerference  % \egroup
>     \stopreadingfile
> -    \setgvalue{\??runtimeloaded#2}\empty
> +    \letgvalue{\??runtimeloaded#2}\empty
>   \fi
>   \ifx#1\undefined
>     \writestatus\m!system{command \string#1 not found in file #2}%
>     \unexpanded\gdef#1{{\infofont[unknown command \string#1]}}%
>   \fi
>   #1}
>
> Wolfgang

ok4me


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120125/cf7d35ca/attachment.html>

From luigi.scarso at gmail.com  Thu Jan 26 16:59:20 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 26 Jan 2012 16:59:20 +0100
Subject: [dev-context] error in setuplist[alternative=command]
Message-ID: <CAG5iGsA8OJP27=S_5dNX=1RKnSzsRNfpK3KxmET4V5mByj0B=A@mail.gmail.com>

\def\ChapterCommand#1#2#3{#1 #2 #3}%
\setuplist[chapter]
        [alternative=command,
       command=\ChapterCommand]
\starttext
\placecontent
\startpart[title=aaa]
\startchapter[title=bbb]
\startsection[title=ccc]
\input knuth
\stopsection
\stopchapter
\stoppart
\stoptext

! Argument of \ChapterCommand has an extra }.

Perhaps

*** strc-lst.mkvi.new    2012-01-26 16:47:46.000000000 +0100
--- strc-lst.mkvi    2012-01-23 19:44:00.000000000 +0100
***************
*** 755,757 ****
  \startsetups[\??listrenderings:\v!command]
!     \def\p_command{\listalternativeparameter\c!command}%
      \ifx\p_command\empty
--- 755,757 ----
  \startsetups[\??listrenderings:\v!command]
!     \edef\p_command{\listalternativeparameter\c!command}%
      \ifx\p_command\empty

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120126/b7f89b1a/attachment.html>

From luigi.scarso at gmail.com  Thu Jan 26 20:20:04 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 26 Jan 2012 20:20:04 +0100
Subject: [dev-context] error in setuplist[alternative=command]
In-Reply-To: <D1609A53-8F39-4E06-9F44-2BED493DBA73@googlemail.com>
References: <CAG5iGsA8OJP27=S_5dNX=1RKnSzsRNfpK3KxmET4V5mByj0B=A@mail.gmail.com>
	<D1609A53-8F39-4E06-9F44-2BED493DBA73@googlemail.com>
Message-ID: <CAG5iGsAn_rgCWK9mYdn-fmwQu2KvdJioMC292Y=rPf3jzwRMZg@mail.gmail.com>

On Thu, Jan 26, 2012 at 6:16 PM, Wolfgang Schuster <
schuster.wolfgang at googlemail.com> wrote:

>
> Am 26.01.2012 um 16:59 schrieb luigi scarso:
>
> > \def\ChapterCommand#1#2#3{#1 #2 #3}%
> > \setuplist[chapter]
> >         [alternative=command,
> >        command=\ChapterCommand]
> > \starttext
> > \placecontent
> > \startpart[title=aaa]
> > \startchapter[title=bbb]
> > \startsection[title=ccc]
> > \input knuth
> > \stopsection
> > \stopchapter
> > \stoppart
> > \stoptext
> >
> > ! Argument of \ChapterCommand has an extra }.
>
> Write \unexpanded\def\?
>
> Wolfgang


hm, doesn't break compatibility ?
Also in strc-doc.mkiv
% We can access the (stored) data with the following macros.
%
% \def\MyHeadCommand  #1#2{\framed{#1}\framed{#2 /
\structureuservariable{subtitle}}}
%
\def\MyListCommand#1#2#3{\externalfigure[\structurelistuservariable{figure}][height=5mm]#2}
%
% \setuphead[chapter][command=\MyHeadCommand]
% \setuplist[chapter][alternative=command,command=\MyListCommand]

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120126/40ae4227/attachment.html>

From schuster.wolfgang at googlemail.com  Thu Jan 26 20:33:47 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 26 Jan 2012 20:33:47 +0100
Subject: [dev-context] error in setuplist[alternative=command]
In-Reply-To: <CAG5iGsAn_rgCWK9mYdn-fmwQu2KvdJioMC292Y=rPf3jzwRMZg@mail.gmail.com>
References: <CAG5iGsA8OJP27=S_5dNX=1RKnSzsRNfpK3KxmET4V5mByj0B=A@mail.gmail.com>
	<D1609A53-8F39-4E06-9F44-2BED493DBA73@googlemail.com>
	<CAG5iGsAn_rgCWK9mYdn-fmwQu2KvdJioMC292Y=rPf3jzwRMZg@mail.gmail.com>
Message-ID: <B86E940E-B37A-4F12-BFA2-55795F9E70F4@googlemail.com>


Am 26.01.2012 um 20:20 schrieb luigi scarso:

> hm, doesn't break compatibility ?
> Also in strc-doc.mkiv
> % We can access the (stored) data with the following macros.
> %
> % \def\MyHeadCommand  #1#2{\framed{#1}\framed{#2 / \structureuservariable{subtitle}}}
> % \def\MyListCommand#1#2#3{\externalfigure[\structurelistuservariable{figure}][height=5mm]#2}
> %
> % \setuphead[chapter][command=\MyHeadCommand]
> % \setuplist[chapter][alternative=command,command=\MyListCommand]

I think it?s better to write the commands above as \define[2]\MyHeadCommand{?}
and \define[3]\MyListCommand{?} and make all with \define generated commands
unexpanded.

Wolfgang

From luigi.scarso at gmail.com  Fri Jan 27 02:39:41 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 27 Jan 2012 02:39:41 +0100
Subject: [dev-context] error in setuplist[alternative=command]
In-Reply-To: <B86E940E-B37A-4F12-BFA2-55795F9E70F4@googlemail.com>
References: <CAG5iGsA8OJP27=S_5dNX=1RKnSzsRNfpK3KxmET4V5mByj0B=A@mail.gmail.com>
	<D1609A53-8F39-4E06-9F44-2BED493DBA73@googlemail.com>
	<CAG5iGsAn_rgCWK9mYdn-fmwQu2KvdJioMC292Y=rPf3jzwRMZg@mail.gmail.com>
	<B86E940E-B37A-4F12-BFA2-55795F9E70F4@googlemail.com>
Message-ID: <CAG5iGsAy030bx+2Nm+E7C4TOWJ8B+7JDeePNVh2ifnOr9r+jFA@mail.gmail.com>

On Thu, Jan 26, 2012 at 8:33 PM, Wolfgang Schuster <
schuster.wolfgang at googlemail.com> wrote:

>
> Am 26.01.2012 um 20:20 schrieb luigi scarso:
>
> > hm, doesn't break compatibility ?
> > Also in strc-doc.mkiv
> > % We can access the (stored) data with the following macros.
> > %
> > % \def\MyHeadCommand  #1#2{\framed{#1}\framed{#2 /
> \structureuservariable{subtitle}}}
> > %
> \def\MyListCommand#1#2#3{\externalfigure[\structurelistuservariable{figure}][height=5mm]#2}
> > %
> > % \setuphead[chapter][command=\MyHeadCommand]
> > % \setuplist[chapter][alternative=command,command=\MyListCommand]
>
> I think it?s better to write the commands above as
> \define[2]\MyHeadCommand{?}
> and \define[3]\MyListCommand{?} and make all with \define generated
> commands
> unexpanded.
>
> Wolfgang


Hm, I don't know.
\def\MyListCommand#1#2#3
looks simpler.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120127/dad95cdb/attachment.html>

From schuster.wolfgang at googlemail.com  Sat Jan 28 19:40:35 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 28 Jan 2012 19:40:35 +0100
Subject: [dev-context] type-ini.mkvi
Message-ID: <6A12C014-25D2-447A-A0E9-177064133C0B@googlemail.com>

Hi,

\def\tsvar#key#default% undocumented and unofficial
  {\expandafter\ifx\csname\??ts#key\endcsname\empty
     \csname\??ts#key\endcsname
   \else
     #default%
   \fi}

has to be (#default in the empty branch)

\def\tsvar#key#default% undocumented and unofficial
  {\expandafter\ifx\csname\??ts#key\endcsname\empty
     #default%
   \else
     \csname\??ts#key\endcsname
   \fi}

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jan 29 17:17:41 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 29 Jan 2012 17:17:41 +0100
Subject: [dev-context] strc-lst.mkvi
Message-ID: <A2DD5DFE-F482-4A7D-8056-853BBF38017C@googlemail.com>

Hi,

remove the \v!-prefix for ?none? and ?command?

-\startsetups[\??listrenderings:\v!none]
+\startsetups[\??listrenderings:none]
    % nothing, nb we use the [] syntax here because we end with a \cs
\stopsetups

-\startsetups[\??listrenderings:\v!command]
+\startsetups[\??listrenderings:command]
    \edef\p_command{\listalternativeparameter\c!command}%
    \ifx\p_command\empty
        [\currentlist: \currentlistentrynumber\space -- \currentlistentrytitle\space -- \currentlistentrypagenumber]%
    \else
        \p_command\currentlistentrynumber\currentlistentrytitle\currentlistentrypagenumber
    \fi
\stopsetups

because they are used without them

\definelistalternative
  [\v!command]
  [\c!renderingsetup=\??listrenderings:command]

\definelistalternative
  [\v!none]
  [\c!renderingsetup=\??listrenderings:none]

Wolfgang

From wolfgang.schuster at gmail.com  Thu Feb  2 18:26:42 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 2 Feb 2012 18:26:42 +0100
Subject: [dev-context] colo-grp.mkiv
Message-ID: <EA9B7592-92D6-4D38-9C16-2D8C3272AB3A@gmail.com>

Hi Hans,

\def\colo_groups_define_entry#1#2#3% name mode specification
  {\advance\c_colo_groups_n\plusone
-  \csname\??colorgroupsetter\ifcsname\??colorgroupssetter#2\endcsname#2\else\s!rgb\fi\endcsname[#1:\the\c_colo_groups_n][#3:0:0:0:0]}
+  \csname\??colorgroupsetter\ifcsname\??colorgroupsetter#2\endcsname#2\else\s!rgb\fi\endcsname[#1:\the\c_colo_groups_n][#3:0:0:0:0]}

Wolfgang


From schuster.wolfgang at googlemail.com  Thu Feb  2 18:34:37 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 2 Feb 2012 18:34:37 +0100
Subject: [dev-context] colo-grp.mkiv
Message-ID: <669A08FB-EFF5-4306-A0D7-7374388338A8@googlemail.com>

Hi Hans,

\def\colo_groups_define_entry#1#2#3% name mode specification
 {\advance\c_colo_groups_n\plusone
-  \csname\??colorgroupsetter\ifcsname\??colorgroupssetter#2\endcsname#2\else\s!rgb\fi\endcsname[#1:\the\c_colo_groups_n][#3:0:0:0:0]}
+  \csname\??colorgroupsetter\ifcsname\??colorgroupsetter#2\endcsname#2\else\s!rgb\fi\endcsname[#1:\the\c_colo_groups_n][#3:0:0:0:0]}

Wolfgang


From luigi.scarso at gmail.com  Fri Feb  3 17:34:16 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 3 Feb 2012 17:34:16 +0100
Subject: [dev-context] \page_one_place_float_text undefined in ftp
Message-ID: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>

\page_one_place_float_text is undefined in latest ftp

-- 
luigi

From pragma at wxs.nl  Fri Feb  3 18:45:45 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 03 Feb 2012 18:45:45 +0100
Subject: [dev-context] \page_one_place_float_text undefined in ftp
In-Reply-To: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>
References: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>
Message-ID: <4F2C1D49.9010105@wxs.nl>

On 3-2-2012 17:34, luigi scarso wrote:
> \page_one_place_float_text is undefined in latest ftp
>
strc-flt:

\def\page_one_place_float_text[#1]%
      ^^^^ was strc

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Feb  3 22:20:02 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 03 Feb 2012 22:20:02 +0100
Subject: [dev-context] new beta
Message-ID: <4F2C4F82.9040600@wxs.nl>

Hi,

I've uploaded a beta to the ftp server. There is some work in progress:

- otr (page-* files)
- descriptions, enumerations, notes (and their parent: constructions)

I'm not yet satisfied but it shows where we're heading.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Feb  6 09:57:25 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 6 Feb 2012 09:57:25 +0100
Subject: [dev-context] new beta
In-Reply-To: <4F2C4F82.9040600@wxs.nl>
References: <4F2C4F82.9040600@wxs.nl>
Message-ID: <CAG5iGsDw1dtU8kQ9SkF-hNM3JrseZf0O2PYZjuiBg=4rDd0VzA@mail.gmail.com>

On Fri, Feb 3, 2012 at 10:20 PM, Hans Hagen <pragma at wxs.nl> wrote:
> Hi,
>
> I've uploaded a beta to the ftp server. There is some work in progress:
>
> - otr (page-* files)
> - descriptions, enumerations, notes (and their parent: constructions)
>
> I'm not yet satisfied but it shows where we're heading.
>
> Hans

! LuaTeX error ...tex/texmf-context/tex/context/base/strc-mar.lua:663:
attempt to call field 'savedtitle' (a nil value)
stack traceback:
	...tex/texmf-context/tex/context/base/strc-mar.lua:663: in function 'title'
	<main ctx instance>:1: in main chunk.

system          > tex > error on line 1 in file xtabl-b.tex: LuaTeX error  ...


\sectionheadmarkingtitle ...arks.title("#1","#2")}

l.1 \markingcommand{chapter}{li::2}

\ctxcommand ...\directlua \zerocount {commands.#1}

<argument> ...rking("chapter","\v!page ","first")}
                                                  \fi \endgroup
\firstofoneargument #1->#1

<to be read again>
                   }



-- 
luigi

From pragma at wxs.nl  Mon Feb  6 11:05:12 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 06 Feb 2012 11:05:12 +0100
Subject: [dev-context] new beta
In-Reply-To: <CAG5iGsDw1dtU8kQ9SkF-hNM3JrseZf0O2PYZjuiBg=4rDd0VzA@mail.gmail.com>
References: <4F2C4F82.9040600@wxs.nl>
	<CAG5iGsDw1dtU8kQ9SkF-hNM3JrseZf0O2PYZjuiBg=4rDd0VzA@mail.gmail.com>
Message-ID: <4F2FA5D8.8020804@wxs.nl>

On 6-2-2012 09:57, luigi scarso wrote:
> On Fri, Feb 3, 2012 at 10:20 PM, Hans Hagen<pragma at wxs.nl>  wrote:
>> Hi,
>>
>> I've uploaded a beta to the ftp server. There is some work in progress:
>>
>> - otr (page-* files)
>> - descriptions, enumerations, notes (and their parent: constructions)
>>
>> I'm not yet satisfied but it shows where we're heading.
>>
>> Hans
>
> ! LuaTeX error ...tex/texmf-context/tex/context/base/strc-mar.lua:663:
> attempt to call field 'savedtitle' (a nil value)
> stack traceback:
> 	...tex/texmf-context/tex/context/base/strc-mar.lua:663: in function 'title'
> 	<main ctx instance>:1: in main chunk.
>
> system>  tex>  error on line 1 in file xtabl-b.tex: LuaTeX error  ...
>
>
> \sectionheadmarkingtitle ...arks.title("#1","#2")}
>
> l.1 \markingcommand{chapter}{li::2}
>
> \ctxcommand ...\directlua \zerocount {commands.#1}
>
> <argument>  ...rking("chapter","\v!page ","first")}
>                                                    \fi \endgroup
> \firstofoneargument #1->#1
>
> <to be read again>
>                     }
>

         commands.savedlisttitle(tag,listindex,"marking")
         commands.savedlisnumber(tag,listindex,"marking")


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Feb  6 11:27:50 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 6 Feb 2012 11:27:50 +0100
Subject: [dev-context] new beta
In-Reply-To: <4F2FA5D8.8020804@wxs.nl>
References: <4F2C4F82.9040600@wxs.nl>
	<CAG5iGsDw1dtU8kQ9SkF-hNM3JrseZf0O2PYZjuiBg=4rDd0VzA@mail.gmail.com>
	<4F2FA5D8.8020804@wxs.nl>
Message-ID: <CAG5iGsAJ=7912WMRcw4cujo65Yo_TOCiBTuFYBMwO5fFvvZsgQ@mail.gmail.com>

On Mon, Feb 6, 2012 at 11:05 AM, Hans Hagen <pragma at wxs.nl> wrote:
> On 6-2-2012 09:57, luigi scarso wrote:
>>
>> On Fri, Feb 3, 2012 at 10:20 PM, Hans Hagen<pragma at wxs.nl> ?wrote:
>>>
>>> Hi,
>>>
>>> I've uploaded a beta to the ftp server. There is some work in progress:
>>>
>>> - otr (page-* files)
>>> - descriptions, enumerations, notes (and their parent: constructions)
>>>
>>> I'm not yet satisfied but it shows where we're heading.
>>>
>>> Hans
>>
>>
>> ! LuaTeX error ...tex/texmf-context/tex/context/base/strc-mar.lua:663:
>> attempt to call field 'savedtitle' (a nil value)
>> stack traceback:
>> ? ? ? ?...tex/texmf-context/tex/context/base/strc-mar.lua:663: in function
>> 'title'
>> ? ? ? ?<main ctx instance>:1: in main chunk.
>>
>> system> ?tex> ?error on line 1 in file xtabl-b.tex: LuaTeX error ?...
>>
>>
>> \sectionheadmarkingtitle ...arks.title("#1","#2")}
>>
>> l.1 \markingcommand{chapter}{li::2}
>>
>> \ctxcommand ...\directlua \zerocount {commands.#1}
>>
>> <argument> ?...rking("chapter","\v!page ","first")}
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? \fi \endgroup
>> \firstofoneargument #1->#1
>>
>> <to be read again>
>> ? ? ? ? ? ? ? ? ? ?}
>>
>
> ? ? ? ?commands.savedlisttitle(tag,listindex,"marking")
> ? ? ? ?commands.savedlisnumber(tag,listindex,"marking")
>
>
>
> -----------------------------------------------------------------
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Hans Hagen | PRAGMA ADE
> ? ? ? ? ? ? ?Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ? ?tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? | www.pragma-pod.nl
> -----------------------------------------------------------------
in strc-not.lua should be

function commands.notetitle(tag,n)
    commands.savedlisttitle(tag,notedata[tag][n])
end
?


-- 
luigi

From luigi.scarso at gmail.com  Mon Feb  6 12:04:48 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 6 Feb 2012 12:04:48 +0100
Subject: [dev-context] \page_one_place_float_text undefined in ftp
In-Reply-To: <4F2C1D49.9010105@wxs.nl>
References: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>
	<4F2C1D49.9010105@wxs.nl>
Message-ID: <CAG5iGsDFUKBk_JUnExrr-tJ-PkZ7YNxgYAH=g5s2yp6XP249qg@mail.gmail.com>

On Fri, Feb 3, 2012 at 6:45 PM, Hans Hagen <pragma at wxs.nl> wrote:
> On 3-2-2012 17:34, luigi scarso wrote:
>>
>> \page_one_place_float_text is undefined in latest ftp
>>
> strc-flt:
>
> \def\page_one_place_float_text[#1]%
> ? ? ^^^^ was strc


! Use of \page_one_place_float_text doesn't match its definition.

system          > tex > error on line 2 in file xtabl-b.tex: Use of  ...


\strc_floats_get_box ...loatmethod \endcsname \fi

\strc_floats_place_packaged_boxes ...oats_get_box
                                                  \global \insidefloatfalse
\strc_floats_finish_placement ...e_packaged_boxes
                                                  \dostoptagged \global \sid...
l.2 ...bottom][width=20pt,height=20pt,factor=fit]}
                                                   \tfx \setupinterlinespace...
<inserted text> ...ntext(t) end end context('}') }

\luat_start_lua_code_indeed ...ua \zerocount {#1}}


-- 
luigi

From pragma at wxs.nl  Tue Feb  7 09:17:54 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 07 Feb 2012 09:17:54 +0100
Subject: [dev-context] \page_one_place_float_text undefined in ftp
In-Reply-To: <CAG5iGsDFUKBk_JUnExrr-tJ-PkZ7YNxgYAH=g5s2yp6XP249qg@mail.gmail.com>
References: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>
	<4F2C1D49.9010105@wxs.nl>
	<CAG5iGsDFUKBk_JUnExrr-tJ-PkZ7YNxgYAH=g5s2yp6XP249qg@mail.gmail.com>
Message-ID: <4F30DE32.5020601@wxs.nl>

On 6-2-2012 12:04, luigi scarso wrote:
> On Fri, Feb 3, 2012 at 6:45 PM, Hans Hagen<pragma at wxs.nl>  wrote:
>> On 3-2-2012 17:34, luigi scarso wrote:
>>>
>>> \page_one_place_float_text is undefined in latest ftp
>>>
>> strc-flt:
>>
>> \def\page_one_place_float_text[#1]%
>>      ^^^^ was strc
>
>
> ! Use of \page_one_place_float_text doesn't match its definition.

example needed


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Tue Feb  7 09:27:35 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 7 Feb 2012 09:27:35 +0100
Subject: [dev-context] \page_one_place_float_text undefined in ftp
In-Reply-To: <4F30DE32.5020601@wxs.nl>
References: <CAG5iGsA_uHrwsxgLrLF37ytUArgT9EWSubsME0JtD8k5=M2v_A@mail.gmail.com>
	<4F2C1D49.9010105@wxs.nl>
	<CAG5iGsDFUKBk_JUnExrr-tJ-PkZ7YNxgYAH=g5s2yp6XP249qg@mail.gmail.com>
	<4F30DE32.5020601@wxs.nl>
Message-ID: <CAG5iGsA11rO8BtjTNo69o2F-uk+ahukXdyT6jmb-RJ47SeCBNA@mail.gmail.com>

On Tue, Feb 7, 2012 at 9:17 AM, Hans Hagen <pragma at wxs.nl> wrote:
> On 6-2-2012 12:04, luigi scarso wrote:
>>
>> On Fri, Feb 3, 2012 at 6:45 PM, Hans Hagen<pragma at wxs.nl> ?wrote:
>>>
>>> On 3-2-2012 17:34, luigi scarso wrote:
>>>>
>>>>
>>>> \page_one_place_float_text is undefined in latest ftp
>>>>
>>> strc-flt:
>>>
>>> \def\page_one_place_float_text[#1]%
>>> ? ? ^^^^ was strc
>>
>>
>>
>> ! Use of \page_one_place_float_text doesn't match its definition.
>
>
> example needed
yes I know, infact I'm still trying to make a small example with xtables.
It's in the middle part of a long document, I've tried to isolate only
the culprit but the error vanish.

-- 
luigi

From wolfgang.schuster at gmail.com  Thu Feb  9 16:56:38 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 9 Feb 2012 16:56:38 +0100
Subject: [dev-context] strc-con.mkvi
Message-ID: <9B4FA186-080F-458F-BCFD-AD1E49C22CA5@gmail.com>

Hi,

shouldn?t these values be global?

\def\strc_constructions_register_yes[#1][#2]% #1=interfaced-settings, #2=optional user data
  {\begingroup                              % similar to structure so we might generalize this
   ...
   \ifnoconstructioncaption % then why analyze anyway?
     \endgroup
-    \let\currentconstructionlistnumber \relax
-    \let\currentconstructionsynchronize\relax
-    \let\currentconstructionattribute  \relax
+    \glet\currentconstructionlistnumber \relax
+    \glet\currentconstructionsynchronize\relax
+    \glet\currentconstructionattribute  \relax
   \else
   ...
   % \writestatus{constructions}{registering \currentconstruction: \number\scratchcounter}%
     \normalexpanded{%
       \endgroup
-      \edef\noexpand\currentconstructionlistentry  {\the\scratchcounter}%
-      \edef\noexpand\currentconstructionattribute  {\ctxcommand    {setinternalreference("\referenceprefix","\currentconstructionreference",\nextinternalreference,"\interactionparameter\c!focus")}}%
-      \edef\noexpand\currentconstructionsynchronize{\ctxlatecommand{enhancelist(\the\scratchcounter)}}%
+      \xdef\noexpand\currentconstructionlistentry  {\the\scratchcounter}%
+      \xdef\noexpand\currentconstructionattribute  {\ctxcommand    {setinternalreference("\referenceprefix","\currentconstructionreference",\nextinternalreference,"\interactionparameter\c!focus")}}%
+      \xdef\noexpand\currentconstructionsynchronize{\ctxlatecommand{enhancelist(\the\scratchcounter)}}%
     }%
   \fi}

Wolfang

From pragma at wxs.nl  Thu Feb  9 19:28:02 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 09 Feb 2012 19:28:02 +0100
Subject: [dev-context] strc-con.mkvi
In-Reply-To: <9B4FA186-080F-458F-BCFD-AD1E49C22CA5@gmail.com>
References: <9B4FA186-080F-458F-BCFD-AD1E49C22CA5@gmail.com>
Message-ID: <4F341032.6070302@wxs.nl>

On 9-2-2012 16:56, Wolfgang Schuster wrote:
> Hi,
>
> shouldn?t these values be global?
>
> \def\strc_constructions_register_yes[#1][#2]% #1=interfaced-settings, #2=optional user data
>    {\begingroup                              % similar to structure so we might generalize this
>     ...
>     \ifnoconstructioncaption % then why analyze anyway?
>       \endgroup
> -    \let\currentconstructionlistnumber \relax
> -    \let\currentconstructionsynchronize\relax
> -    \let\currentconstructionattribute  \relax
> +    \glet\currentconstructionlistnumber \relax
> +    \glet\currentconstructionsynchronize\relax
> +    \glet\currentconstructionattribute  \relax
>     \else
>     ...
>     % \writestatus{constructions}{registering \currentconstruction: \number\scratchcounter}%
>       \normalexpanded{%
>         \endgroup
> -      \edef\noexpand\currentconstructionlistentry  {\the\scratchcounter}%
> -      \edef\noexpand\currentconstructionattribute  {\ctxcommand    {setinternalreference("\referenceprefix","\currentconstructionreference",\nextinternalreference,"\interactionparameter\c!focus")}}%
> -      \edef\noexpand\currentconstructionsynchronize{\ctxlatecommand{enhancelist(\the\scratchcounter)}}%
> +      \xdef\noexpand\currentconstructionlistentry  {\the\scratchcounter}%
> +      \xdef\noexpand\currentconstructionattribute  {\ctxcommand    {setinternalreference("\referenceprefix","\currentconstructionreference",\nextinternalreference,"\interactionparameter\c!focus")}}%
> +      \xdef\noexpand\currentconstructionsynchronize{\ctxlatecommand{enhancelist(\the\scratchcounter)}}%
>       }%
>     \fi}

actually i wanted them to be local ... (but they need to be 
inititalized, so (this morning) i added this before the macro:

\let\currentconstructionlistnumber \!!zerocount
\let\currentconstructionsynchronize\relax
\let\currentconstructionattribute  \attributeunsetvalue

in order to prevent messages (new beta later as there has been another fix)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Feb  9 19:32:44 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 9 Feb 2012 19:32:44 +0100
Subject: [dev-context] strc-not.mkvi
Message-ID: <1B7AB098-85D8-440D-9D86-8C010BCB3C8B@googlemail.com>

Hi,

the command ?\strc_constructions_initialize\currentnote? is here necessary to ensure \currentconstructionhandler etc. are set when \strc_constructions_stored_start is called.

\def\handlenoteitself#1#2% tg, id
  {\edef\currentnote{#1}%
   \edef\currentnotenumber{#2}%
   \edef\currentconstructionlistentry{\ctxlua{tex.write(structures.notes.listindex("#1",#2))}}% index in list cache
   % as we can have collected notes (e.g. in tables) we need to recover
   % \currentdescriptionattribute and \currentdescriptionsynchronize
   %
  %\reinstateconstructionnumberentry\currentconstructionlistentry % we could store the number in the entry
   %
   \dontcomplain
%  \begingroup
   \strc_notes_interaction_check_display
   \strc_notes_set_reference_attribute_text
+  \strc_constructions_initialize\currentnote
   \strc_constructions_stored_start
   \begstrut
   \strc_notes_set_destination_attribute_text
   \strc_notes_inject_text
   \endstrut
   \strc_constructions_stored_stop
%  \endgroup
   }

Wolfgang

From pragma at wxs.nl  Thu Feb  9 19:40:47 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 09 Feb 2012 19:40:47 +0100
Subject: [dev-context] strc-not.mkvi
In-Reply-To: <1B7AB098-85D8-440D-9D86-8C010BCB3C8B@googlemail.com>
References: <1B7AB098-85D8-440D-9D86-8C010BCB3C8B@googlemail.com>
Message-ID: <4F34132F.2020105@wxs.nl>

On 9-2-2012 19:32, Wolfgang Schuster wrote:
> Hi,
>
> the command ?\strc_constructions_initialize\currentnote? is here necessary to ensure \currentconstructionhandler etc. are set when \strc_constructions_stored_start is called.
>
> \def\handlenoteitself#1#2% tg, id
>    {\edef\currentnote{#1}%
>     \edef\currentnotenumber{#2}%
>     \edef\currentconstructionlistentry{\ctxlua{tex.write(structures.notes.listindex("#1",#2))}}% index in list cache
>     % as we can have collected notes (e.g. in tables) we need to recover
>     % \currentdescriptionattribute and \currentdescriptionsynchronize
>     %
>    %\reinstateconstructionnumberentry\currentconstructionlistentry % we could store the number in the entry
>     %
>     \dontcomplain
> %  \begingroup
>     \strc_notes_interaction_check_display
>     \strc_notes_set_reference_attribute_text
> +  \strc_constructions_initialize\currentnote
>     \strc_constructions_stored_start
>     \begstrut
>     \strc_notes_set_destination_attribute_text
>     \strc_notes_inject_text
>     \endstrut
>     \strc_constructions_stored_stop
> %  \endgroup
>     }

indeed, and also in an earlier command (and also a move if the increment)

(i'll make a beta .. also with a change in fonts ... x|xx and a|b|c|d 
decoupled so that they can be combined)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Sat Feb 11 16:10:18 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 11 Feb 2012 16:10:18 +0100
Subject: [dev-context] tabl-tbl.mkiv
Message-ID: <C05365A2-077A-407D-8317-3E8B346A01C5@googlemail.com>

Hi,

\def\tabl_start_regular[#1][#2]%
  {%\let\currenttabulationparent\v!tabulate
   \let\currenttabulationparent\empty
   \let\currenttabulation\currenttabulationparent
   \def\p_format{#1}%
   \ifx\p_format\empty
     \def\p_format{|l|p|}%
   \fi
   \lettabulationparameter\c!format\p_format
   \ifsecondargument
-    \getcurrenttabulationparameters[#2]%
+    \setupcurrenttabulation[#2]%
   \fi
   \tabl_tabulate_start_building}

Wolfgang

From luigi.scarso at gmail.com  Mon Feb 13 18:06:22 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 13 Feb 2012 18:06:22 +0100
Subject: [dev-context] back-exp.mkiv
Message-ID: <CAG5iGsCK99aZeu=sfd-VH7RBfdsK+cbRrNs=H+ab1=FGDiEbLQ@mail.gmail.com>

\appendtoks
   %\def\dotagcombination{\taggedctxcommand{settagcombination(\combinationparameter\c!nx,\combinationparameter\c!ny)}}%
    \unexpanded\def\dotagcombination{\taggedctxcommand{settagcombination(\number\horcombination,\number\totcombination)}}%
\to \everyenableelements

should be

\appendtoks
   \def\dotagcombination{\taggedctxcommand{settagcombination(\combinationparameter\c!nx,\combinationparameter\c!ny)}}%
   % \unexpanded\def\dotagcombination{\taggedctxcommand{settagcombination(\number\horcombination,\number\totcombination)}}%
\to \everyenableelements


-- 
luigi

From wolfgang.schuster at gmail.com  Mon Feb 13 22:10:05 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 13 Feb 2012 22:10:05 +0100
Subject: [dev-context] spac-ali.mkiv
Message-ID: <F1C89FFD-27AA-4B09-9BFE-985A9C35DAFD@gmail.com>

Hi,

these two options can be removed because MkIV has no \enablespacehandling and \enablekernhandling commands.

\setvalue{\??aligncommand\v!spacing        }{\t_spac_align_collected\expandafter{\the\t_spac_align_collected\enablespacehandling \enablekernhandling }}
\setvalue{\??aligncommand\v!nospacing      }{\t_spac_align_collected\expandafter{\the\t_spac_align_collected\disablespacehandling\disablekernhandling}}

Wolfgang

From schuster.wolfgang at googlemail.com  Mon Feb 13 22:21:10 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 13 Feb 2012 22:21:10 +0100
Subject: [dev-context] spac-ali.mkiv
Message-ID: <9096157E-B3DD-4D18-ACEE-5686B65F87F9@googlemail.com>

Hi,

\unexpanded\def\usealignparameter#1% faster local variant
  {\edef\m_spac_align{#1\c!align}%
-  \ifx\m_spac_align\else
+  \ifx\m_spac_align\empty\else
     \expandafter\let\expandafter\raggedcommand\csname\??alignmentnormalcache\m_spac_align\endcsname
     \ifx\raggedcommand\relax
       \spac_align_add_to_cache\m_spac_align
     \else
       \expandafter\let\expandafter\updateraggedskips\csname\??alignmentraggedcache\m_spac_align\endcsname
     \fi
     \raggedcommand
   \fi}

Wolfgang

From schuster.wolfgang at googlemail.com  Tue Feb 14 23:16:08 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 14 Feb 2012 23:16:08 +0100
Subject: [dev-context] page-brk.mkiv
Message-ID: <DCCA9F99-F509-4DC0-ACE2-77D23B94FD29@googlemail.com>

Hi,

\def\page_tests_test[#1][#2]% don't change, only add more methods
  {\relax % needed before \if
   \ifconditional\c_page_breaks_enabled
     % new from here
     \ifcase\testpagetrigger
       \endgraf
     \or\ifvmode
       \dosomebreak\allowbreak
     \else % indeed?
       \vadjust{\allowbreak}%
       \endgraf
     \fi\fi
     % till here
     \ifdim\pagegoal<\maxdimen \relax
       \ifdim\pagetotal<\pagegoal \relax
         \d_page_tests_test\dimexpr
            #1\lineheight
           +\pagetotal
           \ifdim\lastskip<\parskip+\parskip\fi
-          \ifthirdargument+#2\fi
+          \ifsecondargument+#2\fi
         \relax
         \ifcase\testpagemethod
           \ifdim\d_page_tests_test>.99\pagegoal
             \penalty-\plustenthousand
           \fi
         \or
           \ifdim\dimexpr\d_page_tests_test-\pagegoal\relax>-\lineheight
             \penalty-\plustenthousand
           \fi
         \or
           \getnoflines\pagegoal
           \ifdim\dimexpr\d_page_tests_test-\noflines\lineheight\relax>-\lineheight
             \penalty-\plustenthousand
           \fi
         \or % same as 0 but more accurate
           \ifdim\dimexpr\d_page_tests_test-10\scaledpoint\relax>\pagegoal
             \penalty-\plustenthousand
           \fi
         \fi
       \else\ifnum\c_page_tests_mode=\plusthree
         \page_tests_flush_so_far
       \fi\fi
     \else\ifnum\c_page_tests_mode=\plusone
       \goodbreak
     \fi\fi
   \else
     \endgraf
   \fi}

Wolfgang

From schuster.wolfgang at googlemail.com  Fri Feb 17 10:35:27 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 17 Feb 2012 10:35:27 +0100
Subject: [dev-context] back-exp.mkiv
Message-ID: <95ADC4B4-5CA6-414E-8C00-8D36AD6DCDD1@googlemail.com>

Hi,

\appendtoks
-   \unexpanded\def\dotagtabulatecell  {\taggedctxcommand{settagtabulatecell(\number\tabulatealign)}}%
+   \unexpanded\def\dotagtabulatecell  {\taggedctxcommand{settagtabulatecell(\number\c_tabl_tabulate_align)}}%
    \unexpanded\def\dotagtabulatesignal{\dontleavehmode\char\zerocount\ignorespaces}%
\to \everyenableelements

Wolfgang

From luigi.scarso at gmail.com  Fri Feb 17 14:55:56 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2012 14:55:56 +0100
Subject: [dev-context] strc-tag.mkiv
Message-ID: <CAG5iGsAdFXZzhguXo5LOX=bYP-BfNTZxX3JwNQ-Zn30Riw1izQ@mail.gmail.com>

Maybe

\unexpanded\def\strc_tags_element_start_yes_indeed
  {\iftrialtypesetting
     \expandafter\strc_tags_element_start_yes_indeed_yes
   \else
     \expandafter\strc_tags_element_start_nop_indeed
   \fi}

\unexpanded\def\strc_tags_element_stop
  {\iftrialtypesetting
     \expandafter\strc_tags_element_stop_yes
   \else
     \expandafter\strc_tags_element_stop_nop
   \fi}


should be

\unexpanded\def\strc_tags_element_start_yes_indeed
  {\iftrialtypesetting
    \expandafter\strc_tags_element_start_nop_indeed
   \else
     \expandafter\strc_tags_element_start_yes_indeed_yes
   \fi}

\unexpanded\def\strc_tags_element_stop
  {\iftrialtypesetting
     \expandafter\strc_tags_element_stop_nop
   \else
     \expandafter\strc_tags_element_stop_yes
   \fi}


?

-- 
luigi

From pragma at wxs.nl  Fri Feb 17 15:06:02 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 17 Feb 2012 15:06:02 +0100
Subject: [dev-context] strc-tag.mkiv
In-Reply-To: <CAG5iGsAdFXZzhguXo5LOX=bYP-BfNTZxX3JwNQ-Zn30Riw1izQ@mail.gmail.com>
References: <CAG5iGsAdFXZzhguXo5LOX=bYP-BfNTZxX3JwNQ-Zn30Riw1izQ@mail.gmail.com>
Message-ID: <4F3E5ECA.1090108@wxs.nl>

On 17-2-2012 14:55, luigi scarso wrote:
> Maybe
>
> \unexpanded\def\strc_tags_element_start_yes_indeed
>    {\iftrialtypesetting
>       \expandafter\strc_tags_element_start_yes_indeed_yes
>     \else
>       \expandafter\strc_tags_element_start_nop_indeed
>     \fi}
>
> \unexpanded\def\strc_tags_element_stop
>    {\iftrialtypesetting
>       \expandafter\strc_tags_element_stop_yes
>     \else
>       \expandafter\strc_tags_element_stop_nop
>     \fi}

maybe_indeed -)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Fri Feb 17 15:46:33 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2012 15:46:33 +0100
Subject: [dev-context] strc-tag.mkiv
In-Reply-To: <4F3E5ECA.1090108@wxs.nl>
References: <CAG5iGsAdFXZzhguXo5LOX=bYP-BfNTZxX3JwNQ-Zn30Riw1izQ@mail.gmail.com>
	<4F3E5ECA.1090108@wxs.nl>
Message-ID: <CAG5iGsAHUGN4cUmz2LmZJ0LpExDvTj70A_cMVyn9R08kusneeQ@mail.gmail.com>

On Fri, Feb 17, 2012 at 3:06 PM, Hans Hagen <pragma at wxs.nl> wrote:
> On 17-2-2012 14:55, luigi scarso wrote:
>>
>> Maybe
>>
>> \unexpanded\def\strc_tags_element_start_yes_indeed
>> ? {\iftrialtypesetting
>> ? ? ?\expandafter\strc_tags_element_start_yes_indeed_yes
>> ? ?\else
>> ? ? ?\expandafter\strc_tags_element_start_nop_indeed
>> ? ?\fi}
>>
>> \unexpanded\def\strc_tags_element_stop
>> ? {\iftrialtypesetting
>> ? ? ?\expandafter\strc_tags_element_stop_yes
>> ? ?\else
>> ? ? ?\expandafter\strc_tags_element_stop_nop
>> ? ?\fi}
>
>
> maybe_indeed -)
or
maybe_yes
?

-- 
luigi

From pragma at wxs.nl  Fri Feb 17 15:53:31 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 17 Feb 2012 15:53:31 +0100
Subject: [dev-context] strc-tag.mkiv
In-Reply-To: <CAG5iGsAHUGN4cUmz2LmZJ0LpExDvTj70A_cMVyn9R08kusneeQ@mail.gmail.com>
References: <CAG5iGsAdFXZzhguXo5LOX=bYP-BfNTZxX3JwNQ-Zn30Riw1izQ@mail.gmail.com>
	<4F3E5ECA.1090108@wxs.nl>
	<CAG5iGsAHUGN4cUmz2LmZJ0LpExDvTj70A_cMVyn9R08kusneeQ@mail.gmail.com>
Message-ID: <4F3E69EB.6070008@wxs.nl>

On 17-2-2012 15:46, luigi scarso wrote:
> On Fri, Feb 17, 2012 at 3:06 PM, Hans Hagen<pragma at wxs.nl>  wrote:
>> On 17-2-2012 14:55, luigi scarso wrote:
>>>
>>> Maybe
>>>
>>> \unexpanded\def\strc_tags_element_start_yes_indeed
>>>    {\iftrialtypesetting
>>>       \expandafter\strc_tags_element_start_yes_indeed_yes
>>>     \else
>>>       \expandafter\strc_tags_element_start_nop_indeed
>>>     \fi}
>>>
>>> \unexpanded\def\strc_tags_element_stop
>>>    {\iftrialtypesetting
>>>       \expandafter\strc_tags_element_stop_yes
>>>     \else
>>>       \expandafter\strc_tags_element_stop_nop
>>>     \fi}
>>
>>
>> maybe_indeed -)
> or
> maybe_yes

I bet that you know the answer (as you tested it) .. next beta is coming.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From sbbrouwer at gmail.com  Mon Feb 20 18:12:38 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Mon, 20 Feb 2012 18:12:38 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
	and fails on odd pages
Message-ID: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>

Dear devs,

When I try to use \startalignment[outer], it fails when one of the
following is true:

* the command is invoked on an odd-numbered page, or
* \setuppagenumbering[alternative=doublesided] was not called first.

Regarding the second point, the bug is that I believe
\setuplayout[location=doublesided] also ought to work, but doesn't.

I get the same "! undefined control sequence" error message in all
cases; the error message and a minimal *working* example are
reproduced below, with comments showing how to break the working
example.

Cheers,

Sietse

--------------begin error text--------------
<argument> \c_spac_align_state_horizontal_left

\firstoftwoarguments #1#2->#1

\spac_align_flush_horizontal ..._horizontal_right
                                                 \or \ifcase \c_spac_align_...
\spac_align_add_to_cache ...lign_flush_horizontal
                                                 \spac_align_flush_vertical...
\spac_align_setup ...\spac_align_add_to_cache {#1}
--------------end error text--------------

--------------self-contained example that does not fail--------------------
\setuppapersize[A9] % not required

% FAILURE POINT #1
% remove the following line to induce failure
\setuppagenumbering[alternative=doublesided]

% This line ought to work instead of the setuppagenumbering line,
% but it doesn't.
%\setuplayout[location=doublesided]

\showframe % not required

\starttext
% FAILURE POINT #2
% To induce failure by pushing startalignment onto an odd page,
% remove the next line or, alternatively, duplicate it.
Page 1 \page[yes]

\startalignment[outer] % must be on even page!
Page 2
\page[yes]
Page 3
\stopalignment

\stoptext
--------------------end example that does not fail------------------------

--
Sietse Brouwer -- sbbrouwer at gmail.com -- +31 6 13.456.848
Verlengde Wassenaarseweg 4a -- 2342 BG Oegstgeest -- the Netherlands
MSN: sietse at gawab.com -- ICQ: 341232104

From schuster.wolfgang at googlemail.com  Mon Feb 20 19:54:35 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 20 Feb 2012 19:54:35 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
	and fails on odd pages
In-Reply-To: <CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
References: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>
	<98F9FFDC-1D36-4D50-8945-9AB7F6EE84B9@googlemail.com>
	<CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
Message-ID: <3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>


Am 20.02.2012 um 19:43 schrieb Sietse Brouwer:

> Hi Wolfgang,
> 
> I tried making that alteration in
> /opt/context/tex/texmf-context/tex/context/base/spac-ali.mkiv ,
> but that didn't work. Was merely changing that file not enough, or
> should I conclude that this fix does not work?

You have to regenerate the format (context --make en) when you patch a core file.

BTW: The location key for \setuplayout is to position the page on the paper when the have different sizes.

\setuppapersize[A5][A4]

\setuppagenumbering[alternative=doublesided]
\setuplayout       [location=doublesided]

\showframe

\starttext
\dorecurse{12}{\input knuth\par}
\stoptext

Wolfgang

From sbbrouwer at gmail.com  Mon Feb 20 20:28:04 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Mon, 20 Feb 2012 20:28:04 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
 and fails on odd pages
In-Reply-To: <3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>
References: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>
	<98F9FFDC-1D36-4D50-8945-9AB7F6EE84B9@googlemail.com>
	<CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
	<3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>
Message-ID: <CAF=dkzz0ah99r=HSO2RiO_pb8j7f=p9LZpRRQbGkHmgz=ZkQhw@mail.gmail.com>

Sietse Brouwer wrote:
>> I tried making that alteration [see below] in
>> /opt/context/tex/texmf-context/tex/context/base/spac-ali.mkiv ,
>> but that didn't work. Was merely changing that file not enough, or
>> should I conclude that this fix does not work?

Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:
> You have to regenerate the format (context --make en) when you patch a core file.

Just did so. The odd-page-invocations still fail. Does it work on your end?

As an aside, on the page [[Running Mark IV]] the wiki says
"Starting with 2011, formats are automatically (re)generated by
`context myfile.tex` when it believes it is necessary to do so.", so
perhaps the format does not need to be manually regenerated. But
that's not relevant to this bug, directly.

> BTW: The location key for \setuplayout is to position the page on the paper when the have different sizes.
Ah, so doublesided typesetting is activated from \setuppagenumbering,
not from \setuplayout? Thanks for the tip.

Cheers,

Sietse

> \setuppapersize[A5][A4]
>
> \setuppagenumbering[alternative=doublesided]
> \setuplayout ? ? ? [location=doublesided]
>
> \showframe
>
> \starttext
> \dorecurse{12}{\input knuth\par}
> \stoptext
>
> Wolfgang

(Reproducing here the patch Wolfgang sent me, as it didn't go to the
list the first time.)

\def\spac_align_flush_horizontal
  {\ifcase\c_spac_align_state_horizontal
     % 0
     \spac_align_set_horizontal_none
   \or
     % 1 center
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_center
     \or
       \spac_align_set_horizontal_very_center
     \or
       \spac_align_set_horizontal_wide_center
     \fi
   \or
     % 2 flush left
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_right
     \else
       \spac_align_set_horizontal_very_right
     \fi
   \or
     % 3 flush right
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_left
     \else
       \spac_align_set_horizontal_very_left
     \fi
   \or
     % 4 inner
     \ifdoublesided
       \signalinnerrealign
     \fi
     \rightorleftpageaction\spac_align_set_horizontal_right\spac_align_set_horizontal_left
   \or
     % 5 outer
     \ifdoublesided
       \signalouterrealign
     \fi
 -    \rightorleftpageaction\c_spac_align_state_horizontal_left\spac_align_set_horizontal_right
 +    \rightorleftpageaction\spac_align_state_horizontal_left\spac_align_set_horizontal_right
   \or
     % 6 oneliner
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_right
     \else
       \spac_align_set_horizontal_very_right
     \fi
     \parfillskip\zeropoint
   \or
     % 7 centered last line
     \spac_align_set_horizontal_centered_last_line
   \fi}

From schuster.wolfgang at googlemail.com  Mon Feb 20 20:36:47 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 20 Feb 2012 20:36:47 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
	and fails on odd pages
In-Reply-To: <CAF=dkzz0ah99r=HSO2RiO_pb8j7f=p9LZpRRQbGkHmgz=ZkQhw@mail.gmail.com>
References: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>
	<98F9FFDC-1D36-4D50-8945-9AB7F6EE84B9@googlemail.com>
	<CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
	<3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>
	<CAF=dkzz0ah99r=HSO2RiO_pb8j7f=p9LZpRRQbGkHmgz=ZkQhw@mail.gmail.com>
Message-ID: <EAA96D28-9819-44B1-96C4-5882B329584E@googlemail.com>


Am 20.02.2012 um 20:28 schrieb Sietse Brouwer:

> Sietse Brouwer wrote:
>>> I tried making that alteration [see below] in
>>> /opt/context/tex/texmf-context/tex/context/base/spac-ali.mkiv ,
>>> but that didn't work. Was merely changing that file not enough, or
>>> should I conclude that this fix does not work?
> 
> Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:
>> You have to regenerate the format (context --make en) when you patch a core file.
> 
> Just did so. The odd-page-invocations still fail. Does it work on your end?

There was a typo, this works:

\def\spac_align_flush_horizontal
  {\ifcase\c_spac_align_state_horizontal
     % 0
     \spac_align_set_horizontal_none
   \or
     % 1 center
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_center
     \or
       \spac_align_set_horizontal_very_center
     \or
       \spac_align_set_horizontal_wide_center
     \fi
   \or
     % 2 flush left
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_right
     \else
       \spac_align_set_horizontal_very_right
     \fi
   \or
     % 3 flush right
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_left
     \else
       \spac_align_set_horizontal_very_left
     \fi
   \or
     % 4 inner
     \ifdoublesided
       \signalinnerrealign
     \fi
     \rightorleftpageaction\spac_align_set_horizontal_right\spac_align_set_horizontal_left
   \or
     % 5 outer
     \ifdoublesided
       \signalouterrealign
     \fi
    %\rightorleftpageaction\c_spac_align_state_horizontal_left\spac_align_set_horizontal_right
     \rightorleftpageaction\spac_align_set_horizontal_left\spac_align_set_horizontal_right
   \or
     % 6 oneliner
     \ifcase\c_spac_align_state_broad
       \spac_align_set_horizontal_right
     \else
       \spac_align_set_horizontal_very_right
     \fi
     \parfillskip\zeropoint
   \or
     % 7 centered last line
     \spac_align_set_horizontal_centered_last_line
   \fi}

> As an aside, on the page [[Running Mark IV]] the wiki says
> "Starting with 2011, formats are automatically (re)generated by
> `context myfile.tex` when it believes it is necessary to do so.", so
> perhaps the format does not need to be manually regenerated. But
> that's not relevant to this bug, directly.

The format is only auto generated when the version number is incremented
which does happen when Hans releases a new beta/current but not when
you change files.

>> BTW: The location key for \setuplayout is to position the page on the paper when the have different sizes.
> Ah, so doublesided typesetting is activated from \setuppagenumbering,
> not from \setuplayout? Thanks for the tip.

Yes, you need \setuppagenumbering to select between single- and doublesided document.

Wolfgang

From sbbrouwer at gmail.com  Mon Feb 20 20:52:44 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Mon, 20 Feb 2012 20:52:44 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
 and fails on odd pages
In-Reply-To: <EAA96D28-9819-44B1-96C4-5882B329584E@googlemail.com>
References: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>
	<98F9FFDC-1D36-4D50-8945-9AB7F6EE84B9@googlemail.com>
	<CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
	<3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>
	<CAF=dkzz0ah99r=HSO2RiO_pb8j7f=p9LZpRRQbGkHmgz=ZkQhw@mail.gmail.com>
	<EAA96D28-9819-44B1-96C4-5882B329584E@googlemail.com>
Message-ID: <CAF=dkzw6bXMn-1K93JQw2i0NRxb2a_LRWnmkfZ+TYSnxo22YbA@mail.gmail.com>

Wolfgang Schuster wrote:
> There was a typo, this works:

Marvellous, it works indeed. Thank you for your help.

> The format is only auto generated when the version number is incremented
> which does happen when Hans releases a new beta/current but not when
> you change files.

Okay, I've added that to the wiki.

>>> BTW: The location key for \setuplayout is to position the page on the paper when the have different sizes.
>> Ah, so doublesided typesetting is activated from \setuppagenumbering,
>> not from \setuplayout? Thanks for the tip.
>
> Yes, you need \setuppagenumbering to select between single- and doublesided document.

Thanks. Looking through the wiki for a place to mention that (or/and a
place that is already mentioned.)

Thank you very much for your help!

Kind regards,

Sietse

From pragma at wxs.nl  Tue Feb 21 10:43:04 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 21 Feb 2012 10:43:04 +0100
Subject: [dev-context] Bugs: align[outer] requires setuppagenumbering,
 and fails on odd pages
In-Reply-To: <CAF=dkzw6bXMn-1K93JQw2i0NRxb2a_LRWnmkfZ+TYSnxo22YbA@mail.gmail.com>
References: <CAF=dkzw+i3MYx0me3edpQJx-HWSWpcT1VzMOmN0Ovhrkxj9TTA@mail.gmail.com>
	<98F9FFDC-1D36-4D50-8945-9AB7F6EE84B9@googlemail.com>
	<CAF=dkzwvkkRTx02djwVGO5Vi-kzkx3qFR=uac+Qy6w-oSGpdZg@mail.gmail.com>
	<3C1DB6D5-2387-4B9D-AF1D-F937BB1E1D08@googlemail.com>
	<CAF=dkzz0ah99r=HSO2RiO_pb8j7f=p9LZpRRQbGkHmgz=ZkQhw@mail.gmail.com>
	<EAA96D28-9819-44B1-96C4-5882B329584E@googlemail.com>
	<CAF=dkzw6bXMn-1K93JQw2i0NRxb2a_LRWnmkfZ+TYSnxo22YbA@mail.gmail.com>
Message-ID: <4F436728.9090203@wxs.nl>

On 20-2-2012 20:52, Sietse Brouwer wrote:
> Wolfgang Schuster wrote:
>> There was a typo, this works:
>
> Marvellous, it works indeed. Thank you for your help.
>
>> The format is only auto generated when the version number is incremented
>> which does happen when Hans releases a new beta/current but not when
>> you change files.
>
> Okay, I've added that to the wiki.

If really needed, you can trigger automake with:

context --expert --touch

(after all, that is how I jump the version)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Feb 23 21:15:04 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 23 Feb 2012 21:15:04 +0100
Subject: [dev-context] Customized list alternative with hyperlinks
Message-ID: <0208DE16-8ACD-4056-88B7-4ADCB064EBD4@googlemail.com>

Hi Hans,

can you add the following list alternative to strc-lst.mkvi

\def\v!interactive{interactive}

\definelistalternative
  [\v!interactive]
  [\c!renderingsetup=\??listrenderings:interactive]

\startsetups[\??listrenderings:interactive]
   \edef\p_command{\listalternativeparameter\c!command}%
   \ifx\p_command\empty
       [\currentlist: \currentlistentrynumber\space -- \currentlistentrytitle\space -- \currentlistentrypagenumber]%
   \else
       \listparameter\c!before
       \hbox \strc_lists_get_reference_attribute\v!all \strc_lists_get_destination_attribute {
           \p_command\currentlistentrynumber\currentlistentrytitle\currentlistentrypagenumber
       }
       \listparameter\c!after
   \fi
\stopsetups

This is ?alternative=command? with hyperlink functionality, I know ?horizontal? and ?vertical? do the same
when a command is applied but I think this variant is better when no command is set.

Wolfgang

From luigi.scarso at gmail.com  Fri Feb 24 13:06:32 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 24 Feb 2012 13:06:32 +0100
Subject: [dev-context] problems with xtable and export xhtml
Message-ID: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>

It seems that xtable doesn't export @rows and @columns
This patch to tabl-xtb.mkvi works, not sure if it is a good style.

\unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
  {\dostarttagged\t!tablecell\empty % can't we just tag the box
   \setbox\b_tabl_x\hbox\bgroup
   \setupcurrentxtable[#settings]
   \letxtableparameter\c!width \d_tabl_x_width  % overloads given width
   \letxtableparameter\c!height\d_tabl_x_height % overloads given height
   \ctxcommand{x_table_init_construct()}%
   \inheritedxtableframed\bgroup
   \tabl_x_begin_of_cell
   \def\tablecellcolumns{%
      \ifnum\csname \m_mult_interfaces_namespace nx\endcsname>\csname
\m_mult_interfaces_namespace nc\endcsname%
        \csname \m_mult_interfaces_namespace nx\endcsname%
      \else
        \csname \m_mult_interfaces_namespace nc\endcsname%
      \fi}%
   \def\tablecellrows{%
     \ifnum\csname \m_mult_interfaces_namespace ny\endcsname>\csname
\m_mult_interfaces_namespace nr\endcsname%
       \csname \m_mult_interfaces_namespace ny\endcsname%
     \else
       \csname \m_mult_interfaces_namespace nr\endcsname%
     \fi}
   \dotagxtablecell}


-- 
luigi

From luigi.scarso at gmail.com  Fri Feb 24 16:12:27 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 24 Feb 2012 16:12:27 +0100
Subject: [dev-context] problems with xtable and export xhtml
In-Reply-To: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
References: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
Message-ID: <CAG5iGsCVBTO4_AGi0vVCAYLxdctYOCOgXMqziRHHYw2PJs8-Lg@mail.gmail.com>

On Fri, Feb 24, 2012 at 1:06 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> It seems that xtable doesn't export @rows and @columns
> This patch to tabl-xtb.mkvi works, not sure if it is a good style.
>
> \unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
> ?{\dostarttagged\t!tablecell\empty % can't we just tag the box
> ? \setbox\b_tabl_x\hbox\bgroup
> ? \setupcurrentxtable[#settings]
> ? \letxtableparameter\c!width \d_tabl_x_width ?% overloads given width
> ? \letxtableparameter\c!height\d_tabl_x_height % overloads given height
> ? \ctxcommand{x_table_init_construct()}%
> ? \inheritedxtableframed\bgroup
> ? \tabl_x_begin_of_cell
> ? \def\tablecellcolumns{%
> ? ? ?\ifnum\csname \m_mult_interfaces_namespace nx\endcsname>\csname
> \m_mult_interfaces_namespace nc\endcsname%
> ? ? ? ?\csname \m_mult_interfaces_namespace nx\endcsname%
> ? ? ?\else
> ? ? ? ?\csname \m_mult_interfaces_namespace nc\endcsname%
> ? ? ?\fi}%
> ? \def\tablecellrows{%
> ? ? \ifnum\csname \m_mult_interfaces_namespace ny\endcsname>\csname
> \m_mult_interfaces_namespace nr\endcsname%
> ? ? ? \csname \m_mult_interfaces_namespace ny\endcsname%
> ? ? \else
> ? ? ? \csname \m_mult_interfaces_namespace nr\endcsname%
> ? ? \fi}
> ? \dotagxtablecell}
Hm, no it's wrong .

-- 
luigi

From schuster.wolfgang at googlemail.com  Fri Feb 24 16:40:21 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 24 Feb 2012 16:40:21 +0100
Subject: [dev-context] problems with xtable and export xhtml
In-Reply-To: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
References: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
Message-ID: <17C8A182-90EE-49F7-A6E1-A19AAE66A5A7@googlemail.com>


Am 24.02.2012 um 13:06 schrieb luigi scarso:

> It seems that xtable doesn't export @rows and @columns
> This patch to tabl-xtb.mkvi works, not sure if it is a good style.
> 
> \unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
>  {\dostarttagged\t!tablecell\empty % can't we just tag the box
>   \setbox\b_tabl_x\hbox\bgroup
>   \setupcurrentxtable[#settings]
>   \letxtableparameter\c!width \d_tabl_x_width  % overloads given width
>   \letxtableparameter\c!height\d_tabl_x_height % overloads given height
>   \ctxcommand{x_table_init_construct()}%
>   \inheritedxtableframed\bgroup
>   \tabl_x_begin_of_cell
>   \def\tablecellcolumns{%
>      \ifnum\csname \m_mult_interfaces_namespace nx\endcsname>\csname
> \m_mult_interfaces_namespace nc\endcsname%
>        \csname \m_mult_interfaces_namespace nx\endcsname%
>      \else
>        \csname \m_mult_interfaces_namespace nc\endcsname%
>      \fi}%
>   \def\tablecellrows{%
>     \ifnum\csname \m_mult_interfaces_namespace ny\endcsname>\csname
> \m_mult_interfaces_namespace nr\endcsname%
>       \csname \m_mult_interfaces_namespace ny\endcsname%
>     \else
>       \csname \m_mult_interfaces_namespace nr\endcsname%
>     \fi}
>   \dotagxtablecell}


You need this

\appendtoks
   %\def\dotagxtablecell  {\taggedctxcommand{settagtablecell(\number\tablecellrows,\number\tablecellcolumns,\number\raggedstatus)}}%
    \def\dotagxtablecell  {\taggedctxcommand{settagtablecell(\number\c_tabl_x_nx,\number\c_tabl_x_ny,\number\raggedstatus)}}%
    \def\dotagxtablesignal{\char\zerocount}% not used
\to \everyenableelements

and this change

%\unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
%  {\dostarttagged\t!tablecell\empty % can't we just tag the box
%   \setbox\b_tabl_x\hbox\bgroup
%   \setupcurrentxtable[#settings]%
%   \letxtableparameter\c!width \d_tabl_x_width  % overloads given width
%   \letxtableparameter\c!height\d_tabl_x_height % overloads given height
%   \ctxcommand{x_table_init_construct()}%
%   \inheritedxtableframed\bgroup
%   \tabl_x_begin_of_cell
%   \dotagxtablecell}

\unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
  {\dostarttagged\t!tablecell\empty % can't we just tag the box
   \setbox\b_tabl_x\hbox\bgroup
   %
   \letxtableparameter\c!nx\plusone
   \letxtableparameter\c!ny\plusone
   \letxtableparameter\c!nc\plusone
   \letxtableparameter\c!nr\plusone
   %
   \setupcurrentxtable[#settings]%
   %
   \c_tabl_x_nx\directxtableparameter\c!nc\relax
   \c_tabl_x_ny\directxtableparameter\c!nr\relax
   \ifnum\c_tabl_x_nx=\plusone
     \c_tabl_x_nx\directxtableparameter\c!nx\relax
   \fi
   \ifnum\c_tabl_x_ny=\plusone
     \c_tabl_x_ny\directxtableparameter\c!ny\relax
   \fi
   %
   \letxtableparameter\c!width \d_tabl_x_width  % overloads given width
   \letxtableparameter\c!height\d_tabl_x_height % overloads given height
   \ctxcommand{x_table_init_construct()}%
   \inheritedxtableframed\bgroup
   \tabl_x_begin_of_cell
   \dotagxtablecell}

Wolfgang

From luigi.scarso at gmail.com  Fri Feb 24 16:45:06 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 24 Feb 2012 16:45:06 +0100
Subject: [dev-context] problems with xtable and export xhtml
In-Reply-To: <17C8A182-90EE-49F7-A6E1-A19AAE66A5A7@googlemail.com>
References: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
	<17C8A182-90EE-49F7-A6E1-A19AAE66A5A7@googlemail.com>
Message-ID: <CAG5iGsA-1qJw0QnB+h+jT7e1aMfuKn9bAbGm1Y-RVPe8YUXDQA@mail.gmail.com>

On Fri, Feb 24, 2012 at 4:40 PM, Wolfgang Schuster
<schuster.wolfgang at googlemail.com> wrote:
>
> Am 24.02.2012 um 13:06 schrieb luigi scarso:
>
>> It seems that xtable doesn't export @rows and @columns
>> This patch to tabl-xtb.mkvi works, not sure if it is a good style.
>>
>> \unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
>> ?{\dostarttagged\t!tablecell\empty % can't we just tag the box
>> ? \setbox\b_tabl_x\hbox\bgroup
>> ? \setupcurrentxtable[#settings]
>> ? \letxtableparameter\c!width \d_tabl_x_width ?% overloads given width
>> ? \letxtableparameter\c!height\d_tabl_x_height % overloads given height
>> ? \ctxcommand{x_table_init_construct()}%
>> ? \inheritedxtableframed\bgroup
>> ? \tabl_x_begin_of_cell
>> ? \def\tablecellcolumns{%
>> ? ? ?\ifnum\csname \m_mult_interfaces_namespace nx\endcsname>\csname
>> \m_mult_interfaces_namespace nc\endcsname%
>> ? ? ? ?\csname \m_mult_interfaces_namespace nx\endcsname%
>> ? ? ?\else
>> ? ? ? ?\csname \m_mult_interfaces_namespace nc\endcsname%
>> ? ? ?\fi}%
>> ? \def\tablecellrows{%
>> ? ? \ifnum\csname \m_mult_interfaces_namespace ny\endcsname>\csname
>> \m_mult_interfaces_namespace nr\endcsname%
>> ? ? ? \csname \m_mult_interfaces_namespace ny\endcsname%
>> ? ? \else
>> ? ? ? \csname \m_mult_interfaces_namespace nr\endcsname%
>> ? ? \fi}
>> ? \dotagxtablecell}
>
>
> You need this
>
> \appendtoks
> ? %\def\dotagxtablecell ?{\taggedctxcommand{settagtablecell(\number\tablecellrows,\number\tablecellcolumns,\number\raggedstatus)}}%
> ? ?\def\dotagxtablecell ?{\taggedctxcommand{settagtablecell(\number\c_tabl_x_nx,\number\c_tabl_x_ny,\number\raggedstatus)}}%
> ? ?\def\dotagxtablesignal{\char\zerocount}% not used
> \to \everyenableelements
>
> and this change
>
> %\unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
> % ?{\dostarttagged\t!tablecell\empty % can't we just tag the box
> % ? \setbox\b_tabl_x\hbox\bgroup
> % ? \setupcurrentxtable[#settings]%
> % ? \letxtableparameter\c!width \d_tabl_x_width ?% overloads given width
> % ? \letxtableparameter\c!height\d_tabl_x_height % overloads given height
> % ? \ctxcommand{x_table_init_construct()}%
> % ? \inheritedxtableframed\bgroup
> % ? \tabl_x_begin_of_cell
> % ? \dotagxtablecell}
>
> \unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
> ?{\dostarttagged\t!tablecell\empty % can't we just tag the box
> ? \setbox\b_tabl_x\hbox\bgroup
> ? %
> ? \letxtableparameter\c!nx\plusone
> ? \letxtableparameter\c!ny\plusone
> ? \letxtableparameter\c!nc\plusone
> ? \letxtableparameter\c!nr\plusone
> ? %
> ? \setupcurrentxtable[#settings]%
> ? %
> ? \c_tabl_x_nx\directxtableparameter\c!nc\relax
> ? \c_tabl_x_ny\directxtableparameter\c!nr\relax
> ? \ifnum\c_tabl_x_nx=\plusone
> ? ? \c_tabl_x_nx\directxtableparameter\c!nx\relax
> ? \fi
> ? \ifnum\c_tabl_x_ny=\plusone
> ? ? \c_tabl_x_ny\directxtableparameter\c!ny\relax
> ? \fi
> ? %
> ? \letxtableparameter\c!width \d_tabl_x_width ?% overloads given width
> ? \letxtableparameter\c!height\d_tabl_x_height % overloads given height
> ? \ctxcommand{x_table_init_construct()}%
> ? \inheritedxtableframed\bgroup
> ? \tabl_x_begin_of_cell
> ? \dotagxtablecell}
>
> Wolfgang
yes, I suppose something similar -- I'm checking


-- 
luigi

From schuster.wolfgang at googlemail.com  Fri Feb 24 17:52:58 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 24 Feb 2012 17:52:58 +0100
Subject: [dev-context] \structurevariable
Message-ID: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>

Hi Hans,

the \structurevariable command which can be used the access the value in the headings don?t show any text because context looks into the wrong table.

In strc-doc.lua something like this has to be changed (use the title data subtable):

function sections.structuredata(depth,key,default,honorcatcodetable) -- todo: spec table and then also depth
    if depth then
        depth = levelmap[depth] or tonumber(depth)
    end
    if not depth or depth == 0 then
        depth = data.depth
    end
    local data = data.status[depth]
--  local d = data
    local d = data.titledata
    ?
end

Example:

\setupheadertexts[chapter]

\define[2]\ChapterCommand
  {\vbox\bgroup\starttabulate
   \NC Title   \EQ \structurevariable{title}   \NC\NR
   \NC Marking \EQ \structurevariable{marking} \NC\NR
   \stoptabulate\egroup}

\setuphead[chapter][command=\ChapterCommand]

\starttext

\startchapter[title={Hello World},marking={A}]

\starttabulate
\NC Title   \EQ \namedstructurevariable{chapter}{title}   \NC\NR
\NC Marking \EQ \namedstructurevariable{chapter}{marking} \NC\NR
\stoptabulate

\stopchapter

\stoptext

Wolfgang

From pragma at wxs.nl  Fri Feb 24 22:42:44 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 24 Feb 2012 22:42:44 +0100
Subject: [dev-context] \structurevariable
In-Reply-To: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
References: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
Message-ID: <4F480454.6050801@wxs.nl>

On 24-2-2012 17:52, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \structurevariable command which can be used the access the value in the headings don?t show any text because context looks into the wrong table.
 >
...

sorry for not being that reponsive but I'm recovering from a pretty 
heavy flu so a bit slow

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Feb 27 11:09:56 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 27 Feb 2012 11:09:56 +0100
Subject: [dev-context] problems with xtable and export xhtml
In-Reply-To: <CAG5iGsA-1qJw0QnB+h+jT7e1aMfuKn9bAbGm1Y-RVPe8YUXDQA@mail.gmail.com>
References: <CAG5iGsBA4QdnJS+xWa9U1N8SFmvL=7pJ0VOw_YhWGuEXh=K0Kw@mail.gmail.com>
	<17C8A182-90EE-49F7-A6E1-A19AAE66A5A7@googlemail.com>
	<CAG5iGsA-1qJw0QnB+h+jT7e1aMfuKn9bAbGm1Y-RVPe8YUXDQA@mail.gmail.com>
Message-ID: <CAG5iGsA2goFBzAAQOMAdM_A=pUFq9-O35jA8zv6zXDP2+18Hew@mail.gmail.com>

On Fri, Feb 24, 2012 at 4:45 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Fri, Feb 24, 2012 at 4:40 PM, Wolfgang Schuster
> <schuster.wolfgang at googlemail.com> wrote:
>>
>> Am 24.02.2012 um 13:06 schrieb luigi scarso:
>>
>>> It seems that xtable doesn't export @rows and @columns
>>> This patch to tabl-xtb.mkvi works, not sure if it is a good style.
>>>
>>> \unexpanded\def\tabl_x_start_cell_construct_yes[#settings]%
>>> ?{\dostarttagged\t!tablecell\empty % can't we just tag the box
>>> ? \setbox\b_tabl_x\hbox\bgroup
>>> ? \setupcurrentxtable[#settings]
>>> ? \letxtableparameter\c!width \d_tabl_x_width ?% overloads given width
>>> ? \letxtableparameter\c!height\d_tabl_x_height % overloads given height
>>> ? \ctxcommand{x_table_init_construct()}%
>>> ? \inheritedxtableframed\bgroup
>>> ? \tabl_x_begin_of_cell
>>> ? \def\tablecellcolumns{%
>>> ? ? ?\ifnum\csname \m_mult_interfaces_namespace nx\endcsname>\csname
>>> \m_mult_interfaces_namespace nc\endcsname%
>>> ? ? ? ?\csname \m_mult_interfaces_namespace nx\endcsname%
>>> ? ? ?\else
>>> ? ? ? ?\csname \m_mult_interfaces_namespace nc\endcsname%
>>> ? ? ?\fi}%
>>> ? \def\tablecellrows{%
>>> ? ? \ifnum\csname \m_mult_interfaces_namespace ny\endcsname>\csname
>>> \m_mult_interfaces_namespace nr\endcsname%
>>> ? ? ? \csname \m_mult_interfaces_namespace ny\endcsname%
>>> ? ? \else
>>> ? ? ? \csname \m_mult_interfaces_namespace nr\endcsname%
>>> ? ? \fi}
>>> ? \dotagxtablecell}
>>
>>
>> You need this
>>
>> \appendtoks
>> ? %\def\dotagxtablecell ?{\taggedctxcommand{settagtablecell(\number\tablecellrows,\number\tablecellcolumns,\number\raggedstatus)}}%
>> ? ?\def\dotagxtablecell ?{\taggedctxcommand{settagtablecell(\number\c_tabl_x_nx,\number\c_tabl_x_ny,\number\raggedstatus)}}%

Hm, not sure --- I'm always confused by  "nx" that could be "nr of
rows" which goes down along the y-axis direction.
So it should be
\def\dotagxtablecell
{\taggedctxcommand{settagtablecell(\number\c_tabl_x_ny,\number\c_tabl_x_nx,\number\raggedstatus)}}%
ie swithc nx with ny
And maybe we should keep this as good and modify other part of code
\def\dotagxtablecell
{\taggedctxcommand{settagtablecell(\number\tablecellrows,\number\tablecellcolumns,\number\raggedstatus)}}

PS @wolfgang:
I've said "it looks ok", but it was friday evening... :-)


-- 
luigi

From schuster.wolfgang at googlemail.com  Thu Mar  1 16:14:36 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 1 Mar 2012 16:14:36 +0100
Subject: [dev-context] Enumerations
Message-ID: <06E1EF96-649D-4707-B05B-9D98CB68BE7B@googlemail.com>

Hi Hans,

there is a problem with sub enumerations and notes in the new construct code. As you can see in the example below there is no difference between \test and \subtest:

\starttext

\defineenumeration[test][text=Test,title=no]

\starttest
One
\stoptest

\startsubtest
One
\stopsubtest

\test Two\par

\subtest Two\par

\stoptext

The problem is here because both \test and \subtest expand to \strc_enumerations_command{test}, changing \currentenumeration to ?#1? will fix it.

\unexpanded\def\strc_define_commands_enumeration#1#2#3% current level parent
  {\doifelsenothing{#3}
     {\defineconstruction[#1][\s!handler=\v!enumeration,\c!level=#2]}%
     {\defineconstruction[#1][#3][\s!handler=\v!enumeration,\c!level=#2]}%
   \setuevalue{\e!next #1}{\strc_enumerations_next   }%
   \setuevalue{\c!reset#1}{\strc_enumerations_reset  }%
   %setuevalue{\c!set  #1}{\strc_enumerations_set    }%
   \setuevalue        {#1}{\strc_enumerations_command{\currentenumeration}}%
   \setuevalue{\e!start#1}{\strc_enumerations_start  {\currentenumeration}}%
   \setuevalue{\e!stop #1}{\strc_enumerations_stop   }}

Even though there is another problem because \subtest has the wrong parent setting (parent=\??construction test), a quick fix is this (see the block between % and %):

\setvalue{\??constructioninitializer\v!enumeration}%
  {\let\currentenumeration              \currentconstruction
   \let\constructionparameter           \enumerationparameter
   \let\detokenizedconstructionparameter\detokenizedenumerationparameter
   \let\letconstructionparameter        \letenumerationparameter
   \let\setconstructionparameter        \setenumerationparameter
   \let\useconstructionstyleandcolor    \useenumerationstyleandcolor
   \let\setupcurrentconstruction        \setupcurrentenumeration
   %
   \ifx\currentconstructionmain\currentconstruction
     \letconstructionparameter\s!parent\??enumeration
   \else
     \setconstructionparameter\s!parent{\??enumeration\currentconstructionmain}%
   \fi
   %
   \edef\p_number{\constructionparameter\c!number}%
   \ifx\p_number\v!yes
     \settrue\c_strc_constructions_number_state
     \iftrialtypesetting
       \strc_counters_save\currentconstructionnumber
     \fi
     \strc_counters_increment_sub\currentconstructionnumber\currentconstructionlevel
   \else
     \setfalse\c_strc_constructions_number_state
   \fi
   \edef\p_title{\constructionparameter\c!title}%
   \ifx\p_title\v!yes
     \settrue\c_strc_constructions_title_state
   \else
     \setfalse\c_strc_constructions_title_state
   \fi}

Wolfgang

From luigi.scarso at gmail.com  Fri Mar  2 11:39:42 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 2 Mar 2012 11:39:42 +0100
Subject: [dev-context] wrong css attr.
Message-ID: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>

Errata
itemgroup[symbol="5"] { list-style-type : circ ; }
itemgroup[symbol="A"] { list-style-type : alpha ; }
itemgroup[symbol="G"] { list-style-type : upper-greek ; }

Corrige
itemgroup[symbol="5"] { list-style-type : circle ; }
itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
itemgroup[symbol="G"] { list-style-type : upper-roman ; }

Note
upper-greek  doesn't exist

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120302/ffee96ac/attachment.html>

From pragma at wxs.nl  Fri Mar  2 17:20:23 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Mar 2012 17:20:23 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
Message-ID: <4F50F347.1080507@wxs.nl>

On 2-3-2012 11:39, luigi scarso wrote:
> Errata
> itemgroup[symbol="5"] { list-style-type : circ ; }
> itemgroup[symbol="A"] { list-style-type : alpha ; }
> itemgroup[symbol="G"] { list-style-type : upper-greek ; }
>
> Corrige
> itemgroup[symbol="5"] { list-style-type : circle ; }
> itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
> itemgroup[symbol="G"] { list-style-type : upper-roman ; }
>
> Note
> upper-greek  doesn't exist

hm, I is upper-roman ... is there no way to get greek?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Fri Mar  2 17:28:17 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 2 Mar 2012 17:28:17 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <4F50F347.1080507@wxs.nl>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
Message-ID: <CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>

On Fri, Mar 2, 2012 at 5:20 PM, Hans Hagen <pragma at wxs.nl> wrote:

> On 2-3-2012 11:39, luigi scarso wrote:
>
>> Errata
>> itemgroup[symbol="5"] { list-style-type : circ ; }
>> itemgroup[symbol="A"] { list-style-type : alpha ; }
>> itemgroup[symbol="G"] { list-style-type : upper-greek ; }
>>
>> Corrige
>> itemgroup[symbol="5"] { list-style-type : circle ; }
>> itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
>> itemgroup[symbol="G"] { list-style-type : upper-roman ; }
>>
>> Note
>> upper-greek  doesn't exist
>>
>
> hm, I is upper-roman ... is there no way to get greek?
>
> Hans
>

Not with list-style-type --- maybe list-style-image as svg ?

http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type
12.5.1 Lists: the
'list-style-type'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type>,
'list-style-image'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-image>,
'list-style-position'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-position>,
and 'list-style'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style>properties
 *'list-style-type'*  *Value:*  disc | circle | square | decimal |
decimal-leading-zero | lower-roman | upper-roman | lower-greek |
lower-latin | upper-latin | armenian | georgian | lower-alpha | upper-alpha
| none | inherit <http://www.w3.org/TR/CSS2/cascade.html#value-def-inherit>
*Initial:*  disc *Applies to:*  elements with 'display: list-item' *
Inherited:*  yes *Percentages:*  N/A *Media:*
visual<http://www.w3.org/TR/CSS2/media.html#visual-media-group>
*Computed value:*  as specified

This property specifies appearance of the list item marker if
'list-style-image'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-image>has
the value 'none' or if the image pointed to by the URI cannot be
displayed. The value 'none' specifies no marker, otherwise there are three
types of marker: glyphs, numbering systems, and alphabetic systems.

Glyphs are specified with *disc*, *circle*, and *square*. Their exact
rendering depends on the user agent.

Numbering systems are specified with:
*decimal*Decimal numbers, beginning with 1. *decimal-leading-zero* Decimal
numbers padded by initial zeros (e.g., 01, 02, 03, ..., 98, 99). *
lower-roman* Lowercase roman numerals (i, ii, iii, iv, v, etc.). *
upper-roman* Uppercase roman numerals (I, II, III, IV, V, etc.).
*georgian* Traditional
Georgian numbering (an, ban, gan, ..., he, tan, in, in-an, ...).
*armenian* Traditional
uppercase Armenian numbering.

Alphabetic systems are specified with:
*lower-latin* or *lower-alpha* Lowercase ascii letters (a, b, c, ... z). *
upper-latin* or *upper-alpha* Uppercase ascii letters (A, B, C, ... Z). *
lower-greek* Lowercase classical Greek alpha, beta, gamma, ... (?, ?, ?,
...)

This specification does not define how alphabetic systems wrap at the end
of the alphabet. For instance, after 26 list items, 'lower-latin' rendering
is undefined. Therefore, for long lists, we recommend that authors specify
true numbers.

CSS 2.1 does not define how the list numbering is reset and incremented.
This is expected to be defined in the CSS List Module
[CSS3LIST]<http://www.w3.org/TR/CSS2/refs.html#ref-CSS3LIST>.


For example, the following HTML document:

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML>
   <HEAD>
     <TITLE>Lowercase latin numbering</TITLE>
     <STYLE type="text/css">
          ol { list-style-type: lower-roman }
     </STYLE>
  </HEAD>
  <BODY>
    <OL>
      <LI> This is the first item.
      <LI> This is the second item.
      <LI> This is the third item.
    </OL>
  </BODY>
</HTML>

might produce something like this:

  i This is the first item.
 ii This is the second item.
iii This is the third item.

The list marker alignment (here, right justified) depends on the user
agent.
 *'list-style-image'*  *Value:*
<uri><http://www.w3.org/TR/CSS2/syndata.html#value-def-uri>| none |
inherit <http://www.w3.org/TR/CSS2/cascade.html#value-def-inherit> *Initial:
*  none *Applies to:*  elements with 'display: list-item' *Inherited:*  yes
*Percentages:*  N/A *Media:*
visual<http://www.w3.org/TR/CSS2/media.html#visual-media-group>
*Computed value:*  absolute URI or 'none'

This property sets the image that will be used as the list item marker.
When the image is available, it will replace the marker set with the
'list-style-type'<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type>marker.

The size of the image is calculated from the following rules:

   1. If the image has a intrinsic width and height, the used width and
   height are the intrinsic width and height.
   2. Otherwise, if the image has an intrinsic ratio and either an
   intrinsic width or an intrinsic height, the used width/height is the same
   as the provided intrinsic width/height, and the used value of the missing
   dimension is calculated from the provided dimension and the ratio.
   3. Otherwise, if the image has an intrinsic ratio, the used width is 1em
   and the used height is calculated from this width and the intrinsic ratio.
   If this would produce a height larger than 1em, then the used height is
   instead set to 1em and the used width is calculated from this height and
   the intrinsic ratio.
   4. Otherwise, the image's used width is its intrinsic width if it has
   one, or else 1em. The image's used height is its intrinsic height if it has
   one, or else 1em.

 The following example sets the marker at the beginning of each list item
to be the image "ellipse.png".

ul { list-style-image: url("http://png.com/ellipse.png") }




-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120302/505b0759/attachment.html>

From pragma at wxs.nl  Fri Mar  2 17:42:37 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Mar 2012 17:42:37 +0100
Subject: [dev-context] Enumerations
In-Reply-To: <06E1EF96-649D-4707-B05B-9D98CB68BE7B@googlemail.com>
References: <06E1EF96-649D-4707-B05B-9D98CB68BE7B@googlemail.com>
Message-ID: <4F50F87D.9030401@wxs.nl>

On 1-3-2012 16:14, Wolfgang Schuster wrote:
> Hi Hans,
>
> there is a problem with sub enumerations and notes in the new construct code. As you can see in the example below there is no difference between \test and \subtest:
>
> \starttext
>
> \defineenumeration[test][text=Test,title=no]
>
> \starttest
> One
> \stoptest
>
> \startsubtest
> One
> \stopsubtest
>
> \test Two\par
>
> \subtest Two\par
>
> \stoptext
>
> The problem is here because both \test and \subtest expand to \strc_enumerations_command{test}, changing \currentenumeration to ?#1? will fix it.

how about

% to be considered:
%
% \let\??construction\??enumeration
%
% with push/pop (also at definition time)

\unexpanded\def\strc_define_commands_enumeration#1#2#3% current level parent
   {\doifelsenothing{#3}
 
{\normalexpanded{\defineconstruction[#1][\s!handler=\v!enumeration,\c!level=#2]}%
\setevalue{\??enumeration#1:\s!parent }{\??enumeration}%
      }%
 
{\normalexpanded{\defineconstruction[#1][#3][\s!handler=\v!enumeration,\c!level=#2]}%
\setevalue{\??enumeration#1:\s!parent }{\??enumeration#3}%
      }%
    \setuevalue{\e!next #1}{\strc_enumerations_next   }%
    \setuevalue{\c!reset#1}{\strc_enumerations_reset  }%
    %setuevalue{\c!set  #1}{\strc_enumerations_set    }%
    \setuevalue        {#1}{\strc_enumerations_command{#1}}%
    \setuevalue{\e!start#1}{\strc_enumerations_start  {#1}}%
    \setuevalue{\e!stop #1}{\strc_enumerations_stop   }}



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  2 17:44:17 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Mar 2012 17:44:17 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
Message-ID: <4F50F8E1.9000707@wxs.nl>

On 2-3-2012 17:28, luigi scarso wrote:
> On Fri, Mar 2, 2012 at 5:20 PM, Hans Hagen<pragma at wxs.nl>  wrote:
>
>> On 2-3-2012 11:39, luigi scarso wrote:
>>
>>> Errata
>>> itemgroup[symbol="5"] { list-style-type : circ ; }
>>> itemgroup[symbol="A"] { list-style-type : alpha ; }
>>> itemgroup[symbol="G"] { list-style-type : upper-greek ; }
>>>
>>> Corrige
>>> itemgroup[symbol="5"] { list-style-type : circle ; }
>>> itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
>>> itemgroup[symbol="G"] { list-style-type : upper-roman ; }
>>>
>>> Note
>>> upper-greek  doesn't exist
>>>
>>
>> hm, I is upper-roman ... is there no way to get greek?
>>
>> Hans
>>
>
> Not with list-style-type --- maybe list-style-image as svg ?

so best we can do is map to lower-greek then as then it still looks like 
greek

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  2 20:55:45 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 02 Mar 2012 20:55:45 +0100
Subject: [dev-context] \structurevariable
In-Reply-To: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
References: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
Message-ID: <4F5125C1.1040602@wxs.nl>

On 24-2-2012 17:52, Wolfgang Schuster wrote:
> Hi Hans,
>
> the \structurevariable command which can be used the access the value in the headings don?t show any text because context looks into the wrong table.
>
> In strc-doc.lua something like this has to be changed (use the title data subtable):
>
> function sections.structuredata(depth,key,default,honorcatcodetable) -- todo: spec table and then also depth
>      if depth then
>          depth = levelmap[depth] or tonumber(depth)
>      end
>      if not depth or depth == 0 then
>          depth = data.depth
>      end
>      local data = data.status[depth]
> --  local d = data
>      local d = data.titledata
>      ?
> end

no, it's a wrong change from split to match ...

     for k in gmatch(key,"[^%.]+") do

and then

\startchapter[title={Hello World},marking={A}][mybla=whatever]

\starttabulate
\NC Title    \EQ \namedstructurevariable{chapter}{titledata.title}   \NC\NR
\NC Marking  \EQ \namedstructurevariable{chapter}{titledata.marking} \NC\NR
\NC Whatever \EQ \namedstructurevariable{chapter}{userdata.mybla} \NC\NR
\stoptabulate

\stopchapter



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mojca.miklavec.lists at gmail.com  Fri Mar  2 22:34:42 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 2 Mar 2012 22:34:42 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
Message-ID: <CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>

On Fri, Mar 2, 2012 at 17:28, luigi scarso wrote:
 > On Fri, Mar 2, 2012 at 5:20 PM, Hans Hagen wrote:
 >>
 >> On 2-3-2012 11:39, luigi scarso wrote:
 >>>
 >>> Errata
 >>> itemgroup[symbol="5"] { list-style-type : circ ; }
 >>> itemgroup[symbol="A"] { list-style-type : alpha ; }
 >>> itemgroup[symbol="G"] { list-style-type : upper-greek ; }
 >>>
 >>> Corrige
 >>> itemgroup[symbol="5"] { list-style-type : circle ; }
 >>> itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
 >>> itemgroup[symbol="G"] { list-style-type : upper-roman ; }
 >>>
 >>> Note
 >>> upper-greek  doesn't exist
 >>
 >>
 >> hm, I is upper-roman ... is there no way to get greek?
 >>
 >> Hans
 >
 > Not with list-style-type --- maybe list-style-image as svg ?
 >
 > http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type


From pragma at wxs.nl  Sat Mar  3 00:13:08 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 03 Mar 2012 00:13:08 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
Message-ID: <4F515404.4000903@wxs.nl>

On 2-3-2012 22:34, Mojca Miklavec wrote:
> On Fri, Mar 2, 2012 at 17:28, luigi scarso wrote:
>   >  On Fri, Mar 2, 2012 at 5:20 PM, Hans Hagen wrote:
>   >>
>   >>  On 2-3-2012 11:39, luigi scarso wrote:
>   >>>
>   >>>  Errata
>   >>>  itemgroup[symbol="5"] { list-style-type : circ ; }
>   >>>  itemgroup[symbol="A"] { list-style-type : alpha ; }
>   >>>  itemgroup[symbol="G"] { list-style-type : upper-greek ; }
>   >>>
>   >>>  Corrige
>   >>>  itemgroup[symbol="5"] { list-style-type : circle ; }
>   >>>  itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
>   >>>  itemgroup[symbol="G"] { list-style-type : upper-roman ; }
>   >>>
>   >>>  Note
>   >>>  upper-greek  doesn't exist
>   >>
>   >>
>   >>  hm, I is upper-roman ... is there no way to get greek?
>   >>
>   >>  Hans
>   >
>   >  Not with list-style-type --- maybe list-style-image as svg ?
>   >
>   >  http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type
>
>  From http://www.w3.org/TR/css3-lists/:
>
> Issue: According to a native Greek speaker, the lower-greek and
> upper-greek styles aren't actually used. I've removed upper-greek for
> now, but kept lower-greek because CSS2.1 included the keyword. Do
> these have actual use-cases?
>
> @counter-style lower-greek {
>          type: alphabetic;
>          glyphs: '\3B1' '\3B2' '\3B3' '\3B4' '\3B5' '\3B6' '\3B7' '\3B8'
>   '\3B9' '\3BA' '\3BB' '\3BC' '\3BD' '\3BE' '\3BF' '\3C0' '\3C1' '\3C3'
>   '\3C4' '\3C5' '\3C6' '\3C7' '\3C8' '\3C9';
>          /* '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?'
> '?' '?' '?' '?' '?' '?' '?' '?' '?' */
>          /* This style is only defined because CSS2.1 has it.  It
> doesn't appear to actually be used in Greek texts. */
> }
>
> (However there is lower-serbo-croatian and upper-serbo-croation,
> lower-macedonian and upper-macedonian. I should ask for
> lower-slovenian and upper-slovenian ;)

I have no problem adding them but you have to key them in.

> You need to ask Thomas about his opinion, but I see no reason for not
> using lowercase greek for mathematical purposes.

indeed. also, it's in context because someone asked for it (mkii times)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Sat Mar  3 07:12:09 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 3 Mar 2012 07:12:09 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <4F515404.4000903@wxs.nl>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
Message-ID: <CAG5iGsCrN29qZ8Spb0hcn6-iOMocEu6oCoXWroWzi_ZW8xrM8g@mail.gmail.com>

On Sat, Mar 3, 2012 at 12:13 AM, Hans Hagen <pragma at wxs.nl> wrote:

> On 2-3-2012 22:34, Mojca Miklavec wrote:
>
>> On Fri, Mar 2, 2012 at 17:28, luigi scarso wrote:
>>  >  On Fri, Mar 2, 2012 at 5:20 PM, Hans Hagen wrote:
>>  >>
>>  >>  On 2-3-2012 11:39, luigi scarso wrote:
>>  >>>
>>  >>>  Errata
>>  >>>  itemgroup[symbol="5"] { list-style-type : circ ; }
>>  >>>  itemgroup[symbol="A"] { list-style-type : alpha ; }
>>  >>>  itemgroup[symbol="G"] { list-style-type : upper-greek ; }
>>  >>>
>>  >>>  Corrige
>>  >>>  itemgroup[symbol="5"] { list-style-type : circle ; }
>>  >>>  itemgroup[symbol="A"] { list-style-type : upper-alpha ; }
>>  >>>  itemgroup[symbol="G"] { list-style-type : upper-roman ; }
>>  >>>
>>  >>>  Note
>>  >>>  upper-greek  doesn't exist
>>  >>
>>  >>
>>  >>  hm, I is upper-roman ... is there no way to get greek?
>>  >>
>>  >>  Hans
>>  >
>>  >  Not with list-style-type --- maybe list-style-image as svg ?
>>  >
>>  >  http://www.w3.org/TR/CSS2/**generate.html#propdef-list-**style-type<http://www.w3.org/TR/CSS2/generate.html#propdef-list-style-type>
>>
>>  From http://www.w3.org/TR/css3-**lists/<http://www.w3.org/TR/css3-lists/>
>> :
>>
>> Issue: According to a native Greek speaker, the lower-greek and
>> upper-greek styles aren't actually used. I've removed upper-greek for
>> now, but kept lower-greek because CSS2.1 included the keyword. Do
>> these have actual use-cases?
>>
>> @counter-style lower-greek {
>>         type: alphabetic;
>>         glyphs: '\3B1' '\3B2' '\3B3' '\3B4' '\3B5' '\3B6' '\3B7' '\3B8'
>>  '\3B9' '\3BA' '\3BB' '\3BC' '\3BD' '\3BE' '\3BF' '\3C0' '\3C1' '\3C3'
>>  '\3C4' '\3C5' '\3C6' '\3C7' '\3C8' '\3C9';
>>         /* '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?' '?'
>> '?' '?' '?' '?' '?' '?' '?' '?' '?' */
>>         /* This style is only defined because CSS2.1 has it.  It
>> doesn't appear to actually be used in Greek texts. */
>> }
>>
>> (However there is lower-serbo-croatian and upper-serbo-croation,
>> lower-macedonian and upper-macedonian. I should ask for
>> lower-slovenian and upper-slovenian ;)
>>
>
> I have no problem adding them but you have to key them in.
>
>
>  You need to ask Thomas about his opinion, but I see no reason for not
>> using lowercase greek for mathematical purposes.
>>
>
> indeed. also, it's in context because someone asked for it (mkii times)
>
> In css3 we can define our style: so for example
@counter-style upper-greek {
type: non-repeating;
glyphs:
'?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?'
;
suffix: '.';
}
(not sure if the sequence is  correct.)


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120303/12f1574d/attachment.html>

From schuster.wolfgang at googlemail.com  Sat Mar  3 09:51:15 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 3 Mar 2012 09:51:15 +0100
Subject: [dev-context] \structurevariable
In-Reply-To: <4F5125C1.1040602@wxs.nl>
References: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
	<4F5125C1.1040602@wxs.nl>
Message-ID: <4D44D1AC-68F0-4AB0-9AB7-C198C3AFF61F@googlemail.com>


Am 02.03.2012 um 20:55 schrieb Hans Hagen:

> On 24-2-2012 17:52, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> the \structurevariable command which can be used the access the value in the headings don?t show any text because context looks into the wrong table.
>> 
>> In strc-doc.lua something like this has to be changed (use the title data subtable):
>> 
>> function sections.structuredata(depth,key,default,honorcatcodetable) -- todo: spec table and then also depth
>>     if depth then
>>         depth = levelmap[depth] or tonumber(depth)
>>     end
>>     if not depth or depth == 0 then
>>         depth = data.depth
>>     end
>>     local data = data.status[depth]
>> --  local d = data
>>     local d = data.titledata
>>     ?
>> end
> 
> no, it's a wrong change from split to match ...
> 
>    for k in gmatch(key,"[^%.]+") do
> 
> and then
> 
> \startchapter[title={Hello World},marking={A}][mybla=whatever]
> 
> \starttabulate
> \NC Title    \EQ \namedstructurevariable{chapter}{titledata.title}   \NC\NR
> \NC Marking  \EQ \namedstructurevariable{chapter}{titledata.marking} \NC\NR
> \NC Whatever \EQ \namedstructurevariable{chapter}{userdata.mybla} \NC\NR
> \stoptabulate
> 
> \stopchapter

Writing ?titledata.title? is not very convent and it would be better when
\strucuturevariable would always get titledata entries because for userdata
you already provided the \structureuservariable command.

%def\structurevariable           #1{\ctxcommand{structurevariable("#1")}}
\def\structurevariable           #1{\ctxcommand{structurevariable("titledata.#1")}}

Wolfgang

From mojca.miklavec.lists at gmail.com  Sat Mar  3 14:26:59 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 3 Mar 2012 14:26:59 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <4F515404.4000903@wxs.nl>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
Message-ID: <CALBOmsYeBkpg+0O8kWkt3xH2of2rydXNqFn7OsP9e=P8MvEkOw@mail.gmail.com>

On Sat, Mar 3, 2012 at 00:13, Hans Hagen wrote:
> On 2-3-2012 22:34, Mojca Miklavec wrote:
>
>> (However there is lower-serbo-croatian and upper-serbo-croation,
>> lower-macedonian and upper-macedonian. I should ask for
>> lower-slovenian and upper-slovenian ;)
>
> I have no problem adding them but you have to key them in.

I was talking about asking CSS people to add it to specification ;)
ConTeXt already has slovenian itemize.

Mojca

From schuster.wolfgang at googlemail.com  Sun Mar  4 09:57:10 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 4 Mar 2012 09:57:10 +0100
Subject: [dev-context] tabltbl.mkiv
Message-ID: <01F52C83-0A8D-48D8-9CB3-705482165627@googlemail.com>

Hi,

does \doifemptyvalue make any sense in mkiv because there is no guarantee that ?\currenttabulationhash\c!before? is defined and \doifempty{\tabulationparameter\c!before}{?} should also work.

\unexpanded\def\tabl_tabulate_FL_second_indeed
  {\ifinsidefloat\else
-    \doifemptyvalue{\??tt\currenttabulation\c!before}\tabl_tabulate_baselinecorrection % no expansion
+    \doifemptyvalue{\currenttabulationhash\c!before}\tabl_tabulate_baselinecorrection % no expansion
?   %\doifempty{\tabulationparameter\c!before}\tabl_tabulate_baselinecorrection
   \fi
   \tabl_tabulate_hrule_inject
   \tabl_tabulate_nobreak_inject
   \tabl_tabulate_column_rule_separator_inject
   \prevdepth\strutdp
   \tabl_tabulate_nobreak_inject
   \stoptabulatenoalign}

\unexpanded\def\tabl_tabulate_LL_second_indeed
  {\tabl_tabulate_nobreak_inject
   \tabl_tabulate_column_rule_separator_inject
   \tabl_tabulate_nobreak_inject
   \tabl_tabulate_hrule_inject
   \ifinsidefloat\else
-    \doifemptyvalue{\??tt\currenttabulation\c!after} % no expansion
+    \doifemptyvalue{\currenttabulationhash\c!after} % no expansion
?   %\doifempty{\tabulationparameter\c!after}
       {\vskip\strutdp
        \verticalstrut
        \vskip-\struttotal}%
   \fi
   \stoptabulatenoalign}

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Mar  4 20:43:15 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 4 Mar 2012 20:43:15 +0100
Subject: [dev-context] typo-mar.mkiv
Message-ID: <C22034C2-A683-46CE-86E9-EC357EF0B2F1@googlemail.com>

Hi,

there are a two \dosetupstrut commands which have to be changed.

\unexpanded\def\typo_margins_data_yes_indeed[#dataparameters][#textparameters]#content%
  {\iffirstargument
     \setupcurrentmargindata[#dataparameters]%
   \fi
   \doifelsenothing{#content}\donefalse\donetrue
   \ifdone
     \edef\currentmarginreference{\margindataparameter\c!reference}%
     \ifx\currentmarginreference\empty \else
       \strc_references_set_page_only_destination_box_attribute\currentmarginreference\currentmarginreference
     \fi
     \edef\currentmargindatastrut{\margindataparameter\c!strut}%
     \dostarttagged\t!margintext\currentmargindata
     \ifcsname\currentmarginframedhash\s!parent\endcsname
       \setbox\nextbox\hbox \currentmarginreference \bgroup
         \the\everymargindatacontent
         \usemargindatastyleandcolor\c!style\c!color
         \setupcurrentmarginframed[\c!location=\v!normal,#textparameters]%
         \inheritedmarginframedframed\bgroup
           \ifx\currentmargindatastrut\empty \else
-            \setupstrut[\currentmargindatastrut]%
+            \synchronizestrut\currentmargindatastrut
           \fi
           \begstrut\margindataparameter\c!command{#content}\endstrut
         \egroup
       \egroup
       \edef\currentmarginfirstheight{\number\dimexpr\framedfirstheight}%
     \else
       \edef\currentmargindatawidth{\margindataparameter\c!width}%
       \ifx\currentmargindatawidth\empty
         \setbox\nextbox\hbox \currentmarginreference \bgroup
           \the\everymargindatacontent
           \usemargindatastyleandcolor\c!style\c!color
           \ifx\currentmargindatastrut\empty \else
-            \dosetupstrut[\currentmargindatastrut]%
+            \synchronizestrut\currentmargindatastrut
           \fi
           \begstrut\margindataparameter\c!command{#content}\endstrut
         \egroup
         \let\currentmarginfirstheight\empty
       \else
         \dosetraggedcommand{\margindataparameter\c!align}%
         \setbox\nextbox\hbox \currentmarginreference \bgroup
           \vtop \bgroup
             \the\everymargindatacontent
             \usemargindatastyleandcolor\c!style\c!color
             \hsize\currentmargindatawidth
             \raggedcommand
             \ifx\currentmargindatastrut\empty \else
-              \dosetupstrut[\currentmargindatastrut]%
+              \synchronizestrut\currentmargindatastrut
             \fi
             \begstrut\margindataparameter\c!command{#content}\endstrut
           \egroup
         \egroup
         \edef\currentmarginfirstheight{true}%
       \fi
     \fi
     \dostoptagged
   \fi
   ...
   \endgroup}

Wolfgang

From pragma at wxs.nl  Mon Mar  5 09:59:08 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Mar 2012 09:59:08 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CAG5iGsCrN29qZ8Spb0hcn6-iOMocEu6oCoXWroWzi_ZW8xrM8g@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
	<CAG5iGsCrN29qZ8Spb0hcn6-iOMocEu6oCoXWroWzi_ZW8xrM8g@mail.gmail.com>
Message-ID: <4F54805C.9060006@wxs.nl>

On 3-3-2012 07:12, luigi scarso wrote:

>> In css3 we can define our style: so for example
> @counter-style upper-greek {
> type: non-repeating;
> glyphs:
> '?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?'
> ;
> suffix: '.';
> }
> (not sure if the sequence is  correct.)

afaiks only the B is missing

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Mar  5 10:14:40 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 5 Mar 2012 10:14:40 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <4F54805C.9060006@wxs.nl>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
	<CAG5iGsCrN29qZ8Spb0hcn6-iOMocEu6oCoXWroWzi_ZW8xrM8g@mail.gmail.com>
	<4F54805C.9060006@wxs.nl>
Message-ID: <CAG5iGsAx7xw7r2Rn5cpXUfteYmHoGyNq3f-vd1qAk0LUrDN5wg@mail.gmail.com>

On Mon, Mar 5, 2012 at 9:59 AM, Hans Hagen <pragma at wxs.nl> wrote:afaiks
only the B is missing
>
>
> afaiks only the B is missing
> Hans
>


@counter-style upper-greek {
type: non-repeating;
glyphs:
'?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?','?';
suffix: '.';
}
ie
U+0391 GREEK CAPITAL LETTER ALPHA,...,U+03A9 GREEK CAPITAL LETTER OMEGA

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120305/ba4963b6/attachment.html>

From pragma at wxs.nl  Mon Mar  5 10:49:20 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Mar 2012 10:49:20 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <CALBOmsYeBkpg+0O8kWkt3xH2of2rydXNqFn7OsP9e=P8MvEkOw@mail.gmail.com>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
	<CALBOmsYeBkpg+0O8kWkt3xH2of2rydXNqFn7OsP9e=P8MvEkOw@mail.gmail.com>
Message-ID: <4F548C20.3020403@wxs.nl>

On 3-3-2012 14:26, Mojca Miklavec wrote:
> On Sat, Mar 3, 2012 at 00:13, Hans Hagen wrote:
>> On 2-3-2012 22:34, Mojca Miklavec wrote:
>>
>>> (However there is lower-serbo-croatian and upper-serbo-croation,
>>> lower-macedonian and upper-macedonian. I should ask for
>>> lower-slovenian and upper-slovenian ;)
>>
>> I have no problem adding them but you have to key them in.
>
> I was talking about asking CSS people to add it to specification ;)
> ConTeXt already has slovenian itemize.

I know, but not yet in the export css file, but I guess Luigi will 
define one for you now.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Mar  5 10:55:09 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Mar 2012 10:55:09 +0100
Subject: [dev-context] tabltbl.mkiv
In-Reply-To: <01F52C83-0A8D-48D8-9CB3-705482165627@googlemail.com>
References: <01F52C83-0A8D-48D8-9CB3-705482165627@googlemail.com>
Message-ID: <4F548D7D.1000600@wxs.nl>

On 4-3-2012 09:57, Wolfgang Schuster wrote:
> Hi,
>
> does \doifemptyvalue make any sense in mkiv because there is no guarantee that ?\currenttabulationhash\c!before? is defined and \doifempty{\tabulationparameter\c!before}{?} should also work.

indeed the value variants should become simple empty tests (with the 
command handler all the \doif*value's go (there are probably left-overs 
where global replacements were done), so it's:

> ?   %\doifempty{\tabulationparameter\c!before}\tabl_tabulate_baselinecorrection
> ?   %\doifempty{\tabulationparameter\c!after}

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Mar  5 10:57:23 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 5 Mar 2012 10:57:23 +0100
Subject: [dev-context] wrong css attr.
In-Reply-To: <4F548C20.3020403@wxs.nl>
References: <CAG5iGsC-jyKWucGbAB2xca29TA=D_7e3HA-ng06U2uncW4kKJA@mail.gmail.com>
	<4F50F347.1080507@wxs.nl>
	<CAG5iGsBF=rQKLhiSVkFfujyr4CqHyZxS8pMQvfyHj9xVKBV9tQ@mail.gmail.com>
	<CALBOmsZ+vRmtKi1pvREUiDxBtZk4MFgjB3SUWw08vT5X+OGyOw@mail.gmail.com>
	<4F515404.4000903@wxs.nl>
	<CALBOmsYeBkpg+0O8kWkt3xH2of2rydXNqFn7OsP9e=P8MvEkOw@mail.gmail.com>
	<4F548C20.3020403@wxs.nl>
Message-ID: <CAG5iGsA1mNzph8+3_XVBco-qi9PEFp81FZ+C+UCyaqrG1UKx-w@mail.gmail.com>

On Mon, Mar 5, 2012 at 10:49 AM, Hans Hagen <pragma at wxs.nl> wrote:

> On 3-3-2012 14:26, Mojca Miklavec wrote:
>
>> On Sat, Mar 3, 2012 at 00:13, Hans Hagen wrote:
>>
>>> On 2-3-2012 22:34, Mojca Miklavec wrote:
>>>
>>>  (However there is lower-serbo-croatian and upper-serbo-croation,
>>>> lower-macedonian and upper-macedonian. I should ask for
>>>> lower-slovenian and upper-slovenian ;)
>>>>
>>>
>>> I have no problem adding them but you have to key them in.
>>>
>>
>> I was talking about asking CSS people to add it to specification ;)
>> ConTeXt already has slovenian itemize.
>>
>
> I know, but not yet in the export css file, but I guess Luigi will define
> one for you now.
>

lost with jquery ....
It's impossible to do a paginator with CSS2.1 and  CSS3 is still a draft.
Some kind of javascript is necessary then.
Of course you can also use a heavy xslt -> standard xhtml , but still you
need javascript to paginate.

I've added html5 to my personal notes "nice idea to explore  for next
eurotex meeting ".


> --
>
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120305/5d0d29f3/attachment-0001.html>

From pragma at wxs.nl  Mon Mar  5 13:44:52 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Mar 2012 13:44:52 +0100
Subject: [dev-context] \structurevariable
In-Reply-To: <4D44D1AC-68F0-4AB0-9AB7-C198C3AFF61F@googlemail.com>
References: <5C8339F0-E55C-4E35-A1B1-B78BCC4E6AAD@googlemail.com>
	<4F5125C1.1040602@wxs.nl>
	<4D44D1AC-68F0-4AB0-9AB7-C198C3AFF61F@googlemail.com>
Message-ID: <4F54B544.7090009@wxs.nl>

On 3-3-2012 09:51, Wolfgang Schuster wrote:

> Writing ?titledata.title? is not very convent and it would be better when
> \strucuturevariable would always get titledata entries because for userdata
> you already provided the \structureuservariable command.

I now support both


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Mar  5 15:59:39 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 5 Mar 2012 15:59:39 +0100
Subject: [dev-context] [OT] Github compromised
Message-ID: <CAG5iGsBpPa8S2_p8HTDbgUxHkUC9EpErbE1hjmL+i6CGrUhXeg@mail.gmail.com>

https://lwn.net/Articles/485162/
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/mailman/private/dev-context/attachments/20120305/4b5f313d/attachment.html>

From schuster.wolfgang at googlemail.com  Tue Mar  6 18:52:20 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 6 Mar 2012 18:52:20 +0100
Subject: [dev-context] strc-con.mkvi
Message-ID: <48392625-998C-4800-B231-13EA7AF4EDF9@googlemail.com>

Hi,

missing ?s? in \localhsize

\defineconstructionalternative
  [\v!top]
  [\c!renderingsetup=\??constructionrenderings:\v!top,
-  \c!width=\localhize]
+  \c!width=\localhsize]

Wolfgang

From schuster.wolfgang at googlemail.com  Tue Mar  6 20:01:22 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 6 Mar 2012 20:01:22 +0100
Subject: [dev-context] s-mod-01.mkiv: \startinterface
Message-ID: <147A528F-1BFF-48D5-8D1D-D4B9D3C84430@googlemail.com>

Hi Hans,

is this really needed in s-mod-01.mkiv

  \defineparagraphs [interface] [\c!n=2]
  \setupparagraphs  [interface] [1] [\c!width=4cm]

because this makes it impossible to make a PDF from a module source when it contains something like this

  \startinterface all
    \setinterfaceconstant {?} {?}
  \stopinterface

Wolfgang

From pragma at wxs.nl  Tue Mar  6 21:36:21 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 06 Mar 2012 21:36:21 +0100
Subject: [dev-context] s-mod-01.mkiv: \startinterface
In-Reply-To: <147A528F-1BFF-48D5-8D1D-D4B9D3C84430@googlemail.com>
References: <147A528F-1BFF-48D5-8D1D-D4B9D3C84430@googlemail.com>
Message-ID: <4F567545.4010603@wxs.nl>

On 6-3-2012 20:01, Wolfgang Schuster wrote:
> Hi Hans,
>
> is this really needed in s-mod-01.mkiv
>
>    \defineparagraphs [interface] [\c!n=2]
>    \setupparagraphs  [interface] [1] [\c!width=4cm]
>
> because this makes it impossible to make a PDF from a module source when it contains something like this
>
>    \startinterface all
>      \setinterfaceconstant {?} {?}
>    \stopinterface

It's probably there for a reason but I wonder if it's still used so it 
might go away indeed.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Fri Mar  9 09:15:25 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Fri, 9 Mar 2012 09:15:25 +0100
Subject: [dev-context] pack-lyr.mkiv
Message-ID: <49051356-C7A2-43C2-B841-66E1D0CCC7C9@googlemail.com>

Hi Hans,

when you process the following example you can see that the layer box is positioned in MkII at the top of the page but in MkIV at the bottom, why has this changed?

\definelayer[test][width=\paperwidth,height=22mm,option=test]

\setlayer[test][x=104mm,y=11mm]{\externalfigure[cow][width=56mm]}

\setupbackgrounds[page][background=test]

\starttext

Hello

\stoptext

The change happened in this code block where you moved \vss from the bottom of the box to the top:

\def\pack_layers_flush_indeed#1#2% quite core, so optimized
  {\begingroup % already grouped
   ...
   \ifx\p_pack_layers_option\v!test \ruledvbox \else \vbox \fi \ifx\p_pack_layers_method\v!overlay to \overlayheight \fi \layoutcomponentboxattribute
     {\vss
      \hbox \ifx\p_pack_layers_method\v!overlay to \overlaywidth \fi
        {\box\nextbox
         \hss}%
      }%\vss}%
   ...
   \endgroup}

Wolfgang

From pragma at wxs.nl  Sat Mar 10 12:57:10 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 10 Mar 2012 12:57:10 +0100
Subject: [dev-context] pack-lyr.mkiv
In-Reply-To: <49051356-C7A2-43C2-B841-66E1D0CCC7C9@googlemail.com>
References: <49051356-C7A2-43C2-B841-66E1D0CCC7C9@googlemail.com>
Message-ID: <4F5B4196.8070504@wxs.nl>

On 9-3-2012 09:15, Wolfgang Schuster wrote:
> Hi Hans,
>
> when you process the following example you can see that the layer box is positioned in MkII at the top of the page but in MkIV at the bottom, why has this changed?
>
> \definelayer[test][width=\paperwidth,height=22mm,option=test]
>
> \setlayer[test][x=104mm,y=11mm]{\externalfigure[cow][width=56mm]}
>
> \setupbackgrounds[page][background=test]
>
> \starttext
>
> Hello
>
> \stoptext
>
> The change happened in this code block where you moved \vss from the bottom of the box to the top:

indeed ... the problem is that in some case we work ulx,uly and in 
others bottom top (as positions are llx,lly) ... and I need to find a 
solution that works for both cases

> \def\pack_layers_flush_indeed#1#2% quite core, so optimized
>    {\begingroup % already grouped
>     ...
>     \ifx\p_pack_layers_option\v!test \ruledvbox \else \vbox \fi \ifx\p_pack_layers_method\v!overlay to \overlayheight \fi \layoutcomponentboxattribute
>       {\vss
>        \hbox \ifx\p_pack_layers_method\v!overlay to \overlaywidth \fi
>          {\box\nextbox
>           \hss}%
>        }%\vss}%
>     ...
>     \endgroup}
>
> Wolfgang
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-context


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Mar 15 22:34:34 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 15 Mar 2012 22:34:34 +0100
Subject: [dev-context] =?windows-1252?q?=5Cdefinestructure=85?=
Message-ID: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>

Hi Hans,

can you finally add synonyms for the following four commands.

- \definestructureresetset
- \definestructureseparatorset
- \definestructureconversionset
- \definestructureprefixset

Wolfgang

From schuster.wolfgang at googlemail.com  Thu Mar 22 15:43:43 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 22 Mar 2012 15:43:43 +0100
Subject: [dev-context] supp-box.mkiv
Message-ID: <8AD2A241-043A-468D-AA7B-1F6636DA673E@googlemail.com>

Hi Hans,

-\def\syst_boxes_raise_finish#1%
+\def\syst_boxes_raise_finish
  {\setbox\nextbox\hbox{\raise\scratchdimen\box\nextbox}%
   \ht\nextbox\strutht
   \dp\nextbox\strutdp
   \box\nextbox
   \egroup}

-\def\syst_boxes_lower_finish#1%
+\def\syst_boxes_lower_finish
  {\setbox\nextbox\hbox{\lower\scratchdimen\box\nextbox}%
   \ht\nextbox\strutht
   \dp\nextbox\strutdp
   \box\nextbox
   \egroup}

Wolfgang

From pragma at wxs.nl  Thu Mar 22 22:05:15 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 22 Mar 2012 22:05:15 +0100
Subject: [dev-context] supp-box.mkiv
In-Reply-To: <8AD2A241-043A-468D-AA7B-1F6636DA673E@googlemail.com>
References: <8AD2A241-043A-468D-AA7B-1F6636DA673E@googlemail.com>
Message-ID: <4F6B940B.5090005@wxs.nl>

On 22-3-2012 15:43, Wolfgang Schuster wrote:
> Hi Hans,
>
> -\def\syst_boxes_raise_finish#1%
> +\def\syst_boxes_raise_finish
>    {\setbox\nextbox\hbox{\raise\scratchdimen\box\nextbox}%
>     \ht\nextbox\strutht
>     \dp\nextbox\strutdp
>     \box\nextbox
>     \egroup}
>
> -\def\syst_boxes_lower_finish#1%
> +\def\syst_boxes_lower_finish
>    {\setbox\nextbox\hbox{\lower\scratchdimen\box\nextbox}%
>     \ht\nextbox\strutht
>     \dp\nextbox\strutdp
>     \box\nextbox
>     \egroup}

done

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Tue Mar 27 20:25:25 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 27 Mar 2012 20:25:25 +0200
Subject: [dev-context] strc-lst.mkvi
Message-ID: <7B851975-D193-418A-B87D-509DDF770C9A@gmail.com>

Hi Hans,

there is ?alternative=? missing in the default settings for \definecombinedlist.

\def\strc_lists_combined_define[#tag][#list][#settings]%
- {\definelist[#tag][\c!criterium=\v!local,\c!number=0,\c!list={#list},#settings]% inherits from root
+ {\definelist[#tag][\c!criterium=\v!local,\c!number=0,\c!list={#list},\c!alternative=,#settings]% inherits from root
   \setvalue{\e!setup   #tag\e!endsetup}{\dodoubleempty\strc_lists_combined_setup   [#tag]}%
   \setvalue{\e!place              #tag}{\dodoubleempty\strc_lists_combined_place   [#tag]}%
   \setvalue{\e!complete           #tag}{\dodoubleempty\strc_lists_combined_complete[#tag]}}

Wolfgang

From schuster.wolfgang at googlemail.com  Tue Mar 27 21:42:57 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 27 Mar 2012 21:42:57 +0200
Subject: [dev-context] strc-lst.mkvi
Message-ID: <E24D3714-49CD-4417-8E8B-9362A94BDABD@googlemail.com>

Hi Hans,

can you make the change below to permit back references from the heading to the list entry.

\startsetups[\??listrenderings:generic]
    \listparameter\c!before % can be \hskip
    \edef\p_command{\listalternativeparameter\c!command}
    \ifx\p_command\empty
        \listalternativeparameter\c!before
        \vbox {
            \forgetall
            \hbox \strc_lists_get_reference_attribute\v!all {
                \ifconditional\c_lists_show_number
                  % \ifconditional\c_lists_has_page
                        \hbox \strc_lists_get_reference_attribute\v!number {
                            \strc_lists_set_style_color\c!numberstyle\c!numbercolor\v!number
                            \listparameter\c!numbercommand\currentlistsymbol
                        }
                  % \fi
                \fi
                \hbox \strc_lists_get_reference_attribute\v!text {
                    \strc_lists_set_style_color\c!textstyle\c!textcolor\v!text
                    \the\t_lists_every_renderingtext
                    \listparameter\c!textcommand\currentlistentrytitle
                }
                \ifconditional\c_lists_show_page
                    \ifconditional\c_lists_has_page
                        \hbox \strc_lists_get_reference_attribute\v!pagenumber {
                            \strc_lists_set_style_color\c!pagestyle\c!pagecolor\v!pagenumber
                            \listparameter\c!pagecommand\currentlistentrypagenumber
                        }
                    \fi
                \fi
            }
        }
        \listalternativeparameter\c!after
   \else
-       \hbox \strc_lists_get_reference_attribute\v!all {
+       \hbox \strc_lists_get_reference_attribute\v!all \strc_lists_get_destination_attribute {
            \p_command\currentlistentrynumber\currentlistentrytitle\currentlistentrypagenumber
        }
   \fi
   \listparameter\c!after
\stopsetups

Wolfgang

From sbbrouwer at gmail.com  Wed Mar 28 00:15:13 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Wed, 28 Mar 2012 00:15:13 +0200
Subject: [dev-context] Bugs: \WORD and \WORDS behave identically;
	\Cap and \CAP do nothing
Message-ID: <CAF=dkzz0kn9E1BZmwdx3CfRonZ3+ptFpPb5PzQdSy=SeGtYwVA@mail.gmail.com>

Hi all,

(1) In MkIV, \WORD{some text} and \WORDS{some text} both turn the
entire text to uppercase ("SOME TEXT"). By analogy with \Word and
\Words, I would expect \WORD to only uppercase the first word ("SOME
text"),

(2) \Cap produces the amsmath \Cap even in text mode. That's the
double intersection symbol.
Link to picture:
http://www.marathon-studios.com/unicode/U22D2/Double_Intersection
According to the manual, "\Cap changes the first character of a word
into a capital".
\Caps already changes a string to small capitals, with the first
letter of every word uppercase; so, I would expect \Cap to change a
string to small capitals with the first letter of the string
uppercase. (I think the manual migh be saying this; it's not quite
clear.)

(3) \CAP{some \\{text}} does nothing; the double backslash only
produces a newline.
According to the manual, \CAP changes letters that are preceded by \\
into capital letters.
The documentation comments in typo-cap.mkiv also mention the \CAP{ ...
... \\{...} ...} syntax, but the comments don't say what it should do.

They're not terribly important commands, to be sure, but they might
also be easy fixes. I don't need them for myself; I simply picked a
random command + its relatives to improve on the Wiki.

Cheers,

Sietse

From pragma at wxs.nl  Wed Mar 28 10:10:53 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Mar 2012 10:10:53 +0200
Subject: [dev-context] strc-lst.mkvi
In-Reply-To: <E24D3714-49CD-4417-8E8B-9362A94BDABD@googlemail.com>
References: <E24D3714-49CD-4417-8E8B-9362A94BDABD@googlemail.com>
Message-ID: <4F72C78D.2030705@wxs.nl>

On 27-3-2012 21:42, Wolfgang Schuster wrote:

> -       \hbox \strc_lists_get_reference_attribute\v!all {
> +       \hbox \strc_lists_get_reference_attribute\v!all \strc_lists_get_destination_attribute {
>              \p_command\currentlistentrynumber\currentlistentrytitle\currentlistentrypagenumber
>          }
>     \fi

the other variants in thsi macro probably also need that attribute then

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 28 18:38:02 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Mar 2012 18:38:02 +0200
Subject: [dev-context] Bugs: \WORD and \WORDS behave identically;
 \Cap and \CAP do nothing
In-Reply-To: <CAF=dkzz0kn9E1BZmwdx3CfRonZ3+ptFpPb5PzQdSy=SeGtYwVA@mail.gmail.com>
References: <CAF=dkzz0kn9E1BZmwdx3CfRonZ3+ptFpPb5PzQdSy=SeGtYwVA@mail.gmail.com>
Message-ID: <4F733E6A.8090107@wxs.nl>

On 28-3-2012 00:15, Sietse Brouwer wrote:
> Hi all,
>
> (1) In MkIV, \WORD{some text} and \WORDS{some text} both turn the
> entire text to uppercase ("SOME TEXT"). By analogy with \Word and
> \Words, I would expect \WORD to only uppercase the first word ("SOME
> text"),

\WORD and \WORDS always have been synonyms (if needed we can have \FIRSTWORD

> (2) \Cap produces the amsmath \Cap even in text mode. That's the
> double intersection symbol.
> Link to picture:
> http://www.marathon-studios.com/unicode/U22D2/Double_Intersection
> According to the manual, "\Cap changes the first character of a word
> into a capital".
> \Caps already changes a string to small capitals, with the first
> letter of every word uppercase; so, I would expect \Cap to change a
> string to small capitals with the first letter of the string
> uppercase. (I think the manual migh be saying this; it's not quite
> clear.)

The cap you want is something \Word{\smallcaps ...}. The old mkii cap 
code is mostly a solution for fonts lacking small capitals.

> (3) \CAP{some \\{text}} does nothing; the double backslash only
> produces a newline.
> According to the manual, \CAP changes letters that are preceded by \\
> into capital letters.
> The documentation comments in typo-cap.mkiv also mention the \CAP{ ...
> .... \\{...} ...} syntax, but the comments don't say what it should do.

Hm. Do we need that kind of stuff? If not (no longer) than we need to 
fix the (fonts) manual.

> They're not terribly important commands, to be sure, but they might
> also be easy fixes. I don't need them for myself; I simply picked a
> random command + its relatives to improve on the Wiki.

Best fix the wiki. Especially with regards to fonts some of the more 
obscure things have become obsolete due to the fact that opentype fonts 
are more complete. For instance the concept of small caps and old style 
font as a separate entity has gone.

Thanks for noticing,

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From sbbrouwer at gmail.com  Wed Mar 28 22:46:12 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Wed, 28 Mar 2012 22:46:12 +0200
Subject: [dev-context] Bugs: \WORD and \WORDS behave identically;
 \Cap and \CAP do nothing
In-Reply-To: <4F733E6A.8090107@wxs.nl>
References: <CAF=dkzz0kn9E1BZmwdx3CfRonZ3+ptFpPb5PzQdSy=SeGtYwVA@mail.gmail.com>
	<4F733E6A.8090107@wxs.nl>
Message-ID: <CAF=dkzxLqTV6AaPE5GLWO9wXyOUWYwstZzWf2u10ob8gT4y+Lg@mail.gmail.com>

Hi Hans,

> \WORD and \WORDS always have been synonyms

Noted in the wiki.

> (if needed we can have \FIRSTWORD

If needed. I expect quite some people will do it for themselves in Lua
before someone comes asking for a command for it.

>> I would expect \Cap to change a
>> string to small capitals with the first letter of the string
>> uppercase.

> The cap you want is something \Word{\smallcaps ...}. The old mkii cap code
> is mostly a solution for fonts lacking small capitals.

This works for me at home (MkIV), but not on the wiki (MkII). I'm
running 2012.02.08 MkIV at home, while the wiki runs 2011.10.08 MkII.

>> (3) \CAP{some \\{text}} does nothing; the double backslash only
>> produces a newline.
>> According to the manual, \CAP changes letters that are preceded by \\
>> into capital letters.

(Actually, turns out this works under MkII, but not MkIV.)

> Hm. Do we need that kind of stuff? If not (no longer) than we need to fix
> the (fonts) manual.

I can't imagine anyone being in a position that they *can* insert
backslashes, but *can't* just capitalize the letters. I see no
objection to marking this command obsolete, myself. I'm not in a
position to edit the fonts manual, though.

Cheers, and thanks for your reply,

Sietse

On Wed, Mar 28, 2012 at 18:38, Hans Hagen <pragma at wxs.nl> wrote:
> On 28-3-2012 00:15, Sietse Brouwer wrote:
>>
>> Hi all,
>>
>> (1) In MkIV, \WORD{some text} and \WORDS{some text} both turn the
>> entire text to uppercase ("SOME TEXT"). By analogy with \Word and
>> \Words, I would expect \WORD to only uppercase the first word ("SOME
>> text"),
>
>
> \WORD and \WORDS always have been synonyms (if needed we can have \FIRSTWORD
>
>
>> (2) \Cap produces the amsmath \Cap even in text mode. That's the
>> double intersection symbol.
>> Link to picture:
>> http://www.marathon-studios.com/unicode/U22D2/Double_Intersection
>> According to the manual, "\Cap changes the first character of a word
>> into a capital".
>> \Caps already changes a string to small capitals, with the first
>> letter of every word uppercase; so, I would expect \Cap to change a
>> string to small capitals with the first letter of the string
>> uppercase. (I think the manual might be saying this; it's not quite
>> clear.)
>
>
> The cap you want is something \Word{\smallcaps ...}. The old mkii cap code
> is mostly a solution for fonts lacking small capitals.
>
>> (3) \CAP{some \\{text}} does nothing; the double backslash only
>> produces a newline.
>> According to the manual, \CAP changes letters that are preceded by \\
>> into capital letters.
>> The documentation comments in typo-cap.mkiv also mention the \CAP{ ...
>> .... \\{...} ...} syntax, but the comments don't say what it should do.
>
>
> Hm. Do we need that kind of stuff? If not (no longer) than we need to fix
> the (fonts) manual.
>
>
>> They're not terribly important commands, to be sure, but they might
>> also be easy fixes. I don't need them for myself; I simply picked a
>> random command + its relatives to improve on the Wiki.
>
>
> Best fix the wiki. Especially with regards to fonts some of the more obscure
> things have become obsolete due to the fact that opentype fonts are more
> complete. For instance the concept of small caps and old style font as a
> separate entity has gone.
>
> Thanks for noticing,
>
> Hans
>
> -----------------------------------------------------------------
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Hans Hagen | PRAGMA ADE
> ? ? ? ? ? ? ?Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ? ?tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? | www.pragma-pod.nl
> -----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 28 23:07:36 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Mar 2012 23:07:36 +0200
Subject: [dev-context] =?windows-1252?q?=5Cdefinestructure=85?=
In-Reply-To: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
Message-ID: <4F737D98.5040600@wxs.nl>

On 15-3-2012 22:34, Wolfgang Schuster wrote:
> Hi Hans,
>
> can you finally add synonyms for the following four commands.
>
> - \definestructureresetset
> - \definestructureseparatorset
> - \definestructureconversionset
> - \definestructureprefixset

you mean

\definecounterresetset

etc?

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Wed Mar 28 23:48:36 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 28 Mar 2012 23:48:36 +0200
Subject: [dev-context] =?windows-1252?q?=5Cdefinestructure=85?=
In-Reply-To: <4F737D98.5040600@wxs.nl>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
Message-ID: <D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>


Am 28.03.2012 um 23:07 schrieb Hans Hagen:

> On 15-3-2012 22:34, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> can you finally add synonyms for the following four commands.
>> 
>> - \definestructureresetset
>> - \definestructureseparatorset
>> - \definestructureconversionset
>> - \definestructureprefixset
> 
> you mean
> 
> \definecounterresetset
> 
> etc?

One solution is to provide a commands for each key to enable the set, e.g.

- \definesectionconverionset for sectionconversion,
- \defineprefixconversionset for prefixconversion and
- \definenumberconverionset for numberconversion

but that?s overkill for the same thing and leads to redundant setting because section and prefix are the same thing.

Your \definecounter? synonyms is a good thing in the middle.

As we?re now talking about \definestructure? I have a new request, can?t you change (or provide alternatives names) all the new counter commands from ?structurecounter? (\definestructurecounter, \rawstructurecounter, \convertedstructurecounter etc.) to ?counter? (e.g. \definecounter \rawcounter, \convertedcounter).

Wolfgang

From schuster.wolfgang at googlemail.com  Thu Mar 29 08:51:28 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 29 Mar 2012 08:51:28 +0200
Subject: [dev-context] \startstructurelevel
Message-ID: <F1749471-3E85-4A72-B8A3-CA207876C47B@googlemail.com>

Hi Hans,

can you give the \startstructurelevel (and the define and setup command) environment a better name, e.g. \startsectionlevel which fit it?s purpose.

Wolfgang

From pragma at wxs.nl  Thu Mar 29 09:34:00 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Mar 2012 09:34:00 +0200
Subject: [dev-context] =?windows-1252?q?=5Cdefinestructure=85?=
In-Reply-To: <D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
Message-ID: <4F741068.3030309@wxs.nl>

On 28-3-2012 23:48, Wolfgang Schuster wrote:
>
> Am 28.03.2012 um 23:07 schrieb Hans Hagen:
>
>> On 15-3-2012 22:34, Wolfgang Schuster wrote:
>>> Hi Hans,
>>>
>>> can you finally add synonyms for the following four commands.
>>>
>>> - \definestructureresetset
>>> - \definestructureseparatorset
>>> - \definestructureconversionset
>>> - \definestructureprefixset
>>
>> you mean
>>
>> \definecounterresetset
>>
>> etc?
>
> One solution is to provide a commands for each key to enable the set, e.g.
>
> - \definesectionconverionset for sectionconversion,
> - \defineprefixconversionset for prefixconversion and
> - \definenumberconverionset for numberconversion
>
> but that?s overkill for the same thing and leads to redundant setting because section and prefix are the same thing.
>
> Your \definecounter? synonyms is a good thing in the middle.

or maybe just \defineconversionset

> As we?re now talking about \definestructure? I have a new request, can?t you change (or provide alternatives names) all the new counter commands from ?structurecounter? (\definestructurecounter, \rawstructurecounter, \convertedstructurecounter etc.) to ?counter? (e.g. \definecounter \rawcounter, \convertedcounter).

we already have

\let \definenumber          \definestructurecounter    % [name]
\let \setupnumber           \setupstructurecounter     % [name][setups]

\let \setnumber             \setstructurecounter       % [name]{value}
\let \resetnumber           \resetstructurecounter     % [name]
\let \savenumber            \savestructurecounter      % [name]
\let \restorenumber         \restorestructurecounter   % [name]
\let \incrementnumber       \incrementstructurecounter % [name]
\let \decrementnumber       \decrementstructurecounter % [name]
\let \rawnumber             \rawstructurecounter       % [name]
\let \getnumber             \getstructurecounter       % [name]
\let \convertednumber       \getstructurecounter       % [name]

\let \doifdefinednumber     \doifstructurecounter      % {number}{true}
\let \doifundefinednumber   \doifnotstructurecounter   % {number}{true}
\let \doifdefinednumberelse \doifstructurecounterelse  % 
{number}{true}{false}

\let \setupnumbering        \setupstructurecountering

and three synonyms is a bit too much ... best is to decide on the main 
one and then provide a synonym for a while for backward compatibility

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Mar 29 10:46:14 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 29 Mar 2012 10:46:14 +0200
Subject: [dev-context] =?windows-1252?q?Counters_=28was=3A_=5Cdefinestruct?=
	=?windows-1252?q?ure=85=29?=
In-Reply-To: <4F741068.3030309@wxs.nl>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
Message-ID: <83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>


Am 29.03.2012 um 09:34 schrieb Hans Hagen:

> On 28-3-2012 23:48, Wolfgang Schuster wrote:
>> 
>> As we?re now talking about \definestructure? I have a new request, can?t you change (or provide alternatives names) all the new counter commands from ?structurecounter? (\definestructurecounter, \rawstructurecounter, \convertedstructurecounter etc.) to ?counter? (e.g. \definecounter \rawcounter, \convertedcounter).
> 
> we already have
> 
> \let \definenumber          \definestructurecounter    % [name]
> \let \setupnumber           \setupstructurecounter     % [name][setups]
> 
> \let \setnumber             \setstructurecounter       % [name]{value}
> \let \resetnumber           \resetstructurecounter     % [name]
> \let \savenumber            \savestructurecounter      % [name]
> \let \restorenumber         \restorestructurecounter   % [name]
> \let \incrementnumber       \incrementstructurecounter % [name]
> \let \decrementnumber       \decrementstructurecounter % [name]
> \let \rawnumber             \rawstructurecounter       % [name]
> \let \getnumber             \getstructurecounter       % [name]
> \let \convertednumber       \getstructurecounter       % [name]
> 
> \let \doifdefinednumber     \doifstructurecounter      % {number}{true}
> \let \doifundefinednumber   \doifnotstructurecounter   % {number}{true}
> \let \doifdefinednumberelse \doifstructurecounterelse  % {number}{true}{false}
> 
> \let \setupnumbering        \setupstructurecountering
> 
> and three synonyms is a bit too much ... best is to decide on the main one and then provide a synonym for a while for backward compatibility

To many names aren?t a good solution but when I have to make a decision I would choose \definecounter because it?s the name which makes more sense. The only thing (besides backward compatibility) is the \makecounter mechanism which use the following commands:

\makecounter{...}
\countervalue{...}
\pluscounter{...}
\minuscounter{...}
\resetcounter{...}
\setcounter{?}{?}
\savecounter{...}
\restorecounter{?}

If the \definenumber commands are changed this mechanism can?t exist anymore but do we really need 4 different counter mechanism (\newcount, \newcounter, \makecounter and \definenumber/\definestructurecounter) in ConTeXt?

Wolfgang

From pragma at wxs.nl  Thu Mar 29 11:12:20 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Mar 2012 11:12:20 +0200
Subject: [dev-context] Bugs: \WORD and \WORDS behave identically;
 \Cap and \CAP do nothing
In-Reply-To: <CAF=dkzxLqTV6AaPE5GLWO9wXyOUWYwstZzWf2u10ob8gT4y+Lg@mail.gmail.com>
References: <CAF=dkzz0kn9E1BZmwdx3CfRonZ3+ptFpPb5PzQdSy=SeGtYwVA@mail.gmail.com>
	<4F733E6A.8090107@wxs.nl>
	<CAF=dkzxLqTV6AaPE5GLWO9wXyOUWYwstZzWf2u10ob8gT4y+Lg@mail.gmail.com>
Message-ID: <4F742774.6040303@wxs.nl>

On 28-3-2012 22:46, Sietse Brouwer wrote:

>> The cap you want is something \Word{\smallcaps ...}. The old mkii cap code
>> is mostly a solution for fonts lacking small capitals.
>
> This works for me at home (MkIV), but not on the wiki (MkII). I'm
> running 2012.02.08 MkIV at home, while the wiki runs 2011.10.08 MkII.

for mkii: \sc (which might trigger a smallcaps font if present) or 
\cap{\Word{...}} as there \cap is a font switch

>>> (3) \CAP{some \\{text}} does nothing; the double backslash only
>>> produces a newline.
>>> According to the manual, \CAP changes letters that are preceded by \\
>>> into capital letters.
>
> (Actually, turns out this works under MkII, but not MkIV.)
>
>> Hm. Do we need that kind of stuff? If not (no longer) than we need to fix
>> the (fonts) manual.
>
> I can't imagine anyone being in a position that they *can* insert
> backslashes, but *can't* just capitalize the letters. I see no
> objection to marking this command obsolete, myself. I'm not in a
> position to edit the fonts manual, though.

Ok, let's consider it obsolete in mkiv then. Can you put that on the wiki?

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Mar 29 11:30:48 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Mar 2012 11:30:48 +0200
Subject: [dev-context] Counters
In-Reply-To: <83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
	<83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
Message-ID: <4F742BC8.7000901@wxs.nl>

On 29-3-2012 10:46, Wolfgang Schuster wrote:

> To many names aren?t a good solution but when I have to make a decision I would choose \definecounter because it?s the name which makes more sense. The only thing (besides backward compatibility) is the \makecounter mechanism which use the following commands:

So will we drop the number ones then?

(Making a beta now with the rename of the sets. We have to do this 
stepwise in order to be sure. I also have to adapt the test suite.)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Mar 29 18:38:52 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 29 Mar 2012 18:38:52 +0200
Subject: [dev-context] Counters
In-Reply-To: <4F742BC8.7000901@wxs.nl>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
	<83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
	<4F742BC8.7000901@wxs.nl>
Message-ID: <054B527A-07C5-4B14-BAFB-77938EE5705D@googlemail.com>


Am 29.03.2012 um 11:30 schrieb Hans Hagen:

> On 29-3-2012 10:46, Wolfgang Schuster wrote:
> 
>> To many names aren?t a good solution but when I have to make a decision I would choose \definecounter because it?s the name which makes more sense. The only thing (besides backward compatibility) is the \makecounter mechanism which use the following commands:
> 
> So will we drop the number ones then?

This would only work when you also drop \makecounter because it won?t be usable anymore when \definenumber will be changed to \definecounter.

Wolfgang

From pragma at wxs.nl  Thu Mar 29 19:23:59 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Mar 2012 19:23:59 +0200
Subject: [dev-context] Counters
In-Reply-To: <054B527A-07C5-4B14-BAFB-77938EE5705D@googlemail.com>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
	<83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
	<4F742BC8.7000901@wxs.nl>
	<054B527A-07C5-4B14-BAFB-77938EE5705D@googlemail.com>
Message-ID: <4F749AAF.5020602@wxs.nl>

On 29-3-2012 18:38, Wolfgang Schuster wrote:
>
> Am 29.03.2012 um 11:30 schrieb Hans Hagen:
>
>> On 29-3-2012 10:46, Wolfgang Schuster wrote:
>>
>>> To many names aren?t a good solution but when I have to make a decision I would choose \definecounter because it?s the name which makes more sense. The only thing (besides backward compatibility) is the \makecounter mechanism which use the following commands:
>>
>> So will we drop the number ones then?
>
> This would only work when you also drop \makecounter because it won?t be usable anymore when \definenumber will be changed to \definecounter.

Well, a direct consequence of removing all 'structure' from 
'structurecounter' is indeed that we get \definecounter and therefore 
need to drop the ones in syst-aux (no big deal as they are only used a 
few times and nowadays we have more than enough \count's; we can always 
turn them into \definevaluecounter or so if needed).

Anyhow, I already did a lot of editing so there's no going back now ... 
I'm making a beta that you can check in a while. In the process 
\currentstructurecounter has become \currentsectioncountervalue and some 
macros got value appended as well.

Hans




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Mar 29 21:33:22 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 29 Mar 2012 21:33:22 +0200
Subject: [dev-context] Counters
In-Reply-To: <4F749AAF.5020602@wxs.nl>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
	<83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
	<4F742BC8.7000901@wxs.nl>
	<054B527A-07C5-4B14-BAFB-77938EE5705D@googlemail.com>
	<4F749AAF.5020602@wxs.nl>
Message-ID: <2D32349E-EF24-42DE-AF5C-20F4ECBBEB0A@googlemail.com>


Am 29.03.2012 um 19:23 schrieb Hans Hagen:

> On 29-3-2012 18:38, Wolfgang Schuster wrote:
>> 
>> Am 29.03.2012 um 11:30 schrieb Hans Hagen:
>> 
>>> On 29-3-2012 10:46, Wolfgang Schuster wrote:
>>> 
>>>> To many names aren?t a good solution but when I have to make a decision I would choose \definecounter because it?s the name which makes more sense. The only thing (besides backward compatibility) is the \makecounter mechanism which use the following commands:
>>> 
>>> So will we drop the number ones then?
>> 
>> This would only work when you also drop \makecounter because it won?t be usable anymore when \definenumber will be changed to \definecounter.
> 
> Well, a direct consequence of removing all 'structure' from 'structurecounter' is indeed that we get \definecounter and therefore need to drop the ones in syst-aux (no big deal as they are only used a few times and nowadays we have more than enough \count's; we can always turn them into \definevaluecounter or so if needed).
> 
> Anyhow, I already did a lot of editing so there's no going back now ... I'm making a beta that you can check in a while. In the process \currentstructurecounter has become \currentsectioncountervalue and some macros got value appended as well.

It looks good and I will update my modules to use the new names but what?s with the following helper functions, will you provide synonyms for them or should I use these names (the commands are too useful to not use them myself):

- \strc_counters_register_component
- \strc_counter_setup_using_parameter
- \strc_counter_preset_using_parameter

Wolfgang

From pragma at wxs.nl  Thu Mar 29 21:51:15 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Mar 2012 21:51:15 +0200
Subject: [dev-context] Counters
In-Reply-To: <2D32349E-EF24-42DE-AF5C-20F4ECBBEB0A@googlemail.com>
References: <26ED1045-D0A7-4BE0-A839-E84457879ABB@googlemail.com>
	<4F737D98.5040600@wxs.nl>
	<D8FA3CA1-BA91-4F4F-BEA2-B0357AEA9A4F@googlemail.com>
	<4F741068.3030309@wxs.nl>
	<83793C5F-5CDB-4830-B6A1-8A7D5933EAD7@googlemail.com>
	<4F742BC8.7000901@wxs.nl>
	<054B527A-07C5-4B14-BAFB-77938EE5705D@googlemail.com>
	<4F749AAF.5020602@wxs.nl>
	<2D32349E-EF24-42DE-AF5C-20F4ECBBEB0A@googlemail.com>
Message-ID: <4F74BD33.1090201@wxs.nl>

On 29-3-2012 21:33, Wolfgang Schuster wrote:

> It looks good and I will update my modules to use the new names but what?s with the following helper functions, will you provide synonyms for them or should I use these names (the commands are too useful to not use them myself):
>
> - \strc_counters_register_component
> - \strc_counter_setup_using_parameter
> - \strc_counter_preset_using_parameter

these are quite low level and not meant for regular users

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Apr 12 06:42:54 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 12 Apr 2012 06:42:54 +0200
Subject: [dev-context] \setuphead and conversion key
Message-ID: <75B25F39-E421-4B25-B981-EA83DEA8F84E@googlemail.com>

Hi Hans,

shouldn?t the name of the ?conversion? key be changed to ?sectionconversion? because the other structure key have the names ?sectionset?, ?sectionstarter? etc.

\setuphead[section][conversion=Characters]
%\setuphead[section][sectionconversion=Characters]

\starttext
\section{The letter A}
\stoptext

Wolfgang

From wolfgang.schuster at gmail.com  Thu Apr 12 15:41:52 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 12 Apr 2012 15:41:52 +0200
Subject: [dev-context] strc-ref.lua
Message-ID: <916CA9A8-CC65-4D4D-BADC-6B6B93A1EAD2@gmail.com>

Hi Hans,

can you add the following filters to strc-ref.lua and I would remove ?filters.text.number? because it?s nonsense when \getreference[number][?] delivers a string and not a number.


filters.text = { }

function filters.text.title(data)
    helpers.title(data.entries.text or "?",data.metadata)
end

-function filters.text.number(data)
-    helpers.title(data.entries.text or "?",data.metadata)
-end

function filters.text.page(data,prefixspec,pagespec)
    helpers.prefixpage(data,prefixspec,pagespec)
end

+filters.full = { }

+filters.full.title   = filters.text.title
+filters.full.page    = filters.text.page


Wolfgang

From pragma at wxs.nl  Fri Apr 13 22:49:10 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 13 Apr 2012 22:49:10 +0200
Subject: [dev-context] strc-ref.lua
In-Reply-To: <916CA9A8-CC65-4D4D-BADC-6B6B93A1EAD2@gmail.com>
References: <916CA9A8-CC65-4D4D-BADC-6B6B93A1EAD2@gmail.com>
Message-ID: <4F889146.4070802@wxs.nl>

On 12-4-2012 15:41, Wolfgang Schuster wrote:
> filters.full = { }
>
> +filters.full.title   = filters.text.title
> +filters.full.page    = filters.text.page

ok

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Wed Apr 18 05:36:58 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 17 Apr 2012 23:36:58 -0400 (EDT)
Subject: [dev-context] Spacebefore and spaceafter in strc-mat
Message-ID: <alpine.LNX.2.02.1204172334100.13934@ybpnyubfg.ybpnyqbznva>

Hi,

strc-mat sets:

\def\beforedisplayspace
   {\doifnot{\formulaparameter\c!spacebefore}\v!none{\blank[\formulaparameter\c!spacebefore]}}

\def\afterdisplayspace
   {\doifnot{\formulaparameter\c!spaceafter}\v!none{\blank[\formulaparameter\c!spaceafter ]}}

Other environments that provide spacebefore and spaceafter keys 
(delimiters, floats), do not check if the key is none.

I don't really understand why this check is done. Can we delete this 
check?

Aditya

From netuse at lavabit.com  Wed Apr 18 12:55:18 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 18 Apr 2012 12:55:18 +0200
Subject: [dev-context] Storing and retrieving two-pass data
Message-ID: <20120418125518.2e8a77c9@Zewz>

Hi,

I am trying to  save a string to the .tuc  file and to retrieve
it in the next run. My attempt:

\starttext
\startluacode
	local collected = utilities.storage.allocate()
	local tobesaved = utilities.storage.allocate()

	job.register("job.userdata", tobesaved)

	tobesaved["foo"] = "value_foo"
	tobesaved["bar"] = "value_bar"
\stopluacode
\stoptext

This leads to the following entry in the .tuc file:

utilitydata.job.userdata={
 ["bar"]="value_bar",
 ["foo"]="value_foo",
}

I  expected  to  be  able   to  retrieve  the  data  with  e.g.
collected["foo"], but the collected table is empty. What is the
interface to  retrieve the  values from  the .tuc  file? Aditya
mentioned  that there  will  be  a new  interface  in this  (or
the upcoming) beta.

Marco



From schuster.wolfgang at googlemail.com  Wed Apr 18 13:06:50 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 18 Apr 2012 13:06:50 +0200
Subject: [dev-context] Storing and retrieving two-pass data
In-Reply-To: <20120418125518.2e8a77c9@Zewz>
References: <20120418125518.2e8a77c9@Zewz>
Message-ID: <8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>


Am 18.04.2012 um 12:55 schrieb Marco:

> Hi,
> 
> I am trying to  save a string to the .tuc  file and to retrieve
> it in the next run. My attempt:
> 
> \starttext
> \startluacode
> 	local collected = utilities.storage.allocate()
> 	local tobesaved = utilities.storage.allocate()
> 
> 	job.register("job.userdata", tobesaved)
> 
> 	tobesaved["foo"] = "value_foo"
> 	tobesaved["bar"] = "value_bar"
> \stopluacode
> \stoptext
> 
> This leads to the following entry in the .tuc file:
> 
> utilitydata.job.userdata={
> ["bar"]="value_bar",
> ["foo"]="value_foo",
> }
> 
> I  expected  to  be  able   to  retrieve  the  data  with  e.g.
> collected["foo"], but the collected table is empty. What is the
> interface to  retrieve the  values from  the .tuc  file? Aditya
> mentioned  that there  will  be  a new  interface  in this  (or
> the upcoming) beta.


The following works with the current beta, you can find another example in core-dat.mkiv.

\definedataset[test-1]
\definedataset[test-2]

\starttext

\setdataset[test-1][x=Value X 1,y=Value Y 1]
\setdataset[test-1][x=Value X 2,y=Value Y 2]

\setdataset[test-2][a][name=Ben Lee User,job=Manager]
\setdataset[test-2][b][title=TeX by Topic]

\startlines
\datasetvariable{test-1}{1}{x}:\datasetvariable{test-1}{1}{y}
\datasetvariable{test-1}{2}{x}:\datasetvariable{test-1}{2}{y}
\stoplines

Name: \datasetvariable{test-2}{a}{name} \par
Job: \datasetvariable{test-2}{a}{job} \par

\stoptext

Wolfgang

From netuse at lavabit.com  Wed Apr 18 14:15:53 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 18 Apr 2012 14:15:53 +0200
Subject: [dev-context] Storing and retrieving two-pass data
References: <20120418125518.2e8a77c9@Zewz>
	<8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>
Message-ID: <20120418141553.7cb36e07@Zewz>

On 2012-04-18 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:

> The following works with the current beta, you can find another example in
> core-dat.mkiv.
> 
> [?]

Thanks a  lot. One more  question: How  to address the  last element
without manually keeping track of how  often it was saved? Anyhow, I
am just interested in the last  saved value. A solution which simply
overwrites the old value every time would also be fine.

\starttext
	\definedataset [test]
	\setdataset    [test] [foo=first]
	\setdataset    [test] [foo=second]

	% I don't know that element "2" is the last
	foo is: \datasetvariable{test}{2}{foo}

	% what I need
	% foo is: \datasetvariable{test}{"last"}{foo}
\stoptext

Regards

Marco



From schuster.wolfgang at googlemail.com  Thu Apr 19 13:23:52 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 19 Apr 2012 13:23:52 +0200
Subject: [dev-context] Storing and retrieving two-pass data
In-Reply-To: <20120418141553.7cb36e07@Zewz>
References: <20120418125518.2e8a77c9@Zewz>
	<8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>
	<20120418141553.7cb36e07@Zewz>
Message-ID: <36695353-920B-4AE1-B5BD-8CB7CD172B93@googlemail.com>


Am 18.04.2012 um 14:15 schrieb Marco:

> On 2012-04-18 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:
> 
>> The following works with the current beta, you can find another example in
>> core-dat.mkiv.
>> 
>> [?]
> 
> Thanks a  lot. One more  question: How  to address the  last element
> without manually keeping track of how  often it was saved? Anyhow, I
> am just interested in the last  saved value. A solution which simply
> overwrites the old value every time would also be fine.
> 
> \starttext
> 	\definedataset [test]
> 	\setdataset    [test] [foo=first]
> 	\setdataset    [test] [foo=second]
> 
> 	% I don't know that element "2" is the last
> 	foo is: \datasetvariable{test}{2}{foo}
> 
> 	% what I need
> 	% foo is: \datasetvariable{test}{"last"}{foo}
> \stoptext


\definedataset[test]

\newcounter\testcounter % optional because \increment checks if the command is defined

\startsetups dataset:test

	\doifvariable{test}{foo}
		{
			\doglobal\increment\testcounter
			\setdataset[test][foo=\getvariable{test}{foo}]
		}

\stopsetups

\setvariables[test][set=\texsetup{dataset:test}]

\starttext

\setvariables[test][foo=first]
\setvariables[test][foo=second]

foo is: \datasetvariable{test}{\testcounter}{foo}

\stoptext

Wolfgang

From netuse at lavabit.com  Fri Apr 20 17:30:56 2012
From: netuse at lavabit.com (Marco)
Date: Fri, 20 Apr 2012 17:30:56 +0200
Subject: [dev-context] Storing and retrieving two-pass data
References: <20120418125518.2e8a77c9@Zewz>
	<8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>
	<20120418141553.7cb36e07@Zewz>
	<36695353-920B-4AE1-B5BD-8CB7CD172B93@googlemail.com>
Message-ID: <20120420173056.07d856ed@Zewz>

On 2012-04-19 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:

Hi Wolfgang,

thanks for  the answer. In the first place I also  came up  with a
similar solution  to yours. But  that's what I meant  by ?manually
counting? and  wanted to avoid.  Apparently I missed  the obvious,
there is no special magic needed:

% doesn't seem to be necessary
% \definedataset [test]

\setdataset [test] [foo] [foo=first]
\setdataset [test] [foo] [foo=second]

\setdataset [test] [bar] [bar=first]
\setdataset [test] [bar] [bar=second]
\setdataset [test] [bar] [bar=third]

\starttext
	foo is: \datasetvariable{test}{foo}{foo}\crlf
	bar is: \datasetvariable{test}{bar}{bar}
\stoptext

Wikified:
http://wiki.contextgarden.net/System_Macros/Key_Value_Assignments#Two-pass_data


Have a nice weekend

Marco Patzer



From pragma at wxs.nl  Sun Apr 22 12:03:51 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 22 Apr 2012 12:03:51 +0200
Subject: [dev-context] Storing and retrieving two-pass data
In-Reply-To: <20120420173056.07d856ed@Zewz>
References: <20120418125518.2e8a77c9@Zewz>
	<8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>
	<20120418141553.7cb36e07@Zewz>
	<36695353-920B-4AE1-B5BD-8CB7CD172B93@googlemail.com>
	<20120420173056.07d856ed@Zewz>
Message-ID: <4F93D787.4020001@wxs.nl>

On 20-4-2012 17:30, Marco wrote:
> On 2012-04-19 Wolfgang Schuster<schuster.wolfgang at googlemail.com>  wrote:
>
> Hi Wolfgang,
>
> thanks for  the answer. In the first place I also  came up  with a
> similar solution  to yours. But  that's what I meant  by ?manually
> counting? and  wanted to avoid.  Apparently I missed  the obvious,
> there is no special magic needed:
>
> % doesn't seem to be necessary
> % \definedataset [test]
>
> \setdataset [test] [foo] [foo=first]
> \setdataset [test] [foo] [foo=second]
>
> \setdataset [test] [bar] [bar=first]
> \setdataset [test] [bar] [bar=second]
> \setdataset [test] [bar] [bar=third]
>
> \starttext
> 	foo is: \datasetvariable{test}{foo}{foo}\crlf
> 	bar is: \datasetvariable{test}{bar}{bar}
> \stoptext
>
> Wikified:
> http://wiki.contextgarden.net/System_Macros/Key_Value_Assignments#Two-pass_data

Maybe you should add a note about \detupdatase[test][delay=yes] as 
option. In that case a node is injected and the dataset is extended with 
'realpage', 'index' and 'order' information with the realpage being 
synchronized when the node is flushed.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From netuse at lavabit.com  Sun Apr 22 16:08:23 2012
From: netuse at lavabit.com (Marco)
Date: Sun, 22 Apr 2012 16:08:23 +0200
Subject: [dev-context] Storing and retrieving two-pass data
References: <20120418125518.2e8a77c9@Zewz>
	<8219268B-17E3-4D69-93A7-EAD24E452BF6@googlemail.com>
	<20120418141553.7cb36e07@Zewz>
	<36695353-920B-4AE1-B5BD-8CB7CD172B93@googlemail.com>
	<20120420173056.07d856ed@Zewz> <4F93D787.4020001@wxs.nl>
Message-ID: <20120422160823.2959a69c@Zewz>

On 2012-04-22 Hans Hagen <pragma at wxs.nl> wrote:

> > Wikified:
> > http://wiki.contextgarden.net/System_Macros/Key_Value_Assignments#Two-pass_data
> 
> Maybe you should add a note about \detupdatase[test][delay=yes] as 
> option.

Done.

http://wiki.contextgarden.net/System_Macros/Key_Value_Assignments#Two-pass_data
http://wiki.contextgarden.net/Command/definedataset

Marco



From netuse at lavabit.com  Tue Apr 24 10:11:37 2012
From: netuse at lavabit.com (Marco)
Date: Tue, 24 Apr 2012 10:11:37 +0200
Subject: [dev-context] Bug in pgfplots module
Message-ID: <20120424101137.0bc99262@Zewz>

Hi,

the pgfplots module t-pgfplots.tex lacks an \unprotect \protect
pair, which causes a catcode error in the file

numtable/pgfplotstable.code.tex on lines 1042-1045:

{
	\catcode`\^^I=12
	\gdef\pgfplotstablesave at impl@TAB{^^I}
}

Suggested fix:

--- texmf-modules/tex/context/third/pgfplots/t-pgfplots.tex~	2012-04-24 10:01:24.972183906 +0200
+++ texmf-modules/tex/context/third/pgfplots/t-pgfplots.tex	2012-04-24 10:03:13.712723135 +0200
@@ -27,6 +27,8 @@
 \usemodule[tikz]
 \usetikzlibrary[plotmarks]
 
+\unprotect
+
 \edef\tikzatcode{\the\catcode`\@}
 \edef\tikzbarcode{\the\catcode`\|}
 \edef\tikzexclaimcode{\the\catcode`\!}
@@ -61,4 +63,6 @@
 \catcode`\|=\tikzbarcode
 \catcode`\!=\tikzexclaimcode
 
+\protect
+
 \endinput


I don't know who is responsible for that and if it needs to be fixed
upstream or if the module is a part of ConTeXt.


Best wishes

Marco Patzer



From mojca.miklavec.lists at gmail.com  Tue Apr 24 10:26:50 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 24 Apr 2012 10:26:50 +0200
Subject: [dev-context] Bug in pgfplots module
In-Reply-To: <20120424101137.0bc99262@Zewz>
References: <20120424101137.0bc99262@Zewz>
Message-ID: <CALBOmsZW8ofU0-AjhUVz_c+ai50K1_6qmTzdYkc1EbZ8rgroPQ@mail.gmail.com>

On Tue, Apr 24, 2012 at 10:11, Marco wrote:
> Hi,
>
> the pgfplots module t-pgfplots.tex lacks an \unprotect \protect
> pair, which causes a catcode error in the file
>
> numtable/pgfplotstable.code.tex on lines 1042-1045:
>
> {
> ? ? ? ?\catcode`\^^I=12
> ? ? ? ?\gdef\pgfplotstablesave at impl@TAB{^^I}
> }
>
> Suggested fix:
>
> --- texmf-modules/tex/context/third/pgfplots/t-pgfplots.tex~ ? ?2012-04-24 10:01:24.972183906 +0200
> +++ texmf-modules/tex/context/third/pgfplots/t-pgfplots.tex ? ? 2012-04-24 10:03:13.712723135 +0200
> @@ -27,6 +27,8 @@
> ?\usemodule[tikz]
> ?\usetikzlibrary[plotmarks]
>
> +\unprotect
> +
> ?\edef\tikzatcode{\the\catcode`\@}
> ?\edef\tikzbarcode{\the\catcode`\|}
> ?\edef\tikzexclaimcode{\the\catcode`\!}
> @@ -61,4 +63,6 @@
> ?\catcode`\|=\tikzbarcode
> ?\catcode`\!=\tikzexclaimcode
>
> +\protect
> +
> ?\endinput
>
>
> I don't know who is responsible for that and if it needs to be fixed
> upstream or if the module is a part of ConTeXt.

The module is maintained by Christian Feuersaenger. I'm forwarding
your email to him. (Loading the module fails for me as well.)

However, I think that I'm not entirely innocent either. I'm still
fetching pgfplots from CVS and I just realized that the project
switched to GIT. (Nobody ever complained so far.) But there's no
unprotect/protect in git repository either, so it is not just due to
outdated sources. Christian - is there any chance to use git & TDS for
pgf as well?

Mojca

From sbbrouwer at gmail.com  Wed Apr 25 15:16:59 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Wed, 25 Apr 2012 15:16:59 +0200
Subject: [dev-context] \setuppapersize: mirrored, negative, rotated,
	etc. not working in mkiv
Message-ID: <CAF=dkzwfS1xKyQFy8NdtyXnED-UZGxDyAzxS2o73JgeeQg47TQ@mail.gmail.com>

Hi,

While working on the wiki I discovered that mkiv fails on a few
\setuppapersizes keys. Minimal example below. I'm using
mkiv, 2012.04.19 23:18. mkii does it all with no problems. I
discovered this while working out what the various keys do; I myself
don't need a fix.

--Sietse

% negative causes an 'undefined control sequence' error.
% So do mirrored, 90, 180, and 270.
% rotated causes no error, but does nothing

% \setuppapersize[A6][A5] % works

\setuppapersize[A6,negative][A5] %fails

\starttext
asdf
\stoptext

From schuster.wolfgang at googlemail.com  Thu Apr 26 18:08:50 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 26 Apr 2012 18:08:50 +0200
Subject: [dev-context] page-brk.mkvi
Message-ID: <6A2CE561-F03D-4F8D-8586-D12FFA468162@googlemail.com>

Hi Hans,

can you add this to page-brk.mkvi

\installpagebreakmethod \v!left
  {\page_otr_flush_all_floats
   \page_otr_command_next_page_and_inserts
   \doifbothsidesoverruled{}{\resetcurrentstructuremarkswithpage\page_otr_insert_dummy_page}{}}

There is a comment in the file

% \installpagebreakmethod \v!left  {} % defined in page-txt.mkiv

to look at page-txt.mkvi for the method but it isn?t defined there.

Wolfgang

From sbbrouwer at gmail.com  Sat May 12 23:31:43 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Sat, 12 May 2012 23:31:43 +0200
Subject: [dev-context] Streams: compensation not happening correctly.
Message-ID: <CAF=dkzwJT9WVr0q8+o8cLNOmignmLNZmeHsT8+rMVj4tCasHGQ@mail.gmail.com>

Hi all,

I was trying to work out the streams mechanism, and found the
following bug (I call my streams [left] and [right]):

* An unwanted extra compensating line is inserted after the first
block of the [left] stream that is as tall as, or shorter than, its
corresponding block in the [right] stream.
* If that extra line has not yet been inserted, then when two blocks
have the same height the one on the [left] is wrongly measured as
being shorter. (For a single line containing a capital A, it's 561512
vs 932551.)
* This happens only once: subsequent identical-content blocks will
indeed have identical heights.

This is just a bug report; for me, at least, a fix is not required.
Minimal example and relevant bit from its output log below.

Cheers,

Sietse
Sietse Brouwer

---- minimal example ----

\enabletrackers[streams.flushing]

\setuplayout[grid=yes]
\showgrid

\starttext
\enableoutputstream[left]
    A
    %\input ward
    \par \pushoutputstream
    % Unwanted compensating line inserted here
    B \par \pushoutputstream
    % If the Ward paragraph is enabled, the extra line is inserted
here, instead.
    C \par \pushoutputstream
\enableoutputstream[right]
    A \par \pushoutputstream
    B \par \pushoutputstream
    C \par \pushoutputstream
\disableoutputstream

\synchronizestreams[left,right]

\page \flushoutputstream[left]
\page \flushoutputstream[right]
\stoptext


-------- excerpt from output log -----------

streams         > synchronizing list: left right
streams         > maximum number of slots: 4
streams         > slot 1 of 'left' is packed to height 561512 and depth 0
streams         > slot 1 of 'right' is packed to height 932551 and depth 0
streams         > slot 1 has max height 932551 and max depth 0
streams         > slot 1:1 with delta (371039,0) is compensated by 1 lines
streams         > slot 2 of 'left' is packed to height 949066 and depth 0
streams         > slot 2 of 'right' is packed to height 949066 and depth 0
streams         > slot 2 has max height 949066 and max depth 0
streams         > slot 3 of 'left' is packed to height 949066 and depth 16515
streams         > slot 3 of 'right' is packed to height 949066 and depth 16515
streams         > slot 3 has max height 949066 and max depth 16515
streams         > slot 4 has max height 0 and max depth 0
streams         > flushing 4 slots of 'left'
backend         > xmp > using file
'/opt/context/tex/texmf-context/tex/context/base/lpdf-pdx.xml'
pages           > flushing realpage 1, userpage 1
streams         > flushing 4 slots of 'right'
pages           > flushing realpage 2, userpage 2

From netuse at lavabit.com  Wed May 16 19:24:25 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 16 May 2012 19:24:25 +0200
Subject: [dev-context] Wrong structure numbers in margin
Message-ID: <20120516192425.373d6eac@Zewz>

Hi Hans,

could you check the definition of \placeheadmarginalternative in
strc-ren.mkiv? The current solution fails when structure number are
set to ?margin? in a doublesided layout because of the hard-coded
\leftmargindistance. The ?maybe better? solution actually seems to
work better.

\setuplayout
  [backspace=8cm,
   width=5cm,
   leftmargindistance=2cm]

\setuppagenumbering
  [alternative=doublesided]

\setupheads
  [alternative=margin]

\unexpanded\def\placeheadmarginalternative#1#2%
  {\vbox
     {\localheadsetup
      \begstrut % use one \strut here!
      \dontleavehmode % in case there is no strut, else side effects with llap
      \ifconditional\headshownumber
				% this gives a wrong result on the second page
        %\llap{\hbox{\hfill{#1}\hskip\localheadskip\hskip\leftmargindistance}}% introduces whitespace
        % maybe better:
         \inleftmargin{\hbox{\hss{#1}\hskip\localheadskip}}%
      \fi
      {#2}}}

\showframe
\starttext
  \chapter{Chapter}
  \null\page
  \section{Section}
  \subsection{Subsection}
  \subsubsection{Subsubsection}
\stoptext


Regards

Marco Patzer



From schuster.wolfgang at googlemail.com  Wed May 16 19:58:00 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 16 May 2012 19:58:00 +0200
Subject: [dev-context] Wrong structure numbers in margin
In-Reply-To: <20120516192425.373d6eac@Zewz>
References: <20120516192425.373d6eac@Zewz>
Message-ID: <79C76D7C-74DE-4076-8EF5-99109F33FD0A@googlemail.com>


Am 16.05.2012 um 19:24 schrieb Marco:

> Hi Hans,
> 
> could you check the definition of \placeheadmarginalternative in
> strc-ren.mkiv? The current solution fails when structure number are
> set to ?margin? in a doublesided layout because of the hard-coded
> \leftmargindistance. The ?maybe better? solution actually seems to
> work better.

\inleftmargin can be a problem when you have another margin data command before the heading.

> \unexpanded\def\placeheadmarginalternative#1#2%
>  {\vbox
>     {\localheadsetup
>      \begstrut % use one \strut here!
>      \dontleavehmode % in case there is no strut, else side effects with llap
>      \ifconditional\headshownumber
> 				% this gives a wrong result on the second page
>        %\llap{\hbox{\hfill{#1}\hskip\localheadskip\hskip\leftmargindistance}}% introduces whitespace
>        % maybe better:
>         \inleftmargin{\hbox{\hss{#1}\hskip\localheadskip}}%
>      \fi
>      {#2}}}


It?s simpler to check for odd/even page and use the right dimension:

\unexpanded\def\placeheadmarginalternative#1#2%
 {\vbox
    {\localheadsetup
     \begstrut % use one \strut here!
     \dontleavehmode % in case there is no strut, else side effects with llap
     \ifconditional\headshownumber
       \llap{\hbox{\hfill{#1}\hskip\dimexpr\localheadskip+\doifoddpageelse\leftmargindistance\rightmargindistance\relax}}% introduces whitespace
     \fi
     {#2}}}

Wolfgang

From pragma at wxs.nl  Wed May 16 23:33:13 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 16 May 2012 23:33:13 +0200
Subject: [dev-context] Esperanto
In-Reply-To: <20120516172357.0f2e6593@freenet.de>
References: <20120516141711.1467a75a@freenet.de>
	<BFA488C0-9A99-478A-85ED-1333511D4480@googlemail.com>
	<20120516154245.5bc28da1@freenet.de>
	<2BB14DDA-98D7-4BFD-A664-CCACFE0018E5@googlemail.com>
	<20120516172357.0f2e6593@freenet.de>
Message-ID: <4FB41D19.6000103@wxs.nl>

On 16-5-2012 17:23, Peter Schorsch wrote:
> Hallo Hans,
>
> would you mind to add Esperanto to the valid languages of ConTeXt? And
> do you need any additional infos to do so?

It depends on how much support you want.

- for basic language support we need an entry in lang-def.mkiv
- for labels we need entries in lang-txt.lua
- for patterns you need to check with Mojca what file we need to use
- if you also want commanda and keywords in esperanto we need to extend 
mult-def.lua

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu May 17 12:11:34 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 17 May 2012 12:11:34 +0200
Subject: [dev-context] \startframed and parameters
Message-ID: <F0B26E5A-617C-4ACD-ADEC-0868B9076900@googlemail.com>

Hi Hans,

\startframed doesn?t accept local settings because \pack_framed_process expects two arguments.


Here is only one optional argument

\unexpanded\def\startframed
  {\dosingleempty\pack_framed_start_framed}

\def\pack_framed_start_framed[#1]%
  {\bgroup
   \advance\framednesting\plusone
   \expandafter\let\csname\??ol:\the\framednesting\s!parent\endcsname\??ol
   \pack_framed_process[\??ol:\the\framednesting][#1]%
   \bgroup}

while \framed accepts two

\unexpanded\def\framed
  {\bgroup
   \advance\framednesting\plusone
   \expandafter\let\csname\??ol:\the\framednesting\s!parent\endcsname\??ol
   \dodoubleempty\pack_framed_process[\??ol:\the\framednesting]}

and \pack_framed_process checks for the second argument:

\unexpanded\def\pack_framed_process[#1][#2]% assumes a \dodoubleempty (slows down), also should have leading \bgroup
  {\bgroup
   \pack_framed_initialize{#1}%
   \ifsecondargument % faster
     \getparameters[\currentframed][#2]% here !
   \fi
   \pack_framed_process_indeed}


Test file:

\starttext

\secondargumentfalse % was true from a previous command but should be false

\startframed[frame=off]text\stopframed

\framed[frame=off]{text}

\stoptext

Wolfgang

From schuster.wolfgang at googlemail.com  Thu May 17 14:40:31 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 17 May 2012 14:40:31 +0200
Subject: [dev-context] \startframed and parameters
In-Reply-To: <4FB4E9AB.4090507@wxs.nl>
References: <F0B26E5A-617C-4ACD-ADEC-0868B9076900@googlemail.com>
	<4FB4E9AB.4090507@wxs.nl>
Message-ID: <682ECF86-97BE-44AB-B60E-14B7E53B92DA@googlemail.com>


Am 17.05.2012 um 14:06 schrieb Hans Hagen:

> On 17-5-2012 12:11, Wolfgang Schuster wrote:
> 
>> \unexpanded\def\startframed
>>   {\dosingleempty\pack_framed_start_framed}
> >
> > ...
> 
> so we should have
> 
> \def\pack_framed_start_framed[#1]%
>  {\bgroup
>   \advance\framednesting\plusone
>   \expandafter\let\csname\??ol:\the\framednesting\s!parent\endcsname\??ol
>   \secondargumenttrue % dirty trick
>   \pack_framed_process[\??ol:\the\framednesting][#1]%
>   \bgroup}


Better:

\iffirstargument\secondargumenttrue\fi

Wolfgang

From pragma at wxs.nl  Thu May 17 14:06:03 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 17 May 2012 14:06:03 +0200
Subject: [dev-context] \startframed and parameters
In-Reply-To: <F0B26E5A-617C-4ACD-ADEC-0868B9076900@googlemail.com>
References: <F0B26E5A-617C-4ACD-ADEC-0868B9076900@googlemail.com>
Message-ID: <4FB4E9AB.4090507@wxs.nl>

On 17-5-2012 12:11, Wolfgang Schuster wrote:

> \unexpanded\def\startframed
>    {\dosingleempty\pack_framed_start_framed}
 >
 > ...

so we should have

\def\pack_framed_start_framed[#1]%
   {\bgroup
    \advance\framednesting\plusone
    \expandafter\let\csname\??ol:\the\framednesting\s!parent\endcsname\??ol
    \secondargumenttrue % dirty trick
    \pack_framed_process[\??ol:\the\framednesting][#1]%
    \bgroup}





-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Wed May 23 03:26:05 2012
From: preining at logic.at (Norbert Preining)
Date: Wed, 23 May 2012 10:26:05 +0900
Subject: [dev-context] debugging mtxrun
Message-ID: <20120523012605.GB20502@gamma.logic.tuwien.ac.at>

Hi Mojca, hi everyone,

can someone please help me getting mtxrun work properly on Debian
again???

Ok, I have current luatex, and current context from TL2012 packaged
for Debian.

In Debian we have a bit a funny layout:
	/usr/share/texlive/texmf-dist
	/usr/share/texlive/texmf
	/usr/share/texmf
	/etc/texmf


I have edited texmfcnf.lua which is located in /usr/share/texmf/web2c
to look like (only relevant parts extracted):
...
local texmflocal = "/usr/local/share/texmf";
..
            TEXMFSYSVAR     = "/var/lib/texmf",
            TEXMFVAR        = "home:.texmf-var",
...
            TEXMFCACHE      = "$TEXMFSYSVAR;$TEXMFVAR",
            TEXMFCONFIG     = "home:texmf-config",
...
            TEXMFMAIN       = "/usr/share/texlive/texmf",
            TEXMFDIST       = "/usr/share/texlive/texmf-dist",
            TEXMFCONTEXT    = "/usr/share/texmf",

            TEXMFLOCAL      = /usr/local/share/texmf",
            TEXMFSYSCONFIG  = "/etc/texmf",
....
            TEXMF           = "{$TEXMFCONFIG,$TEXMFVAR,$TEXMFHOME,$TEXMFSYSCONFIG,!!$TEXMFSYSVAR,!!$TEXMFLOCAL,!!$TEXMFCONTEXT,!!$TEXMFMAIN,!!$TEXMFDIST}",



(the TEMXCONFI is actually a bug and should be .texmf-config)

But, mtxrun does not find anything....
# mtxrun  --generate --verbose

resolvers       | resolving | creating instance
resolvers       | resolving | variable 'SELFAUTOLOC' set to '/usr/bin'
resolvers       | resolving | variable 'SELFAUTODIR' set to '/usr'
resolvers       | resolving | variable 'SELFAUTOPARENT' set to '.'
resolvers       | resolving | variable 'TEXMFCNF' set to ''
resolvers       | resolving | variable 'TEXMF' set to ''
resolvers       | resolving | variable 'TEXOS' set to '/usr'
resolvers       | resolving |
resolvers       | resolving | using configuration specification 'home:texmf/web2c;selfautoparent:texmf{-local,-context,}/web2c'
resolvers       | resolving |
resolvers       | resolving | unknown configuration file '/root/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmf-context/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmf/web2c/texmfcnf.lua'
resolvers       | resolving |
resolvers       | resolving | warning: no lua configuration files found
resolvers       | resolving | no texmf paths are defined (using TEXMF)
resolvers       | resolving |
mtxrun          |
mtxrun          | runtime: 0.008 seconds

#

which is unlucky ....

I guess I have to *edit* mtxrun to make it find the texmf.cnf files?
But I have no idea what I have to do.

In addition, when I do:
# TEXMFCNF="/usr/share/texmf/web2c/;/etc/texmf/web2c" mtxrun --generate --verbose
it find the proper texmfcnf.lua, but seems to not be interested in reading
the right values from it:
# TEXMFCNF="/usr/share/texmf/web2c/;/etc/texmf/web2c" mtxrun --generate --verbose

resolvers       | resolving | creating instance
resolvers       | resolving | variable 'SELFAUTOLOC' set to '/usr/bin'
resolvers       | resolving | variable 'SELFAUTODIR' set to '/usr'
resolvers       | resolving | variable 'SELFAUTOPARENT' set to '.'
resolvers       | resolving | variable 'TEXMFCNF' set to '/usr/share/texmf/web2c/;/etc/texmf/web2c'
resolvers       | resolving | variable 'TEXMF' set to ''
resolvers       | resolving | variable 'TEXOS' set to '/usr'
resolvers       | resolving |
resolvers       | resolving | using configuration specification '/usr/share/texmf/web2c/;/etc/texmf/web2c'
resolvers       | resolving |
resolvers       | resolving | found configuration file '/usr/share/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/etc/texmf/web2c/texmfcnf.lua'
resolvers       | resolving |
resolvers       | resolving | skipping configuration file '/usr/share/texmf/web2c/texmfcnf.lua' (no file)
resolvers       | resolving | no texmf paths are defined (using TEXMF)
resolvers       | resolving |
mtxrun          |
mtxrun          | runtime: 0.007 seconds
#

Any help appreciated... otherwise we continue shipping 2011 context
in a broken state in Debian :-( or worse, I have to call for removal
before freeze.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
ALLTAMI (n.)
The ancient art of being able to balance the hot and cold shower taps.
			--- Douglas Adams, The Meaning of Liff

From adityam at umich.edu  Wed May 23 06:43:25 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 May 2012 00:43:25 -0400 (EDT)
Subject: [dev-context] Local settings for frame borders
Message-ID: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>

Hi,

Currently it is not possible to individually set the thickness of the 
different borders of a frame. A typical use-case is typesetting a table 
row where the top frame is double the thichness of the bottom frame. 
Having to resort to metapost for something as simple as this is a bit 
annoying.

Attached is a metapost library that defines "local" fences and allows you 
to set border individually. For example

\defineframed[...][frame=off, topframe=local, topframethickness=1pt, 
bottomframe=local, bottomframethickness=0.5pt]

sets the top frame to be 1pt and the bottomframe to be 0.5pt.

Does it make sense to include this (appropriately modified) in the core? 
Or is it better to distribute such enhancements as a user module.

Aditya
-------------- next part --------------
%D \module
%D   [       file=meta-imp-local-fences,
%D        version=2012.05.23,
%D          title=\METAPOST\ Graphics,
%D       subtitle=Fences,
%D         author=Aditya Mahajan,
%D           date=\currentdate,
%D      copyright={Aditya Mahajan}]
%C

%D This module allows one to set the thickness and color of each side of a
%D frame.

\unprotect
\def\insall_local_fence_handler#1#2%
    {\startuniqueMPgraphic {#1_local_fence}
        draw #1boundary OverlayBox 
          withpen pensquare scaled (\the\dimexpr\framedparameter{#2\c!rulethickness}\relax) 
          withcolor \MPcolor{\framedparameter{#2\c!framecolor}} ;
        
        setbounds currentpicture to OverlayBox ;
      \stopuniqueMPgraphic
      \setupframed[#2\c!rulethickness=\c!rulethickness, #2\c!framecolor=\c!framecolor]
      \getvalue{install#1framerenderer}\v!local {\uniqueMPgraphic{#1_local_fence}}}


\insall_local_fence_handler {top}    \v!top
\insall_local_fence_handler {bottom} \v!bottom
\insall_local_fence_handler {left}   \v!left
\insall_local_fence_handler {right}  \v!right


\protect

\continueifinputfile{meta-imp-local-fences.mkiv}

% Typo in pack-fen.mkiv
\unprotected
\let\setinstalledframedimensions\pack_framed_overlay_initialize_indeed

\defineframed
  [colorful]
  [
    toprulethickness=1pt,
    topframecolor=red,
    bottomrulethickness=2pt,
    bottomframecolor=blue,
    leftrulethickness=3pt,
    leftframecolor=green,
    rightrulethickness=4pt,
    rightframecolor=yellow,
    frame=off,
    topframe=local,
    bottomframe=local,
    rightframe=local,
    leftframe=local,
  ]

\colorful{Hello world}

\stoptext

From netuse at lavabit.com  Wed May 23 11:20:30 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 23 May 2012 11:20:30 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
Message-ID: <20120523112030.62035fd5@Zewz>

On 2012-05-23 Aditya Mahajan <adityam at umich.edu> wrote:

Hi Aditya,

> Currently it is not possible to individually set the thickness of
> the different borders of a frame. A typical use-case is
> typesetting a table row where the top frame is double the
> thichness of the bottom frame. Having to resort to metapost for
> something as simple as this is a bit annoying.

ACK

> Attached is a metapost library that defines "local" fences and
> allows you to set border individually.

A typo in your library:

- \def\insall_local_fence_handler#1#2%
+ \def\install_local_fence_handler#1#2%

It makes sense to add the ?tight? handler as well. It makes sense
especially when the table header consists of multiple rows and
column spans and is often used.

> Does it make sense to include this (appropriately modified) in the
> core? Or is it better to distribute such enhancements as a user
> module.

If it goes into the core, I'll write the wiki pages.

Aditya, thanks an awful lot for your effort and code for a better
user interface for the typesetting of tables.


Marco Patzer



From schuster.wolfgang at googlemail.com  Wed May 23 14:55:59 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 23 May 2012 14:55:59 +0200
Subject: [dev-context] pack-fen.mkiv
Message-ID: <7F73B8EB-24CA-4762-A393-D9224BBAFF82@googlemail.com>

Hi,

\ifdefined \pack_framed_overlay_initialize_indeed

-   \let\installedframedimensions\pack_framed_overlay_initialize_indeed
+   \let\setinstalledframedimensions\pack_framed_overlay_initialize_indeed

\else

    ...

\fi

Wolfgang

From schuster.wolfgang at googlemail.com  Wed May 23 15:03:18 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 23 May 2012 15:03:18 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
Message-ID: <52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>


Am 23.05.2012 um 06:43 schrieb Aditya Mahajan:

> Hi,
> 
> Currently it is not possible to individually set the thickness of the different borders of a frame. A typical use-case is typesetting a table row where the top frame is double the thichness of the bottom frame. Having to resort to metapost for something as simple as this is a bit annoying.
> 
> Attached is a metapost library that defines "local" fences and allows you to set border individually. For example
> 
> \defineframed[...][frame=off, topframe=local, topframethickness=1pt, bottomframe=local, bottomframethickness=0.5pt]
> 
> sets the top frame to be 1pt and the bottomframe to be 0.5pt.
> 
> Does it make sense to include this (appropriately modified) in the core? Or is it better to distribute such enhancements as a user module.

I modified your code to bring it in the same form as meta-imp-fen.mkiv. The best form of distribution is when Hans add it to the core because you can load it then with \useMPlibrary[?] in your document.

Wolfgang
-------------- next part --------------
A non-text attachment was scrubbed...
Name: meta-imp-loc.mkiv
Type: application/octet-stream
Size: 2108 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120523/d3c6b532/attachment.obj>

From netuse at lavabit.com  Wed May 23 15:40:54 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 23 May 2012 15:40:54 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
Message-ID: <20120523154054.3c0e2d33@Zewz>

On 2012-05-23 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:

> I modified your code to bring it in the same form as meta-imp-fen.mkiv.

? and introduces some bugs: multiple topboundary

Frankly, I feel that Adityas \install_local_fence_handler was a
pretty neat solution. It looks cleaner, avoids redundancy and
prevents copy-paste errors ;)

I fixed the boundaries and added the ?tight? fences.

> The best form of distribution is when Hans add it to the core
> because you can load it then with \useMPlibrary[?] in your
> document.

If this goes into the core, maybe we should change the name to
something less dull and more meaningful than ?loc?. Or just merge
the code into meta-imp-fen.mkiv

Thanks also to you, Wolfgang!

Marco Patzer



From netuse at lavabit.com  Wed May 23 15:41:54 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 23 May 2012 15:41:54 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
Message-ID: <20120523154154.51cc2798@Zewz>

And here we go again, including the file.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: meta-imp-loc.mkiv
Type: application/octet-stream
Size: 4123 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120523/15c37099/attachment.obj>

From schuster.wolfgang at googlemail.com  Wed May 23 15:56:10 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 23 May 2012 15:56:10 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <20120523154154.51cc2798@Zewz>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
Message-ID: <333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>


Am 23.05.2012 um 15:41 schrieb Marco:

> And here we go again, including the file.

You can replace

  \the\dimexpr\framedparameter{?}

with

  \frameddimension{?}

and

  \overlaylinewidth

with

  OverlayLineWidth


You can also replace

  \MPcolor{\overlaylinecolor}

with (can be found in meta-ini.mkiv)

  OverlayLineColor


BTW: Don?t you want different rules (toprulethicknes, bottomrulethickness etc.) for the ?tight? frames?

Wolfgang


From adityam at umich.edu  Wed May 23 16:30:45 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 May 2012 10:30:45 -0400 (EDT)
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
Message-ID: <alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>

On Wed, 23 May 2012, Wolfgang Schuster wrote:

>
> Am 23.05.2012 um 15:41 schrieb Marco:
>
>> And here we go again, including the file.
>
> You can replace
>
>  \the\dimexpr\framedparameter{?}
>
> with
>
>  \frameddimension{?}

In my tests that was failing. IIRC, that was because rulethickness is 
equal to \linewidth, which is a \dimen register. To be usable in MP, 
we need \the\linewidth.

Aditya

From schuster.wolfgang at googlemail.com  Wed May 23 16:44:00 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Wed, 23 May 2012 16:44:00 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>
Message-ID: <56329A71-76CD-4A5A-BA60-6FC2E97AF3BF@googlemail.com>


Am 23.05.2012 um 16:30 schrieb Aditya Mahajan:

> On Wed, 23 May 2012, Wolfgang Schuster wrote:
> 
>> 
>> Am 23.05.2012 um 15:41 schrieb Marco:
>> 
>>> And here we go again, including the file.
>> 
>> You can replace
>> 
>> \the\dimexpr\framedparameter{?}
>> 
>> with
>> 
>> \frameddimension{?}
> 
> In my tests that was failing. IIRC, that was because rulethickness is equal to \linewidth, which is a \dimen register. To be usable in MP, we need \the\linewidth.

Do you have a minimal example because this is how \frameddimension is defined:

\def\frameddimension#1{\the\dimexpr\framedparameter{#1}\relax}


In this example I get the correct value for rulethickness:

\starttext

\unprotected\let\currentframed\??framed

\frameddimension{rulethickness}

\stoptext

Wolfgang

From pragma at wxs.nl  Wed May 23 16:44:24 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 23 May 2012 16:44:24 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>
Message-ID: <4FBCF7C8.1030400@wxs.nl>

On 23-5-2012 16:30, Aditya Mahajan wrote:
> On Wed, 23 May 2012, Wolfgang Schuster wrote:
>
>>
>> Am 23.05.2012 um 15:41 schrieb Marco:
>>
>>> And here we go again, including the file.
>>
>> You can replace
>>
>> \the\dimexpr\framedparameter{?}
>>
>> with
>>
>> \frameddimension{?}
>
> In my tests that was failing. IIRC, that was because rulethickness is
> equal to \linewidth, which is a \dimen register. To be usable in MP, we
> need \the\linewidth.

or play safe: \the\dimexpr\whateverhasadimenvalue which works with a 
register as well as a macro

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Wed May 23 16:54:53 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 23 May 2012 10:54:53 -0400 (EDT)
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <56329A71-76CD-4A5A-BA60-6FC2E97AF3BF@googlemail.com>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<alpine.LNX.2.02.1205231026580.11992@ybpnyubfg.ybpnyqbznva>
	<56329A71-76CD-4A5A-BA60-6FC2E97AF3BF@googlemail.com>
Message-ID: <alpine.LNX.2.02.1205231054070.11992@ybpnyubfg.ybpnyqbznva>

On Wed, 23 May 2012, Wolfgang Schuster wrote:

>
> Am 23.05.2012 um 16:30 schrieb Aditya Mahajan:
>
>> On Wed, 23 May 2012, Wolfgang Schuster wrote:
>>
>>>
>>> Am 23.05.2012 um 15:41 schrieb Marco:
>>>
>>>> And here we go again, including the file.
>>>
>>> You can replace
>>>
>>> \the\dimexpr\framedparameter{?}
>>>
>>> with
>>>
>>> \frameddimension{?}
>>
>> In my tests that was failing. IIRC, that was because rulethickness is equal to \linewidth, which is a \dimen register. To be usable in MP, we need \the\linewidth.
>
> Do you have a minimal example because this is how \frameddimension is defined:
>
> \def\frameddimension#1{\the\dimexpr\framedparameter{#1}\relax}

Sorry, I misread your comment (\frameparameter instread of 
\frameddimension). Of course, \frameddimension should work fine.

Aditya

From netuse at lavabit.com  Wed May 23 19:05:14 2012
From: netuse at lavabit.com (Marco)
Date: Wed, 23 May 2012 19:05:14 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
Message-ID: <20120523190514.437da0d6@Zewz>

On 2012-05-23 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:

> You can replace
>
> [?]

> BTW: Don?t you want different rules (toprulethicknes,
> bottomrulethickness etc.) for the ?tight? frames?

It makes sense, yes. I added the code to the module. For my tables
the code works just fine (I don't use all the features). However, a
small test file fails miserably. The code in the current state has
several issues.

? The tight frames need a top/bottom?rulethickness setting,
otherwise it breaks the compilation. The values should be inherited
from the global rulethickness value if the individual rulethicknesss
are absent.

? Almost everything interferes with each other. See the topframes in
the table or the colorfullocalb example. It it coloured, but should
be black. I guess that's because they use the same global \framed
name space.

? For the tight frames the rulethickness is not taken into account
when placing the lines, which leads to strange offsets. See examples
colorfultight and colorfultightb.

These issues should be fixed before the module goes into the core.
This does not mean that *you* have to fix these issues! For me the
code works, but I guess for most other people the code will fail.

I will check how to improve the code. If anyone has suggestions or
fixes, please don't hesitate sharing them.

Marco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: meta-imp-loc.mkiv
Type: application/octet-stream
Size: 5999 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120523/bdff2a90/attachment.obj>

From preining at logic.at  Thu May 24 03:14:50 2012
From: preining at logic.at (Norbert Preining)
Date: Thu, 24 May 2012 10:14:50 +0900
Subject: [dev-context] [Dev-luatex] new luatex for Debian
In-Reply-To: <CALBOmsbZ8AuDzMKLVbVZY6oEtV8DrJzqccqOAn9Dz7nhi+nFLg@mail.gmail.com>
References: <20120522081538.GA5059@gamma.logic.tuwien.ac.at>
	<CALBOmsZuxfdPivPBQrP6y6ZD1UxbapEBLW3ZNivCiCF8EE9_ug@mail.gmail.com>
	<20120522225323.GM20502@gamma.logic.tuwien.ac.at>
	<20120523024112.GA27297@khaled-laptop>
	<20120523024611.GA32207@gamma.logic.tuwien.ac.at>
	<4FBCD58D.8010500@elvenkind.com>
	<20120523141251.GD6533@gamma.logic.tuwien.ac.at>
	<CALBOmsbA4tJZMs=JUnPxHRO=9bcvksdAxpak0R4SzW_h+zy_HA@mail.gmail.com>
	<20120523224057.GH32624@gamma.logic.tuwien.ac.at>
	<CALBOmsbZ8AuDzMKLVbVZY6oEtV8DrJzqccqOAn9Dz7nhi+nFLg@mail.gmail.com>
Message-ID: <20120524011450.GX32624@gamma.logic.tuwien.ac.at>

Hi Mojca,

(dropping Karl and dev-luatex list, since luatex now works, but add context list)

On Do, 24 Mai 2012, Mojca Miklavec wrote:
> Committed (after my commit I found another version of ConTeXt, but

Still not working ...

Now it finds my texmfcnf.lua, but is still borken:
# mtxrun --generate

resolvers       | resolving | variable 'SELFAUTOLOC' set to '/usr/bin'
resolvers       | resolving | variable 'SELFAUTODIR' set to '/usr'
resolvers       | resolving | variable 'SELFAUTOPARENT' set to '.'
resolvers       | resolving | variable 'TEXMFCNF' set to ''
resolvers       | resolving | variable 'TEXMF' set to ''
resolvers       | resolving | variable 'TEXOS' set to '/usr'
resolvers       | resolving |
resolvers       | resolving | using configuration specification 'home:texmf/web2c;{selfautoloc:,selfautoloc:/share/texmf-local/web2c,selfautoloc:/share/texmf/web2c,selfautoloc:/texmf-local/web2c,selfautoloc:/texmf/web2c,selfautodir:,selfautodir:/share/texmf-local/web2c,selfautodir:/share/texmf/web2c,selfautodir:/texmf-local/web2c,selfautodir:/texmf/web2c,selfautoparent:/../texmf-local/web2c,selfautoparent:,selfautoparent:/share/texmf-local/web2c,selfautoparent:/share/texmf/web2c,selfautoparent:/texmf-local/web2c,selfautoparent:/texmf/web2c}'
resolvers       | resolving |
resolvers       | resolving | unknown configuration file '/root/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/bin/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/bin/share/texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/bin/share/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/bin/texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/bin/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/share/texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | found configuration file '/usr/share/texmf/web2c/texmfcnf.lua'

	HURRAY!!!

resolvers       | resolving | unknown configuration file '/usr/texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file '/usr/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './../texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmfcnf.lua'
resolvers       | resolving | unknown configuration file './share/texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './share/texmf/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmf-local/web2c/texmfcnf.lua'
resolvers       | resolving | unknown configuration file './texmf/web2c/texmfcnf.lua'
resolvers       | resolving |
resolvers       | resolving | skipping configuration file 'selfautodir:/share/texmf/web2c/texmfcnf.lua' (no file)
resolvers       | resolving | no texmf paths are defined (using TEXMF)
resolvers       | resolving |
mtxrun          |
mtxrun          | runtime: 0.009 seconds


MIND it finds 
	/usr/share/texmf/web2c/texmfcnf.lua
as it says:
resolvers       | resolving | found configuration file '/usr/share/texmf/web2c/texmfcnf.lua'

and this file contains the proper changes from the distributed texmfcnf.lua
to what we need in Debian, I attach my version here.

But still, all broken.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
DETCHANT (n.)
(Of the hands or feet.) Prunelike after an overlong bath.
			--- Douglas Adams, The Meaning of Liff
-------------- next part --------------
-- public domain

-- ConTeXt needs a properly expanded TEXMFLOCAL, so here is a
-- bit of lua code to make that happen

local texmflocal = "/usr/local/share/texmf";

return {

    type    = "configuration",
    version = "1.1.0",
    date    = "2012-05-14", -- or so
    time    = "12:12:12",
    comment = "ConTeXt MkIV configuration file",
    author  = "Hans Hagen, PRAGMA-ADE, Hasselt NL",
    -- adaption by Preining Norbert for the Debian system

    content = {

        -- Originally there was support for engines and progname but I don't expect
        -- other engines to use this file, so first engines were removed. After that
        -- if made sense also to get rid of progname. At some point specific formats
        -- will be supported but then as a subtable with fallbacks, which sounds more
        -- natural. Also, at some point the paths will become tables. For the moment
        -- I don't care too much about it as extending is easy.

        variables = {

            -- The following variable is predefined (but can be overloaded) and in
            -- most cases you can leve this one untouched. The built-in definition
            -- permits relocation of the tree.
            --
            -- TEXMFCNF     = "{selfautodir:,selfautoparent:}{,{/share,}/texmf{-local,}/web2c}"
            --
            -- more readable than "selfautoparent:{/texmf{-local,}{,/web2c},}}" is:
            --
            -- TEXMFCNF     = {
            --     "selfautoparent:/texmf-local",
            --     "selfautoparent:/texmf-local/web2c",
            --     "selfautoparent:/texmf",
            --     "selfautoparent:/texmf/web2c",
            --     "selfautoparent:",
            -- }

            -- only used for FONTCONFIG_PATH & TEXMFCACHE in TeX Live

            TEXMFSYSVAR     = "/var/lib/texmf",
            TEXMFVAR        = "home:.texmf-var",

            -- We have only one cache path but there can be more. The first writable one
            -- will be chosen but there can be more readable paths.

            TEXMFCACHE      = "$TEXMFSYSVAR;$TEXMFVAR",
            TEXMFCONFIG     = "home:.texmf-config",

            -- I don't like this texmf under home and texmf-home would make more
            -- sense. One never knows what installers put under texmf anywhere and
            -- sorting out problems will be a pain. But on the other hand ... home
            -- mess is normally under the users own responsibility.
            --
            -- By using prefixes we don't get expanded paths in the cache __path__
            -- entry. This makes the tex root relocatable.

            -- TEXMFOS         = "selfautodir:",
            -- TEXMFSYSTEM     = "selfautoparent:$SELFAUTOSYSTEM",
            TEXMFMAIN       = "/usr/share/texlive/texmf",
	    TEXMFDIST       = "/usr/share/texlive/texmf-dist",
            TEXMFCONTEXT    = "/usr/share/texmf",

            TEXMFLOCAL      = /usr/local/share/texmf",
            TEXMFSYSCONFIG  = "/etc/texmf",
            -- TEXMFFONTS      = "selfautoparent:texmf-fonts",
            -- TEXMFPROJECT    = "selfautoparent:texmf-project",

            TEXMFHOME       = "home:texmf",
         -- TEXMFHOME       = os.name == "macosx" and "home:Library/texmf" or "home:texmf",

            -- We need texmfos for a few rare files but as I have a few more bin trees
            -- a hack is needed. Maybe other users also have texmf-platform-new trees.

            TEXMF           = "{$TEXMFCONFIG,$TEXMFVAR,$TEXMFHOME,$TEXMFSYSCONFIG,!!$TEXMFSYSVAR,!!$TEXMFLOCAL,!!$TEXMFCONTEXT,!!$TEXMFMAIN,!!$TEXMFDIST}",

            TEXFONTMAPS     = ".;$TEXMF/fonts/data//;$TEXMF/fonts/map/{pdftex,dvips}//",
            ENCFONTS        = ".;$TEXMF/fonts/data//;$TEXMF/fonts/enc/{dvips,pdftex}//",
            VFFONTS         = ".;$TEXMF/fonts/{data,vf}//",
            TFMFONTS        = ".;$TEXMF/fonts/{data,tfm}//",
            T1FONTS         = ".;$TEXMF/fonts/{data,type1}//;$OSFONTDIR",
            AFMFONTS        = ".;$TEXMF/fonts/{data,afm}//;$OSFONTDIR",
            TTFONTS         = ".;$TEXMF/fonts/{data,truetype}//;$OSFONTDIR",
            OPENTYPEFONTS   = ".;$TEXMF/fonts/{data,opentype}//;$OSFONTDIR",
            CMAPFONTS       = ".;$TEXMF/fonts/cmap//",
            FONTFEATURES    = ".;$TEXMF/fonts/{data,fea}//;$OPENTYPEFONTS;$TTFONTS;$T1FONTS;$AFMFONTS",
            FONTCIDMAPS     = ".;$TEXMF/fonts/{data,cid}//",
            OFMFONTS        = ".;$TEXMF/fonts/{data,ofm,tfm}//",
            OVFFONTS        = ".;$TEXMF/fonts/{data,ovf,vf}//",

            TEXINPUTS       = ".;$TEXMF/tex/{context,plain/base,generic}//",
            MPINPUTS        = ".;$TEXMF/metapost/{context,base,}//",

            -- In the next variable the inputs path will go away.

            TEXMFSCRIPTS    = ".;$TEXMF/scripts/context/{lua,ruby,python,perl}//;$TEXINPUTS",
            PERLINPUTS      = ".;$TEXMF/scripts/context/perl",
            PYTHONINPUTS    = ".;$TEXMF/scripts/context/python",
            RUBYINPUTS      = ".;$TEXMF/scripts/context/ruby",
            LUAINPUTS       = ".;$TEXINPUTS;$TEXMF/scripts/context/lua//",
            CLUAINPUTS      = ".;$SELFAUTOLOC/lib/{context,luatex,}/lua//",

            -- Not really used by MkIV so they might go away.

            BIBINPUTS       = ".;$TEXMF/bibtex/bib//",
            BSTINPUTS       = ".;$TEXMF/bibtex/bst//",

            -- Experimental

            ICCPROFILES     = ".;$TEXMF/tex/context/colors/{icc,profiles}//;$OSCOLORDIR",

            -- A few special ones that will change some day.

            FONTCONFIG_FILE = "fonts.conf",
            FONTCONFIG_PATH = "$TEXMFSYSVAR/fonts/conf",

        },

        -- We have a few reserved subtables. These control runtime behaviour. The
        -- keys have names like 'foo.bar' which means that you have to use keys
        -- like ['foo.bar'] so for convenience we also support 'foo_bar'.

        directives = {

            -- There are a few variables that determine the engines
            -- limits. Most will fade away when we close in on version 1.

            ["luatex.expanddepth"]       =  "10000", -- 10000
            ["luatex.hashextra"]         = "100000", --     0
            ["luatex.nestsize"]          =   "1000", --    50
            ["luatex.maxinopen"]         =    "500", --    15
            ["luatex.maxprintline"]      = " 10000", --    79
            ["luatex.maxstrings"]        = "500000", -- 15000 -- obsolete
            ["luatex.paramsize"]         =  "25000", --    60
            ["luatex.savesize"]          =  "50000", --  4000
            ["luatex.stacksize"]         =  "10000", --   300

            -- A few process related variables come next.

         -- ["system.checkglobals"]      = "10",
         -- ["system.nostatistics"]      = "yes",
            ["system.errorcontext"]      = "10",
            ["system.compile.cleanup"]   = "no",    -- remove tma files
            ["system.compile.strip"]     = "yes",   -- strip tmc files

            -- The io modes are similar to the traditional ones. Possible values
            -- are all, paranoid and restricted.

            ["system.outputmode"]        = "restricted",
            ["system.inputmode"]         = "any",

            -- The following variable is under consideration. We do have protection
            -- mechanims but it's not enabled by default.

            ["system.commandmode"]       = "any", -- any none list
            ["system.commandlist"]       = "mtxrun, convert, inkscape, gs, imagemagick, curl, bibtex, pstoedit",

            -- The mplib library support mechanisms have their own
            -- configuration. Normally these variables can be left as
            -- they are.

            ["mplib.texerrors"]          = "yes",

            -- Normally you can leave the font related directives untouched
            -- as they only make sense when testing.

         -- ["fonts.autoreload"]         = "no",
         -- ["fonts.otf.loader.method"]  = "table", -- table mixed sparse
         -- ["fonts.otf.loader.cleanup"] = "0",     -- 0 1 2 3

            -- In an edit cycle it can be handy to launch an editor. The
            -- preferred one can be set here.

         -- ["pdfview.method"]           = "see", -- default (often acrobat) xpdf okular

        },

        experiments = {
            ["fonts.autorscale"] = "yes",
        },

        trackers = {
        },

    },

}

From mojca.miklavec.lists at gmail.com  Thu May 24 10:23:13 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 24 May 2012 10:23:13 +0200
Subject: [dev-context] [Dev-luatex] new luatex for Debian
In-Reply-To: <20120524011450.GX32624@gamma.logic.tuwien.ac.at>
References: <20120522081538.GA5059@gamma.logic.tuwien.ac.at>
	<CALBOmsZuxfdPivPBQrP6y6ZD1UxbapEBLW3ZNivCiCF8EE9_ug@mail.gmail.com>
	<20120522225323.GM20502@gamma.logic.tuwien.ac.at>
	<20120523024112.GA27297@khaled-laptop>
	<20120523024611.GA32207@gamma.logic.tuwien.ac.at>
	<4FBCD58D.8010500@elvenkind.com>
	<20120523141251.GD6533@gamma.logic.tuwien.ac.at>
	<CALBOmsbA4tJZMs=JUnPxHRO=9bcvksdAxpak0R4SzW_h+zy_HA@mail.gmail.com>
	<20120523224057.GH32624@gamma.logic.tuwien.ac.at>
	<CALBOmsbZ8AuDzMKLVbVZY6oEtV8DrJzqccqOAn9Dz7nhi+nFLg@mail.gmail.com>
	<20120524011450.GX32624@gamma.logic.tuwien.ac.at>
Message-ID: <CALBOmsYC7_bnCcwtBTp=5SqXVteGyg8HpYkqMJsxGpdr_USysw@mail.gmail.com>

On Thu, May 24, 2012 at 3:14 AM, Norbert Preining wrote:
> Hi Mojca,
>
> (dropping Karl and dev-luatex list, since luatex now works, but add context list)
>
> On Do, 24 Mai 2012, Mojca Miklavec wrote:
>> Committed (after my commit I found another version of ConTeXt, but
>
> Still not working ...
>
> Now it finds my texmfcnf.lua, but is still borken:
> # mtxrun --generate
>
> resolvers ? ? ? | resolving | variable 'SELFAUTOLOC' set to '/usr/bin'
> resolvers ? ? ? | resolving | variable 'SELFAUTODIR' set to '/usr'
> resolvers ? ? ? | resolving | variable 'SELFAUTOPARENT' set to '.'
> resolvers ? ? ? | resolving | variable 'TEXMFCNF' set to ''
> resolvers ? ? ? | resolving | variable 'TEXMF' set to ''
> resolvers ? ? ? | resolving | variable 'TEXOS' set to '/usr'
> resolvers ? ? ? | resolving |
> resolvers ? ? ? | resolving | using configuration specification 'home:texmf/web2c;{selfautoloc:,selfautoloc:/share/texmf-local/web2c,selfautoloc:/share/texmf/web2c,selfautoloc:/texmf-local/web2c,selfautoloc:/texmf/web2c,selfautodir:,selfautodir:/share/texmf-local/web2c,selfautodir:/share/texmf/web2c,selfautodir:/texmf-local/web2c,selfautodir:/texmf/web2c,selfautoparent:/../texmf-local/web2c,selfautoparent:,selfautoparent:/share/texmf-local/web2c,selfautoparent:/share/texmf/web2c,selfautoparent:/texmf-local/web2c,selfautoparent:/texmf/web2c}'
> resolvers ? ? ? | resolving |
> resolvers ? ? ? | resolving | unknown configuration file '/root/texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/bin/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/bin/share/texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/bin/share/texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/bin/texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/bin/texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/share/texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | found configuration file '/usr/share/texmf/web2c/texmfcnf.lua'
>
> ? ? ? ?HURRAY!!!
>
> resolvers ? ? ? | resolving | unknown configuration file '/usr/texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file '/usr/texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './../texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './share/texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './share/texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './texmf-local/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving | unknown configuration file './texmf/web2c/texmfcnf.lua'
> resolvers ? ? ? | resolving |
> resolvers ? ? ? | resolving | skipping configuration file 'selfautodir:/share/texmf/web2c/texmfcnf.lua' (no file)

First of all, I think that ConTeXt is wrong about message. Hans, file
exists, only the contents might be weird, but that doesn't mean "no
file".

The lines around 12618 in mtxrun:

            local blob = loadfile(realname)
            if blob then

 fail to load (slightly wrong content), but this doesn't mean that
there is no file.

> MIND it finds
> ? ? ? ?/usr/share/texmf/web2c/texmfcnf.lua
> as it says:
> resolvers ? ? ? | resolving | found configuration file '/usr/share/texmf/web2c/texmfcnf.lua'
>
> and this file contains the proper changes from the distributed texmfcnf.lua
> to what we need in Debian, I attach my version here.
>
> But still, all broken.

Probably all broken including this line in texmfcnf.lua?
    TEXMFLOCAL      = /usr/local/share/texmf",

Mojca

PS: you don't need
    local texmflocal = "/usr/local/share/texmf";
on top. That's only to overcome a problem with ".." in
"../texmf-local" in TeX Live.

From preining at logic.at  Thu May 24 10:51:46 2012
From: preining at logic.at (Norbert Preining)
Date: Thu, 24 May 2012 17:51:46 +0900
Subject: [dev-context] [Dev-luatex] new luatex for Debian
In-Reply-To: <CALBOmsYC7_bnCcwtBTp=5SqXVteGyg8HpYkqMJsxGpdr_USysw@mail.gmail.com>
References: <20120522225323.GM20502@gamma.logic.tuwien.ac.at>
	<20120523024112.GA27297@khaled-laptop>
	<20120523024611.GA32207@gamma.logic.tuwien.ac.at>
	<4FBCD58D.8010500@elvenkind.com>
	<20120523141251.GD6533@gamma.logic.tuwien.ac.at>
	<CALBOmsbA4tJZMs=JUnPxHRO=9bcvksdAxpak0R4SzW_h+zy_HA@mail.gmail.com>
	<20120523224057.GH32624@gamma.logic.tuwien.ac.at>
	<CALBOmsbZ8AuDzMKLVbVZY6oEtV8DrJzqccqOAn9Dz7nhi+nFLg@mail.gmail.com>
	<20120524011450.GX32624@gamma.logic.tuwien.ac.at>
	<CALBOmsYC7_bnCcwtBTp=5SqXVteGyg8HpYkqMJsxGpdr_USysw@mail.gmail.com>
Message-ID: <20120524085146.GA31200@gamma.logic.tuwien.ac.at>

On Do, 24 Mai 2012, Mojca Miklavec wrote:
>     TEXMFLOCAL      = /usr/local/share/texmf",

ARGGG?!?!?!?

Thanks!!!!

indeed ... but why is there no warning or so from lua ... 
I thought it is not even read ... due to the (no file)

Well, case solved, problem as usual between chair and kbd (me).

> PS: you don't need
>     local texmflocal = "/usr/local/share/texmf";

I know, was a left over.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
`You ARE Zaphod Beeblebrox?'
but don't shout it out or they'll all
want one.'
`THE Zaphod Beeblebrox?'
`No, just A Zaphod Bebblebrox, didn't you hear I come in
six packs?'
I just heard on the sub-ether
radio report. It said you were dead...'
`Yeah, that's right, I just haven't stopped moving yet.'
                 --- Zaphod and the Guide's receptionist.
                 --- Douglas Adams, The Hitchhikers Guide to the Galaxy

From adityam at umich.edu  Sun May 27 07:32:46 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 27 May 2012 01:32:46 -0400 (EDT)
Subject: [dev-context] Including gif images from the web
Message-ID: <alpine.LNX.2.02.1205270124360.13255@ybpnyubfg.ybpnyqbznva>

Hi,

Inclusion of gif images from the web does not work. For example:

\starttext
\externalfigure[http://upload.wikimedia.org/wikipedia/commons/a/a0/Sunflower_as_gif_websafe.gif]
\stoptext

It is a rather strange bug. In grph-inc.lua we have

     local newbase = file.addsuffix(newbase,newformat)
     local newname = file.join(newpath,newbase)

Now, since the webaddress has a dot, newbase has a dot. file.addsuffix does not
change the suffix if a file already has a suffix (and does not give any warning
about it!). So, newname does not end with .pdf, and therefore

gm convert long-path.gif long-path

does not convert to pdf--the resultant file is a gif file. Hence, direct 
inclusion of that file fails.

A simple fix is to change the addsuffix line to:

    newbase = newbase .. "." .. newformat

Aditya

From netuse at lavabit.com  Mon May 28 16:40:43 2012
From: netuse at lavabit.com (Marco)
Date: Mon, 28 May 2012 16:40:43 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz>
Message-ID: <20120528164043.011cb951@Zewz>

On 2012-05-23 Marco <netuse at lavabit.com> wrote:

I improved the code. There is no interference any more and no
strange offsets. One thing is still unsolved:

The top/bottom/?rulethickness settings are not inherited from
rulethickness (see the table example at the end). This breaks the
compilation if only rulethickness is provided but not
toprulethicknes and bottomrulethickness. I don't know how to fix
that. That's not what users expect and is a bug.


Marco Patzer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: meta-imp-loc.mkiv
Type: application/octet-stream
Size: 10118 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120528/9e7b8002/attachment.obj>

From netuse at lavabit.com  Mon May 28 16:48:28 2012
From: netuse at lavabit.com (Marco)
Date: Mon, 28 May 2012 16:48:28 +0200
Subject: [dev-context] Definition of \doframedparentparameter
Message-ID: <20120528164828.2da2e2ec@Zewz>

Hi,

I have a question about \doframedparentparameter from pack-rul.mkiv:

\def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1{#2}\fi}

When the else branch is taken, it picks up the second argument, but
when the if branch is taken, it just picks up the first letter of
the argument (since the braces are missing). Is that intended? When
there are braces in the else branch there should also be braces in
the if branch.

Marco



From schuster.wolfgang at googlemail.com  Mon May 28 17:05:18 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 28 May 2012 17:05:18 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <20120528164043.011cb951@Zewz>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
Message-ID: <551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>


Am 28.05.2012 um 16:40 schrieb Marco:

> On 2012-05-23 Marco <netuse at lavabit.com> wrote:
> 
> I improved the code. There is no interference any more and no
> strange offsets. One thing is still unsolved:
> 
> The top/bottom/?rulethickness settings are not inherited from
> rulethickness (see the table example at the end). This breaks the
> compilation if only rulethickness is provided but not
> toprulethicknes and bottomrulethickness. I don't know how to fix
> that. That's not what users expect and is a bug.

Add these setups to the module (there is no need for the braces):

\setupTABLE [  \c!left\c!rulethickness=\framedparameter\c!rulethickness,  \c!left\c!framecolor=\framedparameter\c!framecolor]
\setupTABLE [ \c!right\c!rulethickness=\framedparameter\c!rulethickness, \c!right\c!framecolor=\framedparameter\c!framecolor]
\setupTABLE [   \c!top\c!rulethickness=\framedparameter\c!rulethickness,   \c!top\c!framecolor=\framedparameter\c!framecolor]
\setupTABLE [\c!bottom\c!rulethickness=\framedparameter\c!rulethickness,\c!bottom\c!framecolor=\framedparameter\c!framecolor]

Wolfgang

From adityam at umich.edu  Mon May 28 17:08:31 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 28 May 2012 11:08:31 -0400 (EDT)
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
Message-ID: <alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>

On Mon, 28 May 2012, Wolfgang Schuster wrote:

>
> Am 28.05.2012 um 16:40 schrieb Marco:
>
>> On 2012-05-23 Marco <netuse at lavabit.com> wrote:
>>
>> I improved the code. There is no interference any more and no
>> strange offsets. One thing is still unsolved:
>>
>> The top/bottom/?rulethickness settings are not inherited from
>> rulethickness (see the table example at the end). This breaks the
>> compilation if only rulethickness is provided but not
>> toprulethicknes and bottomrulethickness. I don't know how to fix
>> that. That's not what users expect and is a bug.
>
> Add these setups to the module (there is no need for the braces):
>
> \setupTABLE [  \c!left\c!rulethickness=\framedparameter\c!rulethickness,  \c!left\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [ \c!right\c!rulethickness=\framedparameter\c!rulethickness, \c!right\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [   \c!top\c!rulethickness=\framedparameter\c!rulethickness,   \c!top\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [\c!bottom\c!rulethickness=\framedparameter\c!rulethickness,\c!bottom\c!framecolor=\framedparameter\c!framecolor]

I made some more changes at

https://github.com/adityam/context-fences-extra

Aditya

From schuster.wolfgang at googlemail.com  Mon May 28 18:01:55 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 28 May 2012 18:01:55 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
	<alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
Message-ID: <516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>


Am 28.05.2012 um 17:08 schrieb Aditya Mahajan:

> On Mon, 28 May 2012, Wolfgang Schuster wrote:
> 
>> 
>> Am 28.05.2012 um 16:40 schrieb Marco:
>> 
>>> On 2012-05-23 Marco <netuse at lavabit.com> wrote:
>>> 
>>> I improved the code. There is no interference any more and no
>>> strange offsets. One thing is still unsolved:
>>> 
>>> The top/bottom/?rulethickness settings are not inherited from
>>> rulethickness (see the table example at the end). This breaks the
>>> compilation if only rulethickness is provided but not
>>> toprulethicknes and bottomrulethickness. I don't know how to fix
>>> that. That's not what users expect and is a bug.
>> 
>> Add these setups to the module (there is no need for the braces):
>> 
>> \setupTABLE [  \c!left\c!rulethickness=\framedparameter\c!rulethickness,  \c!left\c!framecolor=\framedparameter\c!framecolor]
>> \setupTABLE [ \c!right\c!rulethickness=\framedparameter\c!rulethickness, \c!right\c!framecolor=\framedparameter\c!framecolor]
>> \setupTABLE [   \c!top\c!rulethickness=\framedparameter\c!rulethickness,   \c!top\c!framecolor=\framedparameter\c!framecolor]
>> \setupTABLE [\c!bottom\c!rulethickness=\framedparameter\c!rulethickness,\c!bottom\c!framecolor=\framedparameter\c!framecolor]
> 
> I made some more changes at
> 
> https://github.com/adityam/context-fences-extra

I made also a few modifications on Marcos code, maybe a few of them should be moved to the core.

It would be also a good idea to change the name of the module to meta-imp-frame.mkiv or something similar.

Wolfgang
-------------- next part --------------
A non-text attachment was scrubbed...
Name: meta-imp-loc.mkiv
Type: application/octet-stream
Size: 10734 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120528/3c7cbeee/attachment.obj>

From adityam at umich.edu  Mon May 28 18:09:23 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 28 May 2012 12:09:23 -0400 (EDT)
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
	<alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
	<516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
Message-ID: <alpine.LNX.2.02.1205281208330.13255@ybpnyubfg.ybpnyqbznva>

On Mon, 28 May 2012, Wolfgang Schuster wrote:

> I made also a few modifications on Marcos code, maybe a few of them should be moved to the core.
>
> It would be also a good idea to change the name of the module to 
> meta-imp-frame.mkiv or something similar.

In that case, we also need to change local and tight to \v!local and 
\v!tight (and define a variable for tight).

Aditya

From netuse at lavabit.com  Mon May 28 18:27:47 2012
From: netuse at lavabit.com (Marco)
Date: Mon, 28 May 2012 18:27:47 +0200
Subject: [dev-context] Local settings for frame borders
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
Message-ID: <20120528182747.3a0a3d4e@Zewz>

On 2012-05-28 Wolfgang Schuster <schuster.wolfgang at googlemail.com> wrote:

> Add these setups to the module (there is no need for the braces):
> 
> \setupTABLE [  \c!left\c!rulethickness=\framedparameter\c!rulethickness,  \c!left\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [ \c!right\c!rulethickness=\framedparameter\c!rulethickness, \c!right\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [   \c!top\c!rulethickness=\framedparameter\c!rulethickness,   \c!top\c!framecolor=\framedparameter\c!framecolor]
> \setupTABLE [\c!bottom\c!rulethickness=\framedparameter\c!rulethickness,\c!bottom\c!framecolor=\framedparameter\c!framecolor]

That does not work, unfortunately. Thought, it doesn't throw a
compile error any more. The value rulethickness is not used for
toprulethickness, if not given explicitly. The following should be
equal, but it isn't:

  \setupTABLE [frame=off, rulethickness=.03em]
  \setupTABLE [frame=off, rulethickness=.03em, toprulethickness=.03em]

Marco



From pragma at wxs.nl  Mon May 28 18:53:56 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 18:53:56 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205281208330.13255@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
	<alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
	<516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
	<alpine.LNX.2.02.1205281208330.13255@ybpnyubfg.ybpnyqbznva>
Message-ID: <4FC3ADA4.1060509@wxs.nl>

On 28-5-2012 18:09, Aditya Mahajan wrote:
> On Mon, 28 May 2012, Wolfgang Schuster wrote:
>
>> I made also a few modifications on Marcos code, maybe a few of them
>> should be moved to the core.
>>
>> It would be also a good idea to change the name of the module to
>> meta-imp-frame.mkiv or something similar.
>
> In that case, we also need to change local and tight to \v!local and
> \v!tight (and define a variable for tight).

possible extension (less graphics):

\unprotect

\startMPinitializations
   boolean LocalFrameDone ; LocalFrameDone := false ;
\stopMPinitializations

\startuseMPgraphic {frame_local_top}
if not LocalFrameDone :
   draw topboundary OverlayBox
     leftenlarged  (LeftFrameLinewidth-.5*TopFrameLinewidth)
     rightenlarged (RightFrameLinewidth-.5*TopFrameLinewidth)
     shifted (0, .5*TopFrameLinewidth)
     withpen pensquare scaled (TopFrameLinewidth)
     withcolor TopFrameColor ;
   setbounds currentpicture to OverlayBox ;
fi ;
\stopuseMPgraphic

\defineoverlay[localframe][\useMPgraphic{localframe}]

\startuseMPgraphic{localframe}
     \includeMPgraphic{frame_\framedparameter\c!topframe    _top}
     \includeMPgraphic{frame_\framedparameter\c!leftframe   _left}
     \includeMPgraphic{frame_\framedparameter\c!rightframe  _right}
     \includeMPgraphic{frame_\framedparameter\c!bottomframe _bottom}
     LocalFrameDone := true ;
\stopuseMPgraphic

\protect

\starttext

\framed
   [background=localframe,
    framecolor=blue,
    frame=off,
    leftframe=local,
    topframe=tight,
    leftframecolor=red]
   {test}

\stoptext

it could permit some analysis and connection of pieces of frame but in 
that case one will use a dedicated background anyway

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon May 28 19:06:39 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 19:06:39 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
	<alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
	<516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
Message-ID: <4FC3B09F.3090808@wxs.nl>

On 28-5-2012 18:01, Wolfgang Schuster wrote:
>
> Am 28.05.2012 um 17:08 schrieb Aditya Mahajan:
>
>> On Mon, 28 May 2012, Wolfgang Schuster wrote:
>>
>>>
>>> Am 28.05.2012 um 16:40 schrieb Marco:
>>>
>>>> On 2012-05-23 Marco<netuse at lavabit.com>  wrote:
>>>>
>>>> I improved the code. There is no interference any more and no
>>>> strange offsets. One thing is still unsolved:
>>>>
>>>> The top/bottom/?rulethickness settings are not inherited from
>>>> rulethickness (see the table example at the end). This breaks the
>>>> compilation if only rulethickness is provided but not
>>>> toprulethicknes and bottomrulethickness. I don't know how to fix
>>>> that. That's not what users expect and is a bug.
>>>
>>> Add these setups to the module (there is no need for the braces):
>>>
>>> \setupTABLE [  \c!left\c!rulethickness=\framedparameter\c!rulethickness,  \c!left\c!framecolor=\framedparameter\c!framecolor]
>>> \setupTABLE [ \c!right\c!rulethickness=\framedparameter\c!rulethickness, \c!right\c!framecolor=\framedparameter\c!framecolor]
>>> \setupTABLE [   \c!top\c!rulethickness=\framedparameter\c!rulethickness,   \c!top\c!framecolor=\framedparameter\c!framecolor]
>>> \setupTABLE [\c!bottom\c!rulethickness=\framedparameter\c!rulethickness,\c!bottom\c!framecolor=\framedparameter\c!framecolor]
>>
>> I made some more changes at
>>
>> https://github.com/adityam/context-fences-extra
>
> I made also a few modifications on Marcos code, maybe a few of them should be moved to the core.
>
> It would be also a good idea to change the name of the module to meta-imp-frame.mkiv or something similar.

last week I was considering leftframeoffset (but decided to stick to som 
emp jugling) and wondered if lframeoffset made more sense then (as it 
matches the loffset keyword which we have in order not to clash with 
leftoffset elsewhere .. \framed is often used as helper)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon May 28 19:22:02 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 19:22:02 +0200
Subject: [dev-context] Local settings for frame borders
In-Reply-To: <alpine.LNX.2.02.1205281208330.13255@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205230036400.11992@ybpnyubfg.ybpnyqbznva>
	<52480737-4158-457F-8E0B-25C35C9F1824@googlemail.com>
	<20120523154154.51cc2798@Zewz>
	<333EE82E-8261-4E1D-A474-6E2F6D7B9ED8@googlemail.com>
	<20120523190514.437da0d6@Zewz> <20120528164043.011cb951@Zewz>
	<551C11FB-48BC-4413-B96F-C18D0BD91727@googlemail.com>
	<alpine.LNX.2.02.1205281107520.13255@ybpnyubfg.ybpnyqbznva>
	<516F7B26-EF13-466F-8D23-90B3F203E01A@googlemail.com>
	<alpine.LNX.2.02.1205281208330.13255@ybpnyubfg.ybpnyqbznva>
Message-ID: <4FC3B43A.7060600@wxs.nl>

On 28-5-2012 18:09, Aditya Mahajan wrote:
> On Mon, 28 May 2012, Wolfgang Schuster wrote:
>
>> I made also a few modifications on Marcos code, maybe a few of them
>> should be moved to the core.
>>
>> It would be also a good idea to change the name of the module to
>> meta-imp-frame.mkiv or something similar.
>
> In that case, we also need to change local and tight to \v!local and
> \v!tight (and define a variable for tight).

new beta with \v!tight


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon May 28 19:25:32 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 19:25:32 +0200
Subject: [dev-context] Definition of \doframedparentparameter
In-Reply-To: <20120528164828.2da2e2ec@Zewz>
References: <20120528164828.2da2e2ec@Zewz>
Message-ID: <4FC3B50C.3020002@wxs.nl>

On 28-5-2012 16:48, Marco wrote:
> Hi,
>
> I have a question about \doframedparentparameter from pack-rul.mkiv:
>
> \def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1{#2}\fi}
>
> When the else branch is taken, it picks up the second argument, but
> when the if branch is taken, it just picks up the first letter of
> the argument (since the braces are missing). Is that intended? When
> there are braces in the else branch there should also be braces in
> the if branch.

normally #1 is a \cs and helpers like \doframedparentparameter are not 
user commands

(in the commandhandler variant {#1} is used but \framed is not yet using 
that code)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From netuse at lavabit.com  Mon May 28 19:30:36 2012
From: netuse at lavabit.com (Marco)
Date: Mon, 28 May 2012 19:30:36 +0200
Subject: [dev-context] Definition of \doframedparentparameter
References: <20120528164828.2da2e2ec@Zewz>
	<4FC3B50C.3020002@wxs.nl>
Message-ID: <20120528193036.6697ff02@Zewz>

On 2012-05-28 Hans Hagen <pragma at wxs.nl> wrote:

> > \def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1{#2}\fi}


> normally #1 is a \cs and helpers like \doframedparentparameter are not 
> user commands

I was talking about the second argument #2. If #2 is always a
command, then you can write

\def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1#2\fi}

if not, then

\def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter{#2}\else\doframedparameter#1{#2}\fi}

but the actual definition is neither of them, that is what confused me.


Marco



From pragma at wxs.nl  Mon May 28 19:39:00 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 19:39:00 +0200
Subject: [dev-context] Fwd: Re: Definition of \doframedparentparameter
In-Reply-To: <4FC3B813.7090007@wxs.nl>
References: <4FC3B813.7090007@wxs.nl>
Message-ID: <4FC3B834.6090900@wxs.nl>



-------- Original Message --------
Subject: Re: Definition of \doframedparentparameter
Date: Mon, 28 May 2012 19:38:27 +0200
From: Hans Hagen <pragma at wxs.nl>
To: Marco <netuse at lavabit.com>

On 28-5-2012 19:30, Marco wrote:
> On 2012-05-28 Hans Hagen<pragma at wxs.nl>  wrote:
>
>>> \def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1{#2}\fi}
>
>
>> normally #1 is a \cs and helpers like \doframedparentparameter are not
>> user commands
>
> I was talking about the second argument #2. If #2 is always a
> command, then you can write
>
> \def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter#2\else\doframedparameter#1#2\fi}
>
> if not, then
>
> \def\doframedparentparameter#1#2{\ifx#1\relax\doframedrootparameter{#2}\else\doframedparameter#1{#2}\fi}
>
> but the actual definition is neither of them, that is what confused me.

Users can do \setupframed[mine:whatever=wewant] and then say
\framedparameter{mine:whatever}. They never see or use the #1 (being a
special and abstract namespace value). It's the value of \currentframed
that starts the lookup chain.  Also, a lot of this low level code is
optimized for performance.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Mon May 28 20:23:14 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 28 May 2012 20:23:14 +0200
Subject: [dev-context] strc-not.mkvi
Message-ID: <750E4C0A-F2AB-4BCF-AE62-9AC170F95227@googlemail.com>

Hi,

\unexpanded\def\strc_notations_command#1%
  {\begingroup
   \edef\currentnote{#1}%
   \strc_constructions_initialize{#1}%
   \strc_notes_synchronize
-  \strc_counters_increment_sub\currentconstructionnumber\currentconstructionlevel
+  \ifnotesenabled\strc_counters_increment_sub\currentconstructionnumber\currentconstructionlevel\fi
   \doifnextoptionalelse\strc_notations_command_yes\strc_notations_command_nop}

\unexpanded\def\strc_notations_start#1#2%
  {\begingroup
   \edef\currentnote{#1}%
   \strc_constructions_initialize{#1}%
   \strc_notes_synchronize
-  \strc_counters_increment_sub\currentconstructionnumber\currentconstructionlevel
+  \ifnotesenabled\strc_counters_increment_sub\currentconstructionnumber\currentconstructionlevel\fi
   \normalexpanded % not that efficient but also not that frequently used
     {\def\noexpand\strc_pickup_yes[##1]##2\csname\e!stop#2\endcsname{\strc_notations_command_yes[##1]{##2}}%
      \def\noexpand\strc_pickup_nop     ##1\csname\e!stop#2\endcsname{\strc_notations_command_nop     {##1}}}%
   \doifnextoptionalelse\strc_pickup_yes\strc_pickup_nop}

Wolfgang

From mojca.miklavec.lists at gmail.com  Mon May 28 22:47:10 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 28 May 2012 22:47:10 +0200
Subject: [dev-context] context-version.png/pdf
Message-ID: <CALBOmsYFeRbL_nB1cm7efLDrYXXbBno-V8auWTSsBz2GCX_ATg@mail.gmail.com>

Dear Hans,

Why are different binary files
    tex/context/base/context-version.pdf
    tex/context/base/context-version.png
needed for each new version of ConTeXt?

Mojca

From pragma at wxs.nl  Mon May 28 22:59:19 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 28 May 2012 22:59:19 +0200
Subject: [dev-context] context-version.png/pdf
In-Reply-To: <CALBOmsYFeRbL_nB1cm7efLDrYXXbBno-V8auWTSsBz2GCX_ATg@mail.gmail.com>
References: <CALBOmsYFeRbL_nB1cm7efLDrYXXbBno-V8auWTSsBz2GCX_ATg@mail.gmail.com>
Message-ID: <4FC3E727.5000005@wxs.nl>

Hi Mojca,

> Why are different binary files
>      tex/context/base/context-version.pdf
>      tex/context/base/context-version.png
> needed for each new version of ConTeXt?

because the graphic changes and is actually a graphics timestamp (i have 
it as an icon ... you're the first to notice that it changes

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu May 31 11:45:14 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 31 May 2012 11:45:14 +0200
Subject: [dev-context] font-pre.mkvi
Message-ID: <411F8EA3-634D-437A-ACEF-2766DA5D4A54@googlemail.com>

Hi Hans,

can you add these to font-pre.mkiv

\definealternativestyle [\v!roman,\v!serif,\v!regular]    [\rm]
\definealternativestyle [\v!handwritten]                  [\hw]
\definealternativestyle [\v!calligraphic]                 [\cg]

Wolfgang

From adityam at umich.edu  Thu May 31 14:46:13 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Thu, 31 May 2012 08:46:13 -0400 (EDT)
Subject: [dev-context] Including gif images from the web
In-Reply-To: <alpine.LNX.2.02.1205270124360.13255@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1205270124360.13255@ybpnyubfg.ybpnyqbznva>
Message-ID: <alpine.LNX.2.02.1205310844110.25904@ybpnyubfg.ybpnyqbznva>

Hi,

On Sun, 27 May 2012, Aditya Mahajan wrote:

> Hi,
>
> Inclusion of gif images from the web does not work. For example:
>
> \starttext
> \externalfigure[http://upload.wikimedia.org/wikipedia/commons/a/a0/Sunflower_as_gif_websafe.gif]
> \stoptext
>
> It is a rather strange bug. In grph-inc.lua we have
>
>    local newbase = file.addsuffix(newbase,newformat)
>    local newname = file.join(newpath,newbase)
>
> Now, since the webaddress has a dot, newbase has a dot. file.addsuffix does 
> not
> change the suffix if a file already has a suffix (and does not give any 
> warning
> about it!). So, newname does not end with .pdf, and therefore
>
> gm convert long-path.gif long-path
>
> does not convert to pdf--the resultant file is a gif file. Hence, direct 
> inclusion of that file fails.
>
> A simple fix is to change the addsuffix line to:
>
>   newbase = newbase .. "." .. newformat

This issue is fixed in the latest beta.

Thanks,
Aditya

From pragma at wxs.nl  Mon Jun  4 20:00:58 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 04 Jun 2012 20:00:58 +0200
Subject: [dev-context] commandhandler
Message-ID: <4FCCF7DA.6040901@wxs.nl>

Hi,

new in next version:

\unexpanded\def\doifelsecommandhandler#1#2% namespace name
\unexpanded\def\doifcommandhandler    #1#2% namespace name
\unexpanded\def\doifnotcommandhandler #1#2% namespace name

(first used in the 'makeup' macros)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From sbbrouwer at gmail.com  Thu Jun  7 13:08:42 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Thu, 7 Jun 2012 13:08:42 +0200
Subject: [dev-context] core-mis.mkiv
Message-ID: <CAF=dkzynCPx1E-wpk7mH5YO1-j876UTPXhAfrdV2jE8yBEHCRQ@mail.gmail.com>

Hi,

For mkiv-appropriateness, in core-mis.mkiv:

\setuptab
-   [\c!location=\v!left]
+  [\c!alternative=\v!left]

--Sietse

From schuster.wolfgang at googlemail.com  Thu Jun  7 18:14:04 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 7 Jun 2012 18:14:04 +0200
Subject: [dev-context] Comma lists and Lua
Message-ID: <B9F6C527-46FB-49C4-BC68-D8E07E5006B4@googlemail.com>

Hi,

in the following example the space before the ?one? in the line

  \ctxlua{userdata.commalist(" one, two, three")}

is visible in the output. I guess this counts as bug because in the assignment
list the space before ?a=x? is removed.


Example:

\starttext

\startluacode

userdata = userdata or {}

function userdata.commalist(list)
	local list = utilities.parsers.settings_to_array(list)
	context.starttabulate()
	for index, value in next, list do
		context.NC()
			context.quotation(index)
		context.NC()
			context.quotation(value)
		context.NC()
		context.NR()
	end
	context.stoptabulate()
end

function userdata.parameters(list)
	local list = utilities.parsers.settings_to_hash(list)
	context.starttabulate()
	for key, value in next, list do
		context.NC()
			context.quotation(key)
		context.NC()
			context.quotation(value)
		context.NC()
		context.NR()
	end
	context.stoptabulate()
end

\stopluacode

\ctxlua{userdata.commalist("one,two,three")}
\ctxlua{userdata.commalist(" one, two, three")}
\ctxlua{userdata.parameters("a=x,b=y,c=z")}
\ctxlua{userdata.parameters(" a=x, b=y, c=z")}

\stoptext

Wolfgang

From pragma at wxs.nl  Thu Jun  7 18:28:46 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 07 Jun 2012 18:28:46 +0200
Subject: [dev-context] Comma lists and Lua
In-Reply-To: <B9F6C527-46FB-49C4-BC68-D8E07E5006B4@googlemail.com>
References: <B9F6C527-46FB-49C4-BC68-D8E07E5006B4@googlemail.com>
Message-ID: <4FD0D6BE.1020906@wxs.nl>

On 7-6-2012 18:14, Wolfgang Schuster wrote:
> Hi,
>
> in the following example the space before the ?one? in the line
>
>    \ctxlua{userdata.commalist(" one, two, three")}
>
> is visible in the output. I guess this counts as bug because in the assignment
> list the space before ?a=x? is removed.

you can change line 113 in util-prs.lua:

local pattern   = spaces * Ct(value*(separator*value)^0)

> Example:
>
> \starttext
>
> \startluacode
>
> userdata = userdata or {}
>
> function userdata.commalist(list)
> 	local list = utilities.parsers.settings_to_array(list)
> 	context.starttabulate()
> 	for index, value in next, list do
> 		context.NC()
> 			context.quotation(index)
> 		context.NC()
> 			context.quotation(value)
> 		context.NC()
> 		context.NR()
> 	end
> 	context.stoptabulate()
> end
>
> function userdata.parameters(list)
> 	local list = utilities.parsers.settings_to_hash(list)
> 	context.starttabulate()
> 	for key, value in next, list do
> 		context.NC()
> 			context.quotation(key)
> 		context.NC()
> 			context.quotation(value)
> 		context.NC()
> 		context.NR()
> 	end
> 	context.stoptabulate()
> end
>
> \stopluacode
>
> \ctxlua{userdata.commalist("one,two,three")}
> \ctxlua{userdata.commalist(" one, two, three")}
> \ctxlua{userdata.parameters("a=x,b=y,c=z")}
> \ctxlua{userdata.parameters(" a=x, b=y, c=z")}
>
> \stoptext
>
> Wolfgang
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-context


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at googlemail.com  Thu Jun  7 18:55:49 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 7 Jun 2012 18:55:49 +0200
Subject: [dev-context] Comma lists and Lua
In-Reply-To: <4FD0D6BE.1020906@wxs.nl>
References: <B9F6C527-46FB-49C4-BC68-D8E07E5006B4@googlemail.com>
	<4FD0D6BE.1020906@wxs.nl>
Message-ID: <773DBE74-EB0E-4FC3-A8BD-D1D5DFA92F37@googlemail.com>


Am 07.06.2012 um 18:28 schrieb Hans Hagen:

> On 7-6-2012 18:14, Wolfgang Schuster wrote:
>> Hi,
>> 
>> in the following example the space before the ?one? in the line
>> 
>>   \ctxlua{userdata.commalist(" one, two, three")}
>> 
>> is visible in the output. I guess this counts as bug because in the assignment
>> list the space before ?a=x? is removed.
> 
> you can change line 113 in util-prs.lua:
> 
> local pattern   = spaces * Ct(value*(separator*value)^0)

Works, the space is gone.

Wolfgang

From schuster.wolfgang at googlemail.com  Sun Jun 10 15:03:46 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 10 Jun 2012 15:03:46 +0200
Subject: [dev-context] =?windows-1252?q?ctx_file_can=92t_be_used?=
Message-ID: <6EF509B6-4688-4BFD-9BF8-DE397E2FDB21@googlemail.com>

Hi Hans,

ctx files can?t be used in the last beta.

This

  context --ctx=s-mod.ctx tabl-ntb.mkiv

generates the following error message:

  ctxname: s-mod.ctx...ex/texmf-context/scripts/context/lua/mtx-context.lua:261: bad argument #1 to 'match' (string expected, got nil)

Wolfgang

From pragma at wxs.nl  Mon Jun 11 00:05:32 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 11 Jun 2012 00:05:32 +0200
Subject: [dev-context] =?windows-1252?q?ctx_file_can=92t_be_used?=
In-Reply-To: <6EF509B6-4688-4BFD-9BF8-DE397E2FDB21@googlemail.com>
References: <6EF509B6-4688-4BFD-9BF8-DE397E2FDB21@googlemail.com>
Message-ID: <4FD51A2C.8080800@wxs.nl>

On 10-6-2012 15:03, Wolfgang Schuster wrote:
> Hi Hans,
>
> ctx files can?t be used in the last beta.
>
> This
>
>    context --ctx=s-mod.ctx tabl-ntb.mkiv
>
> generates the following error message:
>
>    ctxname: s-mod.ctx...ex/texmf-context/scripts/context/lua/mtx-context.lua:261: bad argument #1 to 'match' (string expected, got nil)

hopefully fixed in the next upload

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From sidojensma at gmail.com  Sun Jun 10 12:19:59 2012
From: sidojensma at gmail.com (Sido Jensma)
Date: Sun, 10 Jun 2012 12:19:59 +0200
Subject: [dev-context] bTABLE in header and document give unexpected behavior
In-Reply-To: <mailman.22.1339322855.4522.dev-context@ntg.nl>
References: <mailman.22.1339322855.4522.dev-context@ntg.nl>
Message-ID: <06BE7710-F241-445A-9ABA-83B333A432BF@me.com>

This is the first time I am posting here. I am not really sure what a typical bug report should look like.

I had posted a question on stack-exchange and it was suggested to post a bug report here. I?m not sure if this is a bug, but it was unexpected behavior to me.

The original question was posted here:
http://tex.stackexchange.com/questions/59134/strange-problem-with-frames-context-tables

And a ?not-so-minimal? example of what is happening is attached (see the last page).

I have tested this with extreme tables and don?t get the same behavior.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: table.tex
Type: application/octet-stream
Size: 1640 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120610/dff577f9/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: table.pdf
Type: application/pdf
Size: 20554 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20120610/dff577f9/attachment-0001.pdf>

From schuster.wolfgang at googlemail.com  Mon Jun 11 10:54:17 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 11 Jun 2012 10:54:17 +0200
Subject: [dev-context] bTABLE in header and document give unexpected
	behavior
In-Reply-To: <06BE7710-F241-445A-9ABA-83B333A432BF@me.com>
References: <mailman.22.1339322855.4522.dev-context@ntg.nl>
	<06BE7710-F241-445A-9ABA-83B333A432BF@me.com>
Message-ID: <97CD002D-C069-4CDE-910E-FED117796A32@googlemail.com>


Am 10.06.2012 um 12:19 schrieb Sido Jensma:

> This is the first time I am posting here. I am not really sure what a typical bug report should look like.
> 
> I had posted a question on stack-exchange and it was suggested to post a bug report here. I?m not sure if this is a bug, but it was unexpected behavior to me.
> 
> The original question was posted here:
> http://tex.stackexchange.com/questions/59134/strange-problem-with-frames-context-tables
> 
> And a ?not-so-minimal? example of what is happening is attached (see the last page).
> 
> I have tested this with extreme tables and don?t get the same behavior.

When you use a table environment which is broken across pages together with the same environment
in header settings can sometimes mix. In your case it?s best to use \framed in the header which does
the same and is also faster but even then one problem remains. By default \framed uses \linewidth
for ?rulethickness? and natural tables assign a different value to this length, this results in wrong
rules in the header when you don?t change the value (see example below).

Here is a better version for the header of your document.

\startsetups[header]

  \setupframed[width=0.2\textwidth,height=\headerheight,align=middle,offset=2mm,rulethickness=0.4pt]

  \dontleavehmode

  \startframed
    Rev
  \stopframed

  \startframed[width=0.6\textwidth,foregroundstyle=\ssbfa]
    \getvariable{document}{projectname}\\ 
    \getvariable{document}{documenttitle}
  \stopframed

  \startframed
    some text
  \stopframed

\stopsetups

BTW: Please use next time the normal mailing list for such problems and not the developer list.

Wolfgang

From sbbrouwer at gmail.com  Mon Jun 11 11:46:17 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Mon, 11 Jun 2012 11:46:17 +0200
Subject: [dev-context] bTABLE in header and document give unexpected
	behavior
In-Reply-To: <97CD002D-C069-4CDE-910E-FED117796A32@googlemail.com>
References: <mailman.22.1339322855.4522.dev-context@ntg.nl>
	<06BE7710-F241-445A-9ABA-83B333A432BF@me.com>
	<97CD002D-C069-4CDE-910E-FED117796A32@googlemail.com>
Message-ID: <CAF=dkzxCzUykaKuHpFz7+A2brmuHMBxJPUEadbgSdf5+5rewVg@mail.gmail.com>

Sido wrote:
>> I had posted a question on stack-exchange and it was suggested to
>> post a bug report here. I?m not sure if this is a bug, but it was
>> unexpected behavior to me.

Wolfgang wrote:
> BTW: Please use next time the normal mailing list for such problems and not the developer list.

That was my mistake: I thought it was a bug, and so I advised him to
post to dev-context instead of ntg-context. Just to check: is
dev-context at ntg.nl also for bug reports, or is it exclusively for
development discussions and should (probable) bugs also go on
ntg-context at ntg.nl?

--Sietse

From luigi.scarso at gmail.com  Mon Jun 11 12:13:54 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 11 Jun 2012 12:13:54 +0200
Subject: [dev-context] bTABLE in header and document give unexpected
	behavior
In-Reply-To: <CAF=dkzxCzUykaKuHpFz7+A2brmuHMBxJPUEadbgSdf5+5rewVg@mail.gmail.com>
References: <mailman.22.1339322855.4522.dev-context@ntg.nl>
	<06BE7710-F241-445A-9ABA-83B333A432BF@me.com>
	<97CD002D-C069-4CDE-910E-FED117796A32@googlemail.com>
	<CAF=dkzxCzUykaKuHpFz7+A2brmuHMBxJPUEadbgSdf5+5rewVg@mail.gmail.com>
Message-ID: <CAG5iGsDL_8MG1=K2yVpheQ7wnuiKGaAL-kkTVh7eAqA8a8zfig@mail.gmail.com>

On Mon, Jun 11, 2012 at 11:46 AM, Sietse Brouwer <sbbrouwer at gmail.com> wrote:
> Sido wrote:
>>> I had posted a question on stack-exchange and it was suggested to
>>> post a bug report here. I?m not sure if this is a bug, but it was
>>> unexpected behavior to me.
>
> Wolfgang wrote:
>> BTW: Please use next time the normal mailing list for such problems and not the developer list.
>
> That was my mistake: I thought it was a bug, and so I advised him to
> post to dev-context instead of ntg-context. Just to check: is
> dev-context at ntg.nl also for bug reports, or is it exclusively for
> development discussions and should (probable) bugs also go on
> ntg-context at ntg.nl?
Lets' say that dev-context at ntg.nl is for developers (features request
and bugs) .
Features request and bugs from users should be addressed to ntg-context at ntg.nl .

-- 
luigi

From schuster.wolfgang at googlemail.com  Mon Jun 11 14:07:42 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 11 Jun 2012 14:07:42 +0200
Subject: [dev-context] =?windows-1252?q?ctx_file_can=92t_be_used?=
In-Reply-To: <4FD51A2C.8080800@wxs.nl>
References: <6EF509B6-4688-4BFD-9BF8-DE397E2FDB21@googlemail.com>
	<4FD51A2C.8080800@wxs.nl>
Message-ID: <33AD37F9-3014-4BC2-B72C-A8AC2D457EE7@googlemail.com>


Am 11.06.2012 um 00:05 schrieb Hans Hagen:

> On 10-6-2012 15:03, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> ctx files can?t be used in the last beta.
>> 
>> This
>> 
>>   context --ctx=s-mod.ctx tabl-ntb.mkiv
>> 
>> generates the following error message:
>> 
>>   ctxname: s-mod.ctx...ex/texmf-context/scripts/context/lua/mtx-context.lua:261: bad argument #1 to 'match' (string expected, got nil)
> 
> hopefully fixed in the next upload

Yes, it works :)

Wolfgang

From aditya.mahajan at mcgill.ca  Thu Jun 14 05:57:10 2012
From: aditya.mahajan at mcgill.ca (Aditya Mahajan)
Date: Wed, 13 Jun 2012 23:57:10 -0400 (EDT)
Subject: [dev-context] Change preset to setups in page-lay.mkiv
Message-ID: <alpine.LNX.2.02.1206132352550.24146@ybpnyubfg.ybpnyqbznva>

Hi,

\setuplayouts has a "preset" option, which is used for specifying setups. 
This is the only instance where "preset" is used to specify "setups". All 
other uses of "preset" is in layers. I think that it will be more 
consistent to change that option to setups.

Aditya

From schuster.wolfgang at googlemail.com  Thu Jun 14 14:29:45 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 14 Jun 2012 14:29:45 +0200
Subject: [dev-context] Change preset to setups in page-lay.mkiv
In-Reply-To: <alpine.LNX.2.02.1206132352550.24146@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1206132352550.24146@ybpnyubfg.ybpnyqbznva>
Message-ID: <03A9E1E7-56F4-403A-93C8-7635930B101C@googlemail.com>


Am 14.06.2012 um 05:57 schrieb Aditya Mahajan:

> Hi,
> 
> \setuplayouts has a "preset" option, which is used for specifying setups. This is the only instance where "preset" is used to specify "setups". All other uses of "preset" is in layers. I think that it will be more consistent to change that option to setups.

This isn?t possible because \setuplayout has a ?setups? key which is used to load penalty setting which are set in spac-hor.mkiv.

Wolfgang

From schuster.wolfgang at googlemail.com  Thu Jun 14 15:12:47 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 14 Jun 2012 15:12:47 +0200
Subject: [dev-context] \framed[width=broad]
Message-ID: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>

Hi,

framed has the two keyword ?fit? and ?broad? for the height parameter but both have the same effect. Can this be changed and ?height=broad? result in ?height=\vsize? like ?width=broad? results in ?width=\hsize?.

There are cases like this

  \setupheadertexts[{\framed[width=\hsize,height=\vsize]{?}}]

where I would prefer to write ?width=broad? and ?height=broad? instead of passing dimensions to the keys.

Wolfgang

From sbbrouwer at gmail.com  Thu Jun 14 16:53:03 2012
From: sbbrouwer at gmail.com (Sietse Brouwer)
Date: Thu, 14 Jun 2012 16:53:03 +0200
Subject: [dev-context] \framed[width=broad]
In-Reply-To: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>
References: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>
Message-ID: <CAF=dkzy635S2e3wUuufESr7twZ9Wzzn=HoW5dS-QjYV4Q9qyCQ@mail.gmail.com>

On Thu, Jun 14, 2012 at 3:12 PM, Wolfgang Schuster
<schuster.wolfgang at googlemail.com> wrote:
> framed has the two keyword ?fit? and ?broad? for the height parameter
> but both have the same effect. Can this be changed and ?height=broad?
> result in ?height=\vsize? like ?width=broad? results in ?width=\hsize?.

In that case, I think height=tall would be a more appropriate keyword.
'broad' has very horizontal connotations.
'height=broad' could then remain a deprecated synonym for 'height=fit'.

Cheers,

Sietse

From netuse at lavabit.com  Thu Jun 14 16:53:40 2012
From: netuse at lavabit.com (Marco)
Date: Thu, 14 Jun 2012 16:53:40 +0200
Subject: [dev-context] Bug in \usepath
Message-ID: <20120614165340.5eaa88e7@homerow>

There's something fishy with \usepath. A simple call fails with

! LuaTeX error ...-new/tex/texmf-context/tex/context/base/data-res.lua:688: attempt to get length of local 'subpaths' (a nil value)
stack traceback:
	...-new/tex/texmf-context/tex/context/base/data-res.lua:688: in function 'registerextrapath'
	...-new/tex/texmf-context/tex/context/base/file-job.lua:71: in function 'usepath'
	<main ctx instance>:1: in main chunk.

\usepath [chapters]
\starttext
  Foo
\stoptext


Marco



From schuster.wolfgang at googlemail.com  Thu Jun 14 17:33:56 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Thu, 14 Jun 2012 17:33:56 +0200
Subject: [dev-context] \framed[width=broad]
In-Reply-To: <CAF=dkzy635S2e3wUuufESr7twZ9Wzzn=HoW5dS-QjYV4Q9qyCQ@mail.gmail.com>
References: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>
	<CAF=dkzy635S2e3wUuufESr7twZ9Wzzn=HoW5dS-QjYV4Q9qyCQ@mail.gmail.com>
Message-ID: <B1A4FD68-F8D3-416C-A58F-2CAB2F9F0ECA@googlemail.com>


Am 14.06.2012 um 16:53 schrieb Sietse Brouwer:

> On Thu, Jun 14, 2012 at 3:12 PM, Wolfgang Schuster
> <schuster.wolfgang at googlemail.com> wrote:
>> framed has the two keyword ?fit? and ?broad? for the height parameter
>> but both have the same effect. Can this be changed and ?height=broad?
>> result in ?height=\vsize? like ?width=broad? results in ?width=\hsize?.
> 
> In that case, I think height=tall would be a more appropriate keyword.
> 'broad' has very horizontal connotations.
> 'height=broad' could then remain a deprecated synonym for 'height=fit'.

I have no problem with a new keyword but then I would choose ?width=max? and ?height=max?.

Wolfgang

From adityam at umich.edu  Sat Jun 16 05:13:30 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Fri, 15 Jun 2012 23:13:30 -0400 (EDT)
Subject: [dev-context] Adding setuvalue etc to syst-gen.mkii
Message-ID: <alpine.LNX.2.02.1206152310480.3365@ybpnyubfg.ybpnyqbznva>

Hi Hans.

Can you add the following block of macros from syst-aux.mkiv to 
syst-gen.mkii?

\def\setuvalue    #1{\normalprotected\expandafter \def\csname#1\endcsname}
\def\setuevalue   #1{\normalprotected\expandafter\edef\csname#1\endcsname}
\def\setugvalue   #1{\normalprotected\expandafter\gdef\csname#1\endcsname}
\def\setuxvalue   #1{\normalprotected\expandafter\xdef\csname#1\endcsname}

I wonder how long should I support MkII for my modules?

Aditya

From pragma at wxs.nl  Mon Jun 18 10:22:14 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 18 Jun 2012 10:22:14 +0200
Subject: [dev-context] Adding setuvalue etc to syst-gen.mkii
In-Reply-To: <alpine.LNX.2.02.1206152310480.3365@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1206152310480.3365@ybpnyubfg.ybpnyqbznva>
Message-ID: <4FDEE536.8040400@wxs.nl>

On 16-6-2012 05:13, Aditya Mahajan wrote:
> Hi Hans.
>
> Can you add the following block of macros from syst-aux.mkiv to
> syst-gen.mkii?
>
> \def\setuvalue    #1{\normalprotected\expandafter \def\csname#1\endcsname}
> \def\setuevalue   #1{\normalprotected\expandafter\edef\csname#1\endcsname}
> \def\setugvalue   #1{\normalprotected\expandafter\gdef\csname#1\endcsname}
> \def\setuxvalue   #1{\normalprotected\expandafter\xdef\csname#1\endcsname}

ok

> I wonder how long should I support MkII for my modules?

at some point you can freeze the mkii one (I've done that with most modules)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From pragma at wxs.nl  Mon Jun 18 10:36:36 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 18 Jun 2012 10:36:36 +0200
Subject: [dev-context] Bug in \usepath
In-Reply-To: <20120614165340.5eaa88e7@homerow>
References: <20120614165340.5eaa88e7@homerow>
Message-ID: <4FDEE894.6060002@wxs.nl>

On 14-6-2012 16:53, Marco wrote:
> There's something fishy with \usepath. A simple call fails with
>
> ! LuaTeX error ...-new/tex/texmf-context/tex/context/base/data-res.lua:688: attempt to get length of local 'subpaths' (a nil value)
> stack traceback:
> 	...-new/tex/texmf-context/tex/context/base/data-res.lua:688: in function 'registerextrapath'
> 	...-new/tex/texmf-context/tex/context/base/file-job.lua:71: in function 'usepath'
> 	<main ctx instance>:1: in main chunk.
>
> \usepath [chapters]
> \starttext
>    Foo
> \stoptext

line 681:

function resolvers.registerextrapath(paths,subpaths)
     paths = settings_to_array(paths)
     subpaths = settings_to_array(subpaths)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From pragma at wxs.nl  Mon Jun 18 16:22:29 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 18 Jun 2012 16:22:29 +0200
Subject: [dev-context] \framed[width=broad]
In-Reply-To: <B1A4FD68-F8D3-416C-A58F-2CAB2F9F0ECA@googlemail.com>
References: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>
	<CAF=dkzy635S2e3wUuufESr7twZ9Wzzn=HoW5dS-QjYV4Q9qyCQ@mail.gmail.com>
	<B1A4FD68-F8D3-416C-A58F-2CAB2F9F0ECA@googlemail.com>
Message-ID: <4FDF39A5.7000400@wxs.nl>

On 14-6-2012 17:33, Wolfgang Schuster wrote:
>
> Am 14.06.2012 um 16:53 schrieb Sietse Brouwer:
>
>> On Thu, Jun 14, 2012 at 3:12 PM, Wolfgang Schuster
>> <schuster.wolfgang at googlemail.com> wrote:
>>> framed has the two keyword ?fit? and ?broad? for the height parameter
>>> but both have the same effect. Can this be changed and ?height=broad?
>>> result in ?height=\vsize? like ?width=broad? results in ?width=\hsize?.
>>
>> In that case, I think height=tall would be a more appropriate keyword.
>> 'broad' has very horizontal connotations.
>> 'height=broad' could then remain a deprecated synonym for 'height=fit'.
>
> I have no problem with a new keyword but then I would choose ?width=max? and ?height=max?.

indeed 'max' is the only candidate ... as \framed is pretty important 
and used all over the place adding extra values to check is not always 
possible without interference so it has to be experimental

wolfgang: in the next beta the width/height/offset/strut handling will 
be csname'd as in other places so you can check for issues then

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From schuster.wolfgang at googlemail.com  Tue Jun 19 23:48:05 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 19 Jun 2012 23:48:05 +0200
Subject: [dev-context] \framed[width=broad]
In-Reply-To: <4FDF39A5.7000400@wxs.nl>
References: <06CE1C8F-96D6-4F4A-92E8-19F521557AF1@googlemail.com>
	<CAF=dkzy635S2e3wUuufESr7twZ9Wzzn=HoW5dS-QjYV4Q9qyCQ@mail.gmail.com>
	<B1A4FD68-F8D3-416C-A58F-2CAB2F9F0ECA@googlemail.com>
	<4FDF39A5.7000400@wxs.nl>
Message-ID: <88C27E05-D03B-4990-A991-DE209C64CEAB@googlemail.com>


Am 18.06.2012 um 16:22 schrieb Hans Hagen:

> On 14-6-2012 17:33, Wolfgang Schuster wrote:
>> 
>> Am 14.06.2012 um 16:53 schrieb Sietse Brouwer:
>> 
>>> On Thu, Jun 14, 2012 at 3:12 PM, Wolfgang Schuster
>>> <schuster.wolfgang at googlemail.com> wrote:
>>>> framed has the two keyword ?fit? and ?broad? for the height parameter
>>>> but both have the same effect. Can this be changed and ?height=broad?
>>>> result in ?height=\vsize? like ?width=broad? results in ?width=\hsize?.
>>> 
>>> In that case, I think height=tall would be a more appropriate keyword.
>>> 'broad' has very horizontal connotations.
>>> 'height=broad' could then remain a deprecated synonym for 'height=fit'.
>> 
>> I have no problem with a new keyword but then I would choose ?width=max? and ?height=max?.
> 
> indeed 'max' is the only candidate ... as \framed is pretty important and used all over the place adding extra values to check is not always possible without interference so it has to be experimental
> 
> wolfgang: in the next beta the width/height/offset/strut handling will be csname'd as in other places so you can check for issues then

I haven?t checked all value but the ?max? setting works for width and height :)

Wolfgang

From pragma at wxs.nl  Fri Jul  6 19:24:43 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Jul 2012 19:24:43 +0200
Subject: [dev-context] beta
Message-ID: <4FF71F5B.1050509@wxs.nl>

Hi Wolfgang,

The current beta has pack-rul.mkiv adapted ... it also uses the 
commandhandler code now so you might want to have a look at it. There 
are now only a few mechanisms left that don't use the new parent chain 
code. AFAIKS the speed penalty is neglectable.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From schuster.wolfgang at gmail.com  Fri Jul  6 20:08:20 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 6 Jul 2012 20:08:20 +0200
Subject: [dev-context] beta
In-Reply-To: <4FF71F5B.1050509@wxs.nl>
References: <4FF71F5B.1050509@wxs.nl>
Message-ID: <844BC752-E862-4203-8F73-01D2B055F61C@gmail.com>


Am 06.07.2012 um 19:24 schrieb Hans Hagen:

> Hi Wolfgang,
> 
> The current beta has pack-rul.mkiv adapted ... it also uses the commandhandler code now so you might want to have a look at it. There are now only a few mechanisms left that don't use the new parent chain code. AFAIKS the speed penalty is neglect able.

\unexpanded\def\pack_framed_defined_process[#1]% official (not much checking, todo: parent)
  {\bgroup
   \ifcsname\??regularframedlevel#1\endcsname
     \expandafter\let\expandafter\c_framed_temp\csname\??regularframedlevel#1\endcsname
   \else
     \let\c_framed_temp\c_framed_crap
   \fi
   \advance\c_framed_temp\plusone
   \expandafter\def\csname\??framed#1>\the\c_framed_temp:\s!parent\endcsname{\??framed#1}% \inheritlocalframed
   \bgroup
   \edef\currentframed{#1>\the\c_pack_framed_temp}%
   \pack_framed_initialize
-  \dosingleempty\pack_framed_process}
+  \dosingleempty\pack_framed_defined_process_indeed}

Wolfgang

From netuse at lavabit.com  Mon Jul 16 21:15:34 2012
From: netuse at lavabit.com (Marco)
Date: Mon, 16 Jul 2012 21:15:34 +0200
Subject: [dev-context] Spurious parameter in m-visual.mkiv
Message-ID: <20120716211534.32efd403@homerow>

Hi!

There's a spurious parameter in \ruledbaseline, which breaks the
visual module. I guess it's a leftover from the clean-up. I assume
the parameter can simply be omitted (untested):

\unexpanded\def\ruledbaseline
  {\vrule \!!width \zeropoint
   \bgroup
   \dontinterfere
   \doglobal\increment\ruledbaselines
   \scratchdimen\nofruledbaselines\baselineskip
   \setbox\scratchbox\normalvbox to 2\scratchdimen
     {\leaders
        \normalhbox
          {\strut
           \vrule
             \!!height \testrulewidth
             \!!depth \testrulewidth
             \!!width 120\points}
      \normalvfill}%
   \smashbox\scratchbox
   \advance\scratchdimen \strutheightfactor\baselineskip
   \setbox\scratchbox\normalhbox
     {\normalhskip -48\points
      \normalhbox to 24\points
        {\normalhss
-         {\ttxx#1}%
-         \ruledbaselines
+         {\ttxx\ruledbaselines}%
         \normalhskip6\points}%
      \raise\scratchdimen\box\scratchbox}%
   \smashbox\scratchbox
   \box\scratchbox
   \egroup}

Marco



From pragma at wxs.nl  Mon Jul 16 21:39:35 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Jul 2012 21:39:35 +0200
Subject: [dev-context] Spurious parameter in m-visual.mkiv
In-Reply-To: <20120716211534.32efd403@homerow>
References: <20120716211534.32efd403@homerow>
Message-ID: <50046DF7.7040503@wxs.nl>

On 16-7-2012 21:15, Marco wrote:
> Hi!
>
> There's a spurious parameter in \ruledbaseline, which breaks the
> visual module. I guess it's a leftover from the clean-up. I assume
> the parameter can simply be omitted (untested):

ok

so someone is using that code ... (it also needs an overhaul but modules 
come later)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From pmlists at free.fr  Fri Sep  7 00:03:15 2012
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Fri, 07 Sep 2012 00:03:15 +0200
Subject: [dev-context] 2 patches for grph-inc
Message-ID: <87fw6uzu58.fsf@micropit.couberia.bzh>

Hi Hans,

Could you please add these 2 patches (or something similar), because the
grph-downsample module? would work much better then:

1.) To get the width and the height into the name of the file,
    because when the figure dimensions change, there must be a new
    conversion:

--8<---------------cut here---------------start------------->8---
--- grph-inc.lua~	2012-06-05 10:37:01.000000000 +0200
+++ grph-inc.lua	2012-07-31 22:40:39.214426838 +0200
@@ -528,6 +528,9 @@
                     if resolution and resolution ~= "" then -- the order might change
                         newbase = newbase .. "_" .. resolution
                     end
+                    local width = figures.current().request.width
+                    local height = figures.current().request.height
+                    newbase = newbase .. "_" .. width .. "_" .. height
                     --
                     -- see *, we had:
                     --
--8<---------------cut here---------------end--------------->8---


2.) To avoid crap in the width and height options:

--8<---------------cut here---------------start------------->8---
--- grph-inc.mkiv~	2012-07-20 23:26:52.000000000 +0200
+++ grph-inc.mkiv	2012-08-01 00:02:23.851094854 +0200
@@ -293,6 +293,10 @@
    %
    \the\t_grph_include_local_settings
    \dostarttagged\t!image\empty
+   \edef\current_width{\externalfigureparameter\c!width}%
+   \edef\current_height{\externalfigureparameter\c!height}%
+   \def\nocrap##1{\doifnotemptyvalue{##1}{%
+       \the\dimexpr\csname##1\endcsname\relax}}%
    \ctxlua{figures.push {
         name       = "\p_grph_include_name",
         label      = "\p_grph_include_label",
@@ -312,8 +316,8 @@
         resolution = "\externalfigureparameter\c!resolution",
         color      = "\internalspotcolorparent{\externalfigureparameter\c!color}", % hack is needed
         ["repeat"] = "\externalfigureparameter\c!repeat",
-        width      = "\externalfigureparameter\c!width",  % can be crap
-        height     = "\externalfigureparameter\c!height", % can be crap
+        width      = "\nocrap{current_width}",  % no more crap
+        height     = "\nocrap{current_height}", % no more crap
     } }%
    \ctxlua{figures.identify()}%
    % also mode: checkpresense only
--8<---------------cut here---------------end--------------->8---


? http://modules.contextgarden.net/grph-downsample


TIA,
-- 
           Peter

From adityam at umich.edu  Fri Sep  7 00:43:03 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Thu, 6 Sep 2012 18:43:03 -0400 (EDT)
Subject: [dev-context] 2 patches for grph-inc
In-Reply-To: <87fw6uzu58.fsf@micropit.couberia.bzh>
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
Message-ID: <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq>

On Fri, 7 Sep 2012, Peter M?nster wrote:

> 2.) To avoid crap in the width and height options:
>
> --8<---------------cut here---------------start------------->8---
> --- grph-inc.mkiv~	2012-07-20 23:26:52.000000000 +0200
> +++ grph-inc.mkiv	2012-08-01 00:02:23.851094854 +0200
> @@ -293,6 +293,10 @@
>    %
>    \the\t_grph_include_local_settings
>    \dostarttagged\t!image\empty
> +   \edef\current_width{\externalfigureparameter\c!width}%
> +   \edef\current_height{\externalfigureparameter\c!height}%
> +   \def\nocrap##1{\doifnotemptyvalue{##1}{%
> +       \the\dimexpr\csname##1\endcsname\relax}}%

It is better to use a more meaningful name. This can be a general macro 
that will be useful outside of the figure inclusion code as well.

>    \ctxlua{figures.push {
>         name       = "\p_grph_include_name",
>         label      = "\p_grph_include_label",
> @@ -312,8 +316,8 @@
>         resolution = "\externalfigureparameter\c!resolution",
>         color      = "\internalspotcolorparent{\externalfigureparameter\c!color}", % hack is needed
>         ["repeat"] = "\externalfigureparameter\c!repeat",
> -        width      = "\externalfigureparameter\c!width",  % can be crap
> -        height     = "\externalfigureparameter\c!height", % can be crap
> +        width      = "\nocrap{current_width}",  % no more crap
> +        height     = "\nocrap{current_height}", % no more crap
>     } }%

Aditya

From pmlists at free.fr  Thu Sep 13 11:25:00 2012
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Thu, 13 Sep 2012 11:25:00 +0200
Subject: [dev-context] 2 patches for grph-inc
In-Reply-To: <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq> (Aditya
 Mahajan's message of "Thu, 6 Sep 2012 18:43:03 -0400 (EDT)")
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
 <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq>
Message-ID: <87pq5qs2ab.fsf@micropit.couberia.selfip.net>

On Fri, Sep 07 2012, Aditya Mahajan wrote:

>> +   \edef\current_width{\externalfigureparameter\c!width}%
>> +   \edef\current_height{\externalfigureparameter\c!height}%
>> +   \def\nocrap##1{\doifnotemptyvalue{##1}{%
>> +       \the\dimexpr\csname##1\endcsname\relax}}%
>
> It is better to use a more meaningful name. This can be a general macro that
> will be useful outside of the figure inclusion code as well.

Ok. What about \scratch_current_width, \scratch_current_height,
\scratch_nocrap ?  Or something similar...

-- 
           Peter

From adityam at umich.edu  Fri Sep 14 00:07:21 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Thu, 13 Sep 2012 18:07:21 -0400 (EDT)
Subject: [dev-context] 2 patches for grph-inc
In-Reply-To: <87pq5qs2ab.fsf@micropit.couberia.selfip.net>
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
 <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq>
 <87pq5qs2ab.fsf@micropit.couberia.selfip.net>
Message-ID: <alpine.LNX.2.02.1209131805070.12157@qrpragenyvmrq>

On Thu, 13 Sep 2012, Peter M?nster wrote:

> On Fri, Sep 07 2012, Aditya Mahajan wrote:
>
>>> +   \edef\current_width{\externalfigureparameter\c!width}%
>>> +   \edef\current_height{\externalfigureparameter\c!height}%
>>> +   \def\nocrap##1{\doifnotemptyvalue{##1}{%
>>> +       \the\dimexpr\csname##1\endcsname\relax}}%
>>
>> It is better to use a more meaningful name. This can be a general macro that
>> will be useful outside of the figure inclusion code as well.
>
> Ok. What about \scratch_current_width, \scratch_current_height,
> \scratch_nocrap ?  Or something similar...

Hans already added a generic function \setemeasure to syst-aux, that can 
be used here.

Note that a simple \doifnotemptyvalue is not enough. I can pass values
like 'fit', 'max', etc to height and width keys, so you must check if what 
is being passed is a dimension before calling \dimexpr.

Aditya

From pmlists at free.fr  Fri Sep 14 06:56:56 2012
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Fri, 14 Sep 2012 06:56:56 +0200
Subject: [dev-context] 2 patches for grph-inc
In-Reply-To: <alpine.LNX.2.02.1209131805070.12157@qrpragenyvmrq> (Aditya
 Mahajan's message of "Thu, 13 Sep 2012 18:07:21 -0400 (EDT)")
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
 <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq>
 <87pq5qs2ab.fsf@micropit.couberia.selfip.net>
 <alpine.LNX.2.02.1209131805070.12157@qrpragenyvmrq>
Message-ID: <877grxrylj.fsf@micropit.couberia.selfip.net>

On Fri, Sep 14 2012, Aditya Mahajan wrote:

> Hans already added a generic function \setemeasure to syst-aux, that can be
> used here.

Thanks, I'll take a look.


> Note that a simple \doifnotemptyvalue is not enough. I can pass values
> like 'fit', 'max', etc to height and width keys, so you must check if what is
> being passed is a dimension before calling \dimexpr.

Are you sure? According to
http://wiki.contextgarden.net/Command/useexternalfigure
you have to pass `fit' and `max' to `factor='.

-- 
           Peter

From wolfgang.schuster at gmail.com  Sun Sep 16 10:14:49 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 16 Sep 2012 10:14:49 +0200
Subject: [dev-context] supp-mat.mkiv
Message-ID: <0632044B-2536-4272-B69C-1C04DBEED5EB@gmail.com>

Hi Hans,

\let\normalsuperscript \Usuperscript
\let\normalsubscript   \Usubscript
\let\normalstartimath  \Ustartmath
\let\normalstopimath   \Ustopmath
\let\normalstartdmath  \Ustartdisplaymath
-\let\normalstopdmath   \Ustopmath
+\let\normalstopdmath   \Ustopdisplaymath

\def\normalmathaligntab{&} % \let\normalmathaligntab\aligntab does to work well in a let to & (a def works ok)

\let\normalsuper       \Usuperscript       % obsolete
\let\normalsuber       \Usubscript         % obsolete

\let\startimath        \Ustartmath
\let\stopimath         \Ustopmath
\let\startdmath        \Ustartdisplaymath
-\let\stopdmath         \Ustopmath
+\let\stopdmath         \Ustopdisplaymath

Wolfgang

From pragma at wxs.nl  Sun Sep 16 12:33:40 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 16 Sep 2012 12:33:40 +0200
Subject: [dev-context] supp-mat.mkiv
In-Reply-To: <0632044B-2536-4272-B69C-1C04DBEED5EB@gmail.com>
References: <0632044B-2536-4272-B69C-1C04DBEED5EB@gmail.com>
Message-ID: <5055AB04.7080605@wxs.nl>

On 16-9-2012 10:14, Wolfgang Schuster wrote:
> Hi Hans,
>
> \let\normalsuperscript \Usuperscript
> \let\normalsubscript   \Usubscript
> \let\normalstartimath  \Ustartmath
> \let\normalstopimath   \Ustopmath
> \let\normalstartdmath  \Ustartdisplaymath
> -\let\normalstopdmath   \Ustopmath
> +\let\normalstopdmath   \Ustopdisplaymath
>
> \def\normalmathaligntab{&} % \let\normalmathaligntab\aligntab does to work well in a let to & (a def works ok)
>
> \let\normalsuper       \Usuperscript       % obsolete
> \let\normalsuber       \Usubscript         % obsolete
>
> \let\startimath        \Ustartmath
> \let\stopimath         \Ustopmath
> \let\startdmath        \Ustartdisplaymath
> -\let\stopdmath         \Ustopmath
> +\let\stopdmath         \Ustopdisplaymath

Ah, ok, fixed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pmlists at free.fr  Mon Sep 24 23:19:12 2012
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Mon, 24 Sep 2012 23:19:12 +0200
Subject: [dev-context] 2 patches for grph-inc
In-Reply-To: <alpine.LNX.2.02.1209131805070.12157@qrpragenyvmrq> (Aditya
 Mahajan's message of "Thu, 13 Sep 2012 18:07:21 -0400 (EDT)")
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
 <alpine.LNX.2.02.1209061839340.16874@qrpragenyvmrq>
 <87pq5qs2ab.fsf@micropit.couberia.selfip.net>
 <alpine.LNX.2.02.1209131805070.12157@qrpragenyvmrq>
Message-ID: <876273yv8v.fsf@micropit.couberia.selfip.net>

On Fri, Sep 14 2012, Aditya Mahajan wrote:

> Hans already added a generic function \setemeasure to syst-aux, that can be
> used here.

I've tried, but without success... :(

TIA for any further help,
-- 
           Peter

From wolfgang.schuster at gmail.com  Mon Oct  1 19:47:21 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 1 Oct 2012 19:47:21 +0200
Subject: [dev-context] Reset counter with each heading
Message-ID: <CC31812B-673A-4B97-9CF4-4199B1155596@gmail.com>

Hi Hans,

can you add a option for the ?way? key for \setupcounter which resets a counter for every section independent of the level which was requested by Peter Schorsch on the mailing list. I looked into the source file (strc-num.lua and strc-sec.mkiv) and only four lines have to be changed to add this feature (I used ?head? for the name because there was a predefined variable).


strc-sec.mkiv:

\setvalue{\??headlevel\v!block}{0}
\setvalue{\??headlevel\v!none }{-1}
\setvalue{\??headlevel\v!text }{-2}
+\setvalue{\??headlevel\v!head }{-3}


strc-num.lua:

function counters.setown(name,n,value)
    local cd = counterdata[name]
    if cd then
        local d = allocate(name,n)
        d.own = value
        d.number = (d.number or d.start or 0) + (d.step or 0)
        local level = cd.level
        if not level or level == -1 then
            -- -1 is signal that we reset manually
-       elseif level > 0 then
 +      elseif level > 0 or level == -3 then
            check(name,d,n+1)
        elseif level == 0 then
            -- happens elsewhere, check this for block
        end
        synchronize(name,d)
    end
end

function counters.add(name,n,delta)
    local cd = counterdata[name]
    if cd and (cd.state == v_start or cd.state == "") then
        local data = cd.data
        local d = allocate(name,n)
        d.number = (d.number or d.start or 0) + delta*(d.step or 0)
     -- d.own = nil
        local level = cd.level
        if not level or level == -1 then
            -- -1 is signal that we reset manually
            if trace_counters then
                report_counters("adding, name: %s, level: manually, action: no checking",name)
            end
        elseif level == -2 then
            -- -2 is signal that we work per text
            if trace_counters then
                report_counters("adding, name: %s, level: text, action: checking",name)
            end
            check(name,data,n+1)
-       elseif level > 0 then
+       elseif level > 0 or level == -3 then
            -- within countergroup
            if trace_counters then
                report_counters("adding, name: %s, level: %s, action: checking within group",name,level)
            end
            check(name,data,n+1)
        elseif level == 0 then
            -- happens elsewhere
            if trace_counters then
                report_counters("adding, name: %s, level: %s, action: no checking",name,level)
            end
        else
            if trace_counters then
                report_counters("adding, name: %s, level: unknown, action: no checking",name)
            end
        end
        synchronize(name,d)
        return d.number -- not needed
    end
    return 0
end

function counters.check(level)
    for name, cd in next, counterdata do
-       if cd.level == level then
+       if cd.level == level or level > 0 and cd.level == -3 then
            if trace_counters then
                report_counters("resetting, name: %s, level: %s",name,level)
            end
            reset(name)
        end
    end
end


The question for the counter.check function is if it should also reset the counter for each new sectionblock (replace my change above with ?if cd.level == level then?) or only at the start of a new section (that?s how my change behaves now).

Wolfgang

From wolfgang.schuster at gmail.com  Mon Oct  1 19:49:49 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 1 Oct 2012 19:49:49 +0200
Subject: [dev-context] Reset counter with each heading
In-Reply-To: <CC31812B-673A-4B97-9CF4-4199B1155596@gmail.com>
References: <CC31812B-673A-4B97-9CF4-4199B1155596@gmail.com>
Message-ID: <812F4481-FDCA-4402-9EBB-B18ECA0A91A9@gmail.com>


Am 01.10.2012 um 19:47 schrieb Wolfgang Schuster <wolfgang.schuster at gmail.com>:

> Hi Hans,
> 
> can you add a option for the ?way? key for \setupcounter which resets a counter for every section independent of the level which was requested by Peter Schorsch on the mailing list. I looked into the source file (strc-num.lua and strc-sec.mkiv) and only four lines have to be changed to add this feature (I used ?head? for the name because there was a predefined variable).
> 
> 
> strc-sec.mkiv:
> 
> \setvalue{\??headlevel\v!block}{0}
> \setvalue{\??headlevel\v!none }{-1}
> \setvalue{\??headlevel\v!text }{-2}
> +\setvalue{\??headlevel\v!head }{-3}
> 
> 
> strc-num.lua:
> 
> function counters.setown(name,n,value)
>    local cd = counterdata[name]
>    if cd then
>        local d = allocate(name,n)
>        d.own = value
>        d.number = (d.number or d.start or 0) + (d.step or 0)
>        local level = cd.level
>        if not level or level == -1 then
>            -- -1 is signal that we reset manually
> -       elseif level > 0 then
> +      elseif level > 0 or level == -3 then
>            check(name,d,n+1)
>        elseif level == 0 then
>            -- happens elsewhere, check this for block
>        end
>        synchronize(name,d)
>    end
> end
> 
> function counters.add(name,n,delta)
>    local cd = counterdata[name]
>    if cd and (cd.state == v_start or cd.state == "") then
>        local data = cd.data
>        local d = allocate(name,n)
>        d.number = (d.number or d.start or 0) + delta*(d.step or 0)
>     -- d.own = nil
>        local level = cd.level
>        if not level or level == -1 then
>            -- -1 is signal that we reset manually
>            if trace_counters then
>                report_counters("adding, name: %s, level: manually, action: no checking",name)
>            end
>        elseif level == -2 then
>            -- -2 is signal that we work per text
>            if trace_counters then
>                report_counters("adding, name: %s, level: text, action: checking",name)
>            end
>            check(name,data,n+1)
> -       elseif level > 0 then
> +       elseif level > 0 or level == -3 then
>            -- within countergroup
>            if trace_counters then
>                report_counters("adding, name: %s, level: %s, action: checking within group",name,level)
>            end
>            check(name,data,n+1)
>        elseif level == 0 then
>            -- happens elsewhere
>            if trace_counters then
>                report_counters("adding, name: %s, level: %s, action: no checking",name,level)
>            end
>        else
>            if trace_counters then
>                report_counters("adding, name: %s, level: unknown, action: no checking",name)
>            end
>        end
>        synchronize(name,d)
>        return d.number -- not needed
>    end
>    return 0
> end
> 
> function counters.check(level)
>    for name, cd in next, counterdata do
> -       if cd.level == level then
> +       if cd.level == level or level > 0 and cd.level == -3 then
>            if trace_counters then
>                report_counters("resetting, name: %s, level: %s",name,level)
>            end
>            reset(name)
>        end
>    end
> end
> 
> 
> The question for the counter.check function is if it should also reset the counter for each new sectionblock (replace my change above with ?if cd.level == level then?) or only at the start of a new section (that?s how my change behaves now).

Here is a example to test the option:

\definecounter[test]

%\setupcounter[test][way=bytext]
\setupcounter[test][way=byhead]

\define\test
  {\incrementcounter[test]%
   \convertedcounter[test]}

\starttext

\startbodymatter

\chapter{Chapter}\test

\section{Section}\test

\subsection{Subsection}\test

\subsubsection{Subsubsection}\test

\stopbodymatter

\startbackmatter

%\chapter{Another chapter}

\test

\stopbackmatter

\stoptext

Wolfgang

From pragma at wxs.nl  Tue Oct  2 15:09:39 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 02 Oct 2012 15:09:39 +0200
Subject: [dev-context] Reset counter with each heading
In-Reply-To: <CC31812B-673A-4B97-9CF4-4199B1155596@gmail.com>
References: <CC31812B-673A-4B97-9CF4-4199B1155596@gmail.com>
Message-ID: <506AE793.1070908@wxs.nl>

Hi,

> function counters.check(level)
>      for name, cd in next, counterdata do
> -       if cd.level == level then
> +       if cd.level == level or level > 0 and cd.level == -3 then
>              if trace_counters then
>                  report_counters("resetting, name: %s, level: %s",name,level)
>              end
>              reset(name)
>          end
>      end
> end
>
>
> The question for the counter.check function is if it should also reset the counter for each new sectionblock (replace my change above with ?if cd.level == level then?) or only at the start of a new section (that?s how my change behaves now).

let's make two branches and wait till we get complaints ..

function counters.check(level)
     for name, cd in next, counterdata do
         if level > 0 and cd.level == -3 then -- could become an option
             if trace_counters then
                 report_counters("resetting, name: %s, level: %s 
(head)",name,level)
             end
             reset(name)
         elseif cd.level == level then
             if trace_counters then
                 report_counters("resetting, name: %s, level: %s 
(normal)",name,level)
             end
             reset(name)
         end
     end
end



-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Sat Oct  6 09:31:36 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sat, 6 Oct 2012 09:31:36 +0200
Subject: [dev-context] symb-run.mkiv
Message-ID: <B7D72D0C-0C72-4917-9E69-03CD6292E4DD@gmail.com>

Hi Hans,

-\unexpanded\gdef\symb_show_set
-  {\dosingleargument\doshowsymbolset}
+\unexpanded\gdef\showsymbolset
+  {\dosingleargument\symb_show_set}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Oct 14 09:11:00 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 14 Oct 2012 09:11:00 +0200
Subject: [dev-context] pack-com.mkiv
Message-ID: <200B5554-B7B5-4C7C-8506-D1C6FAC0A6A0@gmail.com>

Hi,

a typo (missing ?other? \pack_topofeach_two) in and to many hash signs:

-\def\pack_topofeachother_one{\bgroup\setbox0\box\nextbox\dowithnextboxcs\pack_topofeach_two \hbox}
+\def\pack_topofeachother_one{\bgroup\setbox0\box\nextbox\dowithnextboxcs\pack_topofeachother_two\hbox}
\def\pack_sidebyside_one    {\bgroup\setbox0\box\nextbox\dowithnextboxcs\pack_sidebyside_two\hbox}

-\def\pack_topofeachother_two{\setbox2\box\nextbox\halign{\hss####\hss\cr\box0\cr\box2\cr}\egroup\egroup}
-\def\pack_sidebyside_two    {\setbox2\box\nextbox\valign{\vss####\vss\cr\box0\cr\box2\cr}\egroup\egroup}
+\def\pack_topofeachother_two{\setbox2\box\nextbox\halign{\hss##\hss\cr\box0\cr\box2\cr}\egroup\egroup}
+\def\pack_sidebyside_two    {\setbox2\box\nextbox\valign{\vss##\vss\cr\box0\cr\box2\cr}\egroup\egroup}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Oct 14 23:18:53 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 14 Oct 2012 23:18:53 +0200
Subject: [dev-context] font-new.mkiv
Message-ID: <CEB6E470-6648-4642-B0BF-EE32B26BFFEB@gmail.com>

Hi,

\def\strc_formulas_handle_sub_numbering
  {\iftrialtypesetting
     \strc_counters_save\v!formula
-    \strc_formulas_handle_sub_numbering
+    \strc_formulas_handle_sub_numbering_indeed
     \strc_counters_restore\v!formula
   \else
-    \strc_formulas_handle_sub_numbering
+    \strc_formulas_handle_sub_numbering_indeed
   \fi}

Wolfgang

From pragma at wxs.nl  Mon Oct 15 09:52:42 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 15 Oct 2012 09:52:42 +0200
Subject: [dev-context] font-new.mkiv
In-Reply-To: <CEB6E470-6648-4642-B0BF-EE32B26BFFEB@gmail.com>
References: <CEB6E470-6648-4642-B0BF-EE32B26BFFEB@gmail.com>
Message-ID: <507BC0CA.2000706@wxs.nl>

On 14-10-2012 23:18, Wolfgang Schuster wrote:
> Hi,
>
> \def\strc_formulas_handle_sub_numbering
>    {\iftrialtypesetting
>       \strc_counters_save\v!formula
> -    \strc_formulas_handle_sub_numbering
> +    \strc_formulas_handle_sub_numbering_indeed
>       \strc_counters_restore\v!formula
>     \else
> -    \strc_formulas_handle_sub_numbering
> +    \strc_formulas_handle_sub_numbering_indeed
>     \fi}

ok, will also move to strc-mat

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Mon Oct 15 10:20:06 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 15 Oct 2012 10:20:06 +0200
Subject: [dev-context] Subfootnotes
Message-ID: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>

Hi Hans,

subfootnotes don?t work because


1. \noteparameter has no parent set which can be used for undefined values which can be solved with the extra line in \strc_define_commands_notation

\unexpanded\def\strc_define_commands_notation#1#2#3% current level parent
  {\doifelsenothing{#3}
     {\normalexpanded{\defineconstruction[#1][\s!handler=\v!notation,\c!level=#2]}%
      \setevalue{\??notation#1:\s!parent}{\??notation}}%
     {\normalexpanded{\defineconstruction[#1][#3][\s!handler=\v!notation,\c!level=#2]}%
+     \setevalue{\??note    #1:\s!parent}{\??note    #3}%
      \setevalue{\??notation#1:\s!parent}{\??notation#3}}%
   \setuevalue{\e!next #1}{\strc_notations_next   }%
   \setuevalue{\c!reset#1}{\strc_notations_reset  }%
   %setuevalue{\c!set  #1}{\strc_notations_set    }%
   %setuevalue        {#1}{\strc_notations_command{\currentnotation}}%
   %setuevalue{\e!start#1}{\strc_notations_start  {\currentnotation}{#1}}%
   \setuevalue        {#1}{\strc_notations_command{#1}}%
   \setuevalue{\e!start#1}{\strc_notations_start  {#1}{#1}}% okay?
   \setuevalue{\e!stop #1}{\strc_notations_stop   }}


2. the name for the insert is wrong because it uses the name of the command (e.g. subfootnote) and not the name of the note type, e.g. in this code block \namedinsertionnumber and \page_inserts_set_location get ?subfootnote? as argument but it has to be always ?footnote?.

\def\strc_notes_set_location_text % we don't use inserts anyway (e.g. endnotes)
  {\settrue\c_strc_notes_delayed
   \ctxcommand{setnotestate("\currentnote","store")}%
   \page_inserts_set_location\currentnote\v!text % \setupinsertion[\currentnote][\c!location=\v!text]%
   \global\count\namedinsertionnumber\currentnote\zerocount
   \global\dimen\namedinsertionnumber\currentnote\maxdimen
   \global\skip \namedinsertionnumber\currentnote\zeropoint}

One way to fix is to store the note type in a key when \definenote is called (e.g. ?insert=\currentote? but only when \footnote is created and not for \subfootnote) and use this key as argument for \namedinsertionnumber etc.

Wolfgang

From pragma at wxs.nl  Mon Oct 15 19:19:11 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 15 Oct 2012 19:19:11 +0200
Subject: [dev-context] Subfootnotes
In-Reply-To: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>
References: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>
Message-ID: <507C458F.2030107@wxs.nl>

On 15-10-2012 10:20, Wolfgang Schuster wrote:
> Hi Hans,
>
> subfootnotes don?t work because

new beta

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From homerow at lavabit.com  Mon Oct 15 19:44:38 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Mon, 15 Oct 2012 19:44:38 +0200
Subject: [dev-context] Subfootnotes
In-Reply-To: <507C458F.2030107@wxs.nl>
References: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>
 <507C458F.2030107@wxs.nl>
Message-ID: <20121015194438.59164e83@homerow>

2012-10-15 Hans Hagen:

> On 15-10-2012 10:20, Wolfgang Schuster wrote:
> > Hi Hans,
> >
> > subfootnotes don?t work because
> 
> new beta

The following example prints

    1
    1.A

in beta 2011.11.29 23:11

and

    1
    1.1

in the current one.


\definestructureconversionset [footnote] [numbers, Characters] [numbers]
\setupenumerations            [footnote] [numberconversionset=footnote]

\starttext
\startfootnote This is a footnote. \stopfootnote\par
\startsubfootnote This is a subfootnote. \stopsubfootnote
\stoptext

Marco


From schuster.wolfgang at gmail.com  Mon Oct 15 19:51:07 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 15 Oct 2012 19:51:07 +0200
Subject: [dev-context] Subfootnotes
In-Reply-To: <20121015194438.59164e83@homerow>
References: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>
 <507C458F.2030107@wxs.nl> <20121015194438.59164e83@homerow>
Message-ID: <72BF11FB-219B-4382-BD53-5CE407035F21@gmail.com>


Am 15.10.2012 um 19:44 schrieb Marco Patzer <homerow at lavabit.com>:

> 2012-10-15 Hans Hagen:
> 
>> On 15-10-2012 10:20, Wolfgang Schuster wrote:
>>> Hi Hans,
>>> 
>>> subfootnotes don?t work because
>> 
>> new beta
> 
> The following example prints
> 
>    1
>    1.A
> 
> in beta 2011.11.29 23:11
> 
> and
> 
>    1
>    1.1
> 
> in the current one.
> 
> 
> \definestructureconversionset [footnote] [numbers, Characters] [numbers]
> \setupenumerations            [footnote] [numberconversionset=footnote]

\setupnotation[footnote][numberconversionset=footnote]

Wolfgang

From schuster.wolfgang at gmail.com  Mon Oct 15 20:04:03 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 15 Oct 2012 20:04:03 +0200
Subject: [dev-context] Subfootnotes
In-Reply-To: <72BF11FB-219B-4382-BD53-5CE407035F21@gmail.com>
References: <DA77273A-1A8E-4DF8-955E-241D114AA890@gmail.com>
 <507C458F.2030107@wxs.nl> <20121015194438.59164e83@homerow>
 <72BF11FB-219B-4382-BD53-5CE407035F21@gmail.com>
Message-ID: <4BF9C967-AA5B-457B-A0AB-6772120EA70F@gmail.com>


Am 15.10.2012 um 19:51 schrieb Wolfgang Schuster <schuster.wolfgang at gmail.com>:

>> \definestructureconversionset [footnote] [numbers, Characters] [numbers]
>> \setupenumerations            [footnote] [numberconversionset=footnote]
> 
> \setupnotation[footnote][numberconversionset=footnote]

The \definestructureconversionset has also the new name \defineconversionset, even though old name will stay for backward compatibility of existing styles.

Wolfgang

From adityam at umich.edu  Mon Oct 15 23:16:17 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 15 Oct 2012 17:16:17 -0400 (EDT)
Subject: [dev-context] Error while updating to new beta
Message-ID: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>

Hi,

When compiling the format in the new beta, I get the following error:

loading         > ConTeXt File Macros / Job Handling
! LuaTeX error 
...d/src/tex/texmf-context/tex/context/base/l-table.lua:106: C stack 
overflow
stack traceback:
         ...d/src/tex/texmf-context/tex/context/base/l-table.lua:106: in 
function 'sortedkeys'
         ...d/src/tex/texmf-context/tex/context/base/l-table.lua:156: in 
function 'sortedpairs'
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:168: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         ...
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/data-pre.lua:177: in 
function <.../src/tex/texmf-context/tex/context/base/data-pre.lua:165>
         .../src/tex/texmf-context/tex/context/base/file-job.lua:570: in 
function 'code'
         .../src/tex/texmf-context/tex/context/base/util-lua.lua:130: in 
function 'loadedluacode'
         .../src/tex/texmf-context/tex/context/base/luat-env.lua:285: in 
function 'luafilechunk'
         .../src/tex/texmf-context/tex/context/base/luat-cod.lua:45: in 
function 'registercode'
         <main ctx instance>:1: in main chunk.

system          > tex > error on line 20 in file 
/home/adityam/Software/context-pkgbuild/src/tex/texmf-context/tex/context/base/file-job.mkvi: 
LuaTeX error  ...

10     %C This module is part of the \CONTEXT\ macro||package and is
11     %C therefore copyrighted by \PRAGMA. See mreadme.pdf for
12     %C details.
13
14     %D This module is still to be split and documented.
15
16     \writestatus{loading}{ConTeXt File Macros / Job Handling}
17
18     \unprotect
19
20 >>  \registerctxluafile{file-job}{1.001}
21
22     % processing
23
24     \unexpanded\def\doifinputfileelse#name%
25       {\ctxcommand{doifinputfileelse("#name")}}
26
27     \unexpanded\def\processfile#name%
28       {\ctxcommand{processfile("#name")}}
29
30     % path control


\registerctxluafile ...ua.registercode("#1","#2")}

l.20 \registerctxluafile{file-job}{1.001}

?

Aditya

From pragma at wxs.nl  Mon Oct 15 23:54:49 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 15 Oct 2012 23:54:49 +0200
Subject: [dev-context] Error while updating to new beta
In-Reply-To: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
Message-ID: <507C8629.5060809@wxs.nl>

On 15-10-2012 23:16, Aditya Mahajan wrote:
> Hi,
>
> When compiling the format in the new beta, I get the following error:

weird: I've added this to core-job

local function toppath()
     local pathname = dirname(inputstack[#inputstack] or "")
     if pathname == "" then
         return "."
     else
         return pathname
     end
end

resolvers.toppath = topath

resolvers.prefixes.toppath = function(str)
     return cleanpath(joinpath(toppath(),str))
end

local function process(what,name)
     local depth = #typestack
     local process
     --
     name = resolvers.resolve(name)

but that should be harmless. (On my machine the format is made.)

What if you comment

     name = resolvers.resolve(name)

As it's only used in component etc code I wonder why it influences the 
format making

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Tue Oct 16 00:14:57 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 15 Oct 2012 18:14:57 -0400 (EDT)
Subject: [dev-context] Error while updating to new beta
In-Reply-To: <507C8629.5060809@wxs.nl>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
 <507C8629.5060809@wxs.nl>
Message-ID: <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>

On Mon, 15 Oct 2012, Hans Hagen wrote:

> On 15-10-2012 23:16, Aditya Mahajan wrote:
>> Hi,
>> 
>> When compiling the format in the new beta, I get the following error:
>
> weird: I've added this to core-job
>
> local function toppath()
>    local pathname = dirname(inputstack[#inputstack] or "")
>    if pathname == "" then
>        return "."
>    else
>        return pathname
>    end
> end
>
> resolvers.toppath = topath
>
> resolvers.prefixes.toppath = function(str)
>    return cleanpath(joinpath(toppath(),str))
> end
>
> local function process(what,name)
>    local depth = #typestack
>    local process
>    --
>    name = resolvers.resolve(name)
>
> but that should be harmless. (On my machine the format is made.)
>
> What if you comment
>
>    name = resolvers.resolve(name)

Same error. But if I comment the definition of resolvers.prefixes.toppath, 
the error goes away.

Aditya

From wolfgang.schuster at gmail.com  Tue Oct 16 11:07:02 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 16 Oct 2012 11:07:02 +0200
Subject: [dev-context] =?windows-1252?q?=5Cnote_doesn=92t_work_when_notes_?=
 =?windows-1252?q?are_placed_in_the_text?=
Message-ID: <0073DAC6-4014-4502-8F06-407E7CBAC740@gmail.com>

Hi,

in the following example the \note commands shows only unknown references. It has something to do with ?location=text? because ?location=page? or ?location=column? have working references.

\setupfootnotes[location=text]

\starttext

Second Note\note[footnote][2]
 First Note\note[footnote][1]

\setnotetext[footnote][1]{Footnote 1}
\setnotetext[footnote][2]{Footnote 2}

Second Note\note[footnote][2]
 First Note\note[footnote][1]

\placenotes[footnote]

\stopfootnote


I tried to find a fix for thus bug but wasn?t able to find a good solution. There is a little hack below which works (it is only used for ?location=text? and ?location=none?) but I guess there is a better solution.

\unexpanded\setvalue{\??constructionnotehandler\v!notation:\v!note}% in the running text
  {\ifnotesenabled
     % do be done elsewhere
     %
     %let\currentnote\currentconstructionmain
     \let\currentnote\currentconstruction % else wrong inheritance
     %
     \iftrialtypesetting
        \strc_notes_inject_dummy
     \else
       \begingroup
       \edef\currentnotenumber{\ctxcommand{storenote("\currentnote",\currentconstructionlistentry)}}%
       \settrue\processingnote
       \ifconditional\c_strc_notes_skip
         \globallet\lastnotesymbol\strc_notes_inject_symbol
+        \ifconditional\c_strc_notes_delayed
+          \currentconstructionsynchronize
+        \fi
       \else
         \iftypesettinglines % otherwise problems with \type <crlf> {xxx}
           \ignorelines % makes footnotes work in \startlines ... \stoplines
         \fi
         \ifconditional\c_strc_notes_symbol
           \strc_notes_inject_symbol
         \else
           \unskip\unskip
           \globallet\lastnotesymbol\strc_notes_inject_symbol
         \fi
       \fi
       \ifconditional\postponingnotes % todo: per note class
         \global\settrue\postponednote
       \else\ifconditional\inlocalnotes % todo: per note class
         \global\settrue\postponednote
       \else
         \handlenoteinsert\currentnote\currentnotenumber % either an insert or just delayed
       \fi\fi
       \endgroup
     \fi
   \fi
   \ifconditional\c_strc_notes_skip
     \global\setfalse\c_strc_notes_skip
   \else
     \kern\notesignal\relax % \relax is needed to honor spaces
   \fi}

Wolfgang

From pragma at wxs.nl  Tue Oct 16 11:37:41 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 16 Oct 2012 11:37:41 +0200
Subject: [dev-context] Error while updating to new beta
In-Reply-To: <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
 <507C8629.5060809@wxs.nl>
 <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>
Message-ID: <507D2AE5.4030501@wxs.nl>

On 16-10-2012 00:14, Aditya Mahajan wrote:

> Same error. But if I comment the definition of
> resolvers.prefixes.toppath, the error goes away.

fixed (tested on opensuse and ubuntu)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Tue Oct 16 14:12:47 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 16 Oct 2012 08:12:47 -0400
Subject: [dev-context] Error while updating to new beta
In-Reply-To: <507D2AE5.4030501@wxs.nl>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
 <507C8629.5060809@wxs.nl>
 <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>
 <507D2AE5.4030501@wxs.nl>
Message-ID: <11B0CF05-7B40-4188-9F88-03484DA1EA8B@umich.edu>


On 2012-10-16, at 5:37 AM, Hans Hagen <pragma at wxs.nl> wrote:

> On 16-10-2012 00:14, Aditya Mahajan wrote:
> 
>> Same error. But if I comment the definition of
>> resolvers.prefixes.toppath, the error goes away.
> 
> fixed (tested on opensuse and ubuntu)
> 

Thanks. The format is made cleanly now. 

Aditya 

From pragma at wxs.nl  Wed Oct 17 23:33:33 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 Oct 2012 23:33:33 +0200
Subject: [dev-context]
 =?windows-1252?q?=5Cnote_doesn=92t_work_when_notes_?=
 =?windows-1252?q?are_placed_in_the_text?=
In-Reply-To: <0073DAC6-4014-4502-8F06-407E7CBAC740@gmail.com>
References: <0073DAC6-4014-4502-8F06-407E7CBAC740@gmail.com>
Message-ID: <507F242D.4080001@wxs.nl>

On 16-10-2012 11:07, Wolfgang Schuster wrote:
> Hi,
>
> in the following example the \note commands shows only unknown references. It has something to do with ?location=text? because ?location=page? or ?location=column? have working references.
>
> \setupfootnotes[location=text]
>
> \starttext
>
> Second Note\note[footnote][2]
>   First Note\note[footnote][1]
>
> \setnotetext[footnote][1]{Footnote 1}
> \setnotetext[footnote][2]{Footnote 2}
>
> Second Note\note[footnote][2]
>   First Note\note[footnote][1]
>
> \placenotes[footnote]
>
> \stopfootnote
>
>
> I tried to find a fix for thus bug but wasn?t able to find a good solution. There is a little hack below which works (it is only used for ?location=text? and ?location=none?) but I guess there is a better solution.

The fix ls nearlu ok ... we also need to makr sure that the sync only 
happens once (as \lastnotesymbol can also do it).

I also mkvi'd the file so you might want to check it (uploading now).

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Thu Oct 18 17:08:59 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 18 Oct 2012 17:08:59 +0200
Subject: [dev-context] Wrong counter settings
Message-ID: <E8FE6FB5-584B-4E9D-A6B9-72AE8D4B6187@gmail.com>

Hi Hans,

in the following three files the additional check is necessary because otherwise changes for the counter (e.g. prefix=?) would also change the global counter settings from \setupstructurecounting.


strc-not.mkvi:

\appendtoks
-   \strc_notes_setup_counter\currentnotation
+   \ifx\currentnotation\empty \else
+       \strc_notes_setup_counter\currentnotation
+   \fi
\to \everysetupnotation


strc-enu.mkvi:

\appendtoks
-   \strc_enumerations_setup_counter\currentenumeration
+   \ifx\currentenumeration\empty \else
+       \strc_enumerations_setup_counter\currentenumeration
+   \fi
\to \everysetupenumeration


strc-lab.mkvi

\appendtoks
-   \strc_labels_setup_counter\currentlabel
+   \ifx\currentlabel\empty \else
+       \strc_labels_setup_counter\currentlabel
+   \fi
\to \everysetuplabel



In the following two files you can remove the \strc_counters_check_setup\? line because it?s already called from \strc_counter_setup_using_parameter in the previous line.


strc-flt.mkvi:

\appendtoks
    \let\currentfloat\currentfloatcaption
    \ifx\currentfloat\empty \else
        \strc_counter_setup_using_parameter\currentfloatcaption\floatcaptionparameter
-       \strc_counters_check_setup\currentfloatcaption
    \fi
\to \everysetupfloatcaption


strc-mat.mkiv:

\appendtoks
    \strc_counter_setup_using_parameter\v!formula\formulaparameter
-   \strc_counters_check_setup\v!formula % yes or no
\to \everysetupformula


Wolfgang

From pragma at wxs.nl  Thu Oct 18 18:36:38 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 18 Oct 2012 18:36:38 +0200
Subject: [dev-context] Wrong counter settings
In-Reply-To: <E8FE6FB5-584B-4E9D-A6B9-72AE8D4B6187@gmail.com>
References: <E8FE6FB5-584B-4E9D-A6B9-72AE8D4B6187@gmail.com>
Message-ID: <50803016.8090401@wxs.nl>

On 18-10-2012 17:08, Wolfgang Schuster wrote:
> Hi Hans,
>
> in the following three files the additional check is necessary because otherwise changes for the counter (e.g. prefix=?) would also change the global counter settings from \setupstructurecounting.

> In the following two files you can remove the \strc_counters_check_setup\? line because it?s already called from \strc_counter_setup_using_parameter in the previous line.

okay

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pmlists at free.fr  Sun Oct 21 21:57:44 2012
From: pmlists at free.fr (=?utf-8?Q?Peter_M=C3=BCnster?=)
Date: Sun, 21 Oct 2012 21:57:44 +0200
Subject: [dev-context] 2 patches for grph-inc
References: <87fw6uzu58.fsf@micropit.couberia.bzh>
Message-ID: <871ugry4w7.fsf@micropit.couberia.selfip.net>

Hello Hans,

What do you think about these patches?

-- 
           Peter

From luigi.scarso at gmail.com  Thu Oct 25 14:12:44 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 25 Oct 2012 14:12:44 +0200
Subject: [dev-context] overrightarrow and underrightarrow give the same
	result
Message-ID: <CAG5iGsAoK8PiiZmf6rUV0xyOCAg=aKZb8QFvDzK+5ggNRhWaaA@mail.gmail.com>

$\overrightarrow{ab}$
$\underrightarrow{ab}$

both give the same result  ($\underrightarrow{ab}$)


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121025/d28bc967/attachment.html>

From pragma at wxs.nl  Sat Oct 27 12:19:35 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 27 Oct 2012 12:19:35 +0200
Subject: [dev-context] overrightarrow and underrightarrow give the same
 result
In-Reply-To: <CAG5iGsAoK8PiiZmf6rUV0xyOCAg=aKZb8QFvDzK+5ggNRhWaaA@mail.gmail.com>
References: <CAG5iGsAoK8PiiZmf6rUV0xyOCAg=aKZb8QFvDzK+5ggNRhWaaA@mail.gmail.com>
Message-ID: <508BB537.40603@wxs.nl>

On 25-10-2012 14:12, luigi scarso wrote:
> $\overrightarrow{ab}$
> $\underrightarrow{ab}$
>
> both give the same result  ($\underrightarrow{ab}$)

a few under/over mixups in math-arr.mkiv: line 429 and 434

Question for Aditya:

We have this arrow module, but as luatex has better under / over fill 
support, we could use:

% \unexpanded\def\underrightarrow#1{\mathop{\Uunderdelimiter 
\defaultmathfamily "2192 {#1}}}
% \unexpanded\def\overrightarrow #1{\mathop{\Uoverdelimiter 
\defaultmathfamily "2192 {#1}}}

which actually gives a different spacing. So the question is: how valid 
is the arrow module?

btw, The old kludges wrt left/right arrow fills with text above as used 
in chemical reactions is solved using virtual characters ... I discussed 
this with Gyre Math Font Gurus and we agreed that it makes sense to have 
such double arrow combination snippets in the fonts ... it was also 
discussed that we should have a well defined private space in unicode 
for additional characters)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Mon Oct 29 19:17:59 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 29 Oct 2012 19:17:59 +0100
Subject: [dev-context] page-lin.mkiv
Message-ID: <D0969C0A-D166-47C4-9FAE-5794C17AD212@gmail.com>

Hi,

the fix below enables the \startlinenumbering[continue=yes] setting.

\def\page_lines_start_one[#1][#2]% [continue|<number>|settings] % historic
  {\edef\m_argument{#1}%
   \ifx\m_argument\v!continue
     \c_page_lines_mode\zerocount
     \let\currentlinenumbering\empty
   \else
     \c_page_lines_mode\plusone
     \ifx\m_argument\v!empty
       \let\currentlinenumbering\empty
     \else
       \doifassignmentelse{#1}
         {\let\currentlinenumbering\empty
          \setupcurrentlinenumbering[#1]}
         {\doifnumberelse\m_argument
            {\let\currentlinenumbering\empty
             \letlinenumberingparameter\c!start\m_argument}
            {\let\currentlinenumbering\m_argument}}%
     \fi
-    \edef\m_argument{\linenumberingparameter\c!continue}%
-    \ifx\m_argument\v!continue
+    \edef\p_continue{\linenumberingparameter\c!continue}%
+    \ifx\p_continue\v!yes
       \c_page_lines_mode\zerocount
     \fi
   \fi
   \page_lines_start_followup}

\def\page_lines_start_two[#1][#2]% [tag][continue|<number>|settings]
  {\edef\currentlinenumbering{#1}%
   \edef\m_argument{#2}%
   \ifx\m_argument\v!continue
     \c_page_lines_mode\zerocount
   \else
     \c_page_lines_mode\plusone
     \ifx\m_argument\v!empty \else
       \doifassignmentelse{#2}
         {\setupcurrentlinenumbering[#2]}
         {\doifnumber\m_argument
            {\letlinenumberingparameter\c!start\m_argument}}%
     \fi
-    \edef\m_argument{\linenumberingparameter\c!continue}%
-    \ifx\m_argument\v!continue
+    \edef\p_continue{\linenumberingparameter\c!continue}%
+    \ifx\p_continue\v!yes
       \c_page_lines_mode\zerocount
     \fi
   \fi
   \page_lines_start_followup}

Wolfgang

From wolfgang.schuster at gmail.com  Mon Oct 29 20:06:09 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 29 Oct 2012 20:06:09 +0100
Subject: [dev-context] spac-ali.mkiv
Message-ID: <F1AA0472-4A2F-422D-AD94-B0FD9D70D4F2@gmail.com>

Hi,

the \begingroup and \endgroup commands are not possible here because they are the delimiters for the \hbox.

\def\doalignline#1#2% \\ == newline
  {\noindentation  % was \noindent
   \dontleavehmode % added in marrakesch at TUG 2006\begingroup
   \begingroup
   \setlocalhsize % new
-  \def\\{\endgroup\par\doalignline{#1}{#2}\begingroup}%
+  \def\\{\egroup\par\doalignline{#1}{#2}\bgroup}%
   \dowithnextbox
     {\hbox to \localhsize
        {\ifcase\alignstrutmode\or\strut\fi
         \the\everyleftofalignedline
         #1\unhbox\nextbox#2\relax
         \the\everyrightofalignedline}%
      \endgroup}
     \hbox}

\def\doxalignline#1#2#3#4#5#6%
  {\noindentation  % was \noindent
   \dontleavehmode % added in marrakesch at TUG 2006\begingroup
   \begingroup
   \setlocalhsize
-  \def\\{\endgroup\par\doxalignline#1#2#3#4#5#6\begingroup}% inefficient
+  \def\\{\egroup\par\doxalignline#1#2#3#4#5#6\bgroup}% inefficient
   \dowithnextbox
     {\hbox to \localhsize
        {#1\hskip\ifdone#2\else#3\fi#4%
         \hbox to \localhsize
           {\the\everyleftofalignedline
            \ifcase\alignstrutmode\or\strut\fi
            \ifdone#5\unhbox\nextbox#6\else#6\unhbox\nextbox#5\fi
            \the\everyrightofalignedline}%
         \hss}%
        \endgroup}
     \hbox}

Wolfgang

From wolfgang.schuster at gmail.com  Mon Oct 29 20:24:22 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 29 Oct 2012 20:24:22 +0100
Subject: [dev-context] Environments for alignment commands
Message-ID: <E00101C2-1707-4C48-B134-B8DA2355E181@gmail.com>

Hi Hans,

can we add the following definitions to space-ali.mkiv

\unexpanded\def\startleftaligned {\doalignline\relax \hss  \bgroup}
\unexpanded\def\startmidaligned  {\doalignline\hss   \hss  \bgroup}
\unexpanded\def\startrightaligned{\doalignline\hss   \relax\bgroup}
\unexpanded\def\startmaxaligned  {\doalignline\relax \relax\bgroup}

\unexpanded\def\stopleftaligned {\unskip\egroup}
\unexpanded\def\stopmidaligned  {\unskip\egroup}
\unexpanded\def\stoprightaligned{\unskip\egroup}
\unexpanded\def\stopmaxaligned  {\unskip\egroup}

The \unskip (would be \removeunwantedspaces better?) because otherwise the space at the end of the text appears in the output:

\startmidaligned
  Centered?
\stopmidaligned

Wolfgang

From wolfgang.schuster at gmail.com  Mon Oct 29 20:36:34 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 29 Oct 2012 20:36:34 +0100
Subject: [dev-context] Combinations and \startcontent/\startcaption commands
Message-ID: <D9BC4333-24BB-4A35-8999-C4ACFA3DB302@gmail.com>

Hi Hans,

with the use of \stopcaption a visible space is added to the caption of the combination. Can you change the definition of the command from

  \let\stopcaption \egroup

to

  \def\stopcaption {\unskip\egroup}

or something similar.


Example:

\starttext

\startcombination[2*1]
    {\framed{Content 1}}{Caption 1}
    {\framed{Content 2}}{Caption 2}
\stopcombination

\startcombination[2*1]
    \startcontent
        \framed{Content 1}
    \stopcontent
    \startcaption
        Caption 1
    \stopcaption
    \startcontent
        \framed{Content 2}
    \stopcontent
    \startcaption
        Caption 2
    \stopcaption
\stopcombination

\stoptext


Wolfgang

From pragma at wxs.nl  Tue Oct 30 11:26:33 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 30 Oct 2012 11:26:33 +0100
Subject: [dev-context] Combinations and \startcontent/\startcaption
	commands
In-Reply-To: <D9BC4333-24BB-4A35-8999-C4ACFA3DB302@gmail.com>
References: <D9BC4333-24BB-4A35-8999-C4ACFA3DB302@gmail.com>
Message-ID: <508FAB59.90806@wxs.nl>

On 29-10-2012 20:36, Wolfgang Schuster wrote:
> Hi Hans,
>
> with the use of \stopcaption a visible space is added to the caption of the combination. Can you change the definition of the command from
>
>    \let\stopcaption \egroup
>
> to
>
>    \def\stopcaption {\unskip\egroup}
>
> or something similar.

ok ... best check the 'something similar' in the next upload

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Oct 30 11:35:37 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 30 Oct 2012 11:35:37 +0100
Subject: [dev-context] Environments for alignment commands
In-Reply-To: <E00101C2-1707-4C48-B134-B8DA2355E181@gmail.com>
References: <E00101C2-1707-4C48-B134-B8DA2355E181@gmail.com>
Message-ID: <508FAD79.6080401@wxs.nl>

On 29-10-2012 20:24, Wolfgang Schuster wrote:
> Hi Hans,
>
> can we add the following definitions to space-ali.mkiv
>
> \unexpanded\def\startleftaligned {\doalignline\relax \hss  \bgroup}
> \unexpanded\def\startmidaligned  {\doalignline\hss   \hss  \bgroup}
> \unexpanded\def\startrightaligned{\doalignline\hss   \relax\bgroup}
> \unexpanded\def\startmaxaligned  {\doalignline\relax \relax\bgroup}
>
> \unexpanded\def\stopleftaligned {\unskip\egroup}
> \unexpanded\def\stopmidaligned  {\unskip\egroup}
> \unexpanded\def\stoprightaligned{\unskip\egroup}
> \unexpanded\def\stopmaxaligned  {\unskip\egroup}
>
> The \unskip (would be \removeunwantedspaces better?) because otherwise the space at the end of the text appears in the output:

indeed as it does multiple spaces and some hmode checking

> \startmidaligned
>    Centered?
> \stopmidaligned

\unexpanded\def\startleftaligned {\doalignline\relax \hss 
\bgroup\ignorespaces}
\unexpanded\def\startmidaligned  {\doalignline\hss   \hss 
\bgroup\ignorespaces}
\unexpanded\def\startrightaligned{\doalignline\hss 
\relax\bgroup\ignorespaces}
\unexpanded\def\startmaxaligned  {\doalignline\relax 
\relax\bgroup\ignorespaces}

\unexpanded\def\stopleftaligned {\removeunwantedspaces\egroup}
\unexpanded\def\stopmidaligned  {\removeunwantedspaces\egroup}
\unexpanded\def\stoprightaligned{\removeunwantedspaces\egroup}
\unexpanded\def\stopmaxaligned  {\removeunwantedspaces\egroup}

making a beta now

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Tue Oct 30 12:59:16 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 30 Oct 2012 12:59:16 +0100
Subject: [dev-context] page-lin.mkiv
In-Reply-To: <D0969C0A-D166-47C4-9FAE-5794C17AD212@gmail.com>
References: <D0969C0A-D166-47C4-9FAE-5794C17AD212@gmail.com>
Message-ID: <7EEC4DBC-7721-4419-9D24-1DECA529050B@gmail.com>


Am 29.10.2012 um 19:17 schrieb Wolfgang Schuster <wolfgang.schuster at gmail.com>:

> Hi,
> 
> the fix below enables the \startlinenumbering[continue=yes] setting.
> 
> \def\page_lines_start_one[#1][#2]% [continue|<number>|settings] % historic
>  {\edef\m_argument{#1}%
>   \ifx\m_argument\v!continue
>     \c_page_lines_mode\zerocount
>     \let\currentlinenumbering\empty
>   \else
>     \c_page_lines_mode\plusone
>     \ifx\m_argument\v!empty
>       \let\currentlinenumbering\empty
>     \else
>       \doifassignmentelse{#1}
>         {\let\currentlinenumbering\empty
>          \setupcurrentlinenumbering[#1]}
>         {\doifnumberelse\m_argument
>            {\let\currentlinenumbering\empty
>             \letlinenumberingparameter\c!start\m_argument}
>            {\let\currentlinenumbering\m_argument}}%
>     \fi
> -    \edef\m_argument{\linenumberingparameter\c!continue}%
> -    \ifx\m_argument\v!continue
> +    \edef\p_continue{\linenumberingparameter\c!continue}%
> +    \ifx\p_continue\v!yes
>       \c_page_lines_mode\zerocount
>     \fi
>   \fi
>   \page_lines_start_followup}
> 
> \def\page_lines_start_two[#1][#2]% [tag][continue|<number>|settings]
>  {\edef\currentlinenumbering{#1}%
>   \edef\m_argument{#2}%
>   \ifx\m_argument\v!continue
>     \c_page_lines_mode\zerocount
>   \else
>     \c_page_lines_mode\plusone
>     \ifx\m_argument\v!empty \else
>       \doifassignmentelse{#2}
>         {\setupcurrentlinenumbering[#2]}
>         {\doifnumber\m_argument
>            {\letlinenumberingparameter\c!start\m_argument}}%
>     \fi
> -    \edef\m_argument{\linenumberingparameter\c!continue}%
> -    \ifx\m_argument\v!continue
> +    \edef\p_continue{\linenumberingparameter\c!continue}%
> +    \ifx\p_continue\v!yes
>       \c_page_lines_mode\zerocount
>     \fi
>   \fi
>   \page_lines_start_followup}

Still wrong in the last beta because it should be \ifx\?\v!yes

page-lin.mkiv:

     \edef\p_continue{\linenumberingparameter\c!continue}%
     \ifx\p_continue\v!continue
       \c_page_lines_mode\zerocount
     \fi

Wolfgang

From wolfgang.schuster at gmail.com  Tue Oct 30 18:48:18 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 30 Oct 2012 18:48:18 +0100
Subject: [dev-context] Reversed alignment for left and right
Message-ID: <89609F5B-2A6F-4394-B6A6-51E57C0B759A@gmail.com>

Hi Hans,

while for backwards compatibility you won?t change \setupalign[leftt|right] the current implementation makes it possible to change the behavior with a simple change in the code.

\unprotect

\newconstant\c_spec_align_state_method

%\setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\plustwo  }
%setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\plusthree}
\setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plustwo\else\plusthree\fi}
\setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plusthree\else\plustwo\fi}

\unexpanded\def\enablereversealignment{\c_spec_align_state_method\plusone}

\protect

%\enablereversealignment

\starttext

\startalignment[left]
\input ward
\stopalignment

\blank

\startalignment[right]
\input ward
\stopalignment

\stoptext

Wolfgang

From pragma at wxs.nl  Tue Oct 30 19:02:12 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 30 Oct 2012 19:02:12 +0100
Subject: [dev-context] Reversed alignment for left and right
In-Reply-To: <89609F5B-2A6F-4394-B6A6-51E57C0B759A@gmail.com>
References: <89609F5B-2A6F-4394-B6A6-51E57C0B759A@gmail.com>
Message-ID: <50901624.2050400@wxs.nl>

On 30-10-2012 18:48, Wolfgang Schuster wrote:
> Hi Hans,
>
> while for backwards compatibility you won?t change \setupalign[leftt|right] the current implementation makes it possible to change the behavior with a simple change in the code.
>
> \unprotect
>
> \newconstant\c_spec_align_state_method
>
> %\setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\plustwo  }
> %setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\plusthree}
> \setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plustwo\else\plusthree\fi}
> \setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plusthree\else\plustwo\fi}

iirr we had something like that in mkii

> \unexpanded\def\enablereversealignment{\c_spec_align_state_method\plusone}

so who's helping users who put that in cont-usr.mkiv and have issues

> \protect
>
> %\enablereversealignment
>
> \starttext
>
> \startalignment[left]
> \input ward
> \stopalignment
>
> \blank
>
> \startalignment[right]
> \input ward
> \stopalignment
>
> \stoptext

more generic is:

\unprotect

\newtoks \t_spac_every_swap_align

\appendtoks
 
\setvalue{\??aligncommand\v!right}{\c_spac_align_state_horizontal\plusthree}%
     \setvalue{\??aligncommand\v!left 
}{\c_spac_align_state_horizontal\plustwo}%
\to \t_spac_every_swap_align

\unexpanded\def\enablereversealignment{\the\t_spac_every_swap_align\t_spac_every_swap_align\emptytoks}

\protect

% \enablereversealignment

\starttext

\startalignment[left]
\input ward
\stopalignment

\blank

\startalignment[right]
\input ward
\stopalignment

\stoptext


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Tue Oct 30 19:26:43 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 30 Oct 2012 19:26:43 +0100
Subject: [dev-context] Reversed alignment for left and right
In-Reply-To: <50901624.2050400@wxs.nl>
References: <89609F5B-2A6F-4394-B6A6-51E57C0B759A@gmail.com>
 <50901624.2050400@wxs.nl>
Message-ID: <59555BB9-C271-4BF0-AAFA-67A794A26414@gmail.com>


Am 30.10.2012 um 19:02 schrieb Hans Hagen <pragma at wxs.nl>:

> On 30-10-2012 18:48, Wolfgang Schuster wrote:
>> Hi Hans,
>> 
>> while for backwards compatibility you won?t change \setupalign[leftt|right] the current implementation makes it possible to change the behavior with a simple change in the code.
>> 
>> \unprotect
>> 
>> \newconstant\c_spec_align_state_method
>> 
>> %\setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\plustwo  }
>> %setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\plusthree}
>> \setvalue{\??aligncommand\v!right          }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plustwo\else\plusthree\fi}
>> \setvalue{\??aligncommand\v!left           }{\c_spac_align_state_horizontal\ifcase\c_spec_align_state_method\plusthree\else\plustwo\fi}
> 
> iirr we had something like that in mkii

I saw the old and new keywords for \setupalign in mkii but never checked what?s their purpose.

Because both keywords aren?t used in mkiv I had first the following two lines (before using \enablereversealignment) in my test file:

\setvalue{\??aligncommand\v!old            }{\c_spec_align_state_method\zerocount}
\setvalue{\??aligncommand\v!new            }{\c_spec_align_state_method\plusone}

>> \unexpanded\def\enablereversealignment{\c_spec_align_state_method\plusone}
> 
> so who's helping users who put that in cont-usr.mkiv and have issues

How many users do know about this and the other runtime loaded files and use them?

Wolfgang

From adityam at umich.edu  Sat Nov  3 23:34:26 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 3 Nov 2012 18:34:26 -0400 (EDT)
Subject: [dev-context] typo is spac-ali
Message-ID: <alpine.LNX.2.02.1211031833220.11517@ybpnyubfg.ybpnyqbznva>

\let\startmidaligned   \startmiddlealigned  \let\stopmidaligned 
\stopmiddlealignment
\let\startcenteraligned\startmiddlealigned  \let\stopcenteraligned 
\stopmiddlealignment

The \stopmiddlealignment should be changed to \stopmiddlealigned.

Aditya


From wolfgang.schuster at gmail.com  Sun Nov  4 10:50:58 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 4 Nov 2012 10:50:58 +0100
Subject: [dev-context] Module documentation for Lua files
Message-ID: <6BAF0065-FBED-45DD-9EA8-AD7F1FBB2262@gmail.com>

Hi Hans,

the scripts to generate the documentation from Lua files don?t work in the beta.


When I run

  context --ctx=x-ldx x-ldx.lua

not even the xml file ?x-ldx.ldx? is generated.


When I use the two step method with

  mtxrun --internal x-ldx x-ldx.lua

I get the xml file but the second step

  context --usemodule=ldx --forcexml x-ldx.ldx

gives no output.


Wolfgang


From pragma at wxs.nl  Mon Nov  5 22:48:47 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 05 Nov 2012 22:48:47 +0100
Subject: [dev-context] Module documentation for Lua files
In-Reply-To: <6BAF0065-FBED-45DD-9EA8-AD7F1FBB2262@gmail.com>
References: <6BAF0065-FBED-45DD-9EA8-AD7F1FBB2262@gmail.com>
Message-ID: <5098343F.1010206@wxs.nl>

On 11/4/2012 10:50 AM, Wolfgang Schuster wrote:
> Hi Hans,
>
> the scripts to generate the documentation from Lua files don?t work in the beta.
>
>
> When I run
>
>    context --ctx=x-ldx x-ldx.lua
>
> not even the xml file ?x-ldx.ldx? is generated.
>
>
> When I use the two step method with
>
>    mtxrun --internal x-ldx x-ldx.lua
>
> I get the xml file but the second step
>
>    context --usemodule=ldx --forcexml x-ldx.ldx
>
> gives no output.

Took me a bit of coding but I go tthe ctx preprocessing up and runnign 
again. No beta yet. Actually, I should make in an 'extra' some day.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Nov  6 23:32:08 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 06 Nov 2012 23:32:08 +0100
Subject: [dev-context] [NTG-context]  Error while updating to new beta
In-Reply-To: <CADVh14XWoeX3GJtDbF0ahwNpy8VaGejd0AZdqb1fAXsAJiP3XA@mail.gmail.com>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
 <507C8629.5060809@wxs.nl>
 <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>
 <507D2AE5.4030501@wxs.nl>
 <CADVh14XWoeX3GJtDbF0ahwNpy8VaGejd0AZdqb1fAXsAJiP3XA@mail.gmail.com>
Message-ID: <50998FE8.2060508@wxs.nl>

On 11/6/2012 10:04 PM, Andre Caldas wrote:
>>> Same error. But if I comment the definition of
>>> resolvers.prefixes.toppath, the error goes away.
>>
>> fixed (tested on opensuse and ubuntu)
>
> The problem was that in some places there was a
> toppath with double "p" (pp)
> and in some places it was
> topath with single "p" (p).
>
> Will "toppath" be brought back?

in only see double p's

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From andre.em.caldas at gmail.com  Tue Nov  6 22:04:21 2012
From: andre.em.caldas at gmail.com (Andre Caldas)
Date: Tue, 6 Nov 2012 19:04:21 -0200
Subject: [dev-context] [NTG-context]  Error while updating to new beta
In-Reply-To: <507D2AE5.4030501@wxs.nl>
References: <alpine.LNX.2.02.1210151715160.12240@ybpnyubfg.ybpnyqbznva>
 <507C8629.5060809@wxs.nl>
 <alpine.LNX.2.02.1210151813540.12240@ybpnyubfg.ybpnyqbznva>
 <507D2AE5.4030501@wxs.nl>
Message-ID: <CADVh14XWoeX3GJtDbF0ahwNpy8VaGejd0AZdqb1fAXsAJiP3XA@mail.gmail.com>

>> Same error. But if I comment the definition of
>> resolvers.prefixes.toppath, the error goes away.
>
> fixed (tested on opensuse and ubuntu)

The problem was that in some places there was a
toppath with double "p" (pp)
and in some places it was
topath with single "p" (p).

Will "toppath" be brought back?


Cheers,
Andr? Caldas.
-- 
- Por que altera a ordem natural da conversa??o!
- Por que n?o?
- Eu n?o gosto, n?o.
- Voc? gosta quando copiam a mensagem original ao final do e-mail?

From homerow at lavabit.com  Thu Nov  8 11:47:40 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Thu, 8 Nov 2012 11:47:40 +0100
Subject: [dev-context] Expandable \currentlistentry versions
Message-ID: <20121108114740.1aa4900f@homerow>

Hi Hans!

Could you provide expandable versions of

  \currentlistentrynumber
  \currentlistentrytitle
  \currentlistentrypagenumber

that can be used inside a \doifelse statement? Use case, see

  http://www.ntg.nl/pipermail/ntg-context/2012/069779.html


Marco


From wolfgang.schuster at gmail.com  Tue Nov 13 22:43:08 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Tue, 13 Nov 2012 22:43:08 +0100
Subject: [dev-context] typo-del.mkiv
Message-ID: <E2B9F400-1CCB-4FD2-B7F4-13AE538224EB@gmail.com>

Hi,

\def\typo_delimited_fontdriven_b
  {\dostarttagged\t!delimited\currentdelimitedtext
-  \languageparameter{\c!left\currentdelimitedtext}}
+  \languageparameter{\c!left\currentparentdelimitedtext}}

\def\typo_delimited_fontdriven_e
- {\languageparameter{\c!right\currentdelimitedtext}%
+ {\languageparameter{\c!right\currentparentdelimitedtext}%
   \dostoptagged
   \typo_delimited_pop}

Wolfgang

From homerow at lavabit.com  Wed Nov 14 11:29:03 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Wed, 14 Nov 2012 11:29:03 +0100
Subject: [dev-context] \hskip for hanging descriptions
Message-ID: <20121114112903.3e41e0d3@homerow>

Hi Hans,

do you have any objections changing the following \kern into a
\hskip?

\startsetups[\??constructionrenderings:\v!hanging]
    % tricky: leftskipadaption is somewhat unpredictable
    \let\\=\crlf
    \noindent
    \advance\leftskip-\leftskipadaption\relax
    \ifdim\leftskipadaption=\zeropoint
        \leftskipadaption1.5\emwidth\relax % just some default
        \ifnum\c_strc_constructions_nested_state=\plusone
            \ifdim\leftskip>\zeropoint \relax
                \leftskipadaption\leftskip
            \fi
        \fi
    \fi
    \ifnum\c_strc_constructions_nested_state>\zerocount % was
\ifnum\c_strc_constructions_nested_state=\plusone
\advance\leftskip\leftskipadaption % but we're already further on \fi
    \hskip-\leftskipadaption\relax
    \ifhbox\constructionheadbox\unhcopy\else\copy\fi\constructionheadbox
- \kern\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
+ \hskip\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
\useconstructionstyleandcolor\c!style\c!color \ignorespaces
\stopsetups


Marco


From pragma at wxs.nl  Wed Nov 14 18:23:25 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 14 Nov 2012 18:23:25 +0100
Subject: [dev-context] \hskip for hanging descriptions
In-Reply-To: <20121114112903.3e41e0d3@homerow>
References: <20121114112903.3e41e0d3@homerow>
Message-ID: <50A3D38D.1030106@wxs.nl>

On 11/14/2012 11:29 AM, Marco Patzer wrote:
> Hi Hans,
>
> do you have any objections changing the following \kern into a
> \hskip?
>
> \startsetups[\??constructionrenderings:\v!hanging]
>      % tricky: leftskipadaption is somewhat unpredictable
>      \let\\=\crlf
>      \noindent
>      \advance\leftskip-\leftskipadaption\relax
>      \ifdim\leftskipadaption=\zeropoint
>          \leftskipadaption1.5\emwidth\relax % just some default
>          \ifnum\c_strc_constructions_nested_state=\plusone
>              \ifdim\leftskip>\zeropoint \relax
>                  \leftskipadaption\leftskip
>              \fi
>          \fi
>      \fi
>      \ifnum\c_strc_constructions_nested_state>\zerocount % was
> \ifnum\c_strc_constructions_nested_state=\plusone
> \advance\leftskip\leftskipadaption % but we're already further on \fi
>      \hskip-\leftskipadaption\relax
>      \ifhbox\constructionheadbox\unhcopy\else\copy\fi\constructionheadbox
> - \kern\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
> + \hskip\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
> \useconstructionstyleandcolor\c!style\c!color \ignorespaces
> \stopsetups

changing skips/kerns is always somewhat dangerous as one suddenly can 
get unwanted breaks ... is there a use case?

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Wed Nov 14 18:29:52 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 14 Nov 2012 18:29:52 +0100
Subject: [dev-context] \hskip for hanging descriptions
In-Reply-To: <50A3D38D.1030106@wxs.nl>
References: <20121114112903.3e41e0d3@homerow> <50A3D38D.1030106@wxs.nl>
Message-ID: <BE7F0A17-E6FF-48D6-9BFB-6BC7C7961C98@gmail.com>


Am 14.11.2012 um 18:23 schrieb Hans Hagen <pragma at wxs.nl>:

> On 11/14/2012 11:29 AM, Marco Patzer wrote:
>> Hi Hans,
>> 
>> do you have any objections changing the following \kern into a
>> \hskip?
>> 
>> \startsetups[\??constructionrenderings:\v!hanging]
>>     % tricky: leftskipadaption is somewhat unpredictable
>>     \let\\=\crlf
>>     \noindent
>>     \advance\leftskip-\leftskipadaption\relax
>>     \ifdim\leftskipadaption=\zeropoint
>>         \leftskipadaption1.5\emwidth\relax % just some default
>>         \ifnum\c_strc_constructions_nested_state=\plusone
>>             \ifdim\leftskip>\zeropoint \relax
>>                 \leftskipadaption\leftskip
>>             \fi
>>         \fi
>>     \fi
>>     \ifnum\c_strc_constructions_nested_state>\zerocount % was
>> \ifnum\c_strc_constructions_nested_state=\plusone
>> \advance\leftskip\leftskipadaption % but we're already further on \fi
>>     \hskip-\leftskipadaption\relax
>>     \ifhbox\constructionheadbox\unhcopy\else\copy\fi\constructionheadbox
>> - \kern\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
>> + \hskip\ifdim\constructionsheaddistance=\zeropoint .75\emwidth\else\constructionsheaddistance\fi
>> \useconstructionstyleandcolor\c!style\c!color \ignorespaces
>> \stopsetups
> 
> changing skips/kerns is always somewhat dangerous as one suddenly can get unwanted breaks ... is there a use case?

Marco posted the following example a while ago:

\definedescription
  [description]
  [alternative=hanging,
   width=broad]

\starttext

\startdescription{conclusion that}
 \input knuth
\stopdescription

\startdescription{conclusion that the designer of a new system must not only be literally}
 \input knuth
\stopdescription

\stoptext

Wolfgang

From homerow at lavabit.com  Wed Nov 14 18:36:17 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Wed, 14 Nov 2012 18:36:17 +0100
Subject: [dev-context] \hskip for hanging descriptions
In-Reply-To: <50A3D38D.1030106@wxs.nl>
References: <20121114112903.3e41e0d3@homerow>
	<50A3D38D.1030106@wxs.nl>
Message-ID: <20121114183617.50cb352f@homerow>

2012-11-14 Hans Hagen:

> changing skips/kerns is always somewhat dangerous as one suddenly can 
> get unwanted breaks ... is there a use case?

There is. Long description heads protrude into the margin. With the
original definition I always have to manually check if that's the
case, since the result is unacceptable. I use the proposed setting
since two months for all my documents and for me it didn't break
anything.

\definedescription
  [description]
  [alternative=hanging,
   width=broad]

\starttext
\startdescription{conclusion that}
  \input knuth
\stopdescription

\startdescription{conclusion that the designer of a new system must not only be literally}
  \input knuth
\stopdescription
\stoptext

The fix was actually proposed by Phillip.


Marco


From wolfgang.schuster at gmail.com  Sun Nov 18 13:25:19 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 18 Nov 2012 13:25:19 +0100
Subject: [dev-context] spac-hor.mkiv
Message-ID: <E0F2E2B0-E195-4D86-A1C0-4839201EB8A8@gmail.com>

Hi,

the negative values for \startnarrower don?t work because braces in the definition are missing.

-\installnarrowermethod-\v!left  {\global\advance\s_spac_narrower_left -\narrowerparameter\c!left  \relax}
-\installnarrowermethod-\v!middle{\global\advance\s_spac_narrower_mid  -\narrowerparameter\c!middle\relax}
-\installnarrowermethod-\v!right {\global\advance\s_spac_narrower_right-\narrowerparameter\c!right \relax}
+\installnarrowermethod{-\v!left  }{\global\advance\s_spac_narrower_left -\narrowerparameter\c!left  \relax}
+\installnarrowermethod{-\v!middle}{\global\advance\s_spac_narrower_mid  -\narrowerparameter\c!middle\relax}
+\installnarrowermethod{-\v!right }{\global\advance\s_spac_narrower_right-\narrowerparameter\c!right \relax}

Wolfgang

From pragma at wxs.nl  Sun Nov 18 15:57:21 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 18 Nov 2012 15:57:21 +0100
Subject: [dev-context] spac-hor.mkiv
In-Reply-To: <E0F2E2B0-E195-4D86-A1C0-4839201EB8A8@gmail.com>
References: <E0F2E2B0-E195-4D86-A1C0-4839201EB8A8@gmail.com>
Message-ID: <50A8F751.8040105@wxs.nl>

On 11/18/2012 1:25 PM, Wolfgang Schuster wrote:
> Hi,
>
> the negative values for \startnarrower don?t work because braces in the definition are missing.
>
> -\installnarrowermethod-\v!left  {\global\advance\s_spac_narrower_left -\narrowerparameter\c!left  \relax}
> -\installnarrowermethod-\v!middle{\global\advance\s_spac_narrower_mid  -\narrowerparameter\c!middle\relax}
> -\installnarrowermethod-\v!right {\global\advance\s_spac_narrower_right-\narrowerparameter\c!right \relax}
> +\installnarrowermethod{-\v!left  }{\global\advance\s_spac_narrower_left -\narrowerparameter\c!left  \relax}
> +\installnarrowermethod{-\v!middle}{\global\advance\s_spac_narrower_mid  -\narrowerparameter\c!middle\relax}
> +\installnarrowermethod{-\v!right }{\global\advance\s_spac_narrower_right-\narrowerparameter\c!right \relax}

ah, interesting

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Mon Nov 19 09:31:37 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 19 Nov 2012 09:31:37 +0100
Subject: [dev-context] supp-box.mkiv
Message-ID: <21B0A09D-8978-412A-BA46-0296AA56E744@gmail.com>

Hi,

\def\syst_boxes_struttedbox_finish
- {\ht\nextbox\strutdepth
+ {\dp\nextbox\strutdepth
   \ht\nextbox\strutheight
   \box\nextbox
   \egroup}%

Wolfgang

From adityam at umich.edu  Tue Nov 27 21:37:34 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 27 Nov 2012 15:37:34 -0500 (EST)
Subject: [dev-context] Texexec help message
Message-ID: <alpine.LNX.2.02.1210151759350.12240@ybpnyubfg.ybpnyqbznva>

texexec --help --all gives

TeXExec | ["--check        check versions"]
TeXExec | ["--figures      generate overview of figures"]
TeXExec | ["--listing      list of file content"]
TeXExec | ["--make         make formats"]
TeXExec | ["--modules      generate module documentation"]
TeXExec | ["--mpgraphic    process mp file to stand-alone graphics"]
TeXExec | ["--mpstatic     process mp/ctx file to stand-alone graphics"]
TeXExec | ["--mptex        process mp file"]
TeXExec | ["--mpxtex       process mpx file"]
TeXExec | ["--pdfarrange   impose pages (booklets)"]
TeXExec | ["--pdfcombine   combine multiple pages"]
TeXExec | ["--pdfcopy      copy pages from file(s)"]
TeXExec | ["--pdfselect    select pages from file(s)"]
TeXExec | ["--pdfsplit     split file in pages"]
TeXExec | ["--pdftrim      trim pages from file(s)"]
TeXExec | ["--process      process file"]
TeXExec | [""]
TeXExec | ["boolean switches:"]
TeXExec | [""]
TeXExec | ["  allpatterns  alpha  arrange  automprun  autopath"]
TeXExec | ["  autopdf  batchmode  beta  centerpage  color"]
TeXExec | ["  combine  draft  fast  final  forcempy"]
TeXExec | ["  forcetexutil  forcexml  foxet  fullscreen  globalfile"]
TeXExec | ["  keep  local  markings  mkii  mkiv"]
TeXExec | ["  mpyforce  noarrange  nobackend  nobanner  noctx"]
TeXExec | ["  noduplex  nomapfiles  nompmode  nomprun  nonstopmode"]
TeXExec | ["  nooptionfile  notparanoid  once  paranoid  pretty"]
TeXExec | ["  purge  purgeall  screensaver  simplerun  synctex"]
TeXExec | ["  texutil  utfbom  verbose  xpdf"]
TeXExec | [""]
TeXExec | ["string switches:"]
TeXExec | [""]
TeXExec | ["  addempty  arguments  backend  background  backspace"]
TeXExec | ["  bannerheight  bodyfont  boxtype  combination  ctxfile"]
TeXExec | ["  distribution  endcolumn  endline  engine  environments"]
TeXExec | ["  filename  filters  input  interface  language"]
TeXExec | ["  logfile  mainlanguage  method  mode  modefile"]
TeXExec | ["  modes  mpsformats  output  pages  paperformat"]
TeXExec | ["  paperoffset  passon  path  pdftitle  printformat"]
TeXExec | ["  progname  randomseed  response  result  runs"]
TeXExec | ["  scale  selection  separation  setuppath  startcolumn"]
TeXExec | ["  startline  suffix  tempdir  texformats  textwidth"]
TeXExec | ["  timeout  topspace  usemodules"]

It appears that a `.join` or `.to_s` method is missing somewhere.



From pragma at wxs.nl  Wed Nov 28 15:53:26 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Nov 2012 15:53:26 +0100
Subject: [dev-context] Texexec help message
In-Reply-To: <alpine.LNX.2.02.1210151759350.12240@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1210151759350.12240@ybpnyubfg.ybpnyqbznva>
Message-ID: <50B62566.3000701@wxs.nl>

On 11/27/2012 9:37 PM, Aditya Mahajan wrote:
> texexec --help --all gives
>
> TeXExec | ["--check        check versions"]
> TeXExec | ["--figures      generate overview of figures"]
> TeXExec | ["--listing      list of file content"]
> TeXExec | ["--make         make formats"]
> TeXExec | ["--modules      generate module documentation"]
> TeXExec | ["--mpgraphic    process mp file to stand-alone graphics"]
> TeXExec | ["--mpstatic     process mp/ctx file to stand-alone graphics"]
> TeXExec | ["--mptex        process mp file"]
> TeXExec | ["--mpxtex       process mpx file"]
> TeXExec | ["--pdfarrange   impose pages (booklets)"]
> TeXExec | ["--pdfcombine   combine multiple pages"]
> TeXExec | ["--pdfcopy      copy pages from file(s)"]
> TeXExec | ["--pdfselect    select pages from file(s)"]
> TeXExec | ["--pdfsplit     split file in pages"]
> TeXExec | ["--pdftrim      trim pages from file(s)"]
> TeXExec | ["--process      process file"]
> TeXExec | [""]
> TeXExec | ["boolean switches:"]
> TeXExec | [""]
> TeXExec | ["  allpatterns  alpha  arrange  automprun  autopath"]
> TeXExec | ["  autopdf  batchmode  beta  centerpage  color"]
> TeXExec | ["  combine  draft  fast  final  forcempy"]
> TeXExec | ["  forcetexutil  forcexml  foxet  fullscreen  globalfile"]
> TeXExec | ["  keep  local  markings  mkii  mkiv"]
> TeXExec | ["  mpyforce  noarrange  nobackend  nobanner  noctx"]
> TeXExec | ["  noduplex  nomapfiles  nompmode  nomprun  nonstopmode"]
> TeXExec | ["  nooptionfile  notparanoid  once  paranoid  pretty"]
> TeXExec | ["  purge  purgeall  screensaver  simplerun  synctex"]
> TeXExec | ["  texutil  utfbom  verbose  xpdf"]
> TeXExec | [""]
> TeXExec | ["string switches:"]
> TeXExec | [""]
> TeXExec | ["  addempty  arguments  backend  background  backspace"]
> TeXExec | ["  bannerheight  bodyfont  boxtype  combination  ctxfile"]
> TeXExec | ["  distribution  endcolumn  endline  engine  environments"]
> TeXExec | ["  filename  filters  input  interface  language"]
> TeXExec | ["  logfile  mainlanguage  method  mode  modefile"]
> TeXExec | ["  modes  mpsformats  output  pages  paperformat"]
> TeXExec | ["  paperoffset  passon  path  pdftitle  printformat"]
> TeXExec | ["  progname  randomseed  response  result  runs"]
> TeXExec | ["  scale  selection  separation  setuppath  startcolumn"]
> TeXExec | ["  startline  suffix  tempdir  texformats  textwidth"]
> TeXExec | ["  timeout  topspace  usemodules"]
>
> It appears that a `.join` or `.to_s` method is missing somewhere.

can you patch

             r << '  ' + s.to_s

in line 736

(a pretty weird situation if that changed in ruby; on my system that 
patch is not needed; ruby version 1.8.6)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Thu Nov 29 00:27:37 2012
From: adityam at umich.edu (Aditya Mahajan)
Date: Wed, 28 Nov 2012 18:27:37 -0500 (EST)
Subject: [dev-context] Texexec help message
In-Reply-To: <50B62566.3000701@wxs.nl>
References: <alpine.LNX.2.02.1210151759350.12240@ybpnyubfg.ybpnyqbznva>
 <50B62566.3000701@wxs.nl>
Message-ID: <alpine.LNX.2.02.1211281806540.22664@ybpnyubfg.ybpnyqbznva>

On Wed, 28 Nov 2012, Hans Hagen wrote:

> On 11/27/2012 9:37 PM, Aditya Mahajan wrote:
>> 
>> It appears that a `.join` or `.to_s` method is missing somewhere.
>
> can you patch
>
>            r << '  ' + s.to_s
>
> in line 736
>
> (a pretty weird situation if that changed in ruby; on my system that patch is 
> not needed; ruby version 1.8.6)

I use ruby 1.9.3p286 (2012-10-12 revision 37165) [i686-linux] and it does 
appear to be due to a change in the Array class.

See http://stackoverflow.com/a/3960429/193149
http://nuclearsquid.com/writings/ruby-1-9-what-s-new-what-s-changed/ 
(search for to_s)


The bug is not in line 736. If I change that line to

    r << ' '

(an extreme case always helps testing), I get

texexec --help --all

TeXExec | ["version 6.2.1 - 1997-2009 - PRAGMA ADE/POD"]

TeXExec | ["--check        check versions"]
TeXExec | ["--figures      generate overview of figures"]
TeXExec | ["--listing      list of file content"]
TeXExec | ["--make         make formats"]
TeXExec | ["--modules      generate module documentation"]
TeXExec | ["--mpgraphic    process mp file to stand-alone graphics"]
TeXExec | ["--mpstatic     process mp/ctx file to stand-alone graphics"]
TeXExec | ["--mptex        process mp file"]
TeXExec | ["--mpxtex       process mpx file"]
TeXExec | ["--pdfarrange   impose pages (booklets)"]
TeXExec | ["--pdfcombine   combine multiple pages"]
TeXExec | ["--pdfcopy      copy pages from file(s)"]
TeXExec | ["--pdfselect    select pages from file(s)"]
TeXExec | ["--pdfsplit     split file in pages"]
TeXExec | ["--pdftrim      trim pages from file(s)"]
TeXExec | ["--process      process file"]
TeXExec | [""]
TeXExec | ["boolean switches:"]
TeXExec | [""]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["        "]
TeXExec | [""]
TeXExec | ["string switches:"]
TeXExec | [""]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["          "]
TeXExec | ["      "]


So, the `s` part is being formatted correctly, the brackets are coming 
from somewhere else.

I tested by changing report function in base/logger.rb, and if I change 
line 50 to

                     message = str.first.join(' ')

then texexec --help --all gives

TeXExec | --check        check versions
TeXExec | --figures      generate overview of figures
TeXExec | --listing      list of file content
TeXExec | --make         make formats
TeXExec | --modules      generate module documentation
TeXExec | --mpgraphic    process mp file to stand-alone graphics
TeXExec | --mpstatic     process mp/ctx file to stand-alone graphics
TeXExec | --mptex        process mp file
TeXExec | --mpxtex       process mpx file
TeXExec | --pdfarrange   impose pages (booklets)
TeXExec | --pdfcombine   combine multiple pages
TeXExec | --pdfcopy      copy pages from file(s)
TeXExec | --pdfselect    select pages from file(s)
TeXExec | --pdfsplit     split file in pages
TeXExec | --pdftrim      trim pages from file(s)
TeXExec | --process      process file
TeXExec |
TeXExec | boolean switches:
TeXExec |
TeXExec |   allpatterns  alpha  arrange  automprun  autopath
TeXExec |   autopdf  batchmode  beta  centerpage  color
TeXExec |   combine  draft  fast  final  forcempy
TeXExec |   forcetexutil  forcexml  foxet  fullscreen  globalfile
TeXExec |   keep  local  markings  mkii  mkiv
TeXExec |   mpyforce  noarrange  nobackend  nobanner  noctx
TeXExec |   noduplex  nomapfiles  nompmode  nomprun  nonstopmode
TeXExec |   nooptionfile  notparanoid  once  paranoid  pretty
TeXExec |   purge  purgeall  screensaver  simplerun  synctex
TeXExec |   texutil  utfbom  verbose  xpdf
TeXExec |
TeXExec | string switches:
TeXExec |
TeXExec |   addempty  arguments  backend  background  backspace
TeXExec |   bannerheight  bodyfont  boxtype  combination  ctxfile
TeXExec |   distribution  endcolumn  endline  engine  environments
TeXExec |   filename  filters  input  interface  language
TeXExec |   logfile  mainlanguage  method  mode  modefile
TeXExec |   modes  mpsformats  output  pages  paperformat
TeXExec |   paperoffset  passon  path  pdftitle  printformat
TeXExec |   progname  randomseed  response  result  runs
TeXExec |   scale  selection  separation  setuppath  startcolumn
TeXExec |   startline  suffix  tempdir  texformats  textwidth
TeXExec |   timeout  topspace  usemodules


Aditya

From pragma at wxs.nl  Thu Nov 29 16:21:12 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 29 Nov 2012 16:21:12 +0100
Subject: [dev-context] Texexec help message
In-Reply-To: <alpine.LNX.2.02.1211281806540.22664@ybpnyubfg.ybpnyqbznva>
References: <alpine.LNX.2.02.1210151759350.12240@ybpnyubfg.ybpnyqbznva>
 <50B62566.3000701@wxs.nl>
 <alpine.LNX.2.02.1211281806540.22664@ybpnyubfg.ybpnyqbznva>
Message-ID: <50B77D68.8070802@wxs.nl>

On 11/29/2012 12:27 AM, Aditya Mahajan wrote:

> I tested by changing report function in base/logger.rb, and if I change
> line 50 to

Ok, I've patched that.

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster at gmail.com  Sun Dec  2 16:31:19 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 2 Dec 2012 16:31:19 +0100
Subject: [dev-context] Stretch charatcers
Message-ID: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>

Hi,

how can I write the following two lines with Lua, I saw in supp-box.lua a few example how to loop through the characters but I don?t know how I can add glue between them. 

\starttext

\ruledhbox to 6cm{\processtokens{\hfil }{\hfil\hfil}{\hfil }{}{WORD}}

\ruledhbox to 6cm{\processtokens{\relax}{\hfil\hfil}{\relax}{}{WORD}}

\def\HFILLED#1{\hfil#1\hfil}

\ruledhbox to 6cm{\applytocharacters\HFILLED{WORD}}
\ruledhbox to 6cm{\hfilneg\applytocharacters\HFILLED{WORD}\hfilneg}

\stoptext

Wolfgang

From pragma at wxs.nl  Sun Dec  2 23:18:01 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 02 Dec 2012 23:18:01 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
Message-ID: <50BBD399.2060700@wxs.nl>

On 12/2/2012 4:31 PM, Wolfgang Schuster wrote:
> Hi,
>
> how can I write the following two lines with Lua, I saw in supp-box.lua a few example how to loop through the characters but I don?t know how I can add glue between them.
>
> \starttext
>
> \ruledhbox to 6cm{\processtokens{\hfil }{\hfil\hfil}{\hfil }{}{WORD}}
>
> \ruledhbox to 6cm{\processtokens{\relax}{\hfil\hfil}{\relax}{}{WORD}}
>
> \def\HFILLED#1{\hfil#1\hfil}
>
> \ruledhbox to 6cm{\applytocharacters\HFILLED{WORD}}
> \ruledhbox to 6cm{\hfilneg\applytocharacters\HFILLED{WORD}\hfilneg}
>
> \stoptext

\startluacode
function commands.ws_hfilled(str)
     context.hfil()
     for c in string.utfcharacters(str) do
         context(c)
         context.hfil()
     end
end
\stopluacode

\enabletrackers[context.trace]

\def\HFILLED#1{\ctxcommand{ws_hfilled("#1")}}

\ruledhbox to 6cm{\HFILLED{WORD}}
\ruledhbox to 6cm{\hfilneg\HFILLED{WORD}\hfilneg}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon Dec  3 10:09:45 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 3 Dec 2012 10:09:45 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <50BBD399.2060700@wxs.nl>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl>
Message-ID: <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>


Am 02.12.2012 um 23:18 schrieb Hans Hagen <pragma at wxs.nl>:

> On 12/2/2012 4:31 PM, Wolfgang Schuster wrote:
>> Hi,
>> 
>> how can I write the following two lines with Lua, I saw in supp-box.lua a few example how to loop through the characters but I don?t know how I can add glue between them.
>> 
>> \starttext
>> 
>> \ruledhbox to 6cm{\processtokens{\hfil }{\hfil\hfil}{\hfil }{}{WORD}}
>> 
>> \ruledhbox to 6cm{\processtokens{\relax}{\hfil\hfil}{\relax}{}{WORD}}
>> 
>> \def\HFILLED#1{\hfil#1\hfil}
>> 
>> \ruledhbox to 6cm{\applytocharacters\HFILLED{WORD}}
>> \ruledhbox to 6cm{\hfilneg\applytocharacters\HFILLED{WORD}\hfilneg}
>> 
>> \stoptext
> 
> \startluacode
> function commands.ws_hfilled(str)
>    context.hfil()
>    for c in string.utfcharacters(str) do
>        context(c)
>        context.hfil()
>    end
> end
> \stopluacode
> 
> \enabletrackers[context.trace]
> 
> \def\HFILLED#1{\ctxcommand{ws_hfilled("#1")}}
> 
> \ruledhbox to 6cm{\HFILLED{WORD}}
> \ruledhbox to 6cm{\hfilneg\HFILLED{WORD}\hfilneg}

This does the trick but can I check for the last char without the additional check (if n == string.utflength(str)) in the example below?

\startluacode
function commands.ws_hfilled(str,margin)
    local n = 0
    if margin then context.hfil() end
    for c in string.utfcharacters(str) do
        n = n + 1
        context(c)
        if n == string.utflength(str) then
            if margin then context.hfil() end
        else
            context.hfil()
        end
    end
end
\stopluacode

\starttext
\ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD")}}
\ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD",true)}}
\stoptext

Wolfgang

From pragma at wxs.nl  Mon Dec  3 11:00:46 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 03 Dec 2012 11:00:46 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl> <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
Message-ID: <50BC784E.4050508@wxs.nl>

On 12/3/2012 10:09 AM, Wolfgang Schuster wrote:
>
> Am 02.12.2012 um 23:18 schrieb Hans Hagen <pragma at wxs.nl>:
>
>> On 12/2/2012 4:31 PM, Wolfgang Schuster wrote:
>>> Hi,
>>>
>>> how can I write the following two lines with Lua, I saw in supp-box.lua a few example how to loop through the characters but I don?t know how I can add glue between them.
>>>
>>> \starttext
>>>
>>> \ruledhbox to 6cm{\processtokens{\hfil }{\hfil\hfil}{\hfil }{}{WORD}}
>>>
>>> \ruledhbox to 6cm{\processtokens{\relax}{\hfil\hfil}{\relax}{}{WORD}}
>>>
>>> \def\HFILLED#1{\hfil#1\hfil}
>>>
>>> \ruledhbox to 6cm{\applytocharacters\HFILLED{WORD}}
>>> \ruledhbox to 6cm{\hfilneg\applytocharacters\HFILLED{WORD}\hfilneg}
>>>
>>> \stoptext
>>
>> \startluacode
>> function commands.ws_hfilled(str)
>>     context.hfil()
>>     for c in string.utfcharacters(str) do
>>         context(c)
>>         context.hfil()
>>     end
>> end
>> \stopluacode
>>
>> \enabletrackers[context.trace]
>>
>> \def\HFILLED#1{\ctxcommand{ws_hfilled("#1")}}
>>
>> \ruledhbox to 6cm{\HFILLED{WORD}}
>> \ruledhbox to 6cm{\hfilneg\HFILLED{WORD}\hfilneg}
>
> This does the trick but can I check for the last char without the additional check (if n == string.utflength(str)) in the example below?
>
> \startluacode
> function commands.ws_hfilled(str,margin)
>      local n = 0
>      if margin then context.hfil() end
>      for c in string.utfcharacters(str) do
>          n = n + 1
>          context(c)
>          if n == string.utflength(str) then
>              if margin then context.hfil() end
>          else
>              context.hfil()
>          end
>      end
> end
> \stopluacode
>
> \starttext
> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD")}}
> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD",true)}}
> \stoptext

easier:

\startluacode
function commands.ws_hfilled(str,margin)
     local done = false
     for c in string.utfcharacters(str) do
         if done or margin then
             context.hfil()
         else
             done = true
         end
         context(c)
     end
     if margin then
         context.hfil()
     end
end
\stopluacode

\starttext
\ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD")}}
\ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD",true)}}
\stoptext


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon Dec  3 11:42:42 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 3 Dec 2012 11:42:42 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <50BC784E.4050508@wxs.nl>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl> <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
 <50BC784E.4050508@wxs.nl>
Message-ID: <AB51F38C-6E09-44F5-831D-A7B2967B2FC6@gmail.com>


Am 03.12.2012 um 11:00 schrieb Hans Hagen <pragma at wxs.nl>:

> On 12/3/2012 10:09 AM, Wolfgang Schuster wrote:
>> 
>> Am 02.12.2012 um 23:18 schrieb Hans Hagen <pragma at wxs.nl>:
>> 
>>> On 12/2/2012 4:31 PM, Wolfgang Schuster wrote:
>>>> Hi,
>>>> 
>>>> how can I write the following two lines with Lua, I saw in supp-box.lua a few example how to loop through the characters but I don?t know how I can add glue between them.
>>>> 
>>>> \starttext
>>>> 
>>>> \ruledhbox to 6cm{\processtokens{\hfil }{\hfil\hfil}{\hfil }{}{WORD}}
>>>> 
>>>> \ruledhbox to 6cm{\processtokens{\relax}{\hfil\hfil}{\relax}{}{WORD}}
>>>> 
>>>> \def\HFILLED#1{\hfil#1\hfil}
>>>> 
>>>> \ruledhbox to 6cm{\applytocharacters\HFILLED{WORD}}
>>>> \ruledhbox to 6cm{\hfilneg\applytocharacters\HFILLED{WORD}\hfilneg}
>>>> 
>>>> \stoptext
>>> 
>>> \startluacode
>>> function commands.ws_hfilled(str)
>>>    context.hfil()
>>>    for c in string.utfcharacters(str) do
>>>        context(c)
>>>        context.hfil()
>>>    end
>>> end
>>> \stopluacode
>>> 
>>> \enabletrackers[context.trace]
>>> 
>>> \def\HFILLED#1{\ctxcommand{ws_hfilled("#1")}}
>>> 
>>> \ruledhbox to 6cm{\HFILLED{WORD}}
>>> \ruledhbox to 6cm{\hfilneg\HFILLED{WORD}\hfilneg}
>> 
>> This does the trick but can I check for the last char without the additional check (if n == string.utflength(str)) in the example below?
>> 
>> \startluacode
>> function commands.ws_hfilled(str,margin)
>>     local n = 0
>>     if margin then context.hfil() end
>>     for c in string.utfcharacters(str) do
>>         n = n + 1
>>         context(c)
>>         if n == string.utflength(str) then
>>             if margin then context.hfil() end
>>         else
>>             context.hfil()
>>         end
>>     end
>> end
>> \stopluacode
>> 
>> \starttext
>> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD")}}
>> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD",true)}}
>> \stoptext
> 
> easier:
> 
> \startluacode
> function commands.ws_hfilled(str,margin)
>    local done = false
>    for c in string.utfcharacters(str) do
>        if done or margin then
>            context.hfil()
>        else
>            done = true
>        end
>        context(c)
>    end
>    if margin then
>        context.hfil()
>    end
> end
> \stopluacode
> 
> \starttext
> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD")}}
> \ruledhbox to 6cm{\ctxlua{commands.ws_hfilled("WORD",true)}}
> \stoptext

Perfect, thank you Hans.

Wolfgang

From luigi.scarso at gmail.com  Mon Dec  3 13:05:09 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 3 Dec 2012 13:05:09 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <AB51F38C-6E09-44F5-831D-A7B2967B2FC6@gmail.com>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl>
 <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
 <50BC784E.4050508@wxs.nl>
 <AB51F38C-6E09-44F5-831D-A7B2967B2FC6@gmail.com>
Message-ID: <CAG5iGsDneXj8duf95obNnTD0r4wCGXpjeNnO-=di2pkO65DceQ@mail.gmail.com>

function commands.LSws_hfilled(str,margin)
    local _
    _= margin and context.hfil()
    _= false
    for c in string.utfcharacters(str) do
        _=(_ and  context.hfil()) or  true
        context(c)
    end
    _=margin and context.hfil()
end

--
luigi

From schuster.wolfgang at gmail.com  Mon Dec  3 14:41:30 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 3 Dec 2012 14:41:30 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <CAG5iGsDneXj8duf95obNnTD0r4wCGXpjeNnO-=di2pkO65DceQ@mail.gmail.com>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl> <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
 <50BC784E.4050508@wxs.nl> <AB51F38C-6E09-44F5-831D-A7B2967B2FC6@gmail.com>
 <CAG5iGsDneXj8duf95obNnTD0r4wCGXpjeNnO-=di2pkO65DceQ@mail.gmail.com>
Message-ID: <9E30B5CC-ED43-4783-B635-22232AD0E0D6@gmail.com>


Am 03.12.2012 um 13:05 schrieb luigi scarso <luigi.scarso at gmail.com>:

> function commands.LSws_hfilled(str,margin)
>    local _
>    _= margin and context.hfil()
>    _= false
>    for c in string.utfcharacters(str) do
>        _=(_ and  context.hfil()) or  true
>        context(c)
>    end
>    _=margin and context.hfil()
> end

Thank you for the example Luigi.

Wolfgang

From luigi.scarso at gmail.com  Mon Dec  3 15:00:36 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 3 Dec 2012 15:00:36 +0100
Subject: [dev-context] Stretch charatcers
In-Reply-To: <9E30B5CC-ED43-4783-B635-22232AD0E0D6@gmail.com>
References: <955C00C5-F7A3-4353-9B38-2B692A545F52@gmail.com>
 <50BBD399.2060700@wxs.nl>
 <AFD8CA65-690C-49E6-8F21-ABC23272EADD@gmail.com>
 <50BC784E.4050508@wxs.nl>
 <AB51F38C-6E09-44F5-831D-A7B2967B2FC6@gmail.com>
 <CAG5iGsDneXj8duf95obNnTD0r4wCGXpjeNnO-=di2pkO65DceQ@mail.gmail.com>
 <9E30B5CC-ED43-4783-B635-22232AD0E0D6@gmail.com>
Message-ID: <CAG5iGsABY7CoFBxLo6x+VOsvWBgiNU3mo1gK2ckwbGwYRJiv_g@mail.gmail.com>

function commands.LSws_hfilled(str,margin)
    local _
    _= margin and context.hfil()
    _=string.utfcharacters(str)
    context(_())
    for c in _ do
        context.hfil()
        context(c)
    end
    _=margin and context.hfil()
end

--
luigi

From taco at elvenkind.com  Mon Dec 10 11:20:08 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 10 Dec 2012 11:20:08 +0100
Subject: [dev-context] MetaPost 1.770 (test release)
Message-ID: <50C5B758.6010204@elvenkind.com>


We are happy to announce a new test release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.770
----------------------------------------------------------------------

This is a test release for the new functionality planned in MetaPost 1.800.

This version will not be uploaded to CTAN / TLcontrib yet. The plan is
to wait for a few weeks before releasing 1.800. That will then be an
official end-user release.

Bugs in the current version are expected, so use with care!

The standalone distribution package and a win32 binary can be downloaded
immediately from

   http://foundry.supelec.fr/gf/project/metapost/

----------------------------------------------------------------------
What is new in MetaPost version 1.770:
----------------------------------------------------------------------

Fixes & improvements:

* There is a new bitmap backend:

     outputformat:="png";

   This backend uses cairo and libpng to generate PNG bitmap data.

   Associated with this, there are new internals "hppp" and "vppp",
   that are used by the bitmap backend to decide on the scale of
   the generated bitmap. Default value for both new internals is
   "1.0", i.e. one pixel per Metapost point.

* On the command line, adding

     --numbersystem="double"

   switches to double precision floating point internal numerical values
   instead of the traditional scaled point. There is also an identically
   named new read-only internal to query the current setting. The
   possible return values for that are currently "scaled" and "double".

   With "double" in effect, numerical values can be expressed in
   scientific notation including exponent, e.g.:

      a = 23.5E71;

   and the warning limit (traditionally 4096.0) has been extended to
   allow for the greater range.

* The C API has been extended to allow path control point resolution
    without going through the Metapost input language, see
    manual/mplibapi.tex for details.

* The C API has been extended with a "math_mode" switch in the options
   structure, and the memory size options as well as "ini_mode" have
   been removed (the MPlib instance now always starts up in inimp mode)

* The code for picture shipout now uses "double" for all floating point
   values. This can give small differences in the actual output files in
   traditional mode due to the required scaled -> double conversion, but
   was necessary to support the new numerical backend code.

* The Lua API internals have been updated to reflect the C API changes.

* All known crashes in earlier versions of Metapost have been fixed.

Known issues:

* The manual is not up-to-date yet on the metapost input language
   changes.

* There are various small memory leaks (for the most part, these were
   already present in mpost 1.50x series).


----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
http://foundry.supelec.fr/gf/project/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, December 10, 2012.
--
http://tug.org/metapost/

From taco at elvenkind.com  Mon Dec 10 11:58:34 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 10 Dec 2012 11:58:34 +0100
Subject: [dev-context] Luatex 0.72.0 announcement
Message-ID: <50C5C05A.20400@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.72.0.

This release exists mostly to get back into the habit of releasing,
you can expect another release in a month or so.

There are a few small improvements, but not that many bugs fixed yet
in this version.

Most noticeable changes:

* update various used libraries, including mplib 1.770, poppler 0.21,
   libpng 1.5, and lpeg 0.10.2.

* new 'pdfscanner' lua library.

* various OT math fixes, including \Umathcharnumdef.

* improved placement of bottom accents.

* various other small fixes that have accumulated over the past
   year-and-a-half.


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.72.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From taco at elvenkind.com  Mon Dec 10 12:17:58 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 10 Dec 2012 12:17:58 +0100
Subject: [dev-context] [metapost] MetaPost 1.770 (test release)
In-Reply-To: <50C5B758.6010204@elvenkind.com>
References: <50C5B758.6010204@elvenkind.com>
Message-ID: <50C5C4E6.5010509@elvenkind.com>


Forgotten:

On 12/10/2012 11:20 AM, Taco Hoekwater wrote:
>
> ----------------------------------------------------------------------
> What is new in MetaPost version 1.770:
> ----------------------------------------------------------------------
>
> Fixes & improvements:

* there are two new primitives for use with picture item objects:

      prescriptpart
      postscriptpart



From wolfgang.schuster at gmail.com  Mon Dec 10 12:54:53 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Mon, 10 Dec 2012 12:54:53 +0100
Subject: [dev-context] s-mod-02.mkiv
Message-ID: <2C1545AC-D949-4358-A936-D744C86CEA1A@gmail.com>

Hi Hans,

can you add the ?nocode? mode from the MkII version of the module to the MkIV file.

s-mod-00.mkii:

\startmode[nocode]

% \definieerbuffer[definition] % ignore

  \long\def\startdefinition#1\stopdefinition{}

\stopmode

Wolfgang

From taco at elvenkind.com  Mon Dec 10 17:14:04 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 10 Dec 2012 17:14:04 +0100
Subject: [dev-context] [metapost] MetaPost 1.770 (test release)
In-Reply-To: <Pine.LNX.4.61.1212101548320.14259@linux.bop.eps.gda.pl>
References: <Pine.LNX.4.61.1212101548320.14259@linux.bop.eps.gda.pl>
Message-ID: <50C60A4C.1050409@elvenkind.com>

On 12/10/2012 03:50 PM, Boguslaw Jackowski wrote:
>
> The following simple code (an acute accent from TG Pagella):
>
>    path p;
>    p:=(302,643)..controls (302,662) and (288,677)
>     ..(271,677)..controls (256,677) and (238,666)
>     ..(216,644)..controls (216,644) and (78,506)
>     ..(78,506)..controls (78,506) and (118,506)
>     ..(118,506)..controls (118,506) and (262,596)
>     ..(262,596)..controls (295,617) and (302,625)
>     ..cycle;
>    show turningnumber p;
>    end.
>
> produces a strange result with the new Metapost, namely, turningnumber=6:

Fixed in the source & repository. A simple case of an addition where a
substraction was called for (it only affected turningnumber).

Best wishes,
Taco


From bop at bop.com.pl  Mon Dec 10 21:55:08 2012
From: bop at bop.com.pl (Boguslaw Jackowski)
Date: Mon, 10 Dec 2012 21:55:08 +0100 (CET)
Subject: [dev-context] [metapost] MetaPost 1.770 (test release)
In-Reply-To: <50C60A4C.1050409@elvenkind.com>
References: <Pine.LNX.4.61.1212101548320.14259@linux.bop.eps.gda.pl>
 <50C60A4C.1050409@elvenkind.com>
Message-ID: <Pine.LNX.4.61.1212102152080.16291@linux.bop.eps.gda.pl>


Hello,

>>The following simple code (an acute accent from TG Pagella):
>>
>>  path p;
>>  p:=(302,643)..controls (302,662) and (288,677)
>>   ..(271,677)..controls (256,677) and (238,666)
>>   ..(216,644)..controls (216,644) and (78,506)
>>   ..(78,506)..controls (78,506) and (118,506)
>>   ..(118,506)..controls (118,506) and (262,596)
>>   ..(262,596)..controls (295,617) and (302,625)
>>   ..cycle;
>>  show turningnumber p;
>>  end.
>>
>> produces a strange result with the new Metapost, namely, 
>> turningnumber=6:

> Fixed in the source & repository.

Very many thanks for the prompt reaction.

> A simple case of an addition where a
> substraction was called for (it only affected turningnumber).

Sounds somehow familiar... :-)

Cheers -- Jacko

-- 
BOP s. c.
ul. Bora-Komorowskiego 24, 80-377 Gdansk, Poland
tel. (+48 58) 553 46 59,  fax (+48 58) 511 03 81
bop at bop.com.pl, http://www.bop.com.pl

From B_Jackowski at GUST.org.pl  Mon Dec 10 15:50:36 2012
From: B_Jackowski at GUST.org.pl (Boguslaw Jackowski)
Date: Mon, 10 Dec 2012 15:50:36 +0100 (CET)
Subject: [dev-context] [metapost] MetaPost 1.770 (test release)
Message-ID: <Pine.LNX.4.61.1212101548320.14259@linux.bop.eps.gda.pl>


The following simple code (an acute accent from TG Pagella):

   path p;
   p:=(302,643)..controls (302,662) and (288,677)
    ..(271,677)..controls (256,677) and (238,666)
    ..(216,644)..controls (216,644) and (78,506)
    ..(78,506)..controls (78,506) and (118,506)
    ..(118,506)..controls (118,506) and (262,596)
    ..(262,596)..controls (295,617) and (302,625)
    ..cycle;
   show turningnumber p;
   end.

produces a strange result with the new Metapost, namely, turningnumber=6:

This is MetaPost, version 1.770 (kpathsea version 6.1.1dev)  10 DEC 2012 15:35
**zz.mp
(plain.mp
Preloading the plain mem file, version 0.63)) (./zz.mp
>> 6

A previous version of Metapost, 1.503, produces the correct result:

This is MetaPost, version 1.503 (kpathsea version 6.0.0)  10 DEC 2012 15:42
**zz.mp
(mpost15.mp (c:\BOP-UTI/lib-mfmp/0mp/plain.mp
Preloading the plain mem file, version 0.63)) (./zz.mp
>> 1 )

Of course, Metafont produces also the correct result as expected:

This is METAFONT, Version 2.718281 (Web2C 2010) (base=mf 2011.1.14)  10 DEC 2012 15:35
**zz.mp
(zz.mp
>> 1 )

Cheers -- Jacko

-- 
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  Bogus\l{}aw Jackowski: B_Jackowski at GUST.ORG.PL
----------------------------------------------------------------
  Hofstadter's Law: It always takes longer than you expect, even
                    when you take into account Hofstadter's Law.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-



From taco at elvenkind.com  Tue Dec 11 10:21:14 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2012 10:21:14 +0100
Subject: [dev-context] external pdf references
Message-ID: <50C6FB0A.70202@elvenkind.com>


Hi Hans,

You know we at Docwolves do lots of stuff with

   \externalfigure[extern.pdf][interaction=yes]

right? That sometimes produces errors. Some of those are hard to send
back to you because the PDFs tend to be confidential, but there are two
cases where valid but unexpected external references wreak havoc that
are easy to explain and report:

The first is:

    mailto:"someone at gmail.com"

(with embedded " symbols). Resulting in

      ) expected near 'someone'

error from lua, and it required us to patch context like so:

\def\doifreferencefoundelse#1#2#3% 

   {\ctxcommand {doifelsereference("\referenceprefix ",[[#1]], % "#1"
                    \luaconditional \highlighthyperlinks ,
                    \luaconditional \gotonewwindow )}
                    {\expandtexincurrentreference #2}{#3}}


The second was a variation of:

   C:\TEMP\FILE.PDF

(I forgot the real example). This of course results in

	Undefined control sequence: \\TEMP

from luatex, and it required an extra line in link_uri in
lpdf-epa.lua:

local function link_uri(x,y,w,h,document,annotation)
     local url = annotation.A.URI
     url = string.gsub(url,"\\","/") -- TH Don't want backslashes here
     if url then
         add_link(x,y,w,h,format("url(%s)",url),"url")
     end
end


For the other bugs (which are ones where I often doubt whether the
external pdf was even correct in the first place) I am attaching my
versions of lpdf-epa.lua and lpdf-epd.lua for you to compare with your
version. Unfortunately, we are using "2012.06.20 20:43", so that may
be too old to help much. But you can grep for TH in the source and
perhaps get some inspiration ;)

Best wishes,
Taco




-------------- next part --------------
A non-text attachment was scrubbed...
Name: lpdf-epa.lua
Type: text/x-lua
Size: 8181 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121211/f5c3a147/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lpdf-epd.lua
Type: text/x-lua
Size: 9888 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121211/f5c3a147/attachment-0003.bin>

From taco at elvenkind.com  Tue Dec 11 10:28:09 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 11 Dec 2012 10:28:09 +0100
Subject: [dev-context] external pdf references
In-Reply-To: <50C6FB0A.70202@elvenkind.com>
References: <50C6FB0A.70202@elvenkind.com>
Message-ID: <50C6FCA9.1070306@elvenkind.com>

On 12/11/2012 10:21 AM, Taco Hoekwater wrote:
>
> Hi Hans,
>
> You know we at Docwolves do lots of stuff with
>
>    \externalfigure[extern.pdf][interaction=yes]
>
> right? That sometimes produces errors. Some of those are hard to send
> back to you because the PDFs tend to be confidential, but there are two
> cases where valid but unexpected external references wreak havoc that
> are easy to explain and report:
>
> The first is:
>
>     mailto:"someone at gmail.com"
>
> (with embedded " symbols). Resulting in
>
>       ) expected near 'someone'
>
> error from lua, and it required us to patch context like so:
>
> \def\doifreferencefoundelse#1#2#3%
>    {\ctxcommand {doifelsereference("\referenceprefix ",[[#1]], % "#1"
>                     \luaconditional \highlighthyperlinks ,
>                     \luaconditional \gotonewwindow )}
>                     {\expandtexincurrentreference #2}{#3}}

I just realized this could be fixed in link_uri as well with another
gsub. Duh.



From schuster.wolfgang at gmail.com  Tue Dec 11 13:09:19 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 11 Dec 2012 13:09:19 +0100
Subject: [dev-context] s-mod-01.mkiv (was: s-mod-02.mkiv)
In-Reply-To: <2C1545AC-D949-4358-A936-D744C86CEA1A@gmail.com>
References: <2C1545AC-D949-4358-A936-D744C86CEA1A@gmail.com>
Message-ID: <6F475934-C8AE-4CE8-8932-7A7291C78746@gmail.com>


Am 10.12.2012 um 12:54 schrieb Wolfgang Schuster <wolfgang.schuster at gmail.com>:

> Hi Hans,
> 
> can you add the ?nocode? mode from the MkII version of the module to the MkIV file.
> 
> s-mod-00.mkii:
> 
> \startmode[nocode]
> 
> % \definieerbuffer[definition] % ignore
> 
>  \long\def\startdefinition#1\stopdefinition{}
> 
> \stopmode


The code is now in the beta it but it can?t be used yet because the file isn?t loaded, can you change in s-mod-01.mkiv the line

\usemodule
  [abr-02]

to

\usemodule
  [mod-00,abr-02]

Wolfgang


From taco at elvenkind.com  Mon Dec 24 13:52:45 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 24 Dec 2012 13:52:45 +0100
Subject: [dev-context] MetaPost 1.780
Message-ID: <50D8501D.3090506@elvenkind.com>


We are happy to announce a new test release of MetaPost:

----------------------------------------------------------------------
MetaPost 1.780
----------------------------------------------------------------------

This is a second test release for the new functionality planned in
MetaPost 1.800.

This version will not be uploaded to CTAN / TLcontrib yet. The plan is
to wait for a few weeks before releasing 1.800. That will then be an
official end-user release.

Bugs in the current version are still likely, so use with care!

The standalone distribution package and a win32 binary can be downloaded
immediately from

   http://foundry.supelec.fr/gf/project/metapost/

----------------------------------------------------------------------
What is new in MetaPost version 1.780:
----------------------------------------------------------------------

* The turningnumber calculation in 1.770 was bugged.

* The picture export in 1.770 forgot to add trailing zeroes to the
   log and term output channel resulting in rubbish output.

* The arguments of the PS "dtransform" operator have been fixed
   (was wrong since 1.750).

* The warning limit in numbersystem=double mode is now exactly 2**52.

* A bunch of obvious memory leaks fixed. Not all yet, but now the
   MPlib seems to be usable even with many graphics.

----------------------------------------------------------------------
Legal notice / license / bug reports
----------------------------------------------------------------------

MetaPost is a system for producing graphics developed by John Hobby
at AT&T, based on Donald Knuth's Metafont.  The MetaPost home page
is http://tug.org/metapost.

MetaPost is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation, either version 2.1 of the License, or
(at your option) any later version.

The MetaPost development project is currently hosted at Supelec,
http://foundry.supelec.fr/gf/project/metapost; with a bug tracker
at http://tracker.luatex.org/. Please report bugs and
request enhancements through there if possible. Alternatively, you
can reach us through the <metapost at tug.org> mailing list as well.

Have fun!

Taco Hoekwater, for the MetaPost team, December 24, 2012.

From taco at elvenkind.com  Mon Dec 24 13:54:48 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 24 Dec 2012 13:54:48 +0100
Subject: [dev-context] MetaPost 1.780
In-Reply-To: <50D8501D.3090506@elvenkind.com>
References: <50D8501D.3090506@elvenkind.com>
Message-ID: <50D85098.8020403@elvenkind.com>


Hi Mojca,

On 12/24/2012 01:52 PM, Taco Hoekwater wrote:
>
> We are happy to announce a new test release of MetaPost:
>
> ----------------------------------------------------------------------
> MetaPost 1.780
> ----------------------------------------------------------------------

It would be cool if the distribution would actually contain this
version, as it seems that most of the big bugs have been removed now.

Best wishes,
Taco


From taco at elvenkind.com  Mon Dec 24 15:13:31 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 24 Dec 2012 15:13:31 +0100
Subject: [dev-context] Luatex 0.74.0 announcement
Message-ID: <50D8630B.4070104@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.74.0.

Most noticeable changes:

* Lua 5.2
   There are no patches to the core Lua files; a future version
   of luatex will switch to loading the regular lua 5.2 dynamic
   library instead of depending on a statically compiled
   one.

   NOTE: This change can break some of your lua files, as the
   language has changed a little between versions 5.1 and 5.2

* A bleeding-edge version of luasocket is included, as there
   is no 5.2-compatible official release yet.

* A new lua extension is the two-argument version of
   string.dump from Luajit:

     string.dump(function f, [boolean strip])

* Included mpost 1.780

* The implied existence of the following Lua libraries is now
   deprecated:

      debug, unicode.*, luazip, lfs, lpeg, zlib, gzip, md5,
      socket.*, profiler, epdf, fontloader, mplib, and
      pdfscanner.

   Future versions of luatex will load these modules on demand
   from dynamic libraries.

   Please update your sources to include a 'require' line for
   each of the library modules mentioned.

* Two new callbacks: find_cidmap_file and load_cidmap_file
   (used by the fontloader to discover .cidmaps)



The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.74.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco

From preining at logic.at  Tue Dec 25 00:34:56 2012
From: preining at logic.at (Norbert Preining)
Date: Tue, 25 Dec 2012 08:34:56 +0900
Subject: [dev-context] [luatex] Luatex 0.74.0 announcement - warning
In-Reply-To: <50D8630B.4070104@elvenkind.com>
References: <50D8630B.4070104@elvenkind.com>
Message-ID: <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>

Hi Taco,

On Mo, 24 Dez 2012, Taco Hoekwater wrote:
> I have just uploaded the archives for a new luatex release, 0.74.0.

First report: Current context from TeX Live breaks with this luatex:

$ context test.tex
/usr/bin/mtxrun:15228: attempt to index field 'loaders' (a nil value)
$

I guess a consequence of that:
> * The implied existence of the following Lua libraries is now
>   deprecated:

Other than that, I enjoyed reading that announcement that soon lua52 will
be dynamically linked ... many distributors will be happy ;-)


Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
PEVENSEY (n. archaic)
The right to collect shingle from the king's foreshore.
			--- Douglas Adams, The Meaning of Liff

From martin at oneiros.de  Tue Dec 25 00:41:06 2012
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 25 Dec 2012 00:41:06 +0100
Subject: [dev-context] [luatex] Luatex 0.74.0 announcement - warning
In-Reply-To: <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
Message-ID: <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>

2012/12/25 Norbert Preining <preining at logic.at>:
> First report: Current context from TeX Live breaks with this luatex:
>
> $ context test.tex
> /usr/bin/mtxrun:15228: attempt to index field 'loaders' (a nil value)

A known fallout of lua 5.2

<Hans>fixed in next beta</Hans>

Best
   Martin

From preining at logic.at  Tue Dec 25 00:50:43 2012
From: preining at logic.at (Norbert Preining)
Date: Tue, 25 Dec 2012 08:50:43 +0900
Subject: [dev-context] [Dev-luatex] [luatex] Luatex 0.74.0
	announcement	- warning
In-Reply-To: <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
Message-ID: <20121224235043.GA10489@gamma.logic.tuwien.ac.at>

On Di, 25 Dez 2012, Martin Schr?der wrote:
> > First report: Current context from TeX Live breaks with this luatex:
> >
> > $ context test.tex
> > /usr/bin/mtxrun:15228: attempt to index field 'loaders' (a nil value)
> 
> A known fallout of lua 5.2
> 
> <Hans>fixed in next beta</Hans>

Better to be fixed/backported in the TeX Live svn, too, so that users 
don't stumble over a 
	tlmgr --repository .../tlcontrib update --all
and suddenly context is gone.

Martin, Taco: Merry Christmas, what are you doning *NOW* online ;-)))

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
NAPLES (pl.n.)
The tiny depression in a piece of Ryvita.
			--- Douglas Adams, The Meaning of Liff

From taco at docwolves.nl  Tue Dec 25 09:43:47 2012
From: taco at docwolves.nl (Taco hoekwater)
Date: Tue, 25 Dec 2012 09:43:47 +0100
Subject: [dev-context] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
Message-ID: <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>

Hi all,

So far, it looks like we have three issue groups:

1) the compile errors for metapost with the missing png.h
2) various luatex compile problems for luasocket
3) broken context / texdoc (lualatex?)with texlive

Issue 1) appears to be a timestamp problem. It is probably possible to work around it by manually running 'make' in build/libs/zlib and build/libs/libpng, then 'make mpost' in build/texk/web2c. Somehow, the build rules are not quite right yet, and I probably need help from PEB to fix it properly.

Issue 2) probably comes down to the bleeding edge luasocket not being as portable as the released version, and should be relatively easy to fix.

Issue 3) means that some package updates should go to tlcontrib asap.

But for today, I just wish you all a blessed christmas / yule. Programming is for tomorrow.

Taco

From luigi.scarso at gmail.com  Tue Dec 25 09:48:56 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 25 Dec 2012 09:48:56 +0100
Subject: [dev-context] [Dev-luatex] Luatex 0.74.0 announcement -issues
In-Reply-To: <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
Message-ID: <CAG5iGsAwPozir7dJF6xb3ry2wa1L2=ouP7fU4JjamY3ph9UqKA@mail.gmail.com>

On Tue, Dec 25, 2012 at 9:43 AM, Taco hoekwater <taco at docwolves.nl> wrote:
> Hi all,
>
> So far, it looks like we have three issue groups:
>
> 1) the compile errors for metapost with the missing png.h
> 2) various luatex compile problems for luasocket
> 3) broken context / texdoc (lualatex?)with texlive
>
> Issue 1) appears to be a timestamp problem. It is probably possible to work around it by manually running 'make' in build/libs/zlib and build/libs/libpng, then 'make mpost' in build/texk/web2c. Somehow, the build rules are not quite right yet, and I probably need help from PEB to fix it properly.
>
> Issue 2) probably comes down to the bleeding edge luasocket not being as portable as the released version, and should be relatively easy to fix.
>
> Issue 3) means that some package updates should go to tlcontrib asap.
>
> But for today, I just wish you all a blessed christmas / yule. Programming is for tomorrow.
ok.
Merry christmas to all of you !!
--
luigi

From alan.braslau at cea.fr  Tue Dec 25 09:50:44 2012
From: alan.braslau at cea.fr (Alan BRASLAU)
Date: Tue, 25 Dec 2012 09:50:44 +0100
Subject: [dev-context] [Dev-luatex] [luatex] Luatex 0.74.0 announcement
 - warning
In-Reply-To: <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
Message-ID: <20121225095044.692d9404@iram-hb-003386.extra.cea.fr>

On Tue, 25 Dec 2012 08:50:43 +0900
Norbert Preining <preining at logic.at> wrote:

> Martin, Taco: Merry Christmas, what are you doning *NOW* online ;-)))

Nice Christmas present Taco left us!

(re)compiling in front of a nice warm fire...

Alan


From pragma at wxs.nl  Tue Dec 25 13:02:41 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 25 Dec 2012 13:02:41 +0100
Subject: [dev-context] [Dev-luatex] [luatex] Luatex 0.74.0 announcement
 - warning
In-Reply-To: <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
Message-ID: <50D995E1.3060000@wxs.nl>

On 12/25/2012 12:41 AM, Martin Schr?der wrote:
> 2012/12/25 Norbert Preining <preining at logic.at>:
>> First report: Current context from TeX Live breaks with this luatex:
>>
>> $ context test.tex
>> /usr/bin/mtxrun:15228: attempt to index field 'loaders' (a nil value)
>
> A known fallout of lua 5.2
>
> <Hans>fixed in next beta</Hans>

FYI: We have done 0.74 tests with context so it works ok but this time 
the beta was not yet pushed to the garden. Also, just popping luatex 
0.74 into the stable texlive tree is not that good an idea if stability 
is important.

The 0.74+ versions are more a prelude to texlive 2014 esp as there are 
some fixes coming that can also influence compatibility. Afaik, context 
in texlive is the 'current' and not the 'beta' (Mojca has to correct me 
if I'm wrong).

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From homerow at lavabit.com  Tue Dec 25 16:07:30 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Tue, 25 Dec 2012 16:07:30 +0100
Subject: [dev-context] [Dev-luatex] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
Message-ID: <20121225150730.GA28858@homerow>

On 2012?12?25 Taco hoekwater wrote:

Hi,

I am building the binaries for Solaris (x86).


> 1) the compile errors for metapost with the missing png.h

No problems during compilation.


> 2) various luatex compile problems for luasocket

Linking fails due to a call to an undefined function:

Undefined			first referenced
 symbol  			    in file
hstrerror                           libluasocket.a(libluasocket_a-socket.o)
ld: fatal: symbol referencing errors. No output written to luatex

A patch is attached. Which upstream repo is useed? This is the most
recent one I found:

https://github.com/diegonehab/luasocket/tree/unstable


When committing the binaries, I get a bunch of SVN errors:

svn: E200009: Could not add all targets because some targets are already versioned
svn: E200009: Illegal target for the requested operation

This does not seem to be critical, but maybe you can check while
you're at it. The binaries are committed successfully.


Marco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix_luasocket.patch
Type: text/x-diff
Size: 388 bytes
Desc: not available
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121225/8a03d945/attachment.patch>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121225/8a03d945/attachment.pgp>

From homerow at lavabit.com  Tue Dec 25 17:11:16 2012
From: homerow at lavabit.com (Marco Patzer)
Date: Tue, 25 Dec 2012 17:11:16 +0100
Subject: [dev-context] [Dev-luatex] Luatex 0.74.0 announcement	 -issues
In-Reply-To: <20121225150730.GA28858@homerow>
References: <50D8630B.4070104@elvenkind.com>
 <20121224233456.GJ7986@gamma.logic.tuwien.ac.at>
 <CAP7DCDez1t6eaHaxkF_tPGde5zbg69zt9MCLrf_ePcZCOap5jA@mail.gmail.com>
 <20121224235043.GA10489@gamma.logic.tuwien.ac.at>
 <296D54EA-58A5-4ECE-ADCA-39B065CABDBC@docwolves.nl>
 <20121225150730.GA28858@homerow>
Message-ID: <20121225161116.GD28858@homerow>

On 2012?12?25 Marco Patzer wrote:

> Linking fails due to a call to an undefined function:
> 
> Undefined			first referenced
>  symbol  			    in file
> hstrerror                           libluasocket.a(libluasocket_a-socket.o)
> ld: fatal: symbol referencing errors. No output written to luatex
> 
> A patch is attached.

Changing hstrerror (from netdb.h) to strerror might not be a good
idea, it might result in reporting a wrong error message. This
should be fixed so that hstrerror is actually found.

I'm not sure what's wrong here, the luasocket build or the libtool
call?


Marco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: Digital signature
URL: <http://www.ntg.nl/pipermail/dev-context/attachments/20121225/4347dd82/attachment.pgp>

From schuster.wolfgang at gmail.com  Sat Dec 29 13:45:42 2012
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sat, 29 Dec 2012 13:45:42 +0100
Subject: [dev-context] pack-box.mkiv
Message-ID: <C72D906C-AD89-47A4-B04E-F8394CEA1F95@gmail.com>

Hi,

there is a % missing after \setupcurrentcollector:

\def\pack_boxes_collector[#1][#2]% todo: keep reference point
  {\pack_boxes_collector_check_box{#1}%
   \ifconditional\c_pack_boxes_collector_valid_box
-    \setupcurrentcollector[#2]
+    \setupcurrentcollector[#2]%
     \expandafter\pack_boxes_collector_yes
   \else
     \expandafter\pack_boxes_collector_nop
   \fi}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Dec 30 10:33:33 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 30 Dec 2012 10:33:33 +0100
Subject: [dev-context] buff-ini.mkii
Message-ID: <CFB9D36D-49F4-4751-8F1C-8B80010BDD1A@gmail.com>

Hi,

bug/typo in the MkII buffer code:

\def\normalbufferparagraph
  {\advance\currentbufferparagraph \plusone
   \ifnum\currentbufferparagraph>\zerocount
     \expandafter\dostartbufferparagraph
   \else
-    \expandafter\gobbleoneargument
+    \expandafter\gobblebufferparagraph
   \fi}

Wolfgang

From wolfgang.schuster at gmail.com  Sun Dec 30 11:41:50 2012
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Sun, 30 Dec 2012 11:41:50 +0100
Subject: [dev-context] \getbufferparagraphs
Message-ID: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>

Hi Hans,

do you plan to add the \getbufferparagraphs command to MkIV or is it marked obsolete?

Wolfgang

From pragma at wxs.nl  Mon Dec 31 19:28:45 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 31 Dec 2012 19:28:45 +0100
Subject: [dev-context] \getbufferparagraphs
In-Reply-To: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>
References: <0D102744-DF18-480B-9B9D-85BA9A0A0E46@gmail.com>
Message-ID: <50E1D95D.7020205@wxs.nl>

On 12/30/2012 11:41 AM, Wolfgang Schuster wrote:
> Hi Hans,
>
> do you plan to add the \getbufferparagraphs command to MkIV or is it marked obsolete?

if needed i can do that (not much work) but i need to figure out the 
specs -)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

