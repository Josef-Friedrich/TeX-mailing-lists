From lahcim8 at gmail.com  Tue Feb  9 18:57:14 2021
From: lahcim8 at gmail.com (=?utf-8?q?Michal_Vlas=C3=A1k?=)
Date: Tue, 09 Feb 2021 18:57:14 +0100
Subject: [dev-context] lpdf-ini.lmt: lpdf.tosixteen(),
 wrong conversion to UTF-16BE
Message-ID: <C95706QWSQU0.35NM7EZO0FSQS@phobos>

Hello,

conversion to UTF-16BE PDF strings used for example in bookmarks / PDF
outlines is not right.

Take the following example:

```
\starttext
\setupinteraction[state=start]
\placebookmarks[section][number=no]

\section[bookmark=ð]

\stoptext
```

Produces: <FEFF0075DD44> for ð (U+1D544), instead of the correct
<FEFFD835DD44>.


The relevant function is `lpdf.tosixteen()` (from lpdf-ini.lmt), and its
`cache`. (Although the same function is also in lpdf-aux.lmt, and in
MkIV equivalents).

My proposal (also enclosed as a file attachment):

```
--- a/lpdf-ini.lmt
+++ b/lpdf-ini.lmt
@@ -178,7 +178,8 @@
         if v < 0x10000 then
             v = format("%04x",v)
         else
-            v = format("%04x%04x",rshift(v,10),v%1024+0xDC00)
+            v = v - 0x10000
+            v = format("%04x%04x",rshift(v,10)+0xD800,v%1024+0xDC00)
         end
         t[k] = v
         return v
```

(Note the similiarity to existing function `big()` in l-unicode.lua.)

I found this by chance, but I am not really a ConTeXt user, so I hope
didn't miss anything.

Regards,
Michal VlasÃ¡k
-------------- next part --------------
if not modules then modules = { } end modules ['lpdf-ini'] = {
    version   = 1.001,
    optimize  = true,
    comment   = "companion to lpdf-ini.mkiv",
    author    = "Hans Hagen, PRAGMA-ADE, Hasselt NL",
    copyright = "PRAGMA ADE / ConTeXt Development Team",
    license   = "see context related readme files"
}

-- beware of "too many locals" here

local setmetatable, getmetatable, type, next, tostring, tonumber, rawset = setmetatable, getmetatable, type, next, tostring, tonumber, rawset
local char, byte, format, gsub, concat, match, sub, gmatch = string.char, string.byte, string.format, string.gsub, table.concat, string.match, string.sub, string.gmatch
local utfchar, utfbyte, utfvalues = utf.char, utf.byte, utf.values
local sind, cosd, max, min = math.sind, math.cosd, math.max, math.min
local sort, sortedhash = table.sort, table.sortedhash
local P, C, R, S, Cc, Cs, V = lpeg.P, lpeg.C, lpeg.R, lpeg.S, lpeg.Cc, lpeg.Cs, lpeg.V
local lpegmatch, lpegpatterns = lpeg.match, lpeg.patterns
local formatters = string.formatters
local isboolean = string.is_boolean
local rshift = bit32.rshift

local report_objects    = logs.reporter("backend","objects")
local report_finalizing = logs.reporter("backend","finalizing")
local report_blocked    = logs.reporter("backend","blocked")

local implement         = interfaces.implement

local context           = context

-- In ConTeXt MkIV we use utf8 exclusively so all strings get mapped onto a hex
-- encoded utf16 string type between <>. We could probably save some bytes by using
-- strings between () but then we end up with escaped ()\ too.

pdf                     = type(pdf) == "table" and pdf or { }
local factor            = number.dimenfactors.bp

local codeinjections    = { }
local nodeinjections    = { }

local backends          = backends

local pdfbackend        = {
    comment        = "backend for directly generating pdf output",
    nodeinjections = nodeinjections,
    codeinjections = codeinjections,
    registrations  = { },
    tables         = { },
}

backends.pdf = pdfbackend

lpdf       = lpdf or { }
local lpdf = lpdf
lpdf.flags = lpdf.flags or { } -- will be filled later

table.setmetatableindex(lpdf, function(t,k)
    report_blocked("function %a is not accessible",k)
    os.exit()
end)

local trace_finalizers = false  trackers.register("backend.finalizers", function(v) trace_finalizers = v end)
local trace_resources  = false  trackers.register("backend.resources",  function(v) trace_resources  = v end)

local pdfreserveobject
local pdfimmediateobject

updaters.register("backend.update.lpdf",function()
    pdfreserveobject    = lpdf.reserveobject
    pdfimmediateobject  = lpdf.immediateobject
end)

do

    updaters.register("backend.update.lpdf",function()
        job.positions.registerhandlers {
            getpos  = drivers.getpos,
            getrpos = drivers.getrpos,
            gethpos = drivers.gethpos,
            getvpos = drivers.getvpos,
        }
        lpdf.getpos = drivers.getpos
    end)

    local pdfgetmatrix, pdfhasmatrix, pdfgetpos

    updaters.register("backend.update.lpdf",function()
        pdfgetmatrix = lpdf.getmatrix
        pdfhasmatrix = lpdf.hasmatrix
        pdfgetpos    = lpdf.getpos
    end)

    -- local function transform(llx,lly,urx,ury,rx,sx,sy,ry)
    --     local x1 = llx * rx + lly * sy
    --     local y1 = llx * sx + lly * ry
    --     local x2 = llx * rx + ury * sy
    --     local y2 = llx * sx + ury * ry
    --     local x3 = urx * rx + lly * sy
    --     local y3 = urx * sx + lly * ry
    --     local x4 = urx * rx + ury * sy
    --     local y4 = urx * sx + ury * ry
    --     llx = min(x1,x2,x3,x4);
    --     lly = min(y1,y2,y3,y4);
    --     urx = max(x1,x2,x3,x4);
    --     ury = max(y1,y2,y3,y4);
    --     return llx, lly, urx, ury
    -- end
    --
    -- function lpdf.transform(llx,lly,urx,ury) -- not yet used so unchecked
    --     if pdfhasmatrix() then
    --         local sx, rx, ry, sy = pdfgetmatrix()
    --         local w, h = urx - llx, ury - lly
    --         return llx, lly, llx + sy*w - ry*h, lly + sx*h - rx*w
    --      -- return transform(llx,lly,urx,ury,sx,rx,ry,sy)
    --     else
    --         return llx, lly, urx, ury
    --     end
    -- end

    -- funny values for tx and ty

    function lpdf.rectangle(width,height,depth,offset)
        local tx, ty = pdfgetpos()
        if offset then
            tx     = tx     -   offset
            ty     = ty     +   offset
            width  = width  + 2*offset
            height = height +   offset
            depth  = depth  +   offset
        end
        if pdfhasmatrix() then
            local rx, sx, sy, ry = pdfgetmatrix()
            return
                factor *  tx,
                factor * (ty - ry*depth  + sx*width),
                factor * (tx + rx*width  - sy*height),
                factor * (ty + ry*height - sx*width)
        else
            return
                factor *  tx,
                factor * (ty - depth),
                factor * (tx + width),
                factor * (ty + height)
        end
    end

end

-- we could use a hash of predefined unicodes

-- local function tosixteen(str) -- an lpeg might be faster (no table)
--     if not str or str == "" then
--         return "<feff>" -- not () as we want an indication that it's unicode
--     else
--         local r, n = { "<feff" }, 1
--         for b in utfvalues(str) do
--             n = n + 1
--             if b < 0x10000 then
--                 r[n] = format("%04x",b)
--             else
--                 r[n] = format("%04x%04x",rshift(b,10),b%1024+0xDC00)
--             end
--         end
--         n = n + 1
--         r[n] = ">"
--         return concat(r)
--     end
-- end

local tosixteen, fromsixteen, topdfdoc, frompdfdoc, toeight, fromeight

do

    local escaped = Cs(Cc("(") * (S("\\()\n\r\t\b\f")/"\\%0" + P(1))^0 * Cc(")"))

    local cache = table.setmetatableindex(function(t,k) -- can be made weak
        local v = utfbyte(k)
        if v < 0x10000 then
            v = format("%04x",v)
        else
            v = v - 0x10000
            v = format("%04x%04x",rshift(v,10)+0xD800,v%1024+0xDC00)
        end
        t[k] = v
        return v
    end)

    local unified = Cs(Cc("<feff") * (lpeg.patterns.utf8character/cache)^1 * Cc(">"))

    tosixteen = function(str) -- an lpeg might be faster (no table)
        if not str or str == "" then
            return "<feff>" -- not () as we want an indication that it's unicode
        else
            return lpegmatch(unified,str)
        end
    end

    local more = 0

    local pattern = C(4) / function(s) -- needs checking !
        local now = tonumber(s,16)
        if more > 0 then
            now = (more-0xD800)*0x400 + (now-0xDC00) + 0x10000 -- the 0x10000 smells wrong
            more = 0
            return utfchar(now)
        elseif now >= 0xD800 and now <= 0xDBFF then
            more = now
            return "" -- else the c's end up in the stream
        else
            return utfchar(now)
        end
    end

    local pattern = P(true) / function() more = 0 end * Cs(pattern^0)

    fromsixteen = function(str)
        if not str or str == "" then
            return ""
        else
            return lpegmatch(pattern,str)
        end
    end

    local toregime   = regimes.toregime
    local fromregime = regimes.fromregime

    topdfdoc = function(str,default)
        if not str or str == "" then
            return ""
        else
            return lpegmatch(escaped,toregime("pdfdoc",str,default)) -- could be combined if needed
        end
    end

    frompdfdoc = function(str)
        if not str or str == "" then
            return ""
        else
            return fromregime("pdfdoc",str)
        end
    end

    if not toregime   then topdfdoc   = function(s) return s end end
    if not fromregime then frompdfdoc = function(s) return s end end

    toeight = function(str)
        if not str or str == "" then
            return "()"
        else
            return lpegmatch(escaped,str)
        end
    end

    local b_pattern = Cs((P("\\")/"" * (
        S("()")
      + S("nrtbf") / { n = "\n", r = "\r", t = "\t", b = "\b", f = "\f" }
      + lpegpatterns.octdigit^-3 / function(s) return char(tonumber(s,8)) end)
    + P(1))^0)

    fromeight = function(str)
        if not str or str == "" then
            return ""
        else
            return lpegmatch(unescape,str)
        end
    end

    local u_pattern = lpegpatterns.utfbom_16_be * lpegpatterns.utf16_to_utf8_be -- official
                    + lpegpatterns.utfbom_16_le * lpegpatterns.utf16_to_utf8_le -- we've seen these

    local h_pattern = lpegpatterns.hextobytes

    local zero = S(" \n\r\t") + P("\\ ")
    local one  = C(4)
    local two  = P("d") * R("89","af") * C(2) * C(4)

    local x_pattern = P { "start",
        start     = V("wrapped") + V("unwrapped") + V("original"),
        original  = Cs(P(1)^0),
        wrapped   = P("<") * V("unwrapped") * P(">") * P(-1),
        unwrapped = P("feff")
                  * Cs( (
                        zero  / ""
                      + two   / function(a,b)
                                    a = (tonumber(a,16) - 0xD800) * 1024
                                    b = (tonumber(b,16) - 0xDC00)
                                    return utfchar(a+b)
                                end
                      + one   / function(a)
                                    return utfchar(tonumber(a,16))
                                end
                    )^1 ) * P(-1)
    }

    function lpdf.frombytes(s,hex)
        if not s or s == "" then
            return ""
        end
        if hex then
            local x = lpegmatch(x_pattern,s)
            if x then
                return x
            end
            local h = lpegmatch(h_pattern,s)
            if h then
                return h
            end
        else
            local u = lpegmatch(u_pattern,s)
            if u then
                return u
            end
        end
        return lpegmatch(b_pattern,s)
    end

    lpdf.tosixteen   = tosixteen
    lpdf.toeight     = toeight
    lpdf.topdfdoc    = topdfdoc
    lpdf.fromsixteen = fromsixteen
    lpdf.fromeight   = fromeight
    lpdf.frompdfdoc  = frompdfdoc

end

local tostring_a, tostring_d

do

    local f_key_null       = formatters["/%s null"]
    local f_key_value      = formatters["/%s %s"]
 -- local f_key_dictionary = formatters["/%s << % t >>"]
 -- local f_dictionary     = formatters["<< % t >>"]
    local f_key_dictionary = formatters["/%s << %s >>"]
    local f_dictionary     = formatters["<< %s >>"]
 -- local f_key_array      = formatters["/%s [ % t ]"]
 -- local f_array          = formatters["[ % t ]"]
    local f_key_array      = formatters["/%s [ %s ]"]
    local f_array          = formatters["[ %s ]"]
    local f_key_number     = formatters["/%s %N"]  -- always with max 9 digits and integer is possible
    local f_tonumber       = formatters["%N"]      -- always with max 9 digits and integer is possible

    tostring_d = function(t,contentonly,key)
        if next(t) then
            local r = { }
            local n = 0
            local e
            for k, v in next, t do
                if k == "__extra__" then
                    e = v
                elseif k == "__stream__" then
                    -- do nothing (yet)
                else
                    n = n + 1
                    r[n] = k
                end
            end
            if n > 1 then
                sort(r)
            end
            for i=1,n do
                local k  = r[i]
                local v  = t[k]
                local tv = type(v)
                -- mostly tables
                if tv == "table" then
                 -- local mv = getmetatable(v)
                 -- if mv and mv.__lpdftype then
                    if v.__lpdftype__ then
                     -- if v == t then
                     --     report_objects("ignoring circular reference in dictionary")
                     --     r[i] = f_key_null(k)
                     -- else
                            r[i] = f_key_value(k,tostring(v))
                     -- end
                    elseif v[1] then
                        r[i] = f_key_value(k,tostring_a(v))
                    else
                        r[i] = f_key_value(k,tostring_d(v))
                    end
                elseif tv == "string" then
                    r[i] = f_key_value(k,toeight(v))
                elseif tv == "number" then
                    r[i] = f_key_number(k,v)
                else
                    r[i] = f_key_value(k,tostring(v))
                end
            end
            if e then
                r[n+1] = e
            end
            r = concat(r," ")
            if contentonly then
                return r
            elseif key then
                return f_key_dictionary(key,r)
            else
                return f_dictionary(r)
            end
        elseif contentonly then
            return ""
        else
            return "<< >>"
        end
    end

    tostring_a = function(t,contentonly,key)
        local tn = #t
        if tn ~= 0 then
            local r = { }
            for k=1,tn do
                local v = t[k]
                local tv = type(v)
                -- mostly numbers and tables
                if tv == "number" then
                    r[k] = f_tonumber(v)
                elseif tv == "table" then
                 -- local mv = getmetatable(v)
                 -- if mv and mv.__lpdftype then
                    if v.__lpdftype__ then
                     -- if v == t then
                     --     report_objects("ignoring circular reference in array")
                     --     r[k] = "null"
                     -- else
                            r[k] = tostring(v)
                     -- end
                    elseif v[1] then
                        r[k] = tostring_a(v)
                    else
                        r[k] = tostring_d(v)
                    end
                elseif tv == "string" then
                    r[k] = toeight(v)
                else
                    r[k] = tostring(v)
                end
            end
            local e = t.__extra__
            if e then
                r[tn+1] = e
            end
            r = concat(r," ")
            if contentonly then
                return r
            elseif key then
                return f_key_array(key,r)
            else
                return f_array(r)
            end
        elseif contentonly then
            return ""
        else
            return "[ ]"
        end
    end

end

local f_tonumber = formatters["%N"]

local tostring_x = function(t) return concat(t," ")       end
local tostring_s = function(t) return toeight(t[1])       end
local tostring_p = function(t) return topdfdoc(t[1],t[2]) end
local tostring_u = function(t) return tosixteen(t[1])     end
----- tostring_n = function(t) return tostring(t[1])      end -- tostring not needed
local tostring_n = function(t) return f_tonumber(t[1])    end -- tostring not needed
local tostring_c = function(t) return t[1]                end -- already prefixed (hashed)
local tostring_z = function()  return "null"              end
local tostring_t = function()  return "true"              end
local tostring_f = function()  return "false"             end
local tostring_r = function(t) local n = t[1] return n and n > 0 and (n .. " 0 R") or "null" end

local tostring_v = function(t)
    local s = t[1]
    if type(s) == "table" then
        return concat(s)
    else
        return s
    end
end

local tostring_l = function(t)
    local s = t[1]
    if not s or s == "" then
        return "()"
    elseif t[2] then
        return "<" .. s .. ">"
    else
        return "(" .. s .. ")"
    end
end

local function value_x(t) return t                  end
local function value_s(t) return t[1]               end
local function value_p(t) return t[1]               end
local function value_u(t) return t[1]               end
local function value_n(t) return t[1]               end
local function value_c(t) return sub(t[1],2)        end
local function value_d(t) return tostring_d(t,true) end
local function value_a(t) return tostring_a(t,true) end
local function value_z()  return nil                end
local function value_t(t) return t.value or true    end
local function value_f(t) return t.value or false   end
local function value_r(t) return t[1] or 0          end -- null
local function value_v(t) return t[1]               end
local function value_l(t) return t[1]               end

local function add_to_d(t,v)
    local k = type(v)
    if k == "string" then
        if t.__extra__ then
            t.__extra__ = t.__extra__ .. " " .. v
        else
            t.__extra__ = v
        end
    elseif k == "table" then
        for k, v in next, v do
            t[k] = v
        end
    end
    return t
end

local function add_to_a(t,v)
    local k = type(v)
    if k == "string" then
        if t.__extra__ then
            t.__extra__ = t.__extra__ .. " " .. v
        else
            t.__extra__ = v
        end
    elseif k == "table" then
        local n = #t
        for i=1,#v do
            n = n + 1
            t[n] = v[i]
        end
    end
    return t
end

local function add_x(t,k,v) rawset(t,k,tostring(v)) end

local mt_x = { __index = { __lpdftype__ = "stream"     }, __tostring = tostring_x, __call = value_x, __newindex = add_x }
local mt_d = { __index = { __lpdftype__ = "dictionary" }, __tostring = tostring_d, __call = value_d, __add = add_to_d }
local mt_a = { __index = { __lpdftype__ = "array"      }, __tostring = tostring_a, __call = value_a, __add = add_to_a }
local mt_u = { __index = { __lpdftype__ = "unicode"    }, __tostring = tostring_u, __call = value_u }
local mt_s = { __index = { __lpdftype__ = "string"     }, __tostring = tostring_s, __call = value_s }
local mt_p = { __index = { __lpdftype__ = "docstring"  }, __tostring = tostring_p, __call = value_p }
local mt_n = { __index = { __lpdftype__ = "number"     }, __tostring = tostring_n, __call = value_n }
local mt_c = { __index = { __lpdftype__ = "constant"   }, __tostring = tostring_c, __call = value_c }
local mt_z = { __index = { __lpdftype__ = "null"       }, __tostring = tostring_z, __call = value_z }
local mt_t = { __index = { __lpdftype__ = "true"       }, __tostring = tostring_t, __call = value_t }
local mt_f = { __index = { __lpdftype__ = "false"      }, __tostring = tostring_f, __call = value_f }
local mt_r = { __index = { __lpdftype__ = "reference"  }, __tostring = tostring_r, __call = value_r }
local mt_v = { __index = { __lpdftype__ = "verbose"    }, __tostring = tostring_v, __call = value_v }
local mt_l = { __index = { __lpdftype__ = "literal"    }, __tostring = tostring_l, __call = value_l }

local function pdfstream(t) -- we need to add attributes
    if t then
        local tt = type(t)
        if tt == "table" then
            for i=1,#t do
                t[i] = tostring(t[i])
            end
        elseif tt == "string" then
            t = { t }
        else
            t = { tostring(t) }
        end
    end
    return setmetatable(t or { },mt_x)
end

local function pdfdictionary(t)
    return setmetatable(t or { },mt_d)
end

local function pdfarray(t)
    if type(t) == "string" then
        return setmetatable({ t },mt_a)
    else
        return setmetatable(t or { },mt_a)
    end
end

local function pdfstring(str,default)
    return setmetatable({ str or default or "" },mt_s)
end

local function pdfdocstring(str,default,defaultchar)
    return setmetatable({ str or default or "", defaultchar or " " },mt_p)
end

local function pdfunicode(str,default)
    return setmetatable({ str or default or "" },mt_u) -- could be a string
end

local function pdfliteral(str,hex) -- can also produce a hex <> instead of () literal
    return setmetatable({ str, hex },mt_l)
end

local pdfnumber, pdfconstant

do

    local cache = { } -- can be weak

    pdfnumber = function(n,default) -- 0-10
        if not n then
            n = default
        end
        local c = cache[n]
        if not c then
            c = setmetatable({ n },mt_n)
        --  cache[n] = c -- too many numbers
        end
        return c
    end

    for i=-1,9 do cache[i] = pdfnumber(i) end

    local replacer = S("\0\t\n\r\f ()[]{}/%%#\\") / {
        ["\00"]="#00",
        ["\09"]="#09",
        ["\10"]="#0a",
        ["\12"]="#0c",
        ["\13"]="#0d",
        [ " " ]="#20",
        [ "#" ]="#23",
        [ "%" ]="#25",
        [ "(" ]="#28",
        [ ")" ]="#29",
        [ "/" ]="#2f",
        [ "[" ]="#5b",
        [ "\\"]="#5c",
        [ "]" ]="#5d",
        [ "{" ]="#7b",
        [ "}" ]="#7d",
    } + P(1)

    local escaped = Cs(Cc("/") * replacer^0)

    local cache = table.setmetatableindex(function(t,k)
        local v = setmetatable({ lpegmatch(escaped,k) }, mt_c)
        t[k] = v
        return v
    end)

    pdfconstant = function(str,default)
        if not str then
            str = default or "none"
        end
        return cache[str]
    end

    local escaped = Cs(replacer^0)

    function lpdf.escaped(str)
        return lpegmatch(escaped,str) or str
    end

end

local pdfnull, pdfboolean, pdfreference, pdfverbose

do

    local p_null  = { } setmetatable(p_null, mt_z)
    local p_true  = { } setmetatable(p_true, mt_t)
    local p_false = { } setmetatable(p_false,mt_f)

    pdfnull = function()
        return p_null
    end

    pdfboolean = function(b,default)
        if type(b) == "boolean" then
            return b and p_true or p_false
        else
            return default and p_true or p_false
        end
    end

    -- print(pdfboolean(false),pdfboolean(false,false),pdfboolean(false,true))
    -- print(pdfboolean(true),pdfboolean(true,false),pdfboolean(true,true))
    -- print(pdfboolean(nil,true),pdfboolean(nil,false))

    local r_zero = setmetatable({ 0 },mt_r)

    pdfreference = function(r)  -- maybe make a weak table
        if r and r ~= 0 then
            return setmetatable({ r },mt_r)
        else
            return r_zero
        end
    end

    local v_zero  = setmetatable({ 0  },mt_v)
    local v_empty = setmetatable({ "" },mt_v)

    pdfverbose = function(t) -- maybe check for type
        if t == 0 then
            return v_zero
        elseif t == "" then
            return v_empty
        else
            return setmetatable({ t },mt_v)
        end
    end

end

lpdf.stream      = pdfstream -- THIS WILL PROBABLY CHANGE
lpdf.dictionary  = pdfdictionary
lpdf.array       = pdfarray
lpdf.docstring   = pdfdocstring
lpdf.string      = pdfstring
lpdf.unicode     = pdfunicode
lpdf.number      = pdfnumber
lpdf.constant    = pdfconstant
lpdf.null        = pdfnull
lpdf.boolean     = pdfboolean
lpdf.reference   = pdfreference
lpdf.verbose     = pdfverbose
lpdf.literal     = pdfliteral

-- three priority levels, default=2

local pagefinalizers     = { { }, { }, { } }
local documentfinalizers = { { }, { }, { } }

local pageresources, pageattributes, pagesattributes

local function resetpageproperties()
    pageresources   = pdfdictionary()
    pageattributes  = pdfdictionary()
    pagesattributes = pdfdictionary()
end

function lpdf.getpageproperties()
    return {
        pageresources   = pageresources,
        pageattributes  = pageattributes,
        pagesattributes = pagesattributes,
    }
end

resetpageproperties()

local function addtopageresources  (k,v) pageresources  [k] = v end
local function addtopageattributes (k,v) pageattributes [k] = v end
local function addtopagesattributes(k,v) pagesattributes[k] = v end

lpdf.addtopageresources   = addtopageresources
lpdf.addtopageattributes  = addtopageattributes
lpdf.addtopagesattributes = addtopagesattributes

local function set(where,what,f,when,comment)
    if type(when) == "string" then
        when, comment = 2, when
    elseif not when then
        when = 2
    end
    local w = where[when]
    w[#w+1] = { f, comment }
    if trace_finalizers then
        report_finalizing("%s set: [%s,%s]",what,when,#w)
    end
end

local function run(where,what)
    if trace_finalizers then
        report_finalizing("start backend, category %a, n %a",what,#where)
    end
    for i=1,#where do
        local w = where[i]
        for j=1,#w do
            local wj = w[j]
            if trace_finalizers then
                report_finalizing("%s finalizer: [%s,%s] %s",what,i,j,wj[2] or "")
            end
            wj[1]()
        end
    end
    if trace_finalizers then
        report_finalizing("stop finalizing")
    end
end

local function registerpagefinalizer(f,when,comment)
    set(pagefinalizers,"page",f,when,comment)
end

local function registerdocumentfinalizer(f,when,comment)
    set(documentfinalizers,"document",f,when,comment)
end

lpdf.registerpagefinalizer     = registerpagefinalizer
lpdf.registerdocumentfinalizer = registerdocumentfinalizer

function lpdf.finalizepage(shipout)
    if shipout and not environment.initex then
     -- resetpageproperties() -- maybe better before
        run(pagefinalizers,"page")
        resetpageproperties() -- maybe better before
    end
end

function lpdf.finalizedocument()
    if not environment.initex then
        run(documentfinalizers,"document")
        function lpdf.finalizedocument()
         -- report_finalizing("serious error: the document is finalized multiple times")
            function lpdf.finalizedocument() end
        end
    end
end

callbacks.register("finish_pdfpage", lpdf.finalizepage)
callbacks.register("finish_pdffile", lpdf.finalizedocument)

do

    -- some minimal tracing, handy for checking the order

    local function trace_set(what,key)
        if trace_resources then
            report_finalizing("setting key %a in %a",key,what)
        end
    end

    local function trace_flush(what)
        if trace_resources then
            report_finalizing("flushing %a",what)
        end
    end

    lpdf.protectresources = true

    local catalog = pdfdictionary { Type = pdfconstant("Catalog") } -- nicer, but when we assign we nil the Type
    local info    = pdfdictionary { Type = pdfconstant("Info")    } -- nicer, but when we assign we nil the Type
    ----- names   = pdfdictionary { Type = pdfconstant("Names")   } -- nicer, but when we assign we nil the Type

    local function checkcatalog()
        if not environment.initex then
            trace_flush("catalog")
            return true
        end
    end

    local function checkinfo()
        if not environment.initex then
            trace_flush("info")
            if lpdf.majorversion() > 1 then
                for k, v in next, info do
                    if k == "CreationDate" or k == "ModDate" then
                        -- mandate >= 2.0
                    else
                        info[k] = nil
                    end
                end
            end
            return true
        end
    end

    local function flushcatalog()
        if checkcatalog() then
            catalog.Type = nil
--             pdfsetcatalog(catalog())
        end
    end

    local function flushinfo()
        if checkinfo() then
            info.Type = nil
        end
    end

    function lpdf.getcatalog()
        if checkcatalog() then
            catalog.Type = pdfconstant("Catalog")
            return pdfreference(pdfimmediateobject(tostring(catalog)))
        end
    end

    function lpdf.getinfo()
        if checkinfo() then
            return pdfreference(pdfimmediateobject(tostring(info)))
        end
    end

    function lpdf.addtocatalog(k,v)
        if not (lpdf.protectresources and catalog[k]) then
            trace_set("catalog",k)
            catalog[k] = v
        end
    end

    function lpdf.addtoinfo(k,v)
        if not (lpdf.protectresources and info[k]) then
            trace_set("info",k)
            info[k] = v
        end
    end

    local names = pdfdictionary {
     -- Type = pdfconstant("Names")
    }

    local function flushnames()
        if next(names) and not environment.initex then
            names.Type = pdfconstant("Names")
            trace_flush("names")
            lpdf.addtocatalog("Names",pdfreference(pdfimmediateobject(tostring(names))))
        end
    end

    function lpdf.addtonames(k,v)
        if not (lpdf.protectresources and names[k]) then
            trace_set("names",  k)
            names  [k] = v
        end
    end

    local r_extgstates, r_colorspaces, r_patterns, r_shades
    local d_extgstates, d_colorspaces, d_patterns, d_shades
    local p_extgstates, p_colorspaces, p_patterns, p_shades

    local function checkextgstates () if d_extgstates  then addtopageresources("ExtGState", p_extgstates ) end end
    local function checkcolorspaces() if d_colorspaces then addtopageresources("ColorSpace",p_colorspaces) end end
    local function checkpatterns   () if d_patterns    then addtopageresources("Pattern",   p_patterns   ) end end
    local function checkshades     () if d_shades      then addtopageresources("Shading",   p_shades     ) end end

    local function flushextgstates () if d_extgstates  then trace_flush("extgstates")  pdfimmediateobject(r_extgstates, tostring(d_extgstates )) end end
    local function flushcolorspaces() if d_colorspaces then trace_flush("colorspaces") pdfimmediateobject(r_colorspaces,tostring(d_colorspaces)) end end
    local function flushpatterns   () if d_patterns    then trace_flush("patterns")    pdfimmediateobject(r_patterns,   tostring(d_patterns   )) end end
    local function flushshades     () if d_shades      then trace_flush("shades")      pdfimmediateobject(r_shades,     tostring(d_shades     )) end end

    -- patterns are special as they need resources to so we can get recursive references and in that case
    -- acrobat doesn't show anything (other viewers handle it well)
    --
    -- todo: share them
    -- todo: force when not yet set

    local pdfgetfontobjectnumber

    updaters.register("backend.update.lpdf",function()
        pdfgetfontobjectnumber = lpdf.getfontobjectnumber
    end)

    local f_font = formatters["%s%d"]

    function lpdf.collectedresources(options)
        local ExtGState  = d_extgstates  and next(d_extgstates ) and p_extgstates
        local ColorSpace = d_colorspaces and next(d_colorspaces) and p_colorspaces
        local Pattern    = d_patterns    and next(d_patterns   ) and p_patterns
        local Shading    = d_shades      and next(d_shades     ) and p_shades
        local Font
        if options and options.patterns == false then
            Pattern = nil
        end
        local fonts = options and options.fonts
        if fonts and next(fonts) then
            local prefix = options.fontprefix or "F"
            Font = pdfdictionary { }
            for k, v in sortedhash(fonts) do
                Font[f_font(prefix,v)] = pdfreference(pdfgetfontobjectnumber(k))
            end
        end
        if ExtGState or ColorSpace or Pattern or Shading or Font then
            local collected = pdfdictionary {
                ExtGState  = ExtGState,
                ColorSpace = ColorSpace,
                Pattern    = Pattern,
                Shading    = Shading,
                Font       = Font,
            }
            if options and options.serialize == false then
                return collected
            else
                return collected()
            end
        elseif options and options.notempty then
            return nil
        elseif options and options.serialize == false then
            return pdfdictionary { }
        else
            return ""
        end
    end

    function lpdf.adddocumentextgstate (k,v)
        if not d_extgstates then
            r_extgstates = pdfreserveobject()
            d_extgstates = pdfdictionary()
            p_extgstates = pdfreference(r_extgstates)
        end
        d_extgstates[k] = v
    end

    function lpdf.adddocumentcolorspace(k,v)
        if not d_colorspaces then
            r_colorspaces = pdfreserveobject()
            d_colorspaces = pdfdictionary()
            p_colorspaces = pdfreference(r_colorspaces)
        end
        d_colorspaces[k] = v
    end

    function lpdf.adddocumentpattern(k,v)
        if not d_patterns then
            r_patterns = pdfreserveobject()
            d_patterns = pdfdictionary()
            p_patterns = pdfreference(r_patterns)
        end
        d_patterns[k] = v
    end

    function lpdf.adddocumentshade(k,v)
        if not d_shades then
            r_shades = pdfreserveobject()
            d_shades = pdfdictionary()
            p_shades = pdfreference(r_shades)
        end
        d_shades[k] = v
    end

    registerdocumentfinalizer(flushextgstates,3,"extended graphic states")
    registerdocumentfinalizer(flushcolorspaces,3,"color spaces")
    registerdocumentfinalizer(flushpatterns,3,"patterns")
    registerdocumentfinalizer(flushshades,3,"shades")

    registerdocumentfinalizer(flushnames,3,"names") -- before catalog
    registerdocumentfinalizer(flushcatalog,3,"catalog")
    registerdocumentfinalizer(flushinfo,3,"info")

    registerpagefinalizer(checkextgstates,3,"extended graphic states")
    registerpagefinalizer(checkcolorspaces,3,"color spaces")
    registerpagefinalizer(checkpatterns,3,"patterns")
    registerpagefinalizer(checkshades,3,"shades")

end

-- in strc-bkm: lpdf.registerdocumentfinalizer(function() structures.bookmarks.place() end,1)

function lpdf.rotationcm(a)
    local s = sind(a)
    local c = cosd(a)
    return format("%.6F %.6F %.6F %.6F 0 0 cm",c,s,-s,c)
end

-- ! -> universaltime

do

    -- It's a bit of a historical mess here.

    local osdate, ostime, ostimezone = os.date, os.time, os.timezone

    local metadata  = nil
    local timestamp = osdate("%Y-%m-%dT%X") .. ostimezone(true)

    function lpdf.getmetadata()
        if not metadata then
            local contextversion      = environment.version
            local luatexversion       = format("%1.2f",LUATEXVERSION)
            local luatexfunctionality = tostring(LUATEXFUNCTIONALITY)
            metadata = {
                producer            = format("LuaTeX-%s",luatexversion),
                creator             = format("LuaTeX %s %s + ConTeXt MkIV %s",luatexversion,luatexfunctionality,contextversion),
                luatexversion       = luatexversion,
                contextversion      = contextversion,
                luatexfunctionality = luatexfunctionality,
                luaversion          = tostring(LUAVERSION),
                platform            = os.platform,
                time                = timestamp,
            }
        end
        return metadata
    end

    function lpdf.settime(n)
        if n then
            n = converters.totime(n)
            if n then
                converters.settime(n)
                timestamp = osdate("%Y-%m-%dT%X") .. ostimezone(true) -- probably not ok
            end
        end
        if metadata then
            metadata.time = timestamp
        end
        return timestamp
    end

    lpdf.settime(tonumber(resolvers.variable("start_time")) or tonumber(resolvers.variable("SOURCE_DATE_EPOCH"))) -- bah

    function lpdf.pdftimestamp(str)
        local t = type(str)
        if t == "string" then
            local Y, M, D, h, m, s, Zs, Zh, Zm = match(str,"^(%d%d%d%d)%-(%d%d)%-(%d%d)T(%d%d):(%d%d):(%d%d)([%+%-])(%d%d):(%d%d)$")
            return Y and format("D:%s%s%s%s%s%s%s%s'%s'",Y,M,D,h,m,s,Zs,Zh,Zm)
        else
            return osdate("D:%Y%m%d%H%M%S",t == "number" and str or ostime()) -- maybe "!D..." : universal time
        end
    end

    function lpdf.id(date)
        local banner = environment.jobname or tex.jobname or "unknown"
        if not date then
            return banner
        else
            return format("%s | %s",banner,timestamp)
        end
    end

end

-- return nil is nicer in test prints

function lpdf.checkedkey(t,key,variant)
    local pn = t and t[key]
    if pn ~= nil then
        local tn = type(pn)
        if tn == variant then
            if variant == "string" then
                if pn ~= "" then
                    return pn
                end
            elseif variant == "table" then
                if next(pn) then
                    return pn
                end
            else
                return pn
            end
        elseif tn == "string" then
            if variant == "number" then
                return tonumber(pn)
            elseif variant == "boolean" then
                return isboolean(pn,nil,true)
            end
        end
    end
 -- return nil
end

function lpdf.checkedvalue(value,variant) -- code not shared
    if value ~= nil then
        local tv = type(value)
        if tv == variant then
            if variant == "string" then
                if value ~= "" then
                    return value
                end
            elseif variant == "table" then
                if next(value) then
                    return value
                end
            else
                return value
            end
        elseif tv == "string" then
            if variant == "number" then
                return tonumber(value)
            elseif variant == "boolean" then
                return isboolean(value,nil,true)
            end
        end
    end
end

function lpdf.limited(n,min,max,default)
    if not n then
        return default
    else
        n = tonumber(n)
        if not n then
            return default
        elseif n > max then
            return max
        elseif n < min then
            return min
        else
            return n
        end
    end
end

-- The next variant of ActualText is what Taco and I could come up with
-- eventually. As of September 2013 Acrobat copies okay, Sumatra copies a
-- question mark, pdftotext injects an extra space and Okular adds a
-- newline plus space.

-- return formatters["BT /Span << /ActualText (CONTEXT) >> BDC [<feff>] TJ % t EMC ET"](code)

do

    local f_actual_text_p     = formatters["BT /Span << /ActualText <feff%s> >> BDC %s EMC ET"]
    local f_actual_text_b     = formatters["BT /Span << /ActualText <feff%s> >> BDC"]
    local s_actual_text_e     = "EMC ET"
    local f_actual_text_b_not = formatters["/Span << /ActualText <feff%s> >> BDC"]
    local s_actual_text_e_not = "EMC"
    local f_actual_text       = formatters["/Span <</ActualText %s >> BDC"]

    local context   = context
    local pdfdirect = nodes.pool.directliteral -- we can use nuts.write deep down
    local tounicode = fonts.mappings.tounicode

    function codeinjections.unicodetoactualtext(unicode,pdfcode)
        return f_actual_text_p(type(unicode) == "string" and unicode or tounicode(unicode),pdfcode)
    end

    function codeinjections.startunicodetoactualtext(unicode)
        return f_actual_text_b(type(unicode) == "string" and unicode or tounicode(unicode))
    end

    function codeinjections.stopunicodetoactualtext()
        return s_actual_text_e
    end

    function codeinjections.startunicodetoactualtextdirect(unicode)
        return f_actual_text_b_not(type(unicode) == "string" and unicode or tounicode(unicode))
    end

    function codeinjections.stopunicodetoactualtextdirect()
        return s_actual_text_e_not
    end

    implement {
        name      = "startactualtext",
        arguments = "string",
        actions   = function(str)
            context(pdfdirect(f_actual_text(tosixteen(str))))
        end
    }

    implement {
        name      = "stopactualtext",
        actions   = function()
            context(pdfdirect("EMC"))
        end
    }

    local setstate  = nodes.nuts.pool.setstate

    function nodeinjections.startalternate(str)
        return setstate(f_actual_text(tosixteen(str)))
    end

    function nodeinjections.stopalternate()
        return setstate("EMC")
    end


end

-- interface

implement { name = "lpdf_collectedresources",                             actions = { lpdf.collectedresources, context } }
implement { name = "lpdf_addtocatalog",          arguments = "2 strings", actions = lpdf.addtocatalog }
implement { name = "lpdf_addtoinfo",             arguments = "2 strings", actions = function(a,b,c) lpdf.addtoinfo(a,b,c) end } -- gets adapted
implement { name = "lpdf_addtonames",            arguments = "2 strings", actions = lpdf.addtonames }
implement { name = "lpdf_addtopageattributes",   arguments = "2 strings", actions = lpdf.addtopageattributes }
implement { name = "lpdf_addtopagesattributes",  arguments = "2 strings", actions = lpdf.addtopagesattributes }
implement { name = "lpdf_addtopageresources",    arguments = "2 strings", actions = lpdf.addtopageresources }
implement { name = "lpdf_adddocumentextgstate",  arguments = "2 strings", actions = function(a,b) lpdf.adddocumentextgstate (a,pdfverbose(b)) end }
implement { name = "lpdf_adddocumentcolorspace", arguments = "2 strings", actions = function(a,b) lpdf.adddocumentcolorspace(a,pdfverbose(b)) end }
implement { name = "lpdf_adddocumentpattern",    arguments = "2 strings", actions = function(a,b) lpdf.adddocumentpattern   (a,pdfverbose(b)) end }
implement { name = "lpdf_adddocumentshade",      arguments = "2 strings", actions = function(a,b) lpdf.adddocumentshade     (a,pdfverbose(b)) end }

-- more helpers: copy from lepd to lpdf

function lpdf.copyconstant(v)
    if v ~= nil then
        return pdfconstant(v)
    end
end

function lpdf.copyboolean(v)
    if v ~= nil then
        return pdfboolean(v)
    end
end

function lpdf.copyunicode(v)
    if v then
        return pdfunicode(v)
    end
end

function lpdf.copyarray(a)
    if a then
        local t = pdfarray()
        for i=1,#a do
            t[i] = a(i)
        end
        return t
    end
end

function lpdf.copydictionary(d)
    if d then
        local t = pdfdictionary()
        for k, v in next, d do
            t[k] = d(k)
        end
        return t
    end
end

function lpdf.copynumber(v)
    return v
end

function lpdf.copyinteger(v)
    return v -- maybe checking or round ?
end

function lpdf.copyfloat(v)
    return v
end

function lpdf.copystring(v)
    if v then
        return pdfstring(v)
    end
end

do

    -- This is obsolete but old viewers might still use it as directive
    -- for what to send to a postscript printer.

    local a_procset, d_procset

    function lpdf.procset(dict)
        if not a_procset then
            a_procset = pdfarray {
                pdfconstant("PDF"),
                pdfconstant("Text"),
                pdfconstant("ImageB"),
                pdfconstant("ImageC"),
                pdfconstant("ImageI"),
            }
            a_procset = pdfreference(pdfimmediateobject(tostring(a_procset)))
        end
        if dict then
            if not d_procset then
                d_procset = pdfdictionary {
                    ProcSet = a_procset
                }
                d_procset = pdfreference(pdfimmediateobject(tostring(d_procset)))
            end
            return d_procset
        else
            return a_procset
        end
    end

end

From j.hagen at xs4all.nl  Tue Feb  9 19:49:18 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Tue, 9 Feb 2021 19:49:18 +0100
Subject: [dev-context] lpdf-ini.lmt: lpdf.tosixteen(),
 wrong conversion to UTF-16BE
In-Reply-To: <C95706QWSQU0.35NM7EZO0FSQS@phobos>
References: <C95706QWSQU0.35NM7EZO0FSQS@phobos>
Message-ID: <5d559b45-dfd1-0737-d739-d5f96888fd3c@xs4all.nl>

On 2/9/2021 6:57 PM, Michal VlasÃ¡k wrote:
> Hello,
> 
> conversion to UTF-16BE PDF strings used for example in bookmarks / PDF
> outlines is not right.
> 
> Take the following example:
> 
> ```
> \starttext
> \setupinteraction[state=start]
> \placebookmarks[section][number=no]
> 
> \section[bookmark=ð]
> 
> \stoptext
> ```
> 
> Produces: <FEFF0075DD44> for ð (U+1D544), instead of the correct
> <FEFFD835DD44>.
> 
> 
> The relevant function is `lpdf.tosixteen()` (from lpdf-ini.lmt), and its
> `cache`. (Although the same function is also in lpdf-aux.lmt, and in
> MkIV equivalents).
> 
> My proposal (also enclosed as a file attachment):
> 
> ```
> --- a/lpdf-ini.lmt
> +++ b/lpdf-ini.lmt
> @@ -178,7 +178,8 @@
>           if v < 0x10000 then
>               v = format("%04x",v)
>           else
> -            v = format("%04x%04x",rshift(v,10),v%1024+0xDC00)
> +            v = v - 0x10000
> +            v = format("%04x%04x",rshift(v,10)+0xD800,v%1024+0xDC00)
>           end
>           t[k] = v
>           return v
> ```
> 
> (Note the similiarity to existing function `big()` in l-unicode.lua.)
> 
> I found this by chance, but I am not really a ConTeXt user, so I hope
> didn't miss anything.
Thanks for noticing (btw, the aux file is used on some scripts, not in 
context itself).

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From lahcim8 at gmail.com  Fri Feb 12 21:34:25 2021
From: lahcim8 at gmail.com (=?utf-8?q?Michal_Vlas=C3=A1k?=)
Date: Fri, 12 Feb 2021 21:34:25 +0100
Subject: [dev-context] lpdf-ini.lmt: lpdf.tosixteen(),
 wrong conversion to UTF-16BE
In-Reply-To: <5d559b45-dfd1-0737-d739-d5f96888fd3c@xs4all.nl>
Message-ID: <C97U862YHMAN.1WMWGUJVWLXFJ@phobos>

On Tue Feb 9, 2021 at 7:49 PM CET, Hans Hagen wrote:
> On 2/9/2021 6:57 PM, Michal VlasÃ¡k wrote:
> > Hello,
> > 
> > conversion to UTF-16BE PDF strings used for example in bookmarks / PDF
> > outlines is not right.
> > 
> > Take the following example:
> > 
> > ```
> > \starttext
> > \setupinteraction[state=start]
> > \placebookmarks[section][number=no]
> > 
> > \section[bookmark=ð]
> > 
> > \stoptext
> > ```
> > 
> > Produces: <FEFF0075DD44> for ð (U+1D544), instead of the correct
> > <FEFFD835DD44>.
> > 
> > 
> > The relevant function is `lpdf.tosixteen()` (from lpdf-ini.lmt), and its
> > `cache`. (Although the same function is also in lpdf-aux.lmt, and in
> > MkIV equivalents).
> > 
> > My proposal (also enclosed as a file attachment):
> > 
> > ```
> > --- a/lpdf-ini.lmt
> > +++ b/lpdf-ini.lmt
> > @@ -178,7 +178,8 @@
> >           if v < 0x10000 then
> >               v = format("%04x",v)
> >           else
> > -            v = format("%04x%04x",rshift(v,10),v%1024+0xDC00)
> > +            v = v - 0x10000
> > +            v = format("%04x%04x",rshift(v,10)+0xD800,v%1024+0xDC00)
> >           end
> >           t[k] = v
> >           return v
> > ```
> > 
> > (Note the similiarity to existing function `big()` in l-unicode.lua.)
> > 
> > I found this by chance, but I am not really a ConTeXt user, so I hope
> > didn't miss anything.
>
> Thanks for noticing (btw, the aux file is used on some scripts, not in
> context itself).
>
> Hans

Unfortunately the version in latest LMTX is still not right. The
subtraction of 0x10000 is really needed, at least for the high
surrogate. (Note how the number is added back in the inverse function
`lpdf.fromsixteen()`.)

My other suggestion, which does the subtraction only for one surrogate
is below.

(Although I prefer my first suggestion, quoted above, which seems more
clear - from number in range 0x10000 - 0x10FFFF subtract 0x10000, which
makes it a number in range 0x0 - 0xFFFFF, a 20 bit number, the higher 10
bits are encoded into the higher surrogate (16 bits), by adding 0xD800
(so the remaining high 6 bits are 110110), and the lower 10 bits are
encoded into the lower surrogate by adding 0xDC00 (high 6 bits are
110111).)

Michal

--- a/lpdf-ini.lmt
+++ b/lpdf-ini.lmt
@@ -176,7 +176,7 @@
         if v < 0x10000 then
             v = format("%04x",v)
         else
-            v = format("%04x%04x",rshift(v,10)+0xD800,v%1024+0xDC00)
+            v = format("%04x%04x",rshift(v-0x10000,10)+0xD800,v%1024+0xDC00)
         end
         t[k] = v
         return v

From j.hagen at xs4all.nl  Sat Feb 13 11:55:45 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sat, 13 Feb 2021 11:55:45 +0100
Subject: [dev-context] lpdf-ini.lmt: lpdf.tosixteen(),
 wrong conversion to UTF-16BE
In-Reply-To: <C97U862YHMAN.1WMWGUJVWLXFJ@phobos>
References: <C97U862YHMAN.1WMWGUJVWLXFJ@phobos>
Message-ID: <c1b19208-ec3f-3ac3-30fa-69f9a2affe9a@xs4all.nl>

Hi,

>>> +            v = v - 0x10000

ah, i hadn't noted that line (btw, in the file there is a remark where i 
add the 0x10000 that it is inconsistent so i should have looked into it 
then, sigh)

> My other suggestion, which does the subtraction only for one surrogate
> is below.

btw, performance wise the separate step is the same as doing it in the 
one liner (lua does all via the stack so in general using intermediate 
steps assiging to (here v) is often quite ok)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From modules at contextgarden.net  Tue Mar  2 04:43:14 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Tue, 2 Mar 2021 04:43:14 +0100
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.03.01 published.
Message-ID: <20210302034314.10318281178@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.03.01
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Fix a regression of issue #37. At some stage, I made a mistake in merging a feature branch and overwrote the changes in the bugfix 3ea3bef9. Reapplying these changes.

Closes issue #42.

----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 04:10:33 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 04:10:33 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314031033.09F4F2817A9@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: no

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------

Minor changes to use proper ConTeXt syntax. Small additions and a proper manual

----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 05:40:20 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 05:40:20 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314044020.259572817D2@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------

There was a typo in the manual and it was corrected. No additional changes have been made.

----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 05:43:30 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 05:43:30 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314044330.D82D02817D4@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------



----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 16:23:23 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 16:23:23 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314152323.BEC3A28181C@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------



----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 16:26:56 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 16:26:56 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314152656.A720E281815@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------



----------------------------------------------------------------------


From modules at contextgarden.net  Sun Mar 14 16:29:06 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 14 Mar 2021 16:29:06 +0100
Subject: [dev-context] CGModules update: metaducks version 2021-3-13
 published.
Message-ID: <20210314152906.A08CF281820@zapf.ntg.nl>

Jairo A. del Rio submitted an update to the

               metaducks

package.

Version number: 2021-3-13
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Ducks for ConTeXt!

Announcement text:
----------------------------------------------------------------------



----------------------------------------------------------------------


From taco at bittext.nl  Thu Apr  1 16:55:10 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Thu, 1 Apr 2021 16:55:10 +0200
Subject: [dev-context] README for pending new subscribers  March 2021
Message-ID: <38EFFCD7-7E44-43D0-9632-E025489C8670@bittext.nl>

Hi all,

Regretfully, we have had problems with a hacker messing with the html subscription page of this mailing list. In mitigation, we have disabled web - based subscription requests completely. 

From now on, subscription to this mailing list can only be requested by sending an email message to dev-context-request at ntg.nlwith âsubscribe" as the Subject.

Unfortunately, it was impossible for us to differentiate between "hacked" and âlegitâ subscription requests made during the month of March 2021 so to prevent our mail server from being blacklisted as email sender we have had to discard all pending subscription requests. 

This means that anyone that has tried to subscribe to dev-context during the past month (that has not received a confirmation message from mailman welcoming them to the mailing list) will have to re-start the subscription process. 

Apologetically,
Taco

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From modules at contextgarden.net  Thu Apr 22 02:28:56 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Thu, 22 Apr 2021 02:28:56 +0200
Subject: [dev-context] CGModules new: sudoku version 2021-04-21 published.
Message-ID: <20210422002856.DB6AA282AC2@zapf.ntg.nl>

Jairo A. del Rio submitted the new

               sudoku

package.

Version number: 2021-04-21
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Sudokus for ConTeXt!

Announcement text:
----------------------------------------------------------------------

A port of Peter Norvig's sudoku solver to Lua/ConTeXt. It provides four basic commands for typesetting sudokus, as well as a command handler.

----------------------------------------------------------------------


From goughostt at gmail.com  Mon May 10 15:54:07 2021
From: goughostt at gmail.com (Gou Lingfeng)
Date: Mon, 10 May 2021 21:54:07 +0800
Subject: [dev-context] multi-page text background bug
In-Reply-To: <CACY3pWO-4SrDfRanj+-9Q4VZ9fEcsVtXx_CckohtRSYYi=Of=w@mail.gmail.com>
References: <CACY3pWO-4SrDfRanj+-9Q4VZ9fEcsVtXx_CckohtRSYYi=Of=w@mail.gmail.com>
Message-ID: <CACY3pWNy0b1BOAT-6e4TxyKrgL82q5RnhNb9g2Ah0m=UA+1_+w@mail.gmail.com>

Example:
------
\definetextbackground[undeftext][location=text,alternative=1,dash=3,background=,frame=off,voffset=-.5ex]

\starttext
Hello \starttextbackground[undeftext]
world!
\page

bbb.

\page
ccc.
\stoptextbackground
\stoptext
------

Proposed patch:
------
--- tex/texmf-context/tex/context/base/mkxl/anch-pgr.lmt.bak 2021-05-07
12:19:30.951643997 -0500
+++ tex/texmf-context/tex/context/base/mkxl/anch-pgr.lmt 2021-05-07
12:19:44.716693548 -0500
@@ -123,6 +123,9 @@
     local ht    = specification.ht
     local dp    = specification.dp
     -- this is not yet r2l ready
+-- myfix
+realpage=texgetcount("realpageno")
+-- end
     local w = d.shapes[realpage]
     local x, y = getpos()
     if trace_ranges then
------

The module-local variable `realpage` is never changed, which is apparently
a bug.

Best,
GOU Lingfeng
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210510/5ed08a57/attachment.htm>

From j.hagen at xs4all.nl  Mon May 10 19:27:08 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Mon, 10 May 2021 19:27:08 +0200
Subject: [dev-context] multi-page text background bug
In-Reply-To: <CACY3pWNy0b1BOAT-6e4TxyKrgL82q5RnhNb9g2Ah0m=UA+1_+w@mail.gmail.com>
References: <CACY3pWO-4SrDfRanj+-9Q4VZ9fEcsVtXx_CckohtRSYYi=Of=w@mail.gmail.com>
 <CACY3pWNy0b1BOAT-6e4TxyKrgL82q5RnhNb9g2Ah0m=UA+1_+w@mail.gmail.com>
Message-ID: <c55c578d-1a99-673e-b5d5-8cbdb2b6583b@xs4all.nl>

On 5/10/2021 3:54 PM, Gou Lingfeng wrote:
> Example:
> ------
> \definetextbackground[undeftext][location=text,alternative=1,dash=3,background=,frame=off,voffset=-.5ex]
> 
> \starttext
> Hello \starttextbackground[undeftext]
> world!
> \page
> 
> bbb.
> 
> \page
> ccc.
> \stoptextbackground
> \stoptext
> ------
> 
> Proposed patch:
> ------
> --- tex/texmf-context/tex/context/base/mkxl/anch-pgr.lmt.bak 2021-05-07 
> 12:19:30.951643997 -0500
> +++ tex/texmf-context/tex/context/base/mkxl/anch-pgr.lmt 2021-05-07 
> 12:19:44.716693548 -0500
> @@ -123,6 +123,9 @@
>  Â  Â  Â local ht Â  Â = specification.ht <http://specification.ht>
>  Â  Â  Â local dp Â  Â = specification.dp
>  Â  Â  Â -- this is not yet r2l ready
> +-- myfix
> +realpage=texgetcount("realpageno")
> +-- end
>  Â  Â  Â local w = d.shapes[realpage]
>  Â  Â  Â local x, y = getpos()
>  Â  Â  Â if trace_ranges then
> ------
> 
> The module-local variable `realpage` is never changed, which is 
> apparently a bug.
actually it's something that got lost when the approach was change a bit 
.. i'll send you another patch to test

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From modules at contextgarden.net  Mon May 24 21:11:07 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 24 May 2021 21:11:07 +0200
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.05.24 published.
Message-ID: <20210524191107.CF9EC283C1E@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.05.24
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Bugfix release: 

* Fixes a bug where `--` was being translated to `ÃÂ¢ÃÂÃÂ` in LMTX. The fix involved
  creating a new version of `syntax-highlighting` module for LMTX. The
  hyphenation options haven't been translated to LMTX yet.

* Remove `--clean` flag from list of flags. This was introduced because an
  ealier version on neovim was still reading `.viminfo` files when called in
  `-i NONE`. However, the flag was added in the wrong location, so now custom
  `.vimrc` files were not being read (Reported and debugged by Nicola on the
  mailing list). Recent version of neovim seems to honor `-i NONE` option, so
  the `--clean` option was simply removed.

----------------------------------------------------------------------


From goughostt at gmail.com  Fri May 28 11:41:10 2021
From: goughostt at gmail.com (Gou Lingfeng)
Date: Fri, 28 May 2021 17:41:10 +0800
Subject: [dev-context] bug: space before \stoptextbackground is lost
Message-ID: <CACY3pWNaSjOy+WzhChzj+fLtsRYWu8sa4bra428LBLCv0hygLw@mail.gmail.com>

Example:
-----------------
\definetextbackground[placeholder][location=text,alternative=4]

\starttext

a.
\startcolor[red]%
b.
\stopcolor
c.
\starttextbackground[placeholder]%
d.
\stoptextbackground
e.
f.

\stoptext
-----------------

In the output, there is no space before "e" and there is a space before "c".

I'd expect spaces between neighbor sentences, whether textbackground is
used or not, just like the usage of startcolor.


Thanks,
GOU Lingfeng
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210528/1d60a4be/attachment.htm>

From modules at contextgarden.net  Tue Jun  1 04:53:25 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Tue, 1 Jun 2021 04:53:25 +0200
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.05.31 published.
Message-ID: <20210601025325.A1E8228405F@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.05.31
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Bugfix release: 

* Second attempt to fix a bug where `--` was being translated to `ÃÂ¢ÃÂÃÂ` in LMTX.
  Previous tests failed because I did not notice that `context --luatex` now
  invokes MKIV.

----------------------------------------------------------------------


From modules at contextgarden.net  Mon Jul  5 00:35:10 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 5 Jul 2021 00:35:10 +0200
Subject: [dev-context] CGModules new: Karnaugh version 1.0.0 published.
Message-ID: <20210704223510.5FBF52856D7@zapf.ntg.nl>

VicSanRoPe submitted the new

               Karnaugh

package.

Version number: 1.0.0
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: Draws Karnaugh maps

Announcement text:
----------------------------------------------------------------------

This is a ConTeXt module that draws Karnaugh maps containing data (ones, ceros, or anything) and their groupings, with easy to use syntax. It supports larger than four variable maps; and formulas, or any text, can be added.

----------------------------------------------------------------------


From modules at contextgarden.net  Fri Jul  9 02:52:24 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Fri, 9 Jul 2021 02:52:24 +0200
Subject: [dev-context] CGModules update: Karnaugh version 1.1.0 published.
Message-ID: <20210709005224.7444E285943@zapf.ntg.nl>

VicSanRoPe submitted an update to the

               Karnaugh

package.

Version number: 1.1.0
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: Draws Karnaugh maps

Announcement text:
----------------------------------------------------------------------

Added labelstyle=bars, this one doesn't show grey code.
Changed karnaugnote's arguments, they didn't match ConTeXt's style.
Changed the documentation's licence to CC, to match ConTeXt's

----------------------------------------------------------------------


From modules at contextgarden.net  Fri Jul  9 03:22:41 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Fri, 9 Jul 2021 03:22:41 +0200
Subject: [dev-context] CGModules update: Karnaugh version 1.1.1 published.
Message-ID: <20210709012241.75D6D285948@zapf.ntg.nl>

VicSanRoPe submitted an update to the

               Karnaugh

package.

Version number: 1.1.1
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: Draws Karnaugh maps

Announcement text:
----------------------------------------------------------------------

Fixed automatic labels and used new version for documentation

----------------------------------------------------------------------


From modules at contextgarden.net  Thu Jul 22 18:23:35 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Thu, 22 Jul 2021 18:23:35 +0200
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.07.22 published.
Message-ID: <20210722162335.07398285F82@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.07.22
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Bugfix release: 

* Fix a typo in t-vim. Vim uses `Conditional` as a group name, but `t-vim` was
  using `Condition`. As a result, conditions were not highlighted. Reported by
  A. Licari on TeX.SE

----------------------------------------------------------------------


From oinos at gmx.es  Sun Aug  8 20:04:19 2021
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 8 Aug 2021 20:04:19 +0200
Subject: [dev-context] two minor typos in workflows-hashed.tex
Message-ID: <87e9c4e5-a53c-084c-4d37-f2eab02b7c73@gmx.es>

Hans,

the diff file contains two corrections for two minor typos.

Just in case it might help,

Pablo
--
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minor-typos.diff
Type: text/x-patch
Size: 1119 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210808/34ae77e2/attachment.bin>

From wolfgang.schuster.lists at gmail.com  Mon Aug  9 18:10:05 2021
From: wolfgang.schuster.lists at gmail.com (Wolfgang Schuster)
Date: Mon, 9 Aug 2021 18:10:05 +0200
Subject: [dev-context] [NTG-context] Create an enumeration style
In-Reply-To: <CACyK-epjgPwOitRnz1uWNmaTWoD-g_LXhV=EfgcOQnuH4HT9NA@mail.gmail.com>
References: <CACyK-eoqFd1s_7TuGxU9AwYCr2tfvaYw7dHFTNGZasU3Anr2gg@mail.gmail.com>
 <3e22b50c-9fea-1e0d-14d3-722f08436298@gmail.com>
 <CACyK-epjgPwOitRnz1uWNmaTWoD-g_LXhV=EfgcOQnuH4HT9NA@mail.gmail.com>
Message-ID: <c3d58db4-001c-6bc1-0661-de3ed88e6481@gmail.com>

Fabrice Couvreur schrieb am 09.08.2021 um 14:16:
> Hi Wolfgang,
> Thank you for your suggestion.
> I tested the code and the result is not what I expected from the 
> second item : "2 exemple" instead of "2^{e} exemple", "3 exemple" 
> instead of "3^{e} exemple" ...

core-con.lua (line 1155):

local ordinals = {
 Â Â Â  [...]
 Â Â Â  french = function(n)
 Â Â Â Â Â Â Â  if n == 1 then
 Â Â Â Â Â Â Â Â Â Â Â  return "er"
+Â Â Â Â Â Â  else
+Â Â Â Â Â Â Â Â Â Â  return "e"
 Â Â Â Â Â Â Â  end
 Â Â Â  end,
}


> Then I tried to use the key alternative = serried but without success.

This works for me:

\defineenumeration
 Â  [test]
 Â  [text=,
 Â Â  alternative=serried,
 Â Â  width=fit,
 Â Â  distance=.5em,
 Â Â  numbercommand=\groupedcommand{}{~exemple},
 Â Â  numberconversion=ordinal]

\mainlanguage [fr]

\starttext

\starttest
\input knuth
\stoptest

\starttest
\input knuth
\stoptest

\stoptext

Wolfgang

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210809/ea9ba4a7/attachment.htm>

From modules at contextgarden.net  Wed Aug 25 04:43:22 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Wed, 25 Aug 2021 04:43:22 +0200
Subject: [dev-context] CGModules update: Filter version 2021.08.24 published.
Message-ID: <20210825024322.613A3286C6C@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               Filter

package.

Version number: 2021.08.24
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: A module to run external programs on the contents of start-stop evironment

Announcement text:
----------------------------------------------------------------------

Bugfix release.

The job.files.run macro had changed in LMTX, which caused any code using
`cache=yes` (including `t-vim` module) fail. Reported by Bruce Horrocks on the
ConTeXt mailing list. 

Adapted to the new job.files.run interface. In this release t-filter module is
now split into `t-filter.mkiv` and `t-filter.mkxlÃÂ¢ÃÂÃ
 The MkIV code is now in
bugfix only mode and future development will be concentrated on the LMTX code.

----------------------------------------------------------------------


From taco at bittext.nl  Fri Aug 27 13:24:38 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 27 Aug 2021 13:24:38 +0200
Subject: [dev-context] Fwd: [NTG-context] Indexing redux
References: <338559e1-98ac-3ccd-3409-e6744656119a@rik.users.panix.com>
Message-ID: <223FDF67-8140-4CA9-A47E-D28A80B28E98@bittext.nl>

Hi,

Iâll be happy to play around with extending the register code, assuming that is ok with Hans and that not someone else is also working on this?

Taco

> Begin forwarded message:
> 
> From: Rik Kabel via ntg-context <ntg-context at ntg.nl>
> Subject: Re: [NTG-context] Indexing redux
> Date: 26 August 2021 at 22:46:23 CEST
> To: mailing list for ConTeXt users <ntg-context at ntg.nl>
> Cc: Rik Kabel <ConTeXt at rik.users.panix.com>
> Reply-To: mailing list for ConTeXt users <ntg-context at ntg.nl>
> 
> 
> 
> On 8/26/2021 03:26, Taco Hoekwater wrote:
>> Hi Rik,
>> 
>>> On 26 Aug 2021, at 03:14, Rik Kabel via ntg-context <ntg-context at ntg.nl> <mailto:ntg-context at ntg.nl> wrote:
>>> 
>>> List,
>>> 
>>> I am trying to create an index with both "see" and "see also" cross-reference entries.[1] At this point, ConTeXt provides basic support for "see" entries via the \seeREGISTER command (it does not properly support references to sub-entries) and it provides no support at all for "see also" entries.
>>> 
>>> Can somebody suggest a way to generate these entries? Perhaps a way of inserting entries into the index before it is formatted, in the     manner of \writetolist or \writebetweenlist? (MkII has \writetoregister, but that did not carry forward and I do not know if it would have helped here.)
>> 
>> Since strc-reg.mkiv starts with a number of âtodoâ comments, I think your best bet is to create an
>> actual functional example along with an explanation of what you want the typeset result to look 
>> like in the cases where it is not doing what you want.
>> 
>> Generally, explicit examples / test files are the best way to get replies to questions 
>> (either by Hans or anyone else).
> The following produces what I am looking for, and a bit more. Page 3 of the output shows what I would like to see, page 4 is the generated index. I don't really need the "see under" and "see also under" variants, but they would be nice to have. I am indifferent to having stops before "see also"s. I would like to be able to turn checking on or off, so that generic directives (in the example, see also specific breeds) will not generate an error, while the Ford Prefect example will generate an error.
> 
> 
>    \defineprocessor[also][color=blue]
>    \defineprocessor[under][color=green]
>    \defineprocessor[alsounder][color=orange]
>    \define\seealsoindex\seeindex
>    \define\seealsounderindex\seeindex
>    \define\seeunderindex\seeindex
>    \setupinteraction [state=start]
>    \setupregister    [index][balance=no,check=no]
> 
> %% seeindex entries may start on the same line as their head entry
>    \seeindex         {dog breeds+Wiener dog}{dog breeds+Dachshund}
> %%  The next example should not work,
> %%    since there is no main entry /Adams, Douglas/
>    \seeindex         {Prefect, Ford}{Adams, Douglas}
> 
> %%  When referring to a subentry, the target must be a subentry,
> %%    but should display as if a main entry. The next example
> %%    should point to the /Adams+Douglas/ subentry, but it
> %%    should be formatted as if it were /Adams, Douglas/ 
>    \seeindex         {Dent, Arthur}{Adams+Douglas}
> 
> %% The following two work as expected
>    \seeindex         {Matilda effect}{obliteration}
>    \seeindex         {Marut, Ret}{Traven, B.}
> 
> %% seealso should be placed after as a subentry after real page references
> %% seealso should have an appropriate label (default English /see also/)
>    \seealsoindex     {pseudepigraphy}{also->obliteration}
>    \seealsoindex     {dog breeds}{also->breeding programs}
>    \seealsoindex     {dog breeds}{also->specific breeds}
> %% seealsounder is like seealso except that it refers to a main entry
>    \seealsounderindex{Coton de Tulear}{alsounder->dog breeds}
> %% seeunder also is like seealso except that it refers to a main entry
>    \seeunderindex    {Weimaraner}{under->dog breeds}
>    \starttext
>      Stuff
>      \index{obliteration}
>      \index{Adams+Douglas}\index{Adams+John}
>      \index{Beagle}
>      \index{dog breeds+Beagle}
>      \index{dog breeds+Coton de Tulear}
>      \index{dog breeds+Dachshund}
>      \index{dog breeds+Weimaraner}
>    \page
>      More stuff
>      \index{Adams+John Quincy}
>      \index{misquotation}
>      \index{pseudepigraphy}
>      \index{Traven, B.}
>      \index{Beagle}
>      \index{Coton de Tulear}
>      \index{breeding programs}
>    \page
>    \definedescription[Index][headstyle=bold,alternative=top,inbetween=]
>    \startIndex{a}
>      Adams\par
>      \quad \reference[AdamsDouglas]{Adams, Douglas}Douglas\quad 1\par
>      \quad John\quad 1\par
>      \quad John Quincy\quad 2\par
>    \stopIndex
>    \startIndex{b}
>      Beagle\quad 1, 2\par
>      \reference[breedingprograms]{breeding programs}breeding programs\quad 2
>    \stopIndex
>    \startIndex{c}
>      Coton de Tulear\quad 2.\par
>      \quad {\em See also under} \in[dogbreeds]
>    \stopIndex
>    \startIndex{d}
>      \reference[DentArthur]{Dent, Arthur}Dent, Arthur {\em see} \in[AdamsDouglas]\par
>      \reference[dogbreeds]{dog breeds}dog breeds\par
>      \quad \reference[dbBeagle]{dog breeds, Beagle}Beagle\quad 1\par
>      \quad \reference[dbCoton]{dog breeds, Coton}Coton de Tulear\quad 1\par
>      \quad \reference[dbDachshund]{dog breeds, Dachshund}Dachshund\quad 1\par
>      \quad \reference[dbWeimaraner]{dog breeds, Weimaraner}Weimaraner\quad 1\par
>      \quad Wiener dog\quad {\em see} \in[dbDachshund]\par
>      \quad{\em See also} \in[breedingprograms] {\em and specific breeds}
>    \stopIndex
>    \startIndex{m}
>      Marut, Ret\quad {\em see} \in[TravenB]\par
>      Matilda effect\quad {\em see} \in[obliteration]\par
>      \reference[misquotation]{misquotation}misquotation\quad 2
>    \stopIndex
>    \startIndex{o}
>      \reference[obliteration]{obliteration}obliteration\quad 1\par
>      \quad{\em See also} \in[misquotation] {\em and} \in[pseudepigraphy]
>    \stopIndex
>    \startIndex{p}
>      Prefect, Ford\quad {\em see Adams, Douglas}\par
>      \reference[pseudepigraphy]{pseudepigraphy}pseudepigraphy\quad 2\par
>      \quad {\em See also} \in[obliteration]
>    \stopIndex
>    \startIndex{t}
>      \reference[TravenB]{Traven, B.}Traven, B.\quad 2
>    \stopIndex
>    \startIndex{w}
>      Weimaraner\quad {\em see under} \in[dogbreeds]
>    \stopIndex
>    \page
>    \placeindex
>    \stoptext
> 
> -- 
> Rik
> 
> ___________________________________________________________________________________
> If your question is of interest to others as well, please add an entry to the Wiki!
> 
> maillist : ntg-context at ntg.nl / http://www.ntg.nl/mailman/listinfo/ntg-context
> webpage  : http://www.pragma-ade.nl / http://context.aanhet.net
> archive  : https://bitbucket.org/phg/context-mirror/commits/
> wiki     : http://contextgarden.net
> ___________________________________________________________________________________

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210827/456eb2d5/attachment.htm>

From j.hagen at xs4all.nl  Fri Aug 27 17:09:51 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Fri, 27 Aug 2021 17:09:51 +0200
Subject: [dev-context] Fwd: [NTG-context] Indexing redux
In-Reply-To: <223FDF67-8140-4CA9-A47E-D28A80B28E98@bittext.nl>
References: <338559e1-98ac-3ccd-3409-e6744656119a@rik.users.panix.com>
 <223FDF67-8140-4CA9-A47E-D28A80B28E98@bittext.nl>
Message-ID: <1171ec01-c829-34fd-72d5-fd2e92851543@xs4all.nl>

On 8/27/2021 1:24 PM, Taco Hoekwater wrote:
> Hi,
> 
> Iâll be happy to play around with extending the register code, assuming 
> that is ok with Hans and that not someone else is also working on this?

Sure. At some point I'll adapt registers (structure in general) a bit 
more to lmtx features (I currently kind of go stepwise through groups of 
files, also in the process of checking luametatex stuff) so in the 
meantime you can play with new register stuff because that doesn't 
interfere much I guess and you probably don't care if I then add some to 
that (maybe wolfgang also has some pending ideas) and we have Rik to 
test all of it.

What i normally do in such a case is copy the existing file to:

strc-reg-new.mkxk

and in context.mkxl:

\doifelsefileexists{strc-reg-new.mkxl}
   {\input{strc-reg-new.mkxl}}
   {\input{strc-reg.mkxl}}

That way it doesn't interfere with the existing code. Then when all is 
ok I eventually merge and double check. (I can add that if needed.)

Hans

> Taco
> 
>> Begin forwarded message:
>>
>> *From: *Rik Kabel via ntg-context <ntg-context at ntg.nl 
>> <mailto:ntg-context at ntg.nl>>
>> *Subject: **Re: [NTG-context] Indexing redux*
>> *Date: *26 August 2021 at 22:46:23 CEST
>> *To: *mailing list for ConTeXt users <ntg-context at ntg.nl 
>> <mailto:ntg-context at ntg.nl>>
>> *Cc: *Rik Kabel <ConTeXt at rik.users.panix.com 
>> <mailto:ConTeXt at rik.users.panix.com>>
>> *Reply-To: *mailing list for ConTeXt users <ntg-context at ntg.nl 
>> <mailto:ntg-context at ntg.nl>>
>>
>>
>> On 8/26/2021 03:26, Taco Hoekwater wrote:
>>> Hi Rik,
>>>
>>>> On 26 Aug 2021, at 03:14, Rik Kabel via ntg-context<ntg-context at ntg.nl>  wrote:
>>>>
>>>> List,
>>>>
>>>> I am trying to create an index with both "see" and "see also" cross-reference entries.[1] At this point, ConTeXt provides basic support for "see" entries via the \seeREGISTER command (it does not properly support references to sub-entries) and it provides no support at all for "see also" entries.
>>>>
>>>> Can somebody suggest a way to generate these entries? Perhaps a way of inserting entries into the index before it is formatted, in the     manner of \writetolist or \writebetweenlist? (MkII has \writetoregister, but that did not carry forward and I do not know if it would have helped here.)
>>> Since strc-reg.mkiv starts with a number of âtodoâ comments, I think your best bet is to create an
>>> actual functional example along with an explanation of what you want the typeset result to look
>>> like in the cases where it is not doing what you want.
>>>
>>> Generally, explicit examples / test files are the best way to get replies to questions
>>> (either by Hans or anyone else).
>>
>> The following produces what I am looking for, and a bit more. Page 3 
>> of the output shows what I would like to see, page 4 is the generated 
>> index. I don't really need the "see under" and "see also under" 
>> variants, but they would be nice to have. I am indifferent to having 
>> stops before "see also"s. I would like to be able to turn checking on 
>> or off, so that generic directives (in the example, see also specific 
>> breeds) will not generate an error, while the Ford Prefect example 
>> will generate an error.
>>
>>
>>     Â Â  \defineprocessor[also][color=blue]
>>     Â Â  \defineprocessor[under][color=green]
>>     Â Â  \defineprocessor[alsounder][color=orange]
>>     Â Â  \define\seealsoindex\seeindex
>>     Â Â  \define\seealsounderindex\seeindex
>>     Â Â  \define\seeunderindex\seeindex
>>     Â Â  \setupinteraction [state=start]
>>     Â Â  \setupregisterÂ Â Â  [index][balance=no,check=no]
>>
>>     %% seeindex entries may start on the same line as their head entry
>>     Â Â  \seeindexÂ Â Â Â Â Â Â Â  {dog breeds+Wiener dog}{dog breeds+Dachshund}
>>     %%Â  The next example should not work,
>>     %%Â Â Â  since there is no main entry /Adams, Douglas/
>>     Â Â  \seeindexÂ Â Â Â Â Â Â Â  {Prefect, Ford}{Adams, Douglas}
>>
>>     %%Â  When referring to a subentry, the target must be a subentry,
>>     %%Â Â Â  but should display as if a main entry. The next example
>>     %%Â Â Â  should point to the /Adams+Douglas/ subentry, but it
>>     %%Â Â Â  should be formatted as if it were /Adams, Douglas/
>>     Â Â  \seeindexÂ Â Â Â Â Â Â Â  {Dent, Arthur}{Adams+Douglas}
>>
>>     %% The following two work as expected
>>     Â Â  \seeindexÂ Â Â Â Â Â Â Â  {Matilda effect}{obliteration}
>>     Â Â  \seeindexÂ Â Â Â Â Â Â Â  {Marut, Ret}{Traven, B.}
>>
>>     %% seealso should be placed after as a subentry after real page
>>     references
>>     %% seealso should have an appropriate label (default English /see
>>     also/)
>>     Â Â  \seealsoindexÂ Â Â Â  {pseudepigraphy}{also->obliteration}
>>     Â Â  \seealsoindexÂ Â Â Â  {dog breeds}{also->breeding programs}
>>     Â Â  \seealsoindexÂ Â Â Â  {dog breeds}{also->specific breeds}
>>     %% seealsounder is like seealso except that it refers to a main entry
>>     Â Â  \seealsounderindex{Coton de Tulear}{alsounder->dog breeds}
>>     %% seeunder also is like seealso except that it refers to a main entry
>>     Â Â  \seeunderindexÂ Â Â  {Weimaraner}{under->dog breeds}
>>     Â Â  \starttext
>>     Â Â Â Â  Stuff
>>     Â Â Â Â  \index{obliteration}
>>     Â Â Â Â  \index{Adams+Douglas}\index{Adams+John}
>>     Â Â Â Â  \index{Beagle}
>>     Â Â Â Â  \index{dog breeds+Beagle}
>>     Â Â Â Â  \index{dog breeds+Coton de Tulear}
>>     Â Â Â Â  \index{dog breeds+Dachshund}
>>     Â Â Â Â  \index{dog breeds+Weimaraner}
>>     Â Â  \page
>>     Â Â Â Â  More stuff
>>     Â Â Â Â  \index{Adams+John Quincy}
>>     Â Â Â Â  \index{misquotation}
>>     Â Â Â Â  \index{pseudepigraphy}
>>     Â Â Â Â  \index{Traven, B.}
>>     Â Â Â Â  \index{Beagle}
>>     Â Â Â Â  \index{Coton de Tulear}
>>     Â Â Â Â  \index{breeding programs}
>>     Â Â  \page
>>     \definedescription[Index][headstyle=bold,alternative=top,inbetween=]
>>     Â Â  \startIndex{a}
>>     Â Â Â Â  Adams\par
>>     Â Â Â Â  \quad \reference[AdamsDouglas]{Adams, Douglas}Douglas\quad 1\par
>>     Â Â Â Â  \quad John\quad 1\par
>>     Â Â Â Â  \quad John Quincy\quad 2\par
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{b}
>>     Â Â Â Â  Beagle\quad 1, 2\par
>>     Â Â Â Â  \reference[breedingprograms]{breeding programs}breeding
>>     programs\quad 2
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{c}
>>     Â Â Â Â  Coton de Tulear\quad 2.\par
>>     Â Â Â Â  \quad {\em See also under} \in[dogbreeds]
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{d}
>>     Â Â Â Â  \reference[DentArthur]{Dent, Arthur}Dent, Arthur {\em see}
>>     \in[AdamsDouglas]\par
>>     Â Â Â Â  \reference[dogbreeds]{dog breeds}dog breeds\par
>>     Â Â Â Â  \quad \reference[dbBeagle]{dog breeds, Beagle}Beagle\quad 1\par
>>     Â Â Â Â  \quad \reference[dbCoton]{dog breeds, Coton}Coton de
>>     Tulear\quad 1\par
>>     Â Â Â Â  \quad \reference[dbDachshund]{dog breeds,
>>     Dachshund}Dachshund\quad 1\par
>>     Â Â Â Â  \quad \reference[dbWeimaraner]{dog breeds,
>>     Weimaraner}Weimaraner\quad 1\par
>>     Â Â Â Â  \quad Wiener dog\quad {\em see} \in[dbDachshund]\par
>>     Â Â Â Â  \quad{\em See also} \in[breedingprograms] {\em and specific
>>     breeds}
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{m}
>>     Â Â Â Â  Marut, Ret\quad {\em see} \in[TravenB]\par
>>     Â Â Â Â  Matilda effect\quad {\em see} \in[obliteration]\par
>>     Â Â Â Â  \reference[misquotation]{misquotation}misquotation\quad 2
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{o}
>>     Â Â Â Â  \reference[obliteration]{obliteration}obliteration\quad 1\par
>>     Â Â Â Â  \quad{\em See also} \in[misquotation] {\em and}
>>     \in[pseudepigraphy]
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{p}
>>     Â Â Â Â  Prefect, Ford\quad {\em see Adams, Douglas}\par
>>     \reference[pseudepigraphy]{pseudepigraphy}pseudepigraphy\quad 2\par
>>     Â Â Â Â  \quad {\em See also} \in[obliteration]
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{t}
>>     Â Â Â Â  \reference[TravenB]{Traven, B.}Traven, B.\quad 2
>>     Â Â  \stopIndex
>>     Â Â  \startIndex{w}
>>     Â Â Â Â  Weimaraner\quad {\em see under} \in[dogbreeds]
>>     Â Â  \stopIndex
>>     Â Â  \page
>>     Â Â  \placeindex
>>     Â Â  \stoptext
>>
>> -- 
>> Rik
>>
>> ___________________________________________________________________________________
>> If your question is of interest to others as well, please add an entry 
>> to the Wiki!
>>
>> maillist : ntg-context at ntg.nl <mailto:ntg-context at ntg.nl> / 
>> http://www.ntg.nl/mailman/listinfo/ntg-context 
>> <http://www.ntg.nl/mailman/listinfo/ntg-context>
>> webpage Â : http://www.pragma-ade.nl <http://www.pragma-ade.nl> / 
>> http://context.aanhet.net <http://context.aanhet.net>
>> archive Â : https://bitbucket.org/phg/context-mirror/commits/ 
>> <https://bitbucket.org/phg/context-mirror/commits/>
>> wiki Â Â Â Â : http://contextgarden.net <http://contextgarden.net>
>> ___________________________________________________________________________________
> 
> â
> Taco Hoekwater Â  Â  Â  Â  Â  Â  Â E: taco at bittext.nl <mailto:taco at bittext.nl>
> genderfluid (all pronouns)
> 
> 
> 
> 
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context
> 


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From modules at contextgarden.net  Sun Aug 29 20:30:51 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 29 Aug 2021 20:30:51 +0200
Subject: [dev-context] CGModules update: Typescripts version 2021.08.29
 published.
Message-ID: <20210829183051.7EECA286E56@zapf.ntg.nl>

Wolfgang Schuster submitted an update to the

               Typescripts

package.

Version number: 2021.08.29
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: A collection of typescript files for free and commercial fonts.

Announcement text:
----------------------------------------------------------------------

Changed the filenames from type-xxx to type-imp-xxx.

Removed MkII files from the collection.

----------------------------------------------------------------------


From oinos at gmx.es  Mon Aug 30 19:30:51 2021
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 30 Aug 2021 19:30:51 +0200
Subject: [dev-context] minor typo
Message-ID: <4e46bca5-85c4-ad9f-f993-e37693a1806e@gmx.es>

Hans,

I detected a minor typo when searching for JS controlled buttons.

Just in case it helps,

Pablo
--
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minor-typo.diff
Type: text/x-patch
Size: 582 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210830/44092f9a/attachment.bin>

From modules at contextgarden.net  Thu Sep  2 21:26:54 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Thu, 2 Sep 2021 21:26:54 +0200
Subject: [dev-context] CGModules update: Typescripts version 2021.09.02
 published.
Message-ID: <20210902192654.9AC6B28702F@zapf.ntg.nl>

Wolfgang Schuster submitted an update to the

               Typescripts

package.

Version number: 2021.09.02
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: A collection of typescript files for free and commercial fonts.

Announcement text:
----------------------------------------------------------------------

Removed files which are already included in ConTeXt.

----------------------------------------------------------------------


From modules at contextgarden.net  Mon Sep  6 00:38:03 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 6 Sep 2021 00:38:03 +0200
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.09.05 published.
Message-ID: <20210905223803.AA00F2871A4@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.09.05
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Bugfix release: 

* Fix a typo in t-vim. Vim uses `PreProc` as a group name, but `t-vim` was
  using `Preproc`. As a result, some elements were not highlighted. Reported by
  champignoom on github.

----------------------------------------------------------------------


From modules at contextgarden.net  Mon Sep  6 04:32:10 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 6 Sep 2021 04:32:10 +0200
Subject: [dev-context] CGModules update: Filter version 2021.09.05 published.
Message-ID: <20210906023210.C21592871A9@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               Filter

package.

Version number: 2021.09.05
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: A module to run external programs on the contents of start-stop evironment

Announcement text:
----------------------------------------------------------------------

Bugfix release.

* The inteface of \splitfilename changed due the which \externalfilterbasename
  was incorrect. Using the new interface now.

----------------------------------------------------------------------


From champignoom at gmail.com  Thu Sep  9 01:31:55 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Thu, 9 Sep 2021 01:31:55 +0200
Subject: [dev-context] inner item group ignores options
Message-ID: <CACNy3NBHag-jePZvUJiO7JhZjffy8=8J1AD6OJM-UrspD8oGhA@mail.gmail.com>

Dear ConTeXt Devs,

I'm not sure if this is an expected behavior or a known issue, but anyway,
I've found that the inner \startitemize ignores margin= and before= and
probably some other options as well:

\showframe
\starttext
\startitemize[margin=2em]
\item has margin
\stopitemize
\startitemize[before=randomstuff]
\item has text before
\stopitemize

\startitemize[margin=2em]
\item .
\startitemize[margin=2em]
\item no margin
\stopitemize
\startitemize[before=randomstuff]
\item no text before
\stopitemize
\stopitemize
\stoptext

Besides, do we have an official issue tracker?

Thanks!

Best,
Sylvain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210909/24497b91/attachment.htm>

From oinos at gmx.es  Thu Sep  9 08:38:14 2021
From: oinos at gmx.es (Pablo Rodriguez)
Date: Thu, 9 Sep 2021 08:38:14 +0200
Subject: [dev-context] inner item group ignores options
In-Reply-To: <CACNy3NBHag-jePZvUJiO7JhZjffy8=8J1AD6OJM-UrspD8oGhA@mail.gmail.com>
References: <CACNy3NBHag-jePZvUJiO7JhZjffy8=8J1AD6OJM-UrspD8oGhA@mail.gmail.com>
Message-ID: <503ff203-e93c-d3a3-d810-1a6b4d1204cc@gmx.es>

On 9/9/21 1:31 AM, Sylvain Hubert wrote:
> Dear ConTeXt Devs,
>
> I'm not sure if this is an expected behavior or a known issue, but
> anyway, I've found that the inner \startitemize ignores margin= and
> before= and probably some other options as well:

Hi Sylvain,

both options are honored in your sample (at least using current latest
from  2021.09.06 11:47).

"randomstuff" is just a text and your before option is added as pure text.

> Besides, do we have an official issue tracker?

Iâm afraid there is no official issue tracker (as far as I know).

Just in case it helps,

Pablo
--
http://www.ousia.tk

From j.hagen at xs4all.nl  Thu Sep  9 10:22:23 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Thu, 9 Sep 2021 10:22:23 +0200
Subject: [dev-context] inner item group ignores options
In-Reply-To: <CACNy3NBHag-jePZvUJiO7JhZjffy8=8J1AD6OJM-UrspD8oGhA@mail.gmail.com>
References: <CACNy3NBHag-jePZvUJiO7JhZjffy8=8J1AD6OJM-UrspD8oGhA@mail.gmail.com>
Message-ID: <f3c65cdd-a06e-68cd-e101-b56513082689@xs4all.nl>

On 9/9/2021 1:31 AM, Sylvain Hubert wrote:
> Dear ConTeXt Devs,
> 
> I'm not sure if this is an expected behavior or a known issue, but 
> anyway, I've found that the inner \startitemize ignores margin= and 
> before= and probably some other options as well:
> 
> \showframe
> \starttext
> \startitemize[margin=2em]
> \item has margin
> \stopitemize
> \startitemize[before=randomstuff]
> \item has text before
> \stopitemize
> 
> \startitemize[margin=2em]
> \item .
> \startitemize[margin=2em]
> \item no margin
> \stopitemize
> \startitemize[before=randomstuff]
> \item no text before
> \stopitemize
> \stopitemize
> \stoptext

\starttext

\defineitemgroup[marginalized]
\setupitemgroup[marginalized][2][leftmargindistance=2em]
\setupitemgroup[marginalized][3][leftmargindistance=4em]

\startmarginalized
     \item one: \input tufte
         \startmarginalized
             \item two: \input tufte
             \startmarginalized
                 \item three:  \input tufte
             \stopmarginalized
         \stopmarginalized
\stopmarginalized

\stoptext

> Besides, do we have an official issue tracker?
There is one I lack the discipline to keep track of issue trackers so 
just posting to the list is faster.

http://tracker.luatex.org -> project context

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From wolfgang.schuster.lists at gmail.com  Fri Sep 10 20:24:21 2021
From: wolfgang.schuster.lists at gmail.com (Wolfgang Schuster)
Date: Fri, 10 Sep 2021 20:24:21 +0200
Subject: [dev-context] page-inj.mkvi/mklx
Message-ID: <c27a32a0-eca0-4f14-aad2-1f0ca1f97e9f@gmail.com>

Hi,

the \pageinjection command needs a slightly modified version (which uses 
\printpaperwidth and \printpaperheight) of \page_injections_flush_indeed 
because the current version has problems to adjust the paper size when 
multiple injections with different sizes appear at the same spot.

\def\page_injections_flush_indeed
 Â  {\setbox\scratchbox\normalhpack
{\inheritedpageinjectionframed{\texsetup\p_page_injectionalternative_rederingsetup}}%
 Â Â  \begingroup
 Â Â  \printpaperwidth \wd\scratchbox
 Â Â  \printpaperheight\ht\scratchbox
 Â Â  \scrn_canvas_synchronize_only
 Â Â  \invokepagehandler\v!normal{\box\scratchbox}%
 Â Â  \endgroup
 Â Â  \scrn_canvas_synchronize_reset}

Wolfgang


From champignoom at gmail.com  Sun Sep 12 01:15:04 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Sun, 12 Sep 2021 01:15:04 +0200
Subject: [dev-context] mtxrun makes x11 stuck
Message-ID: <CACNy3NApLhP2a3chEWxZCP2saN-DHk3M5Bg6vuP30_AHrmqnVA@mail.gmail.com>

Dear ConTeXt Devs,

Here's a problem that I reported last year (
https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html) with a
wrong description. I thought that it had something to do with Firefox or
browsers, but it turns out to be a much deeper and weirder problem messing
up with the X window system.

Environment: Manjaro Linux 21.1.2, Xfce 4.16

Steps to reproduce:
1. `context --version`  # it can hardly be any more innocent
2.1. keep striking random keys in the terminal or mounsepad or whatever
2.2. or open a running-cat.gif in the background
Expected behavior: the characters should appear as you type, or the cat
should keep running
Actual behavior: ~3s after `context --version` finishes, the terminal
freezes and the character stops appearing for ~1s, or similarly, the cat
stops running for ~1s

In short, ~3s upon termination of context, the X window stuck for ~1s.

More information:
1. The problem only appears 2 days after the fresh installation of latest
context-lmtx, which was also the case last year.
2. `context --version` isn't doing anything, so it shouldn't be a resource
problem, and I've got no such problem keeping 40+ pages open in chrome
anyway.
3. Below is a more precise timing of the problem. The first output is the
result of `context --version` along with the start and stop timestamps. The
second output is a python one-liner printing timestamps each time it reads
an <enter>. Notice how python reads an <enter> per ~0.05s
until 00:33:21.597326, when it is blocked for ~0.7s.

I'm not sure if it's reproducible everywhere, and I'm willing to debug it
myself, but I would need the source code of the context executable.

Thanks!

Best,
Sylvain

$ date +'%H:%M:%S.%N'; context --version; date +'%H:%M:%S.%N'
00:33:18.885305966
mtx-context     | ConTeXt Process Management 1.04
mtx-context     |
mtx-context     | main context file:
/home/exprosic/apps/context-lmtx/tex/texmf-context/tex/context/base/mkiv/context.mkiv
mtx-context     | current version: 2021.09.06 11:47
mtx-context     | main context file:
/home/exprosic/apps/context-lmtx/tex/texmf-context/tex/context/base/mkxl/context.mkxl
mtx-context     | current version: 2021.09.06 11:47

00:33:18.969962042

$ python
>>> while input() or True: print(datetime.now())
...
2021-09-12 00:33:19.232685
2021-09-12 00:33:19.732828
2021-09-12 00:33:19.783645
2021-09-12 00:33:19.833808
(~0.05s per line, omitted 30 lines)
2021-09-12 00:33:21.394246
2021-09-12 00:33:21.445061
2021-09-12 00:33:21.496275
2021-09-12 00:33:21.546402
2021-09-12 00:33:21.597326 <--- ~0.05s per event until here
2021-09-12 00:33:21.646603 <--- stuck for 0.7s
2021-09-12 00:33:22.366133 <--- the stucked events flush in
2021-09-12 00:33:22.366269
2021-09-12 00:33:22.369491
2021-09-12 00:33:22.369765
2021-09-12 00:33:22.372800
2021-09-12 00:33:22.373038
2021-09-12 00:33:22.376233
2021-09-12 00:33:22.376444
2021-09-12 00:33:22.379487
2021-09-12 00:33:22.379687
2021-09-12 00:33:22.382737
2021-09-12 00:33:22.382960
2021-09-12 00:33:22.386020
2021-09-12 00:33:22.386253
2021-09-12 00:33:22.400795 <--- recovers ~0.05s per event
2021-09-12 00:33:22.451349
2021-09-12 00:33:22.503352
2021-09-12 00:33:22.553715
....
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210912/016e834b/attachment.htm>

From champignoom at gmail.com  Sun Sep 12 11:20:46 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Sun, 12 Sep 2021 11:20:46 +0200
Subject: [dev-context] linenumbering in conflict with itemize[columns]
Message-ID: <CACNy3NAg9-a=jGiHd07OGu5Wc6iJTqpvZF3xLpSmp7jayecwnA@mail.gmail.com>

Hi,

the 'columns' option of item groups causes line numberings to overlap with
each other:

% MWE by Aditya
% https://github.com/adityam/filter/issues/55
% ConTeXt LMTX 2021.09.06 11:47

\starttext
\startlinenumbering
  \input tufte
\stoplinenumbering

\startitemize[columns] \item one \stopitemize
\startitemize[columns] \item one \stopitemize
\startitemize[columns] \item one \stopitemize

\stoptext

Best,

Sylvain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210912/e21433f3/attachment.htm>

From j.hagen at xs4all.nl  Sun Sep 12 11:38:36 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sun, 12 Sep 2021 11:38:36 +0200
Subject: [dev-context] mtxrun makes x11 stuck
In-Reply-To: <CACNy3NApLhP2a3chEWxZCP2saN-DHk3M5Bg6vuP30_AHrmqnVA@mail.gmail.com>
References: <CACNy3NApLhP2a3chEWxZCP2saN-DHk3M5Bg6vuP30_AHrmqnVA@mail.gmail.com>
Message-ID: <441c7202-7a02-e86a-1982-d9fc02e903f7@xs4all.nl>

On 9/12/2021 1:15 AM, Sylvain Hubert wrote:
> Dear ConTeXt Devs,
> 
> Here's a problem that I reported last year 
> (https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html 
> <https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html>) with a 
> wrongÂ description. I thought that it had something to do with Firefox or 
> browsers, but it turns out to be a much deeper and weirder problem 
> messing up with the X window system.
> 
> Environment: Manjaro Linux 21.1.2, Xfce 4.16
> 
> Steps to reproduce:
> 1. `context --version`Â  # it can hardly be any more innocent
> 2.1. keep strikingÂ random keys in the terminal or mounsepad or whatever
> 2.2. or open a running-cat.gif in the background
> Expected behavior: the characters should appear as you type, or the cat 
> should keep running
> Actual behavior: ~3s after `context --version` finishes, the terminal 
> freezes and the character stops appearing for ~1s, or similarly, the cat 
> stops running for ~1s
> 
> In short, ~3s upon termination of context, the X window stuck for ~1s.
> 
> More information:
> 1. The problem only appears 2 days after the fresh installation of 
> latest context-lmtx, which was also the case last year.
> 2. `context --version` isn't doing anything, so it shouldn't be a 
> resource problem, and I've got no such problem keeping 40+ pages open in 
> chrome anyway.
> 3. Below is a more precise timing of the problem. The first output is 
> the result of `context --version` along with the start and stop 
> timestamps. The second output is a python one-liner printing timestamps 
> each time it reads an <enter>. Notice how python reads an <enter> per 
> ~0.05s untilÂ 00:33:21.597326, when it is blocked for ~0.7s.
> 
> I'm not sure if it's reproducible everywhere, and I'm willing to debug 
> it myself, but I would need the source code of the context executable.
i can't be of much help here but keep i nind that after an update a 
first run can trigger a format remake or scan for fonts so when that 
takes time hitting some 'run again' key can result in many simulatious 
runs that can add up an dmaybe stall the system

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From champignoom at gmail.com  Sun Sep 12 12:09:36 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Sun, 12 Sep 2021 12:09:36 +0200
Subject: [dev-context] mtxrun makes x11 stuck
In-Reply-To: <441c7202-7a02-e86a-1982-d9fc02e903f7@xs4all.nl>
References: <CACNy3NApLhP2a3chEWxZCP2saN-DHk3M5Bg6vuP30_AHrmqnVA@mail.gmail.com>
 <441c7202-7a02-e86a-1982-d9fc02e903f7@xs4all.nl>
Message-ID: <CACNy3NC1zJKhYP6MBYJJu8ORXwC=qkMFNxFVyYkHC0jk6LSQag@mail.gmail.com>

Thanks for the hints, Hans. But the problem has been reproduced multiple
times after the last update.

The bug turns out to be not from within context. I just tried `touch
context-lmtx/tex` (in which there are texmf/, texmf-context/, etc.) and the
very same problem appears.

This is very weird, as the whole context-lmtx/ has no more than a few
thousand files and <400MB of data, so it's unlikely to be a cache issue
either.



On Sun, 12 Sept 2021 at 11:38, Hans Hagen <j.hagen at xs4all.nl> wrote:

> On 9/12/2021 1:15 AM, Sylvain Hubert wrote:
> > Dear ConTeXt Devs,
> >
> > Here's a problem that I reported last year
> > (https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html
> > <https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html>) with a
> > wrong description. I thought that it had something to do with Firefox or
> > browsers, but it turns out to be a much deeper and weirder problem
> > messing up with the X window system.
> >
> > Environment: Manjaro Linux 21.1.2, Xfce 4.16
> >
> > Steps to reproduce:
> > 1. `context --version`  # it can hardly be any more innocent
> > 2.1. keep striking random keys in the terminal or mounsepad or whatever
> > 2.2. or open a running-cat.gif in the background
> > Expected behavior: the characters should appear as you type, or the cat
> > should keep running
> > Actual behavior: ~3s after `context --version` finishes, the terminal
> > freezes and the character stops appearing for ~1s, or similarly, the cat
> > stops running for ~1s
> >
> > In short, ~3s upon termination of context, the X window stuck for ~1s.
> >
> > More information:
> > 1. The problem only appears 2 days after the fresh installation of
> > latest context-lmtx, which was also the case last year.
> > 2. `context --version` isn't doing anything, so it shouldn't be a
> > resource problem, and I've got no such problem keeping 40+ pages open in
> > chrome anyway.
> > 3. Below is a more precise timing of the problem. The first output is
> > the result of `context --version` along with the start and stop
> > timestamps. The second output is a python one-liner printing timestamps
> > each time it reads an <enter>. Notice how python reads an <enter> per
> > ~0.05s until 00:33:21.597326, when it is blocked for ~0.7s.
> >
> > I'm not sure if it's reproducible everywhere, and I'm willing to debug
> > it myself, but I would need the source code of the context executable.
> i can't be of much help here but keep i nind that after an update a
> first run can trigger a format remake or scan for fonts so when that
> takes time hitting some 'run again' key can result in many simulatious
> runs that can add up an dmaybe stall the system
>
> Hans
>
>
> -----------------------------------------------------------------
>                                            Hans Hagen | PRAGMA ADE
>                Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>         tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210912/f0e49123/attachment.htm>

From braslau.list at comcast.net  Sun Sep 12 18:16:24 2021
From: braslau.list at comcast.net (Alan Braslau)
Date: Sun, 12 Sep 2021 10:16:24 -0600
Subject: [dev-context] mtxrun makes x11 stuck
In-Reply-To: <CACNy3NC1zJKhYP6MBYJJu8ORXwC=qkMFNxFVyYkHC0jk6LSQag@mail.gmail.com>
References: <CACNy3NApLhP2a3chEWxZCP2saN-DHk3M5Bg6vuP30_AHrmqnVA@mail.gmail.com>
 <441c7202-7a02-e86a-1982-d9fc02e903f7@xs4all.nl>
 <CACNy3NC1zJKhYP6MBYJJu8ORXwC=qkMFNxFVyYkHC0jk6LSQag@mail.gmail.com>
Message-ID: <1B439D62-FEFE-431E-94DE-D4882A4C77FD@comcast.net>

It sounds to me like you have a system problem, and context is just the unlucky recipient where that shows up.

Alan


> On 12Sep21, at 04:09, Sylvain Hubert <champignoom at gmail.com> wrote:
> 
> Thanks for the hints, Hans. But the problem has been reproduced multiple times after the last update.
> 
> The bug turns out to be not from within context. I just tried `touch context-lmtx/tex` (in which there are texmf/, texmf-context/, etc.) and the very same problem appears.
> 
> This is very weird, as the whole context-lmtx/ has no more than a few thousand files and <400MB of data, so it's unlikely to be a cache issue either.
> 
> 
> 
> On Sun, 12 Sept 2021 at 11:38, Hans Hagen <j.hagen at xs4all.nl> wrote:
> On 9/12/2021 1:15 AM, Sylvain Hubert wrote:
> > Dear ConTeXt Devs,
> > 
> > Here's a problem that I reported last year 
> > (https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html 
> > <https://mailman.ntg.nl/pipermail/ntg-context/2020/099862.html>) with a 
> > wrong description. I thought that it had something to do with Firefox or 
> > browsers, but it turns out to be a much deeper and weirder problem 
> > messing up with the X window system.
> > 
> > Environment: Manjaro Linux 21.1.2, Xfce 4.16
> > 
> > Steps to reproduce:
> > 1. `context --version`  # it can hardly be any more innocent
> > 2.1. keep striking random keys in the terminal or mounsepad or whatever
> > 2.2. or open a running-cat.gif in the background
> > Expected behavior: the characters should appear as you type, or the cat 
> > should keep running
> > Actual behavior: ~3s after `context --version` finishes, the terminal 
> > freezes and the character stops appearing for ~1s, or similarly, the cat 
> > stops running for ~1s
> > 
> > In short, ~3s upon termination of context, the X window stuck for ~1s.
> > 
> > More information:
> > 1. The problem only appears 2 days after the fresh installation of 
> > latest context-lmtx, which was also the case last year.
> > 2. `context --version` isn't doing anything, so it shouldn't be a 
> > resource problem, and I've got no such problem keeping 40+ pages open in 
> > chrome anyway.
> > 3. Below is a more precise timing of the problem. The first output is 
> > the result of `context --version` along with the start and stop 
> > timestamps. The second output is a python one-liner printing timestamps 
> > each time it reads an <enter>. Notice how python reads an <enter> per 
> > ~0.05s until 00:33:21.597326, when it is blocked for ~0.7s.
> > 
> > I'm not sure if it's reproducible everywhere, and I'm willing to debug 
> > it myself, but I would need the source code of the context executable.
> i can't be of much help here but keep i nind that after an update a 
> first run can trigger a format remake or scan for fonts so when that 
> takes time hitting some 'run again' key can result in many simulatious 
> runs that can add up an dmaybe stall the system
> 
> Hans
> 
> 
> -----------------------------------------------------------------
>                                            Hans Hagen | PRAGMA ADE
>                Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>         tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context

--
Alan Braslau





From champignoom at gmail.com  Mon Sep 13 00:20:27 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Mon, 13 Sep 2021 00:20:27 +0200
Subject: [dev-context] wrong layout by default
Message-ID: <CACNy3NA5QFp45jsi1mMsSUQr0kGvQDYodPsNoRciYNbdeyZ57A@mail.gmail.com>

Hi,

% wrong layout
% page number on the right instead of the center
% almost no margin for the text
\starttext
\dorecurse{28}{x }
\stoptext

% correct layout
% page number at the center
% margin exists
\showframe
\starttext
\dorecurse{28}{x }
\stoptext

% ConTeXt LMTX 2021.09.06 11:47

Sylvain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210913/0cb226c6/attachment.htm>

From champignoom at gmail.com  Mon Sep 13 00:25:26 2021
From: champignoom at gmail.com (Sylvain Hubert)
Date: Mon, 13 Sep 2021 00:25:26 +0200
Subject: [dev-context] wrong layout by default
In-Reply-To: <CACNy3NA5QFp45jsi1mMsSUQr0kGvQDYodPsNoRciYNbdeyZ57A@mail.gmail.com>
References: <CACNy3NA5QFp45jsi1mMsSUQr0kGvQDYodPsNoRciYNbdeyZ57A@mail.gmail.com>
Message-ID: <CACNy3NA2jexKq6YY8H+OXRVOOggtaE0-MgvBJtJtJn=71Zf+uw@mail.gmail.com>

False alarm, sorry. I accidentally triggered the margin trimming of the
viewer.

On Mon, 13 Sept 2021 at 00:20, Sylvain Hubert <champignoom at gmail.com> wrote:

> Hi,
>
> % wrong layout
> % page number on the right instead of the center
> % almost no margin for the text
> \starttext
> \dorecurse{28}{x }
> \stoptext
>
> % correct layout
> % page number at the center
> % margin exists
> \showframe
> \starttext
> \dorecurse{28}{x }
> \stoptext
>
> % ConTeXt LMTX 2021.09.06 11:47
>
> Sylvain
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20210913/51ca5ef1/attachment.htm>

From wolfgang.schuster at gmail.com  Thu Sep 23 17:15:36 2021
From: wolfgang.schuster at gmail.com (Wolfgang Schuster)
Date: Thu, 23 Sep 2021 17:15:36 +0200
Subject: [dev-context] font-sel.lua
Message-ID: <356a8958-54ea-3d36-52b8-29056b6e2d8d@gmail.com>

Hi,

below is a short patch for \definefontfamily.

function selectfont.registerfiles(index)
 Â Â Â  local dataÂ  = data[index]
 Â Â Â  local colon = splitat(":",true)
 Â Â Â  for alternative, _ in next, alternatives do
 Â Â Â Â Â Â Â  local arguments = data.alternatives[alternative]
 Â Â Â Â Â Â Â  if arguments and arguments ~= "" then
 Â Â Â Â Â Â Â Â Â Â Â  local entries = settings_to_array(arguments)
 Â Â Â Â Â Â Â Â Â Â Â  for index, entry in next, entries do
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  method, argument = lpegmatch(colon,entry)
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if not argument then
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  argument = method
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  methodÂ Â  = "name"
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  end
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if #entries == 1 and method == "features" then
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  extras["features"](data,alternative,argument)
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  methods[v_default](data,alternative)
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  else
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  (extras[method] or methods[method] or 
methods[v_default])(data,alternative,argument)
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  end
 Â Â Â Â Â Â Â Â Â Â Â  end
 Â Â Â Â Â Â Â  else
 Â Â Â Â Â Â Â Â Â Â Â  methods[v_default](data,alternative)
 Â Â Â Â Â Â Â  end
 Â Â Â  end
end

Wolfgang


From modules at contextgarden.net  Mon Oct 11 13:26:12 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 11 Oct 2021 13:26:12 +0200
Subject: [dev-context] CGModules new: my test module version v1.0 published.
Message-ID: <20211011112612.21437287D60@zapf.ntg.nl>

Taco Hoekwater submitted the new

               my test module

package.

Version number: v1.0
License type: Public Domain
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: Just testing

Announcement text:
----------------------------------------------------------------------

odd stuff

----------------------------------------------------------------------


From modules at contextgarden.net  Mon Oct 11 22:56:08 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 11 Oct 2021 22:56:08 +0200
Subject: [dev-context] CGModules new: lua-widow-control version 1.0.0
 published.
Message-ID: <20211011205608.8189A2856F7@zapf.ntg.nl>

Max Chernoff submitted the new

               lua-widow-control

package.

Version number: 1.0.0
License type: Mozilla Public License v2.0
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Automatically remove widows and orphans from any document

Announcement text:
----------------------------------------------------------------------

Initial release.

----------------------------------------------------------------------


From modules at contextgarden.net  Sat Oct 16 05:42:57 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sat, 16 Oct 2021 05:42:57 +0200
Subject: [dev-context] CGModules update: Filter version 2021.10.15 published.
Message-ID: <20211016034257.2B27D288B14@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               Filter

package.

Version number: 2021.10.15
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: A module to run external programs on the contents of start-stop evironment

Announcement text:
----------------------------------------------------------------------

Bugfix release.

* Typesetting two external files (in the vim module) with the same name but
  different extension causes a clash. Reported on Github
  (https://github.com/adityam/filter/issues/57). Now the file extension is
  also stored as part of the basename of the file to avoid this clash.

----------------------------------------------------------------------


From modules at contextgarden.net  Sat Oct 16 09:54:57 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sat, 16 Oct 2021 09:54:57 +0200
Subject: [dev-context] CGModules update: Letter module version 2021.10.16
 published.
Message-ID: <20211016075457.31ABE288B2B@zapf.ntg.nl>

Wolfgang Schuster submitted an update to the

               Letter module

package.

Version number: 2021.10.16
License type: GNU General Public License
Wants to be in ConTeXt distribution: no
Wants to be synced with CTAN: no

Summary description: Writing letters with ConTeXt.

Announcement text:
----------------------------------------------------------------------

Fixes a typo in the memo module which caused an error.

----------------------------------------------------------------------


From tomas.hala at mendelu.cz  Sun Oct 31 22:23:37 2021
From: tomas.hala at mendelu.cz (Tomas Hala)
Date: Sun, 31 Oct 2021 22:23:37 +0100
Subject: [dev-context] Three issues: empty lines | -error.log file |
 simpleslides
Message-ID: <20211031212337.GD17216@akela.mendelu.cz>

Hi all,

during last several months I came accross three non-critical problems
worth reporting here:

1. 
Empty lines at the beginning of the main file generates an error:
-----------------------------ERR
This is LuaTeX, Version 1.13.0 (TeX Live 2021) 
 system commands enabled.
**
---------------------------------
and compilation crashes. Detected at TL 2021, at two or three month old
garden installation is does not appear (maybe it has been fixed yet).
------------------------------MWE

\starttext
xxx
\stoptext
---------------------------------

2. 
When an error during compilation of "xxx.tex" appears, the file
"xxx-error.log" is generated. But sometimes happens that file "-error.log"
is created. It makes troubles for Linux command line processing --
if user writes some mask later, "-error.log" string is interpreted by default 
as list of options of a particular command. 
It would be very useful if a test preventing an "empty" filename will be added.

-----------------------------LOG (file -error.log)
return {
 ["filename"]="",
 ["lastcontext"]="\n<*> c\n   ont-yes.mkiv --c:currentrun=1 --c:fulljobname=./pokus-1.tex --c:input=./pokus-1.tex --c:kindofrun=3 -- --c:maxnofruns=1 --c:once -- -- --c:texmfbinpath=/usr/local/texlive/2021/bin/x86_64-linux",
 ["lastluaerror"]="?",
 ["lasttexerror"]="! Interruption",
 ["linenumber"]=0,
 ["offset"]=10,
}
--------------------------------

3.
When simpleslides module is used, interactive element BottomSquares does not
change if the file is compiled by ConTeXt from TL2021 whereas with ConTeXt
from TL2019 it works.

-----------------------------MWE
\usemodule[simpleslides][style=BottomSquares,font=Schoolbook,size=20dd,]
\starttext
\setupTitle[title=Title]
\placeTitle
\SlideTitle{A+B} blabla
\SlideTitle{CCC} blabla
\SlideTitle{D+E} blabla
\stoptext
--------------------------------
Examples attached.

The best,

TomÃ¡Å¡
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pokus315simpleslides-tl19.pdf
Type: application/pdf
Size: 9239 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20211031/06900431/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pokus315simpleslides-tl21.pdf
Type: application/pdf
Size: 9208 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20211031/06900431/attachment-0003.pdf>

From j.hagen at xs4all.nl  Mon Nov  1 17:54:24 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Mon, 1 Nov 2021 17:54:24 +0100
Subject: [dev-context] Three issues: empty lines | -error.log file |
 simpleslides
In-Reply-To: <20211031212337.GD17216@akela.mendelu.cz>
References: <20211031212337.GD17216@akela.mendelu.cz>
Message-ID: <b510518f-aab4-9382-9886-6b40f5015b03@xs4all.nl>

On 10/31/2021 10:23 PM, Tomas Hala wrote:
> Hi all,
> 
> during last several months I came accross three non-critical problems
> worth reporting here:
> 
> 1.
> Empty lines at the beginning of the main file generates an error:
> -----------------------------ERR
> This is LuaTeX, Version 1.13.0 (TeX Live 2021)
>   system commands enabled.
> **
> ---------------------------------
> and compilation crashes. Detected at TL 2021, at two or three month old
> garden installation is does not appear (maybe it has been fixed yet).
> ------------------------------MWE
> 
> \starttext
> xxx
> \stoptext
> ---------------------------------

weird error ... smells liek an engine issue

> 2.
> When an error during compilation of "xxx.tex" appears, the file
> "xxx-error.log" is generated. But sometimes happens that file "-error.log"
> is created. It makes troubles for Linux command line processing --
> if user writes some mask later, "-error.log" string is interpreted by default
> as list of options of a particular command.
> It would be very useful if a test preventing an "empty" filename will be added.
> 
> -----------------------------LOG (file -error.log)
> return {
>   ["filename"]="",
>   ["lastcontext"]="\n<*> c\n   ont-yes.mkiv --c:currentrun=1 --c:fulljobname=./pokus-1.tex --c:input=./pokus-1.tex --c:kindofrun=3 -- --c:maxnofruns=1 --c:once -- -- --c:texmfbinpath=/usr/local/texlive/2021/bin/x86_64-linux",
>   ["lastluaerror"]="?",
>   ["lasttexerror"]="! Interruption",
>   ["linenumber"]=0,
>   ["offset"]=10,
> }
> --------------------------------

i'll try to catch that

> 3.
> When simpleslides module is used, interactive element BottomSquares does not
> change if the file is compiled by ConTeXt from TL2021 whereas with ConTeXt
> from TL2019 it works.
> 
> -----------------------------MWE
> \usemodule[simpleslides][style=BottomSquares,font=Schoolbook,size=20dd,]
> \starttext
> \setupTitle[title=Title]
> \placeTitle
> \SlideTitle{A+B} blabla
> \SlideTitle{CCC} blabla
> \SlideTitle{D+E} blabla
> \stoptext
> --------------------------------
> Examples attached.

dunno

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From tomas.hala at mendelu.cz  Mon Nov  1 20:52:33 2021
From: tomas.hala at mendelu.cz (Tomas Hala)
Date: Mon, 1 Nov 2021 20:52:33 +0100
Subject: [dev-context] Three issues: empty lines | -error.log file |
 simpleslides
In-Reply-To: <b510518f-aab4-9382-9886-6b40f5015b03@xs4all.nl>
References: <20211031212337.GD17216@akela.mendelu.cz>
 <b510518f-aab4-9382-9886-6b40f5015b03@xs4all.nl>
Message-ID: <20211101195233.GA7545@akela.mendelu.cz>


Empty lines: 
Probably yes, I think that appears only on Linux.

Towards simpleslides: 
TL2020 also OK.

TomÃ¡Å¡
 
Mon, Nov 01, 2021 ve 05:54:24PM +0100 Hans Hagen napsal(a):
# On 10/31/2021 10:23 PM, Tomas Hala wrote:
# >Hi all,
# >
# >during last several months I came accross three non-critical problems
# >worth reporting here:
# >
# >1.
# >Empty lines at the beginning of the main file generates an error:
# >-----------------------------ERR
# >This is LuaTeX, Version 1.13.0 (TeX Live 2021)
# >  system commands enabled.
# >**
# >---------------------------------
# >and compilation crashes. Detected at TL 2021, at two or three month old
# >garden installation is does not appear (maybe it has been fixed yet).
# >------------------------------MWE
# >
# >\starttext
# >xxx
# >\stoptext
# >---------------------------------
# 
# weird error ... smells liek an engine issue

# >2.
# >When an error during compilation of "xxx.tex" appears, the file
# >"xxx-error.log" is generated. But sometimes happens that file "-error.log"
# >is created. It makes troubles for Linux command line processing --
# >if user writes some mask later, "-error.log" string is interpreted by default
# >as list of options of a particular command.
# >It would be very useful if a test preventing an "empty" filename will be added.
# >
# >-----------------------------LOG (file -error.log)
# >return {
# >  ["filename"]="",
# >  ["lastcontext"]="\n<*> c\n   ont-yes.mkiv --c:currentrun=1 --c:fulljobname=./pokus-1.tex --c:input=./pokus-1.tex --c:kindofrun=3 -- --c:maxnofruns=1 --c:once -- -- --c:texmfbinpath=/usr/local/texlive/2021/bin/x86_64-linux",
# >  ["lastluaerror"]="?",
# >  ["lasttexerror"]="! Interruption",
# >  ["linenumber"]=0,
# >  ["offset"]=10,
# >}
# >--------------------------------
# 
# i'll try to catch that
# 
# >3.
# >When simpleslides module is used, interactive element BottomSquares does not
# >change if the file is compiled by ConTeXt from TL2021 whereas with ConTeXt
# >from TL2019 it works.
# >
# >-----------------------------MWE
# >\usemodule[simpleslides][style=BottomSquares,font=Schoolbook,size=20dd,]
# >\starttext
# >\setupTitle[title=Title]
# >\placeTitle
# >\SlideTitle{A+B} blabla
# >\SlideTitle{CCC} blabla
# >\SlideTitle{D+E} blabla
# >\stoptext
# >--------------------------------
# >Examples attached.
# 
# dunno
# 
# Hans
# 
# -----------------------------------------------------------------
#                                           Hans Hagen | PRAGMA ADE
#               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
#        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
# -----------------------------------------------------------------
# _______________________________________________
# dev-context mailing list
# dev-context at ntg.nl
# https://mailman.ntg.nl/mailman/listinfo/dev-context

                                         TomÃ¡Å¡ HÃ¡la
--------------------------------------------------------------------
Mendelova univerzita, ProvoznÄ ekonomickÃ¡ fakulta, Ãºstav informatiky
ZemÄdÄlskÃ¡ 1, CZ-613 00 Brno,  tel. +420 545 13 22 28
--------------------------------------------------------------------
http://akela.mendelu.cz/~thala

From modules at contextgarden.net  Tue Nov  9 01:47:49 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Tue, 9 Nov 2021 01:47:49 +0100
Subject: [dev-context] CGModules update: lua-widow-control version 1.1.0
 published.
Message-ID: <20211109004749.C1A8528902E@zapf.ntg.nl>

Max Chernoff submitted an update to the

               lua-widow-control

package.

Version number: 1.1.0
License type: Mozilla Public License v2.0
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Automatically remove widows and orphans from any document

Announcement text:
----------------------------------------------------------------------

Changes from previous version:
  - Extensive documentation updates
  - Clarify that lua-widow-control does in fact support columns
  - Add \lwcdisablecmd macro to disable lua-widow-control for certain commands
  - Automatically disable lua-widow-control inside section headings (uses \lwcdisablecmd)
  - Add automated tests to prevent regressions
  - Fix a rare issue that would cause indefinite hangs

----------------------------------------------------------------------


From taco at bittext.nl  Mon Nov 15 12:36:08 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Mon, 15 Nov 2021 12:36:08 +0100
Subject: [dev-context] startpagefigure (mkxl) bug
Message-ID: <56EB4C8D-D165-4AE3-B035-A1FE94220265@bittext.nl>

Hi,


\defineexternalfigure[\v!page:\v!figure][\c!offset=\v!overlay] % we force a parent

\permanent\tolerant\protected\def\startpagefigure[#1]#*[#2]%
  {\bgroup
   \setupexternalfigure[\v!page:\v!figure][\c!offset=\v!overlay,#2]%
   \startTEXpage[\c!offset=\namedexternalfigureparameter{\v!page:\v!figure}\c!offset,\c!align=\v!normal]%
     \externalfigure[#1]\ignorespaces} % so we can put some text below the graphic


I think that last line should be 

     \externalfigure[#1[\v!page:\v!figure]]\ignorespaces} % so we can put some text below the graphic

?

Best wishes,
Taco

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From j.hagen at xs4all.nl  Mon Nov 15 15:01:31 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Mon, 15 Nov 2021 15:01:31 +0100
Subject: [dev-context] startpagefigure (mkxl) bug
In-Reply-To: <56EB4C8D-D165-4AE3-B035-A1FE94220265@bittext.nl>
References: <56EB4C8D-D165-4AE3-B035-A1FE94220265@bittext.nl>
Message-ID: <d9b97be7-c419-4c6b-e11f-dd592dd6d306@xs4all.nl>

On 11/15/2021 12:36 PM, Taco Hoekwater wrote:
> Hi,
> 
> 
> \defineexternalfigure[\v!page:\v!figure][\c!offset=\v!overlay] % we force a parent
> 
> \permanent\tolerant\protected\def\startpagefigure[#1]#*[#2]%
>    {\bgroup
>     \setupexternalfigure[\v!page:\v!figure][\c!offset=\v!overlay,#2]%
>     \startTEXpage[\c!offset=\namedexternalfigureparameter{\v!page:\v!figure}\c!offset,\c!align=\v!normal]%
>       \externalfigure[#1]\ignorespaces} % so we can put some text below the graphic
> 
> 
> I think that last line should be
> 
>       \externalfigure[#1[\v!page:\v!figure]]\ignorespaces} % so we can put some text below the graphic
you didn't test it  ... missing ] in the patch

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at bittext.nl  Tue Nov 16 15:59:33 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Tue, 16 Nov 2021 15:59:33 +0100
Subject: [dev-context] lmtx \fillinline bug
Message-ID: <4AA13B2C-8298-4973-BA0F-DD7D7C9C2815@bittext.nl>

Hi,

Something goes wrong rather oddly in lmtx with \fillinline. In vmode, it does not actually 
show the fill-in line, but then it does remember it because it will appear in the *next* 
paragraph. 

mkiv is fine, for comparison.

Best wishes.
Taco

% MWE:
\setuppapersize[A6,landscape]

\starttext

OK: \fillinline[width=2cm]{\it OK (hmode)} \par

\fillinline[width=2cm]{\it NOT OK (vmode)} \par

NOK, spillover!\par

\stoptext


â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From j.hagen at xs4all.nl  Tue Nov 16 18:40:07 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Tue, 16 Nov 2021 18:40:07 +0100
Subject: [dev-context] lmtx \fillinline bug
In-Reply-To: <4AA13B2C-8298-4973-BA0F-DD7D7C9C2815@bittext.nl>
References: <4AA13B2C-8298-4973-BA0F-DD7D7C9C2815@bittext.nl>
Message-ID: <538bf270-0332-b1e9-68ac-95bb071c39ba@xs4all.nl>

On 11/16/2021 3:59 PM, Taco Hoekwater wrote:
> Hi,
> 
> Something goes wrong rather oddly in lmtx with \fillinline. In vmode, it does not actually
> show the fill-in line, but then it does remember it because it will appear in the *next*
> paragraph.
> 
> mkiv is fine, for comparison.
> 
> Best wishes.
> Taco
> 
> % MWE:
> \setuppapersize[A6,landscape]
> 
> \starttext
> 
> OK: \fillinline[width=2cm]{\it OK (hmode)} \par
> 
> \fillinline[width=2cm]{\it NOT OK (vmode)} \par
> 
> NOK, spillover!\par
> 
> \stoptext
we can add a \dontleavehmode

\permanent\tolerant\protected\def\fillinline[#1]%
   {\dontleavehmode
    \registerparwrapper
      {fillinline}%
      {\pack_fillinline_before{#1}}%
      {\pack_fillinline_after {#1}%
       \unregisterparwrapper{fillinline}}}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at bittext.nl  Fri Nov 19 14:35:06 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 19 Nov 2021 14:35:06 +0100
Subject: [dev-context] startfigure / placestartfigure confusion
Message-ID: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>

Hi all,

I was trying to document the \marking()() command (which is in itself a bit of an odd thing, but
not the point of this message). It is supposedly to be used inside of 

  \startfigure â¦ \stopfigure (lmtx)
or with the old name:
  \placestartfigure â¦ \placestopfigure (mkii/mkiv)

but as I was trying to produce an example, I discovered that 

  \startfigure â¦ \stopfigure

does not seem to work at all ? no output appears. Is this command supposed to still work, even?

% MWE (assuming I understand the supposed syntax correctly):
\starttext
\startfigure[mycow][cow.pdf][width=4cm]
...
\stopfigure
some text
\stoptext




â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From taco at bittext.nl  Fri Nov 19 15:34:30 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 19 Nov 2021 15:34:30 +0100
Subject: [dev-context] \offset
Message-ID: <3B710A67-CEB4-439A-8F5D-DABAE5EBB500@bittext.nl>

Hi,

It looks like the \offset command is not quite exact? See attached output, which I thought should be
exactly centred horizontally. Instead, it shifts too far to the left. Normally I would suspect a 
stray space somewhere, but I do not see it...

Best wishes,
Taco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: off.pdf
Type: application/pdf
Size: 13252 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20211119/e83e1352/attachment.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: off.tex
Type: application/octet-stream
Size: 353 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20211119/e83e1352/attachment.obj>

From wolfgang.schuster.lists at gmail.com  Fri Nov 19 15:47:47 2021
From: wolfgang.schuster.lists at gmail.com (Wolfgang Schuster)
Date: Fri, 19 Nov 2021 15:47:47 +0100
Subject: [dev-context] \offset
In-Reply-To: <3B710A67-CEB4-439A-8F5D-DABAE5EBB500@bittext.nl>
References: <3B710A67-CEB4-439A-8F5D-DABAE5EBB500@bittext.nl>
Message-ID: <63804763-3bb0-d516-0a9b-79ec03f738de@gmail.com>

Taco Hoekwater schrieb am 19.11.2021 um 15:34:
> Hi,
>
> It looks like the \offset command is not quite exact? See attached output, which I thought should be
> exactly centred horizontally. Instead, it shifts too far to the left. Normally I would suspect a
> stray space somewhere, but I do not see it...

Floats are centered by default and your offset destroys the alignment.

\setuppapersize
 Â  [A5] [A4]

\setuplayout
 Â  [location=middle,
 Â Â  width=middle]

\showframe

\starttext

\placefigure[top][fig:ref]
 Â  {Caption}
 Â  {\externalfigure[cow][frame=on,width=\dimexpr\paperwidth+6mm\relax]}

\stoptext

Wolfgang


From taco at bittext.nl  Fri Nov 19 16:31:56 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 19 Nov 2021 16:31:56 +0100
Subject: [dev-context] \offset
In-Reply-To: <63804763-3bb0-d516-0a9b-79ec03f738de@gmail.com>
References: <3B710A67-CEB4-439A-8F5D-DABAE5EBB500@bittext.nl>
 <63804763-3bb0-d516-0a9b-79ec03f738de@gmail.com>
Message-ID: <9BD4D533-5115-4EB6-9ABD-A0F2E9088601@bittext.nl>



> On 19 Nov 2021, at 15:47, Wolfgang Schuster <wolfgang.schuster.lists at gmail.com> wrote:
> 
> Taco Hoekwater schrieb am 19.11.2021 um 15:34:
>> Hi,
>> 
>> It looks like the \offset command is not quite exact? See attached output, which I thought should be
>> exactly centred horizontally. Instead, it shifts too far to the left. Normally I would suspect a
>> stray space somewhere, but I do not see it...
> 
> Floats are centered by default and your offset destroys the alignment.

Ok, but then, should it not have given me 3mm to the left and to the right, then apply an
offset of -3mm, resulting in *all* of the extra 6mm to the left? yes? 

Ahâ¦ except that the centering of the float happens *after* the offset, and the \offset
actually adjusts the apparent width of the float (which is a bit unexpected, if you ask me). 

It ends up with 4.5mm to the left and 1.5 to the right, because the offset command has 
effectively *shrunken* the float. 

Well, now I get why Harald was confused all the time ;) 

.. but at last I get it. 


â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From taco at bittext.nl  Fri Nov 19 16:35:37 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 19 Nov 2021 16:35:37 +0100
Subject: [dev-context] \somewhere is broken in lmtx
Message-ID: <B2E1EE78-6D3B-4C2D-B2F5-B34AC11C4BB3@bittext.nl>

Hi,

It just seems to typeset all its arguments, or something. Works fine in mkiv mode.

MWE: https://wiki.contextgarden.net/Command/somewhere 

(I set the wiki example up to use mkiv instead so it looks ok there)

Best wishes,
Taco


â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From braslau.list at comcast.net  Sat Nov 20 04:26:02 2021
From: braslau.list at comcast.net (Alan Braslau)
Date: Fri, 19 Nov 2021 20:26:02 -0700
Subject: [dev-context] startfigure / placestartfigure confusion
In-Reply-To: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>
References: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>
Message-ID: <10657E12-DA26-419E-8CFA-D96D8DB2CF54@comcast.net>

Shouldn't it be:

\startfigure [reference=mycow]
  \externalfigure [cow.pdf] [width=4cm]
\stopfigure


> On 19Nov21, at 19/11/21, 06:35, Taco Hoekwater <taco at bittext.nl> wrote:
> 
> % MWE (assuming I understand the supposed syntax correctly):
> \starttext
> \startfigure[mycow][cow.pdf][width=4cm]
> ...
> \stopfigure
> some text
> \stoptext

--
Alan Braslau





From wolfgang.schuster.lists at gmail.com  Sat Nov 20 08:52:55 2021
From: wolfgang.schuster.lists at gmail.com (Wolfgang Schuster)
Date: Sat, 20 Nov 2021 08:52:55 +0100
Subject: [dev-context] startfigure / placestartfigure confusion
In-Reply-To: <10657E12-DA26-419E-8CFA-D96D8DB2CF54@comcast.net>
References: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>
 <10657E12-DA26-419E-8CFA-D96D8DB2CF54@comcast.net>
Message-ID: <66f37af0-5327-a0dc-1f1d-66734e1cf62a@gmail.com>

Alan Braslau schrieb am 20.11.2021 um 04:26:
> Shouldn't it be:
>
> \startfigure [reference=mycow]
>    \externalfigure [cow.pdf] [width=4cm]
> \stopfigure
>
>> On 19Nov21, at 19/11/21, 06:35, Taco Hoekwater <taco at bittext.nl> wrote:
>>
>> % MWE (assuming I understand the supposed syntax correctly):
>> \starttext
>> \startfigure[mycow][cow.pdf][width=4cm]
>> ...
>> \stopfigure
>> some text
>> \stoptext

No, this is \startplacefigure while Taco talks about a different mechanism.

The only example for the environment I ever saw is in the following 
manual (page 280ff):
https://www.yumpu.com/nl/document/view/17451692/context

Wolfgang


From wolfgang.schuster.lists at gmail.com  Sat Nov 20 12:29:58 2021
From: wolfgang.schuster.lists at gmail.com (Wolfgang Schuster)
Date: Sat, 20 Nov 2021 12:29:58 +0100
Subject: [dev-context] \somewhere is broken in lmtx
In-Reply-To: <B2E1EE78-6D3B-4C2D-B2F5-B34AC11C4BB3@bittext.nl>
References: <B2E1EE78-6D3B-4C2D-B2F5-B34AC11C4BB3@bittext.nl>
Message-ID: <acf44793-2019-64f2-6b37-f9b9f55d7767@gmail.com>

Taco Hoekwater schrieb am 19.11.2021 um 16:35:
> Hi,
>
> It just seems to typeset all its arguments, or something. Works fine in mkiv mode.
>
> MWE: https://wiki.contextgarden.net/Command/somewhere
>
> (I set the wiki example up to use mkiv instead so it looks ok there)

strc-ref.mklx:

The \numexpr isn't necessary but \relax has to be added after 
\referencepagedetail.

\def\strc_references_handle_page_state_yes
 Â  {\markreferencepage
-Â  \ifcase\referencepagedetail
+Â  \ifcase\numexpr\referencepagedetail\relax
 Â Â Â Â  \expandafter\sixthofsixarguments \or
 Â Â Â Â  \expandafter\thirdofsixarguments \or
 Â Â Â Â  \expandafter\firstofsixarguments \or
 Â Â Â Â  \expandafter\fifthofsixarguments \or
 Â Â Â Â  \expandafter\secondofsixarguments\or
 Â Â Â Â  \expandafter\fourthofsixarguments\else
 Â Â Â Â  \expandafter\sixthofsixarguments \fi}

Wolfgang


From j.hagen at xs4all.nl  Sat Nov 20 12:38:56 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sat, 20 Nov 2021 12:38:56 +0100
Subject: [dev-context] \somewhere is broken in lmtx
In-Reply-To: <acf44793-2019-64f2-6b37-f9b9f55d7767@gmail.com>
References: <B2E1EE78-6D3B-4C2D-B2F5-B34AC11C4BB3@bittext.nl>
 <acf44793-2019-64f2-6b37-f9b9f55d7767@gmail.com>
Message-ID: <7a99d1f9-9a65-a8e6-bb0b-8dfba5475fbd@xs4all.nl>

On 11/20/2021 12:29 PM, Wolfgang Schuster wrote:
> Taco Hoekwater schrieb am 19.11.2021 um 16:35:
>> Hi,
>>
>> It just seems to typeset all its arguments, or something. Works fine 
>> in mkiv mode.
>>
>> MWE: https://wiki.contextgarden.net/Command/somewhere
>>
>> (I set the wiki example up to use mkiv instead so it looks ok there)
> 
> strc-ref.mklx:
> 
> The \numexpr isn't necessary but \relax has to be added after 
> \referencepagedetail.
> 
> \def\strc_references_handle_page_state_yes
>  Â  {\markreferencepage
> -Â  \ifcase\referencepagedetail
> +Â  \ifcase\numexpr\referencepagedetail\relax
>  Â Â Â Â  \expandafter\sixthofsixarguments \or
>  Â Â Â Â  \expandafter\thirdofsixarguments \or
>  Â Â Â Â  \expandafter\firstofsixarguments \or
>  Â Â Â Â  \expandafter\fifthofsixarguments \or
>  Â Â Â Â  \expandafter\secondofsixarguments\or
>  Â Â Â Â  \expandafter\fourthofsixarguments\else
>  Â Â Â Â  \expandafter\sixthofsixarguments \fi}
ok, also mkiv

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From j.hagen at xs4all.nl  Sat Nov 20 13:42:16 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sat, 20 Nov 2021 13:42:16 +0100
Subject: [dev-context] startfigure / placestartfigure confusion
In-Reply-To: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>
References: <6568A87B-9F83-4647-BB11-999C8D86B711@bittext.nl>
Message-ID: <dba77bc2-9c8b-ec90-8dfe-6ecf9c6aa649@xs4all.nl>

On 11/19/2021 2:35 PM, Taco Hoekwater wrote:
> Hi all,
> 
> I was trying to document the \marking()() command (which is in itself a bit of an odd thing, but
> not the point of this message). It is supposedly to be used inside of
> 
>    \startfigure â¦ \stopfigure (lmtx)
> or with the old name:
>    \placestartfigure â¦ \placestopfigure (mkii/mkiv)
> 
> but as I was trying to produce an example, I discovered that
> 
>    \startfigure â¦ \stopfigure
> 
> does not seem to work at all ? no output appears. Is this command supposed to still work, even?
> 
> % MWE (assuming I understand the supposed syntax correctly):
> \starttext
> \startfigure[mycow][cow.pdf][width=4cm]
> ...
> \stopfigure
> some text
> \stoptext
that's an oldy ... pre-metapost, pre-positioning, pre-layers ... (maybe 
make it into a compatibility (auto loaded) module if not really used any 
more)

(1) parsing issue i.e. not adapted to recent 'upgrade'
(2) due to grouping the mechanism thinks ther ei sno image (so it also 
shows a dummy)

fixed (hackerish)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From modules at contextgarden.net  Mon Nov 22 14:00:51 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 22 Nov 2021 14:00:51 +0100
Subject: [dev-context] CGModules update: Transliterator version 2021-2
 published.
Message-ID: <20211122130051.928272896BD@zapf.ntg.nl>

Philipp Gesang submitted an update to the

               Transliterator

package.

Version number: 2021-2
License type: (unknown license status)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Inline Transliteration of contemporary and historical cyrillic, glagolitic and greek scripts.

Announcement text:
----------------------------------------------------------------------

Bugfix release

----------------------------------------------------------------------


From taco at bittext.nl  Tue Nov 23 15:21:25 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Tue, 23 Nov 2021 15:21:25 +0100
Subject: [dev-context] \placesubformula
Message-ID: <380BF835-C0F3-4184-9F89-7F1BCE63676F@bittext.nl>

Hi,

Could someone look at the example of 

  https://wiki.contextgarden.net/Command/placesubformula

please? 

I thought this command was supposed to produce subformula numbers, but perhaps I misunderstood something in the syntax ?

Best wishes,
Taco

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From taco at bittext.nl  Wed Nov 24 13:59:10 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Wed, 24 Nov 2021 13:59:10 +0100
Subject: [dev-context] \placenamedfloat ?
Message-ID: <294FE746-1828-4505-9DFC-6DD6BFFBBEE2@bittext.nl>

I just converted the wiki page:

  https://wiki.contextgarden.net/Command/placenamedfloat

But trying to run the example there â¦ it doesnât seem to work? Neither mkiv nor lmtx.


â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From j.hagen at xs4all.nl  Wed Nov 24 19:44:13 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Wed, 24 Nov 2021 19:44:13 +0100
Subject: [dev-context] \placenamedfloat ?
In-Reply-To: <294FE746-1828-4505-9DFC-6DD6BFFBBEE2@bittext.nl>
References: <294FE746-1828-4505-9DFC-6DD6BFFBBEE2@bittext.nl>
Message-ID: <f6727fd2-96c4-a914-0bcb-83095cb5ccd3@xs4all.nl>

On 11/24/2021 1:59 PM, Taco Hoekwater wrote:
> I just converted the wiki page:
> 
>    https://wiki.contextgarden.net/Command/placenamedfloat
> 
> But trying to run the example there â¦ it doesnât seem to work? Neither mkiv nor lmtx.
sorry ... crappy lpeg ... fixed in next upload

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From modules at contextgarden.net  Sat Nov 27 04:00:28 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sat, 27 Nov 2021 04:00:28 +0100
Subject: [dev-context] CGModules update: lua-widow-control version v1.1.1
 published.
Message-ID: <20211127030028.1D66428913A@zapf.ntg.nl>

Max Chernoff submitted an update to the

               lua-widow-control

package.

Version number: v1.1.1
License type: Mozilla Public License v2.0
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Automatically remove widows and orphans from any document

Announcement text:
----------------------------------------------------------------------

Minor documentation updates

----------------------------------------------------------------------


From taco at bittext.nl  Tue Nov 30 11:39:43 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Tue, 30 Nov 2021 11:39:43 +0100
Subject: [dev-context] \showlayout (more wiki stuff)
Message-ID: <E9B0A7BA-92F7-407F-BA80-3788584BA648@bittext.nl>

Hi,

Here is a question about \showlayout â¦ is that not supposed to print different variable values on each page? I tried this:

\setuppagenumbering [alternative=doublesided]
\definelayout[1][rightmargin=5mm,width=fit]
\definelayout[even][rightmargin=80mm,width=fit]
\definelayout[odd][rightmargin=50mm,width=fit]
\setuplayout
\starttext
\showlayout[3]
\stoptext

and it updates the frame correctly on each page, but always prints the initial layout variables â¦ I have 3 pages where only the frames differ.

Also, there is a fourth, empty page generated, but that I do not care much about.

Best wishes,
Taco



â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From taco at bittext.nl  Tue Nov 30 14:55:01 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Tue, 30 Nov 2021 14:55:01 +0100
Subject: [dev-context] \showmakeup (wiki)
Message-ID: <77DBD11F-8C5F-4916-8AD8-662E7F82A35C@bittext.nl>

Hi, 

See the bug report in: https://wiki.contextgarden.net/Command/showmakeup

Does that need fixing in the interface file, or should the bug report be converted into a 
simple note and a pointer to check the most recent options in the actual source file? 

X
Taco

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From j.hagen at xs4all.nl  Tue Nov 30 19:34:34 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Tue, 30 Nov 2021 19:34:34 +0100
Subject: [dev-context] \showmakeup (wiki)
In-Reply-To: <77DBD11F-8C5F-4916-8AD8-662E7F82A35C@bittext.nl>
References: <77DBD11F-8C5F-4916-8AD8-662E7F82A35C@bittext.nl>
Message-ID: <f31f90ef-13fd-7824-0d15-3bf2fab0692b@xs4all.nl>

On 11/30/2021 2:55 PM, Taco Hoekwater wrote:
> Hi,
> 
> See the bug report in: https://wiki.contextgarden.net/Command/showmakeup
> 
> Does that need fixing in the interface file, or should the bug report be converted into a
> simple note and a pointer to check the most recent options in the actual source file?
afaiks it's this now:

                 <cd:constant type="makeup" default="yes"/>
                 <cd:constant type="reset"/>
                 <cd:constant type="boxes"/>
                 <cd:constant type="all"/>
                 <cd:constant type="hbox"/>
                 <cd:constant type="vbox"/>
                 <cd:constant type="vtop"/>
                 <cd:constant type="origin"/>
                 <cd:constant type="kern"/>
                 <cd:constant type="glue"/>
                 <cd:constant type="penalty"/>
                 <cd:constant type="glyph"/>
                 <cd:constant type="discretionary"/>
                 <cd:constant type="italic"/>
                 <cd:constant type="expansion"/>
                 <cd:constant type="fontkern"/>
                 <cd:constant type="marginkern"/>
                 <cd:constant type="par"/>
                 <cd:constant type="dir"/>
                 <cd:constant type="line"/>
                 <cd:constant type="strut"/>
                 <cd:constant type="space"/>
                 <cd:constant type="depth"/>
                 <cd:constant type="insert"/>
                 <cd:constant type="mark"/>
                 <cd:constant type="math"/>
                 <cd:constant type="mathglue"/>
                 <cd:constant type="mathkern"/>
                 <cd:constant type="mathshapekern"/>
                 <cd:constant type="user"/>
                 <cd:constant type="whatsit"/>

simple box ones gone, a few more kern etc addes

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From j.hagen at xs4all.nl  Tue Nov 30 19:35:39 2021
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Tue, 30 Nov 2021 19:35:39 +0100
Subject: [dev-context] \showlayout (more wiki stuff)
In-Reply-To: <E9B0A7BA-92F7-407F-BA80-3788584BA648@bittext.nl>
References: <E9B0A7BA-92F7-407F-BA80-3788584BA648@bittext.nl>
Message-ID: <adf67c6d-165b-f7c2-f0f5-1259f1e9c5ac@xs4all.nl>

On 11/30/2021 11:39 AM, Taco Hoekwater wrote:
> Hi,
> 
> Here is a question about \showlayout â¦ is that not supposed to print different variable values on each page? I tried this:
> 
> \setuppagenumbering [alternative=doublesided]
> \definelayout[1][rightmargin=5mm,width=fit]
> \definelayout[even][rightmargin=80mm,width=fit]
> \definelayout[odd][rightmargin=50mm,width=fit]
> \setuplayout
> \starttext
> \showlayout[3]
> \stoptext
> 
> and it updates the frame correctly on each page, but always prints the initial layout variables â¦ I have 3 pages where only the frames differ.
> 
> Also, there is a fourth, empty page generated, but that I do not care much about.
no, the variables are only swapped on demand (in the otr and/or when we 
need them (e.g. when stuff goes into the margin, but then we also need 
to sync with the position)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at bittext.nl  Fri Dec  3 11:50:11 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 3 Dec 2021 11:50:11 +0100
Subject: [dev-context] columnsets lmtx crash
Message-ID: <0E40E5B8-7144-4DEA-9E92-5E3EFE0D2601@bittext.nl>

Hi,

I am still running this one:

  ConTeXt  ver: 2021.10.28 10:19 LMTX  fmt: 2021.11.1  int: english/english
  This is LuaMetaTeX, Version 2.09.26

because that matches the version installed on the wiki.  So this may well be outdated news, but
I noticed that on my machine (macos 11), using columnsets crashes the luametatex binary.

MWE:

\starttext
  \startcolumnset[n=2]
  \input knuth
  \stopcolumnset
\stoptext 

console output:
% context col         

resolvers       | formats | executing runner 'run luametatex format': /Users/taco/lmtx/tex/texmf-osx-64/bin/luametatex --jobname="./col.tex" --fmt=/Users/taco/lmtx/tex/texmf-cache/luametatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luametatex/cont-en.fmt --lua=/Users/taco/lmtx/tex/texmf-cache/luametatex-cache/context/5fe67e0bfe781ce0dde776fb1556f32e/formats/luametatex/cont-en.lui  --c:currentrun=1 --c:fulljobname="./col.tex" --c:input="./col.tex" --c:kindofrun=1 --c:maxnofruns=9 --c:texmfbinpath="/Users/taco/lmtx/tex/texmf-osx-64/bin"

system          > callbacks > not registering frozen 'local_box_filter'
job             > passes > version mismatch: 1.32 <> 1.33
system          > 
system          > ConTeXt  ver: 2021.10.28 10:19 LMTX  fmt: 2021.11.1  int: english/english
system          > 
system          > 'cont-new.mkxl' loaded
open source     > level 1, order 1, name '/Users/taco/lmtx/tex/texmf-context/tex/context/base/mkxl/cont-new.mkxl'
system          > beware: some patches loaded from cont-new.mkiv
close source    > level 1, order 1, name '/Users/taco/lmtx/tex/texmf-context/tex/context/base/mkxl/cont-new.mkxl'
system          > files > jobname './col', input './col.tex', result './col'
fonts           > latin modern fonts are not preloaded
languages       > language 'en' is active
open source     > level 1, order 2, name './col.tex'
fonts           > preloading latin modern fonts (second stage)
fonts           > 'fallback modern-designsize rm 12pt' is loaded
mtx-context     | fatal error: return code: 11



Best wishes,
Taco

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From andrei at borisov.dev  Fri Dec  3 12:14:58 2021
From: andrei at borisov.dev (andrei at borisov.dev)
Date: Fri, 3 Dec 2021 14:14:58 +0300
Subject: [dev-context] Incorrect installer script for musl
Message-ID: <3920C55D-B158-431B-8019-DA9B17E05601@borisov.dev>

Hi!

I think there is a bug in the installer script, particularly in http://lmtx.pragma-ade.nl/install-lmtx/context-linuxmusl.zip <http://lmtx.pragma-ade.nl/install-lmtx/context-linuxmusl.zip>

When trying to install I get the following error:

https://imgur.com/a/kPXmkBK <https://imgur.com/a/kPXmkBK>

Here are the lines that produce the error:

https://imgur.com/a/9r6eimT <https://imgur.com/a/9r6eimT>

Seems like the order of cp arguments should be the opposite.

I would be very thankful if this could be fixedð

Thanks in advance and take care,
Andrei Borisov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20211203/b3bf69ac/attachment.htm>

From taco at bittext.nl  Fri Dec  3 14:00:19 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Fri, 3 Dec 2021 14:00:19 +0100
Subject: [dev-context] Incorrect installer script for musl
In-Reply-To: <3920C55D-B158-431B-8019-DA9B17E05601@borisov.dev>
References: <3920C55D-B158-431B-8019-DA9B17E05601@borisov.dev>
Message-ID: <792B3DB4-903F-4801-96E8-C6A0ECC99083@bittext.nl>



> On 3 Dec 2021, at 12:14, andrei at borisov.dev wrote:
> 
> Hi!
> 
> I think there is a bug in the installer script, particularly in http://lmtx.pragma-ade.nl/install-lmtx/context-linuxmusl.zip
> 
> When trying to install I get the following error:
> 
> https://imgur.com/a/kPXmkBK
> 
> Here are the lines that produce the error:
> 
> https://imgur.com/a/9r6eimT
> 
> Seems like the order of cp arguments should be the opposite.

It goes wrong before that. The cp arguments are correct, but the download of these files has failed. In your first screenshot,
the line that says âmtx-install | provide valid server and instanceâ is indicating problem, because at that point it should
have said:

mtx-install     | server   : lmtx.pragma-ade.com
mtx-install     | instance : install-lmtx
mtx-install     | platform : osx-64
mtx-install     | system   : unix
mtx-install     | fetching 'http://lmtx.pragma-ade.com/install-lmtx//texmf.zipâ

do you have the program âcurlâ installed? If not, could you try installing that beforehand?


> 
> I would be very thankful if this could be fixedð
> 
> Thanks in advance and take care,
> Andrei Borisov.
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From taco at bittext.nl  Mon Dec  6 09:33:17 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Mon, 6 Dec 2021 09:33:17 +0100
Subject: [dev-context] subfloats
Message-ID: <30C8EBBF-2C69-4B1B-955B-3B87DA636677@bittext.nl>

Hi,

Triggered by a wiki edit: the \startsubfloatnumbering environment does not exist any more.

Is there some new method to get that functionality ?

See e.g. https://wiki.contextgarden.net/Floating_Objects#Subfloats

Best wishes,
Taco
â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From lists at homerow.info  Mon Dec  6 09:44:20 2021
From: lists at homerow.info (Marco Patzer)
Date: Mon, 6 Dec 2021 09:44:20 +0100
Subject: [dev-context] subfloats
In-Reply-To: <30C8EBBF-2C69-4B1B-955B-3B87DA636677@bittext.nl>
References: <30C8EBBF-2C69-4B1B-955B-3B87DA636677@bittext.nl>
Message-ID: <20211206094420.00beee5f@homerow>

On Mon, 6 Dec 2021 09:33:17 +0100
Taco Hoekwater <taco at bittext.nl> wrote:

> Triggered by a wiki edit: the \startsubfloatnumbering environment
> does not exist any more.
> 
> Is there some new method to get that functionality ?
> 
> See e.g. https://wiki.contextgarden.net/Floating_Objects#Subfloats

I edited those pages. It's the other way round: The command is too
new for the wiki, which is on 2021.10.28 10:19.
\startsubfloatnumbering has been implemented in late November.

Marco

From taco at bittext.nl  Mon Dec  6 10:24:02 2021
From: taco at bittext.nl (Taco Hoekwater)
Date: Mon, 6 Dec 2021 10:24:02 +0100
Subject: [dev-context] subfloats
In-Reply-To: <20211206094420.00beee5f@homerow>
References: <30C8EBBF-2C69-4B1B-955B-3B87DA636677@bittext.nl>
 <20211206094420.00beee5f@homerow>
Message-ID: <EBCA8949-E779-4682-9D0B-C926AEBF4B8C@bittext.nl>



> On 6 Dec 2021, at 09:44, Marco Patzer <lists at homerow.info> wrote:
> 
> On Mon, 6 Dec 2021 09:33:17 +0100
> Taco Hoekwater <taco at bittext.nl> wrote:
> 
>> Triggered by a wiki edit: the \startsubfloatnumbering environment
>> does not exist any more.
>> 
>> Is there some new method to get that functionality ?
>> 
>> See e.g. https://wiki.contextgarden.net/Floating_Objects#Subfloats
> 
> I edited those pages. It's the other way round: The command is too
> new for the wiki, which is on 2021.10.28 10:19.
> \startsubfloatnumbering has been implemented in late November.

Ah, ok. Thanks!
> 
> Marco
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context

â 
Taco Hoekwater              E: taco at bittext.nl
genderfluid (all pronouns)




From modules at contextgarden.net  Mon Dec  6 12:18:53 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 6 Dec 2021 12:18:53 +0100
Subject: [dev-context] CGModules new: PresVoz version 2021.12.06 published.
Message-ID: <20211206111853.4A665280D8E@zapf.ntg.nl>

Pablo Rodriguez submitted the new

               PresVoz

package.

Version number: 2021.12.06
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: no

Summary description: Generating presentations with voice.

Announcement text:
----------------------------------------------------------------------

Remote revision: 5b07a31, log message:
doc added

----------------------------------------------------------------------


From modules at contextgarden.net  Mon Dec 13 17:32:17 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Mon, 13 Dec 2021 17:32:17 +0100
Subject: [dev-context] CGModules update: vim syntax highlighting version
 2021.12.13 published.
Message-ID: <20211213163217.B91752A1A60@zapf.ntg.nl>

Aditya Mahajan submitted an update to the

               vim syntax highlighting

package.

Version number: 2021.12.13
License type: BSD License (simplified)
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: This module uses Vim editor's syntax files to syntax highlight verbatim code in ConTeXt

Announcement text:
----------------------------------------------------------------------

Bugfix release: 

* Fix a typo in t-syntax-highlighting. The module is written using slightly
  different catcodes than standard \unprotect catcodes. So, the module code
  should be inside: \unprotectmodulecatcodes ... \protectmodulecatcodes.

----------------------------------------------------------------------


From modules at contextgarden.net  Wed Dec 15 07:27:44 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Wed, 15 Dec 2021 07:27:44 +0100
Subject: [dev-context] CGModules update: lua-widow-control version v1.1.2
 published.
Message-ID: <20211215062744.AEC52283D81@zapf.ntg.nl>

Max Chernoff submitted an update to the

               lua-widow-control

package.

Version number: v1.1.2
License type: Mozilla Public License v2.0
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: yes

Summary description: Automatically remove widows and orphans from any document

Announcement text:
----------------------------------------------------------------------

Fix crash under ConTeXt LMTX

----------------------------------------------------------------------


From modules at contextgarden.net  Sun Dec 19 22:21:40 2021
From: modules at contextgarden.net (modules at contextgarden.net)
Date: Sun, 19 Dec 2021 22:21:40 +0100
Subject: [dev-context] CGModules update: PresVoz version 2021-12-19
 published.
Message-ID: <20211219212140.782E828650B@zapf.ntg.nl>

Pablo Rodriguez submitted an update to the

               PresVoz

package.

Version number: 2021-12-19
License type: GNU General Public License
Wants to be in ConTeXt distribution: yes
Wants to be synced with CTAN: no

Summary description: Generating presentations with voice.

Announcement text:
----------------------------------------------------------------------

Remote revision: ed85f22, log message:
proportional loader button

----------------------------------------------------------------------


