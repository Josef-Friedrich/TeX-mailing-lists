From schuster.wolfgang at gmail.com  Tue Jan 17 20:40:05 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 17 Jan 2017 20:40:05 +0100
Subject: [dev-context] syst-aux.lua
Message-ID: <587E7315.1030908@gmail.com>

Hi,

line 280 (extra t in triple):

local option = (
         P("single")
       + P("double")
-     + P("tripple")
+     + P("triple")
       + P("quadruple")
       + P("quintuple")
       + P("sixtuple")
   ) * (P("empty") + P("argument"))

Wolfgang

From schuster.wolfgang at gmail.com  Tue Jan 17 20:41:01 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 17 Jan 2017 20:41:01 +0100
Subject: [dev-context] syst-aux.lua
In-Reply-To: <587E7315.1030908@gmail.com>
References: <587E7315.1030908@gmail.com>
Message-ID: <587E734D.8060006@gmail.com>

> Wolfgang Schuster <mailto:schuster.wolfgang at gmail.com>
> 17. Januar 2017 um 20:40
> Hi,
>
> line 280 (extra t in triple):
should be line 260
> local option = (
>         P("single")
>       + P("double")
> -     + P("tripple")
> +     + P("triple")
>       + P("quadruple")
>       + P("quintuple")
>       + P("sixtuple")
>   ) * (P("empty") + P("argument"))
>
> Wolfgang
> ------------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170117/7a01be46/attachment.html>

From adityam at umich.edu  Mon Jan 23 09:26:04 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Mon, 23 Jan 2017 00:26:04 -0800 (PST)
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
Message-ID: <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>

On Tue, 27 Dec 2016, SaÅ¡o Å½ivanoviÄ wrote:

> I'm the author of a PGF/TikZ-based LaTeX package Forest for drawing 
> (linguistic) trees. I have received several requests to support ConTexT 
> and I'm trying to do that now.

Thank you for trying to port your code to ConTeXt. Although I don't 
foresee that I will use the forest package, I do use pgfplots quite a lot 
and appreciate the extra effort put in by the package authors to support 
two different macro packages.

> Forest uses a lot of \boxes. Actually, the number of boxes used cannot 
> be known in advance, as it depends on the document. Here's why: Forest's 
> main job is to place the nodes of a tree so that they don't overlap and 
> to do that, it needs to first typeset the individual nodes and measure 
> them. The typeset nodes are kept around and later used when typesetting 
> the entire tree.

I don't have an answer to your questions, but I am replying partly to bump 
this thread again.

> The typeset nodes are kept in "local" boxes. They are created using 
> \locbox, which is defined either by plain eTeX format or package 
> elocalloc.sty for LaTeX >2015. (Prior to LaTeX 2015, \locbox was defined 
> in etex.sty.) elocalloc.sty's \locbox is somewhat broken, but still 
> works, mainly because it seems no other package is using local 
> allocation. ;-)

Let me see if I understand this correctly.

You are asking how to define a macro, \locbox, such that the following 
code should not change the value of \c_syst_last_allocated_box.

\bgroup
\locbox\BoxOne
\locbox\BoxTwo

\BoxOne\hbox{Box One}
\BoxTow\hbox{Box Two}
% Do some measurement based on the size of the boxes
\egroup

The fact that a LaTeX package implements this behaviour by allocating 
local box numbers from the end seems to be an implementation detail.

I don't know the best way to implement such a macro in ConTeXt, but I want 
to make sure that the user-level behavior that you want is properly 
understood. Given the details in your question, one can easily lose the 
forest for the trees (pun intended :-)

Aditya

From saso.zivanovic at guest.arnes.si  Mon Jan 23 12:43:37 2017
From: saso.zivanovic at guest.arnes.si (=?UTF-8?B?U2HFoW8gxb1pdmFub3ZpxIc=?=)
Date: Mon, 23 Jan 2017 12:43:37 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
Message-ID: <3a0bee73-15be-5f0d-144f-51c02d254cba@guest.arnes.si>

On 23. 01. 2017 09:26, Aditya Mahajan wrote:
> I don't have an answer to your questions, but I am replying partly to
> bump this thread again.
Thanks!

>> The typeset nodes are kept in "local" boxes. They are created using
>> \locbox, which is defined either by plain eTeX format or package
>> elocalloc.sty for LaTeX >2015. (Prior to LaTeX 2015, \locbox was
>> defined in etex.sty.) elocalloc.sty's \locbox is somewhat broken, but
>> still works, mainly because it seems no other package is using local
>> allocation. ;-)
>
> Let me see if I understand this correctly.
>
> You are asking how to define a macro, \locbox, such that the following
> code should not change the value of \c_syst_last_allocated_box.
>
> \bgroup
> \locbox\BoxOne
> \locbox\BoxTwo
>
> \BoxOne\hbox{Box One}
> \BoxTow\hbox{Box Two}
You probably meant \setbox\BoxOne\hbox{Box One}
> % Do some measurement based on the size of the boxes
> \egroup
Essentially, yes.

The intro section to package localloc (afaik, historically the first 
package to implement local register allocation) might shed some light on 
the issue as well.
http://ctan.org/pkg/localloc

> The fact that a LaTeX package implements this behaviour by allocating
> local box numbers from the end seems to be an implementation detail.
True, although I'm not aware of any other possibility to implement this.

> I don't know the best way to implement such a macro in ConTeXt, but I
> want to make sure that the user-level behavior that you want is properly
> understood. Given the details in your question, one can easily lose the
> forest for the trees (pun intended :-)
Damn. Precisely what the users say about my documentation! ;-)

Best,
SaÅ¡o

>
> Aditya


From pragma at wxs.nl  Tue Jan 24 09:52:42 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Jan 2017 09:52:42 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
Message-ID: <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>

On 1/23/2017 9:26 AM, Aditya Mahajan wrote:
> On Tue, 27 Dec 2016, SaÅ¡o Å½ivanoviÄ wrote:
>
>> I'm the author of a PGF/TikZ-based LaTeX package Forest for drawing
>> (linguistic) trees. I have received several requests to support
>> ConTexT and I'm trying to do that now.
>
> Thank you for trying to port your code to ConTeXt. Although I don't
> foresee that I will use the forest package, I do use pgfplots quite a
> lot and appreciate the extra effort put in by the package authors to
> support two different macro packages.
>
>> Forest uses a lot of \boxes. Actually, the number of boxes used cannot
>> be known in advance, as it depends on the document. Here's why:
>> Forest's main job is to place the nodes of a tree so that they don't
>> overlap and to do that, it needs to first typeset the individual nodes
>> and measure them. The typeset nodes are kept around and later used
>> when typesetting the entire tree.
>
> I don't have an answer to your questions, but I am replying partly to
> bump this thread again.
>
>> The typeset nodes are kept in "local" boxes. They are created using
>> \locbox, which is defined either by plain eTeX format or package
>> elocalloc.sty for LaTeX >2015. (Prior to LaTeX 2015, \locbox was
>> defined in etex.sty.) elocalloc.sty's \locbox is somewhat broken, but
>> still works, mainly because it seems no other package is using local
>> allocation. ;-)
>
> Let me see if I understand this correctly.
>
> You are asking how to define a macro, \locbox, such that the following
> code should not change the value of \c_syst_last_allocated_box.
>
> \bgroup
> \locbox\BoxOne
> \locbox\BoxTwo
>
> \BoxOne\hbox{Box One}
> \BoxTow\hbox{Box Two}
> % Do some measurement based on the size of the boxes
> \egroup
>
> The fact that a LaTeX package implements this behaviour by allocating
> local box numbers from the end seems to be an implementation detail.
>
> I don't know the best way to implement such a macro in ConTeXt, but I
> want to make sure that the user-level behavior that you want is properly
> understood. Given the details in your question, one can easily lose the
> forest for the trees (pun intended :-)

\unprotect

\installcorenamespace{localbox}

\unexpanded\def\newlocalbox#1%
   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
    \ifx#1\relax
      \syst_aux_new_localbox#1%
    \fi}

\def\syst_aux_new_localbox#1%
   {\expandafter\newbox\csname\??localbox\string#1\endcsname
    \newlocalbox#1}

\protect

\starttext

\newlocalbox\BoxOne
\newlocalbox\BoxTwo

\setbox\BoxOne\hbox{Box One}
\setbox\BoxTwo\hbox{Box Two}

[\box\BoxTwo]
[\box\BoxOne]

\let\locbox\newlocalbox

\stoptext

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From saso.zivanovic at guest.arnes.si  Tue Jan 24 10:54:38 2017
From: saso.zivanovic at guest.arnes.si (=?UTF-8?B?U2HFoW8gxb1pdmFub3ZpxIc=?=)
Date: Tue, 24 Jan 2017 10:54:38 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
Message-ID: <a2a31cba-3cb4-1fba-9caf-12ff8c030a5c@guest.arnes.si>

I'm afraid this doesn't do the trick: \c_syst_last_allocated_box is 
definitely incremented.

Let me try explaining again. This is essentially what I do:

{
   \newbox\TempBox
   \setbox\TempBox\hbox{Box One}
   \let\BoxOne\TempBox
   \global\let\TempBox\relax

   \newbox\TempBox
   \setbox\TempBox\hbox{Box Two}
   \let\BoxTwo\TempBox
   \global\let\TempBox\relax

   \the\numexpr\BoxOne: [\box\BoxOne]
   \the\numexpr\BoxTwo: [\box\BoxTwo]
}

But I want the number of available box registers at entering and exiting 
the group to be the same, and substituting \newbox for \locbox is what 
does the trick in my package. So I can run the following a million times:

{
   \newlocalbox\TempBox
   \setbox\TempBox\hbox{Box One}
   \let\BoxOne\TempBox
   \global\let\TempBox\relax

   \newlocalbox\TempBox
   \setbox\TempBox\hbox{Box Two}
   \let\BoxTwo\TempBox
   \global\let\TempBox\relax

   \the\numexpr\BoxOne: [\box\BoxOne]
   \the\numexpr\BoxTwo: [\box\BoxTwo]
}

Each of the million "\the\numexpr\BoxOne" should produce the same 
number, whereas in the \newbox-based example these numbers increment.

Best,
SaÅ¡o

On 24. 01. 2017 09:52, Hans Hagen wrote:
>> You are asking how to define a macro, \locbox, such that the following
>> code should not change the value of \c_syst_last_allocated_box.
>>
>> \bgroup
>> \locbox\BoxOne
>> \locbox\BoxTwo
>>
>> \BoxOne\hbox{Box One}
>> \BoxTow\hbox{Box Two}
>> % Do some measurement based on the size of the boxes
>> \egroup
>>
>> The fact that a LaTeX package implements this behaviour by allocating
>> local box numbers from the end seems to be an implementation detail.
>>
>> I don't know the best way to implement such a macro in ConTeXt, but I
>> want to make sure that the user-level behavior that you want is properly
>> understood. Given the details in your question, one can easily lose the
>> forest for the trees (pun intended :-)
>
> \unprotect
>
> \installcorenamespace{localbox}
>
> \unexpanded\def\newlocalbox#1%
>   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
>    \ifx#1\relax
>      \syst_aux_new_localbox#1%
>    \fi}
>
> \def\syst_aux_new_localbox#1%
>   {\expandafter\newbox\csname\??localbox\string#1\endcsname
>    \newlocalbox#1}
>
> \protect
>
> \starttext
>
> \newlocalbox\BoxOne
> \newlocalbox\BoxTwo
>
> \setbox\BoxOne\hbox{Box One}
> \setbox\BoxTwo\hbox{Box Two}
>
> [\box\BoxTwo]
> [\box\BoxOne]
>
> \let\locbox\newlocalbox
>
> \stoptext
>
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context


From saso.zivanovic at guest.arnes.si  Tue Jan 24 15:05:46 2017
From: saso.zivanovic at guest.arnes.si (=?UTF-8?B?U2HFoW8gxb1pdmFub3ZpxIc=?=)
Date: Tue, 24 Jan 2017 15:05:46 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
Message-ID: <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>

Dear Hans,

thank you very much for helping me out here.

Aditya's rephrasal of the question might have shown a tree but hidden 
the forest ... ;-)  Let me try to explain below, but please also take a 
look at my original post, 
https://mailman.ntg.nl/pipermail/dev-context/2016/003346.html.

As far as I can see, in your 10 million example I can only work on one 
of the local boxes at the time, whereas I need to save an undetermined 
number of boxes, do some computation which uses dimensions of all these 
boxes (this computation potentially invokes user's code, so I don't have 
control over it), and then use all the saved boxes.
(Btw, saving just the dimensions is not an acceptable solution, both 
because of speed and because in general, setting the box with same 
content twice won't yield the same result.)

As the number of needed boxes cannot be known in advance, I'd like to be 
nice and "give them back" to the allocation system after using them. And 
I *do* know how to do that (see localloc, elocalloc, or etex), but I'm 
not sure if it would cause any trouble in ConTeXt: I'd prefer "not to 
mess with allocation" indeed and have the issue fixed systemically.

 > The overhead is just one box per name and you probably don't allocate 
 > a million unique tempboxes as you will then already ran out of names.
I believe this overhead is precisely what I'm trying to avoid. A further 
detail of my situation might help. I've got, for each node of the tree:
\locbox\tempbox
\setbox\tempbox\hbox{...}
\expandafter\let\csname node<id>@box\endcsname\tempbox

 > Messing with the allocation can fail because when the content of the
 > boxes triggers a new box allocation itself that one might be forgotten
 > as well.
I'm not sure I get this. Even if the new box allocation was global (so, 
the usual \newbox)?

Best,
SaÅ¡o

P.S. And I did test it! Albeit with two iterations, not ten million. ;-)



On 24. 01. 2017 13:48, Hans Hagen wrote:
> On 1/24/2017 10:47 AM, SaÅ¡o Å½ivanoviÄ wrote:
>> I'm afraid this doesn't do the trick: \c_syst_last_allocated_box is
>> definitely incremented.
>>
>> Let me try explaining again. This is essentially what I do:
>>
>> {
>>   \newbox\TempBox
>>   \setbox\TempBox\hbox{Box One}
>>   \let\BoxOne\TempBox
>>   \global\let\TempBox\relax
>>
>>   \newbox\TempBox
>>   \setbox\TempBox\hbox{Box Two}
>>   \let\BoxTwo\TempBox
>>   \global\let\TempBox\relax
>>
>>   \the\numexpr\BoxOne: [\box\BoxOne]
>>   \the\numexpr\BoxTwo: [\box\BoxTwo]
>> }
>>
>> But I want the number of available box registers at entering and exiting
>> the group to be the same, and substituting \newbox for \locbox is what
>> does the trick in my package. So I can run the following a million times:
>>
>> {
>>   \newlocalbox\TempBox
>>   \setbox\TempBox\hbox{Box One}
>>   \let\BoxOne\TempBox
>>   \global\let\TempBox\relax
>>
>>   \newlocalbox\TempBox
>>   \setbox\TempBox\hbox{Box Two}
>>   \let\BoxTwo\TempBox
>>   \global\let\TempBox\relax
>>
>>   \the\numexpr\BoxOne: [\box\BoxOne]
>>   \the\numexpr\BoxTwo: [\box\BoxTwo]
>> }
>>
>> Each of the million "\the\numexpr\BoxOne" should produce the same
>> number, whereas in the \newbox-based example these numbers increment.
>
> I suppose you didn't test it ...
>
> \starttext
>
> % \unprotect
> %
> % \installcorenamespace{localbox}
> %
> % \unexpanded\def\newlocalbox#1%
> %   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
> %    \ifx#1\relax
> %      \syst_aux_new_localbox#1%
> %    \fi}
> %
> % \def\syst_aux_new_localbox#1%
> %   {\expandafter\newbox\csname\??localbox\string#1\endcsname
> %    \newlocalbox#1}
> %
> % \protect
>
> \newbox\MyBoxA \number\MyBoxA
>
> \dorecurse{10} {
>     \dorecurse{1000000} {
>         \newlocalbox\TempBox
>     }
>     \writestatus{!!!}{#1 million done}
>     #1: \number\TempBox\par
> }
>
> \newbox\MyBoxB \number\MyBoxB
>
> \stoptext
>
> The overhead is just one box per name and you probably don't allocate a
> million unique tempboxes as you will then already ran out of names.
>
> Messing with the allocation can fail because when the content of the
> boxes triggers a new box allocation itself that one might be forgotten
> as well.
>
>> Best,
>> SaÅ¡o
>>
>> On 24. 01. 2017 09:52, Hans Hagen wrote:
>>>> You are asking how to define a macro, \locbox, such that the following
>>>> code should not change the value of \c_syst_last_allocated_box.
>>>>
>>>> \bgroup
>>>> \locbox\BoxOne
>>>> \locbox\BoxTwo
>>>>
>>>> \BoxOne\hbox{Box One}
>>>> \BoxTow\hbox{Box Two}
>>>> % Do some measurement based on the size of the boxes
>>>> \egroup
>>>>
>>>> The fact that a LaTeX package implements this behaviour by allocating
>>>> local box numbers from the end seems to be an implementation detail.
>>>>
>>>> I don't know the best way to implement such a macro in ConTeXt, but I
>>>> want to make sure that the user-level behavior that you want is
>>>> properly
>>>> understood. Given the details in your question, one can easily lose the
>>>> forest for the trees (pun intended :-)
>>>
>>> \unprotect
>>>
>>> \installcorenamespace{localbox}
>>>
>>> \unexpanded\def\newlocalbox#1%
>>>   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
>>>    \ifx#1\relax
>>>      \syst_aux_new_localbox#1%
>>>    \fi}
>>>
>>> \def\syst_aux_new_localbox#1%
>>>   {\expandafter\newbox\csname\??localbox\string#1\endcsname
>>>    \newlocalbox#1}
>>>
>>> \protect
>>>
>>> \starttext
>>>
>>> \newlocalbox\BoxOne
>>> \newlocalbox\BoxTwo
>>>
>>> \setbox\BoxOne\hbox{Box One}
>>> \setbox\BoxTwo\hbox{Box Two}
>>>
>>> [\box\BoxTwo]
>>> [\box\BoxOne]
>>>
>>> \let\locbox\newlocalbox
>>>
>>> \stoptext
>>>
>>> -----------------------------------------------------------------
>>>                                           Hans Hagen | PRAGMA ADE
>>>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>>>        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
>>> -----------------------------------------------------------------
>>> _______________________________________________
>>> dev-context mailing list
>>> dev-context at ntg.nl
>>> https://mailman.ntg.nl/mailman/listinfo/dev-context
>>
>
>


From pragma at wxs.nl  Tue Jan 24 16:36:02 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Jan 2017 16:36:02 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
 <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
Message-ID: <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>

On 1/24/2017 3:05 PM, SaÅ¡o Å½ivanoviÄ wrote:
> Dear Hans,
>
> thank you very much for helping me out here.
>
> Aditya's rephrasal of the question might have shown a tree but hidden
> the forest ... ;-)  Let me try to explain below, but please also take a
> look at my original post,
> https://mailman.ntg.nl/pipermail/dev-context/2016/003346.html.
>
> As far as I can see, in your 10 million example I can only work on one
> of the local boxes at the time, whereas I need to save an undetermined
> number of boxes, do some computation which uses dimensions of all these
> boxes (this computation potentially invokes user's code, so I don't have
> control over it), and then use all the saved boxes.
> (Btw, saving just the dimensions is not an acceptable solution, both
> because of speed and because in general, setting the box with same
> content twice won't yield the same result.)

Just try it ...

\newbox\MyBoxA \number\MyBoxA

\dorecurse{2} {
     \dorecurse{1000000} {
         \newlocalbox\TempBoxA
         \newlocalbox\TempBoxB
         \newlocalbox\TempBoxC
         \newlocalbox\TempBoxD
         \newlocalbox\TempBoxE
     }
     \writestatus{!!!}{#1 million done}
     #1: \number\TempBoxA\par
     #1: \number\TempBoxB\par
     #1: \number\TempBoxC\par
     #1: \number\TempBoxD\par
     #1: \number\TempBoxE\par
}

\newbox\MyBoxB \number\MyBoxB

\stoptext

overhead: 5 boxes in 2*1 million (or more) allocations

so, if a user needs 15.000 boxes locally you have an overhead of 15.000 
but the second time if he/she uses the same names the overhead doesn't 
grow ... in fact, if he/she uses 15K new names also the hash will get 
them (even if they get undefined later)

> As the number of needed boxes cannot be known in advance, I'd like to be
> nice and "give them back" to the allocation system after using them. And
> I *do* know how to do that (see localloc, elocalloc, or etex), but I'm
> not sure if it would cause any trouble in ConTeXt: I'd prefer "not to
> mess with allocation" indeed and have the issue fixed systemically.

no need to give them back ..

>> The overhead is just one box per name and you probably don't allocate
>> a million unique tempboxes as you will then already ran out of names.
> I believe this overhead is precisely what I'm trying to avoid. A further
> detail of my situation might help. I've got, for each node of the tree:
> \locbox\tempbox
> \setbox\tempbox\hbox{...}
> \expandafter\let\csname node<id>@box\endcsname\tempbox
>
>> Messing with the allocation can fail because when the content of the
>> boxes triggers a new box allocation itself that one might be forgotten
>> as well.
> I'm not sure I get this. Even if the new box allocation was global (so,
> the usual \newbox)?

sure ... with 2 million:

452
1: 453
1: 454
1: 455
1: 456
1: 457
2: 453
2: 454
2: 455
2: 456
2: 457
458

so, only 5 slots used and lots left

> Best,
> SaÅ¡o
>
> P.S. And I did test it! Albeit with two iterations, not ten million. ;-)
>
>
>
> On 24. 01. 2017 13:48, Hans Hagen wrote:
>> On 1/24/2017 10:47 AM, SaÅ¡o Å½ivanoviÄ wrote:
>>> I'm afraid this doesn't do the trick: \c_syst_last_allocated_box is
>>> definitely incremented.
>>>
>>> Let me try explaining again. This is essentially what I do:
>>>
>>> {
>>>   \newbox\TempBox
>>>   \setbox\TempBox\hbox{Box One}
>>>   \let\BoxOne\TempBox
>>>   \global\let\TempBox\relax
>>>
>>>   \newbox\TempBox
>>>   \setbox\TempBox\hbox{Box Two}
>>>   \let\BoxTwo\TempBox
>>>   \global\let\TempBox\relax
>>>
>>>   \the\numexpr\BoxOne: [\box\BoxOne]
>>>   \the\numexpr\BoxTwo: [\box\BoxTwo]
>>> }
>>>
>>> But I want the number of available box registers at entering and exiting
>>> the group to be the same, and substituting \newbox for \locbox is what
>>> does the trick in my package. So I can run the following a million
>>> times:
>>>
>>> {
>>>   \newlocalbox\TempBox
>>>   \setbox\TempBox\hbox{Box One}
>>>   \let\BoxOne\TempBox
>>>   \global\let\TempBox\relax
>>>
>>>   \newlocalbox\TempBox
>>>   \setbox\TempBox\hbox{Box Two}
>>>   \let\BoxTwo\TempBox
>>>   \global\let\TempBox\relax
>>>
>>>   \the\numexpr\BoxOne: [\box\BoxOne]
>>>   \the\numexpr\BoxTwo: [\box\BoxTwo]
>>> }
>>>
>>> Each of the million "\the\numexpr\BoxOne" should produce the same
>>> number, whereas in the \newbox-based example these numbers increment.
>>
>> I suppose you didn't test it ...
>>
>> \starttext
>>
>> % \unprotect
>> %
>> % \installcorenamespace{localbox}
>> %
>> % \unexpanded\def\newlocalbox#1%
>> %   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
>> %    \ifx#1\relax
>> %      \syst_aux_new_localbox#1%
>> %    \fi}
>> %
>> % \def\syst_aux_new_localbox#1%
>> %   {\expandafter\newbox\csname\??localbox\string#1\endcsname
>> %    \newlocalbox#1}
>> %
>> % \protect
>>
>> \newbox\MyBoxA \number\MyBoxA
>>
>> \dorecurse{10} {
>>     \dorecurse{1000000} {
>>         \newlocalbox\TempBox
>>     }
>>     \writestatus{!!!}{#1 million done}
>>     #1: \number\TempBox\par
>> }
>>
>> \newbox\MyBoxB \number\MyBoxB
>>
>> \stoptext
>>
>> The overhead is just one box per name and you probably don't allocate a
>> million unique tempboxes as you will then already ran out of names.
>>
>> Messing with the allocation can fail because when the content of the
>> boxes triggers a new box allocation itself that one might be forgotten
>> as well.
>>
>>> Best,
>>> SaÅ¡o
>>>
>>> On 24. 01. 2017 09:52, Hans Hagen wrote:
>>>>> You are asking how to define a macro, \locbox, such that the following
>>>>> code should not change the value of \c_syst_last_allocated_box.
>>>>>
>>>>> \bgroup
>>>>> \locbox\BoxOne
>>>>> \locbox\BoxTwo
>>>>>
>>>>> \BoxOne\hbox{Box One}
>>>>> \BoxTow\hbox{Box Two}
>>>>> % Do some measurement based on the size of the boxes
>>>>> \egroup
>>>>>
>>>>> The fact that a LaTeX package implements this behaviour by allocating
>>>>> local box numbers from the end seems to be an implementation detail.
>>>>>
>>>>> I don't know the best way to implement such a macro in ConTeXt, but I
>>>>> want to make sure that the user-level behavior that you want is
>>>>> properly
>>>>> understood. Given the details in your question, one can easily lose
>>>>> the
>>>>> forest for the trees (pun intended :-)
>>>>
>>>> \unprotect
>>>>
>>>> \installcorenamespace{localbox}
>>>>
>>>> \unexpanded\def\newlocalbox#1%
>>>>   {\expandafter\let\expandafter#1\csname\??localbox\string#1\endcsname
>>>>    \ifx#1\relax
>>>>      \syst_aux_new_localbox#1%
>>>>    \fi}
>>>>
>>>> \def\syst_aux_new_localbox#1%
>>>>   {\expandafter\newbox\csname\??localbox\string#1\endcsname
>>>>    \newlocalbox#1}
>>>>
>>>> \protect
>>>>
>>>> \starttext
>>>>
>>>> \newlocalbox\BoxOne
>>>> \newlocalbox\BoxTwo
>>>>
>>>> \setbox\BoxOne\hbox{Box One}
>>>> \setbox\BoxTwo\hbox{Box Two}
>>>>
>>>> [\box\BoxTwo]
>>>> [\box\BoxOne]
>>>>
>>>> \let\locbox\newlocalbox
>>>>
>>>> \stoptext
>>>>
>>>> -----------------------------------------------------------------
>>>>                                           Hans Hagen | PRAGMA ADE
>>>>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>>>>        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
>>>> -----------------------------------------------------------------
>>>> _______________________________________________
>>>> dev-context mailing list
>>>> dev-context at ntg.nl
>>>> https://mailman.ntg.nl/mailman/listinfo/dev-context
>>>
>>
>>
>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From saso.zivanovic at guest.arnes.si  Tue Jan 24 17:04:57 2017
From: saso.zivanovic at guest.arnes.si (=?UTF-8?B?U2HFoW8gxb1pdmFub3ZpxIc=?=)
Date: Tue, 24 Jan 2017 17:04:57 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
 <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
 <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>
Message-ID: <df87942c-c750-64b5-91ca-c78758a6a7ad@guest.arnes.si>

On 24. 01. 2017 16:36, Hans Hagen wrote:
> On 1/24/2017 3:05 PM, SaÅ¡o Å½ivanoviÄ wrote:
>> Dear Hans,
>>
>> thank you very much for helping me out here.
>>
>> Aditya's rephrasal of the question might have shown a tree but hidden
>> the forest ... ;-)  Let me try to explain below, but please also take a
>> look at my original post,
>> https://mailman.ntg.nl/pipermail/dev-context/2016/003346.html.
>>
>> As far as I can see, in your 10 million example I can only work on one
>> of the local boxes at the time, whereas I need to save an undetermined
>> number of boxes, do some computation which uses dimensions of all these
>> boxes (this computation potentially invokes user's code, so I don't have
>> control over it), and then use all the saved boxes.
>> (Btw, saving just the dimensions is not an acceptable solution, both
>> because of speed and because in general, setting the box with same
>> content twice won't yield the same result.)
>
> Just try it ...
>
> \newbox\MyBoxA \number\MyBoxA
>
> \dorecurse{2} {
>     \dorecurse{1000000} {
>         \newlocalbox\TempBoxA
>         \newlocalbox\TempBoxB
>         \newlocalbox\TempBoxC
>         \newlocalbox\TempBoxD
>         \newlocalbox\TempBoxE
>     }
>     \writestatus{!!!}{#1 million done}
>     #1: \number\TempBoxA\par
>     #1: \number\TempBoxB\par
>     #1: \number\TempBoxC\par
>     #1: \number\TempBoxD\par
>     #1: \number\TempBoxE\par
> }
>
> \newbox\MyBoxB \number\MyBoxB
>
> \stoptext
>
> overhead: 5 boxes in 2*1 million (or more) allocations

But not if:

\def\csnewlocalbox#1{\expandafter\newlocalbox\csname #1\endcsname}
\def\csboxnumber#1{\expandafter\number\csname #1\endcsname}

\starttext

\newbox\MyBoxA \number\MyBoxA

\dorecurse{2} {
     \dorecurse{1000} {
         \csnewlocalbox{TempBox#1-1}%
         \csnewlocalbox{TempBox#1-2}%
         \csnewlocalbox{TempBox#1-3}%
         \csnewlocalbox{TempBox#1-4}%
         \csnewlocalbox{TempBox#1-5}%
     }
     \writestatus{!!!}{#1 million done}
     #1: \csboxnumber{TempBox#1-1}\par
     #1: \csboxnumber{TempBox#1-2}\par
     #1: \csboxnumber{TempBox#1-3}\par
     #1: \csboxnumber{TempBox#1-4}\par
     #1: \csboxnumber{TempBox#1-5}\par
}

\newbox\MyBoxB \number\MyBoxB

\stoptext


However, I see your point now. If I use a consistent naming scheme (and 
I do) and allocate using \csnewlocalbox{node<id>@box}, the boxes will be 
reused.

>
> so, if a user needs 15.000 boxes locally you have an overhead of 15.000
> but the second time if he/she uses the same names the overhead doesn't
> grow ... in fact, if he/she uses 15K new names also the hash will get
> them (even if they get undefined later)
>
>> As the number of needed boxes cannot be known in advance, I'd like to be
>> nice and "give them back" to the allocation system after using them. And
>> I *do* know how to do that (see localloc, elocalloc, or etex), but I'm
>> not sure if it would cause any trouble in ConTeXt: I'd prefer "not to
>> mess with allocation" indeed and have the issue fixed systemically.
>
> no need to give them back ..
Well, imho, that's bad programming practice, but the fault goes all the 
way back to plain TeX ...


Thanks for being patient with me!
SaÅ¡o


From pragma at wxs.nl  Tue Jan 24 17:33:22 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Jan 2017 17:33:22 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <df87942c-c750-64b5-91ca-c78758a6a7ad@guest.arnes.si>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
 <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
 <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>
 <df87942c-c750-64b5-91ca-c78758a6a7ad@guest.arnes.si>
Message-ID: <81dda245-eed3-38a3-387b-7bff1868dbc3@wxs.nl>

On 1/24/2017 5:04 PM, SaÅ¡o Å½ivanoviÄ wrote:
> On 24. 01. 2017 16:36, Hans Hagen wrote:
>> On 1/24/2017 3:05 PM, SaÅ¡o Å½ivanoviÄ wrote:
>>> Dear Hans,
>>>
>>> thank you very much for helping me out here.
>>>
>>> Aditya's rephrasal of the question might have shown a tree but hidden
>>> the forest ... ;-)  Let me try to explain below, but please also take a
>>> look at my original post,
>>> https://mailman.ntg.nl/pipermail/dev-context/2016/003346.html.
>>>
>>> As far as I can see, in your 10 million example I can only work on one
>>> of the local boxes at the time, whereas I need to save an undetermined
>>> number of boxes, do some computation which uses dimensions of all these
>>> boxes (this computation potentially invokes user's code, so I don't have
>>> control over it), and then use all the saved boxes.
>>> (Btw, saving just the dimensions is not an acceptable solution, both
>>> because of speed and because in general, setting the box with same
>>> content twice won't yield the same result.)
>>
>> Just try it ...
>>
>> \newbox\MyBoxA \number\MyBoxA
>>
>> \dorecurse{2} {
>>     \dorecurse{1000000} {
>>         \newlocalbox\TempBoxA
>>         \newlocalbox\TempBoxB
>>         \newlocalbox\TempBoxC
>>         \newlocalbox\TempBoxD
>>         \newlocalbox\TempBoxE
>>     }
>>     \writestatus{!!!}{#1 million done}
>>     #1: \number\TempBoxA\par
>>     #1: \number\TempBoxB\par
>>     #1: \number\TempBoxC\par
>>     #1: \number\TempBoxD\par
>>     #1: \number\TempBoxE\par
>> }
>>
>> \newbox\MyBoxB \number\MyBoxB
>>
>> \stoptext
>>
>> overhead: 5 boxes in 2*1 million (or more) allocations
>
> But not if:
>
> \def\csnewlocalbox#1{\expandafter\newlocalbox\csname #1\endcsname}
> \def\csboxnumber#1{\expandafter\number\csname #1\endcsname}
>
> \starttext
>
> \newbox\MyBoxA \number\MyBoxA
>
> \dorecurse{2} {
>     \dorecurse{1000} {
>         \csnewlocalbox{TempBox#1-1}%
>         \csnewlocalbox{TempBox#1-2}%
>         \csnewlocalbox{TempBox#1-3}%
>         \csnewlocalbox{TempBox#1-4}%
>         \csnewlocalbox{TempBox#1-5}%
>     }
>     \writestatus{!!!}{#1 million done}
>     #1: \csboxnumber{TempBox#1-1}\par
>     #1: \csboxnumber{TempBox#1-2}\par
>     #1: \csboxnumber{TempBox#1-3}\par
>     #1: \csboxnumber{TempBox#1-4}\par
>     #1: \csboxnumber{TempBox#1-5}\par
> }
>
> \newbox\MyBoxB \number\MyBoxB
>
> \stoptext

even then you only get 5000 boxes defined ... you can reset the storag 
of course but you still have 5000 hash entries (mening \undefined then) 
with names like TempBox*-*

\starttext

\dorecurse{100}
   {\bgroup
    \dorecurse{10000}
      {\expandafter\def\csname foo:#1:##1\endcsname{}}
    \egroup}

\stoptext

so in the end it doesn't matter much that the boxes are allocated given 
that one reuses names

> However, I see your point now. If I use a consistent naming scheme (and
> I do) and allocate using \csnewlocalbox{node<id>@box}, the boxes will be
> reused.
>
>>
>> so, if a user needs 15.000 boxes locally you have an overhead of 15.000
>> but the second time if he/she uses the same names the overhead doesn't
>> grow ... in fact, if he/she uses 15K new names also the hash will get
>> them (even if they get undefined later)
>>
>>> As the number of needed boxes cannot be known in advance, I'd like to be
>>> nice and "give them back" to the allocation system after using them. And
>>> I *do* know how to do that (see localloc, elocalloc, or etex), but I'm
>>> not sure if it would cause any trouble in ConTeXt: I'd prefer "not to
>>> mess with allocation" indeed and have the issue fixed systemically.
>>
>> no need to give them back ..
> Well, imho, that's bad programming practice, but the fault goes all the
> way back to plain TeX ...

and with the fact that we have a macro language with a grouping model 
and even worse, users who can do unexpected things like

\starttext

\bgroup
   \newlocalbox\foo
   \setbox\foo\hbox\bgroup
     bar
     \ifdefined\oof\else\newbox\oof\fi
     \global\setbox\oof\hbox{foo}
   \egroup
\egroup

\box\oof

\stoptext

when we would reset the allocator count then \oof would still be ok but 
its slot would be reallocated at some point by \newlocalbox


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From saso.zivanovic at guest.arnes.si  Thu Jan 26 17:02:15 2017
From: saso.zivanovic at guest.arnes.si (=?UTF-8?B?U2HFoW8gxb1pdmFub3ZpxIc=?=)
Date: Thu, 26 Jan 2017 17:02:15 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <81dda245-eed3-38a3-387b-7bff1868dbc3@wxs.nl>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
 <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
 <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>
 <df87942c-c750-64b5-91ca-c78758a6a7ad@guest.arnes.si>
 <81dda245-eed3-38a3-387b-7bff1868dbc3@wxs.nl>
Message-ID: <a21bbbb9-9638-f108-6acd-4a79ed5f34a4@guest.arnes.si>

On 24. 01. 2017 17:33, Hans Hagen wrote:
>> \def\csnewlocalbox#1{\expandafter\newlocalbox\csname #1\endcsname}
>> \def\csboxnumber#1{\expandafter\number\csname #1\endcsname}
>>
>> \starttext
>>
>> \newbox\MyBoxA \number\MyBoxA
>>
>> \dorecurse{2} {
>>     \dorecurse{1000} {
>>         \csnewlocalbox{TempBox#1-1}%
>>         \csnewlocalbox{TempBox#1-2}%
>>         \csnewlocalbox{TempBox#1-3}%
>>         \csnewlocalbox{TempBox#1-4}%
>>         \csnewlocalbox{TempBox#1-5}%
>>     }
>>     \writestatus{!!!}{#1 million done}
>>     #1: \csboxnumber{TempBox#1-1}\par
>>     #1: \csboxnumber{TempBox#1-2}\par
>>     #1: \csboxnumber{TempBox#1-3}\par
>>     #1: \csboxnumber{TempBox#1-4}\par
>>     #1: \csboxnumber{TempBox#1-5}\par
>> }
>>
>> \newbox\MyBoxB \number\MyBoxB
>>
>> \stoptext
>
> even then you only get 5000 boxes defined ...
Well, that's because I was impatient and have changed a 1000000 to a 
1000 ;-)
> you can reset the storag
> of course but you still have 5000 hash entries (mening \undefined then)
> with names like TempBox*-*
That's very good info, thanks!

> \starttext
>
> \bgroup
>   \newlocalbox\foo
>   \setbox\foo\hbox\bgroup
>     bar
>     \ifdefined\oof\else\newbox\oof\fi
>     \global\setbox\oof\hbox{foo}
>   \egroup
> \egroup
>
> \box\oof
>
> \stoptext
>
> when we would reset the allocator count then \oof would still be ok but
> its slot would be reallocated at some point by \newlocalbox
I hope you don't mind explaining this further, as I'm lost.

1. I was unable to produce this effect. Should it happen with the 
\newlocalbox defined in this thread, or some hypothetical \newlocalbox 
(which would share the allocation counter with \newbox?). I tried both 
your \newlocalbox and elocalloc's \locbox, and didn't manage to 
reallocate \oof's register.

But maybe this question is bogus, as:

2. I don't understand why it is important to use \newbox within 
\setbox\foo\hbox{...}  Don't we get the same result in the following?

\starttext

\bgroup
   \newlocalbox\foo
   \setbox\foo\hbox\bgroup
     bar
   \egroup
   \ifdefined\oof\else\newbox\oof\fi
   \global\setbox\oof\hbox{foo}
\egroup

\box\oof

\stoptext


Best,
SaÅ¡o


From pragma at wxs.nl  Thu Jan 26 18:53:13 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 26 Jan 2017 18:53:13 +0100
Subject: [dev-context] local allocation in ConTeXt
In-Reply-To: <a21bbbb9-9638-f108-6acd-4a79ed5f34a4@guest.arnes.si>
References: <59f5f1dc-fb4b-5d2e-ca00-e870c6bfaa5a@guest.arnes.si>
 <alpine.OSX.2.02.1701230012460.10626@nqv-znpobbx>
 <669c25f4-ff50-ec10-2822-15d862ae24cb@wxs.nl>
 <3204e33f-c523-2626-9ed6-a2eeb39f9db6@guest.arnes.si>
 <a99f6d4a-6008-cf4e-f2f7-93188cc1051f@wxs.nl>
 <1f677129-b08d-1803-b54a-86aa9b22a293@guest.arnes.si>
 <40a6d173-84e0-875f-e8f6-8845f2ce4080@wxs.nl>
 <df87942c-c750-64b5-91ca-c78758a6a7ad@guest.arnes.si>
 <81dda245-eed3-38a3-387b-7bff1868dbc3@wxs.nl>
 <a21bbbb9-9638-f108-6acd-4a79ed5f34a4@guest.arnes.si>
Message-ID: <9a9b69a6-6e03-3e17-960a-2fac94535d81@wxs.nl>

On 1/26/2017 5:02 PM, SaÅ¡o Å½ivanoviÄ wrote:
> On 24. 01. 2017 17:33, Hans Hagen wrote:
>>> \def\csnewlocalbox#1{\expandafter\newlocalbox\csname #1\endcsname}
>>> \def\csboxnumber#1{\expandafter\number\csname #1\endcsname}
>>>
>>> \starttext
>>>
>>> \newbox\MyBoxA \number\MyBoxA
>>>
>>> \dorecurse{2} {
>>>     \dorecurse{1000} {
>>>         \csnewlocalbox{TempBox#1-1}%
>>>         \csnewlocalbox{TempBox#1-2}%
>>>         \csnewlocalbox{TempBox#1-3}%
>>>         \csnewlocalbox{TempBox#1-4}%
>>>         \csnewlocalbox{TempBox#1-5}%
>>>     }
>>>     \writestatus{!!!}{#1 million done}
>>>     #1: \csboxnumber{TempBox#1-1}\par
>>>     #1: \csboxnumber{TempBox#1-2}\par
>>>     #1: \csboxnumber{TempBox#1-3}\par
>>>     #1: \csboxnumber{TempBox#1-4}\par
>>>     #1: \csboxnumber{TempBox#1-5}\par
>>> }
>>>
>>> \newbox\MyBoxB \number\MyBoxB
>>>
>>> \stoptext
>>
>> even then you only get 5000 boxes defined ...
> Well, that's because I was impatient and have changed a 1000000 to a
> 1000 ;-)
>> you can reset the storag
>> of course but you still have 5000 hash entries (mening \undefined then)
>> with names like TempBox*-*
> That's very good info, thanks!
>
>> \starttext
>>
>> \bgroup
>>   \newlocalbox\foo
>>   \setbox\foo\hbox\bgroup
>>     bar
>>     \ifdefined\oof\else\newbox\oof\fi
>>     \global\setbox\oof\hbox{foo}
>>   \egroup
>> \egroup
>>
>> \box\oof
>>
>> \stoptext
>>
>> when we would reset the allocator count then \oof would still be ok but
>> its slot would be reallocated at some point by \newlocalbox
> I hope you don't mind explaining this further, as I'm lost.
>
> 1. I was unable to produce this effect. Should it happen with the
> \newlocalbox defined in this thread, or some hypothetical \newlocalbox
> (which would share the allocation counter with \newbox?). I tried both
> your \newlocalbox and elocalloc's \locbox, and didn't manage to
> reallocate \oof's register.
>
> But maybe this question is bogus, as:
>
> 2. I don't understand why it is important to use \newbox within
> \setbox\foo\hbox{...}  Don't we get the same result in the following?
>
> \starttext
>
> \bgroup
>   \newlocalbox\foo
>   \setbox\foo\hbox\bgroup
>     bar
>   \egroup
>   \ifdefined\oof\else\newbox\oof\fi
>   \global\setbox\oof\hbox{foo}
> \egroup
>
> \box\oof
>
> \stoptext

the difference is that a next \newbox\oof will report that \off is 
already defined (so no new box will be allocated unless you \relax \foo) 
while \newlocalbox\foo will happily reuse \foo and not report a message 
(as you use it local \foo is also defined as local while \oof is global)

Hans



-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Sun Feb 12 06:05:10 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 11 Feb 2017 21:05:10 -0800 (PST)
Subject: [dev-context] Solarized colors
Message-ID: <alpine.OSX.2.02.1702112056190.3087@nqv-znpobbx>

Hi,

I am wondering if there is any interest in adding solarized colors to the 
core. I am attaching colo-imp-solarized.mkiv file. (Essentially the same 
file will work in MkII). For those who do not know, solarized 
(http://ethanschoonover.com/solarized) is a 16 color palatte designed with 
a precise LAB lightness between the colors and is supposed to work well in 
a variety of lighting conditions.

I have named the colors such that loading this will override the default 
color values of yello, orange, red, magenta, violet, blue, cyan, and 
green (X11 does the same, but X11's color definitions match the default). 
Another option is to either use CamelCase names or names such as 
'solarizedYellow', etc.

If you think that it is not worth having such small color palattes in the 
core, then I can create a separate module that collects these.

Aditya
-------------- next part --------------
%D \module
%D   [    file=colo-imp-solarized,
%D     version=2017.02.10,
%D       title=\CONTEXT\ColorMacros,
%D    subtitle=Solarized,
%D      author=AdityaMahajan,
%D   ]

%D Colors based on solarized scheme
%D \hyphenatedurl{http://ethanschoonover.com/solarized}

\startprotectedcolors
  \definecolor[base03]  [h=002b36]
  \definecolor[base02]  [h=073642]
  \definecolor[base01]  [h=586e75]
  \definecolor[base00]  [h=657b83]
  \definecolor[base0]   [h=839496]
  \definecolor[base1]   [h=93a1a1]
  \definecolor[base2]   [h=eee8d5]
  \definecolor[base3]   [h=fdf6e3]
  \definecolor[yellow]  [h=b58900]
  \definecolor[orange]  [h=cb4b16]
  \definecolor[red]     [h=dc322f]
  \definecolor[magenta] [h=d33682]
  \definecolor[violet]  [h=6c71c4]
  \definecolor[blue]    [h=268bd2]
  \definecolor[cyan]    [h=2aa198]
  \definecolor[green]   [h=859900]
\stopprotectedcolors


From pragma at wxs.nl  Sun Feb 12 15:02:20 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 12 Feb 2017 15:02:20 +0100
Subject: [dev-context] Solarized colors
In-Reply-To: <alpine.OSX.2.02.1702112056190.3087@nqv-znpobbx>
References: <alpine.OSX.2.02.1702112056190.3087@nqv-znpobbx>
Message-ID: <7ce776bf-8f4e-c945-7bd9-47f39132711a@wxs.nl>

On 2/12/2017 6:05 AM, Aditya Mahajan wrote:
> Hi,
>
> I am wondering if there is any interest in adding solarized colors to
> the core. I am attaching colo-imp-solarized.mkiv file. (Essentially the
> same file will work in MkII). For those who do not know, solarized
> (http://ethanschoonover.com/solarized) is a 16 color palatte designed
> with a precise LAB lightness between the colors and is supposed to work
> well in a variety of lighting conditions.
>
> I have named the colors such that loading this will override the default
> color values of yello, orange, red, magenta, violet, blue, cyan, and
> green (X11 does the same, but X11's color definitions match the
> default). Another option is to either use CamelCase names or names such
> as 'solarizedYellow', etc.
>
> If you think that it is not worth having such small color palattes in
> the core, then I can create a separate module that collects these.

file added

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Mon Feb 13 05:13:59 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 12 Feb 2017 20:13:59 -0800 (PST)
Subject: [dev-context] Solarized colors
In-Reply-To: <7ce776bf-8f4e-c945-7bd9-47f39132711a@wxs.nl>
References: <alpine.OSX.2.02.1702112056190.3087@nqv-znpobbx>
 <7ce776bf-8f4e-c945-7bd9-47f39132711a@wxs.nl>
Message-ID: <alpine.LNX.2.20.1702122013290.3478@nqv-fhesnpr.nggybpny.arg>

On Sun, 12 Feb 2017, Hans Hagen wrote:

> On 2/12/2017 6:05 AM, Aditya Mahajan wrote:
>>  Hi,
>>
>>  I am wondering if there is any interest in adding solarized colors to
>>  the core. I am attaching colo-imp-solarized.mkiv file. (Essentially the
>>  same file will work in MkII). For those who do not know, solarized
>>  (http://ethanschoonover.com/solarized) is a 16 color palatte designed
>>  with a precise LAB lightness between the colors and is supposed to work
>>  well in a variety of lighting conditions.
>
> file added

Thanks.

Aditya

From taco at elvenkind.com  Tue Feb 14 13:31:56 2017
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 14 Feb 2017 13:31:56 +0100
Subject: [dev-context] \pdfannot
Message-ID: <D7FDC6E1-4C16-4CCE-8D3B-B065D027E3DE@elvenkind.com>

Hi Hans,

I just tried this with a fairly new ConTeXt:

  \starttext
  \message{pdfannot: [\meaning \pdfannot] pdflastannot: [\meaning \pdflastannot]
  \stoptext 

reports

   pdfannot: [\relax] pdflastannot: [\count1160]

which is not really useful. It actually hit me inside a file that was actually 
using \pdfannot to do some fancy stuff, which was working fine a few years back. 
(I know it is now called "\pdfextension annot", that is not actually the problem)

If you do no longer want to support the primitives in ConTeXt, sure. But could 
you at least produce a message and/or error ? In particular,  the

  \let \pdfannot \relax

creates mayhem inside the produced PDF, because of all the associated keywords
in the primitive \pdfannot implementation that are now suddenly being typeset as-is,
which is rather messy.

Best wishes,
Taco


From luigi.scarso at gmail.com  Fri Feb 17 20:57:09 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2017 20:57:09 +0100
Subject: [dev-context] LuaTeX 1.0.3 announcement
Message-ID: <CAG5iGsAE3Yc+b6rHf7vV9_63Jw6pkPyMgfhpz841wwXUzgM2+A@mail.gmail.com>

==============================================================
LuaTeX Release 1.0.3  was released 2017021514
==============================================================

This is a minor upgrade and probably this version will go on texlive.
There are a couple
of fixes and additions.
- We added a few a few more helpers in the pdf namespace (like
set|get]gentounicode,
  [set|get]omitcidset and set|get]decimaldigits. Some helpers were
moved from the tex
  to the pdf namespace.

- We added a build_page_insert callback for inserts so that one can
for instance adapt
  spacing on demand.

- On the agenda has been some more control over word start and end in
hyphenation and
  this is now possible via hyphenationbounds. We also updated the
manual with some more
  details.

- An old tracker item with respect to control over spacing around math
was revived and
  has resulted in mathsurroundmode (one can wonder how useful this is).

- We improved the resolution detection in included jpeg images.


- An ffi library has been added to luatex so that it is more in sync
with luajittex. This
  permits easy and flexible loading of libraries. Our policy is to
make luatex as lean
  as possible with no dependencies and this is a step towards that.
Eventually we hope
  to support all relevant platforms.

- The glue and skip register accessors have been improved as a step in
freeing the user
  from glue spec management.

- We added a few more getters and setters for nodes in order to get a
more consistent
  set.

- Irrelevant fields have been removed from the status table and an
engine identifier
  has been added.

- Of course there are numerous fixes and improvements but none of
these have consequences
  for the interfaces.

- The manual has been updated but will be improved over time.




Have fun,
Hans, Luigi, Taco

From preining at logic.at  Thu May  4 09:35:26 2017
From: preining at logic.at (Norbert Preining)
Date: Thu, 4 May 2017 16:35:26 +0900
Subject: [dev-context] [MacTeX] Context Problem?
In-Reply-To: <21B8F5B4-7435-430A-816C-1496514A0852@wideopenwest.com>
References: <21B8F5B4-7435-430A-816C-1496514A0852@wideopenwest.com>
Message-ID: <20170504073526.ftthqdipu2ibwihd@burischnitzel.preining.info>

Hi ConteXt people,

here a problem report from Herbert on MacOS, but it is the same on Linux
in tlpretest.

Thanks

Norbert

On Wed, 03 May 2017, Herbert Schulz wrote:
> Howdy,
> 
> I know virtually nothing about ConTeXt but have a few very simple test files that I picked up from who knows where. In the process of testing TeX Live 2017 pretest I happened to try out the latest ConTeXt on the enclosed file (all updates, including context, this morning). I also enclose the pdf output.
> 
> I checked with the final TeX Live 2016 and the problem doesn't exist in that distribution.
> 



> 
> 
> I'm sure there are some folks on this list that understand what is happening here and can pass on worthwhile information to the ConTeXt folks.
> 
> Good Luck,
> 
> Herb Schulz
> (herbs at wideopenwest dot com)
> 

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
-------------- next part --------------
A non-text attachment was scrubbed...
Name: HelloWorldLucida.tex
Type: text/x-tex
Size: 243 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170504/8c817291/attachment.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: HelloWorldLucida.pdf
Type: application/pdf
Size: 14722 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170504/8c817291/attachment.pdf>

From pragma at wxs.nl  Thu May  4 10:00:58 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 4 May 2017 10:00:58 +0200
Subject: [dev-context] [MacTeX] Context Problem?
In-Reply-To: <20170504073526.ftthqdipu2ibwihd@burischnitzel.preining.info>
References: <21B8F5B4-7435-430A-816C-1496514A0852@wideopenwest.com>
 <20170504073526.ftthqdipu2ibwihd@burischnitzel.preining.info>
Message-ID: <d2ac17f0-3940-38f4-770a-c7230d6e6644@wxs.nl>

Hi Norbert & Herbert,

> Hi ConteXt people,
>
> here a problem report from Herbert on MacOS, but it is the same on Linux
> in tlpretest.
>
> Thanks
>
> Norbert
>
> On Wed, 03 May 2017, Herbert Schulz wrote:
>> Howdy,
>>
>> I know virtually nothing about ConTeXt but have a few very simple test files that I picked up from who knows where. In the process of testing TeX Live 2017 pretest I happened to try out the latest ConTeXt on the enclosed file (all updates, including context, this morning). I also enclose the pdf output.
>>
>> I checked with the final TeX Live 2016 and the problem doesn't exist in that distribution.
>>

Just replace your test with:

\setupbodyfont[lucida-ot]

\starttext
     Hello world.
     \showbodyfont
\stoptext

the experimental simplefonts module is already obsolete for a while and 
its methods are (slightly upgraded) in the core

the above code is using the regular loading and is ok for testing

>>
>>
>> I'm sure there are some folks on this list that understand what is happening here and can pass on worthwhile information to the ConTeXt folks.
>>
>> Good Luck,
>>
>> Herb Schulz
>> (herbs at wideopenwest dot com)
>>
>
> --
> PREINING Norbert                               http://www.preining.info
> Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
> GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
>
>
>
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context
>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Thu May  4 10:25:58 2017
From: preining at logic.at (Norbert Preining)
Date: Thu, 4 May 2017 17:25:58 +0900
Subject: [dev-context] [MacTeX] Context Problem?
In-Reply-To: <d2ac17f0-3940-38f4-770a-c7230d6e6644@wxs.nl>
References: <21B8F5B4-7435-430A-816C-1496514A0852@wideopenwest.com>
 <20170504073526.ftthqdipu2ibwihd@burischnitzel.preining.info>
 <d2ac17f0-3940-38f4-770a-c7230d6e6644@wxs.nl>
Message-ID: <20170504082558.aftqt3qqtoxwx4fh@burischnitzel.preining.info>

> \setupbodyfont[lucida-ot]

Thanks Hans for the quick clarification.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From Idris.Hamid at colostate.edu  Sat May 13 21:49:24 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sat, 13 May 2017 13:49:24 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
Message-ID: <op.yz6z0mhyejo439@desktop-mt1m160>

Dear gang,

We need to generate a complete list of mkiv commands. setup-en.pdf has
everything but some clarification and modification is needed:

1. Clarification: Does setup-en.pdf includes both mkii and mkiv commands?
If so, then can a version of the auto-generation script be made that will
generate a version setup-mkiv-en.pdf that is complete but restricted to
mkiv commands?

[Is the auto-generation script publicly available?]

2. Modification: It appears that all command names that appear in slanted
text are used to mention user-defined commands of a particular class, e.g.,

/\BACKGROUND/ - slanted text

which obviously names each of a class of commands defined by

\definebackground - regular text

Can a version of the auto-generation script be made that will generate a
version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
explicitly defined in mkiv, excluding class commands or anything else
represented in slanted text?

3. Although it is intuitive, a legend precisely explaining the semantics
of the command list in setup.pdf would be useful. If there is already one
available, could you point it out to me?

4. Would it be possible for the auto-generation to export the command list
to a semi-formatted text file? Copying the text of setup-en.pdf to a text
file gives usable results but a text file with some regular structure
might be better.


In sum: we need - urgently - a comprehensive ConTeXt command list
restricted to mkiv that excludes class names for user definitions and the
like. Any help is greatly appreciated, and thanks in advance!

Best wishes
Idris

-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From Idris.Hamid at colostate.edu  Sat May 13 21:49:30 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sat, 13 May 2017 13:49:30 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz6zmzqlejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
Message-ID: <op.yz6z0si9ejo439@desktop-mt1m160>

On Sat, 13 May 2017 13:41:04 -0600, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯
<Idris.Hamid at colostate.edu> wrote:

CHANGE

> Copying the text of setup-en.pdf to a text file gives usable results but  
> a text file with some regular structure might be better.

TO

Copying the text of setup-en.pdf to a text file gives usable results but a
text file with some regular structure, auto-generated via the script,
might be better.

-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From pragma at wxs.nl  Sun May 14 17:33:04 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 17:33:04 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz6zmzqlejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
Message-ID: <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>

On 5/13/2017 9:41 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> Dear gang,
>
> We need to generate a complete list of mkiv commands. setup-en.pdf has
> everything but some clarification and modification is needed:
>
> 1. Clarification: Does setup-en.pdf includes both mkii and mkiv
> commands? If so, then can a version of the auto-generation script be
> made that will generate a version setup-mkiv-en.pdf that is complete but
> restricted to mkiv commands?

this is mkiv (there is an cont-en.xml file describing mkii mostly) ... 
remmeber: mkii is frozen and phased out

> [Is the auto-generation script publicly available?]

all scripts are in the distribution

> 2. Modification: It appears that all command names that appear in
> slanted text are used to mention user-defined commands of a particular
> class, e.g.,
>
> /\BACKGROUND/ - slanted text
>
> which obviously names each of a class of commands defined by
>
> \definebackground - regular text
>
> Can a version of the auto-generation script be made that will generate a
> version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
> explicitly defined in mkiv, excluding class commands or anything else
> represented in slanted text?

it's xml so one can benerate anything from the file (i was in the 
process of generating instances in the lua files for scintilla but (1) 
had to prepare for bachotex, (2) got back and ill, (3) need some 
motivation to pick up that thread)

> 3. Although it is intuitive, a legend precisely explaining the semantics
> of the command list in setup.pdf would be useful. If there is already
> one available, could you point it out to me?

dunno, maybe somewhere on the wiki

> 4. Would it be possible for the auto-generation to export the command
> list to a semi-formatted text file? Copying the text of setup-en.pdf to
> a text file gives usable results but a text file with some regular
> structure might be better.

one can (1) use some xml transformation or (2) use the lua tables to get 
strings

> In sum: we need - urgently - a comprehensive ConTeXt command list
> restricted to mkiv that excludes class names for user definitions and
> the like. Any help is greatly appreciated, and thanks in advance!
>
> Best wishes
> Idris
>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun May 14 19:10:06 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 19:10:06 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8l2zg5ejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
Message-ID: <25bf79c4-b9a7-eac4-3953-324b7428c1f5@wxs.nl>

On 5/14/2017 6:43 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Sun, 14 May 2017 09:33:04 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>
>>> 2. Modification: It appears that all command names that appear in
>>> slanted text are used to mention user-defined commands of a particular
>>> class, e.g.,
>>>
>>> /\BACKGROUND/ - slanted text
>>>
>>> which obviously names each of a class of commands defined by
>>>
>>> \definebackground - regular text
>>>
>>> Can a version of the auto-generation script be made that will generate a
>>> version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
>>> explicitly defined in mkiv, excluding class commands or anything else
>>> represented in slanted text?
>>
>> it's xml so one can benerate anything from the file (i was in the
>> process of generating instances in the lua files for scintilla but (1)
>> had to prepare for bachotex, (2) got back and ill, (3) need some
>> motivation to pick up that thread)
>
> Let's call commands like \BACKGROUND etc abstract commands; the rest are
> concrete. An abstract command constitutes the form of a concrete
> instance that is, e.g., defined by the user via a corresponding
> \define<instance>.
>
> [Are there other kinds of abstract command not involving some
> \define<instance>?]
>
> For text editors a generic list of all concrete mkiv commands is needed.
>
>>> 3. Although it is intuitive, a legend precisely explaining the semantics
>>> of the command list in setup.pdf would be useful. If there is already
>>> one available, could you point it out to me?
>>
>> dunno, maybe somewhere on the wiki
>
> The closest I could find is here:
>
> http://wiki.contextgarden.net/Command_Syntax
>
> but it does not contain a complete or precise legend. Such a thing would
> obviously be useful for users..
>
>>> 4. Would it be possible for the auto-generation to export the command
>>> list to a semi-formatted text file? Copying the text of setup-en.pdf to
>>> a text file gives usable results but a text file with some regular
>>> structure might be better.
>>
>> one can (1) use some xml transformation or (2) use the lua tables to
>> get strings
>
> The lua tables in the scite distribution are incomplete. For example, in
> scite-context-data-interfaces.lua there is no mention of the commands
> for natural tables - \bTABLE etc. This is the reason for taking the
> auto-generation approach, to get a comprehensive and complete list.
>
> Idris


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun May 14 19:15:42 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 19:15:42 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8l2zg5ejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
Message-ID: <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl>

On 5/14/2017 6:43 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Sun, 14 May 2017 09:33:04 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>
>>> 2. Modification: It appears that all command names that appear in
>>> slanted text are used to mention user-defined commands of a particular
>>> class, e.g.,
>>>
>>> /\BACKGROUND/ - slanted text
>>>
>>> which obviously names each of a class of commands defined by
>>>
>>> \definebackground - regular text
>>>
>>> Can a version of the auto-generation script be made that will generate a
>>> version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
>>> explicitly defined in mkiv, excluding class commands or anything else
>>> represented in slanted text?
>>
>> it's xml so one can benerate anything from the file (i was in the
>> process of generating instances in the lua files for scintilla but (1)
>> had to prepare for bachotex, (2) got back and ill, (3) need some
>> motivation to pick up that thread)
>
> Let's call commands like \BACKGROUND etc abstract commands; the rest are
> concrete. An abstract command constitutes the form of a concrete
> instance that is, e.g., defined by the user via a corresponding
> \define<instance>.

that's what i meant with "i'm working on getting these instances in the 
lua lists too" but it takes time (and motivation) so it will happen 
stepwise

(normally i prioritize such things by need in projects but in the 
projects that we have the authors code in xml)

> [Are there other kinds of abstract command not involving some
> \define<instance>?]

dunno

> For text editors a generic list of all concrete mkiv commands is needed.
>
>>> 3. Although it is intuitive, a legend precisely explaining the semantics
>>> of the command list in setup.pdf would be useful. If there is already
>>> one available, could you point it out to me?
>>
>> dunno, maybe somewhere on the wiki
>
> The closest I could find is here:
>
> http://wiki.contextgarden.net/Command_Syntax
>
> but it does not contain a complete or precise legend. Such a thing would
> obviously be useful for users..

the command reference is quite complete (and user defined instances will 
never be part of syntax highlight anyway)

>>> 4. Would it be possible for the auto-generation to export the command
>>> list to a semi-formatted text file? Copying the text of setup-en.pdf to
>>> a text file gives usable results but a text file with some regular
>>> structure might be better.
>>
>> one can (1) use some xml transformation or (2) use the lua tables to
>> get strings
>
> The lua tables in the scite distribution are incomplete. For example, in
> scite-context-data-interfaces.lua there is no mention of the commands
> for natural tables - \bTABLE etc. This is the reason for taking the
> auto-generation approach, to get a comprehensive and complete list.

could be but wolfgang did a huge effort in making them pretty complete 
(even low level commands) so ic something is not in there (the i-*.xml 
files), it's with good reason

keep in mind that all this happens in spare time

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun May 14 19:38:19 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 14 May 2017 19:38:19 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl>
Message-ID: <5918960B.9060001@gmail.com>


> Hans Hagen <mailto:pragma at wxs.nl>
> 14. Mai 2017 um 19:15
> On 5/14/2017 6:43 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
>> On Sun, 14 May 2017 09:33:04 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>>
>>>> 2. Modification: It appears that all command names that appear in
>>>> slanted text are used to mention user-defined commands of a particular
>>>> class, e.g.,
>>>>
>>>> /\BACKGROUND/ - slanted text
>>>>
>>>> which obviously names each of a class of commands defined by
>>>>
>>>> \definebackground - regular text
>>>>
>>>> Can a version of the auto-generation script be made that will 
>>>> generate a
>>>> version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
>>>> explicitly defined in mkiv, excluding class commands or anything else
>>>> represented in slanted text?
>>>
>>> it's xml so one can benerate anything from the file (i was in the
>>> process of generating instances in the lua files for scintilla but (1)
>>> had to prepare for bachotex, (2) got back and ill, (3) need some
>>> motivation to pick up that thread)
>>
>> Let's call commands like \BACKGROUND etc abstract commands; the rest are
>> concrete. An abstract command constitutes the form of a concrete
>> instance that is, e.g., defined by the user via a corresponding
>> \define<instance>.
>
> that's what i meant with "i'm working on getting these instances in 
> the lua lists too" but it takes time (and motivation) so it will 
> happen stepwise
>
> (normally i prioritize such things by need in projects but in the 
> projects that we have the authors code in xml)
>
>> [Are there other kinds of abstract command not involving some
>> \define<instance>?]
>
> dunno
>

>> For text editors a generic list of all concrete mkiv commands is needed.
>>
>>>> 3. Although it is intuitive, a legend precisely explaining the 
>>>> semantics
>>>> of the command list in setup.pdf would be useful. If there is already
>>>> one available, could you point it out to me?
>>>
>>> dunno, maybe somewhere on the wiki
>>
>> The closest I could find is here:
>>
>> http://wiki.contextgarden.net/Command_Syntax
>>
>> but it does not contain a complete or precise legend. Such a thing would
>> obviously be useful for users..
>
> the command reference is quite complete (and user defined instances 
> will never be part of syntax highlight anyway)
>
>>>> 4. Would it be possible for the auto-generation to export the command
>>>> list to a semi-formatted text file? Copying the text of 
>>>> setup-en.pdf to
>>>> a text file gives usable results but a text file with some regular
>>>> structure might be better.
>>>
>>> one can (1) use some xml transformation or (2) use the lua tables to
>>> get strings
>>
>> The lua tables in the scite distribution are incomplete. For example, in
>> scite-context-data-interfaces.lua there is no mention of the commands
>> for natural tables - \bTABLE etc. This is the reason for taking the
>> auto-generation approach, to get a comprehensive and complete list.
>
> could be but wolfgang did a huge effort in making them pretty complete 
> (even low level commands) so ic something is not in there (the i-*.xml 
> files), it's with good reason
Environments with custom begin/end-strings (e.g. \bTR)

<cd:command name="TR" type="environment" begin="b" end="e" 
file="tabl-ntb.mkiv">
<cd:arguments>
<cd:assignments list="yes" optional="yes">
<cd:inherit name="setupTABLE"/>
</cd:assignments>
</cd:arguments>
</cd:command>

get the default start/stop string in the scite files.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170514/52a9a51d/attachment.html>

From schuster.wolfgang at gmail.com  Sun May 14 20:20:43 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 14 May 2017 20:20:43 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8pxmngejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160>
Message-ID: <59189FFB.5060002@gmail.com>

> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 14. Mai 2017 um 20:06
> On Sun, 14 May 2017 11:38:19 -0600, Wolfgang Schuster 
> <schuster.wolfgang at gmail.com> wrote:
>
>>>> The lua tables in the scite distribution are incomplete. For 
>>>> example, in
>>>> scite-context-data-interfaces.lua there is no mention of the commands
>>>> for natural tables - \bTABLE etc. This is the reason for taking the
>>>> auto-generation approach, to get a comprehensive and complete list.
>>>
>>> could be but wolfgang did a huge effort in making them pretty complete
>>> (even low level commands) so ic something is not in there (the i-*.xml
>>> files), it's with good reason
>
> Sure, I was referring to scite-context-data-interfaces.lua, not the 
> i-*.xml files..
>
>
> Fortunately setup-en.pdf makes all of these concrete commands 
> explicit: setup-en.pdf is as complete as one could ask for. But for 
> editors the abstract commands are superfluous, as you pointed out:
>
>>> the command reference is quite complete (and user defined instances
>>> will never be part of syntax highlight anyway)
>
> OTOH user-defined commands can be added to the ConTeXt lexer via the 
> Style Configurator (Notepad++) and get their own highlight color. I 
> have found this very useful in writing long documents. See attached 
> (User-defined Keywords dialog).

You can limit the number of custom commands when you use

     \startnamedsection[topic][title=...]

instead of

     \starttopic[title=...]

>> Environments with custom begin/end-strings (e.g. \bTR)
>>
>> <cd:command name="TR" type="environment" begin="b" end="e"
>> file="tabl-ntb.mkiv">
>> <cd:arguments>
>> <cd:assignments list="yes" optional="yes">
>> <cd:inherit name="setupTABLE"/>
>> </cd:assignments>
>> </cd:arguments>
>> </cd:command>
>>
>> get the default start/stop string in the scite files.
>
> Ah, "setupTABLE" is listed in scite-context-data-interfaces.lua.
\bTABLE is also listed but Hans script includes it as \startTABLE 
(because it ignores the begin/end attributes).
> Wolfgang: In that case, is there a way to generate an explicit list of 
> all concrete commands that derive from the ["en"] class in 
> scite-context-data-interfaces? If the results are sufficiently 
> complete, we could distinguish high-level mkiv commands from the 
> low-level ones. Such a list might be more beneficial for most users. 
> Put another way, we could have
>
> mkiv-list-high - one syntax highlighting (say, bold)
> mkiv-list-low - second syntax highlighting (say, regular)
>
> OTOH, much of this is a matter of taste: I would argue that \unprotect 
> and \protect are high-level (as part of the meta-language used to mark 
> off low-level code) and should therefore go into 
> scite-context-data-interfaces (not there at present).
Adding tags to the commands is planned but the question is how to 
categorize them (internal, api, user level, low level, primitives, 
defininitions (\define...), setups etc.).

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170514/6e68d6d9/attachment-0001.html>

From pragma at wxs.nl  Sun May 14 22:03:52 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 22:03:52 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8pxmngejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160>
Message-ID: <5ebfdaa8-6091-7378-808e-26b8bbae8ff9@wxs.nl>

On 5/14/2017 8:06 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Sun, 14 May 2017 11:38:19 -0600, Wolfgang Schuster
> <schuster.wolfgang at gmail.com> wrote:
>
>>>> The lua tables in the scite distribution are incomplete. For
>>>> example, in
>>>> scite-context-data-interfaces.lua there is no mention of the commands
>>>> for natural tables - \bTABLE etc. This is the reason for taking the
>>>> auto-generation approach, to get a comprehensive and complete list.
>>>
>>> could be but wolfgang did a huge effort in making them pretty complete
>>> (even low level commands) so ic something is not in there (the i-*.xml
>>> files), it's with good reason
>
> Sure, I was referring to scite-context-data-interfaces.lua, not the
> i-*.xml files..

what i mean is: all is in the i-* files but not all in those files is 
(yet) in the scite files (i do such things stepwise as it has a low 
priority for me; rendering in the pdf is more important)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Sun May 14 22:04:41 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Sun, 14 May 2017 22:04:41 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8r68sdejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
Message-ID: <5918B859.8080803@gmail.com>

> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 14. Mai 2017 um 20:55
> On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster 
> <schuster.wolfgang at gmail.com> wrote:
>
>>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>>> Style Configurator (Notepad++) and get their own highlight color. I
>>> have found this very useful in writing long documents. See attached
>>> (User-defined Keywords dialog).
>>
>> You can limit the number of custom commands when you use
>>
>>      \startnamedsection[topic][title=...]
>>
>> instead of
>>
>>      \starttopic[title=...]
>
> First time encountering these two commands; they're not on the wiki, 
> need to learn more about them..
>
> Can you explain or give a complete sample test file illustrating how 
> they apply in the matter under discussion? Thanks.
This is only a example to demonstrate that you can create new commands
without using new command names (and the need to add them to your lexer)
in your document.

In the example below I create a new section but I donât have to use
a new user generated command in the document itself.

\definehead[topic][subject]

\starttext

\startnamedsection[topic][title=This is a topic]
...
\stopnamedsection

\stoptext
>>>> Environments with custom begin/end-strings (e.g. \bTR)
>>>>
>>>> <cd:command name="TR" type="environment" begin="b" end="e"
>>>> file="tabl-ntb.mkiv">
>>>> <cd:arguments>
>>>> <cd:assignments list="yes" optional="yes">
>>>> <cd:inherit name="setupTABLE"/>
>>>> </cd:assignments>
>>>> </cd:arguments>
>>>> </cd:command>
>>>>
>>>> get the default start/stop string in the scite files.
>>>
>>> Ah, "setupTABLE" is listed in scite-context-data-interfaces.lua.
>> \bTABLE is also listed but Hans script includes it as \startTABLE
>> (because it ignores the begin/end attributes).
>>> Wolfgang: In that case, is there a way to generate an explicit list of
>>> all concrete commands that derive from the ["en"] class in
>>> scite-context-data-interfaces? If the results are sufficiently
>>> complete, we could distinguish high-level mkiv commands from the
>>> low-level ones. Such a list might be more beneficial for most users.
>>> Put another way, we could have
>>>
>>> mkiv-list-high - one syntax highlighting (say, bold)
>>> mkiv-list-low - second syntax highlighting (say, regular)
>>>
>>> OTOH, much of this is a matter of taste: I would argue that \unprotect
>>> and \protect are high-level (as part of the meta-language used to mark
>>> off low-level code) and should therefore go into
>>> scite-context-data-interfaces (not there at present).
>> Adding tags to the commands is planned but the question is how to
>> categorize them (internal, api, user level, low level, primitives,
>> defininitions (\define...), setups etc.).
>
> This is good to know. At the moment we're working on a full-featured 
> ConTeXt lexer and are experimenting with different ideas of organizing 
> commands for user-friendly syntax highlighting. Currently considering 
> something like the following:
>
> TeX primitives - Knuth
> luaTeX primitives - excluding Knuth
The syntax files contain at the moment only ConTeXt specific command, 
primitives arenât included.
> macro structure - e.g., sectioning etc.
> micro structure - e.g., itemizations, tables etc.
> mode structure - e.g., metapost, xml, markdown
The XML source has a category attribute for this information.
> MkiV - remaining high level
> MkIV - low-level [but how to separate them out?]
> user-defined
Internal commands can be grouped in official helpers (which should be 
documented) and internal helpers (which can be hidden).
> Perhaps collapse macro and micro structure into one set... Again, just 
> ideas for now, will work this week to work them into a concrete 
> organization for the lexer - once we generate a complete list of 
> concrete mkiv commands.
>
> If we can generate a complete version of the list in 
> scite-context-data-interfaces (including \bTR etc.) then we can 
> subtract that from the complete list of concrete mkiv commands, giving 
> us mutually exclusive and jointly exhaustive high/low-level lists.
The source for the command list are the XML files (search for i-*.xml) 
and specific lists can be generated by adding metadata to the definitions.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170514/58347d1b/attachment.html>

From pragma at wxs.nl  Sun May 14 22:10:38 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 22:10:38 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8pxmngejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160>
Message-ID: <468c0d76-6093-56de-fc82-e52706ba4e8d@wxs.nl>

On 5/14/2017 8:06 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Sun, 14 May 2017 11:38:19 -0600, Wolfgang Schuster
> <schuster.wolfgang at gmail.com> wrote:
>
>>>> The lua tables in the scite distribution are incomplete. For
>>>> example, in
>>>> scite-context-data-interfaces.lua there is no mention of the commands
>>>> for natural tables - \bTABLE etc. This is the reason for taking the
>>>> auto-generation approach, to get a comprehensive and complete list.
>>>
>>> could be but wolfgang did a huge effort in making them pretty complete
>>> (even low level commands) so ic something is not in there (the i-*.xml
>>> files), it's with good reason
>
> Sure, I was referring to scite-context-data-interfaces.lua, not the
> i-*.xml files..
>
>
> Fortunately setup-en.pdf makes all of these concrete commands explicit:
> setup-en.pdf is as complete as one could ask for. But for editors the
> abstract commands are superfluous, as you pointed out:
>
>>> the command reference is quite complete (and user defined instances
>>> will never be part of syntax highlight anyway)
>
> OTOH user-defined commands can be added to the ConTeXt lexer via the
> Style Configurator (Notepad++) and get their own highlight color. I have
> found this very useful in writing long documents. See attached
> (User-defined Keywords dialog).

sure, but it's not something that we will suport out of the box in a 
context distribution; one can have additional i-* files too (technically 
a user instance should be defined in an xml files like any other 
instance as xml is the starting point, not the generated lua table)

>> Environments with custom begin/end-strings (e.g. \bTR)
>>
>> <cd:command name="TR" type="environment" begin="b" end="e"
>> file="tabl-ntb.mkiv">
>> <cd:arguments>
>> <cd:assignments list="yes" optional="yes">
>> <cd:inherit name="setupTABLE"/>
>> </cd:assignments>
>> </cd:arguments>
>> </cd:command>
>>
>> get the default start/stop string in the scite files.
>
> Ah, "setupTABLE" is listed in scite-context-data-interfaces.lua.
>
> Wolfgang: In that case, is there a way to generate an explicit list of
> all concrete commands that derive from the ["en"] class in
> scite-context-data-interfaces? If the results are sufficiently complete,
> we could distinguish high-level mkiv commands from the low-level ones.
> Such a list might be more beneficial for most users. Put another way, we
> could have
>
> mkiv-list-high - one syntax highlighting (say, bold)
> mkiv-list-low - second syntax highlighting (say, regular)

> OTOH, much of this is a matter of taste: I would argue that \unprotect
> and \protect are high-level (as part of the meta-language used to mark
> off low-level code) and should therefore go into
> scite-context-data-interfaces (not there at present).

mult-low.lua does that (accordomg to what i considere low level or helper)

btw, users who need \unprotect are already expewrts

(fwiw, i've been trying to make the server/html based help subsystem 
instance aware because that is what i offer in scite/ta)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun May 14 22:21:13 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 14 May 2017 22:21:13 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <5918B859.8080803@gmail.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
Message-ID: <b24fe9ae-6a70-0168-399b-edaa18d58c5b@wxs.nl>

On 5/14/2017 10:04 PM, Wolfgang Schuster wrote:
>> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
>> 14. Mai 2017 um 20:55
>> On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster
>> <schuster.wolfgang at gmail.com> wrote:
>>
>>>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>>>> Style Configurator (Notepad++) and get their own highlight color. I
>>>> have found this very useful in writing long documents. See attached
>>>> (User-defined Keywords dialog).
>>>
>>> You can limit the number of custom commands when you use
>>>
>>>      \startnamedsection[topic][title=...]
>>>
>>> instead of
>>>
>>>      \starttopic[title=...]
>>
>> First time encountering these two commands; they're not on the wiki,
>> need to learn more about them..
>>
>> Can you explain or give a complete sample test file illustrating how
>> they apply in the matter under discussion? Thanks.
> This is only a example to demonstrate that you can create new commands
> without using new command names (and the need to add them to your lexer)
> in your document.
>
> In the example below I create a new section but I donât have to use
> a new user generated command in the document itself.
>
> \definehead[topic][subject]
>
> \starttext
>
> \startnamedsection[topic][title=This is a topic]
> ...
> \stopnamedsection
>
> \stoptext

indeed, and we stimmulate this over using hard coded generated names 
(some define commands have the option not to define instance commands)

idris: don't overdo syntax highlighting, better concentrate on 
supporting structure

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From Idris.Hamid at colostate.edu  Sun May 14 18:43:37 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 14 May 2017 10:43:37 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
Message-ID: <op.yz8l2zg5ejo439@desktop-mt1m160>

On Sun, 14 May 2017 09:33:04 -0600, Hans Hagen <pragma at wxs.nl> wrote:

>> 2. Modification: It appears that all command names that appear in
>> slanted text are used to mention user-defined commands of a particular
>> class, e.g.,
>>
>> /\BACKGROUND/ - slanted text
>>
>> which obviously names each of a class of commands defined by
>>
>> \definebackground - regular text
>>
>> Can a version of the auto-generation script be made that will generate a
>> version setup-mkiv-strict-en.pdf that is restricted to mkiv commands
>> explicitly defined in mkiv, excluding class commands or anything else
>> represented in slanted text?
>
> it's xml so one can benerate anything from the file (i was in the  
> process of generating instances in the lua files for scintilla but (1)  
> had to prepare for bachotex, (2) got back and ill, (3) need some  
> motivation to pick up that thread)

Let's call commands like \BACKGROUND etc abstract commands; the rest are  
concrete. An abstract command constitutes the form of a concrete instance  
that is, e.g., defined by the user via a corresponding \define<instance>.

[Are there other kinds of abstract command not involving some  
\define<instance>?]

For text editors a generic list of all concrete mkiv commands is needed.

>> 3. Although it is intuitive, a legend precisely explaining the semantics
>> of the command list in setup.pdf would be useful. If there is already
>> one available, could you point it out to me?
>
> dunno, maybe somewhere on the wiki

The closest I could find is here:

http://wiki.contextgarden.net/Command_Syntax

but it does not contain a complete or precise legend. Such a thing would  
obviously be useful for users..

>> 4. Would it be possible for the auto-generation to export the command
>> list to a semi-formatted text file? Copying the text of setup-en.pdf to
>> a text file gives usable results but a text file with some regular
>> structure might be better.
>
> one can (1) use some xml transformation or (2) use the lua tables to get  
> strings

The lua tables in the scite distribution are incomplete. For example, in  
scite-context-data-interfaces.lua there is no mention of the commands for  
natural tables - \bTABLE etc. This is the reason for taking the  
auto-generation approach, to get a comprehensive and complete list.

Idris
-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From Idris.Hamid at colostate.edu  Sun May 14 18:45:15 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 14 May 2017 10:45:15 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
Message-ID: <op.yz8l5pd8ejo439@desktop-mt1m160>

On Sun, 14 May 2017 09:33:04 -0600, Hans Hagen <pragma at wxs.nl> wrote:

>> 1. Clarification: Does setup-en.pdf includes both mkii and mkiv
>> commands? If so, then can a version of the auto-generation script be
>> made that will generate a version setup-mkiv-en.pdf that is complete but
>> restricted to mkiv commands?
>
> this is mkiv (there is an cont-en.xml file describing mkii mostly) ...  
> remmeber: mkii is frozen and phased out

Thanks, that's what I expected, just wanted to be certain..

-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From Idris.Hamid at colostate.edu  Sun May 14 20:06:48 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 14 May 2017 12:06:48 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <5918960B.9060001@gmail.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
Message-ID: <op.yz8pxmngejo439@desktop-mt1m160>

On Sun, 14 May 2017 11:38:19 -0600, Wolfgang Schuster  
<schuster.wolfgang at gmail.com> wrote:

>>> The lua tables in the scite distribution are incomplete. For example,  
>>> in
>>> scite-context-data-interfaces.lua there is no mention of the commands
>>> for natural tables - \bTABLE etc. This is the reason for taking the
>>> auto-generation approach, to get a comprehensive and complete list.
>>
>> could be but wolfgang did a huge effort in making them pretty complete
>> (even low level commands) so ic something is not in there (the i-*.xml
>> files), it's with good reason

Sure, I was referring to scite-context-data-interfaces.lua, not the  
i-*.xml files..


Fortunately setup-en.pdf makes all of these concrete commands explicit:  
setup-en.pdf is as complete as one could ask for. But for editors the  
abstract commands are superfluous, as you pointed out:

>> the command reference is quite complete (and user defined instances
>> will never be part of syntax highlight anyway)

OTOH user-defined commands can be added to the ConTeXt lexer via the Style  
Configurator (Notepad++) and get their own highlight color. I have found  
this very useful in writing long documents. See attached (User-defined  
Keywords dialog).

> Environments with custom begin/end-strings (e.g. \bTR)
>
> <cd:command name="TR" type="environment" begin="b" end="e"
> file="tabl-ntb.mkiv">
> <cd:arguments>
> <cd:assignments list="yes" optional="yes">
> <cd:inherit name="setupTABLE"/>
> </cd:assignments>
> </cd:arguments>
> </cd:command>
>
> get the default start/stop string in the scite files.

Ah, "setupTABLE" is listed in scite-context-data-interfaces.lua.

Wolfgang: In that case, is there a way to generate an explicit list of all  
concrete commands that derive from the ["en"] class in  
scite-context-data-interfaces? If the results are sufficiently complete,  
we could distinguish high-level mkiv commands from the low-level ones.  
Such a list might be more beneficial for most users. Put another way, we  
could have

mkiv-list-high - one syntax highlighting (say, bold)
mkiv-list-low - second syntax highlighting (say, regular)

OTOH, much of this is a matter of taste: I would argue that \unprotect and  
\protect are high-level (as part of the meta-language used to mark off  
low-level code) and should therefore go into scite-context-data-interfaces  
(not there at present).

Idris
-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From Idris.Hamid at colostate.edu  Sun May 14 20:11:10 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 14 May 2017 12:11:10 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8pxmngejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160>
Message-ID: <op.yz8p4wx6ejo439@desktop-mt1m160>

>>> the command reference is quite complete (and user defined instances
>>> will never be part of syntax highlight anyway)
>
> OTOH user-defined commands can be added to the ConTeXt lexer via the  
> Style Configurator (Notepad++) and get their own highlight color. I have  
> found this very useful in writing long documents. See attached  
> (User-defined Keywords dialog).

See attached (experimental ConTeXt lexer in development..)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: style-configurator1.jpg
Type: image/jpeg
Size: 43682 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170514/2f24724b/attachment-0001.jpg>

From Idris.Hamid at colostate.edu  Sun May 14 20:55:36 2017
From: Idris.Hamid at colostate.edu (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= =?utf-8?B?2KfZhdiv?=)
Date: Sun, 14 May 2017 12:55:36 -0600
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <59189FFB.5060002@gmail.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
Message-ID: <op.yz8r68sdejo439@desktop-mt1m160>

On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster  
<schuster.wolfgang at gmail.com> wrote:

>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>> Style Configurator (Notepad++) and get their own highlight color. I
>> have found this very useful in writing long documents. See attached
>> (User-defined Keywords dialog).
>
> You can limit the number of custom commands when you use
>
>      \startnamedsection[topic][title=...]
>
> instead of
>
>      \starttopic[title=...]

First time encountering these two commands; they're not on the wiki, need  
to learn more about them..

Can you explain or give a complete sample test file illustrating how they  
apply in the matter under discussion? Thanks.

>>> Environments with custom begin/end-strings (e.g. \bTR)
>>>
>>> <cd:command name="TR" type="environment" begin="b" end="e"
>>> file="tabl-ntb.mkiv">
>>> <cd:arguments>
>>> <cd:assignments list="yes" optional="yes">
>>> <cd:inherit name="setupTABLE"/>
>>> </cd:assignments>
>>> </cd:arguments>
>>> </cd:command>
>>>
>>> get the default start/stop string in the scite files.
>>
>> Ah, "setupTABLE" is listed in scite-context-data-interfaces.lua.
> \bTABLE is also listed but Hans script includes it as \startTABLE
> (because it ignores the begin/end attributes).
>> Wolfgang: In that case, is there a way to generate an explicit list of
>> all concrete commands that derive from the ["en"] class in
>> scite-context-data-interfaces? If the results are sufficiently
>> complete, we could distinguish high-level mkiv commands from the
>> low-level ones. Such a list might be more beneficial for most users.
>> Put another way, we could have
>>
>> mkiv-list-high - one syntax highlighting (say, bold)
>> mkiv-list-low - second syntax highlighting (say, regular)
>>
>> OTOH, much of this is a matter of taste: I would argue that \unprotect
>> and \protect are high-level (as part of the meta-language used to mark
>> off low-level code) and should therefore go into
>> scite-context-data-interfaces (not there at present).
> Adding tags to the commands is planned but the question is how to
> categorize them (internal, api, user level, low level, primitives,
> defininitions (\define...), setups etc.).

This is good to know. At the moment we're working on a full-featured  
ConTeXt lexer and are experimenting with different ideas of organizing  
commands for user-friendly syntax highlighting. Currently considering  
something like the following:

TeX primitives - Knuth
luaTeX primitives - excluding Knuth
macro structure - e.g., sectioning etc.
micro structure - e.g., itemizations, tables etc.
mode structure - e.g., metapost, xml, markdown
MkiV - remaining high level
MkIV - low-level [but how to separate them out?]
user-defined

Perhaps collapse macro and micro structure into one set... Again, just  
ideas for now, will work this week to work them into a concrete  
organization for the lexer - once we generate a complete list of concrete  
mkiv commands.

If we can generate a complete version of the list in  
scite-context-data-interfaces (including \bTR etc.) then we can subtract  
that from the complete list of concrete mkiv commands, giving us mutually  
exclusive and jointly exhaustive high/low-level lists.

Any help and other ideas are greatly appreciated!

Idris
-- 
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512

From pragma at wxs.nl  Mon May 15 11:43:43 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 15 May 2017 11:43:43 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.yz8r68sdejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
Message-ID: <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl>

On 5/14/2017 8:55 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster
> <schuster.wolfgang at gmail.com> wrote:
>
>>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>>> Style Configurator (Notepad++) and get their own highlight color. I
>>> have found this very useful in writing long documents. See attached
>>> (User-defined Keywords dialog).
>>
>> You can limit the number of custom commands when you use
>>
>>      \startnamedsection[topic][title=...]
>>
>> instead of
>>
>>      \starttopic[title=...]
>
> First time encountering these two commands; they're not on the wiki,
> need to learn more about them..

in mkiv most commands that have generated names also provide generic 
instance handling, like here

> Can you explain or give a complete sample test file illustrating how
> they apply in the matter under discussion? Thanks.

afaiks there is not much to add to the above example unless i 
misunderstood; basically one can always use "topic" as instance name to 
do something instead of \somecommandwith<topic>init

> something like the following:
>
> TeX primitives - Knuth
> luaTeX primitives - excluding Knuth
> macro structure - e.g., sectioning etc.
> micro structure - e.g., itemizations, tables etc.

here i have document level (\startdocument etc) vs the rest

> mode structure - e.g., metapost, xml, markdown
> MkiV - remaining high level
> MkIV - low-level [but how to separate them out?]

is there a need to separate them? after all, most users will not use low 
level code and when they do it doesn't matter much to them if they're 
more or less low level

low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter 
(more generic)

> user-defined

> Perhaps collapse macro and micro structure into one set... Again, just
> ideas for now, will work this week to work them into a concrete
> organization for the lexer - once we generate a complete list of
> concrete mkiv commands.
>
> If we can generate a complete version of the list in
> scite-context-data-interfaces (including \bTR etc.) then we can subtract
> that from the complete list of concrete mkiv commands, giving us
> mutually exclusive and jointly exhaustive high/low-level lists.
>
> Any help and other ideas are greatly appreciated!
>
> Idris


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon May 15 21:00:37 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 15 May 2017 21:00:37 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl>
Message-ID: <5919FAD5.9060604@gmail.com>


> Hans Hagen <mailto:pragma at wxs.nl>
> 15. Mai 2017 um 11:43
> On 5/14/2017 8:55 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
>> On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster
>> <schuster.wolfgang at gmail.com> wrote:
>>
>>>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>>>> Style Configurator (Notepad++) and get their own highlight color. I
>>>> have found this very useful in writing long documents. See attached
>>>> (User-defined Keywords dialog).
>>>
>>> You can limit the number of custom commands when you use
>>>
>>>      \startnamedsection[topic][title=...]
>>>
>>> instead of
>>>
>>>      \starttopic[title=...]
>>
>> First time encountering these two commands; they're not on the wiki,
>> need to learn more about them..
>
> in mkiv most commands that have generated names also provide generic 
> instance handling, like here
>
>> Can you explain or give a complete sample test file illustrating how
>> they apply in the matter under discussion? Thanks.
>
> afaiks there is not much to add to the above example unless i 
> misunderstood; basically one can always use "topic" as instance name 
> to do something instead of \somecommandwith<topic>init
>
>> something like the following:
>>
>> TeX primitives - Knuth
>> luaTeX primitives - excluding Knuth
>> macro structure - e.g., sectioning etc.
>> micro structure - e.g., itemizations, tables etc.
>
> here i have document level (\startdocument etc) vs the rest
>
>> mode structure - e.g., metapost, xml, markdown
>> MkiV - remaining high level
>> MkIV - low-level [but how to separate them out?]
>
> is there a need to separate them? after all, most users will not use 
> low level code and when they do it doesn't matter much to them if 
> they're more or less low level
>
> low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter 
> (more generic)
I can add class="system|primitive" (or level="...") to the XML files, 
commands without attribute are user-level.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170515/c780d6ff/attachment.html>

From pragma at wxs.nl  Mon May 15 21:45:52 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 15 May 2017 21:45:52 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <5919FAD5.9060604@gmail.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
Message-ID: <a1c35397-e8d3-3dcc-8426-81bcb2b0ccb9@wxs.nl>

On 5/15/2017 9:00 PM, Wolfgang Schuster wrote:

>> is there a need to separate them? after all, most users will not use
>> low level code and when they do it doesn't matter much to them if
>> they're more or less low level
>>
>> low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter
>> (more generic)
> I can add class="system|primitive" (or level="...") to the XML files,
> commands without attribute are user-level.

i assume that with primitive you mean primitive context

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Mon May 15 21:57:50 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 15 May 2017 21:57:50 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <a1c35397-e8d3-3dcc-8426-81bcb2b0ccb9@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <a1c35397-e8d3-3dcc-8426-81bcb2b0ccb9@wxs.nl>
Message-ID: <591A083E.3090002@gmail.com>


> Hans Hagen <mailto:pragma at wxs.nl>
> 15. Mai 2017 um 21:45
> On 5/15/2017 9:00 PM, Wolfgang Schuster wrote:
>
>
> i assume that with primitive you mean primitive context
No, TeX primitives.

<cd:command name="abovewithdelims" class="primitive">
<cd:arguments>
<cd:resolve name="string-text"/>
<cd:resolve name="string-text"/>
<cd:resolve name="string-dimension"/>
</cd:arguments>
</cd:command>

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170515/85dea34c/attachment.html>

From pragma at wxs.nl  Tue May 16 10:23:52 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 16 May 2017 10:23:52 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <591A083E.3090002@gmail.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <a1c35397-e8d3-3dcc-8426-81bcb2b0ccb9@wxs.nl> <591A083E.3090002@gmail.com>
Message-ID: <18ec26ac-18c7-8fe2-3979-1cb6ff3eff48@wxs.nl>

On 5/15/2017 9:57 PM, Wolfgang Schuster wrote:
>
>> Hans Hagen <mailto:pragma at wxs.nl>
>> 15. Mai 2017 um 21:45
>> On 5/15/2017 9:00 PM, Wolfgang Schuster wrote:
>>
>>
>> i assume that with primitive you mean primitive context
> No, TeX primitives.
>
> <cd:command name="abovewithdelims" class="primitive">
>     <cd:arguments>
>         <cd:resolve name="string-text"/>
>         <cd:resolve name="string-text"/>
>         <cd:resolve name="string-dimension"/>
>     </cd:arguments>
> </cd:command>

aha, so all these have to be entered then

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue May 16 15:16:57 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 16 May 2017 15:16:57 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0bzkwpyejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <op.y0bzkwpyejo439@desktop-mt1m160>
Message-ID: <099782e0-4a55-302d-0b41-5d845989d64f@wxs.nl>

On 5/16/2017 2:27 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> Hi Wolfgang,
>
> On Mon, 15 May 2017 13:00:37 -0600, Wolfgang Schuster
> <schuster.wolfgang at gmail.com> wrote:
>
>>
>>> Hans Hagen <mailto:pragma at wxs.nl>
>
>>> low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter
>>> (more generic)
>> I can add class="system|primitive" (or level="...") to the XML files,
>> commands without attribute are user-level.
>
> It would be great to include this system-primitive class in the lexer,
> but if that's too much of a burden short-term then perhaps we should not
> wait... Do you have an approximate time-frame for when this can be done?
> I presume it will take a long time to put that class together...

everything setups is long term and normally ctx group meetings are 
moments when something is/gets done

(if you'd seen Wolfgangs awesome ledgers at the last meeting you'd 
probably understand better what i mean)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue May 16 15:17:43 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 16 May 2017 15:17:43 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0bzw3qtejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <op.y0bzkwpyejo439@desktop-mt1m160> <op.y0bzw3qtejo439@desktop-mt1m160>
Message-ID: <18f2f7bf-eb57-a6ea-9d73-836d574336ac@wxs.nl>

On 5/16/2017 2:35 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Tue, 16 May 2017 06:27:49 -0600, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯
> <Idris.Hamid at colostate.edu> wrote:
>
>> Hi Wolfgang,
>>
>> On Mon, 15 May 2017 13:00:37 -0600, Wolfgang Schuster
>> <schuster.wolfgang at gmail.com> wrote:
>>
>>>
>>>> Hans Hagen <mailto:pragma at wxs.nl>
>>
>>>> low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter
>>>> (more generic)
>>> I can add class="system|primitive" (or level="...") to the XML files,
>>> commands without attribute are user-level.
>>
>> It would be great to include this system-primitive class in the lexer,
>> but if that's too much of a burden short-term then perhaps we should
>> not wait... Do you have an approximate time-frame for when this can be
>> done? I presume it will take a long time to put that class together...
>
> Apologies, got confused, assumed we were talking about low-level context
> commands, not TeX/luaTeX primitives.

sure, but a categorization has to cover all aspects of tex

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Tue May 16 15:26:11 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 16 May 2017 15:26:11 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <18ec26ac-18c7-8fe2-3979-1cb6ff3eff48@wxs.nl>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <a1c35397-e8d3-3dcc-8426-81bcb2b0ccb9@wxs.nl> <591A083E.3090002@gmail.com>
 <18ec26ac-18c7-8fe2-3979-1cb6ff3eff48@wxs.nl>
Message-ID: <591AFDF3.1030909@gmail.com>


> Hans Hagen <mailto:pragma at wxs.nl>
> 16. Mai 2017 um 10:23
>
>
> aha, so all these have to be entered then
Yes but it wonât be finished in the next time.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/a25b2de6/attachment.html>

From schuster.wolfgang at gmail.com  Tue May 16 15:31:59 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 16 May 2017 15:31:59 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0bzkwpyejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160>
 <ffa378d8-1abd-b932-870f-21d9c5c80d0b@wxs.nl> <5919FAD5.9060604@gmail.com>
 <op.y0bzkwpyejo439@desktop-mt1m160>
Message-ID: <591AFF4F.5060807@gmail.com>


> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 16. Mai 2017 um 14:27
> Hi Wolfgang,
>
> On Mon, 15 May 2017 13:00:37 -0600, Wolfgang Schuster 
> <schuster.wolfgang at gmail.com> wrote:
>
>>
>>> Hans Hagen <mailto:pragma at wxs.nl>
>
>>> low level is fuzzy anyway: \xmlfirst (more low level?) vs \xmlfilter
>>> (more generic)
>> I can add class="system|primitive" (or level="...") to the XML files,
>> commands without attribute are user-level.
>
> It would be great to include this system-primitive class in the lexer, 
> but if that's too much of a burden short-term then perhaps we should 
> not wait... Do you have an approximate time-frame for when this can be 
> done? I presume it will take a long time to put that class together...
Marking internal/system command is simple but it will take a few days 
(boring stuff you wonât do for a few hours).

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/0a44f926/attachment.html>

From schuster.wolfgang at gmail.com  Tue May 16 15:38:33 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Tue, 16 May 2017 15:38:33 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0b1uyt5ejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160>
Message-ID: <591B00D9.8010003@gmail.com>


> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 16. Mai 2017 um 15:17
> On Sun, 14 May 2017 14:04:41 -0600, Wolfgang Schuster 
> <schuster.wolfgang at gmail.com> wrote:
>
>>> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
>>> 14. Mai 2017 um 20:55
>>> On Sun, 14 May 2017 12:20:43 -0600, Wolfgang Schuster
>>> <schuster.wolfgang at gmail.com> wrote:
>>>
>>>>> OTOH user-defined commands can be added to the ConTeXt lexer via the
>>>>> Style Configurator (Notepad++) and get their own highlight color. I
>>>>> have found this very useful in writing long documents. See attached
>>>>> (User-defined Keywords dialog).
>>>>
>>>> You can limit the number of custom commands when you use
>>>>
>>>>      \startnamedsection[topic][title=...]
>>>>
>>>> instead of
>>>>
>>>>      \starttopic[title=...]
>>>
>>> First time encountering these two commands; they're not on the wiki,
>>> need to learn more about them..
>>>
>>> Can you explain or give a complete sample test file illustrating how
>>> they apply in the matter under discussion? Thanks.
>> This is only a example to demonstrate that you can create new commands
>> without using new command names (and the need to add them to your lexer)
>> in your document.
>>
>> In the example below I create a new section but I donât have to use
>> a new user generated command in the document itself.
>>
>> \definehead[topic][subject]
>>
>> \starttext
>>
>> \startnamedsection[topic][title=This is a topic]
>> ...
>> \stopnamedsection
>>
>> \stoptext
>
> I see your point. Will make a note of it for the lexer documentation.
>
>>>> Adding tags to the commands is planned but the question is how to
>>>> categorize them (internal, api, user level, low level, primitives,
>>>> defininitions (\define...), setups etc.).
>>>
>>> This is good to know. At the moment we're working on a full-featured
>>> ConTeXt lexer and are experimenting with different ideas of organizing
>>> commands for user-friendly syntax highlighting. Currently considering
>>> something like the following:
>>>
>>> TeX primitives - Knuth
>>> luaTeX primitives - excluding Knuth
>> The syntax files contain at the moment only ConTeXt specific command,
>> primitives arenât included.
>
> Sure, we get the TeX and luaTeX commands from the scite*.lua files
>
>>> macro structure - e.g., sectioning etc.
>>> micro structure - e.g., itemizations, tables etc.
>>> mode structure - e.g., metapost, xml, markdown
>> The XML source has a category attribute for this information.
>
> Could you give a couple of examples?
Below is a example for \m{â¦}.

<cd:command name="m" category="mathematics" file="math-ini.mkiv">
<cd:arguments>
<cd:resolve name="keyword-name-optional"/>
<cd:content/>
</cd:arguments>
</cd:command>

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/49fb7975/attachment-0001.html>

From pragma at wxs.nl  Wed May 17 00:17:46 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 May 2017 00:17:46 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
Message-ID: <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>

On 5/16/2017 9:57 PM, Yu,Jason wrote:
> Hi all,
>
>
> I wrote a python script to auto-generate keyword lists from the full xml
> file. All the "abstract" keywords (those with a <cd:sequence>
> </cd:sequence> tag) are simply ignored. The full list is in the
> KEYWORDS.txt file.

idris probably also wants the instances, so \startsubject and so; in due 
time we'll add cd:instances to the relevant commands (kind of 
experimental now)

anyway, not that you can make lists you can always provide idris with 
updated onces

categories can come later

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 17 09:43:38 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 May 2017 09:43:38 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0crpli4ejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
Message-ID: <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>

On 5/17/2017 12:35 AM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Tue, 16 May 2017 16:17:46 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>
>> On 5/16/2017 9:57 PM, Yu,Jason wrote:
>>> Hi all,
>>>
>>>
>>> I wrote a python script to auto-generate keyword lists from the full xml
>>> file. All the "abstract" keywords (those with a <cd:sequence>
>>> </cd:sequence> tag) are simply ignored. The full list is in the
>>> KEYWORDS.txt file.
>>
>> idris probably also wants the instances, so \startsubject and so; in
>> due time we'll add cd:instances to the relevant commands (kind of
>> experimental now)
>
> Hmm, so we have an ambiguity. See setup-en.pdf, p. 302:
>
> \startSECTION is typeset in slanted, but is an abstract command that can
> have an indefinite number of instances
>
> \startchapter is typeset in slanted, but is a concrete command -- in
> this case a pre-supported instance of an abstract command.
>
> Question 1: Why is \startchapter typeset in slanted?

to show that it's an instance

> Question 2: Is there a hook in the i-*.xml files so that Jason's script
> can distinguish between abstract commands and pre-supported instances?
> We want a way to capture the latter while ignoring the former? Or are we
> stuck with the ambiguity until cd:instances is supported? In the latter
> case we'll have to do some manual work...

cd:instances

>> anyway, not that you can make lists you can always provide idris with
>> updated onces
>>
>> categories can come later
>
> Thanks Hans
>
> Idris


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed May 17 15:25:41 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 May 2017 15:25:41 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0dt02zxejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
 <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>
 <op.y0dt02zxejo439@desktop-mt1m160>
Message-ID: <2ae09f75-29eb-823e-717e-9b9c74b5cf4e@wxs.nl>

On 5/17/2017 2:23 PM, Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ wrote:
> On Wed, 17 May 2017 01:43:38 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>
>>>>> I wrote a python script to auto-generate keyword lists from the
>>>>> full xml
>>>>> file. All the "abstract" keywords (those with a <cd:sequence>
>>>>> </cd:sequence> tag) are simply ignored. The full list is in the
>>>>> KEYWORDS.txt file.
>>>>
>>>> idris probably also wants the instances, so \startsubject and so; in
>>>> due time we'll add cd:instances to the relevant commands (kind of
>>>> experimental now)
>>>
>>> Hmm, so we have an ambiguity. See setup-en.pdf, p. 302:
>>>
>>> \startSECTION is typeset in slanted, but is an abstract command that can
>>> have an indefinite number of instances
>>>
>>> \startchapter is typeset in slanted, but is a concrete command -- in
>>> this case a pre-supported instance of an abstract command.
>>>
>>> Question 1: Why is \startchapter typeset in slanted?
>>
>> to show that it's an instance
>>
>>> Question 2: Is there a hook in the i-*.xml files so that Jason's script
>>> can distinguish between abstract commands and pre-supported instances?
>>> We want a way to capture the latter while ignoring the former? Or are we
>>> stuck with the ambiguity until cd:instances is supported? In the latter
>>> case we'll have to do some manual work...
>>
>> cd:instances
>
> While we wait for support cd:instances: How about this heuristic to
> distinguish abstract commands from pre-supported instances:
>
> =======
> If slanted and containing and containing *no* capital letters, treat as
> an instance.
> =======

(slanted is not part of the coding, instances is)

> Wolfgang, Hans: Will this heuristic leave any residue, i.e., leave out
> any pre-supported instances?

well, you can easilly check that .. probably it's ok but not a complete 
list


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Wed May 17 16:15:11 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 17 May 2017 16:15:11 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0dyp0j2ejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
 <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>
 <op.y0dt02zxejo439@desktop-mt1m160>
 <2ae09f75-29eb-823e-717e-9b9c74b5cf4e@wxs.nl>
 <op.y0dyp0j2ejo439@desktop-mt1m160>
Message-ID: <591C5AEF.5020607@gmail.com>


> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 17. Mai 2017 um 16:04
> On Wed, 17 May 2017 07:25:41 -0600, Hans Hagen <pragma at wxs.nl> wrote:
>
>>>> cd:instances
>>>
>>> While we wait for support cd:instances: How about this heuristic to
>>> distinguish abstract commands from pre-supported instances:
>>>
>>> =======
>>> If slanted and containing and containing *no* capital letters, treat as
>>> an instance.
>>> =======
>>
>> (slanted is not part of the coding, instances is)
>
> Sure, but we have to distinguish abstract commands from pre-supported 
> instances of abstract commands, both of which are typeset as slanted.
>
> So we need a simple name for the genus that encompasses both abstract 
> commands and pre-supported instances of abstract commands.
>
> Perhaps 'generic'. All commands typeset as slanted in setup-en etc. 
> are generic commands. So to rephrase
>
> =======
> If a command is generic and contains *no* capital letters, treat as a 
> concrete instance.
> =======
>
> So whatever hook marks off a command to be treated as slanted is what 
> marks it as a generic command.

Below this is the entry for \section in my own version of the setups 
files. All commands with instances
have the attribute variant="instance" and the predefined instances are 
listed under cd:instances.

Commands which are slanted in the manual are produced by a \defineXXX 
command which
is documented with the generated="yes" attribute. For your list you can 
ignore the values
under cd:sequence and use only the listed instances.

<cd:command name="section" generated="yes" variant="instance" 
file="strc-sec.mkiv">
<cd:sequence>
<cd:instance value="section"/>
</cd:sequence>
<cd:arguments>
<cd:resolve name="keyword-reference-list-optional"/>
<cd:resolve name="argument-text"/>
</cd:arguments>
<cd:instances>
<cd:constant value="part"/>
<cd:constant value="chapter"/>
<cd:constant value="section"/>
<cd:constant value="subsection"/>
<cd:constant value="subsubsection"/>
<cd:constant value="subsubsubsection"/>
<cd:constant value="subsubsubsubsection"/>
<cd:constant value="title"/>
<cd:constant value="subject"/>
<cd:constant value="subsubject"/>
<cd:constant value="subsubsubject"/>
<cd:constant value="subsubsubsubject"/>
<cd:constant value="subsubsubsubsubject"/>
</cd:instances>
</cd:command>

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170517/82688a12/attachment.html>

From Jason.Yu at colostate.edu  Tue May 16 21:57:35 2017
From: Jason.Yu at colostate.edu (Yu,Jason)
Date: Tue, 16 May 2017 19:57:35 +0000
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0b392nbejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160>
 <591B00D9.8010003@gmail.com>,<op.y0b392nbejo439@desktop-mt1m160>
Message-ID: <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>

Hi all,


I wrote a python script to auto-generate keyword lists from the full xml file. All the "abstract" keywords (those with a <cd:sequence> </cd:sequence> tag) are simply ignored. The full list is in the KEYWORDS.txt file.


Thanks,

Jason

________________________________
From: Hamid,Idris
Sent: Tuesday, May 16, 2017 8:09:28 AM
To: Wolfgang Schuster
Cc: Hans Hagen; dev-context at ntg.nl; Yu,Jason
Subject: Re: setup-en.pdf and mkiv command list

On Tue, 16 May 2017 07:38:33 -0600, Wolfgang Schuster
<schuster.wolfgang at gmail.com> wrote:

>>>> TeX primitives - Knuth
>>>> luaTeX primitives - excluding Knuth
>>> The syntax files contain at the moment only ConTeXt specific command,
>>> primitives arenât included.
>>
>> Sure, we get the TeX and luaTeX commands from the scite*.lua files
>>
>>>> macro structure - e.g., sectioning etc.
>>>> micro structure - e.g., itemizations, tables etc.
>>>> mode structure - e.g., metapost, xml, markdown
>>> The XML source has a category attribute for this information.
>>
>> Could you give a couple of examples?
> Below is a example for \m{â¦}.
>
> <cd:command name="m" category="mathematics" file="math-ini.mkiv">
> <cd:arguments>
> <cd:resolve name="keyword-name-optional"/>
> <cd:content/>
> </cd:arguments>
> </cd:command>

Wonderful. So the task is two-fold:

i)  categorization of context commands via the category attribute
ii) adding tex and luatex primitive classes

For editors, the abstract commands (\ATTACHMENT, \CHARACTERKERNING etc.)
do not need to be generated.

Idris
--
Idris Samawi Hamid, Professor
Department of Philosophy
Colorado State University
Fort Collins, CO 80512
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/cd730f17/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: command_gen.py
Type: application/octet-stream
Size: 3877 bytes
Desc: command_gen.py
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/cd730f17/attachment-0001.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: KEYWORDS.txt
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170516/cd730f17/attachment-0001.txt>

From pragma at wxs.nl  Wed May 17 20:30:38 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 May 2017 20:30:38 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <CY4PR07MB3096AE9B57F5002E4E76DB5683E70@CY4PR07MB3096.namprd07.prod.outlook.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
 <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>
 <op.y0dt02zxejo439@desktop-mt1m160>
 <2ae09f75-29eb-823e-717e-9b9c74b5cf4e@wxs.nl>
 <op.y0dyp0j2ejo439@desktop-mt1m160> <591C5AEF.5020607@gmail.com>
 <CY4PR07MB3096AE9B57F5002E4E76DB5683E70@CY4PR07MB3096.namprd07.prod.outlook.com>
Message-ID: <0bc4184e-f581-93cd-ebbd-ac9a47013836@wxs.nl>

On 5/17/2017 8:27 PM, Yu,Jason wrote:
> I suppose not all abstract commands has  <cd:instances> tag. For

not yet ... it's work in progress, so you can assume tyhat over time the 
xml file gets more complete


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Wed May 17 20:37:19 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 17 May 2017 20:37:19 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <CY4PR07MB3096AE9B57F5002E4E76DB5683E70@CY4PR07MB3096.namprd07.prod.outlook.com>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
 <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>
 <op.y0dt02zxejo439@desktop-mt1m160>
 <2ae09f75-29eb-823e-717e-9b9c74b5cf4e@wxs.nl>
 <op.y0dyp0j2ejo439@desktop-mt1m160>, <591C5AEF.5020607@gmail.com>
 <CY4PR07MB3096AE9B57F5002E4E76DB5683E70@CY4PR07MB3096.namprd07.prod.outlook.com>
Message-ID: <591C985F.8060006@gmail.com>


> Yu,Jason <mailto:Jason.Yu at colostate.edu>
> 17. Mai 2017 um 20:27
>
> I suppose not all abstract commands has <cd:instances> tag. For 
> example, \ORNAMENT does not have <cd:instances>, but it is still 
> recognized as an abstract keyword (slanted). In my python script, I 
> recognized every abstract keyword by determining if it has a 
> <cd:sequence> tag, which seems to be right.
>
Not all commands which let you create instances have predefined ones, 
e.g. there are no predefined descriptions.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170517/04839582/attachment.html>

From schuster.wolfgang at gmail.com  Wed May 17 20:39:15 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Wed, 17 May 2017 20:39:15 +0200
Subject: [dev-context] setup-en.pdf and mkiv command list
In-Reply-To: <op.y0eal2tfejo439@desktop-mt1m160>
References: <op.yz6zmzqlejo439@desktop-mt1m160>
 <dd65a98c-0229-835d-0048-6c1842a8d488@wxs.nl>
 <op.yz8l2zg5ejo439@desktop-mt1m160>
 <5be47c7c-3b3d-b412-c6ea-cf8efa21381c@wxs.nl> <5918960B.9060001@gmail.com>
 <op.yz8pxmngejo439@desktop-mt1m160> <59189FFB.5060002@gmail.com>
 <op.yz8r68sdejo439@desktop-mt1m160> <5918B859.8080803@gmail.com>
 <op.y0b1uyt5ejo439@desktop-mt1m160> <591B00D9.8010003@gmail.com>
 <op.y0b392nbejo439@desktop-mt1m160>
 <CY4PR07MB30964A84C52C53D9E213027783E60@CY4PR07MB3096.namprd07.prod.outlook.com>
 <6135ce68-a5ff-4e24-1d07-1a1b22a57fcf@wxs.nl>
 <op.y0crpli4ejo439@desktop-mt1m160>
 <d820db13-2f59-90ab-fb59-c284b06823a2@wxs.nl>
 <op.y0dt02zxejo439@desktop-mt1m160>
 <2ae09f75-29eb-823e-717e-9b9c74b5cf4e@wxs.nl>
 <op.y0dyp0j2ejo439@desktop-mt1m160> <591C5AEF.5020607@gmail.com>
 <op.y0eal2tfejo439@desktop-mt1m160>
Message-ID: <591C98D3.1080304@gmail.com>


> Idris Samawi Hamid Ø§Ø¯Ø±ÙØ³ Ø³ÙØ§ÙÙ Ø­Ø§ÙØ¯ <mailto:Idris.Hamid at colostate.edu>
> 17. Mai 2017 um 20:21
> On Wed, 17 May 2017 08:15:11 -0600, Wolfgang Schuster 
> <schuster.wolfgang at gmail.com> wrote:
>
>
> This is what I get from running
>
> context x-setups-generate.mkiv
>
> <cd:command file="strc-sec.mkiv" generated="yes" name="section" 
> variant="instance">
> <cd:sequence>
> <cd:instance value="section"/>
> </cd:sequence>
> <cd:arguments>
> <cd:keywords list="yes" optional="yes">
> <cd:constant type="cd:reference"/>
> </cd:keywords>
> <cd:keywords delimiters="braces">
> <cd:constant type="cd:text"/>
> </cd:keywords>
> </cd:arguments>
> <cd:instances>
> <cd:constant value="chapter"/>
> <cd:constant value="section"/>
> <cd:constant value="subsection"/>
> <cd:constant value="subsubsection"/>
> <cd:constant value="subsubsubsection"/>
> <cd:constant value="subsubsubsubsection"/>
> <cd:constant value="title"/>
> <cd:constant value="subject"/>
> <cd:constant value="subsubject"/>
> <cd:constant value="subsubsubject"/>
> <cd:constant value="subsubsubsubject"/>
> <cd:constant value="subsubsubsubsubject"/>
> </cd:instances>
> </cd:command>
>
> This is different from what I get from the latest ConTeXt - 2017.05.15 
> 21:48.
>
> Notably, \part is missing from the official context version; it's also 
> missing in the generated x-setups-generate.pdf and the published 
> setup-en.pdf. So there are bugs in the official version -)
>
> Wolfgang: When will your latest sources be ready for distribution or 
> sharing? Thanks in advance.
I can send them in a few days.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170517/0832225f/attachment.html>

From krobbins at alumni.princeton.edu  Fri May 19 05:36:47 2017
From: krobbins at alumni.princeton.edu (Kevin D. Robbins)
Date: Thu, 18 May 2017 21:36:47 -0600
Subject: [dev-context] Is it possible to change the converted figure cache
	directory for a build?
Message-ID: <CAPtCXry--Z-2EktuMy726=Zry5BbX=1tdOxyuZDUhDX240S=zQ@mail.gmail.com>

By default, converted figures (m_k_i_v_foo.pdf for source figure foo.svg)
are written to the same directory as the source figure. I would like all
converted figures to be written instead to a cache directory in my home
directory. How do I set this path?

I asked this question on the ConTeXt users mailing list, but no one had an
answer. Is there no user interface (environment variable, command line
parameter, etc.) available to change where converted figures are written on
disk?

Best Regards,

Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170518/89bf65f7/attachment.html>

From oinos at gmx.es  Sat May 27 19:01:17 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sat, 27 May 2017 19:01:17 +0200
Subject: [dev-context] /UseAttachments and /UseOC for /PageMode
Message-ID: <edfcf4d3-a109-f24a-294f-e201eb9f5a2b@gmx.es>

Hans,

the attachment contains a patch to be able to set /PageMode to
attachments or optional contents.

Values are attach and oc. These were the simplest names that came to my
mind.

I realized these are extremely useful, since vast majority of people
(including IT guys) donât seem to know how to extract attachments from
PDF documents.

Could you apply it to ConTeXt?

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: attach-oc.diff
Type: text/x-patch
Size: 1159 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170527/1c15a6b5/attachment.bin>

From pragma at wxs.nl  Sun May 28 12:05:09 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 28 May 2017 12:05:09 +0200
Subject: [dev-context] /UseAttachments and /UseOC for /PageMode
In-Reply-To: <edfcf4d3-a109-f24a-294f-e201eb9f5a2b@gmx.es>
References: <edfcf4d3-a109-f24a-294f-e201eb9f5a2b@gmx.es>
Message-ID: <f6ea0797-f084-34ba-a119-a132e9d007fb@wxs.nl>

On 5/27/2017 7:01 PM, Pablo Rodriguez wrote:
> Hans,
> 
> the attachment contains a patch to be able to set /PageMode to
> attachments or optional contents.
> 
> Values are attach and oc. These were the simplest names that came to my
> mind.
What do these keys do? OC is layers (optional content) isn't it?


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Sun May 28 12:26:51 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 28 May 2017 12:26:51 +0200
Subject: [dev-context] /UseAttachments and /UseOC for /PageMode
In-Reply-To: <f6ea0797-f084-34ba-a119-a132e9d007fb@wxs.nl>
References: <edfcf4d3-a109-f24a-294f-e201eb9f5a2b@gmx.es>
 <f6ea0797-f084-34ba-a119-a132e9d007fb@wxs.nl>
Message-ID: <23f58d60-5acc-fb01-fb04-bbe25b577bca@gmx.es>

On 05/28/2017 12:05 PM, Hans Hagen wrote:
> On 5/27/2017 7:01 PM, Pablo Rodriguez wrote:
>> Hans,
>>
>> the attachment contains a patch to be able to set /PageMode to
>> attachments or optional contents.
>>
>> Values are attach and oc. These were the simplest names that came to my
>> mind.
>
> What do these keys do? OC is layers (optional content) isn't it?

Sorry for not being clear, Hans.

OC stands for layers (and maybe layer is a better name than oc).

The same way bookmark in \setupinteractionscreen[option=bookmark] opens
the bookmark display (http://pdf.ousia.tk/bookmark.png), attach opens
the attachment display (http://pdf.ousia.tk/attach.png) and oc, but
layer is a better name, opens the layer display
(http://pdf.ousia.tk/layer.png, although the document has no layers).

I hope it is clearer now. Let me know if it isnât.

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From oinos at gmx.es  Mon May 29 20:29:58 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 29 May 2017 20:29:58 +0200
Subject: [dev-context] fix for \attachment[method=hidden]
Message-ID: <67fddfc8-2b59-8c26-24a3-a9ced02bd064@gmx.es>

Hans,

the following sample shows an issue with attachments:

    \setupinteraction[state=start]
    \setupinteractionscreen[option=attachment]
    \setuppapersize[A5, landscape]
    \setuppagenumbering[location=]
    \starttext
    \input knuth\attachment[file=e.pdf, title=Attachment \letterhash1,
     author=ConTeXt, subtitle=ÏÎ±Î»ÎµÏá½° Ïá½° ÎºÎ±Î»Î¬, method=hidden]
    \stoptext

method=hidden (http://pdf.ousia.tk/attachment-hidden.pdf) doesnât
actually attach the file (http://pdf.ousia.tk/attachment-hidden.png).

But method=visible (http://pdf.ousia.tk/attachment-visible.pdf) attachs
the file (http://pdf.ousia.tk/attachment-visible.png)

Iâm afraid that method=hidden was missing subtitle, file and name. I
would say that buffer is also missing there, but I donât know what it
is used for.

The attached .diff file fixes the issue. I have tested it and it works
fine.

I hope it helps,

Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: attachment-hidden.diff
Type: text/x-patch
Size: 593 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170529/6626380b/attachment.bin>

From oinos at gmx.es  Wed Jun  7 20:39:39 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Wed, 7 Jun 2017 20:39:39 +0200
Subject: [dev-context] translate Dutch sample included in grph-inc.mkiv
Message-ID: <21f161ba-cf68-5967-8e5a-697425036ccd@gmx.es>

Hans,

I have just noticed that grph-inc.mkiv includes a small sample in Dutch.
I guess this isnât intended.

The attached patch fixes it.

I hope it helps,

Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: breedte-width.diff
Type: text/x-patch
Size: 1536 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170607/b2e23f25/attachment.bin>

From oinos at gmx.es  Wed Jun  7 20:51:16 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Wed, 7 Jun 2017 20:51:16 +0200
Subject: [dev-context] fix for \attachment[method=hidden]
In-Reply-To: <67fddfc8-2b59-8c26-24a3-a9ced02bd064@gmx.es>
References: <67fddfc8-2b59-8c26-24a3-a9ced02bd064@gmx.es>
Message-ID: <00709080-64c6-02b4-1d46-84aad6a7714e@gmx.es>

Hans,

sorry for insisting in this issue. Here is the sample:

    \setupinteraction[state=start]
    \setupinteractionscreen[option=attachment]
    \setuppapersize[A5, landscape]
    \setuppagenumbering[location=]
    \starttext
    \startbuffer[abc]
    hola Î¼Î±ÏÎ¹ÏÎ»Î±
    \stopbuffer
    This PDF document contains a visible
    attachment.\attachment[name=hidden.txt, title={ÏÎ±Î»ÎµÏá½° Ïá½° ÎºÎ±Î»Î¬},
    author=ConTeXt, subtitle=ÏÎ±Î»ÎµÏá½° Ïá½° ÎºÎ±Î»Î¬, method=hidden, buffer=abc]

    This PDF document should contain the same hidden attachment (under
    a different name\attachment[name=visible.txt, title={ÏÎ±Î»ÎµÏá½° Ïá½°
    ÎºÎ±Î»Î¬}, author=ConTeXt, subtitle=ÏÎ±Î»ÎµÏá½° Ïá½° ÎºÎ±Î»Î¬, method=visible,
    buffer=abc].
    \stoptext

I attach the patch. With the previous sample, it is clear that the
buffer keyword is needed in method=hidden.

Many thanks for your help,

Pablo


On 05/29/2017 08:29 PM, Pablo Rodriguez wrote:
> Hans,
> 
> the following sample shows an issue with attachments:
> 
>     \setupinteraction[state=start]
>     \setupinteractionscreen[option=attachment]
>     \setuppapersize[A5, landscape]
>     \setuppagenumbering[location=]
>     \starttext
>     \input knuth\attachment[file=e.pdf, title=Attachment \letterhash1,
>      author=ConTeXt, subtitle=ÏÎ±Î»ÎµÏá½° Ïá½° ÎºÎ±Î»Î¬, method=hidden]
>     \stoptext
> 
> method=hidden (http://pdf.ousia.tk/attachment-hidden.pdf) doesnât
> actually attach the file (http://pdf.ousia.tk/attachment-hidden.png).
> 
> But method=visible (http://pdf.ousia.tk/attachment-visible.pdf) attachs
> the file (http://pdf.ousia.tk/attachment-visible.png)
> 
> Iâm afraid that method=hidden was missing subtitle, file and name. I
> would say that buffer is also missing there, but I donât know what it
> is used for.
> 
> The attached .diff file fixes the issue. I have tested it and it works
> fine.
> 
> I hope it helps,
> 
> Pablo


-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: attachment-hidden.diff
Type: text/x-patch
Size: 593 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170607/e0c482a9/attachment.bin>

From adityam at umich.edu  Sat Aug  5 06:50:23 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 5 Aug 2017 00:50:23 -0400 (EDT)
Subject: [dev-context] mathpairs
Message-ID: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>

Hi Hans,

Currently the following mathpairs are defined:

:=  \colonequals
=:  \equalscolon
<=  \le
>=  \ge
!=  \neq

Are these all? (Why is != defined using specials?)

Does it make sense to define others? I can think of the following:

<<  \ll
>>  \gg
<<< \lll
>>> \ggg
== \equiv

In addition, we can also add arrows.
Because one wants to distinguish between \Leftarrow (<=) and \le (<=), I 
am defining arrows using two ==.

-> \rightarrow
<- \leftarrow
<-> \leftrightarrow
==> \Rightarrow
<== \Leftarrow
<=> \Leftrightarrow
===> \Longrightarrow
<=== \Longleftarrow
<==> \Longleftrightarrow

I see this as marginally useful. Does it make sense to add support for 
math pairs of size three and four? If so, I am attaching a patch for 
char-def.lua that provides this support (as well as a test file).

Everything works except ===>. The reason is that === is not mapped to 
anything. In the attached file, I tried mapping === (i.e., 0x2261 + 0x3D) 
to 0x2A76 (I gave it a mathname "eqeqeq" as well; this is consistent with 
latex's unicode-math package). However, this glyph is missing 
from LM and cambria, and === to \eqeqeq mapping doesn't work.

Any idea on how to fix this or is there another approach without defining 
a mapping for ===. (that will also help us to define --> where I couldn't 
figure out what I should map -- to; I can map it to en-dash, but that just 
feels wrong).

Thanks,
Aditya

PS: Currently, !=== !<= etc doesn't work (neither does \not <=, etc.). It 
can be fixed,  but at that stage I am not sure it worth using math pairs.

PPS: Monospace fonts with ligatures: 
https://www.hanselman.com/blog/MonospacedProgrammingFontsWithLigatures.aspx

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: application/x-tex
Size: 904 bytes
Desc: 
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170805/aaa32389/attachment.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: char-def.patch
Type: text/x-diff
Size: 3276 bytes
Desc: 
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170805/aaa32389/attachment.patch>

From adityam at umich.edu  Sat Aug  5 06:53:28 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sat, 5 Aug 2017 00:53:28 -0400 (EDT)
Subject: [dev-context] mathpairs
In-Reply-To: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>
References: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>
Message-ID: <alpine.OSX.2.02.1708050052140.65966@nqv-znpobbx>

On Sat, 5 Aug 2017, Aditya Mahajan wrote:

> :=  \colonequals
> =:  \equalscolon

BTW, should we remove the definitions of \colonequals, \equalcolons, and 
\minuscolon from math-def.mkiv?

Aditya

From pragma at wxs.nl  Sun Aug  6 12:08:33 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 6 Aug 2017 12:08:33 +0200
Subject: [dev-context] mathpairs
In-Reply-To: <alpine.OSX.2.02.1708050052140.65966@nqv-znpobbx>
References: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>
 <alpine.OSX.2.02.1708050052140.65966@nqv-znpobbx>
Message-ID: <293af0e7-e37a-7d32-14f6-b72402984fe9@wxs.nl>

On 8/5/2017 6:53 AM, Aditya Mahajan wrote:
> On Sat, 5 Aug 2017, Aditya Mahajan wrote:
> 
>> :=  \colonequals
>> =:  \equalscolon
> 
> BTW, should we remove the definitions of \colonequals, \equalcolons, and 
> \minuscolon from math-def.mkiv?
i'll comment them ... how about the others .. i can make them into 
virtual characters if needed .. or do they need to be added to unicode 
(given that we have proof of usage, in that case we can ask barbara)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Sun Aug  6 22:51:23 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 6 Aug 2017 16:51:23 -0400 (EDT)
Subject: [dev-context] mathpairs
In-Reply-To: <293af0e7-e37a-7d32-14f6-b72402984fe9@wxs.nl>
References: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>
 <alpine.OSX.2.02.1708050052140.65966@nqv-znpobbx>
 <293af0e7-e37a-7d32-14f6-b72402984fe9@wxs.nl>
Message-ID: <alpine.OSX.2.02.1708061645020.80287@nqv-znpobbx>

On Sun, 6 Aug 2017, Hans Hagen wrote:

> On 8/5/2017 6:53 AM, Aditya Mahajan wrote:
>> On Sat, 5 Aug 2017, Aditya Mahajan wrote:
>> 
>>> :=  \colonequals
>>> =:  \equalscolon
>> 
>> BTW, should we remove the definitions of \colonequals, \equalcolons, and 
>> \minuscolon from math-def.mkiv?
> i'll comment them ... how about the others ..

Thanks.

\coloncolonequals can also be commented (it is 0x2A74). We can also 
create a mathpair for this.

* :: (0x3A, 0x3A) -> 0x2237
* ::- (0x2237, 0x2D) -> 0x2A74.

> i can make them into virtual characters if needed .. or do they need to 
> be added to unicode (given that we have proof of usage, in that case we 
> can ask barbara)

I don't see the usage of other \colon... symbols (at least in my sub-field 
of mathematics). For consistency with others, we can convert them into 
virtual characters.

Aditya

From adityam at umich.edu  Sun Aug  6 23:48:04 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Sun, 6 Aug 2017 17:48:04 -0400 (EDT)
Subject: [dev-context] mathpairs
In-Reply-To: <ea94eaf0-c03f-7cc1-2e7b-e8c7d2779670@wxs.nl>
References: <alpine.OSX.2.02.1708042258580.64732@nqv-znpobbx>
 <ea94eaf0-c03f-7cc1-2e7b-e8c7d2779670@wxs.nl>
Message-ID: <alpine.OSX.2.02.1708061727290.81043@nqv-znpobbx>

Hi,

I tested with the latest beta and everything works well.

Can you also add a virtual character for --. Then I can add the mappings 
for

-->, <--.

Others that can be mapped are

::, ::=, -:

for which I am attaching a patch file.

Aditya
-------------- next part --------------
A non-text attachment was scrubbed...
Name: char-def.patch
Type: text/x-diff
Size: 774 bytes
Desc: 
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170806/988f448e/attachment-0001.patch>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 15143 bytes
Desc: 
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170806/988f448e/attachment-0001.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: application/x-tex
Size: 1324 bytes
Desc: 
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20170806/988f448e/attachment-0001.tex>

From oinos at gmx.es  Mon Oct 23 18:25:44 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 23 Oct 2017 18:25:44 +0200
Subject: [dev-context] fix output intent subtype
Message-ID: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>

Hans,

according to Boris Doubrov (one of the developers of the veraPDF parser
for PDF/A validation) the subtype of the /OutputIntent dictionary for
all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).

Here is his reply for reference:
https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.

The attached patch fixes the issue. I have tried it myself and it solves
the problems with color space profiles.

Could you apply it to ConTeXt?

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix-gts-pdfa1.diff
Type: text/x-patch
Size: 929 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20171023/af6279df/attachment.bin>

From luigi.scarso at gmail.com  Mon Oct 23 19:01:58 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 23 Oct 2017 19:01:58 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
Message-ID: <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>

On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
> Hans,
>
> according to Boris Doubrov (one of the developers of the veraPDF parser
> for PDF/A validation) the subtype of the /OutputIntent dictionary for
> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>
> Here is his reply for reference:
> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>
> The attached patch fixes the issue. I have tried it myself and it solves
> the problems with color space profiles.
>
> Could you apply it to ConTeXt?
>
> Many thanks for your help,
sure, but it's better if we have an example that fails
--- I mean, the source code,  the version of the parser , the command line used.
It could be that other parts are also not ok.
-- 
luigi

From pragma at wxs.nl  Mon Oct 23 19:14:59 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Oct 2017 19:14:59 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
Message-ID: <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>

On 10/23/2017 7:01 PM, luigi scarso wrote:
> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>> Hans,
>>
>> according to Boris Doubrov (one of the developers of the veraPDF parser
>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>
>> Here is his reply for reference:
>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>
>> The attached patch fixes the issue. I have tried it myself and it solves
>> the problems with color space profiles.
>>
>> Could you apply it to ConTeXt?
>>
>> Many thanks for your help,
> sure, but it's better if we have an example that fails
> --- I mean, the source code,  the version of the parser , the command line used.
> It could be that other parts are also not ok.
i also want to check with Peter

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Mon Oct 23 20:00:31 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 23 Oct 2017 20:00:31 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
Message-ID: <ed5d38a6-c0d5-4ebc-9623-7f08f1a16331@gmx.es>

On 10/23/2017 07:01 PM, luigi scarso wrote:
> [...]
> sure, but it's better if we have an example that fails
> --- I mean, the source code,  the version of the parser , the command line used.
> It could be that other parts are also not ok.

The sample file is:

    \nopdfcompression

    \setupexternalfigures[location=default]

    \setuptagging[state=start]

    \setupbackend
      [format=PDF/A-3a,
       intent=sRGB IEC61966-2.1,
       profile={sRGB.icc,default_gray.icc},
       level=0]

    \setupcolors[cmyk=no, pagecolormodel=auto]

    \starttext
    \startTEXpage[offset=1em]
    \externalfigure[cow-brown]
    \stopTEXpage
    \stoptext

Version of the parser is 1.9.46
(http://downloads.verapdf.org/dev/verapdf-installer.zip). I use the GUI
version (default settings).

Without the fix, it fails. After it color profiles are fine.

BTW, there is another issue with tagged content, but I guess this was
introduced in betas starting from 2017.10.19 13:50. Betas from
2017.10.15 12:29 and before arenât affected by the issue. (Iâm going to
investigate it further and report the results here.)

Pablo
-- 
http://www.ousia.tk

From oinos at gmx.es  Mon Oct 23 20:40:15 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 23 Oct 2017 20:40:15 +0200
Subject: [dev-context] /MarkInfo refers to empty object
Message-ID: <5c0572d1-7ada-dd4b-7adb-851be5514b25@gmx.es>

Dear list,

[I accidentally discovered this issue when validating PDF/A documents
with veraPDF.]

I have the following sample:

    \nopdfcompression
    \setuptagging[state=start]
    \starttext
    \startTEXpage[offset=1em]
    \TeX
    \stopTEXpage
    \stoptext

The resulting PDF document contains a catalog with the entry "/MarkInfo
17 0 R". If compiled with betas up to 2017.10.15 12:29, the PDF object
reads:

    17 0 obj
    << /Marked true >>
    endobj

If compiled with betas starting from 2017.10.19 13:50, the PDF object is
empty:

    17 0 obj
    << >>
    endobj

Line 153 in lpdf-tag.lua was changed from its original content in beta
2017.10.15 12:29:

       Marked    = pdfboolean(true),

to the new content in beta 2017.10.19 13:50:

       Marked    = lpdf.majorversion == 1 and pdfboolean(true) or nil,

I wonder whether this may be related to the LuaTeX version. But this is
the newest version from the ConTeXt Suite for the Linux 32bit platform
(in beta from 17.10.19 13:50):

   This is LuajitTeX, Version 1.05.0 (TeX Live 2017)

Is this also an issue with more recent LuaTeX versions?

Sorry for asking this in the developersâ mailing list, but checking it
may be too technical for the standard mailing list.

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From pragma at wxs.nl  Mon Oct 23 21:53:03 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 23 Oct 2017 21:53:03 +0200
Subject: [dev-context] /MarkInfo refers to empty object
In-Reply-To: <5c0572d1-7ada-dd4b-7adb-851be5514b25@gmx.es>
References: <5c0572d1-7ada-dd4b-7adb-851be5514b25@gmx.es>
Message-ID: <69174388-5ebe-2e7b-ef27-cca56e714ae8@wxs.nl>

On 10/23/2017 8:40 PM, Pablo Rodriguez wrote:
> Dear list,
> 
> [I accidentally discovered this issue when validating PDF/A documents
> with veraPDF.]
> 
> I have the following sample:
> 
>      \nopdfcompression
>      \setuptagging[state=start]
>      \starttext
>      \startTEXpage[offset=1em]
>      \TeX
>      \stopTEXpage
>      \stoptext
> 
> The resulting PDF document contains a catalog with the entry "/MarkInfo
> 17 0 R". If compiled with betas up to 2017.10.15 12:29, the PDF object
> reads:
> 
>      17 0 obj
>      << /Marked true >>
>      endobj
> 
> If compiled with betas starting from 2017.10.19 13:50, the PDF object is
> empty:
> 
>      17 0 obj
>      << >>
>      endobj
> 
> Line 153 in lpdf-tag.lua was changed from its original content in beta
> 2017.10.15 12:29:
> 
>         Marked    = pdfboolean(true),
> 
> to the new content in beta 2017.10.19 13:50:
> 
>         Marked    = lpdf.majorversion == 1 and pdfboolean(true) or nil,

for now change that to

    lpdf.majorversion()

> I wonder whether this may be related to the LuaTeX version. But this is
> the newest version from the ConTeXt Suite for the Linux 32bit platform
> (in beta from 17.10.19 13:50):
> 
>     This is LuajitTeX, Version 1.05.0 (TeX Live 2017)
> 
> Is this also an issue with more recent LuaTeX versions?

Unrelated . The engine as well are context are made ready for pdf 
version 2 so that's why you get such side effects. The engine is not 
affected when version 2 is not set.
> Sorry for asking this in the developersâ mailing list, but checking it
> may be too technical for the standard mailing list.
I don't know. PDF issues have been discussed there before.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Mon Oct 23 22:07:40 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Mon, 23 Oct 2017 22:07:40 +0200
Subject: [dev-context] /MarkInfo refers to empty object
In-Reply-To: <69174388-5ebe-2e7b-ef27-cca56e714ae8@wxs.nl>
References: <5c0572d1-7ada-dd4b-7adb-851be5514b25@gmx.es>
 <69174388-5ebe-2e7b-ef27-cca56e714ae8@wxs.nl>
Message-ID: <00b731c2-d673-d99b-0a9b-31da329ec2f2@gmx.es>

On 10/23/2017 09:53 PM, Hans Hagen wrote:
> On 10/23/2017 8:40 PM, Pablo Rodriguez wrote:
>> [...]
>> to the new content in beta 2017.10.19 13:50:
>>
>>    Marked    = lpdf.majorversion == 1 and pdfboolean(true) or nil,
> 
> for now change that to
> 
>     lpdf.majorversion()

Many thanks for your fix, Hans.

>>     This is LuajitTeX, Version 1.05.0 (TeX Live 2017)
>>
>> Is this also an issue with more recent LuaTeX versions?
> 
> Unrelated . The engine as well are context are made ready for pdf 
> version 2 so that's why you get such side effects. The engine is not 
> affected when version 2 is not set.

I didnât know that both LuaTeX and ConTeXt were ready for PDF-2.

>> Sorry for asking this in the developersâ mailing list, but checking it
>> may be too technical for the standard mailing list.
>> I don't know. PDF issues have been discussed there before.

Ok, next time I will only provide patches (the very few Iâm able to
type) here.

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From peter.rolf at arcor.de  Mon Oct 23 23:14:07 2017
From: peter.rolf at arcor.de (Peter Rolf)
Date: Mon, 23 Oct 2017 23:14:07 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
Message-ID: <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>

Am 23.10.2017 um 19:14 schrieb Hans Hagen:
> On 10/23/2017 7:01 PM, luigi scarso wrote:
>> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>>> Hans,
>>>
>>> according to Boris Doubrov (one of the developers of the veraPDF parser
>>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>>
>>> Here is his reply for reference:
>>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>>
>>>
>>> The attached patch fixes the issue. I have tried it myself and it solves
>>> the problems with color space profiles.
>>>
>>> Could you apply it to ConTeXt?
>>>
>>> Many thanks for your help,
>> sure, but it's better if we have an example that fails
>> --- I mean, the source code,Â  the version of the parser , the command
>> line used.
>> It could be that other parts are also not ok.
> i also want to check with Peter
> 

No objections, the 'gts_flag' is also fix for the PDF/X variants.

I think I have tested all variants at that time (around Oct 2015) and
'veraPDF' didn't throw an error. Looks like they have improved their
parser on that part.


Best wishes,  Peter


ps @Pablo: Thanks for testing and bug fixing :D


From luigi.scarso at gmail.com  Mon Oct 23 23:21:24 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 23 Oct 2017 23:21:24 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
Message-ID: <CAG5iGsBWeCxGP7pm9aeLi59Pm-ycVOFZ25E02Ht6DvLbBFjeJA@mail.gmail.com>

On Mon, Oct 23, 2017 at 11:14 PM, Peter Rolf <peter.rolf at arcor.de> wrote:
> Am 23.10.2017 um 19:14 schrieb Hans Hagen:
>> On 10/23/2017 7:01 PM, luigi scarso wrote:
>>> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>>>> Hans,
>>>>
>>>> according to Boris Doubrov (one of the developers of the veraPDF parser
>>>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>>>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>>>
>>>> Here is his reply for reference:
>>>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>>>
>>>>
>>>> The attached patch fixes the issue. I have tried it myself and it solves
>>>> the problems with color space profiles.
>>>>
>>>> Could you apply it to ConTeXt?
>>>>
>>>> Many thanks for your help,
>>> sure, but it's better if we have an example that fails
>>> --- I mean, the source code,  the version of the parser , the command
>>> line used.
>>> It could be that other parts are also not ok.
>> i also want to check with Peter
>>
>
> No objections, the 'gts_flag' is also fix for the PDF/X variants.
>
> I think I have tested all variants at that time (around Oct 2015) and
> 'veraPDF' didn't throw an error. Looks like they have improved their
> parser on that part.

yes, the parser looks better, and a nice thing is that an error shows the
reference to the part of the standard that is interested to the failure.

-- 
luigi

From schuster.wolfgang at gmail.com  Mon Oct 23 23:22:11 2017
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Mon, 23 Oct 2017 23:22:11 +0200
Subject: [dev-context] type-del.mkiv
Message-ID: <59EE5D83.7030704@gmail.com>

Hi,

there are missing \bgroup (and one \aftergroup) on line 793 and 810 in 
typo-del.mkiv:

\def\typo_delimited_attributed
   {\dontleavehmode
    \begingroup
    \dostarttaggedchained\t!delimited\currentdelimitedtext\??delimitedtext
    \usedelimitedtextstyleandcolor\c!style\c!color
    \typo_delimited_start_content
+  \bgroup
+  \aftergroup\typo_delimited_attributed_e
-  \typo_delimited_attributed_e
    \let\next=}

\def\typo_delimited_attributed_e
   {\typo_delimited_stop_content
    \dostoptagged
    \typo_delimited_pop
    \endgroup}

\def\typo_delimited_fontdriven
   {\dontleavehmode
    \begingroup
    \dostarttaggedchained\t!delimited\currentdelimitedtext\??delimitedtext
    \usedlanguageparameter{\c!left\currentparentdelimitedtext}% was: 
\currentdelimitedtext
    \usedelimitedtextstyleandcolor\c!style\c!color
    \typo_delimited_start_content
+  \bgroup
    \aftergroup\typo_delimited_fontdriven_e
    \let\next=}

\def\typo_delimited_fontdriven_e
   {\typo_delimited_stop_content
    \usedlanguageparameter{\c!right\currentparentdelimitedtext}% was: 
\currentdelimitedtext
    \dostoptagged
    \typo_delimited_pop
    \endgroup}

Wolfgang

From pragma at wxs.nl  Tue Oct 24 09:12:53 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Oct 2017 09:12:53 +0200
Subject: [dev-context] /MarkInfo refers to empty object
In-Reply-To: <00b731c2-d673-d99b-0a9b-31da329ec2f2@gmx.es>
References: <5c0572d1-7ada-dd4b-7adb-851be5514b25@gmx.es>
 <69174388-5ebe-2e7b-ef27-cca56e714ae8@wxs.nl>
 <00b731c2-d673-d99b-0a9b-31da329ec2f2@gmx.es>
Message-ID: <3814f8b7-f14e-8e4b-b45d-6f4b9edfb5d6@wxs.nl>

On 10/23/2017 10:07 PM, Pablo Rodriguez wrote:
> On 10/23/2017 09:53 PM, Hans Hagen wrote:
>> On 10/23/2017 8:40 PM, Pablo Rodriguez wrote:
>>> [...]
>>> to the new content in beta 2017.10.19 13:50:
>>>
>>>     Marked    = lpdf.majorversion == 1 and pdfboolean(true) or nil,
>>
>> for now change that to
>>
>>      lpdf.majorversion()
> 
> Many thanks for your fix, Hans.
> 
>>>      This is LuajitTeX, Version 1.05.0 (TeX Live 2017)
>>>
>>> Is this also an issue with more recent LuaTeX versions?
>>
>> Unrelated . The engine as well are context are made ready for pdf
>> version 2 so that's why you get such side effects. The engine is not
>> affected when version 2 is not set.
> 
> I didnât know that both LuaTeX and ConTeXt were ready for PDF-2.

it looks like viewers don't care much as you can throw a 2.0 version pdf 
to them

>>> Sorry for asking this in the developersâ mailing list, but checking it
>>> may be too technical for the standard mailing list.
>>> I don't know. PDF issues have been discussed there before.
> 
> Ok, next time I will only provide patches (the very few Iâm able to
> type) here.

just choose the list you think most suitable (often for pdf it helps 
when more folks test)
  Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Oct 24 09:15:54 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Oct 2017 09:15:54 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
Message-ID: <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>

On 10/23/2017 11:14 PM, Peter Rolf wrote:
> Am 23.10.2017 um 19:14 schrieb Hans Hagen:
>> On 10/23/2017 7:01 PM, luigi scarso wrote:
>>> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>>>> Hans,
>>>>
>>>> according to Boris Doubrov (one of the developers of the veraPDF parser
>>>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>>>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>>>
>>>> Here is his reply for reference:
>>>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>>>
>>>>
>>>> The attached patch fixes the issue. I have tried it myself and it solves
>>>> the problems with color space profiles.
>>>>
>>>> Could you apply it to ConTeXt?
>>>>
>>>> Many thanks for your help,
>>> sure, but it's better if we have an example that fails
>>> --- I mean, the source code,Â  the version of the parser , the command
>>> line used.
>>> It could be that other parts are also not ok.
>> i also want to check with Peter
>>
> 
> No objections, the 'gts_flag' is also fix for the PDF/X variants.

So all variants get GTS_PDFA1 ?

> I think I have tested all variants at that time (around Oct 2015) and
> 'veraPDF' didn't throw an error. Looks like they have improved their
> parser on that part.

Well, for me it means that all that validation esp of keys like this are 
rather useless (creating work) because docs validated in the past and 
archived now are suddenly no longer valid.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Tue Oct 24 09:49:38 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 09:49:38 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
Message-ID: <CAG5iGsBWonrYA80AcB_B80WCUgJonCWDqoVts697q-d-q1AdtA@mail.gmail.com>

On Tue, Oct 24, 2017 at 9:15 AM, Hans Hagen <pragma at wxs.nl> wrote:
>
> Well, for me it means that all that validation esp of keys like this are
> rather useless (creating work) because docs validated in the past and
> archived now are suddenly no longer valid.
Hm I have made a pdf with
format={pdf/a-3a},
where I see
  /S /GTS_PDFA3
verapdf 1.8.4 says that it's valid.
I need to investigate, perhaps my  version of verapdf is older.
-- 
luigi

From peter.rolf at arcor.de  Tue Oct 24 10:01:28 2017
From: peter.rolf at arcor.de (Peter Rolf)
Date: Tue, 24 Oct 2017 10:01:28 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
Message-ID: <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>

Am 24.10.2017 um 09:15 schrieb Hans Hagen:
> On 10/23/2017 11:14 PM, Peter Rolf wrote:
>> Am 23.10.2017 um 19:14 schrieb Hans Hagen:
>>> On 10/23/2017 7:01 PM, luigi scarso wrote:
>>>> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>>>>> Hans,
>>>>>
>>>>> according to Boris Doubrov (one of the developers of the veraPDF
>>>>> parser
>>>>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>>>>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>>>>
>>>>> Here is his reply for reference:
>>>>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>>>>
>>>>>
>>>>>
>>>>> The attached patch fixes the issue. I have tried it myself and it
>>>>> solves
>>>>> the problems with color space profiles.
>>>>>
>>>>> Could you apply it to ConTeXt?
>>>>>
>>>>> Many thanks for your help,
>>>> sure, but it's better if we have an example that fails
>>>> --- I mean, the source code,Â  the version of the parser , the command
>>>> line used.
>>>> It could be that other parts are also not ok.
>>> i also want to check with Peter
>>>
>>
>> No objections, the 'gts_flag' is also fix for the PDF/X variants.
> 
> So all variants get GTS_PDFA1 ?
>

Yes. My guess (as I have no ISO documention) at that time was, that the
number should be increased with the versions. I couldn't imagine, why
the should use a number in that flag (there may be reasons for it, but I
donno them).

Anyhow, I'll download veraPDF and test all variants with the actual
beta. I doubt that the results will differ. If I find any other errors
you can fix them at one go. Will report back (probably after lunch
break). I hope nobody is in a hurry :D



>> I think I have tested all variants at that time (around Oct 2015) and
>> 'veraPDF' didn't throw an error. Looks like they have improved their
>> parser on that part.
> 
> Well, for me it means that all that validation esp of keys like this are
> rather useless (creating work) because docs validated in the past and
> archived now are suddenly no longer valid.
> 
> Hans
> 
> -----------------------------------------------------------------
> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Hans Hagen | PRAGMA ADE
> Â Â Â Â Â Â Â Â Â Â Â Â Â  Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> Â Â Â Â Â Â  tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context


From luigi.scarso at gmail.com  Tue Oct 24 10:14:56 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 10:14:56 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
Message-ID: <CAG5iGsDYRY4VDzZ941UbowqJD5ARJmS-LQNzZQ=ygSWKUR9_8Q@mail.gmail.com>

On Tue, Oct 24, 2017 at 10:01 AM, Peter Rolf <peter.rolf at arcor.de> wrote:
>
> Yes. My guess (as I have no ISO documention) at that time was, that the
> number should be increased with the versions. I couldn't imagine, why
> the should use a number in that flag (there may be reasons for it, but I
> donno them).
>
> Anyhow, I'll download veraPDF and test all variants with the actual
> beta. I doubt that the results will differ. If I find any other errors
> you can fix them at one go. Will report back (probably after lunch
> break). I hope nobody is in a hurry :D

I have made a test with pdf/a-2a, pdf/a-3a, they pass  both the
verapdf 1.8.4 and 1.9.46-dev
The problem with the file
$ cat unrgb.tex
\nopdfcompression
\setupexternalfigures[location=default]
\setuptagging[state=start]
\setupbackend
      [format=PDF/A-3a,
       intent=sRGB IEC61966-2.1,
       profile={sRGB.icc,default_gray.icc},
       level=0]
\setupcolors[cmyk=no, pagecolormodel=auto]
\starttext
\startTEXpage[offset=1em]
\externalfigure[cow-brown]
\stopTEXpage
\stoptext

is that it includes a pdf (cow-brown.pdf)  and this can lead to
conflicts with the specs. of the setupbackend.
There is no way to solve this: even is both the pdf are pdf/a-3a ok,
they can conflict.
So, the safest way is always to include bitmap images.

-- 
luigi

From luigi.scarso at gmail.com  Tue Oct 24 10:23:58 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 10:23:58 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsDYRY4VDzZ941UbowqJD5ARJmS-LQNzZQ=ygSWKUR9_8Q@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <CAG5iGsDYRY4VDzZ941UbowqJD5ARJmS-LQNzZQ=ygSWKUR9_8Q@mail.gmail.com>
Message-ID: <CAG5iGsAe48YCiLKA7eGMqOfm96xpjVQ9uPD5yZ9wThSNgVEYUg@mail.gmail.com>

On Tue, Oct 24, 2017 at 10:14 AM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Tue, Oct 24, 2017 at 10:01 AM, Peter Rolf <peter.rolf at arcor.de> wrote:
>>
>> Yes. My guess (as I have no ISO documention) at that time was, that the
>> number should be increased with the versions. I couldn't imagine, why
>> the should use a number in that flag (there may be reasons for it, but I
>> donno them).
>>
>> Anyhow, I'll download veraPDF and test all variants with the actual
>> beta. I doubt that the results will differ. If I find any other errors
>> you can fix them at one go. Will report back (probably after lunch
>> break). I hope nobody is in a hurry :D
>
> I have made a test with pdf/a-2a, pdf/a-3a, they pass  both the
> verapdf 1.8.4 and 1.9.46-dev
> The problem with the file
> $ cat unrgb.tex
> \nopdfcompression
> \setupexternalfigures[location=default]
> \setuptagging[state=start]
> \setupbackend
>       [format=PDF/A-3a,
>        intent=sRGB IEC61966-2.1,
>        profile={sRGB.icc,default_gray.icc},
>        level=0]
> \setupcolors[cmyk=no, pagecolormodel=auto]
> \starttext
> \startTEXpage[offset=1em]
> \externalfigure[cow-brown]
> \stopTEXpage
> \stoptext
>
> is that it includes a pdf (cow-brown.pdf)  and this can lead to
> conflicts with the specs. of the setupbackend.
> There is no way to solve this: even is both the pdf are pdf/a-3a ok,
> they can conflict.
> So, the safest way is always to include bitmap images.
>
> --
> luigi

infact
$ convert cow-brown.pdf --flatten -density 300 cow-brown.png


%% unrgb.tex
\nopdfcompression
\setupexternalfigures[location=default]
\setuptagging[state=start]
\setupbackend
      [format=PDF/A-3a,
       intent=sRGB IEC61966-2.1,
       profile={sRGB.icc,default_gray.icc},
       level=0]
\setupcolors[cmyk=no, pagecolormodel=auto]
\starttext
\startTEXpage[offset=1em]
\externalfigure[cow-brown.png]
\stopTEXpage
\stoptext

$ context unrgb.tex

$ verapdf -f 3a unrgb.pdf
<?xml version="1.0" encoding="utf-8"?>
<report>
  <buildInformation>
    <releaseDetails id="core" version="1.8.2"
buildDate="2017-08-14T09:56:00+02:00"></releaseDetails>
    <releaseDetails id="validation-model" version="1.8.3"
buildDate="2017-08-21T14:17:00+02:00"></releaseDetails>
    <releaseDetails id="gui" version="1.8.4"
buildDate="2017-08-21T14:49:00+02:00"></releaseDetails>
  </buildInformation>
  <jobs>
    <job>
      <item size="235110">
        <name>/opt/luatex/harald/Indien-2015/unrgb.pdf</name>
      </item>
      <validationReport profileName="PDF/A-3A validation profile"
statement="PDF file is compliant with Validation Profile
requirements." isCompliant="true">
        <details passedRules="131" failedRules="0" passedChecks="430"
failedChecks="0"></details>
      </validationReport>
      <duration start="1508833358743"
finish="1508833359138">00:00:00.395</duration>
    </job>
  </jobs>
  <batchSummary totalJobs="1" failedToParse="0" encrypted="0">
    <validationReports compliant="1" nonCompliant="0"
failedJobs="0">1</validationReports>
    <featureReports failedJobs="0">0</featureReports>
    <repairReports failedJobs="0">0</repairReports>
    <duration start="1508833358683"
finish="1508833359162">00:00:00.479</duration>
  </batchSummary>
</report>


-- 
luigi

From luigi.scarso at gmail.com  Tue Oct 24 10:38:45 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 10:38:45 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsAe48YCiLKA7eGMqOfm96xpjVQ9uPD5yZ9wThSNgVEYUg@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <CAG5iGsDYRY4VDzZ941UbowqJD5ARJmS-LQNzZQ=ygSWKUR9_8Q@mail.gmail.com>
 <CAG5iGsAe48YCiLKA7eGMqOfm96xpjVQ9uPD5yZ9wThSNgVEYUg@mail.gmail.com>
Message-ID: <CAG5iGsCuVaOJ+-Y3cLGEMW_6zBGOQLj1M0Em-V8w1hV3tqnHUQ@mail.gmail.com>

On Tue, Oct 24, 2017 at 10:23 AM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Tue, Oct 24, 2017 at 10:14 AM, luigi scarso <luigi.scarso at gmail.com> wrote:
> infact
> $ convert cow-brown.pdf --flatten -density 300 cow-brown.png
>
>
> %% unrgb.tex
> \nopdfcompression
> \setupexternalfigures[location=default]
> \setuptagging[state=start]
> \setupbackend
>       [format=PDF/A-3a,
>        intent=sRGB IEC61966-2.1,
>        profile={sRGB.icc,default_gray.icc},
>        level=0]
> \setupcolors[cmyk=no, pagecolormodel=auto]
> \starttext
> \startTEXpage[offset=1em]
> \externalfigure[cow-brown.png]
> \stopTEXpage
> \stoptext
>
> $ context unrgb.tex
>
> $ verapdf -f 3a unrgb.pdf
> <?xml version="1.0" encoding="utf-8"?>
> <report>
>   <buildInformation>
>     <releaseDetails id="core" version="1.8.2"
> buildDate="2017-08-14T09:56:00+02:00"></releaseDetails>
>     <releaseDetails id="validation-model" version="1.8.3"
> buildDate="2017-08-21T14:17:00+02:00"></releaseDetails>
>     <releaseDetails id="gui" version="1.8.4"
> buildDate="2017-08-21T14:49:00+02:00"></releaseDetails>
>   </buildInformation>
>   <jobs>
>     <job>
>       <item size="235110">
>         <name>/opt/luatex/harald/Indien-2015/unrgb.pdf</name>
>       </item>
>       <validationReport profileName="PDF/A-3A validation profile"
> statement="PDF file is compliant with Validation Profile
> requirements." isCompliant="true">
>         <details passedRules="131" failedRules="0" passedChecks="430"
> failedChecks="0"></details>
>       </validationReport>
>       <duration start="1508833358743"
> finish="1508833359138">00:00:00.395</duration>
>     </job>
>   </jobs>
>   <batchSummary totalJobs="1" failedToParse="0" encrypted="0">
>     <validationReports compliant="1" nonCompliant="0"
> failedJobs="0">1</validationReports>
>     <featureReports failedJobs="0">0</featureReports>
>     <repairReports failedJobs="0">0</repairReports>
>     <duration start="1508833358683"
> finish="1508833359162">00:00:00.479</duration>
>   </batchSummary>
> </report>
>
>
> --
> luigi

ah yes, of course
11 0 obj
<< /DestOutputProfile 7 0 R /Info (sRGB IEC61966-2.1) /OutputCondition
() /OutputConditionIdentifier (Custom) /RegistryName
(http://www.color.org) /S /GTS_PDFA3 /Type /OutputIntent >>
endobj


-- 
luigi

From peter.rolf at arcor.de  Tue Oct 24 13:48:01 2017
From: peter.rolf at arcor.de (Peter Rolf)
Date: Tue, 24 Oct 2017 13:48:01 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
Message-ID: <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>

Am 24.10.2017 um 10:01 schrieb Peter Rolf:
> Am 24.10.2017 um 09:15 schrieb Hans Hagen:
>> On 10/23/2017 11:14 PM, Peter Rolf wrote:
>>> Am 23.10.2017 um 19:14 schrieb Hans Hagen:
>>>> On 10/23/2017 7:01 PM, luigi scarso wrote:
>>>>> On Mon, Oct 23, 2017 at 6:25 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>>>>>> Hans,
>>>>>>
>>>>>> according to Boris Doubrov (one of the developers of the veraPDF
>>>>>> parser
>>>>>> for PDF/A validation) the subtype of the /OutputIntent dictionary for
>>>>>> all PDF/A intents should be GTS_PDFA1 (no GTS_PDFA2 or GTS_PDFA3).
>>>>>>
>>>>>> Here is his reply for reference:
>>>>>> https://github.com/veraPDF/veraPDF-parser/issues/317#issuecomment-338613962.
>>>>>>
>>>>>>
>>>>>>
>>>>>> The attached patch fixes the issue. I have tried it myself and it
>>>>>> solves
>>>>>> the problems with color space profiles.
>>>>>>
>>>>>> Could you apply it to ConTeXt?
>>>>>>
>>>>>> Many thanks for your help,
>>>>> sure, but it's better if we have an example that fails
>>>>> --- I mean, the source code,Â  the version of the parser , the command
>>>>> line used.
>>>>> It could be that other parts are also not ok.
>>>> i also want to check with Peter
>>>>
>>>
>>> No objections, the 'gts_flag' is also fix for the PDF/X variants.
>>
>> So all variants get GTS_PDFA1 ?
>>
> 
> Yes. My guess (as I have no ISO documention) at that time was, that the
> number should be increased with the versions. I couldn't imagine, why
> the should use a number in that flag (there may be reasons for it, but I
> donno them).
> 
> Anyhow, I'll download veraPDF and test all variants with the actual
> beta. I doubt that the results will differ. If I find any other errors
> you can fix them at one go. Will report back (probably after lunch
> break). I hope nobody is in a hurry :D
> 
>

Tested all PDF/A versions with veraPDF 1.8.4 and ConTeXt 2017.10.24
10:30. No errors reported.

> 
>>> I think I have tested all variants at that time (around Oct 2015) and
>>> 'veraPDF' didn't throw an error. Looks like they have improved their
>>> parser on that part.
>>
>> Well, for me it means that all that validation esp of keys like this are
>> rather useless (creating work) because docs validated in the past and
>> archived now are suddenly no longer valid.
>>

Well, the good news is that the actual problem does not effect any A1
documents. And even with an incomplete (99.9%) validity the documents
stay usable. I'm sure that (alien) historians will love any ConTeXt
created PDF/A document :D

Anyhow, next time I'm in doubt about an entry I will ask the guys from
veraPDF. They have a copy of the ISO docs.


Peter

>> Hans
>>
>> -----------------------------------------------------------------
>> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Hans Hagen | PRAGMA ADE
>> Â Â Â Â Â Â Â Â Â Â Â Â Â  Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>> Â Â Â Â Â Â  tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
>> -----------------------------------------------------------------
>> _______________________________________________
>> dev-context mailing list
>> dev-context at ntg.nl
>> https://mailman.ntg.nl/mailman/listinfo/dev-context
> 
> _______________________________________________
> dev-context mailing list
> dev-context at ntg.nl
> https://mailman.ntg.nl/mailman/listinfo/dev-context
> 


From oinos at gmx.es  Tue Oct 24 18:13:22 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 24 Oct 2017 18:13:22 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsBWonrYA80AcB_B80WCUgJonCWDqoVts697q-d-q1AdtA@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <CAG5iGsBWonrYA80AcB_B80WCUgJonCWDqoVts697q-d-q1AdtA@mail.gmail.com>
Message-ID: <baee5088-1e60-dd5e-e6b0-398bdd4b7994@gmx.es>

On 10/24/2017 09:49 AM, luigi scarso wrote:
> On Tue, Oct 24, 2017 at 9:15 AM, Hans Hagen wrote:
>>
>> Well, for me it means that all that validation esp of keys like this are
>> rather useless (creating work) because docs validated in the past and
>> archived now are suddenly no longer valid.
> Hm I have made a pdf with
> format={pdf/a-3a},
> where I see
>   /S /GTS_PDFA3
> verapdf 1.8.4 says that it's valid.
> I need to investigate, perhaps my  version of verapdf is older.

I had created a valid PDF/A-3a document with /S /GTS_PDFA3. It seems
that this affects to the way (form) xobjects have their color spaces.

It may be that the same document that verapdf-1.8.4 says itâs valid,
itâs also valid for verapdf-1.9.46.

Since you have the source, you might want to check it with latest
development version
(http://downloads.verapdf.org/dev/verapdf-installer.zip).

Pablo
-- 
http://www.ousia.tk

From oinos at gmx.es  Tue Oct 24 19:02:18 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 24 Oct 2017 19:02:18 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
Message-ID: <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>

On 10/24/2017 01:48 PM, Peter Rolf wrote:
> [...]
> Well, the good news is that the actual problem does not effect any A1
> documents. And even with an incomplete (99.9%) validity the documents
> stay usable. I'm sure that (alien) historians will love any ConTeXt
> created PDF/A document :D

Sorry, Peter, but Iâm afraid that the bad news is that CMYK in form
xobjects doesnât work fine :-(:

    \nopdfcompression

    \setupexternalfigures[location=default]

    \setuptagging[state=start]

    \setupbackend
      [format=PDF/A-3a,
       intent=sRGB IEC61966-2.1,
       profile={isocoated_v2_eci.icc,default_gray.icc},
       level=0]

    \setupcolors[pagecolormodel=auto]

    \starttext
    \startTEXpage[offset=1em]
    \externalfigure[cow]
    \stopTEXpage
    \stoptext

I donât use CMYK myself, but am I missing something or is this something
that needs further investigation?

Analyzing the document, the xobject has a ressource with a color space
(object 23) that doesnât contain the ICC profile (object 2). (But I
donât know whether the intent is fine.)

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From luigi.scarso at gmail.com  Tue Oct 24 19:06:51 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 19:06:51 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
Message-ID: <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>

On Tue, Oct 24, 2017 at 7:02 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
> On 10/24/2017 01:48 PM, Peter Rolf wrote:
>> [...]
>> Well, the good news is that the actual problem does not effect any A1
>> documents. And even with an incomplete (99.9%) validity the documents
>> stay usable. I'm sure that (alien) historians will love any ConTeXt
>> created PDF/A document :D
>
> Sorry, Peter, but Iâm afraid that the bad news is that CMYK in form
> xobjects doesnât work fine :-(:
>
>     \nopdfcompression
>
>     \setupexternalfigures[location=default]
>
>     \setuptagging[state=start]
>
>     \setupbackend
>       [format=PDF/A-3a,
>        intent=sRGB IEC61966-2.1,
>        profile={isocoated_v2_eci.icc,default_gray.icc},
>        level=0]
>
>     \setupcolors[pagecolormodel=auto]
>
>     \starttext
>     \startTEXpage[offset=1em]
>     \externalfigure[cow]
>     \stopTEXpage
>     \stoptext
>
> I donât use CMYK myself, but am I missing something or is this something
> that needs further investigation?
is this
     \externalfigure[cow]
a pdf ?
As said previously , including pdf can break the rules of
format=PDF/A-3a.
Simply include bitmap images, it's way more robust.

-- 
luigi

From braslau.list at comcast.net  Tue Oct 24 19:27:05 2017
From: braslau.list at comcast.net (Alan Braslau)
Date: Tue, 24 Oct 2017 11:27:05 -0600
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
Message-ID: <20171024112705.004506ee@zoo.hsd1.co.comcast.net>

On Tue, 24 Oct 2017 19:06:51 +0200
luigi scarso <luigi.scarso at gmail.com> wrote:

> is this
>      \externalfigure[cow]
> a pdf ?
> As said previously , including pdf can break the rules of
> format=PDF/A-3a.
> Simply include bitmap images, it's way more robust.

Isn't that non-optimal, using bitmap images rather than vector graphics?
Must there not be a way to correctly include PDF graphics, perhaps
modifying the included file to make it conforming?

Alan

From oinos at gmx.es  Tue Oct 24 19:42:07 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 24 Oct 2017 19:42:07 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
Message-ID: <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>

On 10/24/2017 07:06 PM, luigi scarso wrote:
> a pdf ?
> As said previously , including pdf can break the rules of
> format=PDF/A-3a.
> Simply include bitmap images, it's way more robust.

Allow me a fair and respectful disagreement, Luigi.

Bitmap images are less problematic in PDF/A because they include their
own color space. This is why they work even with /S /GTS_PDFA3.

But replacing vectors with bitmaps is a way of avoiding the issue, not
of fixing it (if this needs to be fixed).

Again, I donât have any CMYK images and I thought this might be relevant
to other users.

Pablo
-- 
http://www.ousia.tk

From luigi.scarso at gmail.com  Tue Oct 24 19:46:21 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 19:46:21 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <20171024112705.004506ee@zoo.hsd1.co.comcast.net>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <20171024112705.004506ee@zoo.hsd1.co.comcast.net>
Message-ID: <CAG5iGsAX5P15Nkm+0qoaWFPN8xM=7L287vit1YRFZvJo4ytQOg@mail.gmail.com>

On Tue, Oct 24, 2017 at 7:27 PM, Alan Braslau <braslau.list at comcast.net> wrote:
> On Tue, 24 Oct 2017 19:06:51 +0200
> luigi scarso <luigi.scarso at gmail.com> wrote:
>
>> is this
>>      \externalfigure[cow]
>> a pdf ?
>> As said previously , including pdf can break the rules of
>> format=PDF/A-3a.
>> Simply include bitmap images, it's way more robust.
>
> Isn't that non-optimal, using bitmap images rather than vector graphics?
> Must there not be a way to correctly include PDF graphics, perhaps
> modifying the included file to make it conforming?
Forgetting for the moment that a generic pdf could not have the right
structure (and fix it can be quite complicate)
you can have a "guest" pdf file that is valid pdf/a but once included
with  \externalfigure can conflicts with the "host" pdf, because the
host specifies a different color spaces, for example.
On the other side, if you include it as bitmap, you are safe on the
color spaces and the structure.
Of course This sound not ok if the pdf is only text --- but even in
this case the situation is not so simple:
the fonts must be correct (it's known that we have math fonts that are
not ok ), the tounicode also..
so also in this case a high res bitmap can be the only solution.,
-- 
luigi

From luigi.scarso at gmail.com  Tue Oct 24 19:51:44 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 19:51:44 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
Message-ID: <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>

On Tue, Oct 24, 2017 at 7:42 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
> On 10/24/2017 07:06 PM, luigi scarso wrote:
>> a pdf ?
>> As said previously , including pdf can break the rules of
>> format=PDF/A-3a.
>> Simply include bitmap images, it's way more robust.
>
> Allow me a fair and respectful disagreement, Luigi.
>
> Bitmap images are less problematic in PDF/A because they include their
> own color space. This is why they work even with /S /GTS_PDFA3.
>
> But replacing vectors with bitmaps is a way of avoiding the issue, not
> of fixing it (if this needs to be fixed).
yes, it's a  clean way to resolve a problem that could not be solvable.
The point is that is more easy to make a correct pdf than fix an
arbitrary pdf to make it conform to the document
---  there are tools like pitstop for that.


-- 
luigi

From oinos at gmx.es  Tue Oct 24 20:21:45 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 24 Oct 2017 20:21:45 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
 <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
Message-ID: <cc976b6d-431c-f539-efd2-2f2f1b873125@gmx.es>

On 10/24/2017 07:51 PM, luigi scarso wrote:
> On Tue, Oct 24, 2017 at 7:42 PM, Pablo Rodriguez wrote:
>>
>> But replacing vectors with bitmaps is a way of avoiding the issue, not
>> of fixing it (if this needs to be fixed).
>
> yes, it's a  clean way to resolve a problem that could not be solvable.
> The point is that is more easy to make a correct pdf than fix an
> arbitrary pdf to make it conform to the document

If the document is invalid, I totally agree with you, there is nothing
to fix there.

After analyzing cow.pdf, the issue is in that file. Of course, I didnât
mean to fix invalid documents.

Although I think that there might be an issue with the way that LuaTeX
(or ConTeXt, I donât know) inserts form xobjects with CMYK colors in a
PDF document.

It adds them a color space that (I think) makes it impossible that an
icc profile can be referred to the form xobject.

Pablo
-- 
http://www.ousia.tk

From braslau.list at comcast.net  Tue Oct 24 20:21:45 2017
From: braslau.list at comcast.net (Alan Braslau)
Date: Tue, 24 Oct 2017 12:21:45 -0600
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsAX5P15Nkm+0qoaWFPN8xM=7L287vit1YRFZvJo4ytQOg@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <20171024112705.004506ee@zoo.hsd1.co.comcast.net>
 <CAG5iGsAX5P15Nkm+0qoaWFPN8xM=7L287vit1YRFZvJo4ytQOg@mail.gmail.com>
Message-ID: <20171024122145.4ba7e626@zoo.hsd1.co.comcast.net>

On Tue, 24 Oct 2017 19:46:21 +0200
luigi scarso <luigi.scarso at gmail.com> wrote:

> On Tue, Oct 24, 2017 at 7:27 PM, Alan Braslau
> <braslau.list at comcast.net> wrote:
> > On Tue, 24 Oct 2017 19:06:51 +0200
> > luigi scarso <luigi.scarso at gmail.com> wrote:
> >  
> >> is this
> >>      \externalfigure[cow]
> >> a pdf ?
> >> As said previously , including pdf can break the rules of
> >> format=PDF/A-3a.
> >> Simply include bitmap images, it's way more robust.  
> >
> > Isn't that non-optimal, using bitmap images rather than vector
> > graphics? Must there not be a way to correctly include PDF
> > graphics, perhaps modifying the included file to make it
> > conforming?  
> Forgetting for the moment that a generic pdf could not have the right
> structure (and fix it can be quite complicate)
> you can have a "guest" pdf file that is valid pdf/a but once included
> with  \externalfigure can conflicts with the "host" pdf, because the
> host specifies a different color spaces, for example.
> On the other side, if you include it as bitmap, you are safe on the
> color spaces and the structure.
> Of course This sound not ok if the pdf is only text --- but even in
> this case the situation is not so simple:
> the fonts must be correct (it's known that we have math fonts that are
> not ok ), the tounicode also..
> so also in this case a high res bitmap can be the only solution.,

"Let the buyer beware".

Given that bitmap graphics are NOT OK (think bloat, an MS/Office
specialty), there must be a better solution. Perhaps simply detecting a
conflict between an included PDF and the "host" PDF and printing a
warning! Then it could be up to the user to "fix" the included PDF so
not to break the host PDF.

Alan

From luigi.scarso at gmail.com  Tue Oct 24 20:31:39 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 20:31:39 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <20171024122145.4ba7e626@zoo.hsd1.co.comcast.net>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <20171024112705.004506ee@zoo.hsd1.co.comcast.net>
 <CAG5iGsAX5P15Nkm+0qoaWFPN8xM=7L287vit1YRFZvJo4ytQOg@mail.gmail.com>
 <20171024122145.4ba7e626@zoo.hsd1.co.comcast.net>
Message-ID: <CAG5iGsDVoB2R0De34ZDgbZ3GHXjqzdkZ5rZvdorPK1+urBtu=Q@mail.gmail.com>

On Tue, Oct 24, 2017 at 8:21 PM, Alan Braslau <braslau.list at comcast.net> wrote:
> "Let the buyer beware".
>
> Given that bitmap graphics are NOT OK (think bloat, an MS/Office
> specialty), there must be a better solution. Perhaps simply detecting a
> conflict between an included PDF and the "host" PDF and printing a
> warning! Then it could be up to the user to "fix" the included PDF so
> not to break the host PDF.
For the purpose of pdf/a (long term preservation, reproducibility and
robustness of the file )
bitmap graphics are ok. RGB is one of the best color space.


-- 
luigi

From peter.rolf at arcor.de  Tue Oct 24 20:56:09 2017
From: peter.rolf at arcor.de (Peter Rolf)
Date: Tue, 24 Oct 2017 20:56:09 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
 <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
Message-ID: <a9b78015-c167-efeb-b058-7d444e53b1cb@arcor.de>

Am 24.10.2017 um 19:51 schrieb luigi scarso:
> On Tue, Oct 24, 2017 at 7:42 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
>> On 10/24/2017 07:06 PM, luigi scarso wrote:
>>> a pdf ?
>>> As said previously , including pdf can break the rules of
>>> format=PDF/A-3a.
>>> Simply include bitmap images, it's way more robust.
>>
>> Allow me a fair and respectful disagreement, Luigi.
>>
>> Bitmap images are less problematic in PDF/A because they include their
>> own color space. This is why they work even with /S /GTS_PDFA3.
>>
>> But replacing vectors with bitmaps is a way of avoiding the issue, not
>> of fixing it (if this needs to be fixed).
> yes, it's a  clean way to resolve a problem that could not be solvable.
> The point is that is more easy to make a correct pdf than fix an
> arbitrary pdf to make it conform to the document
> ---  there are tools like pitstop for that.
> 
> 

I agree. Pitstop (Acrobat plugin) and PDFToolBox are the tools for such
stuff. Analysing arbitrary PDF documents with successive color
management is far beyond the scope of ConTeXt.

Both mentioned prepress tools have free evaluation versions (at least at
the time I tested them). If I remember right, Pitstop has build in such
an option (change default CS for a complete document).


Hope that helps,

Peter

From pragma at wxs.nl  Tue Oct 24 21:38:42 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Oct 2017 21:38:42 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <cc976b6d-431c-f539-efd2-2f2f1b873125@gmx.es>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
 <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
 <cc976b6d-431c-f539-efd2-2f2f1b873125@gmx.es>
Message-ID: <4786f82d-f7d5-4ebd-bc00-c8498da02ec0@wxs.nl>

On 10/24/2017 8:21 PM, Pablo Rodriguez wrote:
> On 10/24/2017 07:51 PM, luigi scarso wrote:
>> On Tue, Oct 24, 2017 at 7:42 PM, Pablo Rodriguez wrote:
>>>
>>> But replacing vectors with bitmaps is a way of avoiding the issue, not
>>> of fixing it (if this needs to be fixed).
>>
>> yes, it's a  clean way to resolve a problem that could not be solvable.
>> The point is that is more easy to make a correct pdf than fix an
>> arbitrary pdf to make it conform to the document
> 
> If the document is invalid, I totally agree with you, there is nothing
> to fix there.
> 
> After analyzing cow.pdf, the issue is in that file. Of course, I didnât
> mean to fix invalid documents.
> 
> Although I think that there might be an issue with the way that LuaTeX
> (or ConTeXt, I donât know) inserts form xobjects with CMYK colors in a
> PDF document.
> 
> It adds them a color space that (I think) makes it impossible that an
> icc profile can be referred to the form xobject.
Are you sure? The image is included as is. Nothing is added to its 
resource and as i mentioned a while ago, that's also beyond the engine.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Oct 24 21:43:34 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Oct 2017 21:43:34 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <20171024122145.4ba7e626@zoo.hsd1.co.comcast.net>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <20171024112705.004506ee@zoo.hsd1.co.comcast.net>
 <CAG5iGsAX5P15Nkm+0qoaWFPN8xM=7L287vit1YRFZvJo4ytQOg@mail.gmail.com>
 <20171024122145.4ba7e626@zoo.hsd1.co.comcast.net>
Message-ID: <fd05c37a-8e56-2c66-176a-6f8c7dca64fa@wxs.nl>

On 10/24/2017 8:21 PM, Alan Braslau wrote:
> On Tue, 24 Oct 2017 19:46:21 +0200
> luigi scarso <luigi.scarso at gmail.com> wrote:
> 
>> On Tue, Oct 24, 2017 at 7:27 PM, Alan Braslau
>> <braslau.list at comcast.net> wrote:
>>> On Tue, 24 Oct 2017 19:06:51 +0200
>>> luigi scarso <luigi.scarso at gmail.com> wrote:
>>>   
>>>> is this
>>>>       \externalfigure[cow]
>>>> a pdf ?
>>>> As said previously , including pdf can break the rules of
>>>> format=PDF/A-3a.
>>>> Simply include bitmap images, it's way more robust.
>>>
>>> Isn't that non-optimal, using bitmap images rather than vector
>>> graphics? Must there not be a way to correctly include PDF
>>> graphics, perhaps modifying the included file to make it
>>> conforming?
>> Forgetting for the moment that a generic pdf could not have the right
>> structure (and fix it can be quite complicate)
>> you can have a "guest" pdf file that is valid pdf/a but once included
>> with  \externalfigure can conflicts with the "host" pdf, because the
>> host specifies a different color spaces, for example.
>> On the other side, if you include it as bitmap, you are safe on the
>> color spaces and the structure.
>> Of course This sound not ok if the pdf is only text --- but even in
>> this case the situation is not so simple:
>> the fonts must be correct (it's known that we have math fonts that are
>> not ok ), the tounicode also..
>> so also in this case a high res bitmap can be the only solution.,
> 
> "Let the buyer beware".
> 
> Given that bitmap graphics are NOT OK (think bloat, an MS/Office
> specialty), there must be a better solution. Perhaps simply detecting a
> conflict between an included PDF and the "host" PDF and printing a
> warning! Then it could be up to the user to "fix" the included PDF so
> not to break the host PDF.
we have a few workflows where we add color profiles to images before 
inclusion (in fact that's a built in option) but only for bitmap fonts

normally a press workflow is cmyk based and vector graphics are then 
made in cmyk too

if someone knows the magic command (gm or gs) to add a color profile to 
an image i can also add a fixer for it (as we do for bitmaps) but it's 
always done with external tools

Hans

(We do have workflows where we manipulate graphics but often these are 
rather special and it doesn't pay off i.e customers don't want to pay 
for that and expect it to be, so it even pays off less to then make it 
into some built-in feature that we need to maintain and document and ...)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Tue Oct 24 21:48:26 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Tue, 24 Oct 2017 21:48:26 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <4786f82d-f7d5-4ebd-bc00-c8498da02ec0@wxs.nl>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
 <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
 <cc976b6d-431c-f539-efd2-2f2f1b873125@gmx.es>
 <4786f82d-f7d5-4ebd-bc00-c8498da02ec0@wxs.nl>
Message-ID: <3a5f6a50-3584-44ca-132d-fa4639fcef1a@gmx.es>

On 10/24/2017 09:38 PM, Hans Hagen wrote:
> On 10/24/2017 8:21 PM, Pablo Rodriguez wrote:
>> It adds them a color space that (I think) makes it impossible that an
>> icc profile can be referred to the form xobject.
>
> Are you sure? The image is included as is. Nothing is added to its 
> resource and as i mentioned a while ago, that's also beyond the engine.

Youâre right, Hans, the issue with validation is caused by something
different.

I will investigate the issue myself and report here (or in the user
list) the results.

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From luigi.scarso at gmail.com  Tue Oct 24 21:49:58 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Oct 2017 21:49:58 +0200
Subject: [dev-context] fix output intent subtype
In-Reply-To: <3a5f6a50-3584-44ca-132d-fa4639fcef1a@gmx.es>
References: <d8d47ce8-74ff-a158-2a3c-f66163ca5722@gmx.es>
 <CAG5iGsBD6sHUvB_xMJJFyYmbSX5bpKNkPrbBy_5XCbhqsLMUOA@mail.gmail.com>
 <c86b62b1-f5cd-d96b-e19f-c11eebf1925e@wxs.nl>
 <446c08ac-b955-cbdd-ba48-1b51aa3c433b@arcor.de>
 <57c76c3a-fcc1-36af-c15f-f32d095e56f8@wxs.nl>
 <a17a418b-4a69-1e98-7cb2-4fbe094e56e5@arcor.de>
 <953355aa-265d-6872-f394-a8d71ab9f2c0@arcor.de>
 <beea2a23-f1fa-5850-23d7-998f9d0d2f20@gmx.es>
 <CAG5iGsAM=a8eJuJFfk8smB+HBCttRLV83iLgTDa5ZNEQForDng@mail.gmail.com>
 <91f870d4-f1fc-0113-f9b2-d191c0902194@gmx.es>
 <CAG5iGsD5wYpVj-n2J85W1TMDrSdB3TL77uTTVdMRnTdNYg5bJw@mail.gmail.com>
 <cc976b6d-431c-f539-efd2-2f2f1b873125@gmx.es>
 <4786f82d-f7d5-4ebd-bc00-c8498da02ec0@wxs.nl>
 <3a5f6a50-3584-44ca-132d-fa4639fcef1a@gmx.es>
Message-ID: <CAG5iGsCP7+Gw_FrvLP13CfadCygsnapEfJ5zYz3WettnB7=KXw@mail.gmail.com>

On Tue, Oct 24, 2017 at 9:48 PM, Pablo Rodriguez <oinos at gmx.es> wrote:
> I will investigate the issue myself and report here (or in the user
> list) the results.

this is the right list

-- 
luigi

From oinos at gmx.es  Sun Nov 19 00:10:42 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 19 Nov 2017 00:10:42 +0100
Subject: [dev-context] typo in page-pcl.mkiv
Message-ID: <5dcd63c7-3836-fd9f-db7e-4aabd217bbb4@gmx.es>

Hans,

the attached patch fixes a typo in page-pcl.mkiv.

I hope it helps,

Pablo
-- 
http://www.ousia.tk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: page-pcl.mkiv_typo.diff
Type: text/x-patch
Size: 616 bytes
Desc: not available
URL: <http://mailman.ntg.nl/pipermail/dev-context/attachments/20171119/ddfef84d/attachment.bin>

From pragma at wxs.nl  Sun Nov 19 11:54:44 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 19 Nov 2017 11:54:44 +0100
Subject: [dev-context] typo in page-pcl.mkiv
In-Reply-To: <5dcd63c7-3836-fd9f-db7e-4aabd217bbb4@gmx.es>
References: <5dcd63c7-3836-fd9f-db7e-4aabd217bbb4@gmx.es>
Message-ID: <237bd8ac-4af4-96d5-7395-0c71536b7c1d@wxs.nl>

On 11/19/2017 12:10 AM, Pablo Rodriguez wrote:
> Hans,
> 
> the attached patch fixes a typo in page-pcl.mkiv.
> 
> I hope it helps,
fixed but don't use that code yet ... it's pretty experimental

(i'm moving some experimental code that i used in old styles into the 
core but it has to be made sort of generic useable)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From adityam at umich.edu  Tue Nov 28 23:37:23 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 28 Nov 2017 17:37:23 -0500 (EST)
Subject: [dev-context] Typo in page-brk.mkiv
Message-ID: <alpine.LNX.2.20.1711281736080.12868@ybpnyubfg.ybpnyqbznva>

Line 507: \pagecheckparameter should be \pagecheckerparameter

Aditya

From adityam at umich.edu  Tue Dec  5 13:01:25 2017
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 5 Dec 2017 07:01:25 -0500 (EST)
Subject: [dev-context] Typo in tabl-tab.mkiv
Message-ID: <alpine.OSX.2.03.1712050658380.30299@zptvyy.pn>

There is a typo in tabl-tab.mkiv:

Line 1075 should be

        \let\tabl_tabulate_insert_foot\tabl_tabulate_insert_foot_content


(note **foot_content** instead of **head_content**)

Thanks,
Aditya


From oinos at gmx.es  Sun Dec 10 12:55:58 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 10 Dec 2017 12:55:58 +0100
Subject: [dev-context] double widget for signature?
Message-ID: <cf701534-1cdd-b3e2-ceff-c8bc5704e19c@gmx.es>

Hans,

I have the following sample:

    \setupinteraction[state=start]

    \starttext
    \startTEXpage[offset=1em]
         \definefield[x][signature]
         \field[x]
    \stopTEXpage
    \stoptext

And for the signature two widgets are generated (I include object 7 to
make sense of the kids in objet 8):

    7 0 obj
    [ 9 0 R ]
    endobj

    8 0 obj
    <<
      /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
      /DV <FEFF>
      /F 4
      /FT /Sig
      /Ff 0
      /Kids 7 0 R
      /MaxLen 1024
      /Q 0
      /Subtype /Widget
      /T <FEFF0078>
      /V <FEFF>
    >>
    endobj

    9 0 obj
    <<
      /Type /Annot
      /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
      /F 4
      /Parent 8 0 R
      /Q 0
      /Subtype /Widget
      /Rect [ 14.033 14.033 70.404 25.081 ]
    >>
    endobj

When Acrobat XI (Win, just in case) signs the document, both widgets are
merged into one:

    25 0 obj
    <<
      /AP <<
        /N 14 0 R
      >>
      /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
      /DV <FEFF>
      /F 132
      /FT /Sig
      /Ff 0
      /MaxLen 1024
      /P 13 0 R
      /Q 0
      /Rect [ 14.033 14.033 464.204 95.701 ]
      /Subtype /Widget
      /T <FEFF005300690067006E006500640044006F00630075006D0065006E0074>
      /Type /Annot
      /V 21 0 R
    >>
    endobj

Would it be possible to generate only one annotation widget for the
signature?

Many thanks for your help,

Pablo
-- 
http://www.ousia.tk

From pragma at wxs.nl  Sun Dec 10 13:29:13 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 10 Dec 2017 13:29:13 +0100
Subject: [dev-context] double widget for signature?
In-Reply-To: <cf701534-1cdd-b3e2-ceff-c8bc5704e19c@gmx.es>
References: <cf701534-1cdd-b3e2-ceff-c8bc5704e19c@gmx.es>
Message-ID: <e3a55221-f1ca-9aaf-e683-4ab8d9f4ad75@wxs.nl>

On 12/10/2017 12:55 PM, Pablo Rodriguez wrote:
> Hans,
> 
> I have the following sample:
> 
>      \setupinteraction[state=start]
> 
>      \starttext
>      \startTEXpage[offset=1em]
>           \definefield[x][signature]
>           \field[x]
>      \stopTEXpage
>      \stoptext
> 
> And for the signature two widgets are generated (I include object 7 to
> make sense of the kids in objet 8):
> 
>      7 0 obj
>      [ 9 0 R ]
>      endobj
> 
>      8 0 obj
>      <<
>        /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
>        /DV <FEFF>
>        /F 4
>        /FT /Sig
>        /Ff 0
>        /Kids 7 0 R
>        /MaxLen 1024
>        /Q 0
>        /Subtype /Widget
>        /T <FEFF0078>
>        /V <FEFF>
>      >>
>      endobj
> 
>      9 0 obj
>      <<
>        /Type /Annot
>        /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
>        /F 4
>        /Parent 8 0 R
>        /Q 0
>        /Subtype /Widget
>        /Rect [ 14.033 14.033 70.404 25.081 ]
>      >>
>      endobj >
> When Acrobat XI (Win, just in case) signs the document, both widgets are
> merged into one:
> 
>      25 0 obj
>      <<
>        /AP <<
>          /N 14 0 R
>        >>
>        /DA (/rmtf 11.9552 Tf 1.1955 Ts 0 0 0 rg 0 0 0 RG)
>        /DV <FEFF>
>        /F 132
>        /FT /Sig
>        /Ff 0
>        /MaxLen 1024
>        /P 13 0 R
>        /Q 0
>        /Rect [ 14.033 14.033 464.204 95.701 ]
>        /Subtype /Widget
>        /T <FEFF005300690067006E006500640044006F00630075006D0065006E0074>
>        /Type /Annot
>        /V 21 0 R
>      >>
>      endobj
> 
> Would it be possible to generate only one annotation widget for the
> signature?
Only if one beforehand would indicate that there are no more possible 
kids (we don't want to keep that info as yet another bit of multipass 
data) which would be yet another hard to explain (undocumented feature). 
The current approach is afaik valid (and it's already hard enough to get 
these widgets robust over pdf / acrobat versions). It would also make 
the code messier (nwo we clearly separate parent and instance, then we 
have an extra hybrid form which duplicates the code). So, what is the 
benefit? Saving a few bytes hardly matters here.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From oinos at gmx.es  Sun Dec 10 18:17:30 2017
From: oinos at gmx.es (Pablo Rodriguez)
Date: Sun, 10 Dec 2017 18:17:30 +0100
Subject: [dev-context] double widget for signature?
In-Reply-To: <e3a55221-f1ca-9aaf-e683-4ab8d9f4ad75@wxs.nl>
References: <cf701534-1cdd-b3e2-ceff-c8bc5704e19c@gmx.es>
 <e3a55221-f1ca-9aaf-e683-4ab8d9f4ad75@wxs.nl>
Message-ID: <d379a4f0-4ac9-9194-c915-bc571b7946ad@gmx.es>

On 12/10/2017 01:29 PM, Hans Hagen wrote:
> On 12/10/2017 12:55 PM, Pablo Rodriguez wrote:
>> [...]
>> Would it be possible to generate only one annotation widget for the
>> signature?
> 
> Only if one beforehand would indicate that there are no more possible 
> kids (we don't want to keep that info as yet another bit of multipass 
> data) which would be yet another hard to explain (undocumented feature). 
> The current approach is afaik valid (and it's already hard enough to get 
> these widgets robust over pdf / acrobat versions). It would also make 
> the code messier (nwo we clearly separate parent and instance, then we 
> have an extra hybrid form which duplicates the code). So, what is the 
> benefit? Saving a few bytes hardly matters here.

You are right, Hans.

It is much ado about nothing.

Sorry for the noise,

Pablo
-- 
http://www.ousia.tk

