From elie.roux at telecom-bretagne.eu  Tue Mar  3 22:32:15 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 03 Mar 2009 22:32:15 +0100
Subject: [luatex] macros to invoke lua in LaTeX
Message-ID: <49ADA1DF.7010407@telecom-bretagne.eu>

Hello,

I'm stabilizing a luatextra package. I can do most of the things by 
myself, but there is something that should be validated by someone else: 
the name of the wrapper for \directlua0. In ConTeXt it's \ctxlua, but in 
luatextra (that will be for both plain and LaTeX) I can't find a perfect 
name, and I think it would be a bad idea to change it later, as a lot of 
people will use it. The aim of this macro is to allow package writers to 
invoke lua code with a small macro, so I thought \pkglua would be good, 
but it doesn't start by \lua... Do you think it would be good anyway?

Should I provide a \lua macro that invokes \directlua0, to be used by 
users? I was also thinking about a \luastate macro that would be a 
wrapper for \directlua to write in some states...

Thank you in advance,
-- 
Elie

From karl at freefriends.org  Tue Mar  3 23:56:21 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 3 Mar 2009 16:56:21 -0600
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49ADA1DF.7010407@telecom-bretagne.eu>
Message-ID: <200903032256.n23MuL626402@f7.net>

    the name of the wrapper for \directlua0. 

What does it do?

    invoke lua code with a small macro, so I thought \pkglua would be good, 

How about \luadirect?

From taco at elvenkind.com  Wed Mar  4 09:08:50 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 09:08:50 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <200903032256.n23MuL626402@f7.net>
References: <200903032256.n23MuL626402@f7.net>
Message-ID: <49AE3712.9060808@elvenkind.com>

Karl Berry wrote:
>     the name of the wrapper for \directlua0. 
> 
> What does it do?
> 
>     invoke lua code with a small macro, so I thought \pkglua would be good, 
> 
> How about \luadirect?

You could also consider just using \directlua, like so:

   \def\directlua{\directlua0}

The multi-state support will be marked deprecated in 0.40 and removed
in 0.50.

Best wishes,
Taco



From elie.roux at telecom-bretagne.eu  Wed Mar  4 09:16:02 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 04 Mar 2009 09:16:02 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3712.9060808@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
Message-ID: <49AE38C2.3050608@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> You could also consider just using \directlua, like so:
>
>   \def\directlua{\directlua0}
>
> The multi-state support will be marked deprecated in 0.40 and removed
> in 0.50.

I didn't know that, it will prevent me from doing unnecessary code!

I'll wrap directlua and I'll add a \luadirect macro so that it starts by 
\lua...

Thank you!
-- 
Elie

From taco at elvenkind.com  Wed Mar  4 09:17:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 09:17:13 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE38C2.3050608@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
	<49AE38C2.3050608@telecom-bretagne.eu>
Message-ID: <49AE3909.1040505@elvenkind.com>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> You could also consider just using \directlua, like so:
>>
>>   \def\directlua{\directlua0}
>>
>> The multi-state support will be marked deprecated in 0.40 and removed
>> in 0.50.
> 
> I didn't know that, it will prevent me from doing unnecessary code!

You just got a sneak peek :)

Best wishes,
Taco

From pragma at wxs.nl  Wed Mar  4 09:39:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 04 Mar 2009 09:39:39 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3712.9060808@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
Message-ID: <49AE3E4B.9050801@wxs.nl>

Taco Hoekwater wrote:
> Karl Berry wrote:
>>     the name of the wrapper for \directlua0.
>> What does it do?
>>
>>     invoke lua code with a small macro, so I thought \pkglua would be 
>> good,
>> How about \luadirect?
> 
> You could also consider just using \directlua, like so:
> 
>   \def\directlua{\directlua0}

\def\directlua{\primitive\directlua0}


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar  4 09:42:07 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 04 Mar 2009 09:42:07 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE38C2.3050608@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
	<49AE38C2.3050608@telecom-bretagne.eu>
Message-ID: <49AE3EDF.6070605@wxs.nl>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> You could also consider just using \directlua, like so:
>>
>>   \def\directlua{\directlua0}
>>
>> The multi-state support will be marked deprecated in 0.40 and removed
>> in 0.50.
> 
> I didn't know that, it will prevent me from doing unnecessary code!

you couldn't -) we discussed it last week en-route

there is not much advantage in multiple lua engines because they cannot 
share data (unless we use very inefficient mechanisms) and all action 
with regards to tex takes place in instance 0 anyway

because a directlua call is re-entrant there is not that much need for 
multiple instances any more

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Mar  4 09:43:23 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 09:43:23 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3E4B.9050801@wxs.nl>
References: <200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE3E4B.9050801@wxs.nl>
Message-ID: <49AE3F2B.2000701@elvenkind.com>



Hans Hagen wrote:
> Taco Hoekwater wrote:
>> Karl Berry wrote:
>>>     the name of the wrapper for \directlua0.
>>> What does it do?
>>>
>>>     invoke lua code with a small macro, so I thought \pkglua would be
>>> good,
>>> How about \luadirect?
>>
>> You could also consider just using \directlua, like so:
>>
>>   \def\directlua{\directlua0}
> 
> \def\directlua{\primitive\directlua0}

Oops, hans is right of course. Even better:

\ifnum\luatexversion<40
  \def\directlua{\primitive\directlua0}
\fi

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Wed Mar  4 10:16:37 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 04 Mar 2009 10:16:37 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3F2B.2000701@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE3E4B.9050801@wxs.nl> <49AE3F2B.2000701@elvenkind.com>
Message-ID: <49AE46F5.1040503@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Oops, hans is right of course. Even better:
>
> \ifnum\luatexversion<40
>   \def\directlua{\primitive\directlua0}
> \fi

Does it mean it will be removed in LuaTeX 0.40 or just marked deprecated?
-- 
Elie

From taco at elvenkind.com  Wed Mar  4 10:18:06 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 10:18:06 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE46F5.1040503@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE3E4B.9050801@wxs.nl>
	<49AE3F2B.2000701@elvenkind.com>
	<49AE46F5.1040503@telecom-bretagne.eu>
Message-ID: <49AE474E.6070101@elvenkind.com>



Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> Oops, hans is right of course. Even better:
>>
>> \ifnum\luatexversion<40
>>   \def\directlua{\primitive\directlua0}
>> \fi
> 
> Does it mean it will be removed in LuaTeX 0.40 or just marked deprecated?

Just marked deprecated. But that comes with a terminal message
that you will want to avoud.

Best wishes,
Taco

From khaledhosny at eglug.org  Wed Mar  4 11:45:53 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 4 Mar 2009 12:45:53 +0200
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE38C2.3050608@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
	<49AE38C2.3050608@telecom-bretagne.eu>
Message-ID: <20090304104553.GB7333@khaled-laptop>

On Wed, Mar 04, 2009 at 09:16:02AM +0100, Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> You could also consider just using \directlua, like so:
>>
>>   \def\directlua{\directlua0}
>>
>> The multi-state support will be marked deprecated in 0.40 and removed
>> in 0.50.
>
> I didn't know that, it will prevent me from doing unnecessary code!
>
> I'll wrap directlua and I'll add a \luadirect macro so that it starts by  
> \lua...

What about just \lua{}? Much shorter and I think more intuitive than any
lua+combination.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090304/ebfa3a8e/attachment-0001.bin 

From oberdiek at uni-freiburg.de  Wed Mar  4 11:59:46 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 4 Mar 2009 11:59:46 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3F2B.2000701@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE3E4B.9050801@wxs.nl>
	<49AE3F2B.2000701@elvenkind.com>
Message-ID: <20090304105945.GA9779@irwin.vpn.uni-freiburg.de>

On Wed, Mar 04, 2009 at 09:43:23AM +0100, Taco Hoekwater wrote:

> Oops, hans is right of course. Even better:
> 
> \ifnum\luatexversion<40
>   \def\directlua{\primitive\directlua0}
> \fi

\ifnum\luatexversion<40
  \def\directlua#{\primitive\directlua0}
\fi

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From elie.roux at telecom-bretagne.eu  Wed Mar  4 12:12:47 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 04 Mar 2009 12:12:47 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE474E.6070101@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE3E4B.9050801@wxs.nl>	<49AE3F2B.2000701@elvenkind.com>	<49AE46F5.1040503@telecom-bretagne.eu>
	<49AE474E.6070101@elvenkind.com>
Message-ID: <49AE622F.9070202@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
>>>
>>> \ifnum\luatexversion<40
>>>   \def\directlua{\primitive\directlua0}
>>> \fi
>>>       
>
> Just marked deprecated. But that comes with a terminal message
> that you will want to avoud.
>   

Sure... but then I don't understand why we should put a 
\ifnum\luatexversion<40?
-- 
Elie

From mpg at elzevir.fr  Wed Mar  4 12:31:22 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 04 Mar 2009 12:31:22 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE3712.9060808@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
Message-ID: <49AE668A.9080309@elzevir.fr>

Taco Hoekwater a ?crit :
> You could also consider just using \directlua, like so:
> 
>   \def\directlua{\directlua0}
> 
You mean \def\directlua{\pdfprimitive\directlua0}, don't you?

Manuel.


From taco at elvenkind.com  Wed Mar  4 12:31:26 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 12:31:26 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE622F.9070202@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE3E4B.9050801@wxs.nl>	<49AE3F2B.2000701@elvenkind.com>	<49AE46F5.1040503@telecom-bretagne.eu>	<49AE474E.6070101@elvenkind.com>
	<49AE622F.9070202@telecom-bretagne.eu>
Message-ID: <49AE668E.1050101@elvenkind.com>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>>>>
>>>> \ifnum\luatexversion<40
>>>>   \def\directlua{\primitive\directlua0}
>>>> \fi
>>>>       
>>
>> Just marked deprecated. But that comes with a terminal message
>> that you will want to avoud.
>>   
> 
> Sure... but then I don't understand why we should put a 
> \ifnum\luatexversion<40?

Because your redefinition won't be needed from 0.40 upwards and
will in fact be wrong from 0.50 up.

Best wishes,
Taco

From taco at elvenkind.com  Wed Mar  4 12:34:34 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 12:34:34 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE668A.9080309@elzevir.fr>
References: <200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
Message-ID: <49AE674A.2050606@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Taco Hoekwater a ?crit :
>> You could also consider just using \directlua, like so:
>>
>>   \def\directlua{\directlua0}
>>
> You mean \def\directlua{\pdfprimitive\directlua0}, don't you?

Pdftex's \pdfprimitive is \primitive in luatex. Iirc, I removed
some other pdf prefixes also (I am sure it is mentioned in the
manual, but I don't remember offhand).



From mpg at elzevir.fr  Wed Mar  4 12:42:12 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 04 Mar 2009 12:42:12 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE674A.2050606@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr> <49AE674A.2050606@elvenkind.com>
Message-ID: <49AE6914.5020206@elzevir.fr>

Taco Hoekwater a ?crit :
>> You mean \def\directlua{\pdfprimitive\directlua0}, don't you?
> 
> Pdftex's \pdfprimitive is \primitive in luatex. Iirc, I removed
> some other pdf prefixes also (I am sure it is mentioned in the
> manual, but I don't remember offhand).
> 
Oh, great. The pdf prefix was very counter-intuitive in front of some
primitives, such as \primitive indeed.

But apparently you kept \pdfprimitive as an alias. Are such aliases reliable, or
are they meant to be removed sooner or later?

Manuel.

From taco at elvenkind.com  Wed Mar  4 13:01:03 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 13:01:03 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE6914.5020206@elzevir.fr>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
Message-ID: <49AE6D7F.6030003@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Taco Hoekwater a ?crit :
>>> You mean \def\directlua{\pdfprimitive\directlua0}, don't you?
>> Pdftex's \pdfprimitive is \primitive in luatex. Iirc, I removed
>> some other pdf prefixes also (I am sure it is mentioned in the
>> manual, but I don't remember offhand).
>>
> Oh, great. The pdf prefix was very counter-intuitive in front of some
> primitives, such as \primitive indeed.
> 
> But apparently you kept \pdfprimitive as an alias. Are such aliases reliable, or
> are they meant to be removed sooner or later?

There are no immediate plans to remove these aliases (there is nearly
no overhead involved and it helps backward compatibilty with pdftex).

Best wishes,
Taco

From taco at elvenkind.com  Wed Mar  4 13:02:16 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 13:02:16 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE6D7F.6030003@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<49AE6D7F.6030003@elvenkind.com>
Message-ID: <49AE6DC8.1070803@elvenkind.com>

Taco Hoekwater wrote:
> 
> There are no immediate plans to remove these aliases (there is nearly

Please make that "current plans" (sloppy English)

> no overhead involved and it helps backward compatibilty with pdftex).
> 
> Best wishes,
> Taco
> 


From arthur.reutenauer at normalesup.org  Wed Mar  4 13:35:41 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 4 Mar 2009 13:35:41 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE6914.5020206@elzevir.fr>
References: <200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
Message-ID: <20090304123541.GA23524@phare.normalesup.org>

> Oh, great. The pdf prefix was very counter-intuitive in front of some
> primitives, such as \primitive indeed.

  If I remember correctly, the original idea was to add "pdf" in front
of all the primitives that were particular to pdfTeX, and it thus meant
"pdfTeX" and not "PDF", at least originally (am I right?)  But it is
indeed not the most intuitive naming convention.

	Arthur

From pragma at wxs.nl  Wed Mar  4 13:51:47 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 04 Mar 2009 13:51:47 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090304123541.GA23524@phare.normalesup.org>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
Message-ID: <49AE7963.1040506@wxs.nl>

Arthur Reutenauer wrote:
>> Oh, great. The pdf prefix was very counter-intuitive in front of some
>> primitives, such as \primitive indeed.
> 
>   If I remember correctly, the original idea was to add "pdf" in front
> of all the primitives that were particular to pdfTeX, and it thus meant
> "pdfTeX" and not "PDF", at least originally (am I right?)  But it is
> indeed not the most intuitive naming convention.

it was mostly to avoid clashes with existing macro names but even then 
it's not needed as one can save the meaning of new primitives under 
names that make sense for the specific macro package anyway

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mpg at elzevir.fr  Wed Mar  4 17:16:03 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 04 Mar 2009 17:16:03 +0100
Subject: [luatex] recent luatexref-t.pdf?
Message-ID: <49AEA943.6070100@elzevir.fr>

Hi,

I've been unable to locate a recent build of the LuaTeX reference manual online,
either at luatex.org or http://foundry.supelec.fr/projects/luatex or in the
ConTeXt minimals distribution. The most natural place where I would expect to
find it is http://luatex.org/documentation.html but the versions there are dated
2007.

May I request that the links on the above page be updated?

Thanks,
Manuel.

From luigi.scarso at gmail.com  Wed Mar  4 17:20:30 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 4 Mar 2009 17:20:30 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AEA943.6070100@elzevir.fr>
References: <49AEA943.6070100@elzevir.fr>
Message-ID: <fe8d59da0903040820x47a648cao630d284411061545@mail.gmail.com>

On Wed, Mar 4, 2009 at 5:16 PM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Hi,
>
> I've been unable to locate a recent build of the LuaTeX reference manual online,
> either at luatex.org or http://foundry.supelec.fr/projects/luatex or in the
> ConTeXt minimals distribution. The most natural place where I would expect to
> find it is http://luatex.org/documentation.html but the versions there are dated
> 2007.
Did you see in the source distribution ? (try with svn)

-- 
luigi

From pragma at wxs.nl  Wed Mar  4 17:29:39 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 04 Mar 2009 17:29:39 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AEA943.6070100@elzevir.fr>
References: <49AEA943.6070100@elzevir.fr>
Message-ID: <49AEAC73.6030604@wxs.nl>

Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I've been unable to locate a recent build of the LuaTeX reference manual online,
> either at luatex.org or http://foundry.supelec.fr/projects/luatex or in the
> ConTeXt minimals distribution. The most natural place where I would expect to
> find it is http://luatex.org/documentation.html but the versions there are dated
> 2007.
> 
> May I request that the links on the above page be updated?

it's on the agenda

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mpg at elzevir.fr  Wed Mar  4 19:32:40 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 04 Mar 2009 19:32:40 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AEAC73.6030604@wxs.nl>
References: <49AEA943.6070100@elzevir.fr> <49AEAC73.6030604@wxs.nl>
Message-ID: <49AEC948.2090005@elzevir.fr>

Hans Hagen a ?crit :
>> May I request that the links on the above page be updated?
> 
> it's on the agenda
> 
Good to hear.

In the meanwhile, I got it from the svn distribution, thanks to Luigi's suggestion.

Manuel.

From taco at elvenkind.com  Wed Mar  4 19:42:34 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 19:42:34 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AEC948.2090005@elzevir.fr>
References: <49AEA943.6070100@elzevir.fr> <49AEAC73.6030604@wxs.nl>
	<49AEC948.2090005@elzevir.fr>
Message-ID: <49AECB9A.1080101@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Hans Hagen a ?crit :
>>> May I request that the links on the above page be updated?
>> it's on the agenda
>>
> Good to hear.
> 
> In the meanwhile, I got it from the svn distribution, thanks to Luigi's suggestion.

Just in case: jhe trunk of luatex is checked out (readonly) and mirrored
to a website automatically, every six hours:

	http://context.aanhet.net/svn/luatex/trunk/

The manual is in manual/, of course.



From taco at elvenkind.com  Wed Mar  4 19:46:54 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 04 Mar 2009 19:46:54 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AECB9A.1080101@elvenkind.com>
References: <49AEA943.6070100@elzevir.fr>
	<49AEAC73.6030604@wxs.nl>	<49AEC948.2090005@elzevir.fr>
	<49AECB9A.1080101@elvenkind.com>
Message-ID: <49AECC9E.6090704@elvenkind.com>

Taco Hoekwater wrote:
> Manuel P?gouri?-Gonnard wrote:
>> Hans Hagen a ?crit :
>>>> May I request that the links on the above page be updated?
>>> it's on the agenda
>>>
>> Good to hear.
>>
>> In the meanwhile, I got it from the svn distribution, thanks to 
>> Luigi's suggestion.
> 
> Just in case: jhe trunk of luatex is checked out (readonly) and mirrored
> to a website automatically, every six hours:
> 
>     http://context.aanhet.net/svn/luatex/trunk/

Oops. Wrong url! It is this one now:

   http://www.luatex.org/svn/

Taco



From mpg at elzevir.fr  Wed Mar  4 19:55:03 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 04 Mar 2009 19:55:03 +0100
Subject: [luatex] recent luatexref-t.pdf?
In-Reply-To: <49AECC9E.6090704@elvenkind.com>
References: <49AEA943.6070100@elzevir.fr>	<49AEAC73.6030604@wxs.nl>	<49AEC948.2090005@elzevir.fr>	<49AECB9A.1080101@elvenkind.com>
	<49AECC9E.6090704@elvenkind.com>
Message-ID: <49AECE87.6010505@elzevir.fr>

Taco Hoekwater a ?crit :
>> Just in case: jhe trunk of luatex is checked out (readonly) and mirrored
>> to a website automatically, every six hours:
>> [...]
>   http://www.luatex.org/svn/
> 
Great, thanks.

Manuel.

From karl at freefriends.org  Thu Mar  5 00:31:17 2009
From: karl at freefriends.org (Karl Berry)
Date: Wed, 4 Mar 2009 17:31:17 -0600
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090304123541.GA23524@phare.normalesup.org>
Message-ID: <200903042331.n24NVGv26173@f7.net>

      If I remember correctly, the original idea was to add "pdf" in front
    of all the primitives that were particular to pdfTeX, and it thus meant
    "pdfTeX" and not "PDF", at least originally (am I right?)  But it is
    indeed not the most intuitive naming convention.

Maybe not intuitive in all cases, but very very useful for preventing
clashes.  The LuaTeX practice of choosing names for primitives that are
meaningful, but without any such prefix, seems quite problematic to me.
Not just right now, but at any time in the future: if a new primitive
\foo is introduced, any existing package that happens to use \foo is
potentially affected.  Sure, it can be worked around, but it introduces
unnecessary instability and incompatibility, it seems to me.

Sorry to be such a drag.

From wspr81 at gmail.com  Thu Mar  5 05:47:00 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 5 Mar 2009 15:17:00 +1030
Subject: [luatex] macros to invoke lua in LaTeX
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net> <49AE3712.9060808@elvenkind.com>
	<49AE38C2.3050608@telecom-bretagne.eu>
	<20090304104553.GB7333@khaled-laptop>
Message-ID: <gonlg4$5e9$1@ger.gmane.org>

On 2009-03-04 21:15:53 +1030, Khaled Hosny 
<khaledhosny at eglug.org> said:

> What about just \lua{}? Much shorter and I think more intuitive than any
> lua+combination.

In my opinion only, I think this is too short for a "programming" 
macro. Say I want to print "lua" in my document in some typeface, then 
\lua would be a natural macro to use. Instead, it's taken up by this 
primitive that few *document* authors will ever want to know about.

"\luadirect" seems like a fine choice to me.

Will



From pragma at wxs.nl  Thu Mar  5 09:01:57 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 09:01:57 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <200903042331.n24NVGv26173@f7.net>
References: <200903042331.n24NVGv26173@f7.net>
Message-ID: <49AF86F5.5070909@wxs.nl>

Karl Berry wrote:
>       If I remember correctly, the original idea was to add "pdf" in front
>     of all the primitives that were particular to pdfTeX, and it thus meant
>     "pdfTeX" and not "PDF", at least originally (am I right?)  But it is
>     indeed not the most intuitive naming convention.
> 
> Maybe not intuitive in all cases, but very very useful for preventing
> clashes.  The LuaTeX practice of choosing names for primitives that are
> meaningful, but without any such prefix, seems quite problematic to me.
> Not just right now, but at any time in the future: if a new primitive
> \foo is introduced, any existing package that happens to use \foo is
> potentially affected.  Sure, it can be worked around, but it introduces
> unnecessary instability and incompatibility, it seems to me.
> 
> Sorry to be such a drag.

no package is infected at all as the package redefined the new primitives

however, the macro package that loads the package should provide an 
alternative name for the new functionality then (or use the \primitive 
prefix)

\let\originalwhatever=\whatever

and then use \originalwhatever instead consistently; the \original 
prefix then could be made a 'norm' in the macro package (e.g. context 
users know that they should not mess around with \normalwhatever)

when etex came around, its new primitives clashes with several of 
context's and even recently there was a new primitive (\expanded) that 
clashed again but it's no big deal (well, i've learned to live with it)

concerning a prefix ... pdf backends were possible before pdftex came 
around so \pdfsomething can also clash with existing macros; the same is 
true for many systematically prefixed primitives

so ... whatever solution is choses, it always can fail at some point 
which is why we didn't do it

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Mar  5 09:19:15 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Mar 2009 09:19:15 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <200903042331.n24NVGv26173@f7.net>
References: <200903042331.n24NVGv26173@f7.net>
Message-ID: <49AF8B03.1020306@elvenkind.com>

Hi Karl,

A not too short mail follows that attempts to answer both of your
email messages at once.

Karl Berry wrote:
> Not just right now, but at any time in the future: if a new primitive
> \foo is introduced, any existing package that happens to use \foo is
> potentially affected.  

This is the best argument ever -- for not developing luatex at all.

Until version luatex 1.0, we reserve the right to make any change.
Because if we were to promise not to remove old primitives and to
avoid adding conflicting primitives, you get exactly what you have
already: pdftex. Which isn't going away.

People that are hung up on compatibility should stick with pdftex
in any case, because luatex's *output* is potentially different
(and will remain to be so, as that is an unavoidable consequence
of the unwrapping of the engine internals). The name of some primitives
is really a minor point in view of these other engine changes.

In the particular case of \pdfprimitive, I don't mind promising 
(herewith) that that will remain in the engine and that it will keep
doing what it did in pdftex, with just possibly a bug fix here or there.
But we won't go as far as making that promise in the general case.

For example, right at the start of luatex, we threw out a bunch of
primitives from Heiko Oberdiek and myself that provide various scripting
subroutines for use inside pdftex. Why? Because in luatex that sort of
stuff should be done in lua, not in tex macros. If you want to use
Heiko's subroutines in their \primitive form, simply keep using pdftex.

About primitive names:

The core problem is that the \newcommand macro in latex does not
allow *any* new primitives: it assumes the engine is totally stable.
Adding some special prefix does not solve this, it merely attempts at
making clashes less likely by increasing the hash key length. I will
not accept that as a general solution to the problem.

If there was a functional proposal for namespaces, I would gladly
implement that and put the new primitives in a dedicated namespace.
But any language extension to allow for namespaces would likely be
just as incompatible, so I highly doubt that would solve your issue.

Prefixes with a generic engine prefix are just silly. In the new Unicode
math support I've been adding a lot of primitives (more than 100).  A
whole bunch of them are identical to xetex counterparts (\XeTeXmathchar
and friends). But I couldn't keep their names, because then a package
could believe it was running xetex instead of luatex (!). Some talk with
JK and Will resulted in the \U prefix and I am happy with that, it is
a good compromise to have \U... for all the new math-related primitives
now.

But that does not mean that I should now start creating say \Udirectlua,
because \directlua has nothing to do with Unicode. Just like
\pdfprimitive has nothing to do with pdf. When choosing a primitive
name, I believe that fitness to purpose should weigh more heavily
than conceptual compatibity concerns.

Actual known clashes are a different issue, and we do try quite hard
to avoid such names: for example, luatex will never get \begin as a
new primitive.

Best wishes,
Taco

From wspr81 at gmail.com  Thu Mar  5 11:51:28 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 5 Mar 2009 21:21:28 +1030
Subject: [luatex] macros to invoke lua in LaTeX
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
	<200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
Message-ID: <gooarg$uhl$1@ger.gmane.org>

On 2009-03-05 18:49:15 +1030, Taco Hoekwater 
<taco at elvenkind.com> said:

> For example, right at the start of luatex, we threw out a bunch of
> primitives from Heiko Oberdiek and myself that provide various scripting
> subroutines for use inside pdftex.

I'm curious, are these the primitives like \pdfescape..., 
\pdfmdfivesum, \pdf...deviate, \pdffilemoddate, and so on? (Sorry, I'm 
not up to date on all of the new primitives of LuaTeX.)

> If there was a functional proposal for namespaces, I would gladly
> implement that and put the new primitives in a dedicated namespace.

Did the namespace idea of the ExTeX team never work in practice? I 
really liked that idea, what little I read of it...

> But any language extension to allow for namespaces would likely be
> just as incompatible, so I highly doubt that would solve your issue.

I'm not suggesting this seriously, but you could prefix new primitives 
with chars that are usually "other"  to dramatically lower the chances 
of a clash. E.g.,  \^scantextokens, \^directlua, and whatever.

> Actual known clashes are a different issue, and we do try quite hard
> to avoid such names: for example, luatex will never get \begin as a
> new primitive.

Are you aware, Karl, of any namespace collisions that have already 
occured? I do understand your concern, but I imagine that only a very 
small number of old documents will be affected by the LuaTeX primitives.

Will



From pragma at wxs.nl  Thu Mar  5 12:03:04 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 12:03:04 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gooarg$uhl$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>	<20090304123541.GA23524@phare.normalesup.org>	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com> <gooarg$uhl$1@ger.gmane.org>
Message-ID: <49AFB168.3070603@wxs.nl>

Will Robertson wrote:

> I'm not suggesting this seriously, but you could prefix new primitives 
> with chars that are usually "other"  to dramatically lower the chances 
> of a clash. E.g.,  \^scantextokens, \^directlua, and whatever.

each macro package has its own usage of prefixes so that would not solve 
the problem; of course one can remap primitives quite early after 
loading so

\let\^scantextokens\scantextokens

and when in macro package xyz this is agreed upon it also avoids 
discussions at the engine dev level

also, prefixing with \@reserved at scantextokens or whatever is rather safe 
too (and efficient)

any namespace switching mechanism would bring its own problems (mixed 
namespaces, more code, clashes too); it's all about managaging code and 
the only way out there is clear rules forusers that want to extend a 
macro package

>> Actual known clashes are a different issue, and we do try quite hard
>> to avoid such names: for example, luatex will never get \begin as a
>> new primitive.
> 
> Are you aware, Karl, of any namespace collisions that have already 
> occured? I do understand your concern, but I imagine that only a very 
> small number of old documents will be affected by the LuaTeX primitives.

well, i myself ran into it several times -)

also, users redefining primitives are out of anyones control -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Mar  5 12:04:59 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 12:04:59 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gooarg$uhl$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>	<20090304123541.GA23524@phare.normalesup.org>	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com> <gooarg$uhl$1@ger.gmane.org>
Message-ID: <49AFB1DB.9090900@wxs.nl>

Will Robertson wrote:
> On 2009-03-05 18:49:15 +1030, Taco Hoekwater <taco at elvenkind.com> said:
>
> Are you aware, Karl, of any namespace collisions that have already 
> occured? I do understand your concern, but I imagine that only a very 
> small number of old documents will be affected by the LuaTeX primitives.

(a good example of claashing i ran into is supp-pdf ... clashes with 
macro names in latex that showed up afterwards, clashes with lc codes, 
catcodes etc; which is why i decided to ship two versions, one for latex 
and one for context so that i'm no longer crippled by hacks that make 
things run in multiple packages)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Thu Mar  5 12:25:02 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Mar 2009 12:25:02 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gooarg$uhl$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>	<20090304123541.GA23524@phare.normalesup.org>	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com> <gooarg$uhl$1@ger.gmane.org>
Message-ID: <49AFB68E.1080009@elvenkind.com>



Will Robertson wrote:
> On 2009-03-05 18:49:15 +1030, Taco Hoekwater <taco at elvenkind.com> said:
> 
>> For example, right at the start of luatex, we threw out a bunch of
>> primitives from Heiko Oberdiek and myself that provide various scripting
>> subroutines for use inside pdftex.
> 
> I'm curious, are these the primitives like \pdfescape..., \pdfmdfivesum,
> \pdf...deviate, \pdffilemoddate, and so on? (Sorry, I'm not up to date
> on all of the new primitives of LuaTeX.)

Yes, exactly.

>> If there was a functional proposal for namespaces, I would gladly
>> implement that and put the new primitives in a dedicated namespace.
> 
> Did the namespace idea of the ExTeX team never work in practice? I
> really liked that idea, what little I read of it...

I only know of it as a presentation given in pont-a-mousson, and
I would be interested to hear how it worked out in the wild.

Best wishes,
Taco



From oberdiek at uni-freiburg.de  Thu Mar  5 12:45:10 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 5 Mar 2009 12:45:10 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gooarg$uhl$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com> <gooarg$uhl$1@ger.gmane.org>
Message-ID: <20090305114509.GA2936@irwin.vpn.uni-freiburg.de>

On Thu, Mar 05, 2009 at 09:21:28PM +1030, Will Robertson wrote:

> On 2009-03-05 18:49:15 +1030, Taco Hoekwater 
> <taco at elvenkind.com> said:
> 
> >For example, right at the start of luatex, we threw out a bunch of
> >primitives from Heiko Oberdiek and myself that provide various scripting
> >subroutines for use inside pdftex.
> 
> I'm curious, are these the primitives like \pdfescape..., 
> \pdfmdfivesum, \pdf...deviate, \pdffilemoddate, and so on? (Sorry, I'm 
> not up to date on all of the new primitives of LuaTeX.)

See package `pdftexcmds', there I define the missing primitives
by using Lua functions.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From Robin.Fairbairns at cl.cam.ac.uk  Thu Mar  5 13:23:22 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 05 Mar 2009 12:23:22 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Thu, 05 Mar 2009 12:25:02 +0100.
	<49AFB68E.1080009@elvenkind.com>
Message-ID: <28252.1236255802@cl.cam.ac.uk>

Taco Hoekwater <taco at elvenkind.com> wrote:

> Will Robertson wrote:
> > Did the namespace idea of the ExTeX team never work in practice? I
> > really liked that idea, what little I read of it...
> 
> I only know of it as a presentation given in pont-a-mousson, and
> I would be interested to hear how it worked out in the wild.

i felt at pont-a-m (last [ever?] tex meeting i went to) that the extex
proposal was more of a paper exercise than a thing in current use.

what little i've read of extex since hasn't inspired me with any belief
that there _is_ any "wild".

are there any extex people reading this list, who can correct me?

robin

From wspr81 at gmail.com  Thu Mar  5 15:38:54 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 6 Mar 2009 01:08:54 +1030
Subject: [luatex] macros to invoke lua in LaTeX
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com> <gooarg$uhl$1@ger.gmane.org>
	<49AFB168.3070603@wxs.nl>
Message-ID: <gooo5v$bsc$1@ger.gmane.org>

On 2009-03-05 21:33:04 +1030, Hans Hagen 
<pragma at wxs.nl> said:
> 
> well, i myself ran into it several times -)
> 
> also, users redefining primitives are out of anyones control -)

Oh, I was more referring to new problems with LuaTeX; most of its new 
primitives (that I've seen) seem rather esoteric in terms of clashing 
with existing code.

Wondering if Karl's legitimate complaints are based on real problems 
already or expected problems down the road (I suspect the latter).

I don't have a strong opinion either way but, well, I guess I'm 
optimistic enough to expect that any code that breaks can be easily 
fixed. (E.g., \let\attribute\relax.)

Thanks,
Will



From luatex at nililand.de  Thu Mar  5 15:40:17 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 5 Mar 2009 15:40:17 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AF8B03.1020306@elvenkind.com>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
Message-ID: <d5mbcspvya1y$.dlg@nililand.de>

Am Thu, 05 Mar 2009 09:19:15 +0100 schrieb Taco Hoekwater:

>> Not just right now, but at any time in the future: if a new primitive
>> \foo is introduced, any existing package that happens to use \foo is
>> potentially affected.  
> 
> This is the best argument ever -- for not developing luatex at all.
> 
> Until version luatex 1.0, we reserve the right to make any change.
> Because if we were to promise not to remove old primitives and to
> avoid adding conflicting primitives, you get exactly what you have
> already: pdftex. Which isn't going away.

Naturally luatex can add new primitives (and should do it) like 
pdftex has done it. And you will never be able to avoid that such a 
new primitive clash somehow. But nevertheless I think it would be 
very useful if the names of the primitives would use an uniform 
prefix -- even more as luatex is not stable and new primitives can 
arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
xetex create a simple namespace and enable package writers to avoid 
_future_ conflicts with new primitives simply by not using the 
prefix. 


-- 
Ulrike Fischer 


From taco at elvenkind.com  Thu Mar  5 15:45:04 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Mar 2009 15:45:04 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <d5mbcspvya1y$.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de>
Message-ID: <49AFE570.3080903@elvenkind.com>



Ulrike Fischer wrote:
> Am Thu, 05 Mar 2009 09:19:15 +0100 schrieb Taco Hoekwater:
> 
>>> Not just right now, but at any time in the future: if a new primitive
>>> \foo is introduced, any existing package that happens to use \foo is
>>> potentially affected.  
>> This is the best argument ever -- for not developing luatex at all.
>>
>> Until version luatex 1.0, we reserve the right to make any change.
>> Because if we were to promise not to remove old primitives and to
>> avoid adding conflicting primitives, you get exactly what you have
>> already: pdftex. Which isn't going away.
> 
> Naturally luatex can add new primitives (and should do it) like 
> pdftex has done it. And you will never be able to avoid that such a 
> new primitive clash somehow. But nevertheless I think it would be 
> very useful if the names of the primitives would use an uniform 
> prefix -- even more as luatex is not stable and new primitives can 
> arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
> xetex create a simple namespace and enable package writers to avoid 
> _future_ conflicts with new primitives simply by not using the 
> prefix. 

You do realise that you are argueing for the creation of

  \XeTeXsuppressfontnotfounderror
and
  \LuaTeXsuppressfontnotfounderror

instead of just the single new primitive \suppressfontnotfounderror
that Jonathan and I came up with and implemented?

Best wishes,
Taco





From luatex at nililand.de  Thu Mar  5 16:02:31 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 5 Mar 2009 16:02:31 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AFE570.3080903@elvenkind.com>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
Message-ID: <1lp8y5eraeqfn.dlg@nililand.de>

Am Thu, 05 Mar 2009 15:45:04 +0100 schrieb Taco Hoekwater:


>> Naturally luatex can add new primitives (and should do it) like 
>> pdftex has done it. And you will never be able to avoid that such a 
>> new primitive clash somehow. But nevertheless I think it would be 
>> very useful if the names of the primitives would use an uniform 
>> prefix -- even more as luatex is not stable and new primitives can 
>> arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
>> xetex create a simple namespace and enable package writers to avoid 
>> _future_ conflicts with new primitives simply by not using the 
>> prefix. 
> 
> You do realise that you are argueing for the creation of
> 
>   \XeTeXsuppressfontnotfounderror
> and
>   \LuaTeXsuppressfontnotfounderror
> 
> instead of just the single new primitive \suppressfontnotfounderror
> that Jonathan and I came up with and implemented?

You could use \uniTeX as prefix for commands that affects both
"unicode" engines ;-). But a bit more serious: I do understand that
it will probably not possible to get a completly strict and
consistent naming scheme. But an imperfect naming scheme is in my
opinion better than none at all.  

-- 
Ulrike Fischer 


From pragma at wxs.nl  Thu Mar  5 16:59:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 16:59:26 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <1lp8y5eraeqfn.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFE570.3080903@elvenkind.com> <1lp8y5eraeqfn.dlg@nililand.de>
Message-ID: <49AFF6DE.4080404@wxs.nl>

Ulrike Fischer wrote:
> Am Thu, 05 Mar 2009 15:45:04 +0100 schrieb Taco Hoekwater:
> 
> 
>>> Naturally luatex can add new primitives (and should do it) like 
>>> pdftex has done it. And you will never be able to avoid that such a 
>>> new primitive clash somehow. But nevertheless I think it would be 
>>> very useful if the names of the primitives would use an uniform 
>>> prefix -- even more as luatex is not stable and new primitives can 
>>> arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
>>> xetex create a simple namespace and enable package writers to avoid 
>>> _future_ conflicts with new primitives simply by not using the 
>>> prefix. 
>> You do realise that you are argueing for the creation of
>>
>>   \XeTeXsuppressfontnotfounderror
>> and
>>   \LuaTeXsuppressfontnotfounderror
>>
>> instead of just the single new primitive \suppressfontnotfounderror
>> that Jonathan and I came up with and implemented?
> 
> You could use \uniTeX as prefix for commands that affects both
> "unicode" engines ;-). But a bit more serious: I do understand that
> it will probably not possible to get a completly strict and
> consistent naming scheme. But an imperfect naming scheme is in my
> opinion better than none at all.  

if someone has been using a macro package that provided a macro based 
\suppressfontnotfounderror where that macro was a core macro, tnen 
changes are high that it will still has its meaning (since it is defined 
and overloads the primitive); the only thing a macro package then has to 
do is provde a way to access the new primitive or just use the 
\primitive prefix which kind of acts like a namespace for the engine; 
actually \mymacropackageprefix can be easily define to create a package 
specific namespace as well

macro packages have 25-50 K macro names easily so there's alway sthe 
potential of a clash; in the end it's the manuals that tell users what 
command to use

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Thu Mar  5 17:04:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 17:04:26 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <d5mbcspvya1y$.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de>
Message-ID: <49AFF80A.4080204@wxs.nl>

Ulrike Fischer wrote:
> Am Thu, 05 Mar 2009 09:19:15 +0100 schrieb Taco Hoekwater:
> 
>>> Not just right now, but at any time in the future: if a new primitive
>>> \foo is introduced, any existing package that happens to use \foo is
>>> potentially affected.  
>> This is the best argument ever -- for not developing luatex at all.
>>
>> Until version luatex 1.0, we reserve the right to make any change.
>> Because if we were to promise not to remove old primitives and to
>> avoid adding conflicting primitives, you get exactly what you have
>> already: pdftex. Which isn't going away.
> 
> Naturally luatex can add new primitives (and should do it) like 
> pdftex has done it. And you will never be able to avoid that such a 
> new primitive clash somehow. But nevertheless I think it would be 
> very useful if the names of the primitives would use an uniform 
> prefix -- even more as luatex is not stable and new primitives can 
> arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
> xetex create a simple namespace and enable package writers to avoid 
> _future_ conflicts with new primitives simply by not using the 
> prefix. 

there is no such problem:

- engine starts up with \newthing defined as primitive
- macro packagesis loaded and defines \newthing itself

so, how can there be a conflict? only if other packages expect \newthing 
to be the primitive which they can't because it was always a macro

now, nothing prevents a macro package core to provide \prefixednewthing 
as soon as \newthing shows up in the engine

so, instead of messing around with the engine's prefix (which is not 
robust either) a macro package can enforce its own policy

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luatex at nililand.de  Thu Mar  5 17:51:54 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 5 Mar 2009 17:51:54 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AFF80A.4080204@wxs.nl>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFF80A.4080204@wxs.nl>
Message-ID: <re4yo1eqlmvs$.dlg@nililand.de>

Am Thu, 05 Mar 2009 17:04:26 +0100 schrieb Hans Hagen:


>> Naturally luatex can add new primitives (and should do it) like 
>> pdftex has done it. And you will never be able to avoid that such a 
>> new primitive clash somehow. But nevertheless I think it would be 
>> very useful if the names of the primitives would use an uniform 
>> prefix -- even more as luatex is not stable and new primitives can 
>> arise or disappear again. Prefixes like \pdf of pdftex and \XeTeX of 
>> xetex create a simple namespace and enable package writers to avoid 
>> _future_ conflicts with new primitives simply by not using the 
>> prefix. 
> 
> there is no such problem:
> 
> - engine starts up with \newthing defined as primitive
> - macro packagesis loaded and defines \newthing itself
> 
> so, how can there be a conflict? only if other packages expect \newthing 
> to be the primitive which they can't because it was always a macro

A new package is written which uses the primitive \newthing and
knows nothing about the old package with the \newthing macro. The
some user loads both packages and gets a conflict. 

This is probably not a real problem in a system like context where
large portions of the code are under your control. But in a system
like LaTeX with its large amounts of packages from various authors,
some small, some large, some old and perhaps not longer maintained
it is much more difficult to know which package is (re)defining
which macro.

> now, nothing prevents a macro package core to provide \prefixednewthing 
> as soon as \newthing shows up in the engine

Sure, if you mean by "macro package" a large, well maintained format
and not one of the small LaTeX-package. The LaTeX kernel e.g. could
do it, like LaTeX3 is doing it for the TeX-primitives. But in the
case of the TeX-primitives this renaming is necessary because there
is no chance to change the names in the engines itself. luatex on
the other side is _new_. Why doesn't it use names where there is
less danger that someone will try to overwrite it? It would be a
pity if you would have to use \latexluanewthing with latex3 and
\ctxluanewthing with context and \memluanewthing in latex2e when
using the memoir class and \komaluanewthing when using a KOMA-class. 



-- 
Ulrike Fischer 


From taco at elvenkind.com  Thu Mar  5 18:07:10 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Mar 2009 18:07:10 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <re4yo1eqlmvs$.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFF80A.4080204@wxs.nl> <re4yo1eqlmvs$.dlg@nililand.de>
Message-ID: <49B006BE.6090204@elvenkind.com>


Hi Ulrike,

Ulrike Fischer wrote:
> luatex the other side is _new_. Why doesn't it use names where 
> there is less danger that someone will try to overwrite it? 

Well, that is why the primitive \primitive exists (and the alias
\pdfprimitive): so that you always have access to all primitives
in the engine (well, unless a smartass package would redefine
\primitive and \pdfprimitive, of course).

> It would be a
> pity if you would have to use \latexluanewthing with latex3 and
> \ctxluanewthing with context and \memluanewthing in latex2e when
> using the memoir class and \komaluanewthing when using a KOMA-class. 

That virtual "you" will not be using all of these packages, and
even if that "you" would do so, I still don't see a *practical*
case for each of those packages having an *actual* clash with
*any* primitive. The whole name conflict thing has been virtual
so far, with the only person actually affected: Hans himself.

Let's be clear on this: we will not start prefixing every new
primitive with some random string, and I believe we have explained
quite thoroughly why we will not do so. We have heard all the
arguments in favour of prefixes before, and we are still not
convinced.

Best wishes,
Taco


From pragma at wxs.nl  Thu Mar  5 19:32:30 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Mar 2009 19:32:30 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <re4yo1eqlmvs$.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFF80A.4080204@wxs.nl> <re4yo1eqlmvs$.dlg@nililand.de>
Message-ID: <49B01ABE.5070003@wxs.nl>

Ulrike Fischer wrote:

> A new package is written which uses the primitive \newthing and
> knows nothing about the old package with the \newthing macro. The
> some user loads both packages and gets a conflict. 

it's more like to get conflicts in allocated registers or macro names 
like \temp and such

> pity if you would have to use \latexluanewthing with latex3 and
> \ctxluanewthing with context and \memluanewthing in latex2e when
> using the memoir class and \komaluanewthing when using a KOMA-class. 

well, latex and context macros don't mix anyway so there is not much 
change for a clash there -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Thu Mar  5 23:07:51 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 5 Mar 2009 23:07:51 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AFE570.3080903@elvenkind.com>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
Message-ID: <18864.19767.613869.152787@zaphod.ms25.net>

On 5 March 2009 Taco Hoekwater wrote:

 > You do realise that you are argueing for the creation of
 > 
 >   \XeTeXsuppressfontnotfounderror
 > and
 >   \LuaTeXsuppressfontnotfounderror
 > 
 > instead of just the single new primitive \suppressfontnotfounderror
 > that Jonathan and I came up with and implemented?

Hi Taco,
great to hear that you are discussing these things with Jonathan!
Yes, I think that two primitives in different engines, which do exactly
the same thing, should have the same name.

Regarding namespaces: It's a good idea at first glance.  But I don't
think there is any need to be concerned about macro packages people
write in the future.  Macro writers have to read the specifications
anyway.  They have to read the TeXbook if they want to support Knuth's
tex, they have to read the pdfTeX manual if they want to support
pdftex, and they have to read the LuaTeX manual if they want to support
Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.

Hans already explained why new primitives don't break old macro
packages.  So, where is the problem?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From oberdiek at uni-freiburg.de  Thu Mar  5 23:06:21 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 5 Mar 2009 23:06:21 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B006BE.6090204@elvenkind.com>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFF80A.4080204@wxs.nl>
	<re4yo1eqlmvs$.dlg@nililand.de> <49B006BE.6090204@elvenkind.com>
Message-ID: <20090305220621.GA3546@irwin.vpn.uni-freiburg.de>

On Thu, Mar 05, 2009 at 06:07:10PM +0100, Taco Hoekwater wrote:

> Ulrike Fischer wrote:
> > luatex the other side is _new_. Why doesn't it use names where 
> > there is less danger that someone will try to overwrite it? 
> 
> Well, that is why the primitive \primitive exists (and the alias
> \pdfprimitive): so that you always have access to all primitives
> in the engine (well, unless a smartass package would redefine
> \primitive and \pdfprimitive, of course).

There are quite some applications in LaTeX, that are based on
the possibility to redefine a primitive command, e.g.
\shipout is redefined in various packages (atbegshi, everyshi,
pdftex.def for background color, ...).
  Another application is debugging, e.g. \special is a candidate,
that can be redefined to print its contents to the .log file
additionally.
  All these wouldn't be possible, if \(pdf)primitive was used.

> > It would be a
> > pity if you would have to use \latexluanewthing with latex3 and
> > \ctxluanewthing with context and \memluanewthing in latex2e when
> > using the memoir class and \komaluanewthing when using a KOMA-class. 
> 
> That virtual "you" will not be using all of these packages, and
> even if that "you" would do so, I still don't see a *practical*
> case for each of those packages having an *actual* clash with
> *any* primitive. The whole name conflict thing has been virtual
> so far, with the only person actually affected: Hans himself.
> 
> Let's be clear on this: we will not start prefixing every new
> primitive with some random string, and I believe we have explained
> quite thoroughly why we will not do so. We have heard all the
> arguments in favour of prefixes before, and we are still not
> convinced.

As example, you got lucky with \formatname: LaTeX uses \fmtname,
quite close already, I would say.

The point is that there is software written at a time with
a known set of command names from the engines.
Now the engines evolve further and introduces new command names.
This can lead to name clashes, because the engine developer
cannot know all software that is based on the engine to avoid them.
Prefixing helps to reduce the probability of such name clashes.
With reserved prefixes they can even be avoided.

Best regards
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Thu Mar  5 23:25:35 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Mar 2009 23:25:35 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090305220621.GA3546@irwin.vpn.uni-freiburg.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>
	<49B006BE.6090204@elvenkind.com>
	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>
Message-ID: <49B0515F.7070408@elvenkind.com>

Heiko Oberdiek wrote:
> The point is that there is software written at a time with
> a known set of command names from the engines.
> Now the engines evolve further and introduces new command names.
> This can lead to name clashes, because the engine developer
> cannot know all software that is based on the engine to avoid them.
> Prefixing helps to reduce the probability of such name clashes.
> With reserved prefixes they can even be avoided.

Let's have this discussion again at the time of the luatex 1.00
release.

Best wishes,
Taco

From oberdiek at uni-freiburg.de  Thu Mar  5 23:37:55 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Thu, 5 Mar 2009 23:37:55 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <18864.19767.613869.152787@zaphod.ms25.net>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
Message-ID: <20090305223754.GA31979@irwin.vpn.uni-freiburg.de>

On Thu, Mar 05, 2009 at 11:07:51PM +0100, Reinhard Kotucha wrote:

> Regarding namespaces: It's a good idea at first glance.  But I don't
> think there is any need to be concerned about macro packages people
> write in the future.  Macro writers have to read the specifications
> anyway.  They have to read the TeXbook if they want to support Knuth's
> tex, they have to read the pdfTeX manual if they want to support
> pdftex, and they have to read the LuaTeX manual if they want to support
> Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.

Another reason for prefixes. As package author I wouldn't want
to check all engines for name clashes. Also it's quite
difficult to check future name clashes, especially for user
land macro names.

> Hans already explained why new primitives don't break old macro
> packages.  So, where is the problem?

Mixing old with new packages.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From reinhard.kotucha at web.de  Fri Mar  6 01:08:53 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 6 Mar 2009 01:08:53 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
Message-ID: <18864.27029.891426.734156@zaphod.ms25.net>

On 5 March 2009 Heiko Oberdiek wrote:

 > On Thu, Mar 05, 2009 at 11:07:51PM +0100, Reinhard Kotucha wrote:
 > 
 > > Regarding namespaces: It's a good idea at first glance.  But I don't
 > > think there is any need to be concerned about macro packages people
 > > write in the future.  Macro writers have to read the specifications
 > > anyway.  They have to read the TeXbook if they want to support Knuth's
 > > tex, they have to read the pdfTeX manual if they want to support
 > > pdftex, and they have to read the LuaTeX manual if they want to support
 > > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
 > 
 > Another reason for prefixes. As package author I wouldn't want
 > to check all engines for name clashes.

You have to check anyway.  At least if you want to support all
engines.  e-TeX provides new primitives, why can't luatex do the same?

 > Also it's quite difficult to check future name clashes, especially
 > for user land macro names.

Please try LaTeX's \newcommand .

 > > Hans already explained why new primitives don't break old macro
 > > packages.  So, where is the problem?
 > 
 > Mixing old with new packages.

Forget the old stuff.  Nobody forces anyone to process old documents
with luatex.

You can't expect any progress if you insist on compatibility with
stuff written three decades ago.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  6 08:48:49 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2009 08:48:49 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090305220621.GA3546@irwin.vpn.uni-freiburg.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>
	<49B006BE.6090204@elvenkind.com>
	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>
Message-ID: <49B0D561.5000003@wxs.nl>


> There are quite some applications in LaTeX, that are based on
> the possibility to redefine a primitive command, e.g.
> \shipout is redefined in various packages (atbegshi, everyshi,
> pdftex.def for background color, ...).
>   Another application is debugging, e.g. \special is a candidate,
> that can be redefined to print its contents to the .log file
> additionally.
>   All these wouldn't be possible, if \(pdf)primitive was used.

i assume that if the core engine uses \primitive\shipout that it doe 
with a purpose; actually the core should provide a proper way to 
overload its behaviour then; i woul dnot be surprised that when packages 
overload primitives, that when users load several in (an arbitrary) 
order, problems show up anyway

> As example, you got lucky with \formatname: LaTeX uses \fmtname,
> quite close already, I would say.

normally when choosing a new name, a scan on the tex live tree is done

> The point is that there is software written at a time with
> a known set of command names from the engines.
> Now the engines evolve further and introduces new command names.
> This can lead to name clashes, because the engine developer
> cannot know all software that is based on the engine to avoid them.
> Prefixing helps to reduce the probability of such name clashes.
> With reserved prefixes they can even be avoided.

as said ... latex can start with a truckload of

\let\reservedlatexprefixsomethingnew=\somethingnew

or even \luatexprimitivesomethingnew=\somethingnew if it wants.

this can be done even for older ones; that keeps the engine clean and 
puts the burden on the macro package (as it should)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Mar  6 09:04:21 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 09:04:21 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49AE668E.1050101@elvenkind.com>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE3E4B.9050801@wxs.nl>	<49AE3F2B.2000701@elvenkind.com>	<49AE46F5.1040503@telecom-bretagne.eu>	<49AE474E.6070101@elvenkind.com>	<49AE622F.9070202@telecom-bretagne.eu>
	<49AE668E.1050101@elvenkind.com>
Message-ID: <49B0D905.2010302@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Because your redefinition won't be needed from 0.40 upwards and
> will in fact be wrong from 0.50 up.

Sorry to come back to this, but there is still something I don't 
understand: what will be the good call (the one that doesn't warn about 
states) to execute lua code in LuaTeX 0.40? \directlua with no state 
argument?

Thank you,
-- 
Elie

From taco at elvenkind.com  Fri Mar  6 09:09:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 Mar 2009 09:09:13 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0D905.2010302@telecom-bretagne.eu>
References: <200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>	<49AE3E4B.9050801@wxs.nl>	<49AE3F2B.2000701@elvenkind.com>	<49AE46F5.1040503@telecom-bretagne.eu>	<49AE474E.6070101@elvenkind.com>	<49AE622F.9070202@telecom-bretagne.eu>	<49AE668E.1050101@elvenkind.com>
	<49B0D905.2010302@telecom-bretagne.eu>
Message-ID: <49B0DA29.2090707@elvenkind.com>



Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> Because your redefinition won't be needed from 0.40 upwards and
>> will in fact be wrong from 0.50 up.
> 
> Sorry to come back to this, but there is still something I don't
> understand: what will be the good call (the one that doesn't warn about
> states) to execute lua code in LuaTeX 0.40? \directlua with no state
> argument?

Yes. \directlua0 {} will trigger a warning message about the integer
argument going away in 0.50.



From oberdiek at uni-freiburg.de  Fri Mar  6 09:07:34 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 6 Mar 2009 09:07:34 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <18864.27029.891426.734156@zaphod.ms25.net>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
Message-ID: <20090306080733.GA4256@irwin.vpn.uni-freiburg.de>

On Fri, Mar 06, 2009 at 01:08:53AM +0100, Reinhard Kotucha wrote:

> On 5 March 2009 Heiko Oberdiek wrote:
> 
>  > On Thu, Mar 05, 2009 at 11:07:51PM +0100, Reinhard Kotucha wrote:
>  > 
>  > > Regarding namespaces: It's a good idea at first glance.  But I don't
>  > > think there is any need to be concerned about macro packages people
>  > > write in the future.  Macro writers have to read the specifications
>  > > anyway.  They have to read the TeXbook if they want to support Knuth's
>  > > tex, they have to read the pdfTeX manual if they want to support
>  > > pdftex, and they have to read the LuaTeX manual if they want to support
>  > > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
>  > 
>  > Another reason for prefixes. As package author I wouldn't want
>  > to check all engines for name clashes.
> 
> You have to check anyway.  At least if you want to support all
> engines.  e-TeX provides new primitives, why can't luatex do the same?

I had to write package `etexcmds' to deal with the clashes.

>  > Also it's quite difficult to check future name clashes, especially
>  > for user land macro names.
> 
> Please try LaTeX's \newcommand .

It doesn't fix anything.

>  > > Hans already explained why new primitives don't break old macro
>  > > packages.  So, where is the problem?
>  > 
>  > Mixing old with new packages.
> 
> Forget the old stuff.  Nobody forces anyone to process old documents
> with luatex.

You think, development stops at version 1.00?

> You can't expect any progress if you insist on compatibility with
> stuff written three decades ago.

The price is low. There is also a benefit, if prefixing is used.
At first glance it can be seen where the command comes from
(primitive, macro package, ...).

With unprefixed command names in userland it seems to me as
requirement that the format (as "operating system") renames
the primitive commands using its naming conventions (e.g. prefixes)
to prevent name clashes. Then only this renaming module needs
an update if a new version with new primitives is released.
Then there is also no point in having unprefixed primitives
in the first place, because they can never be reliably used in
this form.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Fri Mar  6 09:19:10 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 Mar 2009 09:19:10 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090306080733.GA4256@irwin.vpn.uni-freiburg.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>
	<20090306080733.GA4256@irwin.vpn.uni-freiburg.de>
Message-ID: <49B0DC7E.6070705@elvenkind.com>



Heiko Oberdiek wrote:
> 
> The price is low. There is also a benefit, if prefixing is used.
> At first glance it can be seen where the command comes from
> (primitive, macro package, ...).

This is an argument I can accept. Now, you have to come up with
a proposal for luatex to adopt once 1.0 is out.

Taco



From oberdiek at uni-freiburg.de  Fri Mar  6 09:18:35 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 6 Mar 2009 09:18:35 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0D561.5000003@wxs.nl>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFF80A.4080204@wxs.nl>
	<re4yo1eqlmvs$.dlg@nililand.de> <49B006BE.6090204@elvenkind.com>
	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>
	<49B0D561.5000003@wxs.nl>
Message-ID: <20090306081835.GA4550@irwin.vpn.uni-freiburg.de>

On Fri, Mar 06, 2009 at 08:48:49AM +0100, Hans Hagen wrote:

> 
> >There are quite some applications in LaTeX, that are based on
> >the possibility to redefine a primitive command, e.g.
> >\shipout is redefined in various packages (atbegshi, everyshi,
> >pdftex.def for background color, ...).
> >  Another application is debugging, e.g. \special is a candidate,
> >that can be redefined to print its contents to the .log file
> >additionally.
> >  All these wouldn't be possible, if \(pdf)primitive was used.
> 
> i assume that if the core engine uses \primitive\shipout that it doe 
> with a purpose; actually the core should provide a proper way to 
> overload its behaviour then;

In opposite to ConTeXt the core of LaTeX(2e) is frozen and
it doesn't provide proper ways. :-(

> i woul dnot be surprised that when packages 
> overload primitives, that when users load several in (an arbitrary) 
> order, problems show up anyway

Of course it would reduce the amount of trouble, if the core
would provide more proper ways. Perhaps LaTeX3 will be better.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From taco at elvenkind.com  Fri Mar  6 09:24:36 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 06 Mar 2009 09:24:36 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <20090306081835.GA4550@irwin.vpn.uni-freiburg.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>
	<49B006BE.6090204@elvenkind.com>	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>	<49B0D561.5000003@wxs.nl>
	<20090306081835.GA4550@irwin.vpn.uni-freiburg.de>
Message-ID: <49B0DDC4.8070403@elvenkind.com>



Heiko Oberdiek wrote:
> 
> In opposite to ConTeXt the core of LaTeX(2e) is frozen and
> it doesn't provide proper ways. :-(

You cannot reasonably use the bare latex2e core with luatex
anyway: if you don't need the extensions that luatex offers
then you are much better off running pdftex. I am starting to
wonder why this argument is ignored all the time ...

Best wishes,
Taco



From joseph.wright at morningstar2.co.uk  Fri Mar  6 09:40:43 2009
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 06 Mar 2009 08:40:43 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0DDC4.8070403@elvenkind.com>
References: <200903042331.n24NVGv26173@f7.net>	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>	<49B006BE.6090204@elvenkind.com>	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>	<49B0D561.5000003@wxs.nl>	<20090306081835.GA4550@irwin.vpn.uni-freiburg.de>
	<49B0DDC4.8070403@elvenkind.com>
Message-ID: <49B0E18B.5030209@morningstar2.co.uk>

Taco Hoekwater wrote:
> 
> Heiko Oberdiek wrote:
>> In opposite to ConTeXt the core of LaTeX(2e) is frozen and
>> it doesn't provide proper ways. :-(
> 
> You cannot reasonably use the bare latex2e core with luatex
> anyway: if you don't need the extensions that luatex offers
> then you are much better off running pdftex. I am starting to
> wonder why this argument is ignored all the time ...

I think because at some point we all expect to see the default engine
switch from pdfTeX to LuaTeX.  At that point, this becomes very important.

(Also just because one thing you want needs LuaTeX doesn't mean that
everything else will have been re-written as well.)
-- 
Joseph Wright

From Robin.Fairbairns at cl.cam.ac.uk  Fri Mar  6 09:41:54 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 06 Mar 2009 08:41:54 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Thu, 05 Mar 2009 23:37:55 +0100.
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
Message-ID: <6890.1236328914@cl.cam.ac.uk>

Heiko Oberdiek <oberdiek at uni-freiburg.de> wrote:

> On Thu, Mar 05, 2009 at 11:07:51PM +0100, Reinhard Kotucha wrote:
> 
> > Regarding namespaces: It's a good idea at first glance.  But I don't
> > think there is any need to be concerned about macro packages people
> > write in the future.  Macro writers have to read the specifications
> > anyway.  They have to read the TeXbook if they want to support Knuth's
> > tex, they have to read the pdfTeX manual if they want to support
> > pdftex, and they have to read the LuaTeX manual if they want to support
> > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
> 
> Another reason for prefixes. As package author I wouldn't want
> to check all engines for name clashes. Also it's quite
> difficult to check future name clashes, especially for user
> land macro names.

i don't _want_ to check all engines, but _i_ (and heiko) could, in
principle.

> > Hans already explained why new primitives don't break old macro
> > packages.  So, where is the problem?
> 
> Mixing old with new packages.

and mixing well-established packages with new engines.  *we* aren't
going to be surprised when package foo "breaks" the new primitive \bar,
but a steady proportion of texhax/comp.text.tex traffic covers just such
name clashes (mostly between packages, but occasionally between package
and engine).

as has already been said, this is complicated by the state of
authorship; the context community (seems, to me, to) keep in touch with
each other, but latex package authors regularly disappear.  of the large
list of latex packages for which i don't have an author address, i've
only *two* instructions to hand responsibility on to anyone who
volunteers to take it.

what do i do about packages whose author dies?  (for mike downes, i mail
barbara beeton; but i don't know who to ask in re. brian hamilton
kelly's stuff -- we had to break the copyright to get his crossword
stuff working with 2e.)

robin

From Robin.Fairbairns at cl.cam.ac.uk  Fri Mar  6 09:54:11 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 06 Mar 2009 08:54:11 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Fri, 06 Mar 2009 01:08:53 +0100.
	<18864.27029.891426.734156@zaphod.ms25.net>
Message-ID: <6999.1236329651@cl.cam.ac.uk>

Reinhard Kotucha <reinhard.kotucha at web.de> wrote:

> On 5 March 2009 Heiko Oberdiek wrote:
> 
>  > On Thu, Mar 05, 2009 at 11:07:51PM +0100, Reinhard Kotucha wrote:
>  > 
>  > > Regarding namespaces: It's a good idea at first glance.  But I don't
>  > > think there is any need to be concerned about macro packages people
>  > > write in the future.  Macro writers have to read the specifications
>  > > anyway.  They have to read the TeXbook if they want to support Knuth's
>  > > tex, they have to read the pdfTeX manual if they want to support
>  > > pdftex, and they have to read the LuaTeX manual if they want to support
>  > > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
>  > 
>  > Another reason for prefixes. As package author I wouldn't want
>  > to check all engines for name clashes.
> 
> You have to check anyway.  At least if you want to support all
> engines.  e-TeX provides new primitives, why can't luatex do the same?

as i already said: that's fine for you, me or heiko.

the concern is for the non-cognoscenti.

>  > Also it's quite difficult to check future name clashes, especially
>  > for user land macro names.
> 
> Please try LaTeX's \newcommand .

don't be silly: do you suppose any of us do otherwise, whenever
appropriate?

>  > > Hans already explained why new primitives don't break old macro
>  > > packages.  So, where is the problem?
>  > 
>  > Mixing old with new packages.
> 
> Forget the old stuff.  Nobody forces anyone to process old documents
> with luatex.

pshaw.  nobody forces anyone to use pdftex with their old documents, but
anyone who updates their distribution (e.g., because they've gained a
new machine) ends up with little choice other than recompiling.

*still*, we get people confused by that.

it would be nice to have luatex as the default engine, some time in the
future.  which is why people such as heiko and i are concerned to
minimise problems.

> You can't expect any progress if you insist on compatibility with
> stuff written three decades ago.

sure, but it's as well to take precautions, so as to minimise problems.

i, for one, had never anticipated all the problems with the switch to
pdftex; i bet there were those who did, and if this sort of discussion
had happened then, we might have avoided the worst of the problems.

robin

From pragma at wxs.nl  Fri Mar  6 10:01:00 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2009 10:01:00 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0E18B.5030209@morningstar2.co.uk>
References: <200903042331.n24NVGv26173@f7.net>	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>	<49B006BE.6090204@elvenkind.com>	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>	<49B0D561.5000003@wxs.nl>	<20090306081835.GA4550@irwin.vpn.uni-freiburg.de>	<49B0DDC4.8070403@elvenkind.com>
	<49B0E18B.5030209@morningstar2.co.uk>
Message-ID: <49B0E64C.4090308@wxs.nl>

Joseph Wright wrote:
> Taco Hoekwater wrote:
>> Heiko Oberdiek wrote:
>>> In opposite to ConTeXt the core of LaTeX(2e) is frozen and
>>> it doesn't provide proper ways. :-(
>> You cannot reasonably use the bare latex2e core with luatex
>> anyway: if you don't need the extensions that luatex offers
>> then you are much better off running pdftex. I am starting to
>> wonder why this argument is ignored all the time ...
> 
> I think because at some point we all expect to see the default engine
> switch from pdfTeX to LuaTeX.  At that point, this becomes very important.

given our roadmap, this will not happen before 2012 (when we expect to 
have version 1.0) so there's quite some time for packages to adapt

anyhow, the engine landscape will be as follows:

- pdftex: stable, no unicode, but frozen apart from bugfixes: this will 
probably be used quite a while esp by those who want compatibility and 
speed (not everyone needs open type fonts and/or unicode)

- xetex: unicode, depending on libraries, relatively fast and easy to 
interface to fonts

- luatex: flexible unicode engine, no pre-cooked solutions, mainly a 
core engine, where macro packages have to do the work; downward 
compatible where possible (exceptions are in the dark corners of 
hyphenation and logging)

now, i've been sitting at quite some tex user meetings and whenever real 
new things came up there is always someone willing to bring up the "do 
we need it" or "we don't need it because it breaks old stuff" or "we 
have this standard input interface so forget about something else even 
if it's better" or "one could do it this or that way too" ...

the bottom line is ... there are quite some users (also think of 
journals) who probably will stick to pdftex just because it's not doing 
anything new that might result in incompatible output; that's also not 
the audience luatex is directly aiming at ... if eventually those users 
will use luatex (or xetex) it will be because they are not aware of the 
switch, just as many users are not aware that they had been running etex 
or later pdftex when they keyed in "tex" (after all many users are 
hapilly unaware of the difference between an engine and a macro package 
anyway)

> (Also just because one thing you want needs LuaTeX doesn't mean that
> everything else will have been re-written as well.)

believe me ... if you really want to use luatex you'll have to rewrite 
lots of code (ok, you can use it as pdftex with \directlua calls and not 
touch the nasty internals); eventually context (mkiv) will be 50% or 
more lua and currently it already spends over 50% of its time in lua, 
and as such is twice as slow as pdftex (which can be another argument to 
use multiple engines); and yes, context will support pdftex, xetex and 
luatex, simply because all are used by its users -)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  6 10:02:54 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2009 10:02:54 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <6999.1236329651@cl.cam.ac.uk>
References: <6999.1236329651@cl.cam.ac.uk>
Message-ID: <49B0E6BE.6040209@wxs.nl>

Robin Fairbairns wrote:

> i, for one, had never anticipated all the problems with the switch to
> pdftex; i bet there were those who did, and if this sort of discussion
> had happened then, we might have avoided the worst of the problems.

part of the problems were probaly due to the fact that in the process of 
developing pdftex, some primitive names changesd (even the prefix 
changed) simply as part of a cleanup

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luatex at nililand.de  Fri Mar  6 09:41:04 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 6 Mar 2009 09:41:04 +0100
Subject: [luatex] macros to invoke lua in LaTeX
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
Message-ID: <x27pc7blzmgf.dlg@nililand.de>

Am Fri, 6 Mar 2009 01:08:53 +0100 schrieb Reinhard Kotucha:

>  > > Regarding namespaces: It's a good idea at first glance.  But I don't
>  > > think there is any need to be concerned about macro packages people
>  > > write in the future.  Macro writers have to read the specifications
>  > > anyway.  They have to read the TeXbook if they want to support Knuth's
>  > > tex, they have to read the pdfTeX manual if they want to support
>  > > pdftex, and they have to read the LuaTeX manual if they want to support
>  > > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
>  > 
>  > Another reason for prefixes. As package author I wouldn't want
>  > to check all engines for name clashes.
> 
> You have to check anyway.  At least if you want to support all
> engines.  

I have to know the exact names of the new primitive commands only if
I want to use them. To write a package that can be used with all
engines without a clash it is enough to know how to avoid the names.
That's easy with pdftex: simply don't use commands starting with
\pdf. It's also easy with XeTeX: avoid commands starting with
\XeTeX. But with luatex you are right. I will have to check
everytime a new version is released if there is a conflict.  

> e-TeX provides new primitives, why can't luatex do the same?

Nobody is denying luatex the right to declare new primitives. The
only question is if the names of this new primitives should use some
namespace.


>  > Also it's quite difficult to check future name clashes, especially
>  > for user land macro names.
> 
> Please try LaTeX's \newcommand .

What would this help? If it doesn't give an error now, there is no
way to know if it will give an error later. 

 

-- 
Ulrike Fischer 


From Robin.Fairbairns at cl.cam.ac.uk  Fri Mar  6 10:27:55 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 06 Mar 2009 09:27:55 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Fri, 06 Mar 2009 10:02:54 +0100.
	<49B0E6BE.6040209@wxs.nl>
Message-ID: <7576.1236331675@cl.cam.ac.uk>


Hans Hagen <pragma at wxs.nl> wrote:

> Robin Fairbairns wrote:
> 
> > i, for one, had never anticipated all the problems with the switch to
> > pdftex; i bet there were those who did, and if this sort of discussion
> > had happened then, we might have avoided the worst of the problems.
> 
> part of the problems were probaly due to the fact that in the process
> of developing pdftex, some primitive names changesd (even the prefix
> changed) simply as part of a cleanup

no: they were (and still are) because of documents misunderstanding what
engine they're using, and deploying the wrong graphics support macros.

otherwise, the change over has been remarkably smooth.

robi

From pragma at wxs.nl  Fri Mar  6 10:33:08 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2009 10:33:08 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <7576.1236331675@cl.cam.ac.uk>
References: <7576.1236331675@cl.cam.ac.uk>
Message-ID: <49B0EDD4.8040702@wxs.nl>

Robin Fairbairns wrote:

> otherwise, the change over has been remarkably smooth.

btw, in the past my biggest 'waste-of-time' efforts were not a few 
primitives or differences between engines but

- uncommunicated changes in filenames (of for instance pattern files)
- changes in tds (that affect scripts and tex/mp lookups)
- changes in fonts (files, metrics, etc)
- command line switches

so, it could be worse -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Mar  6 10:39:52 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 06 Mar 2009 10:39:52 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <x27pc7blzmgf.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de>
Message-ID: <49B0EF68.8000709@wxs.nl>

Ulrike Fischer wrote:

> I have to know the exact names of the new primitive commands only if
> I want to use them. To write a package that can be used with all
> engines without a clash it is enough to know how to avoid the names.
> That's easy with pdftex: simply don't use commands starting with
> \pdf. It's also easy with XeTeX: avoid commands starting with
> \XeTeX. But with luatex you are right. I will have to check
> everytime a new version is released if there is a conflict.  

you'll have to check anyway since we can change names of primitives (or 
function at the lua end) as we progress; however, we will declare some 
of them stable with version 0.50 and more with 1.00

>> e-TeX provides new primitives, why can't luatex do the same?
> 
> Nobody is denying luatex the right to declare new primitives. The
> only question is if the names of this new primitives should use some
> namespace.

so, i suggest that you convince your fellow latex users to come op with 
a definition file that is loaded early and maps primitives to prefixed 
ones (for which you can use \lua if you can agree upon it); the 
advantage is that even if we change primitives, package users still see 
the same (it's what i've been doing for years when pdftex changed 
primive names and still do with luatex)

(this does not solve the shipout overload but that's another issue: 
proper package management; it should not be too hard to change the few 
packages that redefine shipout to use some \redefineshipout)

and, if there is no proper management for that kind of stuff at the 
macro package level then you might expect even bigger problems once 
users start messing around with node lists in ways that might confuse 
successive packages that do the same; that's the price for flexibility)

Hans




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Mar  6 10:54:10 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 10:54:10 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0EF68.8000709@wxs.nl>
References: <200903042331.n24NVGv26173@f7.net>	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>	<x27pc7blzmgf.dlg@nililand.de>
	<49B0EF68.8000709@wxs.nl>
Message-ID: <49B0F2C2.3040404@telecom-bretagne.eu>

Hans Hagen a ?crit :
> so, i suggest that you convince your fellow latex users to come op 
> with a definition file that is loaded early and maps primitives to 
> prefixed ones (for which you can use \lua if you can agree upon it); 
> the advantage is that even if we change primitives, package users 
> still see the same (it's what i've been doing for years when pdftex 
> changed primive names and still do with luatex)

That's (part of) what I'm doing with luatextra...
-- 
Elie

From luatex at nililand.de  Fri Mar  6 13:09:47 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 6 Mar 2009 13:09:47 +0100
Subject: [luatex] macros to invoke lua in LaTeX
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de> <49B0EF68.8000709@wxs.nl>
Message-ID: <t0yz00acdhfw$.dlg@nililand.de>

Am Fri, 06 Mar 2009 10:39:52 +0100 schrieb Hans Hagen:

> Ulrike Fischer wrote:
> 
>> I have to know the exact names of the new primitive commands only if
>> I want to use them. To write a package that can be used with all
>> engines without a clash it is enough to know how to avoid the names.
>> That's easy with pdftex: simply don't use commands starting with
>> \pdf. It's also easy with XeTeX: avoid commands starting with
>> \XeTeX. But with luatex you are right. I will have to check
>> everytime a new version is released if there is a conflict.  
> 
> you'll have to check anyway since we can change names of primitives (or 
> function at the lua end) as we progress; however, we will declare some 
> of them stable with version 0.50 and more with 1.00

I do have the impression that you are thinking about packages or
documents that really use luatex commands. But this is not my
concern. Someone who is now writing a package which uses some of the
new commands should know that syntax and names can change.

I'm thinking about the large number of generic packages, some on
CTAN, some local, which don't do anything engine specific and whose
authors are trying not to define new user commands which will
conflict with some of the new engine primitives. 


>> Nobody is denying luatex the right to declare new primitives. The
>> only question is if the names of this new primitives should use some
>> namespace.
> 
> so, i suggest that you convince your fellow latex users to come op with 
> a definition file that is loaded early and maps primitives to prefixed 
> ones (for which you can use \lua if you can agree upon it); 

And I'm thinking about the not so large number of packages like pgf
which try to offer code for latex and context and plain. 



-- 
Ulrike Fischer 


From joseph.wright at morningstar2.co.uk  Fri Mar  6 13:25:20 2009
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 06 Mar 2009 12:25:20 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B0E64C.4090308@wxs.nl>
References: <200903042331.n24NVGv26173@f7.net>	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>	<49AFF80A.4080204@wxs.nl>	<re4yo1eqlmvs$.dlg@nililand.de>	<49B006BE.6090204@elvenkind.com>	<20090305220621.GA3546@irwin.vpn.uni-freiburg.de>	<49B0D561.5000003@wxs.nl>	<20090306081835.GA4550@irwin.vpn.uni-freiburg.de>	<49B0DDC4.8070403@elvenkind.com>	<49B0E18B.5030209@morningstar2.co.uk>
	<49B0E64C.4090308@wxs.nl>
Message-ID: <49B11630.7060600@morningstar2.co.uk>

Hans Hagen wrote:
 >> (Also just because one thing you want needs LuaTeX doesn't mean that
>> everything else will have been re-written as well.)
> 
> believe me ... if you really want to use luatex you'll have to rewrite
> lots of code 

I don't see this (at least for LaTeX).  If I'm using a lot of big
packages (say komascript, hyperref, pgf, mhchem, ...), then most of the
code is not about to be re-written. So even if some new package uses
quite a lot of Lua (say a LuaTeX equivalent of fontspec + microtype),
most of the code I'm relying on is still TeX-based.
-- 
Joseph Wright

From elie.roux at telecom-bretagne.eu  Fri Mar  6 19:21:24 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 19:21:24 +0100
Subject: [luatex] LuaTeXtra code review
Message-ID: <49B169A4.1080806@telecom-bretagne.eu>

Hello,

As this package may lead to a lot of discussions, here you can find the 
current code of the luatextra package. It's not totally complete yet. 
All the macros start by \lua, and the primitives are wrapped in a macro 
that starts by lua too. \directlua becomes luadirect for example.

The package works for LaTeX and plain, it loads Heiko's ifluatex.sty.

It automatically loads luamcallbacks, to enable several functions to be 
registered in a callback.

It contains \luanewattribute and \luanewcatcodetable, as well as the 
same catcodetables as in Heiko's luatex.sty. It adds a 
tex.attributenumber table to get the number of an attribute. It's useful 
for processing nodes with attributes.

It contains module loading functions, named \luaUseModule and 
\luaRequireModule, with the corresponding lua functions 
luatextra.use_module and luatextra.require_module. They have the same 
kind of behaviour as LaTeX with packages.

I also defined some lua functions for packages to use, like module_info, 
module_log, module_warning or module_error.

I added the following macros :
\def\LuaTeX{Lua\TeX }
\def\LuaLaTeX{Lua\LaTeX }

I hesitated with \textsc{Lua}\TeX in LaTeX, but it seems unlogical, as 
the LuaTeX manual doesn't use small capitals.

The next steps are : improving the catcodetable code, and defining a 
LaTeX evironment that executes pure lua code, with the good catcodes (it 
won't expand macros nor macro arguments), called luaverb.

Thank you in advance,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatextra.zip
Type: application/zip
Size: 5499 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090306/6eee1792/attachment.zip 

From wspr81 at gmail.com  Fri Mar  6 19:38:55 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 7 Mar 2009 05:08:55 +1030
Subject: [luatex] LuaTeXtra code review
References: <49B169A4.1080806@telecom-bretagne.eu>
Message-ID: <gorqjv$vjv$1@ger.gmane.org>

On 2009-03-07 04:51:24 +1030, Elie Roux 
<elie.roux at telecom-bretagne.eu> said:

> As this package may lead to a lot of discussions, here you can find the
> current code of the luatextra package. It's not totally complete yet.
> All the macros start by \lua, and the primitives are wrapped in a macro
> that starts by lua too. \directlua becomes luadirect for example.

Is this package (and your related work) stored in a version control 
system somewhere? Can I suggest GitHub or somethere similar?

Will



From elie.roux at telecom-bretagne.eu  Fri Mar  6 19:44:19 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 19:44:19 +0100
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <gorqjv$vjv$1@ger.gmane.org>
References: <49B169A4.1080806@telecom-bretagne.eu> <gorqjv$vjv$1@ger.gmane.org>
Message-ID: <49B16F03.2020207@telecom-bretagne.eu>

Will Robertson a ?crit :
> Is this package (and your related work) stored in a version control 
> system somewhere? Can I suggest GitHub or somethere similar?

Not yet, but I'll set something up soon (tonight maybe).
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Mar  6 21:15:01 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 21:15:01 +0100
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <49B16F03.2020207@telecom-bretagne.eu>
References: <49B169A4.1080806@telecom-bretagne.eu> <gorqjv$vjv$1@ger.gmane.org>
	<49B16F03.2020207@telecom-bretagne.eu>
Message-ID: <49B18445.5030207@telecom-bretagne.eu>

Elie Roux a ?crit :
> Will Robertson a ?crit :
>> Is this package (and your related work) stored in a version control 
>> system somewhere? Can I suggest GitHub or somethere similar?
>
> Not yet, but I'll set something up soon (tonight maybe).

Here it is: http://github.com/eroux/lualatex/tree/master

Some files are not totally adapted and may contain some wrong names (the 
names of the modules and files changed). I also still have to decide the 
good behaviour of luainputenc... I don't know yet if I split it into 
fancyencodings and luainputenc, where fancyencodings really converts 
things from and to a lot of encodings and luainputenc just the 
adaptation of inputenc to LuaTeX, with a fake_utf8 function. What do you 
think?
-- 
Elie

From oberdiek at uni-freiburg.de  Fri Mar  6 22:24:34 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Fri, 6 Mar 2009 22:24:34 +0100
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <49B169A4.1080806@telecom-bretagne.eu>
References: <49B169A4.1080806@telecom-bretagne.eu>
Message-ID: <20090306212433.GA3600@irwin.vpn.uni-freiburg.de>

On Fri, Mar 06, 2009 at 07:21:24PM +0100, Elie Roux wrote:

> It contains \luanewattribute and \luanewcatcodetable, as well as the 

\new... is a naming convention of plain.tex/latex.ltx.
attribute, codetable comes from LuaTeX, why not
\newluaattribute and \newluacatcodetable?

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From elie.roux at telecom-bretagne.eu  Fri Mar  6 22:43:31 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 06 Mar 2009 22:43:31 +0100
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <20090306212433.GA3600@irwin.vpn.uni-freiburg.de>
References: <49B169A4.1080806@telecom-bretagne.eu>
	<20090306212433.GA3600@irwin.vpn.uni-freiburg.de>
Message-ID: <49B19903.9040800@telecom-bretagne.eu>

Heiko Oberdiek a ?crit :
> \new... is a naming convention of plain.tex/latex.ltx.
> attribute, codetable comes from LuaTeX, why not
> \newluaattribute and \newluacatcodetable?

Seems logical, but it seems also logical that all primitive start by 
\lua... I must admit I also prefer \newluaattribute... Karl, what do you 
think?
-- 
Elie

From karl at freefriends.org  Fri Mar  6 23:18:27 2009
From: karl at freefriends.org (Karl Berry)
Date: Fri, 6 Mar 2009 16:18:27 -0600
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <49B19903.9040800@telecom-bretagne.eu>
Message-ID: <200903062218.n26MIRK23932@f7.net>

    Seems logical, but it seems also logical that all primitive 

Well, not primitives :).

    start by \lua... I must admit I also prefer
    \newluaattribute... Karl, what do you think?

If it were me, I would consistently start every public macro defined by
a package with a given prefix, \lua in this case.

However, I'm not doing the work, and I won't complain if you go with
with \newlua...  I am well aware that is the convention for everything
else.

From mpg at elzevir.fr  Sat Mar  7 00:50:33 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 07 Mar 2009 00:50:33 +0100
Subject: [luatex] LuaTeXtra code review
In-Reply-To: <49B19903.9040800@telecom-bretagne.eu>
References: <49B169A4.1080806@telecom-bretagne.eu>	<20090306212433.GA3600@irwin.vpn.uni-freiburg.de>
	<49B19903.9040800@telecom-bretagne.eu>
Message-ID: <49B1B6C9.6030105@elzevir.fr>

Elie Roux a ?crit :
> Heiko Oberdiek a ?crit :
>> \new... is a naming convention of plain.tex/latex.ltx.
>> attribute, codetable comes from LuaTeX, why not
>> \newluaattribute and \newluacatcodetable?
> 
> Seems logical, but it seems also logical that all primitive start by
> \lua... I must admit I also prefer \newluaattribute...

FWIW, I also prefer \newluaattribute. For some reasons, I had problems correctly
dividing \luanewattribute into words the first time I saw it. I tend to think
both are good anyway.

Manuel.


From reinhard.kotucha at web.de  Sat Mar  7 02:11:20 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 7 Mar 2009 02:11:20 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <x27pc7blzmgf.dlg@nililand.de>
References: <200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de>
Message-ID: <18865.51640.724775.78648@zaphod.ms25.net>

On 6 March 2009 Ulrike Fischer wrote:

 > Am Fri, 6 Mar 2009 01:08:53 +0100 schrieb Reinhard Kotucha:
 > 
 > >  > > Regarding namespaces: It's a good idea at first glance.  But
 > >  > > I don't think there is any need to be concerned about macro
 > >  > > packages people write in the future.  Macro writers have to
 > >  > > read the specifications anyway.  They have to read the
 > >  > > TeXbook if they want to support Knuth's tex, they have to
 > >  > > read the pdfTeX manual if they want to support pdftex, and
 > >  > > they have to read the LuaTeX manual if they want to support
 > >  > > Luatex.  Same for e-TeX, XeTeX, Omega, and derivates.
 > >  > 
 > >  > Another reason for prefixes. As package author I wouldn't want
 > >  > to check all engines for name clashes.
 > > 
 > > You have to check anyway.  At least if you want to support all
 > > engines.  
 > 
 > I have to know the exact names of the new primitive commands only if
 > I want to use them. To write a package that can be used with all
 > engines without a clash it is enough to know how to avoid the names.
 > That's easy with pdftex: simply don't use commands starting with
 > \pdf. It's also easy with XeTeX: avoid commands starting with
 > \XeTeX. But with luatex you are right. I will have to check
 > everytime a new version is released if there is a conflict.  
 > 
 > > e-TeX provides new primitives, why can't luatex do the same?
 > 
 > Nobody is denying luatex the right to declare new primitives. The
 > only question is if the names of this new primitives should use some
 > namespace.

Hi Ulrike,
I'm not against namespaces.  But since we are talking about
primitives, I think that in this case the gain is not very high.

I'm sure that most clashes happen between different packages, not
between a particular package and the underlying engine(s).  Yes, if
you are using an engine which is still under construction, you have to
check from time to time whether primitives had been renamed or new
ones had been added.  But I assume that LuaTeX becomes more stable
soon.  The idea of LuaTeX is to provide new functionality by Lua code
instead of new primitives.  Maybe some new primitives have to be added
after version 1.0, but thanks to Lua, I expect that the number of them
will be very small.

The LaTeX packages are much more problematic than the engines.  It's
much more work to check all of them, if possible at all.  It would be
more worthwhile to introduce namespaces here.  Some package authors
already made a first attempt.  Unfortunatetly there are no
instructions how a unique prefix should look like.

There had been a discussion about namespaces on the LaTeX-3 mailing
list a few years ago.  It was Hans Aberg who proposed namespaces, if I
remember correctly.  As far as I remember, he had not been able to
convince the LaTeX team.  I don't remember the details.  If you are
interested, dig out the mail archives.

In short:  I'm not against namespaces at all.  But I think they
make more sense in macro packages than in primitives.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From wspr81 at gmail.com  Sat Mar  7 05:13:24 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 7 Mar 2009 14:43:24 +1030
Subject: [luatex] macros to invoke lua in LaTeX
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
	<200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de>
	<18865.51640.724775.78648@zaphod.ms25.net>
Message-ID: <goss93$ru9$1@ger.gmane.org>

On 2009-03-07 11:41:20 +1030, Reinhard Kotucha 
<reinhard.kotucha at web.de> said:

> There had been a discussion about namespaces on the LaTeX-3 mailing
> list a few years ago.  It was Hans Aberg who proposed namespaces, if I
> remember correctly.  As far as I remember, he had not been able to
> convince the LaTeX team.  I don't remember the details.  If you are
> interested, dig out the mail archives.

I haven't been too successful finding the relevant thread. I remember 
Philip Lehman proposed a "poor man's namespace" for packages, but 
that's not really the same thing.

What LaTeX3 does currently is to rename all engine primitives to remove 
them from the user namespace.

E.g.,
  \write -> \tex_write:D
  \protected -> \etex_protected:D
  \pdfstrcmp -> \pdf_strcmp:D

So as far as LaTeX3 is concerned, it doesn't matter what the primitives 
are called :) But that's no help to the problem at hand.

Will



From wspr81 at gmail.com  Sat Mar  7 05:25:22 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 7 Mar 2009 14:55:22 +1030
Subject: [luatex] LuaTeXtra code review
References: <49B169A4.1080806@telecom-bretagne.eu>
	<20090306212433.GA3600@irwin.vpn.uni-freiburg.de>
	<49B19903.9040800@telecom-bretagne.eu>
	<49B1B6C9.6030105@elzevir.fr>
Message-ID: <gossvi$stm$1@ger.gmane.org>

On 2009-03-07 10:20:33 +1030, Manuel P?gouri?-Gonnard 
<mpg at elzevir.fr> said:

> Elie Roux a ?crit :
>> Heiko Oberdiek a ?crit :
>>> \new... is a naming convention of plain.tex/latex.ltx.
>>> attribute, codetable comes from LuaTeX, why not
>>> \newluaattribute and \newluacatcodetable?
>> 
>> Seems logical, but it seems also logical that all primitive start by
>> \lua... I must admit I also prefer \newluaattribute...
> 
> FWIW, I also prefer \newluaattribute. For some reasons, I had problems 
> correctly dividing \luanewattribute into words the first time I saw it.

+1
However, if this is intended to be a programmers macro, maybe you 
should give it a name with @ somewhere. (Otherwise the point of 
renaming the thing diminishes.)

So maybe
  \lua at newattribute
and so on.

Oh wait, this package is supposed to target plain LuaTeX as well, isn't 
it? So maybe using @ isn't the best idea.

Will



From Arno.Trautmann at gmx.de  Sat Mar  7 09:15:23 2009
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 07 Mar 2009 09:15:23 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <goss93$ru9$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>	<20090304123541.GA23524@phare.normalesup.org>	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>	<x27pc7blzmgf.dlg@nililand.de>	<18865.51640.724775.78648@zaphod.ms25.net>
	<goss93$ru9$1@ger.gmane.org>
Message-ID: <49B22D1B.1000208@gmx.de>

Will Robertson wrote:
> On 2009-03-07 11:41:20 +1030, Reinhard Kotucha <reinhard.kotucha at web.de>
> said:
> 
>> There had been a discussion about namespaces on the LaTeX-3 mailing
>> list a few years ago.  It was Hans Aberg who proposed namespaces, if I
>> remember correctly.  As far as I remember, he had not been able to
>> convince the LaTeX team.  I don't remember the details.  If you are
>> interested, dig out the mail archives.
> 
> I haven't been too successful finding the relevant thread. I remember
> Philip Lehman proposed a "poor man's namespace" for packages, but that's
> not really the same thing.
> 
> What LaTeX3 does currently is to rename all engine primitives to remove
> them from the user namespace.
> 
> E.g.,
>  \write -> \tex_write:D
>  \protected -> \etex_protected:D
>  \pdfstrcmp -> \pdf_strcmp:D

Where the ?:D? means ?don?t touch, these are primitives?, for the reader
who is not familiar with LaTeX3. They?re not funny smileys added by Will?

Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090307/4282b4ee/attachment.bin 

From elie.roux at telecom-bretagne.eu  Sat Mar  7 09:57:01 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Mar 2009 09:57:01 +0100
Subject: [luatex] distro-specific lua file?
Message-ID: <49B236DD.4030309@telecom-bretagne.eu>

Hello,

What do you think about a distrib.lua containing all the distro-specific 
stuff? Like name, version and date of the distribution, but also for 
instance the name of the .mem file for luatex-mplib, as it can be any 
and each distro has to decide for one... With Karl we came up with 
luatex-plain.mem. What kind of other things would go in it?
-- 
Elie

From Robin.Fairbairns at cl.cam.ac.uk  Sat Mar  7 10:32:17 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sat, 07 Mar 2009 09:32:17 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Sat, 07 Mar 2009 02:11:20 +0100.
	<18865.51640.724775.78648@zaphod.ms25.net>
Message-ID: <23322.1236418337@cl.cam.ac.uk>

Reinhard Kotucha <reinhard.kotucha at web.de> wrote:

> There had been a discussion about namespaces on the LaTeX-3 mailing
> list a few years ago.  It was Hans Aberg who proposed namespaces, if I
> remember correctly.  As far as I remember, he had not been able to
> convince the LaTeX team.  I don't remember the details.  If you are
> interested, dig out the mail archives.

hans aberg was proposing stuff that seemed to me (at the time)
completely un-implementable.  we have a proposed namespace package for
latex 3, now -- much simpler than i remember aberg's proposal, and (i
think) up to the job.

not that there are many people writing latex 3 packages, just now.

> In short:  I'm not against namespaces at all.  But I think they
> make more sense in macro packages than in primitives.

"namespace" is a rather strong term for what we've been asking for: i
would call it, rather, a naming convention -- just a suggestion for the
structure of names.

i _know_ i'm late to the luatex business (i've done nothing but read
papers since pont-a-mousson), and i've written no luatex code.  so my
feeling is a gut feeling only.  (i'm not even a particularly long-
serving user of tex, having only started in 1987.)  sorry.

robin

From taco at elvenkind.com  Sat Mar  7 11:09:14 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Mar 2009 11:09:14 +0100
Subject: [luatex] distro-specific lua file?
In-Reply-To: <49B236DD.4030309@telecom-bretagne.eu>
References: <49B236DD.4030309@telecom-bretagne.eu>
Message-ID: <49B247CA.9090307@elvenkind.com>

Elie Roux wrote:
> Hello,
> 
> What do you think about a distrib.lua containing all the distro-specific 
> stuff? Like name, version and date of the distribution, but also for 
> instance the name of the .mem file for luatex-mplib, as it can be any 
> and each distro has to decide for one... With Karl we came up with 
> luatex-plain.mem. What kind of other things would go in it?

Sounds like a good idea, but why not name it config.lua then?



From elie.roux at telecom-bretagne.eu  Sat Mar  7 11:11:49 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Mar 2009 11:11:49 +0100
Subject: [luatex] distro-specific lua file?
In-Reply-To: <49B247CA.9090307@elvenkind.com>
References: <49B236DD.4030309@telecom-bretagne.eu>
	<49B247CA.9090307@elvenkind.com>
Message-ID: <49B24865.6010605@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Sounds like a good idea, but why not name it config.lua then?

Good idea, let's go for config.lua.
-- 
Elie


From wspr81 at gmail.com  Sat Mar  7 18:29:11 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 8 Mar 2009 03:59:11 +1030
Subject: [luatex] macros to invoke lua in LaTeX
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<200903032256.n23MuL626402@f7.net>
	<49AE3712.9060808@elvenkind.com> <49AE668A.9080309@elzevir.fr>
	<49AE674A.2050606@elvenkind.com> <49AE6914.5020206@elzevir.fr>
	<20090304123541.GA23524@phare.normalesup.org>
	<200903042331.n24NVGv26173@f7.net> <49AF8B03.1020306@elvenkind.com>
	<d5mbcspvya1y$.dlg@nililand.de> <49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de>
	<18865.51640.724775.78648@zaphod.ms25.net>
	<23322.1236418337@cl.cam.ac.uk>
Message-ID: <gouat8$2um$1@ger.gmane.org>

On 2009-03-07 20:02:17 +1030, Robin Fairbairns 
<Robin.Fairbairns at cl.cam.ac.uk> said:

> (i'm not even a particularly long-
> serving user of tex, having only started in 1987.)

Hmmm, perhaps you don't want to know what *I* was doing in 1987 :)

* * *

Anyway, if the LaTeX team is serious about preventing backwards 
compatibility problems, then we should do things like rename LuaTeX 
primitives into a "namespace" such that older documents won't be 
affected (within reasonable expectations of what naming schemes are 
being used in the wild).

I could imagine a future LaTeX configuration file doing something like 
the following to ensure that documents written for legacy versions of 
LaTeX still compile without problems.

\ifluatex
   \let\formatname\luatex at formatname\let\formatname\@undefined
   ...
\fi

W



From karl at freefriends.org  Sun Mar  8 00:00:19 2009
From: karl at freefriends.org (Karl Berry)
Date: Sat, 7 Mar 2009 17:00:19 -0600
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gouat8$2um$1@ger.gmane.org>
Message-ID: <200903072300.n27N0Jl28111@f7.net>

    Anyway, if the LaTeX team is serious about preventing backwards 
    compatibility problems, then we should do things like rename LuaTeX 
    primitives into a "namespace" 

I agree.  It will certainly cause a lot of confusion in terms of
documentation, etc., but I don't see a better alternative.

And I think the likely-clashing current primitives need to be renamed
now, or any new luatex-using packages will use (are using) the current
names, and we will be completely stuck by the time luatex is widely
deployed -- there will be too many packages.

I don't think the renamed primitives should have @ in the name.  They
aren't necessarily internal, that's an independent issue.  A prefix is
enough.  If some primitives are shared between engines or already have a
prefix, then that is fine, we don't need to blindly prefix everything
with the same string.

I think it should be done for both plain and latex, that is,
(pdf)luatex.fmt and (pdf)lualatex.fmt.

Elie?

karl

P.S. The answer to the various questions of "when does this ever cause a
problem" is simple: any existing latex document that issues the
perfectly reasonable construct \newcommand{\primitive}{...} fails.

From taco at elvenkind.com  Sun Mar  8 00:09:51 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 08 Mar 2009 00:09:51 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <200903072300.n27N0Jl28111@f7.net>
References: <200903072300.n27N0Jl28111@f7.net>
Message-ID: <49B2FEBF.1010004@elvenkind.com>

Karl Berry wrote:
> 
> P.S. The answer to the various questions of "when does this ever cause a
> problem" is simple: any existing latex document that issues the
> perfectly reasonable construct \newcommand{\primitive}{...} fails.

Which nicely demonstrates that LaTeX was designed with a completely
frozen engine in mind (but I'll shut up about it now).

Best wishes,
Taco



From karl at freefriends.org  Sun Mar  8 00:16:34 2009
From: karl at freefriends.org (Karl Berry)
Date: Sat, 7 Mar 2009 17:16:34 -0600
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B2FEBF.1010004@elvenkind.com>
Message-ID: <200903072316.n27NGYZ32002@f7.net>

    Which nicely demonstrates that LaTeX was designed with a completely
    frozen engine in mind

I agree with that statement.  But lacking a time machine, the situation
is what it is: it is not reasonable to ignore the fact that much of the
world's mathematics over the past two decades has been written in LaTeX,
i.e., expect the world to adjust to us.  That would not happen.  What
would happen is that luatex would not be used except by a few hard-core
devotees.  That is not a desirable outcome from my point of view.

From martin at oneiros.de  Sun Mar  8 00:35:14 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 8 Mar 2009 00:35:14 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B2FEBF.1010004@elvenkind.com>
References: <200903072300.n27N0Jl28111@f7.net> <49B2FEBF.1010004@elvenkind.com>
Message-ID: <68c491a60903071535k9530dd3laa3d1444919d8edc@mail.gmail.com>

2009/3/8, Taco Hoekwater <taco at elvenkind.com>:
> > perfectly reasonable construct \newcommand{\primitive}{...} fails.
>
>  Which nicely demonstrates that LaTeX was designed with a completely
>  frozen engine in mind (but I'll shut up about it now).

Yes. But that doesn't mean that \newcommand can't be made more
intelligent.

Best
   Martin

From karl at freefriends.org  Sun Mar  8 00:49:51 2009
From: karl at freefriends.org (Karl Berry)
Date: Sat, 7 Mar 2009 17:49:51 -0600
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <68c491a60903071535k9530dd3laa3d1444919d8edc@mail.gmail.com>
Message-ID: <200903072349.n27Nnpe07895@f7.net>

    Yes. But that doesn't mean that \newcommand can't be made more
    intelligent.

Irrelevant.  You'd have to fix \def, too.

From Robin.Fairbairns at cl.cam.ac.uk  Sun Mar  8 00:52:19 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sat, 07 Mar 2009 23:52:19 +0000
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: Your message of Sun, 08 Mar 2009 00:09:51 +0100.
	<49B2FEBF.1010004@elvenkind.com>
Message-ID: <29854.1236469939@cl.cam.ac.uk>

Taco Hoekwater <taco at elvenkind.com> wrote:

> Karl Berry wrote:
> > P.S. The answer to the various questions of "when does this ever cause a
> > problem" is simple: any existing latex document that issues the
> > perfectly reasonable construct \newcommand{\primitive}{...} fails.
> 
> Which nicely demonstrates that LaTeX was designed with a completely
> frozen engine in mind (but I'll shut up about it now).

latex was, but i don't see how the above demonstrates it.

karl observes that latex allows the user to checks that hir definitions
aren't overwriting some existing "thing".  sure, this can cause problems
when the engine is changed, but the design aimed to avoid clashes of
user macros with packages, etc.

*failure* to detect that the user is in the habit of redefining
 something that the engine (now) provides, is potentially just as (or
 even more) troublesome, imo.   of course, either way, one gets a
 "confused user" message appearing on the support lists...

r

From karl at freefriends.org  Sun Mar  8 03:13:52 2009
From: karl at freefriends.org (Karl Berry)
Date: Sat, 7 Mar 2009 20:13:52 -0600
Subject: [luatex] prefix
Message-ID: <200903080213.n282DqC19477@f7.net>

Whoops, I was wrong about \def.  It doesn't need fixing.  Never mind that.

It is \ifx\someprimitive\undefined that could run into trouble, and I'm
sure that we do not want to "fix" \ifx, even in theory.

Anyway, it seems pointless to go further with imagining problematic cases.
I still don't see a viable alternative to renaming primitives for
achieving compatibility.

From wspr81 at gmail.com  Sun Mar  8 08:09:56 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 8 Mar 2009 17:39:56 +1030
Subject: [luatex] Proposal to fix the namespace argument
Message-ID: <govr04$k7s$1@ger.gmane.org>

Hello,

Yesterday I proposed a tidy way to resolve the tension between nice 
primitive names and problems with processing old documents where these 
new primitives may clash with users' macros.

I'd like to formalise the suggestion:

1.  The LuaTeX team name the primitives whatever they please 
(personally I like the names they've chosen up until now).
2.  The LaTeX team or the TeX Live team maintains a luatexconfig.tex 
file that maps all new LuaTeX primitives to some sort of hidden 
namespace that is accessible by package authors.
3.  Probably Plain should do something similar.

Consequences:

1.  Legacy documents are not affected unless they define macros in 
whatever namespace we choose to hide the LuaTeX primitives. (Let's 
assume this won't happen.)

2.  luatextra.sty (say) will allow package writers and users to access 
the new primitives in some form; either by remapping them back to 
userspace names or with some other scheme.

* * *

Disregarding the details of how we hide the primitive names, what do 
you all think of this plan?

* * *

Is there a comprehensive list of primitives defined by LuaTeX? I've got 
a long list culled from the manual but I'm not sure if I caught them 
all. The list I've got is in the file luatexconfig.tex here:
  <http://github.com/wspr/lualatex/tree/master>

I'll also be writing the code there to perform the namespace switcheroo.

Cheers,
Will



From Arno.Trautmann at gmx.de  Sun Mar  8 10:11:57 2009
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 08 Mar 2009 10:11:57 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <govr04$k7s$1@ger.gmane.org>
References: <govr04$k7s$1@ger.gmane.org>
Message-ID: <49B38BDD.40104@gmx.de>

Will Robertson wrote:
> Hello,
> 
> Yesterday I proposed a tidy way to resolve the tension between nice
> primitive names and problems with processing old documents where these
> new primitives may clash with users' macros.
> 
> I'd like to formalise the suggestion:
> 
> 1.  The LuaTeX team name the primitives whatever they please (personally
> I like the names they've chosen up until now).
> 2.  The LaTeX team or the TeX Live team maintains a luatexconfig.tex
> file that maps all new LuaTeX primitives to some sort of hidden
> namespace that is accessible by package authors.
> 3.  Probably Plain should do something similar.

I think, this is the best solution.

> Consequences:
> 
> 1.  Legacy documents are not affected unless they define macros in
> whatever namespace we choose to hide the LuaTeX primitives. (Let's
> assume this won't happen.)
> 
> 2.  luatextra.sty (say) will allow package writers and users to access
> the new primitives in some form; either by remapping them back to
> userspace names or with some other scheme.
> 
> * * *
> 
> Disregarding the details of how we hide the primitive names, what do you
> all think of this plan?

I like it.

> * * *
> 
> Is there a comprehensive list of primitives defined by LuaTeX? I've got
> a long list culled from the manual but I'm not sure if I caught them
> all. The list I've got is in the file luatexconfig.tex here:
>  <http://github.com/wspr/lualatex/tree/master>

One question: Why the _ as separator? I would have expected an @
instead. Is this already due to LaTeX3? Or just to avoid possible
clashes with package authors?

Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090308/4826b1c5/attachment.bin 

From elie.roux at telecom-bretagne.eu  Sun Mar  8 16:46:29 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 08 Mar 2009 16:46:29 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <govr04$k7s$1@ger.gmane.org>
References: <govr04$k7s$1@ger.gmane.org>
Message-ID: <49B3E855.90006@telecom-bretagne.eu>

Will Robertson a ?crit :
> 1.  The LuaTeX team name the primitives whatever they please 
> (personally I like the names they've chosen up until now).
> 2.  The LaTeX team or the TeX Live team maintains a luatexconfig.tex 
> file that maps all new LuaTeX primitives to some sort of hidden 
> namespace that is accessible by package authors.
> 3.  Probably Plain should do something similar.

I think this solution is good!

> Is there a comprehensive list of primitives defined by LuaTeX? I've 
> got a long list culled from the manual but I'm not sure if I caught 
> them all. The list I've got is in the file luatexconfig.tex here:
>  <http://github.com/wspr/lualatex/tree/master>
>
> I'll also be writing the code there to perform the namespace switcheroo.

Ok.

Thank you!
-- 
Elie


From elie.roux at telecom-bretagne.eu  Sun Mar  8 17:41:59 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 08 Mar 2009 17:41:59 +0100
Subject: [luatex] manual update
Message-ID: <49B3F557.8060306@telecom-bretagne.eu>

The manual reads:

There is no synctex support yet (planned for 0.30)

As the current version is 0.35, I think the manual needs a small update...

Thank you in advance,
-- 
Elie

From mpg at elzevir.fr  Sun Mar  8 18:18:46 2009
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 08 Mar 2009 18:18:46 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <gouat8$2um$1@ger.gmane.org>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<200903032256.n23MuL626402@f7.net>	<49AE3712.9060808@elvenkind.com>
	<49AE668A.9080309@elzevir.fr>	<49AE674A.2050606@elvenkind.com>
	<49AE6914.5020206@elzevir.fr>	<20090304123541.GA23524@phare.normalesup.org>	<200903042331.n24NVGv26173@f7.net>
	<49AF8B03.1020306@elvenkind.com>	<d5mbcspvya1y$.dlg@nililand.de>
	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>	<x27pc7blzmgf.dlg@nililand.de>	<18865.51640.724775.78648@zaphod.ms25.net>	<23322.1236418337@cl.cam.ac.uk>
	<gouat8$2um$1@ger.gmane.org>
Message-ID: <49B3FDF6.9010508@elzevir.fr>

Will Robertson a ?crit :
> On 2009-03-07 20:02:17 +1030, Robin Fairbairns
> <Robin.Fairbairns at cl.cam.ac.uk> said:
> 
>> (i'm not even a particularly long-
>> serving user of tex, having only started in 1987.)
> 
> Hmmm, perhaps you don't want to know what *I* was doing in 1987 :)
> 
IIRC, I was finishing learning how to read in 87...

Manuel.



From elie.roux at telecom-bretagne.eu  Sun Mar  8 18:26:44 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 08 Mar 2009 18:26:44 +0100
Subject: [luatex] name for the package for otf support in LuaLaTeX
Message-ID: <49B3FFD4.6060809@telecom-bretagne.eu>

Hello,

I'm planning to build a simple package for LuaTeX to basically support 
OTF, so that it's (potentially) available in TL2009 event if we don't 
have time to work on a true otf support... As names are pretty 
important, I'm asking here how it should be called...

Is luaotf ok for everyone?
-- 
Elie

From mpg at elzevir.fr  Sun Mar  8 18:28:56 2009
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 08 Mar 2009 18:28:56 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <49B38BDD.40104@gmx.de>
References: <govr04$k7s$1@ger.gmane.org> <49B38BDD.40104@gmx.de>
Message-ID: <49B40058.4060305@elzevir.fr>

Arno Trautmann a ?crit :
>> 1.  The LuaTeX team name the primitives whatever they please (personally
>> I like the names they've chosen up until now).
>> 2.  The LaTeX team or the TeX Live team maintains a luatexconfig.tex
>> file that maps all new LuaTeX primitives to some sort of hidden
>> namespace that is accessible by package authors.
>> 3.  Probably Plain should do something similar.
> 
> I think, this is the best solution.
> 
So do I.

>> Is there a comprehensive list of primitives defined by LuaTeX? I've got
>> a long list culled from the manual but I'm not sure if I caught them
>> all. The list I've got is in the file luatexconfig.tex here:
>>  <http://github.com/wspr/lualatex/tree/master>
> 
> One question: Why the _ as separator?

I have a more general question: why a separator?  Why not just using a prefix
but keeping the new name usable with "normal" catcodes?  It would be coherent
with current primitive names, and "agnostic" concerning expl3 vs LaTeX2e.

I think it's best to separate clearly the two folowing goals:
1. Implement a namespace system in order to avoid clashes, which should be done
in your proposed luatexconfig.tex.
2. Hide primitives from the user, which should be left to expl3 or whatever
macro package.

Manuel.


From elie.roux at telecom-bretagne.eu  Sun Mar  8 20:00:29 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 08 Mar 2009 20:00:29 +0100
Subject: [luatex] name for the package for otf support in LuaLaTeX
In-Reply-To: <49B3FFD4.6060809@telecom-bretagne.eu>
References: <49B3FFD4.6060809@telecom-bretagne.eu>
Message-ID: <49B415CD.8060805@telecom-bretagne.eu>

Elie Roux a ?crit :
> Is luaotf ok for everyone?

After a private mail, it seems that luaminimalotf would be better to 
avoid confusion...
-- 
Elie

From wspr81 at gmail.com  Mon Mar  9 02:15:36 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 9 Mar 2009 11:45:36 +1030
Subject: [luatex] Proposal to fix the namespace argument
References: <govr04$k7s$1@ger.gmane.org> <49B38BDD.40104@gmx.de>
	<49B40058.4060305@elzevir.fr>
Message-ID: <gp1qjo$mn3$1@ger.gmane.org>

On 2009-03-09 03:58:56 +1030, Manuel P?gouri?-Gonnard 
<mpg at elzevir.fr> said:
> 
> I have a more general question: why a separator?  Why not just using a prefix
> but keeping the new name usable with "normal" catcodes?  It would be coherent
> with current primitive names, and "agnostic" concerning expl3 vs LaTeX2e.
> 
> I think it's best to separate clearly the two folowing goals:
> 1. Implement a namespace system in order to avoid clashes, which should 
> be done in your proposed luatexconfig.tex.
> 2. Hide primitives from the user, which should be left to expl3 or whatever
> macro package.

I was originally thinking that if the names were remapping into the 
user namespace (with \LuaTeXattribute and so on) there'd still be the 
(admittedly much smaller) chance that there could be a name clash. 
Hence the original use of a char that isn't used in LaTeX2e (the fact 
that I chose _ which is also used by LaTeX3 should be ignored :) ).

I've now changed my mind. At this stage I've prefixed all primitives 
with "LuaTeX" (in keeping with the "XeTeX" prefix). So there's no 
proposed "hiding" any more.

Karl, what do you think of all this? (I assume Taco et al. approve :) )

Will



From yuleopen at gmail.com  Mon Mar  9 02:44:24 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 9 Mar 2009 09:44:24 +0800
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <49B3FDF6.9010508@elzevir.fr>
References: <49ADA1DF.7010407@telecom-bretagne.eu>
	<49AFE570.3080903@elvenkind.com>
	<18864.19767.613869.152787@zaphod.ms25.net>
	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>
	<18864.27029.891426.734156@zaphod.ms25.net>
	<x27pc7blzmgf.dlg@nililand.de>
	<18865.51640.724775.78648@zaphod.ms25.net>
	<23322.1236418337@cl.cam.ac.uk> <gouat8$2um$1@ger.gmane.org>
	<49B3FDF6.9010508@elzevir.fr>
Message-ID: <68bfdc900903081844h7e04cfb7r8cd5f2c8c11fd405@mail.gmail.com>

On Mon, Mar 9, 2009 at 1:18 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Will Robertson a ?crit :
>> On 2009-03-07 20:02:17 +1030, Robin Fairbairns
>> <Robin.Fairbairns at cl.cam.ac.uk> said:
>>
>>> (i'm not even a particularly long-
>>> serving user of tex, having only started in 1987.)
>>
>> Hmmm, perhaps you don't want to know what *I* was doing in 1987 :)
>>
> IIRC, I was finishing learning how to read in 87...
>

I was born in 1987.....

> Manuel.
>
>
>

From pragma at wxs.nl  Mon Mar  9 09:14:42 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 09 Mar 2009 09:14:42 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <gp1qjo$mn3$1@ger.gmane.org>
References: <govr04$k7s$1@ger.gmane.org>
	<49B38BDD.40104@gmx.de>	<49B40058.4060305@elzevir.fr>
	<gp1qjo$mn3$1@ger.gmane.org>
Message-ID: <49B4CFF2.6010501@wxs.nl>

Will Robertson wrote:
> On 2009-03-09 03:58:56 +1030, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> 
> said:
>>
>> I have a more general question: why a separator?  Why not just using a 
>> prefix
>> but keeping the new name usable with "normal" catcodes?  It would be 
>> coherent
>> with current primitive names, and "agnostic" concerning expl3 vs LaTeX2e.
>>
>> I think it's best to separate clearly the two folowing goals:
>> 1. Implement a namespace system in order to avoid clashes, which 
>> should be done in your proposed luatexconfig.tex.
>> 2. Hide primitives from the user, which should be left to expl3 or 
>> whatever
>> macro package.
> 
> I was originally thinking that if the names were remapping into the user 
> namespace (with \LuaTeXattribute and so on) there'd still be the 
> (admittedly much smaller) chance that there could be a name clash. Hence 
> the original use of a char that isn't used in LaTeX2e (the fact that I 
> chose _ which is also used by LaTeX3 should be ignored :) ).

you could have chosen a weird character from unicode -)

> I've now changed my mind. At this stage I've prefixed all primitives 
> with "LuaTeX" (in keeping with the "XeTeX" prefix). So there's no 
> proposed "hiding" any more.
> 
> Karl, what do you think of all this? (I assume Taco et al. approve :) )

there not much to disapprove as it does not related to luatex 
development directly but to latex development (apart from the fact that 
one needs to update the list when luatex provides more primitives or 
changes their names)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Mar  9 10:00:51 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 09 Mar 2009 10:00:51 +0100
Subject: [luatex] manual update
In-Reply-To: <49B3F557.8060306@telecom-bretagne.eu>
References: <49B3F557.8060306@telecom-bretagne.eu>
Message-ID: <49B4DAC3.4010600@elvenkind.com>



Elie Roux wrote:
> The manual reads:
> 
> There is no synctex support yet (planned for 0.30)
> 
> As the current version is 0.35, I think the manual needs a small update...

Thanks, will fix the manual (there are some other changed needed in
those "Changes" sections also).

Taco

From Arno.Trautmann at gmx.de  Mon Mar  9 10:22:31 2009
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Mon, 09 Mar 2009 10:22:31 +0100
Subject: [luatex] macros to invoke lua in LaTeX
In-Reply-To: <68bfdc900903081844h7e04cfb7r8cd5f2c8c11fd405@mail.gmail.com>
References: <49ADA1DF.7010407@telecom-bretagne.eu>	<49AFE570.3080903@elvenkind.com>	<18864.19767.613869.152787@zaphod.ms25.net>	<20090305223754.GA31979@irwin.vpn.uni-freiburg.de>	<18864.27029.891426.734156@zaphod.ms25.net>	<x27pc7blzmgf.dlg@nililand.de>	<18865.51640.724775.78648@zaphod.ms25.net>	<23322.1236418337@cl.cam.ac.uk>
	<gouat8$2um$1@ger.gmane.org>	<49B3FDF6.9010508@elzevir.fr>
	<68bfdc900903081844h7e04cfb7r8cd5f2c8c11fd405@mail.gmail.com>
Message-ID: <49B4DFD7.60108@gmx.de>

Yue Wang wrote:
> On Mon, Mar 9, 2009 at 1:18 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
>> Will Robertson a ?crit :
>>> On 2009-03-07 20:02:17 +1030, Robin Fairbairns
>>> <Robin.Fairbairns at cl.cam.ac.uk> said:
>>>
>>>> (i'm not even a particularly long-
>>>> serving user of tex, having only started in 1987.)
>>> Hmmm, perhaps you don't want to know what *I* was doing in 1987 :)
>>>
>> IIRC, I was finishing learning how to read in 87...
>>
> 
> I was born in 1987.....

Me too. Good to know I?m not ?alone? ;)

Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090309/b1b863c8/attachment.bin 

From wspr81 at gmail.com  Mon Mar  9 11:07:41 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 9 Mar 2009 20:37:41 +1030
Subject: [luatex] Proposal to fix the namespace argument
References: <govr04$k7s$1@ger.gmane.org> <49B38BDD.40104@gmx.de>
	<49B40058.4060305@elzevir.fr> <gp1qjo$mn3$1@ger.gmane.org>
	<49B4CFF2.6010501@wxs.nl>
Message-ID: <gp2ppd$p8u$1@ger.gmane.org>

On 2009-03-09 18:44:42 +1030, Hans Hagen 
<pragma at wxs.nl> said:
> 
> (apart from the fact that one needs to update the list when luatex 
> provides more primitives or changes their names)

That's why I was hoping (perhaps as part of the source for the manual?) 
it would be possible to automatically obtain a list of primitives... :)

Will



From elie.roux at telecom-bretagne.eu  Mon Mar  9 11:12:24 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Mar 2009 11:12:24 +0100
Subject: [luatex] more package names...
Message-ID: <49B4EB88.4000202@telecom-bretagne.eu>

Hello,

I'm going to split the current luainputenc between two packages: the one 
only for backward compatibility, that will be called by inputenc and use 
a fake utf8, and another one that really translates different encodings 
into a true utf8. The second will certainly have some macros like XeTeX 
has, to change the encoding in different files.

I can't find good names for those two packages, as I think we should 
keep a parallel with XeTeX... What do you think about

luainputenc for the first
luaencodings for the second

luainputenccompat for the first
luainputenc for the second

?

Also for the package containing LuaTeX configuration (like the name of 
the distrib and some file names), would luatexconfig be ok, or is 
luaconfig better? It will be automatically loaded by luatextra.
-- 
Elie

From taco at elvenkind.com  Mon Mar  9 11:41:24 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 09 Mar 2009 11:41:24 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <gp2ppd$p8u$1@ger.gmane.org>
References: <govr04$k7s$1@ger.gmane.org>
	<49B38BDD.40104@gmx.de>	<49B40058.4060305@elzevir.fr>
	<gp1qjo$mn3$1@ger.gmane.org>	<49B4CFF2.6010501@wxs.nl>
	<gp2ppd$p8u$1@ger.gmane.org>
Message-ID: <49B4F254.2020500@elvenkind.com>



Will Robertson wrote:
> On 2009-03-09 18:44:42 +1030, Hans Hagen <pragma at wxs.nl> said:
>>
>> (apart from the fact that one needs to update the list when luatex
>> provides more primitives or changes their names)
> 
> That's why I was hoping (perhaps as part of the source for the manual?)
> it would be possible to automatically obtain a list of primitives... :)

Oh, that request makes perfect sense.

The next beta will have the lua function

  tex.primitives()

which outputs a table of "name, token" pairs. While waiting for that,
I will generate a list of current new primives compared to pdftex+aleph
and post the results shortly.

Best wishes,
Taco




From taco at elvenkind.com  Mon Mar  9 12:05:10 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 09 Mar 2009 12:05:10 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <49B4F254.2020500@elvenkind.com>
References: <govr04$k7s$1@ger.gmane.org>	<49B38BDD.40104@gmx.de>	<49B40058.4060305@elzevir.fr>	<gp1qjo$mn3$1@ger.gmane.org>	<49B4CFF2.6010501@wxs.nl>	<gp2ppd$p8u$1@ger.gmane.org>
	<49B4F254.2020500@elvenkind.com>
Message-ID: <49B4F7E6.608@elvenkind.com>



Taco Hoekwater wrote:
> I will generate a list of current new primives compared to pdftex+aleph
> and post the results shortly.

And here it is:

\UmathXXXXXXspacing  % 64 of these, for the 8x8 array formed by
                     % bin,close,inner,open,op,ord,punct,rel
\Udelcode
\Udelcodenum
\Udelimiter
\Umathaccent
\Umathaccents
\Umathaxis
\Umathbotaccent
\Umathchar
\Umathchardef
\Umathcharnum
\Umathcode
\Umathcodenum
\Umathconnectoroverlapmin
\Umathfractiondelsize
\Umathfractiondenomdown
\Umathfractiondenomvgap
\Umathfractionnumup
\Umathfractionnumvgap
\Umathfractionrule
\Umathlimitabovebgap
\Umathlimitabovekern
\Umathlimitabovevgap
\Umathlimitdownbgap
\Umathlimitdownkern
\Umathlimitdownvgap
\Umathoperatorsize
\Umathoverbarkern
\Umathoverbarrule
\Umathoverbarvgap
\Umathoverdelimiterbgap
\Umathoverdelimitervgap
\Umathquad
\Umathradicaldegreeafter
\Umathradicaldegreebefore
\Umathradicaldegreeraise
\Umathradicalkern
\Umathradicalrule
\Umathradicalvgap
\Umathspaceafterscript
\Umathstackdenomdown
\Umathstacknumup
\Umathstackvgap
\Umathsubshiftdown
\Umathsubshiftdrop
\Umathsubsupshiftdown
\Umathsubsupvgap
\Umathsubtopmax
\Umathsupbottommin
\Umathsupshiftdrop
\Umathsupshiftup
\Umathsupsubbottommax
\Umathunderbarkern
\Umathunderbarrule
\Umathunderbarvgap
\Umathunderdelimiterbgap
\Umathunderdelimitervgap
\Uoverdelimiter
\Uradical
\Uroot
\Uunderdelimiter
\attribute
\attributedef
\catcodetable
\charic
\clearmarks
\closelua
\crampeddisplaystyle
\crampedscriptscriptstyle
\crampedscriptstyle
\crampedtextstyle
\directlua
\exhyphenchar
\formatname
\ifabsdim
\ifabsnum
\ifprimitive
\initcatcodetable
\latelua
\luaescapestring
\luastartup
\luatexdatestamp
\luatexrevision
\luatexversion
\nokerns
\noligs
\pageleftoffset
\pagetopoffset
\pdfreplacefont
\postexhyphenchar
\posthyphenchar
\preexhyphenchar
\prehyphenchar
\primitive
\savecatcodetable
\scantextokens


Best wishes,

From wspr81 at gmail.com  Mon Mar  9 12:43:40 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 9 Mar 2009 22:13:40 +1030
Subject: [luatex] Proposal to fix the namespace argument
References: <govr04$k7s$1@ger.gmane.org> <49B38BDD.40104@gmx.de>
	<49B40058.4060305@elzevir.fr> <gp1qjo$mn3$1@ger.gmane.org>
	<49B4CFF2.6010501@wxs.nl> <gp2ppd$p8u$1@ger.gmane.org>
	<49B4F254.2020500@elvenkind.com> <49B4F7E6.608@elvenkind.com>
Message-ID: <gp2vdc$bmb$1@ger.gmane.org>

On 2009-03-09 21:35:10 +1030, Taco Hoekwater 
<taco at elvenkind.com> said:

> Taco Hoekwater wrote:
>> I will generate a list of current new primives compared to pdftex+aleph
>> and post the results shortly.
> 
> And here it is:

That's great, thank you very much!

Best wishes,
Will



From pragma at wxs.nl  Mon Mar  9 13:33:43 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 09 Mar 2009 13:33:43 +0100
Subject: [luatex] more package names...
In-Reply-To: <49B4EB88.4000202@telecom-bretagne.eu>
References: <49B4EB88.4000202@telecom-bretagne.eu>
Message-ID: <49B50CA7.6070001@wxs.nl>

Elie Roux wrote:
> Hello,
> 
> I'm going to split the current luainputenc between two packages: the one 
> only for backward compatibility, that will be called by inputenc and use 
> a fake utf8, and another one that really translates different encodings 
> into a true utf8. The second will certainly have some macros like XeTeX 
> has, to change the encoding in different files.
> 
> I can't find good names for those two packages, as I think we should 
> keep a parallel with XeTeX... What do you think about
> 
> luainputenc for the first
> luaencodings for the second
> 
> luainputenccompat for the first
> luainputenc for the second
> 
> ?
> 
> Also for the package containing LuaTeX configuration (like the name of 
> the distrib and some file names), would luatexconfig be ok, or is 
> luaconfig better? It will be automatically loaded by luatextra.

i assume that all these files lives in the latex tds namespace

Hans

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Mar  9 13:39:50 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 09 Mar 2009 13:39:50 +0100
Subject: [luatex] more package names...
In-Reply-To: <49B50CA7.6070001@wxs.nl>
References: <49B4EB88.4000202@telecom-bretagne.eu> <49B50CA7.6070001@wxs.nl>
Message-ID: <49B50E16.9060207@elvenkind.com>

Hans Hagen wrote:
>> Also for the package containing LuaTeX configuration (like the name of 
>> the distrib and some file names), would luatexconfig be ok, or is 
>> luaconfig better? It will be automatically loaded by luatextra.
> 
> i assume that all these files lives in the latex tds namespace

Just I case we run into the unique filename problem again:
context already ships lua files with the following name patterns
(using msdos-style wildcards):

   ????-*.lua
   ?-*.lua
   mtx-*.lua

as well as the actual scripts luatools.lua and mtxrun.lua

Best wishes,
Taco





From wspr81 at gmail.com  Mon Mar  9 13:48:15 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 9 Mar 2009 23:18:15 +1030
Subject: [luatex] more package names...
References: <49B4EB88.4000202@telecom-bretagne.eu>
Message-ID: <gp336f$nqj$1@ger.gmane.org>

On 2009-03-09 20:42:24 +1030, Elie Roux 
<elie.roux at telecom-bretagne.eu> said:

> I'm going to split the current luainputenc between two packages: the 
> one only for backward compatibility, that will be called by inputenc 
> and use a fake utf8, and another one that really translates different 
> encodings into a true utf8. The second will certainly have some macros 
> like XeTeX has, to change the encoding in different files.
> 
> I can't find good names for those two packages, as I think we should 
> keep a parallel with XeTeX... What do you think about
> 
> luainputenc for the first
> luaencodings for the second
> 
> luainputenccompat for the first
> luainputenc for the second
> 
> ?

I don't know enough about the situation, sorry. Seems like the second 
makes a little more sense to me but...I'm not really sure.

> Also for the package containing LuaTeX configuration (like the name of 
> the distrib and some file names), would luatexconfig be ok, or is 
> luaconfig better? It will be automatically loaded by luatextra.

Do you mean my file luatexconfig.tex? That won't be input by luatextra, 
it will be loaded by the (pdf)lualatex.ini file when the formats are 
generated. I just chose luatexconfig.tex as a name because of 
pdftexconfig.tex.

Cheers,
Will







From elie.roux at telecom-bretagne.eu  Mon Mar  9 14:55:27 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Mar 2009 14:55:27 +0100
Subject: [luatex] more package names...
In-Reply-To: <49B50E16.9060207@elvenkind.com>
References: <49B4EB88.4000202@telecom-bretagne.eu> <49B50CA7.6070001@wxs.nl>
	<49B50E16.9060207@elvenkind.com>
Message-ID: <49B51FCF.3020204@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Just I case we run into the unique filename problem again:
> context already ships lua files with the following name patterns
> (using msdos-style wildcards):
>
>   ????-*.lua
>   ?-*.lua
>   mtx-*.lua

For now, all the files I have are

lua*.lua

I think I'll keep things this way...
-- 
Elie

From elie.roux at telecom-bretagne.eu  Mon Mar  9 14:58:46 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Mar 2009 14:58:46 +0100
Subject: [luatex] more package names...
In-Reply-To: <gp336f$nqj$1@ger.gmane.org>
References: <49B4EB88.4000202@telecom-bretagne.eu> <gp336f$nqj$1@ger.gmane.org>
Message-ID: <49B52096.9080402@telecom-bretagne.eu>

Will Robertson a ?crit :
> Do you mean my file luatexconfig.tex? That won't be input by 
> luatextra, it will be loaded by the (pdf)lualatex.ini file when the 
> formats are generated. I just chose luatexconfig.tex as a name because 
> of pdftexconfig.tex.


No I meant a file containing all the distro-specific stuff... I was 
thinking about it because with Karl we decided the .mem file used by 
LuaTeX + mplib will be named luatex-plain.mem, which is not obvious for 
everyone (there is no default name for this file). For package that will 
use it, I thought maybe a luaconfig package loaded by luatextra would be 
good... Or maybe I should integrate it in luatextra, in another table?
-- 
Elie

From wspr81 at gmail.com  Mon Mar  9 15:09:07 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 10 Mar 2009 00:39:07 +1030
Subject: [luatex] more package names...
References: <49B4EB88.4000202@telecom-bretagne.eu> <gp336f$nqj$1@ger.gmane.org>
	<49B52096.9080402@telecom-bretagne.eu>
Message-ID: <gp37u3$9d4$1@ger.gmane.org>

Hi Elie,

On 2009-03-10 00:28:46 +1030, Elie Roux 
<elie.roux at telecom-bretagne.eu> said:

> Will Robertson a ?crit :
>> Do you mean my file luatexconfig.tex? That won't be input by luatextra, 
>> it will be loaded by the (pdf)lualatex.ini file when the formats are 
>> generated. I just chose luatexconfig.tex as a name because of 
>> pdftexconfig.tex.
> 
> 
> No I meant a file containing all the distro-specific stuff...

Okay, sorry.

>  I was thinking about it because with Karl we decided the .mem file 
> used by LuaTeX + mplib will be named luatex-plain.mem, which is not 
> obvious for everyone (there is no default name for this file). For 
> package that will use it, I thought maybe a luaconfig package loaded by 
> luatextra would be good... Or maybe I should integrate it in luatextra, 
> in another table?

I reckon just go with whatever strikes your fancy at this stage, and if 
there are conflicts or difficulties they'll become obvious in time :) 
Follow the lead of the LuaTeX team and don't worry about a couple of 
changes at this early time. It's inevitable for evolving software.

Will



From taco at elvenkind.com  Mon Mar  9 15:27:34 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 09 Mar 2009 15:27:34 +0100
Subject: [luatex] Luatex primitive names
Message-ID: <49B52756.1090402@elvenkind.com>


Hi all,

After all the recent discussion, Hartmut, Hans and myself have been
emailing about primitives and namespaces and such, and we believe we
have come up with an extensible solution. Here is our plan on how
to handle this in luatex 0.40 and onwards:



First, there will be a new lua function tex.primitives(), as I wrote
in my earlier email. It optionally takes a list of keywords as argument
that select various sets of primitives to list (instead of everything,
which is the default). These are the keywords and meanings:

 'etex'   -- the list of primitives etex 2.2 offered on top of tex82
 'pdftex' -- non-etex primitives pdftex 1.40 offered on top of tex82
 'omega'  -- non-etex primitives aleph rc4 offered on top of tex82
 'luatex' -- primitives luatex itself offers on top of tex82

For example

  tex.primitives ('etex', 'omega')  -- this would be aleph's list
                                    -- of new primitives

  tex.primitives ('etex', 'pdftex') -- and this is pdfetex

  tex.primitives ()                 -- this is the whole lot:
                                    -- all non-TeX82 primitives

The names returned are the ones documented in the various reference
manuals (as strings, not leading backslash).



Second, there will be a new lua function called tex.enableprimitives(),
which takes two arguments. The first argument is a prefix string, and
the second an array of names.

For each combination of prefix and name, the tex.enableprimitives()
function first verifies that <name> is one of the new, non-tex82
commands (it must be returned by one of the tex.primitives() calls
explained above). If not, it does nothing and skips to the next pair.

Otherwise, it will contruct a csname variable by concatenating the
<prefix> and the <name>, unless the <prefix> is already the actual
prefix of <name>. In the latter case, it will discard the <prefix>,
and just use <name>.

Then it will then check for the existence of the constructed csname.
If the csname is currently undefined (note: that is not the same
as \relax), then it will globally define the csname to have the meaning:
run code belonging to the primitive <name>. If for some reason the
csname is already defined, it does nothing and tries the next pair.

An example:
	
  tex.enableprimitives('LuaTeX', {'formatname'})

will define \LuaTeXformatname with the same intrinsic meaning as
the current primitive \formatname, provided that \LuaTeXformatname
is currently undefined.

Second example:

  tex.enableprimitives('Omega',tex.primitives ('omega'))

will define a whole series of csnames like \Omegatextdir,
\Omegapardir, etc., but it will stick with \OmegaVersion instead of
creating the doubly-prefixed \OmegaOmegaVersion.


Third (and this is why the above two functions are needed) starting
with version 0.40, luatex in --ini mode will contain only the tex82
primitives and \directlua, no extra primitives *at all*.

So, if you want to have all the new functionality available using
their default names, as it is now, you will have to add

  \expandafter\ifx\csname directlua\endcsname \relax \else
     \directlua {tex.enableprimitives('',tex.primitives ())}
  \fi

near the beginning of your format generation file. Or you can choose
different prefixes for different subsets, as you see fit.

Calling some form of tex.enableprimitives() is highly important though,
because if you don't, you will end up with a tex82-lookalike that can
run lua code but not do much else. The defined csnames are (of course)
saved in the format and will be available runtime.



We trust this solution is flexible enough to accomodate everyones
wishes, but if there are any comments, please give them now rather than
later. Once 0.40 is out, we don't want to have to go back to this topic.

Best wishes,
Taco





From wspr81 at gmail.com  Mon Mar  9 15:49:51 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 10 Mar 2009 01:19:51 +1030
Subject: [luatex] Luatex primitive names
References: <49B52756.1090402@elvenkind.com>
Message-ID: <gp3aag$ht6$1@ger.gmane.org>

On 2009-03-10 00:57:34 +1030, Taco Hoekwater 
<taco at elvenkind.com> said:

> We trust this solution is flexible enough to accomodate everyones
> wishes, but if there are any comments, please give them now rather than
> later. Once 0.40 is out, we don't want to have to go back to this topic.

Flexible enough and more, I'd say. Thanks for the elegant solution; 
very nice idea.

Will



From arthur.reutenauer at normalesup.org  Mon Mar  9 15:54:33 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 9 Mar 2009 15:54:33 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B52756.1090402@elvenkind.com>
References: <49B52756.1090402@elvenkind.com>
Message-ID: <20090309145433.GC6333@phare.normalesup.org>

	Hello,

> After all the recent discussion, Hartmut, Hans and myself have been
> emailing about primitives and namespaces and such, and we believe we
> have come up with an extensible solution.

  Your solution sounds excellent, and seems to solve all the issues that
have been raised.

> Third (and this is why the above two functions are needed) starting
> with version 0.40, luatex in --ini mode will contain only the tex82
> primitives and \directlua, no extra primitives *at all*.

  We'd have kind of a boostrap problem if \directlua wasn't included ;-)

	Arthur

From arthur.reutenauer at normalesup.org  Mon Mar  9 15:58:17 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 9 Mar 2009 15:58:17 +0100
Subject: [luatex] more package names...
In-Reply-To: <gp37u3$9d4$1@ger.gmane.org>
References: <49B4EB88.4000202@telecom-bretagne.eu> <gp336f$nqj$1@ger.gmane.org>
	<49B52096.9080402@telecom-bretagne.eu> <gp37u3$9d4$1@ger.gmane.org>
Message-ID: <20090309145817.GD6333@phare.normalesup.org>

> I reckon just go with whatever strikes your fancy at this stage, and if 
> there are conflicts or difficulties they'll become obvious in time :) 
> Follow the lead of the LuaTeX team and don't worry about a couple of 
> changes at this early time. It's inevitable for evolving software.

  Agreed.  It's important to choose good names, but you shouldn't spend
too much time on it either.

	Arthur

From pragma at wxs.nl  Mon Mar  9 16:06:00 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 09 Mar 2009 16:06:00 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090309145433.GC6333@phare.normalesup.org>
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org>
Message-ID: <49B53058.4040405@wxs.nl>

Arthur Reutenauer wrote:
> 	Hello,
> 
>> After all the recent discussion, Hartmut, Hans and myself have been
>> emailing about primitives and namespaces and such, and we believe we
>> have come up with an extensible solution.
> 
>   Your solution sounds excellent, and seems to solve all the issues that
> have been raised.
> 
>> Third (and this is why the above two functions are needed) starting
>> with version 0.40, luatex in --ini mode will contain only the tex82
>> primitives and \directlua, no extra primitives *at all*.
> 
>   We'd have kind of a boostrap problem if \directlua wasn't included ;-)

that's why only that one is there (and not even \luatexversion)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From karl at freefriends.org  Mon Mar  9 23:32:41 2009
From: karl at freefriends.org (Karl Berry)
Date: Mon, 9 Mar 2009 17:32:41 -0500
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <govr04$k7s$1@ger.gmane.org>
Message-ID: <200903092232.n29MWfY23850@f7.net>

Thank you very much, Taco/Hans/Hartmut.  That is great.

So given these new features, I think for (pdf)lualatex in TL'09 we
should remap at least the non-prefixed primitives to \LaTeX.  (I guess.)
I'm not sure if we should remap the ones that already include "lua" or
start with \U.  I don't see a great need to do so.

For plain, though, I think it's not necessary.  After all, we're not
going to change "tex" itself (ever), and etex/pdftex/etc. will continue
to invoke pdftex in TL'09.  (When and if that ever changes, we
could/should change the ini files to hide the luatex primitives for
those fmt's.)

So for TL'09, the only way that users can invoke plain-with-luatex is by
"luatex" or "pdfluatex".  It seems reasonable to me for those programs
to expose native luatex (whatever it happens to be), with no remapping.

Thoughts?

Reminder to self: we should also communicate our plans, when they are
settled, to Christian.  It would be disastrous if MiKTeX and TL did
different things here.

From wspr81 at gmail.com  Tue Mar 10 00:19:17 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 10 Mar 2009 09:49:17 +1030
Subject: [luatex] Proposal to fix the namespace argument
References: <govr04$k7s$1@ger.gmane.org> <200903092232.n29MWfY23850@f7.net>
Message-ID: <gp485m$3hm$1@ger.gmane.org>

On 2009-03-10 09:02:41 +1030, 
karl at freefriends.org (Karl Berry) said:

> So given these new features, I think for (pdf)lualatex in TL'09 we
> should remap at least the non-prefixed primitives to \LaTeX.  (I guess.)
> I'm not sure if we should remap the ones that already include "lua" or
> start with \U.  I don't see a great need to do so.

I'd add the prefix to them all; there's a primitive called \Uroot which 
is short enough to conceivably exist in a document somewhere.

> For plain, though, I think it's not necessary.  After all, we're not
> going to change "tex" itself (ever), and etex/pdftex/etc. will continue
> to invoke pdftex in TL'09.  (When and if that ever changes, we
> could/should change the ini files to hide the luatex primitives for
> those fmt's.)

(Thinking out loud here.) Under this philosophy, wouldn't it make sense 
for (pdf)lualatex to continue to enable the LuaTeX primitives in LaTeX? 
And then remove the primitives only if/when LuaTeX becomes the engine 
for (pdf)latex itself?

Well, I can see how that would be annoying for package authors :) It 
could work if we write an "enable LuaTeX primitives" package (which 
would probably be Elie's luatextra), which would do nothing under 
"lualatex" but activate all the primitives when using "latex" running 
with LuaTeX.

No, I think it's more sensible (unless I've somehow managed to change 
your mind above) to stay with your original plan of deactivating all 
primitives even in lualatex -- but only if you think that there's a 
possibility one day of it becoming the default engine. (Which is kind 
of the point of the whole discussion.)

> So for TL'09, the only way that users can invoke plain-with-luatex is by
> "luatex" or "pdfluatex".  It seems reasonable to me for those programs
> to expose native luatex (whatever it happens to be), with no remapping.

That makes sense to me.
Good plan!

Will



From mpg at elzevir.fr  Mon Mar  9 19:03:03 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 09 Mar 2009 19:03:03 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B53058.4040405@wxs.nl>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>
	<49B53058.4040405@wxs.nl>
Message-ID: <49B559D7.6000701@elzevir.fr>

Hans Hagen a ?crit :
>>> Third (and this is why the above two functions are needed) starting
>>> with version 0.40, luatex in --ini mode will contain only the tex82
>>> primitives and \directlua, no extra primitives *at all*.
>>
>>   We'd have kind of a boostrap problem if \directlua wasn't included ;-)
> 
> that's why only that one is there (and not even \luatexversion)
> 
Btw, extra care should be taken while writing code that should be portable:
- across different version of LuaTeX
- across different TeX engines.

Before this, as a macro writer, my preferred way of detecting the underlying
engine would probably have been testing whether \luatexversion is defined. Now
I'd rather test for \directlua. *But* if some day Jonathan include Lua as a
scripting language in XeTeX, things will be more complicated.

Also, if I want to test for the LuaTeX version in order to know whether I should
use \directlua0 or \directlua, it is a bit complicated. I guess there is a
solution (no time to find it and write down the code right now) but anyway my
point is:

I think the LuaTeX manual should state clearly a recommended way of detecting
LuaTeX (and its version) so that macro writers can (hopefully) use it and no
other way that could become wrong in the future.

Manuel.


From mpg at elzevir.fr  Mon Mar  9 18:42:24 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 09 Mar 2009 18:42:24 +0100
Subject: [luatex] more package names...
In-Reply-To: <49B4EB88.4000202@telecom-bretagne.eu>
References: <49B4EB88.4000202@telecom-bretagne.eu>
Message-ID: <49B55500.3080307@elzevir.fr>

Elie Roux a ?crit :
> I'm going to split the current luainputenc between two packages: the one
> only for backward compatibility, that will be called by inputenc and use
> a fake utf8, and another one that really translates different encodings
> into a true utf8. The second will certainly have some macros like XeTeX
> has, to change the encoding in different files.
> 
Btw, I'm not sure splitting is the way to go here. I rather thought of a single
package with many different options. Actually, there may be additional ways to
treat encodings (when I'll have a little more free time, I'd like to try a sort
of semi-heuristic encoding "detection"), and it may become confusing for the
user if the number of encoding-related packages for LuaTeX becomes too large.
(Besides, from a technical point of view, I guess the packages won't be mutually
compatible, so it's probably best to handle this as mutually eclusive options of
a single package. Also, the packages/options will probably share a lot of code.)

Anyway, I agree with Arthur : while you're right to try choosing good names and
consult people in this regard, don't let it slow your work too much. Everything
here is at the development stage, so users will actually be beta-testers and
should expect things to change, and be ready to look for newer information if
names need to change later.

Manuel.


From mpg at elzevir.fr  Mon Mar  9 19:10:50 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 09 Mar 2009 19:10:50 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B52756.1090402@elvenkind.com>
References: <49B52756.1090402@elvenkind.com>
Message-ID: <49B55BAA.8030505@elzevir.fr>

Taco Hoekwater a ?crit :
> First, there will be a new lua function tex.primitives(),
> [...]
> Second, there will be a new lua function called tex.enableprimitives(),
> which takes two arguments. The first argument is a prefix string, and
> the second an array of names.
> 
I like this solution very much, I only have a few remarks about the name. I
think it would be best to either rename tex.primitives() as tex.newprimitives()
(or anything that makes clear that the tex82 primitives are returned) or make it
return all primitives by default, and subsets only if arguments are given.

Also, calling

tex.primitives('etex', 'pdftex')
tex.primitives('etex', 'omega')
-- but
tex.primitives('luatex')

sounds rather unintuitive to me.

Anyway, that's very minor points, and the overall idea is great.

Manuel.


From elie.roux at telecom-bretagne.eu  Tue Mar 10 07:56:42 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Mar 2009 07:56:42 +0100
Subject: [luatex] more package names...
In-Reply-To: <49B55500.3080307@elzevir.fr>
References: <49B4EB88.4000202@telecom-bretagne.eu>
	<49B55500.3080307@elzevir.fr>
Message-ID: <49B60F2A.1050601@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Btw, I'm not sure splitting is the way to go here. I rather thought of 
> a single
> package with many different options. Actually, there may be additional ways to
> treat encodings (when I'll have a little more free time, I'd like to try a sort
> of semi-heuristic encoding "detection"), and it may become confusing for the
> user if the number of encoding-related packages for LuaTeX becomes too large.
> (Besides, from a technical point of view, I guess the packages won't be mutually
> compatible, so it's probably best to handle this as mutually eclusive options of
> a single package. Also, the packages/options will probably share a lot of code.)
>   

In fact the two packages have almost nothing in common (and share no 
code): one really loads an encoding, the other has two modes : utf8 or 
8bit ; one needs inputenc, the other is standalone... In fact I'm 
thinking about dropping the standalone package that really loads 
encodings, I think it won't be used by anyone if the first works...
-- 
Elie

From taco at elvenkind.com  Tue Mar 10 09:16:21 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 09:16:21 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B55BAA.8030505@elzevir.fr>
References: <49B52756.1090402@elvenkind.com> <49B55BAA.8030505@elzevir.fr>
Message-ID: <49B621D5.4050602@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Taco Hoekwater a ?crit :
>> First, there will be a new lua function tex.primitives(),
>> [...]
>> Second, there will be a new lua function called tex.enableprimitives(),
>> which takes two arguments. The first argument is a prefix string, and
>> the second an array of names.
>>
> I like this solution very much, I only have a few remarks about the name. I
> think it would be best to either rename tex.primitives() as tex.newprimitives()

Ok, tex.newprimitives() it is.

I will keep the function tex.primitives() though, and make it return
every primitive the internals know about along with its command and
character code. That was what I originally intended anyway.

Best wishes,
Taco

From taco at elvenkind.com  Tue Mar 10 09:13:40 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 09:13:40 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B559D7.6000701@elzevir.fr>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr>
Message-ID: <49B62134.7010509@elvenkind.com>


Hi Manuel,

Manuel P?gouri?-Gonnard wrote:
> Btw, extra care should be taken while writing code that should be portable:
> - across different version of LuaTeX
> - across different TeX engines.

For that, I assume it would be better if luatex exposed \luatexversion
by default also? Fine by me, just make up your collective mind and let
me know if that makes more sense.

I personally don't care much about what exactly is part of the --ini,
I only ever use context, and there luatex will be enabled in the core
format for sure. Just reach a conclusion together in the next few
days and let me know the result.

> Before this, as a macro writer, my preferred way of detecting the underlying
> engine would probably have been testing whether \luatexversion is defined. Now
> I'd rather test for \directlua. *But* if some day Jonathan include Lua as a
> scripting language in XeTeX, things will be more complicated.

> Also, if I want to test for the LuaTeX version in order to know whether I should
> use \directlua0 or \directlua, it is a bit complicated. I guess there is a
> solution (no time to find it and write down the code right now) but anyway my
> point is:

> I think the LuaTeX manual should state clearly a recommended way of detecting
> LuaTeX (and its version) so that macro writers can (hopefully) use it and no
> other way that could become wrong in the future.

Defining a detection mechanism has now become the format authors
territory: disabling/enabling luatexs extra primitives should be done
either by the format itself, or by some base format package that
everybody that uses that format agrees on.

I(We) won't mind adding a paragraph to the manual (and this new way of
handling primitives needs explaining in "section one" for sure) but
how to deal the runtime detection for the (lua)(pdf)latex format in
practice is not a decision I want to make, nor think about.

Just make up your minds among yourselves, and if at the end someone
writes me a paragraph, I'll happily include it in the manual.

Best wishes,
Taco

From taco at elvenkind.com  Tue Mar 10 09:50:25 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 09:50:25 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B559D7.6000701@elzevir.fr>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr>
Message-ID: <49B629D1.9080501@elvenkind.com>


Hi,

(I send this message earlier but it seems to not have arrived.
If you somehow get it twice, I am sorry)


Manuel P?gouri?-Gonnard wrote:
> Btw, extra care should be taken while writing code that should be portable:
> - across different version of LuaTeX
> - across different TeX engines.

For that, I assume it would be better if luatex exposed \luatexversion
by default also? Fine by me, just make up your collective mind and let
me know if that makes more sense.

I personally don't care much about what exactly is part of the --ini,
I only ever use context, and there luatex will be enabled in the core
format for sure. Just reach a conclusion together in the next few
days and let me know the result.

> Before this, as a macro writer, my preferred way of detecting the underlying
> engine would probably have been testing whether \luatexversion is defined. Now
> I'd rather test for \directlua. *But* if some day Jonathan include Lua as a
> scripting language in XeTeX, things will be more complicated.

> Also, if I want to test for the LuaTeX version in order to know whether I should
> use \directlua0 or \directlua, it is a bit complicated. I guess there is a
> solution (no time to find it and write down the code right now) but anyway my
> point is:

> I think the LuaTeX manual should state clearly a recommended way of detecting
> LuaTeX (and its version) so that macro writers can (hopefully) use it and no
> other way that could become wrong in the future.

Defining a detection mechanism has now become the format authors
territory: disabling/enabling luatexs extra primitives should be done
either by the format itself, or by some base format package that
everybody that uses that format agrees on.

I(We) won't mind adding a paragraph to the manual (and this new way of
handling primitives needs explaining in "section one" for sure) but
how to deal the runtime detection for the (lua)(pdf)latex format in
practice is not a decision I want to make, nor think about.

Just make up your minds among yourselves, and if at the end someone
writes me a paragraph, I'll happily include it in the manual.

Best wishes,
Taco


From luatex at nililand.de  Tue Mar 10 09:55:00 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 10 Mar 2009 09:55:00 +0100
Subject: [luatex] Luatex primitive names
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr> <49B62134.7010509@elvenkind.com>
Message-ID: <lyzx6prqphcb$.dlg@nililand.de>

Am Tue, 10 Mar 2009 09:13:40 +0100 schrieb Taco Hoekwater:

>> Btw, extra care should be taken while writing code that should be portable:
>> - across different version of LuaTeX
>> - across different TeX engines.
> 
> For that, I assume it would be better if luatex exposed \luatexversion
> by default also? Fine by me, just make up your collective mind and let
> me know if that makes more sense.

I think that \luatexversion should be enabled by default. 


-- 
Ulrike Fischer 


From taco at elvenkind.com  Tue Mar 10 11:08:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 11:08:13 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B621D5.4050602@elvenkind.com>
References: <49B52756.1090402@elvenkind.com> <49B55BAA.8030505@elzevir.fr>
	<49B621D5.4050602@elvenkind.com>
Message-ID: <49B63C0D.8050209@elvenkind.com>



Taco Hoekwater wrote:
> Manuel P?gouri?-Gonnard wrote:
>> Taco Hoekwater a ?crit :
>>> First, there will be a new lua function tex.primitives(),
>>> [...]
>>> Second, there will be a new lua function called tex.enableprimitives(),
>>> which takes two arguments. The first argument is a prefix string, and
>>> the second an array of names.
>>>
>> I like this solution very much, I only have a few remarks about the
>> name. I
>> think it would be best to either rename tex.primitives() as
>> tex.newprimitives()
> 
> Ok, tex.newprimitives() it is.

Hans says that tex.extraprimitives() is even better.

From pragma at wxs.nl  Tue Mar 10 11:09:14 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2009 11:09:14 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <lyzx6prqphcb$.dlg@nililand.de>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com> <lyzx6prqphcb$.dlg@nililand.de>
Message-ID: <49B63C4A.4060400@wxs.nl>

Ulrike Fischer wrote:
> Am Tue, 10 Mar 2009 09:13:40 +0100 schrieb Taco Hoekwater:
> 
>>> Btw, extra care should be taken while writing code that should be portable:
>>> - across different version of LuaTeX
>>> - across different TeX engines.
>> For that, I assume it would be better if luatex exposed \luatexversion
>> by default also? Fine by me, just make up your collective mind and let
>> me know if that makes more sense.
> 
> I think that \luatexversion should be enabled by default. 

for a short while we considered it but it contradicts the fact that we 
want to start up as tex82 and settled on only \directlua


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From javier at digi21.eu  Tue Mar 10 12:45:55 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Tue, 10 Mar 2009 12:45:55 +0100
Subject: [luatex]  Luatex primitive names
Message-ID: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>

>Also, if I want to test for the LuaTeX version in order
>to know whether I should use \directlua0 or \directlua

LuaTeX is still beta, so in my opinion it makes no sense to write code
compatible with previous versions of luatex (previous to the current
one at every moment, while it still be in beta state). So just write
\directlua0 now and when it is changed to \directlua, change your code
accordingly.

Javier A.

From olli at sopos.org  Tue Mar 10 12:53:31 2009
From: olli at sopos.org (Oliver Heins)
Date: Tue, 10 Mar 2009 12:53:31 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B63C4A.4060400@wxs.nl> (Hans Hagen's message of "Tue\,
	10 Mar 2009 11\:09\:14 +0100")
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org> <49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr> <49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
Message-ID: <87d4cp3878.fsf@sopos.org>

Hans Hagen <pragma at wxs.nl> writes:

> Ulrike Fischer wrote:
>>
>> I think that \luatexversion should be enabled by default. 
>
> for a short while we considered it but it contradicts the fact that we
> want to start up as tex82 and settled on only \directlua

If so, you should consider reopening Issue 0000161: \outer has no effect.

Best regards,
 olli

-- 
Oliver Heins olli at sopos.de     F27A BA8C 1CFB B905 65A8
http://www.sopos.org/olli/     2544 0F07 B675 9A00 D827
1024D/9A00D827 2004-09-24 -- gpg --recv-keys 0x9A00D827
Please avoid sending me Word or PowerPoint attachments:
http://www.gnu.org/philosophy/no-word-attachments.html

From taco at elvenkind.com  Tue Mar 10 13:18:18 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 13:18:18 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <87d4cp3878.fsf@sopos.org>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>
	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl> <87d4cp3878.fsf@sopos.org>
Message-ID: <49B65A8A.1010005@elvenkind.com>

Oliver Heins wrote:
> Hans Hagen <pragma at wxs.nl> writes:
> 
>> Ulrike Fischer wrote:
>>> I think that \luatexversion should be enabled by default. 
>> for a short while we considered it but it contradicts the fact that we
>> want to start up as tex82 and settled on only \directlua
> 
> If so, you should consider reopening Issue 0000161: \outer has no effect.

Maybe so, seeing that Knuth's documentation about \outer insists that
it does something useful (I am not so sure about that myself: how
many users of latex/context do you believe could, after reading that
error, actually understand it, and fix their input document or macro
correspondingly?).

Generally speaking, however, we feel that we are free to make changes in
areas where tex82 would generate an error. We feel that such a level of
backward compatibility would really be silly to maintain.

Best wishes,
Taco

From preining at logic.at  Tue Mar 10 13:21:40 2009
From: preining at logic.at (Norbert Preining)
Date: Tue, 10 Mar 2009 13:21:40 +0100
Subject: [luatex] luatex beta 0.35.0
In-Reply-To: <49A40423.6090609@elvenkind.com>
References: <49A40423.6090609@elvenkind.com>
Message-ID: <20090310122140.GA18772@gamma.logic.tuwien.ac.at>

On Di, 24 Feb 2009, Taco Hoekwater wrote:
> I have just uploaded luatex 0.35.0.

BTW, Debian Sid now has luatex 0.35.0 packages, too, and together with
the context packages 2008.10.31-1 from experimental (I will upload to
unstable soon) MarkIV at least works after doing the usual post-install
stuff.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
BANTEER
A lusty and raucous old ballad sung after a particulary spectacular
araglin (q.v.) has been pulled off.
			--- Douglas Adams, The Meaning of Liff

From olli at sopos.org  Tue Mar 10 13:30:47 2009
From: olli at sopos.org (Oliver Heins)
Date: Tue, 10 Mar 2009 13:30:47 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B65A8A.1010005@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 10 Mar 2009 13\:18\:18 +0100")
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org> <49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr> <49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
	<87d4cp3878.fsf@sopos.org> <49B65A8A.1010005@elvenkind.com>
Message-ID: <87r6151rwo.fsf@sopos.org>

Taco Hoekwater <taco at elvenkind.com> writes:

> Oliver Heins wrote:
>> Hans Hagen <pragma at wxs.nl> writes:
>>
>>> Ulrike Fischer wrote:
>>>> I think that \luatexversion should be enabled by default. 
>>> for a short while we considered it but it contradicts the fact that we
>>> want to start up as tex82 and settled on only \directlua
>>
>> If so, you should consider reopening Issue 0000161: \outer has no effect.
>
> Maybe so, seeing that Knuth's documentation about \outer insists that
> it does something useful (I am not so sure about that myself: how
> many users of latex/context do you believe could, after reading that
> error, actually understand it, and fix their input document or macro
> correspondingly?).

At least me who ran once into it and the three people who pointed it out
to me :-)

> Generally speaking, however, we feel that we are free to make changes in
> areas where tex82 would generate an error. We feel that such a level of
> backward compatibility would really be silly to maintain.

Well, that's your decision.  For me it's fine either way, I don't really
care (I just recognized that LuaTeX does not behave as TeX82 and
reported it).

Best regards,
 olli

-- 
Oliver Heins olli at sopos.de     F27A BA8C 1CFB B905 65A8
http://www.sopos.org/olli/     2544 0F07 B675 9A00 D827
1024D/9A00D827 2004-09-24 -- gpg --recv-keys 0x9A00D827
Please avoid sending me Word or PowerPoint attachments:
http://www.gnu.org/philosophy/no-word-attachments.html

From luatex at nililand.de  Tue Mar 10 13:41:46 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 10 Mar 2009 13:41:46 +0100
Subject: [luatex] Luatex primitive names
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
Message-ID: <bpuzq83jk4pg$.dlg@nililand.de>

Am Tue, 10 Mar 2009 11:09:14 +0100 schrieb Hans Hagen:

>>>> Btw, extra care should be taken while writing code that should be portable:
>>>> - across different version of LuaTeX
>>>> - across different TeX engines.
>>> For that, I assume it would be better if luatex exposed \luatexversion
>>> by default also? Fine by me, just make up your collective mind and let
>>> me know if that makes more sense.
>> 
>> I think that \luatexversion should be enabled by default. 
 
> for a short while we considered it but it contradicts the fact that we 
> want to start up as tex82 and settled on only \directlua

Yes, enabling \luatexversion is not so clean and consistent. But I
like the idea to have a simple and reliable command to identify the
engine. This would avoid problems like the one we got with faulty
\pdfoutput-tests. 



-- 
Ulrike Fischer 


From pragma at wxs.nl  Tue Mar 10 14:18:18 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2009 14:18:18 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <bpuzq83jk4pg$.dlg@nililand.de>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl> <bpuzq83jk4pg$.dlg@nililand.de>
Message-ID: <49B6689A.9010407@wxs.nl>

Ulrike Fischer wrote:
> Am Tue, 10 Mar 2009 11:09:14 +0100 schrieb Hans Hagen:
> 
>>>>> Btw, extra care should be taken while writing code that should be portable:
>>>>> - across different version of LuaTeX
>>>>> - across different TeX engines.
>>>> For that, I assume it would be better if luatex exposed \luatexversion
>>>> by default also? Fine by me, just make up your collective mind and let
>>>> me know if that makes more sense.
>>> I think that \luatexversion should be enabled by default. 
>  
>> for a short while we considered it but it contradicts the fact that we 
>> want to start up as tex82 and settled on only \directlua
> 
> Yes, enabling \luatexversion is not so clean and consistent. But I
> like the idea to have a simple and reliable command to identify the
> engine. This would avoid problems like the one we got with faulty
> \pdfoutput-tests. 

\directlua will always be there as it is needed to enable the primitives 
  so it is a save test


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From yuleopen at gmail.com  Tue Mar 10 14:27:11 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 10 Mar 2009 21:27:11 +0800
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B6689A.9010407@wxs.nl>
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org> <49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr> <49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
	<bpuzq83jk4pg$.dlg@nililand.de> <49B6689A.9010407@wxs.nl>
Message-ID: <68bfdc900903100627p22753b34tfec69dbe85cf3bef@mail.gmail.com>

Hi,

> \directlua will always be there as it is needed to enable the primitives ?so
> it is a save test

what about the getopt route?

luatex --ini foo (using tex82)
luatex --ini foo --pdftex (using pdftex)
luatex --ini foo --pdftex --etex (using pdfetex)
luatex --ini foo --luatex (using luatex)

so no \directlua is needed for bootsrtap.

Yue Wang

From arthur.reutenauer at normalesup.org  Tue Mar 10 14:30:59 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 10 Mar 2009 14:30:59 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B6689A.9010407@wxs.nl>
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org>
	<49B53058.4040405@wxs.nl> <49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
	<bpuzq83jk4pg$.dlg@nililand.de> <49B6689A.9010407@wxs.nl>
Message-ID: <20090310133059.GA17625@phare.normalesup.org>

> \directlua will always be there as it is needed to enable the primitives  
> so it is a save test

  For what it's worth, I also think we should make only \directlua
available at ini time, and use that to detect LuaTeX.  It is, after all,
the very mark of LuaTeX.

	Arthur

From pragma at wxs.nl  Tue Mar 10 14:37:40 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2009 14:37:40 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <68bfdc900903100627p22753b34tfec69dbe85cf3bef@mail.gmail.com>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>
	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl>	<bpuzq83jk4pg$.dlg@nililand.de>
	<49B6689A.9010407@wxs.nl>
	<68bfdc900903100627p22753b34tfec69dbe85cf3bef@mail.gmail.com>
Message-ID: <49B66D24.3010902@wxs.nl>

Yue Wang wrote:
> Hi,
> 
>> \directlua will always be there as it is needed to enable the primitives  so
>> it is a save test
> 
> what about the getopt route?
> 
> luatex --ini foo (using tex82)
> luatex --ini foo --pdftex (using pdftex)
> luatex --ini foo --pdftex --etex (using pdfetex)
> luatex --ini foo --luatex (using luatex)

that would complicate matters .. think of macro packages doing differnet 
things as users on the commandline demand; also, it all started with 
prefixes so your solution would end up as --pdftex=MyPrefix which in 
turn would give interesting conflicts

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luatex at nililand.de  Tue Mar 10 14:42:36 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 10 Mar 2009 14:42:36 +0100
Subject: [luatex] Luatex primitive names
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl> <bpuzq83jk4pg$.dlg@nililand.de>
	<49B6689A.9010407@wxs.nl>
Message-ID: <1kng6x8o4nxhp.dlg@nililand.de>

Am Tue, 10 Mar 2009 14:18:18 +0100 schrieb Hans Hagen:

>> Yes, enabling \luatexversion is not so clean and consistent. But I
>> like the idea to have a simple and reliable command to identify the
>> engine. This would avoid problems like the one we got with faulty
>> \pdfoutput-tests. 
 
> \directlua will always be there as it is needed to enable the primitives 
>   so it is a save test

If \directlua is only offered by luatex, then yes. But Manual wrote

"Now I'd rather test for \directlua. *But* if some day Jonathan
include Lua as a scripting language in XeTeX, things will be more
complicated."

and I thought this meant that perhaps \directlua will also be
included in XeTeX. 


-- 
Ulrike Fischer 


From arthur.reutenauer at normalesup.org  Tue Mar 10 14:51:47 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 10 Mar 2009 14:51:47 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <1kng6x8o4nxhp.dlg@nililand.de>
References: <49B52756.1090402@elvenkind.com>
	<20090309145433.GC6333@phare.normalesup.org>
	<49B53058.4040405@wxs.nl> <49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
	<bpuzq83jk4pg$.dlg@nililand.de> <49B6689A.9010407@wxs.nl>
	<1kng6x8o4nxhp.dlg@nililand.de>
Message-ID: <20090310135147.GA23064@phare.normalesup.org>

> "Now I'd rather test for \directlua. *But* if some day Jonathan
> include Lua as a scripting language in XeTeX, things will be more
> complicated."

  The primitive doesn't need to be called \directlua :-)  It will have a
very different behaviour anyway: XeTeX will not use callbacks to hook
Lua code into the TeX engine, it will simply enable to write Lua
programs inside TeX (Jonathan said so).

  But I guess that brings us back to the prefix issue, and maybe we can
rename \directlua to \luadirect (which will be coherent with the change
in the syntax anyway).  Taco?

	Arthur

From taco at elvenkind.com  Tue Mar 10 15:22:31 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 10 Mar 2009 15:22:31 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090310135147.GA23064@phare.normalesup.org>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr>	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl>	<bpuzq83jk4pg$.dlg@nililand.de>
	<49B6689A.9010407@wxs.nl>	<1kng6x8o4nxhp.dlg@nililand.de>
	<20090310135147.GA23064@phare.normalesup.org>
Message-ID: <49B677A7.4040606@elvenkind.com>



Arthur Reutenauer wrote:
>> "Now I'd rather test for \directlua. *But* if some day Jonathan
>> include Lua as a scripting language in XeTeX, things will be more
>> complicated."
> 
>   The primitive doesn't need to be called \directlua :-)  It will have a
> very different behaviour anyway: XeTeX will not use callbacks to hook
> Lua code into the TeX engine, it will simply enable to write Lua
> programs inside TeX (Jonathan said so).
> 
>   But I guess that brings us back to the prefix issue, and maybe we can
> rename \directlua to \luadirect (which will be coherent with the change
> in the syntax anyway).  Taco?

At some point in this discussion I will start screaming, I am sure ;)

I believe that in the combination of \luatexversion + \directlua
would be a better choice than yet another primitive name, but no,
the --ini primitive does not have to be called \directla per se.
It could be called \luatexdirectlua or so.

In any case, \directlua will remain present in the 'luatex' block of
primitives because of all the exposure it has gotten already; but
also because it nicely complements \latelua (which \luadirect doesnt).

Best wishes,
Taco


From arthur.reutenauer at normalesup.org  Tue Mar 10 15:38:02 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 10 Mar 2009 15:38:02 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B677A7.4040606@elvenkind.com>
References: <49B53058.4040405@wxs.nl> <49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>
	<lyzx6prqphcb$.dlg@nililand.de> <49B63C4A.4060400@wxs.nl>
	<bpuzq83jk4pg$.dlg@nililand.de> <49B6689A.9010407@wxs.nl>
	<1kng6x8o4nxhp.dlg@nililand.de>
	<20090310135147.GA23064@phare.normalesup.org>
	<49B677A7.4040606@elvenkind.com>
Message-ID: <20090310143802.GC23064@phare.normalesup.org>

> At some point in this discussion I will start screaming, I am sure ;)

  The devil lies in the details :-)

> I believe that in the combination of \luatexversion + \directlua
> would be a better choice than yet another primitive name, but no,
> the --ini primitive does not have to be called \directla per se.
> It could be called \luatexdirectlua or so.

  That was my point.  I'm not saying it was a particularily good one.

> In any case, \directlua will remain present in the 'luatex' block of
> primitives because of all the exposure it has gotten already; but
> also because it nicely complements \latelua (which \luadirect doesnt).

  Sure enough.  I guess we could rule that \directlua per se
characterizes LuaTeX well enough, and that XeTeX, or any other
extension that would add Lua to the TeX engine, should use some other
name.  As I pointed out, the Lua interpreter inside XeTeX would be
significantly different from what we have currently in LuaTeX.  For that
matter, I'm not even sure if a difference between immediate and late
execution of Lua would be relevant outside of LuaTeX.

	Arthur

From pragma at wxs.nl  Tue Mar 10 15:45:24 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2009 15:45:24 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090310143802.GC23064@phare.normalesup.org>
References: <49B53058.4040405@wxs.nl>
	<49B559D7.6000701@elzevir.fr>	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>
	<49B63C4A.4060400@wxs.nl>	<bpuzq83jk4pg$.dlg@nililand.de>
	<49B6689A.9010407@wxs.nl>	<1kng6x8o4nxhp.dlg@nililand.de>	<20090310135147.GA23064@phare.normalesup.org>	<49B677A7.4040606@elvenkind.com>
	<20090310143802.GC23064@phare.normalesup.org>
Message-ID: <49B67D04.4010209@wxs.nl>

Arthur Reutenauer wrote:

>   Sure enough.  I guess we could rule that \directlua per se
> characterizes LuaTeX well enough, and that XeTeX, or any other

also, one can test for \XeTeXversion first

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Tue Mar 10 15:47:47 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 10 Mar 2009 15:47:47 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
Message-ID: <20090310144747.GE23064@phare.normalesup.org>

> LuaTeX is still beta, so in my opinion it makes no sense to write code
> compatible with previous versions of luatex (previous to the current
> one at every moment, while it still be in beta state).

  Agreed.

	Arthur

From mpg at elzevir.fr  Tue Mar 10 19:51:04 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 10 Mar 2009 19:51:04 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B62134.7010509@elvenkind.com>
References: <49B52756.1090402@elvenkind.com>	<20090309145433.GC6333@phare.normalesup.org>	<49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>
	<49B62134.7010509@elvenkind.com>
Message-ID: <49B6B698.6040205@elzevir.fr>

Taco Hoekwater a ?crit :
> For that, I assume it would be better if luatex exposed \luatexversion
> by default also? Fine by me, just make up your collective mind and let
> me know if that makes more sense.
> 
FWIW, I think expostion \luatexversion is the simplest, hence the best, solution.

> I(We) won't mind adding a paragraph to the manual (and this new way of
> handling primitives needs explaining in "section one" for sure) but
> how to deal the runtime detection for the (lua)(pdf)latex format in
> practice is not a decision I want to make, nor think about.
> 
I agree with you that the runtime detection should belong to the format.
However, given that things running on top of LaTeX2e will probably need to
detect the engine themselves a least for some time, it's best to provide and
document a simple and reliable detection mechanism.

My primary concern here is to try and avoid reproducing the problems with wrong
\pdfoutput hacks as Ulrike said.

Manuel.


From mpg at elzevir.fr  Tue Mar 10 19:57:33 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 10 Mar 2009 19:57:33 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B67D04.4010209@wxs.nl>
References: <49B53058.4040405@wxs.nl>	<49B559D7.6000701@elzevir.fr>	<49B62134.7010509@elvenkind.com>	<lyzx6prqphcb$.dlg@nililand.de>	<49B63C4A.4060400@wxs.nl>	<bpuzq83jk4pg$.dlg@nililand.de>	<49B6689A.9010407@wxs.nl>	<1kng6x8o4nxhp.dlg@nililand.de>	<20090310135147.GA23064@phare.normalesup.org>	<49B677A7.4040606@elvenkind.com>	<20090310143802.GC23064@phare.normalesup.org>
	<49B67D04.4010209@wxs.nl>
Message-ID: <49B6B81D.60905@elzevir.fr>

Hans Hagen a ?crit :
>>   Sure enough.  I guess we could rule that \directlua per se
>> characterizes LuaTeX well enough, and that XeTeX, or any other
> 
> also, one can test for \XeTeXversion first
> 
Sure. But only because XeTeX provides a simple, immuable and unambiguous way of
identification. My whole point is that every engine should provide such a
mechanism, and the more coherent choice IMO is a \<engine-name>version primitive.

It costs essentially nothing, and avoids a lot of possible problems, now and in
the future.

Manuel.

From mpg at elzevir.fr  Tue Mar 10 20:04:06 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 10 Mar 2009 20:04:06 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090310144747.GE23064@phare.normalesup.org>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<20090310144747.GE23064@phare.normalesup.org>
Message-ID: <49B6B9A6.4010708@elzevir.fr>

Arthur Reutenauer a ?crit :
>> LuaTeX is still beta, so in my opinion it makes no sense to write code
>> compatible with previous versions of luatex (previous to the current
>> one at every moment, while it still be in beta state).
> 
>   Agreed.
> 
Sorry but I don't agree. Detecting the version (if a convenient mechanism is
available) costs essentially nothing and can make things simpler for users,
which is always important, even in beta stage, IMHO.

Manuel.





From elie.roux at telecom-bretagne.eu  Tue Mar 10 21:07:12 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Mar 2009 21:07:12 +0100
Subject: [luatex] luainputenc
Message-ID: <49B6C870.9060601@telecom-bretagne.eu>

Hello,

I have a first version of luainputenc package: 
http://github.com/eroux/lualatex/blob/404c353679cbe0ad50d3ad6f92b4180b930455bd/luainputenc/luainputenc.dtx

Basically this works:

\usepackage[latin1]{luainputenc}
\usepackage[latin1]{inputenc}

this too (though it does nothing):

\usepackage[utf8]{luainputenc}

but the following don't work:

\usepackage[utf8]{luainputenc}
\usepackage[utf8]{inputenc}

\usepackage[latin1]{inputenc}

\usepackage[utf8]{inputenc}

\usepackage[latin1]{luainputenc}

This will be pretty confusing for the users, but I hope Will and I will 
manage to have a patch for inputenc accepted by the LaTeX team...
-- 
Elie

From pragma at wxs.nl  Tue Mar 10 23:25:31 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 10 Mar 2009 23:25:31 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B6B9A6.4010708@elzevir.fr>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>	<20090310144747.GE23064@phare.normalesup.org>
	<49B6B9A6.4010708@elzevir.fr>
Message-ID: <49B6E8DB.6050209@wxs.nl>

Manuel P?gouri?-Gonnard wrote:
> Arthur Reutenauer a ?crit :
>>> LuaTeX is still beta, so in my opinion it makes no sense to write code
>>> compatible with previous versions of luatex (previous to the current
>>> one at every moment, while it still be in beta state).
>>   Agreed.
>>
> Sorry but I don't agree. Detecting the version (if a convenient mechanism is
> available) costs essentially nothing and can make things simpler for users,
> which is always important, even in beta stage, IMHO.

simple ... hm ...

\pdftexversion
\OmegaVersion
\XeTeXversion
\luatexversion
\eTeXversion

lucky us that most users don't have to gamble on the casing in these 
primitives


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From karl at freefriends.org  Wed Mar 11 00:36:28 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 10 Mar 2009 18:36:28 -0500
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B629D1.9080501@elvenkind.com>
Message-ID: <200903102336.n2ANaS213328@f7.net>

Taco (or anyone) -- is there some simple Lua function which returns some
engine identification?

I'm thinking of something like
\directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
which both luatex and xetex could implement.

(I concur with the opinions of only exposing \directlua.)

From mpg at elzevir.fr  Wed Mar 11 01:27:56 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 01:27:56 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <200903102336.n2ANaS213328@f7.net>
References: <200903102336.n2ANaS213328@f7.net>
Message-ID: <49B7058C.4050207@elzevir.fr>

Karl Berry a ?crit :
> Taco (or anyone) -- is there some simple Lua function which returns some
> engine identification?
> 
> I'm thinking of something like
> \directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
> which both luatex and xetex could implement.
> 
Hum, there is currently no \directlua in XeTeX. I mentioned it only as a
possibility in the future, since I think it is important that engine+version
identification be stable in time.

> (I concur with the opinions of only exposing \directlua.)

Well, I'm also for exposing only \directlua if there is a variable like
tex.luatexversion (or lua.luatexversion or whatever).

Manuel.

From karl at freefriends.org  Wed Mar 11 01:29:49 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 10 Mar 2009 19:29:49 -0500
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7058C.4050207@elzevir.fr>
Message-ID: <200903110029.n2B0Tnr28624@f7.net>

    Hum, there is currently no \directlua in XeTeX

I know that.

\ifx\undefined\directlua ... non-lua engines .. \else
  \def\formatname{\directlua{tex.engine_ident()}}%
\fi

From karl at freefriends.org  Wed Mar 11 01:55:10 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 10 Mar 2009 19:55:10 -0500
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <gp485m$3hm$1@ger.gmane.org>
Message-ID: <200903110055.n2B0tAY03266@f7.net>

    No, I think it's more sensible (unless I've somehow managed to change 
    your mind above) 

Nope :).

    to stay with your original plan of deactivating all 
    primitives even in lualatex -- 

Ok, let's call it agreed on that point.  Can you write the stuff for the
.ini, and we'll show it to Christian?

    but only if you think that there's a possibility one day of it
    becoming the default engine.

I do think there is that possibility.

    (Which is kind of the point of the whole discussion.)

Right.

From oberdiek at uni-freiburg.de  Wed Mar 11 01:53:33 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 01:53:33 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <200903102336.n2ANaS213328@f7.net>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
Message-ID: <20090311005332.GA6997@irwin.vpn.uni-freiburg.de>

On Tue, Mar 10, 2009 at 06:36:28PM -0500, Karl Berry wrote:

> Taco (or anyone) -- is there some simple Lua function which returns some
> engine identification?
> 
> I'm thinking of something like
> \directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
> which both luatex and xetex could implement.
> 
> (I concur with the opinions of only exposing \directlua.)

I don't unless I have misunderstood something:

\directlua{...} generates an error message for older versions,
because it requires a number for the lua state.
In newer versions the number shouldn't be given, because it
would cause a deprecation warning -- users always complain
about warnings. Thus the version information is already
needed at TeX level before switching to Lua.

Thus the syntax change for \directlua (and perhaps later
changes) vote for something extra:
\luatexversion is a good choice in my opinion.
It says in my eyes, `hey, I provide the features, described
in the LuaTeX manual for the version number I return'.
This is a clean way for testing without the need to use some
complicate dubious heuristics.

BTW, from the experience of the history of pdfTeX, I would like
some version information in the LuaTeX manual:
* Mapping \luatexversion -> official LuaTeX version number
* Version information for each feature/primitive, when
  it was introduced and when changes occur.
It would help macro programmers to write robuster code
without studying old announcements and logs of the version control
system.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From wspr81 at gmail.com  Wed Mar 11 04:06:42 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 11 Mar 2009 13:36:42 +1030
Subject: [luatex] Proposal to fix the namespace argument
References: <govr04$k7s$1@ger.gmane.org> <200903092232.n29MWfY23850@f7.net>
	<gp485m$3hm$1@ger.gmane.org> <200903110055.n2B0tAY03266@f7.net>
Message-ID: <gp79s2$mcs$1@ger.gmane.org>

On 2009-03-11 11:25:10 +1030, 
karl at freefriends.org (Karl Berry) said:

>     to stay with your original plan of deactivating all
>     primitives even in lualatex --
> 
> Ok, let's call it agreed on that point.  Can you write the stuff for the
> .ini, and we'll show it to Christian?

Actually, not really, sorry :(
The ini I wrote was relying on the primitives already existing; 
furthermore it only used TeX code.

That example of Taco's from the other day looks simple enough to 
replicate, but I can't guarantee I'll be able to keep track of LuaTeX 
and TeXLive development to make sure it's correct...

If there's anyone else here that can write the ini file, I'd be appreciative :)

Will



From taco at elvenkind.com  Wed Mar 11 09:02:18 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 09:02:18 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7058C.4050207@elzevir.fr>
References: <200903102336.n2ANaS213328@f7.net> <49B7058C.4050207@elzevir.fr>
Message-ID: <49B7700A.2000100@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Karl Berry a ?crit :
>> Taco (or anyone) -- is there some simple Lua function which returns some
>> engine identification?
>>
>> I'm thinking of something like
>> \directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
>> which both luatex and xetex could implement.
>>
> Hum, there is currently no \directlua in XeTeX. I mentioned it only as a
> possibility in the future, since I think it is important that engine+version
> identification be stable in time.
> 
>> (I concur with the opinions of only exposing \directlua.)
> 
> Well, I'm also for exposing only \directlua if there is a variable like
> tex.luatexversion (or lua.luatexversion or whatever).

There is the variable tex.luatexversion; its current value is 35.

Best wishes,
Taco

From taco at elvenkind.com  Wed Mar 11 09:08:40 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 09:08:40 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
Message-ID: <49B77188.5090903@elvenkind.com>

Heiko Oberdiek wrote:
> 
> BTW, from the experience of the history of pdfTeX, I would like
> some version information in the LuaTeX manual:
> * Mapping \luatexversion -> official LuaTeX version number

I do not understand what you mean.

> * Version information for each feature/primitive, when
>   it was introduced and when changes occur.

I can do that starting with the next version. But the manual
may be incomplete for a while yet, this is not a top priority
for me.

Best wishes,
Taco

From Robin.Fairbairns at cl.cam.ac.uk  Wed Mar 11 09:28:11 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 11 Mar 2009 08:28:11 +0000
Subject: [luatex] Luatex primitive names
In-Reply-To: Your message of Wed, 11 Mar 2009 01:53:33 +0100.
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
Message-ID: <5836.1236760091@cl.cam.ac.uk>

Heiko Oberdiek <oberdiek at uni-freiburg.de> wrote:

[cogent arguments omitted]

> BTW, from the experience of the history of pdfTeX, I would like
> some version information in the LuaTeX manual:
> * Mapping \luatexversion -> official LuaTeX version number
> * Version information for each feature/primitive, when
>   it was introduced and when changes occur.
> It would help macro programmers to write robuster code
> without studying old announcements and logs of the version control
> system.

fwiw, i agree (with all of it).  the trouble is, it's not me that has to
be persuaded, it's taco.  unfortunately, taco has said that there's no
point attempting backwards compatibility on a beta; he apparently
believes that such small additions to his workload are enough to rule
them out.

which is sad.  i've experienced this sort of pressure, from (as it were)
taco's side, in the past (i don't do much software development any
more).  i know one has to draw a line somewhere, but i am sad that
taco's line isn't where _i_ believe is the ideal.

robin

From pragma at wxs.nl  Wed Mar 11 09:29:50 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 09:29:50 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
Message-ID: <49B7767E.8080007@wxs.nl>

Heiko Oberdiek wrote:
> On Tue, Mar 10, 2009 at 06:36:28PM -0500, Karl Berry wrote:
> 
>> Taco (or anyone) -- is there some simple Lua function which returns some
>> engine identification?
>>
>> I'm thinking of something like
>> \directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
>> which both luatex and xetex could implement.
>>
>> (I concur with the opinions of only exposing \directlua.)
> 
> I don't unless I have misunderstood something:
> 
> \directlua{...} generates an error message for older versions,
> because it requires a number for the lua state.
> In newer versions the number shouldn't be given, because it
> would cause a deprecation warning -- users always complain
> about warnings. Thus the version information is already
> needed at TeX level before switching to Lua.

we're talking of version 0.40 and onwards and the new syntax will be in 0.40

we don't care about < 0.40 and macro package support before 0.40

also, the syntax will not change that much as we will likely use the 
number as alternative for the name directive (index in array then) so 
that the syntax wil become

\dirextlua
   [name {error message string}]
   [optional number refering to error number string in table]

so, for pre 0.40 it means that the number is basically ignored

> * Version information for each feature/primitive, when
>   it was introduced and when changes occur.

at some point we will declare primitives/features stable (will happen 
stepwise) and the manual will mention it for each (class of) primitives

> It would help macro programmers to write robuster code
> without studying old announcements and logs of the version control
> system.

when functionality changes there will be either new primitives or 
mechanisms to control the behaviour (in pdftex we had several hz variants)

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 11 09:39:11 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 09:39:11 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5836.1236760091@cl.cam.ac.uk>
References: <5836.1236760091@cl.cam.ac.uk>
Message-ID: <49B778AF.20201@wxs.nl>

Robin Fairbairns wrote:
> Heiko Oberdiek <oberdiek at uni-freiburg.de> wrote:
> 
> [cogent arguments omitted]
> 
>> BTW, from the experience of the history of pdfTeX, I would like
>> some version information in the LuaTeX manual:
>> * Mapping \luatexversion -> official LuaTeX version number
>> * Version information for each feature/primitive, when
>>   it was introduced and when changes occur.
>> It would help macro programmers to write robuster code
>> without studying old announcements and logs of the version control
>> system.
> 
> fwiw, i agree (with all of it).  the trouble is, it's not me that has to
> be persuaded, it's taco.  unfortunately, taco has said that there's no
> point attempting backwards compatibility on a beta; he apparently
> believes that such small additions to his workload are enough to rule
> them out.
> 
> which is sad.  i've experienced this sort of pressure, from (as it were)
> taco's side, in the past (i don't do much software development any
> more).  i know one has to draw a line somewhere, but i am sad that
> taco's line isn't where _i_ believe is the ideal.

in the case of luatex it's not so much a problem ...

(1) we explicitly state that everything is beta till v 1.00 or till 
declared otherwise

(2) luatex is not production ready so no one should depend on it unless 
at own risk

(3) pdftex was also a moving target but nicely cached on anyway

(4) the solution that we proposed with regards to primitives solves the 
latex profixing problem (afaik)

(5) there is a way to test the engine \directlua (and maybe 
\luatexversion is that is really needed)

(6) some features that influence the output [hyphenation, math etc] will 
be backward compatible as much as possible within the rewrite but we 
don't want to be crippled too much; after all there is xetex (which is 
dependent on libraries that are probably out of the tex communities 
control] or there is pdftex (which can serve users for ever esp when 
they only use cmr/lm fonts)

so, i'm not sure what critital backward compatibility you're refering to


Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 11 09:45:17 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 09:45:17 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <200903102336.n2ANaS213328@f7.net>
References: <200903102336.n2ANaS213328@f7.net>
Message-ID: <49B77A1D.5030902@wxs.nl>

Karl Berry wrote:
> Taco (or anyone) -- is there some simple Lua function which returns some
> engine identification?
> 
> I'm thinking of something like
> \directlua{tex.engine_ident()}  (sorry, wrong syntax, I know),
> which both luatex and xetex could implement.
> 
> (I concur with the opinions of only exposing \directlua.)

2.1 Version information
There are three new primitives to test the version of LuaTEX:
primitive explanation
\luatexversion a combination of major and minor number, as in pdfTEX; 
the current current value
is 34
\luatexrevision the revision, as in pdfTEX; the current value is 0
\luatexdatestamp a combination of the local date and hour when the 
current executable was compiled,
the syntax is identical to \luatexrevision; the value for the executable
that generated this document is 2009022411.
Note that the \luatexdatestamp depends on both the compilation time and 
compilation place of the
current executable, it is defined in terms of the local time. The 
purpose of this primitive is solely to be
an aid in the development process, do not use it for anything besides 
debugging.


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Mar 11 09:50:36 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 09:50:36 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B77A1D.5030902@wxs.nl>
References: <200903102336.n2ANaS213328@f7.net> <49B77A1D.5030902@wxs.nl>
Message-ID: <49B77B5C.8070001@elvenkind.com>



Hans Hagen wrote:
> 
> 2.1 Version information
> There are three new primitives to test the version of LuaTEX:
> primitive explanation
> \luatexversion a combination of major and minor number, as in pdfTEX;
> the current current value
> is 34
> \luatexrevision the revision, as in pdfTEX; the current value is 0
> \luatexdatestamp a combination of the local date and hour when the
> current executable was compiled,

And all three are available as keys in the lua 'tex' table:

\directlua0{
  print ('version:' .. tex.luatexversion)
  print ('revision:' .. tex.luatexrevision)
  print ('datestamp:' .. tex.luatexdatestamp)
}
\bye


Best wishes,
Taco

From oberdiek at uni-freiburg.de  Wed Mar 11 10:30:05 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 10:30:05 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B77188.5090903@elvenkind.com>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B77188.5090903@elvenkind.com>
Message-ID: <20090311093005.GA10178@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 09:08:40AM +0100, Taco Hoekwater wrote:

> Heiko Oberdiek wrote:
> >
> >BTW, from the experience of the history of pdfTeX, I would like
> >some version information in the LuaTeX manual:
> >* Mapping \luatexversion -> official LuaTeX version number
> 
> I do not understand what you mean.

Example pdfTeX:

* 100 <= \pdftexversion < 130:
  first number of \pdftexversion, ".",
  last two numbers of \pdftexversion, \pdftexrevision
  e.g. 1.10b
* \pdftexversion >= 130:
  first number of \pdftexversion, ".",
  last two numbers of \pdftexversion, ".", \pdftexrevision
  e.g. 1.40.9

> >* Version information for each feature/primitive, when
> >  it was introduced and when changes occur.
> 
> I can do that starting with the next version. But the manual
> may be incomplete for a while yet, this is not a top priority
> for me.

Thanks, it helps writing well behaving packages, e.g. (pseudo code):
  \IfUndefined{NiceFeature}{%
    \ErrorOrWarning{%
      \NiceFeature is not available,
      it was introduced in version x.y,
      update ...
    }%
  }{...}
Or
  \IfVersionGreaterXY{%
    Use \NiceFeature
  }{%
    Otherwise (workaround, less effective implementation, ...)
  }%

Yours sincerely  
  Heiko <oberdiek at uni-freiburg.de>

From oberdiek at uni-freiburg.de  Wed Mar 11 10:44:04 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 10:44:04 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7767E.8080007@wxs.nl>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
Message-ID: <20090311094403.GB10178@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 09:29:50AM +0100, Hans Hagen wrote:

> Heiko Oberdiek wrote:

> >\directlua{...} generates an error message for older versions,
> >because it requires a number for the lua state.
> >In newer versions the number shouldn't be given, because it
> >would cause a deprecation warning -- users always complain
> >about warnings. Thus the version information is already
> >needed at TeX level before switching to Lua.
> 
> we're talking of version 0.40 and onwards and the new syntax will be in 0.40
> 
> we don't care about < 0.40 and macro package support before 0.40

LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
some time, probably years, if not decades.
  Thus my concern is that using the syntax of version 0.40
will generate a low level error message, that cannot be understood
by the "normal" user, forcing him to ask in newsgroups and
mailing lists or even go away from LuaTeX.

> also, the syntax will not change that much as we will likely use the 
> number as alternative for the name directive (index in array then) so 
> that the syntax wil become
> 
> \dirextlua
>   [name {error message string}]
>   [optional number refering to error number string in table]

The plans for another change in syntax support the wish of
having \luatexversion at start time.

> >* Version information for each feature/primitive, when
> >  it was introduced and when changes occur.
> 
> at some point we will declare primitives/features stable (will happen 
> stepwise) and the manual will mention it for each (class of) primitives

Good. My wish would be that the version is remembered in the manual,
when the (class of) primitives has become stable.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From mpg at elzevir.fr  Wed Mar 11 10:55:21 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 10:55:21 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <200903110029.n2B0Tnr28624@f7.net>
References: <200903110029.n2B0Tnr28624@f7.net>
Message-ID: <49B78A89.2070304@elzevir.fr>

Karl Berry a ?crit :
>     Hum, there is currently no \directlua in XeTeX
> 
> I know that.
> 
I know you do. I was just under the impression that there was some confusion on
this point in some previous messages.

M.


From taco at elvenkind.com  Wed Mar 11 10:56:54 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 10:56:54 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311093005.GA10178@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B77188.5090903@elvenkind.com>
	<20090311093005.GA10178@irwin.vpn.uni-freiburg.de>
Message-ID: <49B78AE6.7030100@elvenkind.com>



Heiko Oberdiek wrote:
> On Wed, Mar 11, 2009 at 09:08:40AM +0100, Taco Hoekwater wrote:
> 
>> Heiko Oberdiek wrote:
>>> BTW, from the experience of the history of pdfTeX, I would like
>>> some version information in the LuaTeX manual:
>>> * Mapping \luatexversion -> official LuaTeX version number
>> I do not understand what you mean.
> 
> Example pdfTeX:
> 
> * 100 <= \pdftexversion < 130:
>   first number of \pdftexversion, ".",
>   last two numbers of \pdftexversion, \pdftexrevision
>   e.g. 1.10b
> * \pdftexversion >= 130:
>   first number of \pdftexversion, ".",
>   last two numbers of \pdftexversion, ".", \pdftexrevision
>   e.g. 1.40.9

I still don't get what you want from me. The \luatexversion and
\luatexrevision primitives behave exactly like the current
\pdftexversion and \pdftexrevision do.

If mean that you want that documented formally, can you quote me
the relevant section of the pdftex manual please?

Taco



From mpg at elzevir.fr  Wed Mar 11 10:59:33 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 10:59:33 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7700A.2000100@elvenkind.com>
References: <200903102336.n2ANaS213328@f7.net> <49B7058C.4050207@elzevir.fr>
	<49B7700A.2000100@elvenkind.com>
Message-ID: <49B78B85.3060806@elzevir.fr>

Taco Hoekwater a ?crit :
>> Well, I'm also for exposing only \directlua if there is a variable like
>> tex.luatexversion (or lua.luatexversion or whatever).
> 
> There is the variable tex.luatexversion; its current value is 35.
> 
Ok, great. I didn't find it at once in the manual. (Section 4.1.8 "last item
commands" does not seem such a natural place for it, IMO).

Manuel.

From pragma at wxs.nl  Wed Mar 11 11:00:52 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 11:00:52 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
Message-ID: <49B78BD4.8030706@wxs.nl>

Heiko Oberdiek wrote:
> On Wed, Mar 11, 2009 at 09:29:50AM +0100, Hans Hagen wrote:
> 
>> Heiko Oberdiek wrote:
> 
>>> \directlua{...} generates an error message for older versions,
>>> because it requires a number for the lua state.
>>> In newer versions the number shouldn't be given, because it
>>> would cause a deprecation warning -- users always complain
>>> about warnings. Thus the version information is already
>>> needed at TeX level before switching to Lua.
>> we're talking of version 0.40 and onwards and the new syntax will be in 0.40
>>
>> we don't care about < 0.40 and macro package support before 0.40
> 
> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
> some time, probably years, if not decades.
>   Thus my concern is that using the syntax of version 0.40
> will generate a low level error message, that cannot be understood
> by the "normal" user, forcing him to ask in newsgroups and
> mailing lists or even go away from LuaTeX.

well, it depends on how something is advertised ... any luatex based 
package writer should be honest and tell the users that they should
update package(s) and engine in sync which is actually no big deal 
nowadays in tex live (and norbert has been doing that for context for a 
long time now)

also, i think that most < 0.40 users are low level code hackers anyway -)

> Good. My wish would be that the version is remembered in the manual,
> when the (class of) primitives has become stable.

that's indeed the idea; probably startign with 0.50 (around eurotex) the 
first stabilization will take place

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Wed Mar 11 11:01:29 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 11:01:29 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
Message-ID: <49B78BF9.7030209@elvenkind.com>



Heiko Oberdiek wrote:
> On Wed, Mar 11, 2009 at 09:29:50AM +0100, Hans Hagen wrote:
> 
> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
> some time, probably years, if not decades.
>   Thus my concern is that using the syntax of version 0.40
> will generate a low level error message, that cannot be understood
> by the "normal" user, forcing him to ask in newsgroups and
> mailing lists or even go away from LuaTeX.

LuaTeX was added to TL 2008 with the explicit understanding that it
was experimental. If users decide to utterly disregard the manual
which says so clearly in red bold print on the first page, that is
their bad. We do not care.

Taco



From preining at logic.at  Wed Mar 11 11:05:24 2009
From: preining at logic.at (Norbert Preining)
Date: Wed, 11 Mar 2009 11:05:24 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
Message-ID: <20090311100524.GA10300@gamma.logic.tuwien.ac.at>

On Mi, 11 M?r 2009, Heiko Oberdiek wrote:
> > we don't care about < 0.40 and macro package support before 0.40
> 
> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
> some time, probably years, if not decades.

explicite statement that luatex is not stable, not even close to be
stable in any way. How many users are playing around currently with
luatex? Probably only context people and some others, but none of them
is a "plain-normal-TeX-user".

No, I would not care for 0.25 backward compatibility.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
FOINDLE (vb.)
To queue-jump very discreetly by working one's way up the line without
being spotted doing so.
			--- Douglas Adams, The Meaning of Liff

From pragma at wxs.nl  Wed Mar 11 11:06:30 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 11:06:30 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78B85.3060806@elzevir.fr>
References: <200903102336.n2ANaS213328@f7.net>
	<49B7058C.4050207@elzevir.fr>	<49B7700A.2000100@elvenkind.com>
	<49B78B85.3060806@elzevir.fr>
Message-ID: <49B78D26.6000508@wxs.nl>

Manuel P?gouri?-Gonnard wrote:

> Taco Hoekwater a ?crit :
>>> Well, I'm also for exposing only \directlua if there is a variable like
>>> tex.luatexversion (or lua.luatexversion or whatever).
>> There is the variable tex.luatexversion; its current value is 35.
>>
> Ok, great. I didn't find it at once in the manual. (Section 4.1.8 "last item
> commands" does not seem such a natural place for it, IMO).

page 7 mentions the version primitives, and a few pages later is 
explained that internal quantities are exposed in the tex namespace; the 
rest is explained where it makes most sense

also, i assume that in latex package writers have some helper command 
that tells them the version (after all, once all primitives are prefixed 
  by say 'privateluatex' or so those are the ones to be used in which 
case a latex dev manual has to be consulted so in fact the testing code 
has only to be written once

i'm not saying that the manual is perfect but mixing tex and lua 
sections will not help readability

ok, an index is missing but we will start with that after 0.50

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mpg at elzevir.fr  Wed Mar 11 11:12:00 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 11:12:00 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
Message-ID: <49B78E70.30900@elzevir.fr>

Heiko Oberdiek a ?crit :
> Thus the syntax change for \directlua (and perhaps later
> changes) vote for something extra:
> \luatexversion is a good choice in my opinion.

One can also think of the following compromise: continue exposing \luatexversion
as long as the \directlua syntax is not stable. Then expose only \directlua. So
on can use (pseudo-code)

\IfDefined{directlua}{%
  \IfDefined{luatexversion}{%
    % use \luatexversion
  }{%
    \directlua{%
    % or whatever the stable syntax of \directlua is
    if tex.luatexversion == nil then
      -- not running LuaTeX
    else
      -- use tex.luatexversion
    end
  }%
}

> It says in my eyes, `hey, I provide the features, described
> in the LuaTeX manual for the version number I return'.
> This is a clean way for testing without the need to use some
> complicate dubious heuristics.
> 
The above way be a bit more complicated than one could wish, but at least it's
not heuristic.

Manuel.


From mpg at elzevir.fr  Wed Mar 11 11:13:28 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 11:13:28 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78D26.6000508@wxs.nl>
References: <200903102336.n2ANaS213328@f7.net>	<49B7058C.4050207@elzevir.fr>	<49B7700A.2000100@elvenkind.com>	<49B78B85.3060806@elzevir.fr>
	<49B78D26.6000508@wxs.nl>
Message-ID: <49B78EC8.5080702@elzevir.fr>

Hans Hagen a ?crit :
> page 7 mentions the version primitives, and a few pages later is
> explained that internal quantities are exposed in the tex namespace; the
> rest is explained where it makes most sense
> 
Right, I missed that. Sorry.

> ok, an index is missing but we will start with that after 0.50
> 
Good news.

Manuel.



From martin at oneiros.de  Wed Mar 11 11:22:15 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 11 Mar 2009 11:22:15 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
Message-ID: <68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>

2009/3/11, Heiko Oberdiek <oberdiek at uni-freiburg.de>:
> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
>  some time, probably years, if not decades.

Hopefully not. Anyway, it's free software, so anybody can maintain it.
But please don't ask the luatex team to care about it.

Best
   Martin

From mpg at elzevir.fr  Wed Mar 11 11:38:48 2009
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 11 Mar 2009 11:38:48 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B778AF.20201@wxs.nl>
References: <5836.1236760091@cl.cam.ac.uk> <49B778AF.20201@wxs.nl>
Message-ID: <49B794B8.8020605@elzevir.fr>

Hans Hagen a ?crit :
> so, i'm not sure what critital backward compatibility you're refering to
> 
I think the point of this thread is not asking for backward compatibility. We
all know the current status of LuaTeX, and that development cannot happen with
strict backward compatibility. No-one is discussing the fact that almost
everything can change until version 1.0. We're just asking for a (stable) way to
deal with such instability.

A lot of people want to test LuaTeX. Macro writers want to write macro packages
with it, and then to have those macros tested by real users. So even if LuaTeX
should not be used for production now, it will indeed be used by "non-hacker"
users, at least for testing purpose. (And I guess it is the very reason why
LuaTeX is in TL'08.)

Now, not every TeX environment can offer such a high level of synchronisation
between executables and macros as ConTeXt distributions (the minimals and the
Debian packages) do. So outside ConTeXt it is useful for a macro writer to be
able to test for the engine and its version at runtime.

The point is: of course it is not an absolute need, but it will really make life
simpler. OTOH, I don't think that providing a simple an reliable detection
mechanism is a huge workload for Taco or you. Actually, I'm sure we already
spent more time discussing whether it is useful than Taco needs to design,
implement and document an unambiguous engine+version identification tool like
the one we're asking for.

Manuel.

From luatex at nililand.de  Wed Mar 11 11:48:18 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 11 Mar 2009 11:48:18 +0100
Subject: [luatex] Luatex primitive names
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<20090311100524.GA10300@gamma.logic.tuwien.ac.at>
Message-ID: <1sae5xak2zpqz$.dlg@nililand.de>

Am Wed, 11 Mar 2009 11:05:24 +0100 schrieb Norbert Preining:

>>> we don't care about < 0.40 and macro package support before 0.40
>> 
>> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
>> some time, probably years, if not decades.
> 
> explicite statement that luatex is not stable, not even close to be
> stable in any way. How many users are playing around currently with
> luatex? Probably only context people and some others, but none of them
> is a "plain-normal-TeX-user".

You should look e.g. at the discussions at the french group. The
curiosity is there and in my opinion it will grow fast.  

One should also not forget, that as luatex is now part of TeXLive
Luatex is now usable with LaTeX, and LaTeX makes it much more easier
to play around with luatex and to have some fun with it. There are a
lot of people around which are able to write small packages or
pieces of code which use the new features.

-- 
Ulrike Fischer 


From mpg at elzevir.fr  Wed Mar 11 11:49:34 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 11:49:34 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>
Message-ID: <49B7973E.8080805@elzevir.fr>

Martin Schr?der a ?crit :
> 2009/3/11, Heiko Oberdiek <oberdiek at uni-freiburg.de>:
>> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
>>  some time, probably years, if not decades.
> 
> Hopefully not.

It will. Some services widely-used by mathematicians, such as ArXiv, still use
teTeX2, and some universities do so. People (esp. sysadmin) don't upgrade their
TeX system as frequently as we TeXies could wish. This is a fact.

> Anyway, it's free software, so anybody can maintain it.
> But please don't ask the luatex team to care about it.
> 
Nobody wants to maintain an old version of LuaTeX. But a lot of macro writers
want to be able do deal with them, and are asking the for a reliable way to do it.

Manuel.

From preining at logic.at  Wed Mar 11 11:51:32 2009
From: preining at logic.at (Norbert Preining)
Date: Wed, 11 Mar 2009 11:51:32 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <1sae5xak2zpqz$.dlg@nililand.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<20090311100524.GA10300@gamma.logic.tuwien.ac.at>
	<1sae5xak2zpqz$.dlg@nililand.de>
Message-ID: <20090311105132.GB15239@gamma.logic.tuwien.ac.at>

On Mi, 11 M?r 2009, Ulrike Fischer wrote:
> One should also not forget, that as luatex is now part of TeXLive
> Luatex is now usable with LaTeX, and LaTeX makes it much more easier
> to play around with luatex and to have some fun with it. There are a

Not really usable lualatex 0.25 ...

> lot of people around which are able to write small packages or
> pieces of code which use the new features.

Then they should use a newer luatex. We are still in process to allow
updates of TL2008 installations with newer luatex using the same tlmgr
method.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
ADLESTROP (n.)
That part of a suitcase which is designed to get snarled up on
conveyor belts at airports. Some of the more modern adlestrop designs
have a special 'quick release' feature which enables the case to flip
open at this point and fling your underclothes into the conveyor
belt's gearing mechanism.
			--- Douglas Adams, The Meaning of Liff

From preining at logic.at  Wed Mar 11 11:52:45 2009
From: preining at logic.at (Norbert Preining)
Date: Wed, 11 Mar 2009 11:52:45 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7973E.8080805@elzevir.fr>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>
	<49B7973E.8080805@elzevir.fr>
Message-ID: <20090311105245.GC15239@gamma.logic.tuwien.ac.at>

On Mi, 11 M?r 2009, Manuel P?gouri?-Gonnard wrote:
> It will. Some services widely-used by mathematicians, such as ArXiv, still use
> teTeX2, and some universities do so. People (esp. sysadmin) don't upgrade their
> TeX system as frequently as we TeXies could wish. This is a fact.

But they will not *use* luatex. Yes, it will be present, but who will
use it? Do you expect that ArXiv is switching to luatex, or any other of
these systems? THere aren't enough people to support that in any way.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
SPROSTON GREEN (n.)
The violent colour of one of Nigel Rees's jackets, worn when he thinks
he's being elegant.
			--- Douglas Adams, The Meaning of Liff

From pragma at wxs.nl  Wed Mar 11 12:10:36 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 12:10:36 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B7973E.8080805@elzevir.fr>
References: <49B629D1.9080501@elvenkind.com>	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>	<68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>
	<49B7973E.8080805@elzevir.fr>
Message-ID: <49B79C2C.9020404@wxs.nl>

Manuel P?gouri?-Gonnard wrote:
> Martin Schr?der a ?crit :
>> 2009/3/11, Heiko Oberdiek <oberdiek at uni-freiburg.de>:
>>> LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
>>>  some time, probably years, if not decades.
>> Hopefully not.
> 
> It will. Some services widely-used by mathematicians, such as ArXiv, still use
> teTeX2, and some universities do so. People (esp. sysadmin) don't upgrade their
> TeX system as frequently as we TeXies could wish. This is a fact.

unless they have a full time staff to deal with bugs and such i'd advise 
them not to start using luatex before 2012 (when version 1.0 is 
expected) and even they they'd better wait stil the situation is stabelized

- it took a while before pdftex became widely used
- it took a while before latin modern was accepted

etc. also, archives should keep old tex's, old macros, old fonts, old 
patterns around forever

> Nobody wants to maintain an old version of LuaTeX. But a lot of macro writers
> want to be able do deal with them, and are asking the for a reliable way to do it.

hm, macro writers that want to deal with all versions of luatex pre 
(say) 0.5 must have plenty of spare time then

i myself follow the simple route ... if you want to use luatex (pre 1.0)

-- update binaries frequently
-- update the macro package at the same time
-- for that use regular updatable distributions

as tex live supports updating and as norbert posts packages for linux 
and as akira provides the latest greatest as well for windows i see no 
problem

we only feel comitted to stability once we have released 1.0 but you can 
bet that before that arrives much is already pretty stable

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 11 12:20:38 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 12:20:38 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78E70.30900@elzevir.fr>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B78E70.30900@elzevir.fr>
Message-ID: <49B79E86.8050901@wxs.nl>

Manuel P?gouri?-Gonnard wrote:
> Heiko Oberdiek a ?crit :
>> Thus the syntax change for \directlua (and perhaps later
>> changes) vote for something extra:
>> \luatexversion is a good choice in my opinion.
> 
> One can also think of the following compromise: continue exposing \luatexversion
> as long as the \directlua syntax is not stable. Then expose only \directlua. So
> on can use (pseudo-code)
> 
> \IfDefined{directlua}{%
>   \IfDefined{luatexversion}{%
>     % use \luatexversion
>   }{%
>     \directlua{%
>     % or whatever the stable syntax of \directlua is
>     if tex.luatexversion == nil then
>       -- not running LuaTeX
>     else
>       -- use tex.luatexversion
>     end
>   }%
> }

\ifdefined\directlua
   \ifdefined\luatexversion \else
     \edef\luatexversion{\directlua0{tex.print(tex.luatexversion}}
   \fi
\fi

now, since pre 0.40 all primitives are there anyway and since no 
primitives other than \directlua are available 0.4 upwards ...

\ifdefined\directlua
   \ifdefined\luatexversion \else
     \edef\luatexversion
       {\directlua\ifdefined\latelua0\fi{tex.print(tex.luatexversion}}
   \fi
\fi

or something like that (well, not that i'd do it that way myself but ...)

also, as said before, the \directlua syntax *will be stable* in 0.40

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luatex at nililand.de  Wed Mar 11 12:24:04 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 11 Mar 2009 12:24:04 +0100
Subject: [luatex] Luatex primitive names
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<20090311100524.GA10300@gamma.logic.tuwien.ac.at>
	<1sae5xak2zpqz$.dlg@nililand.de>
	<20090311105132.GB15239@gamma.logic.tuwien.ac.at>
Message-ID: <1m69b606xzzhr.dlg@nililand.de>

Am Wed, 11 Mar 2009 11:51:32 +0100 schrieb Norbert Preining:

>> One should also not forget, that as luatex is now part of TeXLive
>> Luatex is now usable with LaTeX, and LaTeX makes it much more easier
>> to play around with luatex and to have some fun with it. There are a
 
> Not really usable lualatex 0.25 ...
 
>> lot of people around which are able to write small packages or
>> pieces of code which use the new features.
 
> Then they should use a newer luatex. We are still in process to allow
> updates of TL2008 installations with newer luatex using the same tlmgr
> method.

Sure. But even if all user now use the current version (0.35?) and
we forget that older version ever exists there is a the need to be
able to identifying luatex and its version. 

-- 
Ulrike Fischer 


From mpg at elzevir.fr  Wed Mar 11 12:26:39 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 12:26:39 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311105245.GC15239@gamma.logic.tuwien.ac.at>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>	<68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>	<49B7973E.8080805@elzevir.fr>
	<20090311105245.GC15239@gamma.logic.tuwien.ac.at>
Message-ID: <49B79FEF.6030300@elzevir.fr>

Norbert Preining a ?crit :
> On Mi, 11 M?r 2009, Manuel P?gouri?-Gonnard wrote:
>> It will. Some services widely-used by mathematicians, such as ArXiv, still use
>> teTeX2, and some universities do so. People (esp. sysadmin) don't upgrade their
>> TeX system as frequently as we TeXies could wish. This is a fact.
> 
> But they will not *use* luatex. Yes, it will be present, but who will
> use it? Do you expect that ArXiv is switching to luatex, or any other of
> these systems?

Of course not. I just took the first well-known example of an *old* TeX system
still widely used today. The point is that today a lot years-old TeX systems are
still around, so I can't see any reason why some TL'08 will not be around in
2013 in some server in some university.

Now imagine, in 2013, a math student just beginning with LaTeX. He hears from a
friend that if he wants to have such or such great functionality (eg the latest
version of breqn heavily relying on LuaTeX) all he has to do is to put
\usepackage{breqn} in his preamble and compile with the pdflualatex command.
Hopefully, there is a pdflualatex button in the latest version of texworks he's
using at home on top of his brand new TL'13. He adds the line in his code,
clicks the button, everything works: hurray, he loves LaTeX!

Then he wants to compile his document on his university's servers, or send him
to a friend, still using and older TL. First, since the GUI there is not as
modern as his version, he doesn't use the correct command to compile. There the
macro package must be able to detect the problem and issue a meaningful error
message.

He finally manages to set the correct compilation command and tries to compile.
If his version of LuaTeX is too old and cannot run the latest version of breqn,
or breqn wants to adapt his code to an older syntax of equivalent primitives,
then the macro package needs to be able to detect the version and possibly issue
a meaningful error message.

All it takes to provide those meaningful error messages is a reliable mechanism
allowing macro writers to detect the engine and its version at runtime. And
providing such a mechanism costs essentially nothing.

Please note that in the above scenario no one is using LuaTeX before it becomes
 stable. The only assumption made is that there will still be pre-0.5 versions
around when 1.0 will be out. And I repeat: given the age of the TeX systems
still being used today, this case will most certainly happen.

Manuel.

From mpg at elzevir.fr  Wed Mar 11 12:32:14 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 12:32:14 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B79E86.8050901@wxs.nl>
References: <49B629D1.9080501@elvenkind.com>	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B78E70.30900@elzevir.fr>
	<49B79E86.8050901@wxs.nl>
Message-ID: <49B7A13E.5010007@elzevir.fr>

Hans Hagen a ?crit :
> now, since pre 0.40 all primitives are there anyway and since no
> primitives other than \directlua are available 0.4 upwards ...
> [...]
> also, as said before, the \directlua syntax *will be stable* in 0.40
> 
Ok, I'm happy with that. There would have been problems if \directlua's
stabilisation happened later, but since you say it will be stable as soon as
\luatexversion is no more exposed, everything's fine.

Manuel.


From oberdiek at uni-freiburg.de  Wed Mar 11 12:22:41 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 12:22:41 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311100524.GA10300@gamma.logic.tuwien.ac.at>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<20090311100524.GA10300@gamma.logic.tuwien.ac.at>
Message-ID: <20090311112240.GC11661@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 11:05:24AM +0100, Norbert Preining wrote:

> On Mi, 11 M?r 2009, Heiko Oberdiek wrote:
> > > we don't care about < 0.40 and macro package support before 0.40
> > 
> > LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
> > some time, probably years, if not decades.
> 
> explicite statement that luatex is not stable, not even close to be
> stable in any way. How many users are playing around currently with
> luatex? Probably only context people and some others, but none of them
> is a "plain-normal-TeX-user".
> 
> No, I would not care for 0.25 backward compatibility.

A package might want to use features of LuaTeX, if it is available,
e.g. some problem can be solved in a better or more robust way
using Lua and it doesn't matter, how old LuaTeX is.
\luatexversion helps doing this without bothering the user
with details or even low level error messages. And \directlua
can then be used without dependency from the format that is used.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From oberdiek at uni-freiburg.de  Wed Mar 11 12:26:59 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 12:26:59 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78E70.30900@elzevir.fr>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B78E70.30900@elzevir.fr>
Message-ID: <20090311112658.GD11661@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 11:12:00AM +0100, Manuel P?gouri?-Gonnard wrote:

> Heiko Oberdiek a ?crit :
> > Thus the syntax change for \directlua (and perhaps later
> > changes) vote for something extra:
> > \luatexversion is a good choice in my opinion.
> 
> One can also think of the following compromise: continue exposing \luatexversion
> as long as the \directlua syntax is not stable. Then expose only \directlua. So
> on can use (pseudo-code)
> 
> \IfDefined{directlua}{%
>   \IfDefined{luatexversion}{%
>     % use \luatexversion
>   }{%
>     \directlua{%
>     % or whatever the stable syntax of \directlua is
>     if tex.luatexversion == nil then
>       -- not running LuaTeX
>     else
>       -- use tex.luatexversion
>     end
>   }%
> }

Thanks.

> > It says in my eyes, `hey, I provide the features, described
> > in the LuaTeX manual for the version number I return'.
> > This is a clean way for testing without the need to use some
> > complicate dubious heuristics.
> > 
> The above way be a bit more complicated than one could wish,

The past has shown, that already \pdfoutput is too complicated.
That's my point, to make this basic stuff easy.
  Also the manual would be shorter. The poor manual writer
would have to explain a complicate algorithm only to get
the version number.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From oberdiek at uni-freiburg.de  Wed Mar 11 12:15:16 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 12:15:16 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78BD4.8030706@wxs.nl>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<49B78BD4.8030706@wxs.nl>
Message-ID: <20090311111515.GB11661@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 11:00:52AM +0100, Hans Hagen wrote:

> Heiko Oberdiek wrote:
> >
> >LuaTeX 0.25 is part of TL 2008, thus it will be significantly present
> >some time, probably years, if not decades.
> >  Thus my concern is that using the syntax of version 0.40
> >will generate a low level error message, that cannot be understood
> >by the "normal" user, forcing him to ask in newsgroups and
> >mailing lists or even go away from LuaTeX.
> 
> well, it depends on how something is advertised ... any luatex based 
> package writer should be honest and tell the users that they should
> update package(s)

I don't have the phone numbers of the users. Ok, joke aside.
AFAIK the best way of telling is an appropriate error message:

\IfVersionIsTooOld{%
  \DieWithError{Please Update}%
}

My concern is the definition of \IfVersionIsTooOld.
How it can be done in a *robust* and *reliable* way?
\luatexversion seems the easiest way with lowest costs.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From oberdiek at uni-freiburg.de  Wed Mar 11 12:11:24 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 12:11:24 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B78AE6.7030100@elvenkind.com>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B77188.5090903@elvenkind.com>
	<20090311093005.GA10178@irwin.vpn.uni-freiburg.de>
	<49B78AE6.7030100@elvenkind.com>
Message-ID: <20090311111123.GA11661@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 10:56:54AM +0100, Taco Hoekwater wrote:

> I still don't get what you want from me. The \luatexversion and
> \luatexrevision primitives behave exactly like the current
> \pdftexversion and \pdftexrevision do.

Manual (sorry, for 0.25):

| \luatexversion  A combination of major and minor number, as in pdfTeX.
| Current value: 25
| \luatexrevision The revision, as in pdfTeX. Current value: 2

Assuming I want to print the version number (e.g. for /Producer
information entry): What is the algorithm to get the version?
>From this description I would assume 25.2, but luatex prints
its version number as 0.25.2

What changes with version 1.0? Or is it 1.00?

A guess of the algorithm, I am not sure that this is correct:

* "major number": \the\luatexversion / 100 (integer division)
* "minor number": \the\luatexversion % 100 (modulo operation), two digits
* "revision number": \luatexrevision

> If mean that you want that documented formally, can you quote me
> the relevant section of the pdftex manual please?

Isn't too clear either:
* minor version: Are this one or two digits?
  e.g. 1.7.4 or 1.07.4?
* All numbers starts with zero? e.g. in principle:
  0.00.0, 0.00.1, ... 0.01.0, ... 1.00.0, ...

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From mpg at elzevir.fr  Wed Mar 11 12:51:09 2009
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 11 Mar 2009 12:51:09 +0100
Subject: [luatex] Proposal to fix the namespace argument
In-Reply-To: <gp79s2$mcs$1@ger.gmane.org>
References: <govr04$k7s$1@ger.gmane.org>
	<200903092232.n29MWfY23850@f7.net>	<gp485m$3hm$1@ger.gmane.org>
	<200903110055.n2B0tAY03266@f7.net> <gp79s2$mcs$1@ger.gmane.org>
Message-ID: <49B7A5AD.80604@elzevir.fr>

Will Robertson a ?crit :
> If there's anyone else here that can write the ini file, I'd be
> appreciative :)
> 
I can take care of it. But someone (you or the LaTeX team) has to take the
decision and tell me what should be done with the primitives (exposing, not
exposing, prefixing, exposing only pdftex primitives, etc).

I suggest we continue this discussion off-list.

Manuel.

From taco at elvenkind.com  Wed Mar 11 12:58:29 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Mar 2009 12:58:29 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311111123.GA11661@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B77188.5090903@elvenkind.com>	<20090311093005.GA10178@irwin.vpn.uni-freiburg.de>	<49B78AE6.7030100@elvenkind.com>
	<20090311111123.GA11661@irwin.vpn.uni-freiburg.de>
Message-ID: <49B7A765.4040206@elvenkind.com>

Heiko Oberdiek wrote:
> 
> A guess of the algorithm, I am not sure that this is correct:
> 
> * "major number": \the\luatexversion / 100 (integer division)
> * "minor number": \the\luatexversion % 100 (modulo operation), two digits
> * "revision number": \luatexrevision

That is the correct algorithm.

Best wishes,
Taco

From pragma at wxs.nl  Wed Mar 11 13:13:27 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 13:13:27 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <49B79FEF.6030300@elzevir.fr>
References: <49B629D1.9080501@elvenkind.com>	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>	<68c491a60903110322j4aa4df12o9fe1fb0b1ed34152@mail.gmail.com>	<49B7973E.8080805@elzevir.fr>	<20090311105245.GC15239@gamma.logic.tuwien.ac.at>
	<49B79FEF.6030300@elzevir.fr>
Message-ID: <49B7AAE7.9050300@wxs.nl>

Manuel P?gouri?-Gonnard wrote:

> Of course not. I just took the first well-known example of an *old* TeX system
> still widely used today. The point is that today a lot years-old TeX systems are
> still around, so I can't see any reason why some TL'08 will not be around in
> 2013 in some server in some university.

maybe best compare it with the tex prototypes before tex was officially 
launched, in that sense luatex has some way to go

anyway, if they depend on tl 2008 then they can just use that tex tree; 
as soon as they update macros to 2009 they also update the engines; it 
is no problem to run old and new trees alongside; if a sysadm is willing 
to update the macro then updating the engines can be mandate

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From javier at digi21.eu  Wed Mar 11 13:16:27 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 11 Mar 2009 13:16:27 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
Message-ID: <5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>

If we (well, not me, the LuaTeX team) states in bold, red, at the
first page, that "Absolutely nothing on the following pages is set in
stone. When the need arises, anything can (and will) be changed
without prior notice." is precisely to avoid starting this soon to
care about backward compatibility, and to be free to make changes that
seem worth making even if they brake previous version's code.

Somebody in this thread stated that he dind't care about absolute
backward compatibility before reaching version 1.0. Well, I would be
more radical and say that don't care about backward compatibility *at
all*.

>Then he wants to compile his document on his university's servers, or send him
>to a friend, still using and older TL.
...
>Please note that in the above scenario no one is using LuaTeX before it becomes
>stable. The only assumption made is that there will still be pre-0.5 versions
>around when 1.0 will be out. And I repeat: given the age of the TeX systems
>still being used today, this case will most certainly happen.

It is enough that somebody tell him that LuaTeX is a program from 2012
and so he cannot compile with older software. Indeed, he would most
likely ask the friend who suggested him the use of luatex what's the
problem and he will get the answer from him that he has to use a
recent Latex version.

So simply write \directlua. If you want to play with LuaTeX before
version 0.4 (or 0.5, whenever the syntax is changed) just write
\directlua0 meanwhile, but anybody writin packages for luatex versions
before 1.0 is liable to keeping  the code updated.

If I ever write a package for luatex, after version 1.0 is removed, I
will not attempt any single backward compatibily for versions that
still carry the warning "anything can (and will) be changed without
prior notice".


But I don't understand why package writters insist on testing for the
version instead of testing for the existence of the command they want
to use. For example, the package microtype has several of

\ifnum\pdftexversion>1.x
  <some code using a new primitive>
\else
  <some other code>
\fi

one of them test for version >1.5 (or 1.6) in order to use \pdfstrcmp.
Now this is wrong with luatex because the test for the version is true
but the primitive has been removed. It would be just as easy to
directly test the existence of \pdfstrcmp or that it equals
\pdfprimitive\pdfstrcmp (I have never used \pdfprimitive, so dont take
literally this code but read what I mean)

Javier A.

From oberdiek at uni-freiburg.de  Wed Mar 11 13:35:33 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 13:35:33 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
Message-ID: <20090311123532.GA13272@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 01:16:27PM +0100, Javier M?gica wrote:

> But I don't understand why package writters insist on testing for the
> version instead of testing for the existence of the command they want
> to use.

* With next LuaTeX, the command (except \directlua) is still there,
  but its name is unknown. Therefore the test for the existence fails.
* The existence of a command doesn't say anything about its
  version dependend syntax, semantics and version specific bugs.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From javier at digi21.eu  Wed Mar 11 13:44:22 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 11 Mar 2009 13:44:22 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
Message-ID: <5088e64f0903110544w1fdbd497rd9cadb7dd1f5e15f@mail.gmail.com>

>The existence of a command doesn't say anything about its
> version dependend syntax, semantics and version specific bugs.

Sorry, I meant why don't they test for the existence or the syntax of
the command when that is possible (as in the example of \pdfstrcmp).

From oberdiek at uni-freiburg.de  Wed Mar 11 13:56:03 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 11 Mar 2009 13:56:03 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903110544w1fdbd497rd9cadb7dd1f5e15f@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
	<5088e64f0903110544w1fdbd497rd9cadb7dd1f5e15f@mail.gmail.com>
Message-ID: <20090311125603.GA14307@irwin.vpn.uni-freiburg.de>

On Wed, Mar 11, 2009 at 01:44:22PM +0100, Javier M?gica wrote:

> >The existence of a command doesn't say anything about its
> > version dependend syntax, semantics and version specific bugs.
> 
> Sorry, I meant why don't they test for the existence or the syntax of
> the command when that is possible (as in the example of \pdfstrcmp).

Yes, your example shows, that care is also necessary for
the version checks (not checking \pdfstrcmp, but \pdftexversion).
Also there may be other engines that provide the same feature as well,
e.g. \pdfsavepos is also supported by XeTeX.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From mpg at elzevir.fr  Wed Mar 11 14:41:40 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 14:41:40 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<5088e64f0903110516h6bd81a18i7977ca08b8779b1d@mail.gmail.com>
Message-ID: <49B7BF94.4090802@elzevir.fr>

Javier M?gica a ?crit :
>> Please note that in the above scenario no one is using LuaTeX before it becomes
>> stable. The only assumption made is that there will still be pre-0.5 versions
>> around when 1.0 will be out. And I repeat: given the age of the TeX systems
>> still being used today, this case will most certainly happen.
> 
> It is enough that somebody tell him that LuaTeX is a program from 2012
> and so he cannot compile with older software. Indeed, he would most
> likely ask the friend who suggested him the use of luatex what's the
> problem and he will get the answer from him that he has to use a
> recent Latex version.
> 
So we just don't live in the same world. In my real world with the users I know,
 things don't work like that. People don't always have a TeX-knowledgeable
friend (ok, my example was bad: suppose they copied the code from a random web
page (which real users often do) or heard it from someone who heard it from
someone who... etc.), and are often easily scared by such cryptic error messages
as TeX produces so often.

In a general way, it's surprising how few they daily users, such as
mathematicians, understand about TeX in general and especially their TeX
installation. (Guess how many OS X users answer TeXShop when you ask which TeX
distribution they use? Now imagine about the version.)

Anyway, using \luatexversion + \directlua{tex.luatexversion} solves the problem,
so the discussion ends here for me.

Manuel.


From luatex at nililand.de  Wed Mar 11 14:46:41 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 11 Mar 2009 14:46:41 +0100
Subject: [luatex] Luatex primitive names
References: <5088e64f0903100445k42628ccfi85e3cd700ca2b380@mail.gmail.com>
	<20090310144747.GE23064@phare.normalesup.org>
	<49B6B9A6.4010708@elzevir.fr>
Message-ID: <4lso4sgewufo$.dlg@nililand.de>

Am Tue, 10 Mar 2009 20:04:06 +0100 schrieb Manuel P?gouri?-Gonnard:

> Sorry but I don't agree. Detecting the version (if a convenient mechanism is
> available) costs essentially nothing and can make things simpler for users,
> which is always important, even in beta stage, IMHO.

That reminds me that some days ago I look for some informations
about the cost involved in extending the license for the virus
programm I got together with my new PC. 

The link "How do I find my version?" lead to the following advice:

"1 Start your XYZ product. 
2 On the main product window, look for the product name. 

In XYZ 360 2.0, the product name will be displayed at the top-left
corner, and you can find Help & Support on top-right corner. 

For example, the latest version of XYZ 360 2.0 looks like the one
below:

If your XYZ 360 looks like the one below, then you have XYZ 360 1.0:

In XYZ 2009 products, the product name will be displayed at the
top-left corner. 

For example, this is XYZ Internet Security 2009:

...."

Putting a product and version info in the help menu like any other
decent application was obviously to difficult.



-- 
Ulrike Fischer 


From hartmut_henkel at gmx.de  Wed Mar 11 20:56:58 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed, 11 Mar 2009 20:56:58 +0100 (CET)
Subject: [luatex] Luatex primitive names
In-Reply-To: <20090311111515.GB11661@irwin.vpn.uni-freiburg.de>
References: <49B629D1.9080501@elvenkind.com> <200903102336.n2ANaS213328@f7.net>
	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>
	<49B7767E.8080007@wxs.nl>
	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>
	<49B78BD4.8030706@wxs.nl>
	<20090311111515.GB11661@irwin.vpn.uni-freiburg.de>
Message-ID: <alpine.DEB.1.00.0903112053330.4253@hahepc1.hahe>

On Wed, 11 Mar 2009, Heiko Oberdiek wrote:

> On Wed, Mar 11, 2009 at 11:00:52AM +0100, Hans Hagen wrote:
> > Heiko Oberdiek wrote:
>
> My concern is the definition of \IfVersionIsTooOld. How it can be done
> in a *robust* and *reliable* way? \luatexversion seems the easiest way
> with lowest costs.

one could probably add something like this to the greeting text:

This is LuaTeX, Version snapshot-0.36.0-2009031100 (Web2C 7.5.7)
Beware: this version is outdated, please upgrade.
**

Regards, Hartmut
:-)

From Robin.Fairbairns at cl.cam.ac.uk  Wed Mar 11 21:01:10 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 11 Mar 2009 20:01:10 +0000
Subject: [luatex] Luatex primitive names
In-Reply-To: Your message of Wed, 11 Mar 2009 20:56:58 +0100.
	<alpine.DEB.1.00.0903112053330.4253@hahepc1.hahe>
Message-ID: <12050.1236801670@cl.cam.ac.uk>

Hartmut Henkel <hartmut_henkel at gmx.de> wrote:

> On Wed, 11 Mar 2009, Heiko Oberdiek wrote:
> 
> > On Wed, Mar 11, 2009 at 11:00:52AM +0100, Hans Hagen wrote:
> > > Heiko Oberdiek wrote:
> >
> > My concern is the definition of \IfVersionIsTooOld. How it can be done
> > in a *robust* and *reliable* way? \luatexversion seems the easiest way
> > with lowest costs.
> 
> one could probably add something like this to the greeting text:
> 
> This is LuaTeX, Version snapshot-0.36.0-2009031100 (Web2C 7.5.7)
> Beware: this version is outdated, please upgrade.
> **

what's more, i actually started to consider how one might do this.

then i noticed:

> :-)

a rotten trick to play :-}

robin

From mpg at elzevir.fr  Wed Mar 11 21:09:52 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 11 Mar 2009 21:09:52 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <alpine.DEB.1.00.0903112053330.4253@hahepc1.hahe>
References: <49B629D1.9080501@elvenkind.com>
	<200903102336.n2ANaS213328@f7.net>	<20090311005332.GA6997@irwin.vpn.uni-freiburg.de>	<49B7767E.8080007@wxs.nl>	<20090311094403.GB10178@irwin.vpn.uni-freiburg.de>	<49B78BD4.8030706@wxs.nl>	<20090311111515.GB11661@irwin.vpn.uni-freiburg.de>
	<alpine.DEB.1.00.0903112053330.4253@hahepc1.hahe>
Message-ID: <49B81A90.8000201@elzevir.fr>

Hartmut Henkel a ?crit :
> one could probably add something like this to the greeting text:
> 
> This is LuaTeX, Version snapshot-0.36.0-2009031100 (Web2C 7.5.7)
> Beware: this version is outdated, please upgrade.
> **
> 
> Regards, Hartmut
> :-)

:-D

Manuel.

From patrick at gundla.ch  Wed Mar 11 21:16:14 2009
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 11 Mar 2009 21:16:14 +0100
Subject: [luatex] repository move?
Message-ID: <m1sklj3je9.fsf@levana.de>

Hi,

I try to update the source tree via svn update, but the hostname
scm.foundry...  is gone. Did I miss any mail on the list? I the
repository gone? Moved?


Patrick

From luigi.scarso at gmail.com  Wed Mar 11 21:19:17 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 11 Mar 2009 21:19:17 +0100
Subject: [luatex] repository move?
In-Reply-To: <m1sklj3je9.fsf@levana.de>
References: <m1sklj3je9.fsf@levana.de>
Message-ID: <fe8d59da0903111319l65b6bd70s86da53fb00016941@mail.gmail.com>

On Wed, Mar 11, 2009 at 9:16 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Hi,
>
> I try to update the source tree via svn update, but the hostname
> scm.foundry... ?is gone. Did I miss any mail on the list? I the
> repository gone? Moved?
>
>
> Patrick
>

svn checkout svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.35.0

works ok here
Estratta revisione 1986.

-- 
luigi

From hartmut_henkel at gmx.de  Wed Mar 11 21:22:21 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Wed, 11 Mar 2009 21:22:21 +0100 (CET)
Subject: [luatex] repository move?
In-Reply-To: <m1sklj3je9.fsf@levana.de>
References: <m1sklj3je9.fsf@levana.de>
Message-ID: <alpine.DEB.1.00.0903112119001.28460@hahepc1.hahe>

On Wed, 11 Mar 2009, Patrick Gundlach wrote:

> I try to update the source tree via svn update, but the hostname
> scm.foundry...  is gone. Did I miss any mail on the list? I the
> repository gone? Moved?

it's something weird with a name server (at some provider?), a problem
since a few days already. Don't know why, but here on my PC it helps to
stop and start bind9 (a few times) -- and suddenly the page is back.

Regards, Hartmut

From elie.roux at telecom-bretagne.eu  Wed Mar 11 21:24:12 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 11 Mar 2009 21:24:12 +0100
Subject: [luatex] repository move?
In-Reply-To: <m1sklj3je9.fsf@levana.de>
References: <m1sklj3je9.fsf@levana.de>
Message-ID: <49B81DEC.80802@telecom-bretagne.eu>

Patrick Gundlach a ?crit :
> I try to update the source tree via svn update, but the hostname
> scm.foundry...  is gone. Did I miss any mail on the list? I the
> repository gone? Moved?
>   

Sometimes supelec.fr is totally offline, and they have their own dns 
server, so sometimes the host is unreachable...
-- 
Elie

From pragma at wxs.nl  Wed Mar 11 21:39:24 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 21:39:24 +0100
Subject: [luatex] repository move?
In-Reply-To: <49B81DEC.80802@telecom-bretagne.eu>
References: <m1sklj3je9.fsf@levana.de> <49B81DEC.80802@telecom-bretagne.eu>
Message-ID: <49B8217C.6000306@wxs.nl>

Elie Roux wrote:
> Patrick Gundlach a ?crit :
>> I try to update the source tree via svn update, but the hostname
>> scm.foundry...  is gone. Did I miss any mail on the list? I the
>> repository gone? Moved?
>>   
> 
> Sometimes supelec.fr is totally offline, and they have their own dns 
> server, so sometimes the host is unreachable...

fabrice will upgrade the machinery soon

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Mar 11 21:45:14 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 11 Mar 2009 21:45:14 +0100
Subject: [luatex] Luatex primitive names
In-Reply-To: <12050.1236801670@cl.cam.ac.uk>
References: <12050.1236801670@cl.cam.ac.uk>
Message-ID: <49B822DA.4010108@wxs.nl>

Robin Fairbairns wrote:
> Hartmut Henkel <hartmut_henkel at gmx.de> wrote:
> 
>> On Wed, 11 Mar 2009, Heiko Oberdiek wrote:
>>
>>> On Wed, Mar 11, 2009 at 11:00:52AM +0100, Hans Hagen wrote:
>>>> Heiko Oberdiek wrote:
>>> My concern is the definition of \IfVersionIsTooOld. How it can be done
>>> in a *robust* and *reliable* way? \luatexversion seems the easiest way
>>> with lowest costs.
>> one could probably add something like this to the greeting text:
>>
>> This is LuaTeX, Version snapshot-0.36.0-2009031100 (Web2C 7.5.7)
>> Beware: this version is outdated, please upgrade.
>> **
> 
> what's more, i actually started to consider how one might do this.

ok, for your eyes only ...

         callback.register('start_run', function()
             texio.write_nl("Beware Robin: you run an outdated version 
of LuaTeX.")
         end


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wspr81 at gmail.com  Fri Mar 13 01:30:13 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 13 Mar 2009 11:00:13 +1030
Subject: [luatex] \primitive and disabled primitives
Message-ID: <gpc9em$u5t$1@ger.gmane.org>

Hi Taco,

Let's say with this syntax to conditionally enable new primitives 
syntax I select just \primitive. What would
    \primitive\<any other LuaTeX primitive>
tell me?

I'm expecting that it would work as if the argument to \primitive 
wasn't actually a primitive (whether defined or not), but I just wanted 
to check.

Will



From taco at elvenkind.com  Fri Mar 13 08:39:41 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 13 Mar 2009 08:39:41 +0100
Subject: [luatex] \primitive and disabled primitives
In-Reply-To: <gpc9em$u5t$1@ger.gmane.org>
References: <gpc9em$u5t$1@ger.gmane.org>
Message-ID: <49BA0DBD.7000000@elvenkind.com>

Will Robertson wrote:
> Hi Taco,
> 
> Let's say with this syntax to conditionally enable new primitives syntax 
> I select just \primitive. What would
>    \primitive\<any other LuaTeX primitive>
> tell me?
> 
> I'm expecting that it would work as if the argument to \primitive wasn't 
> actually a primitive (whether defined or not), but I just wanted to check.

My plan is to keep it behaving just like it does now: it will execute
the primitive attached to the name given (assuming that is indeed part
of the core).

Whether or not there is a current control sequence that can run this
primitive is irrelevant to \primitive because it has its own private
hash (that hash will also be used to implement the new functionality).

The intention behind \primitive is to retain access to otherwise
unreachable primitives, so offering access to hitherto unreachable
primitives seems to most logical extension to its functionality.

Another reason is that otherwise I would have to keep track of
whether a primitive has in fact been enabled, while with the proposed
solution I can just create the csname entries and forget about it.


Best wishes,
Taco

From wspr81 at gmail.com  Fri Mar 13 15:49:11 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sat, 14 Mar 2009 01:19:11 +1030
Subject: [luatex] \primitive and disabled primitives
References: <gpc9em$u5t$1@ger.gmane.org> <49BA0DBD.7000000@elvenkind.com>
Message-ID: <gpdrp6$uk5$1@ger.gmane.org>

On 2009-03-13 18:09:41 +1030, Taco Hoekwater 
<taco at elvenkind.com> said:

> The intention behind \primitive is to retain access to otherwise
> unreachable primitives, so offering access to hitherto unreachable
> primitives seems to most logical extension to its functionality.

I agree with this functionality, thanks for the clarification.

Will



From elie.roux at telecom-bretagne.eu  Sat Mar 14 09:58:27 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Mar 2009 09:58:27 +0100
Subject: [luatex] luatextra font system
Message-ID: <49BB71B3.2070703@telecom-bretagne.eu>

Hello,

I'm starting to work on the fontenc package, and here are a few 
thoughts, I think it's important:

First people using a 8-bit encoding and a standard fontenc won't have 
any problem. The problems will start with people using utf8. The most 
logical way to go is (tell me if I'm wrong) to load the eu1 encoding. 
I've tested it a little, it works fine with, for instance (if you create 
eu1ptm.fd):

\usepackage{times}
\usepackage[EU1]{fontenc}

The main problem with EU1 encoding, is that it's XeTeX oriented, so it 
calls fonts with the XeTeX syntax, which means \font="[file]" for files 
in the TDS. I don't really understand why XeTeX did such an incompatible 
font syntax, but it's done... So there are two solutions: adapting EU1 
and adapting LuaTeX... I already made a parser for the complete XeTeX 
syntax in LuaTeX so the technical part is not really a problem, but it 
means that people will have to load luatextra before fontenc, otherwise 
they'll get an error... I'll try to adapt eu1 for LuaTeX with Will.

Another problem with EU1 encoding is that almost no font understands the 
EU1 encoding: there are t1*.fd and ot1*.fd for every font, but no 
eu1*.fd. A solution would be to build a package that would provide one 
for all the fonts in TL. Basically it's just copy/pasting, there is no 
difficulty. Do you think it's a good idea? If so I'll make a package for 
this.

EU1 may be good for the future, but it does not resolve backward 
compatibility problems, as most of (my for example) documents created 
now say:

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

So I guess I'll have to write some code to convert unicode into other 
font encodings. A (small) problem is the fact that it will certainly 
need a callback into define_font, and the otf font reading will register 
one too, and the conflict can't really be resolved... So I was thinking 
about creating a luafonts package that would register a callback, and 
allow other packages to use some hooks in it. For example there would be 
a hook to open a otf/ttf font, another to do some things (like managing 
encoding) in the final font structure before it's returned, etc. In this 
way, font management would be accessible by several packages... wdyt? In 
any case, I'll need to patch fontenc so that it loads the new font 
management system.

Also, a bonus question: in this font management, could lmr10 be the font 
loaded when there is a load error, or is cmr10 necessary for backward 
compatiblity?

Thank you in advance,
-- 
Elie

From vafakh9 at gmail.com  Sat Mar 14 10:08:17 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sat, 14 Mar 2009 20:08:17 +1100
Subject: [luatex] luatextra font system
In-Reply-To: <49BB71B3.2070703@telecom-bretagne.eu>
References: <49BB71B3.2070703@telecom-bretagne.eu>
Message-ID: <ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>

>
> The main problem with EU1 encoding, is that it's XeTeX oriented, so it
> calls fonts with the XeTeX syntax, which means \font="[file]" for files in
> the TDS. I don't really understand why XeTeX did such an incompatible font
> syntax,


nonsense.



-- 
VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090314/4491703e/attachment.html 

From elie.roux at telecom-bretagne.eu  Sat Mar 14 10:19:24 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Mar 2009 10:19:24 +0100
Subject: [luatex] luatextra font system
In-Reply-To: <ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>
References: <49BB71B3.2070703@telecom-bretagne.eu>
	<ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>
Message-ID: <49BB769C.8060900@telecom-bretagne.eu>

??? ????? a ?crit :
>
>     The main problem with EU1 encoding, is that it's XeTeX oriented,
>     so it calls fonts with the XeTeX syntax, which means
>     \font="[file]" for files in the TDS. I don't really understand why
>     XeTeX did such an incompatible font syntax, 
>
>
> nonsense.

That's true, it's not really the eu1 encoding itself, but more the 
eu1*.fd files (for lmroman for example). The problem is we can't have 
two eu1lmr.fd in the TDS... so they'll need to be adapted, so euenc.dtx 
need to be adapted...

Or maybe the best solution is to fork it with a different encoding name?
-- 
Elie

From luatex at nililand.de  Sat Mar 14 12:12:26 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 14 Mar 2009 12:12:26 +0100
Subject: [luatex] luatextra font system
References: <49BB71B3.2070703@telecom-bretagne.eu>
	<ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>
	<49BB769C.8060900@telecom-bretagne.eu>
Message-ID: <1xtryppg9pi2f.dlg@nililand.de>

Am Sat, 14 Mar 2009 10:19:24 +0100 schrieb Elie Roux:

>>     The main problem with EU1 encoding, is that it's XeTeX oriented,
>>     so it calls fonts with the XeTeX syntax, which means
>>     \font="[file]" for files in the TDS. I don't really understand why
>>     XeTeX did such an incompatible font syntax, 

Incompatible to who? XeTeX *extended* the standard \font syntax to 
handle the loading of open type fonts but the syntax for all fonts 
that pdftex and raw luatex can handle too is unchanged.


With a font callback luatex can be enable to handle also open types 
fonts. It shouldn't be a problem (as far as I know context/mkiv) 
contains already the necessary code) to write this font back in a 
way that enables luatex to handle also font syntax of XeTeX. 

>> nonsense.

> That's true, it's not really the eu1 encoding itself, but more the 
> eu1*.fd files (for lmroman for example). The problem is we can't have 
> two eu1lmr.fd in the TDS... so they'll need to be adapted, so euenc.dtx 
> need to be adapted...

As long as the lua+latex code needed to load and handle the open 
type fonts is not there it doesn't make much sense to think about 
fd-files. But even if lualatex settles on a extended font syntax for 
open type and/or system fonts incompatible to the XeTeX-syntax the 
eu1*.fd-files are a quite small problem. They are not vital, the 
declaration of the lmodern fonts could be done with fontspec 
commands or luatex use EU2 as generic encoding name. 

And in no case generate a lot of eu1*.fd-files. As you can see if 
you look at xetex/fontspec there are quite unnecessary. Also you 
will never be able to generate all entries for all possible 
combinations of open type features. (fontspec generates the entries 
on the fly and use counters in the family name to distinguish 
different variants.)


If you really want to improve font handling in lualatex you could 
write the necessary code so that until unicode fonts can be used 
with luatex non-ascii input works with TS1,T1....-fonts. 

\documentclass{article}

\usepackage[T1]{fontenc}
\usepackage{textcomp}
\begin{document}

?, ?, ?, ?, ?


\catcode`\?=\active
\def?{\ss}
\catcode`\?=\active
\def?{\texteuro}

?, ?, ?, ?, ?
\end{document}


-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Sat Mar 14 12:32:00 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Mar 2009 12:32:00 +0100
Subject: [luatex] luatextra font system
In-Reply-To: <1xtryppg9pi2f.dlg@nililand.de>
References: <49BB71B3.2070703@telecom-bretagne.eu>	<ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>	<49BB769C.8060900@telecom-bretagne.eu>
	<1xtryppg9pi2f.dlg@nililand.de>
Message-ID: <49BB95B0.2090600@telecom-bretagne.eu>

Ulrike Fischer a ?crit :
> Incompatible to who? XeTeX *extended* the standard \font syntax to 
> handle the loading of open type fonts but the syntax for all fonts 
> that pdftex and raw luatex can handle too is unchanged.
>   

Your TeX version handles \font="[myinternalfile]" for files in the TDS? 
Great! Mine does not... That's how eu1*.fd handle fonts, and that's why 
it's not compatible.

> With a font callback luatex can be enable to handle also open types 
> fonts. It shouldn't be a problem (as far as I know context/mkiv) 
> contains already the necessary code) to write this font back in a 
> way that enables luatex to handle also font syntax of XeTeX. 
>   

As I said in my mail, I already wrote a parser to handle XeTeX's font 
syntax, so I know it's not a problem. About open type fonts, I'm writing 
a minimal script to handle them, the main code will be done in a GSoC by 
Manuel.

> And in no case generate a lot of eu1*.fd-files. As you can see if 
> you look at xetex/fontspec there are quite unnecessary. Also you 
> will never be able to generate all entries for all possible 
> combinations of open type features. (fontspec generates the entries 
> on the fly and use counters in the family name to distinguish 
> different variants.)
>   

Please read my mail again... I'm not talking about new fonts. Of course 
new OT fonts will be declared with fontspec. I'm talking about using old 
fonts, like times for example. The most logical way to use them with 
LuaTeX would be to use them with EU1 encoding I think.

> If you really want to improve font handling in lualatex you could 
> write the necessary code so that until unicode fonts can be used 
> with luatex non-ascii input works with TS1,T1....-fonts. 
>   

Please read my mail again, I'm talking about it too.
-- 
Elie

From luatex at nililand.de  Sat Mar 14 14:34:15 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 14 Mar 2009 14:34:15 +0100
Subject: [luatex] luatextra font system
References: <49BB71B3.2070703@telecom-bretagne.eu>	<ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>	<49BB769C.8060900@telecom-bretagne.eu>
	<1xtryppg9pi2f.dlg@nililand.de>
	<49BB95B0.2090600@telecom-bretagne.eu>
Message-ID: <1k7bi4u2pkvyg.dlg@nililand.de>

Am Sat, 14 Mar 2009 12:32:00 +0100 schrieb Elie Roux:

> Ulrike Fischer a ?crit :
>> Incompatible to who? XeTeX *extended* the standard \font syntax to 
>> handle the loading of open type fonts but the syntax for all fonts 
>> that pdftex and raw luatex can handle too is unchanged.
>>   
> 
> Your TeX version handles \font="[myinternalfile]" for files in the TDS? 
> Great! Mine does not... That's how eu1*.fd handle fonts, and that's why 
> it's not compatible.

\font="[...]" is the syntax to load a font directly and extracts the
tfm from the font. A external tfm is not needed. 

pdftex is not able to do this. It needs an external tfm and
\font=<tfm-name> is the normal syntax to do this (and this syntax
works with xetex too). 

http://tug.org/mailman/htdig/xetex/2007-July/007048.html



>> And in no case generate a lot of eu1*.fd-files. As you can see if 
>> you look at xetex/fontspec there are quite unnecessary. Also you 
>> will never be able to generate all entries for all possible 
>> combinations of open type features. (fontspec generates the entries 
>> on the fly and use counters in the family name to distinguish 
>> different variants.)
>>   
> 
> Please read my mail again... I'm not talking about new fonts. Of course 
> new OT fonts will be declared with fontspec. I'm talking about using old 
> fonts, like times for example. 

Times is a new OT font too. So this sentence doesn't make sense. 

> The most logical way to use them with 
> LuaTeX would be to use them with EU1 encoding I think.

fontspec uses EU1 for all fonts it declares. It you use e.g.
\setmainfont{Cambria} and then look in the log-file you will find
font descriptions like EU1/Cambria(0)/bx/it. But only for the latin
modern fonts there are eu1*.fd-files. As far as I know Will used
this special way for the latin modern fonts because there are the
default fonts and should always work. 

So if you really think that fd-files are necessary make at least
sure that they don't disturb fontspec. The best would be if you used
EU2 as encoding name. 



-- 
Ulrike Fischer 


From wspr81 at gmail.com  Sat Mar 14 17:25:04 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 15 Mar 2009 02:55:04 +1030
Subject: [luatex] luatextra font system
References: <49BB71B3.2070703@telecom-bretagne.eu>
	<ba1882870903140208k1d68d127kdbd1d335fddbaa67@mail.gmail.com>
	<49BB769C.8060900@telecom-bretagne.eu>
	<1xtryppg9pi2f.dlg@nililand.de>
	<49BB95B0.2090600@telecom-bretagne.eu>
	<1k7bi4u2pkvyg.dlg@nililand.de>
Message-ID: <gpglp0$8o8$1@ger.gmane.org>

On 2009-03-15 00:04:15 +1030, Ulrike Fischer 
<luatex at nililand.de> said:

> But only for the latin
> modern fonts there are eu1*.fd-files. As far as I know Will used
> this special way for the latin modern fonts because there are the
> default fonts and should always work.

Yes, although these days it would be possible to load the fonts with 
purely fontspec commands; back when I wrote the eu1*.fd files, fontspec 
wasn't sophisticated enough to get the fine-grained control that is 
possble in the .fd files.

* * *

If you want to load the LM fonts by default in LuaTeX and use a 
different font-loading syntax than XeTeX, but all means go with an EU2 
font encoding. I'd argue fairly strongly that the CM fonts should *not* 
be used and the LM fonts made the default as soon as possible.

* * *

Back to the connection between fontenc and LuaTeX. Assuming that LuaTeX 
will always use UTF8 for new documents, there needs to be some way of 
mapping unicode input characters to their appropriate glyph slots in 
the font being used. LaTeX uses inputenc and fontenc to do this, and 
while its LICRs are still being used they're an effective way to solve 
the problem.

It's possible there'd be some value in constructing virtual unicode 
fonts on-the-fly from T1+TS1 (+whatever else exists) so unicode input 
characters can be directly mapped to their output glyphs (i.e., without 
going through the LICR abstraction layer), but the main appeal of XeTeX 
and LuaTeX is that you can use *new* fonts.

So, especially due to the TeX Gyre project, I don't see much need for 
extensive support for old font encodings. As above, much of the current 
system should still work, and OpenType fonts just have so much more 
going for them.

Will



From taco at elvenkind.com  Mon Mar 23 10:53:04 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 23 Mar 2009 10:53:04 +0100
Subject: [luatex] luatex beta 0.36.0
Message-ID: <49C75C00.6050100@elvenkind.com>

Hi,

I have just uploaded luatex 0.36.0.

This is a beta in the process towards 0.40.0, the version that
will be included in texlive 2009. This beta will be shortlived,
the plan is to release the next one in about a week.

The main reason for a release now is to prepare for a bunch
of important user-visible changes:

* The lua code for tex.enableprimitives() etc. is now there,
  but for this beta all the new primitives are still provided
  to the user.

  In next week's beta, these will be gone indeed, and only
  \directlua will remain present by default. See the mailing list
  archive: http://tug.org/pipermail/luatex/2009-March/000360.html
  for more information, the final syntax is explained in the
  manual.

* Multiple lua states have been removed and the old syntax
  now produces a (rather annoying) informational message.

* The fontforge table is renamed to fontloader. The old name
  is still there for the moment, but also produces a warning
  message.



A more detailed 'what's new':

* The included fontforge code is stripped considerably, and
  the lua table to access the code is renamed to 'fontloader'.
  The old name ('fontforge') will remain present for a while,
  but will eventually go away.

* New lua functions: tex.primitives(), tex.extraprimitives,
  tex.enableprimitives().  This is a prelude to a big change
  in the next beta: iniluatex will from now on start up with
  only the TeX82 primitives and \directlua, everything else
  has to be bootstrapped via tex.enableprimitives().
  See the manual for more details.

* Support for multiple lua states has been removed, and at the
  same time support for adding name ids to lua chunks has been
  added, and \closelua has been removed.  See the manual for
  more details.

* More changes to the PDF backend to make it support non-latin
  directions (form and image placement, vertical typesetting,
  synctex).

* The kpathsea library is updated. Highlights: cleaner build
  process (thanks to Peter Breitenlohner), cleaner mingw32
  (cross)compilation support, and a new reentrant API.

* Some possible endless loops within extended delimiters in
  math mode are now trapped.

* Movements inside VF font characters were considerably off
  due to a wrong conversion routine.

* Error handling for \outer has been reinstated, but can be
  suppressed via the new primitive \suppressoutererror.

* The new primitives: \suppresslongerror and \suppressifcsnameerror
  that can be used to suppress errors for \par in non-long macros
  and for non-expandable objects inside \ifcsname ... \endcsname,
  respectively.

* New lua function: node.vpack() via a patch from Khaled Hosny
  that also improves error handling in node.hpack().

* Fix the typo that caused \charic (instead of \charit)
  to be defined as a primitive.

* Suppression of hyphenation via \hyphenchar\font=-1 now works
  again.

* The lua functions tex.print(), tex.sprint(), tex.write() now
  accept an array of strings as well as vararg list of strings
  to print.

* A change to be build process: luatex.p is no longer split
  int smaller pieces before running the C compiler.

* Melissa O'Neill contributed a bugfix to the Type1 font
  subsetting code.

* A bunch of smaller bugfixes and cleanups (as usual).


The archives (now including source again) can be downloaded from
supelec as usual:

        http://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.36.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Taco



From taco at elvenkind.com  Mon Mar 23 11:04:23 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 23 Mar 2009 11:04:23 +0100
Subject: [luatex] luatex beta 0.36.0
In-Reply-To: <49C75C00.6050100@elvenkind.com>
References: <49C75C00.6050100@elvenkind.com>
Message-ID: <49C75EA7.8030705@elvenkind.com>


Hi,

Somehow I can't seem to do these announcements without an error :(

Taco Hoekwater wrote:
> 
> * New lua function: node.vpack() via a patch from Khaled Hosny
>   that also improves error handling in node.hpack().

Wrong attribution. The patch was by Yue Wang, sorry.

Best wishes,
Taco

From yuleopen at gmail.com  Mon Mar 23 11:25:43 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 23 Mar 2009 18:25:43 +0800
Subject: [luatex] luatex beta 0.36.0
In-Reply-To: <49C75EA7.8030705@elvenkind.com>
References: <49C75C00.6050100@elvenkind.com> <49C75EA7.8030705@elvenkind.com>
Message-ID: <68bfdc900903230325j456521e8t5f2abcfbb4836f9e@mail.gmail.com>

Hi, Taco:

On Mon, Mar 23, 2009 at 6:04 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
> Hi,
>
> Somehow I can't seem to do these announcements without an error :(
>
> Taco Hoekwater wrote:
>>
>> * New lua function: node.vpack() via a patch from Khaled Hosny
>> ? that also improves error handling in node.hpack().
>
> Wrong attribution. The patch was by Yue Wang, sorry.
>

Never mind:)

btw, vpack() and hpack() still admit numeric third argument (exactly
and additional are just macros in WEB source). So maybe it will be
better to change

            else if (lua_type(L, 3) == LUA_TNUMBER) {
                m = lua_tonumber(L, 3);
            } else {
                lua_pushstring(L, "incorrect 3rd argument");
            }

to

            else {
                lua_pushstring(L, "incorrect third argument");
                lua_error(L);
            }

So the conditional tests will be more strict.

Anyway, since the API will be changed in the future (as Hans said in
that mail), It is fine if we don't touch that at this moment.

> Best wishes,
> Taco
>

Yue Wang

From yuleopen at gmail.com  Tue Mar 24 04:42:38 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 11:42:38 +0800
Subject: [luatex] Why obsolete the fontforge name space?
Message-ID: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>

Hi, Taco:

in the release notes, you said:

> The included fontforge code is stripped considerably, and
> the lua table to access the code is renamed to 'fontloader'.
> The old name ('fontforge') will remain present for a while,
> but will eventually go away.

What about leaving the fontforge name space in LuaTeX, and create a
synoname as font loader (fontloader=fontforge)?
In the future we might want to use different font library, so the user
can switch to something they want.
(For example, Mac user might prefer to use ATS, so some volunteers can
create a binding in LuaTeX and users can choose the library using
something like "fontloader=ats")
At some point (when LuaTeX can load external system/lua library) some
active user can also develop binding for freetype2 to gain faster
speed and less memory consumption, and we can also switch to the
binding using "fontloader=freetype2"
All we need is to write the luafflib like binding code.

Yue Wang



PS, on the dev-luatex mailing list
(http://www.ntg.nl/mailman/private/dev-luatex/2009-January/002217.html),
you doubted whether freetype2 will be sufficient for advanced fonts,
and in fact ft2 have most of the features you want:

> Not only that. Stuff that needs doing:
> * parsing of Type1 & Type0 (CID composite) fonts

FT2 supports CID-keyed Type 1 fonts (see
http://www.freetype.org/freetype2/index.html)

> * parsing of sfnt containers (ttc and dfont)

FT2 supports TTC and dfont (see the same link)
related code could be found in ftobjs.c and src/sfnt/*
btw, dfont is obsolete. In Mac OS X 10.6 Snow Leopard, all major
system fonts will be shipped in TTC format.

> * parsing of TTF and OTF fonts (including AAT)

No problem parsing these fonts.
But no full AAT support (FT2 can only validate GX and AAT tables[feat,
prop, etc.], see src/gxvalid/*).

> * bounding box calculations for PostScript-based glyphs

FT2 can calculate Control Box of a glyph very efficient (As dicussed
in previous mails)

> * parsing and processing of GPOS & GSUB tables

This is not done in FT2, but HarfBuzz (developed and maintained by FT2
people. The code is also used in QT and Pango)

> * font reencoding

FT2 can encode Type 1 fonts into Unicode.

> * converting to all of this to a lua table

Possible to write the binding code (similar to luafflib.c), but need extra work.

> To be honest, I have no idea how many of those things can be done
> by freetype2, but I highly doubt its OTF support will be sufficient.

see HarfBuzz.

So I think it is possible to write a similar binding.
Maybe we can apply for a Google SoC project for this?

Yue Wang

From yuleopen at gmail.com  Tue Mar 24 07:23:14 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 14:23:14 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <fe8d59da0903232249m253ecf2al5be4ac29a3166e86@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<fe8d59da0903232249m253ecf2al5be4ac29a3166e86@mail.gmail.com>
Message-ID: <68bfdc900903232323j24fd1ad4j33555752974fc11@mail.gmail.com>

Hi,

On Tue, Mar 24, 2009 at 1:49 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
>> At some point (when LuaTeX can load external system/lua library) some
> Maybe you can try just now with you own copy:
> http://wiki.contextgarden.net/User:Luigi.scarso/luatex_lunatic#Fontforge
>

Well, it is not difficult to start writing experimental code for the
freetype2 binding.
The only problem is funding.
Maybe we can ask TUG to host a Summer of Code project for this year.

Concerning your problem with the example,
You only get the control point from fontforge.
Other parameters are still missing to form the polygon.
So the bezier curve is not correct.

> --
> luigi
>

Yue Wang

From pragma at wxs.nl  Tue Mar 24 08:04:13 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Mar 2009 08:04:13 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
Message-ID: <49C885ED.6020501@wxs.nl>

Yue Wang wrote:

> What about leaving the fontforge name space in LuaTeX, and create a
> synoname as font loader (fontloader=fontforge)?
> In the future we might want to use different font library, so the user
> can switch to something they want.
> (For example, Mac user might prefer to use ATS, so some volunteers can
> create a binding in LuaTeX and users can choose the library using
> something like "fontloader=ats")
> At some point (when LuaTeX can load external system/lua library) some
> active user can also develop binding for freetype2 to gain faster
> speed and less memory consumption, and we can also switch to the
> binding using "fontloader=freetype2"
> All we need is to write the luafflib like binding code.

- as mentioned several times, the luatex dev team can (and will when 
they feel they have to) change the names of libraries, functions, new 
primitives etc

- since the loader is a subset and the code stripped we cannot call it 
fontforge (it's the adapted loading part of ff) hence the new name

- a macro package can (if it wants) in the future make any synonym it 
finds useful; there is no reason to burden the codebase with it; it can 
overload the loader any time it wants

- whatever library is used at some point by a user is not up to the core 
of luatex and since we will ship no such libraries their management is 
also iup to the macro package, and as it is quite unlikely that all kind 
of loaders behave the samesimple fontloader=myfontloader assignments 
need to be managed ny a macro package anyway (if it decides to support 
them in the first place)

- so, in practice, if you want to use another loader, you just hook in 
your code in the font definition define callback (as you have to do now) 
since the only thing that luatex expects back a tfm table, luatex does 
not care how ypu produce it

- so, in your case you will end up with

fontforge = fontloader
fontloade = myfontloader

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Tue Mar 24 08:28:04 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 24 Mar 2009 08:28:04 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
Message-ID: <20090324072804.GE26539@phare.normalesup.org>

> PS, on the dev-luatex mailing list
> (http://www.ntg.nl/mailman/private/dev-luatex/2009-January/002217.html),
> you doubted whether freetype2 will be sufficient for advanced fonts,
> and in fact ft2 have most of the features you want:

  From the list you made below, it seems that it doesn't because
OpenType support belongs to HarfBuzz, as has already been said.
FontForge already does all of that.

> So I think it is possible to write a similar binding.
> Maybe we can apply for a Google SoC project for this?

  TUG's candidature to GSoC has been rejected
(http://tug.org/pipermail/summer-of-code/2009/000164.html), so, not this
year.

	Arthur

From elie.roux at telecom-bretagne.eu  Tue Mar 24 08:31:30 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 24 Mar 2009 08:31:30 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <20090324072804.GE26539@phare.normalesup.org>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
Message-ID: <49C88C52.4060903@telecom-bretagne.eu>

Arthur Reutenauer a ?crit :
> TUG's candidature to GSoC has been rejected
> (http://tug.org/pipermail/summer-of-code/2009/000164.html), so, not this
> year.
>   


Ah merde... ?a veut dire pas de GSoC pour Manuel ?

Si oui je vais essayer de faire de mon mieux pour un support de l'OTF 
dans TL2009 en piquant du code de ConTeXt, mais j'ai peur que ?a me 
prenne trop de temps...
-- 
Elie

From elie.roux at telecom-bretagne.eu  Tue Mar 24 08:32:10 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 24 Mar 2009 08:32:10 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <49C88C52.4060903@telecom-bretagne.eu>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>
	<49C88C52.4060903@telecom-bretagne.eu>
Message-ID: <49C88C7A.2080602@telecom-bretagne.eu>

Sorry... this was meant to be private...
-- 
Elie

From yuleopen at gmail.com  Tue Mar 24 09:27:03 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 16:27:03 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <20090324072804.GE26539@phare.normalesup.org>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
Message-ID: <68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>

Hi

On Tue, Mar 24, 2009 at 3:28 PM, Arthur Reutenauer
<arthur.reutenauer at normalesup.org> wrote:
>> PS, on the dev-luatex mailing list
>> (http://www.ntg.nl/mailman/private/dev-luatex/2009-January/002217.html),
>> you doubted whether freetype2 will be sufficient for advanced fonts,
>> and in fact ft2 have most of the features you want:
>
> ?From the list you made below, it seems that it doesn't because
> OpenType support belongs to HarfBuzz, as has already been said.
> FontForge already does all of that.
>

I know that project, and the idea is mentioned in the first mail of this thread.
Yes, FontForge solve all the problems FT2+HarfBuzz do, but:
- HarfBuzz+FT2 is more lightweigh/memory/computational efficient than
Font Forge.
- FT2 has been tested by thousands and thousands of software programs
(it is the basis of Unix GUI program + handhold device GUI + many
Windows and Mac Apps).
- HarfBuzz, though not public released, is the key component of Pango
[a part of GTK+] and Scribe [a part of QT application framework], so
it also has been tested by many software programs (All GTK+ and QT
program use HarfBuzz for text layout).
So, FT2+HB are the quasi-standard of the software world, This approach
is more robust and has much fewer bugs.
If there are sufficient funding, write such binding is beneficial.

Of course, I admit FontForge is useful in LuaTeX, and can solve many
problems FreeType cannot solve (like font generation).

>> So I think it is possible to write a similar binding.
>> Maybe we can apply for a Google SoC project for this?
>
> ?TUG's candidature to GSoC has been rejected
> (http://tug.org/pipermail/summer-of-code/2009/000164.html), so, not this
> year.

bad to know that:(

>
> ? ? ? ?Arthur
>

Yue Wang

From pragma at wxs.nl  Tue Mar 24 12:48:23 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Mar 2009 12:48:23 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
Message-ID: <49C8C887.4080903@wxs.nl>

Yue Wang wrote:

> If there are sufficient funding, write such binding is beneficial.

depends ... 99% of dev in the tex world is not funded and still beneficial

anyway, it's not on our agenda so such a lib + binding would end up in 
the add-ons activities later on; also, such a library should just expose 
  data which then could be transformed to something else using lua, i.e. 
it makes no sense to let such a lib construct a fontforge like table

actually, if the advantage is sought in faster loading keep in mind that 
it's the construction of the big tables that take runtime, and that will 
be true for all fontloaders (only faster processors and more mem can 
solve that; it's the price for flexibility and in the luatex project 
flexibility and opening up is more important than runtime; as such 
luatex will always be much slower than the other engines and fonts is 
just one aspect) (we have a few ideas for speedups but these might not 
show up before version 1.0)

the standard built-in fontloader datastructures are quite specific and 
will stay close to what fontforge does if only because it makes 
developing fonts as well as debugging lua code easier (for instance same 
internal feature interfaces) while other fontlibs might have a 
completely different exposure of font characteristics

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From yuleopen at gmail.com  Tue Mar 24 14:10:32 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 21:10:32 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <49C8C887.4080903@wxs.nl>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
Message-ID: <68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>

Hi, Hans:

On Tue, Mar 24, 2009 at 7:48 PM, Hans Hagen <pragma at wxs.nl> wrote:
> Yue Wang wrote:
>
>> If there are sufficient funding, write such binding is beneficial.
>
> depends ... 99% of dev in the tex world is not funded and still beneficial
>

TeX and MetaPost was funded by AMS,
XeTeX is funded by SIL,
NTS, LaTeX , etc. are funded by TUG and local groups.
LM, Gyre are funded by NTG, and other gourps.
LuaTeX is funded by the Oriental TeX project and many others.
pdfTeX is originally  funded by the authors' advisor (it is a phd project).
TeXWorks is funded by TUG.
hyph-utf8 is a SoC project
......

writing such a binding might take one or two weeks' work.
It is fair to get paid.

> anyway, it's not on our agenda so such a lib + binding would end up in the
> add-ons activities later on; also, such a library should just expose ?data
> which then could be transformed to something else using lua, i.e. it makes
> no sense to let such a lib construct a fontforge like table
>

Even LuaTeX's API/data structures are a bit different from FontForge's
internal presentation.
And it is possible to construct a fontforge like table using FreeType2.

So I think it is better to document such APIs/data structures into a specimen.
All the lib binding developers are recommended to follow the APIs and
data structures.
(like the NextStep or RenderMan way)

In fact, only a small subset of fontforge's data structure (metrics
table) is needed for typesetting.
Most font libraries include this subset.


> actually, if the advantage is sought in faster loading keep in mind that
> it's the construction of the big tables that take runtime, and that will be
> true for all fontloaders (only faster processors and more mem can solve
> that; it's the price for flexibility and in the luatex project flexibility
> and opening up is more important than runtime; as such luatex will always be
> much slower than the other engines and fonts is just one aspect) (we have a
> few ideas for speedups but these might not show up before version 1.0)
>

On my machine, generating and dumping a table for Adobe Song Std in
MKIV takes 30-40 seconds.
Loading the cache takes 1-2 seconds.

When loading the lua cache, lua interpreter should also allocate the
memory and generate the table in the memory.
So in fact the lua part is computational efficient.
It is the fontforge part that takes a lot of time.
At least 20-25 seconds are used for parsing the font and calculating
the bounding box.

Today morning, I wrote a small C program to load and calculate the
Control Box for each glyph in Adobe Song Std,
and it only takes 2 seconds per run, consuming 2M memory. when lua is
involved, I expect it can dump the font to cache in 5-10 seconds,
consuming ~10M of memory.


But, speed and memory consumption are just one reason.
Stability is another important issue: as I said, libfreetype2 was
tested by thousands and thousands of applications, and it is much more
mature than libfontforge.
I think freetype2 is more reliable than fontforge, and more developers
are familiar with freetype2 API.
(On my FreeBSD machine, there are 1000 or more binaries in
/usr/local/bin/, only fontforge and luatex uses fontforge, but at
least 700 of the binaries are linked to libfreetype2)
In addition, I think FreeType's documentation is more clear and
complete (fontforge's API documentation is a mess).
and FreeType also gives better source code comments.


> the standard built-in fontloader datastructures are quite specific and will
> stay close to what fontforge does if only because it makes developing fonts
> as well as debugging lua code easier (for instance same internal feature
> interfaces) while other fontlibs might have a completely different exposure
> of font characteristics
>


Metrics table are not difficult to get from any font libs.
And as long as we have a freetype-like exposure, it is not difficult
to remap it to fontforge-like one.
(just add some "for k,v in xxxtable do xxx=xxx end" or just write the
binding code follow Taco's luafflib.c)



> Hans
>
>
> -----------------------------------------------------------------
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Hans Hagen | PRAGMA ADE
> ? ? ? ? ? ? ?Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ? ? tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? | www.pragma-pod.nl
> -----------------------------------------------------------------
>

Yue Wang

From taco at elvenkind.com  Tue Mar 24 14:20:19 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Mar 2009 14:20:19 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>
	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
Message-ID: <49C8DE13.8010905@elvenkind.com>



Yue Wang wrote:
> 
> Even LuaTeX's API/data structures are a bit different from FontForge's
> internal presentation.
> And it is possible to construct a fontforge like table using FreeType2.

Except for the complete and total showstopper that it will not support
opentype features nor aat features. Please, if you want to continue
along this track, figure out how to some the enormous problem of missing
opentype feature support first.

Unless it can do opentype features (and does so all by itself, without
depending on local system libraries) no external library binding is
acceptable as a replacement for the current code.

Best wishes,
Taco

From yuleopen at gmail.com  Tue Mar 24 15:13:19 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 22:13:19 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <49C8DE13.8010905@elvenkind.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
	<49C8DE13.8010905@elvenkind.com>
Message-ID: <68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>

Hi:

> Except for the complete and total showstopper that it will not support
> opentype features nor aat features. Please, if you want to continue
> along this track, figure out how to some the enormous problem of missing
> opentype feature support first.
>

Complex text layout can only be done by combination of FreeType2 and
otf layout support library.
I do not know what the "complete OpenType feature support" means.
If it just means it can dump the low-level GPOS, GSUB, GDEF related tables.
libotf or harfbuzz has no problem doing them
(both libotf and harfbuzz are small libraries and only depends on
freetype2, so they are not system libraries).

for OTF support in libotf, see http://www.m17n.org/libotf/otf.h
[section 2-3, OTF_get_table() ]
for OTF support in HarfBuzz, see harfbuzz-gdef.h harfbuzz-gsub.h and
harfbuzz-gpos.h.

both library are very stable and mature and can be used for
production. (HarfBuzz is used in QT/Scribe and GTK+/Pango).

It is also said on the website that FreeType is preparing a new
library called "FT Layout"  which have "Full opentype Layout support".
but it is not released yet
(http://freetype.sourceforge.net/ftlayout/).

Yue Wang

From khaledhosny at eglug.org  Tue Mar 24 15:35:38 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 24 Mar 2009 16:35:38 +0200
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
	<49C8DE13.8010905@elvenkind.com>
	<68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>
Message-ID: <20090324143538.GA13853@khaled-laptop>

On Tue, Mar 24, 2009 at 10:13:19PM +0800, Yue Wang wrote:
> It is also said on the website that FreeType is preparing a new
> library called "FT Layout"  which have "Full opentype Layout support".
> but it is not released yet
> (http://freetype.sourceforge.net/ftlayout/).

Actually, that is the old abandoned FreeType code that HarfBuzz is based
on[1], I think this is an outdated/historical page.

Regards,
 Khaled

[1]http://lists.freedesktop.org/archives/harfbuzz/2008-January/000186.html


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090324/c54d4ca8/attachment.bin 

From yuleopen at gmail.com  Tue Mar 24 15:40:45 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 24 Mar 2009 22:40:45 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <20090324143538.GA13853@khaled-laptop>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
	<49C8DE13.8010905@elvenkind.com>
	<68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>
	<20090324143538.GA13853@khaled-laptop>
Message-ID: <68bfdc900903240740h608e5cfh1fb78c8dc6c66992@mail.gmail.com>

Hi,

On Tue, Mar 24, 2009 at 10:35 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:

> Actually, that is the old abandoned FreeType code that HarfBuzz is based
> on[1], I think this is an outdated/historical page.
>
> Regards,
> ?Khaled
>
> [1]http://lists.freedesktop.org/archives/harfbuzz/2008-January/000186.html
>


Well, I think so too...
Previously I am not sure about the relationship since it is
particulary mentioned in the website that it will use mlib.
and actually harfbuzz does not depend on mlib.

Thanks for providing the link to the mailing list

Yue Wang

From pragma at wxs.nl  Tue Mar 24 17:32:33 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Mar 2009 17:32:33 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>
	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>
Message-ID: <49C90B21.3000407@wxs.nl>

Yue Wang wrote:
> Hi, Hans:
> 
> On Tue, Mar 24, 2009 at 7:48 PM, Hans Hagen <pragma at wxs.nl> wrote:
>> Yue Wang wrote:
>>
>>> If there are sufficient funding, write such binding is beneficial.
>> depends ... 99% of dev in the tex world is not funded and still beneficial
>>
> 
> TeX and MetaPost was funded by AMS,
> XeTeX is funded by SIL,
> NTS, LaTeX , etc. are funded by TUG and local groups.
> LM, Gyre are funded by NTG, and other gourps.
> LuaTeX is funded by the Oriental TeX project and many others.
> pdfTeX is originally  funded by the authors' advisor (it is a phd project).
> TeXWorks is funded by TUG.
> hyph-utf8 is a SoC project
> .......

all are partly funded (often much more times goes in it and this is 
definitely true for luatex which gets some funding from lugs for the 
coding bit but on top of that is done in company and private time only 
because we have some freedome to do it and because we like it); pdftex 
was not funded at all; context is not funded at all; anyhow ... not that 
important an issue

> writing such a binding might take one or two weeks' work.

anyhow, you can try to get funding, but keep in mind that it's not part 
of the luatex project and loading modules has a real low priority in the 
roadmap (first the whole system needs to be stable); also, we've chosen 
ff as basis and that will not change

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar 24 17:42:37 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Mar 2009 17:42:37 +0100
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>	<68bfdc900903240610k376abd63r7df1546d525fdf4f@mail.gmail.com>	<49C8DE13.8010905@elvenkind.com>
	<68bfdc900903240713n374d8102u8f56bb0c00cecc61@mail.gmail.com>
Message-ID: <49C90D7D.5060607@wxs.nl>

Yue Wang wrote:
> Hi:
> 
>> Except for the complete and total showstopper that it will not support
>> opentype features nor aat features. Please, if you want to continue
>> along this track, figure out how to some the enormous problem of missing
>> opentype feature support first.
>>
> 
> Complex text layout can only be done by combination of FreeType2 and
> otf layout support library.
> I do not know what the "complete OpenType feature support" means.
> If it just means it can dump the low-level GPOS, GSUB, GDEF related tables.
> libotf or harfbuzz has no problem doing them
> (both libotf and harfbuzz are small libraries and only depends on
> freetype2, so they are not system libraries).

the whole idea behind luatex is that we want an open engine i.e. no 
libraries that do the things we'd like to do in whatever way; pdftex is 
limited to the build in typesetter, xetex uses libraries, luatex 
provides access and the ability to write your own typesetter

even if you'd have loader-x and character-to-glyph-processor-y you'd 
have to glue them together somehow, i.e. pass info back and forward; 
simple for some scripts, more tricky for others, even more tricky when 
we have a mixture of scripts, math, boxing etc etc

so, there is a way to load fonts (and you can add yoru own code if 
needed), there are ways to tell tex how to use a font in relation to the 
nodelist, there is the traditional machinery (after all, it's tex) and 
most of the popular otf features can be mapped onto it (ligaturing, 
kerning, replacements) and for the rest one can program whatever one 
likes (today's fashion is otf but one might as well use the info in a 
font in a completely different way); no hard coded solutions (just as 
there are no hard coded macros); after all, there are other (office) 
apps out there that might do decent jobs as well

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mpg at elzevir.fr  Tue Mar 24 22:51:02 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 24 Mar 2009 22:51:02 +0100
Subject: [luatex] require and load_Lua
Message-ID: <49C955C6.4030000@elzevir.fr>

Hi,

I apologize in advance if this is an FAQ, but I couldn't find any reference in
the manual nor using google.

Did you ever consider changing package.loaders so that the function looking for
lua modules uses something like kpse.find_file(name, 'lua') in order to find the
file rather that searching it along package.path?

Or is something like this already done, and I missed it? Or do you think it
belongs to the macro packages, not in the engine?

Thanks,
Manuel.

From pragma at wxs.nl  Tue Mar 24 23:10:48 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Mar 2009 23:10:48 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C955C6.4030000@elzevir.fr>
References: <49C955C6.4030000@elzevir.fr>
Message-ID: <49C95A68.70909@wxs.nl>

Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I apologize in advance if this is an FAQ, but I couldn't find any reference in
> the manual nor using google.
> 
> Did you ever consider changing package.loaders so that the function looking for
> lua modules uses something like kpse.find_file(name, 'lua') in order to find the
> file rather that searching it along package.path?

you can just do that yourself as any function can be redefined, so you 
can overload the loader or add an extra loader ...

package.loaders[#package.loaders+1] = function(name)
   -- return location of name depending on your preferences
end


> Or is something like this already done, and I missed it? Or do you think it
> belongs to the macro packages, not in the engine?

indeed, it's a macro package issue as each package might have its own 
strategy

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From mpg at elzevir.fr  Tue Mar 24 23:20:47 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 24 Mar 2009 23:20:47 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C95A68.70909@wxs.nl>
References: <49C955C6.4030000@elzevir.fr> <49C95A68.70909@wxs.nl>
Message-ID: <49C95CBF.8030006@elzevir.fr>

Hans Hagen a ?crit :
> you can just do that yourself as any function can be redefined, so you
> can overload the loader or add an extra loader ...
> 
> package.loaders[#package.loaders+1] = function(name)
>   -- return location of name depending on your preferences
> end
> 
Sure, that's the nice thing with Lua.

>> belongs to the macro packages, not in the engine?
> 
> indeed, it's a macro package issue as each package might have its own
> strategy
> 
I was expecting this answer. Thanks for confirming.

Manuel.

From taco at elvenkind.com  Tue Mar 24 23:48:43 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Mar 2009 23:48:43 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C95CBF.8030006@elzevir.fr>
References: <49C955C6.4030000@elzevir.fr> <49C95A68.70909@wxs.nl>
	<49C95CBF.8030006@elzevir.fr>
Message-ID: <49C9634B.8030107@elvenkind.com>

Hi,

Manuel P?gouri?-Gonnard wrote:
>> indeed, it's a macro package issue as each package might have its own
>> strategy
>>
> I was expecting this answer. Thanks for confirming.

Well, I think Manuel has a valid point. When kpathsea is initialized
anyway, which is either when kpse.set_program_name() has been called
by the user in a texlua script or in the --lua ini file, or when
actual typesetting is being done and kpathsea has not explicitly
been disabled via texconfig.kpse_init=false, then I see no reason
*not* to use kpathsea as one of the package loaders.

Perhaps package.loaders will need redefinition anyway, but I assume
it would be a useful addition to have on by default, especially in
standalone scripts.

Best wishes,
Taco



From mpg at elzevir.fr  Wed Mar 25 00:02:41 2009
From: mpg at elzevir.fr (=?ISO-8859-15?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 25 Mar 2009 00:02:41 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C9634B.8030107@elvenkind.com>
References: <49C955C6.4030000@elzevir.fr>
	<49C95A68.70909@wxs.nl>	<49C95CBF.8030006@elzevir.fr>
	<49C9634B.8030107@elvenkind.com>
Message-ID: <49C96691.2040509@elzevir.fr>

Taco Hoekwater a ?crit :
> Well, I think Manuel has a valid point.

Just to be clear: I wasn't trying to make a point. I didn't think about it
enough to have a clear opinion on my own, so I was just asking for yours :-)

But if you think the idea is interesting and want to implement it, great!

> When kpathsea is initialized
> anyway, which is either when kpse.set_program_name() has been called
> by the user in a texlua script or in the --lua ini file, or when
> actual typesetting is being done and kpathsea has not explicitly
> been disabled via texconfig.kpse_init=false, then I see no reason
> *not* to use kpathsea as one of the package loaders.
> 
> Perhaps package.loaders will need redefinition anyway, but I assume
> it would be a useful addition to have on by default, especially in
> standalone scripts.
> 
Yes, it could be handy indeed.

Thanks,
Manuel.


From elie.roux at telecom-bretagne.eu  Wed Mar 25 02:01:48 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 25 Mar 2009 02:01:48 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C955C6.4030000@elzevir.fr>
References: <49C955C6.4030000@elzevir.fr>
Message-ID: <49C9827C.6030402@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> Did you ever consider changing package.loaders so that the function looking for
> lua modules uses something like kpse.find_file(name, 'lua') in order to find the
> file rather that searching it along package.path?
>   

J'ai repomp? du code de Heiko qui fait ?a, ligne 186 de luatextra.lua.
-- 
Elie

From elie.roux at telecom-bretagne.eu  Wed Mar 25 02:08:24 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 25 Mar 2009 02:08:24 +0100
Subject: [luatex] require and load_Lua
In-Reply-To: <49C9827C.6030402@telecom-bretagne.eu>
References: <49C955C6.4030000@elzevir.fr>
	<49C9827C.6030402@telecom-bretagne.eu>
Message-ID: <49C98408.6020008@telecom-bretagne.eu>

Next time I want to send a private mail, I'll take a look at the address 
twice... sorry again...
-- 
Elie

From vafakh9 at gmail.com  Sun Mar 29 12:32:04 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 21:32:04 +1100
Subject: [luatex] bug in RTL typesetting?
Message-ID: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>

In the latest version of luatex, namely snapshot-0.36.0-2009032321, when I
create the table of contents in RTL, the dots that appear in between
subsection name and the page number for example goes to the wrong
direction.( see attached file). I had no issues with this in the previous
version of luatex.

So is this a bug in luatex or I should write some macro to fix this.

Thanks

-- VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/942ebf2e/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 10951 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/942ebf2e/attachment.pdf 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: application/x-tex
Size: 231 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/942ebf2e/attachment.tex 

From pragma at wxs.nl  Sun Mar 29 13:45:12 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 29 Mar 2009 13:45:12 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
Message-ID: <49CF5F48.9080105@wxs.nl>

??? ????? wrote:
> In the latest version of luatex, namely snapshot-0.36.0-2009032321, when I
> create the table of contents in RTL, the dots that appear in between
> subsection name and the page number for example goes to the wrong
> direction.( see attached file). I had no issues with this in the previous
> version of luatex.
> 
> So is this a bug in luatex or I should write some macro to fix this.

could be a side effect of all dir stuff being made consistent in the 
front and backend

in this case it's \pagedir

\pagedir TRT \pardir TRT \textdir TRT

\hbox to \hsize{l\leaders\hbox{.}\hfill r}

\hbox to \hsize{lr}

for taco/hartmut: i have a different testcase

in any case, i think that it's dangerous to assume that \pagedir is safe 
with respect to the output routines used


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From vafakh9 at gmail.com  Sun Mar 29 14:05:43 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:05:43 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <49CF5F48.9080105@wxs.nl>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
Message-ID: <ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>

one more question, why if I use \setRTL at the beginning of the document it
does not works which is defined as

\newif\if at RTL
\if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else \pagedir TLT
\bodydir TLT \pardir TLT \textdir TLT \fi
\def\setRTL{\@RTLtrue}
\def\setLTR{\@RTLfalse}


but if I just say \pagedir TRT \bodydir TRT \pardir TRT \textdir TRT at the
beggining of a document, it works.

Should not these two work the same?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/39dd072b/attachment.html 

From schuster.wolfgang at googlemail.com  Sun Mar 29 14:11:59 2009
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 29 Mar 2009 14:11:59 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
Message-ID: <1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>


Am 29.03.2009 um 14:05 schrieb ??? ?????:

> one more question, why if I use \setRTL at the beginning of the  
> document it does not works which is defined as
>
> \newif\if at RTL
> \if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else  
> \pagedir TLT \bodydir TLT \pardir TLT \textdir TLT \fi
> \def\setRTL{\@RTLtrue}
> \def\setLTR{\@RTLfalse}
>
> but if I just say \pagedir TRT \bodydir TRT \pardir TRT \textdir TRT  
> at the beggining of a document, it works.
>
> Should not these two work the same?


\def\setRTL{\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT }
\def\setLTR{\pagedir TLT \bodydir TLT \pardir TLT \textdir TLT }

Wolfgang


From vafakh9 at gmail.com  Sun Mar 29 14:15:40 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:15:40 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
Message-ID: <ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>

Thanks Wolfgang

I just need to know wht that \if at RTL does not work
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/e2247f9d/attachment-0001.html 

From khaledhosny at eglug.org  Sun Mar 29 14:16:48 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 14:16:48 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <49CF5F48.9080105@wxs.nl>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
Message-ID: <20090329121648.GB10561@khaled-laptop>

On Sun, Mar 29, 2009 at 01:45:12PM +0200, Hans Hagen wrote:
> ??? ????? wrote:
>> In the latest version of luatex, namely snapshot-0.36.0-2009032321, when I
>> create the table of contents in RTL, the dots that appear in between
>> subsection name and the page number for example goes to the wrong
>> direction.( see attached file). I had no issues with this in the previous
>> version of luatex.
>>
>> So is this a bug in luatex or I should write some macro to fix this.
>
> could be a side effect of all dir stuff being made consistent in the  
> front and backend
>
> in this case it's \pagedir
>
> \pagedir TRT \pardir TRT \textdir TRT
>
> \hbox to \hsize{l\leaders\hbox{.}\hfill r}
>
> \hbox to \hsize{lr}
>
> for taco/hartmut: i have a different testcase
>
> in any case, i think that it's dangerous to assume that \pagedir is safe  
> with respect to the output routines used

I'm not sure if its the same issue, but Vafa's example gives the
expected output in DVI mode, unlike your test which is broken in both
DVI and PDF.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/89eb9cb2/attachment.bin 

From vafakh9 at gmail.com  Sun Mar 29 14:17:41 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:17:41 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
Message-ID: <ba1882870903290517l608df09bn2747f86a84e86c56@mail.gmail.com>

Hi Do you think that with powerful RTL support of RTL, we do need to have a
bidi package in LaTeX? If the answer is yes, I would like to start and write
one.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/21e0c71e/attachment.html 

From schuster.wolfgang at googlemail.com  Sun Mar 29 14:22:08 2009
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 29 Mar 2009 14:22:08 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
Message-ID: <F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>


Am 29.03.2009 um 14:15 schrieb ??? ?????:

> Thanks Wolfgang
>
> I just need to know wht that \if at RTL does not work

It works but you have to include it in the \setRTL/LTR macro.

Wolfgang


From elie.roux at telecom-bretagne.eu  Sun Mar 29 14:24:50 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 29 Mar 2009 14:24:50 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903290517l608df09bn2747f86a84e86c56@mail.gmail.com>
References: <ba1882870903290517l608df09bn2747f86a84e86c56@mail.gmail.com>
Message-ID: <49CF6892.9090904@telecom-bretagne.eu>

??? ????? a ?crit :
> Hi Do you think that with powerful RTL support of RTL, we do need to 
> have a bidi package in LaTeX? If the answer is yes, I would like to 
> start and write one.

Hi,

I really think that anything improving the LuaLaTeX experience is good 
to take, please go on!
-- 
Elie

From vafakh9 at gmail.com  Sun Mar 29 14:38:07 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:38:07 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
Message-ID: <ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>

but can you tell me why this does not work:

%%%%%%%%%%%%%%%%%%%%%%%
\newif\if at RTL
\if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else \pagedir TLT
\bodydir TLT \pardir TLT \textdir TLT \fi
\def\setRTL{\@RTLtrue}
\def\setLTR{\@RTLfalse}
%%%%%%%%%%%%%%%%%%%%%%%
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/668b7472/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 14:42:15 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:42:15 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <49CF6892.9090904@telecom-bretagne.eu>
References: <ba1882870903290517l608df09bn2747f86a84e86c56@mail.gmail.com>
	<49CF6892.9090904@telecom-bretagne.eu>
Message-ID: <ba1882870903290542m6a35baf5m579ad429227748a8@mail.gmail.com>

ok then. I will write one. from my experience with xepersian, I know exactly
how things should be treated in bidi.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/1142d51c/attachment.html 

From elie.roux at telecom-bretagne.eu  Sun Mar 29 14:42:30 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 29 Mar 2009 14:42:30 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>	<49CF5F48.9080105@wxs.nl>	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
Message-ID: <49CF6CB6.3090805@telecom-bretagne.eu>

??? ????? a ?crit :
> but can you tell me why this does not work:
>
> %%%%%%%%%%%%%%%%%%%%%%%
> \newif\if at RTL
> \if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else 
> \pagedir TLT \bodydir TLT \pardir TLT \textdir TLT \fi
> \def\setRTL{\@RTLtrue}
> \def\setLTR{\@RTLfalse}
> %%%%%%%%%%%%%%%%%%%%%%%

the \xxtrue and \xxfalse macros do not do anything exept changing the 
behaviour of \ifxx, so basically your \setRTL makes \ifxx be true, but 
that's all...
-- 
Elie

From vafakh9 at gmail.com  Sun Mar 29 14:49:36 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:49:36 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <49CF6CB6.3090805@telecom-bretagne.eu>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
	<49CF6CB6.3090805@telecom-bretagne.eu>
Message-ID: <ba1882870903290549i7f03de11p22fcc45be5f50039@mail.gmail.com>

the next thing is equations, so for example to the same test.tex, if I add

\begin{equation}
1+2=3
\end{equation}

I get different results in dvi and pdf mode. (look at attached files).

and why the equation does not appear at the center anyway?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/cef3755c/attachment-0001.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-dvi-mode.pdf
Type: application/pdf
Size: 9090 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/cef3755c/attachment-0002.pdf 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-pdf-mode.pdf
Type: application/pdf
Size: 9776 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/cef3755c/attachment-0003.pdf 

From vafakh9 at gmail.com  Sun Mar 29 14:51:25 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Sun, 29 Mar 2009 23:51:25 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <49CF6CB6.3090805@telecom-bretagne.eu>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
	<49CF6CB6.3090805@telecom-bretagne.eu>
Message-ID: <ba1882870903290551h66f7ffdch11b724c410b441fb@mail.gmail.com>

the \xxtrue and \xxfalse macros do not do anything exept changing the
> behaviour of \ifxx, so basically your \setRTL makes \ifxx be true, but
> that's all...
> --
> Elie
>

Sorry my mistake. I see.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/aa25a8f2/attachment.html 

From schuster.wolfgang at googlemail.com  Sun Mar 29 14:46:57 2009
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 29 Mar 2009 14:46:57 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
Message-ID: <C9CAA247-9C9B-4F79-9EDD-6E2A655D853E@gmail.com>


Am 29.03.2009 um 14:38 schrieb ??? ?????:

> but can you tell me why this does not work:
>
> \newif\if at RTL
> \if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else  
> \pagedir TLT \bodydir TLT \pardir TLT \textdir TLT \fi

performes the test and executes the false part

> \def\setRTL{\@RTLtrue}
> \def\setLTR{\@RTLfalse}

no effect because the test was executed above

Wolfgang


From elie.roux at telecom-bretagne.eu  Sun Mar 29 15:00:10 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 29 Mar 2009 15:00:10 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290549i7f03de11p22fcc45be5f50039@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>	<49CF5F48.9080105@wxs.nl>	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>	<49CF6CB6.3090805@telecom-bretagne.eu>
	<ba1882870903290549i7f03de11p22fcc45be5f50039@mail.gmail.com>
Message-ID: <49CF70DA.3000803@telecom-bretagne.eu>

??? ????? a ?crit :
>
> the next thing is equations, so for example to the same test.tex, if I add
>
> \begin{equation}
> 1+2=3
> \end{equation}
>
> I get different results in dvi and pdf mode. (look at attached files).

What you should do is giving a small example of this in plain TeX, as a 
lot of people on the list don't use LaTeX at all. The best thing would 
be to extract some code from LaTeX to see what's going on when you type 
\begin{equation}xx\end{equation} in LaTeX, and to see where the bug is 
in this code. With this the LuaTeX team will be able to work on the bug.

Thank you,
-- 
Elie

From vafakh9 at gmail.com  Sun Mar 29 15:19:56 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 00:19:56 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <49CF70DA.3000803@telecom-bretagne.eu>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<1E8EA381-ECF3-4554-8495-077A16B97DB3@gmail.com>
	<ba1882870903290515y66b506beqe4941b2f64ab8395@mail.gmail.com>
	<F5F0C93A-366C-4813-9ECE-E75039FD6AC7@gmail.com>
	<ba1882870903290538g443d482ek6aed7d538620bc0@mail.gmail.com>
	<49CF6CB6.3090805@telecom-bretagne.eu>
	<ba1882870903290549i7f03de11p22fcc45be5f50039@mail.gmail.com>
	<49CF70DA.3000803@telecom-bretagne.eu>
Message-ID: <ba1882870903290619v4027d6c7tc7e058a68d906000@mail.gmail.com>

> What you should do is giving a small example of this in plain TeX, as a lot
> of people on the list don't use LaTeX at all. The best thing would be to
> extract some code from LaTeX to see what's going on when you type
> \begin{equation}xx\end{equation} in LaTeX, and to see where the bug is in
> this code. With this the LuaTeX team will be able to work on the bug.
>
>

No problem. The same issue happens when we do equations in plain TeX (look
at attached files). I do not think this is a vital problem because it can be
solved by macro.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/9e7ef709/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-plain.tex
Type: application/x-tex
Size: 75 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090330/9e7ef709/attachment.tex 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-plain-dvi-mode.pdf
Type: application/pdf
Size: 4132 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090330/9e7ef709/attachment.pdf 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-plain-pdf-mode.pdf
Type: application/pdf
Size: 4406 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090330/9e7ef709/attachment-0001.pdf 

From khaledhosny at eglug.org  Sun Mar 29 15:21:44 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 15:21:44 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
Message-ID: <20090329132144.GA13523@khaled-laptop>

On Sun, Mar 29, 2009 at 11:05:43PM +1100, ??? ????? wrote:
> one more question, why if I use \setRTL at the beginning of the document it
> does not works which is defined as
> 
> \newif\if at RTL
> \if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else \pagedir TLT \
> bodydir TLT \pardir TLT \textdir TLT \fi
> \def\setRTL{\@RTLtrue}
> \def\setLTR{\@RTLfalse}

I don't know much about TeX macros, but I'd rather use lua here.
For example, this macro will switch direction based on the current text
direction. Not exactly what you are doing, but shows some of LuaTeX's
flexibility.

%%%%%%
\catcode`|=\active

\def|#1|{%
\directlua{%
  if tex.textdir == "TLT" then
    tex.print("{".."\luaescapestring{\textdir TRT}".."#1".."}")
  elseif tex.textdir == "TRT" then
    tex.print("{".."\luaescapestring{\textdir TLT}".."#1".."}")
  else
    texio.write_nl("I don't know how to deal with "..tex.textdir.."
direction")
    tex.print("#1")
  end
}}

\obeylines
Hello |World| of wonders!
\textdir TRT
Hello |World| of wonders!
\textdir TLB
Hello |World| of wonders!
\bye
%%%%%%

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/d99e1779/attachment-0001.bin 

From vafakh9 at gmail.com  Sun Mar 29 15:42:44 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 00:42:44 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090329132144.GA13523@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
Message-ID: <ba1882870903290642pa12347cp60631c06d7c4a19c@mail.gmail.com>

Thanks Khaled. I do not know Lua and just started to learn it. I think macro
programming is an art.. In xepersian, I only had four primitives for
directions \beginR, \endR, \beginL, \endL, and I managed everything to work
properly except colours which I did not find any way to fix that.


But offcourse in some situations macro programming gets quite complicated
and so knowing lua will help heaps.

>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/5ef0ae0b/attachment.html 

From Robin.Fairbairns at cl.cam.ac.uk  Sun Mar 29 16:23:31 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sun, 29 Mar 2009 15:23:31 +0100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: Your message of Sun, 29 Mar 2009 14:24:50 +0200.
	<49CF6892.9090904@telecom-bretagne.eu>
Message-ID: <1666.1238336611@cl.cam.ac.uk>

Elie Roux <elie.roux at telecom-bretagne.eu> wrote:

> ??? ????? a ?crit :
> > Hi Do you think that with powerful RTL support of RTL, we do need to
> > have a bidi package in LaTeX? If the answer is yes, I would like to
> > start and write one.
> 
> I really think that anything improving the LuaLaTeX experience is good
> to take, please go on!

but please bear in mind that a unified bidi package with xetex is a
desirable target -- so keep the structure of ctan:macros/xetex/latex/bidi
in mind as you design your code.

robin

From vafakh9 at gmail.com  Sun Mar 29 16:33:13 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 01:33:13 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <1666.1238336611@cl.cam.ac.uk>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
Message-ID: <ba1882870903290733j57e66b6diaab7912a3477533e@mail.gmail.com>

bidi (the one in XeTeX) is good but not perfect. My target is actually what
I did for bodirectional typesetting in xepersian.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/4c3511ce/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 16:56:55 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 01:56:55 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <1666.1238336611@cl.cam.ac.uk>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
Message-ID: <ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>

>
>
> but please bear in mind that a unified bidi package with xetex is a
> desirable target -- so keep the structure of ctan:macros/xetex/latex/bidi
> in mind as you design your code.
>
> robin


Also have a look at the blow page, its a pdf file of the translation of "not
so short introduction to LaTeX2e" which has been typeset by xepersian. It
nicely demonstrates how perfect bidi codes  in xepersian are:

 http://parsilatex.org/latex/lshort-fa.pdf

the bugs that we faced with bidi, caused us to not use bidi any more and
write our own bidi code.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/9824b315/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 17:00:31 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 02:00:31 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
Message-ID: <ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>

More importantly notice the footnotes:

- if the first footnote in a page is Persian, then the footnote rule should
appear in the right hand side.

- if the first footnote in a page is an English one, then the footnote rule
should appear in the left hand side.

That is the perfect rule for footnote in RTL, which bidi does not care.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/752b75d0/attachment.html 

From yannis.haralambous at telecom-bretagne.eu  Sun Mar 29 17:08:51 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 29 Mar 2009 17:08:51 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
Message-ID: <CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>

I would rather say that the side on which the footnote appears does  
not depend of the fact whether it is first or second, but on the  
dominant language of the document. If the dominant language is  
Persian, all footnotes start on the right, if it is French they start  
on the left.

One could also consider changing the dominant language but this should  
be done on the level of a whole page.

Le 29 mars 09 ? 17:00, ??? ????? a ?crit :

> More importantly notice the footnotes:
>
> - if the first footnote in a page is Persian, then the footnote rule  
> should appear in the right hand side.
>
> - if the first footnote in a page is an English one, then the  
> footnote rule should appear in the left hand side.
>
> That is the perfect rule for footnote in RTL, which bidi does not  
> care.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/859721b1/attachment-0002.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/859721b1/attachment-0001.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/859721b1/attachment-0003.html 

From vafakh9 at gmail.com  Sun Mar 29 17:16:23 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 02:16:23 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
Message-ID: <ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>

2009/3/30 Yannis Haralambous <yannis.haralambous at telecom-bretagne.eu>

> I would rather say that the side on which the footnote appears does not
> depend of the fact whether it is first or second, but on the dominant
> language of the document. If the dominant language is Persian, all footnotes
> start on the right, if it is French they start on the left.
> One could also consider changing the dominant language but this should be
> done on the level of a whole page.
>
>

If we only have for example Persian footnotes, the footnote rule will appear
in the right hand side and if we only have English footnotes, the footnote
rule will appear in the left hand side. But Persian users will prefer the
method that I implented if there are mixed Persian and English footnotes.
Let's say if all the footnote rules were to appera in the right hand side
and in a page we had an English footnote, will that page really look nice?

Anyway, maybe we thinkdifferently. But the rule I talked about is the rule
that has been used in Iran and can be seen in Persian maths textbooks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/578e6c87/attachment.html 

From yannis.haralambous at telecom-bretagne.eu  Sun Mar 29 17:31:10 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 29 Mar 2009 17:31:10 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
Message-ID: <7BD73A01-CB7E-4950-A1C0-4C09799AA2C1@telecom-bretagne.eu>

I guess that in both cases there will be situations which will look  
akward. For example, taking your algorithm, one can imagine a page in  
Persian with the first footnote in English and all others in Persian.  
Then all Persian footnotes will be in the right although the English  
one is just an exception...

I think that the dominant language approach has statistically more  
chances in achieving decent results, and would be a good starting  
point or default approach. But, of course, one should be able to apply  
other algorithms!

Le 29 mars 09 ? 17:16, ??? ????? a ?crit :

>
>
>
> 2009/3/30 Yannis Haralambous <yannis.haralambous at telecom-bretagne.eu>
> I would rather say that the side on which the footnote appears does  
> not depend of the fact whether it is first or second, but on the  
> dominant language of the document. If the dominant language is  
> Persian, all footnotes start on the right, if it is French they  
> start on the left.
>
> One could also consider changing the dominant language but this  
> should be done on the level of a whole page.
>
>
>
> If we only have for example Persian footnotes, the footnote rule  
> will appear in the right hand side and if we only have English  
> footnotes, the footnote rule will appear in the left hand side. But  
> Persian users will prefer the method that I implented if there are  
> mixed Persian and English footnotes. Let's say if all the footnote  
> rules were to appera in the right hand side and in a page we had an  
> English footnote, will that page really look nice?
>
> Anyway, maybe we thinkdifferently. But the rule I talked about is  
> the rule that has been used in Iran and can be seen in Persian maths  
> textbooks.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/74950474/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/74950474/attachment.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/74950474/attachment-0001.html 

From Robin.Fairbairns at cl.cam.ac.uk  Sun Mar 29 17:44:03 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sun, 29 Mar 2009 16:44:03 +0100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: Your message of Mon, 30 Mar 2009 01:56:55 +1100.
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
Message-ID: <2639.1238341443@cl.cam.ac.uk>

??? ????? <vafakh9 at gmail.com> wrote:

> Also have a look at the blow page, its a pdf file of the translation of
> "not so short introduction to LaTeX2e" which has been typeset by
> xepersian. It nicely demonstrates how perfect bidi codes?? in xepersian
> are:
> 
> ??[1]http://parsilatex.org/latex/lshort-fa.pdf

it looks lovely, even though i can't read it!

any chance of submitting it to ctan?  (since i can't read it, i don't
see any translator's credit, which would be needed for the ctan
catalogue, but you could presumably supply that.)

> the bugs that we faced with bidi, caused us to not use bidi any more and
> write our own bidi code.

did you feed back to francois, about the problems?  if you're working in
the area, it would be good to bring his package along on your coat tails
(as it were...).

robin

From khaledhosny at eglug.org  Sun Mar 29 18:47:27 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 18:47:27 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
Message-ID: <20090329164727.GB1636@khaled-laptop>

That is the preferred method in Arabic (at least the books that I've
seen), all footnotes are aligned to right. So, I think this should be
configurable by the relevant package.

Regards,
 Khaled


On Sun, Mar 29, 2009 at 05:08:51PM +0200, Yannis Haralambous wrote:
> I would rather say that the side on which the footnote appears does not 
> depend of the fact whether it is first or second, but on the dominant 
> language of the document. If the dominant language is Persian, all 
> footnotes start on the right, if it is French they start on the left.
>
> One could also consider changing the dominant language but this should  
> be done on the level of a whole page.
>
> Le 29 mars 09 ? 17:00, ??? ????? a ?crit :
>
>> More importantly notice the footnotes:
>>
>> - if the first footnote in a page is Persian, then the footnote rule  
>> should appear in the right hand side.
>>
>> - if the first footnote in a page is an English one, then the footnote 
>> rule should appear in the left hand side.
>>
>> That is the perfect rule for footnote in RTL, which bidi does not  
>> care.
>
> --
> + 
> -----------------------------------------------------------------------+
> | Yannis Haralambous, Ph.D.      yannis.haralambous at telecom-bretagne.eu |
> | Directeur d'?tudes                      http://omega.enstb.org/yannis |
> |                                             Tel. +33 (0)2.29.00.14.27 |
> |                                             Fax  +33 (0)2.29.00.12.82 |
> | D?partement Informatique                                              |
> | T?l?com Bretagne                                                      |
> | Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3, France     |
> | Coordonn?es Google-Earth : 48?21'31.57"N 4?34'16.76"W                 |
> + 
> -----------------------------------------------------------------------+
>                             ...pour distinguer l'ext?rieur d'un  
> aquarium,
>                                            mieux vaut n'?tre pas poisson
>
>                            ...the ball I threw while playing in the park
>                                           has not yet reached the ground
>
>               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
> sprechen,
>            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
> m?gen.
>
>
>

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/7f001a60/attachment-0001.bin 

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Sun Mar 29 18:54:58 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 10:54:58 -0600
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
Message-ID: <op.urkbxwbgfkrasx@your-b27fb1c401>

Hi,

On Sun, 29 Mar 2009 09:16:23 -0600, ??? ????? <vafakh9 at gmail.com> wrote:

> Anyway, maybe we thinkdifferently. But the rule I talked about is the  
> rule that has been used in Iran and can be seen in Persian maths  
> textbooks.

Keep in mind that Arabic and Farsi have different rules as well -- not to  
mention Urdu --, so the dominant-language aspect is important. In any  
case, configurability is key...

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From vafakh9 at gmail.com  Sun Mar 29 22:31:20 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 07:31:20 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <2639.1238341443@cl.cam.ac.uk>
References: <ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<2639.1238341443@cl.cam.ac.uk>
Message-ID: <ba1882870903291331xbdfd62ev5a4b5cbdb3773f03@mail.gmail.com>

>
>
> it looks lovely, even though i can't read it!
>
> any chance of submitting it to ctan?  (since i can't read it, i don't
> see any translator's credit, which would be needed for the ctan
> catalogue, but you could presumably supply that.)


I think it will be uploaded to CTAN very soon. The translator is Mehdi
Omidali.


>
>
>
> did you feed back to francois, about the problems?  if you're working in
> the area, it would be good to bring his package along on your coat tails
> (as it were...).
>
> robin


Yes, I did. For example:

http://tug.org/mailman/htdig/xetex/2008-November/011333.html

http://tug.org/mailman/htdig/xetex/2008-December/011359.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/4632cff8/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 22:36:58 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 07:36:58 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <20090329164727.GB1636@khaled-laptop>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<20090329164727.GB1636@khaled-laptop>
Message-ID: <ba1882870903291336w12e07978v82e90f308e17b3e4@mail.gmail.com>

On Mon, Mar 30, 2009 at 3:47 AM, Khaled Hosny <khaledhosny at eglug.org> wrote:

> That is the preferred method in Arabic (at least the books that I've
> seen), all footnotes are aligned to right. So, I think this should be
> configurable by the relevant package.
>
>
You are absolutely right. But what kind of textbooks? Most of the Persian
users use TeX to write texts which involve lots of maths and English
footnotes can be seen heaps and even much more than persian footnotes. The
approach to have all the footnotes in the right is simple and it is good
when you only have Persian footnotes. But when you have mixed footnotes you
will need to imlement a much more sophisticated design.

I think we could do something about all of these but please look at my
response to Khaled.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/a49cfea9/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 22:43:01 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 07:43:01 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <op.urkbxwbgfkrasx@your-b27fb1c401>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
Message-ID: <ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>

Keep in mind that Arabic and Farsi have different rules as well -- not to
> mention Urdu --, so the dominant-language aspect is important. In any case,
> configurability is key...
>
>
I think with our discussion so far, the best thing is designing options, so
we take care of footnotes in additions to other different rules in different
languages.

for footnotes:

in Persian the rule I talked about needs to be implemented.

There is one more idea and I do not know if it is any good in RTL. We could
have a very simple design and that is the footnote rule's widths is the same
as textwidth and if my memory is correct, that is what Donald Knuth used in
his TeXBook.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/c5d4778b/attachment.html 

From vafakh9 at gmail.com  Sun Mar 29 22:55:38 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 30 Mar 2009 07:55:38 +1100
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
Message-ID: <ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>

One more thing with Persian typesetting in LuaTeX which concerns me is the
"Kashida" concept in Persian and I think it is the same in Arabic. We had a
discussion on XeTeX mailing list and Jonathan implemented Kashida for
Persian. Please have a look at

http://tug.org/pipermail/xetex/2009-February/012306.html

http://tug.org/pipermail/xetex/2009-February/012307.html


Now you can find development files at
http://scripts.sil.org/svn-public/xetex/TRUNK/texmf/tex/xelatex/xepersian

Jonathan used \XeTeXinterchartoks to implement Kashida. The question is can
the same thing be done in luatex (does luatex provide any primitive similar
to \XeTeXinterchartoks) or I should bewritting some lua codes for that?*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090330/6ba20dd9/attachment.html 

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Sun Mar 29 23:37:09 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 15:37:09 -0600
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
Message-ID: <op.urkoz0mwfkrasx@your-b27fb1c401>

On Sun, 29 Mar 2009 14:55:38 -0600, ??? ????? <vafakh9 at gmail.com> wrote:

> Jonathan used \XeTeXinterchartoks to implement Kashida.

That ugly, fake, and contrived Arabic-Farsi word, Kashida. I did some  
research on the origins of this word... better to call it Tatweel. :-)

> The question is can
> the same thing be done in luatex (does luatex provide any primitive  
> similar
> to \XeTeXinterchartoks) or I should bewritting some lua codes for that?*

We are working on a new way to do this in luatex, different from xetex or  
omega. Stay tuned :-)

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From khaledhosny at eglug.org  Sun Mar 29 23:39:16 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 23:39:16 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903291336w12e07978v82e90f308e17b3e4@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<20090329164727.GB1636@khaled-laptop>
	<ba1882870903291336w12e07978v82e90f308e17b3e4@mail.gmail.com>
Message-ID: <20090329213916.GA15980@khaled-laptop>

On Mon, Mar 30, 2009 at 07:36:58AM +1100, ??? ????? wrote:
> 
> 
> On Mon, Mar 30, 2009 at 3:47 AM, Khaled Hosny <khaledhosny at eglug.org> wrote:
> 
>     That is the preferred method in Arabic (at least the books that I've
>     seen), all footnotes are aligned to right. So, I think this should be
>     configurable by the relevant package.
> 
> 
> 
> You are absolutely right. But what kind of textbooks? Most of the Persian users
> use TeX to write texts which involve lots of maths and English footnotes can be
> seen heaps and even much more than persian footnotes. The approach to have all
> the footnotes in the right is simple and it is good when you only have Persian
> footnotes. But when you have mixed footnotes you will need to imlement a much
> more sophisticated design.

I was referring to mixed footnotes, I just checked two printed books with mixed
Greek/Arabic footnotes, and all footnotes are aligned to right.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/7f4887ae/attachment.bin 

From khaledhosny at eglug.org  Sun Mar 29 23:44:30 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 23:44:30 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
Message-ID: <20090329214430.GB15980@khaled-laptop>

On Mon, Mar 30, 2009 at 07:55:38AM +1100, ??? ????? wrote:
> same thing be done in luatex (does luatex provide any primitive similar to \
> XeTeXinterchartoks) or I should bewritting some lua codes for that?

In luaTeX you can override line breaking algorithm with lua code, this
is more sophisticated and I think can be used to implement Kashida or
more advanced Arabic justification. Please keep in mind that, Kashida
should not be inserted between all connectable letters (for example
Kasida in the middle of ?? is undesirable), and Kashida's point of
insertion should be prioritized with highest priority points applied
first and so one.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/d36f8b18/attachment-0001.bin 

From hartmut_henkel at gmx.de  Sun Mar 29 23:47:21 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 29 Mar 2009 23:47:21 +0200 (CEST)
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>

On Sun, 29 Mar 2009, ??? ????? wrote:

> In the latest version of luatex, namely snapshot-0.36.0-2009032321,
> when I create the table of contents in RTL, the dots that appear in
> between subsection name and the page number for example goes to the
> wrong direction.( see attached file). I had no issues with this in the
> previous version of luatex.
>
> So is this a bug in luatex or I should write some macro to fix this.

\leaders in directions != TLT are broken, sorry, will try to fix...

Regards, Hartmut

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Sun Mar 29 23:51:47 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 15:51:47 -0600
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <20090329214430.GB15980@khaled-laptop>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<20090329214430.GB15980@khaled-laptop>
Message-ID: <op.urkpolqbfkrasx@your-b27fb1c401>

On Sun, 29 Mar 2009 15:44:30 -0600, Khaled Hosny <khaledhosny at eglug.org>  
wrote:

> Kashida

Not to dwell on this, but the term 'kashida' is about the ugliest  
monstrosity to be forced upon the Arabic or Farsi language: it's not real  
Arabic, it's not real Farsi. 'Tatweel' is much preferred, and is a real  
word. I hope that we can collectively work to eradicate this contriviality  
 from the face of the earth...

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Sun Mar 29 23:55:51 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 15:55:51 -0600
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
Message-ID: <op.urkpvdozfkrasx@your-b27fb1c401>

On Sun, 29 Mar 2009 15:47:21 -0600, Hartmut Henkel <hartmut_henkel at gmx.de>  
wrote:

> On Sun, 29 Mar 2009, ??? ????? wrote:
>
>> In the latest version of luatex, namely snapshot-0.36.0-2009032321,
>> when I create the table of contents in RTL, the dots that appear in
>> between subsection name and the page number for example goes to the
>> wrong direction.( see attached file). I had no issues with this in the
>> previous version of luatex.
>>
>> So is this a bug in luatex or I should write some macro to fix this.
>
> \leaders in directions != TLT are broken, sorry, will try to fix...

That's good to know, I spent a long time scratching my head about why I  
could not get my own leaders macro to work...

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From khaledhosny at eglug.org  Sun Mar 29 23:58:54 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 29 Mar 2009 23:58:54 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <op.urkpolqbfkrasx@your-b27fb1c401>
References: <1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<20090329214430.GB15980@khaled-laptop>
	<op.urkpolqbfkrasx@your-b27fb1c401>
Message-ID: <20090329215854.GA17145@khaled-laptop>

On Sun, Mar 29, 2009 at 03:51:47PM -0600, Idris Samawi Hamid ????? ????? ???? wrote:
> On Sun, 29 Mar 2009 15:44:30 -0600, Khaled Hosny <khaledhosny at eglug.org>  
> wrote:
>
>> Kashida
>
> Not to dwell on this, but the term 'kashida' is about the ugliest  
> monstrosity to be forced upon the Arabic or Farsi language: it's not real 
> Arabic, it's not real Farsi. 'Tatweel' is much preferred, and is a real  
> word. I hope that we can collectively work to eradicate this 
> contriviality from the face of the earth...

Well, it is the word that used in all calligraphy books I've read, and
used by all calligrapher I met. Though Tatweel is an Arabic word, I
don't recall hearing any calligrapher using it. I'm not against Tatweel
though, but not as if Kashida is word of some devil origins :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090329/024a46d4/attachment.bin 

From yannis.haralambous at telecom-bretagne.eu  Sun Mar 29 23:59:14 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 29 Mar 2009 23:59:14 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
Message-ID: <31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>

in omega we have added fi (smaller than fil) for keshideh. But I  
believe that straight-line keshideh are very ugly. One should be able  
to produce curvilinear ones.

Le 29 mars 09 ? 22:55, ??? ????? a ?crit :

> One more thing with Persian typesetting in LuaTeX which concerns me  
> is the "Kashida" concept in Persian and I think it is the same in  
> Arabic. We had a discussion on XeTeX mailing list and Jonathan  
> implemented Kashida for Persian. Please have a look at
>
> http://tug.org/pipermail/xetex/2009-February/012306.html
>
> http://tug.org/pipermail/xetex/2009-February/012307.html
>
>
> Now you can find development files at http://scripts.sil.org/svn-public/xetex/TRUNK/texmf/tex/xelatex/xepersian
>
> Jonathan used \XeTeXinterchartoks to implement Kashida. The question  
> is can the same thing be done in luatex (does luatex provide any  
> primitive similar to \XeTeXinterchartoks) or I should bewritting  
> some lua codes for that?

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/af071115/attachment-0002.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090329/af071115/attachment-0001.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090329/af071115/attachment-0003.html 

From hartmut_henkel at gmx.de  Mon Mar 30 00:05:18 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 30 Mar 2009 00:05:18 +0200 (CEST)
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <op.urkpvdozfkrasx@your-b27fb1c401>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
	<op.urkpvdozfkrasx@your-b27fb1c401>
Message-ID: <alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>

On Sun, 29 Mar 2009, Idris Samawi Hamid ????? ????? ???? wrote:
> On Sun, 29 Mar 2009 15:47:21 -0600, Hartmut Henkel <hartmut_henkel at gmx.de>
> wrote:
> > > So is this a bug in luatex or I should write some macro to fix this.
> >
> > \leaders in directions != TLT are broken, sorry, will try to fix...
>
> That's good to know, I spent a long time scratching my head about why
> I could not get my own leaders macro to work...

sorry for the annoyance, it should work now also in PDF (SVN 2161), DVI
was fine. There is a test case -- vertical seems to be ok as well:

%\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT
\pagedir LTT \bodydir LTT \pardir LTT \textdir LTT

\hbox to \hsize{l\leaders\hbox{.}\hfill r}
\hbox to \hsize{l\hfill r}

\input tufte

\bye

Regards, Hartmut

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Mon Mar 30 00:23:38 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 16:23:38 -0600
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>
Message-ID: <op.urkq5ozdfkrasx@your-b27fb1c401>

On Sun, 29 Mar 2009 15:59:14 -0600, Yannis Haralambous  
<yannis.haralambous at telecom-bretagne.eu> wrote:

> But I believe that straight-line keshideh are very ugly.

In many cases, yes. M$'s 3-level implementation is almost always ugly. But  
carefully calibrated, with a good font and appropriately chosen legal  
stretching points, there are places where auto-tatweel is typographically  
appropriate, like thin columns at small type sizes, or marginal notes.

Even in old manuscripts you can find horizontal tatweel used in poetry and  
the like...

> One should be able to produce curvilinear ones.

That is indeed the ideal.

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From hartmut_henkel at gmx.de  Mon Mar 30 00:24:44 2009
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 30 Mar 2009 00:24:44 +0200 (CEST)
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090329132144.GA13523@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
Message-ID: <alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>

On Sun, 29 Mar 2009, Khaled Hosny wrote:

> On Sun, Mar 29, 2009 at 11:05:43PM +1100, ??? ????? wrote:
> > one more question, why if I use \setRTL at the beginning of the document it
> > does not works which is defined as
> >
> > \newif\if at RTL
> > \if at RTL\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT \else \pagedir TLT \
> > bodydir TLT \pardir TLT \textdir TLT \fi
> > \def\setRTL{\@RTLtrue}
> > \def\setLTR{\@RTLfalse}
>
> I don't know much about TeX macros, but I'd rather use lua here.
> For example, this macro will switch direction based on the current text
> direction. Not exactly what you are doing, but shows some of LuaTeX's
> flexibility.
>
> %%%%%%
> \catcode`|=\active
>
> \def|#1|{%
> \directlua{%
>   if tex.textdir == "TLT" then
>     tex.print("{".."\luaescapestring{\textdir TRT}".."#1".."}")
>   elseif tex.textdir == "TRT" then
>     tex.print("{".."\luaescapestring{\textdir TLT}".."#1".."}")
>   else
>     texio.write_nl("I don't know how to deal with "..tex.textdir.."
> direction")
>     tex.print("#1")
>   end
> }}
>
> \obeylines
> Hello |World| of wonders!
> \textdir TRT
> Hello |World| of wonders!
> \textdir TLB
> Hello |World| of wonders!
> \bye
> %%%%%%

nice example! However i don't know what to do in the TLB case. Currently
the glyphs hang down from the text baseline (as shown in the example),
but maybe in TLB mode also the glyph baselines should be aligned with
the text baseline. Any idea what's right?

Regards, Hartmut

From yannis.haralambous at telecom-bretagne.eu  Mon Mar 30 00:31:29 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Mon, 30 Mar 2009 00:31:29 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <op.urkq5ozdfkrasx@your-b27fb1c401>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>
	<op.urkq5ozdfkrasx@your-b27fb1c401>
Message-ID: <BC9CA2DD-B288-4D91-979B-C6C18E49212E@telecom-bretagne.eu>

Nice to hear from you Idris!

I can't help it but when I see verses of Arabic poetry filled with  
rectilinear tatweel to have both-side justification, it makes me think  
of a typewriter, needless to say that it is horrifying.

Modern fonts with small rectilinear tatweel are OK. But in poetry  
tatweel is often quite important, sometimes you have as much tatweel  
as letters, in that case it must be curvilinear.

The problem comes from the way Arabic script is segmentated. Breaking  
glyphs between letters is a bad choice. Take for example a medial noon  
followed by a fah. The stroke starting from the top of the medial noon  
and arriving at the highest position of the fah should be unique,  
unbreakable and perfectly drawn. When you start breaking it into  
pieces and inserting extra stuff you have lost the dynamics of Arabic  
script. It woudl be better to have either many of these strokes (with  
various widths) or a way to draw them in arbitrary widths, but always  
not-broken.

A student of Azzeddine is working on that.

Cheers

Yannis

Le 30 mars 09 ? 00:23, Idris Samawi Hamid ????? ?????  
???? a ?crit :

> On Sun, 29 Mar 2009 15:59:14 -0600, Yannis Haralambous <yannis.haralambous at telecom-bretagne.eu 
> > wrote:
>
>> But I believe that straight-line keshideh are very ugly.
>
> In many cases, yes. M$'s 3-level implementation is almost always  
> ugly. But carefully calibrated, with a good font and appropriately  
> chosen legal stretching points, there are places where auto-tatweel  
> is typographically appropriate, like thin columns at small type  
> sizes, or marginal notes.
>
> Even in old manuscripts you can find horizontal tatweel used in  
> poetry and the like...
>
>> One should be able to produce curvilinear ones.
>
> That is indeed the ideal.
>
> Best wishes
> Idris
>
> -- 
> Professor Idris Samawi Hamid, Editor-in-Chief
> International Journal of Shi`i Studies
> Department of Philosophy
> Colorado State University
> Fort Collins, CO 80523
>

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090330/e728b516/attachment.bin 
-------------- next part --------------



From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Mon Mar 30 00:41:37 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 16:41:37 -0600
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <BC9CA2DD-B288-4D91-979B-C6C18E49212E@telecom-bretagne.eu>
References: <49CF6892.9090904@telecom-bretagne.eu>
	<1666.1238336611@cl.cam.ac.uk>
	<ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>
	<op.urkq5ozdfkrasx@your-b27fb1c401>
	<BC9CA2DD-B288-4D91-979B-C6C18E49212E@telecom-bretagne.eu>
Message-ID: <op.urkrzndgfkrasx@your-b27fb1c401>

Hi Yannis,

On Sun, 29 Mar 2009 16:31:29 -0600, Yannis Haralambous  
<yannis.haralambous at telecom-bretagne.eu> wrote:

> Take for example a medial noon followed by a fah. The stroke starting  
> from the top of the medial noon and arriving at the highest position of  
> the fah should be unique, unbreakable and perfectly drawn.

Indeed, that is mandatory, and NF_mm_f [medial Nuun + medial or final  
Faa****] is a good example.

> When you start breaking it into pieces and inserting extra stuff you  
> have lost the dynamics of Arabic script.

or the pieces have to seemlessly fit together to give the appearance of  
continuity.

Best wishes
Idris

**** I have worked out a new nomenclature for these kinds of thing, which  
I hope to publish soon...

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=  Mon Mar 30 01:14:48 2009
From: =?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?= (=?utf-8?B?SWRyaXMgU2FtYXdpIEhhbWlkINin2K/YsdmK2LMg2LPZhdin2YjZiiDYrQ==?=)
Date: Sun, 29 Mar 2009 17:14:48 -0600
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
	<op.urkpvdozfkrasx@your-b27fb1c401>
	<alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
Message-ID: <op.urktiyfmfkrasx@your-b27fb1c401>

On Sun, 29 Mar 2009 16:05:18 -0600, Hartmut Henkel <hartmut_henkel at gmx.de>  
wrote:

> sorry for the annoyance, it should work now also in PDF (SVN 2161), DVI
> was fine.

For fun: What is it with TeX and leaders? There always appears to be some  
leaders bug popping up in the code, in the different engines etc...  
low-level stuff is a black box for me but i find this consistent leaders  
bugginess amusing nonetheless...

Best wishes
Idris

-- 
Professor Idris Samawi Hamid, Editor-in-Chief
International Journal of Shi`i Studies
Department of Philosophy
Colorado State University
Fort Collins, CO 80523

From khaledhosny at eglug.org  Mon Mar 30 01:13:41 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 30 Mar 2009 01:13:41 +0200
Subject: [luatex] a bidi package for LaTeX in LuaTeX
In-Reply-To: <BC9CA2DD-B288-4D91-979B-C6C18E49212E@telecom-bretagne.eu>
References: <ba1882870903290756s4afaa406x3e192131bfa1466f@mail.gmail.com>
	<ba1882870903290800m446e432k5ca62d43cd11ae3a@mail.gmail.com>
	<CDB78754-20C0-4886-BF6C-0095105BA824@telecom-bretagne.eu>
	<ba1882870903290816v17e03c18gb95d6f6e78e2ac86@mail.gmail.com>
	<op.urkbxwbgfkrasx@your-b27fb1c401>
	<ba1882870903291343t4080d057p4d54e0d3bb61238@mail.gmail.com>
	<ba1882870903291355l5eb5a0bia538234027bb91f1@mail.gmail.com>
	<31BCC08A-273C-46E4-B3AE-FBE1E23DB921@telecom-bretagne.eu>
	<op.urkq5ozdfkrasx@your-b27fb1c401>
	<BC9CA2DD-B288-4D91-979B-C6C18E49212E@telecom-bretagne.eu>
Message-ID: <20090329231341.GA21824@khaled-laptop>

On Mon, Mar 30, 2009 at 12:31:29AM +0200, Yannis Haralambous wrote:
> The problem comes from the way Arabic script is segmentated. Breaking  
> glyphs between letters is a bad choice. Take for example a medial noon  
> followed by a fah. The stroke starting from the top of the medial noon  
> and arriving at the highest position of the fah should be unique,  
> unbreakable and perfectly drawn.

This could have been fairly to do in OpenType of there is many to many
GSUB lookup, then one would have the connecting stroke as a single
glyph (may be several ones with different lengths for justification) and
noon/feh - connecting stroke glyphs, then the sequence <noon><feh> would be
replaced by <noon - stroke><stroke><feh - stroke>. But unfortunately
OpenType doesn't allow such replacement (Graphite does, BTW).

But another, more complicated approach would be having to variant
feh/noon glyphs, each with his half of that unique connecting stroke and
using contextual substitution lookups. But having connecting strokes
with different lengths will complicate it further; we'll need tow new
glyphs for each length and reverse contextual substitution to make sure
that of one glyph (say feh) is replaced by the longer variant, the
corresponding longer noon get used too.

Just my two cents.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090330/8d9dc42f/attachment-0001.bin 

From khaledhosny at eglug.org  Mon Mar 30 02:09:50 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 30 Mar 2009 02:09:50 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
	<alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>
Message-ID: <20090330000950.GA22610@khaled-laptop>

On Mon, Mar 30, 2009 at 12:24:44AM +0200, Hartmut Henkel wrote:
> On Sun, 29 Mar 2009, Khaled Hosny wrote:
> nice example! However i don't know what to do in the TLB case. Currently
> the glyphs hang down from the text baseline (as shown in the example),
> but maybe in TLB mode also the glyph baselines should be aligned with
> the text baseline. Any idea what's right?

I didn't think in it before, I don't know where TLB would be used. Now,
I can think it is used in Indic scripts (in which the glyphs usually
hang from the base line), then TRT for Arabic would be the logical
choice, imagine Devanagari mixed with Arabic. TRB wouldn't make any
sense for Arabic since it will break the way glyphs are connected
together, unless the glyphs are rotated 180 degrees which would be very
funny but almost useless.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090330/f3408b6e/attachment.bin 

From khaledhosny at eglug.org  Mon Mar 30 02:41:50 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 30 Mar 2009 02:41:50 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090330000950.GA22610@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
	<alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>
	<20090330000950.GA22610@khaled-laptop>
Message-ID: <20090330004150.GA25828@khaled-laptop>

On Mon, Mar 30, 2009 at 02:09:50AM +0200, Khaled Hosny wrote:
> On Mon, Mar 30, 2009 at 12:24:44AM +0200, Hartmut Henkel wrote:
> > On Sun, 29 Mar 2009, Khaled Hosny wrote:
> > nice example! However i don't know what to do in the TLB case. Currently
> > the glyphs hang down from the text baseline (as shown in the example),
> > but maybe in TLB mode also the glyph baselines should be aligned with
> > the text baseline. Any idea what's right?
> 
> I didn't think in it before, I don't know where TLB would be used. Now,
> I can think it is used in Indic scripts (in which the glyphs usually
> hang from the base line), then TRT for Arabic would be the logical
> choice, imagine Devanagari mixed with Arabic. TRB wouldn't make any
> sense for Arabic since it will break the way glyphs are connected
> together, unless the glyphs are rotated 180 degrees which would be very
> funny but almost useless.

I see now, I should have checked it first, sorry. I think in TLB the base
line should be raised to get better matching with, say, Arabic or Latin
script. [1] shows a nice summery of different baselines.

OpenType fonts should provide such information, see [2], so, I think
baseline adjustment should be done as part of OpenType processing.

[1]http://fontforge.sourceforge.net/overview.html#Baseline
[2]http://www.microsoft.com/typography/otspec/BASE.htm

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090330/f006513c/attachment.bin 

From khaledhosny at eglug.org  Mon Mar 30 02:53:48 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 30 Mar 2009 02:53:48 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090330004150.GA25828@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
	<alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>
	<20090330000950.GA22610@khaled-laptop>
	<20090330004150.GA25828@khaled-laptop>
Message-ID: <20090330005348.GB25828@khaled-laptop>

On Mon, Mar 30, 2009 at 02:41:50AM +0200, Khaled Hosny wrote:
> On Mon, Mar 30, 2009 at 02:09:50AM +0200, Khaled Hosny wrote:
> > On Mon, Mar 30, 2009 at 12:24:44AM +0200, Hartmut Henkel wrote:
> > > On Sun, 29 Mar 2009, Khaled Hosny wrote:
> > > nice example! However i don't know what to do in the TLB case. Currently
> > > the glyphs hang down from the text baseline (as shown in the example),
> > > but maybe in TLB mode also the glyph baselines should be aligned with
> > > the text baseline. Any idea what's right?
> > 
> > I didn't think in it before, I don't know where TLB would be used. Now,
> > I can think it is used in Indic scripts (in which the glyphs usually
> > hang from the base line), then TRT for Arabic would be the logical
> > choice, imagine Devanagari mixed with Arabic. TRB wouldn't make any
> > sense for Arabic since it will break the way glyphs are connected
> > together, unless the glyphs are rotated 180 degrees which would be very
> > funny but almost useless.
> 
> I see now, I should have checked it first, sorry. I think in TLB the base
> line should be raised to get better matching with, say, Arabic or Latin
> script. [1] shows a nice summery of different baselines.

Replying to myself again :) this a poor attempt to imitate this:

\setbox0\hbox{A}
English text \raise\the\ht0\hbox dir TLB{Devanagari text} English again.
\bye

I don't read any Indic language myself, so all this may be nonsense :)

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090330/af893291/attachment.bin 

From yannis.haralambous at telecom-bretagne.eu  Mon Mar 30 08:06:56 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Mon, 30 Mar 2009 08:06:56 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090330000950.GA22610@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<49CF5F48.9080105@wxs.nl>
	<ba1882870903290505x5cf4fd4ax8c64f795f2ad05b@mail.gmail.com>
	<20090329132144.GA13523@khaled-laptop>
	<alpine.DEB.1.00.0903300020490.7487@hahepc1.hahe>
	<20090330000950.GA22610@khaled-laptop>
Message-ID: <FF77791F-CB03-44D8-A049-A0F6EF4B64F7@telecom-bretagne.eu>

In theory, TLB could be used in some Indic scripts, Tibetan and  
Hebrew. In practice one can very well do without

Le 30 mars 09 ? 02:09, Khaled Hosny a ?crit :

> I didn't think in it before, I don't know where TLB would be used.  
> Now,

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090330/e686e551/attachment.bin 
-------------- next part --------------



From taco at elvenkind.com  Tue Mar 31 16:18:12 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 31 Mar 2009 16:18:12 +0200
Subject: [luatex] luatex beta 0.37.0
Message-ID: <49D22624.2020302@elvenkind.com>

Hi,

I have just uploaded luatex 0.37.0.

This is a beta in the process towards 0.40.0, the version that
will be included in texlive 2009. This beta will be shortlived,
the plan is to release the next one in about a week.

This release is mainly intended to allow testing of two new things:

* The new build process, which is based on the one that will be
used for texlive 2009.

Lots of build-time stuff is overhauled, and that means that the binary
itself as well as the build process needs testing. Please try on
your system and let us know if something goes amiss.

* The new shell_escape = 'p' functionality invented by Karl and Akira.

Karl wrote about that:

> As I've mentioned to some of you, Akira and I have been implemented a
> restricted version of \write18: only commands which are explicitly
> listed in texmf.cnf can be executed.  Along with sufficient quoting, I
> think that this is secure enough that it can be enabled by default, and
> I plan to do this for TeX Live 2009.

The texmf.cnf variable for 'acceptable commands' is named
shell_escape_commands. In luatex, the variables shell_escape and
shell_escape_commands will be fetched from the texconfig table in case
of a disabled kpathsea (as context mkiv does).

The important thing to note is that if you are typesetting a document
with luatex (as opposed to executing a texlua script), these variables
now also effect the os.execute(), io.popen(), os.exec() and os.spawn()
functions. Unless a non-false value of shell_escape has been read from
either texmf.cnf or the texconfig table, these functions will not do
anything anymore.

Nothing has changed for the case where luatex is used as a script
interpreter.


==============================================================
Luatex beta-0.37.0 was released 20090331 (commit #2194)
==============================================================

* Luatex now implements shell_escape = 'p', a new feature
  in web2c that intends to make \write18 more secure.

* Attributes can now have negative values. The special value
  for 'unset' is lowered to -0x7FFFFFFF (it used to be -1).

* The lua 'kpse' library now has an object-oriented interface
  as companion to the procedural interface. This is useful for
  e.g. controlling the discovery of mplib files.

* The new internal integer parameter \outputbox allows setting
  of the output box number (default: 255, max: 65535)

* The new primitives \Udelimiterunder and \Udelimiterover
  complete the set of 'StretchStacks' for OpenType Math.

* Fixed a bug in font string conversions on the Macintosh that
  resulted in warnings about 'unaligned pointers being freed'.

* Khaled Hosny spotted a bunch of manual errors.

* There was bug in the width of math_accent objects when
  there were super- or subscripts attached to the accentee.

* In PDF mode, TRT \leaders were bugged.

* The source tree now uses the new texlive build system that
  Peter Breitenlohner created.

* There is now a single build.sh instead of four separate
  ones. It has a few options:
      --make      : only make, no make distclean; configure
      --parallel  : make -j 2 -l 3.0
      --nostrip   : do not strip binary
      --mingw     : crosscompile for mingw32 from i386-linux
      --ppc       : crosscompile for ppc osx on intel osx

  Note: --parallel still sometimes causes crashes due to
  timing errors, so use that option with care.

* Many compiler warnings have been removed (but not all yet).


The archives (now including source again) can be downloaded from
supelec as usual:

        http://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.37.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Taco



From khaledhosny at eglug.org  Tue Mar 31 16:49:51 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 31 Mar 2009 16:49:51 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
	<op.urkpvdozfkrasx@your-b27fb1c401>
	<alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
Message-ID: <20090331144951.GA23433@khaled-laptop>

On Mon, Mar 30, 2009 at 12:05:18AM +0200, Hartmut Henkel wrote:
> On Sun, 29 Mar 2009, Idris Samawi Hamid ????? ????? ???? wrote:
> > On Sun, 29 Mar 2009 15:47:21 -0600, Hartmut Henkel <hartmut_henkel at gmx.de>
> > wrote:
> > > > So is this a bug in luatex or I should write some macro to fix this.
> > >
> > > \leaders in directions != TLT are broken, sorry, will try to fix...
> >
> > That's good to know, I spent a long time scratching my head about why
> > I could not get my own leaders macro to work...
> 
> sorry for the annoyance, it should work now also in PDF (SVN 2161), DVI
> was fine. There is a test case -- vertical seems to be ok as well:
> 
> %\pagedir TRT \bodydir TRT \pardir TRT \textdir TRT
> \pagedir LTT \bodydir LTT \pardir LTT \textdir LTT
> 
> \hbox to \hsize{l\leaders\hbox{.}\hfill r}
> \hbox to \hsize{l\hfill r}
> 
> \input tufte
> 
> \bye

I can confirm it is fixed in 0.37, but display math still broken; it is
shifted to the right and gets even more shifted when \eqn is used,
unless \mathdir TRT is used. Here is a test:

\pagedir TRT\bodydir TRT\pardir TRT
$$1+2=3$$
$$1+2=3\eqno(1)$$

\mathdir TRT
$$1+2=3$$
$$1+2=3\eqno(1)$$

\bye

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090331/16bf6cda/attachment.bin 

From vafakh9 at gmail.com  Tue Mar 31 16:53:39 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Wed, 1 Apr 2009 01:53:39 +1100
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <49D22624.2020302@elvenkind.com>
References: <49D22624.2020302@elvenkind.com>
Message-ID: <ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>

Thank you.

But http://foundry.supelec.fr/projects/luatex/ gives load error for me. Is
it down?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090401/2bda0ce3/attachment.html 

From vafakh9 at gmail.com  Tue Mar 31 16:57:04 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Wed, 1 Apr 2009 01:57:04 +1100
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <20090331144951.GA23433@khaled-laptop>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
	<op.urkpvdozfkrasx@your-b27fb1c401>
	<alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
	<20090331144951.GA23433@khaled-laptop>
Message-ID: <ba1882870903310757h32dc68b9vc19bb7cea15b4a7@mail.gmail.com>

Thanks khaled. Hopefully the display math will be fixed in the next version.
That allows me to finish my luabidi package. The page
http://foundry.supelec.fr/projects/luatex/ gives load error for me. How did
you get v0.37 of luatex?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090401/0b6cf88d/attachment.html 

From Robin.Fairbairns at cl.cam.ac.uk  Tue Mar 31 16:58:37 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 31 Mar 2009 15:58:37 +0100
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: Your message of Wed, 01 Apr 2009 01:53:39 +1100.
	<ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>
Message-ID: <31332.1238511517@cl.cam.ac.uk>

??? ????? <vafakh9 at gmail.com> wrote:

> But [1]http://foundry.supelec.fr/projects/luatex/ gives load error for me.
> Is it down?

no -- not as seen from here.

r

From vafakh9 at gmail.com  Tue Mar 31 17:00:57 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Wed, 1 Apr 2009 02:00:57 +1100
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <31332.1238511517@cl.cam.ac.uk>
References: <ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>
	<31332.1238511517@cl.cam.ac.uk>
Message-ID: <ba1882870903310800o4d43140dlc3a091ef08524884@mail.gmail.com>

but it is down for me. (snapshot attached)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090401/9b403709/attachment-0001.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot-Page Load Error - Mozilla Firefox.png
Type: image/png
Size: 86004 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090401/9b403709/attachment-0001.png 

From khaledhosny at eglug.org  Tue Mar 31 17:04:37 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 31 Mar 2009 17:04:37 +0200
Subject: [luatex] bug in RTL typesetting?
In-Reply-To: <ba1882870903310757h32dc68b9vc19bb7cea15b4a7@mail.gmail.com>
References: <ba1882870903290332h6d7998aawa4316706aa238107@mail.gmail.com>
	<alpine.DEB.1.00.0903292346370.5121@hahepc1.hahe>
	<op.urkpvdozfkrasx@your-b27fb1c401>
	<alpine.DEB.1.00.0903300000190.6043@hahepc1.hahe>
	<20090331144951.GA23433@khaled-laptop>
	<ba1882870903310757h32dc68b9vc19bb7cea15b4a7@mail.gmail.com>
Message-ID: <20090331150437.GA7028@khaled-laptop>

On Wed, Apr 01, 2009 at 01:57:04AM +1100, ??? ????? wrote:
> Thanks khaled. Hopefully the display math will be fixed in the next version.
> That allows me to finish my luabidi package. The page http://foundry.supelec.fr
> /projects/luatex/ gives load error for me. How did you get v0.37 of luatex?

Opens fine here, I usually build from svn, though.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://tug.org/pipermail/luatex/attachments/20090331/36db4e30/attachment.bin 

From martin at oneiros.de  Tue Mar 31 17:19:00 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 31 Mar 2009 17:19:00 +0200
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <ba1882870903310800o4d43140dlc3a091ef08524884@mail.gmail.com>
References: <ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>
	<31332.1238511517@cl.cam.ac.uk>
	<ba1882870903310800o4d43140dlc3a091ef08524884@mail.gmail.com>
Message-ID: <68c491a60903310819o427ceee9i4395f2d2d8864fdc@mail.gmail.com>

2009/3/31, ??? ????? <vafakh9 at gmail.com>:
> but it is down for me. (snapshot attached)

The DNS of *foundry is spotty. IP is 193.48.224.170

Best
   Martin

From m.bana at ucl.ac.uk  Tue Mar 31 18:34:53 2009
From: m.bana at ucl.ac.uk (Mohamed Bana)
Date: Tue, 31 Mar 2009 17:34:53 +0100
Subject: [luatex] LuaJIT?
Message-ID: <49D2462D.7060202@ucl.ac.uk>

Hi guys,

has anyone luatex working with luajit?  so far i've only managed to get 
to compile a 32bit version under ubuntu 64 bit - /luajit hasn't been 
ported to a 64 bit yet/.

Currently the interpreter works.

here's the difference in speed between standard lua and the jit 
version;  
http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=all&box=1, 
and generally; http://shootout.alioth.debian.org/.

In summary; I'd just like to know how much roughly how much effort is 
required and If anyone has looked into it.


Mohamed

From pragma at wxs.nl  Tue Mar 31 19:00:15 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 31 Mar 2009 19:00:15 +0200
Subject: [luatex] [Dev-luatex] LuaJIT?
In-Reply-To: <49D2462D.7060202@ucl.ac.uk>
References: <49D2462D.7060202@ucl.ac.uk>
Message-ID: <49D24C1F.3020209@wxs.nl>

Mohamed Bana wrote:
> Hi guys,
> 
> has anyone luatex working with luajit?  so far i've only managed to get 
> to compile a 32bit version under ubuntu 64 bit - /luajit hasn't been 
> ported to a 64 bit yet/.
> 
> Currently the interpreter works.
> 
> here's the difference in speed between standard lua and the jit 
> version;  
> http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=all&box=1, 
> and generally; http://shootout.alioth.debian.org/.
> 
> In summary; I'd just like to know how much roughly how much effort is 
> required and If anyone has looked into it.

i played with it when we started with luatex (luajit < 2)

my concusion at that time was that it does not really speeds up luatex 
unless you use it for number crunching; at the moment i played with it i 
had to tweak the jit (runtime) parameters )

of course luajit is impressive but i'm not sure if it pays off for the 
kind if tasks luatex does - node list processing to mention one - unless 
for instance it turns user data function calls into inline code

also code that only is used once in a run does not profit much

talking of speed, a rather sensitive area is garbage collection; tuning 
the parameters turned out not to help speed up luatex

yet another factor is the binary itself ... for instance, where luatex 
0.36 takes 52 sec for our test document, version 0.37 takes 44 seconds 
(on my machine)

of course i might be wrong

Hans

ps. at that time we decided not to spend too much time on it as it is 
only available for some architectures and it adds complexity so it went 
on the > 1.0 agenda


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From vafakh9 at gmail.com  Tue Mar 31 19:14:35 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Wed, 1 Apr 2009 04:14:35 +1100
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <68c491a60903310819o427ceee9i4395f2d2d8864fdc@mail.gmail.com>
References: <ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>
	<31332.1238511517@cl.cam.ac.uk>
	<ba1882870903310800o4d43140dlc3a091ef08524884@mail.gmail.com>
	<68c491a60903310819o427ceee9i4395f2d2d8864fdc@mail.gmail.com>
Message-ID: <ba1882870903311014p5d1677bcra3035306cad61149@mail.gmail.com>

Thanks. Done

But when I copy the binary to /usr/local/texlive/2008/bin/i386-linux and do
"fmtutil --all" in the terminal, it fails and says "luatex: error while
loading shared libraries: libstdc++.so.5: cannot open shared object file: No
such file or directory".

Do you know what should I do?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090401/541ea4d5/attachment.html 

From khaledhosny at eglug.org  Tue Mar 31 20:27:03 2009
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 31 Mar 2009 20:27:03 +0200
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <ba1882870903311014p5d1677bcra3035306cad61149@mail.gmail.com>
References: <ba1882870903310753y52003142qca6e6c2b61ac4f33@mail.gmail.com>
	<31332.1238511517@cl.cam.ac.uk>
	<ba1882870903310800o4d43140dlc3a091ef08524884@mail.gmail.com>
	<68c491a60903310819o427ceee9i4395f2d2d8864fdc@mail.gmail.com>
	<ba1882870903311014p5d1677bcra3035306cad61149@mail.gmail.com>
Message-ID: <a5a1faa10903311127h3c096868ge18a1a34e1e94658@mail.gmail.com>

On 3/31/09, ??? ????? <vafakh9 at gmail.com> wrote:
> Thanks. Done
>
> But when I copy the binary to
> /usr/local/texlive/2008/bin/i386-linux and do "fmtutil
> --all" in the terminal, it fails and says "luatex: error while loading
> shared libraries: libstdc++.so.5: cannot open shared object file: No such
> file or directory".
>
> Do you know what should I do?
>
>

You need libsctdc++5 package.

Regards,
 Khaled


-- 
  Khaled

From luigi.scarso at gmail.com  Tue Mar 31 22:09:01 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 31 Mar 2009 22:09:01 +0200
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <49D22624.2020302@elvenkind.com>
References: <49D22624.2020302@elvenkind.com>
Message-ID: <fe8d59da0903311309t30be489fi3d5cba105e00a8a1@mail.gmail.com>

I'm not able to compile
this release, nor trunk 2195 .

make[5]: Entering directory `/opt/luatex/svn/trunk/build/texk/web2c'
date >stamp-tangle
srcdir=../../../source/texk/web2c /bin/sh
../../../source/texk/web2c/web2c/convert tangleboot
gcc -DHAVE_CONFIG_H -I. -I../../../source/texk/web2c -I./..
-I/opt/luatex/svn/trunk/build/texk -I/opt/luatex/svn/trunk/source/texk    -g
-O2 -MT tangleboot.o -MD -MP -MF .deps/tangleboot.Tpo -c -o tangleboot.o
tangleboot.c
mv -f .deps/tangleboot.Tpo .deps/tangleboot.Po
/bin/sh ./libtool --tag=CC   --mode=link gcc  -g -O2   -o tangleboot
tangleboot.o lib/lib.a /opt/luatex/svn/trunk/build/texk/kpathsea/
libkpathsea.la -lm
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: compile_command+=: not found
eval: 1: finalize_command+=: not found
eval: 1: libtool_args+=: not found
eval: 1: libtool_args+=: not found
eval: 1: libtool_args+=: not found
libtool: link: gcc  lib/lib.a
/opt/luatex/svn/trunk/build/texk/kpathsea/.libs/libkpathsea.a -lm
lib/lib.a(main.o): In function `main':
/opt/luatex/svn/trunk/build/texk/web2c/lib/../../../../source/texk/web2c/lib/main.c:25:
undefined reference to `mainbody'
collect2: ld returned 1 exit status
make[5]: *** [tangleboot] Error 1
make[5]: Leaving directory `/opt/luatex/svn/trunk/build/texk/web2c'
make[4]: *** [all-recursive] Error 1
make[4]: Leaving directory `/opt/luatex/svn/trunk/build/texk/web2c'
make[3]: *** [all] Error 2
make[3]: Leaving directory `/opt/luatex/svn/trunk/build/texk/web2c'
make[2]: *** [subtexk] Error 1
make[2]: Leaving directory `/opt/luatex/svn/trunk/build/texk'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/opt/luatex/svn/trunk/build/texk'
make: *** [all-recursive] Error 1
strip: 'build/texk/web2c/luatex': No such file
ls: impossibile accedere a build/texk/web2c/luatex: Nessun file o directory

Linux luigicasa-laptop 2.6.24-24-generic #1 SMP Wed Mar 25 12:16:54 UTC 2009
i686 GNU/Linux
# gcc -v
Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v
--enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
--enable-shared --with-system-zlib --libexecdir=/usr/lib
--without-included-gettext --enable-threads=posix --enable-nls
--with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
--enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --enable-mpfr
--enable-targets=all --enable-checking=release --build=i486-linux-gnu
--host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.2.4 (Ubuntu 4.2.4-1ubuntu4)

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090331/ab956a1c/attachment.html 

From martin at oneiros.de  Tue Mar 31 22:35:41 2009
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 31 Mar 2009 22:35:41 +0200
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <fe8d59da0903311309t30be489fi3d5cba105e00a8a1@mail.gmail.com>
References: <49D22624.2020302@elvenkind.com>
	<fe8d59da0903311309t30be489fi3d5cba105e00a8a1@mail.gmail.com>
Message-ID: <68c491a60903311335j1e233df8k8927b885f2c8013a@mail.gmail.com>

2009/3/31, luigi scarso <luigi.scarso at gmail.com>:
> I'm not able to compile
> this release, nor trunk 2195 .
>
> make[5]: Entering directory
> `/opt/luatex/svn/trunk/build/texk/web2c'
> date >stamp-tangle
> srcdir=../../../source/texk/web2c /bin/sh
> ../../../source/texk/web2c/web2c/convert tangleboot
>  gcc -DHAVE_CONFIG_H -I. -I../../../source/texk/web2c -I./..
> -I/opt/luatex/svn/trunk/build/texk
> -I/opt/luatex/svn/trunk/source/texk    -g -O2 -MT
> tangleboot.o -MD -MP -MF .deps/tangleboot.Tpo -c -o tangleboot.o
> tangleboot.c
>  mv -f .deps/tangleboot.Tpo .deps/tangleboot.Po
> /bin/sh ./libtool --tag=CC   --mode=link gcc  -g -O2   -o tangleboot
> tangleboot.o lib/lib.a
> /opt/luatex/svn/trunk/build/texk/kpathsea/libkpathsea.la
> -lm
>  eval: 1: libtool_args+=: not found
> eval: 1: compile_command+=: not found
> eval: 1: finalize_command+=: not found
> eval: 1: libtool_args+=: not found
> eval: 1: compile_command+=: not found
> eval: 1: finalize_command+=: not found
>  eval: 1: libtool_args+=: not found
> eval: 1: compile_command+=: not found
> eval: 1: finalize_command+=: not found
> eval: 1: libtool_args+=: not found
> eval: 1: compile_command+=: not found
> eval: 1: finalize_command+=: not found
>  eval: 1: libtool_args+=: not found
> eval: 1: compile_command+=: not found
> eval: 1: finalize_command+=: not found
> eval: 1: libtool_args+=: not found
> eval: 1: libtool_args+=: not found
> eval: 1: libtool_args+=: not found
>  libtool: link: gcc  lib/lib.a
> /opt/luatex/svn/trunk/build/texk/kpathsea/.libs/libkpathsea.a
> -lm
> lib/lib.a(main.o): In function `main':
> /opt/luatex/svn/trunk/build/texk/web2c/lib/../../../../source/texk/web2c/lib/main.c:25:
> undefined reference to `mainbody'
>  collect2: ld returned 1 exit status
> make[5]: *** [tangleboot] Error 1
> make[5]: Leaving directory
> `/opt/luatex/svn/trunk/build/texk/web2c'
> make[4]: *** [all-recursive] Error 1
> make[4]: Leaving directory
> `/opt/luatex/svn/trunk/build/texk/web2c'
>  make[3]: *** [all] Error 2
> make[3]: Leaving directory
> `/opt/luatex/svn/trunk/build/texk/web2c'
> make[2]: *** [subtexk] Error 1
> make[2]: Leaving directory
> `/opt/luatex/svn/trunk/build/texk'
> make[1]: *** [all-recursive] Error 1
>  make[1]: Leaving directory
> `/opt/luatex/svn/trunk/build/texk'
> make: *** [all-recursive] Error 1
> strip: 'build/texk/web2c/luatex': No such file
> ls: impossibile accedere a build/texk/web2c/luatex: Nessun file o directory

Looks like some bashism creeped in. Can you somehow set the
buildprocess to use bash instead of /bin/sh ?

Best
   Martin

From luigi.scarso at gmail.com  Tue Mar 31 23:09:40 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 31 Mar 2009 23:09:40 +0200
Subject: [luatex] luatex beta 0.37.0
In-Reply-To: <68c491a60903311335j1e233df8k8927b885f2c8013a@mail.gmail.com>
References: <49D22624.2020302@elvenkind.com>
	<fe8d59da0903311309t30be489fi3d5cba105e00a8a1@mail.gmail.com>
	<68c491a60903311335j1e233df8k8927b885f2c8013a@mail.gmail.com>
Message-ID: <fe8d59da0903311409g7c88362fi54216e6c8b9e28dd@mail.gmail.com>

On Tue, Mar 31, 2009 at 10:35 PM, Martin Schr?der <martin at oneiros.de> wrote:

> 2009/3/31, luigi scarso <luigi.scarso at gmail.com>:
> > I'm not able to compile
> > this release, nor trunk 2195 .
> >
> > make[5]: Entering directory
> > `/opt/luatex/svn/trunk/build/texk/web2c'
> > date >stamp-tangle
> > srcdir=../../../source/texk/web2c /bin/sh
> > ../../../source/texk/web2c/web2c/convert tangleboot
> >  gcc -DHAVE_CONFIG_H -I. -I../../../source/texk/web2c -I./..
> > -I/opt/luatex/svn/trunk/build/texk
> > -I/opt/luatex/svn/trunk/source/texk    -g -O2 -MT
> > tangleboot.o -MD -MP -MF .deps/tangleboot.Tpo -c -o tangleboot.o
> > tangleboot.c
> >  mv -f .deps/tangleboot.Tpo .deps/tangleboot.Po
> > /bin/sh ./libtool --tag=CC   --mode=link gcc  -g -O2   -o tangleboot
> > tangleboot.o lib/lib.a
> > /opt/luatex/svn/trunk/build/texk/kpathsea/libkpathsea.la
> > -lm
> >  eval: 1: libtool_args+=: not found
> > eval: 1: compile_command+=: not found
> > eval: 1: finalize_command+=: not found
> > eval: 1: libtool_args+=: not found
> > eval: 1: compile_command+=: not found
> > eval: 1: finalize_command+=: not found
> >  eval: 1: libtool_args+=: not found
> > eval: 1: compile_command+=: not found
> > eval: 1: finalize_command+=: not found
> > eval: 1: libtool_args+=: not found
> > eval: 1: compile_command+=: not found
> > eval: 1: finalize_command+=: not found
> >  eval: 1: libtool_args+=: not found
> > eval: 1: compile_command+=: not found
> > eval: 1: finalize_command+=: not found
> > eval: 1: libtool_args+=: not found
> > eval: 1: libtool_args+=: not found
> > eval: 1: libtool_args+=: not found
> >  libtool: link: gcc  lib/lib.a
> > /opt/luatex/svn/trunk/build/texk/kpathsea/.libs/libkpathsea.a
> > -lm
> > lib/lib.a(main.o): In function `main':
> >
> /opt/luatex/svn/trunk/build/texk/web2c/lib/../../../../source/texk/web2c/lib/main.c:25:
> > undefined reference to `mainbody'
> >  collect2: ld returned 1 exit status
> > make[5]: *** [tangleboot] Error 1
> > make[5]: Leaving directory
> > `/opt/luatex/svn/trunk/build/texk/web2c'
> > make[4]: *** [all-recursive] Error 1
> > make[4]: Leaving directory
> > `/opt/luatex/svn/trunk/build/texk/web2c'
> >  make[3]: *** [all] Error 2
> > make[3]: Leaving directory
> > `/opt/luatex/svn/trunk/build/texk/web2c'
> > make[2]: *** [subtexk] Error 1
> > make[2]: Leaving directory
> > `/opt/luatex/svn/trunk/build/texk'
> > make[1]: *** [all-recursive] Error 1
> >  make[1]: Leaving directory
> > `/opt/luatex/svn/trunk/build/texk'
> > make: *** [all-recursive] Error 1
> > strip: 'build/texk/web2c/luatex': No such file
> > ls: impossibile accedere a build/texk/web2c/luatex: Nessun file o
> directory
>
> Looks like some bashism creeped in. Can you somehow set the
> buildprocess to use bash instead of /bin/sh ?
>
> Best
>    Martin
>

this works for me

# export CONFIG_SHELL=/bin/bash
# ./build.sh

thank you Martin

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090331/97e03acd/attachment.html 

