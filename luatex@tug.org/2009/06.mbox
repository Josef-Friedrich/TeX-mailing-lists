From vafa at users.berlios.de  Wed Jun  3 06:04:55 2009
From: vafa at users.berlios.de (Vafa Khalighi)
Date: Wed, 3 Jun 2009 14:04:55 +1000
Subject: [luatex] Fwd: ledmac, ledpar, ledarab --- new package maintainer
In-Reply-To: <4A25C9E4.6020809@earthlink.net>
References: <4A25C9E4.6020809@earthlink.net>
Message-ID: <7ac5ed450906022104w12cd73bs106171124b9da82c@mail.gmail.com>

---------- Forwarded message ----------
From: peter wilson <herries.press at earthlink.net>
Date: Wed, Jun 3, 2009 at 10:55 AM
Subject: ledmac, ledpar, ledarab --- new package maintainer
To: "CTAN admin (Robin Fairbairns)" <ctan at dante.de>
Cc: Vafa Khalighi <vafa at users.berlios.de>, "Wilson, Peter" <
herries.press at earthlink.net>


   Vafa Khalighi (vafa at users.berlios.de) has very kindly agreed to take over
the maintenance of the ledmac, ledpar, and ledarab packages for typesetting
critical editions.

Please announce this.

Thank you
Peter W.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20090603/19ffaf49/attachment.html>

From taco at elvenkind.com  Wed Jun  3 15:42:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 03 Jun 2009 15:42:13 +0200
Subject: [luatex] luatex beta 0.40.2
Message-ID: <4A267DB5.9090804@elvenkind.com>

Hi,

I have just uploaded luatex 0.40.2 to the foundry server,
and have committed the source code to texlive.

What's new:

* Fix for a compilation warning under Cygwin.

* A complicated bugfix by Hartmut for a rounding problem in the
  VF loading that resulted in 'character width mismatch in font
  XY.vf ignored' messages at large load sizes

* The embedded MPlib is now 1.202.

* The post_page_number callback was accidentally run when
  shipping out xforms as well as during actual pages.

* When a math accent char doesn't have a bot_accent placer,
  luatex now uses the top_accent placer, if present.

* A crash caused by \Uroot .. {<list>}{...} is fixed

* A portability fix for solaris 8 sparc using sun studio
  compiler, and one for glibc > 2.9.90

* luatex -ini now sets the \catcode of the BOM character to
  ignore (9)

* Kpathsea is updated from TeXLive, giving four extra types of
  searchable files: 'font feature files','cid maps','mlbib',
  and 'mlbst'.

* libpng is now 1.2.36


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.40.2

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco





From taco at elvenkind.com  Mon Jun  8 10:58:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 08 Jun 2009 10:58:13 +0200
Subject: [luatex] luatex beta 0.40.3
Message-ID: <4A2CD2A5.8030005@elvenkind.com>

Hi,

I have just uploaded luatex 0.40.3 to the foundry server,
and have committed the source code to texlive.

What's new:

* A set of portability fixes for the AIX compiler from Vladimir
  Volovich.

* A set of fixes to the synctex support.

* A patch to the build script to prevent installed X11 headers
  from being required.

* Some weave (web syntax) fixes from Manuel P?gouri?-Gonnard.

* A simplification in luatex.ch (it is now less verbose
  about the web2c-specific extensions) from Karl Berry.

* A fix in the handling of UTF-8 (input) file names.

* Hyphenation exceptions were case sensitive in 0.40.2.


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.40.3

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco





From taco at elvenkind.com  Tue Jun  9 15:58:02 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 09 Jun 2009 15:58:02 +0200
Subject: [luatex] luatex beta 0.40.4
Message-ID: <4A2E6A6A.2010304@elvenkind.com>

Hi,

I have just uploaded luatex 0.40.4 to the foundry server,
and have committed the source code to texlive.

What's new:

* \the\textfont0 returned a number instead of doing a font switch.

* The embedded MPlib is now 1.203.

The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.40.4

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco





From preining at logic.at  Tue Jun  9 16:26:57 2009
From: preining at logic.at (Norbert Preining)
Date: Tue, 9 Jun 2009 16:26:57 +0200
Subject: [luatex] [Dev-luatex] luatex beta 0.40.4
In-Reply-To: <4A2E6A6A.2010304@elvenkind.com>
References: <4A2E6A6A.2010304@elvenkind.com>
Message-ID: <20090609142657.GE31330@gamma.logic.tuwien.ac.at>

On Di, 09 Jun 2009, Taco Hoekwater wrote:
> I have just uploaded luatex 0.40.4 to the foundry server,
> and have committed the source code to texlive.

Debian packages uploaded to unstable, new binaries for all possible
archs will be available in a few days.

Best wishes

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
GODALMING (n.)
Wonderful rush of relief on discovering that the ely (q.v.) and the
wembley (q.v.) were in fact false alarms.
			--- Douglas Adams, The Meaning of Liff

From nomosnomos at gmail.com  Wed Jun 10 05:33:35 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Wed, 10 Jun 2009 12:33:35 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
Message-ID: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>

Hi,

I am using latest trunk version of luatex engine.
If I try to load a fontfile whose name is in utf8, say "????.ttf",
lualatex fails in loading the font. Here is a simple tex code just for testing:

\documentclass{minimal}
\DeclareFontShape{OT1}{cmr}{m}{n}{<->????}{}
\begin{document}
test.
\end{document}

Upon processing the code with lualatex, I get an error message
with unreadable borken characters:

! Font \OT1/cmr/m/n/10=???????????? at 10pt not loadable: metric data
not found or bad.

Correcnt error message should be

! Font \OT1/cmr/m/n/10=???? at 10pt not loadable: metric data not found or bad.

No problem with plaintex or context; Only latex fails.
Until several days ago, I have never encounterd a problem
with this utf8-named fontfile.  Maybe this could be related to
recently committed patch on utf8 filename.

Best regards,
Dohyun Kim

From taco at elvenkind.com  Wed Jun 10 09:04:06 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 09:04:06 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
Message-ID: <4A2F5AE6.6010000@elvenkind.com>

Dohyun Kim wrote:
> Hi,
> 
> I am using latest trunk version of luatex engine.
> If I try to load a fontfile whose name is in utf8, say "????.ttf",
> lualatex fails in loading the font. Here is a simple tex code just for testing:
> 
> \documentclass{minimal}
> \DeclareFontShape{OT1}{cmr}{m}{n}{<->????}{}
> \begin{document}
> test.
> \end{document}
> 
> Upon processing the code with lualatex, I get an error message
> with unreadable borken characters:

How can I create this lualatex format, for testing?

> ! Font \OT1/cmr/m/n/10=???????? ??? at 10pt not loadable: metric data
> not found or bad.
> 
> Correcnt error message should be
> 
> ! Font \OT1/cmr/m/n/10=???? at 10pt not loadable: metric data not found or bad.
> 
> No problem with plaintex or context; Only latex fails.
> Until several days ago, I have never encounterd a problem
> with this utf8-named fontfile.  Maybe this could be related to
> recently committed patch on utf8 filename.
> 
> Best regards,
> Dohyun Kim


From taco at elvenkind.com  Wed Jun 10 09:45:41 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 09:45:41 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2F5AE6.6010000@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com>
Message-ID: <4A2F64A5.3070405@elvenkind.com>


Hi Dohyun Kim,

Taco Hoekwater wrote:
> 
> How can I create this lualatex format, for testing?

I just did a small test with plain luatex (luatex \&plain,
to be exact), and it has no problem with loading either
????.tex or ????.tfm (a rename of cmr10.tfm),
nor does it report gibberish if either of these cannot
be found, so it looks like this is a latex-specific thing.

Perhaps it is re-encoding the file names internally somehow?

Best wishes,
Taco






From luatex at nililand.de  Wed Jun 10 10:06:18 2009
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 10 Jun 2009 10:06:18 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
Message-ID: <78znc9cch4e4$.dlg@nililand.de>

Am Wed, 10 Jun 2009 09:45:41 +0200 schrieb Taco Hoekwater:

> Hi Dohyun Kim,
> 
> Taco Hoekwater wrote:
>> 
>> How can I create this lualatex format, for testing?
> 
> I just did a small test with plain luatex (luatex \&plain,
> to be exact), and it has no problem with loading either
> ????.tex or ????.tfm (a rename of cmr10.tfm),
> nor does it report gibberish if either of these cannot
> be found, so it looks like this is a latex-specific thing.
> 
> Perhaps it is re-encoding the file names internally somehow?

My first guess would be \nfss at catcodes which reset a lot of catcodes
before reading the font name: 

\def\DeclareFontShape{\begingroup
   \nfss at catcodes
   \expandafter\endgroup
   \DeclareFontShape@}

It is defined as 

\def\nfss at catcodes{%
     \makeatletter
     \catcode`\ 9%
     \catcode`\^^I9%
     \catcode`\^^M9%
     \catcode`\\\z@
     \catcode`\{\@ne
     \catcode`\}\tw@
     \catcode`\#6%
     \catcode`\^7%
     \catcode`\%14%
   \@makeother\<%
   \@makeother\>%
   \@makeother\*%
   \@makeother\.%
   \@makeother\-%
   \@makeother\/%
   \@makeother\[%
   \@makeother\]%
   \@makeother\`%
   \@makeother\'%
   \@makeother\"%
}

But as I have neither an utf8-font, nor the newest luatex currently
I can't try. 

-- 
Ulrike Fischer 


From nomosnomos at gmail.com  Wed Jun 10 10:18:31 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Wed, 10 Jun 2009 17:18:31 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2F64A5.3070405@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
Message-ID: <bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>

2009/6/10 Taco Hoekwater <taco at elvenkind.com>:
>
> Hi Dohyun Kim,
>
> Taco Hoekwater wrote:
>>
>> How can I create this lualatex format, for testing?
>
> I just did a small test with plain luatex (luatex \&plain,
> to be exact), and it has no problem with loading either
> ????.tex or ????.tfm (a rename of cmr10.tfm),
> nor does it report gibberish if either of these cannot
> be found, so it looks like this is a latex-specific thing.
>
> Perhaps it is re-encoding the file names internally somehow?

No, latex does not re-encode the file name.
It just make it cs-named: something like \csname ????\endcsname,
after which the file name becomes weird characters.
Each of utf8 octets now becomes unicode two byte character.
0xea 0xb0 0x80 => U+00EA U+00B0 U+0080.

Anyway, making lualatex format is simple.

=== luatexiniconfig.tex ===
\begingroup
\catcode`\{=1
\catcode`\}=2
\expandafter\ifx\csname luatexversion\endcsname\relax
  \let\luatexversion\undefined
  \directlua{tex.enableprimitives('', tex.extraprimitives())}
\fi
\endgroup
==================

=== lualatex.ini ===
\input luatexiniconfig.tex
\input pdftexconfig
\pdfoutput=0  % dvi output by default
\scrollmode
\input latex.ltx
\endinput
===============

then, run the command "luatex -ini lualatex.ini".

From taco at elvenkind.com  Wed Jun 10 10:29:25 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 10:29:25 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>	<4A2F5AE6.6010000@elvenkind.com>
	<4A2F64A5.3070405@elvenkind.com>
	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
Message-ID: <4A2F6EE5.6000207@elvenkind.com>



Dohyun Kim wrote:
> 
> then, run the command "luatex -ini lualatex.ini".

Ok, that is running (and failing) now. I will investigate
further.

Best wishes,
Taco

From taco at elvenkind.com  Wed Jun 10 12:19:32 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 12:19:32 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2F6EE5.6000207@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>	<4A2F5AE6.6010000@elvenkind.com>	<4A2F64A5.3070405@elvenkind.com>	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
	<4A2F6EE5.6000207@elvenkind.com>
Message-ID: <4A2F88B4.80908@elvenkind.com>


Hi Dohyun Kim,

Taco Hoekwater wrote:
> 
> Dohyun Kim wrote:
>> then, run the command "luatex -ini lualatex.ini".
> 
> Ok, that is running (and failing) now. I will investigate
> further.

There was a fairly serious bug in the printing of csnames
(it encoded the input string again) and that is causing the
current problem. It was working before exactly because the
utf-8 (file)names were incorrectly un-encoded so the two
bugs cancelled themselves out.

I believe the current luatex trunk (and branch/0.40.x) are
now ok, but I would appreciate it if you would do some
more tests with utf-8 files before I release luatex 0.40.5

Best wishes,
Taco



From nomosnomos at gmail.com  Wed Jun 10 13:03:27 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Wed, 10 Jun 2009 20:03:27 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2F88B4.80908@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
	<4A2F6EE5.6000207@elvenkind.com> <4A2F88B4.80908@elvenkind.com>
Message-ID: <bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>

2009? 6? 10? (?) ?? 7:19? Taco Hoekwater<taco at elvenkind.com>?? ??:
>
> There was a fairly serious bug in the printing of csnames
> (it encoded the input string again) and that is causing the
> current problem. It was working before exactly because the
> utf-8 (file)names were incorrectly un-encoded so the two
> bugs cancelled themselves out.
>
> I believe the current luatex trunk (and branch/0.40.x) are
> now ok, but I would appreciate it if you would do some
> more tests with utf-8 files before I release luatex 0.40.5
>

Thank you so much. It works fine now.
Processing tex file in utf8 filename works ok as well.

By the way, before releasing 0.40.5,
would you please fix the bug related to alignment?

% hans hagen's luatex-plain shipped with context beta
\directlua{dofile(kpse.find_file('luatex-fonts.lua'))}
% aligmment
\halign{\indent#1\hfil&\quad#\hfil\cr
Horizontal lists&Chapter 14\cr
Vertical lists&Chapter 15\cr
Math lists&Chapter 17\cr}
\bye

Plain tex fails with segmentation fault; context fails as well.

Best Regards,
Dohyun Kim

From taco at elvenkind.com  Wed Jun 10 13:47:07 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 13:47:07 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>	<4A2F5AE6.6010000@elvenkind.com>
	<4A2F64A5.3070405@elvenkind.com>	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>	<4A2F6EE5.6000207@elvenkind.com>
	<4A2F88B4.80908@elvenkind.com>
	<bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>
Message-ID: <4A2F9D3B.80508@elvenkind.com>



Dohyun Kim wrote:
> 
> By the way, before releasing 0.40.5,
> would you please fix the bug related to alignment?

Trunk (#2470) nor 0.40.4 crash here., so you will
have to post some more information and/or a log file
(plain tex is best for me).

Best wishes,
Taco

From nomosnomos at gmail.com  Wed Jun 10 14:35:33 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Wed, 10 Jun 2009 21:35:33 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2F9D3B.80508@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
	<4A2F6EE5.6000207@elvenkind.com> <4A2F88B4.80908@elvenkind.com>
	<bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>
	<4A2F9D3B.80508@elvenkind.com>
Message-ID: <bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>

2009? 6? 10? (?) ?? 8:47? Taco Hoekwater<taco at elvenkind.com>?? ??:
>
>
> Dohyun Kim wrote:
>>
>> By the way, before releasing 0.40.5,
>> would you please fix the bug related to alignment?
>
> Trunk (#2470) nor 0.40.4 crash here., so you will
> have to post some more information and/or a log file
> (plain tex is best for me).

$ luatex alignment
This is LuaTeX, Version beta-0.41.0-2009061020 (Web2C 2009)
(alignment.tex <luatex-fonts-merged.lua> <luatex-fonts.lua loaded in 0.024 seco
?????? ??

the last line in Korean language means "Segmentation fault".
and log file is empty.

Without the alignment code, tex file compiles ok.

Maybe, this problem could be platform dependent.
I am on my linux box, debian testing (aka. squeeze) and
hardware is apple macbook i386 core2 cpu.

$ uname -a
Linux debian 2.6.29.4.nomos #1 SMP Thu May 21 18:17:53 KST 2009 i686 GNU/Linux

I am afraid it would be quite difficult to find the cause the problem.

Best,
Dohyun Kim

From nomosnomos at gmail.com  Wed Jun 10 14:46:38 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Wed, 10 Jun 2009 21:46:38 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
	<4A2F6EE5.6000207@elvenkind.com> <4A2F88B4.80908@elvenkind.com>
	<bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>
	<4A2F9D3B.80508@elvenkind.com>
	<bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>
Message-ID: <bfeb3bf10906100546y27232effs68e27e480f948a1f@mail.gmail.com>

2009? 6? 10? (?) ?? 9:35? Dohyun Kim<nomosnomos at gmail.com>?? ??:
> 2009? 6? 10? (?) ?? 8:47? Taco Hoekwater<taco at elvenkind.com>?? ??:
>>
>>
>> Dohyun Kim wrote:
>>>
>>> By the way, before releasing 0.40.5,
>>> would you please fix the bug related to alignment?
>>
>> Trunk (#2470) nor 0.40.4 crash here., so you will
>> have to post some more information and/or a log file
>> (plain tex is best for me).
>

I have just downloaded luatex binary 0.40.4 from supelec
instead of compiling myself, and then the problem has gone.
tex code with alignment compiles ok now.

The problem must be in the compilation process of luatex
on my system.  So forget it and please release new beta.

Best,
Dohyun Kim

From taco at elvenkind.com  Wed Jun 10 14:47:27 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 14:47:27 +0200
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>	<4A2F5AE6.6010000@elvenkind.com>
	<4A2F64A5.3070405@elvenkind.com>	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>	<4A2F6EE5.6000207@elvenkind.com>
	<4A2F88B4.80908@elvenkind.com>	<bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>	<4A2F9D3B.80508@elvenkind.com>
	<bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>
Message-ID: <4A2FAB5F.6030908@elvenkind.com>



Dohyun Kim wrote:
> 2009? 6? 10? (?) ?? 8:47? Taco Hoekwater<taco at elvenkind.com>?? ??:
>>
>> Dohyun Kim wrote:
>>> By the way, before releasing 0.40.5,
>>> would you please fix the bug related to alignment?
>> Trunk (#2470) nor 0.40.4 crash here., so you will
>> have to post some more information and/or a log file
>> (plain tex is best for me).
> 
> $ luatex alignment
> This is LuaTeX, Version beta-0.41.0-2009061020 (Web2C 2009)
> (alignment.tex <luatex-fonts-merged.lua> <luatex-fonts.lua loaded in 0.024 seco
> ?????? ??
> 
> the last line in Korean language means "Segmentation fault".
> and log file is empty.
> 
> Without the alignment code, tex file compiles ok.
> 
> Maybe, this problem could be platform dependent.
> I am on my linux box, debian testing (aka. squeeze) and
> hardware is apple macbook i386 core2 cpu.
> 
> $ uname -a
> Linux debian 2.6.29.4.nomos #1 SMP Thu May 21 18:17:53 KST 2009 i686 GNU/Linux
> 
> I am afraid it would be quite difficult to find the cause the problem.

Have you tried regenerating the format file ? For trunk, that often
matters, because the version number detection does not always work
properly.

Other than that, the only advise I can give is to run a debugging
build of luatex via the C debugger to check where it crashes.
(For that, you need to build a binary with ./build.sh --nostrip )


Best wishes,
Taco




From taco at elvenkind.com  Wed Jun 10 16:05:28 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 10 Jun 2009 16:05:28 +0200
Subject: [luatex] luatex beta 0.40.5
Message-ID: <4A2FBDA8.2010208@elvenkind.com>

Hi,

I have just uploaded luatex 0.40.5 to the foundry server,
and have committed the source code to texlive.

What's new:

* One of the internal print functions accidentally encoded its
  argument string to UTF-8 even though it was already UTF-8.

* Some of the log and terminal UTF-8 output was gibberish.

The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.40.5

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco


From nomosnomos at gmail.com  Wed Jun 10 18:50:04 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Thu, 11 Jun 2009 01:50:04 +0900
Subject: [luatex] lualatex fails with fontfile named in utf8
In-Reply-To: <4A2FAB5F.6030908@elvenkind.com>
References: <bfeb3bf10906092033g7533c71du8e67a4d07c891142@mail.gmail.com>
	<4A2F5AE6.6010000@elvenkind.com> <4A2F64A5.3070405@elvenkind.com>
	<bfeb3bf10906100118y4791f42ch506d805f3a92e4a9@mail.gmail.com>
	<4A2F6EE5.6000207@elvenkind.com> <4A2F88B4.80908@elvenkind.com>
	<bfeb3bf10906100403gd43ef90v4801fda110756a49@mail.gmail.com>
	<4A2F9D3B.80508@elvenkind.com>
	<bfeb3bf10906100535o44cc9af9x46b8fa88115e868d@mail.gmail.com>
	<4A2FAB5F.6030908@elvenkind.com>
Message-ID: <bfeb3bf10906100950q19d8e448sea09bc4f82fdca96@mail.gmail.com>

2009? 6? 10? (?) ?? 9:47? Taco Hoekwater<taco at elvenkind.com>?? ??:
>
> Other than that, the only advise I can give is to run a debugging
> build of luatex via the C debugger to check where it crashes.
> (For that, you need to build a binary with ./build.sh --nostrip )
>

just for your information:

$ valgrind --tool=memcheck --leak-check=full luatex alignment
==26800== Memcheck, a memory error detector.
==26800== Copyright (C) 2002-2008, and GNU GPL'd, by Julian Seward et al.
==26800== Using LibVEX rev 1884, a library for dynamic binary translation.
==26800== Copyright (C) 2004-2008, and GNU GPL'd, by OpenWorks LLP.
==26800== Using valgrind-3.4.1-Debian, a dynamic binary
instrumentation framework.
==26800== Copyright (C) 2000-2008, and GNU GPL'd, by Julian Seward et al.
==26800== For more details, rerun with: -v
==26800==
This is LuaTeX, Version beta-0.41.0-2009061101 (Web2C 2009)
(alignment.tex <luatex-fonts-merged.lua> <luatex-fonts.lua loaded in 1.059 seco
==26800== Invalid read of size 1
==26800==    at 0x4026728: strlen (mc_replace_strmem.c:242)
==26800==    by 0x81F26AD: lua_pushstring (lapi.c:453)
==26800==    by 0x80DAF22: lua_hpack_filter (luanode.c:177)
==26800==    by 0x8066712: zfiltered_hpack (luatex0.c:27676)
==26800==    by 0x80E5C7D: fin_row (align.c:684)
==26800==    by 0x8094E3C: main_control (luatex0.c:36892)
==26800==    by 0x8058402: main_body (luatexini.c:2710)
==26800==    by 0x8099616: main (luatexextra.c:791)
==26800==  Address 0x7361754c is not stack'd, malloc'd or (recently) free'd
==26800==
==26800== Process terminating with default action of signal 11 (SIGSEGV)
==26800==  Access not within mapped region at address 0x7361754C
==26800==    at 0x4026728: strlen (mc_replace_strmem.c:242)
==26800==    by 0x81F26AD: lua_pushstring (lapi.c:453)
==26800==    by 0x80DAF22: lua_hpack_filter (luanode.c:177)
==26800==    by 0x8066712: zfiltered_hpack (luatex0.c:27676)
==26800==    by 0x80E5C7D: fin_row (align.c:684)
==26800==    by 0x8094E3C: main_control (luatex0.c:36892)
==26800==    by 0x8058402: main_body (luatexini.c:2710)
==26800==    by 0x8099616: main (luatexextra.c:791)
==26800==  If you believe this happened as a result of a stack overflow in your
==26800==  program's main thread (unlikely but possible), you can try
to increase
==26800==  the size of the main thread stack using the --main-stacksize= flag.
==26800==  The main thread stack size used in this run was 8388608.
nds>==26800==
==26800== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 13 from 1)
==26800== malloc/free: in use at exit: 28,025,669 bytes in 251,924 blocks.
==26800== malloc/free: 471,206 allocs, 219,282 frees, 53,171,393 bytes
allocated.
==26800== For counts of detected errors, rerun with: -v
==26800== searching for pointers to 251,924 not-freed blocks.
==26800== checked 28,963,736 bytes.
==26800==
==26800==
==26800== 24 bytes in 1 blocks are definitely lost in loss record 3 of 21
==26800==    at 0x402613C: realloc (vg_replace_malloc.c:429)
==26800==    by 0x82DD92C: xrealloc (xrealloc.c:31)
==26800==    by 0x82DB26C: str_list_concat (str-list.c:58)
==26800==    by 0x82D9558: search_list (pathsearch.c:498)
==26800==    by 0x82D6F18: kpathsea_init_db (db.c:360)
==26800==    by 0x82D6290: kpathsea_cnf_get (cnf.c:236)
==26800==    by 0x82DD117: kpathsea_var_value (variable.c:55)
==26800==    by 0x82DD1D9: kpse_var_value (variable.c:85)
==26800==    by 0x8098B83: init_shell_escape (luatexextra.c:190)
==26800==    by 0x80D9835: init_kpse (luainit.c:452)
==26800==    by 0x80DA204: lua_initialize (luainit.c:623)
==26800==    by 0x8099611: main (luatexextra.c:785)
==26800==
==26800==
==26800== 26 (16 direct, 10 indirect) bytes in 1 blocks are definitely
lost in loss record 4 of 21
==26800==    at 0x40240D2: calloc (vg_replace_malloc.c:397)
==26800==    by 0x813E6C1: gcalloc (memory.c:55)
==26800==    by 0x81BFAF3: SplineFontEmpty (splineutil2.c:1631)
==26800==    by 0x816C116: SFFillFromTTF (parsettf.c:6002)
==26800==    by 0x8170972: _SFReadTTF (parsettf.c:6250)
==26800==    by 0x8190716: _ReadSplineFont (splinefont.c:395)
==26800==    by 0x81910BF: ReadSplineFont (splinefont.c:494)
==26800==    by 0x813E1DC: ff_open (luafflib.c:168)
==26800==    by 0x81F9414: luaD_precall (ldo.c:319)
==26800==    by 0x820899F: luaV_execute (lvm.c:587)
==26800==    by 0x81F99B7: luaD_call (ldo.c:377)
==26800==    by 0x81F2430: f_call (lapi.c:795)
==26800==
==26800==
==26800== 352 bytes in 1 blocks are possibly lost in loss record 5 of 21
==26800==    at 0x402601E: malloc (vg_replace_malloc.c:207)
==26800==    by 0x402619F: realloc (vg_replace_malloc.c:429)
==26800==    by 0x80DC2DC: my_luaalloc (luastuff.c:78)
==26800==    by 0x82010CD: lua_newstate (lstate.c:147)
==26800==    by 0x80DBB9B: luainterpreter (luastuff.c:123)
==26800==    by 0x80D9D3D: lua_initialize (luainit.c:523)
==26800==    by 0x8099611: main (luatexextra.c:785)
==26800==
==26800==
==26800== 9,121 (6,657 direct, 2,464 indirect) bytes in 362 blocks are
definitely lost in loss record 9 of 21
==26800==    at 0x402601E: malloc (vg_replace_malloc.c:207)
==26800==    by 0x82DD65C: xmalloc (xmalloc.c:25)
==26800==    by 0x82DD98C: xstrdup (xstrdup.c:27)
==26800==    by 0x80D97B9: cleaned_invocation_name (luainit.c:419)
==26800==    by 0x80D9A9D: lua_initialize (luainit.c:489)
==26800==    by 0x8099611: main (luatexextra.c:785)
==26800==
==26800== LEAK SUMMARY:
==26800==    definitely lost: 6,697 bytes in 364 blocks.
==26800==    indirectly lost: 2,474 bytes in 122 blocks.
==26800==      possibly lost: 352 bytes in 1 blocks.
==26800==    still reachable: 28,016,146 bytes in 251,437 blocks.
==26800==         suppressed: 0 bytes in 0 blocks.
==26800== Reachable blocks (those to which a pointer was found) are not shown.
==26800== To see them, rerun with: --leak-check=full --show-reachable=yes
?????? ??

From yuleopen at gmail.com  Fri Jun 19 16:38:17 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Fri, 19 Jun 2009 22:38:17 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <49C8C887.4080903@wxs.nl>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
Message-ID: <68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>

On Tue, Mar 24, 2009 at 7:48 PM, Hans Hagen<pragma at wxs.nl> wrote:
> Yue Wang wrote:
>
>> If there are sufficient funding, write such binding is beneficial.
>
> depends ... 99% of dev in the tex world is not funded and still beneficial
>
> anyway, it's not on our agenda so such a lib + binding would end up in the
> add-ons activities later on; also, such a library should just expose ?data
> which then could be transformed to something else using lua, i.e. it makes
> no sense to let such a lib construct a fontforge like table
>
> actually, if the advantage is sought in faster loading keep in mind that
> it's the construction of the big tables that take runtime, and that will be
> true for all fontloaders (only faster processors and more mem can solve
> that; it's the price for flexibility and in the luatex project flexibility
> and opening up is more important than runtime; as such luatex will always be
> much slower than the other engines and fonts is just one aspect) (we have a
> few ideas for speedups but these might not show up before version 1.0)
>

Li Yanrui's profile results confirms my opinion:
during font loading, Lua uses very short time to build tables. most of
the time are used by fontforge (parsing fonts and calculating).
see http://yuleopen.googlepages.com/prof.txt

and it is difficult to optimize fontforge there are several, not just
one or two, functions takes very long time to execute.


> the standard built-in fontloader datastructures are quite specific and will
> stay close to what fontforge does if only because it makes developing fonts
> as well as debugging lua code easier (for instance same internal feature
> interfaces) while other fontlibs might have a completely different exposure
> of font characteristics
>
> Hans
>
>
> -----------------------------------------------------------------
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Hans Hagen | PRAGMA ADE
> ? ? ? ? ? ? ?Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ? ? tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? | www.pragma-pod.nl
> -----------------------------------------------------------------
>

From taco at elvenkind.com  Fri Jun 19 16:54:39 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 19 Jun 2009 16:54:39 +0200
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>
	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>
Message-ID: <4A3BA6AF.8020808@elvenkind.com>



Yue Wang wrote:
> 
> Li Yanrui's profile results confirms my opinion:
> during font loading, Lua uses very short time to build tables. most of
> the time are used by fontforge (parsing fonts and calculating).
> see http://yuleopen.googlepages.com/prof.txt

> and it is difficult to optimize fontforge there are several, not just
> one or two, functions takes very long time to execute.

It is more straightforward than you think: it is spending most of its
time on work that is needed to calculate glyph boundingboxes correctly.

I can add code to support a switch to do a "simplified boundingbox"
discovery only, and that would drop the font loading time considerably.
But font loading is normally a one-time process of which the results
are cached, so this does not have a high priority.

Best wishes,
Taco


From yuleopen at gmail.com  Fri Jun 19 17:15:44 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Fri, 19 Jun 2009 23:15:44 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <4A3BA6AF.8020808@elvenkind.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>
	<4A3BA6AF.8020808@elvenkind.com>
Message-ID: <68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>

Hi, Taco:

On Fri, Jun 19, 2009 at 10:54 PM, Taco Hoekwater<taco at elvenkind.com> wrote:
>
>
> Yue Wang wrote:
>>
>> Li Yanrui's profile results confirms my opinion:
>> during font loading, Lua uses very short time to build tables. most of
>> the time are used by fontforge (parsing fonts and calculating).
>> see http://yuleopen.googlepages.com/prof.txt
>
>> and it is difficult to optimize fontforge there are several, not just
>> one or two, functions takes very long time to execute.
>
> It is more straightforward than you think: it is spending most of its
> time on work that is needed to calculate glyph boundingboxes correctly.
>
> I can add code to support a switch to do a "simplified boundingbox"
> discovery only, and that would drop the font loading time considerably.

well, that's great! in fact "simplified boundingbox" == "control box"
used in freetype2.
If you can do that, please help to solve this problem. Thanks.

> But font loading is normally a one-time process of which the results
> are cached, so this does not have a high priority.

True for ConTeXt. but a great pain for Chinese TeX Society to develop
a TeX/LaTeX support package --- We should wait before the computer,
with a cup of tea, watching the screen closely for minutes to see the
actual coding result. And each compilation takes the package user a
long time.

>
> Best wishes,
> Taco
>


Yue Wang

>

From taco at elvenkind.com  Fri Jun 19 19:16:10 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 19 Jun 2009 19:16:10 +0200
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>	<4A3BA6AF.8020808@elvenkind.com>
	<68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>
Message-ID: <4A3BC7DA.9000804@elvenkind.com>

Hi,

Yue Wang wrote:
> 
> True for ConTeXt. but a great pain for Chinese TeX Society to develop
> a TeX/LaTeX support package --- We should wait before the computer,
> with a cup of tea, watching the screen closely for minutes to see the
> actual coding result. And each compilation takes the package user a
> long time.

After on by your work drew so much of my attention to the font loading
parts of luatex, I decided to do some profiling of my own as I had a
lost half hour before dinner anyway. Not with gprof but with callgrind
this time, and that was a big help!

You probably (certainly!) want to check out the commit I just did
(#2537), as it speeds up TrueType font loading for (especially) large
fonts, and without *any* need for user-side configuration options.

There is a small price to pay for the (sometimes massive) speedup,
but it is really, really minor and I trust people can easily live
with the following two restrictions:

* The truetype boundingbox data in the font is assumed to be accurate
* No check is made for the uniqueness of the names of the glyphs


I have not looked at OTF loading yet, maybe tomorrow.

Best wishes,
Taco



From yuleopen at gmail.com  Sat Jun 20 02:36:28 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Sat, 20 Jun 2009 08:36:28 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <4A3BC7DA.9000804@elvenkind.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>
	<4A3BA6AF.8020808@elvenkind.com>
	<68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>
	<4A3BC7DA.9000804@elvenkind.com>
Message-ID: <68bfdc900906191736r838f366vf3239924f54b346c@mail.gmail.com>

Hi, Taco

On Sat, Jun 20, 2009 at 1:16 AM, Taco Hoekwater<taco at elvenkind.com> wrote:
> Hi,
>
> Yue Wang wrote:
>>
>> True for ConTeXt. but a great pain for Chinese TeX Society to develop
>> a TeX/LaTeX support package --- We should wait before the computer,
>> with a cup of tea, watching the screen closely for minutes to see the
>> actual coding result. And each compilation takes the package user a
>> long time.
>
> After on by your work drew so much of my attention to the font loading
> parts of luatex, I decided to do some profiling of my own as I had a
> lost half hour before dinner anyway. Not with gprof but with callgrind
> this time, and that was a big help!
>
> You probably (certainly!) want to check out the commit I just did
> (#2537), as it speeds up TrueType font loading for (especially) large
> fonts, and without *any* need for user-side configuration options.
>
> There is a small price to pay for the (sometimes massive) speedup,
> but it is really, really minor and I trust people can easily live
> with the following two restrictions:
>
> * The truetype boundingbox data in the font is assumed to be accurate
> * No check is made for the uniqueness of the names of the glyphs
>

Yes, TTF loading is 7x faster!
Thanks a lot for the fix!

>
> I have not looked at OTF loading yet, maybe tomorrow.
>

I am looking forward to try otf loading~
Thank you very much.

> Best wishes,
> Taco
>
>
>

Yue Wang

From patrick at gundla.ch  Mon Jun 22 20:46:49 2009
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 22 Jun 2009 20:46:49 +0200
Subject: [luatex] Help with kpse_init=false needed
Message-ID: <m1k534hzs6.fsf@levana.de>

Hi all,

I am playing with luatex and I don't get texconfig.kpse_init=false to
work. The idea is to write my own file searching mechanism.

What I have tried (with plain tex format as the base):

$ luatex sample.tex
works ok

$ luatex --lua=ini.lua sample.tex
gives me:
------
~/tmp/example$ luatex --lua ini.lua sample.tex
This is LuaTeX, Version beta-0.41.0-2009062220 (Web2C 2009)

hello from find_format_file
/Users/patrick/tmp/example/luatex.fmt
hello from find_read_file, id_number is 0
../../../source/texk/kpathsea/variable.c:35: failed assertion `kpse->program_name'
/Users/patrick/tmp/example/sample.texAbort trap
------
when commenting out the  texconfig.kpse_init=false, 
$ luatex --lua=ini.lua sample.tex
works ok.


Can anybody tell me what I am doing wrong?

Patrick

-------------------------------------------------------


sample.tex: 
------
hello world
\bye
------

ini.lua:
------
texconfig.kpse_init=false
texconfig.formatname="luatex"
texconfig.jobname="sample"

basedir="/Users/patrick/tmp/example/"

callback.register('find_read_file',
  function(id_number,asked_name)
    texio.write_nl("hello from find_read_file, id_number is " .. tostring(id_number) )
    local file = basedir .. asked_name
    texio.write_nl(file)
    return file
  end
)

callback.register('find_write_file',
  function(id_number,asked_name)
    texio.write_nl("hello from find_write_file, id_number is " .. tostring(id_number) )
    local file = basedir .. asked_name
    texio.write_nl(file)
    return file
  end
)


callback.register('find_output_file',
  function(asked_name)
    texio.write_nl("hello from find_output_file")
    local file = basedir .. asked_name
    texio.write_nl(file)
    return file
  end
)

callback.register('find_format_file',
  function(asked_name)
    texio.write_nl("hello from find_format_file")
    local file = basedir .. "luatex.fmt"
    texio.write_nl(file)
    return file
  end
)

-- all other find_..._file callbacks are omitted here in the mail
------


From taco at elvenkind.com  Tue Jun 23 09:29:37 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 23 Jun 2009 09:29:37 +0200
Subject: [luatex] Help with kpse_init=false needed
In-Reply-To: <m1k534hzs6.fsf@levana.de>
References: <m1k534hzs6.fsf@levana.de>
Message-ID: <4A408461.7020002@elvenkind.com>



Patrick Gundlach wrote:
> Hi all,
> 
> I am playing with luatex and I don't get texconfig.kpse_init=false to
> work. The idea is to write my own file searching mechanism.
> 
> What I have tried (with plain tex format as the base):
> 
> $ luatex sample.tex
> works ok
> 
> $ luatex --lua=ini.lua sample.tex
> gives me:
> ------
> ~/tmp/example$ luatex --lua ini.lua sample.tex
> This is LuaTeX, Version beta-0.41.0-2009062220 (Web2C 2009)
> 
> hello from find_format_file
> /Users/patrick/tmp/example/luatex.fmt
> hello from find_read_file, id_number is 0
> ../../../source/texk/kpathsea/variable.c:35: failed assertion `kpse->program_name'
> /Users/patrick/tmp/example/sample.texAbort trap

> -- all other find_..._file callbacks are omitted here in the mail

It could be the DVI "output_comment" feature, but I won't know for
sure unless you send me the lua file to try it myself.

Best wishes,
Taco




From taco at elvenkind.com  Tue Jun 23 09:59:11 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 23 Jun 2009 09:59:11 +0200
Subject: [luatex] Help with kpse_init=false needed
In-Reply-To: <4A408461.7020002@elvenkind.com>
References: <m1k534hzs6.fsf@levana.de> <4A408461.7020002@elvenkind.com>
Message-ID: <4A408B4F.8050506@elvenkind.com>



Taco Hoekwater wrote:
>> -- all other find_..._file callbacks are omitted here in the mail
> 
> It could be the DVI "output_comment" feature, but I won't know for
> sure unless you send me the lua file to try it myself.

Partick sent me the files off list. The problem is not any variable,
but the openin paranoia check from kpathsea that sneaked back in.

This means that besides all the finders, you also need to add the
open callback for (at least) regular input files:


callback.register('open_read_file',
  function(asked_name)
     texio.write_nl("hello from open_read_file\n")
     local tab = { }
     tab.file = io.open(asked_name)
     tab.reader = function (t)
                     local f = t.file
                     return f:read('*l')
                  end
     return tab
  end
)

Best wishes,
Taco

From patrick at gundla.ch  Tue Jun 23 10:57:40 2009
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 23 Jun 2009 10:57:40 +0200
Subject: [luatex] Help with kpse_init=false needed
In-Reply-To: <4A408B4F.8050506@elvenkind.com> (Taco Hoekwater's message of
	"Tue\, 23 Jun 2009 09\:59\:11 +0200")
References: <m1k534hzs6.fsf@levana.de> <4A408461.7020002@elvenkind.com>
	<4A408B4F.8050506@elvenkind.com>
Message-ID: <m1fxdriayj.fsf@levana.de>


> Taco Hoekwater wrote:

> This means that besides all the finders, you also need to add the
> open callback for (at least) regular input files:
>
>
> callback.register('open_read_file',
>   function(asked_name)
>      texio.write_nl("hello from open_read_file\n")
>      local tab = { }
>      tab.file = io.open(asked_name)
>      tab.reader = function (t)
>                      local f = t.file
>                      return f:read('*l')
>                   end
>      return tab
>   end
> )

Thanks, Taco! It seems that for pdf mode I have to write/register the
read_..._file callbacks as well. Is this on purpose? 

Patrick

From taco at elvenkind.com  Tue Jun 23 16:30:27 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 23 Jun 2009 16:30:27 +0200
Subject: [luatex] Help with kpse_init=false needed
In-Reply-To: <m1fxdriayj.fsf@levana.de>
References: <m1k534hzs6.fsf@levana.de>
	<4A408461.7020002@elvenkind.com>	<4A408B4F.8050506@elvenkind.com>
	<m1fxdriayj.fsf@levana.de>
Message-ID: <4A40E703.4030607@elvenkind.com>



Patrick Gundlach wrote:
> 
> Thanks, Taco! It seems that for pdf mode I have to write/register the
> read_..._file callbacks as well. Is this on purpose? 

Not really ... it probably crept in together with the support
for the new 'restricted' form of \write18. Please remind me in
a month or so (or create a tracker item).

Best wishes,
Taco

From yuleopen at gmail.com  Thu Jun 25 14:18:18 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Thu, 25 Jun 2009 20:18:18 +0800
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <4A3BC7DA.9000804@elvenkind.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>
	<20090324072804.GE26539@phare.normalesup.org>
	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>
	<49C8C887.4080903@wxs.nl>
	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>
	<4A3BA6AF.8020808@elvenkind.com>
	<68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>
	<4A3BC7DA.9000804@elvenkind.com>
Message-ID: <68bfdc900906250518xb3c8da8yb45646a2abf277b0@mail.gmail.com>

On Sat, Jun 20, 2009 at 1:16 AM, Taco Hoekwater<taco at elvenkind.com> wrote:
> Hi,
>
> Yue Wang wrote:
>>
>> True for ConTeXt. but a great pain for Chinese TeX Society to develop
>> a TeX/LaTeX support package --- We should wait before the computer,
>> with a cup of tea, watching the screen closely for minutes to see the
>> actual coding result. And each compilation takes the package user a
>> long time.
>
> After on by your work drew so much of my attention to the font loading
> parts of luatex, I decided to do some profiling of my own as I had a
> lost half hour before dinner anyway. Not with gprof but with callgrind
> this time, and that was a big help!
>
> You probably (certainly!) want to check out the commit I just did
> (#2537), as it speeds up TrueType font loading for (especially) large
> fonts, and without *any* need for user-side configuration options.
>
> There is a small price to pay for the (sometimes massive) speedup,
> but it is really, really minor and I trust people can easily live
> with the following two restrictions:
>
> * The truetype boundingbox data in the font is assumed to be accurate
> * No check is made for the uniqueness of the names of the glyphs
>
>
> I have not looked at OTF loading yet, maybe tomorrow.
>

Still waiting ....

> Best wishes,
> Taco
>
>
>

From taco at elvenkind.com  Thu Jun 25 14:27:00 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 25 Jun 2009 14:27:00 +0200
Subject: [luatex] Why obsolete the fontforge name space?
In-Reply-To: <68bfdc900906250518xb3c8da8yb45646a2abf277b0@mail.gmail.com>
References: <68bfdc900903232042q727cb52eib3fb79117591911e@mail.gmail.com>	<20090324072804.GE26539@phare.normalesup.org>	<68bfdc900903240127m5fb3309k92a895f51d75d633@mail.gmail.com>	<49C8C887.4080903@wxs.nl>	<68bfdc900906190738q714e67b7ja4e4b7d3dbbe7f0b@mail.gmail.com>	<4A3BA6AF.8020808@elvenkind.com>	<68bfdc900906190815h3928dc90l7f513aad96dbb949@mail.gmail.com>	<4A3BC7DA.9000804@elvenkind.com>
	<68bfdc900906250518xb3c8da8yb45646a2abf277b0@mail.gmail.com>
Message-ID: <4A436D14.30109@elvenkind.com>



Yue Wang wrote:
>> * The truetype boundingbox data in the font is assumed to be accurate
>> * No check is made for the uniqueness of the names of the glyphs
>>
>>
>> I have not looked at OTF loading yet, maybe tomorrow.
>>
> 
> Still waiting ....

Oh, I forgot to report back. I actually fixed it a little bit, the
fontforge.open() on AdobeMingStd-Light is now about half the time
of what it used to be. More can be done, I'll be sure to let you
know when I get around to it.

Best wishes,
Taco

From taco at elvenkind.com  Thu Jun 25 14:55:55 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 25 Jun 2009 14:55:55 +0200
Subject: [luatex] Luatex beta 0.40.6
Message-ID: <4A4373DB.1060004@elvenkind.com>

Hi,

I have just uploaded luatex 0.40.6 to the foundry server,
and have committed the source code to texlive.

What's new:

* Fix two string vs. toks bugs in the lua node interface:
  whatsit,annot and whatsit,startlink data assignments were
  made directly as strings instead of being converted to tokens.

* Sometimes pdf.print() could be used before the proper structures
  were initialized.

* There was a bug in the type codes for the lua package filter
  callback: wrong extra info was passed to lua for the alignment
  and vsplit cases.

* The math parameters \Umathlimitdownvgap, \Umathlimitdownbgap,
  and \Umathlimitdownkern have been renamed to \Umathlimitbelowbgap,
  \Umathlimitbelowvgap, and \Umathlimitbelowkern to be more
  consistent with the other parameter names.

* The embedded MPlib is now 1.204.

* Handling of UTF-8 hyphenation exceptions has been fixed.

* There were a number of typos in the manual.


The archives can be downloaded from supelec as usual:

        http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

  svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.40.6

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org


Have fun,
Taco


