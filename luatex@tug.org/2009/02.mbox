From yuleopen at gmail.com  Sun Feb  1 10:50:39 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Sun, 1 Feb 2009 09:50:39 +0000
Subject: [luatex] using (pdf)lualatex
Message-ID: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>

Hi, Karl:

Please visit http://cvs.ktug.or.kr/~nomos/
Some guys are using LuaLaTeX to produce Korean documents.

Yue Wang

From arthur.reutenauer at normalesup.org  Sun Feb  1 18:18:01 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 1 Feb 2009 18:18:01 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
Message-ID: <20090201171801.GA11997@phare.normalesup.org>

> Please visit http://cvs.ktug.or.kr/~nomos/

  Some TeX files there use a luatexko.sty package, and a quick search
points to
http://ftp.ktug.or.kr/KTUG/texlive/texmf-dist/tex/latex/kotex-dev/luatexko/
but you need to install quite a lot of fonts which are available at the
same location.

	Arthur

From nomosnomos at gmail.com  Mon Feb  2 08:07:26 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Mon, 2 Feb 2009 16:07:26 +0900
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <20090201171801.GA11997@phare.normalesup.org>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
Message-ID: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>

2009/2/2 Arthur Reutenauer <arthur.reutenauer at normalesup.org>:
>> Please visit http://cvs.ktug.or.kr/~nomos/
>
>  Some TeX files there use a luatexko.sty package, and a quick search
> points to
> http://ftp.ktug.or.kr/KTUG/texlive/texmf-dist/tex/latex/kotex-dev/luatexko/
> but you need to install quite a lot of fonts which are available at the
> same location.

I was very surprised to see here links to my humble site
and informal kotex (Korean TeX) repository, which was
prepared by KTUG for Korean users of texlive 2008.

Luatexko.sty and other related macros were developed
just for testing or evaluating the possibility of typesetting
Korean documents using luatex. The codes are messy and
there's no documentation except than somewhat terse
three-page guideline written in Korean. Sorry for that.

I think luatexko can typeset modern Korean document
quite well, if luatex binary is compiled from recent svn repository.
The binary from texlive distribution is not usable with latex
because of its many bugs, which were fixed after version 0.30.

Currently, however, luatexko cannot deal with opentype layout
features (especially, those of ccmp, ljmo, vjmo and tjmo),
which are essential for typesetting old Korean documents
being used until 100 years ago or so.  I am waiting for
a more general solution from latex (or plain tex) world
rather than implementing Korean-language-specific stuffs right now.

BTW, the only shortcoming of current luatex seems to be that
it consumes so much memory while loading CJK truetype fonts
whose size is normally much bigger than Latin fonts
(100 times bigger case is not infrequent), that it is almost
unusable under machines with small size of ram.

Anyway,  those who are interested can download and install
luatexko package for texlive 2008 by issuing command:

tlmgr --location=http://ftp.ktug.or.kr/KTUG/texlive/2008 install
kotex-dev kotex-base

Best,
Dohyun Kim

From preining at logic.at  Mon Feb  2 08:19:19 2009
From: preining at logic.at (Norbert Preining)
Date: Mon, 2 Feb 2009 08:19:19 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
Message-ID: <20090202071919.GF25032@gamma.logic.tuwien.ac.at>

Dear Kim,

On Mo, 02 Feb 2009, Dohyun Kim wrote:
> Anyway,  those who are interested can download and install
> luatexko package for texlive 2008 by issuing command:
> 
> tlmgr --location=http://ftp.ktug.or.kr/KTUG/texlive/2008 install kotex-dev kotex-base

Wow ... I didn't know that anyone else is actually using our
distribution format.

Did you read
	Master/tlpkg/doc/repository-setup.txt

Do you have any comments/suggestions/improvements wrt to setting up your
own repository?

Any feedback for us TL devs would be nice. Just send it to me or the
tex-live ML.

Thanks a lot and all the best

Norbert

-------------------------------------------------------------------------------
Dr. Norbert Preining <preining at logic.at>        Vienna University of Technology
Debian Developer <preining at debian.org>                         Debian TeX Group
gpg DSA: 0x09C5B094      fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
-------------------------------------------------------------------------------
SILESIA (n. medical)
The inability to remember, at the critical moment, which is the better
side of a boat to be seasick off.
			--- Douglas Adams, The Meaning of Liff

From yuleopen at gmail.com  Mon Feb  2 09:51:11 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 16:51:11 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
Message-ID: <68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>

Hi:


> I was very surprised to see here links to my humble site
> and informal kotex (Korean TeX) repository, which was
> prepared by KTUG for Korean users of texlive 2008.
>

Karl asked on the mailing list for some lualatex samples, and your CJK
sample is the only one that I can find and understand:)

> Luatexko.sty and other related macros were developed
> just for testing or evaluating the possibility of typesetting
> Korean documents using luatex. The codes are messy and
> there's no documentation except than somewhat terse
> three-page guideline written in Korean. Sorry for that.
>

Well, it's much better than no:)
In China we suggest users use xetex instead of luatex since luatex's
latex support is too immature (especially for the lack of a fontspec
equivalent) and no one is willing to make a latex package for luatex
since the manual contains too much buzzwords. The luatex api is all
greek to ordinary macro developers.

> I think luatexko can typeset modern Korean document
> quite well, if luatex binary is compiled from recent svn repository.
> The binary from texlive distribution is not usable with latex
> because of its many bugs, which were fixed after version 0.30.
>

Yes, I can typeset my Korean document quite well using that package.
And it is not complicated to install the Korean fonts.

> Currently, however, luatexko cannot deal with opentype layout
> features (especially, those of ccmp, ljmo, vjmo and tjmo),
> which are essential for typesetting old Korean documents
> being used until 100 years ago or so.  I am waiting for
> a more general solution from latex (or plain tex) world
> rather than implementing Korean-language-specific stuffs right now.
>
> BTW, the only shortcoming of current luatex seems to be that
> it consumes so much memory while loading CJK truetype fonts
> whose size is normally much bigger than Latin fonts
> (100 times bigger case is not infrequent), that it is almost
> unusable under machines with small size of ram.
>

Well, I have been suggesting this problem to Hans and Taco several
times during the last year. In ConTeXt this problem can be split into
two since ConTeXt use the font cache mechanism (it can dump the
metrics table from the font and store it as a lua table into the disk)

- When the font cache is given, LuaTeX seems to use too much memory
(It usually used up to 600M when typeset a document with only 3
Chinese fonts (song,hei,kai)). And this problem is solved by Taco and
Hans several month ago by changing the Lua C source code. However, the
memory footprint is still a little bit large (more than 300M for 3
Chinese fonts). It will take 3-4 seconds on my machine to load the
font cache for three Chinese fonts.

- When the font cache is not given, ConTeXt will try to dump one on
the first run. LuaTeX will use much more memory than expected. For
example, only loading the metrics from an ordinary Chinese font like
AdobeSongStd-Light (a 13M font) in plain TeX will use more than 700M
memory. I reported this problem to the ntg-context mailing list
yesterday.

For a normal publication, usually some 5 or 6 Chinese fonts will be
used. In some cases dozens of these fonts might be used. So it will
take very long time for luatex to parse the fonts, as well as huge
memory to store the metrics data. So it is suggested that users who
want to try luatex should have a computer with large memory and fast
CPU since the fontforge library is a nightmare for Asian users who
have old machines.


> Anyway,  those who are interested can download and install
> luatexko package for texlive 2008 by issuing command:
>
> tlmgr --location=http://ftp.ktug.or.kr/KTUG/texlive/2008 install
> kotex-dev kotex-base
>
> Best,
> Dohyun Kim
>

From pragma at wxs.nl  Mon Feb  2 10:17:55 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Feb 2009 10:17:55 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
Message-ID: <4986BA43.2060008@wxs.nl>

Yue Wang wrote:

> - When the font cache is given, LuaTeX seems to use too much memory
> (It usually used up to 600M when typeset a document with only 3
> Chinese fonts (song,hei,kai)). And this problem is solved by Taco and
> Hans several month ago by changing the Lua C source code. However, the
> memory footprint is still a little bit large (more than 300M for 3
> Chinese fonts). It will take 3-4 seconds on my machine to load the
> font cache for three Chinese fonts.

no matter what speedups we are able to cook up in the future, keep in 
mind that the nature of luatex is that information is passed around in 
lua tables and this will not change; as a result luatex will always have 
a larger footprint than pdftex and xetex; for that reason it's good to 
have multiple engines: xetex is faster and uses less memory (although it 
has some pretty large usage as well) but has kind of frozen interfaces 
while luatex is more open with respect to interfaces but at the cost of 
speed and memory (as soon as one starts to do fancy things with node 
lists, not only memory usage but also procesing speed compared to the 
other tex engines becomes a factor); it's simply something that luatex 
users to accept

> - When the font cache is not given, ConTeXt will try to dump one on
> the first run. LuaTeX will use much more memory than expected. For
> example, only loading the metrics from an ordinary Chinese font like
> AdobeSongStd-Light (a 13M font) in plain TeX will use more than 700M
> memory. I reported this problem to the ntg-context mailing list
> yesterday.

btw, the table of that font is not even that large:

  7.623.626 adobesongstd-light.lua

when dumped and when compiled to byte code:

  3.833.022 adobesongstd-light.luc

when loading this font, it takes soem 25 meg

> For a normal publication, usually some 5 or 6 Chinese fonts will be
> used. In some cases dozens of these fonts might be used. So it will
> take very long time for luatex to parse the fonts, as well as huge
> memory to store the metrics data. So it is suggested that users who
> want to try luatex should have a computer with large memory and fast
> CPU since the fontforge library is a nightmare for Asian users who
> have old machines.

by the time that luatex is mature (a couple of years down the road) 
machines have much more memory so memory is no issue then; disks might 
be solid state which also helps; processors might not be faster but 
caching migh be better; but no matter what the future brings ... luatex 
will never be real fast

(btw, cjk fonts might be large in number of glyphs, but for instance 
arabic has way more features so there processing time is more an issue)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Mon Feb  2 10:42:09 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 10:42:09 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
Message-ID: <4986BFF1.50308@elvenkind.com>



Yue Wang wrote:
> 
> Well, I have been suggesting this problem to Hans and Taco several
> times during the last year. In ConTeXt this problem can be split into
> two since ConTeXt use the font cache mechanism (it can dump the
> metrics table from the font and store it as a lua table into the disk)

Calculating boundingboxes implies interpreting the actual curves,
and that eats up lots of memory. I'll see if I can create a shortcut
somewhere. If I don't have to calculate boxes afterward, then there
is no need to interpret and save the curves, and the resulting memory
footprint should be much lower.

Best wishes,
Taco

From yuleopen at gmail.com  Mon Feb  2 10:43:17 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 17:43:17 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986BA43.2060008@wxs.nl>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BA43.2060008@wxs.nl>
Message-ID: <68bfdc900902020143l84a7fcambdd09108040c6edb@mail.gmail.com>

> no matter what speedups we are able to cook up in the future, keep in mind
> that the nature of luatex is that information is passed around in lua tables
> and this will not change; as a result luatex will always have a larger
> footprint than pdftex and xetex; for that reason it's good to have multiple
> engines: xetex is faster and uses less memory (although it has some pretty
> large usage as well) but has kind of frozen interfaces while luatex is more
> open with respect to interfaces but at the cost of speed and memory (as soon
> as one starts to do fancy things with node lists, not only memory usage but
> also procesing speed compared to the other tex engines becomes a factor);
> it's simply something that luatex users to accept
>

To be honest, the only reasons for me to use luatex is because xetex's
linebreaking is not so good, and context has better support for
luatex, so I can produce more fancy documents....

And ordinary researchers will not benefit from "open up the engines",
"lua scripting", "pass lua tables" since they just want to finish
their paper.

>> - When the font cache is not given, ConTeXt will try to dump one on
>> the first run. LuaTeX will use much more memory than expected. For
>> example, only loading the metrics from an ordinary Chinese font like
>> AdobeSongStd-Light (a 13M font) in plain TeX will use more than 700M
>> memory. I reported this problem to the ntg-context mailing list
>> yesterday.
>
> btw, the table of that font is not even that large:
>
>  7.623.626 adobesongstd-light.lua
>
> when dumped and when compiled to byte code:
>
>  3.833.022 adobesongstd-light.luc
>
> when loading this font, it takes soem 25 meg
>

Yes, 700/25=28, so fontforge use 28 times of that much memory.

>> For a normal publication, usually some 5 or 6 Chinese fonts will be
>> used. In some cases dozens of these fonts might be used. So it will
>> take very long time for luatex to parse the fonts, as well as huge
>> memory to store the metrics data. So it is suggested that users who
>> want to try luatex should have a computer with large memory and fast
>> CPU since the fontforge library is a nightmare for Asian users who
>> have old machines.
>
> by the time that luatex is mature (a couple of years down the road) machines
> have much more memory so memory is no issue then; disks might be solid state
> which also helps; processors might not be faster but caching migh be better;
> but no matter what the future brings ... luatex will never be real fast
>


Users have plenty of disk space + large memory + faster CPU, so we as
developers can waste them as we like......
The high usage of disk/memory/cpu may also boost the computer hardware
market, and finally solve the economic depression.



> (btw, cjk fonts might be large in number of glyphs, but for instance arabic
> has way more features so there processing time is more an issue)
>
> Hans
>
> -----------------------------------------------------------------
>                                          Hans Hagen | PRAGMA ADE
>              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>     tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
>                                             | www.pragma-pod.nl
> -----------------------------------------------------------------
>

From yuleopen at gmail.com  Mon Feb  2 10:45:45 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 17:45:45 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986BFF1.50308@elvenkind.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
Message-ID: <68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>

On Mon, Feb 2, 2009 at 5:42 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
>
> Yue Wang wrote:
>>
>> Well, I have been suggesting this problem to Hans and Taco several
>> times during the last year. In ConTeXt this problem can be split into
>> two since ConTeXt use the font cache mechanism (it can dump the
>> metrics table from the font and store it as a lua table into the disk)
>
> Calculating boundingboxes implies interpreting the actual curves,
> and that eats up lots of memory. I'll see if I can create a shortcut
> somewhere. If I don't have to calculate boxes afterward, then there
> is no need to interpret and save the curves, and the resulting memory
> footprint should be much lower.

Great to hear that, and if so, it will also make luatex runs much
faster since no calculation is needed.


>
> Best wishes,
> Taco
>

From taco at elvenkind.com  Mon Feb  2 10:48:23 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 10:48:23 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
Message-ID: <4986C167.7010200@elvenkind.com>



Yue Wang wrote:
> On Mon, Feb 2, 2009 at 5:42 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>>
>> Yue Wang wrote:
>>> Well, I have been suggesting this problem to Hans and Taco several
>>> times during the last year. In ConTeXt this problem can be split into
>>> two since ConTeXt use the font cache mechanism (it can dump the
>>> metrics table from the font and store it as a lua table into the disk)
>> Calculating boundingboxes implies interpreting the actual curves,
>> and that eats up lots of memory. I'll see if I can create a shortcut
>> somewhere. If I don't have to calculate boxes afterward, then there
>> is no need to interpret and save the curves, and the resulting memory
>> footprint should be much lower.
> 
> Great to hear that, and if so, it will also make luatex runs much
> faster since no calculation is needed.

Would it be acceptable to have

	fontforge.open("file", false)

which makes to_table return four zeroes in the character boundingboxes?


From javier at digi21.eu  Mon Feb  2 11:14:29 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 2 Feb 2009 11:14:29 +0100
Subject: [luatex] multiple callbacks
Message-ID: <5088e64f0902020214x34ee3655j9c4c9b5eea90c760@mail.gmail.com>

Elie:

I once wrote a package about adding code to token registers, typicaly
\everypar, \everymath, ... Surely one only among many existing solutions.
The concept is similar to adding functions to a callback, so here are a few
ideas that may be usefull for you:

I wrote \fornexttokl and \fornexttokr (left and right). In this case one
usually used left (i.e., fist executed). It is normally clear from what you
are adding whether it has to go at the left or at the right.
I also implemented a command that allows to remove what you added at some
point before, whitout interfering with code that might have been added since
you added your's. (As yet nobody has pointed this problem).

Happy coding

--Javier A.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090202/315f8db2/attachment.html 

From yuleopen at gmail.com  Mon Feb  2 11:15:32 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 18:15:32 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986C167.7010200@elvenkind.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
Message-ID: <68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>

>
> Would it be acceptable to have
>
>        fontforge.open("file", false)
>
> which makes to_table return four zeroes in the character boundingboxes?
>
>

no. they should be get from the glyf (xMin, yMin, xMax, yMax), hmtx,
vmtx, vorg, etc. table directly.

From pragma at wxs.nl  Mon Feb  2 11:17:20 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Feb 2009 11:17:20 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986C167.7010200@elvenkind.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
Message-ID: <4986C830.5090304@wxs.nl>

Taco Hoekwater wrote:
> 
> Yue Wang wrote:
>> On Mon, Feb 2, 2009 at 5:42 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>>> Yue Wang wrote:
>>>> Well, I have been suggesting this problem to Hans and Taco several
>>>> times during the last year. In ConTeXt this problem can be split into
>>>> two since ConTeXt use the font cache mechanism (it can dump the
>>>> metrics table from the font and store it as a lua table into the disk)
>>> Calculating boundingboxes implies interpreting the actual curves,
>>> and that eats up lots of memory. I'll see if I can create a shortcut
>>> somewhere. If I don't have to calculate boxes afterward, then there
>>> is no need to interpret and save the curves, and the resulting memory
>>> footprint should be much lower.
>> Great to hear that, and if so, it will also make luatex runs much
>> faster since no calculation is needed.
> 
> Would it be acceptable to have
> 
> 	fontforge.open("file", false)
> 
> which makes to_table return four zeroes in the character boundingboxes?

can be an option indeed, although we loose the ability to calculate the 
  height/depth which is no big deal for cjk fonts but could less optimal 
for other fonts

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb  2 11:18:34 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 02 Feb 2009 11:18:34 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
Message-ID: <4986C87A.4090806@telecom-bretagne.eu>

Yue Wang a ?crit :
> In China we suggest users use xetex instead of luatex since luatex's
> latex support is too immature (especially for the lack of a fontspec
> equivalent) and no one is willing to make a latex package for luatex
> since the manual contains too much buzzwords. The luatex api is all
> greek to ordinary macro developers.
>   

Not really in the thread, but it's a good occasion:

I spoke with Karl Berry, Will Robertson and other developers, and I 
think things are moving in this area. We'll try to adapt fontspec and 
also to get a minimal LuaTeX support integrated into the LaTeX format of 
TeXLive 2009. Other things to do are adapting inputenc (the same way 
XeTeX will do, this work will be common) and fontenc, and to get 
multiple callbacks.

The latex-l list doesn't seem apropriate to have these discussions. I 
know LuaTeX developers are the same as ConTeXt developers, but would it 
be possible to discuss of LuaTeX+LaTeX on this list?
-- 
Elie

From javier at digi21.eu  Mon Feb  2 11:26:17 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 2 Feb 2009 11:26:17 +0100
Subject: [luatex] OpenType problems
Message-ID: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>

I finally got started with LuaTex. I loaded OpenType fonts with the sample
code form the wiki and the fixes suggested by Jonathan some months ago. I
get this very different spacing with lmr10:

\input otffont.ltex  %Here is the callback
\font\tenrm=ec-lmr10
\font\ottenrm=LMRoman10-Regular

\setbox0 \hbox{\tenrm{} } \showthe\wd0

3.33333 pt

\setbox0 \hbox{\ottenrm{} } \showthe\wd0

2.5 pt

Any ideas how to solve it?

By the way, I have sent a couple of messages to the dev-luatex mailing list
some minutes ago and they still don't show up, is it normal?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090202/5cbc15ee/attachment.html 

From arthur.reutenauer at normalesup.org  Mon Feb  2 11:40:40 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Feb 2009 11:40:40 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986C87A.4090806@telecom-bretagne.eu>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986C87A.4090806@telecom-bretagne.eu>
Message-ID: <20090202104040.GX22175@phare.normalesup.org>

> The latex-l list doesn't seem apropriate to have these discussions. I know 
> LuaTeX developers are the same as ConTeXt developers, but would it be 
> possible to discuss of LuaTeX+LaTeX on this list?

  Of course, this is exactly the point of this list.  Macro writers who
write for LuaTeX are, in a sense, LuaTeX users, and it would be a waste
to create a third list for matters related specifically to LuaTeX + LaTeX;
that would just scatter information unnecessarily.

  The fact that the LuaTeX core developers are the same as the ConTeXt
core developers is not relevant here.  It explains why some purely
LuaTeX issues are discussed on the ConTeXt user list, but that's a side
effect, not the intent (and obviously, we're not going to blame the
people who discuss LuaTeX there either, we just have the discussion).

	Arthur

From luigi.scarso at gmail.com  Mon Feb  2 12:08:12 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 2 Feb 2009 12:08:12 +0100
Subject: [luatex] OpenType problems
In-Reply-To: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
References: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
Message-ID: <fe8d59da0902020308n331be2e6q5fbb05a043c391c4@mail.gmail.com>

On Mon, Feb 2, 2009 at 11:26 AM, Javier M?gica <javier at digi21.eu> wrote:

> I finally got started with LuaTex. I loaded OpenType fonts with the sample
> code form the wiki and the fixes suggested by Jonathan some months ago. I
> get this very different spacing with lmr10:
>
> \input otffont.ltex  %Here is the callback
> \font\tenrm=ec-lmr10
> \font\ottenrm=LMRoman10-Regular
>
> \setbox0 \hbox{\tenrm{} } \showthe\wd0
>
> 3.33333 pt
>
> \setbox0 \hbox{\ottenrm{} } \showthe\wd0
>
> 2.5 pt
>
> Any ideas how to solve it?
>
> By the way, I have sent a couple of messages to the dev-luatex mailing list
> some minutes ago and they still don't show up, is it normal?
>
>
Can you investigate
ec-lmr10
LMRoman10-Regular
with fontforge ?


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090202/8c32a94d/attachment.html 

From pragma at wxs.nl  Mon Feb  2 12:28:26 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Feb 2009 12:28:26 +0100
Subject: [luatex] OpenType problems
In-Reply-To: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
References: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
Message-ID: <4986D8DA.6090604@wxs.nl>

Javier M?gica wrote:
> I finally got started with LuaTex. I loaded OpenType fonts with the 
> sample code form the wiki and the fixes suggested by Jonathan some 
> months ago. I get this very different spacing with lmr10:
> 
> \input otffont.ltex  %Here is the callback
> \font\tenrm=ec-lmr10
> \font\ottenrm=LMRoman10-Regular
> 
> \setbox0 \hbox{\tenrm{} } \showthe\wd0
> 
> 3.33333 pt
> 
> \setbox0 \hbox{\ottenrm{} } \showthe\wd0
> 
> 2.5 pt
> 
> Any ideas how to solve it?

you can set space related fontdimens to the values that you prefer

latin modern opentype is not compatible with *-lmr (the can be 
differences in dimensions, kerns, ligatures)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Mon Feb  2 12:10:17 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 2 Feb 2009 12:10:17 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986C87A.4090806@telecom-bretagne.eu>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986C87A.4090806@telecom-bretagne.eu>
Message-ID: <fe8d59da0902020310u6fbcdac5y7172c8906fc2f28c@mail.gmail.com>

On Mon, Feb 2, 2009 at 11:18 AM, Elie Roux <elie.roux at telecom-bretagne.eu>wrote:

> Yue Wang a ?crit :
>
>> In China we suggest users use xetex instead of luatex since luatex's
>> latex support is too immature (especially for the lack of a fontspec
>> equivalent) and no one is willing to make a latex package for luatex
>> since the manual contains too much buzzwords. The luatex api is all
>> greek to ordinary macro developers.
>>
>>
>
> Not really in the thread, but it's a good occasion:
>
> I spoke with Karl Berry, Will Robertson and other developers, and I think
> things are moving in this area. We'll try to adapt fontspec and also to get
> a minimal LuaTeX support integrated into the LaTeX format of TeXLive 2009.
> Other things to do are adapting inputenc (the same way XeTeX will do, this
> work will be common) and fontenc, and to get multiple callbacks.
>
> The latex-l list doesn't seem apropriate to have these discussions. I know
> LuaTeX developers are the same as ConTeXt developers, but would it be
> possible to discuss of LuaTeX+LaTeX on this list?
>

In my opinion , yes , it's a good thing.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090202/ed4124fb/attachment.html 

From taco at elvenkind.com  Mon Feb  2 12:13:13 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 12:13:13 +0100
Subject: [luatex] OpenType problems
In-Reply-To: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
References: <5088e64f0902020226v71c660aeo3f98787a89e97e3e@mail.gmail.com>
Message-ID: <4986D549.6020206@elvenkind.com>



Javier M?gica wrote:
> I finally got started with LuaTex. I loaded OpenType fonts with the
> sample code form the wiki and the fixes suggested by Jonathan some
> months ago. I get this very different spacing with lmr10:
> 
> \input otffont.ltex  %Here is the callback
> \font\tenrm=ec-lmr10
> \font\ottenrm=LMRoman10-Regular
> 
> \setbox0 \hbox{\tenrm{} } \showthe\wd0
> 
> 3.33333 pt
> 
> \setbox0 \hbox{\ottenrm{} } \showthe\wd0
> 
> 2.5 pt
> 
> Any ideas how to solve it?

You have to fix the setting of f.parameters.space in the callback,
it should use the width of the actual space instead of a hardcoded
0.25 * size. Adding a

  if f.characters[32] then
      f.parameters.space = f.characters[32].width
  end

at the end (after all the other character calculations) should be
sufficient. A similar problem exists with the x_height parameter.

Best wishes,
Taco

From taco at elvenkind.com  Mon Feb  2 11:55:15 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 11:55:15 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
Message-ID: <4986D113.2010304@elvenkind.com>



Yue Wang wrote:
>> Would it be acceptable to have
>>
>>        fontforge.open("file", false)
>>
>> which makes to_table return four zeroes in the character boundingboxes?
>>
> no. they should be get from the glyf (xMin, yMin, xMax, yMax), hmtx,
> vmtx, vorg, etc. table directly.

CFF based fonts (Adobe Song) do not have the glyf (boundingbox)
information, which is why I have to do the expensive calculation to
begin with.

So, the question remains the same: would it be ok to have a correct
vwidth (cf width in horizontal fonts) and tsidebearing (analogous to
the already existing lsidebearing), but no boundingbox? In other
words, is the glyph boundingbox information relevant in the general
case?

The exact boundingbox is relevant for latin fonts because the glyph
depth and height are important for the line height calculations,
because the horizontal baseline lives somewhere in the middle of
the glyphs.

Best wishes,
Taco






From yuleopen at gmail.com  Mon Feb  2 14:23:01 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 21:23:01 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986D113.2010304@elvenkind.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
Message-ID: <68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>

>
> CFF based fonts (Adobe Song) do not have the glyf (boundingbox)
> information, which is why I have to do the expensive calculation to
> begin with.
>
> So, the question remains the same: would it be ok to have a correct
> vwidth (cf width in horizontal fonts) and tsidebearing (analogous to
> the already existing lsidebearing), but no boundingbox? In other
> words, is the glyph boundingbox information relevant in the general
> case?
>
> The exact boundingbox is relevant for latin fonts because the glyph
> depth and height are important for the line height calculations,
> because the horizontal baseline lives somewhere in the middle of
> the glyphs.
>

Please use control box instead of bounding box. Refer
http://freetype.sourceforge.net/freetype2/docs/reference/ft2-glyph_management.html#FT_Glyph_Get_CBox
and related code (ftglyph.c)

From taco at elvenkind.com  Mon Feb  2 14:25:33 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 14:25:33 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<20090201171801.GA11997@phare.normalesup.org>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>	<4986C167.7010200@elvenkind.com>	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
Message-ID: <4986F44D.2060701@elvenkind.com>



Yue Wang wrote:
>>
>> The exact boundingbox is relevant for latin fonts because the glyph
>> depth and height are important for the line height calculations,
>> because the horizontal baseline lives somewhere in the middle of
>> the glyphs.
> 
> Please use control box instead of bounding box. Refer
> http://freetype.sourceforge.net/freetype2/docs/reference/ft2-glyph_management.html#FT_Glyph_Get_CBox
> and related code (ftglyph.c)

You can forget about memory savings for the near future, then.

Best wishes,
Taco

From yuleopen at gmail.com  Mon Feb  2 16:50:36 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 23:50:36 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <4986F44D.2060701@elvenkind.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
	<4986F44D.2060701@elvenkind.com>
Message-ID: <68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>

Hi, Taco:


> You can forget about memory savings for the near future, then.

Then why should we calculate the bounding box for each glyph? Well, as
far as I know, I think it is needed when composing pages (glue the
line boxes together into a page). But now different fonts/font
types/TeX implementations have their own understanding of bounding
boxes (also known as the font metrics), and they are very different
from the original TeX's and Computer Modern's [see Hans'
fontspecial-p.pdf]. Moreover, using the rules in TeX (baselineskip and
friends) are not strict to test whether two glyphs' bounding box are
overlapped with each other. So I don't think bounding box for each
glyph is needed in this situation, maybe we can use CFF's FontBBox as
the largest value to test if the distance between two lines are good.
Just my two cents.


Anyway, if you insist on the current implementation, go ahead, it's also great:)
But I will test luapdflatex later until I buy a new computer if it
does not provide a font cache feature......


Yue Wang

From yuleopen at gmail.com  Mon Feb  2 16:51:47 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Mon, 2 Feb 2009 23:51:47 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
	<4986F44D.2060701@elvenkind.com>
	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
Message-ID: <68bfdc900902020751o3529cbc4w570930a5a6abe3fe@mail.gmail.com>

sorry s/ are not strict / are too strict

On Mon, Feb 2, 2009 at 11:50 PM, Yue Wang <yuleopen at gmail.com> wrote:
> Hi, Taco:
>
>
>> You can forget about memory savings for the near future, then.
>
> Then why should we calculate the bounding box for each glyph? Well, as
> far as I know, I think it is needed when composing pages (glue the
> line boxes together into a page). But now different fonts/font
> types/TeX implementations have their own understanding of bounding
> boxes (also known as the font metrics), and they are very different
> from the original TeX's and Computer Modern's [see Hans'
> fontspecial-p.pdf]. Moreover, using the rules in TeX (baselineskip and
> friends) are not strict to test whether two glyphs' bounding box are
> overlapped with each other. So I don't think bounding box for each
> glyph is needed in this situation, maybe we can use CFF's FontBBox as
> the largest value to test if the distance between two lines are good.
> Just my two cents.
>
>
> Anyway, if you insist on the current implementation, go ahead, it's also great:)
> But I will test luapdflatex later until I buy a new computer if it
> does not provide a font cache feature......
>
>
> Yue Wang
>

From taco at elvenkind.com  Mon Feb  2 17:07:04 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Feb 2009 17:07:04 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>	<4986C167.7010200@elvenkind.com>	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>	<4986D113.2010304@elvenkind.com>	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>	<4986F44D.2060701@elvenkind.com>
	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
Message-ID: <49871A28.8060901@elvenkind.com>



Yue Wang wrote:
> 
> Anyway, if you insist on the current implementation, go ahead, it's also great:)

Well no, I do not insist on that. But in the current state of the
fontforge-based implementation, the difference between a true
boundingbox and the control box is just processing speed, not
memory usage, and changing that behaviour will take more programming
time than I have available at the moment, so I have to move the
request into the future for now.

Best wishes,
Taco

From arthur.reutenauer at normalesup.org  Mon Feb  2 17:09:09 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Feb 2009 17:09:09 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
References: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
	<4986F44D.2060701@elvenkind.com>
	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
Message-ID: <20090202160909.GY22175@phare.normalesup.org>

> Then why should we calculate the bounding box for each glyph? Well, as

  It's weird that you're the one asking the question: Taco was exactly
trying to find ways to avoid calculating the bounding bax of each
individual glyph if possible, and you sort of told him "That's not
acceptable, please calculate all of them, emulating that feature from
FreeType."

>                                   But now different fonts/font
> types/TeX implementations have their own understanding of bounding
> boxes (also known as the font metrics)

  Font metrics are related, but *not identical* to glyphs bounding
boxes.  In particular, a glyph's advance width is very much different
from the horizontal dimensions of its bouding box.  Try any italic font,
for example.

>                             So I don't think bounding box for each
> glyph is needed in this situation, maybe we can use CFF's FontBBox as
> the largest value to test if the distance between two lines are good.

  I also think that in very specific situations you can use the font's
global bounding box, although you probably have to be very careful what
you do.  But really, you seemed to be saying the exact contrary just
before.

> Anyway, if you insist on the current implementation, go ahead, it's also great:)
> But I will test luapdflatex later until I buy a new computer if it
> does not provide a font cache feature......

  LuaTeX will never implement such a cache mechanism, I hope that's
clear.  Thus, the responsibility lies with the macro package.

	Arthur

From yuleopen at gmail.com  Mon Feb  2 17:26:33 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Tue, 3 Feb 2009 00:26:33 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <20090202160909.GY22175@phare.normalesup.org>
References: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
	<4986F44D.2060701@elvenkind.com>
	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
	<20090202160909.GY22175@phare.normalesup.org>
Message-ID: <68bfdc900902020826x38999d9epc46b9061cc6c5a9e@mail.gmail.com>

>  It's weird that you're the one asking the question: Taco was exactly
> trying to find ways to avoid calculating the bounding bax of each
> individual glyph if possible, and you sort of told him "That's not
> acceptable, please calculate all of them, emulating that feature from
> FreeType."


No, I am not. I just want to say:
- Well, if we want to calculate it, then control box might be much
more efficient.
- If we dont calculate, good, we can use  1) TrueType/ OpenType's glyf
table 2) CFF's global bounding box, they are much better than giving 4
zeros.


>  Font metrics are related, but *not identical* to glyphs bounding
> boxes.  In particular, a glyph's advance width is very much different
> from the horizontal dimensions of its bouding box.  Try any italic font,
> for example.

Yes. But as far as I know, the only need in current luatex/mkiv is to
get the height and depth, and later use it to calculate the line skip.
when make box into lines (I mean in horizontal mode), we only need
width (not xmax-xmin) and origin point.

>  I also think that in very specific situations you can use the font's
> global bounding box, although you probably have to be very careful what
> you do.  But really, you seemed to be saying the exact contrary just
> before.

I mean in practice the global bounding box can be used to calculate
the line skip, although not good as bounding box, but very strict and
efficient.


>
>  LuaTeX will never implement such a cache mechanism, I hope that's
> clear.  Thus, the responsibility lies with the macro package.
>

I mean pdflualatex, not LuaTeX engine. Hans said in the ntg-mailing
list that he will implement a plain TeX package to use opentype fonts,
without font cache.

>        Arthur
>

From arthur.reutenauer at normalesup.org  Mon Feb  2 18:00:19 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Feb 2009 18:00:19 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020826x38999d9epc46b9061cc6c5a9e@mail.gmail.com>
References: <4986BFF1.50308@elvenkind.com>
	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>
	<4986C167.7010200@elvenkind.com>
	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>
	<4986D113.2010304@elvenkind.com>
	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>
	<4986F44D.2060701@elvenkind.com>
	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>
	<20090202160909.GY22175@phare.normalesup.org>
	<68bfdc900902020826x38999d9epc46b9061cc6c5a9e@mail.gmail.com>
Message-ID: <20090202170019.GA22175@phare.normalesup.org>

> - Well, if we want to calculate it, then control box might be much
> more efficient.

  OK, but that's not for right now, apparently.

> - If we dont calculate, good, we can use  1) TrueType/ OpenType's glyf
> table 2) CFF's global bounding box, they are much better than giving 4
> zeros.

  You don't get the intent.  If you, the macro package writer, wants to
reduce the memory footprint of LuaTeX when you load some font, you have
the choice to say fontforge.open(that_font, false), and LuaTeX won't
calculate the individual glyphs' bounding boxes, it will fill the Lua
tables with meaningless information.  Then it's your responsibility to
use some reasonable default instead, like the CFF FontBBox.

  Hence, it's pretty unimportant what the Lua tables for the glyphs'
bounding box contain (by the way, Taco, wouldn't be nil even better?);
the point is that you don't calculate the real bounding boxes.  And it
sounds like you're actually happy with the idea; so that's cool, but it
would really be simpler if you tried to answer one question at a time
and not raising related issues each time someone makes a suggestion.

> Yes. But as far as I know, the only need in current luatex/mkiv is to
> get the height and depth

  The bottom line is that none of the vector font formats contains that
basic information that has been in TFM's since they exist.  So we need
to find a substitute in the font information that's available.

> I mean pdflualatex, not LuaTeX engine. Hans said in the ntg-mailing
> list that he will implement a plain TeX package to use opentype fonts,
> without font cache.

  But Hans won't write a line of code for LaTeX.  At some point things
have to be done by the people who really care about LaTeX (not my case
either).

	Arthur

From pragma at wxs.nl  Mon Feb  2 18:24:08 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Feb 2009 18:24:08 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902020826x38999d9epc46b9061cc6c5a9e@mail.gmail.com>
References: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>	<4986BFF1.50308@elvenkind.com>	<68bfdc900902020145y4883ab18k23ce5d9e1b8233ef@mail.gmail.com>	<4986C167.7010200@elvenkind.com>	<68bfdc900902020215j2c92dbd8i702efa7749312008@mail.gmail.com>	<4986D113.2010304@elvenkind.com>	<68bfdc900902020523h5ea5265fhfa1a95d5d9480085@mail.gmail.com>	<4986F44D.2060701@elvenkind.com>	<68bfdc900902020750i3ed6e31au53945419f31ff750@mail.gmail.com>	<20090202160909.GY22175@phare.normalesup.org>
	<68bfdc900902020826x38999d9epc46b9061cc6c5a9e@mail.gmail.com>
Message-ID: <49872C38.6070206@wxs.nl>

Yue Wang wrote:

> Yes. But as far as I know, the only need in current luatex/mkiv is to
> get the height and depth, and later use it to calculate the line skip.
> when make box into lines (I mean in horizontal mode), we only need
> width (not xmax-xmin) and origin point.

i use if for a few more things but my usage might not be representative; 
anyhow, the 'false' option resulting in no bb calculation and no bb 
entry in the lua table will solve part of you rproblem

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Mon Feb  2 23:43:03 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Feb 2009 23:43:03 +0100
Subject: [luatex] Sample code for a very basic OpenType layout engine
Message-ID: <20090202224303.GH22175@phare.normalesup.org>

	Hello everyone,

  In an attempt to contribute to the general war effort towards
improving the support for LuaTeX in macro packages, in particular LaTeX,
I'm releasing a small experiment I made last Fall: an extremely basic
OpenType layout engine, meant to be used with plain LuaTeX (but easily
adaptable to pdflualatex, I guess).  It really only implements one type
of lookup: GSUB 1, but you can already use quite a lot of OpenType
features with that single lookup (onum, smcp, sups, etc.)

  I put it on Google Code:

	http://code.google.com/p/mingyue/

  It contains, for the moment, exactly the TeX file as I left it three
months ago, together with the PDF output I got with the latest LuaTeX
revision back then.  It is completely raw, very little comments in the
code, no use instructions, but I will try to clean it up and enhance it
as soon as I find time.  You also need quite a lot of fonts, most of
which are proprietary; I will try to find freely available fonts with
equivalent features (but Latin Modern and the TeX Gyre fonts are a good
start).

  Given the many experiments I tried, the single page of text probably
looks like the work of a madman, but ... Oh, well, I deny everything :-)

	Arthur

From wspr81 at gmail.com  Tue Feb  3 03:55:27 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 3 Feb 2009 13:25:27 +1030
Subject: [luatex] using (pdf)lualatex
References: <20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<68bfdc900902020051q6b51dc31p548a0f2b68b511c3@mail.gmail.com>
	<4986C87A.4090806@telecom-bretagne.eu>
Message-ID: <gm8bmv$5f1$1@ger.gmane.org>

On 2009-02-02 20:48:34 +1030, Elie Roux 
<elie.roux at telecom-bretagne.eu> said:

> We'll try to adapt fontspec and also to get a minimal LuaTeX support 
> integrated into the LaTeX format of TeXLive 2009.

I hope things do get moving, but best not to set deadlines just yet :)

Will



From elie.roux at telecom-bretagne.eu  Tue Feb  3 22:30:59 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 03 Feb 2009 22:30:59 +0100
Subject: [luatex] LuaTeX + LaTeX
Message-ID: <4988B793.9040401@telecom-bretagne.eu>

Hello all,

During the last month I had a lot of email conversations about what 
seems to be a growing need: LuaTeX + LaTeX. Here is a summary of what I 
learned from these conversations, about some topics:

Basically there are two needs: adapting the LuaTeX new features to 
LaTeX, and adapting LaTeX to the LuaTeX engine.

On the first category is one main project: OT fonts.

== Open Type ==

The discussions lead to one proposal: adapting XeTeX's fontspec to 
LuaTeX. To do so there are two distinct steps:

First being able to open a OT font and being able to choose the 
functionalities we want from it.

Then adapting fontspec to the code of the fist step.

Arthur showed a base code on which we could work, and Hans said he could 
isolate some code from ConTeXt and make it generic enough for plainTeX, 
but only after the math functions are stable. I don't know if the math 
functions are stable, but Hans is your proposition still available?

Will Robertson is willing to help on this, especially on adapting 
fonspec, but first we need to work on the code to open OT fonts.

== luatex.sty ==

Heiko has already been working on adapting LaTeX to LuaTeX by writing a 
luatex.sty, integrated into TeXLive 2008. There are though several 
problems with this package: first Heiko is very busy, and almost 
unreachable. The macros defined in the package do not all start by lua, 
when they should, like the macros defined by pdfTeX (that start by pdf). 
Also the package is not stable enough to be integrated in the LaTeX format.

Integration in the LaTeX format will be totally impossible now for any 
style (even stable), because the LaTeX team works on LaTeX 3, and does 
not want to start changing things in LaTeX 2. But Kark Berry can 
integrate a style (like a style for LuaTeX) in the LaTeX format of 
TeXLive, so we don't have to worry about that.

The style misses, I think, a very important thing, which is multiple 
callbacks. As I can't really reach Heiko, I think the best solution is 
to make a separate style, and ask him to integrate it when it's done. So 
I think we can relaunch the discussions on this. We stopped the 
discussion with a sample code from Hans, asking if it would be 
interesting to continue it... now it is. So if someone wants to continue 
the code given by Hans, please do. Maybe Hans himself?

== Backward compatibility ==

If we want (and I think we do) LuaTeX to be the next "normal" engine for 
LaTeX, like pdfTeX is now, we need to ensure a total backward compatibility.

This compatibilty is broken with two major packages: inputenc and 
fontenc. The two styles are not working at all anymore.

For inputenc, the problem is the same for XeTeX, and the solution can be 
common, so we can work with Will.

For fontenc, the problem does not appear at all with XeTeX, so we'll 
have to work on a LuaTeX solution.

== (Personal) Bonus ==

And at the end of this, we may be able to modify the parallel package so 
that parallel paragraph have a perfect vertical alignment (which is 
impossible now), and that will change the life of a lot of LaTeX users, 
so everyone will go LuaTeX... But that's off-topic...

If you have any suggestion or if you want to work on one of the tasks, 
please do not hesitate!
-- 
Elie

From arthur.reutenauer at normalesup.org  Tue Feb  3 23:46:55 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 3 Feb 2009 23:46:55 +0100
Subject: [luatex] LuaTeX + LaTeX
In-Reply-To: <4988B793.9040401@telecom-bretagne.eu>
References: <4988B793.9040401@telecom-bretagne.eu>
Message-ID: <20090203224655.GU22175@phare.normalesup.org>

> This compatibilty is broken with two major packages: inputenc and fontenc. 
> The two styles are not working at all anymore.

  There is a small lua-inputenc contributed by Javier Bezos
(CTAN:macros/latex/exptl/lualatex/lua-inputenc/), that does some of the
basics, but you'll surely run into some problems, in particular if you
want to write out to a file (XeTeX's \XeTeXinputencoding has the same
problem).

  fontenc would surely be a much bigger issue.

  To speak the truth, I think it's quite a waste of time to try
implementing inputenc and fontenc in LuaTeX, because they're so much
tied to the 8-bit limitations of the older TeX engines: it sounds to me
like wanting to draw a railway carriage with horse power (or, for our
Australian readers, Afghan camels ;-)

  The only reasonable method is, again as for XeTeX, to use UTF-8
throughout, together with a LuaTeX-aware fontspec, and no inputenc nor
fontenc, and users have to be educated to do so (once this lua-fontspec
exists, that is).

	Arthur

From karl at freefriends.org  Wed Feb  4 00:31:40 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 3 Feb 2009 17:31:40 -0600
Subject: [luatex] LuaTeX + LaTeX
In-Reply-To: <20090203224655.GU22175@phare.normalesup.org>
Message-ID: <200902032331.n13NVeX29429@f7.net>

    To speak the truth, I think it's quite a waste of time to try
    implementing inputenc and fontenc in LuaTeX, 

It is not a waste of time if we ever want "latex" (as opposed to just
"lualatex") to invoke luatex instead of pdftex.  Which is an extremely
desirable goal, IMHO.  To achieve that, luatex has to be utterly
compatible with existing documents in the real world.


From arthur.reutenauer at normalesup.org  Wed Feb  4 00:39:18 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 4 Feb 2009 00:39:18 +0100
Subject: [luatex] LuaTeX + LaTeX
In-Reply-To: <200902032331.n13NVeX29429@f7.net>
References: <20090203224655.GU22175@phare.normalesup.org>
	<200902032331.n13NVeX29429@f7.net>
Message-ID: <20090203233918.GY22175@phare.normalesup.org>

> It is not a waste of time if we ever want "latex" (as opposed to just
> "lualatex") to invoke luatex instead of pdftex.

  OK, right.  But that seems like a long-term goal, and for the moment
it seems to me that it's more urgent to make pdflualatex usable in some
particular situations, rather than completely compatible with pdfTeX,
which should come later, in my opinion.

	Arthur

From karl at freefriends.org  Wed Feb  4 00:52:15 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 3 Feb 2009 17:52:15 -0600
Subject: [luatex] LuaTeX + LaTeX
In-Reply-To: <4988B793.9040401@telecom-bretagne.eu>
Message-ID: <200902032352.n13NqF706719@f7.net>

Thanks for moving this forward, Elie (and Arthur).

    Kark Berry can integrate a style (like a style for LuaTeX) in the
    LaTeX format of TeXLive, so we don't have to worry about that.

That is, we can make the "(pdf)lualatex" format load additional packages
-- we can do anything we want there, since compatibility does not arise.
I hope that such packages would be designed, insofar as its possible, to
eventually be included in the LaTeX kernel (else they shouldn't be in a
format at all).  I don't mean the implementation of them, which is
surely impossible at this point, but the functionality.

From wspr81 at gmail.com  Wed Feb  4 01:39:57 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 4 Feb 2009 11:09:57 +1030
Subject: [luatex] LuaTeX + LaTeX
References: <4988B793.9040401@telecom-bretagne.eu>
	<20090203224655.GU22175@phare.normalesup.org>
Message-ID: <gmao4s$jpp$1@ger.gmane.org>

On 2009-02-04 09:16:55 +1030, Arthur Reutenauer 
<arthur.reutenauer at normalesup.org> said:

>> This compatibilty is broken with two major packages: inputenc and fontenc.
>> The two styles are not working at all anymore.
> 
>   There is a small lua-inputenc contributed by Javier Bezos
> (CTAN:macros/latex/exptl/lualatex/lua-inputenc/), that does some of the
> basics, but you'll surely run into some problems, in particular if you
> want to write out to a file (XeTeX's \XeTeXinputencoding has the same
> problem).
> 
>   fontenc would surely be a much bigger issue.
> 
>   To speak the truth, I think it's quite a waste of time to try
> implementing inputenc and fontenc in LuaTeX, because they're so much
> tied to the 8-bit limitations of the older TeX engines: it sounds to me
> like wanting to draw a railway carriage with horse power (or, for our
> Australian readers, Afghan camels ;-)

We have horses too :)
On the other hand, I've eaten camel, but never horse.

The big reason to try and emulate inputenc to some degree is so that 
new users don't get confused when their documents with the seemingly 
correct
  \usepackage[utf8]{inputenc}
don't suddenly die when run on XeTeX or LuaTeX when all >8-bit 
characters start being interpreted in octets.

Supporting older encodings is a more minor point; convenient for those 
people with legacy documents. But as you say above, it may be (or 
probably is) impossible to achieve 100% compatibility.

* * *

fontenc would presumably stay the same; since XeTeX and LuaTeX can both 
use tfm-based fonts (right?), then the machinery stays exactly the 
same; new unicode fonts (in fontspec, anyway) simply use the EU1 font 
encoding. Not that support there is perfect, but people haven't been 
too adventurous mixing TFM and OTF fonts in XeTeX, to my relief.

Cheers,
Will



From wspr81 at gmail.com  Wed Feb  4 01:46:30 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 4 Feb 2009 11:16:30 +1030
Subject: [luatex] LuaTeX + LaTeX
References: <4988B793.9040401@telecom-bretagne.eu>
	<200902032352.n13NqF706719@f7.net>
Message-ID: <gmaoh5$kn5$1@ger.gmane.org>

On 2009-02-04 10:22:15 +1030, 
karl at freefriends.org (Karl Berry) said:

> That is, we can make the "(pdf)lualatex" format load additional packages
> -- we can do anything we want there, since compatibility does not arise.
> I hope that such packages would be designed, insofar as its possible, to
> eventually be included in the LaTeX kernel (else they shouldn't be in a
> format at all).

In my opinion, the only reason that encoding support or font support or 
whatever should be pre-loaded in the lualatex format is if those 
relevant packages become pre-loaded in the latex format (low-level 
support provided by pdftex.def is another story). And that's not going 
to happen, for backwards compatibility reasons.

However, the LaTeX team is happy to make changes to the packages it 
maintains such as inputenc to behave in an appropriate manner with the 
new engines. It just hasn't happened yet :)

Cheers,
Will



From elie.roux at telecom-bretagne.eu  Wed Feb  4 13:37:23 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 04 Feb 2009 13:37:23 +0100
Subject: [luatex] LaTeX + LuaTeX
In-Reply-To: <C36D77D480CF441487EA080989587173@PC1>
References: <4988B95B.40202@telecom-bretagne.eu>
	<C36D77D480CF441487EA080989587173@PC1>
Message-ID: <49898C03.6090007@telecom-bretagne.eu>

Javier Bezos a ?crit :
> and my little lua-inputenc does that, mainly for testing purposes

I just discovered it, it's great! What kind of things are still to 
implement in it? It seems a rather simple and good solution... It 
doesn't work for an aux file for example, but are there other issues? 
Are you interested in going further in this style, or more in letting 
someone else finish it? If we manage to fix the aux file issue, maybe we 
can integrate it into TeXLive 2009...
-- 
Elie

From elie.roux at telecom-bretagne.eu  Wed Feb  4 17:16:26 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 04 Feb 2009 17:16:26 +0100
Subject: [luatex] Review on multiple callbacks
Message-ID: <4989BF5A.608@telecom-bretagne.eu>

Hello,

I took the last step of the discussion on multiple callbacks, and I 
improved it, to get this (in plainTeX). If you have time to tell me what 
you think about it. I think the only trollable code is the following:

-- we overwrite callback.register, so that noone uses it
callback.register = function (...)
mcallbacks.error("function callback.register is considered too dangerous 
to use and has been deleted by mcallbacks, please use callback.add instead")
end

After that I think I'll make a dtx that will generate a .sty containing 
only a \directlua0{...} and a .lua.

Thank you in advance !
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luamcallbacks.zip
Type: application/zip
Size: 1843 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090204/3363eb05/attachment.zip 

From elie.roux at telecom-bretagne.eu  Thu Feb  5 15:30:17 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 05 Feb 2009 15:30:17 +0100
Subject: [luatex] Place of the LuaTeX+LaTeX macros
In-Reply-To: <7156.1233837014@mole.cl.cam.ac.uk>
References: <7156.1233837014@mole.cl.cam.ac.uk>
Message-ID: <498AF7F9.1030506@telecom-bretagne.eu>

Hello,

I haven't been able to determine for sure where global LuaTeX macro 
files (for both plainTeX and LaTeX) should go on the CTAN, nor the good 
directory to put them in in TeXLive. The macro files I'm talking about 
are for general use, and may even be integrated in the format itself...

Where should I put them in the CTAN? and in TeXLive?

Thank you in advance,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Thu Feb  5 16:16:28 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 05 Feb 2009 16:16:28 +0100
Subject: [luatex] Place of the LuaTeX+LaTeX macros
In-Reply-To: <9630.1233845492@mole.cl.cam.ac.uk>
References: <9630.1233845492@mole.cl.cam.ac.uk>
Message-ID: <498B02CC.9050709@telecom-bretagne.eu>

Robin Fairbairns a ?crit :
> we have a macros/xetex/(plain|latex|...), so by analogy i would consider
> creating a new tree macros/luatex, and populating it as required.
>   

Ok!

> look in texmf.cnf, and see what TEXINPUTS.lualatex looks like

It does not exist in TeXLive 2008... But I guess tex/latex/ is alright, 
as it contains packages for every engine...
-- 
Elie

From rf10 at cl.cam.ac.uk  Thu Feb  5 15:51:32 2009
From: rf10 at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 05 Feb 2009 14:51:32 +0000
Subject: [luatex] Place of the LuaTeX+LaTeX macros
In-Reply-To: Your message of Thu, 05 Feb 2009 15:30:17 +0100.
	<498AF7F9.1030506@telecom-bretagne.eu> 
Message-ID: <9630.1233845492@mole.cl.cam.ac.uk>

Elie Roux <elie.roux at telecom-bretagne.eu> wrote:

> I haven't been able to determine for sure where global LuaTeX macro
> files (for both plainTeX and LaTeX) should go on the CTAN,

we have a macros/xetex/(plain|latex|...), so by analogy i would consider
creating a new tree macros/luatex, and populating it as required.

note that we already have macros/latex/exptl/lualatex, but if you're
going to start providing production stuff, that's not appropriate.

> nor the
> good directory to put them in in TeXLive. The macro files I'm talking
> about are for general use, and may even be integrated in the format
> itself...

look in texmf.cnf, and see what TEXINPUTS.lualatex looks like

Robin Fairbairns

For the CTAN team

From arthur.reutenauer at normalesup.org  Thu Feb  5 17:47:46 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 5 Feb 2009 17:47:46 +0100
Subject: [luatex] Place of the LuaTeX+LaTeX macros
In-Reply-To: <498B02CC.9050709@telecom-bretagne.eu>
References: <9630.1233845492@mole.cl.cam.ac.uk>
	<498B02CC.9050709@telecom-bretagne.eu>
Message-ID: <20090205164746.GH6155@phare.normalesup.org>

  Robin, posting to the LuaTeX list is only allowed for members, but I'm
happy to approve your messages if you don't plan to subscribe.

>> look in texmf.cnf, and see what TEXINPUTS.lualatex looks like
>
> It does not exist in TeXLive 2008... But I guess tex/latex/ is alright, as 
> it contains packages for every engine...

  By analogy with XeTeX, it should be tex/luatex and tex/lualatex.  That
said, Taco introduced a <texmf>/luatex/lua hierarchy for Lua files that
are independent of the macro packages, like some additional modules (see
http://www.ntg.nl/mailman/private/dev-luatex/2009-January/002128.html).

	Arthur

From karl at freefriends.org  Fri Feb  6 00:42:47 2009
From: karl at freefriends.org (Karl Berry)
Date: Thu, 5 Feb 2009 17:42:47 -0600
Subject: [luatex] Place of the LuaTeX+LaTeX macros
In-Reply-To: <20090205164746.GH6155@phare.normalesup.org>
Message-ID: <200902052342.n15NglE01878@f7.net>

    >> look in texmf.cnf, and see what TEXINPUTS.lualatex looks like
    >
    > It does not exist in TeXLive 2008... 

I'll add it shortly, thanks.

    By analogy with XeTeX, it should be tex/luatex and tex/lualatex.  

Yes, I suppose so.  That is, texmf-dist/tex/{luatex,lualatex}.

    That said, Taco introduced a <texmf>/luatex/lua hierarchy for Lua
    files that are independent of the macro packages, like some
    additional modules (see
    http://www.ntg.nl/mailman/private/dev-luatex/2009-January/002128.html).

Yes, Taco and I discussed it, and this was our best idea for these Lua
files, which are essentially part of the implementation rather than a
third-party "add-on".  And so it's really just texmf/luatex -- it won't
exist in texmf-dist.  And it won't be part of TEXINPUTS (as far as I can
remember).

From elie.roux at telecom-bretagne.eu  Sat Feb  7 22:48:23 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 07 Feb 2009 22:48:23 +0100
Subject: [luatex] advices for some multiple callbacks implementations
Message-ID: <498E01A7.9070001@telecom-bretagne.eu>

Hello,

I would need an advice on the way to implement several functions in some 
callbacks, the fundamental question is the following one:

for callbacks dealing with file reading, like the read_xxx_file or 
open_read_file, it seems unlogical to register several callbacks, so in 
the current state the handler for these callbacks only calls the first 
function in the list (the one with highest priority). Does it seem right?

The only case in which it would be logical to register several functions 
in this kind of callbacks is this one: if someone wants to act on a 
particular file, he could register a callback that will be called only 
on this file... But the more I write about this idea the less it seems 
good, what do you think?

Joined is the current state, if you have comments...

Thank you!
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luamcallbacks.zip
Type: application/zip
Size: 84998 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090207/ef19b2b0/attachment-0001.zip 

From vafakh9 at gmail.com  Sun Feb  8 14:29:25 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 00:29:25 +1100
Subject: [luatex] pdfluatex bug
Message-ID: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>

If you try compiling the following short beamer document with pdflualatex:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass{beamer}
\begin{document}
\begin{frame}{Test}
This is just a test...!
\end{frame}
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

you get no PDF output and the last bit of your log says

%%%%%%%%%%%%%%%%%%%%%%

!luaTeX error (file beamericonbook.pdf): PDF inclusion: invalid destination
</I
nterpolate false >
 ==> Fatal error occurred, no output PDF file produced!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

but if you compile your document with just lualatex, you will obtain the
result. It seems that pdflualatex has issues with including pdf.
-- 
VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/99deb976/attachment.html 

From yuleopen at gmail.com  Sun Feb  8 15:21:26 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Sun, 8 Feb 2009 22:21:26 +0800
Subject: [luatex] pdfluatex bug
In-Reply-To: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
Message-ID: <68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>

Are you using the latest luatex?

On Sun, Feb 8, 2009 at 9:29 PM, ??? ????? <vafakh9 at gmail.com> wrote:
> If you try compiling the following short beamer document with pdflualatex:
>
> %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
> \documentclass{beamer}
> \begin{document}
> \begin{frame}{Test}
> This is just a test...!
> \end{frame}
> \end{document}
> %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
>
> you get no PDF output and the last bit of your log says
>
> %%%%%%%%%%%%%%%%%%%%%%
>
> !luaTeX error (file beamericonbook.pdf): PDF inclusion: invalid destination
> </I
> nterpolate false >
>  ==> Fatal error occurred, no output PDF file produced!
> %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
>
> but if you compile your document with just lualatex, you will obtain the
> result. It seems that pdflualatex has issues with including pdf.
> --
> VK
>

From vafakh9 at gmail.com  Sun Feb  8 15:22:48 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 01:22:48 +1100
Subject: [luatex] pdfluatex bug
In-Reply-To: <68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
	<68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>
Message-ID: <ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>

No, I am using the one in TL08
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/ad690cc4/attachment.html 

From vafakh9 at gmail.com  Sun Feb  8 15:35:34 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 01:35:34 +1100
Subject: [luatex] Arabic alphabets are not connected
Message-ID: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>

I use the following test file but Arabic alphabets are not connected. Do you
know what should I do?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper,12pt]{article}
\pdfoutput1
\directlua0{
callback.register('define_font',
  function(name, size)
    fonttype = nil
    filename = kpse.find_file(name,"opentype fonts")
    if (filename)
    then fonttype = 'opentype'
    else filename = kpse.find_file(name, "truetype fonts")
    end
    if filename and not fonttype then fonttype = 'truetype' end
    if fonttype then
      if (size < 0) then size = (- 655.36) * size end
      ttffont = fontforge.to_table(fontforge.open(filename))
      if ttffont then
        f = { }
        f.name = ttffont.fontname
        f.fullname = ttffont.names[1].names.fullname
        f.parameters = { }
        f.designsize = size
        f.size = size
        direction = 0
        f.parameters.slant = 0
        f.parameters.space = size * 0.25
        f.parameters.space_stretch = 0.3 * size
        f.parameters.space_shrink = 0.1 * size
        f.parameters.x_height = 0.4 * size
        f.parameters.quad = 1.0 * size
        f.parameters.extra_space = 0
        f.characters = { }
        local mag = size / ttffont.units_per_em

         names_of_char = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_char[ttffont.glyphs[glyph].name]
            = ttffont.map.backmap[glyph]
        end

        names_of_glyph = { }
        for char, glyph in pairs(ttffont.map.map)
        do
          names_of_glyph[ttffont.glyphs[glyph].name]
            = glyph
        end

       for char, glyph in pairs(ttffont.map.map)
        do
          glyph_table = ttffont.glyphs[glyph]

          f.characters[char] = {
            index = glyph,
            width = glyph_table.width * mag,
            name = glyph_table.name,
          }
          if glyph_table.boundingbox[4] then
            f.characters[char].height = glyph_table.boundingbox[4] * mag
          end
          if glyph_table.boundingbox[2] then
            f.characters[char].depth = -glyph_table.boundingbox[2] * mag
          end

          if glyph_table.kerns then
            local kerns = { }
            for _, kern in pairs(glyph_table.kerns)
            do
              kerns[names_of_char[kern.char]] = kern.off * mag
            end
          f.characters[char].kerns = kerns
          end
        end
        f.filename = filename
        f.type = 'real'
        f.format = fonttype
        f.embedding = "subset"
        f.cidinfo = {
          registry = "Adobe",
          ordering = "Identity",
          supplement = 0,
          version = 1
        }
      end
    else
      f = font.read_tfm(name, size)
    end
  return f
  end
)
}

\pagedir TRT \bodydir TRT \textdir TRT \pardir TRT
\font\test="IranNastaliq.ttf" at 12pt
\begin{document}
\test
??? ?? ?????? ???.
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- 
VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/577d25d9/attachment.html 

From yuleopen at gmail.com  Sun Feb  8 15:59:04 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Sun, 8 Feb 2009 22:59:04 +0800
Subject: [luatex] pdfluatex bug
In-Reply-To: <ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
	<68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>
	<ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>
Message-ID: <68bfdc900902080659w561cf5eey97606a2a90b26fab@mail.gmail.com>

Please upgrade to 0.3x.x and see if that will happen again.

On Sun, Feb 8, 2009 at 10:22 PM, ??? ????? <vafakh9 at gmail.com> wrote:
> No, I am using the one in TL08
>

From vafakh9 at gmail.com  Sun Feb  8 16:00:25 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 02:00:25 +1100
Subject: [luatex] pdfluatex bug
In-Reply-To: <68bfdc900902080659w561cf5eey97606a2a90b26fab@mail.gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
	<68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>
	<ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>
	<68bfdc900902080659w561cf5eey97606a2a90b26fab@mail.gmail.com>
Message-ID: <ba1882870902080700p147272b5k97a45832d22f26b6@mail.gmail.com>

Is compiling the source the only way to get the latest beta?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/acfad5d7/attachment.html 

From schuster.wolfgang at googlemail.com  Sun Feb  8 16:10:09 2009
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sun, 08 Feb 2009 16:10:09 +0100
Subject: [luatex] pdfluatex bug
In-Reply-To: <ba1882870902080700p147272b5k97a45832d22f26b6@mail.gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>	<68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>	<ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>	<68bfdc900902080659w561cf5eey97606a2a90b26fab@mail.gmail.com>
	<ba1882870902080700p147272b5k97a45832d22f26b6@mail.gmail.com>
Message-ID: <498EF5D1.8060803@gmail.com>

??? ????? schrieb:

> Is compiling the source the only way to get the latest beta?

You can get binaries from the LuaTeX site or the ConTeXt minimals.

[1] http://foundry.supelec.fr/projects/luatex
[2] http://wiki.contextgarden.net/Running_Mark_IV#Updating_ConTeXt

Wolfgang

From vafakh9 at gmail.com  Sun Feb  8 16:22:23 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 02:22:23 +1100
Subject: [luatex] pdfluatex bug
In-Reply-To: <498EF5D1.8060803@gmail.com>
References: <ba1882870902080529v494451abpfe4801809653e027@mail.gmail.com>
	<68bfdc900902080621g7266c097u7c319055b645aea3@mail.gmail.com>
	<ba1882870902080622w6c07d293x36db5e58d239355@mail.gmail.com>
	<68bfdc900902080659w561cf5eey97606a2a90b26fab@mail.gmail.com>
	<ba1882870902080700p147272b5k97a45832d22f26b6@mail.gmail.com>
	<498EF5D1.8060803@gmail.com>
Message-ID: <ba1882870902080722h60a443a0s62262180ecea811f@mail.gmail.com>

Works fine.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/93104cdb/attachment-0001.html 

From yannis.haralambous at telecom-bretagne.eu  Sun Feb  8 16:44:34 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 8 Feb 2009 16:44:34 +0100
Subject: [luatex] Arabic alphabets are not connected
In-Reply-To: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>
References: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>
Message-ID: <F9D33F1C-6993-4F03-87A2-58A5AA8B3AC1@telecom-bretagne.eu>

at what moment are you doing contextual analysis? Without contextual  
analysis everything will be in isolated form...

Le 8 f?vr. 09 ? 15:35, ??? ????? a ?crit :

> I use the following test file but Arabic alphabets are not  
> connected. Do you know what should I do?
>
> %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
> \documentclass[a4paper,12pt]{article}
> \pdfoutput1
> \directlua0{
> callback.register('define_font',
>   function(name, size)
>     fonttype = nil
>     filename = kpse.find_file(name,"opentype fonts")
>     if (filename)
>     then fonttype = 'opentype'
>     else filename = kpse.find_file(name, "truetype fonts")
>     end
>     if filename and not fonttype then fonttype = 'truetype' end
>     if fonttype then
>       if (size < 0) then size = (- 655.36) * size end
>       ttffont = fontforge.to_table(fontforge.open(filename))
>       if ttffont then
>         f = { }
>         f.name = ttffont.fontname
>         f.fullname = ttffont.names[1].names.fullname
>         f.parameters = { }
>         f.designsize = size
>         f.size = size
>         direction = 0
>         f.parameters.slant = 0
>         f.parameters.space = size * 0.25
>         f.parameters.space_stretch = 0.3 * size
>         f.parameters.space_shrink = 0.1 * size
>         f.parameters.x_height = 0.4 * size
>         f.parameters.quad = 1.0 * size
>         f.parameters.extra_space = 0
>         f.characters = { }
>         local mag = size / ttffont.units_per_em
>
>          names_of_char = { }
>         for char, glyph in pairs(ttffont.map.map)
>         do
>           names_of_char[ttffont.glyphs[glyph].name]
>             = ttffont.map.backmap[glyph]
>         end
>
>         names_of_glyph = { }
>         for char, glyph in pairs(ttffont.map.map)
>         do
>           names_of_glyph[ttffont.glyphs[glyph].name]
>             = glyph
>         end
>
>        for char, glyph in pairs(ttffont.map.map)
>         do
>           glyph_table = ttffont.glyphs[glyph]
>
>           f.characters[char] = {
>             index = glyph,
>             width = glyph_table.width * mag,
>             name = glyph_table.name,
>           }
>           if glyph_table.boundingbox[4] then
>             f.characters[char].height = glyph_table.boundingbox[4] *  
> mag
>           end
>           if glyph_table.boundingbox[2] then
>             f.characters[char].depth = -glyph_table.boundingbox[2] *  
> mag
>           end
>
>           if glyph_table.kerns then
>             local kerns = { }
>             for _, kern in pairs(glyph_table.kerns)
>             do
>               kerns[names_of_char[kern.char]] = kern.off * mag
>             end
>           f.characters[char].kerns = kerns
>           end
>         end
>         f.filename = filename
>         f.type = 'real'
>         f.format = fonttype
>         f.embedding = "subset"
>         f.cidinfo = {
>           registry = "Adobe",
>           ordering = "Identity",
>           supplement = 0,
>           version = 1
>         }
>       end
>     else
>       f = font.read_tfm(name, size)
>     end
>   return f
>   end
> )
> }
>
> \pagedir TRT \bodydir TRT \textdir TRT \pardir TRT
> \font\test="IranNastaliq.ttf" at 12pt
> \begin{document}
> \test
> ??? ?? ?????? ???.
> \end{document}
> %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
> %%%%%%%%%%%%%%%%%%%%%%%%%%%
> -- 
> VK

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090208/8f7c5d06/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090208/8f7c5d06/attachment.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090208/8f7c5d06/attachment-0001.html 

From vafakh9 at gmail.com  Sun Feb  8 16:50:38 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 02:50:38 +1100
Subject: [luatex] Arabic alphabets are not connected
In-Reply-To: <F9D33F1C-6993-4F03-87A2-58A5AA8B3AC1@telecom-bretagne.eu>
References: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>
	<F9D33F1C-6993-4F03-87A2-58A5AA8B3AC1@telecom-bretagne.eu>
Message-ID: <ba1882870902080750h37d98530q69a0fbe9ffa82c0f@mail.gmail.com>

Is there a sample code that I can study?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/95919ce7/attachment.html 

From yharalambous at me.com  Sun Feb  8 17:00:01 2009
From: yharalambous at me.com (Yannis Haralambous)
Date: Sun, 08 Feb 2009 17:00:01 +0100
Subject: [luatex] Arabic alphabets are not connected
In-Reply-To: <ba1882870902080750h37d98530q69a0fbe9ffa82c0f@mail.gmail.com>
References: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>
	<F9D33F1C-6993-4F03-87A2-58A5AA8B3AC1@telecom-bretagne.eu>
	<ba1882870902080750h37d98530q69a0fbe9ffa82c0f@mail.gmail.com>
Message-ID: <E1053D44-2EDB-4A75-87C8-0F4BA139E89A@me.com>

Le 8 f?vr. 09 ? 16:50, ??? ????? a ?crit :

> Is there a sample code that I can study?

Here is an OTP file I wrote in 1994. It works in the following way: it  
takes input coded in Unicode and translates codepoints depending on  
the form:

initial form is translated by DC00
medial form is translated by DE00
final form is translated by E000
isolated form is translated by DA00

short vowels (called ACCENT in the file) are translated by DA00
short vowels + shadda are translated by DA90

The lam-alif and alif-lam-lam-hah ligatures are treated in a different  
OTP.


%%% ====================================================================
%%%  @OmegaTranslationProcess-file{
%%%     author          = "Yannis Haralambous",
%%%     version         = "1.0",
%%%     date            = "16/07/94"
%%%     time            = "9:53:26 MET"
%%%     filename        = "UnicodeToContUnicode.otp",
%%%     address         = "187, rue Nationale,
%%%                        59800 Lille, France"
%%%     telephone       = "",
%%%     FAX             = "+33 20402864",
%%%     checksum        = "",
%%%     email           = "Yannis.Haralambous at univ-lille1.fr",
%%%     codetable       = "ISO/ASCII",
%%%     keywords        = "",
%%%     supported       = "yes",
%%%     docstring       = "This file is part of the public domain
%%%                        Arabic-script Omega system.
%%%                        Omega is a TeX extension (C) John Plaice
%%%                        and Yannis Haralambous, 1994"
%%%  }
%%% ====================================================================
input: 2;
output: 2;

states: MEDIAL,NUMERAL;

aliases:

SHADDA		= (@"FFFF); % was 0651
UNIFORM		  = (@"0621 | @"0674 | @"066E | @"066F | @"06EF | @"063F);
SPECIAL           = (@"FDF2-@"FDF4) ;
BIFORM		  = (@"0605 | @"0606 | @"0613 | @"0622-@"0625 | @"0627 |  
@"0629 | @"062F-@"0632 | @"0648 |
		     @"065D | @"065E |
		     @"0671-@"0673 | @"0675-@"0677 | @"0688-@"069A |
		     @"06BA | @"06C0-@"06CB | @"06CD | @"06D2 | @"06D3 |
		     @"06FF | @"0710 | @"0715-@"0719 | @"071E | @"0724 |
		     @"0728 | @"072A | @"072C | @"072F | @"0750);
QUADRIFORM	  = (@"0600-@"0604 | @"0607-@"060B | @"060C-@"0612 | @"0616 |
			 @"0626 | @"0628 | @"062A-@"062E | @"0633-@"063A |
		     @"0640-@"0647 |
		     @"0649 | @"064A |
%%%		     @"0655-@"0657 | @"065B | @"065C |
              @"0659 |
		     @"0678-@"0687 | @"069A-@"06B7 |
		     @"06BB-@"06BF | @"06CC | @"06CE | @"06D0 | @"06D1 |
		     @"06FE | @"0712-@"0714 | @"071A-@"071D | @"071F-@"0723 |
		     @"0725-@"0727 | @"0729 | @"072B | @"0751-@"0757);
ACCENT		  = (@"064B-@"0658 | @"0670 | @"0711 | @"0730-@"074F);
ARABIC_LETTER	  = ({BIFORM} | {QUADRIFORM});
NOT_ARABIC_LETTER = ^(@"0600-@"060B | @"060D-@"0613 | @"0616 | @"0621- 
@"065F | @"0670-@"06D3 | @"0710-@"075F);
NOT_ARABIC_OR_UNI = ({NOT_ARABIC_LETTER}|{UNIFORM});
ARABIC_NUMBER	  = (@"0030-@"0039 | @"0660-@"0669 | @"06F0-@"06F9);
NOT_ARABIC_NUMBER = ^(@"0030-@"0039 | @"0660-@"0669 | @"06F0-@"06F9);
LAM_LIKE = (@"0644 | @"06B5-@"06B7 | @"06FE);
ALIF_LIKE = (@"0622|@"0623|@"0625|@"0627|@"0671-@"0673);

expressions:

{UNIFORM}{SHADDA}{ACCENT}
	=> #(\1 + @"DA00) #(\3 + @"DA90)
	;
{UNIFORM}{ACCENT}
	=> #(\1 + @"DA00) #(\2 + @"DA00)
	;
{UNIFORM}
	=> #(\1 + @"DA00)
	;
{SPECIAL}{SHADDA}{ACCENT}
	=> \1 #(\3 + @"DA90)
	;
{SPECIAL}{ACCENT}
	=> \1 #(\2 + @"DA00)
	;
{SPECIAL}
	=> \1
	;
<NUMERAL>{ARABIC_NUMBER} end:
	=> #(\1) "\endL{}"
	<pop:>
	;
<NUMERAL>{ARABIC_NUMBER}
	=> #(\1)
	;
<NUMERAL>(@"002B|@"002D|@"002E|@"066B|@"066C){ARABIC_NUMBER} end:
	=> #(\1) #(\2) "\endL{}"
	<pop:>
	;
<NUMERAL>(@"002B|@"002D|@"002E|@"066B|@"066C){ARABIC_NUMBER}
	=> #(\1) #(\2)
	;
<NUMERAL>{NOT_ARABIC_NUMBER}
	=> "\endL{}"
	<= #(\1)
	<pop:>
	;
(@"002B|@"002D|@"002E){ARABIC_NUMBER} end:
	=> "\beginL{}" #(\1) #(\2) "\endL{}"
	;
(@"002B|@"002D|@"002E){ARABIC_NUMBER}
	=> "\beginL{}" #(\1) #(\2)
	<push: NUMERAL>
	;
{ARABIC_NUMBER} end:
	=> #(\1)
	;
{ARABIC_NUMBER}
	=> "\beginL{}" #(\1)
	<push: NUMERAL>
	;
{ACCENT}
	=> #(\1 + @"DA00)
	;
{NOT_ARABIC_LETTER}
	=> #(\1)
	;
{QUADRIFORM}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"DA00) <= \2
	;
{QUADRIFORM} end:
	=> #(\1 + @"DA00)
	;
{QUADRIFORM}{SHADDA}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"DA00) #(\3 + @"DA90)
	<= #(\4)
	;
{QUADRIFORM}{ACCENT}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"DA00) #(\2 + @"DA00) #(\3 + @"DA00)
	<= #(\4)
	;
{QUADRIFORM}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"DA00) #(\2 + @"DA00)
	<= #(\3)
	;
{QUADRIFORM}{SHADDA}{ACCENT} end:
	=> #(\1 + @"DA00) #(\3 + @"DA90)
	;
{QUADRIFORM}{ACCENT}{ACCENT} end:
	=> #(\1 + @"DA00) #(\2 + @"DA00) #(\3 + @"DA00)
	;
{QUADRIFORM}{ACCENT} end:
	=> #(\1 + @"DA00) #(\2 + @"DA00)
	;
	
% @"0620 is our internal keshideh (not Unicode keshideh which is @"0640)

{QUADRIFORM}{SHADDA}{ACCENT}
	=> #(\1 + @"DC00) #(\3 + @"DA90) @"0620
	<push: MEDIAL>
	;
{QUADRIFORM}{ACCENT}{ACCENT}
	=> #(\1 + @"DC00) #(\2 + @"DA00) #(\3 + @"DA00) @"0620
	<push: MEDIAL>
	;
{QUADRIFORM}{ACCENT}
	=> #(\1 + @"DC00) #(\2 + @"DA00) @"0620
	<push: MEDIAL>
	;
{QUADRIFORM}
	=> #(\1 + @"DC00) @"0620
	<push: MEDIAL>
	;
{BIFORM}{SHADDA}{ACCENT}
	=> #(\1 + @"DA00) #(\3 + @"DA90)
	;
{BIFORM}{ACCENT}{ACCENT}
	=> #(\1 + @"DA00) #(\2 + @"DA00) #(\3 + @"DA00)
	;
{BIFORM}{ACCENT}
	=> #(\1 + @"DA00) #(\2 + @"DA00)
	;
{BIFORM}
	=> #(\1 + @"DA00)
	;
<MEDIAL>{QUADRIFORM}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"E000)
	<= #(\2)
	<pop:>
	;
<MEDIAL>{QUADRIFORM} end:
	=> #(\1 + @"E000)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{SHADDA}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"E000) #(\3 + @"DA90)
	<= #(\4)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{ACCENT}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"E000) #(\2 + @"DA00) #(\3 + @"DA00)
	<= #(\4)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{ACCENT}{NOT_ARABIC_OR_UNI}
	=> #(\1 + @"E000) #(\2 + @"DA00)
	<= #(\3)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{SHADDA}{ACCENT} end:
	=> #(\1 + @"E000) #(\3 + @"DA90)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{ACCENT}{ACCENT} end:
	=> #(\1 + @"E000) #(\2 + @"DA00) #(\3 + @"DA00)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{ACCENT} end:
	=> #(\1 + @"E000) #(\2 + @"DA00)
	<pop:>
	;
<MEDIAL>{QUADRIFORM}{SHADDA}{ACCENT}
	=> #(\1 + @"DE00) #(\3 + @"DA90) @"0620
	;
<MEDIAL>{QUADRIFORM}{ACCENT}{ACCENT}
	=> #(\1 + @"DE00) #(\2 + @"DA00) #(\3 + @"DA00) @"0620
	;
<MEDIAL>{QUADRIFORM}{ACCENT}
	=> #(\1 + @"DE00) #(\2 + @"DA00) @"0620
	;
<MEDIAL>{QUADRIFORM}
	=> #(\1 + @"DE00) @"0620
	;
<MEDIAL>{BIFORM}{SHADDA}{ACCENT}
	=> #(\1 + @"E000) #(\3 + @"DA90)
	<pop:>
	;
<MEDIAL>{BIFORM}{ACCENT}{ACCENT}
	=> #(\1 + @"E000) #(\2 + @"DA00) #(\3 + @"DA00)
	<pop:>
	;
<MEDIAL>{BIFORM}{ACCENT}
	=> #(\1 + @"E000) #(\2 + @"DA00)
	<pop:>
	;
<MEDIAL>{BIFORM}
	=> #(\1 + @"E000)
	<pop:>
	;
	
@"F000-@"F07F => \1 ;


From vafakh9 at gmail.com  Sun Feb  8 23:40:24 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Mon, 9 Feb 2009 09:40:24 +1100
Subject: [luatex] Arabic alphabets are not connected
In-Reply-To: <E1053D44-2EDB-4A75-87C8-0F4BA139E89A@me.com>
References: <ba1882870902080635s38183bf6ia30e8a948f45061@mail.gmail.com>
	<F9D33F1C-6993-4F03-87A2-58A5AA8B3AC1@telecom-bretagne.eu>
	<ba1882870902080750h37d98530q69a0fbe9ffa82c0f@mail.gmail.com>
	<E1053D44-2EDB-4A75-87C8-0F4BA139E89A@me.com>
Message-ID: <ba1882870902081440u4c0bbe91oc56acdd83b9282a@mail.gmail.com>

Thanks a lot for this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090209/44385c45/attachment.html 

From elie.roux at telecom-bretagne.eu  Mon Feb  9 10:07:42 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Feb 2009 10:07:42 +0100
Subject: [luatex] plain LuaTeX
Message-ID: <498FF25E.5000903@telecom-bretagne.eu>

Hello,

I have some discussions with Karl Berry, and we are confronted with an 
important issue:

Some additional macros are needed (or at least really logical to add) 
for plain, like (basically) \newattribute. The best thing (in my 
opinion) would be to put them in Plain, so that when the user calls 
'luatex', these  macros are loaded, like the pdftex and etex macros. Do 
some people oppose this?

Thanks,
-- 
Elie

From Robin.Fairbairns at cl.cam.ac.uk  Mon Feb  9 11:16:44 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 09 Feb 2009 10:16:44 +0000
Subject: [luatex] plain LuaTeX
Message-ID: <27519.1234174604@hehe.cl.cam.ac.uk>

Elie Roux <elie.roux at telecom-bretagne.eu> wrote:

> I have some discussions with Karl Berry, and we are confronted with an
> important issue:
> 
> Some additional macros are needed (or at least really logical to add)
> for plain, like (basically) \newattribute. The best thing (in my
> opinion) would be to put them in Plain, so that when the user calls
> 'luatex', these  macros are loaded, like the pdftex and etex
> macros. Do some people oppose this?

you can't "put <x> in plain" -- plain is under knuth's licence, and if
you add to it/otherwise change it, you change the name.

so you build a new format for "plain" luatex, the source of which loads
plain.tex and then does its own thing.

this is the way pdftex and xetex deal with the matter; for example,
pdftex.ini is

  \input pdftexconfig.tex
  \input plain
  \dump
  \endinput

robin

From elie.roux at telecom-bretagne.eu  Mon Feb  9 11:25:54 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Feb 2009 11:25:54 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <27519.1234174604@hehe.cl.cam.ac.uk>
References: <27519.1234174604@hehe.cl.cam.ac.uk>
Message-ID: <499004B2.1000708@telecom-bretagne.eu>

Robin Fairbairns a ?crit :
> you can't "put <x> in plain" -- plain is under knuth's licence, and if
> you add to it/otherwise change it, you change the name.
>
> so you build a new format for "plain" luatex, the source of which loads
> plain.tex and then does its own thing.
>
> this is the way pdftex and xetex deal with the matter; for example,
> pdftex.ini is
>
>   \input pdftexconfig.tex
>   \input plain
>   \dump
>   \endinput
>   

Ok, sorry for my wrong vocabulary... the question with the good words 
would be (I think) to know if someone opposes the fact that luatex.ini 
gets \input luatexconfig.tex added in it, with luatexconfig being 
additional macros like \newattribute.
-- 
Elie

From Robin.Fairbairns at cl.cam.ac.uk  Mon Feb  9 11:31:33 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 09 Feb 2009 10:31:33 +0000
Subject: [luatex] plain LuaTeX
Message-ID: <27651.1234175493@hehe.cl.cam.ac.uk>

Elie Roux <elie.roux at telecom-bretagne.eu> wrote:

> Robin Fairbairns a ?crit :
> > you can't "put <x> in plain" -- plain is under knuth's licence, and if
> > you add to it/otherwise change it, you change the name.
> > [...]
> 
> Ok, sorry for my wrong vocabulary... the question with the good words
> would be (I think) to know if someone opposes the fact that luatex.ini
> gets \input luatexconfig.tex added in it, with luatexconfig being
> additional macros like \newattribute.

i don't believe anyone could object to that...  ;-)

robin

From pragma at wxs.nl  Mon Feb  9 12:58:53 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 09 Feb 2009 12:58:53 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <499004B2.1000708@telecom-bretagne.eu>
References: <27519.1234174604@hehe.cl.cam.ac.uk>
	<499004B2.1000708@telecom-bretagne.eu>
Message-ID: <49901A7D.8040805@wxs.nl>

Elie Roux wrote:
> Robin Fairbairns a ?crit :
>> you can't "put <x> in plain" -- plain is under knuth's licence, and if
>> you add to it/otherwise change it, you change the name.
>>
>> so you build a new format for "plain" luatex, the source of which loads
>> plain.tex and then does its own thing.
>>
>> this is the way pdftex and xetex deal with the matter; for example,
>> pdftex.ini is
>>
>>   \input pdftexconfig.tex
>>   \input plain
>>   \dump
>>   \endinput
>>   
> 
> Ok, sorry for my wrong vocabulary... the question with the good words 
> would be (I think) to know if someone opposes the fact that luatex.ini 
> gets \input luatexconfig.tex added in it, with luatexconfig being 
> additional macros like \newattribute.

the problem with extending plain is that in order to let it stay plain 
one cannot mess around too much with redefining

\newcount\attdefcounter

\def\newattribute#1%
   {\global\advance\attdefcounter\plusone
    \global\attributedef#1\attdefcounter}

is probably the best solution as we cannot use the regular allocation 
infra structure without breaking expectations about behaviour of the 
first 20 counters etc

there are a few more issues, like using > 256 registers and using 
chardef instead of mathchardef in for instance box allocation

i can cook up a new allocation set if needed (some trickery is needed to 
get around the inserts and so)

on the other hand, plain users probably never exceed the 256 limits 
simply because the plain spec says so

Hans




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From Robin.Fairbairns at cl.cam.ac.uk  Mon Feb  9 16:04:32 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 09 Feb 2009 15:04:32 +0000
Subject: [luatex] plain LuaTeX
In-Reply-To: Your message of Mon, 09 Feb 2009 12:58:53 +0100.
	<49901A7D.8040805@wxs.nl> 
Message-ID: <2649.1234191872@hehe.cl.cam.ac.uk>

Hans Hagen <pragma at wxs.nl> wrote:

> [...]
> the problem with extending plain is that in order to let it stay plain
> one cannot mess around too much with redefining

indeed.

> \newcount\attdefcounter
> 
> \def\newattribute#1%
>   {\global\advance\attdefcounter\plusone
>    \global\attributedef#1\attdefcounter}
> 
> is probably the best solution as we cannot use the regular allocation
> infra structure without breaking expectations about behaviour of the
> first 20 counters etc
> 
> there are a few more issues, like using > 256 registers and using
> chardef instead of mathchardef in for instance box allocation
> 
> i can cook up a new allocation set if needed (some trickery is needed
> to get around the inserts and so)
> 
> on the other hand, plain users probably never exceed the 256 limits
> simply because the plain spec says so

pragmatically speaking (and who better to respond to, pragmatically ;-))
i would suggest that *even if* we imagined plain tex users to be
champing at the bit for new facilities, they're surely not likely to be
willing to accept such fundamentals from other people?

so i'd say, go for hans's "simple" version, above.

robin

From elie.roux at telecom-bretagne.eu  Mon Feb  9 16:08:44 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 09 Feb 2009 16:08:44 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <49901A7D.8040805@wxs.nl>
References: <27519.1234174604@hehe.cl.cam.ac.uk>	<499004B2.1000708@telecom-bretagne.eu>
	<49901A7D.8040805@wxs.nl>
Message-ID: <499046FC.1030400@telecom-bretagne.eu>

Hans Hagen a ?crit :
> i can cook up a new allocation set if needed (some trickery is needed 
> to get around the inserts and so)

This would be very interesting, if you have time please do so!
-- 
Elie

From oberdiek at uni-freiburg.de  Mon Feb  9 21:38:44 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Mon, 9 Feb 2009 21:38:44 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <499004B2.1000708@telecom-bretagne.eu>
References: <27519.1234174604@hehe.cl.cam.ac.uk>
	<499004B2.1000708@telecom-bretagne.eu>
Message-ID: <20090209203844.GA3469@irwin.vpn.uni-freiburg.de>

On Mon, Feb 09, 2009 at 11:25:54AM +0100, Elie Roux wrote:

> Robin Fairbairns a ?crit :
> >you can't "put <x> in plain" -- plain is under knuth's licence, and if
> >you add to it/otherwise change it, you change the name.
> >
> >so you build a new format for "plain" luatex, the source of which loads
> >plain.tex and then does its own thing.
> >
> >this is the way pdftex and xetex deal with the matter; for example,
> >pdftex.ini is
> >
> >  \input pdftexconfig.tex
> >  \input plain
> >  \dump
> >  \endinput
> >  
> 
> Ok, sorry for my wrong vocabulary... the question with the good words 
> would be (I think) to know if someone opposes the fact that luatex.ini 
> gets \input luatexconfig.tex added in it, with luatexconfig being 
> additional macros like \newattribute.

BTW, luatex.sty also supports plain-TeX and adds \newattribute.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From vafakh9 at gmail.com  Tue Feb 10 11:08:20 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Tue, 10 Feb 2009 21:08:20 +1100
Subject: [luatex] plain LuaTeX
In-Reply-To: <2649.1234191872@hehe.cl.cam.ac.uk>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
Message-ID: <ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>

On Tue, Feb 10, 2009 at 2:04 AM, Robin Fairbairns <
Robin.Fairbairns at cl.cam.ac.uk> wrote:

>
> pragmatically speaking (and who better to respond to, pragmatically ;-))
> i would suggest that *even if* we imagined plain tex users to be
> champing at the bit for new facilities, they're surely not likely to be
> willing to accept such fundamentals from other people?
>
>
Exactly. As a long time Plain TeX user, I only will accept changes from
Knuth not others and so other Plain TeX users.



-- 
VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090210/e5779e51/attachment.html 

From elie.roux at telecom-bretagne.eu  Tue Feb 10 11:21:09 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Feb 2009 11:21:09 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
Message-ID: <49915515.4010803@telecom-bretagne.eu>

??? ????? a ?crit :
> Exactly. As a long time Plain TeX user, I only will accept changes 
> from Knuth not others and so other Plain TeX users.

I'm not talking about modifications, but extension when you call 
'luatex' or 'pdfluatex'. LuaTeX needs some low-level macros like 
\newattribute, or multiple callbacks in order to work normally. It's not 
adding new features for the fun, it's adding low-level macros that will 
be used by users, like \newskip, etc.
-- 
Elie

From vafakh9 at gmail.com  Tue Feb 10 11:33:16 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Tue, 10 Feb 2009 21:33:16 +1100
Subject: [luatex] plain LuaTeX
In-Reply-To: <49915515.4010803@telecom-bretagne.eu>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
	<49915515.4010803@telecom-bretagne.eu>
Message-ID: <ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>

Why do not you guys contact Knuth? and ask him to do that. He may be
interested to do that and if he does that, then every single Plain TeX user
will be accepting such low level macros.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090210/57f787ed/attachment.html 

From yannis.haralambous at telecom-bretagne.eu  Tue Feb 10 11:35:29 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Tue, 10 Feb 2009 11:35:29 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
	<49915515.4010803@telecom-bretagne.eu>
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
Message-ID: <FDE2035C-EAA0-4FAC-8BC0-4FDA8569CEE7@telecom-bretagne.eu>

Ever since 1990 Don is only fixing bugs, releasing a new version once  
a year.

Le 10 f?vr. 09 ? 11:33, ??? ????? a ?crit :

> Why do not you guys contact Knuth? and ask him to do that. He may be  
> interested to do that and if he does that, then every single Plain  
> TeX user will be accepting such low level macros.

--
+ 
-----------------------------------------------------------------------+
| Yannis Haralambous, Ph.D.      yannis.haralambous at telecom- 
bretagne.eu |
| Directeur d'?tudes                      http://omega.enstb.org/ 
yannis |
|                                             Tel. +33  
(0)2.29.00.14.27 |
|                                             Fax  +33  
(0)2.29.00.12.82 |
| D?partement  
Informatique                                              |
| T?l?com  
Bretagne                                                      |
| Technop?le de Brest Iroise, CS 83818, 29238 Brest Cedex 3,  
France     |
| Coordonn?es Google-Earth : 48?21'31.57"N  
4?34'16.76"W                 |
+ 
-----------------------------------------------------------------------+
                             ...pour distinguer l'ext?rieur d'un  
aquarium,
                                            mieux vaut n'?tre pas  
poisson

                            ...the ball I threw while playing in the  
park
                                           has not yet reached the  
ground

               Es gab eine Zeit, wo ich nur ungern ?ber Schubert  
sprechen,
            nur N?chtens den B?umen und Sternen von ihm vorerz?hlen  
m?gen.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090210/5b545d69/attachment-0002.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090210/5b545d69/attachment-0001.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090210/5b545d69/attachment-0003.html 

From elie.roux at telecom-bretagne.eu  Tue Feb 10 11:40:43 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Feb 2009 11:40:43 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
References: <49901A7D.8040805@wxs.nl>
	<2649.1234191872@hehe.cl.cam.ac.uk>	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>	<49915515.4010803@telecom-bretagne.eu>
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
Message-ID: <499159AB.2070306@telecom-bretagne.eu>

??? ????? a ?crit :
> Why do not you guys contact Knuth? and ask him to do that. He may be 
> interested to do that and if he does that, then every single Plain TeX 
> user will be accepting such low level macros.

My question would by: why do you accept things like \pdfoutput for 
pdfTeX and reject \newattribute (that should certainly be renamed 
\luanewattribute) for LuaTeX?
-- 
Elie

From vafakh9 at gmail.com  Tue Feb 10 11:44:45 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Tue, 10 Feb 2009 21:44:45 +1100
Subject: [luatex] plain LuaTeX
In-Reply-To: <499159AB.2070306@telecom-bretagne.eu>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
	<49915515.4010803@telecom-bretagne.eu>
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
	<499159AB.2070306@telecom-bretagne.eu>
Message-ID: <ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>

I never use PDFTeX. I only use TeX (the original TeX written by Knuth) for
typesetting my books, articles, papers and etc in English. If I want to
produce any Persian document then mostly use XeTeX and sometimes LuaTeX.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090210/48271e5b/attachment.html 

From elie.roux at telecom-bretagne.eu  Tue Feb 10 11:47:12 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Feb 2009 11:47:12 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>
References: <49901A7D.8040805@wxs.nl>
	<2649.1234191872@hehe.cl.cam.ac.uk>	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>	<49915515.4010803@telecom-bretagne.eu>	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>	<499159AB.2070306@telecom-bretagne.eu>
	<ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>
Message-ID: <49915B30.1020103@telecom-bretagne.eu>

??? ????? a ?crit :
> I never use PDFTeX. I only use TeX (the original TeX written by Knuth) 
> for typesetting my books, articles, papers and etc in English. If I 
> want to produce any Persian document then mostly use XeTeX and 
> sometimes LuaTeX.

Ok, so here is my new question: why do you accept \attributedef and 
reject \newattribute? they are both new things in LuaTeX.
-- 
Elie

From joseph.wright at morningstar2.co.uk  Tue Feb 10 11:57:53 2009
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 10 Feb 2009 10:57:53 +0000
Subject: [luatex] plain LuaTeX
In-Reply-To: <499159AB.2070306@telecom-bretagne.eu>
References: <49901A7D.8040805@wxs.nl>	<2649.1234191872@hehe.cl.cam.ac.uk>	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>	<49915515.4010803@telecom-bretagne.eu>	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
	<499159AB.2070306@telecom-bretagne.eu>
Message-ID: <49915DB1.7070005@morningstar2.co.uk>

Elie Roux wrote:
> My question would by: why do you accept things like \pdfoutput for
> pdfTeX and reject \newattribute (that should certainly be renamed
> \luanewattribute) for LuaTeX?

\pdfoutput is an engine primitive.  So there is no *format* change
needed (in the same way that if I run e-TeX rather than Knuth's TeX I
get \scantokens, etc.).  The point here is that a plain luatex format
will have the new primitves, but no new macros (which only Knuth can
do), surely.
--
Joseph Wright

From Robin.Fairbairns at cl.cam.ac.uk  Tue Feb 10 11:59:30 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 10 Feb 2009 10:59:30 +0000
Subject: [luatex] plain LuaTeX
In-Reply-To: Your message of Tue, 10 Feb 2009 21:33:16 +1100.
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com> 
Message-ID: <5206.1234263570@hehe.cl.cam.ac.uk>

??? ????? <vafakh9 at gmail.com> wrote:

> Why do not you guys contact Knuth? and ask him to do that. He may be
> interested to do that and if he does that, then every single Plain TeX
> user will be accepting such low level macros.

i would be amazed if don was interested; while he does read about
developments, his actual work engine is plain tex running over
un-extended tex.  (this is why distributions have an un-extended tex
image at all -- everything else runs over pdfetex or the like.)

a plain luatex *has* to have non-knuth stuff in it.  if you don't want
to use it, on that basis, you might find it good to give up on luatex,
now.  (i hope you don't, as i have no doubt your expertise will be
helpful to the world at large; but if you decide to go, there's nothing
any of us can, or want to, do.)

my original comment (that you reacted to) was merely to explain that we
can't extend plain tex; we have to have a new package called something
like luaplain, which has plain.tex, un-amended, as a part.

robin

From elie.roux at telecom-bretagne.eu  Tue Feb 10 12:08:31 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Feb 2009 12:08:31 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <5206.1234263570@hehe.cl.cam.ac.uk>
References: <5206.1234263570@hehe.cl.cam.ac.uk>
Message-ID: <4991602F.4010209@telecom-bretagne.eu>

Robin Fairbairns a ?crit :
> a plain luatex *has* to have non-knuth stuff in it.  if you don't want
> to use it, on that basis, you might find it good to give up on luatex,
> now.  (i hope you don't, as i have no doubt your expertise will be
> helpful to the world at large; but if you decide to go, there's nothing
> any of us can, or want to, do.)
>   

I agree. I don't understand at all why people would want to do 
\attributedef\myattribute = 545 and to take the risk that other people 
take the same number instead of \newattribute\myattribute, \newattribute 
is a necessity in a format (or to take another vocabulary, it is 
neccesary to have it when you call 'luatex' on a document).
-- 
Elie

From reinhard.kotucha at web.de  Wed Feb 11 03:38:07 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 11 Feb 2009 03:38:07 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
	<49915515.4010803@telecom-bretagne.eu>
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
	<499159AB.2070306@telecom-bretagne.eu>
	<ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>
Message-ID: <18834.14863.403879.608142@zaphod.ms25.net>

On 10 February 2009 ??? ????? wrote:

 > I never use PDFTeX. I only use TeX (the original TeX written by
 > Knuth) for typesetting my books, articles, papers and etc in
 > English. If I want to produce any Persian document then mostly use
 > XeTeX and sometimes LuaTeX.

If you run tex, i.e. you invoke it as tex on the command line, then
you always get Knuth's TeX.  There are not even other hyphenation
patterns available than those Knuth provided himself.  The only change
that had been made is to adapt the program to the operating system you
are using.  This is encouraged by Knuth and is unavoidable anyway.
Nobody is talking about changing anything else.

 > As a long time Plain TeX user, I only will accept changes from
 > Knuth not others and so other Plain TeX users.

The discussion is about adding extensions to tex engines which had been
extended already.  These are etex, omega, pdftex, xetex, luatex, ...

There is nothing wrong to add more extensions to them.  I suppose the
reason of your concerns is that it is not 100% clear what is meant
with "extending plain".

Well, it's not intended to change the file plain.tex.  The idea is to
add extensions when the format file for luatex is created, for
example:

\input plain
\input extensions
\dump

This has absolutely no effect on Knuth's TeX.  It only adds extensions
to engines which had been extended already.  There is no reason to be
worried.  Nobody intends to change the behavior of Knuth's TeX.

And if you are using xetex or luatex, you already accept that the
extensions had not been made by Knuth himself.  These extensions had
been designed carefully.  If you don't use them, everything behaves as
described in The TeXbook.  Regarding luatex, there are probably two
exceptions: The line breaking algorithm had been revised and the
future of DVI output is unclear ATM because Knuth's DVI format is too
limited.  xetex already uses an extended variant of Knuth's DVI.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From luigi.scarso at gmail.com  Wed Feb 11 09:02:14 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 11 Feb 2009 09:02:14 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <18834.14863.403879.608142@zaphod.ms25.net>
References: <49901A7D.8040805@wxs.nl> <2649.1234191872@hehe.cl.cam.ac.uk>
	<ba1882870902100208u70a1b12bl5c34114f6a6f9839@mail.gmail.com>
	<49915515.4010803@telecom-bretagne.eu>
	<ba1882870902100233n293b57del479b3ddf20bbb143@mail.gmail.com>
	<499159AB.2070306@telecom-bretagne.eu>
	<ba1882870902100244g28664d4cg11aed88c174ff352@mail.gmail.com>
	<18834.14863.403879.608142@zaphod.ms25.net>
Message-ID: <fe8d59da0902110002y3d2e757i85d9196f63095784@mail.gmail.com>

> Well, it's not intended to change the file plain.tex.  The idea is to
> add extensions when the format file for luatex is created, for
> example:
>
> \input plain
> \input extensions
> \dump

well, why not
\input luaplain
\dump
?

-- 
luigi

From rf10 at cl.cam.ac.uk  Wed Feb 11 09:16:44 2009
From: rf10 at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 11 Feb 2009 08:16:44 +0000
Subject: [luatex] plain LuaTeX
In-Reply-To: Your message of Wed, 11 Feb 2009 09:02:14 +0100.
	<fe8d59da0902110002y3d2e757i85d9196f63095784@mail.gmail.com> 
Message-ID: <20136.1234340204@hehe.cl.cam.ac.uk>

luigi scarso <luigi.scarso at gmail.com> wrote:

> > Well, it's not intended to change the file plain.tex.  The idea is to
> > add extensions when the format file for luatex is created, for
> > example:
> >
> > \input plain
> > \input extensions
> > \dump
> 
> well, why not
> \input luaplain
> \dump
> ?

for the same reason we don't have pdfplain.tex and so on: maintenance of
the result.

in the unlikely event that don corrects a bug in plain, each
conglomerate plain package would have to be updated.  with the existing
setup, the correction happens automatically (ctan and packaging updates
happen [almost] automatically).

note that we *have* had a plain correction since pdftex hit the streets,
so the hypothesis isn't entirely fanciful.

robin

From yannis.haralambous at telecom-bretagne.eu  Wed Feb 11 11:57:43 2009
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Wed, 11 Feb 2009 11:57:43 +0100
Subject: [luatex] List on plain/LaTeX problems
Message-ID: <02E93163-F9CA-43C1-BBBB-29AB2FA01725@telecom-bretagne.eu>

Do you know of any discussion list (as reactive as this one) on plain/ 
LaTeX problems? I have a problem with \footins and I don't know whom  
to ask...

thanks in advance

Yannis

From vafakh9 at gmail.com  Wed Feb 11 12:01:27 2009
From: vafakh9 at gmail.com (=?UTF-8?B?2YjZgdinINiu2YTbjNmC24w=?=)
Date: Wed, 11 Feb 2009 22:01:27 +1100
Subject: [luatex] List on plain/LaTeX problems
In-Reply-To: <02E93163-F9CA-43C1-BBBB-29AB2FA01725@telecom-bretagne.eu>
References: <02E93163-F9CA-43C1-BBBB-29AB2FA01725@telecom-bretagne.eu>
Message-ID: <ba1882870902110301s2d6b276aw507243d30d685e22@mail.gmail.com>

http://tug.org/mailman/listinfo/texhax

I only can help with Plain TeX, no LaTeX no ConTeXt.

-- VK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://tug.org/pipermail/luatex/attachments/20090211/8b2e97d4/attachment.html 

From luigi.scarso at gmail.com  Wed Feb 11 12:05:41 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 11 Feb 2009 12:05:41 +0100
Subject: [luatex] plain LuaTeX
In-Reply-To: <20136.1234340204@hehe.cl.cam.ac.uk>
References: <fe8d59da0902110002y3d2e757i85d9196f63095784@mail.gmail.com>
	<20136.1234340204@hehe.cl.cam.ac.uk>
Message-ID: <fe8d59da0902110305i6151dbfbl313c7eec89e8d88d@mail.gmail.com>

>> well, why not
>> \input luaplain
>> \dump
>> ?
>
> for the same reason we don't have pdfplain.tex and so on: maintenance of
> the result.

Yes , I understand this .
The fact is that I see luatex radically different from pdftex, etex,
tex and so on,
so I see luaplain.tex as a sign of discontinuity.

It can be also
\input plain
\input luaextensions
\dump




-- 
luigi

From elie.roux at telecom-bretagne.eu  Thu Feb 12 15:39:12 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 12 Feb 2009 15:39:12 +0100
Subject: [luatex] Segfault and kpse.find_file()
Message-ID: <49943490.1010800@telecom-bretagne.eu>

Hello,

the dev-luatex doesn't seem to work today, so here are two mails I sent:

I found that a problem in the mplib package was to find mpost.mem in 
TeXLive: It cant be found with kpse.find_file(). I can't be found 
neither with "kpsewhich --format mem --must-exist mpost.mem", but in 
TeXLive 2008, it can be found with "kpsewhich --format mem --engine 
metapost mpost.mem". The problem is that I can't pass the "engine" 
option to kpse.find_file(). Is it is possible to add it? I think it will 
benefit more packages than only mplib.

and the other mail :

s kpse.find_file can't get the path of mpost.mem, I made some 
experimentations and got a segmentation fault with texlua (revision 
1858, on debian/sid 32 bit) on the following code:

kpse.set_program_name("toto")

local filename = "/var/lib/texmf/web2c/metapost/mpost.mem"

function finder (name, mode, ftype)
   if mode == "w" then
       return name
   else
       local result = kpse.find_file(name,ftype)
       if not result and name == "mpost.mem" then
          result = filename
       end
       return result
   end
end

local mpx = mplib.new {
   ini_version = false,
   mem_name = "mpost.mem",
   find_file = finder
}

you have to replace filename by the true value of you mpost.mem to get 
the segfault.

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Fri Feb 13 08:53:42 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 13 Feb 2009 08:53:42 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
Message-ID: <fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>

On Mon, Feb 2, 2009 at 8:07 AM, Dohyun Kim <nomosnomos at gmail.com> wrote:
> 2009/2/2 Arthur Reutenauer <arthur.reutenauer at normalesup.org>:
>>> Please visit http://cvs.ktug.or.kr/~nomos/
>>
>>  Some TeX files there use a luatexko.sty package, and a quick search
>> points to
>> http://ftp.ktug.or.kr/KTUG/texlive/texmf-dist/tex/latex/kotex-dev/luatexko/
>> but you need to install quite a lot of fonts which are available at the
>> same location.
>
> I was very surprised to see here links to my humble site
> and informal kotex (Korean TeX) repository, which was
> prepared by KTUG for Korean users of texlive 2008.
>

Sorry for the noise:
I have some error with ghostscript 8.64 under Linux

gs -sDEVICE=pdfwrite -dLastPage=1 -dNOPAUSE -sOutputFile=test_2.pdf
connecting3.pdf -c quit
GPL Ghostscript 8.64 (2009-02-03)
Copyright (C) 2009 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
Processing pages 1 through 1.
Page 1
Error: /typecheck in --run--

No problem with
gs -sDEVICE=x11



-- 
luigi

From nomosnomos at gmail.com  Fri Feb 13 09:25:53 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Fri, 13 Feb 2009 17:25:53 +0900
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
Message-ID: <bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>

2009/2/13 luigi scarso <luigi.scarso at gmail.com>:
> I have some error with ghostscript 8.64 under Linux
>
> gs -sDEVICE=pdfwrite -dLastPage=1 -dNOPAUSE -sOutputFile=test_2.pdf
> connecting3.pdf -c quit
> GPL Ghostscript 8.64 (2009-02-03)
> Copyright (C) 2009 Artifex Software, Inc.  All rights reserved.
> This software comes with NO WARRANTY: see the file PUBLIC for details.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
>   **** Warning: Outline has invalid link that was discarded.
> Processing pages 1 through 1.
> Page 1
> Error: /typecheck in --run--
>

connecting3 is a rather old document made in 2005 and was compiled
with latex and dvipdfmx, not luatex.

Anyway, the same error for me; I have no idea about the cause of error.

Dohyun Kim

From luigi.scarso at gmail.com  Fri Feb 13 10:43:38 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 13 Feb 2009 10:43:38 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
	<bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>
Message-ID: <fe8d59da0902130143v3dea124ib718bc4b95e6ae09@mail.gmail.com>

> connecting3 is a rather old document made in 2005 and was compiled
> with latex and dvipdfmx, not luatex.
maybe a bug of gs.
Are there some pdfs  made with luatex ?


-- 
luigi

From yuleopen at gmail.com  Fri Feb 13 11:28:10 2009
From: yuleopen at gmail.com (Yue Wang)
Date: Fri, 13 Feb 2009 18:28:10 +0800
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <fe8d59da0902130143v3dea124ib718bc4b95e6ae09@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
	<bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>
	<fe8d59da0902130143v3dea124ib718bc4b95e6ae09@mail.gmail.com>
Message-ID: <68bfdc900902130228p79c485b9u1c303f753fb524f6@mail.gmail.com>

Hi, Luigi:

On Fri, Feb 13, 2009 at 5:43 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
>> connecting3 is a rather old document made in 2005 and was compiled
>> with latex and dvipdfmx, not luatex.
> maybe a bug of gs.
> Are there some pdfs  made with luatex ?
>

Should that be made using the LaTeX format?
if not, please visit http://code.google.com/p/way2ctx/downloads/list
for a Chinese document.
It is written by Yanrui Li using ConTeXt MKIV.


Yue Wang

From luigi.scarso at gmail.com  Fri Feb 13 12:31:01 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 13 Feb 2009 12:31:01 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <68bfdc900902130228p79c485b9u1c303f753fb524f6@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
	<bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>
	<fe8d59da0902130143v3dea124ib718bc4b95e6ae09@mail.gmail.com>
	<68bfdc900902130228p79c485b9u1c303f753fb524f6@mail.gmail.com>
Message-ID: <fe8d59da0902130331i14142170x27bbf15f3e24e64@mail.gmail.com>

On Fri, Feb 13, 2009 at 11:28 AM, Yue Wang <yuleopen at gmail.com> wrote:
> Hi, Luigi:
>
> On Fri, Feb 13, 2009 at 5:43 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
>>> connecting3 is a rather old document made in 2005 and was compiled
>>> with latex and dvipdfmx, not luatex.
>> maybe a bug of gs.
>> Are there some pdfs  made with luatex ?
>>
>
> Should that be made using the LaTeX format?
> if not, please visit http://code.google.com/p/way2ctx/downloads/list
> for a Chinese document.
> It is written by Yanrui Li using ConTeXt MKIV.

gs  -sDEVICE=pdfwrite -dLastPage=1 -dNOPAUSE -sOutputFile=test_3.pdf
ctxnotes-obsolete-v2.pdf -c quit


Copyright (C) 2009 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
   **** Warning: Outline has invalid link that was discarded.
Processing pages 1 through 1.
Page 1
   **** This file had errors that were repaired or ignored.
   **** The file was produced by:
   **** >>>> luaTeX-0.30.1 <<<<
   **** Please notify the author of the software that produced this
   **** file that it does not conform to Adobe's published PDF
   **** specification.


GPL Ghostscript 8.64 (2009-02-03)
Copyright (C) 2009 Artifex Software, Inc.  All rights reserved.


Errors with gs 8.63

-- 
luigi

From taco at elvenkind.com  Fri Feb 13 13:41:44 2009
From: taco at elvenkind.com (taco)
Date: Fri, 13 Feb 2009 13:41:44 +0100
Subject: [luatex] Segfault and kpse.find_file()
In-Reply-To: <49943490.1010800@telecom-bretagne.eu>
References: <49943490.1010800@telecom-bretagne.eu>
Message-ID: <49956A88.90906@elvenkind.com>

Elie Roux wrote:
> Hello,
> 
> the dev-luatex doesn't seem to work today, so here are two mails I sent:
> 
> I found that a problem in the mplib package was to find mpost.mem in 
> TeXLive: It cant be found with kpse.find_file(). I can't be found 
> neither with "kpsewhich --format mem --must-exist mpost.mem", but in 
> TeXLive 2008, it can be found with "kpsewhich --format mem --engine 
> metapost mpost.mem". The problem is that I can't pass the "engine" 
> option to kpse.find_file(). Is it is possible to add it? 

If you do

    os.setenv('engine', 'metapost')

before asking for the first file, that should work.

But I agree that is (perhaps more than) a little weird. I will redo the
kpathsea interface next month anyway, and I will definately  keep this
problem in mind.

> and the other mail :
> 
> s kpse.find_file can't get the path of mpost.mem, I made some 
> experimentations and got a segmentation fault with texlua (revision 
> 1858, on debian/sid 32 bit) on the following code:
> ..
> you have to replace filename by the true value of you mpost.mem to get 
> the segfault.

I cannot reproduce this crash (#1861 on linux32). I checked that
it enters the correct branch for my machine to return the literal

  /opt/tex/texmf-linux/web2c/metapost/mpost.mem

Are you sure that that mpost.mem is generated by the same version
of metapost/mplib? (it still *should* not crash, but I can see how
that *could* happen: detecting whether a mem file is valid for the
current executable is harder now then it was before the switch to C)

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Sat Feb 14 18:25:40 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Feb 2009 18:25:40 +0100
Subject: [luatex] lua-inputenc
Message-ID: <4996FE94.6030705@telecom-bretagne.eu>

Hello,

I have written a first version of the inputenc package for LuaTeX 
(http://norgz.guiling.fr/lua-inputenc.zip), it simply registers an 
encoding translation function in the callback process_input_buffer. The 
problem (as pointed out earlier by Arthur) is aux files, as LaTeX writes 
them in a special encoding (LICR), and it totally breaks my code, as 
shown by the example file http://norgz.guiling.fr/test.tex, to compile 
two times with pdfLuaLaTeX to get the wrong encoding. I know LICR is not 
at all a LuaTeX problem, but I'm seeking a solution or some good 
documentation on this, I hope someone on this list will have some...

Thank you in advance,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sat Feb 14 20:25:52 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Feb 2009 20:25:52 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <4996FE94.6030705@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>
Message-ID: <49971AC0.3050603@telecom-bretagne.eu>

Elie Roux a ?crit :
> Hello,
>
> I have written a first version of the inputenc package for LuaTeX 
> (http://norgz.guiling.fr/lua-inputenc.zip), it simply registers an 
> encoding translation function in the callback process_input_buffer. 
> The problem (as pointed out earlier by Arthur) is aux files, as LaTeX 
> writes them in a special encoding (LICR), and it totally breaks my 
> code, as shown by the example file http://norgz.guiling.fr/test.tex, 
> to compile two times with pdfLuaLaTeX to get the wrong encoding. I 
> know LICR is not at all a LuaTeX problem, but I'm seeking a solution 
> or some good documentation on this, I hope someone on this list will 
> have some...

Sorry for this mail, I just haven't tested enough...
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sat Feb 14 22:43:20 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sat, 14 Feb 2009 22:43:20 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49971AC0.3050603@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>
	<49971AC0.3050603@telecom-bretagne.eu>
Message-ID: <49973AF8.2010905@telecom-bretagne.eu>

Elie Roux a ?crit :
> Sorry for this mail, I just haven't tested enough...

So here is something more consistent:

With my package, one can do the same as in XeTeX: reading files written 
in another input encoding, but with the same limitation as XeTeX (tell 
me if I'm wrong): reading all files as if they were written in the same 
encoding... The problem is that output files (like aux files) are all 
written in UTF-8. So for example if we read files in latin1, we will 
read the aux file as if it were in latin1, when it is written in UTF-8, 
so it will make some errors.

The only solution I see is to register a callback in open_read_file, 
that will convert from utf8 to latin1, before input is converted again 
to utf8. This solution seems heavy and not really efficient. So I was 
wondering if there was another way to read the aux file in UTF-8, or 
(even better) a way to write the files in latin1? I think the second 
solution would be better, but there seems to be no corresponding 
callback... Do you think there would be a way to add such a callback?

Thank you in advance,
-- 
Elie

From reinhard.kotucha at web.de  Sun Feb 15 02:46:52 2009
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 15 Feb 2009 02:46:52 +0100
Subject: [luatex] using (pdf)lualatex
In-Reply-To: <fe8d59da0902130331i14142170x27bbf15f3e24e64@mail.gmail.com>
References: <68bfdc900902010150i367541b2o2a4f3c7d467b6e85@mail.gmail.com>
	<20090201171801.GA11997@phare.normalesup.org>
	<bfeb3bf10902012307y573a4c6eyced6eaae713e8899@mail.gmail.com>
	<fe8d59da0902122353x2646de0ck40c564d1d4a7ae72@mail.gmail.com>
	<bfeb3bf10902130025m6daf990es45915d839147bbae@mail.gmail.com>
	<fe8d59da0902130143v3dea124ib718bc4b95e6ae09@mail.gmail.com>
	<68bfdc900902130228p79c485b9u1c303f753fb524f6@mail.gmail.com>
	<fe8d59da0902130331i14142170x27bbf15f3e24e64@mail.gmail.com>
Message-ID: <18839.29708.347257.546522@zaphod.ms25.net>

On 13 February 2009 luigi scarso wrote:

 > On Fri, Feb 13, 2009 at 11:28 AM, Yue Wang <yuleopen at gmail.com> wrote:
 > > Hi, Luigi:
 > >
 > > On Fri, Feb 13, 2009 at 5:43 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
 > >>> connecting3 is a rather old document made in 2005 and was compiled
 > >>> with latex and dvipdfmx, not luatex.
 > >> maybe a bug of gs.
 > >> Are there some pdfs  made with luatex ?
 > >>
 > >
 > > Should that be made using the LaTeX format?
 > > if not, please visit http://code.google.com/p/way2ctx/downloads/list
 > > for a Chinese document.
 > > It is written by Yanrui Li using ConTeXt MKIV.
 > 
 > gs  -sDEVICE=pdfwrite -dLastPage=1 -dNOPAUSE -sOutputFile=test_3.pdf
 > ctxnotes-obsolete-v2.pdf -c quit
 > 
 > 
 > Copyright (C) 2009 Artifex Software, Inc.  All rights reserved.
 > This software comes with NO WARRANTY: see the file PUBLIC for details.
 > [...]   
 >    **** Warning: Outline has invalid link that was discarded.
 >    **** This file had errors that were repaired or ignored.
 >    **** The file was produced by:
 >    **** >>>> luaTeX-0.30.1 <<<<
 >    **** Please notify the author of the software that produced this
 >    **** file that it does not conform to Adobe's published PDF
 >    **** specification.
 
Quite funny.  This is by far the easiest method to solve problems.
Neither acroread nor xpdf is complaining.

I first thought that it has something to do with object stream
compression because the xref table is compressed indeed.  gs-8.15
complains that it doesn't find the xref table at all, and gs-8.63
says:

GPL Ghostscript 8.63 (2008-08-01)
Copyright (C) 2008 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
   **** File has an unbalanced >> (close dictionary).
   **** Incorrect object count in object stream.
Error: /rangecheck in resolveobjectstream

However, I tested the file
______________________
\pdfminorversion=5
\pdfobjcompresslevel=3
good\bye
______________________

with pdftex and pdfluatex and gs-8.63 handles the PDF output
gracefully.  I doubt that it's a LuaTeX problem, though I'm not sure.

As far as I know, Martin has a bunch of pre-flight tools, and it would
be nice to know whether ghostscript is the only program which has
problems.

BTW, pdftk aborts with an error message too.  But the latest version
is from 2004 and obviously doesn't support object stream compression
yet.  It's really a pity because it's a wonderful thing and I'd like
to write some scripts for debugging PDF files based on the
"uncompress" option of pdftk.

Some time ago I also evaluated pdftosrc as an alternative.  What I
still don't understand is that it didn't support object stream
compression while xpdf did.  Don't pdftosrc and pdftex use the same
library for parsing PDF files?  Regarding the xpdf libs, pdftex seems
to be quite up-to-date always, and I would expect that pdftosrc uses
the same libs because I don't see differnt libs from Derek in the TeX
Live build tree.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From wspr81 at gmail.com  Sun Feb 15 07:32:58 2009
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 15 Feb 2009 17:02:58 +1030
Subject: [luatex] lua-inputenc
References: <4996FE94.6030705@telecom-bretagne.eu>
Message-ID: <gn8cuq$cqs$1@ger.gmane.org>

On 2009-02-15 03:55:40 +1030, Elie Roux 
<elie.roux at telecom-bretagne.eu> said:

> I have written a first version of the inputenc package for LuaTeX

What's the relationship between
    latex/exptl/lualatex/lua-inputenc
and
    luatex/latex/lua-inputenc/
?

My spare LaTeX time at the moment is finishing up some things with the 
LaTeX3 code, so I don't have time to work on the XeTeX equivalent; but 
when lua-inputenc starts to stabilise we should start talking on the 
LaTeX-L list about supporting it within inputenc.sty itself.

Cheers,
Will



From listas at tex-tipografia.com  Sun Feb 15 09:09:58 2009
From: listas at tex-tipografia.com (Javier Bezos)
Date: Sun, 15 Feb 2009 09:09:58 +0100
Subject: [luatex] lua-inputenc
References: <4996FE94.6030705@telecom-bretagne.eu> <gn8cuq$cqs$1@ger.gmane.org>
Message-ID: <039EAA89D636475397C2B72062F77218@PC1>

Will,

>> I have written a first version of the inputenc package for LuaTeX
> 
> What's the relationship between
>    latex/exptl/lualatex/lua-inputenc
> and
>    luatex/latex/lua-inputenc/
> ?

That's misleading, because actually it's not the first version.
Since I'm very busy and Elie showed interest in working on it,
I tell the CTAN Team he would become the  maintainer, but it
seems Elie has missed pointing this out...

Javier 

From elie.roux at telecom-bretagne.eu  Sun Feb 15 10:03:26 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 15 Feb 2009 10:03:26 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <gn8cuq$cqs$1@ger.gmane.org>
References: <4996FE94.6030705@telecom-bretagne.eu> <gn8cuq$cqs$1@ger.gmane.org>
Message-ID: <4997DA5E.2090802@telecom-bretagne.eu>

Will Robertson a ?crit :
> What's the relationship between
>    latex/exptl/lualatex/lua-inputenc

A minimal first version by Javier.

>    luatex/latex/lua-inputenc/

My version, I've put it here because it's more ready for production (I 
asked the CTAN where to put such files), I think the first version 
should be deleted...
-- 
Elie

From Robin.Fairbairns at cl.cam.ac.uk  Sun Feb 15 10:55:24 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sun, 15 Feb 2009 09:55:24 +0000
Subject: [luatex] lua-inputenc
In-Reply-To: Your message of Sun, 15 Feb 2009 17:02:58 +1030.
	<gn8cuq$cqs$1@ger.gmane.org> 
Message-ID: <2200.1234691724@hehe.cl.cam.ac.uk>

Will Robertson <wspr81 at gmail.com> wrote:

> What's the relationship between
>    latex/exptl/lualatex/lua-inputenc
> and
>    luatex/latex/lua-inputenc/
> ?

the latex/exptl one is the old version, which we hadn't deleted (pending
propagation of catalogue changes).

> My spare LaTeX time at the moment is finishing up some things with the
> LaTeX3 code, so I don't have time to work on the XeTeX equivalent; but
> when lua-inputenc starts to stabilise we should start talking on the
> LaTeX-L list about supporting it within inputenc.sty itself.

i don't understand how you find the time to do what you, even now.  ;-)

robin

From Robin.Fairbairns at cl.cam.ac.uk  Sun Feb 15 11:10:04 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sun, 15 Feb 2009 10:10:04 +0000
Subject: [luatex] lua-inputenc
In-Reply-To: Your message of Sun, 15 Feb 2009 09:09:58 +0100.
	<039EAA89D636475397C2B72062F77218@PC1> 
Message-ID: <2306.1234692604@hehe.cl.cam.ac.uk>

Javier Bezos <listas at tex-tipografia.com> wrote:

> Will wrote:
> 
> >> I have written a first version of the inputenc package for LuaTeX
> >
> > What's the relationship between
> >    latex/exptl/lualatex/lua-inputenc
> > and
> >    luatex/latex/lua-inputenc/
> > ?
> 
> That's misleading, because actually it's not the first version.

it's the first version elie's written, i guess.

> Since I'm very busy and Elie showed interest in working on it,
> I tell the CTAN Team he would become the  maintainer, but it
> seems Elie has missed pointing this out...

it might have been good if we had added to the upload announcement a
note to the effect that the new version supersedes yours; but i'm the
only ctan maintainer who reads the luatex list, and elie uploaded to
jim's machine (most people do...), and jim didn't spot the issue,
whereas i might have.

the new location was _our_ decision (elie asked us where we should put
the revised package).

as far as the ctan catalogue is concerned, you're listed as an "earlier"
author who's no longer working on the package.

robin

From pragma at wxs.nl  Mon Feb 16 10:09:33 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Feb 2009 18:09:33 +0900
Subject: [luatex] lua-inputenc
In-Reply-To: <49973AF8.2010905@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>
	<49973AF8.2010905@telecom-bretagne.eu>
Message-ID: <49992D4D.7090007@wxs.nl>

Elie Roux wrote:
> Elie Roux a ?crit :
>> Sorry for this mail, I just haven't tested enough...
> 
> So here is something more consistent:
> 
> With my package, one can do the same as in XeTeX: reading files written 
> in another input encoding, but with the same limitation as XeTeX (tell 
> me if I'm wrong): reading all files as if they were written in the same 
> encoding... The problem is that output files (like aux files) are all 
> written in UTF-8. So for example if we read files in latin1, we will 
> read the aux file as if it were in latin1, when it is written in UTF-8, 
> so it will make some errors.
> 
> The only solution I see is to register a callback in open_read_file, 
> that will convert from utf8 to latin1, before input is converted again 
> to utf8. This solution seems heavy and not really efficient. So I was 
> wondering if there was another way to read the aux file in UTF-8, or 
> (even better) a way to write the files in latin1? I think the second 
> solution would be better, but there seems to be no corresponding 
> callback... Do you think there would be a way to add such a callback?

i don't know how latex handles that, but why not just overloading the 
write-to-aux (or whatever) macros, intercept the to-be-written string 
and convert it; it's the only controlled way since changing 'all' writes 
will mess up other things (like files that users write)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb 16 10:19:27 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 10:19:27 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49992D4D.7090007@wxs.nl>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>
	<49992D4D.7090007@wxs.nl>
Message-ID: <49992F9F.8090802@telecom-bretagne.eu>

Hans Hagen a ?crit :
> i don't know how latex handles that, but why not just overloading the 
> write-to-aux (or whatever) macros, intercept the to-be-written string 
> and convert it; it's the only controlled way since changing 'all' 
> writes will mess up other things (like files that users write)

That would be a solution, but I think the most consistent thing would be 
that (in this case), LuaTeX reads and write all its files in the same 
encoding: if a user works in latin1, he will want the files he writes to 
be in latin1 too... Isn't there a way to do so?

Thank you in advance,
-- 
Elie

From pragma at wxs.nl  Mon Feb 16 10:28:13 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Feb 2009 18:28:13 +0900
Subject: [luatex] lua-inputenc
In-Reply-To: <49992F9F.8090802@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>
	<49992F9F.8090802@telecom-bretagne.eu>
Message-ID: <499931AD.9040406@wxs.nl>

Elie Roux wrote:
> Hans Hagen a ?crit :
>> i don't know how latex handles that, but why not just overloading the 
>> write-to-aux (or whatever) macros, intercept the to-be-written string 
>> and convert it; it's the only controlled way since changing 'all' 
>> writes will mess up other things (like files that users write)
> 
> That would be a solution, but I think the most consistent thing would be 
> that (in this case), LuaTeX reads and write all its files in the same 
> encoding: if a user works in latin1, he will want the files he writes to 
> be in latin1 too... Isn't there a way to do so?

no, because in many cases one writes files directly via the lua io 
library; i remember that we considered a callback but decided that it 
would become too messy; there is in tex detailed control over the kin 
dof file that is read (tex files vs font files for instance) but writing 
can be anything.

actually, since you already do something with the input, i suppose that 
you could easilly do it there: you can check if an aux file is opened 
(look at suffix), then set some flag, and treat its data in a special way

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb 16 10:41:29 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 10:41:29 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <499931AD.9040406@wxs.nl>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>	<49992F9F.8090802@telecom-bretagne.eu>
	<499931AD.9040406@wxs.nl>
Message-ID: <499934C9.7000802@telecom-bretagne.eu>

Hans Hagen a ?crit :
> no, because in many cases one writes files directly via the lua io 
> library; i remember that we considered a callback but decided that it 
> would become too messy; there is in tex detailed control over the kin 
> dof file that is read (tex files vs font files for instance) but 
> writing can be anything.

For my particular case, I think a callback would still be justified: if 
I'm writing this package, it's for people who want to process their old 
documents through LuaTeX, if they start to use the lua io library, then 
they should definitely write everything in UTF-8. In the case of 
packages like mine, it would be very useful to be able to process the 
output buffer of TeX... For example a process_tex_output_buffer would be 
good I think...

> actually, since you already do something with the input, i suppose 
> that you could easilly do it there: you can check if an aux file is 
> opened (look at suffix), then set some flag, and treat its data in a 
> special way

The solution I have now is to register a function in the 
process_input_buffer callback, but I don't think I can trigger changes 
in my function (like for example when it reads an aux file), can I? Do I 
have to register functions in the readers callbacks to do so?

Thank you in advance,
-- 
Elie

From pragma at wxs.nl  Mon Feb 16 10:47:50 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Feb 2009 18:47:50 +0900
Subject: [luatex] lua-inputenc
In-Reply-To: <499934C9.7000802@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>	<49992F9F.8090802@telecom-bretagne.eu>	<499931AD.9040406@wxs.nl>
	<499934C9.7000802@telecom-bretagne.eu>
Message-ID: <49993646.9000804@wxs.nl>

Elie Roux wrote:
> Hans Hagen a ?crit :
>> no, because in many cases one writes files directly via the lua io 
>> library; i remember that we considered a callback but decided that it 
>> would become too messy; there is in tex detailed control over the kin 
>> dof file that is read (tex files vs font files for instance) but 
>> writing can be anything.
> 
> For my particular case, I think a callback would still be justified: if 
> I'm writing this package, it's for people who want to process their old 
> documents through LuaTeX, if they start to use the lua io library, then 
> they should definitely write everything in UTF-8. In the case of 
> packages like mine, it would be very useful to be able to process the 
> output buffer of TeX... For example a process_tex_output_buffer would be 
> good I think...

in that case, when some user opens a file for writing, you also need 
ways to turn off that processing which adds another layer of management 
there

>> actually, since you already do something with the input, i suppose 
>> that you could easilly do it there: you can check if an aux file is 
>> opened (look at suffix), then set some flag, and treat its data in a 
>> special way
> 
> The solution I have now is to register a function in the 
> process_input_buffer callback, but I don't think I can trigger changes 
> in my function (like for example when it reads an aux file), can I? Do I 
> have to register functions in the readers callbacks to do so?

in the open_read_file callback you return a reader funtion that reads a 
line of code, so in the case of an aux file, you just return a different 
  reader function (i.e. one that proprocesses your code)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb 16 11:11:19 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 11:11:19 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49993646.9000804@wxs.nl>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>	<49992F9F.8090802@telecom-bretagne.eu>	<499931AD.9040406@wxs.nl>	<499934C9.7000802@telecom-bretagne.eu>
	<49993646.9000804@wxs.nl>
Message-ID: <49993BC7.7090301@telecom-bretagne.eu>

Hans Hagen a ?crit :
> in that case, when some user opens a file for writing, you also need 
> ways to turn off that processing which adds another layer of 
> management there

Ok, I understand.

> in the open_read_file callback you return a reader funtion that reads 
> a line of code, so in the case of an aux file, you just return a 
> different  reader function (i.e. one that proprocesses your code)

Ok, I'll do that then! But why isn't there a open_write_file callback? 
With this callback you wouldn't have to add some management I guess...

Also: how do I control the "input buffer" of the main tex file? I can't 
control it with open_read_file can I? So I still would have to register 
a function in the process_input_buffer and add functions in the 
open_read_files that concert from utf to latin1, before they are 
converted again to utf... I still find this solution ugly... Isn't there 
a better one?

Thank you in advance,
-- 
Elie

From pragma at wxs.nl  Mon Feb 16 11:38:11 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 16 Feb 2009 19:38:11 +0900
Subject: [luatex] lua-inputenc
In-Reply-To: <49993BC7.7090301@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>	<49992F9F.8090802@telecom-bretagne.eu>	<499931AD.9040406@wxs.nl>	<499934C9.7000802@telecom-bretagne.eu>	<49993646.9000804@wxs.nl>
	<49993BC7.7090301@telecom-bretagne.eu>
Message-ID: <49994213.6040500@wxs.nl>

Elie Roux wrote:

> Ok, I'll do that then! But why isn't there a open_write_file callback? 
> With this callback you wouldn't have to add some management I guess...

even then you need management

> Also: how do I control the "input buffer" of the main tex file? I can't 
> control it with open_read_file can I? So I still would have to register 
> a function in the process_input_buffer and add functions in the 
> open_read_files that concert from utf to latin1, before they are 
> converted again to utf... I still find this solution ugly... Isn't there 
> a better one?

rewrite latex

anyhow, normally one writes from lua or from tex:

- open/close in tex, write from tex or lua (texio.write)
- open/close in lua, write from lua

because writes can be direct (\immediate) or defered you always need 
some control over it, so using callbacks is kind of tricky; and after 
all, normally writes (and esp ones to aux files) should be managed by 
the macro package anyway

the more precise control at the read end is due to the fact that in 
todays tex this is also kind of controlled (in the web2c lib) as well as 
that input can come from other sources than the file system

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Mon Feb 16 12:03:38 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 12:03:38 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49994213.6040500@wxs.nl>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<49992D4D.7090007@wxs.nl>	<49992F9F.8090802@telecom-bretagne.eu>	<499931AD.9040406@wxs.nl>	<499934C9.7000802@telecom-bretagne.eu>	<49993646.9000804@wxs.nl>	<49993BC7.7090301@telecom-bretagne.eu>
	<49994213.6040500@wxs.nl>
Message-ID: <4999480A.5010308@telecom-bretagne.eu>

Hans Hagen a ?crit :
> because writes can be direct (\immediate) or defered you always need 
> some control over it, so using callbacks is kind of tricky; and after 
> all, normally writes (and esp ones to aux files) should be managed by 
> the macro package anyway

If I understand correctly, the best solution would be to override \write 
(or at least \write at mainaux)... I'll do that...

Thanks!
-- 
Elie

From news2 at nililand.de  Mon Feb 16 12:27:22 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Mon, 16 Feb 2009 12:27:22 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49973AF8.2010905@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>
	<49971AC0.3050603@telecom-bretagne.eu>
	<49973AF8.2010905@telecom-bretagne.eu>
Message-ID: <1t5x5vd848pde.dlg@nililand.de>

Am Sat, 14 Feb 2009 22:43:20 +0100 schrieb Elie Roux:

> With my package, one can do the same as in XeTeX: reading files written 
> in another input encoding, but with the same limitation as XeTeX (tell 
> me if I'm wrong): reading all files as if they were written in the same 
> encoding... The problem is that output files (like aux files) are all 
> written in UTF-8. So for example if we read files in latin1, we will 
> read the aux file as if it were in latin1, when it is written in UTF-8, 
> so it will make some errors.
> 
> The only solution I see is to register a callback in open_read_file, 
> that will convert from utf8 to latin1, before input is converted again 
> to utf8. This solution seems heavy and not really efficient.

You could try to write some code so that luatex understands emacs 
comments about the coding:

% -*-coding: utf-8 -*-

And some code that add such a line to every file luatex writes. 

Then luatex could use the coding of the comment, and some default 
coding from lua-inputenc for all files without such a line. 


-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Mon Feb 16 14:13:29 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 14:13:29 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <1t5x5vd848pde.dlg@nililand.de>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>
	<1t5x5vd848pde.dlg@nililand.de>
Message-ID: <49996679.6020600@telecom-bretagne.eu>

Ulrike Fischer a ?crit :
> You could try to write some code so that luatex understands emacs 
> comments about the coding:
>
> % -*-coding: utf-8 -*-
>
> And some code that add such a line to every file luatex writes. 
>
> Then luatex could use the coding of the comment, and some default 
> coding from lua-inputenc for all files without such a line. 

Basically there are two solutions: making LuaTeX write in latin1 (or 
LICR maybe, it would be the most logical), or guessing (with your 
solution for example) the encoding of the file, and the convert from 
utf8 to latin1 and then to utf8 again...

I still think the first solution is the best, as the behaviour is much 
more similar to the old TeX.
-- 
Elie

From news2 at nililand.de  Mon Feb 16 14:53:16 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Mon, 16 Feb 2009 14:53:16 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <49996679.6020600@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>
	<1t5x5vd848pde.dlg@nililand.de>
	<49996679.6020600@telecom-bretagne.eu>
Message-ID: <109nvvywawhnz$.dlg@nililand.de>

Am Mon, 16 Feb 2009 14:13:29 +0100 schrieb Elie Roux:

>> You could try to write some code so that luatex understands emacs 
>> comments about the coding:
>>
>> % -*-coding: utf-8 -*-
>>
>> And some code that add such a line to every file luatex writes. 
>>
>> Then luatex could use the coding of the comment, and some default 
>> coding from lua-inputenc for all files without such a line. 
> 
> Basically there are two solutions: making LuaTeX write in latin1 (or 
> LICR maybe, it would be the most logical),

No, LICR is not the most logical. Normal LaTeX doesn't use LICR as a 
special "writing" encoding. LaTeX simply expands some commands 
completely, partly or none at all when writing. Try the following 
and then compare the results in the .toc:

\documentclass[11pt]{article}
\usepackage[ansinew]{inputenc}
\begin{document}
\newcommand\test{a}
\tableofcontents
\catcode`\?=12
\section{\test ? ? \protect\test \string ?}
\end{document}

You can't know which result a user will want. So you can't enforce 
the LICR-representation. 


> or guessing (with your solution for example) the encoding of the
> file, and the convert from utf8 to latin1 and then to utf8
> again...

Why guessing? And why should convert luatex from utf8 to latin1 and 
back? If luatex opens a file it can check if the file contains a 
line about the encoding and then apply this encoding. 


 > I still think the first solution is the best, as the behaviour is much 
> more similar to the old TeX.

Above you are complaining that too much converting is involved and 
now you doing unnessary converting yourself. In your scenario you 
are converting the internal utf8 to latin1 to write the aux, and you 
are converting the content of the aux again to utf8 to handle it 
during compilation. In my scenario you only write a comment to the 
aux so that luatex knows that it is already an utf8-file and can be 
handle directly -- no input converting and no output converting 
needed. 

But if you really want to get aux-files in latin1: You don't need 
luatex to be able to write directly in latin1. You only need to be 
able to convert an utf8-file in e.g. latin1. You could do it after 
you closed the file. 

-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Mon Feb 16 15:07:42 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 15:07:42 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <109nvvywawhnz$.dlg@nililand.de>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>
	<109nvvywawhnz$.dlg@nililand.de>
Message-ID: <4999732E.8010406@telecom-bretagne.eu>

Ulrike Fischer a ?crit :
> Why guessing? And why should convert luatex from utf8 to latin1 and 
> back? If luatex opens a file it can check if the file contains a 
> line about the encoding and then apply this encoding. 
>   

Because to convert the main tex file, I need to put a function in the 
callback process_input_buffer, and it converts everything from latin1 to 
utf, so if I want to have a file in utf, I need to convert it first 
(before it is processed in process_input_buffer) in latin1, and then (in 
process_input_buffer) convert it again to utf. If there is another 
solution than the process_input_buffer to convert the main tex file, I 
take it though...

> Above you are complaining that too much converting is involved and 
> now you doing unnessary converting yourself. In your scenario you 
> are converting the internal utf8 to latin1 to write the aux, and you 
> are converting the content of the aux again to utf8 to handle it 
> during compilation. In my scenario you only write a comment to the 
> aux so that luatex knows that it is already an utf8-file and can be 
> handle directly -- no input converting and no output converting 
> needed. 
>
> But if you really want to get aux-files in latin1: You don't need 
> luatex to be able to write directly in latin1. You only need to be 
> able to convert an utf8-file in e.g. latin1. You could do it after 
> you closed the file. 
>   

I might have found a better solution that (unexpectedly) works: calling 
inputenc after lua-inputenc... it works fine for my tests: it uses the 
LICR, so when it reads the file again, no problem, but I need to test it 
more... If it works, I'll take this solution, as my aim is to emulate 
the old inputenc, not creating a new one with new aux files encoding 
conventions. I think people who want to do new things with LuaTeX must 
be workin in UTF-8, not using my packet (that will work for them too 
anyway).
-- 
Elie

From arthur.reutenauer at normalesup.org  Mon Feb 16 18:58:55 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 16 Feb 2009 18:58:55 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <4999732E.8010406@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>
	<49971AC0.3050603@telecom-bretagne.eu>
	<49973AF8.2010905@telecom-bretagne.eu>
	<1t5x5vd848pde.dlg@nililand.de>
	<49996679.6020600@telecom-bretagne.eu>
	<109nvvywawhnz$.dlg@nililand.de>
	<4999732E.8010406@telecom-bretagne.eu>
Message-ID: <20090216175855.GM26572@phare.normalesup.org>

	Hello,

  Just throwing in thoughts, I unfortunately haven't had time to read
the discussion in detail.

> I might have found a better solution that (unexpectedly) works: calling 
> inputenc after lua-inputenc...

  Actually, another question is how all that interacts with fontenc: in
pdfLaTeX, if you're using inputenc, you should use fontenc also,
otherwise you're just asking for trouble.  Hence, in LuaLaTeX +
lua-inputenc, wouldn't it be possible to simply use the LICR internally,
and let fontenc convert it to the font's encoding with the *enc.def
files?

  Of course, this would give very bad results with OpenType fonts, for
example, but I think it's not unreasonable to require LaTeX users who
want to use OpenType fonts with LuaTeX to encode all their documents in
UTF-8, full stop.  lua-inputenc should, as I see it, care for backward
compatibility first.

	Arthur

From elie.roux at telecom-bretagne.eu  Mon Feb 16 19:05:03 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 16 Feb 2009 19:05:03 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <20090216175855.GM26572@phare.normalesup.org>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>	<109nvvywawhnz$.dlg@nililand.de>	<4999732E.8010406@telecom-bretagne.eu>
	<20090216175855.GM26572@phare.normalesup.org>
Message-ID: <4999AACF.4030101@telecom-bretagne.eu>

Arthur Reutenauer a ?crit :
> Actually, another question is how all that interacts with fontenc: in
> pdfLaTeX, if you're using inputenc, you should use fontenc also,
> otherwise you're just asking for trouble.  Hence, in LuaLaTeX +
> lua-inputenc, wouldn't it be possible to simply use the LICR internally,
> and let fontenc convert it to the font's encoding with the *enc.def
> files?
>
>   Of course, this would give very bad results with OpenType fonts, for
> example, but I think it's not unreasonable to require LaTeX users who
> want to use OpenType fonts with LuaTeX to encode all their documents in
> UTF-8, full stop.  lua-inputenc should, as I see it, care for backward
> compatibility first.
>   

I totally agree: users who want new features (like OTF) shoud do things 
in UTF-8.

Actually fontenc works fine with simple documents, and my solution for 
inputenc works fine too (with fontenc). I continue to test, but no 
problem so far...

Thank you!
-- 
Elie

From nomosnomos at gmail.com  Tue Feb 17 06:53:45 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Tue, 17 Feb 2009 14:53:45 +0900
Subject: [luatex] tounicode problem when gsub feature applied
Message-ID: <bfeb3bf10902162153w4c365282w6161b3e300919b12@mail.gmail.com>

Hi, Taco and Hans,

As promised, I hereby attach a small test file
for testing tounicode object when GSUB feature is applied.

I compiled this file with latest luatex binary (rev. 1867) and latest
context beta (2009.02.09).

Font used in this file is UnBatang.ttf, available at
http://kldp.net/frs/download.php/4695/un-fonts-core-1.0.2-080608.tar.gz .
This font has GSUB tables to be used for representing medieval Korean
characters.

Original unicode hex points of test string is :
1112 119E 11AB 1100 1173 11AF
which are all from Hangul conjoining Jamo area (U+1100..U+11FF).

However, when I issue a command "pdftotext test.pdf -"
the resulting code is completely weird and beyond BMP:
F0096 F0333 F0551 F0084 F0308 F0555
which should be the same as original text code in the tex file.

Best,
Dohyun Kim
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: application/x-tex
Size: 248 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090217/bd55e893/attachment.tex 

From news2 at nililand.de  Tue Feb 17 09:21:42 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Tue, 17 Feb 2009 09:21:42 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <4999732E.8010406@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>
	<109nvvywawhnz$.dlg@nililand.de>
	<4999732E.8010406@telecom-bretagne.eu>
Message-ID: <k6dxpqecdjbx.dlg@nililand.de>

Am Mon, 16 Feb 2009 15:07:42 +0100 schrieb Elie Roux:

> I might have found a better solution that (unexpectedly) works: calling 
> inputenc after lua-inputenc... it works fine for my tests: it uses the 
> LICR, so when it reads the file again, no problem, but I need to test it 
> more...

Did you try what happens if the user use \protect or \string? 

\documentclass[11pt]{article}
\usepackage[ansinew]{inputenc}
\begin{document}
\tableofcontents
\catcode`\?=12
\section{? ? \protect ? \string ?}
\end{document}




-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Tue Feb 17 09:42:19 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 17 Feb 2009 09:42:19 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <k6dxpqecdjbx.dlg@nililand.de>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>	<109nvvywawhnz$.dlg@nililand.de>	<4999732E.8010406@telecom-bretagne.eu>
	<k6dxpqecdjbx.dlg@nililand.de>
Message-ID: <499A786B.8080206@telecom-bretagne.eu>

Ulrike Fischer a ?crit :
> Did you try what happens if the user use \protect or \string?
> \documentclass[11pt]{article}
> \usepackage[ansinew]{inputenc}
> \begin{document}
> \tableofcontents
> \catcode`\?=12
> \section{? ? \protect ? \string ?}
> \end{document}

It doesn't work: it needs the aux file to be in ascii, to be read as if 
it were 8-bit (I know there may be some encodings that are not exactly 
ascii for 0 - 127, but you see what I mean) or utf. I'll try some 
experiments, but if becomes too heavy, I'll deal with something else 
(like finishing the mplib package). I think the luainputenc package has 
reached a reasonable point, and that some important things have to be 
dealt with before the use of \protect in the section names... But of 
course, I accept any code contribution!
-- 
Elie

From news2 at nililand.de  Tue Feb 17 10:20:25 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Tue, 17 Feb 2009 10:20:25 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <499A786B.8080206@telecom-bretagne.eu>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>	<109nvvywawhnz$.dlg@nililand.de>	<4999732E.8010406@telecom-bretagne.eu>
	<k6dxpqecdjbx.dlg@nililand.de>
	<499A786B.8080206@telecom-bretagne.eu>
Message-ID: <693hq73p7mzo.dlg@nililand.de>

Am Tue, 17 Feb 2009 09:42:19 +0100 schrieb Elie Roux:

> Ulrike Fischer a ?crit :
>> Did you try what happens if the user use \protect or \string?
>> \documentclass[11pt]{article}
>> \usepackage[ansinew]{inputenc}
>> \begin{document}
>> \tableofcontents
>> \catcode`\?=12
>> \section{? ? \protect ? \string ?}
>> \end{document}
> 
> It doesn't work: it needs the aux file to be in ascii, to be read as if 
> it were 8-bit (I know there may be some encodings that are not exactly 
> ascii for 0 - 127, but you see what I mean) or utf. 

There is no "or". If the aux-file contains only ascii characters it
is an utf8-file. So it is no wonder that it works then. 


> I'll try some 
> experiments, but if becomes too heavy, I'll deal with something else 
> (like finishing the mplib package). I think the luainputenc package has 
> reached a reasonable point, and that some important things have to be 
> dealt with before the use of \protect in the section names... 

The \protect was only there to test if non-ascii auxiliary files
work. As it doesn't work probably all verbatim-like outputs will
break, e.g. 

\documentclass[11pt]{beamer}
\usepackage[ansinew]{inputenc}
\usepackage[T1]{fontenc}
\begin{document}
\begin{frame}[fragile]
???
\end{frame}
\end{document}
 
Loading inputenc is necessary (if you haven't included the
definitions in lua-inputenc) to get the correct mappings of the
non-ascii char to the font positions, and it will have the effect
that large parts of the auxiliary files are ascii files, but it is
at best a crutch. 

Commands comparable to \XeTeXinputencoding and \XeTeXdefaultencoding
would be very useful, and it would be fine if your package would
provide them. But your try to protect users to have to declare or
change the encoding of their files is at my opinion bound to fail
and a dead end. 


-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Tue Feb 17 10:30:37 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 17 Feb 2009 10:30:37 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <693hq73p7mzo.dlg@nililand.de>
References: <4996FE94.6030705@telecom-bretagne.eu>	<49971AC0.3050603@telecom-bretagne.eu>	<49973AF8.2010905@telecom-bretagne.eu>	<1t5x5vd848pde.dlg@nililand.de>	<49996679.6020600@telecom-bretagne.eu>	<109nvvywawhnz$.dlg@nililand.de>	<4999732E.8010406@telecom-bretagne.eu>	<k6dxpqecdjbx.dlg@nililand.de>	<499A786B.8080206@telecom-bretagne.eu>
	<693hq73p7mzo.dlg@nililand.de>
Message-ID: <499A83BD.7060507@telecom-bretagne.eu>

Ulrike Fischer a ?crit :
> Commands comparable to \XeTeXinputencoding and \XeTeXdefaultencoding
> would be very useful, and it would be fine if your package would
> provide them. But your try to protect users to have to declare or
> change the encoding of their files is at my opinion bound to fail
> and a dead end.
>   

Once again, this package is made for backward compatibility. It may 
fail, but at least I'm trying, and I truely think my package has already 
improved backward compatibility a lot. Of course we are not at 100% yet, 
far from it maybe, but we are not at 0% anymore, and a lot of old 
document will work in TeXLive 2009 (if my package is integrated). Think 
what you want, but I still don't think what I made is useless.

If you want to have a package that does fancy things with encodings, 
please go on, fork my code, it's in the public domain! This may work, 
but I still think it will be useless because new users will use UTF-8...
-- 
Elie

From arthur.reutenauer at normalesup.org  Tue Feb 17 14:48:53 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 17 Feb 2009 14:48:53 +0100
Subject: [luatex] tounicode problem when gsub feature applied
In-Reply-To: <bfeb3bf10902162153w4c365282w6161b3e300919b12@mail.gmail.com>
References: <bfeb3bf10902162153w4c365282w6161b3e300919b12@mail.gmail.com>
Message-ID: <20090217134853.GC26572@phare.normalesup.org>

> the resulting code is completely weird and beyond BMP:
> F0096 F0333 F0551 F0084 F0308 F0555

  This is perfectly reasonable, it's the in private use area.  I suppose
those are the character codes actually used in the font.

  Of course, it still means we need a ToUnicode CMap.

	Arthur

From pragma at wxs.nl  Tue Feb 17 15:13:18 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Feb 2009 15:13:18 +0100
Subject: [luatex] tounicode problem when gsub feature applied
In-Reply-To: <20090217134853.GC26572@phare.normalesup.org>
References: <bfeb3bf10902162153w4c365282w6161b3e300919b12@mail.gmail.com>
	<20090217134853.GC26572@phare.normalesup.org>
Message-ID: <499AC5FE.8020400@wxs.nl>

Arthur Reutenauer wrote:
>> the resulting code is completely weird and beyond BMP:
>> F0096 F0333 F0551 F0084 F0308 F0555
> 
>   This is perfectly reasonable, it's the in private use area.  I suppose
> those are the character codes actually used in the font.

indeed

>   Of course, it still means we need a ToUnicode CMap.

it's already solved (i.e. cut/paste works ok in upcoming mkiv)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Tue Feb 17 18:44:33 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 17 Feb 2009 18:44:33 +0100
Subject: [luatex] convention for lua packages and file names
Message-ID: <499AF781.3000601@telecom-bretagne.eu>

Hello,

uploading the lua packages made me think about something: what do you 
think should be the conventions for lua packages names and lua file 
names (outside of ConTeXt)?

Here is a concrete example: I'm finishing a package that uses mplib to 
typeset some metapost directly in LuaTeX, it only works in LuaTeX. The 
file contains a .sty file, a .tex file (for Plain), and a .lua file.

The .lua file registers a module called 'metapost'. I think the 
convention should be to call the file 'metapost.lua', to have a parallel 
with LaTeX: like foo.sty provides the package foo, bar.lua should 
provide the module bar.

When the package is for LuaTeX only, should it have a prefix in its 
name? for instance should I call the package mplib.sty, lua-mplib.sty or 
luamplib.sty?

In the case of a package that is adapted to LuaTeX, like inputenc for 
example, I think it should be names luainputenc (not lua-inputenc).

I'll put this convention in a (future) luatextra package...

Thank you in advance,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Tue Feb 17 20:41:02 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 17 Feb 2009 20:41:02 +0100
Subject: [luatex] writing in output files
Message-ID: <499B12CE.3070802@telecom-bretagne.eu>

Hello,

How can we write with pure lua in a file opened with TeX? What I'd like 
to do is something like

\openout2=test2.aux
\write2{tutu}
titi
\directlua0{texio.write(2, "titi")}
\bye

Of course, texio.sprint("\write2{titi}") is forbiden, as the idea would 
be to eventually overwrite \write...

Thank you in advance,
-- 
Elie

From pragma at wxs.nl  Tue Feb 17 20:58:03 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Feb 2009 20:58:03 +0100
Subject: [luatex] writing in output files
In-Reply-To: <499B12CE.3070802@telecom-bretagne.eu>
References: <499B12CE.3070802@telecom-bretagne.eu>
Message-ID: <499B16CB.9020602@wxs.nl>

Elie Roux wrote:
> Hello,
> 
> How can we write with pure lua in a file opened with TeX? What I'd like 
> to do is something like
> 
> \openout2=test2.aux
> \write2{tutu}
> titi
> \directlua0{texio.write(2, "titi")}
> \bye
> 
> Of course, texio.sprint("\write2{titi}") is forbiden, as the idea would 
> be to eventually overwrite \write...

tex.sprint("\write2{titi}")

is ok and of course you can use io.open and friends

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Tue Feb 17 21:02:45 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 17 Feb 2009 21:02:45 +0100
Subject: [luatex] writing in output files
In-Reply-To: <499B16CB.9020602@wxs.nl>
References: <499B12CE.3070802@telecom-bretagne.eu> <499B16CB.9020602@wxs.nl>
Message-ID: <499B17E5.6000300@telecom-bretagne.eu>

Hans Hagen a ?crit :
>> Of course, texio.sprint("\write2{titi}") is forbiden, as the idea 
>> would be to eventually overwrite \write...
>
> tex.sprint("\write2{titi}")
>
> is ok and of course you can use io.open and friends

The idea was precisely to do it without the write macro... and the idea 
is to write in the aux file, this means something that will be opened 
with TeX (I can't do anything about it).

I hope there is a solution...
-- 
Elie

From pragma at wxs.nl  Tue Feb 17 21:13:02 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 17 Feb 2009 21:13:02 +0100
Subject: [luatex] writing in output files
In-Reply-To: <499B17E5.6000300@telecom-bretagne.eu>
References: <499B12CE.3070802@telecom-bretagne.eu> <499B16CB.9020602@wxs.nl>
	<499B17E5.6000300@telecom-bretagne.eu>
Message-ID: <499B1A4E.6050300@wxs.nl>

Elie Roux wrote:
> Hans Hagen a ?crit :
>>> Of course, texio.sprint("\write2{titi}") is forbiden, as the idea 
>>> would be to eventually overwrite \write...
>>
>> tex.sprint("\write2{titi}")
>>
>> is ok and of course you can use io.open and friends
> 
> The idea was precisely to do it without the write macro... and the idea 
> is to write in the aux file, this means something that will be opened 
> with TeX (I can't do anything about it).
> 
> I hope there is a solution...

writing to such a file involves buffering and such and the lua and tex 
file handling is isolated; the tex.sprint method is pretty save

on the long term we might provide more tex.<primitive> support; there 
are more primitives not accessible from lua now) but don't count on that 
too much on the short term; the focus is currently on getting math 
support done, and after that to sort out some tracker items and do some 
cleanup; after that comes a period of stabilization towards version 0.50 
and then next year a new round of thingies.

so, if i were you i'd just go for the tex.sprint method and revision it 
when other means come available (most of the luatex related code i wrote 
was rewritten several times and probably will be rewritten as we 
proceed; keep in mind that much is still experimental; btw, around 0.50 
we will define the stable subset so far)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Wed Feb 18 01:17:01 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 18 Feb 2009 01:17:01 +0100
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <499AF781.3000601@telecom-bretagne.eu>
References: <499AF781.3000601@telecom-bretagne.eu>
Message-ID: <20090218001701.GA26039@phare.normalesup.org>

> The .lua file registers a module called 'metapost'. I think the convention 
> should be to call the file 'metapost.lua', to have a parallel with LaTeX: 
> like foo.sty provides the package foo, bar.lua should provide the module 
> bar.

  Sounds good to me, but I'm afraid it won't fit in every situation;
think of pstricks with its dozens of pst-* subpackages: in those cases,
it's probably nicer to store those modules in subtables; but then you
would have a file called foo.bar.lua which is a bit awkward (although
possible on modern filesystems).

> When the package is for LuaTeX only, should it have a prefix in its name? 

  I don't think so.  Unless LaTeX starts some sort of internal fork
between LuaTeX and other engines, but that doesn't seem likely for the
moment.

> In the case of a package that is adapted to LuaTeX, like inputenc for 
> example, I think it should be names luainputenc (not lua-inputenc).

  To match with xe* packages?  Sure, why not.  But it's probably not the
best idea to rename lua-inputenc to luainputenc now.

	Arthur

From karl at freefriends.org  Wed Feb 18 01:39:33 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 17 Feb 2009 18:39:33 -0600
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <20090218001701.GA26039@phare.normalesup.org>
Message-ID: <200902180039.n1I0dXh30372@f7.net>

      To match with xe* packages?  Sure, why not.  But it's probably not the
    best idea to rename lua-inputenc to luainputenc now.

It seems to me that now is the *only* time to do so.  And I think it's a
good idea.

From arthur.reutenauer at normalesup.org  Wed Feb 18 01:41:24 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 18 Feb 2009 01:41:24 +0100
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <200902180039.n1I0dXh30372@f7.net>
References: <20090218001701.GA26039@phare.normalesup.org>
	<200902180039.n1I0dXh30372@f7.net>
Message-ID: <20090218004124.GC26039@phare.normalesup.org>

> It seems to me that now is the *only* time to do so.  And I think it's a
> good idea.

  Sure, later would be even worse :-)

	Arthur

From karl at freefriends.org  Wed Feb 18 02:24:59 2009
From: karl at freefriends.org (Karl Berry)
Date: Tue, 17 Feb 2009 19:24:59 -0600
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <499AF781.3000601@telecom-bretagne.eu>
Message-ID: <200902180124.n1I1Oxi09918@f7.net>

    Here is a concrete example: I'm finishing a package that uses mplib to 

What is the name of the package?  mplib?  That would concern me, since
mplib is the project name of the actual library.

    The .lua file registers a module called 'metapost'. I think the 

I think using such a generic name is undesirable.  Yours probably won't
be the only package using MetaPost from LuaTeX.  Instead, I think the
module should include the package name somehow.

    When the package is for LuaTeX only, should it have a prefix in its 
    name? for instance should I call the package mplib.sty, lua-mplib.sty or 
    luamplib.sty?

luamplib by analogy with the xe... that we have for many xetex-specific
packages.  Although it's not perfect, since lua has other meanings
besides luatex.  luatexmplib?  Yuck.

I don't have a good answer right now.  It deserves some thought.
Outlining (again) the different packages you have in mind right now
could help.

Thanks,
k

From elie.roux at telecom-bretagne.eu  Wed Feb 18 09:01:52 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 18 Feb 2009 09:01:52 +0100
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <200902180124.n1I1Oxi09918@f7.net>
References: <200902180124.n1I1Oxi09918@f7.net>
Message-ID: <499BC070.3090107@telecom-bretagne.eu>

Karl Berry a ?crit :
>     Here is a concrete example: I'm finishing a package that uses mplib to 
>
> What is the name of the package?  mplib?  That would concern me, since
> mplib is the project name of the actual library.
>   

The package is currently called mplib yes, but I must say it's a default 
name, I can't find a better one... The goal is to simply typeset 
metapost in LuaTeX, like this

\begin{mplibcode}
my
metapost
code;
\end{mplibcode}

>     The .lua file registers a module called 'metapost'. I think the 
>
> I think using such a generic name is undesirable.  Yours probably won't
> be the only package using MetaPost from LuaTeX.  Instead, I think the
> module should include the package name somehow.
>   

Sure. Once again it's a default name...

> luamplib by analogy with the xe... that we have for many xetex-specific
> packages.  Although it's not perfect, since lua has other meanings
> besides luatex.  luatexmplib?  Yuck.
>   

maybe prefixing all with simple would do the trick? simplemplib.sty and 
simplemplib.lua? Or a random two-letter prefix, for example lkmplib, 
ermplib, ctmplib?

> I don't have a good answer right now.  It deserves some thought.
> Outlining (again) the different packages you have in mind right now
> could help.
>   

The packages I have in mind are

lua-inputenc -> luainputenc
luamcallbacks -> mcallbacks as it will only be a .lua file (no .sty nor 
.tex) loaded by luatextra
mplib -> lkmplib?
luatextra

Thank you!
-- 
Elie

From javier at digi21.eu  Wed Feb 18 11:53:21 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Wed, 18 Feb 2009 11:53:21 +0100
Subject: [luatex] lua-inputenc
Message-ID: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>

I didn't conect to the internet in the past days and haven't red the
whole discussion, so may be this was already pointed:

In order to run my old LaTeX documents with luatex I also thought
about the writing an inputenc, registering differnt callbacks for
process_input_buffer according to the encoding, but then I realized
that it was much easier to simply register a function for
process_input_buffer in such a way as to change from byte to utf-8,
and then just let LateX inputenc (or whatever code) to handle the
input encoding.

Now I don't have the code with me, but Is was fairly simple and I
think I can write it now:

\directlua0{
function byte-to-utf8(string c)
  local b=string.byte(c)
  if b<128 then
     return c
  end
  if b<192 then
    return string.char(194, b)
  else
    return string.char(194,b-64)
  end
end

callback.register(
function process_input_buffer(buffer)
  return string.gsub(buffer,"(.)",byte-to-utf8)
end
)
}

Note that if your document and the macros just contained something
like \catcode`?=\active  \def?{<code>} then the function byte-to-utf8
coud just translate the input bytes to _any_ valid utf-8. But that is
not the case of Latex inputenc, which has code something like

\RegisterInputChar{125}{<code>}

so the right conversion is mandatory.

I have compiled several documents, including a whole books with
several auxiliary files, and It runs without problem.

--Javier A.

From news2 at nililand.de  Wed Feb 18 12:36:49 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Wed, 18 Feb 2009 12:36:49 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
Message-ID: <4uypj54pc6oq$.dlg@nililand.de>

Am Wed, 18 Feb 2009 11:53:21 +0100 schrieb Javier M?gica:

> I didn't conect to the internet in the past days and haven't red the
> whole discussion, so may be this was already pointed:
> 
> In order to run my old LaTeX documents with luatex I also thought
> about the writing an inputenc, registering differnt callbacks for
> process_input_buffer according to the encoding, but then I realized
> that it was much easier to simply register a function for
> process_input_buffer in such a way as to change from byte to utf-8,
> and then just let LateX inputenc (or whatever code) to handle the
> input encoding.
> 
> Now I don't have the code with me, but Is was fairly simple and I
> think I can write it now:
> 
> \directlua0{
> function byte-to-utf8(string c)
>   local b=string.byte(c)
>   if b<128 then
>      return c
>   end
>   if b<192 then
>     return string.char(194, b)
>   else
>     return string.char(194,b-64)
>   end
> end
> 
> callback.register(
> function process_input_buffer(buffer)
>   return string.gsub(buffer,"(.)",byte-to-utf8)
> end
> )
> }

I'm not very good at lua but I do have some doubt that chars which
use 3 octets for coding will come out correctly. E.g. the euro-sign
has in ansinew the position 128, so if I understand your code
correctly it will be mapped to 

0xC2 0x80, but its utf8 code is 0xE2 0x82 0xAC


-- 
Ulrike Fischer 


From elie.roux at telecom-bretagne.eu  Wed Feb 18 12:46:56 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Wed, 18 Feb 2009 12:46:56 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
Message-ID: <499BF530.3010902@telecom-bretagne.eu>

Javier M?gica a ?crit :
> Now I don't have the code with me, but Is was fairly simple and I
> think I can write it now:
You're right, your solution is the good one if we are to use inputenc, I'll change my code.


> I have compiled several documents, including a whole books with
> several auxiliary files, and It runs without problem.
>   

There are some problems if you write something like \protect ? in a aux 
file, but I don't have time to test further, I'll be back by friday.

Thank you!
-- 
Elie

From arthur.reutenauer at normalesup.org  Wed Feb 18 12:58:09 2009
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 18 Feb 2009 12:58:09 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <4uypj54pc6oq$.dlg@nililand.de>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<4uypj54pc6oq$.dlg@nililand.de>
Message-ID: <20090218115809.GE16769@phare.normalesup.org>

> I'm not very good at lua but I do have some doubt that chars which
> use 3 octets for coding will come out correctly. E.g. the euro-sign
> has in ansinew the position 128, so if I understand your code
> correctly it will be mapped to 
> 
> 0xC2 0x80, but its utf8 code is 0xE2 0x82 0xAC

  Yes, it simply means that you fool LuaTeX, which reads the file as if
it was UTF-8, into thinking that it saw character U+0080, so that it
prints character 0x80 to the output file, which turns out to be exactly
what you want if you use the appropriate font.  That's Unicode-heretic,
of course, but a natural trick if you're familiar with the hacks people
commonly used with 8-bit custom fonts in the pre-Unicode days, and I'm
happy to learn that it actually works.  PDF readers might even correctly
interpret the text if they have valid Type 1 fonts (thanks to the glyph
names) -- so that copypasting work, for example.

  It has nothing to do with the number of bytes a character needs in its
UTF-8 form, LuaTeX simply reads the appropriate number of them and
converts the byte stream to a list of Unicode characters upon opening
the file.

	Arthur

From mpg at elzevir.fr  Wed Feb 18 13:34:01 2009
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 18 Feb 2009 13:34:01 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <20090218115809.GE16769@phare.normalesup.org>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>	<4uypj54pc6oq$.dlg@nililand.de>
	<20090218115809.GE16769@phare.normalesup.org>
Message-ID: <499C0039.4030205@elzevir.fr>

Arthur Reutenauer a ?crit :
>> 0xC2 0x80, but its utf8 code is 0xE2 0x82 0xAC
> 
>   Yes, it simply means that you fool LuaTeX, which reads the file as if
> it was UTF-8, into thinking that it saw character U+0080, so that it
> prints character 0x80 to the output file, which turns out to be exactly
> what you want if you use the appropriate font.  That's Unicode-heretic,
> of course, but a natural trick if you're familiar with the hacks people
> commonly used with 8-bit custom fonts in the pre-Unicode days, and I'm
> happy to learn that it actually works.  PDF readers might even correctly
> interpret the text if they have valid Type 1 fonts (thanks to the glyph
> names) -- so that copypasting work, for example.
> 
>   It has nothing to do with the number of bytes a character needs in its
> UTF-8 form, LuaTeX simply reads the appropriate number of them and
> converts the byte stream to a list of Unicode characters upon opening
> the file.
> 
I agree, in some sense it is the easiest way to make inputenc "work"
with LuaTeX exactly the same way as it works with an 8-bit TeX.

But it means you also keep all the problems of the current inputenc over
8-bit TeX. I really wonder whether it's useful to be keep that level of
compatibility: it would just mean no benefit on the encoding side for
the unaware user switching to the luatex engine without switching to
"real" utf-8 without inputenc...

Manuel.


From news2 at nililand.de  Wed Feb 18 18:53:55 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Wed, 18 Feb 2009 18:53:55 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <20090218115809.GE16769@phare.normalesup.org>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<4uypj54pc6oq$.dlg@nililand.de>
	<20090218115809.GE16769@phare.normalesup.org>
Message-ID: <hugmr8atjkb7$.dlg@nililand.de>

Am Wed, 18 Feb 2009 12:58:09 +0100 schrieb Arthur Reutenauer:

>> I'm not very good at lua but I do have some doubt that chars which
>> use 3 octets for coding will come out correctly. E.g. the euro-sign
>> has in ansinew the position 128, so if I understand your code
>> correctly it will be mapped to 
>> 
>> 0xC2 0x80, but its utf8 code is 0xE2 0x82 0xAC
> 
>   Yes, it simply means that you fool LuaTeX, which reads the file as if
> it was UTF-8, into thinking that it saw character U+0080, so that it
> prints character 0x80 to the output file, which turns out to be exactly
> what you want if you use the appropriate font.  That's Unicode-heretic,
> of course, but a natural trick if you're familiar with the hacks people
> commonly used with 8-bit custom fonts in the pre-Unicode days, and I'm
> happy to learn that it actually works.  PDF readers might even correctly
> interpret the text if they have valid Type 1 fonts (thanks to the glyph
> names) -- so that copypasting work, for example.
> 
>   It has nothing to do with the number of bytes a character needs in its
> UTF-8 form, LuaTeX simply reads the appropriate number of them and
> converts the byte stream to a list of Unicode characters upon opening
> the file.

I don't think that I understood ;-(. 

I do understand that the code converts 8-bit input in legal utf-8. 
What I don't understand is how later on latex can print the U+0080 
(in which the euro sign got converted) as an euro. utf8enc.dfu maps 
20AC to the euro, 0080 doesn't have a declaration.

-- 
Ulrike Fischer 


From oberdiek at uni-freiburg.de  Wed Feb 18 23:15:02 2009
From: oberdiek at uni-freiburg.de (Heiko Oberdiek)
Date: Wed, 18 Feb 2009 23:15:02 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <hugmr8atjkb7$.dlg@nililand.de>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<4uypj54pc6oq$.dlg@nililand.de>
	<20090218115809.GE16769@phare.normalesup.org>
	<hugmr8atjkb7$.dlg@nililand.de>
Message-ID: <20090218221501.GA3682@irwin.vpn.uni-freiburg.de>

On Wed, Feb 18, 2009 at 06:53:55PM +0100, Ulrike Fischer wrote:

> I do understand that the code converts 8-bit input in legal utf-8.

I would rather call it "fake-utf-8".
 
> What I don't understand is how later on latex can print the U+0080 
> (in which the euro sign got converted) as an euro. utf8enc.dfu maps 
> 20AC to the euro, 0080 doesn't have a declaration.

No, you wouldn't use utf8, but for example ansinew.def, this maps
character 0x80 (or decimal 128) to \texteuro.

This method is the most compatible way, but it strips off the
new possibilities of using UTF-8 encoding with LuaTeX.
Therefore I don't think, it's a good base for new development.

Yours sincerely
  Heiko <oberdiek at uni-freiburg.de>

From karl at freefriends.org  Wed Feb 18 23:34:09 2009
From: karl at freefriends.org (Karl Berry)
Date: Wed, 18 Feb 2009 16:34:09 -0600
Subject: [luatex] lua-inputenc
In-Reply-To: <499C0039.4030205@elzevir.fr>
Message-ID: <200902182234.n1IMY9O13000@f7.net>

    I really wonder whether it's useful to be keep that level of
    compatibility:

Once again: for the goal of "latex" someday invoking LuaTeX, not
pdfTeX, then that level of compatibility is not just useful, but
mandatory.  Obviously there are intermediate useful steps, but for that
ultimate goal ...

From karl at freefriends.org  Fri Feb 20 02:12:13 2009
From: karl at freefriends.org (Karl Berry)
Date: Thu, 19 Feb 2009 19:12:13 -0600
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <499BC070.3090107@telecom-bretagne.eu>
Message-ID: <200902200112.n1K1CDl19517@f7.net>

    maybe prefixing all with simple would do the trick? simplemplib.sty and 
    simplemplib.lua? Or a random two-letter prefix, for example lkmplib, 
    ermplib, ctmplib?

Neither of these seem like a good convention to me, considering we may
have dozens/hundreds of these in the future.

I guess my suggestion remains just "lua" for the prefix for packages
that run with luatex.

luainputenc
luamcallbacks
luamplib
luatextra

Names are hard.

From luigi.scarso at gmail.com  Fri Feb 20 09:30:37 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 20 Feb 2009 09:30:37 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880 on
	TL2008
Message-ID: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>

Perhaps not so important:

$>/opt/TeXLive2008/texlive/2008/bin/i386-linux# fmtutil --byfmt pdflualatex
fmtutil: running `luatex -ini   -jobname=pdflualatex
-progname=pdflualatex pdflualatex.ini' ...
This is LuaTeX, Version snapshot-0.33.1-2009022008 (Web2C 7.5.7) (INITEX)

(/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/latexconfig/pdflualatex.ini
(/opt/TeXLive2008/texlive/2008/texmf/tex/generic/config/pdftexconfig.tex)
(/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/base/latex.ltxSegmentation
fault
Error: `luatex -ini  -jobname=pdflualatex -progname=pdflualatex
pdflualatex.ini' failed

###############################################################################
fmtutil: Error! Not all formats have been built successfully.
Visit the log files in directory
  /root/.texlive2008/texmf-var/web2c
for details.
###############################################################################

This is a summary of all `failed' messages and warnings:
`luatex -ini  -jobname=pdflualatex -progname=pdflualatex pdflualatex.ini' failed

Linux john 2.6.24-21-generic #1 SMP Tue Oct 21 23:43:45 UTC 2008 i686 GNU/Linux



BTW,no problem with
This is LuaTeX, Version snapshot-0.31.3-2008122917 (Web2C 7.5.7)

-- 
luigi

From taco at elvenkind.com  Fri Feb 20 09:35:32 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 20 Feb 2009 09:35:32 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
 on	TL2008
In-Reply-To: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
Message-ID: <499E6B54.2030904@elvenkind.com>



luigi scarso wrote:
> Perhaps not so important:
> 
> $>/opt/TeXLive2008/texlive/2008/bin/i386-linux# fmtutil --byfmt pdflualatex
> fmtutil: running `luatex -ini   -jobname=pdflualatex
> -progname=pdflualatex pdflualatex.ini' ...
> This is LuaTeX, Version snapshot-0.33.1-2009022008 (Web2C 7.5.7) (INITEX)
> 
> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/latexconfig/pdflualatex.ini
> (/opt/TeXLive2008/texlive/2008/texmf/tex/generic/config/pdftexconfig.tex)
> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/base/latex.ltxSegmentation
> fault

No crash here. Can you check the backtrace in a debugger?

Best wishes,
Taco

From nomosnomos at gmail.com  Fri Feb 20 09:41:10 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Fri, 20 Feb 2009 17:41:10 +0900
Subject: [luatex] bug related to attribute and math
Message-ID: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>

HI,

On compiling following tex code, I get failed assertion error.

$ cat t.tex
\attributedef\xyz 11
\xyz-1
$\dot{}$
\bye

$ luatex t.tex
This is LuaTeX, Version snapshot-0.33.1-2009022016 (Web2C 7.5.7)
(t.tex../../../../src/texk/web2c/luatexdir/tex/mlist.c:1854: failed
assertion `type(varmem[((q)+1)].hh.v.LH)==attribute_list_node'
Abort trap

$ luatex -version
This is LuaTeX, Version snapshot-0.33.1-2009022016, build 1880

Dohyun Kim

From taco at elvenkind.com  Fri Feb 20 09:44:31 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 20 Feb 2009 09:44:31 +0100
Subject: [luatex] bug related to attribute and math
In-Reply-To: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>
Message-ID: <499E6D6F.6000905@elvenkind.com>



Dohyun Kim wrote:
> HI,
> 
> On compiling following tex code, I get failed assertion error.
> 
> $ cat t.tex
> \attributedef\xyz 11
> \xyz-1

You can't really assign negative values to an attribute (at the
moment), doing so is the same as unsetting it. The assertion failure
is a bug but I won't fix that right now since I intend to lift that
limitation soon.

Best wishes,
Taco

From luigi.scarso at gmail.com  Fri Feb 20 10:28:41 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 20 Feb 2009 10:28:41 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
	on TL2008
In-Reply-To: <499E6B54.2030904@elvenkind.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
	<499E6B54.2030904@elvenkind.com>
Message-ID: <fe8d59da0902200128g28c7f54dic0c9f3aa081f604e@mail.gmail.com>

On Fri, Feb 20, 2009 at 9:35 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
>
> luigi scarso wrote:
>> Perhaps not so important:
>>
>> $>/opt/TeXLive2008/texlive/2008/bin/i386-linux# fmtutil --byfmt pdflualatex
>> fmtutil: running `luatex -ini   -jobname=pdflualatex
>> -progname=pdflualatex pdflualatex.ini' ...
>> This is LuaTeX, Version snapshot-0.33.1-2009022008 (Web2C 7.5.7) (INITEX)
>>
>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/latexconfig/pdflualatex.ini
>> (/opt/TeXLive2008/texlive/2008/texmf/tex/generic/config/pdftexconfig.tex)
>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/base/latex.ltxSegmentation
>> fault
>
> No crash here. Can you check the backtrace in a debugger?
>
> Best wishes,
> Taco
>
Can be this
warning: Can't read pathname for load map: Input/output error.

ie a my fault on setup tl2008.

The only thing I do is
export PATH=/opt/TeXLive2008/texlive/2008/bin/i386-linux:$PATH

-- 
luigi

From pragma at wxs.nl  Fri Feb 20 13:17:40 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 20 Feb 2009 13:17:40 +0100
Subject: [luatex] convention for lua packages and file names
In-Reply-To: <200902200112.n1K1CDl19517@f7.net>
References: <200902200112.n1K1CDl19517@f7.net>
Message-ID: <499E9F64.8070404@wxs.nl>

Karl Berry wrote:
>     maybe prefixing all with simple would do the trick? simplemplib.sty and 
>     simplemplib.lua? Or a random two-letter prefix, for example lkmplib, 
>     ermplib, ctmplib?
> 
> Neither of these seem like a good convention to me, considering we may
> have dozens/hundreds of these in the future.
> 
> I guess my suggestion remains just "lua" for the prefix for packages
> that run with luatex.
> 
> luainputenc
> luamcallbacks
> luamplib
> luatextra
> 
> Names are hard.

it all depends on how well the variables in texmf.cnf are defined, i.e. 
macro package specific namespaces; *inputenc in probably only used in 
latex but *mplib is more generic; in any case i wouldn't count too much 
on names being unique (for context we have a rather rigourous scheme so 
i don't expect too many clashes there within the context texmf.cnf 
namespace)

btw, .sty is rather unique for latex so that creates a kind of 
namespace; so maybe blabla.sty should then use blabla.stl or so

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From javier at digi21.eu  Fri Feb 20 14:26:30 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Fri, 20 Feb 2009 14:26:30 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
Message-ID: <5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>

>if you write something like \protect ? ...

The \protect doesn't make any difference. The relevant fact is that
the ? is, in Windows for instance, FC, ie, 11111100, and in a  utf-8
file that byte is not a syngle unit, so it is not a "Byte" in the
sense of minimun significant unit.

>>`But I can make it active and map it to sometihng valid.'
>>`No, that character does not exist.'
>>`What do you mean it does not exist? Of course my file includes 11111100 bytes!'
>>`So does it include six-byte sequences, but certainly you cannot make the six-bit sequence 110100 (or any other) an active character.'

THE ONLY WAY TO HANDLE 8-BIT INPUT IS BY INTERCEPTING THE INPUT WITH A
CALLBACK AND TRANSFORMING IT BEFORE THE LUA ENGINE CAN READ IT.

>No, you wouldn't use utf8, but for example ansinew.def, this maps character 0x80 (or decimal 128) to \texteuro.

Yes, I meant that.

>This method is the most compatible way, but it strips off the new possibilities of using UTF-8 encoding with LuaTeX.
>Therefore I don't think, it's a good base for new development.

If you are using an 8-bit input encoding you won't have the utf-8
facilities anyway; you are limited to 256 input characters.


I see three possible scenarios:

1. Old code which we want to compile with luatex

    In this case I think the solution I proposed is the best one:

      \ifdefiined\directlua
      \input byte-to-utf8.ltex    %This is the file including the code
from my previous message.
      \fi

2. New code in all repectes, i.e., not only the author document but as
well the packages it loads.

    Then the files would be stored in the utf-8 encoding and there is
no need for an input encoding
    scheme at all. There persists the need for an output encoding
while we still use tfm files,
    but this is a different problem.

3. New documents, with utf-8 encoding, using old packages.

    Then it is likely that nothing need be done here too, for packages
cannot include input
    dependent code it they are to come out right in a computer other
than the author's one.
    The following example is taken from the LaTeX Companion itself and belongs
    to the package varioref (the definition for \reftextafter):

       \cyrn\cyra\ \cyrs\cyrl\cyre\cyrd\cyru\cyryu\cyrshch\cyre\cyrshrt ...

       `Clearly, no one wants to type text like this on a regular
basis. Nevertheless, it has
       the advantage of being universally portable.'

    There are a few exceptions to this:

        a) Characters within comments written in the author's native
language. Since they appear
      at comments and are thus ignored this is not a problem. Note
that even invalid characters
      may appear within comments. Neither TeX nor LuaTeX will complay
about the following code.

                \catcode`X=15  %Invalid
                \relax %X?
                \end

        b) Code dealing with encodings, either input or output.
      As for the .def files of the latex inputenc package, as I
pointed they do not include
      non-ascii characters but rather lines like
\DeclareInputText{140}{\OE}. The same is true
      for the output encodings---the fontenc package:
\DeclareTextSymbol{\OE}{T1}{215}. In latex,
      they made the decision not to include non-ascii bytes in any
file. I don't know how
      context does.
      So before trying to solve unexisting problems, whereby we may
add more troubles
      than we solve, let's investigate whether the problem actually exists.
      I did in LaTeX's base folder the following: >copy *.* all.tex,
and then used a text editor
      to find bytes >=128, and found none.

        c) Single-character control sequences or private use of the
characters in the package.
      I made a more radical text than the previous one. I joined all
the files from my LaTeX folder
      and searched for >=128 bytes. I found some very few within
comments (author names)
      and appart from that only a pair of single-character control
sequences in the package
      usr.sty: \?, \? and \?.
      I then performed the same test for the babel files and found none.


    For the very few packages using some non-acii characters, if they
are still maintained
    by their authors, and they want them to be usable both with old
and new documents,
    they may simply write

       \ifdefined\directlua
       \directlua0{mypackage_previous_pibuffer=callback.find('process_input_buffer')}
       \input byte-to-utf8.ltex
       \fi

       <the file contents>

       \ifdefined\directlua
       \directlua0{callback.register('process_input_buffer',mypackage_previous_pibuffer)}
       \fi

    The same can be said for authors that wrote packages for
themselves or a restricted set of
    nearby users where an input encoding can be assumed and thus they
may include many
    non-ascii characters.

    Finally, just in case there remains some frozen packages with
non-ascii code, the
    documentation for the user could simply include something like
this (I exemplify with LaTeX):

    >>In order to use a package you write
    >>
    >>   \usepackage{<packagename>}
    >>
    >>for exampmle, usepackage{fancyhdr}. There may be some old
packages from where you
    >>get the strange message: `Text line contains invalid utf-8
sequence.' If that happens then
    >>write instead
    >>
    >>   \useoldpackage{<packagename>}

    And a similar one with \oldinput{<pkgn>} for \input <pckgn>. The
definition of both these
    would be something like:

     \def\oldinput#1{
       \ifdefined\directlua
       \directlua0{previous_pibuffer=callback.find('process_input_buffer')}
       \input byte-to-utf8.ltex
       \def\next{\input #1%
         \directlua0{callback.register('process_input_buffer',previous_pibuffer)
       }%
       \else
       \def\next{\input #1}
       \fi
       \next
     }

     \def\useoldpackage{\let\InputIfFileExists\OldInputIfFileExists}
     \def\OldInputIfFileExists#1#2{\let\input\oldinput\@@InputIfFileExists{#1}{#2}%
       \let\input\@@input\let\InputIfFileExists\@@InputIfFileExists}

     (Actually, it has to be a bit more elborate since a bold use of
previous_pibuffer like
     this will not work for nested \oldinput's)


%%%%%%%%%%%%%%%%%%%%%%%

I tested the second scenario above. I saved the refered (in my
previous message) book with utf-8 encoding, did nothing more and it
compiled perfectly. My code may write non-ascii to files, but since it
use utf-8 and luatex, then that code is itself utf-8. Note that
inputenc is still necessary, but that is just because the LICR objects
are used by packages, in particular by fontenc. However, for a future
lualatex the ICR could just be the utf-8 itself, except for \SS and
some others. But this is a problem more of latex itself that of the
input encoding.
As for the output encoding (i.e., the font), while we still use
256-char limited .tfm files,
characters still need to be active.

--Javier A.

From javier at digi21.eu  Fri Feb 20 14:27:44 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Fri, 20 Feb 2009 14:27:44 +0100
Subject: [luatex] Font encoding
Message-ID: <5088e64f0902200527y30ba3e79u80e31d696193452e@mail.gmail.com>

The files with the definitions for the different font encodings would
containg mappings from the utf-8 characters and a few control
sequences (like \SS) to the font encoding. A LaTeX like style would
look like

\catcode`?=\active   %If this is not itself contained in the next macro
\DeclareTextSymbol{?}{T1}{215}

A more direct approach would just be

\catcode`?=\active
\def?{\char215 }

From javier at digi21.eu  Fri Feb 20 14:31:08 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Fri, 20 Feb 2009 14:31:08 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
Message-ID: <5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>

Here is the right code the other day I wrote by heart and included
some errors. Just is someones wants to copy-paste it and use it.

\directlua0{
function byte_to_utf8(c)
  local b=string.byte(c)
  if b<128 then
    return c
  end
  if b<192 then
    return string.char(194, b)
  else
    return string.char(195, b-64)
  end
end

callback.register('process_input_buffer',
function(buffer)
  return string.gsub(buffer,"(.)",byte_to_utf8)
end)
}

--Javier A.

From elie.roux at telecom-bretagne.eu  Fri Feb 20 14:42:06 2009
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 20 Feb 2009 14:42:06 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
	<5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
Message-ID: <499EB32E.90104@telecom-bretagne.eu>

Javier M?gica a ?crit :
>   if b<128 then
>     return c
>   end
>   if b<192 then
>     return string.char(194, b)
>   else
>     return string.char(195, b-64)
>   end

I'm using your older piece of code, which works the same (for the tests 
I have made so far) :

unicode.utf8.char(string.bytes(b)) (IIRC)

is there a difference?

Also, is it possible to convert a fake UTF-8 char in the good range in a 
8-bit character simply, or do we have to use a table?
-- 
Elie

From news2 at nililand.de  Fri Feb 20 15:24:24 2009
From: news2 at nililand.de (Ulrike Fischer)
Date: Fri, 20 Feb 2009 15:24:24 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
Message-ID: <1lfmn11jyt9r3$.dlg@nililand.de>

Am Fri, 20 Feb 2009 14:26:30 +0100 schrieb Javier M?gica:

>>if you write something like \protect ? ...
> 
> The \protect doesn't make any difference. The relevant fact is that
> the ? is, in Windows for instance, FC, ie, 11111100, and in a  utf-8
> file that byte is not a syngle unit, so it is not a "Byte" in the
> sense of minimun significant unit.

The \protect is a mean for testing what happens if files written by 
luatex (which are utf8) contains non-ascii chars: 

\directlua0{
function byte_to_utf8(c)
  local b=string.byte(c)
  if b<128 then
    return c
  end
  if b<192 then
    return string.char(194, b)
  else
    return string.char(195, b-64)
  end
end

callback.register('process_input_buffer',
function(buffer)
  return string.gsub(buffer,"(.)",byte_to_utf8)
end)
}

\documentclass{article}
\usepackage[ansinew]{inputenc}
\begin{document}
\tableofcontents
\section{???\protect ? \protect ?}
\end{document}

This doesn't work: The section titel is ok, but the table of 
contents is not. 

This means that you can't process documents which writes external 
files in "verbatim mode" if this files contains non-ascii chars, 
e.g. if you use in beamer the fragile option for a frame, or if you 
use the filecontents-environment.

-- 
Ulrike Fischer 


From listas at tex-tipografia.com  Fri Feb 20 17:16:06 2009
From: listas at tex-tipografia.com (listas at tex-tipografia.com)
Date: Fri, 20 Feb 2009 16:16:06 -0000 (UTC)
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
Message-ID: <59719.193.41.227.4.1235146566.squirrel@webmail.tex-tipografia.com>

Hola, tocayo:

> As for the output encoding (i.e., the font), while we still use
> 256-char limited .tfm files,
> characters still need to be active.

I don't think so. My first attempts for a lua-fontenc are
based in a callback which can combine in on the fly fonts
of the same family in a "Unicode" font -- combining T1 and
TS1 can be done very straightforwardly, but no doubt other
configurations can be set up easily.

Several years ago, I had to write some code for Omega (for
a firm specialized in technical documentation) and this
approach worked pretty well without requiring active chars.
The fonts were built with a external utility I wrote in
Python, but now that can be done inside LuaTeX. My goal
was to implement this approach in the lua-fontenc and in
fact I posted some code a few months ago to lua-dev.

Chao
Javier


From luigi.scarso at gmail.com  Sat Feb 21 08:23:00 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 21 Feb 2009 08:23:00 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
	on TL2008
In-Reply-To: <fe8d59da0902200128g28c7f54dic0c9f3aa081f604e@mail.gmail.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
	<499E6B54.2030904@elvenkind.com>
	<fe8d59da0902200128g28c7f54dic0c9f3aa081f604e@mail.gmail.com>
Message-ID: <fe8d59da0902202323h524cd943k80294291ee9514e5@mail.gmail.com>

On Fri, Feb 20, 2009 at 10:28 AM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Fri, Feb 20, 2009 at 9:35 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
>>
>>
>> luigi scarso wrote:
>>> Perhaps not so important:
>>>
>>> $>/opt/TeXLive2008/texlive/2008/bin/i386-linux# fmtutil --byfmt pdflualatex
>>> fmtutil: running `luatex -ini   -jobname=pdflualatex
>>> -progname=pdflualatex pdflualatex.ini' ...
>>> This is LuaTeX, Version snapshot-0.33.1-2009022008 (Web2C 7.5.7) (INITEX)
>>>
>>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/latexconfig/pdflualatex.ini
>>> (/opt/TeXLive2008/texlive/2008/texmf/tex/generic/config/pdftexconfig.tex)
>>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/base/latex.ltxSegmentation
>>> fault
>>
>> No crash here. Can you check the backtrace in a debugger?
No crash on another machine with rev 1886;
but crash on the prev. server with 1886 too.

What can be ?
LOCALE settings ?
-- 
luigi

From taco at elvenkind.com  Sat Feb 21 09:46:21 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 21 Feb 2009 09:46:21 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
 on TL2008
In-Reply-To: <fe8d59da0902202323h524cd943k80294291ee9514e5@mail.gmail.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>	<499E6B54.2030904@elvenkind.com>	<fe8d59da0902200128g28c7f54dic0c9f3aa081f604e@mail.gmail.com>
	<fe8d59da0902202323h524cd943k80294291ee9514e5@mail.gmail.com>
Message-ID: <499FBF5D.7050308@elvenkind.com>

luigi scarso wrote:
> On Fri, Feb 20, 2009 at 10:28 AM, luigi scarso <luigi.scarso at gmail.com> wrote:
>> On Fri, Feb 20, 2009 at 9:35 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
>>>
>>> luigi scarso wrote:
>>>> Perhaps not so important:
>>>>
>>>> $>/opt/TeXLive2008/texlive/2008/bin/i386-linux# fmtutil --byfmt pdflualatex
>>>> fmtutil: running `luatex -ini   -jobname=pdflualatex
>>>> -progname=pdflualatex pdflualatex.ini' ...
>>>> This is LuaTeX, Version snapshot-0.33.1-2009022008 (Web2C 7.5.7) (INITEX)
>>>>
>>>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/latexconfig/pdflualatex.ini
>>>> (/opt/TeXLive2008/texlive/2008/texmf/tex/generic/config/pdftexconfig.tex)
>>>> (/opt/TeXLive2008/texlive/2008/texmf-dist/tex/latex/base/latex.ltxSegmentation
>>>> fault
>>> No crash here. Can you check the backtrace in a debugger?
> No crash on another machine with rev 1886;
> but crash on the prev. server with 1886 too.
> 
> What can be ?
> LOCALE settings ?

Maybe. I really need the stack backtrace of the crash to be able to
help further.

Best wishes,
Taco



From luigi.scarso at gmail.com  Sat Feb 21 10:43:14 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 21 Feb 2009 10:43:14 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
	on TL2008
In-Reply-To: <499FBF5D.7050308@elvenkind.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
	<499E6B54.2030904@elvenkind.com>
	<fe8d59da0902200128g28c7f54dic0c9f3aa081f604e@mail.gmail.com>
	<fe8d59da0902202323h524cd943k80294291ee9514e5@mail.gmail.com>
	<499FBF5D.7050308@elvenkind.com>
Message-ID: <fe8d59da0902210143l6b448a5encb268c488195a0ce@mail.gmail.com>

> Maybe. I really need the stack backtrace of the crash to be able to
> help further.
>
> Best wishes,
> Taco
ok, off list


-- 
luigi

From nomosnomos at gmail.com  Sat Feb 21 13:34:07 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Sat, 21 Feb 2009 21:34:07 +0900
Subject: [luatex] bug related to attribute and math
In-Reply-To: <499E6D6F.6000905@elvenkind.com>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>
	<499E6D6F.6000905@elvenkind.com>
Message-ID: <bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>

2009/2/20 Taco Hoekwater <taco at elvenkind.com>:
>
>
> Dohyun Kim wrote:
>> HI,
>>
>> On compiling following tex code, I get failed assertion error.
>>
>> $ cat t.tex
>> \attributedef\xyz 11
>> \xyz-1
>
> You can't really assign negative values to an attribute (at the
> moment), doing so is the same as unsetting it. The assertion failure
> is a bug but I won't fix that right now since I intend to lift that
> limitation soon.
>

OK.  However, I still get assertion failure even after modifying my code,
Is my understanding about attribute totally wrong? or is this luatex's bug?

$ cat t.tex
\attributedef\xyz11
{\xyz1 }
$\dot{}$
\bye

$ luatex t.tex
This is LuaTeX, Version snapshot-0.33.1-2009022109 (Web2C 7.5.7)
(t.tex../../../../src/texk/web2c/luatexdir/tex/mlist.c:1891: failed
assertion `type(varmem[((q)+1)].hh.v.LH)==attribute_list_node'
Abort trap

$ luatex -version
This is LuaTeX, Version snapshot-0.33.1-2009022109, build 1886

Best,
Dohyun Kim

From pragma at wxs.nl  Sat Feb 21 13:48:19 2009
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 21 Feb 2009 13:48:19 +0100
Subject: [luatex] bug related to attribute and math
In-Reply-To: <bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>	<499E6D6F.6000905@elvenkind.com>
	<bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>
Message-ID: <499FF813.5060302@wxs.nl>

Dohyun Kim wrote:

> OK.  However, I still get assertion failure even after modifying my code,
> Is my understanding about attribute totally wrong? or is this luatex's bug?

it's a bug (the code runs ok in context but asserts in plain)

it might be related to \dot being an accent

for the moment, patience is the only solution (although you made a nice 
small example, which normally helps a lot to nail down the problem)

btw, there are some other known problems with attributes in math (ref 
counting)


Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Sat Feb 21 13:53:37 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 21 Feb 2009 13:53:37 +0100
Subject: [luatex] bug related to attribute and math
In-Reply-To: <499FF813.5060302@wxs.nl>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>	<499E6D6F.6000905@elvenkind.com>	<bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>
	<499FF813.5060302@wxs.nl>
Message-ID: <499FF951.4010308@elvenkind.com>

Hans Hagen wrote:
> Dohyun Kim wrote:
> 
>> OK.  However, I still get assertion failure even after modifying my code,
>> Is my understanding about attribute totally wrong? or is this luatex's 
>> bug?
> 
> it's a bug (the code runs ok in context but asserts in plain)

fixed in #1888

Best wishes,
Taco

From nomosnomos at gmail.com  Sat Feb 21 14:44:09 2009
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Sat, 21 Feb 2009 22:44:09 +0900
Subject: [luatex] bug related to attribute and math
In-Reply-To: <499FF951.4010308@elvenkind.com>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>
	<499E6D6F.6000905@elvenkind.com>
	<bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>
	<499FF813.5060302@wxs.nl> <499FF951.4010308@elvenkind.com>
Message-ID: <bfeb3bf10902210544u16fcde79i6aa74e875e9da04e@mail.gmail.com>

2009/2/21 Taco Hoekwater <taco at elvenkind.com>:
> Hans Hagen wrote:
>>
>> Dohyun Kim wrote:
>>
>>> OK.  However, I still get assertion failure even after modifying my code,
>>> Is my understanding about attribute totally wrong? or is this luatex's
>>> bug?
>>
>> it's a bug (the code runs ok in context but asserts in plain)
>
> fixed in #1888
>

What a quick response.  Thanks a lot.

In fact, another code fails as well in a quite similar situation.
Probably this problem may be already known to you.

$ cat t.tex
\attributedef\xyz11
{\xyz1 }
${2\over 3}$
\bye

$ luatex t
This is LuaTeX, Version snapshot-0.33.1-2009022122 (Web2C 7.5.7)
(t.tex../../../../src/texk/web2c/luatexdir/tex/mlist.c:1661: failed
assertion `type(att)==attribute_list_node'
Abort trap

$ luatex -version
This is LuaTeX, Version snapshot-0.33.1-2009022122, build 1889

Best,
Dohyun Kim

From taco at elvenkind.com  Sat Feb 21 15:18:49 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 21 Feb 2009 15:18:49 +0100
Subject: [luatex] bug related to attribute and math
In-Reply-To: <bfeb3bf10902210544u16fcde79i6aa74e875e9da04e@mail.gmail.com>
References: <bfeb3bf10902200041v6bd0ea21m716da6d8aa250517@mail.gmail.com>	<499E6D6F.6000905@elvenkind.com>	<bfeb3bf10902210434v5848e077q7c301467f339ca15@mail.gmail.com>	<499FF813.5060302@wxs.nl>
	<499FF951.4010308@elvenkind.com>
	<bfeb3bf10902210544u16fcde79i6aa74e875e9da04e@mail.gmail.com>
Message-ID: <49A00D49.6020905@elvenkind.com>

Dohyun Kim wrote:
> 2009/2/21 Taco Hoekwater <taco at elvenkind.com>:
>> Hans Hagen wrote:
>>> Dohyun Kim wrote:
>>>
>>>> OK.  However, I still get assertion failure even after modifying my code,
>>>> Is my understanding about attribute totally wrong? or is this luatex's
>>>> bug?
>>> it's a bug (the code runs ok in context but asserts in plain)
>> fixed in #1888
>>
> 
> What a quick response.  Thanks a lot.
> 
> In fact, another code fails as well in a quite similar situation.
> Probably this problem may be already known to you.

Not that one exactly, but I saw it coming, yes ;-)
There are likely more bugs like these, I'll do a thorough scan on
monday. Meanwhile, this one is patched by #1891.

Best wishes,
Taco

From javier at digi21.eu  Mon Feb 23 10:28:40 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 23 Feb 2009 10:28:40 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
	<5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
Message-ID: <5088e64f0902230128p6675a219qa4ba1754e5651aea@mail.gmail.com>

>\tableofcontents
>\section{???\protect ? \protect ?}
>This doesn't work
>This means that you can't process documents which writes external
>files in "verbatim mode"

You are right. But you can either use a callback for writting (if it
is possible) or, which I think better, simply write the
push-register-pop of process_input_buffer which I proposed to the
file, but now registering a callback that does nothing:

\directlua0{myfile_previous_pibuffer=callback.find('process_input_buffer')}
callback.register('process_input_buffer',nil)

<the file contents>

\directlua0{callback.register('process_input_buffer',mypackage_previous_pibuffer)}


In the main file you would either still include the

callback.register('process_input_buffer',
function(buffer)
  return string.gsub(buffer,"(.)",byte_to_utf8)
end)

or save it with utf-8 encoding.

--Javier A.

From javier at digi21.eu  Mon Feb 23 10:32:22 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 23 Feb 2009 10:32:22 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902230128p6675a219qa4ba1754e5651aea@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
	<5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
	<5088e64f0902230128p6675a219qa4ba1754e5651aea@mail.gmail.com>
Message-ID: <5088e64f0902230132q68303c30g9f3dd6ce95dc97d6@mail.gmail.com>

?lie Roux a ?crit:

>I'm using your older piece of code, which works the same (for the tests
>I have made so far) :

>unicode.utf8.char(string.bytes(b)) (IIRC)

>is there a difference?

So there is not. You probably know more about lua than me. I even
didn't know about the existence of  unicode.utf8.char.

From javier at digi21.eu  Mon Feb 23 10:37:34 2009
From: javier at digi21.eu (=?ISO-8859-1?Q?Javier_M=FAgica?=)
Date: Mon, 23 Feb 2009 10:37:34 +0100
Subject: [luatex] lua-inputenc
In-Reply-To: <5088e64f0902230132q68303c30g9f3dd6ce95dc97d6@mail.gmail.com>
References: <5088e64f0902180253r1d701589h60e29f5090f9f3a6@mail.gmail.com>
	<5088e64f0902200526v1f51161w217ffd2c6ed8e593@mail.gmail.com>
	<5088e64f0902200531n3efca837p4b96eb4e8e73e927@mail.gmail.com>
	<5088e64f0902230128p6675a219qa4ba1754e5651aea@mail.gmail.com>
	<5088e64f0902230132q68303c30g9f3dd6ce95dc97d6@mail.gmail.com>
Message-ID: <5088e64f0902230137x7395232w6c83968d95b22932@mail.gmail.com>

Hola Javier:

>> As for the output encoding (i.e., the font), while we still use
>> 256-char limited .tfm files,
>> characters still need to be active.

>I don't think so.

Good news to me!!

I hadn't check the lua-dev list for some months. When I came back I
just read some of the later messages.
I'll surely find time time to test your code. It's worth the reward
(No more active characters!)

From luigi.scarso at gmail.com  Tue Feb 24 07:49:46 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Feb 2009 07:49:46 +0100
Subject: [luatex] pdflualatex segmentation fault with luatex trunk 1880
	on TL2008
In-Reply-To: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
References: <fe8d59da0902200030g16e3abf4y42f9a1f7934d855d@mail.gmail.com>
Message-ID: <fe8d59da0902232249n19937431s5de558f7703bace5@mail.gmail.com>

Solved -- I was using a wrong binary --

-- 
luigi

From taco at elvenkind.com  Tue Feb 24 15:28:51 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Feb 2009 15:28:51 +0100
Subject: [luatex] luatex beta 0.35.0
Message-ID: <49A40423.6090609@elvenkind.com>

Hi,

I have just uploaded luatex 0.35.0.

This is a beta in the process towards 0.40.0, the version that
will be included in texlive 2009. We have two big developments
underway right now:

* Hartmut is working on the DVI and PDF output, aiming for full
  support of all direction specifiers in both modes.
* Taco is working on extending the math engine, aiming for complete
  support of the OpenType and MathML concepts.

Both developments are well under way, but neither is perfect yet.
The main goal of this release is to give Hans' ConTeXt mkiv code
and its users a chance to catch up and test the progress so far.


What's new:

* The math handling portions of LuaTeX are converted to C code,
  and extended to support Unicode math. There are a great many
  related changes, see the new Math chapter in the manual for
  details.
* A nasty bug in the paragraph breaking routine was fixed.
  (All lines except the first one were believed to be wider then
  they really were. This affected which nodes were considered
  as active breakpoints)
* Various changes to the PDF backend to make it support non-latin
  directions.
* Fixed the behaviour of the page offsets. Placement of the output
  on the physical page should now work correctly in all directions,
  both in DVI and PDF.
  There now are \pageleftoffset and \pagetopoffset primitives.
* fontforge.apply_featurefile() was broken since 0.31.0
* The lua profiler library is added.
* The included lua filesystem library is now 1.4.1.
* Reading of pk files fixed.
* An optional space afer a <direction specifier> for \textdir c.s.
  is ignored from  now on.
* \bodydir and \pagedir can now be (re)set even after the first
  page has been output.
* The new callback mlist_to_hlist can be used to intercept the
  normal conversion of math lists to horizontal lists.
* The programs ttf2afm and pdftosrc are removed from the luatex
  distribution (these belong to pdftex).
* fontforge.open() now uses much less memory when opening large
  (CJK) fonts.
* The included libpng is now 1.2.35.
* Quite a lot of smaller bugfixes and cleanups (as usual).


The archives (just binaries at this time, hopefully there will be a
source package later) can be downloaded from supelec as usual:

        http://foundry.supelec.fr/projects/luatex/

If you need the sources, please check out via anonymous svn:

  svn co svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.31.3

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Taco



From luigi.scarso at gmail.com  Tue Feb 24 15:37:14 2009
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 24 Feb 2009 15:37:14 +0100
Subject: [luatex] luatex beta 0.35.0
In-Reply-To: <49A40423.6090609@elvenkind.com>
References: <49A40423.6090609@elvenkind.com>
Message-ID: <fe8d59da0902240637qf191712kfc45ff06868715a9@mail.gmail.com>

> ?svn co svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.31.3

svn checkout svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.35.0

-- 
luigi

From taco at elvenkind.com  Tue Feb 24 15:45:58 2009
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Feb 2009 15:45:58 +0100
Subject: [luatex] luatex beta 0.35.0
In-Reply-To: <fe8d59da0902240637qf191712kfc45ff06868715a9@mail.gmail.com>
References: <49A40423.6090609@elvenkind.com>
	<fe8d59da0902240637qf191712kfc45ff06868715a9@mail.gmail.com>
Message-ID: <49A40826.1090101@elvenkind.com>



luigi scarso wrote:
>>  svn co svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.31.3
> 
> svn checkout svn://scm.foundry.supelec.fr/svn/luatex/tags/beta-0.35.0

sorry.



From aelmahmoudy at users.sourceforge.net  Fri Feb 27 10:07:10 2009
From: aelmahmoudy at users.sourceforge.net (=?utf-8?B?2KPYrdmF2K8g2KfZhNmF2K3ZhdmI2K/Zig==?=)
Date: Fri, 27 Feb 2009 11:07:10 +0200
Subject: [luatex] Problem with bib file using IEEEtran style
Message-ID: <20090227090710.GB8686@ants.selfip.net>

Hello,

  I get the following error with a certain bib file that uses IEEEtran style:

(IEEEbib.bbl
! Missing $ inserted.
<inserted text>
                $
l.29 ...rkprogram/Report_WorkItem.asp?WKI_ID=6021}


  Please find the IEEEbib.tex etsi_en_300_429.bib & IEEEbib.log files attached.
  To reproducte the problem, run:

  pdflualatex IEEEbib
  bibtex IEEEbib
  pdflualatex IEEEbib

  Note:
  * The attached log file, is for the second run of pdflualatex.
  * BibTeX, Version 0.99c.
  * IEEEtran.bst version 1.13 (2008/09/30)

-- 
 ???? ???????? (Ahmed El-Mahmoudy)
  Digital design engineer
 GPG KeyID: 0x9DCA0B27 (@ subkeys.pgp.net)
 GPG Fingerprint: 087D 3767 8CAC 65B1 8F6C  156E D325 C3C8 9DCA 0B27
-------------- next part --------------
A non-text attachment was scrubbed...
Name: IEEEbib.tex
Type: text/x-tex
Size: 207 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090227/457dfc73/attachment.bin 
-------------- next part --------------
This is LuaTeX, Version snapshot-0.30.3-2009022610 (Web2C 7.5.7) (format=pdflatex 2009.2.26)  27 FEB 2009 11:06
**IEEEbib
(IEEEbib.tex
LaTeX2e <2005/12/01>
Babel <v3.8h> and hyphenation patterns for english, usenglishmax, dumylang, noh
yphenation, arabic, farsi, loaded.
(/usr/share/texmf-texlive/tex/latex/base/report.cls
Document Class: report 2005/09/16 v1.4f Standard LaTeX document class
(/usr/share/texmf-texlive/tex/latex/base/size10.clo
File: size10.clo 2005/09/16 v1.4f Standard LaTeX file (size option)
)
\c at part=\count79
\c at chapter=\count80
\c at section=\count81
\c at subsection=\count82
\c at subsubsection=\count83
\c at paragraph=\count84
\c at subparagraph=\count85
\c at figure=\count86
\c at table=\count87
\abovecaptionskip=\skip41
\belowcaptionskip=\skip42
\bibindent=\dimen102
) (IEEEbib.aux)
LaTeX Font Info:    Checking defaults for OML/cmm/m/it on input line 4.
LaTeX Font Info:    ... okay on input line 4.
LaTeX Font Info:    Checking defaults for T1/cmr/m/n on input line 4.
LaTeX Font Info:    ... okay on input line 4.
LaTeX Font Info:    Checking defaults for OT1/cmr/m/n on input line 4.
LaTeX Font Info:    ... okay on input line 4.
LaTeX Font Info:    Checking defaults for OMS/cmsy/m/n on input line 4.
LaTeX Font Info:    ... okay on input line 4.
LaTeX Font Info:    Checking defaults for OMX/cmex/m/n on input line 4.
LaTeX Font Info:    ... okay on input line 4.
LaTeX Font Info:    Checking defaults for U/cmr/m/n on input line 4.
LaTeX Font Info:    ... okay on input line 4.

(IEEEbib.bbl
! Missing $ inserted.
<inserted text> 
                $
l.29 ...rkprogram/Report_WorkItem.asp?WKI_ID=6021}
                                                  
? Q
OK, entering \batchmode...
LaTeX Font Info:    External font `cmex10' loaded for size
(Font)              <7> on input line 29.
LaTeX Font Info:    External font `cmex10' loaded for size
(Font)              <5> on input line 29.
! Missing $ inserted.
<inserted text> 
                $
l.31 
     
I've inserted a begin-math/end-math symbol since I think
you left one out. Proceed, with fingers crossed.

! Missing } inserted.
<inserted text> 
                }
l.31 
     
I've inserted something that you may have forgotten.
(See the <inserted text> above.)
With luck, this will get me unwedged. But if you
really didn't forget anything, try typing `2' now; then
my insertion and my current dilemma will both disappear.


Underfull \hbox (badness 1460) in paragraph at lines 27--31
\OT1/cmr/m/n/10 Std. EN 300 429, Apr. 1998. [On-line]. Avail-able:
 []


Underfull \hbox (badness 10000) in paragraph at lines 27--31
\OT1/cmr/m/n/10 http://webapp.etsi.org/workprogram/Report$[]\OML/cmm/m/it/10 or
kItem:asp\OT1/cmr/m/n/10 ?\OML/cmm/m/it/10 WKI[]D \OT1/cmr/m/n/10 =
 []

! Extra }, or forgotten \endgroup.
\par ...m \@noitemerr {\@@par }\fi \else {\@@par }
                                                  \fi 
l.31 
     
I've deleted a group-closing symbol because it seems to be
spurious, as in `$x}$'. But perhaps the } is legitimate and
you forgot something else, as in `\hbox{$x}'. In such cases
the way to recover is to insert both the forgotten and the
deleted material, e.g., by typing `I$}'.

)

LaTeX Warning: Citation `ETSI:EN_300_429' on page 1 undefined on input line 7.

 [1


{/var/lib/texmf/fonts/map/pdftex/updmap/pdftex.map}] (IEEEbib.aux)

LaTeX Warning: There were undefined references.


LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.

 ) 
Here is how much of TeX's memory you used:
 242 strings out of 95324
 2627 string characters out of 1185152
 100000,89155 words of node,token memory allocated

node memory in use: 270 words out of 100000
rapidly available: 2:12, 3:14, 4:121, 5:241, 6:8, 7:36, 9:18, 10:38 nodes
current usage: 2 hlist, 1 vlist, 1 rule, 2 glue, 40 glue_spec, 1 write, 2 dir n
odes
 3632 multiletter control sequences out of 65536+50000
 29 fonts using 246093 bytes
 23i,4n,21p,147b,165s stack positions out of 5000i,500n,6000p,200000b,5000s
</usr/share/texmf-texlive/fonts/type1/bluesky/cm/cmbx10.pfb></usr/share/texmf-t
exlive/fonts/type1/bluesky/cm/cmbx12.pfb></usr/share/texmf-texlive/fonts/type1/
bluesky/cm/cmmi10.pfb></usr/share/texmf-texlive/fonts/type1/bluesky/cm/cmmi7.pf
b></usr/share/texmf-texlive/fonts/type1/bluesky/cm/cmr10.pfb></usr/share/texmf-
texlive/fonts/type1/bluesky/cm/cmti10.pfb>
Output written on IEEEbib.pdf (1 page, 33942 bytes).
PDF statistics:
 30 PDF objects out of 1000 (max. 8388607)
 0 named destinations out of 1000 (max. 131072)
 1 words of extra memory for PDF output out of 10000 (max. 10000000)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: etsi_en_300_429.bib
Type: text/x-bibtex
Size: 431 bytes
Desc: not available
Url : http://tug.org/pipermail/luatex/attachments/20090227/457dfc73/attachment-0001.bin 

From Robin.Fairbairns at cl.cam.ac.uk  Fri Feb 27 10:21:46 2009
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 27 Feb 2009 09:21:46 +0000
Subject: [luatex] Problem with bib file using IEEEtran style
In-Reply-To: Your message of Fri, 27 Feb 2009 11:07:10 +0200.
	<20090227090710.GB8686@ants.selfip.net> 
Message-ID: <29914.1235726506@hehe.cl.cam.ac.uk>

???? ???????? wrote:

> @standard{ETSI:EN_300_429,
> title="Digital Video Broadcasting (DVB); Framing Structure, Channel Coding and 
>        Modulation for Cable Systems",
> organization="ETSI",
> number="EN 300 429",
> publisher="European Telecommunications Standards Institute",
> year=1998,
> month=apr,
> version="1.2.1",
> URL="http://webapp.etsi.org/workprogram/Report_WorkItem.asp?WKI_ID=6021",
> author={},
> keywords="broadcasting;cable;digital;dvb,mpeg;tv;video",
> }

this is a list about the development of luatex; you have a "generic" tex
problem there.  i presume you're using an ieeetran-related bibstyle; i'm
not an expert in that -- the author of ieeetran only (to my knowledge)
reads comp.text.tex, so you'll have to do with non-expert advice.

without _knowledge_, i would guess you need to include the url in an
appropriate command:

  URL="\url{http://webapp.etsi.org/workprogram/Report_WorkItem.asp?WKI_ID=6021}"

that needs at least url.sty, but if you're using hyperref, that also
loads url.sty (so you don't need to).

robin

From aelmahmoudy at users.sourceforge.net  Fri Feb 27 10:30:40 2009
From: aelmahmoudy at users.sourceforge.net (=?utf-8?B?2KPYrdmF2K8g2KfZhNmF2K3ZhdmI2K/Zig==?=)
Date: Fri, 27 Feb 2009 11:30:40 +0200
Subject: [luatex] Problem with bib file using IEEEtran style
In-Reply-To: <20090227090710.GB8686@ants.selfip.net>
References: <20090227090710.GB8686@ants.selfip.net>
Message-ID: <20090227093040.GC8686@ants.selfip.net>

Hello,

  I just solved the problem by adding an empty note field (note="",) in the bib 
  file just after the URL field.

-- 
 ???? ???????? (Ahmed El-Mahmoudy)
  Digital design engineer
 GPG KeyID: 0x9DCA0B27 (@ subkeys.pgp.net)
 GPG Fingerprint: 087D 3767 8CAC 65B1 8F6C  156E D325 C3C8 9DCA 0B27

From aelmahmoudy at users.sourceforge.net  Fri Feb 27 10:47:06 2009
From: aelmahmoudy at users.sourceforge.net (=?utf-8?B?2KPYrdmF2K8g2KfZhNmF2K3ZhdmI2K/Zig==?=)
Date: Fri, 27 Feb 2009 11:47:06 +0200
Subject: [luatex] Problem with bib file using IEEEtran style
In-Reply-To: <20090227093040.GC8686@ants.selfip.net>
References: <20090227090710.GB8686@ants.selfip.net>
	<20090227093040.GC8686@ants.selfip.net>
Message-ID: <20090227094706.GD8686@ants.selfip.net>

Hello,

On Fri, Feb 27, 2009 at 11:30:40AM +0200, ???? ???????? wrote:
>   I just solved the problem by adding an empty note field (note="",) in the bib 
>   file just after the URL field.
---end quoted text---

  Ok, it turned out that the empty note field did nothing, it's the use 
  of hyperref package that solved it ! Thanks to Robin's reply !

-- 
 ???? ???????? (Ahmed El-Mahmoudy)
  Digital design engineer
 GPG KeyID: 0x9DCA0B27 (@ subkeys.pgp.net)
 GPG Fingerprint: 087D 3767 8CAC 65B1 8F6C  156E D325 C3C8 9DCA 0B27

