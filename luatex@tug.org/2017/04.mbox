From kmaeda at kmaeda.net  Thu Apr  6 01:50:38 2017
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Thu, 6 Apr 2017 08:50:38 +0900
Subject: [luatex] fontloader causes segmentation fault by Source Han Serif
Message-ID: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>

Hi all

Recently, Adobe released new CJK serif fonts under OFL-1.1 named Source Han Serif.

I downloaded the fonts from GitHub repository
https://github.com/adobe-fonts/source-han-serif/tree/release/OTF/Japanese
and tried the following one line Lua code

fontloader.open('SourceHanSerif-Regular.otf')

Then, texlua caused segmentation fault.
Because the luatexja package uses fontloader.open(),
one cannot use Source Han Serif with luatexja.


Best regards
Kazuki Maeda

From luatex at nililand.de  Thu Apr  6 13:07:30 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 6 Apr 2017 13:07:30 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
Message-ID: <o2ghspkmgss2$.dlg@nililand.de>

Am Thu, 6 Apr 2017 08:50:38 +0900 schrieb Kazuki Maeda:

> Hi all
> 
> Recently, Adobe released new CJK serif fonts under OFL-1.1 named Source Han Serif.
> 
> I downloaded the fonts from GitHub repository
> https://github.com/adobe-fonts/source-han-serif/tree/release/OTF/Japanese
> and tried the following one line Lua code
> 
> fontloader.open('SourceHanSerif-Regular.otf')
> 
> Then, texlua caused segmentation fault.
> Because the luatexja package uses fontloader.open(),
> one cannot use Source Han Serif with luatexja.

It crashes with luatex 1.0.4 but not with 1.0.5.


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From kmaeda at kmaeda.net  Thu Apr  6 13:28:42 2017
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Thu, 6 Apr 2017 20:28:42 +0900
Subject: [luatex] fontloader causes segmentation fault by Source Han
 Serif
In-Reply-To: <o2ghspkmgss2$.dlg@nililand.de>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <o2ghspkmgss2$.dlg@nililand.de>
Message-ID: <20170406202842.c62f594fb49bff6eac34b472@kmaeda.net>

Thank you for testing.

On Thu, 6 Apr 2017 13:07:30 +0200
Ulrike Fischer <luatex at nililand.de> wrote:

> It crashes with luatex 1.0.4 but not with 1.0.5.

Really?
I'm using luatex 1.0.5 (rev 6307), but it crashes.

% texlua --version
This is LuaTeX, Version 1.0.5 (TeX Live 2017)
...

% ls -l SourceHanSerif-Regular.otf
-rw-r--r-- 1 kmaeda kmaeda 23607996 Apr  6 08:40 SourceHanSerif-Regular.otf
% cat test.lua
fontloader.open('SourceHanSerif-Regular.otf')
% texlua test.lua
zsh: segmentation fault  texlua test.lua


I'm trying on Linux x86_64.


Best regards
Kazuki Maeda

From luatex at nililand.de  Thu Apr  6 14:05:48 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 6 Apr 2017 14:05:48 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <o2ghspkmgss2$.dlg@nililand.de>
 <20170406202842.c62f594fb49bff6eac34b472@kmaeda.net>
Message-ID: <jb01nupbtswd.dlg@nililand.de>

Am Thu, 6 Apr 2017 20:28:42 +0900 schrieb Kazuki Maeda:

>> It crashes with luatex 1.0.4 but not with 1.0.5.
 
> Really?

Yes. 

> I'm using luatex 1.0.5 (rev 6307), but it crashes.

I'm on windows and tried first with the luatex-dev that I had
installed (1.0.4) and got a "luatex doesn't work anymore" window and
then downloaded the newest luatex-dev from w32tex.org and with it it
works. The credits doesn't show the revision but the version is
1.0.5. I tried also with the texlua from context (but imho they are
on windows identical to the w32tex-version anyway). 

In all cases I had a small font.lua-file with your oneliner and
called "texlua font.lua". The font is in the current folder. 

In miktex (1.0.0) I didn't get a crash, but I'm not sure if this
really means that there is no error. See
https://sourceforge.net/p/miktex/bugs/2558/


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From pragma at wxs.nl  Thu Apr  6 14:24:48 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 6 Apr 2017 14:24:48 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
In-Reply-To: <o2ghspkmgss2$.dlg@nililand.de>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <o2ghspkmgss2$.dlg@nililand.de>
Message-ID: <51ef2efa-617c-fbe8-da2d-bb7b6c2037b0@wxs.nl>

On 4/6/2017 1:07 PM, Ulrike Fischer wrote:

> It crashes with luatex 1.0.4 but not with 1.0.5.

FWIW:

1.0.4 is for tex live (read: should be -made- ok)
1.0.5 is our work in progress (read: yet unsupported)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From kakuto at fuk.kindai.ac.jp  Thu Apr  6 15:21:38 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Thu, 6 Apr 2017 22:21:38 +0900
Subject: [luatex] fontloader causes segmentation fault by Source Han Serif
Message-ID: <BE0A0A1454DC451399D91CDBABAC9A88@CJ3001517A>

Here (Windows)
cat test.lua
fontloader.open('SourceHanSerif-Regular.otf')
texlua test.lua
crashes in my luatex 1.0.5.

An example

%
% test1.tex
%
\documentclass{article}
\usepackage{luatexja}
\usepackage{fontspec}
\setmainfont{SourceHanSerif-Regular}
\begin{document}
???????
\end{document}

also crashes,
whereas the following worked (see an attached test2.pdf)

%
% test2.tex
%
\documentclass{article}
\usepackage{fontspec}
\setmainfont{SourceHanSerif-Regular}
\begin{document}
???????
\end{document}

Best,
Akira
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test2.pdf
Type: application/pdf
Size: 4518 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170406/6842b233/attachment.pdf>

From kmaeda at kmaeda.net  Thu Apr  6 15:43:37 2017
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Thu, 6 Apr 2017 22:43:37 +0900
Subject: [luatex] fontloader causes segmentation fault by Source Han
 Serif
In-Reply-To: <jb01nupbtswd.dlg@nililand.de>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <o2ghspkmgss2$.dlg@nililand.de>
 <20170406202842.c62f594fb49bff6eac34b472@kmaeda.net>
 <jb01nupbtswd.dlg@nililand.de>
Message-ID: <20170406224337.d1da9eff8d0fd81ae98cb505@kmaeda.net>

Thanks for Ulrike and Akira.
I don't know the reason why there are different results on Windows.
But I think that LuaTeX probably has a problem on fontloader.

I built luatex with --debug option and ran it on gdb.
However, in this case, luatex did not cause SegFault and exhaust memory.
Hmm...

Best regards
Kazuki Maeda

From luatex at nililand.de  Thu Apr  6 15:44:52 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 6 Apr 2017 15:44:52 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
References: <BE0A0A1454DC451399D91CDBABAC9A88@CJ3001517A>
Message-ID: <133xcq6y88jn7$.dlg@nililand.de>

Am Thu, 6 Apr 2017 22:21:38 +0900 schrieb Akira Kakuto:

> Here (Windows)
> cat test.lua
> fontloader.open('SourceHanSerif-Regular.otf')
> texlua test.lua
> crashes in my luatex 1.0.5.
> 
> An example
> 
> %
> % test1.tex
> %
> ?documentclass{article}
> ?usepackage{luatexja}
> ?usepackage{fontspec}
> ?setmainfont{SourceHanSerif-Regular}
> ?begin{document}
> ???????
> ?end{document}
> 
> also crashes,

It now crases for me too in both cases -- I wonder what changed over
midday ;-(. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luatex at nililand.de  Thu Apr  6 15:57:39 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 6 Apr 2017 15:57:39 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <o2ghspkmgss2$.dlg@nililand.de>
 <20170406202842.c62f594fb49bff6eac34b472@kmaeda.net>
 <jb01nupbtswd.dlg@nililand.de>
 <20170406224337.d1da9eff8d0fd81ae98cb505@kmaeda.net>
Message-ID: <1vojqvshzosbl.dlg@nililand.de>

Am Thu, 6 Apr 2017 22:43:37 +0900 schrieb Kazuki Maeda:

> Thanks for Ulrike and Akira.
> I don't know the reason why there are different results on Windows.

I get the crash now too and can't reproduce why I didn't get it
before -- perhaps I had typo in the font.lua file. 


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luigi.scarso at gmail.com  Thu Apr  6 17:55:20 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 6 Apr 2017 17:55:20 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
In-Reply-To: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
Message-ID: <CAG5iGsDDA7av6PqWCP=jBGHTWhEsSMsoXt5PVRHCDiqGVuZkpg@mail.gmail.com>

On Thu, Apr 6, 2017 at 1:50 AM, Kazuki Maeda <kmaeda at kmaeda.net> wrote:
> Hi all
>
> Recently, Adobe released new CJK serif fonts under OFL-1.1 named Source Han Serif.
>
> I downloaded the fonts from GitHub repository
> https://github.com/adobe-fonts/source-han-serif/tree/release/OTF/Japanese
> and tried the following one line Lua code
>
> fontloader.open('SourceHanSerif-Regular.otf')
>
> Then, texlua caused segmentation fault.
> Because the luatexja package uses fontloader.open(),
> one cannot use Source Han Serif with luatexja.

we are seeing it.

-- 
luigi

From luigi.scarso at gmail.com  Fri Apr  7 15:46:41 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 7 Apr 2017 15:46:41 +0200
Subject: [luatex] fontloader causes segmentation fault by Source Han
	Serif
In-Reply-To: <CAG5iGsDDA7av6PqWCP=jBGHTWhEsSMsoXt5PVRHCDiqGVuZkpg@mail.gmail.com>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <CAG5iGsDDA7av6PqWCP=jBGHTWhEsSMsoXt5PVRHCDiqGVuZkpg@mail.gmail.com>
Message-ID: <CAG5iGsB7=J4raoB+3-kD9wENG2kQoLNRfUz__YR8MrO9Yry4Rw@mail.gmail.com>

On Thu, Apr 6, 2017 at 5:55 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Thu, Apr 6, 2017 at 1:50 AM, Kazuki Maeda <kmaeda at kmaeda.net> wrote:


can you check experimental r6310 ?
-- 
luigi

From kmaeda at kmaeda.net  Fri Apr  7 16:06:38 2017
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Fri, 7 Apr 2017 23:06:38 +0900
Subject: [luatex] fontloader causes segmentation fault by Source Han
 Serif
In-Reply-To: <CAG5iGsB7=J4raoB+3-kD9wENG2kQoLNRfUz__YR8MrO9Yry4Rw@mail.gmail.com>
References: <20170406085038.8601d053196f8556a85fe83d@kmaeda.net>
 <CAG5iGsDDA7av6PqWCP=jBGHTWhEsSMsoXt5PVRHCDiqGVuZkpg@mail.gmail.com>
 <CAG5iGsB7=J4raoB+3-kD9wENG2kQoLNRfUz__YR8MrO9Yry4Rw@mail.gmail.com>
Message-ID: <20170407230638.f9a7a704a8f98a1ae50a796c@kmaeda.net>

Hi Luigi

On Fri, 7 Apr 2017 15:46:41 +0200
luigi scarso <luigi.scarso at gmail.com> wrote:

> can you check experimental r6310 ?

It works without SEGV.
Now luatexja also works with Source Han Serif.
Thank you!

Best regards
Kazuki Maeda

From kakuto at fuk.kindai.ac.jp  Sun Apr  9 00:13:10 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 9 Apr 2017 07:13:10 +0900
Subject: [luatex]  [lucida] luatex hangs on lucida OT test file
Message-ID: <FF734B7C6BA641E39A293B5312787220@CJ3001517A>

> For Windows, users are able to add DLL modules in TeX Live 2016.
> In TeX Live 2017 and later, adding of DLL modules may
> become impossible or ...

I have succeeded to link lua-5.2 or luajit dynamically on Windows.
Thus adding of lua DLL modules will be supported also
in TeX Live 2017.

Best,
Akira


From reinhard.kotucha at web.de  Sun Apr  9 00:55:19 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 9 Apr 2017 00:55:19 +0200
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <FF734B7C6BA641E39A293B5312787220@CJ3001517A>
References: <FF734B7C6BA641E39A293B5312787220@CJ3001517A>
Message-ID: <22761.27223.891823.828834@zaphod.ms25.net>

On 2017-04-09 at 07:13:10 +0900, Akira Kakuto wrote:

 > > For Windows, users are able to add DLL modules in TeX Live 2016.
 > > In TeX Live 2017 and later, adding of DLL modules may
 > > become impossible or ...
 > 
 > I have succeeded to link lua-5.2 or luajit dynamically on Windows.
 > Thus adding of lua DLL modules will be supported also
 > in TeX Live 2017.

Great!

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From luatex at nililand.de  Wed Apr 12 22:05:24 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 12 Apr 2017 22:05:24 +0200
Subject: [luatex] Small error in the manuel
Message-ID: <1bvnk1nqhvgc9.dlg@nililand.de>


In 1.12.5 \letcharcode there is imho a space missing in the example:

\def\foo{bar} \letcharcode123\foo

should be 

\def\foo{bar} \letcharcode123 \foo

Without it the command expands \foo to early to find more numbers.

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luigi.scarso at gmail.com  Sat Apr 15 13:02:02 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 15 Apr 2017 13:02:02 +0200
Subject: [luatex] Small error in the manuel
In-Reply-To: <1bvnk1nqhvgc9.dlg@nililand.de>
References: <1bvnk1nqhvgc9.dlg@nililand.de>
Message-ID: <CAG5iGsCqKqc4NFRH510oRx8Q-SGgh7_HA-xb9YTyYLsOFrnLTA@mail.gmail.com>

On Wed, Apr 12, 2017 at 10:05 PM, Ulrike Fischer <luatex at nililand.de> wrote:
>
> In 1.12.5 \letcharcode there is imho a space missing in the example:
>
> \def\foo{bar} \letcharcode123\foo
>
> should be
>
> \def\foo{bar} \letcharcode123 \foo
>
> Without it the command expands \foo to early to find more numbers.
>
> --
> Ulrike Fischer
> http://www.troubleshooting-tex.de/
>
perhaps
 \def\foo{bar} \letcharcode123=\foo
is better
-- 
luigi

From skostysh at lyx.org  Wed Apr 19 05:19:47 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Tue, 18 Apr 2017 23:19:47 -0400
Subject: [luatex] LuaTeX 1.0.4 regression(?) for handling .eps file
Message-ID: <20170419031947.urvpdhnlruvr2xsa@steph>

Dear all,

I found a difference in behavior when using LuaTeX (version 1.0.4) in TeX Live
2017 pretest that is different compared to using LuaTeX (0.95.0) in TeX Live
2016.

I'm not very knowledgeable about LaTeX and friends, so if I am reporting
this in the wrong place, or if the change in behavior is expected,
hopefully someone can guide me.

The MWE is below:

----------
\documentclass{article}
\usepackage{graphicx}

\begin{document}

Here is an inserted eps file: \includegraphics{mwe}

\end{document}
----------

where mwe.eps is a file in the same directory.

xelatex also has no problem with this file.

For convenience, I also provide the files temporarily on Dropbox here:

https://www.dropbox.com/sh/n6sjyt4w3fqx8ob/AAAtdhw2TBWdBy17J2g9FyCLa?dl=0

mwe.tex and mwe.eps are the files needed to reproce the issue. Simply run

    lualatex mwe.tex

The "bad" folder contains the .log, .aux, and .pdf when compiling with lualatex in TeX Live 2017 pretest.
The "good" folder contains similar files for TeX Live 2016.

Comparing logs, the older LuaTeX version executes

    repstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps

while the newer one executes

    epstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps

Best,

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170418/e606110a/attachment.sig>

From eduardoochs at gmail.com  Wed Apr 19 07:14:39 2017
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Wed, 19 Apr 2017 02:14:39 -0300
Subject: [luatex] luatex-0.95.0 on Debian - Undefined control sequence:
	\luatexluaescapestring
Message-ID: <CADs++6gOWzSyqJzMDVeqzd1gnpMyV04geu6q-d-eAUaZv22LWA@mail.gmail.com>

Hi all,

I am trying to install luatex-0.95.0 on a Debian system that comes
with a TeXlive in which the version of luatex is:

  beta-0.76.0-2013121407 (rev 4627)

I have the impression that I am *almost* succeeding without applying
the patch to texmf.cnf that Norbert mentioned here:

  http://tug.org/pipermail/luatex/2017-March/006434.html

I am avoiding that patch this moment because I don't understand it
well enough yet =(...

Here is the script that I used, with comments; fmtutil succeeds on
dviluatex.ini and luatex.ini, but fails on lualatex.ini with this
error,

  ! Undefined control sequence.
  \bbl at hook@everylanguage ...\luatexluaescapestring
                                                    {\string #1}') ==
nil)}\if...

I've put a more readable version of all this here:

  http://angg.twu.net/luatex.html#install-recent-luatex

All hints are welcome...
Here is the script:



# Build luatex-0.95.0
#
rm -Rv ~/usrc/luatex/
mkdir  ~/usrc/luatex/
cd     ~/usrc/luatex/
tar -xJvf $S/https/foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.doc.tar.xz
tar -xJvf $S/https/foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
cd     ~/usrc/luatex/0.95.0/
./build.sh 2>&1 | tee ob

# Save Debian's luatex as /usr/bin/luatex-orig,
# and install luatex-0.95.0 as /usr/bin/luatex
#
sudo mv -iv /usr/bin/luatex \
            /usr/bin/luatex-orig
sudo rm -v  /usr/bin/luatex
ls -lAF    ~/usrc/luatex/0.95.0/build/texk/web2c/luatex
sudo cp -s ~/usrc/luatex/0.95.0/build/texk/web2c/luatex \
            /usr/bin/luatex

# Extract the .ini files (and their most obvious dependencies) from
# Debian Sid's luatex package, and copy them to ~/usrc/tex-ini-files/
#
rm -Rv ~/usrc/texlive-base/
mkdir  ~/usrc/texlive-base/
cd     ~/usrc/texlive-base/
ar t $S/http/http.debian.net/debian/pool/main/t/texlive-base/texlive-base_2016.20170123-5_all.deb
ar p $S/http/http.debian.net/debian/pool/main/t/texlive-base/texlive-base_2016.20170123-5_all.deb
\
  data.tar.xz | tar -xvJf -

rm -Rv ~/usrc/tex-ini-files/
mkdir  ~/usrc/tex-ini-files/
cd     ~/usrc/tex-ini-files/
cp -v  ~/usrc/texlive-base/usr/share/texlive/texmf-dist/tex/generic/tex-ini-files/*
.
cp -v  ~/usrc/texlive-base/usr/share/texlive/texmf-dist/tex/generic/unicode-data/*
.

# Run "fmtutil --byengine luatex" telling it to use the files in
# ~/usrc/tex-ini-files/. Note that the .fmt files will be put in
# ~/.texmf-var/web2c/luatex/.
#
cd ~/usrc/luatex/0.95.0/
TEXINPUTS=$HOME/usrc/tex-ini-files/: \
  fmtutil --byengine luatex    2>&1 | tee ofmtutil

# What happens: fmtutil generates .fmt files for dviluatex.ini and
# luatex.ini, but when it tries to process lualatex.ini it aborts
# with:
#
# This is LuaTeX, Version 0.95.0 (TeX Live 2016)  (INITEX)
#  restricted system commands enabled.
# (/home/edrx/usrc/tex-ini-files/lualatex.ini
#  (...)
# ! Undefined control sequence.
# \bbl at hook@everylanguage ...\luatexluaescapestring
#                                                   {\string #1}') ==
nil)}\if...

# Revert: make /usr/bin/luatex-orig become /usr/bin/luatex again, and
# re-generate the fmt files in ~/.texmf-var/web2c/luatex/.
#
ls -lAF     /usr/bin/luatex*
sudo rm -v  /usr/bin/luatex
sudo mv -iv /usr/bin/luatex-orig /usr/bin/luatex
fmtutil --byengine luatex   2>&1 | tee /tmp/ofmtutil



  Cheers & thanks in advance,
    Eduardo Ochs
    http://angg.twu.net/
    http://angg.twu.net/math-b.html

From preining at logic.at  Wed Apr 19 08:22:09 2017
From: preining at logic.at (Norbert Preining)
Date: Wed, 19 Apr 2017 15:22:09 +0900
Subject: [luatex] luatex-0.95.0 on Debian - Undefined control sequence:
 \luatexluaescapestring
In-Reply-To: <CADs++6gOWzSyqJzMDVeqzd1gnpMyV04geu6q-d-eAUaZv22LWA@mail.gmail.com>
References: <CADs++6gOWzSyqJzMDVeqzd1gnpMyV04geu6q-d-eAUaZv22LWA@mail.gmail.com>
Message-ID: <20170419062209.bx2tgtyafta2xrb6@burischnitzel.preining.info>

Hi,

>   ! Undefined control sequence.
>   \bbl at hook@everylanguage ...\luatexluaescapestring
>                                                     {\string #1}') ==

primitives have changed, and so have the .ini files.
You cannot use old .ini files with new luatex.

What you need to do is get the fitting set of ini files - but that 
might be complicated since it might clash with other latex files.

There is a reason why we don't update luatex (or any binary) in the 
middle of the year, since the binary updates are often linked with
library (.tex, .ini, ..) file updates to be compatible.

Why not install TeX Live (2016 or pretest 2017) in addition, use
an equivs packages to make the rest of texlive debian packages
removable?

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From joseph.wright at morningstar2.co.uk  Wed Apr 19 08:34:02 2017
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 19 Apr 2017 07:34:02 +0100
Subject: [luatex] luatex-0.95.0 on Debian - Undefined control sequence:
 \luatexluaescapestring
In-Reply-To: <CADs++6gOWzSyqJzMDVeqzd1gnpMyV04geu6q-d-eAUaZv22LWA@mail.gmail.com>
References: <CADs++6gOWzSyqJzMDVeqzd1gnpMyV04geu6q-d-eAUaZv22LWA@mail.gmail.com>
Message-ID: <85ca39f8-6965-d288-9252-c630b1d40942@morningstar2.co.uk>

On 19/04/2017 06:14, Eduardo Ochs wrote:
> Hi all,
> 
> I am trying to install luatex-0.95.0 on a Debian system that comes
> with a TeXlive in which the version of luatex is:
> 
>   beta-0.76.0-2013121407 (rev 4627)
> 
> I have the impression that I am *almost* succeeding without applying
> the patch to texmf.cnf that Norbert mentioned here:
> 
>   http://tug.org/pipermail/luatex/2017-March/006434.html
> 
> I am avoiding that patch this moment because I don't understand it
> well enough yet =(...
> 
> Here is the script that I used, with comments; fmtutil succeeds on
> dviluatex.ini and luatex.ini, but fails on lualatex.ini with this
> error,
> 
>   ! Undefined control sequence.
>   \bbl at hook@everylanguage ...\luatexluaescapestring
>                                                     {\string #1}') ==
> nil)}\if...
> 
> I've put a more readable version of all this here:
> 
>   http://angg.twu.net/luatex.html#install-recent-luatex
> 
> All hints are welcome...
> Here is the script:
> 
> 
> 
> # Build luatex-0.95.0
> #
> rm -Rv ~/usrc/luatex/
> mkdir  ~/usrc/luatex/
> cd     ~/usrc/luatex/
> tar -xJvf $S/https/foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.doc.tar.xz
> tar -xJvf $S/https/foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
> cd     ~/usrc/luatex/0.95.0/
> ./build.sh 2>&1 | tee ob
> 
> # Save Debian's luatex as /usr/bin/luatex-orig,
> # and install luatex-0.95.0 as /usr/bin/luatex
> #
> sudo mv -iv /usr/bin/luatex \
>             /usr/bin/luatex-orig
> sudo rm -v  /usr/bin/luatex
> ls -lAF    ~/usrc/luatex/0.95.0/build/texk/web2c/luatex
> sudo cp -s ~/usrc/luatex/0.95.0/build/texk/web2c/luatex \
>             /usr/bin/luatex
> 
> # Extract the .ini files (and their most obvious dependencies) from
> # Debian Sid's luatex package, and copy them to ~/usrc/tex-ini-files/
> #
> rm -Rv ~/usrc/texlive-base/
> mkdir  ~/usrc/texlive-base/
> cd     ~/usrc/texlive-base/
> ar t $S/http/http.debian.net/debian/pool/main/t/texlive-base/texlive-base_2016.20170123-5_all.deb
> ar p $S/http/http.debian.net/debian/pool/main/t/texlive-base/texlive-base_2016.20170123-5_all.deb
> \
>   data.tar.xz | tar -xvJf -
> 
> rm -Rv ~/usrc/tex-ini-files/
> mkdir  ~/usrc/tex-ini-files/
> cd     ~/usrc/tex-ini-files/
> cp -v  ~/usrc/texlive-base/usr/share/texlive/texmf-dist/tex/generic/tex-ini-files/*
> .
> cp -v  ~/usrc/texlive-base/usr/share/texlive/texmf-dist/tex/generic/unicode-data/*
> .
> 
> # Run "fmtutil --byengine luatex" telling it to use the files in
> # ~/usrc/tex-ini-files/. Note that the .fmt files will be put in
> # ~/.texmf-var/web2c/luatex/.
> #
> cd ~/usrc/luatex/0.95.0/
> TEXINPUTS=$HOME/usrc/tex-ini-files/: \
>   fmtutil --byengine luatex    2>&1 | tee ofmtutil
> 
> # What happens: fmtutil generates .fmt files for dviluatex.ini and
> # luatex.ini, but when it tries to process lualatex.ini it aborts
> # with:
> #
> # This is LuaTeX, Version 0.95.0 (TeX Live 2016)  (INITEX)
> #  restricted system commands enabled.
> # (/home/edrx/usrc/tex-ini-files/lualatex.ini
> #  (...)
> # ! Undefined control sequence.
> # \bbl at hook@everylanguage ...\luatexluaescapestring
> #                                                   {\string #1}') ==
> nil)}\if...

There were some changes in how the LuaTeX primitives are made available
in LaTeX: the older approach was to prefix with \luatex..., but that has
now been dropped. There were a small number of places that other files
had to be updated to account for this. For a 'standard' TeX installation
that was fine: it all got done very rapidly. However, as you are using a
'home built' set up that is much more tricky. The full log is going to
be needed here to track everything down. (From memory this is not an
issue with the binary per se: we covered both the older and newer ones
in latex.ltx and the new .ini files.)

Joseph


From d.p.carlisle at gmail.com  Wed Apr 19 09:03:39 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 19 Apr 2017 08:03:39 +0100
Subject: [luatex] status.shell_escape broken in texlive 2017
Message-ID: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>

<http://chat.stackexchange.com/transcript/message/36800640#36800640>

\directlua{print('shell-escape = ' .. status.shell_escape)}


\bye

the above if run with luatex (and no --shell-escape option)
returns
texshell-es
cape = 2

in texlive 2016  (even using a luatex 1.04 test release)

but

texshell-escape = 1

in 2017

This has broken lots of things and causing mail
on the texlive list, was this an intended change?

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170419/faa2f8ed/attachment.html>

From luigi.scarso at gmail.com  Wed Apr 19 09:11:12 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 19 Apr 2017 09:11:12 +0200
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
Message-ID: <CAG5iGsCJFL8cLfM1v6sgAsPFcujBiZXn4HXoTxH6zNtbvYMvXw@mail.gmail.com>

On Wed, Apr 19, 2017 at 9:03 AM, David Carlisle <d.p.carlisle at gmail.com> wrote:
>
> \directlua{print('shell-escape = ' .. status.shell_escape)}
>
>
> \bye
>
> the above if run with luatex (and no --shell-escape option)
> returns
> texshell-es
> cape = 2
>
> in texlive 2016  (even using a luatex 1.04 test release)
>
> but
>
> texshell-escape = 1
>
> in 2017
>
> This has broken lots of things and causing mail
> on the texlive list, was this an intended change?
no, it looks like a restricted <=> permitted  inversion in lstatlib
We are looking into it


-- 
luigi

From d.p.carlisle at gmail.com  Wed Apr 19 09:46:52 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 19 Apr 2017 08:46:52 +0100
Subject: [luatex] LuaTeX 1.0.4 regression(?) for handling .eps file
In-Reply-To: <20170419031947.urvpdhnlruvr2xsa@steph>
References: <20170419031947.urvpdhnlruvr2xsa@steph>
Message-ID: <CAEW6iOixQMwhbzOj5AvwYkz4-mx296E=z66ou2eRLr6HyyfF4Q@mail.gmail.com>

Comparing logs, the older LuaTeX version executes

    repstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps

while the newer one executes

    epstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps

see the parallel thread re status.shell_escape on this list,
anything doing a status check on shell escape will be broken in the current
tl2017 test release.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170419/4fb3ec87/attachment-0001.html>

From patrick at gundla.ch  Wed Apr 19 10:55:01 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 19 Apr 2017 10:55:01 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
Message-ID: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>

Hello all,

I have a (probably very dumb) question regarding the new TeXlive 2017. I'd like to link C-libraries (actually written in Go, but I would start with simple cases first) to LuaTeX, without recompiling. I believe this is possible with the new LuaTeX. Is this correct? Is this supported on Mac, Linux and Windows? Is this related to ffi? 

If this is possible: is there a small howto somewhere?

Patrick (who is quite excited if this is possible)



From luigi.scarso at gmail.com  Wed Apr 19 12:16:59 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 19 Apr 2017 12:16:59 +0200
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
Message-ID: <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>

On Wed, Apr 19, 2017 at 9:03 AM, David Carlisle <d.p.carlisle at gmail.com> wrote:
>
> \directlua{print('shell-escape = ' .. status.shell_escape)}
>
>
> \bye
>
> the above if run with luatex (and no --shell-escape option)
> returns
> texshell-es
> cape = 2
>
> in texlive 2016  (even using a luatex 1.04 test release)
>
> but
>
> texshell-escape = 1
>
> in 2017
>
> This has broken lots of things and causing mail
> on the texlive list, was this an intended change?
>
> David
>
>
>
no, it's
shell_escape       0 means disabled, 1 is restricted  and 2  means
anything is permitted
(which looks natural  but it is wrong)
vs
shell_escape       0 means disabled,  1 means anything is permitted,
and 2 is restricted
(which is what the web2c manual says)

It should be fixed now.

-- 
luigi

From pragma at wxs.nl  Wed Apr 19 13:18:35 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 19 Apr 2017 13:18:35 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
Message-ID: <8e32f66c-3d46-7ffc-0f0a-a5575efd7886@wxs.nl>

On 4/19/2017 10:55 AM, Patrick Gundlach wrote:

> I have a (probably very dumb) question regarding the new TeXlive 2017. I'd like to link C-libraries (actually written in Go, but I would start with simple cases first) to LuaTeX, without recompiling. I believe this is possible with the new LuaTeX. Is this correct? Is this supported on Mac, Linux and Windows? Is this related to ffi?

it probably is mostly a platform issue because on windows one cal 
already load libraries for years (it was recently broken for a while 
which made users who use that complain)

for ffi based loading, most of the luajit ffi manual applies

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From skostysh at lyx.org  Wed Apr 19 19:42:21 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Wed, 19 Apr 2017 13:42:21 -0400
Subject: [luatex] LuaTeX 1.0.4 regression(?) for handling .eps file
In-Reply-To: <CAEW6iOixQMwhbzOj5AvwYkz4-mx296E=z66ou2eRLr6HyyfF4Q@mail.gmail.com>
References: <20170419031947.urvpdhnlruvr2xsa@steph>
 <CAEW6iOixQMwhbzOj5AvwYkz4-mx296E=z66ou2eRLr6HyyfF4Q@mail.gmail.com>
Message-ID: <20170419174221.n54brgteaht3egu6@Opti1604>

On Wed, Apr 19, 2017 at 08:46:52AM +0100, David Carlisle wrote:
> Comparing logs, the older LuaTeX version executes
> 
>     repstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps
> 
> while the newer one executes
> 
>     epstopdf --outfile=mwe-eps-converted-to.pdf mwe.eps
> 
> see the parallel thread re status.shell_escape on this list,
> anything doing a status check on shell escape will be broken in the current
> tl2017 test release.

Thanks for pointing me to the relevant discussion, David.

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170419/a72322a6/attachment.sig>

From skostysh at lyx.org  Wed Apr 19 19:43:49 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Wed, 19 Apr 2017 13:43:49 -0400
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
Message-ID: <20170419174349.qiuresybcbksj243@Opti1604>

On Wed, Apr 19, 2017 at 12:16:59PM +0200, luigi scarso wrote:

> It should be fixed now.

Thanks for the quick fix!

Does anyone happen to know about when this fix will make it in to the
TeX Live pretest?

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170419/97394d4b/attachment.sig>

From patrick at gundla.ch  Wed Apr 19 20:13:48 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 19 Apr 2017 20:13:48 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <8e32f66c-3d46-7ffc-0f0a-a5575efd7886@wxs.nl>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <8e32f66c-3d46-7ffc-0f0a-a5575efd7886@wxs.nl>
Message-ID: <FE43664D-D3CE-46B7-B917-50212C1E6BBB@gundla.ch>


>> I have a (probably very dumb) question regarding the new TeXlive 2017. I'd like to link C-libraries (actually written in Go, but I would start with simple cases first) to LuaTeX, without recompiling. I believe this is possible with the new LuaTeX. Is this correct? Is this supported on Mac, Linux and Windows? Is this related to ffi?
> 
> it probably is mostly a platform issue because on windows one cal already load libraries for years (it was recently broken for a while which made users who use that complain)

still curious if anybody can confirm if this works on Mac & Linux.

Patrick




From michal.h21 at gmail.com  Wed Apr 19 20:33:06 2017
From: michal.h21 at gmail.com (Michal Hoftich)
Date: Wed, 19 Apr 2017 20:33:06 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <FE43664D-D3CE-46B7-B917-50212C1E6BBB@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <8e32f66c-3d46-7ffc-0f0a-a5575efd7886@wxs.nl>
 <FE43664D-D3CE-46B7-B917-50212C1E6BBB@gundla.ch>
Message-ID: <149262678602.4938.5238156177397853482@kodymirus.localdomain>

Hi Patrick

> > it probably is mostly a platform issue because on windows one cal already load libraries for years (it was recently broken for a while which made users who use that complain)
> 
> still curious if anybody can confirm if this works on Mac & Linux.

It works for me Fedora. With correct package.cpath I can even use
modules installed using Luarocks. The only problem is that Fedora uses
Lua 5.3 and LuaTeX uses Lua 5.2, so some libraries fail because of
version mismatch. 

Best regards,
Michal


From luigi.scarso at gmail.com  Wed Apr 19 21:04:50 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 19 Apr 2017 21:04:50 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
Message-ID: <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>

On Wed, Apr 19, 2017 at 10:55 AM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Hello all,
>
> I have a (probably very dumb) question regarding the new TeXlive 2017. I'd like to link C-libraries (actually written in Go, but I would start with simple cases first) to LuaTeX, without recompiling. I believe this is possible with the new LuaTeX. Is this correct? Is this supported on Mac, Linux and Windows? Is this related to ffi?
>
> If this is possible: is there a small howto somewhere?
luatex 1.0.4 has a ffi module which aims to be compatible with  luajit ffi as in
http://luajit.org/ext_ffi.html
so, if you have a C so/dll  you can load it in luatex, but you have
also to provide an "interface "
(see, for example Accessing the zlib Compression Library in
http://luajit.org/ext_ffi_tutorial.html  )

I don't know if the luatex binary of the  Mac is compiled with the
right switches, but in build.sh
strip -u -r -A -n
should do the work
(at least it was the last time I have  cross-compiled for mac).
-- 
luigi


From luigi.scarso at gmail.com  Wed Apr 19 21:45:38 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 19 Apr 2017 21:45:38 +0200
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <20170419174349.qiuresybcbksj243@Opti1604>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
Message-ID: <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>

On Wed, Apr 19, 2017 at 7:43 PM, Scott Kostyshak <skostysh at lyx.org> wrote:
>
> Does anyone happen to know about when this fix will make it in to the
> TeX Live pretest?
>
> Scott


http://tug.org/pipermail/tex-live-commits/2017-April/002631.html

-- 
luigi

From skostysh at lyx.org  Thu Apr 20 04:19:19 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Wed, 19 Apr 2017 22:19:19 -0400
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
Message-ID: <20170420021919.66imbfgfjhwhrwgl@steph>

On Wed, Apr 19, 2017 at 09:45:38PM +0200, luigi scarso wrote:
> On Wed, Apr 19, 2017 at 7:43 PM, Scott Kostyshak <skostysh at lyx.org> wrote:
> >
> > Does anyone happen to know about when this fix will make it in to the
> > TeX Live pretest?
> >
> > Scott
> 
> 
> http://tug.org/pipermail/tex-live-commits/2017-April/002631.html

Thanks. The mirror I'm using is at 43913, so I'm almost there. I'll wait
a few hours and try again.

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170419/40eb2159/attachment-0001.sig>

From deepak.jois at gmail.com  Thu Apr 20 10:57:35 2017
From: deepak.jois at gmail.com (Deepak Jois)
Date: Thu, 20 Apr 2017 14:27:35 +0530
Subject: [luatex] Problems using node.setglue (r6317)
Message-ID: <CABR1-XZYFi+Br2Xu4anz9K71yAu+z9Y=CG=dbMohOs-LV13WQg@mail.gmail.com>

I just compiled the latest LuaTeX at r6317 and some code that worked
earlier doesn?t anymore.

This fails with error message  (font_params is defined earlier): "glue
(spec) expected"

     n = node.new("glue", 13)
     node.setglue(n, font_params.space, font_params.space_stretch,
font_params.space_shrink)

but changing to this works:

      n = node.new("glue", 13)
      n.width = font_params.space
      n.stretch = font_params.space_stretch
      n.shrink = font_params.space_shrink

I am using the node.setglue function as instructed the manual. Am I doing
something wrong?

Deepak
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170420/030a0fc9/attachment.html>

From alessi at robertalessi.net  Thu Apr 20 11:30:41 2017
From: alessi at robertalessi.net (Robert Alessi)
Date: Thu, 20 Apr 2017 11:30:41 +0200
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <20170420021919.66imbfgfjhwhrwgl@steph>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph>
Message-ID: <20170420093041.GA2341@riseup.net>

On Wed, Apr 19, 2017 at 10:19:19PM -0400, Scott Kostyshak wrote:
> > 
> > http://tug.org/pipermail/tex-live-commits/2017-April/002631.html
> 
> Thanks. The mirror I'm using is at 43913, so I'm almost there. I'll wait
> a few hours and try again.
> 
> Scott

I just got 43919 from mirror.hmc.edu, but trying to compile this with
lualatex:
---------mwe.tex--------------
\documentclass{article}

\usepackage{minted}

\begin{document}

z

\end{document}
------------------------------

still gives me:

$ lualatex --shell-escape mwe.tex
[...]
! Package minted Error: You must invoke LaTeX with the -shell-escape flag.

I also get the same error with -shell-escape (viz. one hyphen before
the 'shell-escape' flag.

Thank you for your attention,

-- Robert
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170420/20705936/attachment.sig>

From d.p.carlisle at gmail.com  Thu Apr 20 11:50:14 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 20 Apr 2017 10:50:14 +0100
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <20170420093041.GA2341@riseup.net>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph> <20170420093041.GA2341@riseup.net>
Message-ID: <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>

The sources are updated but not all the binaries are updated yet (depends
on volunteers compiling on each of the platforms) so if you are not
compiling from source but using the binaries from the tl2017 pretest the
fix will appear at different times, depending what platform you are using,
could be a few days or weeks, depending on how much time people have to
rebuild.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170420/df070b94/attachment.html>

From patrick at gundla.ch  Thu Apr 20 11:56:15 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 20 Apr 2017 11:56:15 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
Message-ID: <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>

Hello all,

thanks Hans, Michal and Luigi for the responses.

I'll try it out and put my results on the wiki.

Patrick



From dirk.laurie at gmail.com  Thu Apr 20 12:06:23 2017
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Thu, 20 Apr 2017 12:06:23 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
Message-ID: <CABcj=tmLNHSRBfn-E0XGhgRf+jVYd86BFYQTnwVF+rrr_8dbmA@mail.gmail.com>

2017-04-19 21:04 GMT+02:00 luigi scarso <luigi.scarso at gmail.com>:

> luatex 1.0.4 has a ffi module which aims to be compatible with  luajit ffi as in
> http://luajit.org/ext_ffi.html
> so, if you have a C so/dll  you can load it in luatex, but you have
> also to provide an "interface "
> (see, for example Accessing the zlib Compression Library in
> http://luajit.org/ext_ffi_tutorial.html  )

Hi Luigi:

Was this developed by the luatex team? If not, where is upstream?

Dirk

From luigi.scarso at gmail.com  Thu Apr 20 12:17:06 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 20 Apr 2017 12:17:06 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <CABcj=tmLNHSRBfn-E0XGhgRf+jVYd86BFYQTnwVF+rrr_8dbmA@mail.gmail.com>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <CABcj=tmLNHSRBfn-E0XGhgRf+jVYd86BFYQTnwVF+rrr_8dbmA@mail.gmail.com>
Message-ID: <CAG5iGsCe1_9zDfg4bfHQO5OxBzkP5UbWJE5H3dpKa2cvHxrEVA@mail.gmail.com>

On Thu, Apr 20, 2017 at 12:06 PM, Dirk Laurie <dirk.laurie at gmail.com> wrote:
> Was this developed by the luatex team? If not, where is upstream?

almost 1:1 copy from
https://github.com/facebook/luaffifb

-- 
luigi

From alessi at robertalessi.net  Thu Apr 20 12:23:25 2017
From: alessi at robertalessi.net (Robert Alessi)
Date: Thu, 20 Apr 2017 12:23:25 +0200
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph>
 <20170420093041.GA2341@riseup.net>
 <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>
Message-ID: <20170420102325.GA4275@riseup.net>

Many thanks, I was not aware of that.  As this is fixed, and no
further testing is required, I think I'll just wait for the updated
binaries to arrive (32-bit Linux in my case).

Robert

On Thu, Apr 20, 2017 at 10:50:14AM +0100, David Carlisle wrote:
> The sources are updated but not all the binaries are updated yet (depends
> on volunteers compiling on each of the platforms) so if you are not
> compiling from source but using the binaries from the tl2017 pretest the
> fix will appear at different times, depending what platform you are using,
> could be a few days or weeks, depending on how much time people have to
> rebuild.
> 
> David

From patrick at gundla.ch  Thu Apr 20 13:11:47 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 20 Apr 2017 13:11:47 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
Message-ID: <7D5D1712-CAA1-48C3-AAD5-E32BC27BC48C@gundla.ch>

Hi all,

the first report for Mac:

The attempt to link sqlite3 library from the Kepler project fails on MacOS X. Same problem as in http://tracker.luatex.org/view.php?id=555.

Patrick



From luigi.scarso at gmail.com  Thu Apr 20 13:14:17 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 20 Apr 2017 13:14:17 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <7D5D1712-CAA1-48C3-AAD5-E32BC27BC48C@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <7D5D1712-CAA1-48C3-AAD5-E32BC27BC48C@gundla.ch>
Message-ID: <CAG5iGsBdJYMetrereTTsyr2g3ctf-Hiu+hHmUMt3+NWQZ8OTvQ@mail.gmail.com>

On Thu, Apr 20, 2017 at 1:11 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Hi all,
>
> the first report for Mac:
>
> The attempt to link sqlite3 library from the Kepler project fails on MacOS X. Same problem as in http://tracker.luatex.org/view.php?id=555.
>
> Patrick
>
>
did you compiled the binary by yourself  ?


-- 
luigi

From patrick at gundla.ch  Thu Apr 20 13:25:27 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 20 Apr 2017 13:25:27 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <CAG5iGsBdJYMetrereTTsyr2g3ctf-Hiu+hHmUMt3+NWQZ8OTvQ@mail.gmail.com>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <7D5D1712-CAA1-48C3-AAD5-E32BC27BC48C@gundla.ch>
 <CAG5iGsBdJYMetrereTTsyr2g3ctf-Hiu+hHmUMt3+NWQZ8OTvQ@mail.gmail.com>
Message-ID: <4456B353-7F2E-46E7-B44D-AC8604E54A08@gundla.ch>


> did you compiled the binary by yourself  ?

no, it is the one from tl2017

Patrick



From skostysh at lyx.org  Thu Apr 20 17:25:53 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Thu, 20 Apr 2017 11:25:53 -0400
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <20170420102325.GA4275@riseup.net>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph>
 <20170420093041.GA2341@riseup.net>
 <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>
 <20170420102325.GA4275@riseup.net>
Message-ID: <20170420152553.ep5nath4ork27s64@steph>

On Thu, Apr 20, 2017 at 12:23:25PM +0200, Robert Alessi wrote:
> On Thu, Apr 20, 2017 at 10:50:14AM +0100, David Carlisle wrote:
> > The sources are updated but not all the binaries are updated yet (depends
> > on volunteers compiling on each of the platforms) so if you are not
> > compiling from source but using the binaries from the tl2017 pretest the
> > fix will appear at different times, depending what platform you are using,
> > could be a few days or weeks, depending on how much time people have to
> > rebuild.

> Many thanks, I was not aware of that.  As this is fixed, and no
> further testing is required, I think I'll just wait for the updated
> binaries to arrive (32-bit Linux in my case).

Indeed, good to know, David. Is there a way (e.g. a URL) to check when
this happens? I'm more curious about this in general, not for this
specific issue.

And thanks to Robert for testing.

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170420/1df37281/attachment.sig>

From d.p.carlisle at gmail.com  Thu Apr 20 17:33:12 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 20 Apr 2017 16:33:12 +0100
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <20170420152553.ep5nath4ork27s64@steph>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph> <20170420093041.GA2341@riseup.net>
 <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>
 <20170420102325.GA4275@riseup.net> <20170420152553.ep5nath4ork27s64@steph>
Message-ID: <CAEW6iOgG7WcjRzFd1qzorRPZtrxBCc5kOt=Fix2ezwEFk0AQMA@mail.gmail.com>

On 20 April 2017 at 16:25, Scott Kostyshak <skostysh at lyx.org> wrote:

> On Thu, Apr 20, 2017 at 12:23:25PM +0200, Robert Alessi wrote:
> > On Thu, Apr 20, 2017 at 10:50:14AM +0100, David Carlisle wrote:
> > > The sources are updated but not all the binaries are updated yet
> (depends
> > > on volunteers compiling on each of the platforms) so if you are not
> > > compiling from source but using the binaries from the tl2017 pretest
> the
> > > fix will appear at different times, depending what platform you are
> using,
> > > could be a few days or weeks, depending on how much time people have to
> > > rebuild.
>
> > Many thanks, I was not aware of that.  As this is fixed, and no
> > further testing is required, I think I'll just wait for the updated
> > binaries to arrive (32-bit Linux in my case).
>
> Indeed, good to know, David. Is there a way (e.g. a URL) to check when
> this happens? I'm more curious about this in general, not for this
> specific issue.
>

well for example I use cygwin as a rule and

https://www.tug.org/svn/texlive/trunk/Master/bin/x86_64-cygwin/?sortby=date

currently shows luatex hasn't changed, whereas  linux 64

https://www.tug.org/svn/texlive/trunk/Master/bin/x86_64-linux/?sortby=date

shows that the new luatex binary was committed a couple of hours ago.

>
> And thanks to Robert for testing.
>
> Scott
>

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170420/804aabb6/attachment.html>

From skostysh at lyx.org  Fri Apr 21 01:25:58 2017
From: skostysh at lyx.org (Scott Kostyshak)
Date: Thu, 20 Apr 2017 19:25:58 -0400
Subject: [luatex] status.shell_escape broken in texlive 2017
In-Reply-To: <CAEW6iOgG7WcjRzFd1qzorRPZtrxBCc5kOt=Fix2ezwEFk0AQMA@mail.gmail.com>
References: <CAEW6iOgRu7ZuK0-cuwr5=7Bj4tg9dZ3MM3LxKNHtgwwuUEqnDQ@mail.gmail.com>
 <CAG5iGsBWD+g4xdGATA1Y1ZraiyTPs612d3sK5oWSgDaqF2fXuA@mail.gmail.com>
 <20170419174349.qiuresybcbksj243@Opti1604>
 <CAG5iGsARCSbBkzKfCvRo--2gqAGcVZT7W3PpCnJfpK2WQcBCSQ@mail.gmail.com>
 <20170420021919.66imbfgfjhwhrwgl@steph>
 <20170420093041.GA2341@riseup.net>
 <CAEW6iOh91jr7bhLPJ+PBM4p=wxGD8RYWVAimx3hQ8AK5SkgBRQ@mail.gmail.com>
 <20170420102325.GA4275@riseup.net>
 <20170420152553.ep5nath4ork27s64@steph>
 <CAEW6iOgG7WcjRzFd1qzorRPZtrxBCc5kOt=Fix2ezwEFk0AQMA@mail.gmail.com>
Message-ID: <20170420232558.c32wk6hf6fflo3yj@steph>

On Thu, Apr 20, 2017 at 04:33:12PM +0100, David Carlisle wrote:
> On 20 April 2017 at 16:25, Scott Kostyshak <skostysh at lyx.org> wrote:

> > Indeed, good to know, David. Is there a way (e.g. a URL) to check when
> > this happens? I'm more curious about this in general, not for this
> > specific issue.
> >
> 
> well for example I use cygwin as a rule and
> 
> https://www.tug.org/svn/texlive/trunk/Master/bin/x86_64-cygwin/?sortby=date
> 
> currently shows luatex hasn't changed, whereas  linux 64
> 
> https://www.tug.org/svn/texlive/trunk/Master/bin/x86_64-linux/?sortby=date
> 
> shows that the new luatex binary was committed a couple of hours ago.

ahh now I understand how it works. I see now that I could alternatively
look at

  http://tug.org/pipermail/tex-live-commits/2017-April/

and search for the x86_64-linux entry and then open that and make sure
"linux/luatex" is listed in the log message. But that takes more time
than using the link that you provided.

Thanks for your help, David!

Scott
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170420/68dd1bc9/attachment-0001.sig>

From patrick at gundla.ch  Sun Apr 23 18:50:26 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 23 Apr 2017 18:50:26 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
Message-ID: <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>

Hello all,

I've tried to use ffi on the Mac (macOS Sierra) and failed with this luajitlatex file:

----------------
\documentclass{article}
\usepackage{luacode}
\begin{document}
\begin{luacode*}
local ffi = require("ffi")


ffi.cdef[[
void Sleep(int ms);
int poll(struct pollfd *fds, unsigned long nfds, int timeout);
]]

local sleep
if ffi.os == "Windows" then
  function sleep(s)
    ffi.C.Sleep(s*1000)
  end
else
  function sleep(s)
    ffi.C.poll(nil, 0, s*1000)
  end
end

for i=1,160 do
  io.write("."); io.flush()
  sleep(0.01)
end
io.write("\n")

\end{luacode*}
\end{document}
----------------

This is the texlive2017 luajittex binary and the sample taken from http://luajit.org/ext_ffi_tutorial.html 

Is this supposed to work with LuaJitLaTeX on a Mac?

Patrick




From luigi.scarso at gmail.com  Sun Apr 23 19:14:40 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 23 Apr 2017 19:14:40 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
Message-ID: <CAG5iGsBxbSQjnhncPav1hwaSTCfKEO-Ny6REMYmmVU_=6o-mJA@mail.gmail.com>

--
-- sleep.lua
--
local ffi = require("ffi")


ffi.cdef[[
void Sleep(int ms);
int poll(struct pollfd *fds, unsigned long nfds, int timeout);
]]

local sleep
if ffi.os == "Windows" then
  function sleep(s)
    ffi.C.Sleep(s*1000)
  end
else
  function sleep(s)
    ffi.C.poll(nil, 0, s*1000)
  end
end

for i=1,160 do
  io.write("."); io.flush()
  sleep(0.01)
end
io.write("\n")


Under linux

$ luajittex --luaonly sleep.lua
................................................................................................................................................................
$ luatex --luaonly sleep.lua
................................................................................................................................................................



-- 
luigi

From patrick at gundla.ch  Sun Apr 23 19:39:27 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 23 Apr 2017 19:39:27 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
Message-ID: <D24534ED-E92B-4654-8CDC-6E9B8FF8A0D5@gundla.ch>

Thanks Luigi for the test file, this works fine on tl2017 and tl2016 (Mac).

My test file (shorter one below) works on tl2016 but _not_ on tl2017 (Mac and Linux). Is this on purpose?


------------------------------------
\documentclass{article}
\usepackage{luacode}
\begin{document}
\begin{luacode*}
ffi = require('ffi')

ffi.cdef[[
int printf(const char *fmt, ...);
]]
ffi.C.printf("Hello %s!", "world")

\end{luacode*}
\end{document}
------------------------------------

(tl2017) $ luajitlatex test
...
(./test.aux)[\directlua]:5: attempt to call field 'cdef' (a nil value)
stack traceback:
	[\directlua]:5: in main chunk.
\luacode at dbg@exec ...code at maybe@printdbg {#1} #1 }
...



(tl2016) $ luajitlatex test
...
(./test.aux)Hello world! (./test.aux))
 349 words of node memory still in use:
   2 hlist, 1 vlist, 1 rule, 7 glue, 39 glue_spec, 2 write nodes
   avail lists: 2:12,3:1,4:1,5:4,7:1,8:1,9:1
...


Patrick




From patrick at gundla.ch  Sun Apr 23 19:44:02 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 23 Apr 2017 19:44:02 +0200
Subject: [luatex] FFI
In-Reply-To: <D24534ED-E92B-4654-8CDC-6E9B8FF8A0D5@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
 <D24534ED-E92B-4654-8CDC-6E9B8FF8A0D5@gundla.ch>
Message-ID: <7C4F0247-05CD-4520-A901-106489E48307@gundla.ch>

A follow-up to my message.

This also happens with plain luajittex:

--------------------
\directlua{
  ffi = require('ffi')
  ffi.cdef("")
}

\bye
--------------------

$ luajittex test
This is LuajitTeX, Version 0.95.0 (TeX Live 2016) 
 restricted system commands enabled.
(./test.tex)
warning  (pdf backend): no pages of output.
Transcript written on test.log.

=> OK

$ luajittex test
This is LuajitTeX, Version 1.0.4 (TeX Live 2017) 
 restricted system commands enabled.
(./test.tex[\directlua]:1: attempt to call field 'cdef' (a nil value)
stack traceback:
	[\directlua]:1: in main chunk.
l.4 }
   
=> broken?


(macOS Sierra)

Patrick



From luigi.scarso at gmail.com  Sun Apr 23 19:51:05 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 23 Apr 2017 19:51:05 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <D24534ED-E92B-4654-8CDC-6E9B8FF8A0D5@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
 <CAG5iGsAKGOngfNkPCAEtn5DHo24d=jBsKv813eS_qmYvu2FhLw@mail.gmail.com>
 <B87B7C9B-A91F-4962-BA46-E25B9F7690DC@gundla.ch>
 <07C5AD3F-0C24-41D0-8124-076F3D921303@gundla.ch>
 <D24534ED-E92B-4654-8CDC-6E9B8FF8A0D5@gundla.ch>
Message-ID: <CAG5iGsA-XUHyvZR1w+6hDZVvTqPKnzVaC=zQx14isuTGwsP7Qw@mail.gmail.com>

On Sun, Apr 23, 2017 at 7:39 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Thanks Luigi for the test file, this works fine on tl2017 and tl2016 (Mac).
>
> My test file (shorter one below) works on tl2016 but _not_ on tl2017 (Mac and Linux). Is this on purpose?

Hm, I don't know. Given that ffi is new, my first problem is to check
that the "--luaonly" works, as is in this case.
A format has its policy, and given that  ffi is as powerful as  a full
shell,  it requires  --shell-escape.
Shell restricted or no shell at all set ffi to nil.



-- 
luigi

From sergiy.ponomarenko at gmail.com  Mon Apr 24 21:45:05 2017
From: sergiy.ponomarenko at gmail.com (Sergiy Ponomarenko)
Date: Mon, 24 Apr 2017 22:45:05 +0300
Subject: [luatex] Behaviour of lualatex 1.0.4. for cyrillic
Message-ID: <CA+1Ucw+zk1Td4dFtJ-qnhsW-CPiecS0eD+85-gxSh5XG7t09TQ@mail.gmail.com>

Hi,
can you answer fo this question
https://tex.stackexchange.com/questions/366460/problem-with-polyglossia-behaviour-for-lualatex-1-0-4-possible-bug
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170424/b2b69629/attachment.html>

From deepak.jois at gmail.com  Thu Apr 27 08:31:40 2017
From: deepak.jois at gmail.com (Deepak Jois)
Date: Thu, 27 Apr 2017 12:01:40 +0530
Subject: [luatex] Problems using node.setglue (r6317)
In-Reply-To: <CABR1-XZYFi+Br2Xu4anz9K71yAu+z9Y=CG=dbMohOs-LV13WQg@mail.gmail.com>
References: <CABR1-XZYFi+Br2Xu4anz9K71yAu+z9Y=CG=dbMohOs-LV13WQg@mail.gmail.com>
Message-ID: <CABR1-XYayjZYfkZB3pj75wo3Ot_h7Eng2XuffUKcMVNkCEvzuQ@mail.gmail.com>

Not sure if there was something unclear about my earlier message. Anyway,
since I did not receive any response, I decided to dig into the source
myself, and it seems a bug was introduced in r6219 and is in the file
source/texk/web2c/luatexdir/lua/lnodelib.c:

The code below (starting at line 3201) always returns an error. That seems
wrong. Any comments?

===
static int lua_nodelib_set_glue(lua_State * L)
{
    halfword n = *check_isnode(L, 1);
    int top = lua_gettop(L) ;
    if (n) {
        halfword t = type(n);
        if (t == glue_node || t == glue_spec_node || t == math_node) {
            width(n)         = ((top > 1 && lua_type(L, 2) == LUA_TNUMBER))
? lua_roundnumber(L,2) : 0;
            stretch(n)       = ((top > 2 && lua_type(L, 3) == LUA_TNUMBER))
? lua_roundnumber(L,3) : 0;
            shrink(n)        = ((top > 3 && lua_type(L, 4) == LUA_TNUMBER))
? lua_roundnumber(L,4) : 0;
            stretch_order(n) = ((top > 4 && lua_type(L, 5) == LUA_TNUMBER))
? lua_tointeger(L,5) : 0;
            shrink_order(n)  = ((top > 5 && lua_type(L, 6) == LUA_TNUMBER))
? lua_tointeger(L,6) : 0;
        }
    }
    return luaL_error(L, "glue (spec) expected");
    return 0;
}

==

I believe it should be something like:

==
static int lua_nodelib_set_glue(lua_State * L)
{
    halfword n = *check_isnode(L, 1);
    int top = lua_gettop(L) ;
    if (n) {
        halfword t = type(n);
        if (t == glue_node || t == glue_spec_node || t == math_node) {
            width(n)         = ((top > 1 && lua_type(L, 2) == LUA_TNUMBER))
? lua_roundnumber(L,2) : 0;
            stretch(n)       = ((top > 2 && lua_type(L, 3) == LUA_TNUMBER))
? lua_roundnumber(L,3) : 0;
            shrink(n)        = ((top > 3 && lua_type(L, 4) == LUA_TNUMBER))
? lua_roundnumber(L,4) : 0;
            stretch_order(n) = ((top > 4 && lua_type(L, 5) == LUA_TNUMBER))
? lua_tointeger(L,5) : 0;
            shrink_order(n)  = ((top > 5 && lua_type(L, 6) == LUA_TNUMBER))
? lua_tointeger(L,6) : 0;
            return 0;
        }
    }
    return luaL_error(L, "glue (spec) expected");
}
==

On Thu, Apr 20, 2017 at 2:27 PM, Deepak Jois <deepak.jois at gmail.com> wrote:

> I just compiled the latest LuaTeX at r6317 and some code that worked
> earlier doesn?t anymore.
>
> This fails with error message  (font_params is defined earlier): "glue
> (spec) expected"
>
>      n = node.new("glue", 13)
>      node.setglue(n, font_params.space, font_params.space_stretch,
> font_params.space_shrink)
>
> but changing to this works:
>
>       n = node.new("glue", 13)
>       n.width = font_params.space
>       n.stretch = font_params.space_stretch
>       n.shrink = font_params.space_shrink
>
> I am using the node.setglue function as instructed the manual. Am I doing
> something wrong?
>
> Deepak
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170427/9f636d0a/attachment.html>

From pragma at wxs.nl  Thu Apr 27 13:14:22 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 27 Apr 2017 13:14:22 +0200
Subject: [luatex] Problems using node.setglue (r6317)
In-Reply-To: <CABR1-XYayjZYfkZB3pj75wo3Ot_h7Eng2XuffUKcMVNkCEvzuQ@mail.gmail.com>
References: <CABR1-XZYFi+Br2Xu4anz9K71yAu+z9Y=CG=dbMohOs-LV13WQg@mail.gmail.com>
 <CABR1-XYayjZYfkZB3pj75wo3Ot_h7Eng2XuffUKcMVNkCEvzuQ@mail.gmail.com>
Message-ID: <474aa9da-618e-d64b-6ff9-d024d06c584a@wxs.nl>

On 4/27/2017 8:31 AM, Deepak Jois wrote:
> Not sure if there was something unclear about my earlier message.
> Anyway, since I did not receive any response, I decided to dig into the
> source myself, and it seems a bug was introduced in r6219 and is in the
> file source/texk/web2c/luatexdir/lua/lnodelib.c:
>
> The code below (starting at line 3201) always returns an error. That
> seems wrong. Any comments?

indeed, the "return 0" needs to be moved

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Sun Apr 30 16:42:45 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 30 Apr 2017 16:42:45 +0200
Subject: [luatex] Linking to C libraries / TL2017 / FFI
In-Reply-To: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
References: <3DCC68E0-4E8F-4D7E-9268-6B8B98C61818@gundla.ch>
Message-ID: <9CCC586D-9852-4E10-87FE-9ADA7FC73BE6@gundla.ch>

Hello all,

this is a first feedback from me regarding this topic. I have tried texlive2017 with Linux and Mac.

Using regular libraries (.so and .dylib) and ffi work fine. 

Next thing I'll try to do the same on Windows and then I'll put it on the wiki.

Patrick

(who thinks this is really great)



