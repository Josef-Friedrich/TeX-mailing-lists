From d.p.carlisle at gmail.com  Thu May  4 10:12:55 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 4 May 2017 09:12:55 +0100
Subject: [luatex] nested ifincsname broken in luatex
Message-ID: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>

the following plain tex file

\ifcsname T\ifincsname e\else \hbox{e}\fi X\endcsname\fi
\bye


works in etex/pdftex/xetex but generates an error in luatex (tl2017 pretest)

ifincsname should be true in the implicit csname started by the outer
ifincsname


David


It is perhaps related to this tracker issue about ifincsname in nested
csname, but that one appears fixed,


http://tracker.luatex.org/view.php?id=728
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170504/754780f6/attachment.html>

From pragma at wxs.nl  Thu May  4 11:00:18 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 4 May 2017 11:00:18 +0200
Subject: [luatex] nested ifincsname broken in luatex
In-Reply-To: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
References: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
Message-ID: <70e7092e-85be-1e07-624e-e5aba0da246c@wxs.nl>

On 5/4/2017 10:12 AM, David Carlisle wrote:
>
> the following plain tex file
>
> \ifcsname T\ifincsname e\else \hbox{e}\fi X\endcsname\fi
> \bye
>
>
> works in etex/pdftex/xetex but generates an error in luatex (tl2017 pretest)
>
> ifincsname should be true in the implicit csname started by the outer
> ifincsname

does

\suppressifcsnameerror1

help?


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Thu May  4 11:37:14 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 4 May 2017 10:37:14 +0100
Subject: [luatex] nested ifincsname broken in luatex
In-Reply-To: <70e7092e-85be-1e07-624e-e5aba0da246c@wxs.nl>
References: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
 <70e7092e-85be-1e07-624e-e5aba0da246c@wxs.nl>
Message-ID: <CAEW6iOjLfv9AnJEtw_N0vxkaQWwyvzPQaLcKsfNCMTeLn1YAow@mail.gmail.com>

On 4 May 2017 at 10:00, Hans Hagen <pragma at wxs.nl> wrote:

> On 5/4/2017 10:12 AM, David Carlisle wrote:
>
>>
>> the following plain tex file
>>
>> \ifcsname T\ifincsname e\else \hbox{e}\fi X\endcsname\fi
>> \bye
>>
>>
>> works in etex/pdftex/xetex but generates an error in luatex (tl2017
>> pretest)
>>
>> ifincsname should be true in the implicit csname started by the outer
>> ifincsname
>>
>
> does
>
> \suppressifcsnameerror1
>
> help?
>


Not really, it masks the error but the test is still  taking the wrong
branch.

If I change the test file to



\ifx\suppressifcsnameerror\undefined\else
\suppressifcsnameerror1
\fi

\ifcsname T\ifincsname e\else \hbox{e}\fi X\endcsname AAA\else zzz\fi
\bye



then it runs without error but typesets

AAA  with pdftex and xetex
but
zzz with luatex

David




>
> -----------------------------------------------------------------
>                                           Hans Hagen | PRAGMA ADE
>               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
>        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170504/519d6cd5/attachment.html>

From d.p.carlisle at gmail.com  Thu May  4 13:04:34 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 4 May 2017 12:04:34 +0100
Subject: [luatex] nested ifincsname broken in luatex
In-Reply-To: <CAEW6iOjLfv9AnJEtw_N0vxkaQWwyvzPQaLcKsfNCMTeLn1YAow@mail.gmail.com>
References: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
 <70e7092e-85be-1e07-624e-e5aba0da246c@wxs.nl>
 <CAEW6iOjLfv9AnJEtw_N0vxkaQWwyvzPQaLcKsfNCMTeLn1YAow@mail.gmail.com>
Message-ID: <CAEW6iOgBECNxitEoJ+S=iAP=g7QwHhMvHbipYaeEh=giLR9kMA@mail.gmail.com>

It's perhaps worth stressing that the error condition was just added so the
difference could be seen without looking at the typeset output: it's not
really related to the underlying issue.

This version runs without error without setting the suppress error flag


\ifcsname T\ifincsname e\else E\fi X\endcsname AAA\else zzz\fi
\bye


but typesets zzz  with luatex and AAA with pdftex/xetex

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170504/b3c8fb9c/attachment.html>

From nikola.lecic at anthesphoria.net  Wed May 10 00:51:15 2017
From: nikola.lecic at anthesphoria.net (Nikola =?UTF-8?B?TGXEjWnEhw==?=)
Date: Wed, 10 May 2017 01:51:15 +0300
Subject: [luatex] Combining diacritics in some fonts: "(linebreak): invalid
 list tail, probably missing glue"
Message-ID: <201705092251.v49MpUc0009400@anthesphoria.net>

Hi,

If you compile this document twice

\documentclass{article}
\usepackage{polyglossia}
\setmainlanguage{serbian}
\setmainfont{Old Standard}
\begin{document}
??\char"0302 ?
\end{document}

you should get

! error:  (linebreak): invalid list tail, probably missing glue
!  ==> Fatal error occurred, no output PDF file produced!

It happens only with some fonts, not with others.

Is there any workaround for this problem (before the bug gets fixed)?

Thanks,
-- 
Nikola Le?i? = ?????? ?????
fingerprint : FEF3 66AF C90E EDC3 D878  7CDC 956D F4AB A377 1C9B
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 331 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20170510/5269a1c3/attachment.sig>

From d.p.carlisle at gmail.com  Wed May 10 01:10:47 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 10 May 2017 00:10:47 +0100
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <201705092251.v49MpUc0009400@anthesphoria.net>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
Message-ID: <CAEW6iOj_ver-59pfgaqn84UWOksP6zc-uSj_mC+QCCQv4FKs-g@mail.gmail.com>

On 9 May 2017 at 23:51, Nikola Le?i? <nikola.lecic at anthesphoria.net> wrote:

> Hi,
>
> If you compile this document twice
>
> \documentclass{article}
> \usepackage{polyglossia}
> \setmainlanguage{serbian}
> \setmainfont{Old Standard}
> \begin{document}
> ??\char"0302 ?
> \end{document}
>


I think as a workaround you can do this, possibly with some loss of
inter-letter kerning, but you could always add a bit of negative space by
hand between the boxes.


\documentclass{article}
\usepackage{polyglossia}
\setmainlanguage{serbian}
\setmainfont{Old Standard}
\begin{document}
\mbox{?}\mbox{??}\mbox{?}
\end{document}

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170510/6d31586c/attachment.html>

From Herbert.Voss at FU-Berlin.DE  Wed May 10 07:32:25 2017
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Wed, 10 May 2017 07:32:25 +0200
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <201705092251.v49MpUc0009400@anthesphoria.net>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
Message-ID: <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>


Nikola Le?i? schrieb:
> Hi,
>
> If you compile this document twice
>
> \documentclass{article}
> \usepackage{polyglossia}
> \setmainlanguage{serbian}
> \setmainfont{Old Standard}
> \begin{document}
> ??\char"0302 ?
> \end{document}
>
> you should get
>
> ! error:  (linebreak): invalid list tail, probably missing glue
> !  ==> Fatal error occurred, no output PDF file produced!

with latex 1.0.4 from upcoming TeXLive 2017 no problem.

Herbert


>
> It happens only with some fonts, not with others.
>
> Is there any workaround for this problem (before the bug gets fixed)?
>
> Thanks,
> --
> Nikola Le?i? = ?????? ?????
> fingerprint : FEF3 66AF C90E EDC3 D878  7CDC 956D F4AB A377 1C9B
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>



From d.p.carlisle at gmail.com  Wed May 10 08:50:18 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 10 May 2017 07:50:18 +0100
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
Message-ID: <CAEW6iOiELgpWx8BK-JNOrqTUubDrsyyP=dSTGD72ND17TMK=4w@mail.gmail.com>

On 10 May 2017 at 06:32, Herbert Voss <Herbert.Voss at fu-berlin.de> wrote:

>
> Nikola Le?i? schrieb:
> > Hi,
> >
> > If you compile this document twice
> >
> > \documentclass{article}
> > \usepackage{polyglossia}
> > \setmainlanguage{serbian}
> > \setmainfont{Old Standard}
> > \begin{document}
> > ??\char"0302 ?
> > \end{document}
> >
> > you should get
> >
> > ! error:  (linebreak): invalid list tail, probably missing glue
> > !  ==> Fatal error occurred, no output PDF file produced!
>
> with latex 1.0.4 from upcoming TeXLive 2017 no problem.
>
>
That's odd, what platform are you using?
i was using an up to date pretest (cygwin 64) and it failed for me

David


Herbert
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170510/d824560f/attachment.html>

From Herbert.Voss at FU-Berlin.DE  Wed May 10 09:13:49 2017
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Wed, 10 May 2017 09:13:49 +0200
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <CAEW6iOiELgpWx8BK-JNOrqTUubDrsyyP=dSTGD72ND17TMK=4w@mail.gmail.com>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
 <CAEW6iOiELgpWx8BK-JNOrqTUubDrsyyP=dSTGD72ND17TMK=4w@mail.gmail.com>
Message-ID: <49855.79.237.242.234.1494400429.webmail@webmail.zedat.fu-berlin.de>

David Carlisle schrieb:
> On 10 May 2017 at 06:32, Herbert Voss <Herbert.Voss at fu-berlin.de> wrote:
>
>> > you should get
>> >
>> > ! error:  (linebreak): invalid list tail, probably missing glue
>> > !  ==> Fatal error occurred, no output PDF file produced!
>>
>> with latex 1.0.4 from upcoming TeXLive 2017 no problem.
>>
>>
> That's odd, what platform are you using?
> i was using an up to date pretest (cygwin 64) and it failed for me

ups, my fault. I run it in a gui and looked only at the
created pdf. And, of course, forgot to look at the log file.
I have the same problem. Sorry ...

Herbert


From luatex at nililand.de  Wed May 10 09:36:55 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 10 May 2017 09:36:55 +0200
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
	invalid list tail, probably missing glue"
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
Message-ID: <1qorlgud0shje.dlg@nililand.de>

Am Wed, 10 May 2017 07:32:25 +0200 schrieb Herbert Voss:

> Nikola Le?i? schrieb:
>> Hi,
>>
>> If you compile this document twice
>>
>> \documentclass{article}
>> \usepackage{polyglossia}
>> \setmainlanguage{serbian}
>> \setmainfont{Old Standard}
>> \begin{document}
>> ??\char"0302 ?
>> \end{document}
>>
>> you should get
>>
>> ! error:  (linebreak): invalid list tail, probably missing glue
>> !  ==> Fatal error occurred, no output PDF file produced!
> 
> with latex 1.0.4 from upcoming TeXLive 2017 no problem.

You get the error only every second compilation -- when the aux-file
contains a \selectlanguage{serbian}. With this command you can get
it always:

\documentclass{article}
\usepackage{polyglossia}
\setmainlanguage{serbian}
\setmainfont{Old Standard}
\begin{document}
\selectlanguage{serbian}
??\char"0302 ?
\end{document}

Imho it has something to do with hyphenation involving combining
accents. 

With babel one get the error if one change add a char as
\righthyphenmin is 3 there:

\documentclass{article}
\usepackage[serbian]{babel}
\usepackage{fontspec}
\setmainfont{Old Standard}
\begin{document}
\selectlanguage{serbian}

??\char"0302 ?x
\end{document}

And the combining accent doesn't work correctly (with lualatex) in
Old Standard if serbian is used:

\documentclass{article}
\usepackage[serbian]{babel}
\usepackage{fontspec}
\setmainfont{Old Standard}
\setsansfont{CMU Serif}
\begin{document}
\selectlanguage{serbian}
%

\mbox{??\char"0302?x}
\mbox{??^^^^0302?x}

\sffamily
\mbox{??\char"0302?x}
\mbox{??^^^^0302?x}

\end{document}



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luatex at nililand.de  Wed May 10 12:48:37 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 10 May 2017 12:48:37 +0200
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
	invalid list tail, probably missing glue"
References: <201705092251.v49MpUc0009400@anthesphoria.net>
Message-ID: <mby5ygyfualw.dlg@nililand.de>

Am Wed, 10 May 2017 01:51:15 +0300 schrieb Nikola Le?i?:

> Hi,
> 
> If you compile this document twice
> 
> \documentclass{article}
> \usepackage{polyglossia}
> \setmainlanguage{serbian}
> \setmainfont{Old Standard}
> \begin{document}
> ??\char"0302 ?
> \end{document}
> 
> you should get
> 
> ! error:  (linebreak): invalid list tail, probably missing glue
> !  ==> Fatal error occurred, no output PDF file produced!
> 
> It happens only with some fonts, not with others.

I have reduced it to this plain tex example 

\catcode`\@=11
\input switch.def
\input babel.def
\input luaotfload.sty

\bbl at patterns@lua{serbian}
\righthyphenmin=3
\catcode`\@=12

%\font\test={OldStandard:mode=node;script=cyrl.SRB;language=DFLT;+tlig;}
%works
\font\test={OldStandard:mode=node;script=latn;language=DFLT;+tlig;}
%fail

\test

oo^^^^0302xx

\bye

The chars are all ascii, no cyrillic involved.

I have also reduced the pattern: One can remove almost everything
from (local copies ...) of hyph-sh-latn.tex and hyph-sh-cyrl.tex. It
breaks if this pattern remains:

\patterns{
2o1
}




-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From nikola.lecic at anthesphoria.net  Wed May 10 14:16:24 2017
From: nikola.lecic at anthesphoria.net (Nikola =?UTF-8?B?TGXEjWnEhw==?=)
Date: Wed, 10 May 2017 15:16:24 +0300
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <1qorlgud0shje.dlg@nililand.de>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
 <1qorlgud0shje.dlg@nililand.de>
Message-ID: <201705101216.v4ACGfDj021315@anthesphoria.net>

On Wed, 10 May 2017 09:36:55 +0200
Ulrike Fischer <luatex at nililand.de> wrote:

> And the combining accent doesn't work correctly (with lualatex) in
> Old Standard if serbian is used:
> 
> \documentclass{article}
> \usepackage[serbian]{babel}
> \usepackage{fontspec}
> \setmainfont{Old Standard}
> \setsansfont{CMU Serif}
> \begin{document}
> \selectlanguage{serbian}
> %
> 
> \mbox{??\char"0302?x}
> \mbox{??^^^^0302?x}
> 
> \sffamily
> \mbox{??\char"0302?x}
> \mbox{??^^^^0302?x}
> 
> \end{document}

Oh...! '??' is completely lost.

Actually, your investigation gives me a perfect workaround: I can
enclose the problematic words (where a diacritic sign appears in the
middle) in another language, say \textenglish{}. This way a proper
kerning is preserved. Losing hyphenation is not a big problem in
texlive-sr, since there's not many words with combining diacritics in
it.

Ulrike, thank you for investigating this!

-- 
Nikola Le?i? = ?????? ?????
fingerprint : FEF3 66AF C90E EDC3 D878  7CDC 956D F4AB A377 1C9B
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 331 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20170510/f09fd491/attachment.sig>

From nikola.lecic at anthesphoria.net  Wed May 10 14:33:57 2017
From: nikola.lecic at anthesphoria.net (Nikola =?UTF-8?B?TGXEjWnEhw==?=)
Date: Wed, 10 May 2017 15:33:57 +0300
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <mby5ygyfualw.dlg@nililand.de>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <mby5ygyfualw.dlg@nililand.de>
Message-ID: <201705101234.v4ACY9Ti021663@anthesphoria.net>

On Wed, 10 May 2017 12:48:37 +0200
Ulrike Fischer <luatex at nililand.de> wrote:

> Am Wed, 10 May 2017 01:51:15 +0300 schrieb Nikola Le?i?:
> 
> > Hi,
> > 
> > If you compile this document twice
> > 
> > \documentclass{article}
> > \usepackage{polyglossia}
> > \setmainlanguage{serbian}
> > \setmainfont{Old Standard}
> > \begin{document}
> > ??\char"0302 ?
> > \end{document}
> > 
> > you should get
> > 
> > ! error:  (linebreak): invalid list tail, probably missing glue
> > !  ==> Fatal error occurred, no output PDF file produced!
> > 
> > It happens only with some fonts, not with others.  
> 
> I have reduced it to this plain tex example 
> 
> \catcode`\@=11
> \input switch.def
> \input babel.def
> \input luaotfload.sty
> 
> \bbl at patterns@lua{serbian}
> \righthyphenmin=3
> \catcode`\@=12
> 
> %\font\test={OldStandard:mode=node;script=cyrl.SRB;language=DFLT;+tlig;}
> %works
> \font\test={OldStandard:mode=node;script=latn;language=DFLT;+tlig;}
> %fail
> 
> \test
> 
> oo^^^^0302xx
> 
> \bye
> 
> The chars are all ascii, no cyrillic involved.
> 
> I have also reduced the pattern: One can remove almost everything
> from (local copies ...) of hyph-sh-latn.tex and hyph-sh-cyrl.tex. It
> breaks if this pattern remains:
> 
> \patterns{
> 2o1
> }

Just for the record, the same will happen with any diacritic sign that
can appear in Serbian (\char"0300, \char"0301, \char"\0302, \char"030F,
\char"0304, \char"0306) if they appear in the middle of a hyphen-able
word.

-- 
Nikola Le?i? = ?????? ?????
fingerprint : FEF3 66AF C90E EDC3 D878  7CDC 956D F4AB A377 1C9B
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 331 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20170510/1ece1390/attachment.sig>

From luatex at nililand.de  Wed May 10 16:52:13 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 10 May 2017 16:52:13 +0200
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
	invalid list tail, probably missing glue"
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
 <1qorlgud0shje.dlg@nililand.de>
 <201705101216.v4ACGfDj021315@anthesphoria.net>
Message-ID: <mhkxjarsm7rw$.dlg@nililand.de>

Am Wed, 10 May 2017 15:16:24 +0300 schrieb Nikola Le?i?:

> Actually, your investigation gives me a perfect workaround: I can
> enclose the problematic words (where a diacritic sign appears in the
> middle) in another language, say \textenglish{}. This way a proper
> kerning is preserved. Losing hyphenation is not a big problem in
> texlive-sr, since there's not many words with combining diacritics in
> it.

You could also load the font with disabled ccmp feature:

\setmainfont[RawFeature={-ccmp}]{Old Standard}


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From nikola.lecic at anthesphoria.net  Thu May 11 00:48:29 2017
From: nikola.lecic at anthesphoria.net (Nikola =?UTF-8?B?TGXEjWnEhw==?=)
Date: Thu, 11 May 2017 01:48:29 +0300
Subject: [luatex] Combining diacritics in some fonts: "(linebreak):
 invalid list tail, probably missing glue"
In-Reply-To: <mhkxjarsm7rw$.dlg@nililand.de>
References: <201705092251.v49MpUc0009400@anthesphoria.net>
 <49799.79.237.242.234.1494394345.webmail@webmail.zedat.fu-berlin.de>
 <1qorlgud0shje.dlg@nililand.de>
 <201705101216.v4ACGfDj021315@anthesphoria.net>
 <mhkxjarsm7rw$.dlg@nililand.de>
Message-ID: <201705102248.v4AMmewH032353@anthesphoria.net>

On Wed, 10 May 2017 16:52:13 +0200
Ulrike Fischer <luatex at nililand.de> wrote:

> Am Wed, 10 May 2017 15:16:24 +0300 schrieb Nikola Le?i?:
> 
> > Actually, your investigation gives me a perfect workaround: I can
> > enclose the problematic words (where a diacritic sign appears in the
> > middle) in another language, say \textenglish{}. This way a proper
> > kerning is preserved. Losing hyphenation is not a big problem in
> > texlive-sr, since there's not many words with combining diacritics
> > in it.  
> 
> You could also load the font with disabled ccmp feature:
> 
> \setmainfont[RawFeature={-ccmp}]{Old Standard}

Perfect, thank you! I've just committed a new
lualatex-compiled texlive-sr.

-- 
Nikola Le?i? = ?????? ?????
fingerprint : FEF3 66AF C90E EDC3 D878  7CDC 956D F4AB A377 1C9B
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 331 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20170511/d8cb3bb4/attachment.sig>

From analuciadm at gmail.com  Wed May 17 22:08:00 2017
From: analuciadm at gmail.com (=?UTF-8?Q?Ana_L=C3=BAcia_de_Moura?=)
Date: Wed, 17 May 2017 17:08:00 -0300
Subject: [luatex] How can I display arbitrary UNICODE characters?
Message-ID: <CA+BL8gLBuY1peOjGE19+3dr82UPa7JdnjRNGJZXu84sQk1gC=w@mail.gmail.com>

I'm currently developing an automatic pdf document generator using LuaLatex.
Unfortunately, the documents can contain arbitrary user-generated
utf-8 text which results in "blank" output if the corresponding glyphs
are not present in the selected font. Is there a (reasonable) way to
avoid this?

Ideally, I would love to to be able to define a chain of fallback fonts.

If that is not possible, another thing that would work for me would be
to be able to associate character ranges to specific fonts. (eg. a
font for the range of Chinese characters, another for Greek, ...).
It is worth reminding that I have to deal with arbitrary text (i.e,
Chinese names inside a Portuguese text) and font switching would need
to happen on a char-by-char basis.

Finally, if none of the above are possible, at least I would like to
be able to produce a "char not supported" glyph or fallback to system
fonts, instead of producing blank output.

Thanks in advance!
Ana

From listas at tex-tipografia.com  Thu May 18 20:24:52 2017
From: listas at tex-tipografia.com (Javier Bezos)
Date: Thu, 18 May 2017 20:24:52 +0200
Subject: [luatex] How can I display arbitrary UNICODE characters?
In-Reply-To: <CA+BL8gLBuY1peOjGE19+3dr82UPa7JdnjRNGJZXu84sQk1gC=w@mail.gmail.com>
References: <CA+BL8gLBuY1peOjGE19+3dr82UPa7JdnjRNGJZXu84sQk1gC=w@mail.gmail.com>
Message-ID: <591DE6F4.107@tex-tipografia.com>


> If that is not possible, another thing that would work for me would be
> to be able to associate character ranges to specific fonts. (eg. a
> font for the range of Chinese characters, another for Greek, ...).

Have a look at:

https://tex.stackexchange.com/questions/314397/defining-new-font-family-with-fontspec/314401#314401

Javier


From daniel.flipo at free.fr  Wed May 24 20:08:49 2017
From: daniel.flipo at free.fr (Daniel Flipo)
Date: Wed, 24 May 2017 20:08:49 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
Message-ID: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>

Hello,

Most TrueType fonts fail to output Unicode composite characters properly
when using LuaTeX while they do a good job with XeTeX.

Let's take <e-acute> as an example. In principle, <e-acute> can be coded
as U+00E9 or as U+0065 U+0301 (e+acute). The following example compiled
with LuaTeX shows differences which depend on the font:

--8<---------------cut here---------------start------------->8---
\input luaotfload.sty

\font\verdana={Verdana}
\font\georgia={Georgia}
\font\arial={Arial}
\font\roboto={Roboto}

% ?te? is coded as U+00E9 U+0074 U+0065 U+0301
% (visible using emacs for instance).
\verdana e^^^^0301, ?te?    % misplaces accent

\georgia e^^^^0301, ?te?    % swallows accent

\arial e^^^^0301, ?te?      % places accent (a lot) too high

\roboto e^^^^0301, ?te?     % correct

\bye
--8<---------------cut here---------------start------------->8---


The corresponding example for XeTeX would be:

--8<---------------cut here---------------start------------->8---
\input font-change-xetex

\myzfont {Verdana}{10}{}  e^^^^0301, ?te?   % correct

\myzfont {Georgia}{10}{}  e^^^^0301, ?te?   % correct

\myzfont {Arial}{10}{}    e^^^^0301, ?te?   % correct

\myzfont {Roboto}{10}{}   e^^^^0301, ?te?   % correct
\bye
--8<---------------cut here---------------start------------->8---


Should the TTF fonts be blamed or is it a LuaTeX bug? None of the
OpenType fonts I tried showed differences between the two encodings for
<e-acute> both with LuaTeX and XeTeX.

Thanks in advance for your comments and/or workarounds!
-- 
Daniel Flipo

From luatex at nililand.de  Thu May 25 19:00:37 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 25 May 2017 19:00:37 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
Message-ID: <1k7cdaahm6vb6.dlg@nililand.de>

Am Wed, 24 May 2017 20:08:49 +0200 schrieb Daniel Flipo:

> Most TrueType fonts fail to output Unicode composite characters properly
> when using LuaTeX while they do a good job with XeTeX.
> 
> Let's take <e-acute> as an example. In principle, <e-acute> can be coded
> as U+00E9 or as U+0065 U+0301 (e+acute). The following example compiled
> with LuaTeX shows differences which depend on the font:

There has been a rather long discussion about this on the context
list in februar:

http://www.mail-archive.com/ntg-context at ntg.nl/msg84424.html

In short: the harfbuzz library in xetex tries to use the composed
glyph if it exists. 

You can mimick this feature, by adding "ligatures" which combine the
accent and the char. This here works for me on texlive 2017:

\documentclass{article}

\directlua
{
  fonts.handlers.otf.addfeature
  {
    name = "compose",
    type = "ligature",
    data =
        {
          ["?"] = { "A", "^^^^0323"},
          ["?"] = { "B", "^^^^0323"},
          ["?"] = { "e","^^^^0301"},  
        },
  }
}

\begin{document}


\font\verdana={file:verdana.ttf:mode=node;+compose;}
\font\georgia={file:georgia.ttf:mode=node;+compose;}
\font\arial={file:arial.ttf:mode=node;+compose;}
\font\roboto={file:roboto-regular.ttf:mode=node;+compose;}

% ?te? is coded as U+00E9 U+0074 U+0065 U+0301
% (visible using emacs for instance).
\verdana e^^^^0301, ?te?    % misplaces accent

\georgia e^^^^0301, ?te?    % swallows accent

\arial e^^^^0301, ?te?      % places accent (a lot) too high

\roboto e^^^^0301, ?te?     % correct

\end{document}

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From daniel.flipo at free.fr  Fri May 26 08:54:20 2017
From: daniel.flipo at free.fr (Daniel Flipo)
Date: Fri, 26 May 2017 08:54:20 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
In-Reply-To: <1k7cdaahm6vb6.dlg@nililand.de>
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
 <1k7cdaahm6vb6.dlg@nililand.de>
Message-ID: <fc0190af-1158-a20f-00f5-69239bed7e4f@free.fr>


Le 25/05/2017 ? 19:00, Ulrike Fischer a ?crit :

> There has been a rather long discussion about this on the context
> list in februar:
> 
> http://www.mail-archive.com/ntg-context at ntg.nl/msg84424.html
> 
> In short: the harfbuzz library in xetex tries to use the composed
> glyph if it exists. 
> 
> You can mimick this feature, by adding "ligatures" which combine the
> accent and the char. This here works for me on texlive 2017:

Thanks Ulrike for the pointer and your code suggestion. I understand a
bit better what is going on now.

Best,
-- 
Daniel Flipo

From asuka_michele at yahoo.it  Fri May 26 12:40:55 2017
From: asuka_michele at yahoo.it (Michele Muccioli)
Date: Fri, 26 May 2017 10:40:55 +0000 (UTC)
Subject: [luatex] Different behaviour beetween LuaTeX e Lua
References: <254546954.542773.1495795255974.ref@mail.yahoo.com>
Message-ID: <254546954.542773.1495795255974@mail.yahoo.com>

Dear all,
? I'm trying to write a module in Lua in order to use it in LuaTeX.??I use TexLive 2016 with LuaTeX Version 0.95.0 (which has Lua version 5.2.*) and mingw with gcc 5.3.0 as C compiler.On my computer there is Lua version 5.2.4.
I compile the module (see attachment called LuaBasic.c) in the following way
? 1) Compile the .c file enabling some Lua definitions in order to have the possibility to create the dll x windows.? ? ?  gcc -O2 -c -DLUA_CORE -DLUA_BUILD_AS_DLL -o LuaBasic.o LuaBasic.c -I"C:\Users\Michele\Desktop\LuaSketch\LuaSketch_C\lua_src" ?? 2) Link the .o file to the dynamic library present in the TexLive folder (as you can see in the -L and -l options)? ? ?  gcc -O -shared -o LuaBasic.dll LuaBasic.o -L"C:\texlive\2016\bin\win32" -l "lua52" ?? 3) Delete the .o file? ? ?  del LuaBasic.o
The problem is: I have two different behaviour, the first when I use the module LuaBasic into Lua 5.2.4 ?and the second when used into LuaTeX.
In the first case I have no problems as you can see from theh attached pictured called ?LuaBasic_used_by_Lua5.2_NO_PROBLEM.png.
In the second case when I compile LuaLaTeX file called LuaBasic_test.tex, it crashes as you can see from the attached picture called LuaBasic_crashed.png. After several times compiling the tex file, a correct pdf is made.
In your opinion, where is the problem? Is the C source or something in the LuaTex?
Many thanks in advance for any suggestions.
Michele
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LuaBasic.c
Type: application/octet-stream
Size: 2335 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LuaBasic.dll
Type: application/x-msdownload
Size: 21880 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LuaBasic_crashed.png
Type: image/png
Size: 156005 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LuaBasic_test.tex
Type: application/octet-stream
Size: 395 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0003.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LuaBasic_used_by_Lua5.2_NO_PROBLEM.png
Type: image/png
Size: 112228 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170526/9a0d2645/attachment-0003.png>

From daniel.flipo at free.fr  Fri May 26 21:03:15 2017
From: daniel.flipo at free.fr (Daniel Flipo)
Date: Fri, 26 May 2017 21:03:15 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
In-Reply-To: <1k7cdaahm6vb6.dlg@nililand.de>
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
 <1k7cdaahm6vb6.dlg@nililand.de>
Message-ID: <9e93a66d-2060-a69b-aba1-35f3c98fc21d@free.fr>


Le 25/05/2017 ? 19:00, Ulrike Fischer a ?crit :

> There has been a rather long discussion about this on the context
> list in februar:
> 
> http://www.mail-archive.com/ntg-context at ntg.nl/msg84424.html
> 
> In short: the harfbuzz library in xetex tries to use the composed
> glyph if it exists. 
> 
> You can mimick this feature, by adding "ligatures" which combine the
> accent and the char. This here works for me on texlive 2017:

Your suggestion works fine for me also with fonts which do have the
needed diacritics (acute accent ^^^^0301 in my example), but fails
otherwise: this happens for instance with the Georgia font.

My concern is about French and fonts which have all the precomposed
characters used in French (???????????? lower and uppercase) built-in.
Fonts not satisfying this criteria (relying on composite characters
only) would probably not provide correct hyphenation anyway.

So another approach could be to build a table of possible composite
characters for a given language and a Lua function which would replace
each composite char found in the node list and belonging to the table
(f.i. e^^^^0301) by the corresponding precomposed char (?) or warn if
the replacement doesn't exist in the current output font.

Does something like this exist already?

Thanks,
-- 
Daniel Flipo

From luatex at nililand.de  Fri May 26 21:47:55 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 26 May 2017 21:47:55 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
 <1k7cdaahm6vb6.dlg@nililand.de>
 <9e93a66d-2060-a69b-aba1-35f3c98fc21d@free.fr>
Message-ID: <1ola22bubia0l.dlg@nililand.de>

Am Fri, 26 May 2017 21:03:15 +0200 schrieb Daniel Flipo:

 
> So another approach could be to build a table of possible composite
> characters for a given language and a Lua function which would replace
> each composite char found in the node list and belonging to the table
> (f.i. e^^^^0301) by the corresponding precomposed char (?) or warn if
> the replacement doesn't exist in the current output font.
> 
> Does something like this exist already?

In the context discussion decomposition (if the compose char doesn't
exist was discussed to. You can write a similar decompose feature 

fonts.handlers.otf.addfeature
  {
    name    = "decompose",
    type    = "multiple",
    nocheck = true, -- new trick
    data    =
        {
          ["?"] = { "Q", "?" },
          ["?"] = { "X", "?" },
        },
  }


But this is only in theory. If I remember correctly it needed the
context fontloader to work and currently it is no longer possible to
load this fontloader with luaotfload. So it is possible that you
will to wait that luaotfload updates.



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From kakuto at fuk.kindai.ac.jp  Sat May 27 02:39:53 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 27 May 2017 09:39:53 +0900
Subject: [luatex]  Different behaviour beetween LuaTeX e Lua
Message-ID: <5EEA5361207646629353569E260331AA@CJ3001517A>

> In the second case when I compile LuaLaTeX file called
> LuaBasic_test.tex, it crashes ...

Here it worked if I add a redundant one byte in LuaBasic.c:

typedef struct {
    LUA_NUMBER val[4]; 
} matrix;

Best,
Akira


From kakuto at fuk.kindai.ac.jp  Sat May 27 07:26:40 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 27 May 2017 14:26:40 +0900
Subject: [luatex]  Different behaviour beetween LuaTeX e Lua
Message-ID: <8C78CA9092544A29AF5FFBFF90B35B0D@CJ3001517A>

> Here it worked if I add a redundant one byte in LuaBasic.c:
>
> typedef struct {
>    LUA_NUMBER val[4]; 
> } matrix;

It is better to use your definition,

typedef struct {
   LUA_NUMBER val[3]; 
} matrix;

and change

val[X] ---> val[X-1]

below. For example,

for (i=1;i<4;i++)
{
     temp->val[i-1] = lua_tonumber(L,i);
}

Note that temp->val[3] was the cause of the crash.
You can write only on temp->val[0], temp->val[1], and temp->val[2].

Best,
Akira


From d.p.carlisle at gmail.com  Sat May 27 16:21:22 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 27 May 2017 15:21:22 +0100
Subject: [luatex] nested ifincsname broken in luatex
In-Reply-To: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
References: <CAEW6iOjVs0FB0PWno2wdovu81+wq6TbuFVM_M53txS3fMeZ27g@mail.gmail.com>
Message-ID: <CAEW6iOirFHb+bV7u2GvkxSdBzpvY2VQKdGGZRV5+1jsEXWmSUg@mail.gmail.com>

On 4 May 2017 at 09:12, David Carlisle <d.p.carlisle at gmail.com> wrote:

>
> the following plain tex file
>
> \ifcsname T\ifincsname e\else \hbox{e}\fi X\endcsname\fi
> \bye
>
>
> works in etex/pdftex/xetex but generates an error in luatex (tl2017
> pretest)
>
> ifincsname should be true in the implicit csname started by the outer
> ifincsname
>
>
> David
>
>
>

Thanks, this seems fixed in the development builds.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170527/8c13ab9c/attachment.html>

From daniel.flipo at free.fr  Sun May 28 15:14:16 2017
From: daniel.flipo at free.fr (Daniel Flipo)
Date: Sun, 28 May 2017 15:14:16 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
In-Reply-To: <1k7cdaahm6vb6.dlg@nililand.de>
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
 <1k7cdaahm6vb6.dlg@nililand.de>
Message-ID: <2d7e8c64-dc65-02b1-a629-a2ccd9fd3039@free.fr>


Le 25/05/2017 ? 19:00, Ulrike Fischer a ?crit :

> In short: the harfbuzz library in xetex tries to use the composed
> glyph if it exists. 
> 
> You can mimick this feature, by adding "ligatures" which combine the
> accent and the char. This here works for me on texlive 2017:

Both harfbuzz library in xetex and the "ligatures" option suggested by
Ulrike for luatex disturb the hyphenation process: the
"character+accent" are displayed as one glyph but count as two for
\lefthyphenmin and \righthyphenmin.

Example of flaw for French (\lefthyphenmin=2 \righthyphenmin=3):

\showhyphens{?largissons, e?largissons} % second ? = e^^^^0301

=> \TU/Verdana(0)/m/n/10 ?lar-gis-sons, ?-lar-gis-sons

\showhyphens{?ternit?, ?ternite?, ?ternit?s} % 4th ? = e^^^^0301

=> \TU/Verdana(0)/m/n/10 ?ter-nit?, ?ter-ni-t?, ?ter-ni-t?s,

Even if the coding "character+accent" is legal in Unicode, its usage
seems not to be fully supported neither in xetex nor in luatex.
Converting "character+accent" in the source file into a ready made
character is not a big deal anyway? currently, it looks to me like the
safest way to go.

-- 
Daniel Flipo

From luatex at nililand.de  Mon May 29 12:53:23 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 29 May 2017 12:53:23 +0200
Subject: [luatex] Unicode composite characters and TrueType fonts
References: <23955b5d-8329-0dc7-fb17-d49adc0fb0d9@free.fr>
 <1k7cdaahm6vb6.dlg@nililand.de>
 <2d7e8c64-dc65-02b1-a629-a2ccd9fd3039@free.fr>
Message-ID: <1w8dtdxefygxl$.dlg@nililand.de>

Am Sun, 28 May 2017 15:14:16 +0200 schrieb Daniel Flipo:

> Both harfbuzz library in xetex and the "ligatures" option suggested by
> Ulrike for luatex disturb the hyphenation process: the
> "character+accent" are displayed as one glyph but count as two for
> \lefthyphenmin and \righthyphenmin.

> Even if the coding "character+accent" is legal in Unicode, its usage
> seems not to be fully supported neither in xetex nor in luatex.
> Converting "character+accent" in the source file into a ready made
> character is not a big deal anyway? currently, it looks to me like the
> safest way to go.

Yes, but as there are combinations where there isn't a combining
glyph (in unicode or in the font) it would be better if luatex/xetex
handles this better. You could make a bug report
(http://tracker.luatex.org, https://sourceforge.net/p/xetex/bugs/).

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From thenders at gmail.com  Wed May 31 04:36:12 2017
From: thenders at gmail.com (Troy Henderson)
Date: Tue, 30 May 2017 21:36:12 -0500
Subject: [luatex] Reusable Code (LuaLaTeX + LuaMPlib)
Message-ID: <CAFP+xF+tk0GqzG3dLZis-fC9wNH5sOQxDEOivqovuTTWzMNRpw@mail.gmail.com>

I would like to reuse MetaPost code with LuaMPlib using LuaLaTeX.  The
following code drawss the line and typesets the text (label) correctly in
the first mplibcode, but the second mplibcode fails to typeset the text
(label).  I have two questions:


   1. Why is the text (label) not included in currentpicture to be reused?
   I believe that it is mentioned in the \mplibcodeinherit{enable} section of
   the LuaMPlib manual, but I don't fully understand why it is so.
   2. How can I reuse the code (perhaps with some TeX/LaTeX
   \def/\newcommand macros)?

I would appreciate any insight into this problem.  Thank you in advance.

Troy Henderson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170530/d79d3d01/attachment.html>

From thenders at gmail.com  Wed May 31 04:37:36 2017
From: thenders at gmail.com (Troy Henderson)
Date: Tue, 30 May 2017 21:37:36 -0500
Subject: [luatex] Reusable Code (LuaLaTeX + LuaMPlib)
In-Reply-To: <CAFP+xF+tk0GqzG3dLZis-fC9wNH5sOQxDEOivqovuTTWzMNRpw@mail.gmail.com>
References: <CAFP+xF+tk0GqzG3dLZis-fC9wNH5sOQxDEOivqovuTTWzMNRpw@mail.gmail.com>
Message-ID: <CAFP+xFKSUx5FQnuXrfxhJYiNZwT8MujQiYo_P88+Kkf2oiR-=g@mail.gmail.com>

Apologies, but I forgot to paste my code.  Here it is:

\documentclass{article}
\usepackage{luamplib}

\mplibtextextlabel{enable}
\mplibcodeinherit{enable}

\begin{document}
    \begin{center}
        \begin{mplibcode}
            picture p;
            beginfig(0);
                draw (-36,0)--(36,0);
                label.bot(textext("Hello"),origin);
                p:=currentpicture;
            endfig;
        \end{mplibcode}
    \end{center}

    \begin{center}
        \begin{mplibcode}
            beginfig(1);
                currentpicture:=p;
            endfig;
        \end{mplibcode}
    \end{center}

\end{document}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170530/43ac7971/attachment.html>

From knuesel at gmail.com  Wed May 31 15:44:00 2017
From: knuesel at gmail.com (Jeremie Knuesel)
Date: Wed, 31 May 2017 13:44:00 +0000
Subject: [luatex] tex.linebreak produces different baselineskip glues
Message-ID: <CAJqiw2Gg26pvcwK8XU2vv903JeV2ejbVyNA7wC7KO6zBn6LS6w@mail.gmail.com>

Hi,

It seems that using tex.linebreak in the linebreak_filter callback produces
a different result (compared to the default with no callback): it changes
the spacing between paragraphs.

Consider the following:

\documentclass{article}
\usepackage{luatexbase}
\usepackage{lipsum}
\setlength\parskip{0pt}
\begin{document}
% \directlua{ luatexbase.add_to_callback("linebreak_filter", tex.linebreak,
"texlinebreak") }
\lipsum[1-5]
\end{document}

By setting parskip to 0pt this typesets the text on a grid. But uncomment
the \directlua call and you get additional space between paragraphs.

Is this known behavior? How can I build the paragraphs with tex.linebreak
and still get the expected vertical spacing?

Thanks,

Jeremie Knuesel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170531/b9446695/attachment.html>

