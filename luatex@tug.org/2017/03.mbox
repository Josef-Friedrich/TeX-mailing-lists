From luatex at nililand.de  Thu Mar  2 18:51:41 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 2 Mar 2017 18:51:41 +0100
Subject: [luatex] possible engine bug: glyphs displaced
Message-ID: <9v0l9mqge764$.dlg@nililand.de>


I'm forwarding a discussion from the luaotfload issue tracker as it
is possible that it indicates a bug introduced between version 1.0.0
and 1.0.4

In the following document the ^^^^0645 is displaced to the left.
With luatex 1.0.0. (miktex) only if it is used in a \hbox. 
With luatex 1.0.4. in all three cases. 

The luaotfload version was the same, as fontloader I used the newest
from the context minimals. 

So it looks as if some change in the engine was made -- perhaps to
correct the \hbox error -- which made the problem worse.


Some more details and some pictures can be found here:
https://github.com/lualatex/luaotfload/issues/410

Disclaimer: I can't read or write arabic or some other
right-to-left-script.  



\documentclass{article}

\begin{document}
\textdir TRT

\font\amiri={file:amiri-regular.ttf:script=arab} at 80pt
\amiri

^^^^0637 ^^^^0645^^^^062d^^^^064a^^^^0637\par

\leavevmode\hbox dir TRT {^^^^0637 ^^^^0645^^^^062d^^^^064a^^^^0637}

\vbox dir TRT {^^^^0637 ^^^^0645^^^^062d^^^^064a^^^^0637}

\end{document}


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From isaac at isb1009.es  Sat Mar  4 23:11:31 2017
From: isaac at isb1009.es (=?UTF-8?Q?Isaac_S=c3=a1nchez_Barrera?=)
Date: Sat, 4 Mar 2017 23:11:31 +0100
Subject: [luatex] Hyphenation of \verb in LuaLaTeX 1.0.x
Message-ID: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>

Hi,

For testing purposes, I have installed the latest "stable" release of 
LuaTeX following a comment in tex.stackexchange.com by David Carlisle 
<http://tex.stackexchange.com/questions/352434/spacing-in-lualatex-with-unicode-math#comment866185_352439>. 
I have installed ConTeXt Standalone in a local directory, copied the 
luatex binary (1.0.3) on top of my MacTeX 2016 install (which is 
up-to-date), and run `fmtutil-sys --refresh` afterwards.

To my surprise, after compiling a LaTeX document with some inline 
verbatim, I saw a strange behaviour: the \verb+words+ were hyphenated! I 
checked with a colleague that uses MiKTeX (with luatex 1.0.0) and he has 
the same behaviour, so it is not a problem with my install.

I have been able to reproduce the issue with a MWE which you can find 
attached (test.tex) along with the LuaLaTeX 0.95 (test.pdf) and 1.0.3 
(test-103.pdf) outputs. In short, the hyphenation in 1.0.3 happens after 
setting the mono font with fontspec (it does not happen after setting 
the other families, tested it already).

I am not sure if this is an issue with fontspec or luaotfload or luatex 
itself, but I am reporting the issue to this list because it looks like 
a regression in the latest luatex releases. Apologies if it has been 
reported already, but I have not been able to see a similar issue in the 
list, in TeX.SE, Google or the issue queues in Github for fontspec and 
luaotfload. If this is not the place to report the issue, please direct 
me to the correct one :)


Thanks for your help.
Regards,

Isaac
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-103.pdf
Type: application/pdf
Size: 7381 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170304/b81941d7/attachment.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: application/x-tex
Size: 2187 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170304/b81941d7/attachment.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-095.pdf
Type: application/pdf
Size: 7147 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170304/b81941d7/attachment-0001.pdf>

From d.p.carlisle at gmail.com  Sat Mar  4 23:36:50 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 4 Mar 2017 22:36:50 +0000
Subject: [luatex] Hyphenation of \verb in LuaLaTeX 1.0.x
In-Reply-To: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>
References: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>
Message-ID: <CAEW6iOgTDkV3zVdxf07ZiBbD+4kJY_Uc936LjcRx6rYWjMFp6g@mail.gmail.com>

this doesn't look like  a luatex issue, looks like fontspec,
the hyphenchar is not unset with the new mono font.
If you  change the middle of your example to say

\setmonofont{Latin Modern Mono}

{\ttfamily \showthe\font
\hyphenchar\font=-1
}

then there is no hyphenation in the second half.

(hyphenchar isn't really the recommended way to suppress hyphenation
in luatex but I think verb
currently just relies on that having been set up for the monospace font)



Actually I'm a bit surprised, that with xetex hyphenchar is also 45
rather than -1 but there's no hyphenation anyway, Will?

David

From d.p.carlisle at gmail.com  Sun Mar  5 00:20:13 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 4 Mar 2017 23:20:13 +0000
Subject: [luatex] Hyphenation of \verb in LuaLaTeX 1.0.x
In-Reply-To: <CAEW6iOgTDkV3zVdxf07ZiBbD+4kJY_Uc936LjcRx6rYWjMFp6g@mail.gmail.com>
References: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>
 <CAEW6iOgTDkV3zVdxf07ZiBbD+4kJY_Uc936LjcRx6rYWjMFp6g@mail.gmail.com>
Message-ID: <CAEW6iOgmougN9kfqt21FkQ=w5NvE-2ecoRgLOufER9QTs5=yzA@mail.gmail.com>

I think actually it was more or less accidentally  not hyphenating
previously (or in xetex) as hyphenchar is 45 hyphenation isn't
suppressed in verb but the first word (only) of each verb  is not
considered as a word for hyphenation due to some of the verb setup
latex does, that is certainly not a documented feature of latex:-)

the new \hyphenationbounds=1 possibility of luatex 1.x would give the
old behaviour here but I think setting the font's hyphenchar to -1 (or
better perhaps latex should make \verb set the language to none)

From r.f.wolpert at gmail.com  Sun Mar  5 03:18:30 2017
From: r.f.wolpert at gmail.com (Rembrandt Wolpert)
Date: Sat, 4 Mar 2017 20:18:30 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
Message-ID: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>

I wonder if this is just my problem...:

after a very recent full update of texlive everything I tried to compile
failed with:

<snip>
  (/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
  *************************************************
  * fontspec warning: "tu-clash"
  *
  * I have found the tuenc.def encoding definition file but the TU
encoding is
  * not defined by the LaTeX2e kernel; attempting to correct but you really
  * should update to the latest version of LaTeX2e.
  *************************************************
  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
  ! Missing \endcsname inserted.
  <to be read again>
  \def
  l.252 ...             \UnicodeEncodingName {}{"007E}

  ?
<snip>

The two (newly introduced) lines in tuenc.def which offended my lualatex
(0.95, from texlive 2016) are:

\DeclareTextComposite{\^}             \UnicodeEncodingName {}{"005E}
\DeclareTextComposite{\~}             \UnicodeEncodingName {}{"007E}

After commenting these out the compilation worked fine. Please note,
that the "offending" lines caused no problem when compiling the MWE with
xelatex (but I am using lualatex).

Here's a M(N)WE:

  \documentclass{article}
  %\usepackage{luatex85} % un-comment when compiling with lualatex
  \usepackage{fontspec}
  %\setmainfont{Brill} % this would be a free and rather comprehensive
typeface
  \begin{document}
  Won't compile under lualatex with newest tuenc.def.
  Compiles fine with xelatex.
  \end{document}

Is there just something wrong with my system? And if so, what would be a
remedy (other than commenting the two lines out, which I did to be able
to continue working)?

(MacOS 10.8.5, texlive (mactex) 2016, last update 3 days ago.)

Best,
Rembrandt

-- 
??????????
                          - ??

From preining at logic.at  Sun Mar  5 03:34:28 2017
From: preining at logic.at (Norbert Preining)
Date: Sun, 05 Mar 2017 11:34:28 +0900
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
Message-ID: <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>

If you have updated to latest TeX Live you should have LaTeX patch level 3. The this is fixed.

Please show the full log, best including the -recorder CMD line option and the generated .fls file.

Norbert


On March 5, 2017 11:18:30 AM GMT+09:00, Rembrandt Wolpert <r.f.wolpert at gmail.com> wrote:
>I wonder if this is just my problem...:
>
>after a very recent full update of texlive everything I tried to
>compile
>failed with:
>
><snip>
>(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
>  *************************************************
>  * fontspec warning: "tu-clash"
>  *
>  * I have found the tuenc.def encoding definition file but the TU
>encoding is
>* not defined by the LaTeX2e kernel; attempting to correct but you
>really
>  * should update to the latest version of LaTeX2e.
>  *************************************************
>  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
>  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
>  ! Missing \endcsname inserted.
>  <to be read again>
>  \def
>  l.252 ...             \UnicodeEncodingName {}{"007E}
>
>  ?
><snip>
>
>The two (newly introduced) lines in tuenc.def which offended my
>lualatex
>(0.95, from texlive 2016) are:
>
>\DeclareTextComposite{\^}             \UnicodeEncodingName {}{"005E}
>\DeclareTextComposite{\~}             \UnicodeEncodingName {}{"007E}
>
>After commenting these out the compilation worked fine. Please note,
>that the "offending" lines caused no problem when compiling the MWE
>with
>xelatex (but I am using lualatex).
>
>Here's a M(N)WE:
>
>  \documentclass{article}
>  %\usepackage{luatex85} % un-comment when compiling with lualatex
>  \usepackage{fontspec}
>  %\setmainfont{Brill} % this would be a free and rather comprehensive
>typeface
>  \begin{document}
>  Won't compile under lualatex with newest tuenc.def.
>  Compiles fine with xelatex.
>  \end{document}
>
>Is there just something wrong with my system? And if so, what would be
>a
>remedy (other than commenting the two lines out, which I did to be able
>to continue working)?
>
>(MacOS 10.8.5, texlive (mactex) 2016, last update 3 days ago.)
>
>Best,
>Rembrandt

--
PREINING Norbert + TeX Live & Debian Developer + http://www.preining.info
GPG: 0x860CDC13 fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13


From r.f.wolpert at gmail.com  Sun Mar  5 05:52:29 2017
From: r.f.wolpert at gmail.com (Rembrandt Wolpert)
Date: Sat, 4 Mar 2017 22:52:29 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
Message-ID: <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>

On 3/4/17 8:34 PM, Norbert Preining wrote:
> If you have updated to latest TeX Live you should have LaTeX patch level 3. The this is fixed.
> 
> Please show the full log, best including the -recorder CMD line option and the generated .fls file.
> 
> Norbert
> 
> 
> On March 5, 2017 11:18:30 AM GMT+09:00, Rembrandt Wolpert <r.f.wolpert at gmail.com> wrote:
>> I wonder if this is just my problem...:
>>
>> after a very recent full update of texlive everything I tried to
>> compile
>> failed with:
>>
>> <snip>
>> (/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
>>  *************************************************
>>  * fontspec warning: "tu-clash"
>>  *
>>  * I have found the tuenc.def encoding definition file but the TU
>> encoding is
>> * not defined by the LaTeX2e kernel; attempting to correct but you
>> really
>>  * should update to the latest version of LaTeX2e.
>>  *************************************************
>>  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
>>  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
>>  ! Missing \endcsname inserted.
>>  <to be read again>
>>  \def
>>  l.252 ...             \UnicodeEncodingName {}{"007E}
>>
>>  ?
>> <snip>
>>
>> The two (newly introduced) lines in tuenc.def which offended my
>> lualatex
>> (0.95, from texlive 2016) are:
>>
>> \DeclareTextComposite{\^}             \UnicodeEncodingName {}{"005E}
>> \DeclareTextComposite{\~}             \UnicodeEncodingName {}{"007E}
>>
>> After commenting these out the compilation worked fine. Please note,
>> that the "offending" lines caused no problem when compiling the MWE
>> with
>> xelatex (but I am using lualatex).
>>
>> Here's a M(N)WE:
>>
>>  \documentclass{article}
>>  %\usepackage{luatex85} % un-comment when compiling with lualatex
>>  \usepackage{fontspec}
>>  %\setmainfont{Brill} % this would be a free and rather comprehensive
>> typeface
>>  \begin{document}
>>  Won't compile under lualatex with newest tuenc.def.
>>  Compiles fine with xelatex.
>>  \end{document}
>>
>> Is there just something wrong with my system? And if so, what would be
>> a
>> remedy (other than commenting the two lines out, which I did to be able
>> to continue working)?
>>
>> (MacOS 10.8.5, texlive (mactex) 2016, last update 3 days ago.)
>>
>> Best,
>> Rembrandt
> 
> --
> PREINING Norbert + TeX Live & Debian Developer + http://www.preining.info
> GPG: 0x860CDC13 fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
> 

Weird. I re-installed texlive/mactex 2016 from scratch (yes, I removed
the previous one), ran sudo tlmgr update --self --all; had a few cups of
tea in between; and then ran lualatex -recorder on the MWE-file. Same
complaints when compiling; hitting twice return at the question-mark got
me to the end: a pdf-file with a tilde floating somewhere high on the
page, the expected text, and a W right in the margin (I can send you the
pdf). How could I not have the patch?

Attached the .log and .fls files.

Many thanks,
Rembrandt
-- 
??????????
                          - ??
-------------- next part --------------
This is LuaTeX, Version 0.95.0 (TeX Live 2016)  (format=lualatex 2016.5.14)  4 MAR 2017 22:13
 restricted system commands enabled.
**silly.tex
(./silly.tex
LaTeX2e <2016/03/31>
Babel <3.9r> and hyphenation patterns for 1 language(s) loaded.
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/article.cls
Document Class: article 2014/09/29 v1.4h Standard LaTeX document class
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/size10.clo
File: size10.clo 2014/09/29 v1.4h Standard LaTeX file (size option)
)
\c at part=\count79
\c at section=\count80
\c at subsection=\count81
\c at subsubsection=\count82
\c at paragraph=\count83
\c at subparagraph=\count84
\c at figure=\count85
\c at table=\count86
\abovecaptionskip=\skip41
\belowcaptionskip=\skip42
\bibindent=\dimen102
)
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3.sty
Package: expl3 2017/02/10 v6878 L3 programming layer (loader) 

(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3-code.tex
Package: expl3 2017/02/10 v6878 L3 programming layer (code)
L3 Module: l3bootstrap 2016/12/28 v6805 L3 Bootstrap code
\ucharcat at table=\catcodetable5
L3 Module: l3names 2016/12/28 v6805 L3 Namespace for primitives
L3 Module: l3basics 2016/12/28 v6805 L3 Basic definitions
L3 Module: l3expan 2016/12/28 v6805 L3 Argument expansion
L3 Module: l3tl 2017/02/06 v6842 L3 Token lists
L3 Module: l3str 2017/01/01 v6809 L3 Strings
L3 Module: l3seq 2017/02/06 v6842 L3 Sequences and stacks
L3 Module: l3int 2016/12/28 v6805 L3 Integers
\c_max_int=\count87
\l_tmpa_int=\count88
\l_tmpb_int=\count89
\g_tmpa_int=\count90
\g_tmpb_int=\count91
L3 Module: l3quark 2016/12/28 v6805 L3 Quarks
L3 Module: l3prg 2017/01/01 v6811 L3 Control structures
\g__prg_map_int=\count92
L3 Module: l3clist 2017/02/06 v6842 L3 Comma separated lists
L3 Module: l3token 2016/12/28 v6805 L3 Experimental token manipulation
L3 Module: l3prop 2016/12/28 v6805 L3 Property lists
L3 Module: l3msg 2016/12/28 v6805 L3 Messages
L3 Module: l3file 2016/12/28 v6805 L3 File and I/O operations
\l_iow_line_count_int=\count93
\l__iow_target_count_int=\count94
\l__iow_current_line_int=\count95
\l__iow_current_word_int=\count96
\l__iow_current_indentation_int=\count97
L3 Module: l3skip 2017/01/01 v6809 L3 Dimensions and skips
\c_zero_dim=\dimen103
\c_max_dim=\dimen104
\l_tmpa_dim=\dimen105
\l_tmpb_dim=\dimen106
\g_tmpa_dim=\dimen107
\g_tmpb_dim=\dimen108
\c_zero_skip=\skip43
\c_max_skip=\skip44
\l_tmpa_skip=\skip45
\l_tmpb_skip=\skip46
\g_tmpa_skip=\skip47
\g_tmpb_skip=\skip48
\c_zero_muskip=\muskip10
\c_max_muskip=\muskip11
\l_tmpa_muskip=\muskip12
\l_tmpb_muskip=\muskip13
\g_tmpa_muskip=\muskip14
\g_tmpb_muskip=\muskip15
L3 Module: l3keys 2017/01/01 v6811 L3 Key-value interfaces
\l_keys_choice_int=\count98
L3 Module: l3fp 2016/12/28 v6805 L3 Floating points
\c__fp_leading_shift_int=\count99
\c__fp_middle_shift_int=\count100
\c__fp_trailing_shift_int=\count101
\c__fp_big_leading_shift_int=\count102
\c__fp_big_middle_shift_int=\count103
\c__fp_big_trailing_shift_int=\count104
\c__fp_Bigg_leading_shift_int=\count105
\c__fp_Bigg_middle_shift_int=\count106
\c__fp_Bigg_trailing_shift_int=\count107
\c__fp_rand_size_int=\count108
\c__fp_rand_four_int=\count109
\c__fp_rand_eight_int=\count110
L3 Module: l3sort 2017/02/07 v6847 L3 Sorting functions
\l__sort_length_int=\count111
\l__sort_min_int=\count112
\l__sort_top_int=\count113
\l__sort_max_int=\count114
\l__sort_true_max_int=\count115
\l__sort_block_int=\count116
\l__sort_begin_int=\count117
\l__sort_end_int=\count118
\l__sort_A_int=\count119
\l__sort_B_int=\count120
\l__sort_C_int=\count121
L3 Module: l3box 2016/12/28 v6805 L3 Experimental boxes
\c_empty_box=\box26
\l_tmpa_box=\box27
\l_tmpb_box=\box28
\g_tmpa_box=\box29
\g_tmpb_box=\box30
L3 Module: l3coffins 2016/12/28 v6805 L3 Coffin code layer
\l__coffin_internal_box=\box31
\l__coffin_internal_dim=\dimen109
\l__coffin_offset_x_dim=\dimen110
\l__coffin_offset_y_dim=\dimen111
\l__coffin_x_dim=\dimen112
\l__coffin_y_dim=\dimen113
\l__coffin_x_prime_dim=\dimen114
\l__coffin_y_prime_dim=\dimen115
\c_empty_coffin=\box32
\l__coffin_aligned_coffin=\box33
\l__coffin_aligned_internal_coffin=\box34
\l_tmpa_coffin=\box35
\l_tmpb_coffin=\box36
\l__coffin_display_coffin=\box37
\l__coffin_display_coord_coffin=\box38
\l__coffin_display_pole_coffin=\box39
\l__coffin_display_offset_dim=\dimen116
\l__coffin_display_x_dim=\dimen117
\l__coffin_display_y_dim=\dimen118
L3 Module: l3color 2016/12/28 v6805 L3 Experimental color support
L3 Module: l3sys 2017/01/01 v6811 L3 Experimental system/runtime functions
L3 Module: l3candidates 2017/01/30 v6835 L3 Experimental additions to l3kernel
\l__box_top_dim=\dimen119
\l__box_bottom_dim=\dimen120
\l__box_left_dim=\dimen121
\l__box_right_dim=\dimen122
\l__box_top_new_dim=\dimen123
\l__box_bottom_new_dim=\dimen124
\l__box_left_new_dim=\dimen125
\l__box_right_new_dim=\dimen126
\l__box_internal_box=\box40
\l__coffin_bounding_shift_dim=\dimen127
\l__coffin_left_corner_dim=\dimen128
\l__coffin_right_corner_dim=\dimen129
\l__coffin_bottom_corner_dim=\dimen130
\l__coffin_top_corner_dim=\dimen131
\l__coffin_scaled_total_height_dim=\dimen132
\l__coffin_scaled_width_dim=\dimen133
L3 Module: l3luatex 2016/12/28 v6805 L3 Experimental LuaTeX-specific functions
)
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/l3pdfmode.def
File: l3pdfmode.def 2016/12/28 v6805 L3 Experimental driver: PDF mode
\l__driver_color_stack_int=\count122
\l__driver_tmp_box=\box41
))
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3packages/xparse/xparse.sty
Package: xparse 2017/02/10 v6878 L3 Experimental document command parser
\l__xparse_current_arg_int=\count123
\g__xparse_grabber_int=\count124
\l__xparse_m_args_int=\count125
\l__xparse_mandatory_args_int=\count126
\l__xparse_v_nesting_int=\count127
)
Package: fontspec 2017/02/12 v2.6 Font selection for XeLaTeX and LuaLaTeX

(/usr/local/texlive/2016/texmf-dist/tex/luatex/luaotfload/luaotfload.sty
Package: luaotfload 2017/01/29 v2.8 OpenType layout system
Lua module: luaotfload-main 2017/01/29 2.80001 OpenType layout system.
Lua module: lualibs 2017-02-01 2.5 ConTeXt Lua standard libraries.
Lua module: lualibs-extended 2017-02-01 2.5 ConTeXt Lua libraries -- extended co
llection.(using write cache: /Users/wolpert/Library/texlive/2016/texmf-var/luate
x-cache/generic)(using read cache: /usr/local/texlive/2016/texmf-var/luatex-cach
e/generic /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic)
luaotfload | conf : Root cache directory is /Users/wolpert/Library/texlive/2016/
texmf-var/luatex-cache/generic/names.
luaotfload | init : Loading fontloader ?fontloader-2017-02-11.lua? from kpse
-resolved path ?/usr/local/texlive/2016/texmf-dist/tex/luatex/luaotfload/fontl
oader-2017-02-11.lua?.
Lua-only attribute luaotfload at state = 1
Lua-only attribute luaotfload at noligature = 2
Lua-only attribute luaotfload at syllabe = 3
luaotfload | init : Context OpenType loader version ?3.027?
Inserting `luaotfload.node_processor' at position 1 in `pre_linebreak_filter'.
Inserting `luaotfload.node_processor' at position 1 in `hpack_filter'.
Inserting `luaotfload.define_font' at position 1 in `define_font'.
Lua-only attribute luaotfload_color_attribute = 4
luaotfload | conf : Root cache directory is /Users/wolpert/Library/texlive/2016/
texmf-var/luatex-cache/generic/names.
Inserting `luaotfload.aux.set_sscale_dimens' at position 1 in `luaotfload.patch_
font'.
Inserting `luaotfload.aux.patch_cambria_domh' at position 2 in `luaotfload.patch
_font'.
Inserting `luaotfload.aux.fixup_fontdata' at position 1 in `luaotfload.patch_fon
t_unsafe'.
Inserting `luaotfload.aux.set_capheight' at position 3 in `luaotfload.patch_font
'.
Inserting `luaotfload.rewrite_fontname' at position 4 in `luaotfload.patch_font'
.
luaotfload | main : initialization completed in 0.153 seconds)
Lua module: fontspec 2017/02/12 2.6 Font selection for XeLaTeX and LuaLaTeX
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
Package: fontspec-luatex 2017/02/12 v2.6 Font selection for XeLaTeX and LuaLaTeX

\l__fontspec_script_int=\count128
\l__fontspec_language_int=\count129
\l__fontspec_strnum_int=\count130
\l__fontspec_tmp_int=\count131
\l__fontspec_em_int=\count132
\l__fontspec_emdef_int=\count133
\l__fontspec_strong_int=\count134
\l__fontspec_strongdef_int=\count135
\l__fontspec_tmpa_dim=\dimen134
\l__fontspec_tmpb_dim=\dimen135
\l__fontspec_tmpc_dim=\dimen136
\g__file_internal_ior=\read1

*************************************************
* fontspec warning: "tu-clash"
* 
* I have found the tuenc.def encoding definition file but the TU encoding is
* not defined by the LaTeX2e kernel; attempting to correct but you really
* should update to the latest version of LaTeX2e.
*************************************************
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
Package: fontenc 2017/02/22 v2.0g Standard LaTeX package

(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
File: tuenc.def 2017/02/22 v2.0g Standard LaTeX file
LaTeX Font Info:    Redeclaring font encoding TU on input line 82.

! Missing \endcsname inserted.
<to be read again> 
\def 
l.252 ...             \UnicodeEncodingName {}{"007E}
                                                  
? 

! LaTeX Error: Missing \begin{document}.

See the LaTeX manual or LaTeX Companion for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.252 ...             \UnicodeEncodingName {}{"007E}
                                                  
? 
)
LaTeX Font Info:    Try loading font information for TU+cmr on input line 105.
LaTeX Font Info:    No file TUcmr.fd. on input line 105.
LaTeX Font Info:    Try loading font information for TU+lmr on input line 105.
 (/usr/local/texlive/2016/texmf-dist/tex/latex/base/tulmr.fd
File: tulmr.fd 2017/01/26 v1.8 Standard LaTeX font definitions for Latin Modern
)

LaTeX Font Warning: Font shape `TU/cmr/m/n' undefined
(Font)              using `TU/lmr/m/n' instead on input line 105.

luaotfload | db : Font names database loaded from /Users/wolpert/Library/texlive
/2016/texmf-var/luatex-cache/generic/names/luaotfload-names.luc(load luc: /Users
/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10
-regular.luc))
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \fontspec with sig. 'O{}mO{}' on line 478.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setmainfont with sig. 'O{}mO{}' on line 494.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setsansfont with sig. 'O{}mO{}' on line 510.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setmonofont with sig. 'O{}mO{}' on line 526.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setmathrm with sig. 'O{}mO{}' on line 531.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setboldmathrm with sig. 'O{}mO{}' on line 536.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setmathsf with sig. 'O{}mO{}' on line 541.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \setmathtt with sig. 'O{}mO{}' on line 546.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newfontfamily with sig. 'mO{}mO{}' on line 566.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newfontface with sig. 'mO{}mO{}' on line 570.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \defaultfontfeatures with sig. 't+om' on line 577.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \addfontfeatures with sig. 'm' on line 626.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newfontfeature with sig. 'mm' on line 637.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newAATfeature with sig. 'mmmm' on line 645.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newopentypefeature with sig. 'mmm' on line 655.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \aliasfontfeature with sig. 'mm' on line 678.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \aliasfontfeatureoption with sig. 'mmm' on line 695.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newfontscript with sig. 'mm' on line 699.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \newfontlanguage with sig. 'mm' on line 703.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \DeclareFontsExtensions with sig. 'm' on line 708.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \IfFontFeatureActiveTF with sig. 'mmm' on line 714.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \EncodingCommand with sig. 'mO{}m' on line 3062.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \EncodingAccent with sig. 'mm' on line 3068.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \EncodingSymbol with sig. 'mm' on line 3074.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \EncodingComposite with sig. 'mmm' on line 3080.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \EncodingCompositeCommand with sig. 'mmm' on line 3086.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \DeclareUnicodeEncoding with sig. 'mm' on line 3111.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \UndeclareSymbol with sig. 'm' on line 3117.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \UndeclareComposite with sig. 'mm' on line 3125.
.................................................

(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg)
LaTeX Info: Redefining \itshape on input line 3310.
LaTeX Info: Redefining \slshape on input line 3315.
LaTeX Info: Redefining \scshape on input line 3320.
LaTeX Info: Redefining \upshape on input line 3325.
LaTeX Info: Redefining \em on input line 3355.
LaTeX Info: Redefining \emph on input line 3380.
(load luc: /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/fo
nts/otl/lmroman10-bold.luc)(load luc: /Users/wolpert/Library/texlive/2016/texmf-
var/luatex-cache/generic/fonts/otl/lmroman10-italic.luc)
LaTeX Info: Redefining \- on input line 3431.
.................................................
. LaTeX info: "xparse/redefine-command"
. 
. Redefining command \oldstylenums with sig. 'm' on line 3526.
.................................................
.................................................
. LaTeX info: "xparse/define-command"
. 
. Defining command \liningnums with sig. 'm' on line 3530.
.................................................
))
No file silly.aux.

\openout1 = silly.aux
LaTeX Font Info:    Checking defaults for OML/cmm/m/it on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for T1/cmr/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for OT1/cmr/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for OMS/cmsy/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for OMX/cmex/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for U/cmr/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
LaTeX Font Info:    Checking defaults for TU/lmr/m/n on input line 16.
LaTeX Font Info:    ... okay on input line 16.
.................................................
. fontspec info: "setup-math"
. 
. Adjusting the maths setup (use [no-math] to avoid this).
.................................................
\symlegacymaths=\mathgroup4
LaTeX Font Info:    Overwriting symbol font `legacymaths' in version `bold'
(Font)                  OT1/cmr/m/n --> OT1/cmr/bx/n on input line 16.
LaTeX Font Info:    Redeclaring math accent \acute on input line 16.
LaTeX Font Info:    Redeclaring math accent \grave on input line 16.
LaTeX Font Info:    Redeclaring math accent \ddot on input line 16.
LaTeX Font Info:    Redeclaring math accent \tilde on input line 16.
LaTeX Font Info:    Redeclaring math accent \bar on input line 16.
LaTeX Font Info:    Redeclaring math accent \breve on input line 16.
LaTeX Font Info:    Redeclaring math accent \check on input line 16.
LaTeX Font Info:    Redeclaring math accent \hat on input line 16.
LaTeX Font Info:    Redeclaring math accent \dot on input line 16.
LaTeX Font Info:    Redeclaring math accent \mathring on input line 16.
LaTeX Font Info:    Redeclaring math symbol \colon on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Gamma on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Delta on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Theta on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Lambda on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Xi on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Pi on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Sigma on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Upsilon on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Phi on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Psi on input line 16.
LaTeX Font Info:    Redeclaring math symbol \Omega on input line 16.
LaTeX Font Info:    Redeclaring math symbol \mathdollar on input line 16.
LaTeX Font Info:    Redeclaring symbol font `operators' on input line 16.
LaTeX Font Info:    Encoding `OT1' has changed to `TU' for symbol font
(Font)              `operators' in the math version `normal' on input line 16.
LaTeX Font Info:    Overwriting symbol font `operators' in version `normal'
(Font)                  OT1/cmr/m/n --> TU/lmr/m/n on input line 16.
LaTeX Font Info:    Encoding `OT1' has changed to `TU' for symbol font
(Font)              `operators' in the math version `bold' on input line 16.
LaTeX Font Info:    Overwriting symbol font `operators' in version `bold'
(Font)                  OT1/cmr/bx/n --> TU/lmr/m/n on input line 16.
LaTeX Font Info:    Overwriting symbol font `operators' in version `normal'
(Font)                  TU/lmr/m/n --> TU/lmr/m/n on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathit' in version `normal'
(Font)                  OT1/cmr/m/it --> TU/lmr/m/it on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathbf' in version `normal'
(Font)                  OT1/cmr/bx/n --> TU/lmr/bx/n on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathsf' in version `normal'
(Font)                  OT1/cmss/m/n --> TU/lmss/m/n on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathtt' in version `normal'
(Font)                  OT1/cmtt/m/n --> TU/lmtt/m/n on input line 16.
LaTeX Font Info:    Overwriting symbol font `operators' in version `bold'
(Font)                  TU/lmr/m/n --> TU/lmr/bx/n on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathit' in version `bold'
(Font)                  OT1/cmr/bx/it --> TU/lmr/bx/it on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathsf' in version `bold'
(Font)                  OT1/cmss/bx/n --> TU/lmss/bx/n on input line 16.
LaTeX Font Info:    Overwriting math alphabet `\mathtt' in version `bold'
(Font)                  OT1/cmtt/m/n --> TU/lmtt/bx/n on input line 16.

Overfull \hbox (152.78056pt too wide) in paragraph at lines 252--19
[]\OT1/cmr/m/n/10 ~?                                                          
                                                                               
                                                                  \TU/cmr/m/n/1
0 Won?t
 []

[1

{/usr/local/texlive/2016/texmf-var/fonts/map/pdftex/updmap/pdftex.map}
Missing character: There is no ? (U+0302) in font cmr10!
]
(./silly.aux)

LaTeX Font Warning: Some font shapes were not available, defaults substituted.

)

Here is how much of LuaTeX's memory you used:
 9363 strings out of 495119
 100000,319454 words of node,token memory allocated
 396 words of node memory still in use:
   3 hlist, 1 vlist, 1 rule, 7 glue, 4 attribute, 44 glue_spec, 4 attribute_list
, 1 write nodes
   avail lists: 2:417,3:3,4:1,5:12,6:81,7:236,8:1,9:7,11:7
 12909 multiletter control sequences out of 65536+600000
 18 fonts using 990807 bytes
 35i,4n,31p,329b,300s stack positions out of 5000i,500n,10000p,200000b,100000s
</Library/Fonts/lmroman10-regular.otf></usr/local/texlive/2016/texmf-dist/fonts/
type1/public/amsfonts/cm/cmr10.pfb>
Output written on silly.pdf (1 page, 13855 bytes).

PDF statistics: 19 PDF objects out of 1000 (max. 8388607)
 11 compressed objects within 1 object stream
 0 named destinations out of 1000 (max. 131072)
 1 words of extra memory for PDF output out of 10000 (max. 10000000)

-------------- next part --------------
PWD /Users/wolpert/base/silly
INPUT /Users/wolpert/Library/texlive/2016/texmf-var/web2c/luatex/lualatex.fmt
INPUT ./silly.tex
OUTPUT silly.log
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/article.cls
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/article.cls
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/size10.clo
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/size10.clo
INPUT /usr/local/texlive/2016/texmf-dist/fonts/tfm/public/cm/cmr10.tfm
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3-code.tex
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3-code.tex
INPUT /usr/local/texlive/2016/texmf-dist/tex/generic/unicode-data/UnicodeData.txt
INPUT /usr/local/texlive/2016/texmf-dist/tex/generic/unicode-data/CaseFolding.txt
INPUT /usr/local/texlive/2016/texmf-dist/tex/generic/unicode-data/SpecialCasing.txt
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/l3pdfmode.def
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/l3pdfmode.def
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3packages/xparse/xparse.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/l3packages/xparse/xparse.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/luaotfload/luaotfload.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/luaotfload/luaotfload.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-basic.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-lua.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-package.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-lpeg.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-function.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-string.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-table.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-boolean.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-number.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-math.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-io.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-os.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-file.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-gzip.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-md5.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-dir.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-unicode.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-url.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-set.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-compat.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-extended.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-str.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-fil.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-tab.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-sto.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-prs.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-dim.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-jsn.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-trac-inf.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-lua.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-deb.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-tpl.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/lualibs/lualibs-util-sta.lua
OUTPUT /Users/wolpert/Library/texlive/2016/texmf-var/m_t_x_t_e_s_t.tmp
INPUT /usr/local/texlive/2016/texmf-dist/tex/luatex/luaotfload/luaotfload-characters.lua
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/tulmr.fd
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/base/tulmr.fd
INPUT /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/names/luaotfload-names.luc
INPUT /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10-regular.luc
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg
INPUT /usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg
INPUT /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10-bold.luc
INPUT /Users/wolpert/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10-italic.luc
OUTPUT silly.aux
OUTPUT silly.pdf
INPUT ./silly.aux
INPUT /usr/local/texlive/2016/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20170304/09595918/attachment-0001.sig>

From preining at logic.at  Sun Mar  5 06:03:00 2017
From: preining at logic.at (Norbert Preining)
Date: Sun, 5 Mar 2017 14:03:00 +0900
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
Message-ID: <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>

> LaTeX2e <2016/03/31>

Not good, should be
	LaTeX2e <2017/01/01> patch level 3

> INPUT /Users/wolpert/Library/texlive/2016/texmf-var/web2c/luatex/lualatex.fmt

This does not seem to be correct. The updated formats would be in
	/usr/local/texlive/2016/texmf-var/web2c/...
You have a personal copy of lualatex.fmt, I guess you have called
	fmtutil
(without the -sys) at some point.

Please backup and remove all files in 
	/Users/wolpert/Library/texlive/2016/texmf-var/web2c/
(especially the format files) and retry.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From frank.mittelbach at latex-project.org  Sun Mar  5 09:03:23 2017
From: frank.mittelbach at latex-project.org (Frank Mittelbach)
Date: Sun, 5 Mar 2017 09:03:23 +0100
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
Message-ID: <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>

Am 05.03.2017 um 06:03 schrieb Norbert Preining:
> This does not seem to be correct. The updated formats would be in
> 	/usr/local/texlive/2016/texmf-var/web2c/...
> You have a personal copy of lualatex.fmt, I guess you have called
> 	fmtutil
> (without the -sys) at some point.

that seems to happen quite often these days (perhaps because in the past 
people made their private formats for luatex when it wasn't set up?)

I wonder if the fmtutil-sys could at least detect and warn if there are 
private formats for the user running it as part of an update?

frank

From preining at logic.at  Sun Mar  5 10:57:24 2017
From: preining at logic.at (Norbert Preining)
Date: Sun, 05 Mar 2017 18:57:24 +0900
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
Message-ID: <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>

Hi Frank

That is unfortunately quite difficult. On a single user system it is surely doable, but when TL is installed globally fmtutil would need to check all home directories.

We are planning to prohibit calls to fmtutil and updmap without mode specification (user or sys), so that users get a string warning what might^Wwill happen.

See my email a few days ago on the TL list.

Norbert
--
PREINING Norbert + TeX Live & Debian Developer + http://www.preining.info
GPG: 0x860CDC13 fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13


From isaac at isb1009.es  Sun Mar  5 13:32:01 2017
From: isaac at isb1009.es (=?UTF-8?Q?Isaac_S=c3=a1nchez_Barrera?=)
Date: Sun, 5 Mar 2017 13:32:01 +0100
Subject: [luatex] Hyphenation of \verb in LuaLaTeX 1.0.x
In-Reply-To: <CAEW6iOgmougN9kfqt21FkQ=w5NvE-2ecoRgLOufER9QTs5=yzA@mail.gmail.com>
References: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>
 <CAEW6iOgTDkV3zVdxf07ZiBbD+4kJY_Uc936LjcRx6rYWjMFp6g@mail.gmail.com>
 <CAEW6iOgmougN9kfqt21FkQ=w5NvE-2ecoRgLOufER9QTs5=yzA@mail.gmail.com>
Message-ID: <b0adde5a-393f-6fc0-a71b-1c08dcfd88b3@isb1009.es>

Interesting... For some reason, I thought \ttfamily was also hyphenated 
except when in \verb. I suppose the "canonical" way in fontspec is to 
set HyphenChar to None. But I think I'd like \ttfamily to be hyphenated, 
so maybe setting \verbatim at font following your answer in 
<http://tex.stackexchange.com/a/91308/117845> is what would work best 
for me:

\makeatletter
\newlanguage\no at hy
\renewcommand*\verbatim at font{\ttfamily\language=\no at hy}
\makeatother

Should we file a bug in fontspec so that HyphenChar=None is the default 
setting in \setmonofont?

Isaac

From d.p.carlisle at gmail.com  Sun Mar  5 13:39:45 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sun, 5 Mar 2017 12:39:45 +0000
Subject: [luatex] Hyphenation of \verb in LuaLaTeX 1.0.x
In-Reply-To: <b0adde5a-393f-6fc0-a71b-1c08dcfd88b3@isb1009.es>
References: <707c45ac-2a12-f048-270b-ea1c57089bf6@isb1009.es>
 <CAEW6iOgTDkV3zVdxf07ZiBbD+4kJY_Uc936LjcRx6rYWjMFp6g@mail.gmail.com>
 <CAEW6iOgmougN9kfqt21FkQ=w5NvE-2ecoRgLOufER9QTs5=yzA@mail.gmail.com>
 <b0adde5a-393f-6fc0-a71b-1c08dcfd88b3@isb1009.es>
Message-ID: <CAEW6iOgS4t+cOfgu4NGtj5NbzfTZ-tKaP6Jy4Cju8buo013vjA@mail.gmail.com>

On 5 March 2017 at 12:32, Isaac S?nchez Barrera <isaac at isb1009.es> wrote:
> Interesting... For some reason, I thought \ttfamily was also hyphenated
> except when in \verb. I suppose the "canonical" way in fontspec is to set
> HyphenChar to None. But I think I'd like \ttfamily to be hyphenated, so

the usual default so far in latex is that monospace fonts have
hyohenation disabled, although that
isn't always what is wanted, certainly.

> maybe setting \verbatim at font following your answer in
> <http://tex.stackexchange.com/a/91308/117845> is what would work best for
> me:
>
> \makeatletter
> \newlanguage\no at hy
> \renewcommand*\verbatim at font{\ttfamily\language=\no at hy}
> \makeatother

yes we were discussing in chat whether verb should do that. babel has
a `none` language already set up for that
but the format doesn't normally assume babel. It would be possible to
use an unallocated language slot actually
in internal code (\count19+1 is the next language that would be
allocated) or we could allocate as you suggest.

>
> Should we file a bug in fontspec so that HyphenChar=None is the default
> setting in \setmonofont?

You could, at least to give a URL to reference in any change, although
Will is on this list so has seen this already:-)


>
> Isaac


From r.f.wolpert at gmail.com  Sun Mar  5 14:42:24 2017
From: r.f.wolpert at gmail.com (Rembrandt Wolpert)
Date: Sun, 5 Mar 2017 07:42:24 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
Message-ID: <75a7da4c-860a-1aaa-47be-a5a08a62c3f5@gmail.com>

On 3/4/17 11:03 PM, Norbert Preining wrote:
>> LaTeX2e <2016/03/31>
> 
> Not good, should be
> 	LaTeX2e <2017/01/01> patch level 3
> 
>> INPUT /Users/wolpert/Library/texlive/2016/texmf-var/web2c/luatex/lualatex.fmt
> 
> This does not seem to be correct. The updated formats would be in
> 	/usr/local/texlive/2016/texmf-var/web2c/...
> You have a personal copy of lualatex.fmt, I guess you have called
> 	fmtutil
> (without the -sys) at some point.
> 
> Please backup and remove all files in 
> 	/Users/wolpert/Library/texlive/2016/texmf-var/web2c/
> (especially the format files) and retry.
> 
> Norbert
> 
> --
> PREINING Norbert                               http://www.preining.info
> Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
> GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
> 

Thank you, that did it: there were files dated 14 May 2016. No idea why
I did this, but with your help, it's sorted out, and I'll always keep an
eye on that place!

as ever,
Rembrandt

-- 
??????????
                          - ??

From frank.mittelbach at latex-project.org  Sun Mar  5 18:41:16 2017
From: frank.mittelbach at latex-project.org (Frank Mittelbach)
Date: Sun, 5 Mar 2017 18:41:16 +0100
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
Message-ID: <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>

Am 05.03.2017 um 10:57 schrieb Norbert Preining:
> That is unfortunately quite difficult. On a single user system it is
> surely doable, but when TL is installed globally fmtutil would need
> to check all home directories.

understood, but I thought that these days the majority of installations 
are in fact single user machine installations where the "sys" part 
really serves typically a single user.

So my thought was that you get already a huge improvement if a "sys" 
update is checking if the current user also has local formats and if so 
warns about that and/or offers to update those as well


> We are planning to prohibit calls to fmtutil and updmap without mode
> specification (user or sys), so that users get a string warning what
> might^Wwill happen.

but isn't it the case that if I install TL on my laptop (for all users, 
even though I'm the only real one) that then all future updates will 
just update the formats in the sys tree which is precisely the problem 
we see?

and honestly the fact that way back I was warned that I do a local 
install may not be something I remember by then (like the user in this 
thread who didn't remember having produced the local format)

frank


From preining at logic.at  Mon Mar  6 01:00:14 2017
From: preining at logic.at (Norbert Preining)
Date: Mon, 6 Mar 2017 09:00:14 +0900
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
Message-ID: <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>

Hi Frank,

> understood, but I thought that these days the majority of installations are
> in fact single user machine installations where the "sys" part really serves
> typically a single user.

Agreed.

> So my thought was that you get already a huge improvement if a "sys" update
> is checking if the current user also has local formats and if so warns about
> that and/or offers to update those as well

How would that work if the -sys part is run as root? Should we query
systemd/logind who is logged in? Of course, we could parse /etc/passwd
and search for users, and if there is say less than 5 non-privileged
users, we search in their home directories. But all this is shaky,
prone to errors.

What we already do is *if* the user running updmap-sys has files in TEXMFVAR,
then he will get a warning:
	The following files have been generated as listed above,
	but will not be found because overriding files exist, listed below.
		....
	Perhaps you have run updmap in the past, but are running updmap-sys
	now.  Once you run updmap the first time, you have to keep using it,
	or else remove the personal configuration files it creates (the ones
	listed below).
This check hasn't been carried over to fmtutil by now, but I can look into
this.

But this only helps if the user owning the TL installation is also the
actual user, but we often have root owning the installation.

> but isn't it the case that if I install TL on my laptop (for all users, even
> though I'm the only real one) that then all future updates will just update
> the formats in the sys tree which is precisely the problem we see?

Yes, updates via tlmgr will call the -sys variants, so generated files
go into TEXMFSYSVAR.

> and honestly the fact that way back I was warned that I do a local install
> may not be something I remember by then (like the user in this thread who
> didn't remember having produced the local format)

I know I know. But most of these errors come from documentation specifying
that
	you should run updmap/fmtutil
which in fact was true long time ago, but isn't any more, also since long.
OTOH, people reading the outdated docs will get a warning and at least
they have to think once ...

All the best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From herbs at wideopenwest.com  Mon Mar  6 02:13:49 2017
From: herbs at wideopenwest.com (Herbert Schulz)
Date: Sun, 5 Mar 2017 19:13:49 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
Message-ID: <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>


> On Mar 5, 2017, at 6:00 PM, Norbert Preining <preining at logic.at> wrote:
> 
> Hi Frank,
> 
>> understood, but I thought that these days the majority of installations are
>> in fact single user machine installations where the "sys" part really serves
>> typically a single user.
> 
> Agreed.
> 
>> So my thought was that you get already a huge improvement if a "sys" update
>> is checking if the current user also has local formats and if so warns about
>> that and/or offers to update those as well
> 
> How would that work if the -sys part is run as root? Should we query
> systemd/logind who is logged in? Of course, we could parse /etc/passwd
> and search for users, and if there is say less than 5 non-privileged
> users, we search in their home directories. But all this is shaky,
> prone to errors.
> 
> What we already do is *if* the user running updmap-sys has files in TEXMFVAR,
> then he will get a warning:
> 	The following files have been generated as listed above,
> 	but will not be found because overriding files exist, listed below.
> 		....
> 	Perhaps you have run updmap in the past, but are running updmap-sys
> 	now.  Once you run updmap the first time, you have to keep using it,
> 	or else remove the personal configuration files it creates (the ones
> 	listed below).
> This check hasn't been carried over to fmtutil by now, but I can look into
> this.
> 
> But this only helps if the user owning the TL installation is also the
> actual user, but we often have root owning the installation.
> 
>> but isn't it the case that if I install TL on my laptop (for all users, even
>> though I'm the only real one) that then all future updates will just update
>> the formats in the sys tree which is precisely the problem we see?
> 
> Yes, updates via tlmgr will call the -sys variants, so generated files
> go into TEXMFSYSVAR.
> 
>> and honestly the fact that way back I was warned that I do a local install
>> may not be something I remember by then (like the user in this thread who
>> didn't remember having produced the local format)
> 
> I know I know. But most of these errors come from documentation specifying
> that
> 	you should run updmap/fmtutil
> which in fact was true long time ago, but isn't any more, also since long.
> OTOH, people reading the outdated docs will get a warning and at least
> they have to think once ...
> 
> All the best
> 
> Norbert
> 
> --
> PREINING Norbert                               http://www.preining.info
> Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
> GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

Howdy,

In 2012 I wrote a document, for Mac users, that noted that changes in Shell Escape (not relevant here) and also in installing fonts that noted the difference between installing in TEXMFLOCAL and TEXMFHOME and updmap-sys and updmap. It is something that has come up too regularly in the Mac community. And here we are in 2017 still living with the same, difficult to anallise, problems
Good Luck,

Herb Schulz
(herbs at wideopenwest dot com)



From herbs at wideopenwest.com  Mon Mar  6 02:18:55 2017
From: herbs at wideopenwest.com (Herbert Schulz)
Date: Sun, 5 Mar 2017 19:18:55 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
Message-ID: <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>


> On Mar 5, 2017, at 7:13 PM, Herbert Schulz <herbs at wideopenwest.com> wrote:
> 
> 
>> On Mar 5, 2017, at 6:00 PM, Norbert Preining <preining at logic.at> wrote:
>> 
>> Hi Frank,
>> 
>>> understood, but I thought that these days the majority of installations are
>>> in fact single user machine installations where the "sys" part really serves
>>> typically a single user.
>> 
>> Agreed.
>> 
>>> So my thought was that you get already a huge improvement if a "sys" update
>>> is checking if the current user also has local formats and if so warns about
>>> that and/or offers to update those as well
>> 
>> How would that work if the -sys part is run as root? Should we query
>> systemd/logind who is logged in? Of course, we could parse /etc/passwd
>> and search for users, and if there is say less than 5 non-privileged
>> users, we search in their home directories. But all this is shaky,
>> prone to errors.
>> 
>> What we already do is *if* the user running updmap-sys has files in TEXMFVAR,
>> then he will get a warning:
>> 	The following files have been generated as listed above,
>> 	but will not be found because overriding files exist, listed below.
>> 		....
>> 	Perhaps you have run updmap in the past, but are running updmap-sys
>> 	now.  Once you run updmap the first time, you have to keep using it,
>> 	or else remove the personal configuration files it creates (the ones
>> 	listed below).
>> This check hasn't been carried over to fmtutil by now, but I can look into
>> this.
>> 
>> But this only helps if the user owning the TL installation is also the
>> actual user, but we often have root owning the installation.
>> 
>>> but isn't it the case that if I install TL on my laptop (for all users, even
>>> though I'm the only real one) that then all future updates will just update
>>> the formats in the sys tree which is precisely the problem we see?
>> 
>> Yes, updates via tlmgr will call the -sys variants, so generated files
>> go into TEXMFSYSVAR.
>> 
>>> and honestly the fact that way back I was warned that I do a local install
>>> may not be something I remember by then (like the user in this thread who
>>> didn't remember having produced the local format)
>> 
>> I know I know. But most of these errors come from documentation specifying
>> that
>> 	you should run updmap/fmtutil
>> which in fact was true long time ago, but isn't any more, also since long.
>> OTOH, people reading the outdated docs will get a warning and at least
>> they have to think once ...
>> 
>> All the best
>> 
>> Norbert
>> 
>> --
>> PREINING Norbert                               http://www.preining.info
>> Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
>> GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
> 
> Howdy,
> 
> In 2012 I wrote a document, for Mac users, that noted that changes in Shell Escape (not relevant here) and also in installing fonts that noted the difference between installing in TEXMFLOCAL and TEXMFHOME and updmap-sys and updmap. It is something that has come up too regularly in the Mac community. And here we are in 2017 still living with the same, difficult to anallise, problems
> Good Luck,
> 
> Herb Schulz
> (herbs at wideopenwest dot com)
> 

Howdy,

Of course that should be `analyse', not anallise. Pressed Send before I was ready.

I enclose the latest version of that doucment (for TL2014 and later):

-------------- next part --------------
A non-text attachment was scrubbed...
Name: TeXLive2014+Changes.pdf.zip
Type: application/zip
Size: 86208 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170305/32ceca8c/attachment-0001.zip>
-------------- next part --------------


Good Luck,

Herb Schulz
(herbs at wideopenwest dot com)


From reinhard.kotucha at web.de  Mon Mar  6 03:48:12 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 6 Mar 2017 03:48:12 +0100
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
 <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>
Message-ID: <22716.52716.884365.111952@zaphod.ms25.net>

On 2017-03-05 at 19:18:55 -0600, Herbert Schulz wrote:

 > I enclose the latest version of that doucment (for TL2014 and later):

Dear Herbert,
I'm sure that this document is very helpful, especially the paragraph
beginning with

  "So, why not just use ?updmap? rather than ?updmap-sys??"

But even if people are aware of the problem they often run ?updmap?
accidentally and don't remember later.

I assume that most people who encountered this problem ran ?updmap?
accidentally.  How can they be aware of ?updmap? at all if they didn't
read the documentation?

BTW, regarding map files you wrote

  "Note: make sure to end the file with at least one blank line."

Though this is usually a good idea, I think that it's worth to check
whether updmap can be made more robust in this regard. 

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------


From norbert at preining.info  Mon Mar  6 02:33:50 2017
From: norbert at preining.info (Norbert Preining)
Date: Mon, 6 Mar 2017 10:33:50 +0900
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
Message-ID: <20170306013350.khtqelyfbmbmkmce@burischnitzel.preining.info>

Hi Herb,

> And here we are in 2017 still living with the same

Unfortunately, yes!

Thanks for the document. If it is ok with you I will probably incorporate
parts of it into a web page we will provide with use cases and best
practices.

Thanks

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From herbs at wideopenwest.com  Mon Mar  6 13:57:07 2017
From: herbs at wideopenwest.com (Herbert Schulz)
Date: Mon, 6 Mar 2017 06:57:07 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <22716.52716.884365.111952@zaphod.ms25.net>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
 <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>
 <22716.52716.884365.111952@zaphod.ms25.net>
Message-ID: <71130DCD-4CD2-46C3-AD9F-A00605E5C886@wideopenwest.com>


> On Mar 5, 2017, at 8:48 PM, Reinhard Kotucha <reinhard.kotucha at web.de> wrote:
> 
> On 2017-03-05 at 19:18:55 -0600, Herbert Schulz wrote:
> 
>> I enclose the latest version of that doucment (for TL2014 and later):
> 
> Dear Herbert,
> I'm sure that this document is very helpful, especially the paragraph
> beginning with
> 
>  "So, why not just use ?updmap? rather than ?updmap-sys??"
> 
> But even if people are aware of the problem they often run ?updmap?
> accidentally and don't remember later.
> 
> I assume that most people who encountered this problem ran ?updmap?
> accidentally.  How can they be aware of ?updmap? at all if they didn't
> read the documentation?
> 
> BTW, regarding map files you wrote
> 
>  "Note: make sure to end the file with at least one blank line."
> 
> Though this is usually a good idea, I think that it's worth to check
> whether updmap can be made more robust in this regard. 
> 
> Regards,
>  Reinhard
> 
> -- 
> ------------------------------------------------------------------
> Reinhard Kotucha                            Phone: +49-511-3373112
> Marschnerstr. 25
> D-30167 Hannover                    mailto:reinhard.kotucha at web.de
> ------------------------------------------------------------------
> 

Howdy,

The blank line suggestion only comes from my ancient experience under UNIX and certainly doesn't hurt.

There are several reasons the problem persists. Experienced maintainers learned how to do updates quite a while ago but haven't kept up with changes (which may be subtle). Web pages live virtually forever without being updated with new information and quite a few of them just have old information.

The think the best way to overcome this problem is to completely separate USER space from SYS space (which includes TEXMFLOCAL). I think this could work pretty easily with fmtutil* but not updmap* which would require quite a bit of work.

Imagine fmtutil-sys works only in SYS space and creates formats in TEXMFSYSVAR. Then fmtutil-user ONLY works in USER space getting information ONLY from TEXMFHOME /web2c/fmtutil.cnf creating those formats in TEXMFVAR. Finally, fmtutil runs both fmtutil-sys (with the possible need for root ownership) to create the SYS formats and then fmtutil-user to create the USR defined formats. Then kpsewhich will still work the same way and will still find the format files.

It wold be nice if the same separation could be used by updmap(-sys/-usr). Unfortunately, this won't work in that case since not all binaries (e.g., dvips) can read more than one map file. (Karl pointed this out to me quite a while ago.)

Good Luck,

Herb Schulz
(herbs at wideopenwest dot com)



From herbs at wideopenwest.com  Mon Mar  6 14:06:40 2017
From: herbs at wideopenwest.com (Herbert Schulz)
Date: Mon, 6 Mar 2017 07:06:40 -0600
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <20170306013350.khtqelyfbmbmkmce@burischnitzel.preining.info>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
 <20170306013350.khtqelyfbmbmkmce@burischnitzel.preining.info>
Message-ID: <7EE77772-90E5-49E8-BCE0-1DC0E22AD1D4@wideopenwest.com>


> On Mar 5, 2017, at 7:33 PM, Norbert Preining <norbert at preining.info> wrote:
> 
> 

Howdy,

No problem with using the information at this end. It's still too technical but I've had multiple folks use it more or less successfully.

By the way, I believe TeX Live Utility, the GUI tlmgr front end (and more) for Mac, has a Preference check box that will have it run updmap if the tlmgr log shows a run of updmap-sys. I haven't used that option so I may be wrong about how it works.

Good Luck,

Herb Schulz
(herbs at wideopenwest dot com)



From martin at oneiros.de  Mon Mar  6 14:56:42 2017
From: martin at oneiros.de (=?UTF-8?Q?Martin_Schr=C3=B6der?=)
Date: Mon, 6 Mar 2017 14:56:42 +0100
Subject: [luatex] recent tunenc.def fails with lualatex
In-Reply-To: <22716.52716.884365.111952@zaphod.ms25.net>
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
 <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>
 <22716.52716.884365.111952@zaphod.ms25.net>
Message-ID: <CAP7DCDecnTLN8K1CjZwBZpWAKTGxxqM_j_A2-6_9yOya-R_35A@mail.gmail.com>

2017-03-06 3:48 GMT+01:00 Reinhard Kotucha <reinhard.kotucha at web.de>:
> BTW, regarding map files you wrote
>
>   "Note: make sure to end the file with at least one blank line."
>
> Though this is usually a good idea, I think that it's worth to check
> whether updmap can be made more robust in this regard.

Actually POSIX requires that text files end with an EOL.
http://stackoverflow.com/a/729795/821436

Best
   Martin

From luatex at nililand.de  Mon Mar  6 15:00:39 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 6 Mar 2017 15:00:39 +0100
Subject: [luatex] recent tunenc.def fails with lualatex
References: <722c28f5-4fa2-3fd9-ae9e-524c5dfe0f3e@gmail.com>
 <8FB228BC-C8DA-4D4E-9874-4F5D88DCC2C3@logic.at>
 <d43b5757-3639-44e4-8bcc-0a7bb29ec280@gmail.com>
 <20170305050300.3kqvrfrjygdfep25@burischnitzel.preining.info>
 <072cc891-3648-ae28-6d09-6a9a239fbb0b@latex-project.org>
 <767019C0-CE3F-4865-806E-570812B3DC01@logic.at>
 <d4c9e8b6-ae73-2c48-433c-1d794f66c542@latex-project.org>
 <20170306000014.73trzbc7oylsfdvd@burischnitzel.preining.info>
 <BD1CFF7A-B6FD-494E-A30E-DE5842066BBD@wideopenwest.com>
 <0EC12DD3-9C42-4117-A84C-435902414B05@wideopenwest.com>
 <22716.52716.884365.111952@zaphod.ms25.net>
Message-ID: <16v6h393yfk4z.dlg@nililand.de>

Am Mon, 6 Mar 2017 03:48:12 +0100 schrieb Reinhard Kotucha:

> But even if people are aware of the problem they often run updmap
> accidentally and don't remember later.

They even don't need to do anything to run into such a problem. 

E.g. on miktex packages are quite often installed on-the-fly "in
user mode" and if they contain fonts will call updmap which leads to
user maps. If such users later update package with the admin-manager
"updmap --admin" will not update the correct maps.

And in texlive I just had a similar problem: I wanted to try out
something with luajitlatex and enabled the format (in a local
fmtutil.cnf). But I forgot to call fmtutil-sys and directly started
a luajitlatex compilation and this triggered the format generation
in texmfhome. 

I don't think that such problems can be avoided completly, they are
consequences of the freedom for the user to create their own formats
and map-files and to update/install packages. 


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From norbert at preining.info  Tue Mar  7 16:19:09 2017
From: norbert at preining.info (Norbert Preining)
Date: Wed, 8 Mar 2017 00:19:09 +0900
Subject: [luatex] luatex hangs on lucida OT test file
Message-ID: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>

Hi all,

with current TL uptodate I get a hang when compiling the attached
LucidaMathOTProperties.tex

lua(la)tex consumes 100% CPU times and never finishes. It is not
about font setup or fc-cache, as other documents work without
any problem.

Even Ctrl-C does not interrupt luatex. I need to Ctrl-Z and then
kill -9.

Before running lualatex I did run luaotfload-tool -u, which didn't
have any problems.

Is this a known issue, and is there a decent work-around?

Here is the log until the hang:
$ lualatex LucidaMathOTProperties.tex 
This is LuaTeX, Version 0.95.0 (TeX Live 2016) 
 restricted system commands enabled.
(./LucidaMathOTProperties.tex
LaTeX2e <2017/01/01> patch level 3
(using write cache: /home/norbert/tl/2016/texmf-var/luatex-cache/generic)(using
 read cache: /home/norbert/tl/2016/texmf-var/luatex-cache/generic /home/norbert
/.texlive2016/texmf-var/luatex-cache/generic)
luaotfload | main : initialization completed in 0.703 seconds
Babel <3.9r> and hyphenation patterns for 1 language(s) loaded.
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/article.cls
Document Class: article 2014/09/29 v1.4h Standard LaTeX document class
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/size10.clo(load luc: /home/nor
bert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10-regular.luc)))
(/home/norbert/tl/2016/texmf-dist/tex/latex/fontspec/fontspec.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/l3kernel/expl3.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/l3kernel/expl3-code.tex)
(/home/norbert/tl/2016/texmf-dist/tex/latex/l3kernel/l3pdfmode.def))
(/home/norbert/tl/2016/texmf-dist/tex/latex/l3packages/xparse/xparse.sty)
(/home/norbert/tl/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/fontenc.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/tuenc.def))
(/home/norbert/tl/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg)(load luc: /h
ome/norbert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lmroman10-bold.luc
)(load luc: /home/norbert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lmro
man10-italic.luc)))
(/home/norbert/tl/2016/texmf-dist/tex/latex/unicode-math/unicode-math.sty
(/home/norbert/tl/2016/texmf-dist/tex/generic/ifxetex/ifxetex.sty)
(/home/norbert/tl/2016/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
(/home/norbert/tl/2016/texmf-dist/tex/latex/ucharcat/ucharcat.sty)
(/home/norbert/tl/2016/texmf-dist/tex/latex/l3packages/l3keys2e/l3keys2e.sty)
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/fix-cm.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/base/ts1enc.def))
(/home/norbert/tl/2016/texmf-dist/tex/latex/filehook/filehook.sty)
(/home/norbert/tl/2016/texmf-dist/tex/latex/unicode-math/unicode-math-luatex.st
y
(/home/norbert/tl/2016/texmf-dist/tex/lualatex/lualatex-math/lualatex-math.sty
(/home/norbert/tl/2016/texmf-dist/tex/latex/etoolbox/etoolbox.sty))
(/home/norbert/tl/2016/texmf-dist/tex/latex/unicode-math/unicode-math-table.tex
)))(load luc: /home/norbert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lu
cidabrightot.luc)(load luc: /home/norbert/tl/2016/texmf-var/luatex-cache/generi
c/fonts/otl/lucidabrightot-italic.luc)(load luc: /home/norbert/tl/2016/texmf-va
r/luatex-cache/generic/fonts/otl/lucidasansot.luc)(load luc: /home/norbert/tl/2
016/texmf-var/luatex-cache/generic/fonts/otl/lucidasansot-italic.luc)(load luc:
 /home/norbert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lucidasanstypew
riterot.luc)(load luc: /home/norbert/tl/2016/texmf-var/luatex-cache/generic/fon
ts/otl/lucidasanstypewriterot-boldoblique.luc)(load luc: /home/norbert/tl/2016/
texmf-var/luatex-cache/generic/fonts/otl/lucidasanstypewriterot-bold.luc)(load 
luc: /home/norbert/tl/2016/texmf-var/luatex-cache/generic/fonts/otl/lucidasanst
ypewriterot-oblique.luc)(load luc: /home/norbert/tl/2016/texmf-var/luatex-cache
/generic/fonts/otl/lucidabrightmathot.luc) (./LucidaMathOTProperties.aux)^C^C^Z
[1]+  Stopped                 lualatex LucidaMathOTProperties.tex
$

Thanks

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LucidaMathOTProperties.tex
Type: text/x-tex
Size: 2001 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170308/797314b4/attachment.bin>

From Herbert.Voss at FU-Berlin.DE  Tue Mar  7 16:48:24 2017
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Tue, 7 Mar 2017 16:48:24 +0100
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
Message-ID: <93c36a9d-b322-a90f-1e31-09ff1ac74347@FU-Berlin.DE>

Am 07.03.2017 um 16:19 schrieb Norbert Preining:

> with current TL uptodate I get a hang when compiling the attached
> LucidaMathOTProperties.tex
>
> lua(la)tex consumes 100% CPU times and never finishes. It is not
> about font setup or fc-cache, as other documents work without
> any problem.
>
> Even Ctrl-C does not interrupt luatex. I need to Ctrl-Z and then
> kill -9.
>
> Before running lualatex I did run luaotfload-tool -u, which didn't
> have any problems.
>
> Is this a known issue, and is there a decent work-around?
>
> Here is the log until the hang:
> $ lualatex LucidaMathOTProperties.tex
> This is LuaTeX, Version 0.95.0 (TeX Live 2016)

no problem here with

This is LuaTeX, Version 1.0.4 (TeX Live 2017/dev)  (format=lualatex 
2017.2.27)  7 MAR 2017 16:44



  *File List*
  article.cls    2014/09/29 v1.4h Standard LaTeX document class
   size10.clo    2014/09/29 v1.4h Standard LaTeX file (size option)
fontspec.sty    2017/02/12 v2.6 Font selection for XeLaTeX and LuaLaTeX
    expl3.sty    2017/02/10 v6878 L3 programming layer (loader)
expl3-code.tex    2017/02/10 v6878 L3 programming layer
l3pdfmode.def    2016/12/28 v6805 L3 Experimental driver: PDF mode
   xparse.sty    2017/02/10 v6878 L3 Experimental document command parser
fontspec-luatex.sty    2017/02/12 v2.6 Font selection for XeLaTeX and 
LuaLaTeX
  fontenc.sty
    tuenc.def    2017/02/22 v2.0g Standard LaTeX file
fontspec.cfg
unicode-math.sty    2017/01/27 v0.8d Unicode maths in XeLaTeX and LuaLaTeX
  ifxetex.sty    2010/09/12 v0.6 Provides ifxetex conditional
ifluatex.sty    2016/05/16 v1.4 Provides the ifluatex switch (HO)
ucharcat.sty    2015/11/19 v0.03 ucharcat for luaLaTeX (DPC)
l3keys2e.sty    2017/02/10 v6878 LaTeX2e option processing using LaTeX3 keys
   fix-cm.sty    2015/01/14 v1.1t fixes to LaTeX
   ts1enc.def    2001/06/05 v3.0e (jk/car/fm) Standard LaTeX file
filehook.sty    2011/10/12 v0.5d Hooks for input files
unicode-math-luatex.sty
lualatex-math.sty    2016/04/16 v1.6 Patches for mathematics typesetting 
with Lu
aLaTeX
etoolbox.sty    2017/01/02 v2.4 e-TeX tools for LaTeX (JAW)


Herbert

From bvoisin at me.com  Tue Mar  7 18:29:44 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 07 Mar 2017 18:29:44 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
Message-ID: <03EE99E0-B8DC-41F2-B7BF-C4D917E45E86@me.com>

> Le 7 mars 2017 ? 16:19, Norbert Preining <norbert at preining.info> a ?crit :
> 
> with current TL uptodate I get a hang when compiling the attached
> LucidaMathOTProperties.tex
> 
> lua(la)tex consumes 100% CPU times and never finishes. It is not
> about font setup or fc-cache, as other documents work without
> any problem.
> 
> Even Ctrl-C does not interrupt luatex. I need to Ctrl-Z and then
> kill -9.

Same here, with MacTeX 2016 updated via TeX Live Utility -- hence TL 2016 updated via tlmgr -- and Lucida OT 1.801. For LuaTeX:

This is LuaTeX, Version 0.95.0 (TeX Live 2016) 

Had to kill LuaTeX in Activity Monitor (see attached screenshot).

Is there, by the way, a way of getting updated LuaTeX binaries in between TL releases (for the Mac in particular)? (Other than compiling locally, I don't really have the competence for that.)

Mojca wrote last year on the MacTeX list that, though sending updated binaries to the TL maintainers -- Karl -- anytime between two releases and have them posted was technically possible, that never happened in the last few years.

Bruno

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170307/d98529e3/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Capture d?e?cran 2017-03-07 a? 18.02.33.png
Type: image/png
Size: 367597 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170307/d98529e3/attachment-0001.png>

From bvoisin at me.com  Tue Mar  7 18:38:56 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 07 Mar 2017 18:38:56 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <03EE99E0-B8DC-41F2-B7BF-C4D917E45E86@me.com>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
 <03EE99E0-B8DC-41F2-B7BF-C4D917E45E86@me.com>
Message-ID: <073A1CFD-E439-4B07-97E7-6A62CC556564@me.com>

> Le 7 mars 2017 ? 18:29, Bruno Voisin <bvoisin at me.com> a ?crit :
> 
> Is there, by the way, a way of getting updated LuaTeX binaries in between TL releases (for the Mac in particular)? (Other than compiling locally, I don't really have the competence for that.)

OK, just seeing Norbert's blog entry <https://www.preining.info/blog/2017/01/debian-tex-live-january-2017/> about LuaTeX 1.0 breaking the current TeX Live packages, so that's probably not a good idea anyway.

Bruno



From bvoisin at me.com  Tue Mar  7 19:05:59 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 07 Mar 2017 19:05:59 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
Message-ID: <4097022E-B9CA-4F5E-A1D3-3484CF68D8BB@me.com>

> Le 7 mars 2017 ? 16:19, Norbert Preining <norbert at preining.info> a ?crit :
> 
> with current TL uptodate I get a hang when compiling the attached
> LucidaMathOTProperties.tex

Looking more closely, your code is essentially an extract from lucidaot.tex, the doc and test file in TUG's LucidaOT distribution.

At TUG's svn repo, svn://tug.org/lucida, lucidaot.tex lives in trunk/tests/dist with a GNUmakefile that tests it with both XeTeX and LuaTeX:

- The XeTeX output lucidaot-xe.pdf is from January 13, 2017.

- The LuaTeX output lucidaot-lua.pdf is from May 19, 2016 and was created with LuaTeX 0.80.0.

So I assume that's a known problem (at least by Karl).

Just to be sure, I replaced your font name calls by file name calls as in lucidaot.tex: that doesn't change a thing.

Bruno

From bvoisin at me.com  Tue Mar  7 20:49:25 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 07 Mar 2017 20:49:25 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <03EE99E0-B8DC-41F2-B7BF-C4D917E45E86@me.com>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
 <03EE99E0-B8DC-41F2-B7BF-C4D917E45E86@me.com>
Message-ID: <0042AA96-CE70-4FB7-96D8-E7907AB682EF@me.com>

> Le 7 mars 2017 ? 18:29, Bruno Voisin <bvoisin at me.com> a ?crit :
> 
>> Le 7 mars 2017 ? 16:19, Norbert Preining <norbert at preining.info> a ?crit :
>> 
>> with current TL uptodate I get a hang when compiling the attached
>> LucidaMathOTProperties.tex
> 
> Same here, with MacTeX 2016 updated via TeX Live Utility -- hence TL 2016 updated via tlmgr -- and Lucida OT 1.801. For LuaTeX:
> 
> This is LuaTeX, Version 0.95.0 (TeX Live 2016) 
> 
> [...]
> 
> Is there, by the way, a way of getting updated LuaTeX binaries in between TL releases (for the Mac in particular)? (Other than compiling locally, I don't really have the competence for that.)

First, there are current Mac binaries available (and for other platforms as well), I should just have looked:

http://www.luatex.org/download.html

Installing the Mac one turned out more complicated than I expected (rename the luatex in /usr/local/texlive/2016/bin/x86_64-darwin/ to luatex-2016, put the current luatex there, run "sudo fmtutil-sys --byfmt lualatex").

But then, everything works well, so this is really an issue with LuaTeX 0.9*, apparently.

Bruno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: LucidaMathOTProperties.pdf
Type: application/pdf
Size: 17619 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170307/a6057b95/attachment-0001.pdf>
-------------- next part --------------


This is LuaTeX, Version 1.0.3 (TeX Live 2017/dev) 
 restricted system commands enabled.
(./LucidaMathOTProperties.tex
LaTeX2e <2017/01/01> patch level 3
(using write cache: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-ca
che/generic)(using read cache: /usr/local/texlive/2016/texmf-var/luatex-cache/g
eneric /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic)
luaotfload | main : initialization completed in 0.318 seconds
Babel <3.9r> and hyphenation patterns for 1 language(s) loaded.
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/article.cls
Document Class: article 2014/09/29 v1.4h Standard LaTeX document class
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/size10.clo(load luc: /Users/
brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lmrom
an10-regular.luc)))
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/expl3-code.tex)
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3kernel/l3pdfmode.def))
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3packages/xparse/xparse.sty)
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def))
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg)(load luc: 
/Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/ot
l/lmroman10-bold.luc)(load luc: /Users/brunovoisin/Library/texlive/2016/texmf-v
ar/luatex-cache/generic/fonts/otl/lmroman10-italic.luc)))
(/usr/local/texlive/2016/texmf-dist/tex/latex/unicode-math/unicode-math.sty
(/usr/local/texlive/2016/texmf-dist/tex/generic/ifxetex/ifxetex.sty)
(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
(/usr/local/texlive/2016/texmf-dist/tex/latex/ucharcat/ucharcat.sty)
(/usr/local/texlive/2016/texmf-dist/tex/latex/l3packages/l3keys2e/l3keys2e.sty)
 (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fix-cm.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/ts1enc.def))
(/usr/local/texlive/2016/texmf-dist/tex/latex/filehook/filehook.sty)
(/usr/local/texlive/2016/texmf-dist/tex/latex/unicode-math/unicode-math-luatex.
sty
(/usr/local/texlive/2016/texmf-dist/tex/lualatex/lualatex-math/lualatex-math.st
y (/usr/local/texlive/2016/texmf-dist/tex/latex/etoolbox/etoolbox.sty))
(/usr/local/texlive/2016/texmf-dist/tex/latex/unicode-math/unicode-math-table.t
ex)))(load luc: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/
generic/fonts/otl/lucidabrightot.luc)(load luc: /Users/brunovoisin/Library/texl
ive/2016/texmf-var/luatex-cache/generic/fonts/otl/lucidabrightot-italic.luc)(lo
ad luc: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/
fonts/otl/lucidasansot.luc)(load luc: /Users/brunovoisin/Library/texlive/2016/t
exmf-var/luatex-cache/generic/fonts/otl/lucidasansot-italic.luc)(load luc: /Use
rs/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lu
cidasanstypewriterot.luc)(load luc: /Users/brunovoisin/Library/texlive/2016/tex
mf-var/luatex-cache/generic/fonts/otl/lucidasanstypewriterot-boldoblique.luc)(l
oad luc: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic
/fonts/otl/lucidasanstypewriterot-bold.luc)(load luc: /Users/brunovoisin/Librar
y/texlive/2016/texmf-var/luatex-cache/generic/fonts/otl/lucidasanstypewriterot-
oblique.luc)(load luc: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex
-cache/generic/fonts/otl/lucidabrightmathot.luc) (./LucidaMathOTProperties.aux)
[1{/Users/brunovoisin/Library/texlive/2016/texmf-var/fonts/map/pdftex/updmap/pd
ftex.map}] (./LucidaMathOTProperties.aux))
 391 words of node memory still in use:
   3 hlist, 1 vlist, 1 rule, 2 glue, 4 attribute, 50 glue_spec, 4 attribute_lis
t, 1 write nodes
   avail lists: 1:11,2:139,3:18,4:5,5:36,6:530,7:191,8:14,9:48,10:3,11:44
</usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/LucidaBrightMathOT.o
tf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/LucidaBrightMathO
T.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/LucidaBrightMa
thOT.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/LucidaBrigh
tMathOT.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/LucidaBr
ightMathOT.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/Lucid
aBrightMathOT.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/Lu
cidaBrightOT.otf></usr/local/texlive/texmf-local/fonts/opentype/bh/lucidaot/Luc
idaSansTypewriterOT.otf>
Output written on LucidaMathOTProperties.pdf (1 page, 17619 bytes).

SyncTeX written on LucidaMathOTProperties.synctex.gz.Transcript written on LucidaMathOTProperties.log.


From norbert at preining.info  Wed Mar  8 00:51:27 2017
From: norbert at preining.info (Norbert Preining)
Date: Wed, 8 Mar 2017 08:51:27 +0900
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <93c36a9d-b322-a90f-1e31-09ff1ac74347@FU-Berlin.DE>
References: <20170307151909.n3lm33jjbfqv37li@burischnitzel.preining.info>
 <93c36a9d-b322-a90f-1e31-09ff1ac74347@FU-Berlin.DE>
Message-ID: <20170307235127.cloca4hmf5prinwq@burischnitzel.preining.info>

Thanks everyone for the answers, as it was pointed out:
* TL2016 with luatex 0.95 does not work
* luatex 1.0.N works
So please wait for TL2017.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From norbert at preining.info  Wed Mar  8 00:54:01 2017
From: norbert at preining.info (Norbert Preining)
Date: Wed, 8 Mar 2017 08:54:01 +0900
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <0042AA96-CE70-4FB7-96D8-E7907AB682EF@me.com>
 <073A1CFD-E439-4B07-97E7-6A62CC556564@me.com>
Message-ID: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>

Hi Bruno,

> OK, just seeing Norbert's blog entry <https://www.preining.info/blog/2017/01/debian-tex-live-january-2017/> about LuaTeX 1.0 breaking the current TeX Live packages, so that's probably not a good idea anyway.

[...]

> But then, everything works well, so this is really an issue with LuaTeX 0.9*, apparently.

Yes, it seems that most relevant packages are already updated to work with
both luatex 0.9 and luatex 1.0. At the time I wrote that blog most weren't
updated and format building broke badly.

> Installing the Mac one turned out more complicated than I expected (rename the luatex in /usr/local/texlive/2016/bin/x86_64-darwin/ to luatex-2016, put the current luatex there, run "sudo fmtutil-sys --byfmt lualatex").

What is complicated here - these are all the natural and necessary steps I guess.

Best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From bvoisin at me.com  Wed Mar  8 06:15:38 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Wed, 08 Mar 2017 06:15:38 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
Message-ID: <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>

> Le 8 mars 2017 ? 00:54, Norbert Preining <norbert at preining.info> a ?crit :
> 
>> Installing the Mac one turned out more complicated than I expected (rename the luatex in /usr/local/texlive/2016/bin/x86_64-darwin/ to luatex-2016, put the current luatex there, run "sudo fmtutil-sys --byfmt lualatex").
> 
> What is complicated here - these are all the natural and necessary steps I guess.

Apart from the necessity to recompile lualatex.fmt, which I had forgotten, I was kind of expecting all that was needed was put the new luatex in the user area, say inside ~/Library/texlive/2016/bin (would be ~/.texlive2016/bin on Linux I guess), and it would be picked up automatically when running luatex from the command line.

In other words, I thought it was possible to install a new binary locally without touching the main TeX Live install, and the new binary would take precedence, same as .sty files say. (But then again I had forgotten the path would need to be set up accordingly.)

In any case, that didn't work, and <https://www.tug.org/texlive/custom-bin.html> showed things weren't that straightforward, so I went as described.

Bruno

From norbert at preining.info  Wed Mar  8 15:59:30 2017
From: norbert at preining.info (Norbert Preining)
Date: Wed, 8 Mar 2017 23:59:30 +0900
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
Message-ID: <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>

> Apart from the necessity to recompile lualatex.fmt, which I had forgotten, I was kind of expecting all that was needed was put the new luatex in the user area, say inside ~/Library/texlive/2016/bin (would be ~/.texlive2016/bin on Linux I guess), and it would be picked up automatically when running luatex from the command line.

No, that *cannot* work ... how should luatex find its initial texmf.cnf?
It uses a set of compiled in paths, plus those determined from the
location of the binary.

You *can* put the luatex binary *anywhere*, but need to make sure that
somewhere a texmf.cnf is findable for luatex.

Once it has its texmf.cnf, everything works with binaries far away.

You could do the following:
* copy kpsewhich alongside the new luatex binary
* add that path to the front
* call: kpsewhich -show-path .cnf

In my case I copied it to ~/bin, I got:
warning: kpathsea: configuration file texmf.cnf not found in these directories: /home/norbert/bin:/home/norbert/bin/share/texmf-local/web2c:/home/norbert/bin/share/texmf-dist/web2c:/home/norbert/bin/share/texmf/web2c:/home/norbert/bin/texmf-local/web2c:/home/norbert/bin/texmf-dist/web2c:/home/norbert/bin/texmf/web2c:/home/norbert:/home/norbert/share/texmf-local/web2c:/home/norbert/share/texmf-dist/web2c:/home/norbert/share/texmf/web2c:/home/norbert/texmf-local/web2c:/home/norbert/texmf-dist/web2c:/home/norbert/texmf/web2c://texmf-local/web2c:/home:/home/share/texmf-local/web2c:/home/share/texmf-dist/web2c:/home/share/texmf/web2c:/home/texmf-local/web2c:/home/texmf-dist/web2c:/home/texmf/web2c.

Which tells you the built-in search paths.

You could drop an adjusted texmf.cnf into the directory of the new luatex
binary, and adjust the path elements so not to use SELFAUTOPARENT etc,
to get a working system.

It is possible, but not trivial ;-)))

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From reinhard.kotucha at web.de  Thu Mar  9 02:22:55 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 9 Mar 2017 02:22:55 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
In-Reply-To: <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
Message-ID: <22720.44655.577386.957818@zaphod.ms25.net>

On 2017-03-08 at 23:59:30 +0900, Norbert Preining wrote:

 > > Apart from the necessity to recompile lualatex.fmt, which I had forgotten, I was kind of expecting all that was needed was put the new luatex in the user area, say inside ~/Library/texlive/2016/bin (would be ~/.texlive2016/bin on Linux I guess), and it would be picked up automatically when running luatex from the command line.
 > 
 > No, that *cannot* work ... how should luatex find its initial texmf.cnf?
 > It uses a set of compiled in paths, plus those determined from the
 > location of the binary.
 > 
 > You *can* put the luatex binary *anywhere*, but need to make sure that
 > somewhere a texmf.cnf is findable for luatex.
 > 
 > Once it has its texmf.cnf, everything works with binaries far away.
 > 
 > You could do the following:
 > * copy kpsewhich alongside the new luatex binary
 > * add that path to the front
 > * call: kpsewhich -show-path .cnf
 > 
 > In my case I copied it to ~/bin, I got:
 > warning: kpathsea: configuration file texmf.cnf not found in these directories: /home/norbert/bin:/home/norbert/bin/share/texmf-local/web2c:/home/norbert/bin/share/texmf-dist/web2c:/home/norbert/bin/share/texmf/web2c:/home/norbert/bin/texmf-local/web2c:/home/norbert/bin/texmf-dist/web2c:/home/norbert/bin/texmf/web2c:/home/norbert:/home/norbert/share/texmf-local/web2c:/home/norbert/share/texmf-dist/web2c:/home/norbert/share/texmf/web2c:/home/norbert/texmf-local/web2c:/home/norbert/texmf-dist/web2c:/home/norbert/texmf/web2c://texmf-local/web2c:/home:/home/share/texmf-local/web2c:/home/share/texmf-dist/web2c:/home/share/texmf/web2c:/home/texmf-local/web2c:/home/texmf-dist/web2c:/home/texmf/web2c.
 > 
 > Which tells you the built-in search paths.
 > 
 > You could drop an adjusted texmf.cnf into the directory of the new luatex
 > binary, and adjust the path elements so not to use SELFAUTOPARENT etc,
 > to get a working system.
 > 
 > It is possible, but not trivial ;-)))

It should be sufficient to put a texmf.cnf file into ~/.texlive2016/bin
which only contains one line:

  TEXMROOT = /usr/local/texlive/2016

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From norbert at preining.info  Thu Mar  9 02:28:28 2017
From: norbert at preining.info (Norbert Preining)
Date: Thu, 9 Mar 2017 10:28:28 +0900
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
In-Reply-To: <22720.44655.577386.957818@zaphod.ms25.net>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
Message-ID: <20170309012828.bbgeiuriiregs6jr@bulldog.preining.info>

>   TEXMROOT = /usr/local/texlive/2016

Indeed, that should work ... nice idea.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From bvoisin at me.com  Thu Mar  9 08:02:41 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Thu, 09 Mar 2017 08:02:41 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
In-Reply-To: <22720.44655.577386.957818@zaphod.ms25.net>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
Message-ID: <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>

> Le 9 mars 2017 ? 02:22, Reinhard Kotucha <reinhard.kotucha at web.de> a ?crit :
> 
> It should be sufficient to put a texmf.cnf file into ~/.texlive2016/bin
> which only contains one line:
> 
>  TEXMROOT = /usr/local/texlive/2016

Thanks, that is brilliant! Will make testing much easier.

Would something also need to be done for texmf-local, like

TEXMFLOCAL = /usr/local/texlive/texmf-local

(to replace $SELFAUTOGRANDPARENT)?

Looking closer through the default texmf.cnf, there's also TEXMFCNF which uses $SELFAUTOLOC, $SELFAUTODIR, $SELFAUTOPARENT and $SELFAUTOGRANDPARENT, but if I understand correctly this is precisely where the location of texmf.cnf files is defined, with $SELFAUTOLOC the location of the currently used binary (ie luatex), right?

Bruno



From luatex at nililand.de  Thu Mar  9 10:33:42 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 9 Mar 2017 10:33:42 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
Message-ID: <171kcjuop7dnv$.dlg@nililand.de>

Am Thu, 9 Mar 2017 02:22:55 +0100 schrieb Reinhard Kotucha:

> It should be sufficient to put a texmf.cnf file into ~/.texlive2016/bin
> which only contains one line:
> 
>   TEXMROOT = /usr/local/texlive/2016

Assuming that I set it up this way:

texlive2016/bin/...
texlive2016/bindev/... %dev luatex

then it should be possible to use the experimental version by simply
adding bindev to the path. But as it also need a new format, how
could one point the dev-version to a different location for it?


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From bvoisin at me.com  Thu Mar  9 15:00:52 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Thu, 09 Mar 2017 15:00:52 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
In-Reply-To: <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
Message-ID: <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>

> Le 9 mars 2017 ? 08:02, Bruno Voisin <bvoisin at me.com> a ?crit :
> 
>> Le 9 mars 2017 ? 02:22, Reinhard Kotucha <reinhard.kotucha at web.de> a ?crit :
>> 
>> It should be sufficient to put a texmf.cnf file into ~/.texlive2016/bin
>> which only contains one line:
>> 
>> TEXMROOT = /usr/local/texlive/2016
> 
> Would something also need to be done for texmf-local, like
> 
> TEXMFLOCAL = /usr/local/texlive/texmf-local
> 
> (to replace $SELFAUTOGRANDPARENT)?
> 
> Looking closer through the default texmf.cnf, there's also TEXMFCNF which uses $SELFAUTOLOC, $SELFAUTODIR, $SELFAUTOPARENT and $SELFAUTOGRANDPARENT, but if I understand correctly this is precisely where the location of texmf.cnf files is defined, with $SELFAUTOLOC the location of the currently used binary (ie luatex), right?


It's not as easy at it sounds. After putting luatex inside ~/Library/texbin, creating symlinks lualatex, texlua and texluac, adding a texmf.cnf containing

TEXMROOT = /usr/local/texlive/2016
TEXMFLOCAL = /usr/local/texlive/texmf-local

and adding to .bash_profile

export PATH="$HOME/Library/texbin":$PATH

then texdoc no longer works

$ texdoc texlive
/Library/TeX/texbin/texdoc:7: module 'texdoc.main' not found:
	no field package.preload['texdoc.main']
	[kpse lua searcher] file not found: 'texdoc.main'
	[kpse C searcher] file not found: 'texdoc.main'
	no file '/usr/local/lib/lua/5.2/texdoc.so'
	no file '/usr/local/lib/lua/5.2/loadall.so'
	no file './texdoc.so'

nor does fmtutil

$ fmtutil --byengine luatex
fmtutil: fmtutil is using the following fmtutil.cnf files (in precedence order):
fmtutil:   /usr/local/texlive/texmf-local/web2c/fmtutil.cnf
fmtutil:   /usr/local/texlive/2016/texmf-dist/web2c/fmtutil.cnf
fmtutil: fmtutil is using the following fmtutil.cnf file for writing changes:
fmtutil:   /Users/brunovoisin/Library/texlive/2016/texmf-config/web2c/fmtutil.cnf
fmtutil [INFO]: writing formats under /Users/brunovoisin/Library/texlive/2016/texmf-var/web2c
fmtutil [INFO]: --- remaking luatex with luatex
fmtutil: running `luatex -ini   -jobname=luatex -progname=luatex luatex.ini' ...
This is LuaTeX, Version 1.0.3 (TeX Live 2017/dev)  (INITEX)
! I can't find file `luatex.ini'.
<*> luatex.ini
[...]
!  ==> Fatal error occurred, bad output DVI file produced!
No pages of output.
Transcript written on luatex.log.
[...]
fmtutil [ERROR]: running `luatex -ini   -jobname=luatex -progname=luatex luatex.ini </dev/null' return status 1
fmtutil [ERROR]: return error due to options --strict
[...]
fmtutil [INFO]: Disabled formats: 6
fmtutil [INFO]: Not selected formats: 41
fmtutil [INFO]: Failed to build: 5 (luatex/luatex luatex/pdfcsplain luatex/lualatex luatex/dvilualatex luatex/dviluatex)
fmtutil [INFO]: Total formats: 52
fmtutil [INFO]: exiting with status 5

I've tried all sorts of things:

- Putting kpsewhich alongside luatex inside ~/Library/texbin, as suggested by Norbert. Norbert's test "kpsewhich -show-path .cnf" then only returns directories inside ~/Library/texbin. Without putting kpsewhich there, the same test only returns directories inside /usr/local/texlive/2016.

- Setting also TEXMFCNF inside texmf.cnf

TEXMFCNF = {\
$SELFAUTOLOC,\
$SELFAUTOLOC/share/texmf-local/web2c,\
$SELFAUTOLOC/share/texmf-dist/web2c,\
$SELFAUTOLOC/share/texmf/web2c,\
$SELFAUTOLOC/texmf-local/web2c,\
$SELFAUTOLOC/texmf-dist/web2c,\
$SELFAUTOLOC/texmf/web2c,\
\
/usr/local/texlive/texmf-local/web2c,\
/usr/local/texlive/2016,\
\
/usr/local/texlive/2016/share/texmf-local/web2c,\
/usr/local/texlive/2016/share/texmf-dist/web2c,\
/usr/local/texlive/2016/share/texmf/web2c,\
/usr/local/texlive/2016/texmf-local/web2c,\
/usr/local/texlive/2016/texmf-dist/web2c,\
/usr/local/texlive/2016/texmf/web2c\
}

- Create also a texmfcnf.lua with

return { 
  content = {
    variables = {
      TEXMFCNF     = "{selfautodir:,/usr/local/texlive/2016}{,{/share,}/texmf{-local,}/web2c}"
      TEXMFSYSVAR     = "/usr/local/texlive/2016/texmf-var",
      TEXMFDIST       = "/usr/local/texlive/2016/texmf-dist",
      TEXMFSYSCONFIG  = "/usr/local/texlive/2016/texmf-config",
      TEXMFFONTS      = "/usr/local/texlive/2016/texmf-fonts",
      TEXMFPROJECT    = "/usr/local/texlive/2016/texmf-project",
    },
  },
}

None of this has the slightest effect!

I'm done, this is simply way above my league and has consumed far too much time already. Will wait for TeX Live 2017.

Bruno



From norbert at preining.info  Thu Mar  9 15:09:47 2017
From: norbert at preining.info (Norbert Preining)
Date: Thu, 9 Mar 2017 23:09:47 +0900
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
Message-ID: <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>

> None of this has the slightest effect!

Complain to luatex maintainers about not reusing the ls-R database
and kpsewhich, but implementing their own solution.

<rant>
That is life with luatex (and context), and that is the reason
most distributions scare away from it, why context is updated
only once a year on CTAN (TL), and if you really want to use 
new luatex (or context), you need to install your own extra
distribution (context minimals).

Sad it is, I have to say, but this is the reality requested and
forced by the "new world order".
</rant>

I could repeat the same outside, <rant>, though. I know Hans and
others will come up with 150^100 reasons why their way is better
in all ways, but it does not help, since the rest of the world
does not completely agree.

> I'm done, this is simply way above my league and has consumed far too much time already. Will wait for TeX Live 2017.

That is probably the best way out anyway. Lots of pain for not so
much gain.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From pragma at wxs.nl  Thu Mar  9 15:35:39 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 9 Mar 2017 15:35:39 +0100
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
Message-ID: <65bf389b-f270-639b-d623-4fdac4b69a4a@wxs.nl>

On 3/9/2017 3:09 PM, Norbert Preining wrote:
>> None of this has the slightest effect!
>
> Complain to luatex maintainers about not reusing the ls-R database
> and kpsewhich, but implementing their own solution.
>
> <rant>
> That is life with luatex (and context), and that is the reason
> most distributions scare away from it, why context is updated
> only once a year on CTAN (TL), and if you really want to use
> new luatex (or context), you need to install your own extra
> distribution (context minimals).
>
> Sad it is, I have to say, but this is the reality requested and
> forced by the "new world order".
> </rant>
>
> I could repeat the same outside, <rant>, though. I know Hans and
> others will come up with 150^100 reasons why their way is better
> in all ways, but it does not help, since the rest of the world
> does not completely agree.
>
>> I'm done, this is simply way above my league and has consumed far too much time already. Will wait for TeX Live 2017.
>
> That is probably the best way out anyway. Lots of pain for not so
> much gain.

i didn't follow this thread closely but i don't see what the issue of 
updating something lucida has to do with luatex or context

(1) luatex normally uses kpse and lsr whatever so latex should not be 
hampered by anything context; updating a binary on the one hand and some 
macros on the other hand is pretty trivial

(2) i have been using additional paths in texnmf.cnf files for ages with 
pdftex even if when was considered weird and strange (i had to defend it 
which to me makes the remark about it being a brilliant solution in some 
previous mail sound funny)

(3) updating context is not really a problem ... happens frequently on 
the context garden .. yes, if we add somethign to the engine and context 
uses it, one has to update both .. btu that is not related to lucida or 
whatever this thread is about

(4) we do test changes in luatex with plain (which then uses kpse and 
lsr) so again ... no problem

(5) the reason why context follows another route is manyfold and over a 
decade discussed in articles: it's faster (definitely was way faster a 
decade ago, taking a second of tex startup with large trees), we can do 
more things (not only read from the file system),  can plug in all kind 
of input handling code, experiment with sandboxing, have more options 
and control in the main configuration (without the need to bother and 
interfere with other macro packages), etc etc .. if i wouldn't had those 
options i'd already be long gone from the tex community

in retrospect maybe luatex should have been a context only thing so that 
there was no burden on tex live and non context users

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From luatex at nililand.de  Thu Mar  9 15:36:55 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 9 Mar 2017 15:36:55 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
Message-ID: <1958hlkc2x0dm.dlg@nililand.de>

Am Thu, 09 Mar 2017 15:00:52 +0100 schrieb Bruno Voisin:

> adding a texmf.cnf containing
> 
> TEXMROOT = /usr/local/texlive/2016

Shouldn't this be TEXMFROOT?


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From pragma at wxs.nl  Thu Mar  9 15:37:45 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 9 Mar 2017 15:37:45 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
Message-ID: <cc6ba226-ece3-5a60-954d-87de4b3fd41f@wxs.nl>

On 3/9/2017 3:00 PM, Bruno Voisin wrote:

> - Create also a texmfcnf.lua with
>
> return {
>   content = {
>     variables = {
>       TEXMFCNF     = "{selfautodir:,/usr/local/texlive/2016}{,{/share,}/texmf{-local,}/web2c}"
>       TEXMFSYSVAR     = "/usr/local/texlive/2016/texmf-var",
>       TEXMFDIST       = "/usr/local/texlive/2016/texmf-dist",
>       TEXMFSYSCONFIG  = "/usr/local/texlive/2016/texmf-config",
>       TEXMFFONTS      = "/usr/local/texlive/2016/texmf-fonts",
>       TEXMFPROJECT    = "/usr/local/texlive/2016/texmf-project",
>     },
>   },
> }

This is a file for context so unrelated to your problem.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Thu Mar  9 16:13:14 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 9 Mar 2017 15:13:14 +0000
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
Message-ID: <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>

On 9 March 2017 at 14:09, Norbert Preining <norbert at preining.info> wrote:
>> None of this has the slightest effect!
>
> Complain to luatex maintainers about not reusing the ls-R database
> and kpsewhich, but implementing their own solution.
>
> <rant>
> That is life with luatex (and context), and that is the reason
> most distributions scare away from it, why context is updated
> only once a year on CTAN (TL), and if you really want to use
> new luatex (or context), you need to install your own extra
> distribution (context minimals).
>

This doesn't seem quite right: context switches it off, but lua(la)tex
will use kpse file searching

I regularly use development builds of luatex in the main texlive tree
(I don't bother maintaining separate trees, just drop the new binary
in
(for me) /usr/local/texlive/2016/bin/x86_64-cygwin/luatex and rebuild
the formats with fmtutil-sys.


David

From luatex at nililand.de  Thu Mar  9 17:54:13 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 9 Mar 2017 17:54:13 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
Message-ID: <sgbq4odjyon2$.dlg@nililand.de>

Am Thu, 09 Mar 2017 15:00:52 +0100 schrieb Bruno Voisin:

> It's not as easy at it sounds.

I just tried out the following on windows:

I created a folder 

    texlive\2016\bin-dev\win32

and copied all the content from \texlive\2016\bin\win32 in this
folder.

Then I replaced the luatex.dll and the lua.exe and luac.exe by
versions from w32tex.org (I also added the files of the development
version of luajittex).

I added in bin-dev\win32 a texmf.cnf with the content

TEXMFSYSVAR = $TEXMFROOT/texmf-var-dev

I created the folder texmf-var-dev beside texmf-var.

I added texlive\2016\bin-dev\win32 to the front of my path and then
rebuild the formats with fmtutil-sys: All were put in texmf-var-dev
and using lua

It works perfectly. I can switch between TL16 and my new TLdev by
changing the path. I will only have to remember to rebuild the
formats if something changes. 


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luatex at nililand.de  Thu Mar  9 18:13:21 2017
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 9 Mar 2017 18:13:21 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com> <sgbq4odjyon2$.dlg@nililand.de>
Message-ID: <13tyrhobj95j.dlg@nililand.de>

Am Thu, 9 Mar 2017 17:54:13 +0100 schrieb Ulrike Fischer:

> I will only have to remember to rebuild the
> formats if something changes.

And naturally updmaps-sys and fc-cache ... 
(I also copied the fonts/conf folder in my new texmf-var-dev folder
for xelatex).


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From reinhard.kotucha at web.de  Thu Mar  9 22:26:14 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 9 Mar 2017 22:26:14 +0100
Subject: [luatex] [lucida]   luatex hangs on lucida OT test file
In-Reply-To: <1958hlkc2x0dm.dlg@nililand.de>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <1958hlkc2x0dm.dlg@nililand.de>
Message-ID: <22721.51318.795119.565729@zaphod.ms25.net>

On 2017-03-09 at 15:36:55 +0100, Ulrike Fischer wrote:

 > Am Thu, 09 Mar 2017 15:00:52 +0100 schrieb Bruno Voisin:
 > 
 > > adding a texmf.cnf containing
 > > 
 > > TEXMROOT = /usr/local/texlive/2016
 > 
 > Shouldn't this be TEXMFROOT?

Of course!  Sorry, this was _my_ fault.

Thanks,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From preining at logic.at  Fri Mar 10 08:49:34 2017
From: preining at logic.at (Norbert Preining)
Date: Fri, 10 Mar 2017 16:49:34 +0900
Subject: [luatex] luatex hangs on lucida OT test file
In-Reply-To: <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
Message-ID: <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>

Hi

On Thu, 09 Mar 2017, David Carlisle wrote:
> I regularly use development builds of luatex in the main texlive tree
> (I don't bother maintaining separate trees, just drop the new binary

Ok, I admit I was wrong with my rant concerning *luatex*. Sorry for that.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From bvoisin at me.com  Fri Mar 10 10:04:29 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Fri, 10 Mar 2017 10:04:29 +0100
Subject: [luatex] [lucida]  luatex hangs on lucida OT test file
In-Reply-To: <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
Message-ID: <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>

> Le 10 mars 2017 ? 08:49, Norbert Preining <preining at logic.at> a ?crit :
> 
> Ok, I admit I was wrong with my rant concerning *luatex*. Sorry for that.

Yes, I didn't answer for fear of just fanning the embers (approximate translation for the French "souffler sur les braises"), but I don't think ConTeXt was involved.

The problem is probably that reconfiguring TeX Live to use a second binary tree in addition to the main one is much more involved than I originally thought, if possible at all. For example texmf.cnf has a

CLUAINPUTS = .;$SELFAUTOLOC/lib/{$progname,$engine,}/lua//

that refers to non-existing paths in the distro. So I imagine it's paths to libraries that are included at compile time inside the binaries, hence absent from the distro. So that would mean relative paths hardcoded into the binaries, possibly explaining why texdoc (now in lua) would fail when luatex is no longer in the main texlive tree.

Bruno



From luigi.scarso at gmail.com  Fri Mar 10 10:31:10 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 10 Mar 2017 10:31:10 +0100
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
In-Reply-To: <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
 <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
Message-ID: <CAG5iGsBQCDZLiuOqUVLGdG2RHybfE0YGqAn4iHmB_Cx5qbeJjg@mail.gmail.com>

On Fri, Mar 10, 2017 at 10:04 AM, Bruno Voisin <bvoisin at me.com> wrote:

> Yes, I didn't answer for fear of just fanning the embers (approximate translation for the French "souffler sur les braises")
"soffiare sul fuoco" in italian, almost the same.

> The problem is probably that reconfiguring TeX Live to use a second binary tree in addition to the main one is much more involved than I originally thought, if possible at all.
Hm, if you want to experiment, why not  just install a  subset of
texlive into a separate folder, i.e. tl2016-exp ?
Switching among tl2016 and tl2016-exp should be a matter of setting
the right PATH, you can keep a standard texlive as reference
and play with tl2016-exp with new binaries packages.



-- 
luigi

From reinhard.kotucha at web.de  Fri Mar 10 22:22:44 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 10 Mar 2017 22:22:44 +0100
Subject: [luatex] [lucida]  luatex hangs on lucida OT test file
In-Reply-To: <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
 <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
Message-ID: <22723.6436.834572.762340@zaphod.ms25.net>

On 2017-03-10 at 10:04:29 +0100, Bruno Voisin wrote:

 > The problem is probably that reconfiguring TeX Live to use a second
 > binary tree in addition to the main one is much more involved than
 > I originally thought, if possible at all. For example texmf.cnf has
 > a
 > 
 > CLUAINPUTS = .;$SELFAUTOLOC/lib/{$progname,$engine,}/lua//
 > 
 > that refers to non-existing paths in the distro. So I imagine it's
 > paths to libraries that are included at compile time inside the
 > binaries, hence absent from the distro. So that would mean relative
 > paths hardcoded into the binaries, possibly explaining why texdoc
 > (now in lua) would fail when luatex is no longer in the main
 > texlive tree.

Bruno, CLUAINPUTS defines directories where you can put shared
libraries which can be used by LuaTeX.  The directory doesn't exist
because no such libraries are shipped with TeX Live (yet?).  Since
shared libraries contain machine code, they have to be somewhere below
SELFAUTOLOC (imagine a tree with the root at the top :).  You can
safely ignore CLUAINPUTS.

I don't know why texdoc doesn't work.  In order to to find out what
goes wrong it's best to set the KPSEDEBUG env var with an appropriate
value for debugging.  I also don't know whether TEXMFCNF is the
culprit but I don't think so.

However, it *is* very easy to add a directory tree with other binaries
iff you have a (multiplatform) TeX Live installation from tug.org and
have write permissions in /usr/local/texlive.  The latter should be
true if the computer is yours.

It's very simple. Assume your platform is i368-linux:

  cd /usr/local/texlive/2016/bin
  cp -a i368-linux my-i368-linux

That's all.  Now you can replace the luatex binary in

  /usr/local/texlive/2016/bin/my-i368-linux

There is no need to touch any config file.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From kakuto at fuk.kindai.ac.jp  Sat Mar 11 00:06:49 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 11 Mar 2017 08:06:49 +0900
Subject: [luatex]  [lucida] luatex hangs on lucida OT test file
Message-ID: <C00DCB7A4E5A436E87404A64D105A3CE@CJ3001517A>

> Bruno, CLUAINPUTS defines directories where you can put shared
> libraries which can be used by LuaTeX.  The directory doesn't exist
> because no such libraries are shipped with TeX Live (yet?).  Since
> shared libraries contain machine code, they have to be somewhere below
> SELFAUTOLOC (imagine a tree with the root at the top :).  You can
> safely ignore CLUAINPUTS.

For Windows, users are able to add DLL modules in TeX Live 2016.
In TeX Live 2017 and later, adding of DLL modules may
become impossible or very difficult due to multiple Lua VMs
problem, since I'll link lua52, luajit, and luaffi statically.
I think this may not be undesirable since DLL modules can
lead to security problems.

If users want to use some DLL in lua(jit)tex, they will be able to do
that with the help of the new (luatex) and the existing (luajittex) ffi
under the --shell-escape option.

Best,
Akira


From bvoisin at me.com  Sat Mar 11 11:58:16 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Sat, 11 Mar 2017 11:58:16 +0100
Subject: [luatex] [lucida]  luatex hangs on lucida OT test file
In-Reply-To: <22723.6436.834572.762340@zaphod.ms25.net>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
 <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
 <22723.6436.834572.762340@zaphod.ms25.net>
Message-ID: <AB85BC9C-2237-4714-A5A6-29509F8F5F30@me.com>

> Le 10 mars 2017 ? 22:22, Reinhard Kotucha <reinhard.kotucha at web.de> a ?crit :
> 
> However, it *is* very easy to add a directory tree with other binaries
> iff you have a (multiplatform) TeX Live installation from tug.org and
> have write permissions in /usr/local/texlive.  The latter should be
> true if the computer is yours.
> 
> It's very simple. Assume your platform is i368-linux:
> 
>  cd /usr/local/texlive/2016/bin
>  cp -a i368-linux my-i368-linux
> 
> That's all.  Now you can replace the luatex binary in
> 
>  /usr/local/texlive/2016/bin/my-i368-linux
> 
> There is no need to touch any config file.

Reinhard (and Luigi and David),

Thanks for the help and suggestions. Actually it's possible to go further than this on the Mac, but one problem remains though which I don't think can be solved (format building, see at the end).

What I've done:

- Download the developments version of LuaTeX. By the way, the links at <http://www.luatex.org/download.html> are partially wrong: there is no link to the 64-bit intel binary, and conversely there is one for a universal binary (ppc + i386) which no longer exists. So I've just downloaded

  http://minimals.contextgarden.net/current/bin/luatex/osx-64/bin/luatex
  http://minimals.contextgarden.net/current/bin/luatex/osx-intel/bin/luatex
  http://minimals.contextgarden.net/current/bin/luatex/osx-ppc/bin/luatex

- Create as you suggest copies of the binary directories

  cd /usr/local/texlive/2016/bin
  sudo cp -a x86_64-darwin dev-x86_64
  sudo cp -a universal-darwin dev-i386
  sudo cp -a universal-darwin dev-ppc

and replace the luatex binaries inside by those just downloaded.

- Then create a Mac collection of symlinks, called a TeXDist directory structure, allowing to switch immediately from one TeX distribution to another (used when testing texlive-year+1-beta against texlive-year, for example) with one mouse click in the GUI TeX Live Utility or use of the CLI texdist.

The script for creating this structure, called TeXLive-Dev say, is attached (based heavily on Dick Koch's postinstall script for MacTeX). Then, for example:

  $ texdist --texdist=TeXLive-2016 "luatex --version"
  This is LuaTeX, Version 0.95.0 (TeX Live 2016)
  [...]
  $ texdist --texdist=TeXLive-Dev "luatex --version"
  This is LuaTeX, Version 1.0.3 (TeX Live 2017/dev)
  [...]
  $ texdist --current
  TeXLive-2016
  $ sudo texdist --setcurrent=TeXLive-Dev
  $ texdist --current
  TeXLive-Dev

- Alas, what I had forgotten (again) is that formats are specific to a binary. So running Norbert's example returned a "fatal file format; I'm stymied" error, and required a

  sudo fmtutil-sys --byengine luatex

After that everything works well. But then again the formats would have to be recompiled to go back to TeXLive-2016.

So I think there is really no one-command/one-click way to switch between different sets of binaries for a given TeX Live tree. What is needed is have two fully functional separate trees side-by side, as Luigi suggested. Which probably leads to something similar to the ConTeXt Mac installation described at

  http://wiki.contextgarden.net/Mac_Installation

(which I assumes originates from the work of Mojca Miklavec).

I'll stop looking at this anyway, this is too time-consuming (and probably not worth the effort).

Bruno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: set-TeXLive-Dev
Type: application/octet-stream
Size: 3950 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170311/a2ab67c9/attachment.obj>

From patrick at gundla.ch  Sat Mar 11 18:04:23 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 11 Mar 2017 18:04:23 +0100
Subject: [luatex] Profiling LuaTeX / difference with jit
Message-ID: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>

Hi all,

I try to understand Lua's debug library and came across differences between luatex and luajittex.

See the following program:

------------
function a(cp)
    return string.format("abc %d",cp)
end


function dothings()
	a(2)
	a(2)
end


function onDebugHook( hookType )
	local funcInfo = debug.getinfo( 2 )
	if hookType == "call" then
		print("call",funcInfo.name or "?")
	elseif hookType == "return" then
		print("return",funcInfo.name or "?")
	end
end

debug.sethook( onDebugHook, 'cr')


dothings()
--------------

with "luatex --luaonly main.lua" I get a balanced call/return list:

--------------
return	sethook
call	dothings
call	a
call	format
return	format
return	a
call	a
call	format
return	format
return	a
return	dothings
return	?
--------------


with "luajittex --luaonly main.lua" I get

--------------
call	dothings
call	a
call	a
call	a
call	a
return	dothings
return	?
--------------


I guess this has to do with optimizations that Luajittex does. 

Just out of curiosity (I can of course work with regular LuaTeX) Now let's say I want to have the output from LuaTeX with the LuajitTeX program, (how) is this possible?

Patrick






From kakuto at fuk.kindai.ac.jp  Sat Mar 11 23:37:52 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sun, 12 Mar 2017 07:37:52 +0900
Subject: [luatex] [lucida] luatex hangs on lucida OT test file
Message-ID: <D5D9A8A4E7F74EDCB88040272887E568@CJ3001517A>

> In TeX Live 2017 and later, adding of DLL modules may
> become impossible or very difficult due to multiple Lua VMs
> problem, since I'll link lua52, luajit, and luaffi statically.

The "lltxplatform" module in the "lualatex-platform" package
by Philipp Stephani may be convenient to know system fonts.
Thus I linked it as a static module as an exercise.
For example, the following may work on windows in TeX Live 2017:

--
-- texlua test.lua
-- or
-- texluajit test.lua
--
require "lltxplatform"

local fonts = lltxplatform.get_installed_fonts()

for k, v in pairs(fonts) do
    print(k, v.name, v.path)
end

Best,
Akira


From reinhard.kotucha at web.de  Sun Mar 12 00:25:48 2017
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 12 Mar 2017 00:25:48 +0100
Subject: [luatex] [lucida]  luatex hangs on lucida OT test file
In-Reply-To: <AB85BC9C-2237-4714-A5A6-29509F8F5F30@me.com>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
 <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
 <22723.6436.834572.762340@zaphod.ms25.net>
 <AB85BC9C-2237-4714-A5A6-29509F8F5F30@me.com>
Message-ID: <22724.34684.95616.18862@zaphod.ms25.net>

On 2017-03-11 at 11:58:16 +0100, Bruno Voisin wrote:

 > So I think there is really no one-command/one-click way to switch
 > between different sets of binaries for a given TeX Live tree. What
 > is needed is have two fully functional separate trees side-by side,
 > as Luigi suggested.

Format files are not system dependent in general.  Formerly they had
been due to the nasty endian-mess but Karl changed it because on a
live system all platforms have to share the same format files.  Here I
have 32 bit and 64 bit binaries for Linux installed and can switch
between them.  My system supports both.

The problem in your case is that the _content_ of the format files of
the different versions of LuaTeX is different.  Some macros were
added, changed, or removed.  This is what makes them incompatible but
they are still platform independent.

If you still have the setup I suggested, you can try this:

  * move the format files of the new version of LuaTeX to the
    directory containing the binaries.  Make sure to copy the correct
    ones.  If in doubt, generate them again.

  * put a texmf.cnf file into this directory containing the line:

        TEXFORMATS=$SELFAUTOLOC

    The new version of LuaTeX will then search in the directory
    containing the new binaries only.  The original TeX Live (from
    tug.org) will still search in its standard directories.

  * switch to the original TeX Live (from tug.org) and re-create
    all formats again.

  * when the directory containing the new version of LuaTeX is in
    PATH, *never* re-create any formats.  Maybe it's helpful to
    disable fmtutil[-sys] and/or tlmgr so that you can't destroy
    anything by accident.

    	chmod a-x fmtutil* tlmgr

    You can enable them temporarily if needed.

It's also possible to follow Luigi's suggestion.  However, this
requires much more disk space.  Though disk space isn't a problem
nowadays, you have to keep two systems up-to-date.  I don't doubt that
it works but I fear that maintenance is more time-consuming.

Kpathsea makes a TeX installation extremely flexible.  I never
encountered any situation where I had to configure something at
compile-time.  There is almost nothing you can't configure at
runtime.

What you have to know is that kpathsea looks for texmf.cnf files in
various directories and evaluates all of them.  A variable set in one
of them will not be overwritten if set in a file evaluated later.

If you create an extra bin/<platform>/ directory, as I suggested, it's
important to know that kpathsea looks for texmf.cnf files in
SELFAUTOLOC first (the directory containing the *tex executables).
TeX Live doesn't make use of this feature but it's very useful in
some situations, especially in our case.

BTW, kpathsea is well documented

  texdoc kpathsea

but in real life the comments in

  texmf-dist/web2c/texmf.cnf

are extremely helpful as well.

Bruno, please don't give up.  We'll find a reasonable solution,
one way or another.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From preining at logic.at  Sun Mar 12 02:10:14 2017
From: preining at logic.at (Norbert Preining)
Date: Sun, 12 Mar 2017 10:10:14 +0900
Subject: [luatex] tlluatex-dev repository
Message-ID: <20170312011014.55f7z2ljvb2ss6pq@bulldog.preining.info>

Dear all,

to pay for my rant, I created a TL repository with the latest
luatex binaries that can be installed on x86-64 linux.

All normal formats are automatically generated, the program names
are
The binaries:
	luatex-dev, luajittex-dev
and the format programs
	luatex1
	lualatex1
	dviluatex1
	dvilualatex1
These are script files (NOT links to the binaries!) that do 
the following:
	luatex-dev -progname luatex -fmtname=... "$*"

With this, format creating and execution works, no further need to
switch

BUT WARNING!!! THere is one thing that needs to be done, due to
fmtutil ..

The formats are generated in
	TEXMFSYSVAR/web2c/luatex-dev/
The formats there need to be moved to
	TEXMFSYSVAR/web2c/luatex/

Another option is to link luatex-dev to luatex *BEFORE* installing
the package:
	ln -s TEXMFSYSVAR/web2c/luatex TEXMFSYSVAR/web2c/luatex-dev

After creating this symbolic (or hard) link, updates should work
automatically.

Binaries are currently only x64_64-linux, I might add more later.

Repository is at
	http://www.preining.info/tlluatex-dev/

Use
	tlmgr -repo ... install luatex-dev
or use the usual command to add another repository

All the best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From pragma at wxs.nl  Sun Mar 12 14:32:48 2017
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 12 Mar 2017 14:32:48 +0100
Subject: [luatex] Profiling LuaTeX / difference with jit
In-Reply-To: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>
References: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>
Message-ID: <9490b366-d5ec-4d01-25fd-c345b36f58eb@wxs.nl>

On 3/11/2017 6:04 PM, Patrick Gundlach wrote:

> Just out of curiosity (I can of course work with regular LuaTeX) Now let's say I want to have the output from LuaTeX with the LuajitTeX program, (how) is this possible?

i wouldn't be surprised it the info needed is gone after the optimization

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From bvoisin at me.com  Sun Mar 12 15:02:39 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Sun, 12 Mar 2017 15:02:39 +0100
Subject: [luatex] [lucida]  luatex hangs on lucida OT test file
In-Reply-To: <22724.34684.95616.18862@zaphod.ms25.net>
References: <20170307235401.saqnplgqcmgp6qpj@burischnitzel.preining.info>
 <CFD93AF0-46DA-4444-B0EB-C2B962B0B958@me.com>
 <20170308145930.6lsssgf7qz3oot2e@burischnitzel.preining.info>
 <22720.44655.577386.957818@zaphod.ms25.net>
 <0459DA0F-2533-4C15-BAEC-090B103C7AE0@me.com>
 <BE1CD9AA-9359-444E-A1E3-8DF346A8C4E7@me.com>
 <20170309140947.idhs2gjn4czum7cx@burischnitzel.preining.info>
 <CAEW6iOgwUibcP3SQjARpg2RetTxmjbTO_Jr-ECtA6trNKRqSBg@mail.gmail.com>
 <20170310074934.uxuagopic3p5miyc@burischnitzel.preining.info>
 <9264FD9E-11AE-44DF-913E-338D5C6D482A@me.com>
 <22723.6436.834572.762340@zaphod.ms25.net>
 <AB85BC9C-2237-4714-A5A6-29509F8F5F30@me.com>
 <22724.34684.95616.18862@zaphod.ms25.net>
Message-ID: <529CC523-04A2-401F-ACDF-62A57F07712E@me.com>

> Le 12 mars 2017 ? 00:25, Reinhard Kotucha <reinhard.kotucha at web.de> a ?crit :
> 
> If you still have the setup I suggested, you can try this:
> 
>  * move the format files of the new version of LuaTeX to the
>    directory containing the binaries.  Make sure to copy the correct
>    ones.  If in doubt, generate them again.
> 
>  * put a texmf.cnf file into this directory containing the line:
> 
>        TEXFORMATS=$SELFAUTOLOC
> 
>    The new version of LuaTeX will then search in the directory
>    containing the new binaries only.  The original TeX Live (from
>    tug.org) will still search in its standard directories.
> 
>  * switch to the original TeX Live (from tug.org) and re-create
>    all formats again.
> 
>  * when the directory containing the new version of LuaTeX is in
>    PATH, *never* re-create any formats.  Maybe it's helpful to
>    disable fmtutil[-sys] and/or tlmgr so that you can't destroy
>    anything by accident.
> 
>    	chmod a-x fmtutil* tlmgr
> 
>    You can enable them temporarily if needed.

Thanks, Reinhard. What I've finally done is the following:

- Create inside /usr/local/texlive/2016/bin/dev-x86_64 a texmf.cnf containing

    TEXFORMATS = .;$SELFAUTOLOC;$TEXMF/web2c{/$engine,}

hoping that it would mean the formats are searched first in the current directory, then in the dev bin directory, then in the standard texmf-var.

- Move the .fmt files from texmf-var/web2c/luatex inside this bin directory.

- Switch to the original TeX Live and recreate the LuaTeX-based formats.

This seems to work: having selected the dev bin directory as the one of use, I was able to run both lualatex (for which the format is in the dir) and xelatex (for which the format is still in texmf-var).

Actually I think it's possible to create format files once in the new setup, should the need arise: you just need to specify the --fmtdir and add --no-engine-subdir to the arguments. Namely, I've ran 

    sudo fmtutil-sys --fmtdir /usr/local/texlive/2016/bin/dev-x86_64 --no-engine-subdir --byengine luatex

successfully.

But then, of course, that wouldn't work when tlmgr (TeX Live Utility on the Mac) rebuilds a format automatically after a package update.

So you would need to configure the fmtutil in the dev bin directory to use this --fmtdir together with --no-engine-subdir by default. I don't think fmtutil.cnf allows that.

Really, I don't think this all is worth the effort: I just made a rather rhetorical comment originally, about not being able to replace momentarily the binaries in TeX Live by newer development versions without touching the main  texlive tree. I had not at all given thought then, how this could be compatible with the texlive architecture.

Trying now, it just seems every time progress is made towards that direction, a new problem arises. There are just too many separate utilities in TeX Live, hence too many config files to set, too many variables to take into account, for everything to work transparently in the end. In any case, I can't possibly devote more time to the matter, unfortunately.

Bruno



From d.p.carlisle at gmail.com  Sun Mar 12 15:18:15 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sun, 12 Mar 2017 14:18:15 +0000
Subject: [luatex] Profiling LuaTeX / difference with jit
In-Reply-To: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>
References: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>
Message-ID: <CAEW6iOgrWqLbmoR7cwTxWDqCfcpPC69Bkda7fLYQqNb2zBP1Nw@mail.gmail.com>

It looks like you are seeing the inlined C calls but the Lua level
name isn't getting reset so you see "a" apparently called four times.
the output is a bit less confusing if you restrict to Lua

        if (hookType == "call" and funcInfo.what=='Lua') then

Then you get

$ luajittex --luaonly pg1.lua
call    dothings
call    a
call    a
return  dothings


$ luatex --luaonly pg1.lua
call    dothings
call    a
return  a
call    a
return  a
return  dothings

so it doesn't trace format in either case and doesn't trace the
returns in luajit, presumably as the function has been inlined in some
way by the jit compiler.

From preining at logic.at  Mon Mar 13 04:03:41 2017
From: preining at logic.at (Norbert Preining)
Date: Mon, 13 Mar 2017 12:03:41 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
Message-ID: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>

Dear all,

some updates: fmtutil has been updated with today to automatically
deal with luatex-dev (all -dev) binaries. No need but
	tlmgr repository add http://www.preining.info/tlluatex-dev luatex-dev
	tlmgr pinning add luatex-dev '*'
	tlmgr install luatex-dev
and you will automatically get luatex 1.0.3, and can run the various
formats by appending a 1:
> 	luatex1
> 	lualatex1
> 	dviluatex1
> 	dvilualatex1

Binaries are taken from the context minimals page, the following archs
are included:
	amd64-freebsd
	i386-freebsd
	i386-linux
	x86_64-darwin
	x86_64-linux

Windows is not supported, I have no idea how to create wrappers and
how to deal with the shared libraries.

Enjoy.

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From bvoisin at me.com  Mon Mar 13 16:28:52 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Mon, 13 Mar 2017 16:28:52 +0100
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
Message-ID: <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>

Hi Norbert,

Answering your message and some of your questions on the Lucida list:

> some updates: fmtutil has been updated with today to automatically
> deal with luatex-dev (all -dev) binaries. No need but
> 	tlmgr repository add http://www.preining.info/tlluatex-dev luatex-dev
> 	tlmgr pinning add luatex-dev '*'
> 	tlmgr install luatex-dev

Works here on the Mac.

One slight adaptation is required for the GUI TeXShop, which is Mac-specific and selects binaries and formats through an Engines submenu. The default definition file LuaLaTeX.engine contains

#!/bin/tcsh
set path= ($path /Library/TeX/texbin /usr/texbin /usr/local/bin)
lualatex -file-line-error -synctex=1 "$1"

Replacing lualatex there by lualatex1 doesn't work (as -file-line-error is for the original lualatex binary, not your script lualatex1). Based on your script I created a new LuaLaTeX-dev.engine containing

#!/bin/tcsh
set path= ($path /Library/TeX/texbin /usr/texbin /usr/local/bin)
luatex-dev -progname=luatex -fmt=lualatex1 -file-line-error -synctex=1 "$1"

and things work transparently.

Same for the cross-platform TeXworks, which uses "processing tools". You need to either define a new tool in its Preferences interface



or edit the file tools.ini in its prefs directory, to add

[012]
arguments=-progname, luatex, -fmt, lualatex1, $synctexoption, $fullname
name=LuaLaTeX-dev
program=luatex-dev
showPdf=true

(the number on top is just the position of the tool in the submenu).

> and you will automatically get luatex 1.0.3, and can run the various
> formats by appending a 1:
>> 	luatex1
>> 	lualatex1
>> 	dviluatex1
>> 	dvilualatex1

Shouldn't pdfcsplain be included too? I've no idea why, nor did I ever use csplain, but it's in texmf-var/web2c/luatex and fmtutil.cnf contains

pdfcsplain pdftex - -etex -enc csplain-utf8.ini
pdfcsplain xetex - -etex csplain.ini
pdfcsplain luatex - -etex csplain.ini

> Binaries are taken from the context minimals page, the following archs
> are included:
> 	amd64-freebsd
> 	i386-freebsd
> 	i386-linux
> 	x86_64-darwin
> 	x86_64-linux
> 
> Windows is not supported, I have no idea how to create wrappers and
> how to deal with the shared libraries.

Regarding mac universal binaries: I don't think that's cause for concern:

- The last macOS version to support PowerPC is Leopard (aka 10.5) from 2009. Every year on the MacTeX Technical Working Group when preparing the new MacTeX, the question arises, how far back macOS versions should we extend support to. I think the decision was made last year to drop PPC support with MacTeX 2017.

- The ppc build at context minimals (2016-09-27 for osx-ppc) is lagging behind the intel builds (2017-02-16 for osx-64 and osx-intel), so I'm not sure it's updated any more. It should probably be considered obsolete.

In any case, looking yesterday at <http://www.tug.org/texlive/> I realized tl2017-pretest should start soon (next month), so all this will become secondary by then.

Bruno

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170313/938e80ad/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Capture d?e?cran 2017-03-13 a? 15.58.01.png
Type: image/png
Size: 259682 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20170313/938e80ad/attachment-0001.png>

From preining at logic.at  Mon Mar 13 16:46:00 2017
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Mar 2017 00:46:00 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
Message-ID: <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>

Hi Bruno,

thanks for your email and testing.

> Works here on the Mac.

Good to hear.

> One slight adaptation is required for the GUI TeXShop, which is Mac-specific and selects binaries and formats through an Engines submenu. The default definition file LuaLaTeX.engine contains

Ok, I have no idea about TeXShop etc as I don't use OSX (only the hardware ;-)

> Same for the cross-platform TeXworks, which uses "processing tools". You need to either define a new tool in its Preferences interface

Yes, that is true, of course.

> Shouldn't pdfcsplain be included too? I've no idea why, nor did I ever use csplain, but it's in texmf-var/web2c/luatex and fmtutil.cnf contains

Can be done, but I don't see much need for that ;-)

> Regarding mac universal binaries: I don't think that's cause for concern:

Good to know, thanks.

> In any case, looking yesterday at <http://www.tug.org/texlive/> I realized tl2017-pretest should start soon (next month), so all this will become secondary by then.

Yes indeed, but still, one reason I did it was to show how all this
can easily be done with on-board methods. No trickery here, just
use the cmd line options.
(Besides the fmtutil trickery, though ;-)

Furthermore, after TL2017 there will be for sure new version of
luatex etc that people want to test, and having a nice
setup already allows for this, without any adjustments (hopefully).

All the best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From bvoisin at me.com  Mon Mar 13 18:12:39 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Mon, 13 Mar 2017 18:12:39 +0100
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
Message-ID: <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>

> Le 13 Mar 2017 ? 16:46, Norbert Preining <preining at logic.at> a ?crit :
> 
> Furthermore, after TL2017 there will be for sure new version of
> luatex etc that people want to test, and having a nice
> setup already allows for this, without any adjustments (hopefully).


The following shows up in the console when typesetting your original LucidaMathOTProperties.tex:


- With release LuaTeX 0.95.0 from TeX Live 2016, before the hang:

(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def))
(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg)(load luc: 
/Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/ot
l/lmroman10-bold.luc)


- With development LuaTeX 1.0.3 installed using your updated fmtutil:

(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
*************************************************
* fontspec warning: "tu-clash"
* 
* I have found the tuenc.def encoding definition file but the TU encoding is
* not defined by the LaTeX2e kernel; attempting to correct but you really
* should update to the latest version of LaTeX2e.
*************************************************
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def)
(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tulmr.fd)

LaTeX Font Warning: Font shape `TU/cmr/m/n' undefined
(Font)              using `TU/lmr/m/n' instead on input line 105.

(load luc: /Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/gener
ic/fonts/otl/lmroman10-regular.luc))


This seems totally innocuous (typesetting succeeds), but I've no idea what's causing it.

Bruno



From patrick at gundla.ch  Mon Mar 13 19:24:09 2017
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 13 Mar 2017 19:24:09 +0100
Subject: [luatex] Profiling LuaTeX / difference with jit
In-Reply-To: <9490b366-d5ec-4d01-25fd-c345b36f58eb@wxs.nl>
References: <C4CF8F60-8602-4D4A-9572-C2A53DD0CC06@gundla.ch>
 <9490b366-d5ec-4d01-25fd-c345b36f58eb@wxs.nl>
Message-ID: <C7BB6DCD-82A1-4096-92BC-95F53CF32EC4@gundla.ch>

> 
>> Just out of curiosity (I can of course work with regular LuaTeX) Now let's say I want to have the output from LuaTeX with the LuajitTeX program, (how) is this possible?
> 
> i wouldn't be surprised it the info needed is gone after the optimization

yes, I gave up (for profiling purpose) with luajit and use regular LuaTeX.

Patrick




From preining at logic.at  Mon Mar 13 23:18:38 2017
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Mar 2017 07:18:38 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
Message-ID: <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>

You have an outdated format dump hanging around somewhere in your TEXMFVAR (~/.texlive2016/texmf-var)

This was fixed in LaTeX kernel long time ago.

Norbert

On March 14, 2017 2:12:39 AM GMT+09:00, Bruno Voisin <bvoisin at me.com> wrote:
>> Le 13 Mar 2017 ? 16:46, Norbert Preining <preining at logic.at> a ?crit
>:
>> 
>> Furthermore, after TL2017 there will be for sure new version of
>> luatex etc that people want to test, and having a nice
>> setup already allows for this, without any adjustments (hopefully).
>
>
>The following shows up in the console when typesetting your original
>LucidaMathOTProperties.tex:
>
>
>- With release LuaTeX 0.95.0 from TeX Live 2016, before the hang:
>
>(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
>(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
>(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def))
>(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec.cfg)(load
>luc: 
>/Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/generic/fonts/ot
>l/lmroman10-bold.luc)
>
>
>- With development LuaTeX 1.0.3 installed using your updated fmtutil:
>
>(/usr/local/texlive/2016/texmf-dist/tex/latex/fontspec/fontspec-luatex.sty
>*************************************************
>* fontspec warning: "tu-clash"
>* 
>* I have found the tuenc.def encoding definition file but the TU
>encoding is
>* not defined by the LaTeX2e kernel; attempting to correct but you
>really
>* should update to the latest version of LaTeX2e.
>*************************************************
>(/usr/local/texlive/2016/texmf-dist/tex/latex/base/fontenc.sty
>(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tuenc.def)
>(/usr/local/texlive/2016/texmf-dist/tex/latex/base/tulmr.fd)
>
>LaTeX Font Warning: Font shape `TU/cmr/m/n' undefined
>(Font)              using `TU/lmr/m/n' instead on input line 105.
>
>(load luc:
>/Users/brunovoisin/Library/texlive/2016/texmf-var/luatex-cache/gener
>ic/fonts/otl/lmroman10-regular.luc))
>
>
>This seems totally innocuous (typesetting succeeds), but I've no idea
>what's causing it.
>
>Bruno

--
PREINING Norbert + TeX Live & Debian Developer + http://www.preining.info
GPG: 0x860CDC13 fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13


From d.p.carlisle at gmail.com  Tue Mar 14 00:18:31 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Mon, 13 Mar 2017 23:18:31 +0000
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
Message-ID: <CAEW6iOipxjgkzuAw3=OZ05OLKQeky-vSOQQywJ14_G1freo18w@mail.gmail.com>

On 13 March 2017 at 22:18, Norbert Preining <preining at logic.at> wrote:
> You have an outdated format dump hanging around somewhere in your TEXMFVAR (~/.texlive2016/texmf-var)
>
> This was fixed in LaTeX kernel long time ago.
>
> Norbert

Not that it really matters but it's not that that was fixed, it's just
that the warning is reporting exactly what you state
that the input files are out of sync with the format. So the fix is to
not have an old format in the path, not anything
that changed in the kernel.

David

From bvoisin at me.com  Tue Mar 14 01:52:39 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 14 Mar 2017 01:52:39 +0100
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
Message-ID: <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>

> On 13 Mar 2017, at 23:18, Norbert Preining <preining at logic.at> wrote:
> 
> You have an outdated format dump hanging around somewhere in your TEXMFVAR (~/.texlive2016/texmf-var)
> 
> This was fixed in LaTeX kernel long time ago.

There really is no .fmt file in TEXMFVAR:

  $ kpsewhich -all -engine=/ lualatex.fmt
  /usr/local/texlive/2016/texmf-var/web2c/luatex/lualatex.fmt
  $ kpsewhich -all -engine=/ lualatex1.fmt
  /usr/local/texlive/2016/texmf-var/web2c/luatex/lualatex1.fmt

lualatex.fmt was built today using "sudo fmtutil-sys --byengine luatex", and lualatex1.fmt by running the instructions in your message of last night:

	tlmgr repository add http://www.preining.info/tlluatex-dev luatex-dev
	tlmgr pinning add luatex-dev '*'
	tlmgr install luatex-dev

So I compared to the two lualatex.log and lualatex1.log from TEXMFSYSVAR. The differences were interesting:

- From lualatex.log

  (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fonttext.cfg
  File: fonttext.cfg 2016/12/03 v3.0a LaTeX Kernel (Uncustomised text font setup)

- From lualatex1.log

  (/usr/local/texlive/2016/texmf-dist/tex/cslatex/base/fonttext.cfg
  File: fonttext.cfg 1997/08/20 CSLaTeX

After looking desperately for an explanation for 20 minutes or so, here it is:

  $ kpsewhich -progname=luatex fonttext.cfg
  /usr/local/texlive/2016/texmf-dist/tex/cslatex/base/fonttext.cfg

  $ kpsewhich -progname=lualatex fonttext.cfg
  /usr/local/texlive/2016/texmf-dist/tex/latex/base/fonttext.cfg

Accordingly, when compiling lualatex.fmt the LaTeX search path was used, but when compiling lualatex1.fmt it was the default (plain TeX) path.

After looking for 10 more minutes for an explanation and a fix, here's one that seems to work: add to texmf.cnf

  % LuaTeX-dev
  TEXINPUTS.luatex1        = .;$TEXMF/tex/{luatex,plain,generic,}//
  TEXINPUTS.luajittex1     = .;$TEXMF/tex/{luatex,plain,generic,}//
  TEXINPUTS.dviluatex1     = .;$TEXMF/tex/{luatex,plain,generic,}//
  TEXINPUTS.lualatex1      = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
  TEXINPUTS.luajitlatex1   = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
  TEXINPUTS.dvilualatex1   = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//

I put this in a texmf.cnf in the same bin directory as luatex-dev, but that should probably be written in the main texmf.cnf, same as for fmtutil.cnf.

Bruno

From preining at logic.at  Tue Mar 14 03:25:26 2017
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Mar 2017 11:25:26 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
 <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
Message-ID: <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>

Hi Bruno,

First of all, thanks for the finding of cslatex/fonttext issue.
This is indeed a problem.

I have updated fmtutil.pl to allow for overriding the -progname
switch in the fmtutil.cnf file. By now this was not possible.

THat means:
* tomorrow (didn't make it for today's update) texlive-scripts will
  be updated
* I will push a new release to the tlluatex-dev repository with
  the adjust fmtutil.cnf entries
* after that a rebuild of the formats should created the formats
  in the proper way.

I am still surprised that I didn't see this extra warning, so please
retry after the above procedure, and after removing the texmf.cnf
adjustments you made.

Thanks

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From preining at logic.at  Tue Mar 14 04:11:29 2017
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Mar 2017 12:11:29 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
 <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
 <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>
Message-ID: <20170314031129.fexyvjlr4fslwiop@bulldog.preining.info>

Hi Bruno, all

> * tomorrow (didn't make it for today's update) texlive-scripts will
>   be updated

Or just apply the following patch:
--- a/Master/texmf-dist/scripts/texlive/fmtutil.pl
+++ b/Master/texmf-dist/scripts/texlive/fmtutil.pl
@@ -568,7 +568,15 @@ sub rebuild_one_format {
     # all activated formats are also buildable, thus return failure.
     return $FMT_FAILURE;
   }
-  
+
+  #
+  # If the 4th field in fmtutil.cnf contains
+  #  -progname=...
+  # then we do not add our own progname!
+  if ($addargs =~ /-progname=/) {
+    $prgswitch = '';
+  }
+
   # NLS support
   #   Example (for fmtutil.cnf):
   #     mex-pl tex mexconf.tex nls=tex-pl,il2-pl mex.ini


> * I will push a new release to the tlluatex-dev repository with
>   the adjust fmtutil.cnf entries

Done. This also fixes the *1 scripts to set the proper -progname 
so that not only format generation, but also actual runs use
the correct search path.

> * after that a rebuild of the formats should created the formats
>   in the proper way.

	fmtutil-sys --by-engine luatex-dev
should be enough

All the best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From d.p.carlisle at gmail.com  Tue Mar 14 08:49:52 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Tue, 14 Mar 2017 07:49:52 +0000
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
 <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
Message-ID: <CAEW6iOgORErNmrLArsYMaymUHF-qQV7aaBEM5FT0Bb3RMZ=KNQ@mail.gmail.com>

oh that, sorry yes, Ulrike reported same for luajitlatex a few weeks ago

http://tug.org/pipermail/tex-live/2017-March/039775.html

As far as I understand, cslatex is a deprecated format anyway these days

texdoc cslatex starts off

> The CSLaTeX package is obsolete and it will be maintained no more.

It would probably be good if its fonttext.cfg could be moved somewhere
out of the main tex inputs tree
and only in the input path if someone really wants to build that format.

David






On 14 March 2017 at 00:52, Bruno Voisin <bvoisin at me.com> wrote:
>> On 13 Mar 2017, at 23:18, Norbert Preining <preining at logic.at> wrote:
>>
>> You have an outdated format dump hanging around somewhere in your TEXMFVAR (~/.texlive2016/texmf-var)
>>
>> This was fixed in LaTeX kernel long time ago.
>
> There really is no .fmt file in TEXMFVAR:
>
>   $ kpsewhich -all -engine=/ lualatex.fmt
>   /usr/local/texlive/2016/texmf-var/web2c/luatex/lualatex.fmt
>   $ kpsewhich -all -engine=/ lualatex1.fmt
>   /usr/local/texlive/2016/texmf-var/web2c/luatex/lualatex1.fmt
>
> lualatex.fmt was built today using "sudo fmtutil-sys --byengine luatex", and lualatex1.fmt by running the instructions in your message of last night:
>
>         tlmgr repository add http://www.preining.info/tlluatex-dev luatex-dev
>         tlmgr pinning add luatex-dev '*'
>         tlmgr install luatex-dev
>
> So I compared to the two lualatex.log and lualatex1.log from TEXMFSYSVAR. The differences were interesting:
>
> - From lualatex.log
>
>   (/usr/local/texlive/2016/texmf-dist/tex/latex/base/fonttext.cfg
>   File: fonttext.cfg 2016/12/03 v3.0a LaTeX Kernel (Uncustomised text font setup)
>
> - From lualatex1.log
>
>   (/usr/local/texlive/2016/texmf-dist/tex/cslatex/base/fonttext.cfg
>   File: fonttext.cfg 1997/08/20 CSLaTeX
>
> After looking desperately for an explanation for 20 minutes or so, here it is:
>
>   $ kpsewhich -progname=luatex fonttext.cfg
>   /usr/local/texlive/2016/texmf-dist/tex/cslatex/base/fonttext.cfg
>
>   $ kpsewhich -progname=lualatex fonttext.cfg
>   /usr/local/texlive/2016/texmf-dist/tex/latex/base/fonttext.cfg
>
> Accordingly, when compiling lualatex.fmt the LaTeX search path was used, but when compiling lualatex1.fmt it was the default (plain TeX) path.
>
> After looking for 10 more minutes for an explanation and a fix, here's one that seems to work: add to texmf.cnf
>
>   % LuaTeX-dev
>   TEXINPUTS.luatex1        = .;$TEXMF/tex/{luatex,plain,generic,}//
>   TEXINPUTS.luajittex1     = .;$TEXMF/tex/{luatex,plain,generic,}//
>   TEXINPUTS.dviluatex1     = .;$TEXMF/tex/{luatex,plain,generic,}//
>   TEXINPUTS.lualatex1      = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
>   TEXINPUTS.luajitlatex1   = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
>   TEXINPUTS.dvilualatex1   = .;$TEXMF/tex/{lualatex,latex,luatex,generic,}//
>
> I put this in a texmf.cnf in the same bin directory as luatex-dev, but that should probably be written in the main texmf.cnf, same as for fmtutil.cnf.
>
> Bruno

From kakuto at fuk.kindai.ac.jp  Tue Mar 14 10:56:55 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Tue, 14 Mar 2017 18:56:55 +0900
Subject: [luatex]  tlluatex-dev TeX Live Manager repository
Message-ID: <0C79A0D0F23E457384D93AAE4CA92BFB@CJ3001517A>

> fmtutil-sys --by-engine luatex-dev

fmtutil-sys --byengine luatex-dev  ?

Best,
Akira


From bvoisin at me.com  Tue Mar 14 12:17:40 2017
From: bvoisin at me.com (Bruno Voisin)
Date: Tue, 14 Mar 2017 12:17:40 +0100
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
 <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
 <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>
Message-ID: <016E9B2F-1095-4AEA-A85F-B3B20E0A044A@me.com>

> On 14 Mar 2017, at 03:25, Norbert Preining <preining at logic.at> wrote:
> 
> I am still surprised that I didn't see this extra warning, so please
> retry after the above procedure, and after removing the texmf.cnf
> adjustments you made.

Hi Norbert,

Yes everything works fine after going through the steps described in your second message (ie patching fmtutil.pl and updating luatex-dev from your repository): lualatex1.log shows the correct fonttext.cfg was read, and typesetting your LucidaMathOTProperties.tex yields no warning.

By the way, updating from your repo yields warnings about the package being unsigned (missing texlive.tlpdb.sha512.asc):

$ sudo tlmgr --repository http://www.preining.info/tlluatex-dev update luatex-dev
TLDownload::get_file: response error: 404 Not Found (for http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc)
TLUtils::download_file: persistent connection ok, but download failed: http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc
TLUtils::download_file: retrying with wget.
TLUtils::download_file: retry with wget failed: http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc
TLDownload::get_file: response error: 404 Not Found (for http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc)
TLUtils::download_file: persistent connection ok, but download failed: http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc
TLUtils::download_file: retrying with wget.
TLUtils::download_file: retry with wget failed: http://www.preining.info/tlluatex-dev/tlpkg/texlive.tlpdb.sha512.asc
tlmgr: package repository http://www.preining.info/tlluatex-dev (not verified: not signed)
tlmgr: saving backups to /usr/local/texlive/2016/tlpkg/backups
[1/2, ??:??/??:??] update: luatex-dev.x86_64-darwin [4664k] (1 -> 2) ... done
[2/2, 00:11/00:11] update: luatex-dev [1k] (1 -> 2) ... done
tlmgr: package log updated: /usr/local/texlive/2016/texmf-var/web2c/tlmgr.log
regenerating fmtutil.cnf in /usr/local/texlive/2016/texmf-dist
running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt luajittex1 ...
done running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt luajittex1.
running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt lualatex1 ...
done running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt lualatex1.
running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt dvilualatex1 ...
done running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt dvilualatex1.
running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt luatex1 ...
done running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt luatex1.
running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt dviluatex1 ...
done running fmtutil-sys --no-error-if-no-engine=luajittex,mfluajit --byfmt dviluatex1.

I don't know whether this comes from the repo, or some misconfiguration of my setup. Totally harmless in any case.

Bruno

From preining at logic.at  Tue Mar 14 12:34:14 2017
From: preining at logic.at (Norbert Preining)
Date: Tue, 14 Mar 2017 20:34:14 +0900
Subject: [luatex] tlluatex-dev TeX Live Manager repository
In-Reply-To: <016E9B2F-1095-4AEA-A85F-B3B20E0A044A@me.com>
References: <20170313030341.gf2zgv6bekylimhz@bulldog.preining.info>
 <035CA10F-9472-476A-8463-3C00C0E2E86C@me.com>
 <20170313154600.ffr6o3puixqto2wb@bulldog.preining.info>
 <770A34FB-62B9-4F00-93C8-6F032F064809@me.com>
 <C9E3EBFC-92AA-49A8-B5C7-6BE9BD2CCC28@logic.at>
 <5095881B-6EBE-4DD8-ADF9-42E6BF75ABF7@me.com>
 <20170314022526.y33v3crvpeyrc7ak@bulldog.preining.info>
 <016E9B2F-1095-4AEA-A85F-B3B20E0A044A@me.com>
Message-ID: <20170314113414.5ih7cfghtdyuy7g7@bulldog.preining.info>

Hi Bruno,

> Yes everything works fine

Good, thanks for checking.

> By the way, updating from your repo yields warnings about the package being unsigned (missing texlive.tlpdb.sha512.asc):

Fixed, didn't sign it by now. Now it is signed with by private key:

	wget -O - https://www.preining.info/preining-norbert.asc | tlmgr key add -

All the best

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From eduardoochs at gmail.com  Wed Mar 22 00:03:50 2017
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Tue, 21 Mar 2017 20:03:50 -0300
Subject: [luatex] luatex-0.95.0 on Debian: fmtutil problem
Message-ID: <CADs++6gK5KJ8g7Eeg_f06sSVaRoMOy9d8A-5tNOanrqsoCYdbw@mail.gmail.com>

Hi list,

I am trying to compile and use luatex-0.95.0 on a Debian variant -
Trisquel - but I am getting errors at the "fmtutil" step... the error
messages are quite clear but I couldn't find anything on how to build
LuaTeX in a way that makes it look for ".ini" files where Debian puts
them:

  /usr/share/texlive/texmf-dist/tex/latex/latexconfig/dvilualatex.ini
  /usr/share/texlive/texmf-dist/tex/latex/latexconfig/lualatex.ini
  /usr/share/texlive/texmf-dist/tex/plain/config/dviluatex.ini
  /usr/share/texlive/texmf-dist/tex/plain/config/luatex.ini

The script I used is below. I edited it for readability, but after
editing it I tested it a handful of times by sending it line by line
to an Emacs shell buffer to make sure that the bug remains...




# Compile.
# Note that the things in ~/snarf/ are local copies of:
# https://foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.doc.tar.xz
# https://foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
#
rm -Rv ~/usrc/luatex/
mkdir  ~/usrc/luatex/
cd     ~/usrc/luatex/
tar -xJvf ~/snarf/https/
foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.doc.tar.xz
tar -xJvf ~/snarf/https/
foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
cd     ~/usrc/luatex/0.95.0/
./build.sh

sudo mv -iv /usr/bin/luatex /usr/bin/luatex-orig
sudo rm -v  /usr/bin/luatex
ls -lAF    ~/usrc/luatex/0.95.0/build/texk/web2c/luatex
sudo cp -s ~/usrc/luatex/0.95.0/build/texk/web2c/luatex /usr/bin/luatex
fmtutil --byengine luatex
# fmtutil fails with the error message below:

# fmtutil: running `luatex -ini   -jobname=dviluatex -progname=dviluatex
dviluatex.ini' ...
# warning: kpathsea: configuration file texmf.cnf not found in these
directories:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf/web2c:
#   /home/edrx/usrc/luatex/0.95.0/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build:
#   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/share/texmf/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texmf-local/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texmf-dist/web2c:
#   /home/edrx/usrc/luatex/0.95.0/build/texmf/web2c.
# This is LuaTeX, Version 0.95.0 (TeX Live 2016)  (INITEX)
# ! I can't find file `dviluatex.ini'.
# <*> dviluatex.ini
#
# (Press Enter to retry, or Control-D to exit)
# Please type another input file name:
# ! Emergency stop.
# <*> dviluatex.ini
#
# !  ==> Fatal error occurred, bad output DVI file produced!
# No pages of output.
# Transcript written on dviluatex.log.

# Revert to the Debian LuaTeX.
#
ls -lAF /usr/bin/luatex*
sudo rm -v  /usr/bin/luatex
sudo mv -iv /usr/bin/luatex-orig /usr/bin/luatex
fmtutil --byengine luatex



  Cheers & thanks in advance,
  (and sorry if I missed something obvious =\),
    Eduardo Ochs
    http://angg.twu.net/
    eduardoochs at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20170321/e842781c/attachment.html>

From norbert at preining.info  Wed Mar 22 03:26:37 2017
From: norbert at preining.info (Norbert Preining)
Date: Wed, 22 Mar 2017 11:26:37 +0900
Subject: [luatex] luatex-0.95.0 on Debian: fmtutil problem
In-Reply-To: <CADs++6gK5KJ8g7Eeg_f06sSVaRoMOy9d8A-5tNOanrqsoCYdbw@mail.gmail.com>
References: <CADs++6gK5KJ8g7Eeg_f06sSVaRoMOy9d8A-5tNOanrqsoCYdbw@mail.gmail.com>
Message-ID: <20170322022637.bvv36iolxgb4sltu@bulldog.preining.info>

On Tue, 21 Mar 2017, Eduardo Ochs wrote:
> foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
> ./build.sh
> sudo mv -iv /usr/bin/luatex /usr/bin/luatex-orig
> sudo rm -v  /usr/bin/luatex

That does not work...

> # warning: kpathsea: configuration file texmf.cnf not found in these
> directories:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build:
> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texmf-local/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texmf-dist/web2c:
> #   /home/edrx/usrc/luatex/0.95.0/build/texmf/web2c.

To set up the whol kpathsea library, any program using kpathsea first
needs to find an *initial* texmf.cnf.

The program code hard codes several paths, as you see above, but none
of them coincides with the path in Debian/TeX Live.

Because binaries and the respective share/texlive dirs are not laid out
as expected by kpathsea (which practically expects an installation of
TeX Live  ROOT/bin ROOT/texmf-dist ..), I apply the following patch
during building of the binaries, including luatex:
https://anonscm.debian.org/cgit/debian-tex/texlive-bin.git/tree/debian/patches/debian-builtin-searchpath

If you want to do it without patching, you need to add a
texmf.cnf *in* /usr/bin (link to the one in texmf-dist/web2c/ should
suffice).

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From eduardoochs at gmail.com  Thu Mar 23 07:14:23 2017
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Thu, 23 Mar 2017 03:14:23 -0300
Subject: [luatex] luatex-0.95.0 on Debian: fmtutil problem
In-Reply-To: <20170322022637.bvv36iolxgb4sltu@bulldog.preining.info>
References: <CADs++6gK5KJ8g7Eeg_f06sSVaRoMOy9d8A-5tNOanrqsoCYdbw@mail.gmail.com>
 <20170322022637.bvv36iolxgb4sltu@bulldog.preining.info>
Message-ID: <CADs++6ig8R=EhL3zExO8=+PUpPKOpCtGgy4FSO7U8z8rxdM7Mg@mail.gmail.com>

Hi Norbert,

On Tue, Mar 21, 2017 at 11:26 PM, Norbert Preining
<norbert at preining.info> wrote:
> On Tue, 21 Mar 2017, Eduardo Ochs wrote:
>> foundry.supelec.fr/frs/download.php/latestfile/6/0.95.0.tar.xz
>> ./build.sh
>> sudo mv -iv /usr/bin/luatex /usr/bin/luatex-orig
>> sudo rm -v  /usr/bin/luatex
>
> That does not work...
>
>> # warning: kpathsea: configuration file texmf.cnf not found in these
>> directories:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/share/texmf/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/web2c/texmf/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/share/texmf/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texk/texmf/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build:
>> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/share/texmf/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texmf-local/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texmf-dist/web2c:
>> #   /home/edrx/usrc/luatex/0.95.0/build/texmf/web2c.
>
> To set up the whol kpathsea library, any program using kpathsea first
> needs to find an *initial* texmf.cnf.
>
> The program code hard codes several paths, as you see above, but none
> of them coincides with the path in Debian/TeX Live.
>
> Because binaries and the respective share/texlive dirs are not laid out
> as expected by kpathsea (which practically expects an installation of
> TeX Live  ROOT/bin ROOT/texmf-dist ..), I apply the following patch
> during building of the binaries, including luatex:
> https://anonscm.debian.org/cgit/debian-tex/texlive-bin.git/tree/debian/patches/debian-builtin-searchpath
>
> If you want to do it without patching, you need to add a
> texmf.cnf *in* /usr/bin (link to the one in texmf-dist/web2c/ should
> suffice).

This - a slight modification of your first suggestion - made
the luatex-0.95.0 binary in /usr/bin/ able to access texmf.cnf:

  cp -s /usr/share/texlive/texmf-dist/web2c/texmf.cnf \
        ~/usrc/luatex/0.95.0/build/

However, when I run

  fmtutil --byengine luatex

it says this, and aborts:

  fmtutil: running `luatex -ini   -jobname=dviluatex
-progname=dviluatex dviluatex.ini' ...
  (...)
  fmtutil: /home/edrx/.texmf-var/web2c/luatex/dviluatex.fmt installed.
  fmtutil: running `luatex -ini   -jobname=luatex -progname=luatex
luatex.ini' ...
  This is LuaTeX, Version 0.95.0 (TeX Live 2016)  (INITEX)
   restricted system commands enabled.
  (/usr/share/texlive/texmf-dist/tex/plain/config/luatex.ini
  (/usr/share/texlive/texmf-dist/tex/generic/config/luatexiniconfig.tex)
  (/usr/share/texlive/texmf-dist/tex/generic/config/luatex-unicode-letters.tex
  loading Unicode properties)
  (/usr/share/texlive/texmf-dist/tex/plain/config/pdfetex.ini
  (/usr/share/texlive/texmf-dist/tex/generic/config/pdftexconfig.tex
  ! Undefined control sequence.
  l.3 \pdfoutput
              =1
  ?
  ! Emergency stop.
  l.3 \pdfoutput
              =1
  !  ==> Fatal error occurred, bad output DVI file produced!
  No pages of output.
  Transcript written on luatex.log.


It seems that I need to change luatex.ini, or one of the files it
"\input"s, to make it run something like the compatibility code in the
section "2.1.7 The backend primitives \pdf *" of the manual, because
recent luatexes have fewer "\pdf*" primitives that the luatex in
Debian...

Is there a standard way to do that? Where can I find the ".ini"s for
recent luatexes?

  Cheers & thanks,
    Eduardo Ochs
    eduardoochs at gmail.com
    http://angg.twu.net/
    http://angg.twu.net/LATEX/2017planar-has.pdf

From norbert at preining.info  Thu Mar 23 07:30:57 2017
From: norbert at preining.info (Norbert Preining)
Date: Thu, 23 Mar 2017 15:30:57 +0900
Subject: [luatex] luatex-0.95.0 on Debian: fmtutil problem
In-Reply-To: <CADs++6ig8R=EhL3zExO8=+PUpPKOpCtGgy4FSO7U8z8rxdM7Mg@mail.gmail.com>
References: <CADs++6gK5KJ8g7Eeg_f06sSVaRoMOy9d8A-5tNOanrqsoCYdbw@mail.gmail.com>
 <20170322022637.bvv36iolxgb4sltu@bulldog.preining.info>
 <CADs++6ig8R=EhL3zExO8=+PUpPKOpCtGgy4FSO7U8z8rxdM7Mg@mail.gmail.com>
Message-ID: <20170323063057.kcgahnxamqjiz3uw@bulldog.preining.info>

HI Eduardo,

> This - a slight modification of your first suggestion - made
> the luatex-0.95.0 binary in /usr/bin/ able to access texmf.cnf:
> 
>   cp -s /usr/share/texlive/texmf-dist/web2c/texmf.cnf \
>         ~/usrc/luatex/0.95.0/build/

Ugg, that is ugly. You want to remove the build directory
at some point, right?

> However, when I run
> 
>   fmtutil --byengine luatex

First of all, you should quite probably *no* use fmtutil but
fmtutil-sys ... 

>   (/usr/share/texlive/texmf-dist/tex/plain/config/luatex.ini

Where does this file come from? Which Debian are you working on?
I have that file in
	/usr/share/texlive/texmf-dist/tex/generic/tex-ini-files/luatex.ini

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From joseph.wright at morningstar2.co.uk  Tue Mar 28 13:25:26 2017
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 28 Mar 2017 12:25:26 +0100
Subject: [luatex] Odd Lua issue with ^^@
Message-ID: <deaf7213-bc4d-5dbd-2d97-15186e18978f@morningstar2.co.uk>

Hello all,

Testing with LuaTeX v1.04 (using the W32TeX build in my case) I find an
oddity with the handling of ^^@ (null) at the 'Lua side' (for scripting
some tests). The attached demo document reads

    ....\T1/cmr/m/n/10 ^@
    ....\kern -5.13763 (for accent)

(with null shown Vim-style as ^@). Up to recent LuaTeX builds, a script
such as

    for line in io.lines("test.txt") do
      print(string.gsub(line, string.char(0), "^^" .. string.char(64)))
    end

can read that file and output the expected two lines

    ....\T1/cmr/m/n/10 ^^@
    ....\kern -5.13763 (for accent)

However, with the v1.04 build I get only a single line

    ....\T1/cmr/m/n/10 ....\kern -5.13763 (for accent)

Does anyone know if this is a deliberate change in Lua or if something
else is wrong? Lua normally treats bytes including ^^@ 'equally'.

Joseph
-------------- next part --------------
....\T1/cmr/m/n/10  
....\kern -5.13763 (for accent)
-------------- next part --------------
for line in io.lines("temp.txt") do
  print((string.gsub(line, string.char(0), "^^" .. string.char(64))))
end

From luigi.scarso at gmail.com  Tue Mar 28 19:55:37 2017
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Mar 2017 19:55:37 +0200
Subject: [luatex] Odd Lua issue with ^^@
In-Reply-To: <deaf7213-bc4d-5dbd-2d97-15186e18978f@morningstar2.co.uk>
References: <deaf7213-bc4d-5dbd-2d97-15186e18978f@morningstar2.co.uk>
Message-ID: <CAG5iGsBkbfwQFJCSH_Cu6gHUXJ-3miEN9Grc6Jdhd6CLtU2MYg@mail.gmail.com>

On Tue, Mar 28, 2017 at 1:25 PM, Joseph Wright
<joseph.wright at morningstar2.co.uk> wrote:
> Hello all,
>
> Testing with LuaTeX v1.04 (using the W32TeX build in my case) I find an
> oddity with the handling of ^^@ (null) at the 'Lua side' (for scripting
> some tests). The attached demo document reads
>
>     ....\T1/cmr/m/n/10 ^@
>     ....\kern -5.13763 (for accent)
>
> (with null shown Vim-style as ^@). Up to recent LuaTeX builds, a script
> such as
>
>     for line in io.lines("test.txt") do
>       print(string.gsub(line, string.char(0), "^^" .. string.char(64)))
>     end
>
> can read that file and output the expected two lines
>
>     ....\T1/cmr/m/n/10 ^^@
>     ....\kern -5.13763 (for accent)
>
> However, with the v1.04 build I get only a single line
>
>     ....\T1/cmr/m/n/10 ....\kern -5.13763 (for accent)
>
> Does anyone know if this is a deliberate change in Lua or if something
> else is wrong? Lua normally treats bytes including ^^@ 'equally'.
>
> Joseph
Latest two months we have made a cleanup of the lua libs part, so I
guess that it's a side effect.
Lua 5.2.4 and luatex 1.0.4 now give the same output and  before we
didn't notice the difference.



-- 
luigi

From joseph.wright at morningstar2.co.uk  Tue Mar 28 22:18:55 2017
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 28 Mar 2017 21:18:55 +0100
Subject: [luatex] Odd Lua issue with ^^@
In-Reply-To: <CAG5iGsBkbfwQFJCSH_Cu6gHUXJ-3miEN9Grc6Jdhd6CLtU2MYg@mail.gmail.com>
References: <deaf7213-bc4d-5dbd-2d97-15186e18978f@morningstar2.co.uk>
 <CAG5iGsBkbfwQFJCSH_Cu6gHUXJ-3miEN9Grc6Jdhd6CLtU2MYg@mail.gmail.com>
Message-ID: <3bc6e9bb-4466-2557-0dfe-c83fa3a8c971@morningstar2.co.uk>

On 28/03/2017 18:55, luigi scarso wrote:
> Latest two months we have made a cleanup of the lua libs part, so I
> guess that it's a side effect.
> Lua 5.2.4 and luatex 1.0.4 now give the same output and  before we
> didn't notice the difference.

OK, if this is 'to be expected' I guess I'll work around it (there are a
few possible approaches).

Joseph

From kakuto at fuk.kindai.ac.jp  Wed Mar 29 10:36:37 2017
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Wed, 29 Mar 2017 17:36:37 +0900
Subject: [luatex]  Odd Lua issue with ^^@
Message-ID: <05CE2E4FA84048DFB3268F1339578B03@CJ3001517A>

> ....\T1/cmr/m/n/10 ^@
> ....\kern -5.13763 (for accent)

Previously we were using static int read_line() by Taco.
Now we are using one in lua 5.2.4, where there is a line:
l = strlen(p);
Probably this seems to be a reason of the difference.

Best,
Akira


From joseph.wright at morningstar2.co.uk  Wed Mar 29 10:51:50 2017
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 29 Mar 2017 09:51:50 +0100
Subject: [luatex] Odd Lua issue with ^^@
In-Reply-To: <05CE2E4FA84048DFB3268F1339578B03@CJ3001517A>
References: <05CE2E4FA84048DFB3268F1339578B03@CJ3001517A>
Message-ID: <85d4d16a-3b6d-50b6-6356-b2ba040cfed5@morningstar2.co.uk>

On 29/03/2017 09:36, Akira Kakuto wrote:
>> ....\T1/cmr/m/n/10 ^@
>> ....\kern -5.13763 (for accent)
> 
> Previously we were using static int read_line() by Taco.
> Now we are using one in lua 5.2.4, where there is a line:
> l = strlen(p);
> Probably this seems to be a reason of the difference.
> 
> Best,
> Akira

All understood (David C. has tracked down an 'interesting' discussion of
the handling of ^^@ when reading files in pure Lua).

As I said in reply to Luigi, I'll adjust the script concerned to allow
for this change.

Joseph


From d.p.carlisle at gmail.com  Wed Mar 29 13:57:55 2017
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 29 Mar 2017 12:57:55 +0100
Subject: [luatex] Odd Lua issue with ^^@
In-Reply-To: <85d4d16a-3b6d-50b6-6356-b2ba040cfed5@morningstar2.co.uk>
References: <05CE2E4FA84048DFB3268F1339578B03@CJ3001517A>
 <85d4d16a-3b6d-50b6-6356-b2ba040cfed5@morningstar2.co.uk>
Message-ID: <CAEW6iOh15Toru3YsgHJTL+4aqTKkUZaoUCFsRGS5mX1tW2e1Hw@mail.gmail.com>

On 29 March 2017 at 09:51, Joseph Wright
<joseph.wright at morningstar2.co.uk> wrote:
> On 29/03/2017 09:36, Akira Kakuto wrote:
>>> ....\T1/cmr/m/n/10 ^@
>>> ....\kern -5.13763 (for accent)
>>
>> Previously we were using static int read_line() by Taco.
>> Now we are using one in lua 5.2.4, where there is a line:
>> l = strlen(p);
>> Probably this seems to be a reason of the difference.
>>
>> Best,
>> Akira
>
> All understood (David C. has tracked down an 'interesting' discussion of
> the handling of ^^@ when reading files in pure Lua).


See

http://lua-users.org/lists/lua-l/2014-02/threads.html#00159

(quite a long thread:-)

>
> As I said in reply to Luigi, I'll adjust the script concerned to allow
> for this change.
>
> Joseph
>

