From loretan.mico at gmail.com  Fri Oct  2 09:42:22 2015
From: loretan.mico at gmail.com (Mico Loretan)
Date: Fri, 2 Oct 2015 09:42:22 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
	2^(63)-1?
Message-ID: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>

Greetings!

It is well known that TeX?s count registers, \count0 thru \count255, have a range of 2^32 integers (from -2^31 thru 2^31-1). 

Lua 5.3, released in January 2015, introduced an explicit integer numeric type. Integers are now stored and processed as 64-bit items. If and when LuaTeX switches from Lua 5.2 to 5.3, will the range of permissible integers in TeX counters be expanded from 2^32 to 2^64, so that they can range from 2^(-63) to 2^63-1? Just curious.

Best, Mico



From pragma at wxs.nl  Fri Oct  2 17:11:35 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 2 Oct 2015 17:11:35 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
Message-ID: <560E9EA7.4010406@wxs.nl>

On 10/2/2015 9:42 AM, Mico Loretan wrote:
> Greetings!
>
> It is well known that TeX?s count registers, \count0 thru \count255, have a range of 2^32 integers (from -2^31 thru 2^31-1).
>
> Lua 5.3, released in January 2015, introduced an explicit integer numeric type. Integers are now stored and processed as 64-bit items. If and when LuaTeX switches from Lua 5.2 to 5.3, will the range of permissible integers in TeX counters be expanded from 2^32 to 2^64, so that they can range from 2^(-63) to 2^63-1? Just curious.

that's very unlikely as internally those ranges are often part of a 
larger type (and when one needs that many counters one should probably 
reconsider the code and use lua tables for storing numbers instead)

going 64 bit internally in tex would mean a lot of checking and patching 
of code

also, we're not sure if we move to 5.3 anyway

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Sat Oct  3 03:06:19 2015
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 3 Oct 2015 03:06:19 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <560E9EA7.4010406@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>
Message-ID: <22031.10763.680030.803059@zaphod.ms25.net>

On 2015-10-02 at 17:11:35 +0200, Hans Hagen wrote:

 > going 64 bit internally in tex would mean a lot of checking and
 > patching of code

Does it really matter whether a user specifies a number which is too
large in his TeX input file or whether such a number comes from Lua?

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From pragma at wxs.nl  Sun Oct  4 00:36:08 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 4 Oct 2015 00:36:08 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <22031.10763.680030.803059@zaphod.ms25.net>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
Message-ID: <56105858.5070203@wxs.nl>

On 10/3/2015 3:06 AM, Reinhard Kotucha wrote:
> On 2015-10-02 at 17:11:35 +0200, Hans Hagen wrote:
>
>   > going 64 bit internally in tex would mean a lot of checking and
>   > patching of code
>
> Does it really matter whether a user specifies a number which is too
> large in his TeX input file or whether such a number comes from Lua?

hard to say but sometimes tex packs data together so casts happen (many 
internals are so called halfwords)

(also tex's maxdimen etc checks kick in)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Sun Oct  4 04:57:29 2015
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 4 Oct 2015 04:57:29 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <56105858.5070203@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>	<22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl>
Message-ID: <22032.38297.127059.511422@zaphod.ms25.net>

On 2015-10-04 at 00:36:08 +0200, Hans Hagen wrote:

 > On 10/3/2015 3:06 AM, Reinhard Kotucha wrote:
 > > On 2015-10-02 at 17:11:35 +0200, Hans Hagen wrote:
 > >
 > >   > going 64 bit internally in tex would mean a lot of checking and
 > >   > patching of code
 > >
 > > Does it really matter whether a user specifies a number which is too
 > > large in his TeX input file or whether such a number comes from Lua?
 > 
 > hard to say but sometimes tex packs data together so casts happen (many 
 > internals are so called halfwords)

Sure, but a number in a TeX input file is a string and TeX has to
convert it to a number.  Maybe it's possible to convert a Lua number
to a string and feed it to TeX at a point where TeX expects a string,
i.e. before TeX converts strings to numbers.  It doesn't matter then
how TeX stores numbers internally. 

I must admit that it's difficult to decide whether 64 bit numbers are
useful or not.  But it would certainly be annoying if texlua can't
read the xref table of a PDF file (10^{10} > 2^{32}).  This seems to
work even with Lua 5.1 on a 64 bit system but numbers with more than
14 decimal digits are converted to floating point numbers.

 | $ lua
 | Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
 | > x=12345678901234
 | > print (tonumber (x))
 | 12345678901234
 | > x=123456789012345
 | > print (tonumber (x))
 | 1.2345678901234e+14

Can anybody confirm that the output is the same on a 32 bit system?

It's clear to me that Lua has to be frozen in LuaTeX former or later.
But since LuaTeX can be considered "not stable" ATM I think that
changes can be made more easily ATM rather than later.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From jilani at vindex.me  Sun Oct  4 09:52:59 2015
From: jilani at vindex.me (Jilani KHALDI)
Date: Sun, 4 Oct 2015 09:52:59 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <22032.38297.127059.511422@zaphod.ms25.net>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
Message-ID: <5610DADB.4000508@vindex.me>

> It's clear to me that Lua has to be frozen in LuaTeX former or later.
Why? Who has decided this?

-- 
Jilani KHALDI
www.vindex.me

From pragma at wxs.nl  Sun Oct  4 11:07:26 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 4 Oct 2015 11:07:26 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <5610DADB.4000508@vindex.me>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610DADB.4000508@vindex.me>
Message-ID: <5610EC4E.4060701@wxs.nl>

On 10/4/2015 9:52 AM, Jilani KHALDI wrote:
>> It's clear to me that Lua has to be frozen in LuaTeX former or later.
> Why? Who has decided this?

We, the team, will decide that at some point ... we will do experiments 
with 5.3 and see how that affects stability. The < 5.2 model is quite 
predictable, i.e. all floats in lua and all integers in tex, while the 
hybrid lua number model might result in integers becoming floats or not 
(so one has to be more careful with division / rounding / casting etc).

So we're not in that hurry, and if we go for 5.3 we might wait a few 
revisions before it ends up in the yearly tex live stable.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Oct  4 11:14:30 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 4 Oct 2015 11:14:30 +0200
Subject: [luatex] Will the next version of LuaTeX allow integer up to
 2^(63)-1?
In-Reply-To: <22032.38297.127059.511422@zaphod.ms25.net>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
Message-ID: <5610EDF6.9010306@wxs.nl>

On 10/4/2015 4:57 AM, Reinhard Kotucha wrote:
> On 2015-10-04 at 00:36:08 +0200, Hans Hagen wrote:
>
>   > On 10/3/2015 3:06 AM, Reinhard Kotucha wrote:
>   > > On 2015-10-02 at 17:11:35 +0200, Hans Hagen wrote:
>   > >
>   > >   > going 64 bit internally in tex would mean a lot of checking and
>   > >   > patching of code
>   > >
>   > > Does it really matter whether a user specifies a number which is too
>   > > large in his TeX input file or whether such a number comes from Lua?
>   >
>   > hard to say but sometimes tex packs data together so casts happen (many
>   > internals are so called halfwords)
>
> Sure, but a number in a TeX input file is a string and TeX has to
> convert it to a number.  Maybe it's possible to convert a Lua number
> to a string and feed it to TeX at a point where TeX expects a string,
> i.e. before TeX converts strings to numbers.  It doesn't matter then
> how TeX stores numbers internally.

normally one would separate that: so we can have 64 bit at te lua end 
and tex still being 32 bit (with truncated casts) .. one can already use 
the token parser to pick up any sequence of characters and pass that to 
lua and back ... so one can then store 64 bit numbers in lua instead of 
in counters

> I must admit that it's difficult to decide whether 64 bit numbers are
> useful or not.  But it would certainly be annoying if texlua can't
> read the xref table of a PDF file (10^{10} > 2^{32}).  This seems to
> work even with Lua 5.1 on a 64 bit system but numbers with more than
> 14 decimal digits are converted to floating point numbers.

it's mostly that one needs to deal with cases like

123 / 2.0

vs

123 / 2

so all existing usage of lua (in macro packages) needs to be checked 
when we move to 5.3

another option is 5.2 using metapost number libraries

>   | $ lua
>   | Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
>   | > x=12345678901234
>   | > print (tonumber (x))
>   | 12345678901234
>   | > x=123456789012345
>   | > print (tonumber (x))
>   | 1.2345678901234e+14
>
> Can anybody confirm that the output is the same on a 32 bit system?
>
> It's clear to me that Lua has to be frozen in LuaTeX former or later.
> But since LuaTeX can be considered "not stable" ATM I think that
> changes can be made more easily ATM rather than later.

sure, we will decide before we end up with 1.0 (after which we can again 
experiment till 2.0, so maybe 5.3 is for luatex 2.0 as we can then adapt 
some of tex internals)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Oct  6 16:55:29 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 6 Oct 2015 16:55:29 +0200
Subject: [luatex] upcoming release
In-Reply-To: <5610EDF6.9010306@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl>
Message-ID: <5613E0E1.4000509@wxs.nl>

Hi,

One of these days we're going to release 0.80.1 and in addition to some 
fixes there also has been some cleanups (more to come).

A couple of primitives are removed, renamed and/or promoted to core 
(luatex) primitives. Here's a summary. It might demand some adaption in 
the way macro packages initialize so we will mention them here 
explicitly in advance. As shown below, a simple way to get backward 
compatibility is to \let old ones to new ones. So,

    Updating to this version also might demand an update in the
    macro package that you use!

Here we go:

% removed, can be done with callbacks if needed, one can define dimen 
dummies, like

\newdimen\pdfeachlineheight
\newdimen\pdfeachlinedepth
\newdimen\pdflastlinedepth
\newdimen\pdffirstlineheight
\newdimen\pdfignoreddimen

% removed, were already obsolete, one can \let them

\let\pdftexversion \luatexversion
\let\pdftexrevision\luatexrevision
\let\pdftexbanner  \luatexbanner

% promoted (from pdftex), so pdf prefix gone, one can \let them

\let\pdfnormaldeviate \normaldeviate
\let\pdfuniformdeviate\uniformdeviate
\let\pdfsetrandomseed \setrandomseed
\let\pdfrandomseed    \randomseed

% promoted (from omega), so pdf prefix gone, one can \let them

\let\pdfpagewidth \pagewidth
\let\pdfpageheight\pageheight

% redundant (etex wins over omega), so \font-less ones gone, one can 
\let them

\let\chardp\fontchardp
\let\charht\fontcharht
\let\charit\fontcharit
\let\charwd\fontcharwd

% promoted (from aleph)

\pagerightoffset
\pagebottomoffset

% promoted (from pdftex)

\ifincsname
\expanded
\quitvmode

% removed (from pdftex), so *pdf* ones gone, one can \let them

\let\ifpdfabsnum   \ifabsnum
\let\ifpdfabsdim   \ifabsdim
\let\ifpdfprimitive\ifprimitive
\let\pdfprimitive  \primitive

% promoted (from omega)

\pagedir
\bodydir
\pardir
\textdir
\mathdir

% promoted (from aleph)

\boxdir

% promoted (from pdftex)

\lpcode
\rpcode
\efcode
\leftmarginkern
\rightmarginkern

\tagcode
\letterspacefont

% promoted (from pdftex), so *pdf* ones gone, one can \let them

\let\pdfprotrudechars\protrudechars
\let\pdfadjustspacing\adjustspacing

\let\pdfnoligatures  \ignoreligaturesinfont
\let\pdffontexpand   \expandglyphsinfont

% promoted (from pdftex), so *pdf* ones gone, one can \let them

\let\pdfsavepos \savepos
\let\pdflastxpos\lastxpos
\let\pdflastypos\lastypos

% on the todo list are:

\pdfoutput         : \outputmode
\pdfmatrix         : will get a normal syntax, no weird { } parsing

\pdfcolorstackinit : might become obsolete
\pdfcolorstack     : might become obsolete

So, apart from a few, the \pdf* primitives now relate to the backend only.

% There is also a new primitive:

\hyphenationmin

This one determines the minimum word length (per language). At the same 
time we moved the (ex)hyphenpenalties in the disc nodes so you can 
inject discretionaries with specific penalties.

There will also be an updated manual.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Tue Oct  6 17:26:52 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Tue, 6 Oct 2015 16:26:52 +0100
Subject: [luatex] upcoming release
In-Reply-To: <5613E0E1.4000509@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>	<22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl>	<22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl>	<5613E0E1.4000509@wxs.nl>
Message-ID: <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>

On 6 October 2015 at 15:55, Hans Hagen <pragma at wxs.nl> wrote:
> Hi,
>
> One of these days we're going to release 0.80.1 and in addition to some

Hans,
thanks for the heads up, can you give an indication of whether that's
"one day this week" or "one day before the end of the year" or ...

Mostly the changes were already flagged as likely in the existing manual
or in conversations so no real surprises but would be good to know how
long we have to plan the transition.

I just did a quick grep of my local tree for \pdfpagewidth and something
in the order of 50 contributed packages use it
(not sure how many are usable with lualatex, but most, probably)

so either we need to update the format as you suggested with a \let
aliasing the old name, or we need to start a round of contacting authors
and getting updates in place for the transition.

Either is possible but before deciding which, it might be good to know
how long we have:-)

David

From pragma at wxs.nl  Tue Oct  6 17:44:46 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 6 Oct 2015 17:44:46 +0200
Subject: [luatex] upcoming release
In-Reply-To: <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
 <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
Message-ID: <5613EC6E.4020805@wxs.nl>

On 10/6/2015 5:26 PM, David Carlisle wrote:

> so either we need to update the format as you suggested with a \let
> aliasing the old name, or we need to start a round of contacting authors
> and getting updates in place for the transition.
>
> Either is possible but before deciding which, it might be good to know
> how long we have:-)

probably the \let approach is best in a distributed dev environment like 
yours (as it gives authors some time to adapt)

i assume that a macro package gets updated before a new luatex shows up 
(i'm not not sure what the policy is with latex, but most users will 
probably stick to tex live updates so that gives you some time)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Tue Oct  6 17:46:56 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 6 Oct 2015 17:46:56 +0200
Subject: [luatex] upcoming release
In-Reply-To: <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>	<22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl>	<22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl>	<5613E0E1.4000509@wxs.nl>
 <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
Message-ID: <CAG5iGsDoFyPVHjQdAA-=jC7r4NB071hr6ZCfVgKEUXXNL0c0mg@mail.gmail.com>

On Tue, Oct 6, 2015 at 5:26 PM, David Carlisle <d.p.carlisle at gmail.com>
wrote:

> On 6 October 2015 at 15:55, Hans Hagen <pragma at wxs.nl> wrote:
> > Hi,
> >
> > One of these days we're going to release 0.80.1 and in addition to some
>
> Hans,
> thanks for the heads up, can you give an indication of whether that's
> "one day this week" or "one day before the end of the year" or ...
>
> The current trunk is "almost" the next beta 0.80.1 .  We are checking some
things ---
there is a part of code of metapost that is still old, I think I will
update it today or tomorrow at max.
Bugfixes can happen as usual, of course.






-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151006/3019ffe7/attachment.html>

From joseph.wright at morningstar2.co.uk  Tue Oct  6 17:54:57 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 6 Oct 2015 16:54:57 +0100
Subject: [luatex] upcoming release
In-Reply-To: <5613EC6E.4020805@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
 <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
 <5613EC6E.4020805@wxs.nl>
Message-ID: <5613EED1.6060507@morningstar2.co.uk>

On 06/10/2015 16:44, Hans Hagen wrote:
> On 10/6/2015 5:26 PM, David Carlisle wrote:
> 
>> so either we need to update the format as you suggested with a \let
>> aliasing the old name, or we need to start a round of contacting authors
>> and getting updates in place for the transition.
>>
>> Either is possible but before deciding which, it might be good to know
>> how long we have:-)
> 
> probably the \let approach is best in a distributed dev environment like
> yours (as it gives authors some time to adapt)
> 
> i assume that a macro package gets updated before a new luatex shows up
> (i'm not not sure what the policy is with latex, but most users will
> probably stick to tex live updates so that gives you some time)
> 
> Hans

For TeX Live users, binary updates (essentially) only happen once per
year at release time, so probably something like April/May before any
change. (Someone from the TL team will doubtless comment on that). For
MiKTeX users the timetable is not so rigid though it's still not going
to happen 'immediately' following a code update.

Joseph


From joseph.wright at morningstar2.co.uk  Tue Oct  6 18:08:10 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 6 Oct 2015 17:08:10 +0100
Subject: [luatex] upcoming release
In-Reply-To: <5613E0E1.4000509@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
Message-ID: <5613F1EA.9070109@morningstar2.co.uk>

On 06/10/2015 15:55, Hans Hagen wrote:
> % promoted (from omega)
> 
> \pagedir
> \bodydir
> \pardir
> \textdir
> \mathdir
> 
> % promoted (from aleph)
> 
> \boxdir
> 
> % promoted (from pdftex)
> 
> \lpcode
> \rpcode
> \efcode
> \leftmarginkern
> \rightmarginkern
> 
> \tagcode
> \letterspacefont

Hi Hans,

As David said, thanks for the heads-up: very useful. Does 'promoted' in
the above mean that these are moved in the lists given for example by
tex.extraprimitives?

Joseph


From pragma at wxs.nl  Tue Oct  6 19:08:31 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 6 Oct 2015 19:08:31 +0200
Subject: [luatex] upcoming release
In-Reply-To: <5613F1EA.9070109@morningstar2.co.uk>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
 <5613F1EA.9070109@morningstar2.co.uk>
Message-ID: <5614000F.60105@wxs.nl>

On 10/6/2015 6:08 PM, Joseph Wright wrote:
> On 06/10/2015 15:55, Hans Hagen wrote:
>> % promoted (from omega)
>>
>> \pagedir
>> \bodydir
>> \pardir
>> \textdir
>> \mathdir
>>
>> % promoted (from aleph)
>>
>> \boxdir
>>
>> % promoted (from pdftex)
>>
>> \lpcode
>> \rpcode
>> \efcode
>> \leftmarginkern
>> \rightmarginkern
>>
>> \tagcode
>> \letterspacefont
>
> Hi Hans,
>
> As David said, thanks for the heads-up: very useful. Does 'promoted' in
> the above mean that these are moved in the lists given for example by
> tex.extraprimitives?

indeed, they end up in the luatex category, so the omega and aleph 
categories are gone and the pdftex category has less

Hans




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From martin at oneiros.de  Tue Oct  6 19:12:55 2015
From: martin at oneiros.de (=?UTF-8?Q?Martin_Schr=C3=B6der?=)
Date: Tue, 6 Oct 2015 19:12:55 +0200
Subject: [luatex] upcoming release
In-Reply-To: <5613E0E1.4000509@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>	<22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl>	<22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl>	<5613E0E1.4000509@wxs.nl>
Message-ID: <CAP7DCDdsnk2Nk5EyaEdRNLA-Q6_TbeXS++m_Vww_n7c0jDouyw@mail.gmail.com>

2015-10-06 16:55 GMT+02:00 Hans Hagen <pragma at wxs.nl>:
> One of these days we're going to release 0.80.1 and in addition to some

Why will it be 0.80.1 and not 0.81.0?

Best
   Martin

From pragma at wxs.nl  Tue Oct  6 21:27:13 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 6 Oct 2015 21:27:13 +0200
Subject: [luatex] upcoming release
In-Reply-To: <CAP7DCDdsnk2Nk5EyaEdRNLA-Q6_TbeXS++m_Vww_n7c0jDouyw@mail.gmail.com>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
 <CAP7DCDdsnk2Nk5EyaEdRNLA-Q6_TbeXS++m_Vww_n7c0jDouyw@mail.gmail.com>
Message-ID: <56142091.2040507@wxs.nl>

On 10/6/2015 7:12 PM, Martin Schr?der wrote:
> 2015-10-06 16:55 GMT+02:00 Hans Hagen <pragma at wxs.nl>:
>> One of these days we're going to release 0.80.1 and in addition to some
>
> Why will it be 0.80.1 and not 0.81.0?

it will be 0.81

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Tue Oct  6 23:50:07 2015
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 6 Oct 2015 23:50:07 +0200
Subject: [luatex] upcoming release
In-Reply-To: <5613EED1.6060507@morningstar2.co.uk>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl>	<22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl>	<22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl>	<5613E0E1.4000509@wxs.nl>
 <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
 <5613EC6E.4020805@wxs.nl>	<5613EED1.6060507@morningstar2.co.uk>
Message-ID: <22036.16911.438931.398684@zaphod.ms25.net>

On 2015-10-06 at 16:54:57 +0100, Joseph Wright wrote:

 > For TeX Live users, binary updates (essentially) only happen once
 > per year at release time, so probably something like April/May
 > before any change. (Someone from the TL team will doubtless comment
 > on that).

Well, there is a small difference between binaries for Unix and for
Windows.  Binaries for Unix are compiled once per year because a lot
of people are involved.  Binaries for Windows are compiled by Akira
Kakuto for his W32TeX distribution.  Akira occasionally uploaded new
binaries to the TL repository immediately after he had fixed a bug.

Of course, TeX Live should behave identically on all systems and it
doesn't make sense to upload LuaTeX 0.81 binaries for Windows only.

In order to evaluate LuaTeX 0.81, Unix users can easily compile the
binaries themselves and Windows users can use binaries from

  http://w32tex.org/

AFAIK W32TeX is always quite up-to-date and I'm sure that LuaTeX 0.81
will appear there soon when it's released.

 > For MiKTeX users the timetable is not so rigid though it's still
 > not going to happen 'immediately' following a code update.

It's all done by a single person.  What do you expect?  I'm wondering
why Christian doesn't at least steal the platform-independent packages
from TeX Live[1].  This could save him a lot of time and allow him to
concentrate on the binaries.

[1] It would also save a lot of space on the DVD.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From joseph.wright at morningstar2.co.uk  Wed Oct  7 11:05:02 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 7 Oct 2015 10:05:02 +0100
Subject: [luatex] upcoming release
In-Reply-To: <22036.16911.438931.398684@zaphod.ms25.net>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
 <CAEW6iOhm4AoN2PKar2abXgHN7nXaA3bz66aR5dEibgL1waXk3A@mail.gmail.com>
 <5613EC6E.4020805@wxs.nl> <5613EED1.6060507@morningstar2.co.uk>
 <22036.16911.438931.398684@zaphod.ms25.net>
Message-ID: <5614E03E.4040703@morningstar2.co.uk>

On 06/10/2015 22:50, Reinhard Kotucha wrote:
> On 2015-10-06 at 16:54:57 +0100, Joseph Wright wrote:
> 
>  > For TeX Live users, binary updates (essentially) only happen once
>  > per year at release time, so probably something like April/May
>  > before any change. (Someone from the TL team will doubtless comment
>  > on that).
> 
> Well, there is a small difference between binaries for Unix and for
> Windows.  Binaries for Unix are compiled once per year because a lot
> of people are involved.  Binaries for Windows are compiled by Akira
> Kakuto for his W32TeX distribution.  Akira occasionally uploaded new
> binaries to the TL repository immediately after he had fixed a bug.
> 
> Of course, TeX Live should behave identically on all systems and it
> doesn't make sense to upload LuaTeX 0.81 binaries for Windows only.
> 
> In order to evaluate LuaTeX 0.81, Unix users can easily compile the
> binaries themselves and Windows users can use binaries from
> 
>   http://w32tex.org/
> 
> AFAIK W32TeX is always quite up-to-date and I'm sure that LuaTeX 0.81
> will appear there soon when it's released.

Thanks for the clarification.

>  > For MiKTeX users the timetable is not so rigid though it's still
>  > not going to happen 'immediately' following a code update.
> 
> It's all done by a single person.  What do you expect? 

Wasn't meant as anything other than an observation: Christian Schenk
clearly does a lot of work to keep MiKTeX working!

Joseph


From luigi.scarso at gmail.com  Wed Oct  7 22:12:27 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 7 Oct 2015 22:12:27 +0200
Subject: [luatex] Luatex 0.81.0 announcement
Message-ID: <CAG5iGsCOkvzX6CN3kEMcsjKQA6+qPRk9jMwyP811ua9Npp97tA@mail.gmail.com>

New luatex release, 0.81.0

Hans already explained the changes on primitives;
I only add
* new epdf.openMemStream(s,l,docid)
to create a pdf from a lightuserdata or  string.
(experimental, do not use in production.)

* uniform random generator in mplib is now specific for each numbersystem;

* too_precise implemented for binary number system;

* several bug fixes.



The archives can be downloaded from supelec as usual:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.81.0
<https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.1>

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org



Have fun,
Hans, Taco, Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151007/82d19dee/attachment.html>

From kmaeda at kmaeda.net  Thu Oct  8 05:57:44 2015
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Thu, 8 Oct 2015 12:57:44 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in Mac
 OS X 10.11 El Capitan
Message-ID: <20151008125744.f06b570ca2dd6342cefcb84e@kmaeda.net>

Hi all.

Mac OS X 10.11 El Capitan provides many new CJK fonts as OpenType Collection (but extension is .ttc).
LuaTeX 0.81.0 can handle these new fonts (see rev 5330).
However, luaotfload still cannot embed several fonts, e.g. HiraginoSans-W1, with "Invalid TTC index number" error.

The cause of the problem is that this font does not have subfonts whose PostScript name is same as "fontname" of the font file.
For HiraginoSans-W1, luatex fontloader returns:

...
 ["familyname"]="Hiragino Sans W1",
 ["fontname"]="HiraKakuProN-W1",
 ["fontstyle_id"]=0,
 ["fullname"]="HiraKakuProN-W1",
...

This font file has two subfonts. Their PostScript name are:

...
     ["family"]=".Hiragino Kaku Gothic Interface",
     ["fullname"]=".Hiragino Kaku Gothic Interface W1",
     ["manufacturer"]="SCREEN Graphic and Precision Solutions Co., Ltd.",
     ["postscriptname"]=".HiraKakuInterface-W1",
     ["preffamilyname"]=".Hiragino Kaku Gothic Interface",
...
     ["family"]="Hiragino Sans W1",
     ["fullname"]="Hiragino Sans W1",
     ["manufacturer"]="SCREEN Graphic and Precision Solutions Co., Ltd.",
     ["postscriptname"]="HiraginoSans-W1",
     ["preffamilyname"]="Hiragino Sans",
...

There is no subfont whose postscriptname is "HiraKakuProN-W1".
But luaotfload sets fontname "HiraKakuProN-W1" to psname, and causes "Invalid TTC index number" error.


I attach a patch to luaotfload (or font-otf.lua).
This code reads postscriptname, writes it to font cache as metadata.psname, and sets it to psname.
After applying this patch, you will be able to embed all the new CJK fonts.


Best regards
Kazuki Maeda
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luaotfload-fontloader-otf-psname.patch
Type: text/x-diff
Size: 1271 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20151008/fa33a7d0/attachment.bin>

From elie.roux at telecom-bretagne.eu  Thu Oct  8 14:50:36 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Thu, 8 Oct 2015 14:50:36 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <20151008125744.f06b570ca2dd6342cefcb84e@kmaeda.net>
References: <20151008125744.f06b570ca2dd6342cefcb84e@kmaeda.net>
Message-ID: <5616669C.1010303@telecom-bretagne.eu>

Dear Kazuki Maeda,

Thank you very much for your bug report and patch. I've reported it on
luaotfload tracker: https://github.com/lualatex/luaotfload/issues/289
and will ask Hans about it (he's the author of the upstream ConTeXt
code). Is one of these fonts publicly available? If not, could you send
it to me privately?

Best Regards,
-- 
Elie

From sh-list at posteo.net  Thu Oct  8 21:37:53 2015
From: sh-list at posteo.net (Stephan Hennig)
Date: Thu, 8 Oct 2015 21:37:53 +0200
Subject: [luatex] upcoming release
In-Reply-To: <5613E0E1.4000509@wxs.nl>
References: <4F6AB221-637C-4103-9A54-3EF87482545D@gmail.com>
 <560E9EA7.4010406@wxs.nl> <22031.10763.680030.803059@zaphod.ms25.net>
 <56105858.5070203@wxs.nl> <22032.38297.127059.511422@zaphod.ms25.net>
 <5610EDF6.9010306@wxs.nl> <5613E0E1.4000509@wxs.nl>
Message-ID: <5616C611.9050601@posteo.net>

Am 06.10.2015 um 16:55 schrieb Hans Hagen:

> At the same time we moved the (ex)hyphenpenalties in the disc nodes
> so you can inject discretionaries with specific penalties.

At last!

Best regards,
Stephan Hennig


From taylorkgb at gmail.com  Thu Oct  8 22:29:26 2015
From: taylorkgb at gmail.com (Yusuke Terada)
Date: Fri, 9 Oct 2015 05:29:26 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
	Mac OS X 10.11 El Capitan
Message-ID: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>

Dear Elie,

I am Yusuke Terada, a friend of Kazuki's. 
I found the bug and asked him to report it to this mailing list.
Please let me add some more information about it.

Here are the paths of fonts which cause the bug:

/System/Library/Fonts/????????? W0.ttc
/System/Library/Fonts/????????? W1.ttc
/System/Library/Fonts/????????? W2.ttc
/System/Library/Fonts/????????? W4.ttc
/System/Library/Fonts/????????? W5.ttc
/System/Library/Fonts/????????? W7.ttc
/System/Library/Fonts/????????? W9.ttc
/Library/Fonts/Klee.ttc
/Library/Fonts/TsukushiAMaruGothic.ttc
/Library/Fonts/TsukushiBMaruGothic.ttc

>  Is one of these fonts publicly available? If not, could you send
> it to me privately?


I'm afraid they are not freely available and cannot be sent, because they are commercial fonts and sending them violates Apple's EULA.
If you or someone else has OS X 10.11 El Capitan, please try this source:

\documentclass{article}
\usepackage{fontspec}
\font\hiragino=HiraginoSans-W1 % PostScript name of a subfont of "????????? W1.ttc"
\begin{document}
\hiragino ?
\end{document}

If you compile this by LuaTeX 0.81.0, you will get the "Invalid TTC index number" error.

Sincerely,

Yusuke Terada



> Dear Kazuki Maeda,
> 
> Thank you very much for your bug report and patch. I've reported it on
> luaotfload tracker: 
> https://github.com/lualatex/luaotfload/issues/289
> 
> and will ask Hans about it (he's the author of the upstream ConTeXt
> code). Is one of these fonts publicly available? If not, could you send
> it to me privately?
> 
> Best Regards,
> -- 
> Elie



From elie.roux at telecom-bretagne.eu  Thu Oct  8 22:40:42 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 8 Oct 2015 22:40:42 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
Message-ID: <5616D4CA.2050809@telecom-bretagne.eu>

Dear Yusuke Terada,

> I'm afraid they are not freely available and cannot be sent, because 
> they are commercial fonts and sending them violates Apple's EULA.

I know that, but none of the people who can work on this have OSX, so
the EULA will have to be broken one way or another if the bug has to be
fixed.

Does someone on the list have access to these fonts?

Thank you,
-- 
Elie

From pragma at wxs.nl  Thu Oct  8 22:56:46 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 8 Oct 2015 22:56:46 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616D4CA.2050809@telecom-bretagne.eu>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>
Message-ID: <5616D88E.9000702@wxs.nl>

On 10/8/2015 10:40 PM, ?lie Roux wrote:
> Dear Yusuke Terada,
>
>> I'm afraid they are not freely available and cannot be sent, because
>> they are commercial fonts and sending them violates Apple's EULA.

So we cannot support apple/osx then.

> I know that, but none of the people who can work on this have OSX, so
> the EULA will have to be broken one way or another if the bug has to be
> fixed.
>
> Does someone on the list have access to these fonts?

Indeed. No font, no fix ... (my mac is way too old, cannot be updated to 
a newer osx, and i'm not going to buy a new one for testing).

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Thu Oct  8 23:55:58 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Thu, 08 Oct 2015 23:55:58 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616D4CA.2050809@telecom-bretagne.eu>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>
Message-ID: <5616E66E.2060208@gmail.com>

> ?lie Roux <mailto:elie.roux at telecom-bretagne.eu>
> 8. Oktober 2015 um 22:40
> Dear Yusuke Terada,
>
>
> I know that, but none of the people who can work on this have OSX, so
> the EULA will have to be broken one way or another if the bug has to be
> fixed.
>
> Does someone on the list have access to these fonts?
You can use the Source Han Sans font for test because it is also 
available in the OTC format.

https://github.com/adobe-fonts/source-han-sans/releases

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151008/47775cf6/attachment-0001.html>

From pragma at wxs.nl  Fri Oct  9 00:03:29 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 9 Oct 2015 00:03:29 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616E66E.2060208@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
Message-ID: <5616E831.8060804@wxs.nl>

On 10/8/2015 11:55 PM, Wolfgang Schuster wrote:
>> ?lie Roux <mailto:elie.roux at telecom-bretagne.eu>
>> 8. Oktober 2015 um 22:40
>> Dear Yusuke Terada,
>>
>>
>> I know that, but none of the people who can work on this have OSX, so
>> the EULA will have to be broken one way or another if the bug has to be
>> fixed.
>>
>> Does someone on the list have access to these fonts?
> You can use the Source Han Sans font for test because it is also
> available in the OTC format.
>
> https://github.com/adobe-fonts/source-han-sans/releases

those fonts work ok (at my end), the problem probably relates to 
filenames as well as fontnames in some non-latin encoding

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From schuster.wolfgang at gmail.com  Fri Oct  9 00:24:57 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 9 Oct 2015 00:24:57 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616E831.8060804@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
Message-ID: <5616ED39.2020802@gmail.com>

> Hans Hagen <mailto:pragma at wxs.nl>
> 9. Oktober 2015 um 00:03
>
> those fonts work ok (at my end), the problem probably relates to 
> filenames as well as fontnames in some non-latin encoding

The normal ttc-files (with separate files for each style) work but the 
file in the folder SuperOTC doesn?t.

The following example

\starttext
\definedfont[file:SourceHanSans(SourceHanSans-Bold)]Source Han Sans Bold
\stoptext

results in this error:

!LuaTeX error (file /Users/wolf/Library/Fonts/SourceHanSans.ttc): sfnt: 
table not found...

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151009/9326de26/attachment.html>

From schuster.wolfgang at gmail.com  Fri Oct  9 00:26:17 2015
From: schuster.wolfgang at gmail.com (Wolfgang Schuster)
Date: Fri, 9 Oct 2015 00:26:17 +0200
Subject: [luatex] Offlist: Luaotfload still cannot embed several new CJK
 fonts in Mac OS X 10.11 El Capitan
Message-ID: <5616ED89.802@gmail.com>

> Hans Hagen <mailto:pragma at wxs.nl>
> 8. Oktober 2015 um 22:56
> On 10/8/2015 10:40 PM, ?lie Roux wrote:
>> Dear Yusuke Terada,
>>
>>> I'm afraid they are not freely available and cannot be sent, because
>>> they are commercial fonts and sending them violates Apple's EULA.
>
> So we cannot support apple/osx then.
>
>> I know that, but none of the people who can work on this have OSX, so
>> the EULA will have to be broken one way or another if the bug has to be
>> fixed.
>>
>> Does someone on the list have access to these fonts?
>
> Indeed. No font, no fix ... (my mac is way too old, cannot be updated 
> to a newer osx, and i'm not going to buy a new one for testing).
Hi Hans,

I can send you the files when you?re interested.

Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151009/e958f7af/attachment-0001.html>

From kmaeda at kmaeda.net  Fri Oct  9 04:20:29 2015
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Fri, 9 Oct 2015 11:20:29 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616E831.8060804@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>	<5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
Message-ID: <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>

On Fri, 9 Oct 2015 00:03:29 +0200
Hans Hagen <pragma at wxs.nl> wrote:
> > You can use the Source Han Sans font for test because it is also
> > available in the OTC format.
> >
> > https://github.com/adobe-fonts/source-han-sans/releases
>
> those fonts work ok (at my end), the problem probably relates to
> filenames as well as fontnames in some non-latin encoding

SourceHanSans-Medium.ttc has the following metadata:

...
 ["fontname"]="SourceHanSans-Medium",
...

and four subfonts:

(0):
   ["postscriptname"]="SourceHanSans-Medium",
(1):
   ["postscriptname"]="SourceHanSansK-Medium",
(2):
   ["postscriptname"]="SourceHanSansSC-Medium",
(3):
   ["postscriptname"]="SourceHanSansTC-Medium",

In this case, ("postscriptname" of the subfont 0) == ("fontname" of SourceHanSans-Medium.ttc).
Therefore, "Invalid TTC index number" error does not occur.
If you delete subfont 0 from the ttc, you may get the error.


Best regards
Kazuki Maeda

From taylorkgb at gmail.com  Fri Oct  9 06:04:48 2015
From: taylorkgb at gmail.com (Yusuke Terada)
Date: Fri, 9 Oct 2015 13:04:48 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
	Mac OS X 10.11 El Capitan
In-Reply-To: <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
Message-ID: <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>

I've made a font for testing on Kazuki's advice using AFDKO.

You can download it from here:
https://dl.dropboxusercontent.com/u/5807100/SourceHanSans-Medium-Reduced.ttc

If you compile the attached luaotfload_test.tex with plain-LuaTeX 0.81.0, you will get this error:
<./SourceHanSans-Medium-Reduced.ttc(SourceHanSans-Medium:-1)Invalid TTC index number

After applying the patch Kazuki submitted yesterday to fontloader, this source can be compiled correctly.

Sincerely,

Yusuke Terada

-------------- next part --------------
A non-text attachment was scrubbed...
Name: luaotfload_test.tex
Type: application/octet-stream
Size: 95 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20151009/b5669254/attachment.obj>
-------------- next part --------------


> 2015/10/09 11:20?Kazuki Maeda <kmaeda at kmaeda.net> ?????
> 
> On Fri, 9 Oct 2015 00:03:29 +0200
> Hans Hagen <pragma at wxs.nl> wrote:
>>> You can use the Source Han Sans font for test because it is also
>>> available in the OTC format.
>>> 
>>> https://github.com/adobe-fonts/source-han-sans/releases
>> 
>> those fonts work ok (at my end), the problem probably relates to
>> filenames as well as fontnames in some non-latin encoding
> 
> SourceHanSans-Medium.ttc has the following metadata:
> 
> ...
> ["fontname"]="SourceHanSans-Medium",
> ...
> 
> and four subfonts:
> 
> (0):
>   ["postscriptname"]="SourceHanSans-Medium",
> (1):
>   ["postscriptname"]="SourceHanSansK-Medium",
> (2):
>   ["postscriptname"]="SourceHanSansSC-Medium",
> (3):
>   ["postscriptname"]="SourceHanSansTC-Medium",
> 
> In this case, ("postscriptname" of the subfont 0) == ("fontname" of SourceHanSans-Medium.ttc).
> Therefore, "Invalid TTC index number" error does not occur.
> If you delete subfont 0 from the ttc, you may get the error.
> 
> 
> Best regards
> Kazuki Maeda


From h.y.acetaminophen at gmail.com  Fri Oct  9 08:15:24 2015
From: h.y.acetaminophen at gmail.com (Hironobu Yamashita)
Date: Fri, 9 Oct 2015 15:15:24 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
	Mac OS X 10.11 El Capitan
In-Reply-To: <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
Message-ID: <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>

Hi all,

I think Kazuki says:

It is true that **most of** the collection fonts available in the world have a subfont
whose postscript name is exactly same as its fontname, however, it is NOT true
that **all of** the collection fonts do.

And he is right: some of the examples are Apple's new CJK fonts and what Yusuke
has sent to us. And the patch Kazuki has sent works fine, I think.

-----
Hironobu Yamashita


2015/10/09 13:04?Yusuke Terada <taylorkgb at gmail.com> ??????:

> I've made a font for testing on Kazuki's advice using AFDKO.
> 
> You can download it from here:
> https://dl.dropboxusercontent.com/u/5807100/SourceHanSans-Medium-Reduced.ttc
> 
> If you compile the attached luaotfload_test.tex with plain-LuaTeX 0.81.0, you will get this error:
> <./SourceHanSans-Medium-Reduced.ttc(SourceHanSans-Medium:-1)Invalid TTC index number
> 
> After applying the patch Kazuki submitted yesterday to fontloader, this source can be compiled correctly.
> 
> Sincerely,
> 
> Yusuke Terada
> 
> <luaotfload_test.tex>
> 
> 
>> 2015/10/09 11:20?Kazuki Maeda <kmaeda at kmaeda.net> ?????
>> 
>> SourceHanSans-Medium.ttc has the following metadata:
>> 
>> ...
>> ["fontname"]="SourceHanSans-Medium",
>> ...
>> 
>> and four subfonts:
>> 
>> (0):
>>  ["postscriptname"]="SourceHanSans-Medium",
>> (1):
>>  ["postscriptname"]="SourceHanSansK-Medium",
>> (2):
>>  ["postscriptname"]="SourceHanSansSC-Medium",
>> (3):
>>  ["postscriptname"]="SourceHanSansTC-Medium",
>> 
>> In this case, ("postscriptname" of the subfont 0) == ("fontname" of SourceHanSans-Medium.ttc).
>> Therefore, "Invalid TTC index number" error does not occur.
>> If you delete subfont 0 from the ttc, you may get the error.
>> 
>> 
>> Best regards
>> Kazuki Maeda
> 


From pragma at wxs.nl  Fri Oct  9 09:21:47 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 9 Oct 2015 09:21:47 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <5616ED39.2020802@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl> <5616ED39.2020802@gmail.com>
Message-ID: <56176B0B.1000003@wxs.nl>

On 10/9/2015 12:24 AM, Wolfgang Schuster wrote:
>> Hans Hagen <mailto:pragma at wxs.nl>
>> 9. Oktober 2015 um 00:03
>>
>> those fonts work ok (at my end), the problem probably relates to
>> filenames as well as fontnames in some non-latin encoding
>
> The normal ttc-files (with separate files for each style) work but the
> file in the folder SuperOTC doesn?t.
>
> The following example
>
> \starttext
> \definedfont[file:SourceHanSans(SourceHanSans-Bold)]Source Han Sans Bold
> \stoptext
>
> results in this error:
>
> !LuaTeX error (file /Users/wolf/Library/Fonts/SourceHanSans.ttc): sfnt:
> table not found...

that is ok in luatex 0.81

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Oct  9 09:24:16 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 9 Oct 2015 09:24:16 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
Message-ID: <56176BA0.2070105@wxs.nl>

On 10/9/2015 6:04 AM, Yusuke Terada wrote:
> I've made a font for testing on Kazuki's advice using AFDKO.
>
> You can download it from here:
> https://dl.dropboxusercontent.com/u/5807100/SourceHanSans-Medium-Reduced.ttc
>
> If you compile the attached luaotfload_test.tex with plain-LuaTeX 0.81.0, you will get this error:
> <./SourceHanSans-Medium-Reduced.ttc(SourceHanSans-Medium:-1)Invalid TTC index number
>
> After applying the patch Kazuki submitted yesterday to fontloader, this source can be compiled correctly.

that patch is not ok (it can result in empty ps names for other fonts 
and is also applied in the wrong place in the code) ... keep in mind 
that what works for one font can fail for another (and anything you can 
imagine that goes wrong with names/string, will go wrong with fonts)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From kmaeda at kmaeda.net  Fri Oct  9 11:06:38 2015
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Fri, 9 Oct 2015 18:06:38 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <56176BA0.2070105@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>	<5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>	<56176BA0.2070105@wxs.nl>
Message-ID: <20151009180638.38dd1d65ade554648d4af154@kmaeda.net>

Dear Hans

> and is also applied in the wrong place in the code
Ahhh, I see. I have written the code in very strange place (between report_otf() and containers.write())...
In addition, such a process should be executed by enhancers?
Where should I write the code in?

> it can result in empty ps names for other fonts
I agree with you. But, in fact, several new commercial fonts cause the problem as I wrote.
I would be happy if we could find a good solution to the problem.


Best regards
Kazuki Maeda

From pragma at wxs.nl  Fri Oct  9 11:09:09 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 9 Oct 2015 11:09:09 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>
Message-ID: <56178435.3050308@wxs.nl>

On 10/9/2015 8:15 AM, Hironobu Yamashita wrote:

> It is true that **most of** the collection fonts available in the world have a subfont
> whose postscript name is exactly same as its fontname, however, it is NOT true
> that **all of** the collection fonts do.

I've uploaded a new context beta that now looks at the postscriptname
(but with some extra checking and in the same spot where fontname and
fullname are checked).

The ps names are normally used in the backend for unique font
identifiers btu are also used by the backend for ttc lookups. So, if
different fonts have the same ps fontnames the result might be
unexpected. Also, in an upcoming luatex patch we will fallback on index
0 + warning which is in most cases quite ok (at least some output).

Wolfgang: the new context font code already had that ps name resolving
so now both methods are more or less similar in that respect, although
we can have subtle differences in font/fullnames.

Hans



-----------------------------------------------------------------
                                          Hans Hagen | PRAGMA ADE
              Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
    tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                             | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Oct  9 11:18:20 2015
From: elie.roux at telecom-bretagne.eu (=?ISO-2022-JP?B?RSdsaWUgUm91eA==?=)
Date: Fri, 9 Oct 2015 11:18:20 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <56178435.3050308@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com> <56178435.3050308@wxs.nl>
Message-ID: <5617865C.6050200@telecom-bretagne.eu>

Dear Hans,

> I've uploaded a new context beta that now looks at the
> postscriptname (but with some extra checking and in the same spot
> where fontname and fullname are checked).

Thanks a lot, I'll try to update luaotfload with the new beta.

Thank you,
-- 
Elie

From kmaeda at kmaeda.net  Fri Oct  9 11:26:42 2015
From: kmaeda at kmaeda.net (Kazuki Maeda)
Date: Fri, 9 Oct 2015 18:26:42 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <56178435.3050308@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>	<5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>	<56178435.3050308@wxs.nl>
Message-ID: <20151009182642.b070288f0ee5b7aac42059e9@kmaeda.net>

Dear Hans

> I've uploaded a new context beta that now looks at the postscriptname
> (but with some extra checking and in the same spot where fontname and
> fullname are checked).

Thank you very much! I will try the updated version as soon as possible.

Best regards
Kazuki Maeda

From h.y.acetaminophen at gmail.com  Fri Oct  9 18:17:39 2015
From: h.y.acetaminophen at gmail.com (Hironobu YAMASHITA)
Date: Sat, 10 Oct 2015 01:17:39 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <56178435.3050308@wxs.nl>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>	<5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>	<56178435.3050308@wxs.nl>
Message-ID: <CAJCZBmSP_kT+2wx5ME0AjGiUaxsfoK6YLga5sCTPjtgPqh5FfA@mail.gmail.com>

??Dear Hans,

> I've uploaded a new context beta that now looks at the postscriptname
>  (but with some extra checking and in the same spot where fontname and
>  fullname are checked).
Thank you very much for new context beta.
I've tested it with following source, using SourceHanSans-Medium.ttc.
I removed all the other private font files from my TEXMF tree, and deleted
all cache files which had already existed.

==========
\definefont[xxx][name:SourceHanSansSCMedium]
\definefont[yyy][name:SourceHanSansTCMedium]
\definefont[zzz][name:SourceHanSansMedium]
\definefont[www][name:SourceHanSansKMedium]
\starttext
{\zzz Using SourceHanSans-Medium.ttc (OTC: OpenType Collection)}

\xxx ?\yyy ?\zzz ?\www ?

\xxx ?\yyy ?\zzz ?\www ?
\stoptext
==========

In version 2015.10.07 12:03, four different characters were printed
correctly. However, in version 2015.10.09 10:59, all four characters
were printed in "SourceHanSansMedium" form.
Sample source, pdfs, and logs are available at:
https://dl.dropboxusercontent.com/s/xrflnjyovslxjbo/contextbeta-test.zip?dl=0

I checked the cache files, and all of them have the same definitions:
  ["familyname"]="Source Han Sans",
  ["fontname"]="SourceHanSans-Medium",
  ["fullname"]="Source Han Sans Medium",
This seems to be an unexpected result...

Regards,
Hironobu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151010/a0a346d7/attachment.html>

From igor.liferenko at gmail.com  Fri Oct  9 23:42:41 2015
From: igor.liferenko at gmail.com (Igor Liferenko)
Date: Sat, 10 Oct 2015 04:42:41 +0700
Subject: [luatex] How to change hyphenation codes with the change of
 \language in LuaTeX?
Message-ID: <CAJyx361ZhbGRvZ5ytuEUNs8AnyLtSXvdNVTGNxh6mkhH+eTqow@mail.gmail.com>

In different languages, one and the same character may and may not be
used in hyphenation. For example: in English, quote (') can not be
part of word, whereas in French it is part of word.

Normally, one has to do \lccode`\'=`\' and \lccode`\'=0 manually each
time when changing language. By using \savinghyphcodes=1 this is done
automatically.

By compiling the following examples, we show that the word *is*
hyphenated in the second case, in spite of the fact that \lccode`\' is
zero. This is because \savinghyphcodes=1 is used.

    $ cat `kpsewhich hyph-fr.tex` | iconv -f utf8 -t cp1252 > hyphfr.tex

Create myfmt.ini:

    \input plain
    \newlanguage\french
    \language\french
    \begingroup
    \savinghyphcodes=1
    \lccode`\'=`\'
    \newcount\n \n=128 \loop\ifnum\n<255 \lccode\n=\n \advance\n by1\repeat
    \input hyphfr
    \endgroup
    \chardef\english=0
    \language\english
    \dump

Generate new format:

    $ etex -ini -etex myfmt.ini

Create test.tex:

    \hsize=1pt
    \hfuzz=10em
    \parindent=0pt
    \language\french
    \the\lccode`\'\ l'installation
    \hbox to 10em {\hrulefill}
    \language\english
    \the\lccode`\'\ l'installation
    \hbox to 10em {\hrulefill}
    \language\french
    \the\lccode`\'\ l'installation
    \bye

Compile test.tex with new format:

    $ etex -fmt myfmt test.tex

Show the output:

    $ xdvi test.dvi

How to achieve with LuaTeX the same functionality as was demonstrated
with e-TeX?

From preining at logic.at  Sat Oct 10 05:10:59 2015
From: preining at logic.at (Norbert Preining)
Date: Sat, 10 Oct 2015 12:10:59 +0900
Subject: [luatex] segfault when building from TL
Message-ID: <20151010031059.GZ7678@auth.logic.tuwien.ac.at>

Hi everyone,

I was thinking about trying out the font stuff for ttc fonts that
was discussed recently, so I built a luatex binary from the current
TeX Live sources.

Then I cleaned the luatex-cache, and rebuild the formats.
Then I run lualatex on a simple file loading fontspec, and
now lualatex always crashes with:
	(/home/norbert/tl/2015/texmf-dist/tex/latex/euenc/eu2lmr.fd)(compiling luc: /home/norbert/tl/2015/texmf-var/luatex-cache/generic/fonts/otf/lmroman10-regular.luc)(compiling luc: /home/norbert/.texlive2015/texmf-var/luatex-cache/generic/fonts/otf/lmroman10-regular.luc)Segmentation fault

Any idea how to track this down?

This is a standard TL 2015 installation up to date, x86_64-linux
(Debian/sid)

Thanks

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0  ACF0 6CAC A448 860C DC13
------------------------------------------------------------------------

From kakuto at fuk.kindai.ac.jp  Sat Oct 10 05:20:04 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 10 Oct 2015 12:20:04 +0900
Subject: [luatex]  segfault when building from TL
Message-ID: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>

Hi Norbert,

> Then I run lualatex on a simple file loading fontspec, and
> now lualatex always crashes with: ...

Because the new LuaTeX and the luaotfload 2.5 are inconsistent.

Thanks,
Akira


From preining at logic.at  Sat Oct 10 05:58:16 2015
From: preining at logic.at (Norbert Preining)
Date: Sat, 10 Oct 2015 12:58:16 +0900
Subject: [luatex] segfault when building from TL
In-Reply-To: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
References: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
Message-ID: <20151010035816.GA7678@auth.logic.tuwien.ac.at>

> Because the new LuaTeX and the luaotfload 2.5 are inconsistent.

Ahh, thanks. Branch master from https://github.com/lualatex/luaotfload
is necessary I guess.

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0  ACF0 6CAC A448 860C DC13
------------------------------------------------------------------------

From luigi.scarso at gmail.com  Sat Oct 10 10:07:55 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 10 Oct 2015 10:07:55 +0200
Subject: [luatex] segfault when building from TL
In-Reply-To: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
References: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
Message-ID: <CAG5iGsCJzZQ4-b5zN_iAwwXE=EFMV26A=0bpUpGNYL1J6+bwHA@mail.gmail.com>

On Sat, Oct 10, 2015 at 5:20 AM, Akira Kakuto <kakuto at fuk.kindai.ac.jp>
wrote:

> Hi Norbert,
>
> Then I run lualatex on a simple file loading fontspec, and
>> now lualatex always crashes with: ...
>>
>
> Because the new LuaTeX and the luaotfload 2.5 are inconsistent.
>
> Thanks,
> Akira
>
> Can I reproduce it ?

I'm using Master from TL and luatex from trunk

$> luatex --credits
This is LuaTeX, Version beta-0.81.1 (TeX Live 2016/dev)

$> fmtutil --byfmt luatex
$> fmtutil --byfmt lualatex
are both ok.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151010/c1da3fa7/attachment-0001.html>

From pragma at wxs.nl  Sat Oct 10 10:21:48 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 10 Oct 2015 10:21:48 +0200
Subject: [luatex] segfault when building from TL
In-Reply-To: <CAG5iGsCJzZQ4-b5zN_iAwwXE=EFMV26A=0bpUpGNYL1J6+bwHA@mail.gmail.com>
References: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
 <CAG5iGsCJzZQ4-b5zN_iAwwXE=EFMV26A=0bpUpGNYL1J6+bwHA@mail.gmail.com>
Message-ID: <5618CA9C.1010708@wxs.nl>

On 10/10/2015 10:07 AM, luigi scarso wrote:
>
>
> On Sat, Oct 10, 2015 at 5:20 AM, Akira Kakuto <kakuto at fuk.kindai..ac.jp
> <mailto:kakuto at fuk.kindai.ac.jp>> wrote:
>
>     Hi Norbert,
>
>         Then I run lualatex on a simple file loading fontspec, and
>         now lualatex always crashes with: ...
>
>
>     Because the new LuaTeX and the luaotfload 2.5 are inconsistent.
>
>     Thanks,
>     Akira
>
> Can I reproduce it ?
>
> I'm using Master from TL and luatex from trunk
>
> $> luatex --credits
> This is LuaTeX, Version beta-0.81.1 (TeX Live 2016/dev)
>
> $> fmtutil --byfmt luatex
> $> fmtutil --byfmt lualatex
> are both ok.

it might relate to this fuzzy mixed zero glyph slot / mem testing issue 
(0, null, NULL) for which we introduced the min/man fields as catch so 
when a fontloader does it right there should be no crash

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Sat Oct 10 10:29:28 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 10 Oct 2015 10:29:28 +0200
Subject: [luatex] segfault when building from TL
In-Reply-To: <5618CA9C.1010708@wxs.nl>
References: <CEB02D8EAD27499DAAA2054CE00B2ACC@CJ3001517A>
 <CAG5iGsCJzZQ4-b5zN_iAwwXE=EFMV26A=0bpUpGNYL1J6+bwHA@mail.gmail.com>
 <5618CA9C.1010708@wxs.nl>
Message-ID: <CAG5iGsB-aUvH36_PdpkjYYrkYov1odi9B3cp_ZV1MOSZkVFkZg@mail.gmail.com>

On Sat, Oct 10, 2015 at 10:21 AM, Hans Hagen <pragma at wxs.nl> wrote:

> On 10/10/2015 10:07 AM, luigi scarso wrote:
>
>>
>>
>> On Sat, Oct 10, 2015 at 5:20 AM, Akira Kakuto <kakuto at fuk.kindai..ac.jp
>> <mailto:kakuto at fuk.kindai.ac.jp>> wrote:
>>
>>     Hi Norbert,
>>
>>         Then I run lualatex on a simple file loading fontspec, and
>>         now lualatex always crashes with: ...
>>
>>
>>     Because the new LuaTeX and the luaotfload 2.5 are inconsistent.
>>
>>     Thanks,
>>     Akira
>>
>> Can I reproduce it ?
>>
>> I'm using Master from TL and luatex from trunk
>>
>> $> luatex --credits
>> This is LuaTeX, Version beta-0.81.1 (TeX Live 2016/dev)
>>
>> $> fmtutil --byfmt luatex
>> $> fmtutil --byfmt lualatex
>> are both ok.
>>
>
> it might relate to this fuzzy mixed zero glyph slot / mem testing issue
> (0, null, NULL) for which we introduced the min/man fields as catch so when
> a fontloader does it right there should be no crash
>
> Hans
>

\documentclass{report}
\usepackage{luaotfload}
\usepackage {fontspec}
\begin{document}
foo
\end{document}



2613    static int ff_glyph_index(lua_State * L)
2614    {
2615        struct splinechar *glyph;
2616        int key;
2617        glyph = *check_isglyph(L, 1);
2618        if (glyph == NULL) {
2619            return luaL_error(L,
2620                              "fontloader.glyph.__index: glyph is
nonexistent\n");
2621        }
2622        if (!lua_isstring(L, 2)) {  /* 1 == 'font' */
2623            return luaL_error(L,
2624                              "fontloader.glyph.__index: can only be
indexed by string\n");
2625        }
2626        key = luaL_checkoption(L, 2, NULL, font_glyph_keys);
2627        switch (key) {
2628        case GK_name:
2629            lua_pushstring(L, glyph->name);
2630            break;

2631        case GK_unicode:
>2632            lua_pushnumber(L, glyph->unicodeenc);

where
luafontloader/src/luafflib.c:#define check_isglyph(L,b) (struct splinechar
**)luaL_checkudata(L,b,FONT_GLYPH_METATABLE)


glyph is not a valid address.

This check_isglyph looks fragile.
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151010/c3b3eb97/attachment.html>

From kakuto at fuk.kindai.ac.jp  Sat Oct 10 13:54:46 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 10 Oct 2015 20:54:46 +0900
Subject: [luatex]  segfault when building from TL
Message-ID: <0177A47F99474F02966384C264018B8A@CJ3001517A>

Hi Luigi,

> This is LuaTeX, Version beta-0.81.1 (TeX Live 2016/dev)
>
> $> fmtutil --byfmt luatex
> $> fmtutil --byfmt lualatex
> are both ok.

Those were of course OK also in Norbert case.
Format creation is independent of the luaotfload.

Best,
Akira


From taylorkgb at gmail.com  Sun Oct 11 09:31:00 2015
From: taylorkgb at gmail.com (Yusuke Terada)
Date: Sun, 11 Oct 2015 16:31:00 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
	Mac OS X 10.11 El Capitan
In-Reply-To: <CAJCZBmSP_kT+2wx5ME0AjGiUaxsfoK6YLga5sCTPjtgPqh5FfA@mail.gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com> <56178435.3050308@wxs.nl>
 <CAJCZBmSP_kT+2wx5ME0AjGiUaxsfoK6YLga5sCTPjtgPqh5FfA@mail.gmail.com>
Message-ID: <68301AAE-204C-472A-AFB4-FEAFE438E0AC@gmail.com>

Dear Hans, 

I've tested the new context beta whose version is:
> mtx-context     | current version: 2015.10.09 21:28


I've confirmed that Hironobu's test source posted at http://tug.org/pipermail/luatex/2015-October/005396.html can be compiled correctly.

Moreover, most of the new CJK fonts of El Capitan can be loaded.
Here is the test source:

%%%%%%%%%%%
\definefont[xxxa][name:HiraginoSans-W0]
\definefont[xxxb][name:HiraginoSans-W1]
\definefont[xxxc][name:HiraginoSans-W2]
\definefont[xxxd][name:HiraginoSans-W3]
\definefont[xxxe][name:HiraginoSans-W4]
\definefont[xxxf][name:HiraginoSans-W5]
\definefont[xxxg][name:HiraginoSans-W6]
\definefont[xxxh][name:HiraginoSans-W7]
\definefont[xxxi][name:HiraginoSans-W8]
\definefont[xxxj][name:HiraginoSans-W9]
\definefont[yyya][name:Klee-Medium]
\definefont[yyyb][name:Klee-Demibold]
%\definefont[zzza][name:TsukuARdGothic-Regular]
%\definefont[zzzb][name:TsukuARdGothic-Bold]
%\definefont[zzzc][name:TsukuBRdGothic-Regular]
%\definefont[zzzd][name:TsukuBRdGothic-Bold]

\starttext

\xxxa ????????? ??\par
\xxxb ????????? ??\par
\xxxc ????????? ??\par
\xxxd ????????? ??\par
\xxxe ????????? ??\par
\xxxf ????????? ??\par
\xxxg ????????? ??\par
\xxxh ????????? ??\par
\xxxi ????????? ??\par
\xxxj ????????? ??\par
\yyya ??? ?????\par
\yyyb ??? ??????\par
%\zzza ???????? ?????\par
%\zzzb ???????? ????\par
%\zzzc ???????? ?????\par
%\zzzd ???????? ????\par

\stoptext
%%%%%%%%%%%

Some lines are commented out, because these fonts cause errors like this:

> Invalid TTC index number -1 (0..1), using index 0 for font TsukuARdGothic-Regular

These fonts (TsukushiAMaruGothic.ttc and TsukushiBMaruGothic.ttc) are, however, not so essential for Japanese typesetting that fixing this issue is an urgent matter.
I am very happy to see most of the new CJK fonts handled correctly with ConTeXt.
Thank you very much.

Sincerely,

Yusuke Terada



From h.y.acetaminophen at gmail.com  Sun Oct 11 11:29:17 2015
From: h.y.acetaminophen at gmail.com (Hironobu YAMASHITA)
Date: Sun, 11 Oct 2015 18:29:17 +0900
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <68301AAE-204C-472A-AFB4-FEAFE438E0AC@gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu>	<5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com>	<56178435.3050308@wxs.nl>
 <CAJCZBmSP_kT+2wx5ME0AjGiUaxsfoK6YLga5sCTPjtgPqh5FfA@mail.gmail.com>
 <68301AAE-204C-472A-AFB4-FEAFE438E0AC@gmail.com>
Message-ID: <CAJCZBmS1arxJJ55=wRh+KP2F5SyNXfMTLuPqw7m3Nsd03HwAxA@mail.gmail.com>

?Dear Hans,

Sorry for my late response,
Now I've tested with the latest context beta 2015.10.09 21:28, and:
> In version 2015.10.07 12:03, four different characters were printed
> correctly. However, in version 2015.10.09 10:59, all four characters
> were printed in "SourceHanSansMedium" form.
the problem was gone. I could get what I expected.

Though Yusuke has reported "Invalid TTC index number -1" error in some
fonts (TsukushiAMaruGothic.ttc and TsukushiBMaruGothic.ttc), I think
this is rather a trivial issue.

Thanks a lot!
Hironobu?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151011/3a8433ff/attachment-0001.html>

From pragma at wxs.nl  Sun Oct 11 11:45:59 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 11 Oct 2015 11:45:59 +0200
Subject: [luatex] Luaotfload still cannot embed several new CJK fonts in
 Mac OS X 10.11 El Capitan
In-Reply-To: <CAJCZBmS1arxJJ55=wRh+KP2F5SyNXfMTLuPqw7m3Nsd03HwAxA@mail.gmail.com>
References: <22E2348B-F296-478F-9817-F4A8F598DD85@gmail.com>
 <5616D4CA.2050809@telecom-bretagne.eu> <5616E66E.2060208@gmail.com>
 <5616E831.8060804@wxs.nl>
 <20151009112029.311d2107f8afa206397fa3d6@kmaeda.net>
 <1106BCA9-CA8D-405F-829B-69B7FE3459B6@gmail.com>
 <96048E47-3A09-4A53-98D9-5456BC0E7DDA@gmail.com> <56178435.3050308@wxs.nl>
 <CAJCZBmSP_kT+2wx5ME0AjGiUaxsfoK6YLga5sCTPjtgPqh5FfA@mail.gmail.com>
 <68301AAE-204C-472A-AFB4-FEAFE438E0AC@gmail.com>
 <CAJCZBmS1arxJJ55=wRh+KP2F5SyNXfMTLuPqw7m3Nsd03HwAxA@mail.gmail.com>
Message-ID: <561A2FD7.5090809@wxs.nl>

On 10/11/2015 11:29 AM, Hironobu YAMASHITA wrote:
> ?Dear Hans,
>
> Sorry for my late response,
> Now I've tested with the latest context beta 2015.10.09 21:28, and:
>  > In version 2015.10.07 12:03, four different characters were printed
>  > correctly. However, in version 2015.10.09 10:59, all four characters
>  > were printed in "SourceHanSansMedium" form.
> the problem was gone. I could get what I expected.
>
> Though Yusuke has reported "Invalid TTC index number -1" error in some
> fonts (TsukushiAMaruGothic.ttc and TsukushiBMaruGothic.ttc), I think
> this is rather a trivial issue.

when a subfont can't be found by name (it's on my list to see if we can 
just pass the subfont index directly) luatex will now fallback to index 
0 (so no -1 abort but a warning)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From joseph.wright at morningstar2.co.uk  Tue Oct 13 16:30:47 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 13 Oct 2015 15:30:47 +0100
Subject: [luatex] Accessing primitive registers
Message-ID: <561D1597.30801@morningstar2.co.uk>

Hello all,

Trying to use e.g. tex.dimen for accessing primitives seems to lead to
very odd errors:

  \directlua{print(tex.dimen["pagewidth"])}

    ! LuaTeX error [\directlua]:1: incorrect index value -11 for
    tex.getdimen()
    stack traceback:
	    [C]: in function '__index'

I'm assuming this is a bug?

Joseph

From pragma at wxs.nl  Tue Oct 13 17:13:35 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 13 Oct 2015 17:13:35 +0200
Subject: [luatex] Accessing primitive registers
In-Reply-To: <561D1597.30801@morningstar2.co.uk>
References: <561D1597.30801@morningstar2.co.uk>
Message-ID: <561D1F9F.2010302@wxs.nl>

On 10/13/2015 4:30 PM, Joseph Wright wrote:
> Hello all,
>
> Trying to use e.g. tex.dimen for accessing primitives seems to lead to
> very odd errors:
>
>    \directlua{print(tex.dimen["pagewidth"])}
>
>      ! LuaTeX error [\directlua]:1: incorrect index value -11 for
>      tex.getdimen()
>      stack traceback:
> 	    [C]: in function '__index'
>
> I'm assuming this is a bug?

i'll have a look at it (normally it indicates a non defined register)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From h_kitagawa2001 at yahoo.co.jp  Wed Oct 14 02:06:04 2015
From: h_kitagawa2001 at yahoo.co.jp (Hironori KITAGAWA)
Date: Wed, 14 Oct 2015 09:06:04 +0900
Subject: [luatex] luatexbase and expl3
Message-ID: <20151014090604.f1d19d61f91abdd0e52ff0ad@yahoo.co.jp>

Hello,

I found that the following source

\documentclass{minimal}
\usepackage{luatexbase}% 2015/10/04 v1.3 
\usepackage{expl3}%      2015/09/27 v6111
\ExplSyntaxOn
\xetex_suppressfontnotfounderror:D 0
\ExplSyntaxOff
\begin{document}
\end{document}

causes the following error:

! Undefined control sequence.
l.5 \xetex_suppressfontnotfounderror:D
                                     0
? x


Regards
Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>

From joseph.wright at morningstar2.co.uk  Wed Oct 14 08:25:35 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 14 Oct 2015 07:25:35 +0100
Subject: [luatex] luatexbase and expl3
In-Reply-To: <20151014090604.f1d19d61f91abdd0e52ff0ad@yahoo.co.jp>
References: <20151014090604.f1d19d61f91abdd0e52ff0ad@yahoo.co.jp>
Message-ID: <561DF55F.50409@morningstar2.co.uk>

On 14/10/2015 01:06, Hironori KITAGAWA wrote:
> Hello,
> 
> I found that the following source
> 
> \documentclass{minimal}
> \usepackage{luatexbase}% 2015/10/04 v1.3 
> \usepackage{expl3}%      2015/09/27 v6111
> \ExplSyntaxOn
> \xetex_suppressfontnotfounderror:D 0
> \ExplSyntaxOff
> \begin{document}
> \end{document}
> 
> causes the following error:
> 
> ! Undefined control sequence.
> l.5 \xetex_suppressfontnotfounderror:D
>                                      0
> ? x
> 
> 
> Regards
> Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>
> 

I'll take a look.

Joseph

From d.p.carlisle at gmail.com  Wed Oct 14 09:01:56 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 14 Oct 2015 08:01:56 +0100
Subject: [luatex] luatexbase and expl3
In-Reply-To: <20151014090604.f1d19d61f91abdd0e52ff0ad@yahoo.co.jp>
References: <20151014090604.f1d19d61f91abdd0e52ff0ad@yahoo.co.jp>
Message-ID: <CAEW6iOjL6YHD1iFNPhy4s3ubTtH8zw8safU4wr-Lg=H6pHfK5g@mail.gmail.com>

On 14 October 2015 at 01:06, Hironori KITAGAWA
<h_kitagawa2001 at yahoo.co.jp> wrote:
> Hello,
>
> I found that the following source
>
> \documentclass{minimal}
> \usepackage{luatexbase}% 2015/10/04 v1.3
> \usepackage{expl3}%      2015/09/27 v6111
> \ExplSyntaxOn
> \xetex_suppressfontnotfounderror:D 0
> \ExplSyntaxOff
> \begin{document}
> \end{document}
>
> causes the following error:
>
> ! Undefined control sequence.
> l.5 \xetex_suppressfontnotfounderror:D
>                                      0
> ? x
>
>
> Regards
> Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>




sorry about that it's fixed in the development sources of expl3 just
needs pushing to ctan.

David

From jfbu at free.fr  Thu Oct 15 18:36:59 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 18:36:59 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
Message-ID: <561FD62B.3070307@free.fr>

Hi,

as people reported problems with mathastext under lualatex I have become aware
that \luatexUmathcharnumdef etc... have been removed and \Umathcharnumdef etc...
must be used  instead.

as I didn't find the info immediately I am asking here: how should I test
(version number, date etc...)
when one should use \luatexUmathcharnumdef and
when on should use \Umathcharnumdef ?

or perhaps \Umathcharnumdef was always ok ?

I would like to not break people's old installation thus I would be
glad to use \Umathcharnumdef  if I am told it works with all earlier lualatex

best wishes

Jean-Fran?ois




From d.p.carlisle at gmail.com  Thu Oct 15 19:18:58 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 15 Oct 2015 18:18:58 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <561FD62B.3070307@free.fr>
References: <561FD62B.3070307@free.fr>
Message-ID: <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>

On 15 October 2015 at 17:36, jfbu <jfbu at free.fr> wrote:
> Hi,
>
> as people reported problems with mathastext under lualatex I have become aware
> that \luatexUmathcharnumdef etc... have been removed and \Umathcharnumdef etc...
> must be used  instead.
>
> as I didn't find the info immediately I am asking here: how should I test
> (version number, date etc...)
> when one should use \luatexUmathcharnumdef and
> when on should use \Umathcharnumdef ?

This is a latex rather than luatex issue really, the change was announced
in ltnews23 and other places along with the 2015/10/01 release
see

texdoc ltnews

Sorry, I thought we'd pre-warned all authors of packages using \luatex...
names, I apologise if we missed you

>
> or perhaps \Umathcharnumdef was always ok ?

yes, it was, the Umath... commands were always available with their
basic luatex names and also prefixed luatex.

>
> I would like to not break people's old installation thus I would be
> glad to use \Umathcharnumdef  if I am told it works with all earlier lualatex
>
> best wishes
>
> Jean-Fran?ois
>
>

David


From joseph.wright at morningstar2.co.uk  Thu Oct 15 19:29:01 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Thu, 15 Oct 2015 18:29:01 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <561FD62B.3070307@free.fr>
References: <561FD62B.3070307@free.fr>
Message-ID: <561FE25D.7060003@morningstar2.co.uk>

On 15/10/2015 17:36, jfbu wrote:
> Hi,
> 
> as people reported problems with mathastext under lualatex I have become aware
> that \luatexUmathcharnumdef etc... have been removed and \Umathcharnumdef etc...
> must be used  instead.
> 
> as I didn't find the info immediately I am asking here: how should I test
> (version number, date etc...)
> when one should use \luatexUmathcharnumdef and
> when on should use \Umathcharnumdef ?
> 
> or perhaps \Umathcharnumdef was always ok ?
> 
> I would like to not break people's old installation thus I would be
> glad to use \Umathcharnumdef  if I am told it works with all earlier lualatex
> 
> best wishes
> 
> Jean-Fran?ois

Hello Jean-Fran?ois,

The 'real' names of the primitives have always been just \Umath... For
some time they've been enabled with the "luatex" prefix.. The LaTeX team
have recently taken a more 'active' interest in directly supporting
LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
As part of that process, we've revised the approach to the newer
primitives and dropped the prefix 'out of the box'.

For code that needs to work both with older (pre 2015/10/01) and newer
(2015/10/01 onward) kernel releases, adding

    \directlua{
      tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
    }

(for just the Umath set) will do the job. Alternatively, if the code in
your package gets modified to drop the prefix then

    \directlua{
      tex.enableprimitives("", tex.extraprimitives("Umath"))
    }

will ensure that the 'natural' names are available with older kernel
releases.

Regards,

Joseph



From jfbu at free.fr  Thu Oct 15 19:30:27 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 19:30:27 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
Message-ID: <AFEA1408-1B38-4937-8E9C-47940E5CF1D0@free.fr>

Hi David

Le 15 oct. 2015 ? 19:18, David Carlisle <d.p.carlisle at gmail.com> a ?crit :

> On 15 October 2015 at 17:36, jfbu <jfbu at free.fr> wrote:
>> Hi,
>> 
>> as people reported problems with mathastext under lualatex I have become aware
>> that \luatexUmathcharnumdef etc... have been removed and \Umathcharnumdef etc...
>> must be used  instead.
>> 
>> as I didn't find the info immediately I am asking here: how should I test
>> (version number, date etc...)
>> when one should use \luatexUmathcharnumdef and
>> when on should use \Umathcharnumdef ?
> 
> This is a latex rather than luatex issue really, the change was announced
> in ltnews23 and other places along with the 2015/10/01 release
> see
> 
> texdoc ltnews

I must have seen the 2015/10/01 announcement but I was busy on 
other things, nevertheless I was only half surprised when bug reports 
(*) started flowing in

(*) one, so far

no wonder then that I when I started looking for info on the luatex
side I found none

(also I do not keep for a long time the messages I receive from
my subscriptions to mailing lists)


> Sorry, I thought we'd pre-warned all authors of packages using \luatex...
> names, I apologise if we missed you

no problem




> 
>> 
>> or perhaps \Umathcharnumdef was always ok ?
> 
> yes, it was, the Umath... commands were always available with their
> basic luatex names and also prefixed luatex.


excellent, and it is my fault then not have to used them from the start

thus the fix will be easy and I will be able to push immediately to CTAN
a patched mathastext

best

Jean-Fran?ois

From joseph.wright at morningstar2.co.uk  Thu Oct 15 19:32:11 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Thu, 15 Oct 2015 18:32:11 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <561FE25D.7060003@morningstar2.co.uk>
References: <561FD62B.3070307@free.fr> <561FE25D.7060003@morningstar2.co.uk>
Message-ID: <561FE31B.4070009@morningstar2.co.uk>

On 15/10/2015 18:29, Joseph Wright wrote:
> On 15/10/2015 17:36, jfbu wrote:
>> Hi,
>>
>> as people reported problems with mathastext under lualatex I have become aware
>> that \luatexUmathcharnumdef etc... have been removed and \Umathcharnumdef etc...
>> must be used  instead.
>>
>> as I didn't find the info immediately I am asking here: how should I test
>> (version number, date etc...)
>> when one should use \luatexUmathcharnumdef and
>> when on should use \Umathcharnumdef ?
>>
>> or perhaps \Umathcharnumdef was always ok ?
>>
>> I would like to not break people's old installation thus I would be
>> glad to use \Umathcharnumdef  if I am told it works with all earlier lualatex
>>
>> best wishes
>>
>> Jean-Fran?ois
> 
> Hello Jean-Fran?ois,
> 
> The 'real' names of the primitives have always been just \Umath... For
> some time they've been enabled with the "luatex" prefix.. The LaTeX team
> have recently taken a more 'active' interest in directly supporting
> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
> As part of that process, we've revised the approach to the newer
> primitives and dropped the prefix 'out of the box'.
> 
> For code that needs to work both with older (pre 2015/10/01) and newer
> (2015/10/01 onward) kernel releases, adding
> 
>     \directlua{
>       tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>     }
> 
> (for just the Umath set) will do the job. Alternatively, if the code in
> your package gets modified to drop the prefix then
> 
>     \directlua{
>       tex.enableprimitives("", tex.extraprimitives("Umath"))
>     }
> 
> will ensure that the 'natural' names are available with older kernel
> releases.
> 
> Regards,
> 
> Joseph

As I see David has noted, the \Umath... set have been available under
their 'natural' names since they were made available separately from
other LuaTeX additions. As such, any at all recent LuaLaTeX will have
them available directly.

Joseph



From jfbu at free.fr  Thu Oct 15 19:35:03 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 19:35:03 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <561FE25D.7060003@morningstar2.co.uk>
References: <561FD62B.3070307@free.fr> <561FE25D.7060003@morningstar2.co.uk>
Message-ID: <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>

Hi Joseph

Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :

>> 
> 
> Hello Jean-Fran?ois,
> 
> The 'real' names of the primitives have always been just \Umath... For
> some time they've been enabled with the "luatex" prefix.. The LaTeX team
> have recently taken a more 'active' interest in directly supporting
> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
> As part of that process, we've revised the approach to the newer
> primitives and dropped the prefix 'out of the box'.
> 
> For code that needs to work both with older (pre 2015/10/01) and newer
> (2015/10/01 onward) kernel releases, adding
> 
>    \directlua{
>      tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>    }
> 
> (for just the Umath set) will do the job. Alternatively, if the code in
> your package gets modified to drop the prefix then
> 
>    \directlua{
>      tex.enableprimitives("", tex.extraprimitives("Umath"))
>    }
> 
> will ensure that the 'natural' names are available with older kernel
> releases.


OK, let's see if I get you right: I remove from mathastext.sty
all "luatex" prefixes, but also I need to add 

   \directlua{
     tex.enableprimitives("", tex.extraprimitives("Umath"))
   }

to mathastext.sty if it detects luatex, 

so as to be sure the new version of the package will work also
with older LaTeX releases ?

is that right ?

best,

Jean-Fran?ois

From d.p.carlisle at gmail.com  Thu Oct 15 19:37:52 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Thu, 15 Oct 2015 18:37:52 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
References: <561FD62B.3070307@free.fr>	<561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
Message-ID: <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>

On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
> Hi Joseph
>
> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>
>>>
>>
>> Hello Jean-Fran?ois,
>>
>> The 'real' names of the primitives have always been just \Umath... For
>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>> have recently taken a more 'active' interest in directly supporting
>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>> As part of that process, we've revised the approach to the newer
>> primitives and dropped the prefix 'out of the box'.
>>
>> For code that needs to work both with older (pre 2015/10/01) and newer
>> (2015/10/01 onward) kernel releases, adding
>>
>>    \directlua{
>>      tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>    }
>>
>> (for just the Umath set) will do the job. Alternatively, if the code in
>> your package gets modified to drop the prefix then
>>
>>    \directlua{
>>      tex.enableprimitives("", tex.extraprimitives("Umath"))
>>    }
>>
>> will ensure that the 'natural' names are available with older kernel
>> releases.
>
>
> OK, let's see if I get you right: I remove from mathastext.sty
> all "luatex" prefixes, but also I need to add
>
>    \directlua{
>      tex.enableprimitives("", tex.extraprimitives("Umath"))
>    }
>
> to mathastext.sty if it detects luatex,
>
> so as to be sure the new version of the package will work also
> with older LaTeX releases ?
>
> is that right ?
>
> best,
>
> Jean-Fran?ois


That works in general for primitives that were previously prefixed
\luatex... but the \Umath... names are special in that they were
previously available both prefixed and not prefixed, so you can just
use the unprefixed ones.

David


From jfbu at free.fr  Thu Oct 15 19:43:11 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 19:43:11 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
References: <561FD62B.3070307@free.fr>	<561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
Message-ID: <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>


Le 15 oct. 2015 ? 19:37, David Carlisle <d.p.carlisle at gmail.com> a ?crit :

> On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
>> Hi Joseph
>> 
>> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>> 
>>>> 
>>> 
>>> Hello Jean-Fran?ois,
>>> 
>>> The 'real' names of the primitives have always been just \Umath... For
>>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>>> have recently taken a more 'active' interest in directly supporting
>>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>>> As part of that process, we've revised the approach to the newer
>>> primitives and dropped the prefix 'out of the box'.
>>> 
>>> For code that needs to work both with older (pre 2015/10/01) and newer
>>> (2015/10/01 onward) kernel releases, adding
>>> 
>>>   \directlua{
>>>     tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>>   }
>>> 
>>> (for just the Umath set) will do the job. Alternatively, if the code in
>>> your package gets modified to drop the prefix then
>>> 
>>>   \directlua{
>>>     tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>   }
>>> 
>>> will ensure that the 'natural' names are available with older kernel
>>> releases.
>> 
>> 
>> OK, let's see if I get you right: I remove from mathastext.sty
>> all "luatex" prefixes, but also I need to add
>> 
>>   \directlua{
>>     tex.enableprimitives("", tex.extraprimitives("Umath"))
>>   }
>> 
>> to mathastext.sty if it detects luatex,
>> 
>> so as to be sure the new version of the package will work also
>> with older LaTeX releases ?
>> 
>> is that right ?
>> 
>> best,
>> 
>> Jean-Fran?ois
> 
> 
> That works in general for primitives that were previously prefixed
> \luatex... but the \Umath... names are special in that they were
> previously available both prefixed and not prefixed, so you can just
> use the unprefixed ones.
> 

Hi David,

ok, this is very clear, thanks, sorry if I have one last question does
"previously available" mean "all the way back to 2011" ? 

I can't test it on my laptop which only has TeXLive 2012 and later,
and I would like not to break installations as far back as 2011,

best

Jean-Fran?ois

From jfbu at free.fr  Thu Oct 15 19:58:51 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 19:58:51 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
References: <561FD62B.3070307@free.fr>	<561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
 <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
Message-ID: <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>


Le 15 oct. 2015 ? 19:43, jfbu <jfbu at free.fr> a ?crit :

> 
> Le 15 oct. 2015 ? 19:37, David Carlisle <d.p.carlisle at gmail.com> a ?crit :
> 
>> On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
>>> Hi Joseph
>>> 
>>> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>>> 
>>>>> 
>>>> 
>>>> Hello Jean-Fran?ois,
>>>> 
>>>> The 'real' names of the primitives have always been just \Umath... For
>>>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>>>> have recently taken a more 'active' interest in directly supporting
>>>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>>>> As part of that process, we've revised the approach to the newer
>>>> primitives and dropped the prefix 'out of the box'.
>>>> 
>>>> For code that needs to work both with older (pre 2015/10/01) and newer
>>>> (2015/10/01 onward) kernel releases, adding
>>>> 
>>>>  \directlua{
>>>>    tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>>>  }
>>>> 
>>>> (for just the Umath set) will do the job. Alternatively, if the code in
>>>> your package gets modified to drop the prefix then
>>>> 
>>>>  \directlua{
>>>>    tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>  }
>>>> 
>>>> will ensure that the 'natural' names are available with older kernel
>>>> releases.
>>> 
>>> 
>>> OK, let's see if I get you right: I remove from mathastext.sty
>>> all "luatex" prefixes, but also I need to add
>>> 
>>>  \directlua{
>>>    tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>  }
>>> 
>>> to mathastext.sty if it detects luatex,
>>> 
>>> so as to be sure the new version of the package will work also
>>> with older LaTeX releases ?
>>> 
>>> is that right ?
>>> 
>>> best,
>>> 
>>> Jean-Fran?ois
>> 
>> 
>> That works in general for primitives that were previously prefixed
>> \luatex... but the \Umath... names are special in that they were
>> previously available both prefixed and not prefixed, so you can just
>> use the unprefixed ones.
>> 
> 
> Hi David,
> 
> ok, this is very clear, thanks, sorry if I have one last question does
> "previously available" mean "all the way back to 2011" ? 
> 
> I can't test it on my laptop which only has TeXLive 2012 and later,
> and I would like not to break installations as far back as 2011,
> 
> best
> 
> Jean-Fran?ois

Hi David/Joseph,

[ I apologize to the list, perhaps I should move this discussion to 
a LaTeX list ]

sorry again, but texdoc ltnews did not give me the following info:

should I also remove the "xetex" prefixes and use "\Umathchardef" 
also under XeLaTeX ? from texdoc xetex, the primitives are there
only with "U" prefix.

best,

Jean-Fran?ois



From jfbu at free.fr  Thu Oct 15 20:20:58 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 20:20:58 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>
References: <561FD62B.3070307@free.fr>	<561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
 <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
 <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>
Message-ID: <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>


Le 15 oct. 2015 ? 19:58, jfbu <jfbu at free.fr> a ?crit :

> 
> Le 15 oct. 2015 ? 19:43, jfbu <jfbu at free.fr> a ?crit :
> 
>> 
>> Le 15 oct. 2015 ? 19:37, David Carlisle <d.p.carlisle at gmail.com> a ?crit :
>> 
>>> On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
>>>> Hi Joseph
>>>> 
>>>> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>>>> 
>>>>>> 
>>>>> 
>>>>> Hello Jean-Fran?ois,
>>>>> 
>>>>> The 'real' names of the primitives have always been just \Umath... For
>>>>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>>>>> have recently taken a more 'active' interest in directly supporting
>>>>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>>>>> As part of that process, we've revised the approach to the newer
>>>>> primitives and dropped the prefix 'out of the box'.
>>>>> 
>>>>> For code that needs to work both with older (pre 2015/10/01) and newer
>>>>> (2015/10/01 onward) kernel releases, adding
>>>>> 
>>>>> \directlua{
>>>>>   tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>>>> }
>>>>> 
>>>>> (for just the Umath set) will do the job. Alternatively, if the code in
>>>>> your package gets modified to drop the prefix then
>>>>> 
>>>>> \directlua{
>>>>>   tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>> }
>>>>> 
>>>>> will ensure that the 'natural' names are available with older kernel
>>>>> releases.
>>>> 
>>>> 
>>>> OK, let's see if I get you right: I remove from mathastext.sty
>>>> all "luatex" prefixes, but also I need to add
>>>> 
>>>> \directlua{
>>>>   tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>> }
>>>> 
>>>> to mathastext.sty if it detects luatex,
>>>> 
>>>> so as to be sure the new version of the package will work also
>>>> with older LaTeX releases ?
>>>> 
>>>> is that right ?
>>>> 
>>>> best,
>>>> 
>>>> Jean-Fran?ois
>>> 
>>> 
>>> That works in general for primitives that were previously prefixed
>>> \luatex... but the \Umath... names are special in that they were
>>> previously available both prefixed and not prefixed, so you can just
>>> use the unprefixed ones.
>>> 
>> 
>> Hi David,
>> 
>> ok, this is very clear, thanks, sorry if I have one last question does
>> "previously available" mean "all the way back to 2011" ? 
>> 
>> I can't test it on my laptop which only has TeXLive 2012 and later,
>> and I would like not to break installations as far back as 2011,
>> 
>> best
>> 
>> Jean-Fran?ois
> 
> Hi David/Joseph,
> 
> [ I apologize to the list, perhaps I should move this discussion to 
> a LaTeX list ]
> 
> sorry again, but texdoc ltnews did not give me the following info:
> 
> should I also remove the "xetex" prefixes and use "\Umathchardef" 
> also under XeLaTeX ? from texdoc xetex, the primitives are there
> only with "U" prefix.
> 
> best,
> 
> Jean-Fran?ois
> 

Hi all,

sorry for all the fuss. I will do

  \let\mst at Umathcharnumdef\Umathcharnumdef
  \let\mst at Umathcodenum\Umathcodenum
  \let\mst at Umathcode\Umathcode
  \let\mst at Umathchardef\Umathchardef

then test if \mst at Umathcode is \undefined
and in the latter case use either "luatexU" or "XeTeX"
prefix depending on the engine,

besides I am sorry about the TL2011 thing, because
regarding LuaLaTeX the doc of mathastext says 
already TL2013 or later is needed.

mathastext.sty will be leaner as I can not
treat identically both unicode engines

best wishes

Jean-Fran?ois

From jfbu at free.fr  Thu Oct 15 20:21:46 2015
From: jfbu at free.fr (jfbu)
Date: Thu, 15 Oct 2015 20:21:46 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>
References: <561FD62B.3070307@free.fr>	<561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
 <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
 <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>
 <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>
Message-ID: <1953F980-FDFE-4198-9D22-35AE53C434BF@free.fr>


Le 15 oct. 2015 ? 20:20, jfbu <jfbu at free.fr> a ?crit :

> mathastext.sty will be leaner as I can not
> treat identically both unicode engines

as I can *now* treat identically ...

ok, good night,

JF

From joseph.wright at morningstar2.co.uk  Thu Oct 15 22:05:51 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Thu, 15 Oct 2015 21:05:51 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>
References: <561FD62B.3070307@free.fr> <561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
 <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
 <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>
 <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>
Message-ID: <5620071F.6040105@morningstar2.co.uk>

On 15/10/2015 19:20, jfbu wrote:
> 
> Le 15 oct. 2015 ? 19:58, jfbu <jfbu at free.fr> a ?crit :
> 
>>
>> Le 15 oct. 2015 ? 19:43, jfbu <jfbu at free.fr> a ?crit :
>>
>>>
>>> Le 15 oct. 2015 ? 19:37, David Carlisle <d.p.carlisle at gmail.com> a ?crit :
>>>
>>>> On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
>>>>> Hi Joseph
>>>>>
>>>>> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>>>>>
>>>>>>>
>>>>>>
>>>>>> Hello Jean-Fran?ois,
>>>>>>
>>>>>> The 'real' names of the primitives have always been just \Umath... For
>>>>>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>>>>>> have recently taken a more 'active' interest in directly supporting
>>>>>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>>>>>> As part of that process, we've revised the approach to the newer
>>>>>> primitives and dropped the prefix 'out of the box'.
>>>>>>
>>>>>> For code that needs to work both with older (pre 2015/10/01) and newer
>>>>>> (2015/10/01 onward) kernel releases, adding
>>>>>>
>>>>>> \directlua{
>>>>>>   tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>>>>> }
>>>>>>
>>>>>> (for just the Umath set) will do the job. Alternatively, if the code in
>>>>>> your package gets modified to drop the prefix then
>>>>>>
>>>>>> \directlua{
>>>>>>   tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>>> }
>>>>>>
>>>>>> will ensure that the 'natural' names are available with older kernel
>>>>>> releases.
>>>>>
>>>>>
>>>>> OK, let's see if I get you right: I remove from mathastext.sty
>>>>> all "luatex" prefixes, but also I need to add
>>>>>
>>>>> \directlua{
>>>>>   tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>> }
>>>>>
>>>>> to mathastext.sty if it detects luatex,
>>>>>
>>>>> so as to be sure the new version of the package will work also
>>>>> with older LaTeX releases ?
>>>>>
>>>>> is that right ?
>>>>>
>>>>> best,
>>>>>
>>>>> Jean-Fran?ois
>>>>
>>>>
>>>> That works in general for primitives that were previously prefixed
>>>> \luatex... but the \Umath... names are special in that they were
>>>> previously available both prefixed and not prefixed, so you can just
>>>> use the unprefixed ones.
>>>>
>>>
>>> Hi David,
>>>
>>> ok, this is very clear, thanks, sorry if I have one last question does
>>> "previously available" mean "all the way back to 2011" ? 
>>>
>>> I can't test it on my laptop which only has TeXLive 2012 and later,
>>> and I would like not to break installations as far back as 2011,
>>>
>>> best
>>>
>>> Jean-Fran?ois
>>
>> Hi David/Joseph,
>>
>> [ I apologize to the list, perhaps I should move this discussion to 
>> a LaTeX list ]
>>
>> sorry again, but texdoc ltnews did not give me the following info:
>>
>> should I also remove the "xetex" prefixes and use "\Umathchardef" 
>> also under XeLaTeX ? from texdoc xetex, the primitives are there
>> only with "U" prefix.
>>
>> best,
>>
>> Jean-Fran?ois
>>
> 
> Hi all,
> 
> sorry for all the fuss. I will do
> 
>   \let\mst at Umathcharnumdef\Umathcharnumdef
>   \let\mst at Umathcodenum\Umathcodenum
>   \let\mst at Umathcode\Umathcode
>   \let\mst at Umathchardef\Umathchardef
> 
> then test if \mst at Umathcode is \undefined
> and in the latter case use either "luatexU" or "XeTeX"
> prefix depending on the engine,
> 
> besides I am sorry about the TL2011 thing, because
> regarding LuaLaTeX the doc of mathastext says 
> already TL2013 or later is needed.
> 
> mathastext.sty will be leaner as I can not
> treat identically both unicode engines
> 
> best wishes
> 
> Jean-Fran?ois

>From TL2013 both XeTeX and LuaTeX have \Umath...

Joseph


From jfbu at free.fr  Fri Oct 16 08:42:18 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 16 Oct 2015 08:42:18 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <5620071F.6040105@morningstar2.co.uk>
References: <561FD62B.3070307@free.fr> <561FE25D.7060003@morningstar2.co.uk>
 <B8D24E3B-B6B0-47DD-B677-391B3261D0DE@free.fr>
 <CAEW6iOj8mULkqzXTdz3B49U6+K35fwD9t5MWx_aN811f0nsXPQ@mail.gmail.com>
 <27CB475D-4104-42D2-9FC5-ADECF416927B@free.fr>
 <483C4E74-489A-48B1-8EB9-93EDA8C4A21F@free.fr>
 <4DDB45EB-26EF-4FAC-B74A-BAF4D2B3D5B6@free.fr>
 <5620071F.6040105@morningstar2.co.uk>
Message-ID: <C203EAE7-26BC-49B6-B051-A60DCFF986D5@free.fr>


Le 15 oct. 2015 ? 22:05, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :

> On 15/10/2015 19:20, jfbu wrote:
>> 
>> Le 15 oct. 2015 ? 19:58, jfbu <jfbu at free.fr> a ?crit :
>> 
>>> 
>>> Le 15 oct. 2015 ? 19:43, jfbu <jfbu at free.fr> a ?crit :
>>> 
>>>> 
>>>> Le 15 oct. 2015 ? 19:37, David Carlisle <d.p.carlisle at gmail.com> a ?crit :
>>>> 
>>>>> On 15 October 2015 at 18:35, jfbu <jfbu at free.fr> wrote:
>>>>>> Hi Joseph
>>>>>> 
>>>>>> Le 15 oct. 2015 ? 19:29, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :
>>>>>> 
>>>>>>>> 
>>>>>>> 
>>>>>>> Hello Jean-Fran?ois,
>>>>>>> 
>>>>>>> The 'real' names of the primitives have always been just \Umath... For
>>>>>>> some time they've been enabled with the "luatex" prefix.. The LaTeX team
>>>>>>> have recently taken a more 'active' interest in directly supporting
>>>>>>> LuaTeX (and XeTeX) by modifying latex.ltx to 'know' about these engines.
>>>>>>> As part of that process, we've revised the approach to the newer
>>>>>>> primitives and dropped the prefix 'out of the box'.
>>>>>>> 
>>>>>>> For code that needs to work both with older (pre 2015/10/01) and newer
>>>>>>> (2015/10/01 onward) kernel releases, adding
>>>>>>> 
>>>>>>> \directlua{
>>>>>>>  tex.enableprimitives("luatex", tex.extraprimitives("Umath"))
>>>>>>> }
>>>>>>> 
>>>>>>> (for just the Umath set) will do the job. Alternatively, if the code in
>>>>>>> your package gets modified to drop the prefix then
>>>>>>> 
>>>>>>> \directlua{
>>>>>>>  tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>>>> }
>>>>>>> 
>>>>>>> will ensure that the 'natural' names are available with older kernel
>>>>>>> releases.
>>>>>> 
>>>>>> 
>>>>>> OK, let's see if I get you right: I remove from mathastext.sty
>>>>>> all "luatex" prefixes, but also I need to add
>>>>>> 
>>>>>> \directlua{
>>>>>>  tex.enableprimitives("", tex.extraprimitives("Umath"))
>>>>>> }
>>>>>> 
>>>>>> to mathastext.sty if it detects luatex,
>>>>>> 
>>>>>> so as to be sure the new version of the package will work also
>>>>>> with older LaTeX releases ?
>>>>>> 
>>>>>> is that right ?
>>>>>> 
>>>>>> best,
>>>>>> 
>>>>>> Jean-Fran?ois
>>>>> 
>>>>> 
>>>>> That works in general for primitives that were previously prefixed
>>>>> \luatex... but the \Umath... names are special in that they were
>>>>> previously available both prefixed and not prefixed, so you can just
>>>>> use the unprefixed ones.
>>>>> 
>>>> 
>>>> Hi David,
>>>> 
>>>> ok, this is very clear, thanks, sorry if I have one last question does
>>>> "previously available" mean "all the way back to 2011" ? 
>>>> 
>>>> I can't test it on my laptop which only has TeXLive 2012 and later,
>>>> and I would like not to break installations as far back as 2011,
>>>> 
>>>> best
>>>> 
>>>> Jean-Fran?ois
>>> 
>>> Hi David/Joseph,
>>> 
>>> [ I apologize to the list, perhaps I should move this discussion to 
>>> a LaTeX list ]
>>> 
>>> sorry again, but texdoc ltnews did not give me the following info:
>>> 
>>> should I also remove the "xetex" prefixes and use "\Umathchardef" 
>>> also under XeLaTeX ? from texdoc xetex, the primitives are there
>>> only with "U" prefix.
>>> 
>>> best,
>>> 
>>> Jean-Fran?ois
>>> 
>> 
>> Hi all,
>> 
>> sorry for all the fuss. I will do
>> 
>>  \let\mst at Umathcharnumdef\Umathcharnumdef
>>  \let\mst at Umathcodenum\Umathcodenum
>>  \let\mst at Umathcode\Umathcode
>>  \let\mst at Umathchardef\Umathchardef
>> 
>> then test if \mst at Umathcode is \undefined
>> and in the latter case use either "luatexU" or "XeTeX"
>> prefix depending on the engine,
>> 
>> besides I am sorry about the TL2011 thing, because
>> regarding LuaLaTeX the doc of mathastext says 
>> already TL2013 or later is needed.
>> 
>> mathastext.sty will be leaner as I can not
>> treat identically both unicode engines
>> 
>> best wishes
>> 
>> Jean-Fran?ois
> From TL2013 both XeTeX and LuaTeX have \Umath...
> 
> Joseph
> 

Hi Joseph, 

thanks for this extra info. It is only
for LuaTex that I needed not farther back than 2013,
for XeLaTeX I needed more, in fact 2010, because
mathastext first appeared in 2011 at the time of TL2010.

the current XeTeX manual explains the adoption
of the U names starting with revision number 9999
and David and your explanations gave me the
explanations for the LaTeX interface to LuaTeX.

I chose to define by default aliases via \let
to the "U" named primitives, check after that
if \Umathcharnumdef is undefined
and in that case re \let the aliases to either the
"luatexU" or "XeTeX" primitives. The former should
never happen from David explanations and yours,
but that's ok to have a bit of superfluous code
in mathastext, anyhow it has other dubious portions, when
I coded its first version I barely knew what a (La)TeX macro
was, I was imitating pieces of codes I saw in other packages
(and wasn't even aware something like source2e.pdf existed),
and as performance is not a relevant issue at this level,
I am only looking for code that works.

best regards

Jean-Fran?ois



From luatex at nililand.de  Fri Oct 16 09:47:19 2015
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 16 Oct 2015 09:47:19 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
Message-ID: <7e80ufkbn3e4$.dlg@nililand.de>

Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:

>> or perhaps \Umathcharnumdef was always ok ?
> 
> yes, it was, the Umath... commands were always available with their
> basic luatex names and also prefixed luatex.

That's not true. In a texlive 2012

\documentclass{article}

\begin{document}
\show\Umathcharnumdef
\show\luatexUmathcharnumdef
\end{document}

gives

> \Umathcharnumdef=undefined.
l.36 \show\Umathcharnumdef

?
> \luatexUmathcharnumdef=\Umathcharnumdef.
l.37 \show\luatexUmathcharnumdef

>From 2013 on both are defined, in texlive 2015 and miktex only
\Umathcharnumdef is defined. In the case of miktex I have no means
to check how older lualatex.ini handled it.

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From d.p.carlisle at gmail.com  Fri Oct 16 09:53:40 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 16 Oct 2015 08:53:40 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <7e80ufkbn3e4$.dlg@nililand.de>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
Message-ID: <CAEW6iOgdupJJS7+_UdYTwWPeo+yr04buXOEuNJqjwC=mTm5M_A@mail.gmail.com>

On 16 October 2015 at 08:47, Ulrike Fischer <luatex at nililand.de> wrote:
> Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:
>
>>> or perhaps \Umathcharnumdef was always ok ?
>>
>> yes, it was, the Umath... commands were always available with their
>> basic luatex names and also prefixed luatex.
>
> That's not true. In a texlive 2012
> ....



Sigh. Sorry, thanks for the correction. I could have sworn it wasn't that way
but I'm happy to believe you!

Just goes to show how confusing this prefixing stuff is, will be
simpler going forward
as latex doesn't prefix things "luatex" and luatex is prefixing less
things with "pdf":-)

David

From luatex at nililand.de  Fri Oct 16 10:04:39 2015
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 16 Oct 2015 10:04:39 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <CAEW6iOgdupJJS7+_UdYTwWPeo+yr04buXOEuNJqjwC=mTm5M_A@mail.gmail.com>
Message-ID: <oxlpdfyhgcea.dlg@nililand.de>

Am Fri, 16 Oct 2015 08:53:40 +0100 schrieb David Carlisle:

> Just goes to show how confusing this prefixing stuff is, will be
> simpler going forward
> as latex doesn't prefix things "luatex" and luatex is prefixing less
> things with "pdf":-)

Yes, that will be easier. But the danger is naturally that it is
getting more difficult to see that something is a primitive. Module
prefixes like in expl3 have their use ...

Are all these \Umath etc primitives using the same syntax in both
engines? 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From joseph.wright at morningstar2.co.uk  Fri Oct 16 10:07:18 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 16 Oct 2015 09:07:18 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <7e80ufkbn3e4$.dlg@nililand.de>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
Message-ID: <5620B036.5030005@morningstar2.co.uk>

On 16/10/2015 08:47, Ulrike Fischer wrote:
> Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:
> 
>>> or perhaps \Umathcharnumdef was always ok ?
>>
>> yes, it was, the Umath... commands were always available with their
>> basic luatex names and also prefixed luatex.
> 
> That's not true. In a texlive 2012
> 
> \documentclass{article}
> 
> \begin{document}
> \show\Umathcharnumdef
> \show\luatexUmathcharnumdef
> \end{document}
> 
> gives
> 
>> \Umathcharnumdef=undefined.
> l.36 \show\Umathcharnumdef
> 
> ?
>> \luatexUmathcharnumdef=\Umathcharnumdef.
> l.37 \show\luatexUmathcharnumdef

For LuaTeX

    \directlua{
      local i
      local t = { }
      for _,i in pairs(tex.extraprimitives("luatex")) do
        if string.match(i, "^U") then
          table.insert(t, i)
        end
      end
      tex.enableprimitives("", tex.extraprimitives("Umath"))
      tex.enableprimitives("", t)
    }

will enable all of the \U... primitives with their 'natural names with
older LuaTeX releases and newer ones: they used to be just part of the
"luatex" list. So something like

    \ifdefined\directlua
      \directlua{
        local i
        local t = { }
        for _,i in pairs(tex.extraprimitives("luatex")) do
          if string.match(i,"^U") then
            table.insert(t,i)
          end
        end
        tex.enableprimitives("", tex.extraprimitives("Umath"))
        tex.enableprimitives("", t)
      }
    \else
      \ifdefined\XeTeXmathcode
        \let\Umathcode\XeTeXmathcode
        \let\Umathcodenum\XeTeXmathcodenum
        \let\Umathchar\XeTeXmathchar
        \let\Umathcharnum\XeTeXmathcharnum
        \let\Umathchardef\XeTeXmathchardef
        \let\Umathcharnumdef\XeTeXmathcharnumdef
        \let\Udelcode\XeTeXdelcode
        \let\Udelcodenum\XeTeXdelcodenum
        \let\Udelimiter\XeTeXdelimiter
        \let\Umathaccent\XeTeXmathaccent
        \let\Uradical\XeTeXradical
      \fi
    \fi

should get you \U... with all possible supported engines.

Joseph

From joseph.wright at morningstar2.co.uk  Fri Oct 16 10:10:29 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 16 Oct 2015 09:10:29 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <oxlpdfyhgcea.dlg@nililand.de>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <CAEW6iOgdupJJS7+_UdYTwWPeo+yr04buXOEuNJqjwC=mTm5M_A@mail.gmail.com>
 <oxlpdfyhgcea.dlg@nililand.de>
Message-ID: <5620B0F5.5000600@morningstar2.co.uk>

On 16/10/2015 09:04, Ulrike Fischer wrote:
> Are all these \Umath etc primitives using the same syntax in both
> engines? 


All of the \U... primitives which are defined by XeTeX have the same
syntax as those in LuaTeX. Note though that XeTeX uses far fewer of
these (and does others using \fontdimen data).

Joseph


From d.p.carlisle at gmail.com  Fri Oct 16 10:13:11 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 16 Oct 2015 09:13:11 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <oxlpdfyhgcea.dlg@nililand.de>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <CAEW6iOgdupJJS7+_UdYTwWPeo+yr04buXOEuNJqjwC=mTm5M_A@mail.gmail.com>
 <oxlpdfyhgcea.dlg@nililand.de>
Message-ID: <CAEW6iOjT6DVaHD9PB6cN-u0M=qxK=1r3x46dzAXEBk3D-KMCsg@mail.gmail.com>

On 16 October 2015 at 09:04, Ulrike Fischer <luatex at nililand.de> wrote:
> Am Fri, 16 Oct 2015 08:53:40 +0100 schrieb David Carlisle:
>
>> Just goes to show how confusing this prefixing stuff is, will be
>> simpler going forward
>> as latex doesn't prefix things "luatex" and luatex is prefixing less
>> things with "pdf":-)
>
> Yes, that will be easier. But the danger is naturally that it is
> getting more difficult to see that something is a primitive. Module
> prefixes like in expl3 have their use ...
>
> Are all these \Umath etc primitives using the same syntax in both
> engines?
>

Mostly.

there are some edge cases where one works and the other gives an error
compare on this for example

https://github.com/davidcarlisle/utex/blob/master/testfiles/udelcode-002.lvt

But I think in all cases where they both give a reasonable result, the
result is the same.

(I think I've reported all the things shown up by the tests in
https://github.com/davidcarlisle/utex/
to one engine tracker all the other although I haven't checked recently)

David

From jfbu at free.fr  Fri Oct 16 10:35:49 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 16 Oct 2015 10:35:49 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <7e80ufkbn3e4$.dlg@nililand.de>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
Message-ID: <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>


Le 16 oct. 2015 ? 09:47, Ulrike Fischer <luatex at nililand.de> a ?crit :

> Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:
> 
>>> or perhaps \Umathcharnumdef was always ok ?
>> 
>> yes, it was, the Umath... commands were always available with their
>> basic luatex names and also prefixed luatex.
> 
> That's not true. In a texlive 2012
> 
> \documentclass{article}
> 
> \begin{document}
> \show\Umathcharnumdef
> \show\luatexUmathcharnumdef
> \end{document}
> 
> gives
> 
>> \Umathcharnumdef=undefined.
> l.36 \show\Umathcharnumdef
> 
> ?
>> \luatexUmathcharnumdef=\Umathcharnumdef.
> l.37 \show\luatexUmathcharnumdef

The file 
/usr/local/texlive/2012/texmf-dist/tex/latex/latexconfig/lualatexiniconfig.tex
says that 
>   % etex and pdftex primitives are enabled without prefixing
>   % as well as extented Unicode math primitives (see below)
> 

but as your test file shows this was not the case for \Umathcharnumdef
(and also \Umathcodenum which I tested).

I recall now that mathastext prior to TeXLive 2013 did not use
\luatexUmathcharnumdef because the right side of the assignment would have
been \luatexUmathcodenum`\-\relax, but \luatexUmathcodenum back then
did not always return a Unicode mathcode.

regarding
> Are all these \Umath etc primitives using the same syntax in both
> engines? 

mathastext.sty fortunately does not deal with \Udelcode, \Udelcodenum
from David's answer, it uses (aliases to)
\Umathcharnumdef, \Umathcodenum, \Umathcode
and \Umathchardef with the same syntax for both engines. 

I tested on TL2012 and TL2015 before pushing to CTAN yesterday.

Apart from that I am curious to get explanation as to your TL2012 result
> \Umathcharnumdef=undefined.
l.4 \show\Umathcharnumdef
                         
> \luatexUmathcharnumdef=\Umathcharnumdef.
l.5 \show\luatexUmathcharnumdef

which is strange (and the \luatexUmathcharnumdef does work)

best
Jean-Fran?ois



From jfbu at free.fr  Fri Oct 16 10:44:53 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 16 Oct 2015 10:44:53 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
Message-ID: <4874F46F-DB7B-4D3D-B135-F5A0F18C2548@free.fr>


Le 16 oct. 2015 ? 10:35, jfbu <jfbu at free.fr> a ?crit :

> Apart from that I am curious to get explanation as to your TL2012 result
>> \Umathcharnumdef=undefined.
> l.4 \show\Umathcharnumdef
> 
>> \luatexUmathcharnumdef=\Umathcharnumdef.
> l.5 \show\luatexUmathcharnumdef
> 
> which is strange (and the \luatexUmathcharnumdef does work)

ah ok sorry

\let\y\box

\let\box\undefined

\show\box

\show\y

produces this kind of things

best wishes

Jean-Fran?ois



From joseph.wright at morningstar2.co.uk  Fri Oct 16 10:45:18 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 16 Oct 2015 09:45:18 +0100
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
Message-ID: <5620B91E.9010501@morningstar2.co.uk>

On 16/10/2015 09:35, jfbu wrote:
> 
> Le 16 oct. 2015 ? 09:47, Ulrike Fischer <luatex at nililand.de> a ?crit :
> 
>> Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:
>>
>>>> or perhaps \Umathcharnumdef was always ok ?
>>>
>>> yes, it was, the Umath... commands were always available with their
>>> basic luatex names and also prefixed luatex.
>>
>> That's not true. In a texlive 2012
>>
>> \documentclass{article}
>>
>> \begin{document}
>> \show\Umathcharnumdef
>> \show\luatexUmathcharnumdef
>> \end{document}
>>
>> gives
>>
>>> \Umathcharnumdef=undefined.
>> l.36 \show\Umathcharnumdef
>>
>> ?
>>> \luatexUmathcharnumdef=\Umathcharnumdef.
>> l.37 \show\luatexUmathcharnumdef
> 
> The file 
> /usr/local/texlive/2012/texmf-dist/tex/latex/latexconfig/lualatexiniconfig.tex
> says that 
>>   % etex and pdftex primitives are enabled without prefixing
>>   % as well as extented Unicode math primitives (see below)
>>
> 
> but as your test file shows this was not the case for \Umathcharnumdef
> (and also \Umathcodenum which I tested).

In older versions of LuaTeX, the \U... primitives were part of the
"luatex" list so were enabled with the \luatex... prefix. Those
primitives now live in a dedicated "umath" list so cn be enabled
separately from the other LuaTeX-specific ones.

> I recall now that mathastext prior to TeXLive 2013 did not use
> \luatexUmathcharnumdef because the right side of the assignment would have
> been \luatexUmathcodenum`\-\relax, but \luatexUmathcodenum back then
> did not always return a Unicode mathcode.

This is the issue with supporting older versions of a developing engine!
I'd suggest you strongly consider saying that only newer releases are
supported. (The LaTeX team are considering much the same for
expl3/LuaTeX support.)

Joseph


From jfbu at free.fr  Fri Oct 16 11:41:34 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 16 Oct 2015 11:41:34 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <5620B91E.9010501@morningstar2.co.uk>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
 <5620B91E.9010501@morningstar2.co.uk>
Message-ID: <3469BDDD-B3C4-4461-BFC3-4299E497456F@free.fr>


Le 16 oct. 2015 ? 10:45, Joseph Wright <joseph.wright at morningstar2.co.uk> a ?crit :

> On 16/10/2015 09:35, jfbu wrote:
>> 
>> Le 16 oct. 2015 ? 09:47, Ulrike Fischer <luatex at nililand.de> a ?crit :
>> 
>>> Am Thu, 15 Oct 2015 18:18:58 +0100 schrieb David Carlisle:
>>> 
>>>>> or perhaps \Umathcharnumdef was always ok ?
>>>> 
>>>> yes, it was, the Umath... commands were always available with their
>>>> basic luatex names and also prefixed luatex.
>>> 
>>> That's not true. In a texlive 2012
>>> 
>>> \documentclass{article}
>>> 
>>> \begin{document}
>>> \show\Umathcharnumdef
>>> \show\luatexUmathcharnumdef
>>> \end{document}
>>> 
>>> gives
>>> 
>>>> \Umathcharnumdef=undefined.
>>> l.36 \show\Umathcharnumdef
>>> 
>>> ?
>>>> \luatexUmathcharnumdef=\Umathcharnumdef.
>>> l.37 \show\luatexUmathcharnumdef
>> 
>> The file 
>> /usr/local/texlive/2012/texmf-dist/tex/latex/latexconfig/lualatexiniconfig.tex
>> says that 
>>>  % etex and pdftex primitives are enabled without prefixing
>>>  % as well as extented Unicode math primitives (see below)
>>> 
>> 
>> but as your test file shows this was not the case for \Umathcharnumdef
>> (and also \Umathcodenum which I tested).
> 
> In older versions of LuaTeX, the \U... primitives were part of the
> "luatex" list so were enabled with the \luatex... prefix. Those
> primitives now live in a dedicated "umath" list so cn be enabled
> separately from the other LuaTeX-specific ones.

The "umath" list in mentioned in 

/usr/local/texlive/2012/texmf-dist/tex/latex/latexconfig/lualatexiniconfig.tex

mentioned above, which has a tag
$Id: lualatexiniconfig.tex 28991 2013-01-30 20:46:39Z hosny $

and the comment seemed to say the Unicode math primitives
had been enabled without "luatex" prefix. But Ulrike's test showed
this was not accurate. But I don't want to invite people
waste their time debugging a TeXlive 2012 issue ...


> 
>> I recall now that mathastext prior to TeXLive 2013 did not use
>> \luatexUmathcharnumdef because the right side of the assignment would have
>> been \luatexUmathcodenum`\-\relax, but \luatexUmathcodenum back then
>> did not always return a Unicode mathcode.
> 
> This is the issue with supporting older versions of a developing engine!
> I'd suggest you strongly consider saying that only newer releases are
> supported. (The LaTeX team are considering much the same for
> expl3/LuaTeX support.)
> 
> Joseph


Well, my package does tell people they need LuaLaTeX from TL2013 or later,
and the latest modification impacting the package did
not come from an evolution of the engine, but from LaTeX 2015/10/01.

In principle, I understand your point, but LuaTeX having been
part of the TeX landscape for many years now, it is hard to view
it as a constantly developing engine needing the package authors
to support only the latest version and telling the users to adapt...

... as I personally was stuck for many years with a laptop on which I
would not install TeXLive 2011 or later, and although
owner of a Mac I could not use xetex (for reasons I have forgotten)
I am aware that software requirements may induce hardware incompatibilities,
and actually a lot of the computer business makes it money from that.

If the package was truly exploiting LuaTeX, the matter would be
a bit otherwise, but here it is just a question of having a minimum
of compatibility with Unicode,

best
Jean-Fran?ois



From pragma at wxs.nl  Fri Oct 16 13:15:10 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 16 Oct 2015 13:15:10 +0200
Subject: [luatex] a question about the names \Umathcharnumdef etc
In-Reply-To: <3469BDDD-B3C4-4461-BFC3-4299E497456F@free.fr>
References: <561FD62B.3070307@free.fr>
 <CAEW6iOgcL2Vj3DHT+gjeg_rHh1zU0fy0ZDxLCF_PoYy0RmFyXw@mail.gmail.com>
 <7e80ufkbn3e4$.dlg@nililand.de>
 <BD1B28DE-0C0A-4CC2-8E87-BAA609BE3C2E@free.fr>
 <5620B91E.9010501@morningstar2.co.uk>
 <3469BDDD-B3C4-4461-BFC3-4299E497456F@free.fr>
Message-ID: <5620DC3E.5010305@wxs.nl>

On 10/16/2015 11:41 AM, jfbu wrote:

 > ...

as mantioned already, it's more a latex issue than an luatex one, but as 
you say:

> Well, my package does tell people they need LuaLaTeX from TL2013 or later,
> and the latest modification impacting the package did
> not come from an evolution of the engine, but from LaTeX 2015/10/01.

but luatex is evolving ... it could be that luatex 0.81 doesn't work for 
code that hasn't be adapted (for instance, some \pdf primitives were 
promoted to core ones, so then the core macros used have to do something 
\let\pdfoo = \whatisnowfoo in it wants to be compatible)

> In principle, I understand your point, but LuaTeX having been
> part of the TeX landscape for many years now, it is hard to view
> it as a constantly developing engine needing the package authors
> to support only the latest version and telling the users to adapt...

the stable snapshots of luatex are the tex live versions and at that 
point the macro packages should be new-version aware; for intermediate 
versions you need to make sure that your old code is not conflicting 
with changes ... simply replacing a binary is dangerous (we're not 
talking of bug fixes here, but of evolution)

so, normally developers should update locally and check things ... for a 
eco system like tex it's not that natural to immediately update binaries 
and certain packages esp when they depend on each other (the same is 
true for fonts and patterns) ... regular users should lag months behind 
developers (or just take the risk of compatibility issues)

> .... as I personally was stuck for many years with a laptop on which I
> would not install TeXLive 2011 or later, and although
> owner of a Mac I could not use xetex (for reasons I have forgotten)
> I am aware that software requirements may induce hardware incompatibilities,
> and actually a lot of the computer business makes it money from that.

luatex should run on any recently modern machine (with decent memory, 
and when using lua a decent cpu cache etc)

> If the package was truly exploiting LuaTeX, the matter would be
> a bit otherwise, but here it is just a question of having a minimum
> of compatibility with Unicode,

afaiks it doesn't relate to unicode but to using the right primitives of 
macros ... one problem with newer binaries is that one can have to 
re-read the manual

Hans

ps. depending on what you use 0.82 will also bring some changes but 
david cum suis will make sure that the latex core code is ready for that

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From igor.liferenko at gmail.com  Fri Oct 30 04:23:22 2015
From: igor.liferenko at gmail.com (Igor Liferenko)
Date: Fri, 30 Oct 2015 10:23:22 +0700
Subject: [luatex] Broken UTF-8 sequences in log
Message-ID: <CAJyx3607q9MkLgNQr0jsgxN5S3WeGyaz2sLA7eczmia6Q1V2-Q@mail.gmail.com>

Hi all,

This is an example, which shows that UTF-8 output is broken:

    ????????? ? ???? ????????? =\> ???????????
    \bye

Log file attached.

As LuaTeX aims at being 100% UTF-8 on input and output, this
incomplete UTF-8 sequence in output may be an indication of
inconsistency.

Regards,
?????
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug.log
Type: text/x-log
Size: 560 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20151030/a578e356/attachment.bin>

From luigi.scarso at gmail.com  Fri Oct 30 14:24:08 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 30 Oct 2015 14:24:08 +0100
Subject: [luatex] Broken UTF-8 sequences in log
In-Reply-To: <CAJyx3607q9MkLgNQr0jsgxN5S3WeGyaz2sLA7eczmia6Q1V2-Q@mail.gmail.com>
References: <CAJyx3607q9MkLgNQr0jsgxN5S3WeGyaz2sLA7eczmia6Q1V2-Q@mail.gmail.com>
Message-ID: <CAG5iGsDFGBY03qyXdAEHjdO9t+XYa1=kmsqpWMDWrJ_2wkSQTw@mail.gmail.com>

On Fri, Oct 30, 2015 at 4:23 AM, Igor Liferenko <igor.liferenko at gmail.com>
wrote:

> Hi all,
>
> This is an example, which shows that UTF-8 output is broken:
>
>     ????????? ? ???? ????????? =\> ???????????
>     \bye
>
> Log file attached.
>
> As LuaTeX aims at being 100% UTF-8 on input and output, this
> incomplete UTF-8 sequence in output may be an indication of
> inconsistency.
>
> Regards,
> ?????
>


Thank you very much for the report. We will investigate.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151030/06528e08/attachment.html>

From luigi.scarso at gmail.com  Fri Oct 30 17:07:37 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 30 Oct 2015 17:07:37 +0100
Subject: [luatex] Broken UTF-8 sequences in log
In-Reply-To: <CAG5iGsDFGBY03qyXdAEHjdO9t+XYa1=kmsqpWMDWrJ_2wkSQTw@mail.gmail.com>
References: <CAJyx3607q9MkLgNQr0jsgxN5S3WeGyaz2sLA7eczmia6Q1V2-Q@mail.gmail.com>
 <CAG5iGsDFGBY03qyXdAEHjdO9t+XYa1=kmsqpWMDWrJ_2wkSQTw@mail.gmail.com>
Message-ID: <CAG5iGsA0_NTc4zx12NJHo55T1txP6p7qCPLKXphLEXba_A9U7A@mail.gmail.com>

On Fri, Oct 30, 2015 at 2:24 PM, luigi scarso <luigi.scarso at gmail.com>
wrote:

>
>
> On Fri, Oct 30, 2015 at 4:23 AM, Igor Liferenko <igor.liferenko at gmail.com>
> wrote:
>
>> Hi all,
>>
>> This is an example, which shows that UTF-8 output is broken:
>>
>>     ????????? ? ???? ????????? =\> ???????????
>>     \bye
>>
>> Log file attached.
>>
>> As LuaTeX aims at being 100% UTF-8 on input and output, this
>> incomplete UTF-8 sequence in output may be an indication of
>> inconsistency.
>>
>> Regards,
>> ?????
>>
>
>
> Thank you very much for the report. We will investigate.
>
> --
> luigi
>

A patch is on trunk now.
The log says:


! Missing $ inserted.
<inserted text>
$
<to be read again>
\mskip
\>->\mskip
           \medmuskip
l.1 ...???? ? ???? ????????? =\>
                                                   ???????????
? q
OK, entering \batchmode...

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151030/b36930a9/attachment-0001.html>

