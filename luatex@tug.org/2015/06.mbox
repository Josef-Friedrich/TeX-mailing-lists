From reinhard.kotucha at googlemail.com  Mon Jun  1 20:59:46 2015
From: reinhard.kotucha at googlemail.com (Reinhard Kotucha)
Date: Mon, 1 Jun 2015 20:59:46 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556AD765.6060807@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>
Message-ID: <21868.43938.923911.143817@zaphod.ms25.net>

On 2015-05-31 at 11:41:57 +0200, ?lie Roux wrote:

 > I see that the .lua file uses "module", does it still work with
 > latest luatex?

Hi ?lie,
all my scripts I wrote in Lua-5.1 work with 5.2 as well.  I only
encountered one incompatible change: unpack() was moved to the table
module.  But it's sufficient to add one line:

  local unpack=table.unpack

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------


From kakuto at fuk.kindai.ac.jp  Tue Jun  2 11:09:21 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Tue, 2 Jun 2015 18:09:21 +0900
Subject: [luatex]  Reading registry to find Windows fonts
Message-ID: <A601C451ECF24EB89D133ACF1B4D2FAE@CJ3001517A>

Hi,

>> A few years ago I implemented a library to retrieve the list of fonts on
>> Windows, OS X, and Linux: https://www.ctan.org/pkg/lualatex-platform
>> I don't think it's widely used, but when I wrote it it worked reliably
>> an all three OSes (http://tracker.luatex.org/view.php?id=555), and could
>> be used as a starting point.

> Thanks a lot for the pointer!

I have uploaded a compiled package for TeX Live 2015-W32:

http://members2.jcom.home.ne.jp/wt1357ak/lltxplatform-w32-TL2015.tar.xz

Try texlua test.lua for $TEXMFDIST/doc/lualatex/lltxplatform/test.lua.

Best,
Akira


From elie.roux at telecom-bretagne.eu  Tue Jun  2 11:16:54 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Tue, 2 Jun 2015 11:16:54 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <A601C451ECF24EB89D133ACF1B4D2FAE@CJ3001517A>
References: <A601C451ECF24EB89D133ACF1B4D2FAE@CJ3001517A>
Message-ID: <556D7486.1070509@telecom-bretagne.eu>

Le 02/06/2015 11:09, Akira Kakuto a ?crit :
> Hi,
> 
>>> A few years ago I implemented a library to retrieve the list of fonts on
>>> Windows, OS X, and Linux: https://www.ctan.org/pkg/lualatex-platform
>>> I don't think it's widely used, but when I wrote it it worked reliably
>>> an all three OSes (http://tracker.luatex.org/view.php?id=555), and could
>>> be used as a starting point.
> 
>> Thanks a lot for the pointer!
> 
> I have uploaded a compiled package for TeX Live 2015-W32:

Thanks a lot! I'll send a mail to MikTeX for this too. It might also be
useful for Linux and OSX, is it already compiled for these platforms? If
not, who should I report it to?

Thank you,
-- 
Elie

From phg at phi-gamma.net  Tue Jun  2 20:11:54 2015
From: phg at phi-gamma.net (Philipp Gesang)
Date: Tue, 2 Jun 2015 20:11:54 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556AD765.6060807@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>
Message-ID: <20150602181154.GB5152@acheron>

???<date: 2015-05-31, Sunday>???<from: ?lie Roux>???

> Le 31/05/2015 08:41, Philipp Stephani a ?crit :
> 
>                                                I see that the .lua file
> uses "module", does it still work with latest luatex?

Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
supported. (AFAICS it should continue to work even after the
interpreter receives an update to 5.3.x.)

Best
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 819 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20150602/adc297d2/attachment.bin>

From elie.roux at telecom-bretagne.eu  Tue Jun  2 20:34:27 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Tue, 2 Jun 2015 20:34:27 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <20150602181154.GB5152@acheron>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu> <20150602181154.GB5152@acheron>
Message-ID: <556DF733.9000602@telecom-bretagne.eu>

Philipp,

> Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
> supported. (AFAICS it should continue to work even after the
> interpreter receives an update to 5.3.x.)

Thanks a lot for this!

What do you think about the lltx-platform solution? I was thinking about
making it an optional dependency: if the module doesn't load, just
outputing a warning, not an error. It's freshly integrated in TeXLive
and I don't have an answer yet on the MikTeX mailing list.

Also, I've tried to compile the luaotfload doc makes latest svn segfault
(the Gregorio doc too)... Do you have this too?

I'm trying to make time to make a proper pull request for luaotfload
(doc + optional lltxplatform) and tracking the segfault, but it's quite
difficult these days...

Thank you!
-- 
Elie

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20150602/2764725d/attachment.bin>

From luigi.scarso at gmail.com  Tue Jun  2 20:36:42 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Jun 2015 20:36:42 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556DF733.9000602@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>	<20150602181154.GB5152@acheron>
 <556DF733.9000602@telecom-bretagne.eu>
Message-ID: <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>

On Tue, Jun 2, 2015 at 8:34 PM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> Philipp,
>
> > Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
> > supported. (AFAICS it should continue to work even after the
> > interpreter receives an update to 5.3.x.)
>
> Thanks a lot for this!
>
> What do you think about the lltx-platform solution? I was thinking about
> making it an optional dependency: if the module doesn't load, just
> outputing a warning, not an error. It's freshly integrated in TeXLive
> and I don't have an answer yet on the MikTeX mailing list.
>
> Also, I've tried to compile the luaotfload doc makes latest svn segfault
> (the Gregorio doc too)... Do you have this too?


A seg. fault in latest svn luatex  ?



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150602/ae0d4066/attachment.html>

From elie.roux at telecom-bretagne.eu  Tue Jun  2 20:48:09 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Tue, 02 Jun 2015 20:48:09 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>	<20150602181154.GB5152@acheron>
 <556DF733.9000602@telecom-bretagne.eu>
 <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>
Message-ID: <556DFA69.6070500@telecom-bretagne.eu>

Le 02/06/2015 20:36, luigi scarso a ?crit :
> 
> 
> On Tue, Jun 2, 2015 at 8:34 PM, ?lie Roux <elie.roux at telecom-bretagne.eu
> <mailto:elie.roux at telecom-bretagne.eu>> wrote:
> 
>     Philipp,
> 
>     > Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
>     > supported. (AFAICS it should continue to work even after the
>     > interpreter receives an update to 5.3.x.)
> 
>     Thanks a lot for this!
> 
>     What do you think about the lltx-platform solution? I was thinking about
>     making it an optional dependency: if the module doesn't load, just
>     outputing a warning, not an error. It's freshly integrated in TeXLive
>     and I don't have an answer yet on the MikTeX mailing list.
> 
>     Also, I've tried to compile the luaotfload doc makes latest svn segfault
>     (the Gregorio doc too)... Do you have this too?
> 
> 
> A seg. fault in latest svn luatex  ?

Indeed. Try make doc in

https://github.com/lualatex/luaotfload/

But it's LaTeX so I guess I have to be able to reproduce it with Plain
to be able to report it right?

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Tue Jun  2 21:15:38 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Jun 2015 21:15:38 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556DFA69.6070500@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>	<20150602181154.GB5152@acheron>
 <556DF733.9000602@telecom-bretagne.eu>
 <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>
 <556DFA69.6070500@telecom-bretagne.eu>
Message-ID: <CAG5iGsAdWwYJY5=fzKWDhJAyiV-a+8eNFkU_fo6LEbaG9CNCrg@mail.gmail.com>

On Tue, Jun 2, 2015 at 8:48 PM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> Le 02/06/2015 20:36, luigi scarso a ?crit :
> >
> >
> > On Tue, Jun 2, 2015 at 8:34 PM, ?lie Roux <elie.roux at telecom-bretagne.eu
> > <mailto:elie.roux at telecom-bretagne.eu>> wrote:
> >
> >     Philipp,
> >
> >     > Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
> >     > supported. (AFAICS it should continue to work even after the
> >     > interpreter receives an update to 5.3.x.)
> >
> >     Thanks a lot for this!
> >
> >     What do you think about the lltx-platform solution? I was thinking
> about
> >     making it an optional dependency: if the module doesn't load, just
> >     outputing a warning, not an error. It's freshly integrated in TeXLive
> >     and I don't have an answer yet on the MikTeX mailing list.
> >
> >     Also, I've tried to compile the luaotfload doc makes latest svn
> segfault
> >     (the Gregorio doc too)... Do you have this too?
> >
> >
> > A seg. fault in latest svn luatex  ?
>
> Indeed. Try make doc in
>
> https://github.com/lualatex/luaotfload/
>
> But it's LaTeX so I guess I have to be able to reproduce it with Plain
> to be able to report it right?
>
it would be better, yes,  but I will try make doc with luaotfload.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150602/066349af/attachment.html>

From luigi.scarso at gmail.com  Tue Jun  2 21:41:38 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Jun 2015 21:41:38 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556DFA69.6070500@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu>	<20150602181154.GB5152@acheron>
 <556DF733.9000602@telecom-bretagne.eu>
 <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>
 <556DFA69.6070500@telecom-bretagne.eu>
Message-ID: <CAG5iGsALrFN_0rrHYJpQ9kXReJfWb04RT8o60y8gtvsQyscgkg@mail.gmail.com>

On Tue, Jun 2, 2015 at 8:48 PM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> Le 02/06/2015 20:36, luigi scarso a ?crit :
> >
> >
> > On Tue, Jun 2, 2015 at 8:34 PM, ?lie Roux <elie.roux at telecom-bretagne.eu
> > <mailto:elie.roux at telecom-bretagne.eu>> wrote:
> >
> >     Philipp,
> >
> >     > Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
> >     > supported. (AFAICS it should continue to work even after the
> >     > interpreter receives an update to 5.3.x.)
> >
> >     Thanks a lot for this!
> >
> >     What do you think about the lltx-platform solution? I was thinking
> about
> >     making it an optional dependency: if the module doesn't load, just
> >     outputing a warning, not an error. It's freshly integrated in TeXLive
> >     and I don't have an answer yet on the MikTeX mailing list.
> >
> >     Also, I've tried to compile the luaotfload doc makes latest svn
> segfault
> >     (the Gregorio doc too)... Do you have this too?
> >
> >
> > A seg. fault in latest svn luatex  ?
>
> Indeed. Try make doc in
>
> https://github.com/lualatex/luaotfload/
>
> But it's LaTeX so I guess I have to be able to reproduce it with Plain
> to be able to report it right?
>
I'm using TL1014 (the paths say context, but I'm not using context )

$ make -B doc
make[1]: Entering directory
`/opt/luatex/standalone-mkiv-new/tex/texmf-project/luaotfload-master/doc'
creating file graph (filegraph.pdf)
creating PDF documentation (luaotfload.pdf)
mv -f -- luaotfload-latex.pdf luaotfload.pdf
mv: cannot stat ?luaotfload-latex.pdf?: No such file or directory
make[1]: *** [luaotfload.pdf] Error 1
make[1]: Leaving directory
`/opt/luatex/standalone-mkiv-new/tex/texmf-project/luaotfload-master/doc'
make: *** [doc/luaotfload.pdf] Error 2
luigicasa at luigicasa-K55VD
:/opt/luatex/standalone-mkiv-new/tex/texmf-project/luaotfload-master$

 A seg. fault in lua code  could be  possible with direct nodes (aka nuts
in context) .


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150602/b245c381/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luaotfload-latex.7z
Type: application/x-7z-compressed
Size: 11862 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20150602/b245c381/attachment-0001.bin>

From phg at phi-gamma.net  Wed Jun  3 00:21:27 2015
From: phg at phi-gamma.net (Philipp Gesang)
Date: Wed, 3 Jun 2015 00:21:27 +0200
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556DFA69.6070500@telecom-bretagne.eu>
References: <556987D8.2000007@telecom-bretagne.eu>
 <CAArVCkShuUUfK8XB+OxRbZbzamNnyyjXHwMi+R8ZWF8D7sN3sg@mail.gmail.com>
 <556AD765.6060807@telecom-bretagne.eu> <20150602181154.GB5152@acheron>
 <556DF733.9000602@telecom-bretagne.eu>
 <CAG5iGsBs-zF49NZMovWBWeZVtsb1fn9foJZhijYif+R0q3DFOA@mail.gmail.com>
 <556DFA69.6070500@telecom-bretagne.eu>
Message-ID: <20150602222127.GE5152@acheron>

???<date: 2015-06-02, Tuesday>???<from: ?lie Roux>???

> Le 02/06/2015 20:36, luigi scarso a ?crit :
> > 
> > 
> > On Tue, Jun 2, 2015 at 8:34 PM, ?lie Roux <elie.roux at telecom-bretagne.eu
> > <mailto:elie.roux at telecom-bretagne.eu>> wrote:
> > 
> >     Philipp,
> > 
> >     > Luatex SVN defines LUA_COMPAT_MODULE so the module() interface is
> >     > supported. (AFAICS it should continue to work even after the
> >     > interpreter receives an update to 5.3.x.)
> > 
> >     Thanks a lot for this!
> > 
> >     What do you think about the lltx-platform solution? I was thinking about
> >     making it an optional dependency: if the module doesn't load, just
> >     outputing a warning, not an error. It's freshly integrated in TeXLive
> >     and I don't have an answer yet on the MikTeX mailing list.
> > 
> >     Also, I've tried to compile the luaotfload doc makes latest svn segfault
> >     (the Gregorio doc too)... Do you have this too?
> > 
> > 
> > A seg. fault in latest svn luatex  ?
> 
> Indeed. Try make doc in
> 
> https://github.com/lualatex/luaotfload/

Can?t reproduce it here:

    +00:10:46 phg at acheron luaotfload $ luaotfload-tool --version

    luaotfload-tool:
            Luaotfload font management and diagnostic utility.
            License: GNU GPL v2.0.
            Report problems to <https://github.com/lualatex/luaotfload/issues>

    luaotfload-tool version: "2.5-4"
    Revision: "fa525b6b60f23a95f550aa737d07b9919720e7fc"
    Lua interpreter: stock; version "Lua 5.2"
    Luatex SVN revision: 5263
    Luatex version: 0.80.1
    Platform: type=unix name=linux
        +  machine: x86_64
        + nodename: acheron
        +  release: 4.0.4-2-ARCH
        +  sysname: Linux
        +  version: #1 SMP PREEMPT Fri May 22 03:05:23 UTC 2015
    Index: version="fa525b6b60f23a95f550aa737d07b9919720e7fc" created="2015-04-30 22:34:12" modified="2015-04-30 22:34:12"

    +00:12:38 phg at acheron luaotfload $ make mrproper && make doc
    make -C ./doc clean
    make[1]: Entering directory '/home/phg/src/latex-dev/luaotfload/doc'
    make[1]: Leaving directory '/home/phg/src/latex-dev/luaotfload/doc'
    make -C ./doc mrproper
    make[1]: Entering directory '/home/phg/src/latex-dev/luaotfload/doc'
    make[1]: Leaving directory '/home/phg/src/latex-dev/luaotfload/doc'
    make[1]: Entering directory '/home/phg/src/latex-dev/luaotfload/doc'
    creating file graph (filegraph.pdf)
    creating PDF documentation (luaotfload.pdf)
    mv -f -- luaotfload-latex.pdf luaotfload.pdf
    make[1]: Leaving directory '/home/phg/src/latex-dev/luaotfload/doc'
    make[1]: Entering directory '/home/phg/src/latex-dev/luaotfload/doc'
    creating man page (luaotfload-tool.1)
    creating man page (luaotfload.conf.5)
    make[1]: Leaving directory '/home/phg/src/latex-dev/luaotfload/doc'

Is there some way to tell ?latexmk? to run Luatex under Valgrind?
Or just invoke lualatex directly on luaotfload-latex.tex in the
doc/ subdir. Alternatively, a backtrace from the Luatex core dump
might shed some light on the matter.

Best,
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 819 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20150603/4fc2acb8/attachment.bin>

From elie.roux at telecom-bretagne.eu  Thu Jun  4 09:25:18 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Thu, 04 Jun 2015 09:25:18 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <201506032334.t53NYEv6001270@freefriends.org>
References: <201506032334.t53NYEv6001270@freefriends.org>
Message-ID: <556FFD5E.3020707@telecom-bretagne.eu>

> Before we include any such .so, there should be an option in luatex
> about loading .so's (maybe it already exists?), and the default has to
> be off.  Otherwise our efforts at security are lost, so far as I can see.

That's a difficult question...

> Which means, it seems to me, that the feature is only useful for
> particular users doing particular things, not for shipping stuff to be
> used by everyone.

It is useful for Windows users

> As I understand it, ConTeXt gets the list of OS fonts by running a
> script at install time, or really mtxrun --generate time.  I expect we
> could figure out something similar for lualatex.  Ideally even re-using
> the same file if it exists ...

Sadly, Windows has a mechanism that stocks some installed fonts only in
the registry, and not in a standard directory. Fonts installed this way
are not handled by ConTeXt. There aren't many cases where users install
fonts this way, but (AFAIK) the mechanism is quite recent and there
might be more and more demand on this...

There are currently two ways to access the registry in LuaTeX:
 - loading a .so file that calls the Windows API (lua-winreg,
lualatex-platform, etc.)
 - calling the "reg" command

The second is already forbidden by shell_escape_commands (which is
good), and if you forbid the first one, this means that users will never
be able to have all their fonts found by TeX.

The only other way this could be dealt with would be through fontconfig,
but fontconfig doesn't support the fonts in the registry, doesn't plan
to, and making a patch is not easy (fonts not in a standard directory
doesn't fit well with fontconfig architecture).[1][2]

> Overall, I think just about any alternative -- a script, a system call,
> a whole separate program, whatever -- is preferable to a .so.

This means that all modules people need will have to be statically
linked with LuaTeX? This seems a difficult choice, and I'm not sure the
LuaTeX team is willing to do this... This will also forbid experiments
with harfbuzz, etc. Maybe there could be a list of allowed extensions,
that would respect openin_any and openout_any (lualatex-platform does,
it doesn't read nor write any file), and also removing "." from CLUAINPUTS ?

> They'd only be updated once a year, or more precisely when the binaries
> are updated.  There is no miracle way to get them compiled on all
> platforms on demand, and I don't want to impose repeated recompiling on
> our builders (or manage such an effort).  

Ok

> I also expect it will take
> quite some effort to get figure out the first one.

Indeed, hence my question...

Thank you!
-- 
Elie

[1]: http://lists.freedesktop.org/archives/fontconfig/2015-May/005510.html
[2]: https://bugs.freedesktop.org/show_bug.cgi?id=90813

From luigi.scarso at gmail.com  Thu Jun  4 10:34:41 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 4 Jun 2015 10:34:41 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <556FFD5E.3020707@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
Message-ID: <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>

On Thu, Jun 4, 2015 at 9:25 AM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> > Before we include any such .so, there should be an option in luatex
> > about loading .so's (maybe it already exists?), and the default has to
> > be off.  Otherwise our efforts at security are lost, so far as I can see.
>
> That's a difficult question...
>
> > Which means, it seems to me, that the feature is only useful for
> > particular users doing particular things, not for shipping stuff to be
> > used by everyone.
>
> It is useful for Windows users
>
> > As I understand it, ConTeXt gets the list of OS fonts by running a
> > script at install time, or really mtxrun --generate time.  I expect we
> > could figure out something similar for lualatex.  Ideally even re-using
> > the same file if it exists ...
>
> Sadly, Windows has a mechanism that stocks some installed fonts only in
> the registry, and not in a standard directory. Fonts installed this way
> are not handled by ConTeXt. There aren't many cases where users install
> fonts this way, but (AFAIK) the mechanism is quite recent and there
> might be more and more demand on this...
>
> There are currently two ways to access the registry in LuaTeX:
>  - loading a .so file that calls the Windows API (lua-winreg,
> lualatex-platform, etc.)
>  - calling the "reg" command
>
> The second is already forbidden by shell_escape_commands (which is
> good), and if you forbid the first one, this means that users will never
> be able to have all their fonts found by TeX.
>
> The only other way this could be dealt with would be through fontconfig,
> but fontconfig doesn't support the fonts in the registry, doesn't plan
> to, and making a patch is not easy (fonts not in a standard directory
> doesn't fit well with fontconfig architecture).[1][2]
>
> > Overall, I think just about any alternative -- a script, a system call,
> > a whole separate program, whatever -- is preferable to a .so.
>
> This means that all modules people need will have to be statically
> linked with LuaTeX? This seems a difficult choice, and I'm not sure the
> LuaTeX team is willing to do this... This will also forbid experiments
> with harfbuzz, etc. Maybe there could be a list of allowed extensions,
> that would respect openin_any and openout_any (lualatex-platform does,
> it doesn't read nor write any file), and also removing "." from CLUAINPUTS
> ?
>
> > They'd only be updated once a year, or more precisely when the binaries
> > are updated.  There is no miracle way to get them compiled on all
> > platforms on demand, and I don't want to impose repeated recompiling on
> > our builders (or manage such an effort).
>
> Ok
>
> > I also expect it will take
> > quite some effort to get figure out the first one.
>
> Indeed, hence my question...
>
> Thank you!
> --
> Elie
>
> [1]: http://lists.freedesktop.org/archives/fontconfig/2015-May/005510.html
> [2]: https://bugs.freedesktop.org/show_bug.cgi?id=90813
>

The swiglib project
swiglib.foundry.supelec.fr
tries to address these problems.
My current opinion is to avoid to include dynamic shared object (ie so/dll
files) in TeXLive
and  set  a path inside the TDS .
ConTeXt already has a mechanism to load dso
(see 3.1 Application module location in the TDS
https://swiglib.foundry.supelec.fr/tb112/tb112scarso.html)
and it works quite well.
A command line switches as  --disable-write18  and --shell-restricted
currently are not implemented
but could be in the future (luajittex is more problematic),
but even in this case loading a dso poses always a security problem.
Another point is that a dso usually it's not available for the all the
platforms
and it can depend on lua version of luatex.

if we keep the modules outside the TeXLive
then they are optionals --- i.e. the user chooses to install them ---
and the developer has the responsibility to fix the problems.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150604/790e2438/attachment.html>

From siepo at cybercomm.nl  Thu Jun  4 10:45:18 2015
From: siepo at cybercomm.nl (Siep Kroonenberg)
Date: Thu, 4 Jun 2015 10:45:18 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <556FFD5E.3020707@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
Message-ID: <20150604084518.GA2254@bitmuis.thuis.internal>

On Thu, Jun 04, 2015 at 09:25:18AM +0200, ?lie Roux wrote:
> 
> > As I understand it, ConTeXt gets the list of OS fonts by running a
> > script at install time, or really mtxrun --generate time.  I expect we
> > could figure out something similar for lualatex.  Ideally even re-using
> > the same file if it exists ...
> 
> Sadly, Windows has a mechanism that stocks some installed fonts only in
> the registry, and not in a standard directory. Fonts installed this way
> are not handled by ConTeXt. There aren't many cases where users install
> fonts this way, but (AFAIK) the mechanism is quite recent and there
> might be more and more demand on this...
> 
> There are currently two ways to access the registry in LuaTeX:
>  - loading a .so file that calls the Windows API (lua-winreg,
> lualatex-platform, etc.)
>  - calling the "reg" command
> 
> The second is already forbidden by shell_escape_commands (which is
> good), and if you forbid the first one, this means that users will never
> be able to have all their fonts found by TeX.

Would it be practical to collect this information from the registry
and have it written to a file in a separate step, just as already
happens with mktexlsr and updmap?

-- 
Siep Kroonenberg

From elie.roux at telecom-bretagne.eu  Thu Jun  4 10:56:38 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 4 Jun 2015 10:56:38 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <20150604084518.GA2254@bitmuis.thuis.internal>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <20150604084518.GA2254@bitmuis.thuis.internal>
Message-ID: <557012C6.3030001@telecom-bretagne.eu>

> Would it be practical to collect this information from the registry
> and have it written to a file in a separate step, just as already
> happens with mktexlsr and updmap?

I didn't think about this solution... That's a good one I believe, if no
external command nor compiled module can run in TeXLive! A little tool
doing that could be easy to write, the only thing would be to add this
call in different TeXLive hooks... What do you all think about this
solution? (this doesn't close the debate on compiled libraries)

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Thu Jun  4 11:12:53 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 4 Jun 2015 11:12:53 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
Message-ID: <55701695.9090504@telecom-bretagne.eu>

> The swiglib project 
> swiglib.foundry.supelec.fr <http://swiglib.foundry.supelec.fr>
> tries to address these problems.
> My current opinion is to avoid to include dynamic shared object (ie
> so/dll files) in TeXLive
> and  set  a path inside the TDS .

Why not, but this means that if some documents rely on external
libraries, users won't be able to compile them, especially under Windows
where it requires very advanced knowledge to compile anything. So this
means that LuaTeX will never be able to use harfbuzz, etc.  This means
that if someone wants to experiment on harfbuzz (change harfbuzz for
anything here) will have to fork LuaTeX, statically compile harfbuzz
against it, and distribute "luatex-harfbuzz", same for all other useful
libraries...

> ConTeXt already has a mechanism to load dso
> (see 3.1 Application module location in the TDS
> https://swiglib.foundry.supelec.fr/tb112/tb112scarso.html)
> and it works quite well.

Loading dynamic libraries is currently quite easy indeed.

> A command line switches as  --disable-write18  and --shell-restricted
> currently are not implemented 
> but could be in the future (luajittex is more problematic), 

That would be helpful... But I suppose that mean that you'll have to
link against -ltexlua (name to be defined) instead of -llua52, because
linking against -llua52 will never provide kpse-restricted funtions
right? That sounds reasonable...

> if we keep the modules outside the TeXLive 

Does it mean ConTeXt users will have all the nice swig modules, while
TeXLive users won't? Seems a bit unfair... This also means that TeXLive
will have a reduced ConTeXt?

> then they are optionals --- i.e. the user chooses to install them --- 
> and the developer has the responsibility to fix the problems.

But this also means that the average user can't install them (installing
such a thing under Windows is way beyond average Windows user's
ability). Even distributing shared libaries for LuaTeX through luarocks
and asking users to install them is, I believe, confusing for the
average user...

Thank you,
-- 
Elie

From zdenek.wagner at gmail.com  Thu Jun  4 11:27:05 2015
From: zdenek.wagner at gmail.com (Zdenek Wagner)
Date: Thu, 4 Jun 2015 11:27:05 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <55701695.9090504@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
Message-ID: <CAC1phyYLcxAawYBZBLsLf8RwQ3TjkmcnsQyhTEy=3qx_SyE1Fw@mail.gmail.com>

2015-06-04 11:12 GMT+02:00 ?lie Roux <elie.roux at telecom-bretagne.eu>:
>> The swiglib project
>> swiglib.foundry.supelec.fr <http://swiglib.foundry.supelec.fr>
>> tries to address these problems.
>> My current opinion is to avoid to include dynamic shared object (ie
>> so/dll files) in TeXLive
>> and  set  a path inside the TDS .
>
> Why not, but this means that if some documents rely on external
> libraries, users won't be able to compile them, especially under Windows
> where it requires very advanced knowledge to compile anything. So this
> means that LuaTeX will never be able to use harfbuzz, etc.  This means
> that if someone wants to experiment on harfbuzz (change harfbuzz for
> anything here) will have to fork LuaTeX, statically compile harfbuzz
> against it, and distribute "luatex-harfbuzz", same for all other useful
> libraries...
>
There are already experiments with luatex and harfbuzz:
https://github.com/michal-h21/luatex-harfbuzz-shaper
https://github.com/michal-h21/luatex-harfbuzz-shaper/blob/master/examples/scripts.pdf

>> ConTeXt already has a mechanism to load dso
>> (see 3.1 Application module location in the TDS
>> https://swiglib.foundry.supelec.fr/tb112/tb112scarso.html)
>> and it works quite well.
>
> Loading dynamic libraries is currently quite easy indeed.
>
>> A command line switches as  --disable-write18  and --shell-restricted
>> currently are not implemented
>> but could be in the future (luajittex is more problematic),
>
> That would be helpful... But I suppose that mean that you'll have to
> link against -ltexlua (name to be defined) instead of -llua52, because
> linking against -llua52 will never provide kpse-restricted funtions
> right? That sounds reasonable...
>
>> if we keep the modules outside the TeXLive
>
> Does it mean ConTeXt users will have all the nice swig modules, while
> TeXLive users won't? Seems a bit unfair... This also means that TeXLive
> will have a reduced ConTeXt?
>
>> then they are optionals --- i.e. the user chooses to install them ---
>> and the developer has the responsibility to fix the problems.
>
> But this also means that the average user can't install them (installing
> such a thing under Windows is way beyond average Windows user's
> ability). Even distributing shared libaries for LuaTeX through luarocks
> and asking users to install them is, I believe, confusing for the
> average user...
>
The solution is to educate users. All security problems stem from
hiding important knowledge, offering security settings in a not
understandable way and pretending false security. If you offer an easy
access to potentially vulnerable or malicious libraries to uneducated
users, you are doin a misservice. For uneducated users reduced but
safe system is more valuable than a potentially vulnerable systems.
Thos who need higher functionality should understand the risk and
should be educated.

> Thank you,
> --
> Elie


Zden?k Wagner
http://hroch486.icpf.cas.cz/wagner/
http://icebearsoft.euweb.cz


From elie.roux at telecom-bretagne.eu  Thu Jun  4 11:58:58 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 4 Jun 2015 11:58:58 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <CAC1phyYLcxAawYBZBLsLf8RwQ3TjkmcnsQyhTEy=3qx_SyE1Fw@mail.gmail.com>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAC1phyYLcxAawYBZBLsLf8RwQ3TjkmcnsQyhTEy=3qx_SyE1Fw@mail.gmail.com>
Message-ID: <55702162.5020006@telecom-bretagne.eu>

> There are already experiments with luatex and harfbuzz:
> https://github.com/michal-h21/luatex-harfbuzz-shaper
> https://github.com/michal-h21/luatex-harfbuzz-shaper/blob/master/examples/scripts.pdf

Right, and it needs to load harfbuzz.so... I think it's an interesting
experiment and I think it would be a pity if there was no way for it to
be simply avaible and useable with TeXLive default settings...

> The solution is to educate users. All security problems stem from
> hiding important knowledge, offering security settings in a not
> understandable way and pretending false security. If you offer an easy
> access to potentially vulnerable or malicious libraries to uneducated
> users, you are doin a misservice. For uneducated users reduced but
> safe system is more valuable than a potentially vulnerable systems.
> Thos who need higher functionality should understand the risk and
> should be educated.

I agree with all this, but security is really not important for most
users (otherwise they wouldn't use Windows), so I think there is a kind
of balance to find...

Anyway, I'd be in favor of something like:

- a setting in texmf.cnf called luatex_so_loading, with values "n"
(none), "r" (restricted) or "a" (all).

- restricted mode would only alow loading of xxx.so where xxx is in
another texmf.cnf setting called luatex_so_authorized, containing for
instance "harfbuzz" and "lualatex-platform", as these seem harmless...

- in all cases, I think "." should be removed from CLUAINPUTS (as it
induces security issues: if a script is allowed to write in current
directory by openout_any, it can write a .so file, load it, and override
openout_any settings)

With this setting available and "r" by default, the average user can use
a few safe libraries that will be useful in many cases (harfbuzz,
lualatex-platform, etc.), and people can make the security level higher
or lower according to their sensibility... What do you think?

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Thu Jun  4 12:49:48 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 4 Jun 2015 12:49:48 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <55701695.9090504@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
Message-ID: <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>

On Thu, Jun 4, 2015 at 11:12 AM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> > The swiglib project
> > swiglib.foundry.supelec.fr <http://swiglib.foundry.supelec.fr>
> > tries to address these problems.
> > My current opinion is to avoid to include dynamic shared object (ie
> > so/dll files) in TeXLive
> > and  set  a path inside the TDS .
>
> Why not, but this means that if some documents rely on external
> libraries, users won't be able to compile them, especially under Windows
> where it requires very advanced knowledge to compile anything. So this
> means that LuaTeX will never be able to use harfbuzz, etc.  This means
> that if someone wants to experiment on harfbuzz (change harfbuzz for
> anything here) will have to fork LuaTeX, statically compile harfbuzz
> against it, and distribute "luatex-harfbuzz", same for all other useful
> libraries...
>
>
Why ?
Just provide a dso of a binding of harfbuzz, put it into the right TDS
directory and load it with luatex.
The points are: 1) who does provide these dso ? 2) how to load it ?
With swiglib I provide some  dso, and I have shown how to load it in
luatex.
ConTeXt has his own loader (much better than mine), LaTeX can have another
one.




> > ConTeXt already has a mechanism to load dso
> > (see 3.1 Application module location in the TDS
> > https://swiglib.foundry.supelec.fr/tb112/tb112scarso.html)
> > and it works quite well.
>
> Loading dynamic libraries is currently quite easy indeed.
>
> > A command line switches as  --disable-write18  and --shell-restricted
> > currently are not implemented
> > but could be in the future (luajittex is more problematic),
>
> That would be helpful... But I suppose that mean that you'll have to
> link against -ltexlua (name to be defined) instead of -llua52, because
> linking against -llua52 will never provide kpse-restricted funtions
> right? That sounds reasonable...
>
> This is true for windows, and in fact currently the TL luatex.exe  dll
have different names
respect to the w32tex, something I hope to fix soon.
Only the luatex headers are mandatory
(under windows, symbols must be  resolved at compile time; under linux at
runtime).

> if we keep the modules outside the TeXLive
>
> Does it mean ConTeXt users will have all the nice swig modules, while
> TeXLive users won't? Seems a bit unfair... This also means that TeXLive
> will have a reduced ConTeXt?
>
> no, swiglib dso are a luatex thing only (and strictly coupled with the C
headers of the lib, so in almost all case a lua/tex layer is advisable)



> > then they are optionals --- i.e. the user chooses to install them ---
> > and the developer has the responsibility to fix the problems.
>
> But this also means that the average user can't install them (installing
> such a thing under Windows is way beyond average Windows user's
> ability). Even distributing shared libaries for LuaTeX through luarocks
> and asking users to install them is, I believe, confusing for the
> average user...
>
> yes, but it's easy to write a luatex script for downloading and installing
a dso in the correct place.
(ConTeXt has not this script because we are discussing how to  integrate
them into the context garden, but in principle is easy, so it has low
priority).

A dso very likely could not be provide for all the platforms supported by
TeXLive:
this means that a tex code that for example runs in Linux could not run in
 Windows
or it could run and give different results.
This led to consequence that the same could have different result with the
same TL on different platforms
(for example swiglib have no dso for Mac, and only one for FreeBSD, so
these users already have very different results if they run a tex code that
uses a dso )
Of course a dso often need to be in sync with the updates of the lib, so
this led to management of the versions for the same TL and for different TL.

For these reasons I consider a dso  as an add-on under the control of the
user, not something that TL should care.



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150604/ce540204/attachment.html>

From elie.roux at telecom-bretagne.eu  Thu Jun  4 13:22:49 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Thu, 4 Jun 2015 13:22:49 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
Message-ID: <55703509.7010005@telecom-bretagne.eu>

> The points are: 1) who does provide these dso ?

Precisely... I might misunderstood your point of view, but I though you
wanted no dso in TeXLive... which would mean that each package is
responsible for providing dso files, and then users would manually have
to go to like the github page of packages, and manually install or
compile them... Or maybe compiled binaries could be provided on CTAN...
I don't know... How do you see that part?

> 2) how to load it ? With swiglib I provide some  dso, and I have
> shown how to load it in luatex.

I don't think loading dso is really an issue here, it seems fairly easy,
the main questions are (I think):

- is dso loading allowed by default?
- are dso provided by TeXLive?

> That would be helpful... But I suppose that mean that you'll have to 
> link against -ltexlua (name to be defined) instead of -llua52,
> because linking against -llua52 will never provide kpse-restricted
> funtions right? That sounds reasonable...
> 
> This is true for windows, and in fact currently the TL luatex.exe
> dll have different names respect to the w32tex, something I hope to
> fix soon. Only the luatex headers are mandatory (under windows,
> symbols must be  resolved at compile time; under linux at runtime).

I'm not entirely sure I understand... Can you give a short example of
how to compile a dynamic library against luatex (if possible under Linux)?

> For these reasons I consider a dso  as an add-on under the control
> of the user, not something that TL should care.

So your proposal is to have something like a package manager a la
luarocks, specific to LuaTeX, parallel to TeXLive, CTAN and MikTeX... I
admit this is quite counter-intuitive to me, and it seems to make
another layer in something already quite complex... But if it's the way
to go why not...

> yes, but it's easy to write a luatex script for downloading and 
> installing a dso in the correct place. (ConTeXt has not this script
> because we are discussing how to  integrate them into the context
> garden, but in principle is easy, so it has low priority).

I see...

> A dso very likely could not be provide for all the platforms
> supported by TeXLive: this means that a tex code that for example
> runs in Linux could not run in  Windows or it could run and give
> different results.

In some cases yes, but in others (such as harfbuzz) no, and in some
cases it will be intended (lualatex-platform will of course not read
Windows registry under Linux)... I don't see obvious cases where this
might be a problem...

> This led to consequence that the same could have different result
> with the same TL on different platforms

Theoretically yes, though this seems quite rare...

> (for example swiglib have no dso for Mac, and only one for FreeBSD,
> so these users already have very different results if they run a tex
> code that uses a dso )

Part of why distributing things with TeXLive will bring much more
homogeneity...

> Of course a dso often need to be in sync with the updates of the lib,
> so this led to management of the versions for the same TL and for
> different TL.

This smells like headaches... Especially if MikTeX doesn't follow
TeXLive precisely, this could mean that the package manager would have
to provide binaries for:
- different versions of the packages themselves
- different platforms
- different versions of LuaTeX
- possibly different versions of the distribution (ConTeXtgarden,
TeXLive, MikTeX)
- possiblty different versions of the package manager itself

I wish good luck to someone wanting to maintain that! Having the
binaries in TeXLive is more statical, but seems way more simple... at
least if this package manager is supposed to be shared by the different
formats... But maybe you meant that ConTeXt would have its package
manager and its compiled package database, "LaTeX" (whatever that means)
or TeXLive would have another one, etc.?

Thanks a lot!
-- 
Elie

From pragma at wxs.nl  Fri Jun  5 02:37:49 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 5 Jun 2015 02:37:49 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <556FFD5E.3020707@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
Message-ID: <5570EF5D.2010003@wxs.nl>

On 6/4/2015 9:25 AM, ?lie Roux wrote:
>> Before we include any such .so, there should be an option in luatex
>> about loading .so's (maybe it already exists?), and the default has to
>> be off.  Otherwise our efforts at security are lost, so far as I can see.
>
> That's a difficult question...
>
>> Which means, it seems to me, that the feature is only useful for
>> particular users doing particular things, not for shipping stuff to be
>> used by everyone.
>
> It is useful for Windows users
>
>> As I understand it, ConTeXt gets the list of OS fonts by running a
>> script at install time, or really mtxrun --generate time.  I expect we
>> could figure out something similar for lualatex.  Ideally even re-using
>> the same file if it exists ...
>
> Sadly, Windows has a mechanism that stocks some installed fonts only in
> the registry, and not in a standard directory. Fonts installed this way
> are not handled by ConTeXt. There aren't many cases where users install
> fonts this way, but (AFAIK) the mechanism is quite recent and there
> might be more and more demand on this...

Speaking for context, I am not that interested in fonts that are 
installed in fuzzy locations. When I use font from the system (which is 
rare) I copy it to the tex/texmf-fonts tree of context so that I can be 
sure that it only changes when I want that. When I need fonts for a 
project I tend to buy the official versions (often one can then use some 
5 copies on different machines i.e. other operating systems). I make 
sure that my stuff works on windows (that I use on workstations) as well 
as linux (on the servers that we use for running services).

So, it is quite unlikely that the file locator that context uses will 
consult the registry. If I really have to I'd probably use the 
commandline method and not a library (for which i need to keep up with 
some api).

> There are currently two ways to access the registry in LuaTeX:
>   - loading a .so file that calls the Windows API (lua-winreg,
> lualatex-platform, etc.)
>   - calling the "reg" command
>
> The second is already forbidden by shell_escape_commands (which is
> good), and if you forbid the first one, this means that users will never
> be able to have all their fonts found by TeX.

Afaik users can configure what programs can run.

> The only other way this could be dealt with would be through fontconfig,
> but fontconfig doesn't support the fonts in the registry, doesn't plan
> to, and making a patch is not easy (fonts not in a standard directory
> doesn't fit well with fontconfig architecture).[1][2]
>
>> Overall, I think just about any alternative -- a script, a system call,
>> a whole separate program, whatever -- is preferable to a .so.
>
> This means that all modules people need will have to be statically
> linked with LuaTeX? This seems a difficult choice, and I'm not sure the
> LuaTeX team is willing to do this... This will also forbid experiments
> with harfbuzz, etc. Maybe there could be a list of allowed extensions,
> that would respect openin_any and openout_any (lualatex-platform does,
> it doesn't read nor write any file), and also removing "." from CLUAINPUTS ?

In fact, we might make some of the current modules dynamic loaded. 
Personally I will only rely on an as small as possible set of libraries, 
basically the tex kernel (luatex 2 might even be a real small kernel.) 
With the swiglib project we aim at a predictable mechanism that can be 
used for all platforms.

>> They'd only be updated once a year, or more precisely when the binaries
>> are updated.  There is no miracle way to get them compiled on all
>> platforms on demand, and I don't want to impose repeated recompiling on
>> our builders (or manage such an effort).
>
> Ok
>
>> I also expect it will take
>> quite some effort to get figure out the first one.
>
> Indeed, hence my question...
>
> Thank you!
>


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jun  5 02:51:46 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 5 Jun 2015 02:51:46 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <CAC1phyYLcxAawYBZBLsLf8RwQ3TjkmcnsQyhTEy=3qx_SyE1Fw@mail.gmail.com>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAC1phyYLcxAawYBZBLsLf8RwQ3TjkmcnsQyhTEy=3qx_SyE1Fw@mail.gmail.com>
Message-ID: <5570F2A2.4090505@wxs.nl>

On 6/4/2015 11:27 AM, Zdenek Wagner wrote:

>> Does it mean ConTeXt users will have all the nice swig modules, while
>> TeXLive users won't? Seems a bit unfair... This also means that TeXLive
>> will have a reduced ConTeXt?

(1) TexLive is a stable yearly snapshot ... and it has a complete 
context. Of course context betas can support new and experimental things 
but that is unrelated to a distribution. There is hardly any code on my 
machine that i snot in the distribution.

(2) Context will never rely on extra modules. There might be support for 
some (e.g. there is some support for mysql and so) but those are not 
needed for regular typesetting. The whole idea of luatex is to delegate 
to lua cq. extend via lua so creating more dependencies contradicts this.

(3) What works for context also can work or other macro packages, but 
the way things get integrated can differ. So, what works in context 
might not work in latex or plain and vice versa. The choice for swiglib 
means that we stick to the original apis but can write macro package 
specific wrappers around it.

>>> then they are optionals --- i.e. the user chooses to install them ---
>>> and the developer has the responsibility to fix the problems.
>>
>> But this also means that the average user can't install them (installing
>> such a thing under Windows is way beyond average Windows user's
>> ability). Even distributing shared libaries for LuaTeX through luarocks
>> and asking users to install them is, I believe, confusing for the
>> average user...

The few times that I had to use e.g. luarocks it was such a nightmare 
compared to a regular tex installation that I decided to use just luatex 
(texlua) as lua engine. (Btw, one can just use some of the libraries 
shipped as rocks with luatex.) (Ok, I also make sure that  the whole 
bunch of libraries that ships with context can be used with stock lua so 
that in practice one doesn't see a difference.)

> The solution is to educate users. All security problems stem from
> hiding important knowledge, offering security settings in a not
> understandable way and pretending false security. If you offer an easy
> access to potentially vulnerable or malicious libraries to uneducated
> users, you are doin a misservice. For uneducated users reduced but
> safe system is more valuable than a potentially vulnerable systems.
> Thos who need higher functionality should understand the risk and
> should be educated.

Personally I'm not too worried about security but more about the 
complexity of a tex system. We have a rather clear tds structure which 
helps support. The more libraries (small or large) we depend on the 
worse it gets (in terms of maintainance, dependencies, whatever). To 
some extend the current luatex is already a bit over the top.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Jun  5 02:57:57 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 5 Jun 2015 02:57:57 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <55703509.7010005@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
Message-ID: <5570F415.5010502@wxs.nl>

On 6/4/2015 1:22 PM, ?lie Roux wrote:

> I wish good luck to someone wanting to maintain that! Having the
> binaries in TeXLive is more statical, but seems way more simple... at
> least if this package manager is supposed to be shared by the different
> formats... But maybe you meant that ConTeXt would have its package
> manager and its compiled package database, "LaTeX" (whatever that means)
> or TeXLive would have another one, etc.?

we already have an infrastructure for compiling for years and swiglibs 
will be part of it (given demand) .. this is also handy for testing 
luatex betas (and i'm no too interested in spending time on making sure 
all we do also works in whatever macro package)

but the reference is always the yearly tl distribution (and it is 
unlikely that context expects tex live to ship extra libraries fo rits 
usage)

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Jun  5 08:56:07 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Fri, 5 Jun 2015 08:56:07 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <5570EF5D.2010003@wxs.nl>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu> <5570EF5D.2010003@wxs.nl>
Message-ID: <55714807.9050101@telecom-bretagne.eu>

Le 05/06/2015 02:57, Hans Hagen a ?crit :
> Speaking for context, I am not that interested in fonts that are 
> installed in fuzzy locations. When I use font from the system (which 
> is rare) I copy it to the tex/texmf-fonts tree of context so that I 
> can be sure that it only changes when I want that. When I need fonts 
> for a project I tend to buy the official versions (often one can
> then use some 5 copies on different machines i.e. other operating 
> systems). I make sure that my stuff works on windows (that I use on 
> workstations) as well as linux (on the servers that we use for 
> running services).

I understand your workflow, but I also understand why users would want
installed fonts to work as the fonts in C:\\Windows\Fonts (the confusing
part is that these fonts actually appear in C:\\Winows\Fonts in the
Windows explorer, even though they're not actually here).

>> The second is already forbidden by shell_escape_commands (which is
>>  good), and if you forbid the first one, this means that users
>> will never be able to have all their fonts found by TeX.
> 
> Afaik users can configure what programs can run.

For shell_escape_commands yes, I think this could be extended to dso,
instead of just a on/off switch.

> In fact, we might make some of the current modules dynamic loaded.

Ok, so having a big switch off by default for dso is thus excluded, as
this means LuaTeX would be unusable in the future...

> (2) Context will never rely on extra modules. There might be support 
> for some (e.g. there is some support for mysql and so) but those are 
> not needed for regular typesetting.

Ok good

> (3) What works for context also can work or other macro packages, but
> the way things get integrated can differ. So, what works in context
> might not work in latex or plain and vice versa. The choice for
> swiglib means that we stick to the original apis but can write macro
> package specific wrappers around it.

The main point here I think is distribution: in the future, how will
ConTeXt ship dso? When will they be released, etc. will
they be included in snapshots, or will there be some kind of package
manager?

> we already have an infrastructure for compiling for years and 
> swiglibs will be part of it (given demand) .. this is also handy for 
> testing luatex betas (and i'm no too interested in spending time on 
> making sure all we do also works in whatever macro package)

This is precisely the point: what about things you're not interested in?
(harfbuzz, lualatex-platform, etc.) Does it mean only you will choose
the dso present in ConTeXt and thus in TeXLive, or is there a
possibility to add a dso in TeXLive that is not in ConTeXt?

> but the reference is always the yearly tl distribution (and it is 
> unlikely that context expects tex live to ship extra libraries fo 
> rits usage)

So I think the main questions are:

- can dso run in TeXLive's "luatex" command?
- if so, what restrictions? how to compile the libraries so that they
respect openout_any, etc.?
- how are the dso compiled and distributed? Provided as binaries by
ConTeXt (preventing inclusions of dso that ConTeXt is not interested in)
or compiled by TeXLive?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Jun  5 10:26:28 2015
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-15?Q?=C9lie_Roux?=)
Date: Fri, 5 Jun 2015 10:26:28 +0200
Subject: [luatex] [tex-live]   lltxplatform integration
In-Reply-To: <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
Message-ID: <55715D34.5070709@telecom-bretagne.eu>

> Thus I see no way to put shared objects into the native TL distribution,

Ok, then if LuaTeX is going to separate into one executable and several
shared objects, this means that TeXLive will no longer support LuaTeX?
If that's so, that should be publicly stated I believe, so that people
can start making a LuaTeX-specific distribution, or start using ConTeXt.

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Jun  5 10:32:35 2015
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-15?Q?=C9lie_Roux?=)
Date: Fri, 05 Jun 2015 10:32:35 +0200
Subject: [luatex] [tex-live]   lltxplatform integration
In-Reply-To: <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
Message-ID: <55715EA3.3070506@telecom-bretagne.eu>

Le 05/06/2015 10:12, Peter Breitenlohner a ?crit :
> One reason is maximal portability, an
> other that the location of non-system shared libraries has to be known at
> compile time, quite impossible if that location is determined during the TL
> installation).  The situation would be at least as bad for shared objects
> loaded via dlopen() or similar.

We're talking here about things loaded by Lua(TeX)'s "require" function,
that looks for .(dll|so) in directories listed by texmf.cnf's
CLUAINPUTS, so I don't think the problem you're talking about exists.

Thank you,
-- 
Elie

From preining at logic.at  Fri Jun  5 11:18:57 2015
From: preining at logic.at (Norbert Preining)
Date: Fri, 5 Jun 2015 18:18:57 +0900
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
Message-ID: <20150605091857.GE11961@auth.logic.tuwien.ac.at>

On Fri, 05 Jun 2015, Peter Breitenlohner wrote:
> And how to place them for differnt architectures (e.g., coexisting i686 and
> x86_64) such that the 32- and 64-bit executables find the corresponding
> shared objects?

I think the problem is not the positioning. We can easiky have
	Master/lib/<ARCH>/...
and include that in some way. The problem is with portability within
the same arch/os combinations, from CentOS over SuSE to Debian et cetc,
all would need to be usable with *the*same* .so.

I am not sure if that works, we haven't tried. And I am not sure
I want t ask all builders to try it out ;-)

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0  ACF0 6CAC A448 860C DC13
------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Jun  5 11:24:21 2015
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-15?Q?=C9lie_Roux?=)
Date: Fri, 5 Jun 2015 11:24:21 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
Message-ID: <55716AC5.4040206@telecom-bretagne.eu>

> And how to place them for differnt architectures (e.g., coexisting i686 and
> x86_64) such that the 32- and 64-bit executables find the corresponding
> shared objects?

Good point, that's to be added to the debate...

> Remember, TL could be on a filesystem shared between 32- and 64-bit Unix
> and
> Windows systems, with variables such as CLUAINPUTS pointing to system
> independet locations.

I admit I didn't have this use case in mind...

>  One possibility would be that the "require" function
> looks into architecture dependent subdirectories of CLUAINPUTS.

What about

CLUAINPUTS =
$SELFAUTOLOC/lib/{$architecture,}/{$progname,$engine,}/lua//

?

(I don't know if "$architecture" exists, if not I think this would be
something to create, also I'm not totally sure this would expand the way
I think it would).

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Jun  5 11:30:11 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Fri, 05 Jun 2015 11:30:11 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <20150605091857.GE11961@auth.logic.tuwien.ac.at>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
Message-ID: <55716C23.9020400@telecom-bretagne.eu>

Le 05/06/2015 11:18, Norbert Preining a ?crit :
> On Fri, 05 Jun 2015, Peter Breitenlohner wrote:
>> And how to place them for differnt architectures (e.g., coexisting i686 and
>> x86_64) such that the 32- and 64-bit executables find the corresponding
>> shared objects?
> 
> I think the problem is not the positioning. We can easiky have
> 	Master/lib/<ARCH>/...
> and include that in some way. The problem is with portability within
> the same arch/os combinations, from CentOS over SuSE to Debian et cetc,
> all would need to be usable with *the*same* .so.
> 
> I am not sure if that works, we haven't tried. And I am not sure
> I want t ask all builders to try it out ;-)

That goes beyond my knowledge, but if CentOS over Suse is able to find
the right luatex binary, would there be a reason for it not to find the
right .so? Or do you mean same binaries wouldn't be able to load the
same .so file on a different OS?

Thank you,
-- 
Elie

From preining at logic.at  Fri Jun  5 11:42:52 2015
From: preining at logic.at (Norbert Preining)
Date: Fri, 5 Jun 2015 18:42:52 +0900
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <55716C23.9020400@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
Message-ID: <20150605094252.GF11961@auth.logic.tuwien.ac.at>

On Fri, 05 Jun 2015, ?lie Roux wrote:
> right .so? Or do you mean same binaries wouldn't be able to load the
> same .so file on a different OS?

Yes, that is the problem. We are not making a distinction between OS,
but ARCH-OS, for examples
	x86_64-linux
which includes 64bit variants of all the major distributions, some
old, some new, some strange.

And no, we will not have
	debian-x86_64-linux
	centos-x86_64-linux
	ffobar...
No way.

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0  ACF0 6CAC A448 860C DC13
------------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Jun  5 11:46:20 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 5 Jun 2015 11:46:20 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <20150605094252.GF11961@auth.logic.tuwien.ac.at>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
Message-ID: <55716FEC.7050304@telecom-bretagne.eu>

Le 05/06/2015 11:42, Norbert Preining a ?crit :
> On Fri, 05 Jun 2015, ?lie Roux wrote:
>> right .so? Or do you mean same binaries wouldn't be able to load the
>> same .so file on a different OS?
> 
> Yes, that is the problem. We are not making a distinction between OS,
> but ARCH-OS, for examples
> 	x86_64-linux
> which includes 64bit variants of all the major distributions, some
> old, some new, some strange.
> 
> And no, we will not have
> 	debian-x86_64-linux
> 	centos-x86_64-linux
> 	ffobar...
> No way.

Sure, I'm just trying to understand: do you mean that the x86_64-linux
luatex binary (which is the same under Debian, Suse, etc.) would be able
to load the x86_64-linux .so on Debian but not under Suse? Why would
this happen?

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Fri Jun  5 11:47:49 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 5 Jun 2015 11:47:49 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <55716FEC.7050304@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
Message-ID: <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>

On Fri, Jun 5, 2015 at 11:46 AM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> Le 05/06/2015 11:42, Norbert Preining a ?crit :
> > On Fri, 05 Jun 2015, ?lie Roux wrote:
> >> right .so? Or do you mean same binaries wouldn't be able to load the
> >> same .so file on a different OS?
> >
> > Yes, that is the problem. We are not making a distinction between OS,
> > but ARCH-OS, for examples
> >       x86_64-linux
> > which includes 64bit variants of all the major distributions, some
> > old, some new, some strange.
> >
> > And no, we will not have
> >       debian-x86_64-linux
> >       centos-x86_64-linux
> >       ffobar...
> > No way.
>
> Sure, I'm just trying to understand: do you mean that the x86_64-linux
> luatex binary (which is the same under Debian, Suse, etc.) would be able
> to load the x86_64-linux .so on Debian but not under Suse? Why would
> this happen?
>
dependencies unjustified,  for example.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150605/cea1e654/attachment.html>

From zdenek.wagner at gmail.com  Fri Jun  5 11:50:15 2015
From: zdenek.wagner at gmail.com (Zdenek Wagner)
Date: Fri, 5 Jun 2015 11:50:15 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <20150605094252.GF11961@auth.logic.tuwien.ac.at>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
Message-ID: <CAC1phyZzUUvCsQu4a-MJ=16mj+4wf2DBqCDWueUD+FSSNa3Y0g@mail.gmail.com>

2015-06-05 11:42 GMT+02:00 Norbert Preining <preining at logic.at>:
> On Fri, 05 Jun 2015, ?lie Roux wrote:
>> right .so? Or do you mean same binaries wouldn't be able to load the
>> same .so file on a different OS?
>
> Yes, that is the problem. We are not making a distinction between OS,
> but ARCH-OS, for examples
>         x86_64-linux
> which includes 64bit variants of all the major distributions, some
> old, some new, some strange.
>
> And no, we will not have
>         debian-x86_64-linux
>         centos-x86_64-linux
>         ffobar...
> No way.
>
If I understand it well, the problem is that ".so" are usually
dynamically linked to other ".so" and this is what is distro
dependent.

And there is one more point. Some universities have network
installation. There is one TL version with binaries for all platforms
which is shared via NFS with unix computers and via CIFS with Windows
computers. All these computers must know how to find the correct
so/dll.

> Norbert
>

Zden?k Wagner
http://hroch486.icpf.cas.cz/wagner/
http://icebearsoft.euweb.cz



> ------------------------------------------------------------------------
> PREINING, Norbert                               http://www.preining.info
> JAIST, Japan                                 TeX Live & Debian Developer
> GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0  ACF0 6CAC A448 860C DC13
> ------------------------------------------------------------------------


From luigi.scarso at gmail.com  Fri Jun  5 11:52:06 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 5 Jun 2015 11:52:06 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
Message-ID: <CAG5iGsAban+18+zLX8HwQFpY4zrBYx=6=wCoTSe4TXzUw981BA@mail.gmail.com>

On Fri, Jun 5, 2015 at 11:47 AM, luigi scarso <luigi.scarso at gmail.com>
wrote:

>
>
> On Fri, Jun 5, 2015 at 11:46 AM, ?lie Roux <elie.roux at telecom-bretagne.eu>
> wrote:
>
>> Le 05/06/2015 11:42, Norbert Preining a ?crit :
>> > On Fri, 05 Jun 2015, ?lie Roux wrote:
>> >> right .so? Or do you mean same binaries wouldn't be able to load the
>> >> same .so file on a different OS?
>> >
>> > Yes, that is the problem. We are not making a distinction between OS,
>> > but ARCH-OS, for examples
>> >       x86_64-linux
>> > which includes 64bit variants of all the major distributions, some
>> > old, some new, some strange.
>> >
>> > And no, we will not have
>> >       debian-x86_64-linux
>> >       centos-x86_64-linux
>> >       ffobar...
>> > No way.
>>
>> Sure, I'm just trying to understand: do you mean that the x86_64-linux
>> luatex binary (which is the same under Debian, Suse, etc.) would be able
>> to load the x86_64-linux .so on Debian but not under Suse? Why would
>> this happen?
>
>
dependencies unsatisfied,  for example
(sorry for the typo)
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150605/6ee15aa6/attachment-0001.html>

From elie.roux at telecom-bretagne.eu  Fri Jun  5 11:54:21 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 5 Jun 2015 11:54:21 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
Message-ID: <557171CD.6030308@telecom-bretagne.eu>

>     Sure, I'm just trying to understand: do you mean that the x86_64-linux
>     luatex binary (which is the same under Debian, Suse, etc.) would be able
>     to load the x86_64-linux .so on Debian but not under Suse? Why would
>     this happen?
> 
> dependencies unjustified,  for example.

Ok, but if TeXLive manages to compile some .so files (for XeTeX for
instance IIRC) and make it generic enough to be used under Debian, Suse,
etc. then I fail to see why it wouldn't manage to compile some .so files
for LuaTeX the same way?

Thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Jun  5 12:03:02 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 05 Jun 2015 12:03:02 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <CAC1phyZzUUvCsQu4a-MJ=16mj+4wf2DBqCDWueUD+FSSNa3Y0g@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <CAC1phyZzUUvCsQu4a-MJ=16mj+4wf2DBqCDWueUD+FSSNa3Y0g@mail.gmail.com>
Message-ID: <557173D6.30600@telecom-bretagne.eu>

> If I understand it well, the problem is that ".so" are usually
> dynamically linked to other ".so" and this is what is distro
> dependent.

Ok, is this the case with all .so files? Or can .so files be statically
linked for instance? (I'm no expert in this area)

For instance if LuaTeX wants to split into one kernel and several
modules, will be it removed from TL?

> And there is one more point. Some universities have network
> installation. There is one TL version with binaries for all platforms
> which is shared via NFS with unix computers and via CIFS with Windows
> computers. All these computers must know how to find the correct
> so/dll.

Sure, but with

CLUAINPUTS =
$SELFAUTOLOC/lib/{$architecture,}/{$progname,$engine,}/lua//

this problem would vanish I suppose?

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Fri Jun  5 12:09:25 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 5 Jun 2015 12:09:25 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <557171CD.6030308@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
Message-ID: <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>

On Fri, Jun 5, 2015 at 11:54 AM, ?lie Roux <elie.roux at telecom-bretagne.eu>
wrote:

> >     Sure, I'm just trying to understand: do you mean that the
> x86_64-linux
> >     luatex binary (which is the same under Debian, Suse, etc.) would be
> able
> >     to load the x86_64-linux .so on Debian but not under Suse? Why would
> >     this happen?
> >
> > dependencies unjustified,  for example.
>
> Ok, but if TeXLive manages to compile some .so files (for XeTeX for
> instance IIRC) and make it generic enough to be used under Debian, Suse,
> etc. then I fail to see why it wouldn't manage to compile some .so files
> for LuaTeX the same way?
>
> Thank you,
> --
> Elie
>
hm, I don't see any so in my texlive 2015 pretest and in trunk/Master.
The only dso I see are dll and none is problematic (almost all 32bit apart
./texmf-dist/scripts/context/stubs/win64/mtxrun.dll:            PE32+
executable (DLL) (console) x86-64 (stripped to external PDB), for MS
Windows)



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150605/535c7251/attachment.html>

From elie.roux at telecom-bretagne.eu  Fri Jun  5 12:21:25 2015
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-15?Q?=C9lie_Roux?=)
Date: Fri, 5 Jun 2015 12:21:25 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <alpine.LSU.2.11.1506051202070.14316@pcl321.mppmu.mpg.de>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <55716AC5.4040206@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051202070.14316@pcl321.mppmu.mpg.de>
Message-ID: <55717825.7000809@telecom-bretagne.eu>

> (1) TeXLive does not compile any .so files for XeTeX but rather uses the
> libfontconfig.so.1 of the system installed in, e.g., /usr/lib64/.

ok

> (2) The trick is to compile the x86_64-linux binaries on a system with a
> fairly old version of the GNU C Library in order not to depend on symbols
> introduced more recently and not available on, e.g., CentOs5.  Compiling an
> .so on such a system would help but there is still the problem of different
> versions of other shared libaries.

lualatex-platform and harfbuzz don't seem to depend on other shared
libaries...

one (poor) solution would be to provide lualatex-platform for windows
only... It is very platform-dependant code anyway, and it's only under
Windows that it can do things that cannot be done otherwise simply.

thank you,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Fri Jun  5 12:24:31 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 5 Jun 2015 12:24:31 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
Message-ID: <557178DF.4060103@telecom-bretagne.eu>

> hm, I don't see any so in my texlive 2015 pretest and in trunk/Master.
> The only dso I see are dll and none is problematic (almost all 32bit apart
> ./texmf-dist/scripts/context/stubs/win64/mtxrun.dll:            PE32+
> executable (DLL) (console) x86-64 (stripped to external PDB), for MS
> Windows)

>From what I understand, Windows is less problematic than Linux... But
what will happen when luatex will be split in one kernel + several .so
files? Will TL change it and compile everything statically under Linux?
If so, why not also statically compiling other things such as
lualatex-platform and harfbuzz?

Thank you,
-- 
Elie

From zdenek.wagner at gmail.com  Fri Jun  5 13:09:12 2015
From: zdenek.wagner at gmail.com (Zdenek Wagner)
Date: Fri, 5 Jun 2015 13:09:12 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <557178DF.4060103@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
Message-ID: <CAC1phybq1a7wHUZfCw8it+HaZhntmYSCHTuT61UZOTF__PQKpg@mail.gmail.com>

If luatex (or whatever) is changed to depend on .so files, it will not
be installable in compiled form. Instead it will be necesary to
install the source codes, each users will have to have autodonf,
automake, compiler, development headers and tlmgr will have to compile
them. You can rely on dynamic linkig only if you compile for a
particular distro.
Zden?k Wagner
http://hroch486.icpf.cas.cz/wagner/
http://icebearsoft.euweb.cz


2015-06-05 12:24 GMT+02:00 ?lie Roux <elie.roux at telecom-bretagne.eu>:
>> hm, I don't see any so in my texlive 2015 pretest and in trunk/Master.
>> The only dso I see are dll and none is problematic (almost all 32bit apart
>> ./texmf-dist/scripts/context/stubs/win64/mtxrun.dll:            PE32+
>> executable (DLL) (console) x86-64 (stripped to external PDB), for MS
>> Windows)
>
> >From what I understand, Windows is less problematic than Linux... But
> what will happen when luatex will be split in one kernel + several .so
> files? Will TL change it and compile everything statically under Linux?
> If so, why not also statically compiling other things such as
> lualatex-platform and harfbuzz?
>
> Thank you,
> --
> Elie


From pragma at wxs.nl  Fri Jun  5 13:32:20 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 5 Jun 2015 13:32:20 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <55714807.9050101@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu> <5570EF5D.2010003@wxs.nl>
 <55714807.9050101@telecom-bretagne.eu>
Message-ID: <557188C4.2070309@wxs.nl>

On 6/5/2015 8:56 AM, ?lie Roux wrote:

>> (3) What works for context also can work or other macro packages, but
>> the way things get integrated can differ. So, what works in context
>> might not work in latex or plain and vice versa. The choice for
>> swiglib means that we stick to the original apis but can write macro
>> package specific wrappers around it.
>
> The main point here I think is distribution: in the future, how will
> ConTeXt ship dso? When will they be released, etc. will
> they be included in snapshots, or will there be some kind of package
> manager?

the garden distribution is a subset of tex live plus some extras and 
users can choose to install additional modules and fonts (which will be 
remembered when as next update happens) ... we could add dll/so to that 
is needed (which then will be compiled along with the luatex binaries so 
there is a consistent set)

>> we already have an infrastructure for compiling for years and
>> swiglibs will be part of it (given demand) .. this is also handy for
>> testing luatex betas (and i'm no too interested in spending time on
>> making sure all we do also works in whatever macro package)
>
> This is precisely the point: what about things you're not interested in?
> (harfbuzz, lualatex-platform, etc.) Does it mean only you will choose
> the dso present in ConTeXt and thus in TeXLive, or is there a
> possibility to add a dso in TeXLive that is not in ConTeXt?

well, i only provide the standard context files to tex live so if users 
put some other stuff for context in it that is fine for me; but the 
problem is not so much extra libraries but more to make sure they don't 
mess up regular usage; it's not different from adding additional node 
juggling code: it can (and probably will) interfere with core 
functionality and as such is not officially supported (or garanteed to 
work with updated context kernels); for instance, an alternative font 
handler or input file (location) handler is very unlikely to work, 
although the later is easier to plug into the framework)

>> but the reference is always the yearly tl distribution (and it is
>> unlikely that context expects tex live to ship extra libraries fo
>> rits usage)
>
> So I think the main questions are:
>
> - can dso run in TeXLive's "luatex" command?

i suppose so

> - if so, what restrictions? how to compile the libraries so that they
> respect openout_any, etc.?

i dunno

> - how are the dso compiled and distributed? Provided as binaries by
> ConTeXt (preventing inclusions of dso that ConTeXt is not interested in)
> or compiled by TeXLive?

context has its own loading mechanism (and sandboxing model) so if there 
is demand i can add or lift all kind of restrictions via the 
configuration file

Hans


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From peb at mppmu.mpg.de  Fri Jun  5 10:54:07 2015
From: peb at mppmu.mpg.de (Peter Breitenlohner)
Date: Fri, 5 Jun 2015 10:54:07 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <55715EA3.3070506@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
Message-ID: <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>

On Fri, 5 Jun 2015, ?lie Roux wrote:

> We're talking here about things loaded by Lua(TeX)'s "require" function,
> that looks for .(dll|so) in directories listed by texmf.cnf's
> CLUAINPUTS, so I don't think the problem you're talking about exists.

And how to place them for differnt architectures (e.g., coexisting i686 and
x86_64) such that the 32- and 64-bit executables find the corresponding
shared objects?

Remember, TL could be on a filesystem shared between 32- and 64-bit Unix and
Windows systems, with variables such as CLUAINPUTS pointing to system
independet locations.  One possibility would be that the "require" function
looks into architecture dependent subdirectories of CLUAINPUTS.

Regards
Peter

From peb at mppmu.mpg.de  Fri Jun  5 12:12:30 2015
From: peb at mppmu.mpg.de (Peter Breitenlohner)
Date: Fri, 5 Jun 2015 12:12:30 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <55716AC5.4040206@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <55716AC5.4040206@telecom-bretagne.eu>
Message-ID: <alpine.LSU.2.11.1506051202070.14316@pcl321.mppmu.mpg.de>

On Fri, 5 Jun 2015, ?lie Roux wrote:

> Ok, but if TeXLive manages to compile some .so files (for XeTeX for
> instance IIRC) and make it generic enough to be used under Debian, Suse,
> etc. then I fail to see why it wouldn't manage to compile some .so files
> for LuaTeX the same way?

(1) TeXLive does not compile any .so files for XeTeX but rather uses the
libfontconfig.so.1 of the system installed in, e.g., /usr/lib64/.

(2) The trick is to compile the x86_64-linux binaries on a system with a
fairly old version of the GNU C Library in order not to depend on symbols
introduced more recently and not available on, e.g., CentOs5.  Compiling an
.so on such a system would help but there is still the problem of different
versions of other shared libaries.

Regards
Peter

From pragma at wxs.nl  Fri Jun  5 13:34:20 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 5 Jun 2015 13:34:20 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <20150605091857.GE11961@auth.logic.tuwien.ac.at>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
Message-ID: <5571893C.401@wxs.nl>

On 6/5/2015 11:18 AM, Norbert Preining wrote:
> On Fri, 05 Jun 2015, Peter Breitenlohner wrote:
>> And how to place them for differnt architectures (e.g., coexisting i686 and
>> x86_64) such that the 32- and 64-bit executables find the corresponding
>> shared objects?
>
> I think the problem is not the positioning. We can easiky have
> 	Master/lib/<ARCH>/...
> and include that in some way. The problem is with portability within
> the same arch/os combinations, from CentOS over SuSE to Debian et cetc,
> all would need to be usable with *the*same* .so.
>
> I am not sure if that works, we haven't tried. And I am not sure
> I want t ask all builders to try it out ;-)

right, so the main purpose of some kind of support is that power users 
who have workflows depending on whatever library have a way to use them

(there are more interesting things to do in life then fighting changing 
apis and dependencies)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Fri Jun  5 14:12:17 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 5 Jun 2015 14:12:17 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <CAC1phybq1a7wHUZfCw8it+HaZhntmYSCHTuT61UZOTF__PQKpg@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
 <CAC1phybq1a7wHUZfCw8it+HaZhntmYSCHTuT61UZOTF__PQKpg@mail.gmail.com>
Message-ID: <55719221.2010304@telecom-bretagne.eu>

Le 05/06/2015 13:09, Zdenek Wagner a ?crit :
> If luatex (or whatever) is changed to depend on .so files, it will not
> be installable in compiled form. Instead it will be necesary to
> install the source codes, each users will have to have autodonf,
> automake, compiler, development headers and tlmgr will have to compile
> them. You can rely on dynamic linkig only if you compile for a
> particular distro.

Ok, so the consensus seems to be "no shared library in TeXLive, due to
technical obstacles, especially under Linux". Unless someone has a new
argument, I think the discussion on this is more or less closed (and
might be reopened if luatex splits into dso).

A few points remain:

- should "." be removed from CLUAINPUTS?

- should CLUAINPUTS become
$SELFAUTOLOC/lib/{$architecture,}/{$progname,$engine,}/lua//
?

- should there be a restriction on loadable libraries?

- Hans, does it seem reasonable to have a ConTeXt script installing the
shared libraries provided by ConTeXtgarden, so that TeXLive users can
install them by running this script?

- could we imagine some place in the TeXLive svn for the source code of
these libraries; they would not be compiled, but TeXLive distro
packagers (Debian, Suse, Mac, whatever) can provide an additional
package "luatex-shared" or something like that, based on this source
code? That would ease their work and make things a bit homogeneous.

- as there doesn't seem to be problems with dll under Windows, could
there be an exception to the "no dso in TeXLive" rule for
lualatex-platform under Windows? It could be called by luaotfload (with
no error if absent) to read the registry under Windows

- if something is to be made by luaotfload to cache the font locations
in the registry, to be called by tlmgr (a bit like updmap, etc.), could
this be "luaotfload-tool --cache-registry" or should it be an
independent script? If it needs to be independent, what about the name
"luaotfload-cache-registry.exe"? The script wouldn't do anything under a
non-Windows OS.

Thank you,
-- 
Elie

From michal.h21 at gmail.com  Fri Jun  5 14:39:02 2015
From: michal.h21 at gmail.com (Michal Hoftich)
Date: Fri, 5 Jun 2015 14:39:02 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <557178DF.4060103@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
Message-ID: <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>

This discussion is really interesting for me, as I am the author of
experimental Harfbuzz module (resp. LuaLaTeX package for binary
library copied from SILE).

Isn't possible to use Luarocks to distribute binary modules? This
unfortunately means that user would need to install luarocks and then
modules by hand, but it's better than nothing.

I have in mind two possible approaches:

1. use standard Luarocks and use modified module loader to load
libraries. I used this approach in one answer on TeX.sx:

http://tex.stackexchange.com/a/219228/2891

the problem is that we probably don't have access to paths used by
Luarocks from LuaTeX, maybe we can extract them using
io.popen("luarocks path","r") and parsing the output?

2. use modified version of Luarocks and install binary packages
directly in $CLUAINPUTS

The first option seems more realistic to me.

Michal

From elie.roux at telecom-bretagne.eu  Fri Jun  5 15:04:02 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 5 Jun 2015 15:04:02 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
 <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
Message-ID: <55719E42.9030009@telecom-bretagne.eu>

> Isn't possible to use Luarocks to distribute binary modules?

A little remark so that everyone can follow: Luarocks compiles the
binaries on the user's machine, it doesn't distribute binaries per se.

> This
> unfortunately means that user would need to install luarocks and then
> modules by hand, but it's better than nothing.

Indeed, but I think it's way too complex for the average user... That
means your package will remain a marginal experiment (which is a pity).

> I have in mind two possible approaches:
> 
> 1. use standard Luarocks and use modified module loader to load
> libraries. I used this approach in one answer on TeX.sx:
> 
> http://tex.stackexchange.com/a/219228/2891
> 
> the problem is that we probably don't have access to paths used by
> Luarocks from LuaTeX, maybe we can extract them using
> io.popen("luarocks path","r") and parsing the output?

On my machine LuaTeX finds the rocks without changing anything... I have
Debian/Sid with a vanilla luarocks.

executing luarocks would mean having luarocks in the
shell_escape_commands, which is certainly not an option... But users
could add the path to CLUAINPUTS, I think that's the safest option.

> 2. use modified version of Luarocks and install binary packages
> directly in $CLUAINPUTS
> 
> The first option seems more realistic to me.

Indeed...

Thank you,
-- 
Elie

From luigi.scarso at gmail.com  Fri Jun  5 15:27:06 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 5 Jun 2015 15:27:06 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
 <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
Message-ID: <CAG5iGsD_-sOceNJV3AaAqotMPYeVLRQz1GwbcmghCGkTe56Sew@mail.gmail.com>

On Fri, Jun 5, 2015 at 2:39 PM, Michal Hoftich <michal.h21 at gmail.com> wrote:

> This discussion is really interesting for me, as I am the author of
> experimental Harfbuzz module (resp. LuaLaTeX package for binary
> library copied from SILE).
>
> Isn't possible to use Luarocks to distribute binary modules? This
> unfortunately means that user would need to install luarocks and then
> modules by hand, but it's better than nothing.
>
> hm be careful here.
Luatex has his own Lua interpreter, a binding should be  compiled following
the Lua API of Luatex
Or: a  binding for Lua 5.2.3 not necessarily works with Luatex.

PS
I have made a swiglib binding for harfbuzz 0.9.40 for linux 64bit and win32
in  an hour  or so (a nice break from a bug hunting)
foundry.supelec.fr/scm/viewvc.php/trunk/experimental/harfbuzz/?root=swiglib
Of course, I don't knwo if it works at all.
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150605/652aa447/attachment-0001.html>

From zdenek.wagner at gmail.com  Fri Jun  5 15:52:43 2015
From: zdenek.wagner at gmail.com (Zdenek Wagner)
Date: Fri, 5 Jun 2015 15:52:43 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <55719E42.9030009@telecom-bretagne.eu>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
 <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
 <55719E42.9030009@telecom-bretagne.eu>
Message-ID: <CAC1phyZHhEjjMRf3+C7vAGg_xwkF_-ofqmjkQVEq0CO1Wga_HQ@mail.gmail.com>

2015-06-05 15:04 GMT+02:00 ?lie Roux <elie.roux at telecom-bretagne.eu>:
>> Isn't possible to use Luarocks to distribute binary modules?
>
> A little remark so that everyone can follow: Luarocks compiles the
> binaries on the user's machine, it doesn't distribute binaries per se.
>
Is it compiled at install time, or at run time? If it is compiled at
install time, it is bad because the TEXMF tree may be physically
located eg in Synology and accessed by many computers with different
operating systems. If it is compiled at run time, the compiled binary
must be stored at the user's computer because the user has no write
access to TEXMF-DIST or TEXMF-VAR.

>> This
>> unfortunately means that user would need to install luarocks and then
>> modules by hand, but it's better than nothing.
>
> Indeed, but I think it's way too complex for the average user... That
> means your package will remain a marginal experiment (which is a pity).
>
>> I have in mind two possible approaches:
>>
>> 1. use standard Luarocks and use modified module loader to load
>> libraries. I used this approach in one answer on TeX.sx:
>>
>> http://tex.stackexchange.com/a/219228/2891
>>
>> the problem is that we probably don't have access to paths used by
>> Luarocks from LuaTeX, maybe we can extract them using
>> io.popen("luarocks path","r") and parsing the output?
>
> On my machine LuaTeX finds the rocks without changing anything... I have
> Debian/Sid with a vanilla luarocks.
>
> executing luarocks would mean having luarocks in the
> shell_escape_commands, which is certainly not an option... But users
> could add the path to CLUAINPUTS, I think that's the safest option.
>
>> 2. use modified version of Luarocks and install binary packages
>> directly in $CLUAINPUTS
>>
>> The first option seems more realistic to me.
>
> Indeed...
>
> Thank you,
> --
> Elie


Zden?k Wagner
http://hroch486.icpf.cas.cz/wagner/
http://icebearsoft.euweb.cz


From elie.roux at telecom-bretagne.eu  Fri Jun  5 16:08:40 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 05 Jun 2015 16:08:40 +0200
Subject: [luatex] [tex-live]  lltxplatform integration
In-Reply-To: <CAC1phyZHhEjjMRf3+C7vAGg_xwkF_-ofqmjkQVEq0CO1Wga_HQ@mail.gmail.com>
References: <556FFD5E.3020707@telecom-bretagne.eu>
 <CAG5iGsCd=g=q1c8awBK3U+iJU7=NHpihaXFjcuEyLYGRE-+6_A@mail.gmail.com>
 <55701695.9090504@telecom-bretagne.eu>
 <CAG5iGsDaWPV2qb1s_N9dEx_KkQT7J5fOFJv96KkvLo=8MaQktQ@mail.gmail.com>
 <55703509.7010005@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506050944100.14316@pcl321.mppmu.mpg.de>
 <55715EA3.3070506@telecom-bretagne.eu>
 <alpine.LSU.2.11.1506051043220.14316@pcl321.mppmu.mpg.de>
 <20150605091857.GE11961@auth.logic.tuwien.ac.at>
 <55716C23.9020400@telecom-bretagne.eu>
 <20150605094252.GF11961@auth.logic.tuwien.ac.at>
 <55716FEC.7050304@telecom-bretagne.eu>
 <CAG5iGsDrcR78B2Dmap6tLGQKHMF2KOTwTFNUq6uZy5pvz2+fwA@mail.gmail.com>
 <557171CD.6030308@telecom-bretagne.eu>
 <CAG5iGsBXG7oGvxhyMvMySY7mJwuX6ffSc8dGdY3b67A6ATh-fg@mail.gmail.com>
 <557178DF.4060103@telecom-bretagne.eu>
 <CAOCj1Of14bQFH9T9FNBKxWC83vd9A8C1skLg86_iQBUqqdt7Rw@mail.gmail.com>
 <55719E42.9030009@telecom-bretagne.eu>
 <CAC1phyZHhEjjMRf3+C7vAGg_xwkF_-ofqmjkQVEq0CO1Wga_HQ@mail.gmail.com>
Message-ID: <5571AD68.1080701@telecom-bretagne.eu>

> Is it compiled at install time, or at run time?

At install time

> If it is compiled at
> install time, it is bad because the TEXMF tree may be physically
> located eg in Synology and accessed by many computers with different
> operating systems.

Luarocks don't get installed in the TEXMF tree, so in order to get your
use case working, a script would need to move the compiled rocks in an
arch-specific TEXMF tree... I don't believe there is a more
straightforward solution...

Thank you,
-- 
Elie

From mojca.miklavec.lists at gmail.com  Fri Jun  5 19:26:20 2015
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 5 Jun 2015 19:26:20 +0200
Subject: [luatex] Discussion about packaging binary modules for LuaTeX (&
 ConTeXt Meeting 2015 in France)
Message-ID: <CALBOmsZXPfbwH2ySoE3f37OS5fCVmwu4NjK+OpFJ7A1ucDikTw@mail.gmail.com>

(was: lltxplatform integration)

Dear ?lie,

Assuming that you might be French (judging from your name) and given
that this year's ConTeXt Meeting is going to be in France (so
hopefully not too far from where you live):

    http://meeting.contextgarden.net/2015/

this might be an excellent opportunity for you to come to the meeting
and schedule a discussion about different ways (with pros and cons)
about packaging binary modules for LuaTeX.

We've been discussing some kind of automated builds of LuaTeX (and
other engines) for a while already, and planned to discuss how to
integrate automated "swiglib" builds as well. We don't have all the
answers ready at the moment, but some clever combination of
[semi-]automated builds (either using buildbots or humans who press a
button every now and then ? which already works well for building the
latest releases of LuaTeX, MetaPost and XeTeX), TLContrib and some
smart scripting hackery might result in some acceptable user-friendly
way to get the desired functionality to the users.

You should consider joining us and hope for a fruitful discussion
together with all the "players" (LuaTeX developers, TLContrib hacker,
ConTeXt garden packagers etc.).

Mojca


On Thu, Jun 4, 2015 at 9:25 AM, ?lie Roux wrote:
>> Before we include any such .so, there should be an option in luatex
>> about loading .so's (maybe it already exists?), and the default has to
>> be off.  Otherwise our efforts at security are lost, so far as I can see.
>
> That's a difficult question...
>
>> Which means, it seems to me, that the feature is only useful for
>> particular users doing particular things, not for shipping stuff to be
>> used by everyone.
>
> It is useful for Windows users
>
>> As I understand it, ConTeXt gets the list of OS fonts by running a
>> script at install time, or really mtxrun --generate time.  I expect we
>> could figure out something similar for lualatex.  Ideally even re-using
>> the same file if it exists ...
>
> Sadly, Windows has a mechanism that stocks some installed fonts only in
> the registry, and not in a standard directory. Fonts installed this way
> are not handled by ConTeXt. There aren't many cases where users install
> fonts this way, but (AFAIK) the mechanism is quite recent and there
> might be more and more demand on this...
>
> There are currently two ways to access the registry in LuaTeX:
>  - loading a .so file that calls the Windows API (lua-winreg,
> lualatex-platform, etc.)
>  - calling the "reg" command
>
> The second is already forbidden by shell_escape_commands (which is
> good), and if you forbid the first one, this means that users will never
> be able to have all their fonts found by TeX.
>
> The only other way this could be dealt with would be through fontconfig,
> but fontconfig doesn't support the fonts in the registry, doesn't plan
> to, and making a patch is not easy (fonts not in a standard directory
> doesn't fit well with fontconfig architecture).[1][2]
>
>> Overall, I think just about any alternative -- a script, a system call,
>> a whole separate program, whatever -- is preferable to a .so.
>
> This means that all modules people need will have to be statically
> linked with LuaTeX? This seems a difficult choice, and I'm not sure the
> LuaTeX team is willing to do this... This will also forbid experiments
> with harfbuzz, etc. Maybe there could be a list of allowed extensions,
> that would respect openin_any and openout_any (lualatex-platform does,
> it doesn't read nor write any file), and also removing "." from CLUAINPUTS ?
>
>> They'd only be updated once a year, or more precisely when the binaries
>> are updated.  There is no miracle way to get them compiled on all
>> platforms on demand, and I don't want to impose repeated recompiling on
>> our builders (or manage such an effort).
>
> Ok
>
>> I also expect it will take
>> quite some effort to get figure out the first one.
>
> Indeed, hence my question...
>
> Thank you!
> --
> Elie
>
> [1]: http://lists.freedesktop.org/archives/fontconfig/2015-May/005510.html
> [2]: https://bugs.freedesktop.org/show_bug.cgi?id=90813


From elie.roux at telecom-bretagne.eu  Fri Jun  5 21:22:14 2015
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 05 Jun 2015 21:22:14 +0200
Subject: [luatex] Discussion about packaging binary modules for LuaTeX
 (& ConTeXt Meeting 2015 in France)
In-Reply-To: <CALBOmsZXPfbwH2ySoE3f37OS5fCVmwu4NjK+OpFJ7A1ucDikTw@mail.gmail.com>
References: <CALBOmsZXPfbwH2ySoE3f37OS5fCVmwu4NjK+OpFJ7A1ucDikTw@mail.gmail.com>
Message-ID: <5571F6E6.2060609@telecom-bretagne.eu>

> Assuming that you might be French (judging from your name)

I admit I almost read "judging from your arrogance and stubbornness" :)

> We've been discussing some kind of automated builds of LuaTeX (and 
> other engines) for a while already, and planned to discuss how to 
> integrate automated "swiglib" builds as well.

Good, sorry to make such a noise now, I didn't know this was being
discussed!

> TLContrib

I almost forgot about it, but it seems kind of frozen...?

> and some smart scripting hackery might result in some acceptable
> user-friendly way to get the desired functionality to the users.

Sure, that sounds a good way to go for me: something simple, generic,
providing binaries for reasonable architectures (I think people using
CentOS5 should be skilled enough to compile themselves)... If things go
in that direction, then it's very fine!

> You should consider joining us and hope for a fruitful discussion 
> together with all the "players" (LuaTeX developers, TLContrib
> hacker, ConTeXt garden packagers etc.).

This seems a good idea (though I've never actually compiled anything
with ConTeXt); it's not too far from where I live, I'll think about that!

Thank you,
-- 
Elie

From mojca.miklavec.lists at gmail.com  Fri Jun  5 21:46:10 2015
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 5 Jun 2015 21:46:10 +0200
Subject: [luatex] [tex-live] Discussion about packaging binary modules
 for LuaTeX (& ConTeXt Meeting 2015 in France)
In-Reply-To: <5571F6E6.2060609@telecom-bretagne.eu>
References: <CALBOmsZXPfbwH2ySoE3f37OS5fCVmwu4NjK+OpFJ7A1ucDikTw@mail.gmail.com>
 <5571F6E6.2060609@telecom-bretagne.eu>
Message-ID: <CALBOmsYkb=FEKYj60sdALVa-HuYJEdwp+VsK3vyouxrbJqWhiA@mail.gmail.com>

On Fri, Jun 5, 2015 at 9:22 PM, ?lie Roux wrote:
>> Assuming that you might be French (judging from your name)
>
> I admit I almost read "judging from your arrogance and stubbornness" :)
>
>> We've been discussing some kind of automated builds of LuaTeX (and
>> other engines) for a while already, and planned to discuss how to
>> integrate automated "swiglib" builds as well.
>
> Good, sorry to make such a noise now, I didn't know this was being
> discussed!

It was being discussed, albeit not with a very high priority. (Some
higher priority tasks are being postponed for years.)

>> TLContrib
>
> I almost forgot about it, but it seems kind of frozen...?

It's true that it's frozen, but:

(a) I guess it's just because Taco was mainly interested in
distributing an up-to-date LuaTeX at the time of setting it up; and
when LuaTeX didn't get any major updates between TL releases, the
repository staled.

(b) You'll have an opportunity to bribe the maintainer with a box of
beer to get it up and running with the latest TL if you come to the
conference.

(c) It's easy enough to set up some independent mirror (as long as you
don't have to deal with user management and only need a set of simple
scrips that would fetch the package content from some well-defined
repository).

>> and some smart scripting hackery might result in some acceptable
>> user-friendly way to get the desired functionality to the users.
>
> Sure, that sounds a good way to go for me: something simple, generic,
> providing binaries for reasonable architectures (I think people using
> CentOS5 should be skilled enough to compile themselves)... If things go
> in that direction, then it's very fine!
>
>> You should consider joining us and hope for a fruitful discussion
>> together with all the "players" (LuaTeX developers, TLContrib
>> hacker, ConTeXt garden packagers etc.).
>
> This seems a good idea (though I've never actually compiled anything
> with ConTeXt); it's not too far from where I live, I'll think about that!

You don't have to be a ConTeXt user in order to attend a meeting.

In fact, a bunch of regular attendants who never use ConTeXt come just
because of the great conference atmosphere. Similar is true for the
Polish user meeting (BachoTeX). Many participants don't understand any
Polish and many don't use any TeX at all. It's just the great
atmosphere, discussions, bonfire, singing etc. that makes people keep
coming back, often with families.

(We also need to make sure that Manuel P?gouri?-Gonnard comes to
Nasbinals. Then we can organize a "parallel" hyphenation meeting as
well ;)

Mojca


From martin at oneiros.de  Sat Jun  6 01:13:42 2015
From: martin at oneiros.de (=?UTF-8?Q?Martin_Schr=C3=B6der?=)
Date: Sat, 6 Jun 2015 01:13:42 +0200
Subject: [luatex] Fwd: [dante-ev] FYI: Hermann Zapf
In-Reply-To: <DEDAEEF1-B81D-49E7-B9CA-0B58D5FE3EFC@gmx.net>
References: <DEDAEEF1-B81D-49E7-B9CA-0B58D5FE3EFC@gmx.net>
Message-ID: <CAP7DCDfic61Biv+iQb7t0yN=aE_heam-RCuyNAKKj+P27XAZuw@mail.gmail.com>

---------- Forwarded message ----------
From: Juergen Fenn <jfenn at gmx.net>
Date: 2015-06-06 0:44 GMT+02:00
Subject: [dante-ev] FYI: Hermann Zapf
To: "\"Diskussionsliste von DANTE e.V. f?r Mitglieder
Diskussionsliste\"" <dante-ev at dante.de>


---------- Forwarded message ----------
From:  <bnb at ams.org>
Date: 2015-06-05 21:36 GMT+02:00
Subject: Hermann Zapf
To: TYPO-L at listserv.heanet.ie


i've just learned (from Chuck Bigelow)
that Hermann Zapf has died.  R.I.P.
                                       -- bb


________________________________
Barbara Beeton
Publications Technical Specialist
American Mathematical Society
201 Charles Street
Providence, RI 02904
Phone: +1 401.455.4000
Fax: +1 401.331.3842
[http://www.ams.org/images/emailFooter-MR75th.png]<http://www.ams.org/about-us/contact/reach>
AMS on Social Media<http://www.ams.org/about-us/social>


From reinhard.kotucha at googlemail.com  Sat Jun  6 03:09:18 2015
From: reinhard.kotucha at googlemail.com (Reinhard Kotucha)
Date: Sat, 6 Jun 2015 03:09:18 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <5570EF5D.2010003@wxs.nl>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>	<5570EF5D.2010003@wxs.nl>
Message-ID: <21874.18494.625542.193013@zaphod.ms25.net>

On 2015-06-05 at 02:37:49 +0200, Hans Hagen wrote:

 > [...] I am not that interested in fonts that are installed in
 > fuzzy locations.

You are probably not allowed to use fonts shipped with 3rd-party
software.  I strongly recommend to read the license before using
a font which is not part of TeX Live already.  I fear that in most
cases such fonts are unusable for legal reasons anyway.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From elie.roux at telecom-bretagne.eu  Sat Jun  6 08:40:31 2015
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Sat, 06 Jun 2015 08:40:31 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <21874.18494.625542.193013@zaphod.ms25.net>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>	<5570EF5D.2010003@wxs.nl>
 <21874.18494.625542.193013@zaphod.ms25.net>
Message-ID: <557295DF.9070505@telecom-bretagne.eu>

Le 06/06/2015 03:09, Reinhard Kotucha a ?crit :
> On 2015-06-05 at 02:37:49 +0200, Hans Hagen wrote:
> 
>> [...] I am not that interested in fonts that are installed in fuzzy
>> locations.
> 
> You are probably not allowed to use fonts shipped with 3rd-party 
> software.  I strongly recommend to read the license before using a
> font which is not part of TeX Live already.  I fear that in most 
> cases such fonts are unusable for legal reasons anyway.

We're talking about fonts that are considered "installed" under Windows,
and hence are shown in the font list of all Windows applications (Word,
etc.), not fonts shipped with 3rd party software. The example that
started the discussion was somebody using "Maintype"[1] to manage his
fonts[2].

Thank you!
-- 
Elie

[1]: http://www.high-logic.com/font-manager/maintype.html
[2]: http://forum.high-logic.com/viewtopic.php?f=12&t=5612&p=25551#p25551

From pragma at wxs.nl  Sat Jun  6 09:26:22 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 6 Jun 2015 09:26:22 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <21874.18494.625542.193013@zaphod.ms25.net>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>	<5570EF5D.2010003@wxs.nl>
 <21874.18494.625542.193013@zaphod.ms25.net>
Message-ID: <5572A09E.3030609@wxs.nl>

On 6/6/2015 3:09 AM, Reinhard Kotucha wrote:
> On 2015-06-05 at 02:37:49 +0200, Hans Hagen wrote:
>
>   > [...] I am not that interested in fonts that are installed in
>   > fuzzy locations.
>
> You are probably not allowed to use fonts shipped with 3rd-party
> software.  I strongly recommend to read the license before using
> a font which is not part of TeX Live already.  I fear that in most
> cases such fonts are unusable for legal reasons anyway.

I only use free fonts (goven that the quality is good) or buy them (for 
projects) (even my cambria is an official one). The only time i 'use' a 
system font is when a user uses it in a mwe.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sat Jun  6 09:28:42 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 6 Jun 2015 09:28:42 +0200
Subject: [luatex] [tex-live] lltxplatform integration
In-Reply-To: <557295DF.9070505@telecom-bretagne.eu>
References: <201506032334.t53NYEv6001270@freefriends.org>
 <556FFD5E.3020707@telecom-bretagne.eu>	<5570EF5D.2010003@wxs.nl>
 <21874.18494.625542.193013@zaphod.ms25.net>
 <557295DF.9070505@telecom-bretagne.eu>
Message-ID: <5572A12A.6050106@wxs.nl>

On 6/6/2015 8:40 AM, ?lie Roux wrote:
> Le 06/06/2015 03:09, Reinhard Kotucha a ?crit :
>> On 2015-06-05 at 02:37:49 +0200, Hans Hagen wrote:
>>
>>> [...] I am not that interested in fonts that are installed in fuzzy
>>> locations.
>>
>> You are probably not allowed to use fonts shipped with 3rd-party
>> software.  I strongly recommend to read the license before using a
>> font which is not part of TeX Live already.  I fear that in most
>> cases such fonts are unusable for legal reasons anyway.
>
> We're talking about fonts that are considered "installed" under Windows,
> and hence are shown in the font list of all Windows applications (Word,
> etc.), not fonts shipped with 3rd party software. The example that
> started the discussion was somebody using "Maintype"[1] to manage his
> fonts[2].

in that case a copy in a tex tree is better (i don't put my text files 
in the places the os likes most either)

the advantage of keeping files in the tree is that (1) one can create 
backups easier and (2) move a tex tree to another machine without hassle

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Sat Jun 13 14:54:38 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 13 Jun 2015 14:54:38 +0200
Subject: [luatex] Luatex 0.80.0 announcement
Message-ID: <CAG5iGsBS71YvEDOMs62kuxS-jFeNR5KN8DEzYM-fdDheYG+VcA@mail.gmail.com>

New luatex release, 0.80.0
This is the release of TeXLive 2015, which is now available for downloading
(see http://tug.org/texlive/ for more info).


Changes:

* New library newtokenlib. It will replace the current token lib.
* Fixed a bug on the normal random generator for double/decimal/binary
  number systems.
* Several others bugs fixed.


The archives can be downloaded from supelec as usual:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.80.0
<https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.1>

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

Have fun,
Hans, Taco, Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150613/922a6081/attachment.html>

From d.p.carlisle at gmail.com  Tue Jun 16 14:09:02 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Tue, 16 Jun 2015 13:09:02 +0100
Subject: [luatex] [tex-live] TL15: luatex and \pdftexversion
In-Reply-To: <20150616112635.GE31825@hzdr.de>
References: <20150616112635.GE31825@hzdr.de>
Message-ID: <CAEW6iOhonp2Szy-95X5Bh4-7-r6wiuFktLWkq+wCChHA3qpfwg@mail.gmail.com>

On 16 June 2015 at 12:26, Alexander Grahn <A.Grahn at hzdr.de> wrote:
> Why is this version number regression from 240 to 80 in TeXLive-2015:
>
> TeXLive-2014:
> =============
>
> $ luatex
> This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
>  restricted \write18 enabled.
> **\message{\the\pdftexversion}
> 200
>
> TeXLive-2015:
> =============
>
> $ luatex
> This is LuaTeX, Version beta-0.80.0 (TeX Live 2015) (rev 5238)
>  restricted \write18 enabled.
> **\message{\the\pdftexversion}
> 80
>
> Alexander

the manual still implies it is 200  but it doesn't really matter
as it was a spurious value before and it'll be gone next time
(0.)80 is the luatex version number

the manual says:


The pdfTEX related primitives will be removed from versions after
0.80. All the version related details
are available in the status table at the Lua end, for instance one can say:
\let\pdftexbanner \luatexbanner
\let\pdftexversion \luatexversion
\let\pdftexrevision\luatexrevision
if these are really needed in a macro package.

David

From A.Grahn at hzdr.de  Tue Jun 16 13:26:35 2015
From: A.Grahn at hzdr.de (Alexander Grahn)
Date: Tue, 16 Jun 2015 13:26:35 +0200
Subject: [luatex] TL15: luatex and \pdftexversion
Message-ID: <20150616112635.GE31825@hzdr.de>

Why is this version number regression from 240 to 80 in TeXLive-2015:

TeXLive-2014:
=============

$ luatex
This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971) 
 restricted \write18 enabled.
**\message{\the\pdftexversion}
200

TeXLive-2015:
=============

$ luatex
This is LuaTeX, Version beta-0.80.0 (TeX Live 2015) (rev 5238) 
 restricted \write18 enabled.
**\message{\the\pdftexversion}
80

Alexander

From luigi.scarso at gmail.com  Tue Jun 16 14:28:56 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 16 Jun 2015 14:28:56 +0200
Subject: [luatex] [tex-live] TL15: luatex and \pdftexversion
In-Reply-To: <CAEW6iOhonp2Szy-95X5Bh4-7-r6wiuFktLWkq+wCChHA3qpfwg@mail.gmail.com>
References: <20150616112635.GE31825@hzdr.de>
 <CAEW6iOhonp2Szy-95X5Bh4-7-r6wiuFktLWkq+wCChHA3qpfwg@mail.gmail.com>
Message-ID: <CAG5iGsCW2reJ6oKvQJ2Eb3KAyz=xv=yMmbxhp9qHusf9N6UBhg@mail.gmail.com>

On Tue, Jun 16, 2015 at 2:09 PM, David Carlisle <d.p.carlisle at gmail.com>
wrote:

> On 16 June 2015 at 12:26, Alexander Grahn <A.Grahn at hzdr.de> wrote:
> > Why is this version number regression from 240 to 80 in TeXLive-2015:
> >
> > TeXLive-2014:
> > =============
> >
> > $ luatex
> > This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
> >  restricted \write18 enabled.
> > **\message{\the\pdftexversion}
> > 200
> >
> > TeXLive-2015:
> > =============
> >
> > $ luatex
> > This is LuaTeX, Version beta-0.80.0 (TeX Live 2015) (rev 5238)
> >  restricted \write18 enabled.
> > **\message{\the\pdftexversion}
> > 80
> >
> > Alexander
>
> the manual still implies it is 200

fixed in trunk, thank you for the report.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150616/7384f95e/attachment.html>

From pragma at wxs.nl  Tue Jun 16 15:22:01 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 16 Jun 2015 15:22:01 +0200
Subject: [luatex] TL15: luatex and \pdftexversion
In-Reply-To: <20150616112635.GE31825@hzdr.de>
References: <20150616112635.GE31825@hzdr.de>
Message-ID: <558022F9.3010807@wxs.nl>

On 6/16/2015 1:26 PM, Alexander Grahn wrote:
> Why is this version number regression from 240 to 80 in TeXLive-2015:
>
> TeXLive-2014:
> =============
>
> $ luatex
> This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
>   restricted \write18 enabled.
> **\message{\the\pdftexversion}
> 200
>
> TeXLive-2015:
> =============
>
> $ luatex
> This is LuaTeX, Version beta-0.80.0 (TeX Live 2015) (rev 5238)
>   restricted \write18 enabled.
> **\message{\the\pdftexversion}
> 80

luatex is not pdftex and is not kept in sync so we now have only one 
version number (in a next version pdftexversion will go away)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Tue Jun 16 22:26:52 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Tue, 16 Jun 2015 21:26:52 +0100
Subject: [luatex] accessing attribute registers (and other register types)
Message-ID: <CAEW6iOiMTuaSjd3LXPLimr_-0TMXAVJfzxbmWUs1tiHDitw51g@mail.gmail.com>

If you have an attributedef token defined via

\attributedef\qqq=301
\qqq=53

(or some allocation macro that does that internally)

then you can access the value (53 here) from lua as tex.attribute.qqq


but to use in node callbacks with such as

 node.has_attribute(n, attr_number)

then you need access to the underlying register number (301).

Does luatex have a documented way to get from the csname "qqq"
to the register number?

The latex luatexbase package achieves this by wrapping the \attributedef
in a call to \directlua that stores the "qqq"->53 association in its
own lua table.

It seemed to me that luatex must have this information and it ought to be
possible to simplify this just to do a bare \attributedef.

The following code appears to work producing

qqq is attribute: 301 value: 53

hhhz is attribute: 444 value: 99

zzz is count: 200 value: 2

that is the register number and value in each case, but poking into
tex.hashtokens seems like it probably is not the correct thing to do
and I'm not sure I'm supposed to assume that all the countdef tokens
get consecutive identifying integers?



\attributedef\attrzero=0

\countdef\zzz=200
\zzz=2
\def\zz{}
\attributedef\qqq=301
\qqq=53
\def\hmm{lll}

\attributedef\hhhz=444
\hhhz=99


\directlua{
texio.write_nl("")

v=tex.hashtokens()["qqq"][2] - tex.hashtokens()["attrzero"][2]
texio.write_nl("qqq is attribute: "  .. v .. " value: " .. tex.attribute["qqq"])


v=tex.hashtokens()["hhhz"][2] -tex.hashtokens()["attrzero"][2]
texio.write_nl("hhhz is attribute: "  .. v .. " value: " ..
tex.attribute["hhhz"])


v=tex.hashtokens()["zzz"][2] -tex.hashtokens()["pageno"][2]
texio.write_nl("zzz is count: "  .. v.. " value: " .. tex.count["zzz"])


texio.write_nl("")}

\bye

From joseph.wright at morningstar2.co.uk  Wed Jun 17 09:59:48 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 17 Jun 2015 08:59:48 +0100
Subject: [luatex] Catcode table efficiency
Message-ID: <558128F4.1060901@morningstar2.co.uk>

Hello all,

In Heiko Oberdiek's luatex.dtx there is a note about catcode table
allocation

    % \item Large catcode table numbers should be avoided because of
    %   performance breakdown.

and this leads to that package implementing an allocation system whereby
odd and even numbered tables are used for distinct purposes. Heiko's
code is a few years old and I wonder if that comment still holds. It
would be clearer to be able to split up tables by working from opposite
ends of the available range, but that only makes sense if the top of the
range is usable without a significant penalty.

What's the current position?
--
Joseph Wright

From dirk.laurie at gmail.com  Wed Jun 17 10:41:44 2015
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Wed, 17 Jun 2015 10:41:44 +0200
Subject: [luatex] Catcode table efficiency
In-Reply-To: <558128F4.1060901@morningstar2.co.uk>
References: <558128F4.1060901@morningstar2.co.uk>
Message-ID: <CABcj=t=eG-ryNb7CWEmyMz1bSE_XgtZgyh3Xw3hMM9MsR06OpA@mail.gmail.com>

2015-06-17 9:59 GMT+02:00 Joseph Wright <joseph.wright at morningstar2.co.uk>:

> In Heiko Oberdiek's luatex.dtx there is a note about catcode table
> allocation
>
>     % \item Large catcode table numbers should be avoided because of
>     %   performance breakdown.
>
> and this leads to that package implementing an allocation system whereby
> odd and even numbered tables are used for distinct purposes. Heiko's
> code is a few years old and I wonder if that comment still holds. It
> would be clearer to be able to split up tables by working from opposite
> ends of the available range, but that only makes sense if the top of the
> range is usable without a significant penalty.
>
> What's the current position?

If the question is purely related to Lua implementation, then there
has been no change. Specifically, Lua tables are extra efficient for
contiguous entries numbered from 1 upwards, and substantially
less so for high-numbered entries if there are many unused entries
in between.

From pragma at wxs.nl  Wed Jun 17 16:07:36 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 Jun 2015 16:07:36 +0200
Subject: [luatex] accessing attribute registers (and other register
	types)
In-Reply-To: <CAEW6iOiMTuaSjd3LXPLimr_-0TMXAVJfzxbmWUs1tiHDitw51g@mail.gmail.com>
References: <CAEW6iOiMTuaSjd3LXPLimr_-0TMXAVJfzxbmWUs1tiHDitw51g@mail.gmail.com>
Message-ID: <55817F28.9030309@wxs.nl>

On 6/16/2015 10:26 PM, David Carlisle wrote:
> If you have an attributedef token defined via
>
> \attributedef\qqq=301
> \qqq=53
>
> (or some allocation macro that does that internally)
>
> then you can access the value (53 here) from lua as tex.attribute.qqq
>
>
> but to use in node callbacks with such as
>
>   node.has_attribute(n, attr_number)
>
> then you need access to the underlying register number (301).
>
> Does luatex have a documented way to get from the csname "qqq"
> to the register number?
>
> The latex luatexbase package achieves this by wrapping the \attributedef
> in a call to \directlua that stores the "qqq"->53 association in its
> own lua table.
>
> It seemed to me that luatex must have this information and it ought to be
> possible to simplify this just to do a bare \attributedef.
>
> The following code appears to work producing
>
> qqq is attribute: 301 value: 53
>
> hhhz is attribute: 444 value: 99
>
> zzz is count: 200 value: 2
>
> that is the register number and value in each case, but poking into
> tex.hashtokens seems like it probably is not the correct thing to do
> and I'm not sure I'm supposed to assume that all the countdef tokens
> get consecutive identifying integers?
>
>
>
> \attributedef\attrzero=0
>
> \countdef\zzz=200
> \zzz=2
> \def\zz{}
> \attributedef\qqq=301
> \qqq=53
> \def\hmm{lll}
>
> \attributedef\hhhz=444
> \hhhz=99
>
>
> \directlua{
> texio.write_nl("")
>
> v=tex.hashtokens()["qqq"][2] - tex.hashtokens()["attrzero"][2]
> texio.write_nl("qqq is attribute: "  .. v .. " value: " .. tex.attribute["qqq"])
>
>
> v=tex.hashtokens()["hhhz"][2] -tex.hashtokens()["attrzero"][2]
> texio.write_nl("hhhz is attribute: "  .. v .. " value: " ..
> tex.attribute["hhhz"])
>
>
> v=tex.hashtokens()["zzz"][2] -tex.hashtokens()["pageno"][2]
> texio.write_nl("zzz is count: "  .. v.. " value: " .. tex.count["zzz"])
>
>
> texio.write_nl("")}
>
> \bye

\attributedef\zeroattribute=0
\attributedef\bar=999

\directlua {
     function attributenumber(name)
         local n = newtoken.create(name).mode - 
newtoken.create("zeroattribute").mode
         if n >= 0 then
             return n
         else
             return false
         end
     end
}

\directlua{print(attributenumber("crap"))}
\directlua{print(attributenumber("bar"))}
\directlua{print(attributenumber("10>color"))}
\directlua{print(attributenumber("10>colormodel"))}

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Wed Jun 17 16:09:51 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 17 Jun 2015 16:09:51 +0200
Subject: [luatex] Catcode table efficiency
In-Reply-To: <558128F4.1060901@morningstar2.co.uk>
References: <558128F4.1060901@morningstar2.co.uk>
Message-ID: <55817FAF.5080401@wxs.nl>

On 6/17/2015 9:59 AM, Joseph Wright wrote:
> Hello all,
>
> In Heiko Oberdiek's luatex.dtx there is a note about catcode table
> allocation
>
>      % \item Large catcode table numbers should be avoided because of
>      %   performance breakdown.
>
> and this leads to that package implementing an allocation system whereby
> odd and even numbered tables are used for distinct purposes. Heiko's
> code is a few years old and I wonder if that comment still holds. It
> would be clearer to be able to split up tables by working from opposite
> ends of the available range, but that only makes sense if the top of the
> range is usable without a significant penalty.
>
> What's the current position?

i don't know that code but as a user of catcode tables i wouldn't worry 
too much about performance as it's quite okay (and i have no clue what 
the comment is about anyway)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From joseph.wright at morningstar2.co.uk  Wed Jun 17 16:13:17 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 17 Jun 2015 15:13:17 +0100
Subject: [luatex] Catcode table efficiency
In-Reply-To: <55817FAF.5080401@wxs.nl>
References: <558128F4.1060901@morningstar2.co.uk> <55817FAF.5080401@wxs.nl>
Message-ID: <5581807D.3050005@morningstar2.co.uk>

On 17/06/2015 15:09, Hans Hagen wrote:
> On 6/17/2015 9:59 AM, Joseph Wright wrote:
>> Hello all,
>>
>> In Heiko Oberdiek's luatex.dtx there is a note about catcode table
>> allocation
>>
>>      % \item Large catcode table numbers should be avoided because of
>>      %   performance breakdown.
>>
>> and this leads to that package implementing an allocation system whereby
>> odd and even numbered tables are used for distinct purposes. Heiko's
>> code is a few years old and I wonder if that comment still holds. It
>> would be clearer to be able to split up tables by working from opposite
>> ends of the available range, but that only makes sense if the top of the
>> range is usable without a significant penalty.
>>
>> What's the current position?
> 
> i don't know that code but as a user of catcode tables i wouldn't worry
> too much about performance as it's quite okay (and i have no clue what
> the comment is about anyway)
> 
> Hans

Didn't really make sense to me either but I thought I should check.
We'll got with a slightly less complex approach then.
--
Joseph Wright


From d.p.carlisle at gmail.com  Wed Jun 17 16:15:26 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 17 Jun 2015 15:15:26 +0100
Subject: [luatex] accessing attribute registers (and other register
	types)
In-Reply-To: <55817F28.9030309@wxs.nl>
References: <CAEW6iOiMTuaSjd3LXPLimr_-0TMXAVJfzxbmWUs1tiHDitw51g@mail.gmail.com>
 <55817F28.9030309@wxs.nl>
Message-ID: <CAEW6iOjXyP4Cx-0zyNTt4zCrZBhsQvh9Y=6+5i47NVA=56YACA@mail.gmail.com>

On 17 June 2015 at 15:07, Hans Hagen <pragma at wxs.nl> wrote:


>
> \attributedef\zeroattribute=0
> \attributedef\bar=999
>
> \directlua {
>     function attributenumber(name)
>         local n = newtoken.create(name).mode -
> newtoken.create("zeroattribute").mode
>         if n >= 0 then
>             return n
>         else
>             return false
>         end
>     end
> }
>
> \directlua{print(attributenumber("crap"))}
> \directlua{print(attributenumber("bar"))}
> \directlua{print(attributenumber("10>color"))}
> \directlua{print(attributenumber("10>colormodel"))}
>
> Hans
>


Hans, ah thanks much better, I almost got there, was experimenting with
newtoken.create(name)

but missed  .mode  somehow.
(Possibly the fact that It doesn't appear to be in the manual:-)

David

From p.stephani2 at gmail.com  Sun Jun 21 21:31:07 2015
From: p.stephani2 at gmail.com (Philipp Stephani)
Date: Sun, 21 Jun 2015 19:31:07 +0000
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <556D7486.1070509@telecom-bretagne.eu>
References: <A601C451ECF24EB89D133ACF1B4D2FAE@CJ3001517A>
 <556D7486.1070509@telecom-bretagne.eu>
Message-ID: <CAArVCkT5Yc2M5GbGdG6hAuLteboRwkf=V+=OAcasCsGKZT=e=Q@mail.gmail.com>

?lie Roux <elie.roux at telecom-bretagne.eu> schrieb am Di., 2. Juni 2015 um
11:17 Uhr:

> Le 02/06/2015 11:09, Akira Kakuto a ?crit :
> > Hi,
> >
> >>> A few years ago I implemented a library to retrieve the list of fonts
> on
> >>> Windows, OS X, and Linux: https://www.ctan.org/pkg/lualatex-platform
> >>> I don't think it's widely used, but when I wrote it it worked reliably
> >>> an all three OSes (http://tracker.luatex.org/view.php?id=555), and
> could
> >>> be used as a starting point.
> >
> >> Thanks a lot for the pointer!
> >
> > I have uploaded a compiled package for TeX Live 2015-W32:
>
> Thanks a lot! I'll send a mail to MikTeX for this too. It might also be
> useful for Linux and OSX, is it already compiled for these platforms? If
> not, who should I report it to?
>
>
IIRC I added it to tlcontrib some time ago, but didn't follow up because on
Linux the current system (which already uses fontconfig) should be good
enough, and on OS X the library couldn't be used because of the
aforementioned bug.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150621/a5cc456a/attachment.html>

From p.stephani2 at gmail.com  Sun Jun 21 21:32:19 2015
From: p.stephani2 at gmail.com (Philipp Stephani)
Date: Sun, 21 Jun 2015 19:32:19 +0000
Subject: [luatex] Reading registry to find Windows fonts
In-Reply-To: <CAArVCkT5Yc2M5GbGdG6hAuLteboRwkf=V+=OAcasCsGKZT=e=Q@mail.gmail.com>
References: <A601C451ECF24EB89D133ACF1B4D2FAE@CJ3001517A>
 <556D7486.1070509@telecom-bretagne.eu>
 <CAArVCkT5Yc2M5GbGdG6hAuLteboRwkf=V+=OAcasCsGKZT=e=Q@mail.gmail.com>
Message-ID: <CAArVCkT5ugSm_enKVKfXMFQAnMOv5ZMm3McBrFrS=M-TKfwgGg@mail.gmail.com>

Here's an old discussion:
http://tex-live.tug.narkive.com/UQJpHihV/lualatex-platform-extension-module-in-tex-live

Philipp Stephani <p.stephani2 at gmail.com> schrieb am So., 21. Juni 2015 um
21:31 Uhr:

> ?lie Roux <elie.roux at telecom-bretagne.eu> schrieb am Di., 2. Juni 2015 um
> 11:17 Uhr:
>
>> Le 02/06/2015 11:09, Akira Kakuto a ?crit :
>> > Hi,
>> >
>> >>> A few years ago I implemented a library to retrieve the list of fonts
>> on
>> >>> Windows, OS X, and Linux: https://www.ctan.org/pkg/lualatex-platform
>> >>> I don't think it's widely used, but when I wrote it it worked reliably
>> >>> an all three OSes (http://tracker.luatex.org/view.php?id=555), and
>> could
>> >>> be used as a starting point.
>> >
>> >> Thanks a lot for the pointer!
>> >
>> > I have uploaded a compiled package for TeX Live 2015-W32:
>>
>> Thanks a lot! I'll send a mail to MikTeX for this too. It might also be
>> useful for Linux and OSX, is it already compiled for these platforms? If
>> not, who should I report it to?
>>
>>
> IIRC I added it to tlcontrib some time ago, but didn't follow up because
> on Linux the current system (which already uses fontconfig) should be good
> enough, and on OS X the library couldn't be used because of the
> aforementioned bug.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150621/bbd10926/attachment.html>

From joseph.wright at morningstar2.co.uk  Mon Jun 22 08:44:35 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 22 Jun 2015 07:44:35 +0100
Subject: [luatex] Logging \discretionary in words containing non-letters
Message-ID: <5587AED3.4090507@morningstar2.co.uk>

Hello all,

A little while ago I raised an issue about \discretionary in the log and
non-letters in 'words' (
http://tug.org/mailman/htdig/luatex/2015-April/005169.html). With LuaTeX
0.80 something like

    \tracingoutput=1 %
    \showboxdepth=\maxdimen
    \showboxbreadth=\maxdimen
    1-world
    \bye

gives the same log output as pdfTeX, i.e.

    ...\tenrm 1
    ...\tenrm -
    ...\discretionary
    ...\tenrm w
    ...\kern-0.27779
    ...\tenrm o
    ...\tenrm r
    ...\tenrm l
    ...\tenrm d

However, I now notice that things get a bit weird if there is more than
one "-" in a 'word'

    \tracingoutput=1 %
    \showboxdepth\maxdimen
    \showboxbreadth\maxdimen
    1-b-c 1-b-c 1a-b-c a-b-1-d-e
    \bye

gives

    ...\tenrm 1
    ...\tenrm -
    ...\discretionary
    ...\tenrm b
    ...\tenrm -
    ...\tenrm c
    ...\glue 3.33333 plus 1.66666 minus 1.11111
    ...\tenrm 1
    ...\tenrm -
    ...\discretionary
    ...\tenrm b
    ...\tenrm -
    ...\tenrm c
    ...\glue 3.33333 plus 1.66666 minus 1.11111
    ...\tenrm 1
    ...\tenrm a
    ...\tenrm -
    ...\discretionary
    ...\tenrm b
    ...\tenrm -
    ...\discretionary
    ...\tenrm c
    ...\glue 3.33333 plus 1.66666 minus 1.11111
    ...\tenrm a
    ...\tenrm -
    ...\tenrm b
    ...\tenrm -
    ...\tenrm 1
    ...\tenrm -
    ...\discretionary
    ...\tenrm d
    ...\tenrm -
    ...\tenrm e

with LuaTeX 0.80.0 whereas pdfTeX marks every "-" as a \discretionary.
Presumably this is not a deliberate change?
--
Joseph Wright

From joseph.wright at morningstar2.co.uk  Mon Jun 22 09:24:59 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 22 Jun 2015 08:24:59 +0100
Subject: [luatex] Undocumented callbacks
Message-ID: <5587B84B.2080404@morningstar2.co.uk>

Hello all,

Running

    \directlua{
      for i,_ in pairs(callback.list()) do
        texio.write_nl("- " .. i)
      end
    }
    \bye

with LuaTeX 0.80.0 (TL'15) lists 58 callbacks. Comparing the list with
those in the manual, there seem to be four undocumented ones:

 - char_exists
 - find_cidmap_file
 - pdf_stream_filter_callback
 - read_cidmap_file

What is the status of these callbacks?
--
Joseph Wright

From luigi.scarso at gmail.com  Mon Jun 22 09:36:44 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 22 Jun 2015 09:36:44 +0200
Subject: [luatex] Undocumented callbacks
In-Reply-To: <5587B84B.2080404@morningstar2.co.uk>
References: <5587B84B.2080404@morningstar2.co.uk>
Message-ID: <CAG5iGsBU3-4HZ9g-sgXzyvymLZv8rQLnxW6txQhEvva8u2F=MA@mail.gmail.com>

On Mon, Jun 22, 2015 at 9:24 AM, Joseph Wright <
joseph.wright at morningstar2.co.uk> wrote:

> Hello all,
>
> Running
>
>     \directlua{
>       for i,_ in pairs(callback.list()) do
>         texio.write_nl("- " .. i)
>       end
>     }
>     \bye
>
> with LuaTeX 0.80.0 (TL'15) lists 58 callbacks. Comparing the list with
> those in the manual, there seem to be four undocumented ones:
>
>  - char_exists
>  - find_cidmap_file
>  - pdf_stream_filter_callback
>  - read_cidmap_file
>
> What is the status of these callbacks?
> --
> Joseph Wright
>

98% they may go or stay, so be careful when  you use it;
02% they are part of the api but we have forgotten to document them

So...thank you for the report  :-)

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150622/c8cc105d/attachment.html>

From pragma at wxs.nl  Mon Jun 22 16:45:43 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 22 Jun 2015 16:45:43 +0200
Subject: [luatex] Undocumented callbacks
In-Reply-To: <5587B84B.2080404@morningstar2.co.uk>
References: <5587B84B.2080404@morningstar2.co.uk>
Message-ID: <55881F97.10106@wxs.nl>

On 6/22/2015 9:24 AM, Joseph Wright wrote:
> Hello all,
>
> Running
>
>      \directlua{
>        for i,_ in pairs(callback.list()) do
>          texio.write_nl("- " .. i)
>        end
>      }
>      \bye
>
> with LuaTeX 0.80.0 (TL'15) lists 58 callbacks. Comparing the list with
> those in the manual, there seem to be four undocumented ones:

- char_exists

obsolete (never was active)

- pdf_stream_filter_callback

this is something old experimental that will go

- find_cidmap_file
- read_cidmap_file

these are not used by the engine but are there for completeness as a lua 
font loader might need them

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at gmx.de  Tue Jun 23 03:25:59 2015
From: reinhard.kotucha at gmx.de (Reinhard Kotucha)
Date: Tue, 23 Jun 2015 03:25:59 +0200
Subject: [luatex] CIDSet in PDF/A documents
Message-ID: <21896.46503.822925.752731@zaphod.ms25.net>

Hi,
at

  http://tracker.luatex.org/view.php?id=434

Hans wrote

 > pdf/a demands a cidset but we will forget about this till we find a
 > proper example
 > 
 > there is still some reported problem with some stream objects not
 > properly being formatted cf. pdf/a but it is not clear what is
 > going on there

This message is now five years old.  Any new perceptions?

I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
complains about a bad CIDSet.

I created a small PDF file which only contains the string "abc",
extracted the TTF from the PDF file, and disassembled it with TTX.
Then I assembled the CIDSet manually according to the instructions
given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
result as LuaTeX, hence it's unclear to me what's going wrong.

The PDFtron

  https://www.pdftron.com/

validator sais

  <Error Code="e_PDFA356" Message="CIDSet in subset font is incomplete" Refs="95, 101"/>

I tend to believe that the validator is wrong.  On the other hand
PDFtron offers software which creates PDF/A files and I can't imagine
that their validator complains about their own products.

Did anybody investigate?  The nasty thing is that PDF/A is for long
term preservation and any file we create today has to comply with the
standard unconditionally.  And for us TeX users, the fact that there
are zillions of invalid PDF/A files around just because old versions
of the Acrobat preflight tool ignored most errors, is not an excuse.
We should do better.

>From the results of my own investigations I deduce that LuaTeX
provides a standard compliant CIDSet.  Maybe different people
interpret the standard in a different way.  But it would be nice to
know whether somebody else investigated this issue already.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From luigi.scarso at gmail.com  Tue Jun 23 06:07:13 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 23 Jun 2015 06:07:13 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <21896.46503.822925.752731@zaphod.ms25.net>
References: <21896.46503.822925.752731@zaphod.ms25.net>
Message-ID: <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>

On Tue, Jun 23, 2015 at 3:25 AM, Reinhard Kotucha <reinhard.kotucha at gmx.de>
wrote:

> Hi,
> at
>
>   http://tracker.luatex.org/view.php?id=434
>
> Hans wrote
>
>  > pdf/a demands a cidset but we will forget about this till we find a
>  > proper example
>  >
>  > there is still some reported problem with some stream objects not
>  > properly being formatted cf. pdf/a but it is not clear what is
>  > going on there
>
> This message is now five years old.  Any new perceptions?
>
> I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
> complains about a bad CIDSet.
>
> I created a small PDF file which only contains the string "abc",
> extracted the TTF from the PDF file, and disassembled it with TTX.
> Then I assembled the CIDSet manually according to the instructions
> given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
> result as LuaTeX, hence it's unclear to me what's going wrong.
>
> The PDFtron
>
>   https://www.pdftron.com/
>
> validator sais
>
>   <Error Code="e_PDFA356" Message="CIDSet in subset font is incomplete"
> Refs="95, 101"/>
>
> I tend to believe that the validator is wrong.  On the other hand
> PDFtron offers software which creates PDF/A files and I can't imagine
> that their validator complains about their own products.
>
> Did anybody investigate?  The nasty thing is that PDF/A is for long
> term preservation and any file we create today has to comply with the
> standard unconditionally.  And for us TeX users, the fact that there
> are zillions of invalid PDF/A files around just because old versions
> of the Acrobat preflight tool ignored most errors, is not an excuse.
> We should do better.
>
> >From the results of my own investigations I deduce that LuaTeX
> provides a standard compliant CIDSet.  Maybe different people
> interpret the standard in a different way.  But it would be nice to
> know whether somebody else investigated this issue already.
>
> Regards,
>   Reinhard
>
>
which pdf/a ?

https://pdfbox.apache.org/

says
"""
Preflight
Validate PDF files against the PDF/A-1b standard.
"""

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150623/a596bac7/attachment-0001.html>

From pragma at wxs.nl  Tue Jun 23 11:30:45 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 23 Jun 2015 11:30:45 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <21896.46503.822925.752731@zaphod.ms25.net>
References: <21896.46503.822925.752731@zaphod.ms25.net>
Message-ID: <55892745.8040403@wxs.nl>

On 6/23/2015 3:25 AM, Reinhard Kotucha wrote:
> Hi,
> at
>
>    http://tracker.luatex.org/view.php?id=434
>
> Hans wrote
>
>   > pdf/a demands a cidset but we will forget about this till we find a
>   > proper example
>   >
>   > there is still some reported problem with some stream objects not
>   > properly being formatted cf. pdf/a but it is not clear what is
>   > going on there
>
> This message is now five years old.  Any new perceptions?
>
> I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
> complains about a bad CIDSet.
>
> I created a small PDF file which only contains the string "abc",
> extracted the TTF from the PDF file, and disassembled it with TTX.
> Then I assembled the CIDSet manually according to the instructions
> given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
> result as LuaTeX, hence it's unclear to me what's going wrong.
>
> The PDFtron
>
>    https://www.pdftron.com/
>
> validator sais
>
>    <Error Code="e_PDFA356" Message="CIDSet in subset font is incomplete" Refs="95, 101"/>
>
> I tend to believe that the validator is wrong.  On the other hand
> PDFtron offers software which creates PDF/A files and I can't imagine
> that their validator complains about their own products.

what does acrobat say

(about validators being ok: recently we had an issue with a validator 
used by a publisher that couldn't handle xforms properly and in the 
process of copying/flattening messed with the lines in a way that made 
them all disappear for successive instances)

> Did anybody investigate?  The nasty thing is that PDF/A is for long
> term preservation and any file we create today has to comply with the
> standard unconditionally.  And for us TeX users, the fact that there
> are zillions of invalid PDF/A files around just because old versions
> of the Acrobat preflight tool ignored most errors, is not an excuse.
> We should do better.

or there should be a way to repair them (what else to do with the 
zillion files .. regenerate them?)

>>From the results of my own investigations I deduce that LuaTeX
> provides a standard compliant CIDSet.  Maybe different people
> interpret the standard in a different way.  But it would be nice to
> know whether somebody else investigated this issue already.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From listas at tex-tipografia.com  Tue Jun 23 16:20:38 2015
From: listas at tex-tipografia.com (Javier Bezos)
Date: Tue, 23 Jun 2015 16:20:38 +0200
Subject: [luatex] lang.patterns
Message-ID: <55896B36.8050601@tex-tipografia.com>

First, let me point out I'm still with 0.79 (TL14), because I'm working
on a book and I won't update until finished (in a couple of months).

According to the docs, lang.patterns "Adds additional patterns for this 
language object, or returns the current set."

And indeed it does... but they are not recognized. However, the
following works:

   pats = lang.patterns(lang.new(0))
   lang.clear_patterns(lang.new(0))
   lang.patterns(lang.new(0), pats .. ' 9e8t9e8t9')

Is this the intended behaviour? I'm working on a \babelpatterns for
babel with luatex (which complements the current \babelpatterns),
and I'd like to know if it's a bug (and if it's, if it has been
fixed).

Javier

From listas at tex-tipografia.com  Tue Jun 23 17:15:43 2015
From: listas at tex-tipografia.com (Javier Bezos)
Date: Tue, 23 Jun 2015 17:15:43 +0200
Subject: [luatex] lang.patterns
In-Reply-To: <55896B36.8050601@tex-tipografia.com>
References: <55896B36.8050601@tex-tipografia.com>
Message-ID: <5589781F.1090005@tex-tipografia.com>


> Is this the intended behaviour? I'm working on a \babelpatterns for
> babel with luatex (which complements the current \babelpatterns),

Oops, I meant \babelhyphenation.

Javier

From reinhard.kotucha at gmx.de  Wed Jun 24 00:46:53 2015
From: reinhard.kotucha at gmx.de (Reinhard Kotucha)
Date: Wed, 24 Jun 2015 00:46:53 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>
References: <21896.46503.822925.752731@zaphod.ms25.net>
 <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>
Message-ID: <21897.57821.983829.763938@zaphod.ms25.net>

On 2015-06-23 at 06:07:13 +0200, luigi scarso wrote:

 > > Hi,
 > > at
 > >
 > >   http://tracker.luatex.org/view.php?id=434
 > >
 > > Hans wrote
 > >
 > >  > pdf/a demands a cidset but we will forget about this till we find a
 > >  > proper example
 > >  >
 > >  > there is still some reported problem with some stream objects not
 > >  > properly being formatted cf. pdf/a but it is not clear what is
 > >  > going on there
 > >
 > > This message is now five years old.  Any new perceptions?
 > >
 > > I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
 > > complains about a bad CIDSet.
 > >
 > > I created a small PDF file which only contains the string "abc",
 > > extracted the TTF from the PDF file, and disassembled it with TTX.
 > > Then I assembled the CIDSet manually according to the instructions
 > > given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
 > > result as LuaTeX, hence it's unclear to me what's going wrong.
 > >
 > > The PDFtron
 > >
 > >   https://www.pdftron.com/
 > >
 > > validator sais
 > >
 > >   <Error Code="e_PDFA356" Message="CIDSet in subset font is incomplete"
 > > Refs="95, 101"/>
 > >
 > > I tend to believe that the validator is wrong.  On the other hand
 > > PDFtron offers software which creates PDF/A files and I can't imagine
 > > that their validator complains about their own products.
 > >
 > > Did anybody investigate?  The nasty thing is that PDF/A is for long
 > > term preservation and any file we create today has to comply with the
 > > standard unconditionally.  And for us TeX users, the fact that there
 > > are zillions of invalid PDF/A files around just because old versions
 > > of the Acrobat preflight tool ignored most errors, is not an excuse.
 > > We should do better.
 > >
 > > >From the results of my own investigations I deduce that LuaTeX
 > > provides a standard compliant CIDSet.  Maybe different people
 > > interpret the standard in a different way.  But it would be nice to
 > > know whether somebody else investigated this issue already.
 > >
 > > Regards,
 > >   Reinhard
 > >
 > >
 > which pdf/a ?

PDF/A-1b

 > https://pdfbox.apache.org/
 > 
 > says
 > """
 > Preflight
 > Validate PDF files against the PDF/A-1b standard.
 > """

PDFbox was one of the validators I used.  It didn't complain.

There is probably a newer release.  Somebody said on a mailing list
that he submitted a patch which adds object numbers to error
messages.  Sounds very reasonable and useful.

BTW, I validated both validators before.

  http://ms25.no-ip.info/pdfa/validate-pdftron.html
  http://ms25.no-ip.info/pdfa/validate-pdfbox.html

I also used the online validators

  http://www.validatepdfa.com/online.htm

and

  http://www.pdf-tools.com/pdf/validate-pdfa-online.aspx

Finally I asked Ross Moore to check my file with Acrobat Pro v.11.

Only PDFtron complained about an uncomplete CIDSet.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From reinhard.kotucha at gmx.de  Wed Jun 24 01:25:52 2015
From: reinhard.kotucha at gmx.de (Reinhard Kotucha)
Date: Wed, 24 Jun 2015 01:25:52 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <55892745.8040403@wxs.nl>
References: <21896.46503.822925.752731@zaphod.ms25.net>
 <55892745.8040403@wxs.nl>
Message-ID: <21897.60160.702312.196808@zaphod.ms25.net>

On 2015-06-23 at 11:30:45 +0200, Hans Hagen wrote:

 > On 6/23/2015 3:25 AM, Reinhard Kotucha wrote:
 > > Hi,
 > > at
 > >
 > >    http://tracker.luatex.org/view.php?id=434
 > >
 > > Hans wrote
 > >
 > >   > pdf/a demands a cidset but we will forget about this till we find a
 > >   > proper example
 > >   >
 > >   > there is still some reported problem with some stream objects not
 > >   > properly being formatted cf. pdf/a but it is not clear what is
 > >   > going on there
 > >
 > > This message is now five years old.  Any new perceptions?
 > >
 > > I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
 > > complains about a bad CIDSet.
 > >
 > > I created a small PDF file which only contains the string "abc",
 > > extracted the TTF from the PDF file, and disassembled it with TTX.
 > > Then I assembled the CIDSet manually according to the instructions
 > > given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
 > > result as LuaTeX, hence it's unclear to me what's going wrong.
 > >
 > > The PDFtron
 > >
 > >    https://www.pdftron.com/
 > >
 > > validator sais
 > >
 > >    <Error Code="e_PDFA356" Message="CIDSet in subset font is incomplete" Refs="95, 101"/>
 > >
 > > I tend to believe that the validator is wrong.  On the other hand
 > > PDFtron offers software which creates PDF/A files and I can't
 > > imagine that their validator complains about their own products.
 > 
 > what does acrobat say

Acrobat Pro v.11 doesn't complain.

 > (about validators being ok: recently we had an issue with a
 > validator used by a publisher that couldn't handle xforms properly
 > and in the process of copying/flattening messed with the lines in a
 > way that made them all disappear for successive instances)

I suppose that you wasted a lot of time.  It's good in such cases if
you can convince the publisher that his tool is faulty, but this can
be time-consuming too.

 > > Did anybody investigate?  The nasty thing is that PDF/A is for long
 > > term preservation and any file we create today has to comply with the
 > > standard unconditionally.  And for us TeX users, the fact that there
 > > are zillions of invalid PDF/A files around just because old versions
 > > of the Acrobat preflight tool ignored most errors, is not an excuse.
 > > We should do better.
 > 
 > or there should be a way to repair them (what else to do with the 
 > zillion files .. regenerate them?)

Repairing files is an acceptable solution if you created them yourself
but it's nearly impossible if you gave the workflow to your customers.
And the need to repair files later doesn't enhance the reputation of
the program which created them.  I'm not worried about all the other
programs but I'm very careful when TeX is involved.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From luigi.scarso at gmail.com  Wed Jun 24 08:57:35 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 24 Jun 2015 08:57:35 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <21897.57821.983829.763938@zaphod.ms25.net>
References: <21896.46503.822925.752731@zaphod.ms25.net>
 <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>
 <21897.57821.983829.763938@zaphod.ms25.net>
Message-ID: <CAG5iGsCkdo8v1SUEEcMWOVjmyjeKbK9cCYqo-u1d9TNdS8ZWOA@mail.gmail.com>

On Wed, Jun 24, 2015 at 12:46 AM, Reinhard Kotucha <reinhard.kotucha at gmx.de>
wrote:

> On 2015-06-23 at 06:07:13 +0200, luigi scarso wrote:
>
>  > > Hi,
>  > > at
>  > >
>  > >   http://tracker.luatex.org/view.php?id=434
>  > >
>  > > Hans wrote
>  > >
>  > >  > pdf/a demands a cidset but we will forget about this till we find a
>  > >  > proper example
>  > >  >
>  > >  > there is still some reported problem with some stream objects not
>  > >  > properly being formatted cf. pdf/a but it is not clear what is
>  > >  > going on there
>  > >
>  > > This message is now five years old.  Any new perceptions?
>  > >
>  > > I'm using a TrueType font (CharisSIL) and one of five PDF/A validators
>  > > complains about a bad CIDSet.
>  > >
>  > > I created a small PDF file which only contains the string "abc",
>  > > extracted the TTF from the PDF file, and disassembled it with TTX.
>  > > Then I assembled the CIDSet manually according to the instructions
>  > > given in the PDF/A-1 specification (ISO 19005-1).  I've got the same
>  > > result as LuaTeX, hence it's unclear to me what's going wrong.
>  > >
>  > > The PDFtron
>  > >
>  > >   https://www.pdftron.com/
>  > >
>  > > validator sais
>  > >
>  > >   <Error Code="e_PDFA356" Message="CIDSet in subset font is
> incomplete"
>  > > Refs="95, 101"/>
>  > >
>  > > I tend to believe that the validator is wrong.  On the other hand
>  > > PDFtron offers software which creates PDF/A files and I can't imagine
>  > > that their validator complains about their own products.
>  > >
>  > > Did anybody investigate?  The nasty thing is that PDF/A is for long
>  > > term preservation and any file we create today has to comply with the
>  > > standard unconditionally.  And for us TeX users, the fact that there
>  > > are zillions of invalid PDF/A files around just because old versions
>  > > of the Acrobat preflight tool ignored most errors, is not an excuse.
>  > > We should do better.
>  > >
>  > > >From the results of my own investigations I deduce that LuaTeX
>  > > provides a standard compliant CIDSet.  Maybe different people
>  > > interpret the standard in a different way.  But it would be nice to
>  > > know whether somebody else investigated this issue already.
>  > >
>  > > Regards,
>  > >   Reinhard
>  > >
>  > >
>  > which pdf/a ?
>
> PDF/A-1b
>
>  > https://pdfbox.apache.org/
>  >
>  > says
>  > """
>  > Preflight
>  > Validate PDF files against the PDF/A-1b standard.
>  > """
>
> PDFbox was one of the validators I used.  It didn't complain.
>
> There is probably a newer release.  Somebody said on a mailing list
> that he submitted a patch which adds object numbers to error
> messages.  Sounds very reasonable and useful.
>
> BTW, I validated both validators before.
>
>   http://ms25.no-ip.info/pdfa/validate-pdftron.html
>   http://ms25.no-ip.info/pdfa/validate-pdfbox.html
>
> I also used the online validators
>
>   http://www.validatepdfa.com/online.htm
>
> and
>
>   http://www.pdf-tools.com/pdf/validate-pdfa-online.aspx
>
> Finally I asked Ross Moore to check my file with Acrobat Pro v.11.
>
> Only PDFtron complained about an uncomplete CIDSet.
>
> I think we can assume  Acrobat Pro v.11 as reference, so PDFtron
could be wrong.  You can contact the pdftron team and
show them the problem, with  the report from
Acrobat Pro v.11 --- it would be nice to hear their answer.


Validating a pdf/a-1b is a quite complicate task, so in the real life you
want
validate with the "best" validator --- and cross the fingers.
Acrobat Pro is one of the best validators around  so if it says that it's
ok, then you have strong reasons to say that it's ok.
In my opinion, pdf/a is a great thing, but the lack of free & solid
pdf/a-1a validators still limits its adoption.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150624/1fb9799a/attachment-0001.html>

From joseph.wright at morningstar2.co.uk  Wed Jun 24 10:34:58 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 24 Jun 2015 09:34:58 +0100
Subject: [luatex] Primitive oddities
Message-ID: <558A6BB2.6070706@morningstar2.co.uk>

Hello all,

I'm currently looking over the list of primitive names as given by e.g.
tex.extraprimitives("luatex"). I notice a couple of oddities.

Primitive \luatexbanner is down in the "pdftex" set. I assume this
should be in the "luatex" set? (The text I get is the same as for
\pdftexbanner but I imagine the latter will get dropped at some stage.)

The docs say that \primitive, \ifprimitive, \ifabsdim and \ifabsnum are
provided without the "pdf" part of the names that is present in for
these in pdfTeX. However, they are in both the "pdftex" and "luatex"
sets. Moreover, the 'new' versions still point to the older ones, for
example

    > \primitive=\pdfprimitive.
    l.1 \show\primitive

Is this deliberate?
--
Joseph Wright

From joseph.wright at morningstar2.co.uk  Wed Jun 24 14:05:54 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 24 Jun 2015 13:05:54 +0100
Subject: [luatex] Primitive oddities
In-Reply-To: <558A6BB2.6070706@morningstar2.co.uk>
References: <558A6BB2.6070706@morningstar2.co.uk>
Message-ID: <558A9D22.3020008@morningstar2.co.uk>

On 24/06/2015 09:34, Joseph Wright wrote:
> Hello all,
> 
> I'm currently looking over the list of primitive names as given by e.g.
> tex.extraprimitives("luatex"). I notice a couple of oddities.
> 
> Primitive \luatexbanner is down in the "pdftex" set. I assume this
> should be in the "luatex" set? (The text I get is the same as for
> \pdftexbanner but I imagine the latter will get dropped at some stage.)
> 
> The docs say that \primitive, \ifprimitive, \ifabsdim and \ifabsnum are
> provided without the "pdf" part of the names that is present in for
> these in pdfTeX. However, they are in both the "pdftex" and "luatex"
> sets. Moreover, the 'new' versions still point to the older ones, for
> example
> 
>     > \primitive=\pdfprimitive.
>     l.1 \show\primitive
> 
> Is this deliberate?
> --
> Joseph Wright
> 

Perhaps related, I see that the "pdftex" set contains \pdfreplacefont
but can't find that in the pdfTeX manual!
--
Joseph Wright

From pragma at wxs.nl  Wed Jun 24 18:17:00 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 24 Jun 2015 18:17:00 +0200
Subject: [luatex] Primitive oddities
In-Reply-To: <558A6BB2.6070706@morningstar2.co.uk>
References: <558A6BB2.6070706@morningstar2.co.uk>
Message-ID: <558AD7FC.3010002@wxs.nl>

On 6/24/2015 10:34 AM, Joseph Wright wrote:
> Hello all,
>
> I'm currently looking over the list of primitive names as given by e.g.
> tex.extraprimitives("luatex"). I notice a couple of oddities.
>
> Primitive \luatexbanner is down in the "pdftex" set. I assume this
> should be in the "luatex" set? (The text I get is the same as for
> \pdftexbanner but I imagine the latter will get dropped at some stage.)
>
> The docs say that \primitive, \ifprimitive, \ifabsdim and \ifabsnum are
> provided without the "pdf" part of the names that is present in for
> these in pdfTeX. However, they are in both the "pdftex" and "luatex"
> sets. Moreover, the 'new' versions still point to the older ones, for
> example
>
>      > \primitive=\pdfprimitive.
>      l.1 \show\primitive
>
> Is this deliberate?

more because we want to give time to adapt ... the \pdf* names that are 
unrelated to pdf will go away eventually

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at gmx.de  Thu Jun 25 04:35:29 2015
From: reinhard.kotucha at gmx.de (Reinhard Kotucha)
Date: Thu, 25 Jun 2015 04:35:29 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <CAG5iGsCkdo8v1SUEEcMWOVjmyjeKbK9cCYqo-u1d9TNdS8ZWOA@mail.gmail.com>
References: <21896.46503.822925.752731@zaphod.ms25.net>
 <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>
 <21897.57821.983829.763938@zaphod.ms25.net>
 <CAG5iGsCkdo8v1SUEEcMWOVjmyjeKbK9cCYqo-u1d9TNdS8ZWOA@mail.gmail.com>
Message-ID: <21899.26865.43285.516807@zaphod.ms25.net>

On 2015-06-24 at 08:57:35 +0200, luigi scarso wrote:

 > Validating a pdf/a-1b is a quite complicate task, so in the real
 > life you want validate with the "best" validator --- and cross the
 > fingers.  Acrobat Pro is one of the best validators around so if it
 > says that it's ok, then you have strong reasons to say that it's
 > ok.

I doubt that Acrobat Pro is the best choice.  Its source code isn't
available, hence you don't know what it actually does.  Former
versions ignored most errors and I don't know whether the latest
version checks everything now.  The Isartor Test Suite can be used in
order to validate a validator but you certainly don't want to run all
these tests unless the validator has a command-line interface.  And a
big drawback is that Acrobat Pro isn't available on all platforms.

And people happily created zillions of invalid PDF/A-1b files because
they blindly relied on former versions of Acrobat Pro.

 > In my opinion, pdf/a is a great thing, but the lack of free &
 > solid pdf/a-1a validators still limits its adoption.

IMO Apache PDFbox is the most promising tool.  It's written in Java
and thus available on all platforms.  It's free software, hence the
sources are available.  AFAIK it supports PDF/A-1b only but if you
need a validator for PDF/A-1a, I think that it makes more sense to
extend PDFbox rather to start from scratch or to rely on proprietary
software.

Furthermore, the PDFbox PDF/A-1b validator is just an application
program which makes use of a small subset of a powerful PDF library.   
I'm not familiar with Java at all, but I'm convinced that with the
library is a good starting point for other projects.

When I worked on the PDF/A-1b stuff it turned out that a useful
validator has to fulfil at least these requirements:

  1. It has to work on all platforms.

  2. It must be possible to run it on the command-line or from a
     makefile. 

  3. It shouldn't abort after the first error whenever possible.

  4. The source code must be available.


Items 2,and 3 are obvious if you test your software while you're
writing it (which IMO saves a lot of time).  When I wrote the XMP file
I was aware that the time stamps in the PDF file and in the XMP header
were different but I can't do everything at the same time.  Validators
which aborted after the first error turned out to be less helpful.

Beside item 1, item 4 is the most important one.  I wouldn't have
started this discussion at all if the sources of the PDFtron validator
were available.

With that said Acrobat Pro is certainly one of the worst tools at all
and Apache PDFbox seems to be the most promising one because it's free
software with all the advantages free software offers.

I recommend TeX users who are familiar with Java programming to have a
look at

  https://pdfbox.apache.org/

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From reinhard.kotucha at gmx.de  Thu Jun 25 04:53:43 2015
From: reinhard.kotucha at gmx.de (Reinhard Kotucha)
Date: Thu, 25 Jun 2015 04:53:43 +0200
Subject: [luatex] CIDSet in PDF/A documents
In-Reply-To: <CAG5iGsCkdo8v1SUEEcMWOVjmyjeKbK9cCYqo-u1d9TNdS8ZWOA@mail.gmail.com>
References: <21896.46503.822925.752731@zaphod.ms25.net>
 <CAG5iGsBHfmv=u4YWRq5yMPNHrSsRmoOr2ug8QWAbSmqn90gTzw@mail.gmail.com>
 <21897.57821.983829.763938@zaphod.ms25.net>
 <CAG5iGsCkdo8v1SUEEcMWOVjmyjeKbK9cCYqo-u1d9TNdS8ZWOA@mail.gmail.com>
Message-ID: <21899.27959.545335.185738@zaphod.ms25.net>

On 2015-06-24 at 08:57:35 +0200, luigi scarso wrote:

 > I think we can assume  Acrobat Pro v.11 as reference, so PDFtron
 > could be wrong.  You can contact the pdftron team and
 > show them the problem, with  the report from
 > Acrobat Pro v.11 --- it would be nice to hear their answer.

Hi Luigi,
sorry, I overlooked this part of your mail, mainly because all your
answers begin with "> " and thus the first paragraph of your responses
look like citations.  Seems to be a bug in your mail program and
I'm convinced that you don't send your mails in HTML deliberately.

I consider to contact PDFtron but the definite reference is ISO
19005-1 and not Acrobug Pro.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------

From sh-list at posteo.net  Fri Jun 26 23:08:54 2015
From: sh-list at posteo.net (Stephan Hennig)
Date: Fri, 26 Jun 2015 23:08:54 +0200
Subject: [luatex] odd read('*a') behaviour
Message-ID: <558DBF66.1060901@posteo.net>

Hi,

I'm observing strange behaviour when reading from files via read('*a').
 Attached is a Lua script read.lua, which reads a file given as argument
twice.

First, it reads the file into a string at once using read('*a') and
outputs it.  After that, the same file is re-opened.  The first line is
read using read('*l').  Then, the remainder is read using read('*a').
Both strings are output.

The Lua script read.lua has Unix line endings (which might be relevant,
but I don't know).

When calling this script on Windows as

  texlua read.lua read.lua

the output is

> $ texlua read.lua read.lua
> --- BEGIN ---
> -- Read file at once.
> local fin = assert(io.open(arg[1], 'r'))
> local full = fin:read('*a')
> print(full)
> fin:close()
> -- Read file in two steps.
> local fin = assert(io.open(arg[1], 'r'))
> local first = fin:read('*l')
> print(first)
> local tail = fin:read('*a')
> print(tail)
> fin:close()
> --- END ---
> 
> --- BEGIN ---
> -- BEGIN ---
> -- Read file at once.
> local fin = assert(io.open(arg[1], 'r'))
> local full = fin:read('*a')
> print(full)
> fin:close()
> -- Read file in two steps.
> local fin = assert(io.open(arg[1], 'r'))
> local first = fin:read('*l')
> print(first)
> local tail = fin:read('*a')
> print(tail)
> fin:close()
> --- END ---

In the second attempt, the first line is printed twice, though not
completely.  The first minus character is missing.  (When removing the
first comment line completely from the script, even more characters are
missing from the then first line.)

Attached is another file german.tr, which is a translate file for Patgen
(the file can also be downloaded at
<URL:http://repo.or.cz/w/wortliste.git/tree/HEAD:/daten>).  Calling the
script on this file shows even more bizarre behaviour.  File german.tr
is output only once.  In the second attempt, only the first line " 2 2"
is read and output.  The second call to read('*a') doesn't seem to read
anything.

Affected:

* Windows 7, TL 2015
> This is LuaTeX, Version beta-0.80.0 (TeX Live 2015/W32TeX) (rev 5238)
* Windows 7, TL 2014
> This is LuaTeX, Version beta-0.79.1 (TeX Live 2014/W32TeX) (rev 4971)

Not affected:

* Ubuntu 14.04, TL 2013
> This is LuaTeX, Version beta-0.76.0-2013121407  (TeX Live 2013/dev/Debian) (rev 4627)
* Windows 7, PUC Lua 5.2.3
* Ubuntu 14.04, PUC Lua 5.2.3

So this is probably a Windows only issue with LuaTeX.  Can anybody
confirm the buggy behaviour on other platforms?

Best regards,
Stephan Hennig
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: german.tr
URL: <http://tug.org/pipermail/luatex/attachments/20150626/aa558743/attachment.ksh>
-------------- next part --------------
--- BEGIN ---
-- Read file at once.
local fin = assert(io.open(arg[1], 'r'))
local full = fin:read('*a')
print(full)
fin:close()
-- Read file in two steps.
local fin = assert(io.open(arg[1], 'r'))
local first = fin:read('*l')
print(first)
local tail = fin:read('*a')
print(tail)
fin:close()
--- END ---

From dirk.laurie at gmail.com  Sat Jun 27 09:19:10 2015
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Sat, 27 Jun 2015 09:19:10 +0200
Subject: [luatex] odd read('*a') behaviour
In-Reply-To: <558DBF66.1060901@posteo.net>
References: <558DBF66.1060901@posteo.net>
Message-ID: <CABcj=tkuxeodd3BkY-wv+r7GFSC-Xw7VXydkT2LhNHNExdTt5g@mail.gmail.com>

2015-06-26 23:08 GMT+02:00 Stephan Hennig <sh-list at posteo.net>:

> The Lua script read.lua has Unix line endings (which might be relevant,
> but I don't know).
...
>   texlua read.lua read.lua
...
> So this is probably a Windows only issue with LuaTeX.  Can anybody
> confirm the buggy behaviour on other platforms?

In the days when I still used Windows, just about every text file
moved between Windows and Unix gave anomalous results
when used with just about any program that relied on reading
lines. I have no idea whether this is still so.

Could you convert read.lua to readwin.lua (with Windows
line endings) and try the various combinations? I.e.

  texlua read.lua readwin.lua

etc. In an ideal world only some of them will fail, and that
should be helpful in finding out why it happens.

From kakuto at fuk.kindai.ac.jp  Sat Jun 27 10:49:19 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 27 Jun 2015 17:49:19 +0900
Subject: [luatex]  odd read('*a') behaviour
Message-ID: <C49225F5F58A4669AB6D45634E438710@CJ3001517A>

>  The Lua script read.lua has Unix line endings (which might be relevant, but I don't know).

Thanks for the report.  That is due to the Unix line endings.
I want to fix the problem, if I can.

Best,
Akira


From kakuto at fuk.kindai.ac.jp  Sat Jun 27 15:04:03 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 27 Jun 2015 22:04:03 +0900
Subject: [luatex] odd read('*a') behaviour
Message-ID: <343824ECCDA84E0E89F717DEBDF66422@CJ3001517A>

Hi,

>>  The Lua script read.lua has Unix line endings (which might be relevant, but I don't know).
>
> Thanks for the report.  That is due to the Unix line endings.
> I want to fix the problem, if I can.

Fixed in TeX Live 2015,  r37692.

Best regards,
Akira


From sh-list at posteo.net  Sun Jun 28 09:39:32 2015
From: sh-list at posteo.net (Stephan Hennig)
Date: Sun, 28 Jun 2015 09:39:32 +0200
Subject: [luatex] odd read('*a') behaviour
In-Reply-To: <343824ECCDA84E0E89F717DEBDF66422@CJ3001517A>
References: <343824ECCDA84E0E89F717DEBDF66422@CJ3001517A>
Message-ID: <558FA4B4.3090105@posteo.net>

Am 27.06.2015 um 15:04 schrieb Akira Kakuto:

>>>  The Lua script read.lua has Unix line endings (which might be relevant, but I don't know).
> 
> Fixed in TeX Live 2015,  r37692.

I can confirm that I don't see the buggy behaviour any more with W32TeX
texlua binary from 2015-06-27.  Thanks!

Best regards,
Stephan Hennig


From luigi.scarso at gmail.com  Sun Jun 28 11:53:10 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 28 Jun 2015 11:53:10 +0200
Subject: [luatex] Logging \discretionary in words containing non-letters
In-Reply-To: <5587AED3.4090507@morningstar2.co.uk>
References: <5587AED3.4090507@morningstar2.co.uk>
Message-ID: <CAG5iGsD11aV=VRRsJ-cgUiGe9WPkVe6pWQDhPHxKP225WJOgPA@mail.gmail.com>

On Mon, Jun 22, 2015 at 8:44 AM, Joseph Wright <
joseph.wright at morningstar2.co.uk> wrote:

> Hello all,
>
> A little while ago I raised an issue about \discretionary in the log and
> non-letters in 'words' (
> http://tug.org/mailman/htdig/luatex/2015-April/005169.html). With LuaTeX
> 0.80 something like
>
>     \tracingoutput=1 %
>     \showboxdepth=\maxdimen
>     \showboxbreadth=\maxdimen
>     1-world
>     \bye
>
> gives the same log output as pdfTeX, i.e.
>
>     ...\tenrm 1
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm w
>     ...\kern-0.27779
>     ...\tenrm o
>     ...\tenrm r
>     ...\tenrm l
>     ...\tenrm d
>
> However, I now notice that things get a bit weird if there is more than
> one "-" in a 'word'
>
>     \tracingoutput=1 %
>     \showboxdepth\maxdimen
>     \showboxbreadth\maxdimen
>     1-b-c 1-b-c 1a-b-c a-b-1-d-e
>     \bye
>
> gives
>
>     ...\tenrm 1
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm b
>     ...\tenrm -
>     ...\tenrm c
>     ...\glue 3.33333 plus 1.66666 minus 1.11111
>     ...\tenrm 1
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm b
>     ...\tenrm -
>     ...\tenrm c
>     ...\glue 3.33333 plus 1.66666 minus 1.11111
>     ...\tenrm 1
>     ...\tenrm a
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm b
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm c
>     ...\glue 3.33333 plus 1.66666 minus 1.11111
>     ...\tenrm a
>     ...\tenrm -
>     ...\tenrm b
>     ...\tenrm -
>     ...\tenrm 1
>     ...\tenrm -
>     ...\discretionary
>     ...\tenrm d
>     ...\tenrm -
>     ...\tenrm e
>
> with LuaTeX 0.80.0 whereas pdfTeX marks every "-" as a \discretionary.
> Presumably this is not a deliberate change?
> --
> Joseph Wright
>

it more looks like some state gets lost or so in inserting - related disc
nodes.
We will investigate next week, thank you for the report and sorry for delay.
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20150628/8ac0b26f/attachment-0001.html>

From d.p.carlisle at gmail.com  Mon Jun 29 22:57:29 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Mon, 29 Jun 2015 21:57:29 +0100
Subject: [luatex] extended registers for \insert
Message-ID: <CAEW6iOj4FxPbOR4e9JDKxs1uYyVhs8Texp3eHyugJvw347pjSg@mail.gmail.com>

etex and xetex can not use registers higher than 256 with \insert, however
the following plain tex works without error with luatex



\mathchardef\footins=1000

qqq\footnote{1}{zzz}

\bye

Can this be relied on, and luatex will accept the full box register
range with \insert?

If so could \insert be added to the manual in section 2.4 where \box \count etc
are listed as accepting 16-bit numbers,

Thanks

David

(It would be nice to avoid the ugly \reserveinserts trick used with etex to
preserve space for inserts below 256, but I'm wary of using
undocumented features)

From pragma at wxs.nl  Tue Jun 30 00:20:10 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 30 Jun 2015 00:20:10 +0200
Subject: [luatex] extended registers for \insert
In-Reply-To: <CAEW6iOj4FxPbOR4e9JDKxs1uYyVhs8Texp3eHyugJvw347pjSg@mail.gmail.com>
References: <CAEW6iOj4FxPbOR4e9JDKxs1uYyVhs8Texp3eHyugJvw347pjSg@mail.gmail.com>
Message-ID: <5591C49A.7060201@wxs.nl>

On 6/29/2015 10:57 PM, David Carlisle wrote:
> etex and xetex can not use registers higher than 256 with \insert, however
> the following plain tex works without error with luatex
>
>
>
> \mathchardef\footins=1000
>
> qqq\footnote{1}{zzz}
>
> \bye
>
> Can this be relied on, and luatex will accept the full box register
> range with \insert?

sure

> If so could \insert be added to the manual in section 2.4 where \box \count etc
> are listed as accepting 16-bit numbers,
>
> Thanks
>
> David
>
> (It would be nice to avoid the ugly \reserveinserts trick used with etex to
> preserve space for inserts below 256, but I'm wary of using
> undocumented features)

you can use a different \outputbox

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Tue Jun 30 00:29:09 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Mon, 29 Jun 2015 23:29:09 +0100
Subject: [luatex] extended registers for \insert
In-Reply-To: <5591C49A.7060201@wxs.nl>
References: <CAEW6iOj4FxPbOR4e9JDKxs1uYyVhs8Texp3eHyugJvw347pjSg@mail.gmail.com>
 <5591C49A.7060201@wxs.nl>
Message-ID: <CAEW6iOi2h_O7fCJZTu8ftQmHgvwF_dHVKs45K9kn0WLVZ8jAvA@mail.gmail.com>

On 29 June 2015 at 23:20, Hans Hagen <pragma at wxs.nl> wrote:
> On 6/29/2015 10:57 PM, David Carlisle wrote:
>>
>> etex and xetex can not use registers higher than 256 with \insert, however
>> the following plain tex works without error with luatex
>>
>>
>>
>> \mathchardef\footins=1000
>>
>> qqq\footnote{1}{zzz}
>>
>> \bye
>>
>> Can this be relied on, and luatex will accept the full box register
>> range with \insert?
>
>
> sure

Thanks for the confirmation.

>
>> If so could \insert be added to the manual in section 2.4 where \box
>> \count etc
>> are listed as accepting 16-bit numbers,
>>
>> Thanks
>>
>> David
>>
>> (It would be nice to avoid the ugly \reserveinserts trick used with etex
>> to
>> preserve space for inserts below 256, but I'm wary of using
>> undocumented features)
>
>
> you can use a different \outputbox
>
> Hans
>
>

Sure that's documented (2.7.12) but no way to infer from that that you
can use \insert with numbers bigger than 255 is there?

David

