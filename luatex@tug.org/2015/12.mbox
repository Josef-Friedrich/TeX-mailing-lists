From jilani at vindex.me  Wed Dec  2 12:49:31 2015
From: jilani at vindex.me (Jilani KHALDI)
Date: Wed, 2 Dec 2015 12:49:31 +0100
Subject: [luatex] Updating to LuaTex 0.85 on MikTek
Message-ID: <565EDACB.9060901@vindex.me>

Hi All,
how to update manually my LaTeX system (MikTeX on Windows 7) from LuaTeX 
0.80 to LuaTex 0.85.
Thank you.
-- 
Jilani KHALDI
www.vindex.me

From d.p.carlisle at gmail.com  Wed Dec  2 12:59:10 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 2 Dec 2015 11:59:10 +0000
Subject: [luatex] Updating to LuaTex 0.85 on MikTek
In-Reply-To: <565EDACB.9060901@vindex.me>
References: <565EDACB.9060901@vindex.me>
Message-ID: <CAEW6iOhdKLhwfYEq75F+3E-WcM__UQii5uDeFu+ekNT-NZrGqA@mail.gmail.com>

On 2 December 2015 at 11:49, Jilani KHALDI <jilani at vindex.me> wrote:
> Hi All,
> how to update manually my LaTeX system (MikTeX on Windows 7) from LuaTeX
> 0.80 to LuaTex 0.85.
> Thank you.
> --
> Jilani KHALDI
> www.vindex.me

I can't help with miktex specifically (for texlive I compiled from source)

But note the distributed latex does _not_ work with luatex 0.85
we are testing some updates that will go in a latex release before luatex 0.8x
is released to texlive, so lualatex for 0.85 is currently only for testing
(there are some patches on github) but don't update a production
system at this time.

David

From joseph.wright at morningstar2.co.uk  Wed Dec  2 13:01:41 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 2 Dec 2015 12:01:41 +0000
Subject: [luatex] Updating to LuaTex 0.85 on MikTek
In-Reply-To: <565EDACB.9060901@vindex.me>
References: <565EDACB.9060901@vindex.me>
Message-ID: <565EDDA5.6080504@morningstar2.co.uk>

On 02/12/2015 11:49, Jilani KHALDI wrote:
> Hi All,
> how to update manually my LaTeX system (MikTeX on Windows 7) from LuaTeX
> 0.80 to LuaTex 0.85.
> Thank you.

You can download LuaTeX v0.85 built for Windows from the w32tex site,
but that is probably best to use with TeX Live not MiKTeX (the TL
binaries are those from w32tex). However, there are *big* 'under the
hood' changes in v0.85 and adjustments to parts of the LaTeX build
system are needed as a result. Those aren't yet on CTAN so you'll need
to do some work. See https://github.com/josephwright/luatex85 but note
that this really is *for developers*. (The intention is to address this
in the next LaTeX release, likely nominal date 2016-01-01.)

Joseph

From luatex at nililand.de  Wed Dec  2 14:17:52 2015
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 2 Dec 2015 14:17:52 +0100
Subject: [luatex] Updating to LuaTex 0.85 on MikTek
References: <565EDACB.9060901@vindex.me>
Message-ID: <1ttrnarna4ah$.dlg@nililand.de>

Am Wed, 2 Dec 2015 12:49:31 +0100 schrieb Jilani KHALDI:

> Hi All,
> how to update manually my LaTeX system (MikTeX on Windows 7) from LuaTeX 
> 0.80 to LuaTex 0.85.

One can use the binaries from w32tex.org, but they won't be able to
use the miktex tools (on-the-fly installation etc), and you need
also a texmf.cnf, ddl for kpsewhich etc. 

Imho it would be easier to install a texlive in parallel and
exchange the binary there. Switching between miktex and texlive is
easy: you only need to change the path variable. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From jlrn77 at gmail.com  Wed Dec  2 20:12:33 2015
From: jlrn77 at gmail.com (Luis Rivera)
Date: Wed, 2 Dec 2015 13:12:33 -0600
Subject: [luatex] language.dat for lualatex on W32TeX
Message-ID: <CAOEhWT15ebVZ8gdEj+=QnMNjB_=z55VB0jTrion+NuCCaBpnwA@mail.gmail.com>

How do I regenerate `language.dat.lua` on W32TeX? It's not exactly
TeXLive, so I couldn't find tlmgr and I am a bit confused.

Thanks in advance,

Luis Rivera

From kakuto at fuk.kindai.ac.jp  Thu Dec  3 10:59:32 2015
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Thu, 3 Dec 2015 18:59:32 +0900
Subject: [luatex]  language.dat for lualatex on W32TeX
Message-ID: <668EF30656A64C7BB76F5C4AC7E4BE2E@CJ3001517A>

> How do I regenerate `language.dat.lua` on W32TeX?

It is in 'web2c-lib.tar.xz'.

Best,
Akira


From jlrn77 at gmail.com  Thu Dec  3 20:24:10 2015
From: jlrn77 at gmail.com (Luis Rivera)
Date: Thu, 3 Dec 2015 13:24:10 -0600
Subject: [luatex] language.dat for lualatex on W32TeX
Message-ID: <CAOEhWT0gmNjdaoBH1uu4t1oZuFeZO+0ZUwu9v3Ov8hbf7yodMQ@mail.gmail.com>

I see that language.dat.lua is in web2c-lib.tar.xz; what I'd like to
know if how to overwrite it to match my modified language.dat file,
removing all the languages I don't need, if I can't find tlmgr in the
W32TeX distribution.

Thanks again,

Luis Rivera


On 3 December 2015 at 05:00,  <luatex-request at tug.org> wrote:
>
> ------------------------------
>
> Message: 2
> Date: Wed, 2 Dec 2015 13:12:33 -0600
> From: Luis Rivera <jlrn77 at gmail.com>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Subject: [luatex] language.dat for lualatex on W32TeX
> Message-ID:
>         <CAOEhWT15ebVZ8gdEj+=QnMNjB_=z55VB0jTrion+NuCCaBpnwA at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> How do I regenerate `language.dat.lua` on W32TeX? It's not exactly
> TeXLive, so I couldn't find tlmgr and I am a bit confused.
>
> Thanks in advance,
>
> Luis Rivera
>
>
> ------------------------------
>
> Message: 3
> Date: Thu, 3 Dec 2015 18:59:32 +0900
> From: Akira Kakuto <kakuto at fuk.kindai.ac.jp>
> To: <luatex at tug.org>
> Subject: [luatex]  language.dat for lualatex on W32TeX
> Message-ID: <668EF30656A64C7BB76F5C4AC7E4BE2E at CJ3001517A>
> Content-Type: text/plain; format=flowed; charset="iso-2022-jp";
>         reply-type=original
>
>> How do I regenerate `language.dat.lua` on W32TeX?
>
> It is in 'web2c-lib.tar.xz'.
>
> Best,
> Akira
>

From d.p.carlisle at gmail.com  Sat Dec  5 18:51:07 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 5 Dec 2015 17:51:07 +0000
Subject: [luatex] \pdfshellescape
Message-ID: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>

The manual lists \pdfshellescape (which used to be 0 1 or 2 depending
if shell escape was allowed or not) as having been dropped as it can
be implemented in lua.

Is there a recommended implementation of this?

I'd hoped to just see a lua value in the status library or some place
set to 0,1,2 as before (or even a \pdfvariable type thing) but it
seems that the only options are to

look at
kpse.var_value("shell_escape") -- for texmf.cnf settings
texconfig.shell_escape -- for lua initialization settings and
arg array for the commandline
and re-do the merging of these to determine whether os.execute is
allowed or restricted?

or to try running os.execute and testing the result?

 but I was looking to avoid calling os.execute if it was prevented by
the current settings.


any hints welcome:-)

David

From luigi.scarso at gmail.com  Sat Dec  5 22:17:01 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 5 Dec 2015 22:17:01 +0100
Subject: [luatex] \pdfshellescape
In-Reply-To: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
Message-ID: <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>

On Sat, Dec 5, 2015 at 6:51 PM, David Carlisle <d.p.carlisle at gmail.com>
wrote:

> The manual lists \pdfshellescape (which used to be 0 1 or 2 depending
> if shell escape was allowed or not) as having been dropped as it can
> be implemented in lua.
>
> Is there a recommended implementation of this?
>
> I'd hoped to just see a lua value in the status library or some place
> set to 0,1,2 as before (or even a \pdfvariable type thing) but it
> seems that the only options are to
>
> look at
> kpse.var_value("shell_escape") -- for texmf.cnf settings
> texconfig.shell_escape -- for lua initialization settings and
> arg array for the commandline
> and re-do the merging of these to determine whether os.execute is
> allowed or restricted?
>
> or to try running os.execute and testing the result?
>
>  but I was looking to avoid calling os.execute if it was prevented by
> the current settings.
>
>
> any hints welcome:-)
>
> David
>

try

\directlua{print('os.execute():|',os.execute(),'|')}
\bye

with  also
--shell-restricted
--no-shell-escape

It should be ok.



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151205/6b754ed6/attachment.html>

From d.p.carlisle at gmail.com  Sat Dec  5 22:51:43 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 5 Dec 2015 21:51:43 +0000
Subject: [luatex] \pdfshellescape
In-Reply-To: <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
 <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
Message-ID: <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>

On 5 December 2015 at 21:17, luigi scarso <luigi.scarso at gmail.com> wrote:
>
>
> On Sat, Dec 5, 2015 at 6:51 PM, David Carlisle <d.p.carlisle at gmail.com>
> wrote:

>
> try
>
> \directlua{print('os.execute():|',os.execute(),'|')}
> \bye
>
> with  also
> --shell-restricted
> --no-shell-escape
>
> It should be ok.
>
>
>
> --
> luigi


Oh thanks!

Hmm so os.execute with empty argument doesn't call the shell and just
returns 0,1 or 2?

I have to ask, could I have deduced that from the manual?;-)

David

From luigi.scarso at gmail.com  Sun Dec  6 00:29:43 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 6 Dec 2015 00:29:43 +0100
Subject: [luatex] \pdfshellescape
In-Reply-To: <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
 <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
 <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>
Message-ID: <CAG5iGsCXHBjNrB4=HpoTPM615g1QfpuegsLVebhGWCP+BjQUPg@mail.gmail.com>

On Sat, Dec 5, 2015 at 10:51 PM, David Carlisle <d.p.carlisle at gmail.com>
wrote:

> On 5 December 2015 at 21:17, luigi scarso <luigi.scarso at gmail.com> wrote:
> >
> >
> > On Sat, Dec 5, 2015 at 6:51 PM, David Carlisle <d.p.carlisle at gmail.com>
> > wrote:
>
> >
> > try
> >
> > \directlua{print('os.execute():|',os.execute(),'|')}
> > \bye
> >
> > with  also
> > --shell-restricted
> > --no-shell-escape
> >
> > It should be ok.
> >
> >
> >
> > --
> > luigi
>
>
> Oh thanks!
>
> Hmm so os.execute with empty argument doesn't call the shell and just
> returns 0,1 or 2?
>
> I have to ask, could I have deduced that from the manual?;-)
>



The current code is

static int os_execute(lua_State * L)
{
    int allow = 0;
    int ret = 1;
    char *safecmd = NULL;
    char *cmdname = NULL;
    const char *cmd = luaL_optstring(L, 1, NULL);

    if (cmd == NULL) { /* pretend we are \.{\\pdfshellescape} */
        if (shellenabledp <= 0) {
            lua_pushinteger(L, 0);
        } else if (restrictedshell == 0) {
            lua_pushinteger(L, 1);
        } else {
            lua_pushinteger(L, 2);
        }
        return 1;
    }

:
}

but I'm not sure that this will be the final form --- maybe for this reason
it  is still to be documented.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151206/3532eb66/attachment.html>

From d.p.carlisle at gmail.com  Sun Dec  6 01:25:24 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sun, 6 Dec 2015 00:25:24 +0000
Subject: [luatex] \pdfshellescape
In-Reply-To: <CAG5iGsCXHBjNrB4=HpoTPM615g1QfpuegsLVebhGWCP+BjQUPg@mail.gmail.com>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
 <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
 <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>
 <CAG5iGsCXHBjNrB4=HpoTPM615g1QfpuegsLVebhGWCP+BjQUPg@mail.gmail.com>
Message-ID: <CAEW6iOjnpjZh7572fxLywGAaF+PuKM7D50TY9z-GUa=jJ2pvAA@mail.gmail.com>

On 5 December 2015 at 23:29, luigi scarso <luigi.scarso at gmail.com> wrote:
>
>
> but I'm not sure that this will be the final form --- maybe for this reason it  is still to be documented.


Thanks it would be nice if you could document it, even (or especially)
if it is likely to change.

We may need it in latex (existing packages using \pdfshellescape) and
I feel uneasy
relying on undocumented code.

It does seem a bit strange being overloaded on to os.execute() since
it is presumably a fixed
integer for the duration of any document, so the function syntax seems
slightly odd, but
it's certainly workable (if documented:-) so that's more of a minor
aside since you mentioned
it might change.

David

From pragma at wxs.nl  Sun Dec  6 12:56:13 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 6 Dec 2015 12:56:13 +0100
Subject: [luatex] \pdfshellescape
In-Reply-To: <CAEW6iOjnpjZh7572fxLywGAaF+PuKM7D50TY9z-GUa=jJ2pvAA@mail.gmail.com>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
 <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
 <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>
 <CAG5iGsCXHBjNrB4=HpoTPM615g1QfpuegsLVebhGWCP+BjQUPg@mail.gmail.com>
 <CAEW6iOjnpjZh7572fxLywGAaF+PuKM7D50TY9z-GUa=jJ2pvAA@mail.gmail.com>
Message-ID: <5664225D.7050108@wxs.nl>

On 12/6/2015 1:25 AM, David Carlisle wrote:
> On 5 December 2015 at 23:29, luigi scarso <luigi.scarso at gmail.com> wrote:
>>
>>
>> but I'm not sure that this will be the final form --- maybe for this reason it  is still to be documented.
>
>
> Thanks it would be nice if you could document it, even (or especially)
> if it is likely to change.
>
> We may need it in latex (existing packages using \pdfshellescape) and
> I feel uneasy
> relying on undocumented code.
>
> It does seem a bit strange being overloaded on to os.execute() since
> it is presumably a fixed
> integer for the duration of any document, so the function syntax seems
> slightly odd, but
> it's certainly workable (if documented:-) so that's more of a minor
> aside since you mentioned
> it might change.

I'll add

\directlua{tex.write(status.shell_escape)}

While testing your stuff you can do:

\directlua{tex.write(status.shell_escape or 2)}

(as it will be available in 0.81)

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Sun Dec  6 12:58:18 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sun, 6 Dec 2015 11:58:18 +0000
Subject: [luatex] \pdfshellescape
In-Reply-To: <5664225D.7050108@wxs.nl>
References: <CAEW6iOia_3v4yj8LWHS=evE9q7_3=ff90Scz5tqqzrsvtwHtTw@mail.gmail.com>
 <CAG5iGsAJhqBCWji2DF+i5q_Pa3_wZhAJPzcRRLYMOX35knyX0A@mail.gmail.com>
 <CAEW6iOj+1P2m9a3s-H02jC-N4zFYFWogmec1aPnBTgv+fMzy0g@mail.gmail.com>
 <CAG5iGsCXHBjNrB4=HpoTPM615g1QfpuegsLVebhGWCP+BjQUPg@mail.gmail.com>
 <CAEW6iOjnpjZh7572fxLywGAaF+PuKM7D50TY9z-GUa=jJ2pvAA@mail.gmail.com>
 <5664225D.7050108@wxs.nl>
Message-ID: <CAEW6iOg2eS0vUtzs-MWJ2-=Mbxmm2dOpe_TZ0Z5jERcxQ2ngnQ@mail.gmail.com>

On 6 December 2015 at 11:56, Hans Hagen <pragma at wxs.nl> wrote:
> On 12/6/2015 1:25 AM, David Carlisle wrote:
>>
>> On 5 December 2015 at 23:29, luigi scarso <luigi.scarso at gmail.com> wrote:
>>>
>>>
>>>
>>> but I'm not sure that this will be the final form --- maybe for this
>>> reason it  is still to be documented.
>>
>>
>>
>> Thanks it would be nice if you could document it, even (or especially)
>> if it is likely to change.
>>
>> We may need it in latex (existing packages using \pdfshellescape) and
>> I feel uneasy
>> relying on undocumented code.
>>
>> It does seem a bit strange being overloaded on to os.execute() since
>> it is presumably a fixed
>> integer for the duration of any document, so the function syntax seems
>> slightly odd, but
>> it's certainly workable (if documented:-) so that's more of a minor
>> aside since you mentioned
>> it might change.
>
>
> I'll add
>
> \directlua{tex.write(status.shell_escape)}
>
> While testing your stuff you can do:
>
> \directlua{tex.write(status.shell_escape or 2)}
>
> (as it will be available in 0.81)
>
> Hans
>
>

Sounds good, thanks

David

From d.p.carlisle at gmail.com  Sat Dec 12 21:35:31 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 12 Dec 2015 20:35:31 +0000
Subject: [luatex] "new" pdftex compatibility commands.
Message-ID: <CAEW6iOhCwrzy55_MYKhhADP9FBNNqqaHa+LA=2-MkSKbMNvz=w@mail.gmail.com>

The 0.85 luatex manual lists several \edef that can be used to emulate
pdftex primitives in terms of the new \pdfvariable and friends.

Included in the list are

\pdfimageaddfilename
\pdfreplacefont
\pdfxformattr
\pdfxformresources

which don't appear to be defined in pdftex.

The first one is documented as being new

> An extra \pdfimageaddfilename option has been added that can be used to
block writing the filename to the pdf file.

But the other three, that is \pdfvariable
[replacefont|xformattr|xformresources] don't appear to be documented at all?

Could you confirm if this is new functionality (and if so what? I could
guess some from the name, but...:-) or is it
existing pdftex functionality but there is a name change from the old
pdftex versions (if so I missed this scanning the two manuals)


thanks,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151212/69d11791/attachment.html>

From pragma at wxs.nl  Mon Dec 14 11:36:14 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 14 Dec 2015 11:36:14 +0100
Subject: [luatex] "new" pdftex compatibility commands.
In-Reply-To: <CAEW6iOhCwrzy55_MYKhhADP9FBNNqqaHa+LA=2-MkSKbMNvz=w@mail.gmail.com>
References: <CAEW6iOhCwrzy55_MYKhhADP9FBNNqqaHa+LA=2-MkSKbMNvz=w@mail.gmail.com>
Message-ID: <566E9B9E.5030904@wxs.nl>

On 12/12/2015 9:35 PM, David Carlisle wrote:
>
>
> The 0.85 luatex manual lists several \edef that can be used to emulate
> pdftex primitives in terms of the new \pdfvariable and friends.
>
> Included in the list are
>
> |\pdfimageaddfilename

that was a request

> \pdfreplacefont

cf the NEWS that came from pdftex but i can find no traces of it 
actually being used so we'll probably remove it, thanks for noticing

> \pdfxformattr
> \pdfxformresources

these can be used to push stuff in the attr and resource dictionaries

> |which don't appear to be defined in pdftex.

hm, i never checked that .. it's already long ago that i changed any 
pdftex backend code in context

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Dec 14 11:41:38 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 14 Dec 2015 11:41:38 +0100
Subject: [luatex] "new" pdftex compatibility commands.
In-Reply-To: <CAEW6iOhCwrzy55_MYKhhADP9FBNNqqaHa+LA=2-MkSKbMNvz=w@mail.gmail.com>
References: <CAEW6iOhCwrzy55_MYKhhADP9FBNNqqaHa+LA=2-MkSKbMNvz=w@mail.gmail.com>
Message-ID: <566E9CE2.2040708@wxs.nl>

On 12/12/2015 9:35 PM, David Carlisle wrote:

> But the other three, that is \pdfvariable
> [replacefont|xformattr|xformresources] don't appear to be documented at all?

the manual says:

     Two extra token lists are provides, \type {\pdfxformresources} and 
\type
     {\pdfxformattr}, as an alternative to \type {\pdfxform} keywords.

so they are shared (no need to repeat them each xform)

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From joseph.wright at morningstar2.co.uk  Mon Dec 14 12:27:16 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 14 Dec 2015 11:27:16 +0000
Subject: [luatex] Lua access to pdf back end variables
Message-ID: <566EA794.7030209@morningstar2.co.uk>

Hello all,

With the v0.85 release, pdfTeX primitives such as \pdfdecimaldigits are
removed with TeX access documented using for example

    \pdfvariable decimaldigits

Currently, the documentation still lists the Lua access routes as e.g.
tex.pdfdecimaldigits. Is this likely to change? I'm trying to set up
some code to work with LuaTeX both before and after this change but
without having to globally enable a load of names then tidy them up. Lua
access seems to be the way to do this *but* I'm not sure if I need

    local decimaldigits = tex.pdfdecimaldigits

or

     local decimaldigits = tex.decimaldigits or tex.decimaldigits

or ...

Joseph

From pragma at wxs.nl  Mon Dec 14 13:45:46 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 14 Dec 2015 13:45:46 +0100
Subject: [luatex] Lua access to pdf back end variables
In-Reply-To: <566EA794.7030209@morningstar2.co.uk>
References: <566EA794.7030209@morningstar2.co.uk>
Message-ID: <566EB9FA.20505@wxs.nl>

On 12/14/2015 12:27 PM, Joseph Wright wrote:
> Hello all,
>
> With the v0.85 release, pdfTeX primitives such as \pdfdecimaldigits are
> removed with TeX access documented using for example
>
>      \pdfvariable decimaldigits
>
> Currently, the documentation still lists the Lua access routes as e.g.
> tex.pdfdecimaldigits. Is this likely to change? I'm trying to set up

ah, yes, i'll remove these

> some code to work with LuaTeX both before and after this change but
> without having to globally enable a load of names then tidy them up. Lua
> access seems to be the way to do this *but* I'm not sure if I need
>
>      local decimaldigits = tex.pdfdecimaldigits
>
> or
>
>       local decimaldigits = tex.decimaldigits or tex.decimaldigits
>
> or ...

i added

pdf.setdegitaldigits(n)

n = pdf.setdegitaldigits()

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From joseph.wright at morningstar2.co.uk  Mon Dec 14 17:54:59 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 14 Dec 2015 16:54:59 +0000
Subject: [luatex] Lua access to pdf back end variables
In-Reply-To: <566EB9FA.20505@wxs.nl>
References: <566EA794.7030209@morningstar2.co.uk> <566EB9FA.20505@wxs.nl>
Message-ID: <566EF463.9000607@morningstar2.co.uk>

On 14/12/2015 12:45, Hans Hagen wrote:
> On 12/14/2015 12:27 PM, Joseph Wright wrote:
>> Hello all,
>>
>> With the v0.85 release, pdfTeX primitives such as \pdfdecimaldigits are
>> removed with TeX access documented using for example
>>
>>      \pdfvariable decimaldigits
>>
>> Currently, the documentation still lists the Lua access routes as e.g.
>> tex.pdfdecimaldigits. Is this likely to change? I'm trying to set up
> 
> ah, yes, i'll remove these

Am I right in understanding that they were removed from the v0.85
binaries (this seems to be the case).

>> some code to work with LuaTeX both before and after this change but
>> without having to globally enable a load of names then tidy them up. Lua
>> access seems to be the way to do this *but* I'm not sure if I need
>>
>>      local decimaldigits = tex.pdfdecimaldigits
>>
>> or
>>
>>       local decimaldigits = tex.decimaldigits or tex.decimaldigits
>>
>> or ...
> 
> i added
> 
> pdf.setdegitaldigits(n)
> 
> n = pdf.setdegitaldigits()

Presumably this route will be available in v0.90? It seems that there is
a 'gap' where there is no Lua access to these concepts: is that correct?

Joseph


From pragma at wxs.nl  Mon Dec 14 19:43:01 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 14 Dec 2015 19:43:01 +0100
Subject: [luatex] Lua access to pdf back end variables
In-Reply-To: <566EF463.9000607@morningstar2.co.uk>
References: <566EA794.7030209@morningstar2.co.uk> <566EB9FA.20505@wxs.nl>
 <566EF463.9000607@morningstar2.co.uk>
Message-ID: <566F0DB5.8010504@wxs.nl>

On 12/14/2015 5:54 PM, Joseph Wright wrote:
> On 14/12/2015 12:45, Hans Hagen wrote:
>> On 12/14/2015 12:27 PM, Joseph Wright wrote:
>>> Hello all,
>>>
>>> With the v0.85 release, pdfTeX primitives such as \pdfdecimaldigits are
>>> removed with TeX access documented using for example
>>>
>>>       \pdfvariable decimaldigits
>>>
>>> Currently, the documentation still lists the Lua access routes as e.g.
>>> tex.pdfdecimaldigits. Is this likely to change? I'm trying to set up
>>
>> ah, yes, i'll remove these
>
> Am I right in understanding that they were removed from the v0.85
> binaries (this seems to be the case).

they were hardcoded entries in the tex table; in fact, one can just 
assign something to that table as it's a normal table, so

tex.foo = 123

is quite valid. Some variables could be read but not set (setting just 
added an antry in the table thereby also obscuring the variable at the 
tex end)

explicit setters/getters behave better (and all backend stuff is (to be) 
in the pdf table/namespace anyway

> Presumably this route will be available in v0.90? It seems that there is

there will probably be a 0.87 in between

> a 'gap' where there is no Lua access to these concepts: is that correct?

indeed (not that big a deal as i suppose in most cases they are set at 
the tex end)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Fri Dec 18 12:00:40 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 11:00:40 +0000
Subject: [luatex] hyphenation in luatex 0.87
Message-ID: <CAEW6iOj7weCUJSRORL0sxaH=bKwmdf-X0FBkqNA4R-a9JMnSzw@mail.gmail.com>

with the plain tex

\hsize 10pt
\hfuzz20pt
a supercalifragilisticexpialidocious
\bye


with pdftex I get no warnings and a multi-line output with several hyphens.

with 0.87 built for example just by

luatex --ini plain.tex \\dump

I get no hyphenation and it comes on one line with:

Overfull \hbox (130.22255pt too wide) in paragraph at lines 4--5
\tenrm supercalifragilisticexpialidocious |

Am I missing some setup needed to enable hyphenation?

David

From d.p.carlisle at gmail.com  Fri Dec 18 14:38:55 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 13:38:55 +0000
Subject: [luatex] query the value of \hyphenationmin
Message-ID: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>

Should the new \hyphenationmin be usable with \the and \showthe, like
\lefthyphenmin?

Currently if I want to see the current effective value I get from


\show\lefthyphenmin
\showthe\lefthyphenmin
\show\hyphenationmin
\showthe\hyphenationmin


> \lefthyphenmin=\lefthyphenmin.
l.4 \show\lefthyphenmin

?
> 2.
l.5 \showthe\lefthyphenmin

?
> \hyphenationmin=\hyphenationmin.
l.6 \show\hyphenationmin

?
! You can't use `\hyphenationmin' after \the.
l.7 \showthe\hyphenationmin

?

David

From pragma at wxs.nl  Fri Dec 18 16:35:27 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Dec 2015 16:35:27 +0100
Subject: [luatex] hyphenation in luatex 0.87
In-Reply-To: <CAEW6iOj7weCUJSRORL0sxaH=bKwmdf-X0FBkqNA4R-a9JMnSzw@mail.gmail.com>
References: <CAEW6iOj7weCUJSRORL0sxaH=bKwmdf-X0FBkqNA4R-a9JMnSzw@mail.gmail.com>
Message-ID: <567427BF.2040508@wxs.nl>

On 12/18/2015 12:00 PM, David Carlisle wrote:
> with the plain tex
>
> \hsize 10pt
> \hfuzz20pt
> a supercalifragilisticexpialidocious
> \bye
>
>
> with pdftex I get no warnings and a multi-line output with several hyphens.
>
> with 0.87 built for example just by
>
> luatex --ini plain.tex \\dump
>
> I get no hyphenation and it comes on one line with:
>
> Overfull \hbox (130.22255pt too wide) in paragraph at lines 4--5
> \tenrm supercalifragilisticexpialidocious |
>
> Am I missing some setup needed to enable hyphenation?

\savinghyohcodes=1

helps for now; i had fallback to working all right but somehow it got 
lost ... fixed now


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Fri Dec 18 18:00:08 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Dec 2015 18:00:08 +0100
Subject: [luatex] query the value of \hyphenationmin
In-Reply-To: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>
References: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>
Message-ID: <56743B98.8010907@wxs.nl>

On 12/18/2015 2:38 PM, David Carlisle wrote:
> Should the new \hyphenationmin be usable with \the and \showthe, like
> \lefthyphenmin?
>
> Currently if I want to see the current effective value I get from
>
>
> \show\lefthyphenmin
> \showthe\lefthyphenmin
> \show\hyphenationmin
> \showthe\hyphenationmin
>
>
>> \lefthyphenmin=\lefthyphenmin.
> l.4 \show\lefthyphenmin
>
> ?
>> 2.
> l.5 \showthe\lefthyphenmin
>
> ?
>> \hyphenationmin=\hyphenationmin.
> l.6 \show\hyphenationmin
>
> ?
> ! You can't use `\hyphenationmin' after \the.
> l.7 \showthe\hyphenationmin
>
> ?

because the value is stored with the language (as with \preexhyphenchar 
cum suis) ... i'll add \the-ers for those that makes sense, fwiw

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Fri Dec 18 18:24:14 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 17:24:14 +0000
Subject: [luatex] query the value of \hyphenationmin
In-Reply-To: <56743B98.8010907@wxs.nl>
References: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>
 <56743B98.8010907@wxs.nl>
Message-ID: <CAEW6iOitfuh8uB+33pccyXdOX8F+TV5oy+nanC0Dq0xT=+LA5Q@mail.gmail.com>

On 18 December 2015 at 17:00, Hans Hagen <pragma at wxs.nl> wrote:
> On 12/18/2015 2:38 PM, David Carlisle wrote:
>>
>> Should the new \hyphenationmin be usable with \the and \showthe, like
>> \lefthyphenmin?
>>
>> Currently if I want to see the current effective value I get from
>>
>>
>> \show\lefthyphenmin
>> \showthe\lefthyphenmin
>> \show\hyphenationmin
>> \showthe\hyphenationmin
>>
>>
>>> \lefthyphenmin=\lefthyphenmin.
>>
>> l.4 \show\lefthyphenmin
>>
>> ?
>>>
>>> 2.
>>
>> l.5 \showthe\lefthyphenmin
>>
>> ?
>>>
>>> \hyphenationmin=\hyphenationmin.
>>
>> l.6 \show\hyphenationmin
>>
>> ?
>> ! You can't use `\hyphenationmin' after \the.
>> l.7 \showthe\hyphenationmin
>>
>> ?
>
>
> because the value is stored with the language

I wondered about that but same is true for \lefthyphenmin isn't it?
that is also documented as being stored per language.
In any case there should be some way of testing any set value, really.

> (as with \preexhyphenchar cum
> suis) ... i'll add \the-ers for those that makes sense, fwiw
>
> Hans

David

>




-- 
http://dpcarlisle.blogspot.com/

From d.p.carlisle at gmail.com  Fri Dec 18 18:27:58 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 17:27:58 +0000
Subject: [luatex] hyphenation in luatex 0.87
In-Reply-To: <567427BF.2040508@wxs.nl>
References: <CAEW6iOj7weCUJSRORL0sxaH=bKwmdf-X0FBkqNA4R-a9JMnSzw@mail.gmail.com>
 <567427BF.2040508@wxs.nl>
Message-ID: <CAEW6iOh7zrzwkTwsghrJKxz8Fz1rvTSMH6Zpu3Ovh-aQE0zeoQ@mail.gmail.com>

On 18 December 2015 at 15:35, Hans Hagen <pragma at wxs.nl> wrote:
> On 12/18/2015 12:00 PM, David Carlisle wrote:
>>
>> with the plain tex
>>
>> \hsize 10pt
>> \hfuzz20pt
>> a supercalifragilisticexpialidocious
>> \bye
>>
>>
>> with pdftex I get no warnings and a multi-line output with several
>> hyphens.
>>
>> with 0.87 built for example just by
>>
>> luatex --ini plain.tex \\dump
>>
>> I get no hyphenation and it comes on one line with:
>>
>> Overfull \hbox (130.22255pt too wide) in paragraph at lines 4--5
>> \tenrm supercalifragilisticexpialidocious |
>>
>> Am I missing some setup needed to enable hyphenation?
>
>
> \savinghyphcodes=1

Thanks if I locally modify the files to set that before loading hyphenation
test suite failures go down from 40 to 19 which is a bit of a relief:-)

(still investigating the remaining ones, more emails on the way probably:-)

David

From pragma at wxs.nl  Fri Dec 18 18:38:34 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Dec 2015 18:38:34 +0100
Subject: [luatex] query the value of \hyphenationmin
In-Reply-To: <CAEW6iOitfuh8uB+33pccyXdOX8F+TV5oy+nanC0Dq0xT=+LA5Q@mail.gmail.com>
References: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>
 <56743B98.8010907@wxs.nl>
 <CAEW6iOitfuh8uB+33pccyXdOX8F+TV5oy+nanC0Dq0xT=+LA5Q@mail.gmail.com>
Message-ID: <5674449A.5050507@wxs.nl>

On 12/18/2015 6:24 PM, David Carlisle wrote:

> I wondered about that but same is true for \lefthyphenmin isn't it?
> that is also documented as being stored per language.
> In any case there should be some way of testing any set value, really.

different code paths (traditional vs new) as \lefthyphenmin is a counter 
and the rest not

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Fri Dec 18 22:07:47 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 21:07:47 +0000
Subject: [luatex] query the value of \hyphenationmin
In-Reply-To: <5674449A.5050507@wxs.nl>
References: <CAEW6iOgKwA1hbbCjdiAaXVYuR7dmmvoPNZxviE3G+nDtXLAWiA@mail.gmail.com>
 <56743B98.8010907@wxs.nl>
 <CAEW6iOitfuh8uB+33pccyXdOX8F+TV5oy+nanC0Dq0xT=+LA5Q@mail.gmail.com>
 <5674449A.5050507@wxs.nl>
Message-ID: <CAEW6iOhzud5KRFSWWbJwS1BZA1KoNXkK2Hg87Ry9AUwNHY9WJg@mail.gmail.com>

On 18 December 2015 at 17:38, Hans Hagen <pragma at wxs.nl> wrote:
> On 12/18/2015 6:24 PM, David Carlisle wrote:
>
>> I wondered about that but same is true for \lefthyphenmin isn't it?
>> that is also documented as being stored per language.
>> In any case there should be some way of testing any set value, really.
>
>
> different code paths (traditional vs new) as \lefthyphenmin is a counter and
> the rest not

Internal code paths are of interest to you only:-) to a user of the language it
would be very odd if \hyphenationmin doesn't work the same way as
\lefthyphenmin and \righthyphenmin since they are just specifying different
aspects of the same thing, the behaviour of hyphenation near word boundaries
and small words.

>
>
> Hans

David

From d.p.carlisle at gmail.com  Fri Dec 18 22:27:57 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 21:27:57 +0000
Subject: [luatex] \mathchardef\foo=\mathcode`\x
Message-ID: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>

The idiom

\mathchardef\foo=\mathcode`\x

is commonly used to  save a mathcode of some character while you
temporarily change it for some reason.

Notably it's used (4 times) during the loading of the AMS package
amsmath, the main math support in latex.

this breaks in 0.87 as \mathcode returns a number suitable for
\Umathcharnumdef which is too large for \mathchardef.

I'm not (necessarily) suggesting that the luatex behaviour change but
if anyone is wanting to test latex math support with the new engine
they may want to patch a local copy of amsmath.sty for testing as at
the end of this message.

Since \mathchardef is mainly for legacy use anyway, I wonder if luatex
could keep this working, specifically \mathchardef if given a number
bigger than hex 8000 could perhaps (instead of giving an error) act
like \Umathcharnumdef.. An alternative would be to try to do the same
test  via a macro redefinition of \mathchardef probably using the lua
token scanner to get the integer) but emulating all the primitive
behaviour in a compatible way might be hard.

The other alternative, as below, is to update the tex code to use
\Umath... but finding all such uses and getting authors to update
might be tricky, just a first scan shows the following (most of which
are affected by this)

$ grep -l mathchardef.*mathcode */*.???
amsmath/amsmath.sty
amsmath/amsopn.sty
bgteubner/bgteubner.cls
breqn/flexisym.sty
commath/commath.sty
dozenal/dozenal.sty
eulervm/eulervm.sty
fontinst/fontdoc.sty
ionumbers/ionumbers.sty
listings/lstlang3.sty
mandi/mandi.sty
mathastext/mathastext.sty
mathtools/mathtools.sty
mdsymbol/mdsymbol.sty
ncctools/ncccomma.sty
semantic/ligature.sty
stix/stix.sty
tudscr/mathswap.sty
unicode-math/unicode-math-xetex.sty
was/icomma.sty
zed-csp/zed-csp.sty


David

For people wanting to use amsmath, a fix would be to change line 741
of amsmath,sty  so it looks something like

\ifx\hyphenationmin\undefined
\mathchardef\std at minus\mathcode`\-\relax
\mathchardef\std at equal\mathcode`\=\relax
\AtBeginDocument{%
  \mathchardef\std at minus\mathcode`\-\relax
  \mathchardef\std at equal\mathcode`\=\relax
}
\else
\Umathcharnumdef\std at minus\Umathcodenum`\-\relax
\Umathcharnumdef\std at equal\Umathcodenum`\=\relax
\AtBeginDocument{%
  \Umathcharnumdef\std at minus\Umathcodenum`\-\relax
  \Umathcharnumdef\std at equal\Umathcodenum`\=\relax
}
\fi

From d.p.carlisle at gmail.com  Fri Dec 18 22:55:26 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 21:55:26 +0000
Subject: [luatex] (not) stretching delimiters.
Message-ID: <CAEW6iOi+82DXBzs5qHi-xg79wabj0dXsQsJOKzsQYBsXQWL1ig@mail.gmail.com>

 Given the plain tex file



$\bordermatrix{&\cr 1&0\cr2&0\cr}$


\bye



I get the attached output with large delimiters with pdftex and
unstretched ones with 0.87.

(Since I compiled this myself for cygwin, and patched the format
building, it's possible that I just have things set up wrong but I
thought I'd flag it anyway)

David
-------------- next part --------------
A non-text attachment was scrubbed...
Name: p.png
Type: image/png
Size: 2689 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20151218/772928e6/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: l.png
Type: image/png
Size: 2070 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20151218/772928e6/attachment-0001.png>

From jfbu at free.fr  Fri Dec 18 22:57:17 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 18 Dec 2015 22:57:17 +0100
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
Message-ID: <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>

Hi David,

> 
> [snip]
> David
> 
> For people wanting to use amsmath, a fix would be to change line 741
> of amsmath,sty  so it looks something like
> 
> \ifx\hyphenationmin\undefined
> \mathchardef\std at minus\mathcode`\-\relax
> \mathchardef\std at equal\mathcode`\=\relax
> \AtBeginDocument{%
>  \mathchardef\std at minus\mathcode`\-\relax
>  \mathchardef\std at equal\mathcode`\=\relax
> }
> \else
> \Umathcharnumdef\std at minus\Umathcodenum`\-\relax
> \Umathcharnumdef\std at equal\Umathcodenum`\=\relax
> \AtBeginDocument{%
>  \Umathcharnumdef\std at minus\Umathcodenum`\-\relax
>  \Umathcharnumdef\std at equal\Umathcodenum`\=\relax
> }
> \fi

I thought package lualatex-math by Philipp Stephani addressed
these amsmath problems with \std at minus and \std at equal already ?

as per  mathastext.sty package, it already does the right thing
but in a rather brutal way regarding \@newmcodes macro or amsmath

(it replaces it by \relax :-( )

best

Jean-Fran?ois

From jfbu at free.fr  Fri Dec 18 23:02:29 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 18 Dec 2015 23:02:29 +0100
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
Message-ID: <65E53426-64FF-4344-BF63-F1CF5919814F@free.fr>


Le 18 d?c. 2015 ? 22:57, jfbu <jfbu at free.fr> a ?crit :

> Hi David,
> 
>> 
>> [snip]
>> David
>> 
>> For people wanting to use amsmath, a fix would be to change line 741
>> of amsmath,sty  so it looks something like
>> 
>> \ifx\hyphenationmin\undefined
>> \mathchardef\std at minus\mathcode`\-\relax
>> \mathchardef\std at equal\mathcode`\=\relax
>> \AtBeginDocument{%
>> \mathchardef\std at minus\mathcode`\-\relax
>> \mathchardef\std at equal\mathcode`\=\relax
>> }
>> \else
>> \Umathcharnumdef\std at minus\Umathcodenum`\-\relax
>> \Umathcharnumdef\std at equal\Umathcodenum`\=\relax
>> \AtBeginDocument{%
>> \Umathcharnumdef\std at minus\Umathcodenum`\-\relax
>> \Umathcharnumdef\std at equal\Umathcodenum`\=\relax
>> }
>> \fi
> 
> I thought package lualatex-math by Philipp Stephani addressed
> these amsmath problems with \std at minus and \std at equal already ?
> 
> as per  mathastext.sty package, it already does the right thing
> but in a rather brutal way regarding \@newmcodes macro or amsmath
> 
> (it replaces it by \relax :-( )

sorry, please read \newcodes@, used in \DeclareMathOperator and doing

\gdef\newmcodes@{\mathcode`\'39\mathcode`\*42\mathcode`\."613A%
  \ifnum\mathcode`\-=45 \else
    \mathchardef\std at minus\mathcode`\-\relax
  \fi
  \mathcode`\-45\mathcode`\/47\mathcode`\:"603A\relax}


which has the \mathcode/\mathchardef issue if one has assigned
an Umathcode to -

best

Jean-Fran?ois

From pragma at wxs.nl  Fri Dec 18 23:19:46 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Dec 2015 23:19:46 +0100
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
Message-ID: <56748682.3050201@wxs.nl>

On 12/18/2015 10:27 PM, David Carlisle wrote:
> The idiom
>
> \mathchardef\foo=\mathcode`\x
>
> is commonly used to  save a mathcode of some character while you
> temporarily change it for some reason.
>
> Notably it's used (4 times) during the loading of the AMS package
> amsmath, the main math support in latex.
>
> this breaks in 0.87 as \mathcode returns a number suitable for
> \Umathcharnumdef which is too large for \mathchardef.
>
> I'm not (necessarily) suggesting that the luatex behaviour change but
> if anyone is wanting to test latex math support with the new engine
> they may want to patch a local copy of amsmath.sty for testing as at
> the end of this message.
>
> Since \mathchardef is mainly for legacy use anyway, I wonder if luatex
> could keep this working, specifically \mathchardef if given a number
> bigger than hex 8000 could perhaps (instead of giving an error) act
> like \Umathcharnumdef.. An alternative would be to try to do the same
> test  via a macro redefinition of \mathchardef probably using the lua
> token scanner to get the integer) but emulating all the primitive
> behaviour in a compatible way might be hard.

changing the meaning of \mathchardef is also kind of incompatible (who 
knows who depends on the error message for whatever reason)

anyway, i'll add that fallback but there is no way back and it will not 
be under some 'option' control


Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From d.p.carlisle at gmail.com  Fri Dec 18 23:20:18 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 22:20:18 +0000
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
Message-ID: <CAEW6iOi11YQzkCNYWGDu3H1gxmAKVE8dGkYRZ_fDpfY921Mnhg@mail.gmail.com>

On 18 December 2015 at 21:57, jfbu <jfbu at free.fr> wrote:
> Hi David,
>

>
> I thought package lualatex-math by Philipp Stephani addressed
> these amsmath problems with \std at minus and \std at equal already ?

It does some things yes but standard amsmath loads without error
in luatex prior to .87. In 0.87 it gives errors while loading which will
affect a lot of documents unless we we can get it updated
(or adjust things so an  update not necessary) before tl2016.
lualatex-math hasn't been been updated since yesterday to adapt to
luatex 0.87 has it?

In the other message

> which has the \mathcode/\mathchardef issue if one has assigned
> an Umathcode to -


not sure what you mean by that?

In .87  assigning a \mathcode to - or assigning a Umathcode to it
are the same thing (and luatex always reports
the Umathcode version when you query it) so essentially
it will be the case that a umath ccode is assigned to - at that point.

David

From d.p.carlisle at gmail.com  Fri Dec 18 23:24:46 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 22:24:46 +0000
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <56748682.3050201@wxs.nl>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <56748682.3050201@wxs.nl>
Message-ID: <CAEW6iOg8_+FVJ3c90jNmHRpb3s7EgHP3HRvJ_Q8mj28+19G_ww@mail.gmail.com>

> changing the meaning of \mathchardef is also kind of incompatible (who knows who depends on the error message for whatever reason)

changing anything in tex is incompatible with something, as we both know:-)

> anyway, i'll add that fallback but there is no way back and it will not be under some 'option' control

options wouldn't be good, I agree. Just lead to incompatible setups
and confusion.

as I said in the last message not necessarily flagging for exactly
that change (I've not had long to think about it really, I'm just
working down our test failures and analysing the results) but wanted
to flag the issue and post the macro workaround, so that it could be
discussed (or at least known about:-)

David


> Hans

From pragma at wxs.nl  Fri Dec 18 23:30:16 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 18 Dec 2015 23:30:16 +0100
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <CAEW6iOg8_+FVJ3c90jNmHRpb3s7EgHP3HRvJ_Q8mj28+19G_ww@mail.gmail.com>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <56748682.3050201@wxs.nl>
 <CAEW6iOg8_+FVJ3c90jNmHRpb3s7EgHP3HRvJ_Q8mj28+19G_ww@mail.gmail.com>
Message-ID: <567488F8.2080603@wxs.nl>

On 12/18/2015 11:24 PM, David Carlisle wrote:
>> changing the meaning of \mathchardef is also kind of incompatible (who knows who depends on the error message for whatever reason)
>
> changing anything in tex is incompatible with something, as we both know:-)
>
>> anyway, i'll add that fallback but there is no way back and it will not be under some 'option' control
>
> options wouldn't be good, I agree. Just lead to incompatible setups
> and confusion.
>
> as I said in the last message not necessarily flagging for exactly
> that change (I've not had long to think about it really, I'm just
> working down our test failures and analysing the results) but wanted
> to flag the issue and post the macro workaround, so that it could be
> discussed (or at least known about:-)

let's add it and later we can decide to remove it (back to the error) so 
that there is time to adapt ...


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From jfbu at free.fr  Fri Dec 18 23:34:29 2015
From: jfbu at free.fr (jfbu)
Date: Fri, 18 Dec 2015 23:34:29 +0100
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <CAEW6iOi11YQzkCNYWGDu3H1gxmAKVE8dGkYRZ_fDpfY921Mnhg@mail.gmail.com>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
 <CAEW6iOi11YQzkCNYWGDu3H1gxmAKVE8dGkYRZ_fDpfY921Mnhg@mail.gmail.com>
Message-ID: <D114E016-71AB-49BC-9283-0A8C92B5FD0B@free.fr>


Le 18 d?c. 2015 ? 23:20, David Carlisle <d.p.carlisle at gmail.com> a ?crit :

> On 18 December 2015 at 21:57, jfbu <jfbu at free.fr> wrote:
>> Hi David,
>> 
> 
>> 
>> I thought package lualatex-math by Philipp Stephani addressed
>> these amsmath problems with \std at minus and \std at equal already ?
> 
> It does some things yes but standard amsmath loads without error
> in luatex prior to .87. In 0.87 it gives errors while loading which will
> affect a lot of documents unless we we can get it updated
> (or adjust things so an  update not necessary) before tl2016.
> lualatex-math hasn't been been updated since yesterday to adapt to
> luatex 0.87 has it?


not that I know of... Sorry for not having paid enough attention
to the fact that your message is motivated by 0.87

> 
> In the other message
> 
>> which has the \mathcode/\mathchardef issue if one has assigned
>> an Umathcode to -
> 
> 
> not sure what you mean by that?

well, I only meant that when a Umathcode had been assigned to -,
the 

    \mathchardef\std at minus\mathcode`\-\relax 

within \newmcodes@,
hence within any macro \foo having been user declared via 
\DeclareMathOperator
(which is not the case of \sin, \cos, etc... in amsopn.sty)
provoked an error.


> 
> In .87  assigning a \mathcode to - or assigning a Umathcode to it
> are the same thing (and luatex always reports
> the Umathcode version when you query it) so essentially
> it will be the case that a umath ccode is assigned to - at that point.

but \mathchardef is not updated to recognize a \Umathcode from a \mathcode ?

(I don't want to derail the thread though and will just sit back
and read the upcoming explanations by knowledgeable people)

cheers

Jean-Fran?ois

From d.p.carlisle at gmail.com  Fri Dec 18 23:35:55 2015
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Fri, 18 Dec 2015 22:35:55 +0000
Subject: [luatex] \mathchardef\foo=\mathcode`\x
In-Reply-To: <D114E016-71AB-49BC-9283-0A8C92B5FD0B@free.fr>
References: <CAEW6iOguzp=Sub7=PbSeCgGn4=y3J7tTOzsVpdKCJjJvZ-Bo2g@mail.gmail.com>
 <00418784-41E8-4808-AE32-3EBE0C1D304F@free.fr>
 <CAEW6iOi11YQzkCNYWGDu3H1gxmAKVE8dGkYRZ_fDpfY921Mnhg@mail.gmail.com>
 <D114E016-71AB-49BC-9283-0A8C92B5FD0B@free.fr>
Message-ID: <CAEW6iOjkHVPkeB5paohocTmk-tOOb-UgCrTFh1fnKQDBhzk7ng@mail.gmail.com>

> but \mathchardef is not updated to recognize a \Umathcode from a \mathcode ?

that is exactly the issue raised in this thread, yes.

David

From pragma at wxs.nl  Sat Dec 19 00:19:21 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 19 Dec 2015 00:19:21 +0100
Subject: [luatex] (not) stretching delimiters.
In-Reply-To: <CAEW6iOi+82DXBzs5qHi-xg79wabj0dXsQsJOKzsQYBsXQWL1ig@mail.gmail.com>
References: <CAEW6iOi+82DXBzs5qHi-xg79wabj0dXsQsJOKzsQYBsXQWL1ig@mail.gmail.com>
Message-ID: <56749479.60305@wxs.nl>

On 12/18/2015 10:55 PM, David Carlisle wrote:
>   Given the plain tex file
>
>
>
> $\bordermatrix{&\cr 1&0\cr2&0\cr}$
>
>
> \bye
>
>
>
> I get the attached output with large delimiters with pdftex and
> unstretched ones with 0.87.
>
> (Since I compiled this myself for cygwin, and patched the format
> building, it's possible that I just have things set up wrong but I
> thought I'd flag it anyway)

i'll check it (i probably have to check some more 8 bit math)


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From luigi.scarso at gmail.com  Sun Dec 20 22:54:30 2015
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 20 Dec 2015 22:54:30 +0100
Subject: [luatex] Luatex 0.87.0 announcement
Message-ID: <CAG5iGsD7-cqbVpT+CJXCwhpMuj4aq4w5Q4eooBZO5NS2e704Tg@mail.gmail.com>

New luatex release, 0.87.0
>From NEWS:

==================================================
This is a next step upto 0.90 and it has the following changes:

- image data is no longer stored in the format (it was fragile anyway)

- pdf backend data generated when in ini mode is no longer stored in  the
format

- (incomplete) \mag support removed from pdf backend (this functionality is
  kept in dvi mode)

- there are a couple of improvements that should make luatex run a little
bit faster
  (but of course that depends on the job at hand)

- some further pending issues / cleanup has been done (but this is not
reflected in the
  interface)

- there is a new primitive \nospace:

  \nospace=1   do now not inject glue for spaces (not even zero glue)
  \nospace=2   inject zero glue for spaces

- there are new primitives \hpack, \vpack and \tpack that are like \hbox,
\vbox and
  \vtop but they don't trigger callbacks

- we no longer keep track of older math character and delimiter definition
states,
  but this should normally go unnoticed

- from now on only ^^XX, ^^C, ^^^^XXXX and ^^^^^^XXXXXX are supported so no
funny odd
  values (three and five)

- texio.setescape(0) disables escaping to terminal (a matter of taste)

- the (current) lc codes are now saved with the (current) language when
patterns are
  loaded unless one hs used \hjcode instead of \lccode; overloading of
\hjcodes is
  possible (but of course goes ahead of hyphenation which is delayed till
parbuilding or
  packaging

- active characters can now be set with: \letcharcode123=\foo (experimental)

- there are some experimental new primitives but these will be described
when they are
  stable (currently being tested)

- there is more backend error reporting and all error messages adn warnings
(the non-tex
  ones) have been normalized

- of course there are the usual small fixes and additional setters and
getters in libraries
  (see manual)
==================================================

Last minute note:
 --synctex
doesn't work. It will be fixed in the next release.

As usual,
the archives can be downloaded from supelec:

        https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

  svn co --username anonsvn --password anonsvn              \
      https://foundry.supelec.fr/svn/luatex/tags/beta-0.87.0

Bugs and feature requests can be added to the issue tracker at

       http://tracker.luatex.org

When you use context or latex you need an updated format. The latest
version of
context can be fetched from the context garden, latex from ctan. For latex
you can contact David and Joseph as they are dealing with the update.






Have fun,
Hans, Luigi, Taco (in alphabetical order this time)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20151220/49895a9a/attachment.html>

From joseph.wright at morningstar2.co.uk  Mon Dec 21 12:13:04 2015
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 21 Dec 2015 11:13:04 +0000
Subject: [luatex] \luastartup
Message-ID: <5677DEC0.3010808@morningstar2.co.uk>

Hello all,

Looking over the list of LuaTeX primitives I notice \luastartup: it's
been there for a while but doesn't seem to be documented. It looks
potentially interesting, but I'm not sure what it's supposed to do: a clue?

Joseph

From pragma at wxs.nl  Mon Dec 21 13:32:31 2015
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 21 Dec 2015 13:32:31 +0100
Subject: [luatex] \luastartup
In-Reply-To: <5677DEC0.3010808@morningstar2.co.uk>
References: <5677DEC0.3010808@morningstar2.co.uk>
Message-ID: <5677F15F.2000708@wxs.nl>

On 12/21/2015 12:13 PM, Joseph Wright wrote:
> Hello all,
>
> Looking over the list of LuaTeX primitives I notice \luastartup: it's
> been there for a while but doesn't seem to be documented. It looks
> potentially interesting, but I'm not sure what it's supposed to do: a clue?

that dates from the time that we had multiple lua instances (now we have 
only one as it makes no sense to have more) (and it sets the startup 
instance)

it was kept for compatibility but it can go now

i'll remove it

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

