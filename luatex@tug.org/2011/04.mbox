From mojca.miklavec.lists at gmail.com  Fri Apr  1 21:00:57 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 1 Apr 2011 21:00:57 +0200
Subject: [luatex] Don't update to Mac OS X 10.6.7
Message-ID: <AANLkTi=BDm5a+AY=CZA8dyqrkt5zfnDK6SCV1PvMBGWG@mail.gmail.com>

Hello,

I'm sorry for cross-posting, but this issue is a really nasty one (and
might come too late for some). If you use OpenType fonts in your TeX
documents, don't update your Mac OS X unless you want to have some
serious fun with printing ...

http://reviews.cnet.com/8301-13727_7-20048314-263.html
http://discussions.apple.com/thread.jspa?threadID=2792142
http://discussions.apple.com/thread.jspa?threadID=2791830

... a workaround that worked for me (for PostScript printers only) was
the following: I used
      http://localhost:631/help
for help and ended up doing
   lpstat -p
to get printer name and then
   lp -d some_very_weird_printer_name_ myfile.pdf
to send the file to a PostScript printer.

I wasn't sure whether it was an OS issue or LuaTeX issue (I updated
both), but Florian on ntg-context mailing list posted the above links
which most probably makes XeTeX users vulnerable as well.

Mojca

From zappathustra at free.fr  Sat Apr  2 16:16:34 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 02 Apr 2011 16:16:34 +0200
Subject: [luatex] Attributes of font kerns.
Message-ID: <4D972FC2.1030208@free.fr>

Hello all,

The manual (section 2.5.1) notes that some nodes inherit the attributes' 
values of the surrounding nodes, and not the values in force when they 
are created; for instance, ligatures have the values of their 
components, even though ligature nodes are created well after their 
components (in the "ligaturing" callback).

Other `asynchronous' nodes receive the current values; for instance, 
font kern nodes added in the "kerning" callback do not inherit the 
values of the surrounding nodes. However, the manual states (same 
section) that `this area needs studying', and Manuel and I thought it 
would be worth discussing here.

My contribution is that font kerns should behave like ligatures and 
inherit the surrounding values; the resulting horizontal list would be 
more homogenous that way, even though the only area where I can see it 
make a difference is underlining and associates (using attributes to 
determine what should be underlined).

Perhaps some of you have reasons for keeping the font kerns' values in 
line with the current values?
[If you don't, I'll be forced to solemnly petition Taco with a feature 
request.]

Best,
Paul

From elie.roux at telecom-bretagne.eu  Sun Apr  3 09:12:19 2011
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 03 Apr 2011 09:12:19 +0200
Subject: [luatex] Hyphen character in tibetan
Message-ID: <4D981DD3.9080504@telecom-bretagne.eu>

Hello,

I'm typesetting tibetan and I'm facing a problem with hyphenation 
character : in tibetan, there is no space to separate words, instead 
there is a tsheg (?, U+F0B) between all syllables. There is no 
hyphenation character, but all lines are simply broken after any tsheg, 
and the remaining space at the end of the line is filled with other tshegs.

Right now I would only like to break the lines after a tsheg, but I 
cannot manage to do so with LuaTeX. Attached is an example with some 
attempts I made to do it (without any macro), which failed. I also 
attached the pdf with the result if I try to do it with a macro, because 
there are some strange black lines at the end of the lines.

Is there a way to break lines after a tsheg with LuaTeX without any 
macro? Why do these black lines appear? Could there be a way to fill the 
remaining space before the end of a line with other tshegs?

Also, are the non-zero width marks fixed in the ConTeXt code?

Thank you in advance,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tsheg.pdf
Type: video/x-flv
Size: 34237 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110403/3c2751e9/attachment-0001.flv>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tsheg.tex
Type: text/x-tex
Size: 1006 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110403/3c2751e9/attachment-0001.bin>

From dpl at sun.ac.za  Mon Apr  4 09:03:47 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Mon, 4 Apr 2011 09:03:47 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret Lua?
Message-ID: <20110404070346.GA9819@rondloper>

I've managed quite well for several months by writing and debugging 
my Lua code separately and using only "dofile" inside \directlua.
Now I'm trying to do it all inside LuaTeX.

It comes as a shock that

\directlua{ tex.print("\\TeX") }

does not work.  TeX grabs the double-quote and tries to make some
accented character.  I've read to about page 25 of the LuaTeX manual
and it's already way over my head.  The answer, apart from working
with dofile, may be in there but I'm not going to find it soon.

Help please!

Dirk

From luigi.scarso at gmail.com  Mon Apr  4 09:26:46 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 4 Apr 2011 09:26:46 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
	Lua?
In-Reply-To: <20110404070346.GA9819@rondloper>
References: <20110404070346.GA9819@rondloper>
Message-ID: <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>

On Mon, Apr 4, 2011 at 9:03 AM, Dirk Laurie <dpl at sun.ac.za> wrote:
> I've managed quite well for several months by writing and debugging
> my Lua code separately and using only "dofile" inside \directlua.
> Now I'm trying to do it all inside LuaTeX.
>
> It comes as a shock that
>
> \directlua{ tex.print("\\TeX") }
>
> does not work. ?TeX grabs the double-quote and tries to make some
> accented character. ?I've read to about page 25 of the LuaTeX manual
> and it's already way over my head. ?The answer, apart from working
> with dofile, may be in there but I'm not going to find it soon.
>
> Help please!
>
> Dirk
>
what about
\directlua{ tex.print([=[\TeX]=]) }
?
-- 
luigi


From zappathustra at free.fr  Mon Apr  4 09:37:42 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 04 Apr 2011 09:37:42 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
Message-ID: <4D997546.4010100@free.fr>

Le 04/04/2011 09:26, luigi scarso a ?crit :
> On Mon, Apr 4, 2011 at 9:03 AM, Dirk Laurie<dpl at sun.ac.za>  wrote:
>> I've managed quite well for several months by writing and debugging
>> my Lua code separately and using only "dofile" inside \directlua.
>> Now I'm trying to do it all inside LuaTeX.
>>
>> It comes as a shock that
>>
>> \directlua{ tex.print("\\TeX") }
>>
>> does not work.  TeX grabs the double-quote and tries to make some
>> accented character.  I've read to about page 25 of the LuaTeX manual
>> and it's already way over my head.  The answer, apart from working
>> with dofile, may be in there but I'm not going to find it soon.
>>
>> Help please!
>>
>> Dirk
>>
> what about
> \directlua{ tex.print([=[\TeX]=]) }
> ?


It won't work properly either. Let's not forget that \directlua expands 
its argument. In both cases there lacks a \noexpand.
Using \directlua is good for snippets only, otherwise it's not very 
convenient, and you have to change catcodes. Everything (I hope) is 
explained in the Wiki:
http://wiki.luatex.org/index.php/Writing_Lua_in_TeX

Best,
Paul


From luigi.scarso at gmail.com  Mon Apr  4 10:10:00 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 4 Apr 2011 10:10:00 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
	Lua?
In-Reply-To: <4D997546.4010100@free.fr>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
Message-ID: <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>

On Mon, Apr 4, 2011 at 9:37 AM, Paul Isambert <zappathustra at free.fr> wrote:
> Le 04/04/2011 09:26, luigi scarso a ?crit :
>>
>> On Mon, Apr 4, 2011 at 9:03 AM, Dirk Laurie<dpl at sun.ac.za> ?wrote:
>>>
>>> I've managed quite well for several months by writing and debugging
>>> my Lua code separately and using only "dofile" inside \directlua.
>>> Now I'm trying to do it all inside LuaTeX.
>>>
>>> It comes as a shock that
>>>
>>> \directlua{ tex.print("\\TeX") }
>>>
>>> does not work. ?TeX grabs the double-quote and tries to make some
>>> accented character. ?I've read to about page 25 of the LuaTeX manual
>>> and it's already way over my head. ?The answer, apart from working
>>> with dofile, may be in there but I'm not going to find it soon.
>>>
>>> Help please!
>>>
>>> Dirk
>>>
>> what about
>> \directlua{ tex.print([=[\TeX]=]) }
>> ?
>
>
> It won't work properly either. Let's not forget that \directlua expands its
> argument. In both cases there lacks a \noexpand.
> Using \directlua is good for snippets only, otherwise it's not very
> convenient, and you have to change catcodes. Everything (I hope) is
> explained in the Wiki:
> http://wiki.luatex.org/index.php/Writing_Lua_in_TeX

hm,

\directlua{ tex.print([=[\TeX]=]) }
\directlua{ tex.print(string.char(92,84,101,88)) }
\directlua{ tex.print(string.char(92).."TeX") }

produce correctly the same \TeX logo with luatex fmt from minimals.

But I must admit that as context user I seldom give attention to this
low level questions.
I was surprised by the mail of Dirk, because I have not  accented
characters, but an error

! Argument of \\ has an extra }.

\directlua{ tex.print("\TeX") }
gives  the meaning of
the \TeX macro, i.e
Tkern -.1667emlower .5exhbox Ekern -.125emX



-- 
luigi


From zappathustra at free.fr  Mon Apr  4 10:25:03 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 04 Apr 2011 10:25:03 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
Message-ID: <4D99805F.3010808@free.fr>

Le 04/04/2011 10:10, luigi scarso a ?crit :
> On Mon, Apr 4, 2011 at 9:37 AM, Paul Isambert<zappathustra at free.fr>  wrote:
>> Le 04/04/2011 09:26, luigi scarso a ?crit :
>>> On Mon, Apr 4, 2011 at 9:03 AM, Dirk Laurie<dpl at sun.ac.za>    wrote:
>>>> I've managed quite well for several months by writing and debugging
>>>> my Lua code separately and using only "dofile" inside \directlua.
>>>> Now I'm trying to do it all inside LuaTeX.
>>>>
>>>> It comes as a shock that
>>>>
>>>> \directlua{ tex.print("\\TeX") }
>>>>
>>>> does not work.  TeX grabs the double-quote and tries to make some
>>>> accented character.  I've read to about page 25 of the LuaTeX manual
>>>> and it's already way over my head.  The answer, apart from working
>>>> with dofile, may be in there but I'm not going to find it soon.
>>>>
>>>> Help please!
>>>>
>>>> Dirk
>>>>
>>> what about
>>> \directlua{ tex.print([=[\TeX]=]) }
>>> ?
>>
>> It won't work properly either. Let's not forget that \directlua expands its
>> argument. In both cases there lacks a \noexpand.
>> Using \directlua is good for snippets only, otherwise it's not very
>> convenient, and you have to change catcodes. Everything (I hope) is
>> explained in the Wiki:
>> http://wiki.luatex.org/index.php/Writing_Lua_in_TeX
> hm,
>
> \directlua{ tex.print([=[\TeX]=]) }
> \directlua{ tex.print(string.char(92,84,101,88)) }
> \directlua{ tex.print(string.char(92).."TeX") }
>
> produce correctly the same \TeX logo with luatex fmt from minimals.

Yes, because \TeX expands to harmless primitives (\kern, etc.), so 
tex.print actually sees is something like "T\kern-.1.667em....". Try 
replacing tex.print with texio.write_nl and you'll see. In other cases, 
though, expansion should be carefully controlled.

> But I must admit that as context user I seldom give attention to this
> low level questions.
> I was surprised by the mail of Dirk, because I have not  accented
> characters, but an error
>
> ! Argument of \\ has an extra }.

That's what I have too. Don't know where Dirk's accent comes from, I 
suspect there's a misunderstanding.

> \directlua{ tex.print("\TeX") }
> gives  the meaning of
> the \TeX macro, i.e
> Tkern -.1667emlower .5exhbox Ekern -.125emX

Yes, that's what I've said above, but here escape characters aren't 
ignored (as in your version with [=[...]=]), so Lua processes a string 
with things like "\k", which doesn't make sense (unlike e.g. "\n"), and 
is apparently normalized to "k".

Best,
Paul

From dpl at sun.ac.za  Mon Apr  4 10:29:20 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Mon, 4 Apr 2011 10:29:20 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <4D997546.4010100@free.fr>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
Message-ID: <20110404082920.GA9859@rondloper>

On Mon, Apr 04, 2011 at 09:37:42AM +0200, Paul Isambert wrote:
> Using \directlua is good for snippets only, otherwise it's not very 
> convenient, and you have to change catcodes. Everything (I hope) is 
> explained in the Wiki:
> http://wiki.luatex.org/index.php/Writing_Lua_in_TeX

That's pure gold.  Thanks a lot.

It would be nice if www.luatex.org (which is where the manual says one 
should go for more information) had a link to wiki.luatex.org, if not
on the main page, then at least on the support and faq pages.  Or the 
manual itself might even mention the Wiki.

Dirk


From dpl at sun.ac.za  Mon Apr  4 10:36:36 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Mon, 4 Apr 2011 10:36:36 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <4D99805F.3010808@free.fr>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr>
Message-ID: <20110404083636.GB9859@rondloper>

On Mon, Apr 04, 2011 at 10:25:03AM +0200, Paul Isambert wrote:
> 
> That's what I have too. Don't know where Dirk's accent comes from, I 
> suspect there's a misunderstanding.
> 
That was my attempt to make sense of

! Undefined control sequence.
\\  ->\let \reserved at e 
                       \relax \let \reserved at f \relax \@ifstar {\let \reserv...

But don't worry, the excellent Wiki article allows me to relax
on my reserved seat.

Dirk

From luigi.scarso at gmail.com  Mon Apr  4 11:40:34 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 4 Apr 2011 11:40:34 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
	Lua?
In-Reply-To: <4D99805F.3010808@free.fr>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr>
Message-ID: <BANLkTim5F0QNU8oiFUuHmzUu1j2AfE8YWA@mail.gmail.com>

On Mon, Apr 4, 2011 at 10:25 AM, Paul Isambert <zappathustra at free.fr> wrote:

>
> Yes, because \TeX expands to harmless primitives (\kern, etc.), so tex.print
> actually sees is something like "T\kern-.1.667em....". Try replacing
> tex.print with texio.write_nl and you'll see. In other cases, though,
> expansion should be carefully controlled.

True, in fact I though that one can replace
<<text>>
with
\directlua{tex.print( [=[<<text>>]=])}
assuming ASCII and the same catcode regime
but it's not true, even if I don't understand clearly why.


\bgroup
\initcatcodetable1
\catcode`\_=0
_TeX\TeX
\savecatcodetable1
\egroup

%% ok
\directlua{tex.print(1, [=[_TeX\relax\TeX]=])}

%% ok
\directlua{tex.print(1, [=[_TeX{}\TeX]=])}

%% ok
\directlua{tex.print(1, [=[_TeX \TeX]=])}


%% wrong
%% \directlua{tex.print(1, [=[_TeX\TeX]=])}
%% ! Undefined control sequence.
%% l.1 _TeXT
%%         \kern


%ok (32 is space)
\directlua{ tex.print(1,string.char(95,84,101,88,
                                    32,
                                    92,84,101,88)) }


%% ok ... why ??
\directlua{ tex.print(1,string.char(95,84,101,88,
                                    92,84,101,88)) }

\bye


-- 
luigi

From reinhard.kotucha at web.de  Mon Apr  4 14:20:38 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 4 Apr 2011 14:20:38 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <20110404083636.GB9859@rondloper>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr> <20110404083636.GB9859@rondloper>
Message-ID: <19865.46998.781361.172629@zaphod.ms25.net>

On 2011-04-04 at 10:36:36 +0200, Dirk Laurie wrote:

 > On Mon, Apr 04, 2011 at 10:25:03AM +0200, Paul Isambert wrote:
 > > 
 > > That's what I have too. Don't know where Dirk's accent comes from, I 
 > > suspect there's a misunderstanding.
 > > 
 > That was my attempt to make sense of
 > 
 > ! Undefined control sequence.
 > \\  ->\let \reserved at e 
 >                        \relax \let \reserved at f \relax \@ifstar {\let \reserv...
 > 
 > But don't worry, the excellent Wiki article allows me to relax
 > on my reserved seat.

You are obviously using LaTeX.  The luacode package is quite useful
then too.  Here is a tiny demo file:

   http://tug.org/~kotucha/luatab.pdf

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Mon Apr  4 15:36:40 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 04 Apr 2011 15:36:40 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
 Lua?
In-Reply-To: <BANLkTim5F0QNU8oiFUuHmzUu1j2AfE8YWA@mail.gmail.com>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr>
 <BANLkTim5F0QNU8oiFUuHmzUu1j2AfE8YWA@mail.gmail.com>
Message-ID: <4D99C968.7040901@free.fr>



Le 04/04/2011 11:40, luigi scarso a ?crit :
> On Mon, Apr 4, 2011 at 10:25 AM, Paul Isambert<zappathustra at free.fr>  wrote:
>
>> Yes, because \TeX expands to harmless primitives (\kern, etc.), so tex.print
>> actually sees is something like "T\kern-.1.667em....". Try replacing
>> tex.print with texio.write_nl and you'll see. In other cases, though,
>> expansion should be carefully controlled.
> True, in fact I though that one can replace
> <<text>>
> with
> \directlua{tex.print( [=[<<text>>]=])}
> assuming ASCII and the same catcode regime
> but it's not true, even if I don't understand clearly why.
>
>
> \bgroup
> \initcatcodetable1
> \catcode`\_=0
> _TeX\TeX
> \savecatcodetable1
> \egroup
>
> %% ok
> \directlua{tex.print(1, [=[_TeX\relax\TeX]=])}
>
> %% ok
> \directlua{tex.print(1, [=[_TeX{}\TeX]=])}
>
> %% ok
> \directlua{tex.print(1, [=[_TeX \TeX]=])}
>
>
> %% wrong
> %% \directlua{tex.print(1, [=[_TeX\TeX]=])}
> %% ! Undefined control sequence.
> %% l.1 _TeXT
> %%         \kern

Quite normal: \TeX is expanded in \directlua to "T\kern1.6667em etc.", 
so the string that is passed to the Lua interpreter and then back to TeX 
is "_TeXT\kern1.6667em etc." The underscore being an escape character 
here, _TeXT is an (unexisting) control sequence. Try:

\directlua{tex.print(1, [=[_TeX\noexpand\TeX]=])}

and \TeX will remain as it is, and the string passed back from Lua to 
TeX will be "_TeX\TeX", hence no error.

>
> %ok (32 is space)
> \directlua{ tex.print(1,string.char(95,84,101,88,
>                                      32,
>                                      92,84,101,88)) }
>
>
> %% ok ... why ??
> \directlua{ tex.print(1,string.char(95,84,101,88,
>                                      92,84,101,88)) }

Because nothing is expanded here. Instead, Lua passes to TeX a string 
made of _, T, e, X, \, T, e, X, and that's simply two control sequences 
in a row.

Best,
Paul

From luigi.scarso at gmail.com  Mon Apr  4 16:07:28 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 4 Apr 2011 16:07:28 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
	Lua?
In-Reply-To: <4D99C968.7040901@free.fr>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr>
 <BANLkTim5F0QNU8oiFUuHmzUu1j2AfE8YWA@mail.gmail.com>
 <4D99C968.7040901@free.fr>
Message-ID: <BANLkTi=jOQt+S=0rp2dgaCcRx9m8QPwQeQ@mail.gmail.com>

On Mon, Apr 4, 2011 at 3:36 PM, Paul Isambert <zappathustra at free.fr> wrote:
>
>
> Le 04/04/2011 11:40, luigi scarso a ?crit :
>>
>> On Mon, Apr 4, 2011 at 10:25 AM, Paul Isambert<zappathustra at free.fr>
>> ?wrote:
>>
>>> Yes, because \TeX expands to harmless primitives (\kern, etc.), so
>>> tex.print
>>> actually sees is something like "T\kern-.1.667em....". Try replacing
>>> tex.print with texio.write_nl and you'll see. In other cases, though,
>>> expansion should be carefully controlled.
>>
>> True, in fact I though that one can replace
>> <<text>>
>> with
>> \directlua{tex.print( [=[<<text>>]=])}
>> assuming ASCII and the same catcode regime
>> but it's not true, even if I don't understand clearly why.
>>
>>
>> \bgroup
>> \initcatcodetable1
>> \catcode`\_=0
>> _TeX\TeX
>> \savecatcodetable1
>> \egroup
>>
>> %% ok
>> \directlua{tex.print(1, [=[_TeX\relax\TeX]=])}
>>
>> %% ok
>> \directlua{tex.print(1, [=[_TeX{}\TeX]=])}
>>
>> %% ok
>> \directlua{tex.print(1, [=[_TeX \TeX]=])}
>>
>>
>> %% wrong
>> %% \directlua{tex.print(1, [=[_TeX\TeX]=])}
>> %% ! Undefined control sequence.
>> %% l.1 _TeXT
>> %% ? ? ? ? \kern
>
> Quite normal: \TeX is expanded in \directlua to "T\kern1.6667em etc.", so
> the string that is passed to the Lua interpreter and then back to TeX is
> "_TeXT\kern1.6667em etc." The underscore being an escape character here,
> _TeXT is an (unexisting) control sequence. Try:
>
> \directlua{tex.print(1, [=[_TeX\noexpand\TeX]=])}
>
> and \TeX will remain as it is, and the string passed back from Lua to TeX
> will be "_TeX\TeX", hence no error.


Sorry, wrong example. I wrote
>> assuming ASCII and the same catcode regime
so the code correct code should be

\bgroup
\catcode `\_=0
_TeX\TeX

\directlua{tex.print([=[_TeX\TeX]=])}
\egroup

\bye

In this sense
<<text>>
and
\directlua{tex.print([=[<<text>>]=])}
should always be the same .

-- 
luigi


From luigi.scarso at gmail.com  Mon Apr  4 16:53:07 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 4 Apr 2011 16:53:07 +0200
Subject: [luatex] Newbie question: how to stop TeX trying to interpret
	Lua?
In-Reply-To: <BANLkTi=jOQt+S=0rp2dgaCcRx9m8QPwQeQ@mail.gmail.com>
References: <20110404070346.GA9819@rondloper>
 <BANLkTimT==5s7SS_k9hS7yBpukcutRctCQ@mail.gmail.com>
 <4D997546.4010100@free.fr>
 <BANLkTin2hM=0tgMcRWhJ4Ay3tn+U4Vb9dg@mail.gmail.com>
 <4D99805F.3010808@free.fr>
 <BANLkTim5F0QNU8oiFUuHmzUu1j2AfE8YWA@mail.gmail.com>
 <4D99C968.7040901@free.fr>
 <BANLkTi=jOQt+S=0rp2dgaCcRx9m8QPwQeQ@mail.gmail.com>
Message-ID: <BANLkTi=EAAFUAKSNK4PK1Jo2TT-s23zNhA@mail.gmail.com>

On Mon, Apr 4, 2011 at 4:07 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> In this sense
> <<text>>
> and
> \directlua{tex.print([=[<<text>>]=])}
> should always be the same .
Of course no:

\bgroup
\catcode `\_=0
\catcode `\[=0
_TeX\TeX[TeX

%error
%\directlua{tex.print([=[_TeX\TeX]=])}
\egroup

\bye



-- 
luigi

From heiko.oberdiek at googlemail.com  Mon Apr  4 18:14:14 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Mon, 4 Apr 2011 18:14:14 +0200
Subject: [luatex] string.char
Message-ID: <20110404161414.GA9856@oberdiek.my-fqdn.de>

Hello,

I have some obscure problem with string.char:

% luatex -ini
\catcode`\{=1
\catcode`\}=2
\newlinechar=-1

\directlua{tex.settoks(0, string.char(65, 0, 66))}
\message{\the\toks0}

\csname @@end\endcsname\end


As result I expect "A^^@B", but I get "A^^@^^@".
All bytes after the first zero are ^^@ (zero byte).

Tested with luatex 0.60.2 and 0.65.0.

What I am missing?

Yours sincerely
  Heiko Oberdiek

From zappathustra at free.fr  Mon Apr  4 18:32:58 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 04 Apr 2011 18:32:58 +0200
Subject: [luatex] string.char
In-Reply-To: <20110404161414.GA9856@oberdiek.my-fqdn.de>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
Message-ID: <4D99F2BA.3060509@free.fr>

Le 04/04/2011 18:14, Heiko Oberdiek a ?crit :
> Hello,
>
> I have some obscure problem with string.char:
>
> % luatex -ini
> \catcode`\{=1
> \catcode`\}=2
> \newlinechar=-1
>
> \directlua{tex.settoks(0, string.char(65, 0, 66))}
> \message{\the\toks0}
>
> \csname @@end\endcsname\end
>
>
> As result I expect "A^^@B", but I get "A^^@^^@".
> All bytes after the first zero are ^^@ (zero byte).
>
> Tested with luatex 0.60.2 and 0.65.0.

No answer, but an additional observation: LuaTeX 0.66 (rev. 4087) with 
your code complains about an invalid UTF-8 sequence and then prints 
"A^^@" followed by some gibberish. But if I simply add another 65 before 
the 0, then it doesn't complain, but prints AA^^@^^@. That smells like bug.

Best,
Paul

From heiko.oberdiek at googlemail.com  Mon Apr  4 20:33:34 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Mon, 4 Apr 2011 20:33:34 +0200
Subject: [luatex] string.char
In-Reply-To: <4D99F2BA.3060509@free.fr>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr>
Message-ID: <20110404183333.GA10416@oberdiek.my-fqdn.de>

On Mon, Apr 04, 2011 at 06:32:58PM +0200, Paul Isambert wrote:

> Le 04/04/2011 18:14, Heiko Oberdiek a ?crit :
> >Hello,
> >
> >I have some obscure problem with string.char:
> >
> >% luatex -ini
> >\catcode`\{=1
> >\catcode`\}=2
> >\newlinechar=-1
> >
> >\directlua{tex.settoks(0, string.char(65, 0, 66))}
> >\message{\the\toks0}
> >
> >\csname @@end\endcsname\end
> >
> >
> >As result I expect "A^^@B", but I get "A^^@^^@".
> >All bytes after the first zero are ^^@ (zero byte).
> >
> >Tested with luatex 0.60.2 and 0.65.0.
> 
> No answer, but an additional observation: LuaTeX 0.66 (rev. 4087)
> with your code complains about an invalid UTF-8 sequence and then
> prints "A^^@" followed by some gibberish. But if I simply add
> another 65 before the 0, then it doesn't complain, but prints
> AA^^@^^@. That smells like bug.

Further addition:
  \message{\directlua{tex.print(string.char(65, 0, 66))}}
works, but
  \directlua{tex.settoks(0, "A\string\000B")}
has the wrong result "A^^@^^X", thus I conclude that
tex.settoks might be the problem.

Yours sincerely
  Heiko Oberdiek

From zappathustra at free.fr  Mon Apr  4 22:01:21 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 04 Apr 2011 22:01:21 +0200
Subject: [luatex] string.char
In-Reply-To: <20110404183333.GA10416@oberdiek.my-fqdn.de>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr> <20110404183333.GA10416@oberdiek.my-fqdn.de>
Message-ID: <4D9A2391.9090003@free.fr>

Le 04/04/2011 20:33, Heiko Oberdiek a ?crit :
> On Mon, Apr 04, 2011 at 06:32:58PM +0200, Paul Isambert wrote:
>
>> Le 04/04/2011 18:14, Heiko Oberdiek a ?crit :
>>> Hello,
>>>
>>> I have some obscure problem with string.char:
>>>
>>> % luatex -ini
>>> \catcode`\{=1
>>> \catcode`\}=2
>>> \newlinechar=-1
>>>
>>> \directlua{tex.settoks(0, string.char(65, 0, 66))}
>>> \message{\the\toks0}
>>>
>>> \csname @@end\endcsname\end
>>>
>>>
>>> As result I expect "A^^@B", but I get "A^^@^^@".
>>> All bytes after the first zero are ^^@ (zero byte).
>>>
>>> Tested with luatex 0.60.2 and 0.65.0.
>> No answer, but an additional observation: LuaTeX 0.66 (rev. 4087)
>> with your code complains about an invalid UTF-8 sequence and then
>> prints "A^^@" followed by some gibberish. But if I simply add
>> another 65 before the 0, then it doesn't complain, but prints
>> AA^^@^^@. That smells like bug.
> Further addition:
>    \message{\directlua{tex.print(string.char(65, 0, 66))}}
> works, but
>    \directlua{tex.settoks(0, "A\string\000B")}
> has the wrong result "A^^@^^X", thus I conclude that
> tex.settoks might be the problem.

So it seems you've found yourself a nice bug to report :)
I say so because I don't think Taco is reading the list much these 
times, so a tracker item would be safer.

Best,
Paul

From taco at elvenkind.com  Tue Apr  5 10:49:00 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 05 Apr 2011 10:49:00 +0200
Subject: [luatex] string.char
In-Reply-To: <4D9A2391.9090003@free.fr>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr> <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr>
Message-ID: <4D9AD77C.9060902@elvenkind.com>

On 04/04/2011 10:01 PM, Paul Isambert wrote:
>> \directlua{tex.settoks(0, "A\string\000B")}
>> has the wrong result "A^^@^^X", thus I conclude that
>> tex.settoks might be the problem.
>
> So it seems you've found yourself a nice bug to report :)
> I say so because I don't think Taco is reading the list much these
> times, so a tracker item would be safer.

I actually do read the list, but usually have no time to reply these
days.

In this case, the problem is indeed the settoks as that used
strdup() to get the needed memory (and therefore stops at the
first \000). There was a simple fix, so I have applied something
immediately. If you can, please try rev. 4096.

Best wishes,
Taco

From zappathustra at free.fr  Tue Apr  5 11:31:50 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 05 Apr 2011 11:31:50 +0200
Subject: [luatex] string.char
In-Reply-To: <4D9AD77C.9060902@elvenkind.com>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr> <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
Message-ID: <4D9AE186.1060701@free.fr>

Le 05/04/2011 10:49, Taco Hoekwater a ?crit :
> On 04/04/2011 10:01 PM, Paul Isambert wrote:
>>> \directlua{tex.settoks(0, "A\string\000B")}
>>> has the wrong result "A^^@^^X", thus I conclude that
>>> tex.settoks might be the problem.
>>
>> So it seems you've found yourself a nice bug to report :)
>> I say so because I don't think Taco is reading the list much these
>> times, so a tracker item would be safer.
>
> I actually do read the list, but usually have no time to reply these
> days.
>
> In this case, the problem is indeed the settoks as that used
> strdup() to get the needed memory (and therefore stops at the
> first \000). There was a simple fix, so I have applied something
> immediately. If you can, please try rev. 4096.

It works very well: tested with tex.settoks(0, string.char(65, 0, 66) 
and tex.settoks(0, "A\string\000B"), both return "A^^@B".
Thanks,
Paul

From taco at elvenkind.com  Mon Apr 11 11:01:55 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 11 Apr 2011 11:01:55 +0200
Subject: [luatex] Attributes of font kerns.
In-Reply-To: <4D972FC2.1030208@free.fr>
References: <4D972FC2.1030208@free.fr>
Message-ID: <4DA2C383.2030507@elvenkind.com>


Hi Paul,

On 04/02/2011 04:16 PM, Paul Isambert wrote:
>
> Perhaps some of you have reasons for keeping the font kerns' values in
> line with the current values?
> [If you don't, I'll be forced to solemnly petition Taco with a feature
> request.]

Revision 4121 should now make font kerns inherit from the left 'parent'.
Can you test that please? TIA,

Taco

From zappathustra at free.fr  Mon Apr 11 18:21:27 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 11 Apr 2011 18:21:27 +0200
Subject: [luatex] Attributes of font kerns.
In-Reply-To: <4DA2C383.2030507@elvenkind.com>
References: <4D972FC2.1030208@free.fr> <4DA2C383.2030507@elvenkind.com>
Message-ID: <4DA32A87.8050606@free.fr>

Le 11/04/2011 11:01, Taco Hoekwater a ?crit :
> On 04/02/2011 04:16 PM, Paul Isambert wrote:
>>
>> Perhaps some of you have reasons for keeping the font kerns' values in
>> line with the current values?
>> [If you don't, I'll be forced to solemnly petition Taco with a feature
>> request.]
>
> Revision 4121 should now make font kerns inherit from the left 'parent'.
> Can you test that please?

It works perfectly.

Thank you, and thanks for the other bug fixes too (sorry for #591, I 
must have confused the return values of node.remove and table.remove), 
and thanks to Hartmut too for his updates, and, well... anybody else?
Paul


From rdt at cs.queensu.ca  Tue Apr 12 01:33:43 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Mon, 11 Apr 2011 19:33:43 -0400
Subject: [luatex] invoking a lua script in TeX
Message-ID: <4da38fd7.MlRG00FArcPPMJfi%rdt@cs.queensu.ca>

Hi. I'm trying to integrate a three-pass process into a single luatex
process. I believe \directlua and tex.print or some variant can provide
the desired functionality but I'm not a TeX expert and the documentation
I've seen so far doesn't seem to be directly relevant. I'd be very
grateful for some assistance or pointers to relevant documentation.

The current work flow is as follows:

1. tex basename.tex 
  produces a dvi file etc. as usual plus a data file basename.mx1

2. musixflx basename
  reads basename.mx1, does some calculations, and outputs basename.mx2

3. tex basename (in the presence of basename.mx2)
  reads basename.mx2 and produces a modified dvi etc.

Traditionally, musixflx has been a platform-dependent binary compiled
from source code in C. But recently, musiflx.c has been translated to
a functionally equivalent musixflx.lua; that is, the second pass can be
achieved by

  lua musixflx.lua basename

musixflx.lua is the script I hope can be invoked from within a TeX
macro package after generation of the .mx1 file; then, I would want to
re-invoke TeX from the Lua script after generation of the .mx2 file.

It might be possible and/or desirable not to have to use auxiliary files
basename.mx1 and basename.mx2, but I would consider that a refinement
that could be deferred if it is problematic.

Thanks for any help you could provide.

Bob Tennent

From taco at elvenkind.com  Tue Apr 12 09:24:56 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 12 Apr 2011 09:24:56 +0200
Subject: [luatex] invoking a lua script in TeX
In-Reply-To: <4da38fd7.MlRG00FArcPPMJfi%rdt@cs.queensu.ca>
References: <4da38fd7.MlRG00FArcPPMJfi%rdt@cs.queensu.ca>
Message-ID: <4DA3FE48.2080305@elvenkind.com>


Hi,

On 04/12/2011 01:33 AM, Bob Tennent wrote:
>
> musixflx.lua is the script I hope can be invoked from within a TeX
> macro package after generation of the .mx1 file; then, I would want to
> re-invoke TeX from the Lua script after generation of the .mx2 file.
>
> It might be possible and/or desirable not to have to use auxiliary files
> basename.mx1 and basename.mx2, but I would consider that a refinement
> that could be deferred if it is problematic.

That would mean that musixflx.lua needs some small adjustments. A 
function that takes an input string and returns an output string instead 
of writing to a file is needed. But that is not a hard change in itself, 
so there is no need to worry about that right away.

If you want to do all the processing in one pass, then basically each 
\endmusic has to 'everything': it has to create a full .mx1 file, make 
musixflx process that file, and read the .mx2 file to feed it back to 
luatex. You have to do the musixflx processing in snippets since 
otherwise the .mx1 file will not be finished until the end of the run, 
and at that stage a second tex pass is definitely required (since it is 
impossible to change already generated pages).

You will need some support from musixtex itself, as one has to make sure 
that each of the snippets uses the right global settings. Also, if 
musixflx does any document-wide optimizations, this functionality will 
be lost if you want a single pass.

Best wishes,
Taco

From heiko.oberdiek at googlemail.com  Tue Apr 12 11:05:29 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Tue, 12 Apr 2011 11:05:29 +0200
Subject: [luatex] string.char
In-Reply-To: <4D9AE186.1060701@free.fr>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr>
 <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr>
Message-ID: <20110412090529.GA12337@oberdiek.my-fqdn.de>

On Tue, Apr 05, 2011 at 11:31:50AM +0200, Paul Isambert wrote:

> Le 05/04/2011 10:49, Taco Hoekwater a ?crit :
> >On 04/04/2011 10:01 PM, Paul Isambert wrote:
> >>>\directlua{tex.settoks(0, "A\string\000B")}
> >>>has the wrong result "A^^@^^X", thus I conclude that
> >>>tex.settoks might be the problem.
> >>
> >>So it seems you've found yourself a nice bug to report :)
> >>I say so because I don't think Taco is reading the list much these
> >>times, so a tracker item would be safer.
> >
> >I actually do read the list, but usually have no time to reply these
> >days.
> >
> >In this case, the problem is indeed the settoks as that used
> >strdup() to get the needed memory (and therefore stops at the
> >first \000). There was a simple fix, so I have applied something
> >immediately. If you can, please try rev. 4096.
> 
> It works very well: tested with tex.settoks(0, string.char(65, 0,
> 66) and tex.settoks(0, "A\string\000B"), both return "A^^@B".

Thanks Taco and Paul for fixing and testing.
In package pdftexcmds that emulates \pdfescape... for LuaTeX
I have now added a workaround for the problematic versions
(0.41?, ..., 0.65).
  The endpoint would be revision 4096, but status.luatex_svn
does not work always as expected:

\catcode`\{=1
\catcode`\}=2
\catcode`\#=6
\def\test#1{%
  \immediate\write16{%
    [#1: \directlua{tex.write(status.luatex_#1)}]%
  }%
}
\test{svn}
\test{version}
\test{revision}
\csname @@end\endcsname\end

Result for TL2010:
  [svn: 3736]
  [version: 60]
  [revision: 2]

Result for luatex 0.65.0 from ConTeXt minimals:
  [svn: -1]
  [version: 65]
  [revision: 0]

Yours sincerely
  Heiko Oberdiek

From taco at elvenkind.com  Tue Apr 12 11:05:21 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 12 Apr 2011 11:05:21 +0200
Subject: [luatex] string.char
In-Reply-To: <20110412090529.GA12337@oberdiek.my-fqdn.de>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr> <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr> <20110412090529.GA12337@oberdiek.my-fqdn.de>
Message-ID: <4DA415D1.90407@elvenkind.com>

On 04/12/2011 11:05 AM, Heiko Oberdiek wrote:
> On Tue, Apr 05, 2011 at 11:31:50AM +0200, Paul Isambert wrote:
>
>> Le 05/04/2011 10:49, Taco Hoekwater a ?crit :
>>> On 04/04/2011 10:01 PM, Paul Isambert wrote:
>>>>> \directlua{tex.settoks(0, "A\string\000B")}
>>>>> has the wrong result "A^^@^^X", thus I conclude that
>>>>> tex.settoks might be the problem.
>>>>
>>>> So it seems you've found yourself a nice bug to report :)
>>>> I say so because I don't think Taco is reading the list much these
>>>> times, so a tracker item would be safer.
>>>
>>> I actually do read the list, but usually have no time to reply these
>>> days.
>>>
>>> In this case, the problem is indeed the settoks as that used
>>> strdup() to get the needed memory (and therefore stops at the
>>> first \000). There was a simple fix, so I have applied something
>>> immediately. If you can, please try rev. 4096.
>>
>> It works very well: tested with tex.settoks(0, string.char(65, 0,
>> 66) and tex.settoks(0, "A\string\000B"), both return "A^^@B".
>
> Thanks Taco and Paul for fixing and testing.

> In package pdftexcmds that emulates \pdfescape... for LuaTeX
> I have now added a workaround for the problematic versions
> (0.41?, ..., 0.65).
>    The endpoint would be revision 4096, but status.luatex_svn
> does not work always as expected:
>
> \catcode`\{=1
> \catcode`\}=2
> \catcode`\#=6
> \def\test#1{%
>    \immediate\write16{%
>      [#1: \directlua{tex.write(status.luatex_#1)}]%
>    }%
> }
> \test{svn}
> \test{version}
> \test{revision}
> \csname @@end\endcsname\end
>
> Result for TL2010:
>    [svn: 3736]
>    [version: 60]
>    [revision: 2]
>
> Result for luatex 0.65.0 from ConTeXt minimals:
>    [svn: -1]
>    [version: 65]
>    [revision: 0]

That is a build problem in the minimals that I have to talk to Mojca 
about. luatex 0.66.0 is the first version that officially fixes the 
problem (to be released after lunch).

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Tue Apr 12 11:30:48 2011
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 12 Apr 2011 11:30:48 +0200
Subject: [luatex] Hyphen character in tibetan
In-Reply-To: <4D981DD3.9080504@telecom-bretagne.eu>
References: <4D981DD3.9080504@telecom-bretagne.eu>
Message-ID: <4DA41BC8.90905@telecom-bretagne.eu>

Hello,

does anyone know the solution to this problem? Is it possible to have 
lines broken after a certain character and the keep this character at 
the end of the lines? With \exhyphenchar or something? (\exhyphenchar 
doesn't do that anymore)

Or is it possible to write a quite simple macro for it without 
registering something in the hyphenation callback?

Thank you,
-- 
Elie

From dpl at sun.ac.za  Tue Apr 12 11:57:49 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Tue, 12 Apr 2011 11:57:49 +0200
Subject: [luatex] invoking a lua script in TeX
In-Reply-To: <4da38fd7.MlRG00FArcPPMJfi%rdt@cs.queensu.ca>
References: <4da38fd7.MlRG00FArcPPMJfi%rdt@cs.queensu.ca>
Message-ID: <20110412095749.GA13168@rondloper>

On Tue, Apr 12, 2011 at 01:33:43AM +0200, Bob Tennent wrote:
> Hi. I'm trying to integrate a three-pass process into a single luatex
> process. I believe \directlua and tex.print or some variant can provide
> the desired functionality but I'm not a TeX expert and the documentation
> I've seen so far doesn't seem to be directly relevant. I'd be very
> grateful for some assistance or pointers to relevant documentation.
>
    http://wiki.luatex.org/index.php/Writing_Lua_in_TeX

> 
> It might be possible and/or desirable not to have to use auxiliary files
> basename.mx1 and basename.mx2, but I would consider that a refinement
> that could be deferred if it is problematic.
> 
> Thanks for any help you could provide.

\def\musixflex{ \ifx\undefined\directlua \else \directlua { 
        musixflx = kpse.find_file("musixflx.lua")
        if musixflx then dofile(musixflx) end } \fi }

If you put \musixflex immediately after \endmuflex in your
TeX file, and you are processing the file with luatex, and 
musixflx.lua is somewhere in your TeX path, then musixflx.lua
will be run on your file.  This reduces the three-pass process
to a two-pass process.

It should be possible to incorporate this macro call somewhere
in musixtex.tex.

Dirk

From rdt at cs.queensu.ca  Tue Apr 12 13:33:24 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Tue, 12 Apr 2011 07:33:24 -0400
Subject: [luatex] invoking a lua script in TeX
Message-ID: <4da43884.qnXZgvDeX/NxzKAL%rdt@cs.queensu.ca>

Dirk:

I've added 

\ifx\undefined\directlua \else \directlua { 
   musixflx = kpse.find_file("musixflx.lua")
   dofile(musixflx)}%
\fi% 

to the definition of \endmuflex and it basically works. But when I add
an assignment to the lua code as follows:

\ifx\undefined\directlua \else \directlua { 
   name_of_file = \jobname 
   musixflx = kpse.find_file("musixflx.lua")
   dofile(musixflx)}%
\fi% 

it no longer works. According to "Writing Lua in TeX" at the luatex
wiki, I need to set \endlinechar=10 or \catcode`\^^M=12 but where?

Bob

From zappathustra at free.fr  Tue Apr 12 13:39:51 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 12 Apr 2011 13:39:51 +0200
Subject: [luatex] invoking a lua script in TeX
In-Reply-To: <4da43884.qnXZgvDeX/NxzKAL%rdt@cs.queensu.ca>
References: <4da43884.qnXZgvDeX/NxzKAL%rdt@cs.queensu.ca>
Message-ID: <4DA43A07.70702@free.fr>

Le 12/04/2011 13:33, Bob Tennent a ?crit :
> Dirk:
>
> I've added
>
> \ifx\undefined\directlua \else \directlua {
>     musixflx = kpse.find_file("musixflx.lua")
>     dofile(musixflx)}%
> \fi%
>
> to the definition of \endmuflex and it basically works. But when I add
> an assignment to the lua code as follows:
>
> \ifx\undefined\directlua \else \directlua {
>     name_of_file = \jobname
>     musixflx = kpse.find_file("musixflx.lua")
>     dofile(musixflx)}%
> \fi%

Here you'd better use the Lua equivalent of \jobname:
name_of_file = tex.jobname

Otherwise, you could have added a space by hand:
\def\space{ }
...
name_of_file = \jobname\space

Changing catcodes is part of a larger strategy that wouldn't work in the 
definition of a macro.

Best,
Paul



From rdt at cs.queensu.ca  Tue Apr 12 14:22:41 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Tue, 12 Apr 2011 08:22:41 -0400
Subject: [luatex] invoking a lua script in TeX
Message-ID: <4da44411.WsE21OlZcjmkd8RS%rdt@cs.queensu.ca>


> Here you'd better use the Lua equivalent of \jobname:
> name_of_file = tex.jobname

Thanks Dirk and Paul.  That's the first two passes merged.
I may just leave it at that; TeX users are used to running
TeX or LaTeX twice.

Bob T.

From taco at elvenkind.com  Tue Apr 12 14:29:36 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 12 Apr 2011 14:29:36 +0200
Subject: [luatex] Luatex 0.66.0 announcement
Message-ID: <4DA445B0.2040006@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.66.0.

This release has ongoing work on the 'epdf' lua interface by
Hartmut (and that interface now has documentation as well). Besides
that, the release fixes a number of the bugs that have been reported
over the past months (mostly the smaller/easier ones).

Luatex 0.66.0 will be the last release in the 0.6X series. The next
release will be luatex 0.70.0;that will be the version on texlive 2011.

Expect no major differences there either, the tracker has just
a few items remaining for 0.70.0. Over the last half year, I personally
have been much too busy with MetaPost to do any real work on luatex,
hence the somewhat disappointing amount of feature progress.

I have uploaded the 0.66.0 base package to tlcontrib as well, but
please give the builders a few days to create actual platform-
specific binaries.

News:

* fixed: linebreak_filter doesn't do its default job when
   tex.linebreak is used

* fixed: \escapechar ignored by \meaning

* fixed: wrong px default

* fixed: font kern attribute inheritance

* fixed: "nop" unrecognized in virtual fonts

* fixed: assertion failure in dviluatex when font ptmr8t used

* fixed: tex.settoks for with strings with embedded zeroes

* fixed: an indexing problem with nonexistent font glyphs

* fixed: some crashes and other bugs on the 'subtype' and 'prev'
   fields (not all node types have those fields)

* fixed: crash on  token.csname_id ("")

* fixed: initialize the statically allocated node's type ids

* fixed: fencepost error in math parameter counting

* fixed: math family numbers > 255 are allowed

* fixed: compilation failure on Hurd

* fixed: a small bug leading to displacements when reading
   the AccentTop table

* fixed: \directlua followed by \pdfximage generates error if
   draft mode is active

* fixed: a problem with \vadjust pre in alignments

* fixed: a lua stack growing problem in the backend in 0.65.0,
   resulting in an inability to create more than a few thousand
   generated pages

* fixed: inclusion of Scribus-generated pdfs

* adapt: the default form margin is now zero (was 1bp before)

* adapt: libpng 1.4.4, zzuplib 0.13.60, mplib 1.504

* adapt: small changes to the build system and new imports from
   the texlive repository

* feature: new function node.currentattr() queries the current
   active attribute list

* feature: Lua font loading; ignore unknown enumeration keys in
   MathConstants

* feature: JPEG 2000 image support

* feature: continuing work on the 'epdf' library

* doc: the 'epdf' lua library is now documented

* doc: various other manual corrections


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.66.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From mojca.miklavec.lists at gmail.com  Tue Apr 12 19:41:06 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 12 Apr 2011 19:41:06 +0200
Subject: [luatex] string.char
In-Reply-To: <4DA415D1.90407@elvenkind.com>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr>
 <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr>
 <20110412090529.GA12337@oberdiek.my-fqdn.de>
 <4DA415D1.90407@elvenkind.com>
Message-ID: <BANLkTinV0hnnhq1GcK_-SbmPTHrhbUuDug@mail.gmail.com>

>> Result for luatex 0.65.0 from ConTeXt minimals:
>> ? [svn: -1]
>> ? [version: 65]
>> ? [revision: 0]
>
> That is a build problem in the minimals that I have to talk to Mojca about.
> luatex 0.66.0 is the first version that officially fixes the problem (to be
> released after lunch).

At some point in past I added --exclude '.svn' rule when doing rsync
on server that collects the most recent files. After that Taco added
svn version recognition and I actually never removed the svn exclude
rule.

It should be easy for me to fix, even though my preference would be to
do auto-replacement-of-version-during-svn-checkout or something
similar that includes the proper version even when .svn files are
absent.

The reason why it has never been done is that minimals always use the
stable version anyway.

I'll wait to see what Taco says.

Taco - does there exist some flag that would set identifier string
from TeX Live to ConTeXt distribution? For example, TeX Live binaries
always always say something like
    pdfTeX 3.1415926-1.40.11-2.2 (TeX Live 2010)
and so does MikTeX.

To what exent would I have to modify files or set flags to metapost
and luatex to display a costum identifier?

Mojca


From mojca.miklavec.lists at gmail.com  Wed Apr 13 17:59:37 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Wed, 13 Apr 2011 17:59:37 +0200
Subject: [luatex] string.char
In-Reply-To: <4DA415D1.90407@elvenkind.com>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr>
 <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr>
 <20110412090529.GA12337@oberdiek.my-fqdn.de>
 <4DA415D1.90407@elvenkind.com>
Message-ID: <BANLkTikk4RMLFCwxMDGSH5PbwBm3_hds9w@mail.gmail.com>

On Tue, Apr 12, 2011 at 11:05, Taco Hoekwater wrote:
> On 04/12/2011 11:05 AM, Heiko Oberdiek wrote:
>
>> Result for luatex 0.65.0 from ConTeXt minimals:
>> ? [svn: -1]
>> ? [version: 65]
>> ? [revision: 0]
>
> That is a build problem in the minimals that I have to talk to Mojca about.
> luatex 0.66.0 is the first version that officially fixes the problem (to be
> released after lunch).

I now generate luatex SVN version on the server before syncing the sources.

The binaries for 32-bit linux have been automatically built during the
night and Peter commited the binary for 64-bit linux, so for those two
platforms one would have to rebuild the binary to make any difference.
The remaining platforms should get it right.

Mojca

(PS: I suspect that the luatex build failed on solaris since the
metapost binary has been submitted, but no luatex.)


From rdt at cs.queensu.ca  Thu Apr 14 16:56:46 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Thu, 14 Apr 2011 10:56:46 -0400
Subject: [luatex] accented characters in plain luatex
Message-ID: <4da70b2e.7rc5YhtQMdOl6NcS%rdt@cs.queensu.ca>

I'm finding that accented characters (?, ?, ?, etc.) in my documents
produce

! String contains an invalid utf-8 sequence.

But the manual says

  All LuaTeX text input and output is considered to be Unicode text.

Is there a simple fix, apart from resorting to \`a, \'e, \:a, etc.?

Bob T.


From arthur.reutenauer at normalesup.org  Thu Apr 14 17:10:49 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 14 Apr 2011 16:10:49 +0100
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da70b2e.7rc5YhtQMdOl6NcS%rdt@cs.queensu.ca>
References: <4da70b2e.7rc5YhtQMdOl6NcS%rdt@cs.queensu.ca>
Message-ID: <20110414151049.GB1195@phare.normalesup.org>

> I'm finding that accented characters (?, ?, ?, etc.) in my documents
> produce
> 
> ! String contains an invalid utf-8 sequence.

  Can you send the exact file you're compiling?  It might simply not be
UTF-8.  If we have the file, that should be easy to diagnose.

	Arthur

From rdt at cs.queensu.ca  Thu Apr 14 17:23:25 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Thu, 14 Apr 2011 11:23:25 -0400
Subject: [luatex]  accented characters in plain luatex
Message-ID: <4da7116d.b5w6OpUmoks+wcOe%rdt@cs.queensu.ca>

 >   Can you send the exact file you're compiling? 

A minimal example is

\input musixtex
\input musixsty
\title{Adagio}
\subtitle{(pour orgue)}
\headtitle{I. Adagio}
\shortauthor{D. Taupin}
\fullauthor{Daniel TAUPIN\\organiste ? Gif-sur-Yvette}
\othermention{Compos? en 1989}
\maketitle
\eject
\bye

where musixtex.tex and musixsty.tex are from musixtex-texmf.zip at

http://mirror.ctan.org/macros/musixtex/musixtex-texmf.zip




From arthur.reutenauer at normalesup.org  Thu Apr 14 17:41:01 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 14 Apr 2011 16:41:01 +0100
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da7116d.b5w6OpUmoks+wcOe%rdt@cs.queensu.ca>
References: <4da7116d.b5w6OpUmoks+wcOe%rdt@cs.queensu.ca>
Message-ID: <20110414154101.GC1195@phare.normalesup.org>

> A minimal example is
>
> [etc.]

  Yes, but that does not tell us whether the file you're actually
compiling is encoded using UTF-8.  Could you just attach the file?

	Arthur

From reinhard.kotucha at web.de  Thu Apr 14 17:43:00 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 14 Apr 2011 17:43:00 +0200
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da7116d.b5w6OpUmoks+wcOe%rdt@cs.queensu.ca>
References: <4da7116d.b5w6OpUmoks+wcOe%rdt@cs.queensu.ca>
Message-ID: <19879.5636.192970.761312@zaphod.ms25.net>

On 2011-04-14 at 11:23:25 -0400, Bob Tennent wrote:

 >  >   Can you send the exact file you're compiling? 
 > 
 > A minimal example is
 > 
 > \input musixtex
 > \input musixsty
 > \title{Adagio}
 > \subtitle{(pour orgue)}
 > \headtitle{I. Adagio}
 > \shortauthor{D. Taupin}
 > \fullauthor{Daniel TAUPIN\\organiste ? Gif-sur-Yvette}
 > \othermention{Compos? en 1989}
 > \maketitle
 > \eject
 > \bye

Seems to be proper UTF-8:

==[ line 1 ]==
FEFF: ZERO WIDTH NO-BREAK SPACE
005C: REVERSE SOLIDUS
0069: LATIN SMALL LETTER I
006E: LATIN SMALL LETTER N
0070: LATIN SMALL LETTER P
0075: LATIN SMALL LETTER U
0074: LATIN SMALL LETTER T
0020: SPACE
006D: LATIN SMALL LETTER M
0075: LATIN SMALL LETTER U
0073: LATIN SMALL LETTER S
0069: LATIN SMALL LETTER I
0078: LATIN SMALL LETTER X
0074: LATIN SMALL LETTER T
0065: LATIN SMALL LETTER E
0078: LATIN SMALL LETTER X
000A: <control> LINE FEED (LF)

==[ line 2 ]==
005C: REVERSE SOLIDUS
0069: LATIN SMALL LETTER I
006E: LATIN SMALL LETTER N
0070: LATIN SMALL LETTER P
0075: LATIN SMALL LETTER U
0074: LATIN SMALL LETTER T
0020: SPACE
006D: LATIN SMALL LETTER M
0075: LATIN SMALL LETTER U
0073: LATIN SMALL LETTER S
0069: LATIN SMALL LETTER I
0078: LATIN SMALL LETTER X
0073: LATIN SMALL LETTER S
0074: LATIN SMALL LETTER T
0079: LATIN SMALL LETTER Y
000A: <control> LINE FEED (LF)

==[ line 3 ]==
005C: REVERSE SOLIDUS
0074: LATIN SMALL LETTER T
0069: LATIN SMALL LETTER I
0074: LATIN SMALL LETTER T
006C: LATIN SMALL LETTER L
0065: LATIN SMALL LETTER E
007B: LEFT CURLY BRACKET
0041: LATIN CAPITAL LETTER A
0064: LATIN SMALL LETTER D
0061: LATIN SMALL LETTER A
0067: LATIN SMALL LETTER G
0069: LATIN SMALL LETTER I
006F: LATIN SMALL LETTER O
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 4 ]==
005C: REVERSE SOLIDUS
0073: LATIN SMALL LETTER S
0075: LATIN SMALL LETTER U
0062: LATIN SMALL LETTER B
0074: LATIN SMALL LETTER T
0069: LATIN SMALL LETTER I
0074: LATIN SMALL LETTER T
006C: LATIN SMALL LETTER L
0065: LATIN SMALL LETTER E
007B: LEFT CURLY BRACKET
0028: LEFT PARENTHESIS
0070: LATIN SMALL LETTER P
006F: LATIN SMALL LETTER O
0075: LATIN SMALL LETTER U
0072: LATIN SMALL LETTER R
0020: SPACE
006F: LATIN SMALL LETTER O
0072: LATIN SMALL LETTER R
0067: LATIN SMALL LETTER G
0075: LATIN SMALL LETTER U
0065: LATIN SMALL LETTER E
0029: RIGHT PARENTHESIS
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 5 ]==
005C: REVERSE SOLIDUS
0068: LATIN SMALL LETTER H
0065: LATIN SMALL LETTER E
0061: LATIN SMALL LETTER A
0064: LATIN SMALL LETTER D
0074: LATIN SMALL LETTER T
0069: LATIN SMALL LETTER I
0074: LATIN SMALL LETTER T
006C: LATIN SMALL LETTER L
0065: LATIN SMALL LETTER E
007B: LEFT CURLY BRACKET
0049: LATIN CAPITAL LETTER I
002E: FULL STOP
0020: SPACE
0041: LATIN CAPITAL LETTER A
0064: LATIN SMALL LETTER D
0061: LATIN SMALL LETTER A
0067: LATIN SMALL LETTER G
0069: LATIN SMALL LETTER I
006F: LATIN SMALL LETTER O
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 6 ]==
005C: REVERSE SOLIDUS
0073: LATIN SMALL LETTER S
0068: LATIN SMALL LETTER H
006F: LATIN SMALL LETTER O
0072: LATIN SMALL LETTER R
0074: LATIN SMALL LETTER T
0061: LATIN SMALL LETTER A
0075: LATIN SMALL LETTER U
0074: LATIN SMALL LETTER T
0068: LATIN SMALL LETTER H
006F: LATIN SMALL LETTER O
0072: LATIN SMALL LETTER R
007B: LEFT CURLY BRACKET
0044: LATIN CAPITAL LETTER D
002E: FULL STOP
0020: SPACE
0054: LATIN CAPITAL LETTER T
0061: LATIN SMALL LETTER A
0075: LATIN SMALL LETTER U
0070: LATIN SMALL LETTER P
0069: LATIN SMALL LETTER I
006E: LATIN SMALL LETTER N
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 7 ]==
005C: REVERSE SOLIDUS
0066: LATIN SMALL LETTER F
0075: LATIN SMALL LETTER U
006C: LATIN SMALL LETTER L
006C: LATIN SMALL LETTER L
0061: LATIN SMALL LETTER A
0075: LATIN SMALL LETTER U
0074: LATIN SMALL LETTER T
0068: LATIN SMALL LETTER H
006F: LATIN SMALL LETTER O
0072: LATIN SMALL LETTER R
007B: LEFT CURLY BRACKET
0044: LATIN CAPITAL LETTER D
0061: LATIN SMALL LETTER A
006E: LATIN SMALL LETTER N
0069: LATIN SMALL LETTER I
0065: LATIN SMALL LETTER E
006C: LATIN SMALL LETTER L
0020: SPACE
0054: LATIN CAPITAL LETTER T
0041: LATIN CAPITAL LETTER A
0055: LATIN CAPITAL LETTER U
0050: LATIN CAPITAL LETTER P
0049: LATIN CAPITAL LETTER I
004E: LATIN CAPITAL LETTER N
005C: REVERSE SOLIDUS
005C: REVERSE SOLIDUS
006F: LATIN SMALL LETTER O
0072: LATIN SMALL LETTER R
0067: LATIN SMALL LETTER G
0061: LATIN SMALL LETTER A
006E: LATIN SMALL LETTER N
0069: LATIN SMALL LETTER I
0073: LATIN SMALL LETTER S
0074: LATIN SMALL LETTER T
0065: LATIN SMALL LETTER E
0020: SPACE
00E0: LATIN SMALL LETTER A WITH GRAVE
0020: SPACE
0047: LATIN CAPITAL LETTER G
0069: LATIN SMALL LETTER I
0066: LATIN SMALL LETTER F
002D: HYPHEN-MINUS
0073: LATIN SMALL LETTER S
0075: LATIN SMALL LETTER U
0072: LATIN SMALL LETTER R
002D: HYPHEN-MINUS
0059: LATIN CAPITAL LETTER Y
0076: LATIN SMALL LETTER V
0065: LATIN SMALL LETTER E
0074: LATIN SMALL LETTER T
0074: LATIN SMALL LETTER T
0065: LATIN SMALL LETTER E
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 8 ]==
005C: REVERSE SOLIDUS
006F: LATIN SMALL LETTER O
0074: LATIN SMALL LETTER T
0068: LATIN SMALL LETTER H
0065: LATIN SMALL LETTER E
0072: LATIN SMALL LETTER R
006D: LATIN SMALL LETTER M
0065: LATIN SMALL LETTER E
006E: LATIN SMALL LETTER N
0074: LATIN SMALL LETTER T
0069: LATIN SMALL LETTER I
006F: LATIN SMALL LETTER O
006E: LATIN SMALL LETTER N
007B: LEFT CURLY BRACKET
0043: LATIN CAPITAL LETTER C
006F: LATIN SMALL LETTER O
006D: LATIN SMALL LETTER M
0070: LATIN SMALL LETTER P
006F: LATIN SMALL LETTER O
0073: LATIN SMALL LETTER S
00E9: LATIN SMALL LETTER E WITH ACUTE
0020: SPACE
0065: LATIN SMALL LETTER E
006E: LATIN SMALL LETTER N
0020: SPACE
0031: DIGIT ONE
0039: DIGIT NINE
0038: DIGIT EIGHT
0039: DIGIT NINE
007D: RIGHT CURLY BRACKET
000A: <control> LINE FEED (LF)

==[ line 9 ]==
005C: REVERSE SOLIDUS
006D: LATIN SMALL LETTER M
0061: LATIN SMALL LETTER A
006B: LATIN SMALL LETTER K
0065: LATIN SMALL LETTER E
0074: LATIN SMALL LETTER T
0069: LATIN SMALL LETTER I
0074: LATIN SMALL LETTER T
006C: LATIN SMALL LETTER L
0065: LATIN SMALL LETTER E
000A: <control> LINE FEED (LF)

==[ line 10 ]==
005C: REVERSE SOLIDUS
0065: LATIN SMALL LETTER E
006A: LATIN SMALL LETTER J
0065: LATIN SMALL LETTER E
0063: LATIN SMALL LETTER C
0074: LATIN SMALL LETTER T
000A: <control> LINE FEED (LF)

==[ line 11 ]==
005C: REVERSE SOLIDUS
0062: LATIN SMALL LETTER B
0079: LATIN SMALL LETTER Y
0065: LATIN SMALL LETTER E
000A: <control> LINE FEED (LF)

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From rdt at cs.queensu.ca  Thu Apr 14 17:48:12 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Thu, 14 Apr 2011 11:48:12 -0400
Subject: [luatex]  accented characters in plain luatex
Message-ID: <4da7173c.TJnXHrNTyPfHNbJM%rdt@cs.queensu.ca>


> Could you just attach the file?

Attached.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: minimal.tex
Type: application/x-tex
Size: 226 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110414/1e7ec5e4/attachment.tex>

From reinhard.kotucha at web.de  Thu Apr 14 17:53:48 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 14 Apr 2011 17:53:48 +0200
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da7173c.TJnXHrNTyPfHNbJM%rdt@cs.queensu.ca>
References: <4da7173c.TJnXHrNTyPfHNbJM%rdt@cs.queensu.ca>
Message-ID: <19879.6284.518475.183160@zaphod.ms25.net>

On 2011-04-14 at 11:48:12 -0400, Bob Tennent wrote:

With the file you sent I get:

iconv: illegal input sequence at position 154

and Emacs detects ISO 8859-1

Regards,
  Reinhard 
 
-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Thu Apr 14 18:00:13 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 14 Apr 2011 17:00:13 +0100
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da7173c.TJnXHrNTyPfHNbJM%rdt@cs.queensu.ca>
References: <4da7173c.TJnXHrNTyPfHNbJM%rdt@cs.queensu.ca>
Message-ID: <20110414160013.GD1195@phare.normalesup.org>

> Attached.

  It is indeed in ISO-8859-1 (a.k.a. latin-1).  You need to tell your
editor, whatever it is, to save the file in UTF-8.  In this case I
suppose the original file was in latin-1, so you need to convert it if
you want to compile it using LuaTeX.

  Note that there is a package called luainputenc that purports to do
the same job as inputenc does for LaTeX / pdfLaTeX, that is dealing with
different text encodings (and luainputenc also works with the plain
format).  Depending on your actual project, you might want to use it or
not: if you have existing files using encodings different than UTF-8, it
can make sense to use on-the-fly conversion; if you're using LuaTeX for
a new project, it would be much better to start off in UTF-8 from the
beginning, because that's what LuaTeX can process directly -- and for
many other reasons.

	Arthur

From rdt at cs.queensu.ca  Thu Apr 14 18:23:43 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Thu, 14 Apr 2011 12:23:43 -0400
Subject: [luatex]  accented characters in plain luatex
Message-ID: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>

 >It is indeed in ISO-8859-1 (a.k.a. latin-1).  You need to tell your
 >editor, whatever it is, to save the file in UTF-8.  In this case I
 >suppose the original file was in latin-1, so you need to convert it if
 >you want to compile it using LuaTeX.

The editor is vim. Rather than figure out how to save in UTF-8, I used

iconv -t UTF-8 -o minimalUTF.tex minimal.tex

Now the accented characters don't display properly and although luatex
processes minimalUTF.tex, the accented characters are missing in the
resulting dvi.

As for luainputenc.sty, if I use it as follows

\input luainputenc.sty

I get \NeedsTeXFormat
                    {LaTeX2e}

despite the manual's 

  This package contains a .sty file for both LaTEX and Plain 

Bob T.

From luatex at nililand.de  Thu Apr 14 19:01:48 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 14 Apr 2011 19:01:48 +0200
Subject: [luatex] accented characters in plain luatex
References: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>
Message-ID: <6mw7y4oua9or.dlg@nililand.de>

Am Thu, 14 Apr 2011 12:23:43 -0400 schrieb Bob Tennent:


> Now the accented characters don't display properly and although luatex
> processes minimalUTF.tex, the accented characters are missing in the
> resulting dvi.

Sure, you are using the OT1-encoded cmr, it hasn't glyphs at the
position of the ?. Try luaotfload + load an unicode font.

-- 
Ulrike Fischer 


From mojca.miklavec.lists at gmail.com  Thu Apr 14 21:06:22 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 14 Apr 2011 21:06:22 +0200
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>
References: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>
Message-ID: <BANLkTimWVArmicxE6Z2QWuqwEsPL-v2WDQ@mail.gmail.com>

On Thu, Apr 14, 2011 at 18:23, Bob Tennent wrote:
> ?>It is indeed in ISO-8859-1 (a.k.a. latin-1). ?You need to tell your
> ?>editor, whatever it is, to save the file in UTF-8. ?In this case I
> ?>suppose the original file was in latin-1, so you need to convert it if
> ?>you want to compile it using LuaTeX.
>
> The editor is vim. Rather than figure out how to save in UTF-8

<open the file in latin1 encoding in the same way as you did before>
:set fileencoding utf-8
:w or :wq

But even better to put "set encoding=utf-8" on top of .vimrc.

Mojca


From dpl at sun.ac.za  Thu Apr 14 22:28:13 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Thu, 14 Apr 2011 22:28:13 +0200
Subject: [luatex] accented characters in plain luatex
In-Reply-To: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>
References: <4da71f8f.pu7cV5lljy3PT+ih%rdt@cs.queensu.ca>
Message-ID: <20110414202813.GA20122@rondloper>

On Thu, Apr 14, 2011 at 06:23:43PM +0200, Bob Tennent wrote:
> 
> Now the accented characters don't display properly and although luatex
> processes minimalUTF.tex, the accented characters are missing in the
> resulting dvi.
> 
Well, if you stick to Computer Modern, of course you're stuck
in the pre-UTF era.

Try a more recent font.  My personal favourite is Antikwa Toru?ska.
In LaTeX, \usepackage{anttor}

Unfortunately, I so seldom use plain TeX (yes, I run MusiXTeX via
LaTeX) that I don't know what \font command to use.  If someone
knows how to deduce that from a LaTeX log file, please tell me.

Dirk

From Robin.Fairbairns at cl.cam.ac.uk  Fri Apr 15 00:34:17 2011
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 14 Apr 2011 23:34:17 +0100
Subject: [luatex] accented characters in plain luatex
In-Reply-To: Your message of Thu, 14 Apr 2011 22:28:13 +0200.
 <20110414202813.GA20122@rondloper>
Message-ID: <26599.1302820457@cl.cam.ac.uk>

Dirk Laurie <dpl at sun.ac.za> wrote:

> On Thu, Apr 14, 2011 at 06:23:43PM +0200, Bob Tennent wrote:
> > 
> > Now the accented characters don't display properly and although luatex
> > processes minimalUTF.tex, the accented characters are missing in the
> > resulting dvi.
> 
> Well, if you stick to Computer Modern, of course you're stuck
> in the pre-UTF era.
> 
> Try a more recent font.  My personal favourite is Antikwa Toru?ska.
> In LaTeX, \usepackage{anttor}
> 
> Unfortunately, I so seldom use plain TeX (yes, I run MusiXTeX via
> LaTeX) that I don't know what \font command to use.  If someone
> knows how to deduce that from a LaTeX log file, please tell me.

ctan:fonts/cm-unicode

includes otf and type 1 versions (not that i've investigated in any
detail, but the readme file does say they'll work with (xe|lua)tex).

robin the catalogue freak.


From martin at oneiros.de  Fri Apr 15 11:20:03 2011
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 15 Apr 2011 11:20:03 +0200
Subject: [luatex] Fwd: Lua Workshop 2011
Message-ID: <BANLkTim1G5bB5AwJado+gOKa=cEmBfLR5g@mail.gmail.com>

This is some kind of CfP. :-)
The Lua workshop 2011 will be in Switzerland
http://lua-users.org/wiki/LuaWorkshopTwoThousandEleven

Best
   Martin
---------- Forwarded message ----------
From: Marc Balmer <marc at msys.ch>
Date: 2011/4/15
Subject: Re: Workshop 2011
To: lua-l at lists.lua.org


Am 14.04.11 14:05, schrieb Roberto Ierusalimschy:
>> Maybe Lua Team should establish at least some minimal procedure and deadlines?
>
> We have been talking and it seems we can settle with Switzerland. Oxford
> is out, Santa Barbara got too few votes, and the others do not seem real
> options (e.g., no organizer, no details). And Marc seems really eager to
> host it :)
>
> Now we need dates.

The date is set now: ?The workshop will take place september 8. - 9.

We already made some hotel arrangements (we get a reduced price at some
places) and the location for the social event/dinner on thursday, 8th,
is reserved. ?Details will follow.

Now we need talks.


From ulrik.vieth at arcor.de  Sun Apr 17 21:39:23 2011
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 17 Apr 2011 21:39:23 +0200
Subject: [luatex] LuaTeX 0.66 segfaults when loading graphicx in LuaLaTeX
Message-ID: <4DAB41EB.50002@arcor.de>

I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
The following minimal test file for LuaLaTeX crashes with a segmentation 
fault:

\documentclass{minimal}
%\tracingall
\usepackage{graphicx}
\begin{document}
\end{document}

Console output:

This is LuaTeX, Version beta-0.66.0-2011041219
  restricted \write18 enabled.
(./test-uni.tex
LaTeX2e <2009/09/24>
LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns 
for english, dumylang, nohyphenation, loaded.
(/opt/texlive/2010/texmf-dist/tex/latex/base/minimal.cls
Document Class: minimal 2001/05/25 Standard LaTeX minimal class
) (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphicx.sty
(/opt/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty)
(/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphics.sty
(/opt/texlive/2010/texmf-dist/tex/latex/graphics/trig.sty)
(/opt/texlive/2010/texmf-dist/tex/latex/latexconfig/graphics.cfg)
(/opt/texlive/2010/texmf-dist/tex/latex/pdftex-def/pdftex.def
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/infwarerr.sty)
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ltxcmds.sty)
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifpdf.sty)
(/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
(/opt/texlive/2010/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua))))))
(./test-uni.aux) 
(/opt/texlive/2010/texmf-dist/tex/context/base/supp-pdf.mkii
[Loading MPS to PDF converter (version 2006.09.02).]
Segmentation fault

Console output with \tracingall ends with:

\pdf at shellescape ->\directlua {oberdiek.pdftexcmds.shellescape()}
{\directlua}
Segmentation fault



From luigi.scarso at gmail.com  Sun Apr 17 21:42:27 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 17 Apr 2011 21:42:27 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
	LuaLaTeX
In-Reply-To: <4DAB41EB.50002@arcor.de>
References: <4DAB41EB.50002@arcor.de>
Message-ID: <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>

On Sun, Apr 17, 2011 at 9:39 PM, Ulrik Vieth <ulrik.vieth at arcor.de> wrote:
> I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
> The following minimal test file for LuaLaTeX crashes with a segmentation
> fault:
>
> \documentclass{minimal}
> %\tracingall
> \usepackage{graphicx}
> \begin{document}
> \end{document}
>
> Console output:
>
> This is LuaTeX, Version beta-0.66.0-2011041219
> ?restricted \write18 enabled.
> (./test-uni.tex
> LaTeX2e <2009/09/24>
> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns for
> english, dumylang, nohyphenation, loaded.
> (/opt/texlive/2010/texmf-dist/tex/latex/base/minimal.cls
> Document Class: minimal 2001/05/25 Standard LaTeX minimal class
> ) (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphicx.sty
> (/opt/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty)
> (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphics.sty
> (/opt/texlive/2010/texmf-dist/tex/latex/graphics/trig.sty)
> (/opt/texlive/2010/texmf-dist/tex/latex/latexconfig/graphics.cfg)
> (/opt/texlive/2010/texmf-dist/tex/latex/pdftex-def/pdftex.def
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/infwarerr.sty)
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ltxcmds.sty)
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifpdf.sty)
> (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
> (/opt/texlive/2010/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua))))))
> (./test-uni.aux)
> (/opt/texlive/2010/texmf-dist/tex/context/base/supp-pdf.mkii
Isn't strange that a context mkii file is used with luatex ?

-- 
luigi


From reinhard.kotucha at web.de  Sun Apr 17 21:51:05 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 17 Apr 2011 21:51:05 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
 LuaLaTeX
In-Reply-To: <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>
References: <4DAB41EB.50002@arcor.de>
 <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>
Message-ID: <19883.17577.14287.664832@zaphod.ms25.net>

On 2011-04-17 at 21:42:27 +0200, luigi scarso wrote:

 > On Sun, Apr 17, 2011 at 9:39 PM, Ulrik Vieth <ulrik.vieth at arcor.de> wrote:
 > > I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
 > > The following minimal test file for LuaLaTeX crashes with a segmentation
 > > fault:
 > >
 > > \documentclass{minimal}
 > > %\tracingall
 > > \usepackage{graphicx}
 > > \begin{document}
 > > \end{document}
 > >
 > > Console output:
 > >
 > > This is LuaTeX, Version beta-0.66.0-2011041219
 > > ?restricted \write18 enabled.
 > > (./test-uni.tex
 > > LaTeX2e <2009/09/24>
 > > LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns for
 > > english, dumylang, nohyphenation, loaded.
 > > (/opt/texlive/2010/texmf-dist/tex/latex/base/minimal.cls
 > > Document Class: minimal 2001/05/25 Standard LaTeX minimal class
 > > ) (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphicx.sty
 > > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphics.sty
 > > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/trig.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/latex/latexconfig/graphics.cfg)
 > > (/opt/texlive/2010/texmf-dist/tex/latex/pdftex-def/pdftex.def
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/infwarerr.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ltxcmds.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifpdf.sty)
 > > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
 > > (/opt/texlive/2010/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua))))))
 > > (./test-uni.aux)
 > > (/opt/texlive/2010/texmf-dist/tex/context/base/supp-pdf.mkii
 > Isn't strange that a context mkii file is used with luatex ?

No, it's used for years.  It allows LaTeX users to use Metapost output
files directly with \includegraphics.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From martin at oneiros.de  Sun Apr 17 22:02:06 2011
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 17 Apr 2011 22:02:06 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
	LuaLaTeX
In-Reply-To: <4DAB41EB.50002@arcor.de>
References: <4DAB41EB.50002@arcor.de>
Message-ID: <BANLkTi=846E8Q5CQWbQwfCZOrNJe=d3UyQ@mail.gmail.com>

2011/4/17 Ulrik Vieth <ulrik.vieth at arcor.de>:
> I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
> The following minimal test file for LuaLaTeX crashes with a segmentation
> fault:

Bug introduced in 0.66, "fixed in next beta".

Best
   Martin

From st_philipp at yahoo.de  Sun Apr 17 22:06:34 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Sun, 17 Apr 2011 22:06:34 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
	LuaLaTeX
In-Reply-To: <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>
References: <4DAB41EB.50002@arcor.de>
 <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>
Message-ID: <F0450F8F-F428-4809-AE7C-4C54BD70B360@yahoo.de>


Am 17.04.2011 um 21:42 schrieb luigi scarso:

>> (/opt/texlive/2010/texmf-dist/tex/context/base/supp-pdf.mkii
> Isn't strange that a context mkii file is used with luatex ?

No, LaTeX has been using ConTeXt code for quite a while: in this case, to support MPS graphics files. Another example is LuaOTFLoad which uses ConTeXt's font loading code.

This segfault is probably the same problem as here:
http://tug.org/pipermail/tex-live/2011-April/028862.html

From heiko.oberdiek at googlemail.com  Sun Apr 17 23:01:36 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Sun, 17 Apr 2011 23:01:36 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
	LuaLaTeX
In-Reply-To: <BANLkTi=846E8Q5CQWbQwfCZOrNJe=d3UyQ@mail.gmail.com>
References: <4DAB41EB.50002@arcor.de>
 <BANLkTi=846E8Q5CQWbQwfCZOrNJe=d3UyQ@mail.gmail.com>
Message-ID: <20110417210136.GA23980@oberdiek.my-fqdn.de>

On Sun, Apr 17, 2011 at 10:02:06PM +0200, Martin Schr?der wrote:

> 2011/4/17 Ulrik Vieth <ulrik.vieth at arcor.de>:
> > I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
> > The following minimal test file for LuaLaTeX crashes with a segmentation
> > fault:
> 
> Bug introduced in 0.66, 

Earlier, but unclear when exactly.

> "fixed in next beta".

0.70.0, revision 4167.

Also I have changed pdftexcmds. Version 2011/04/16 v0.15
lets \pdf at shellescape undefined for LuaTeX prior to 0.70.0
in order to avoid the segmentation fault.

In theory it should be on CTAN today. Perhaps tomorrow,
it's not in my hands.
  For the impatient: ftp://ftp.tug.org/tex/oberdiek/oberdiek.tds.zip

Yours sincerely
  Heiko Oberdiek

From mpg at elzevir.fr  Mon Apr 18 02:57:53 2011
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 18 Apr 2011 02:57:53 +0200
Subject: [luatex] string.char
In-Reply-To: <BANLkTinV0hnnhq1GcK_-SbmPTHrhbUuDug@mail.gmail.com>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr> <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr> <20110412090529.GA12337@oberdiek.my-fqdn.de>
 <4DA415D1.90407@elvenkind.com>
 <BANLkTinV0hnnhq1GcK_-SbmPTHrhbUuDug@mail.gmail.com>
Message-ID: <4DAB8C91.2020201@elzevir.fr>

Le 12/04/2011 19:41, Mojca Miklavec a ?crit :
> It should be easy for me to fix, even though my preference would be to
> do auto-replacement-of-version-during-svn-checkout or something
> similar that includes the proper version even when .svn files are
> absent.
> 
But it wouldn't work with git-svn checkouts, while the current method does (IIRC).

Manuel.

From luigi.scarso at gmail.com  Mon Apr 18 03:16:20 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 18 Apr 2011 03:16:20 +0200
Subject: [luatex] [lltx] LuaTeX 0.66 segfaults when loading graphicx in
	LuaLaTeX
In-Reply-To: <19883.17577.14287.664832@zaphod.ms25.net>
References: <4DAB41EB.50002@arcor.de>
 <BANLkTikXkyJjuZYsVETBanyfS4aGzA5w5A@mail.gmail.com>
 <19883.17577.14287.664832@zaphod.ms25.net>
Message-ID: <BANLkTi=ud5co1DfrJR=-USvXq8h7u9Hz_Q@mail.gmail.com>

On Sun, Apr 17, 2011 at 9:51 PM, Reinhard Kotucha
<reinhard.kotucha at web.de> wrote:
> On 2011-04-17 at 21:42:27 +0200, luigi scarso wrote:
>
> ?> On Sun, Apr 17, 2011 at 9:39 PM, Ulrik Vieth <ulrik.vieth at arcor.de> wrote:
> ?> > I am using LuaTeX 0.66 from TLContrib on top of TeXLive 2010.
> ?> > The following minimal test file for LuaLaTeX crashes with a segmentation
> ?> > fault:
> ?> >
> ?> > \documentclass{minimal}
> ?> > %\tracingall
> ?> > \usepackage{graphicx}
> ?> > \begin{document}
> ?> > \end{document}
> ?> >
> ?> > Console output:
> ?> >
> ?> > This is LuaTeX, Version beta-0.66.0-2011041219
> ?> > ?restricted \write18 enabled.
> ?> > (./test-uni.tex
> ?> > LaTeX2e <2009/09/24>
> ?> > LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns for
> ?> > english, dumylang, nohyphenation, loaded.
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/base/minimal.cls
> ?> > Document Class: minimal 2001/05/25 Standard LaTeX minimal class
> ?> > ) (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphicx.sty
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/keyval.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/graphics.sty
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/graphics/trig.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/latexconfig/graphics.cfg)
> ?> > (/opt/texlive/2010/texmf-dist/tex/latex/pdftex-def/pdftex.def
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/infwarerr.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ltxcmds.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/ifpdf.sty)
> ?> > (/opt/texlive/2010/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
> ?> > (/opt/texlive/2010/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua))))))
> ?> > (./test-uni.aux)
> ?> > (/opt/texlive/2010/texmf-dist/tex/context/base/supp-pdf.mkii
> ?> Isn't strange that a context mkii file is used with luatex ?
>
> No, it's used for years. ?It allows LaTeX users to use Metapost output
> files directly with \includegraphics.
>
> Regards,
> ?Reinhard
Usually a mkii file is used with pdftex (and  a mkiv or mkvi file  with luatex )
but I see that supp-pdf.mkii  is a bit special .
-- 
luigi


From mojca.miklavec.lists at gmail.com  Mon Apr 18 08:04:24 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 18 Apr 2011 08:04:24 +0200
Subject: [luatex] string.char
In-Reply-To: <4DAB8C91.2020201@elzevir.fr>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>
 <4D99F2BA.3060509@free.fr>
 <20110404183333.GA10416@oberdiek.my-fqdn.de>
 <4D9A2391.9090003@free.fr> <4D9AD77C.9060902@elvenkind.com>
 <4D9AE186.1060701@free.fr>
 <20110412090529.GA12337@oberdiek.my-fqdn.de>
 <4DA415D1.90407@elvenkind.com>
 <BANLkTinV0hnnhq1GcK_-SbmPTHrhbUuDug@mail.gmail.com>
 <4DAB8C91.2020201@elzevir.fr>
Message-ID: <BANLkTim5784wb0M_36L46wWx1G3jMTj2gQ@mail.gmail.com>

On Mon, Apr 18, 2011 at 02:57, Manuel P?gouri?-Gonnard wrote:
> Le 12/04/2011 19:41, Mojca Miklavec a ?crit :
>> It should be easy for me to fix, even though my preference would be to
>> do auto-replacement-of-version-during-svn-checkout or something
>> similar that includes the proper version even when .svn files are
>> absent.
>>
> But it wouldn't work with git-svn checkouts, while the current method does (IIRC).

In any case - it does work now (I didn't know about the possibility of
running the command to generate version separately and it seems to be
ok now). On top of that our binaries were never containing
intermediate versions, so SVN version didn't really matter for most
users and I just didn't pay enough attention.

(I find it a bit weird that the version string contains the time when
the binary was compiled as opposed to the time of latest commit for
example.)

Mojca


From taco at elvenkind.com  Mon Apr 18 08:52:43 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 18 Apr 2011 08:52:43 +0200
Subject: [luatex] string.char
In-Reply-To: <BANLkTim5784wb0M_36L46wWx1G3jMTj2gQ@mail.gmail.com>
References: <20110404161414.GA9856@oberdiek.my-fqdn.de>	<4D99F2BA.3060509@free.fr>	<20110404183333.GA10416@oberdiek.my-fqdn.de>	<4D9A2391.9090003@free.fr>	<4D9AD77C.9060902@elvenkind.com>	<4D9AE186.1060701@free.fr>	<20110412090529.GA12337@oberdiek.my-fqdn.de>	<4DA415D1.90407@elvenkind.com>	<BANLkTinV0hnnhq1GcK_-SbmPTHrhbUuDug@mail.gmail.com>	<4DAB8C91.2020201@elzevir.fr>
 <BANLkTim5784wb0M_36L46wWx1G3jMTj2gQ@mail.gmail.com>
Message-ID: <4DABDFBB.8010105@elvenkind.com>

On 04/18/2011 08:04 AM, Mojca Miklavec wrote:
>
> (I find it a bit weird that the version string contains the time when
> the binary was compiled as opposed to the time of latest commit for
> example.)

True, that is why there also is a revision in the banner. Getting the
actual commit date is quite hard, if I recall correctly, so I settled
for compile time just to get *something*.

Best wishes,
Taco

From rdt at cs.queensu.ca  Wed Apr 20 14:59:31 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 08:59:31 -0400
Subject: [luatex] lua scripts
Message-ID: <4daed8b3.q1SJZySGnuxNMCGh%rdt@cs.queensu.ca>


Hi. Where in a texmf tree should lua scripts go so that texlua will find
them? I want to say

 > texlua script.lua

where script.lua is in a texmf tree; but where?

I've tried under scripts and under tex/luatex.

Bob T.


From zappathustra at free.fr  Wed Apr 20 15:14:22 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 20 Apr 2011 15:14:22 +0200
Subject: [luatex] Strange behavior with fonts.
Message-ID: <4DAEDC2E.9040603@free.fr>

Hello there,

I think I've found a bug, but since I'm still a bit uncomfortable with 
fonts and I can't reproduce the problem with luaotfload (haven't tried 
very hard, though), I think it wise to ask knowledgeable people before 
polluting the bug tracker.

The problem is entirely contained in the attached files.

The Lua code is an extremely blunt font loader, as minimal as possible 
while still displaying the problem; it is also extremely stupid: on 
first use, it sets the glyph to their Unicode slots; the second time, it 
puts small caps in the slot of the lowercase letters (it is meant to 
spot Minion's small caps). In other words, after:

\font\fontone=MinionPro-Regular.otf at 10pt
\font\fonttwo=MinionPro-Regular.otf at 10pt

\fontone writes normally, while \fonttwo writes in small caps. That's 
the way I use a font with small caps (I suppose that's the only way, 
unless you change glyphs in callbacks). I've used Minion because it is 
distributed freely with Adobe Reader.

Now, if you look at the PDF or compile the source, you can see that it's 
all wrong; sizes are at random and the paragraph is like raggedright. If 
\fonttwo isn't loaded, everything is fine; otherwise, disaster, even 
though \fonttwo is loaded /after/ the paragraph has been built, which 
seems to indicate something has gone wrong when outputting to PDF (of 
course the problem also shows up when \fonttwo is loaded before the 
paragraph). Judging from what I can read in the uncompressed PDF file 
when comparing to an unproblematic file, spaces between characters are 
all wrong (I don't know where those spaces come from, by the way; there 
are no font kerns with this fontloader).

A few remarks about the behavior:

- It depends on font expansion; without \pdfadjustspacing, everything is 
fine.
- It also depends on the value given to the glyphs' "expansion_factor" 
field; if 484 or higher, it goes wrong; if 483 or lower, everything is 
fine. The value of that threshold depends on the font (e.g. it is 909 
for Chaparral).
- If there is a one-line paragraph before the first paragraph, 
everything is fine.
- If there is a page break before the second font is loaded, again 
everything is fine.
- The fonts should be loaded at the same size; if e.g. \fonttwo is 
10.1pt, the problem vanishes.

Did I do anything wrong or is that a patented bug? (Actually, I think 
that even if I did anything wrong the behavior is so strange that it's 
very probably a bug anyway.)

Best,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110420/da36d627/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.pdf
Type: application/pdf
Size: 16220 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110420/da36d627/attachment-0001.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tex
Type: text/x-tex
Size: 3497 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110420/da36d627/attachment-0001.bin>

From reinhard.kotucha at web.de  Wed Apr 20 15:14:28 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 20 Apr 2011 15:14:28 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4daed8b3.q1SJZySGnuxNMCGh%rdt@cs.queensu.ca>
References: <4daed8b3.q1SJZySGnuxNMCGh%rdt@cs.queensu.ca>
Message-ID: <19886.56372.998843.998424@zaphod.ms25.net>

On 2011-04-20 at 08:59:31 -0400, Bob Tennent wrote:

 > Hi. Where in a texmf tree should lua scripts go so that texlua will find
 > them? I want to say
 > 
 >  > texlua script.lua
 > 
 > where script.lua is in a texmf tree; but where?
 > 
 > I've tried under scripts and under tex/luatex.

I suppose they are treated as any other scripts:  Add the line

#! /usr/bin/env texlua

, put them under scripts, and create a symlink in bin.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Wed Apr 20 15:29:48 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 20 Apr 2011 15:29:48 +0200
Subject: [luatex] Strange behavior with fonts.
In-Reply-To: <4DAEDC2E.9040603@free.fr>
References: <4DAEDC2E.9040603@free.fr>
Message-ID: <4DAEDFCC.4070900@free.fr>

Additional information (don't know why I didn't spot it before):

I had set the expansion step to 30, the same value as shrink and 
stretch, pretty stupidly. Anyway, if I put it to something lower, I 
apparently have to increase the glyphs' expansion_factor for the problem 
to show up. For instance, with step = 10, expansion_factor should be at 
least 1214.

(Also, my LuaTeX is v0.66 rev 4136. And I had left a useless inspection 
of post_linebreak_filter in the file I've sent, sorry for that.)

Best,
Paul

Le 20/04/2011 15:14, Paul Isambert a ?crit :
> Hello there,
>
> I think I've found a bug, but since I'm still a bit uncomfortable with 
> fonts and I can't reproduce the problem with luaotfload (haven't tried 
> very hard, though), I think it wise to ask knowledgeable people before 
> polluting the bug tracker.
>
> The problem is entirely contained in the attached files.
>
> The Lua code is an extremely blunt font loader, as minimal as possible 
> while still displaying the problem; it is also extremely stupid: on 
> first use, it sets the glyph to their Unicode slots; the second time, 
> it puts small caps in the slot of the lowercase letters (it is meant 
> to spot Minion's small caps). In other words, after:
>
> \font\fontone=MinionPro-Regular.otf at 10pt
> \font\fonttwo=MinionPro-Regular.otf at 10pt
>
> \fontone writes normally, while \fonttwo writes in small caps. That's 
> the way I use a font with small caps (I suppose that's the only way, 
> unless you change glyphs in callbacks). I've used Minion because it is 
> distributed freely with Adobe Reader.
>
> Now, if you look at the PDF or compile the source, you can see that 
> it's all wrong; sizes are at random and the paragraph is like 
> raggedright. If \fonttwo isn't loaded, everything is fine; otherwise, 
> disaster, even though \fonttwo is loaded /after/ the paragraph has 
> been built, which seems to indicate something has gone wrong when 
> outputting to PDF (of course the problem also shows up when \fonttwo 
> is loaded before the paragraph). Judging from what I can read in the 
> uncompressed PDF file when comparing to an unproblematic file, spaces 
> between characters are all wrong (I don't know where those spaces come 
> from, by the way; there are no font kerns with this fontloader).
>
> A few remarks about the behavior:
>
> - It depends on font expansion; without \pdfadjustspacing, everything 
> is fine.
> - It also depends on the value given to the glyphs' "expansion_factor" 
> field; if 484 or higher, it goes wrong; if 483 or lower, everything is 
> fine. The value of that threshold depends on the font (e.g. it is 909 
> for Chaparral).
> - If there is a one-line paragraph before the first paragraph, 
> everything is fine.
> - If there is a page break before the second font is loaded, again 
> everything is fine.
> - The fonts should be loaded at the same size; if e.g. \fonttwo is 
> 10.1pt, the problem vanishes.
>
> Did I do anything wrong or is that a patented bug? (Actually, I think 
> that even if I did anything wrong the behavior is so strange that it's 
> very probably a bug anyway.)
>
> Best,
> Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110420/42a30569/attachment.html>

From reinhard.kotucha at web.de  Wed Apr 20 15:32:48 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 20 Apr 2011 15:32:48 +0200
Subject: [luatex] Strange behavior with fonts.
In-Reply-To: <4DAEDC2E.9040603@free.fr>
References: <4DAEDC2E.9040603@free.fr>
Message-ID: <19886.57472.45635.709426@zaphod.ms25.net>

On 2011-04-20 at 15:14:22 +0200, Paul Isambert wrote:

 > I've used Minion because it is distributed freely with Adobe
 > Reader.

Did you read the license?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Wed Apr 20 15:53:32 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 20 Apr 2011 15:53:32 +0200
Subject: [luatex] Strange behavior with fonts.
In-Reply-To: <4DAEDC2E.9040603@free.fr>
References: <4DAEDC2E.9040603@free.fr>
Message-ID: <4DAEE55C.9030509@elvenkind.com>

Hi,

On 04/20/11 15:14, Paul Isambert wrote:
>  Hello there,
> 
> I think I've found a bug, but since I'm still a bit uncomfortable with
> fonts and I can't reproduce the problem with luaotfload (haven't tried
> very hard, though), I think it wise to ask knowledgeable people before
> polluting the bug tracker.
> 
> The problem is entirely contained in the attached files.

Hans knows the details of this better than I do at the moment, but your
problem is with the font names: two fonts that are noticeably different
should have different names in order to avoid confusion in the back end.

IIRC, you have to change f.fullname in the second font or, even better,
use f.psname, and use two different ones for that.

Best wishes,
Taco

From rdt at cs.queensu.ca  Wed Apr 20 16:03:15 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 10:03:15 -0400
Subject: [luatex]  lua scripts
Message-ID: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>


> Add the line

  #! /usr/bin/env texlua

  put them under scripts, and create a symlink in bin.

Yes, but what I do for Windows? I can create a bat script but apparently
the full path to the lua script is needed and that would depend on where
the user installs the latter.

Bob T.

From zappathustra at free.fr  Wed Apr 20 16:05:03 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 20 Apr 2011 16:05:03 +0200
Subject: [luatex] Strange behavior with fonts.
In-Reply-To: <4DAEE55C.9030509@elvenkind.com>
References: <4DAEDC2E.9040603@free.fr> <4DAEE55C.9030509@elvenkind.com>
Message-ID: <4DAEE80F.7040705@free.fr>

Le 20/04/2011 15:53, Taco Hoekwater a ?crit :
> Hi,
>
> On 04/20/11 15:14, Paul Isambert wrote:
>>   Hello there,
>>
>> I think I've found a bug, but since I'm still a bit uncomfortable with
>> fonts and I can't reproduce the problem with luaotfload (haven't tried
>> very hard, though), I think it wise to ask knowledgeable people before
>> polluting the bug tracker.
>>
>> The problem is entirely contained in the attached files.
> Hans knows the details of this better than I do at the moment, but your
> problem is with the font names: two fonts that are noticeably different
> should have different names in order to avoid confusion in the back end.
>
> IIRC, you have to change f.fullname in the second font or, even better,
> use f.psname, and use two different ones for that.

Many thanks, Taco. After experimenting a bit, it seems that the font's 
"name" field should be given a unique identifiant, not "psname". The 
simplest way, I suppose, is to increment a counter on each font loading 
and attach it to the name.

Thanks,
Paul

From luatex at nililand.de  Wed Apr 20 16:08:02 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 20 Apr 2011 16:08:02 +0200
Subject: [luatex] Strange behavior with fonts.
References: <4DAEDC2E.9040603@free.fr> <4DAEE55C.9030509@elvenkind.com>
 <4DAEE80F.7040705@free.fr>
Message-ID: <1qghz7uj1znfg.dlg@nililand.de>

Am Wed, 20 Apr 2011 16:05:03 +0200 schrieb Paul Isambert:


>>> I think I've found a bug, but since I'm still a bit uncomfortable with
>>> fonts and I can't reproduce the problem with luaotfload (haven't tried
>>> very hard, though), I think it wise to ask knowledgeable people before
>>> polluting the bug tracker.
>>>
>>> The problem is entirely contained in the attached files.

>> Hans knows the details of this better than I do at the moment, but your
>> problem is with the font names: two fonts that are noticeably different
>> should have different names in order to avoid confusion in the back end.
>>
>> IIRC, you have to change f.fullname in the second font or, even better,
>> use f.psname, and use two different ones for that.

> Many thanks, Taco. After experimenting a bit, it seems that the font's 
> "name" field should be given a unique identifiant, not "psname". The 
> simplest way, I suppose, is to increment a counter on each font loading 
> and attach it to the name.

No idea if it is relevant, but in a discussion about fonts.trigger
Hans wrote in some code:

        -- if we use the font otherwise luatex gets confused so
        -- we return an additional hash value for fullname
             return string.format("reencoded:%s",value)

http://thread.gmane.org/gmane.comp.tex.context/66288/focus=66291


-- 
Ulrike Fischer 


From reinhard.kotucha at web.de  Wed Apr 20 16:15:30 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 20 Apr 2011 16:15:30 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
References: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
Message-ID: <19886.60034.925572.231633@zaphod.ms25.net>

On 2011-04-20 at 10:03:15 -0400, Bob Tennent wrote:

 > > Add the line
 > 
 >   #! /usr/bin/env texlua
 > 
 >   put them under scripts, and create a symlink in bin.
 > 
 > Yes, but what I do for Windows? I can create a bat script but
 > apparently the full path to the lua script is needed and that would
 > depend on where the user installs the latter.

cd bin\win32
copy /b runscript.exe script.exe

At least if your script is called script.lua and you have TeX Live.
These things are explained in bin\win32\runscript.tlu .

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Wed Apr 20 16:21:09 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 20 Apr 2011 16:21:09 +0200
Subject: [luatex] Strange behavior with fonts.
In-Reply-To: <1qghz7uj1znfg.dlg@nililand.de>
References: <4DAEDC2E.9040603@free.fr> <4DAEE55C.9030509@elvenkind.com>
 <4DAEE80F.7040705@free.fr> <1qghz7uj1znfg.dlg@nililand.de>
Message-ID: <4DAEEBD5.3020501@free.fr>

Le 20/04/2011 16:08, Ulrike Fischer a ?crit :
> Am Wed, 20 Apr 2011 16:05:03 +0200 schrieb Paul Isambert:
>
>
>>>> I think I've found a bug, but since I'm still a bit uncomfortable with
>>>> fonts and I can't reproduce the problem with luaotfload (haven't tried
>>>> very hard, though), I think it wise to ask knowledgeable people before
>>>> polluting the bug tracker.
>>>>
>>>> The problem is entirely contained in the attached files.
>>> Hans knows the details of this better than I do at the moment, but your
>>> problem is with the font names: two fonts that are noticeably different
>>> should have different names in order to avoid confusion in the back end.
>>>
>>> IIRC, you have to change f.fullname in the second font or, even better,
>>> use f.psname, and use two different ones for that.
>> Many thanks, Taco. After experimenting a bit, it seems that the font's
>> "name" field should be given a unique identifiant, not "psname". The
>> simplest way, I suppose, is to increment a counter on each font loading
>> and attach it to the name.
> No idea if it is relevant, but in a discussion about fonts.trigger
> Hans wrote in some code:
>
>          -- if we use the font otherwise luatex gets confused so
>          -- we return an additional hash value for fullname
>               return string.format("reencoded:%s",value)
>
> http://thread.gmane.org/gmane.comp.tex.context/66288/focus=66291

fullname seems relevant and what I've written is insufficient: either 
only name is unique and fullname is nil, or both exist and are unique; 
that's what I've found so far.

Best,
Paul

From rdt at cs.queensu.ca  Wed Apr 20 18:20:25 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 12:20:25 -0400
Subject: [luatex] lua scripts
In-Reply-To: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
References: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
Message-ID: <4daf07c9.11UO0eZd/jlqOyh6%rdt@cs.queensu.ca>

 >|> Add the line
 >|
 >|  #! /usr/bin/env texlua
 >|
 >|  put them under scripts, and create a symlink in bin.
 >|
 >|Yes, but what I do for Windows? I can create a bat script but apparently
 >|the full path to the lua script is needed and that would depend on where
 >|the user installs the latter.

> cd bin\win32
  copy /b runscript.exe script.exe

  At least if your script is called script.lua and you have TeX Live.

But not if the user has MikTeX.  

Lua scripts seem to fall between the executable PATH and the kpse
system.  Why shouldn't lua scripts be treated as data for texlua?

Bob T.

From reinhard.kotucha at web.de  Wed Apr 20 19:22:16 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 20 Apr 2011 19:22:16 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4daf07c9.11UO0eZd/jlqOyh6%rdt@cs.queensu.ca>
References: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
 <4daf07c9.11UO0eZd/jlqOyh6%rdt@cs.queensu.ca>
Message-ID: <19887.5704.607278.930482@zaphod.ms25.net>

On 2011-04-20 at 12:20:25 -0400, Bob Tennent wrote:

 >  >|> Add the line
 >  >|
 >  >|  #! /usr/bin/env texlua
 >  >|
 >  >|  put them under scripts, and create a symlink in bin.
 >  >|
 >  >|Yes, but what I do for Windows? I can create a bat script but apparently
 >  >|the full path to the lua script is needed and that would depend on where
 >  >|the user installs the latter.
 > 
 > > cd bin\win32
 >   copy /b runscript.exe script.exe
 > 
 >   At least if your script is called script.lua and you have TeX Live.
 > 
 > But not if the user has MikTeX.  

In this case you have to put it into a directory which is in PATH and
assign the extension .lua to the texlua binary in the registry.  I'm
wondering whether MiKTeX does this already.  You can check with the
programs assoc and ftype.

BTW, this might cause trouble if you have Lua intalled too, thus TeX
Live supports the extensions .tlu and .texlua too.

 > Lua scripts seem to fall between the executable PATH and the kpse
 > system.  

No, they don't fall between anything.  They are scripts end their
interpreter has kpathsea built in.

 > Why shouldn't lua scripts be treated as data for texlua?

Because they are scripts and have to be treated so.  I don't want to
specify the interpreter on the command line each time I run my
scripts.  But you can call the scripts from .tex files.  I this case
they are found in TEXMF.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From dpl at sun.ac.za  Wed Apr 20 19:43:21 2011
From: dpl at sun.ac.za (Dirk Laurie)
Date: Wed, 20 Apr 2011 19:43:21 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4daed8b3.q1SJZySGnuxNMCGh%rdt@cs.queensu.ca>
References: <4daed8b3.q1SJZySGnuxNMCGh%rdt@cs.queensu.ca>
Message-ID: <20110420174321.GA2665@rondloper>

On Wed, Apr 20, 2011 at 02:59:31PM +0200, Bob Tennent wrote:
> 
> Hi. Where in a texmf tree should lua scripts go so that texlua will find
> them? I want to say
> 
>  > texlua script.lua
> 
> where script.lua is in a texmf tree; but where?
> 
> I've tried under scripts and under tex/luatex.
> 
> Bob T.
> 

There are quite a few options.  See below.

Dirk

$ kpsewhich -show-path lua
.:/home/dirk/.texmf-config/scripts/kpsewhich/lua//:/home/dirk/.texmf-var/scripts/kpsewhich/lua//:/home/dirk/texmf/scripts/kpsewhich/lua//:/etc/texmf/scripts/kpsewhich/lua//:!!/var/lib/texmf/scripts/kpsewhich/lua//:!!/usr/local/share/texmf/scripts/kpsewhich/lua//:!!/usr/share/texmf/scripts/kpsewhich/lua//:!!/usr/share/texmf-texlive/scripts/kpsewhich/lua//:/home/dirk/.texmf-config/scripts/unset/lua//:/home/dirk/.texmf-var/scripts/unset/lua//:/home/dirk/texmf/scripts/unset/lua//:/etc/texmf/scripts/unset/lua//:!!/var/lib/texmf/scripts/unset/lua//:!!/usr/local/share/texmf/scripts/unset/lua//:!!/usr/share/texmf/scripts/unset/lua//:!!/usr/share/texmf-texlive/scripts/unset/lua//:/home/dirk/.texmf-config/scripts//lua//:/home/dirk/.texmf-var/scripts//lua//:/home/dirk/texmf/scripts//lua//:/etc/texmf/scripts//lua//:!!/var/lib/texmf/scripts//lua//:!!/usr/local/share/texmf/scripts//lua//:!!/usr/share/texmf/scripts//lua//:!!/usr/share/texmf-texlive/scripts//lua//


From rdt at cs.queensu.ca  Wed Apr 20 20:20:10 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 14:20:10 -0400
Subject: [luatex]  lua scripts
Message-ID: <4daf23da.4/oQvj5RnTKPjasE%rdt@cs.queensu.ca>

> There are quite a few options.  

  $ kpsewhich -show-path lua

I moved the relevant lua scripts below texmf/scripts/lua and now
kpsewhich reports that it can find them.  But when I do

  texlua script.lua ...

texlua says it can't.  

Bob T.

From t34www at googlemail.com  Wed Apr 20 21:42:59 2011
From: t34www at googlemail.com (T T)
Date: Wed, 20 Apr 2011 20:42:59 +0100
Subject: [luatex] lua scripts
In-Reply-To: <4daf07c9.11UO0eZd/jlqOyh6%rdt@cs.queensu.ca>
References: <4daee7a3.G7UJNadhVqRnh9fo%rdt@cs.queensu.ca>
 <4daf07c9.11UO0eZd/jlqOyh6%rdt@cs.queensu.ca>
Message-ID: <BANLkTikXBp8ExOEKz4d37S_KrJhK83sMEA@mail.gmail.com>

On 20 April 2011 17:20, Bob Tennent <rdt at cs.queensu.ca> wrote:
>
>> cd bin\win32
> ?copy /b runscript.exe script.exe
>
> ?At least if your script is called script.lua and you have TeX Live.
>
> But not if the user has MikTeX.

Ask on the MikTeX list.  AFAIR, MikTeX automatically creates exe stubs
for perl and batch scripts located under <TEXMF>/scripts.  I wouldn't
be surprised if the same is done for (TeX)Lua scripts.  If you have
MikTeX, just put the script in the right place, run mktexlsr (or
whatever the MikTeX's equivalent is called) and check the bin dir for
the stub.

Cheers,

Tomek


From t34www at googlemail.com  Wed Apr 20 21:48:16 2011
From: t34www at googlemail.com (T T)
Date: Wed, 20 Apr 2011 20:48:16 +0100
Subject: [luatex] lua scripts
In-Reply-To: <4daf23da.4/oQvj5RnTKPjasE%rdt@cs.queensu.ca>
References: <4daf23da.4/oQvj5RnTKPjasE%rdt@cs.queensu.ca>
Message-ID: <BANLkTimGuW2vcV0MKERo9E-kF7k25Ox=Dg@mail.gmail.com>

On 20 April 2011 19:20, Bob Tennent <rdt at cs.queensu.ca> wrote:
>> There are quite a few options.
>
> ?$ kpsewhich -show-path lua
>
> I moved the relevant lua scripts below texmf/scripts/lua and now
> kpsewhich reports that it can find them. ?But when I do
>
> ?texlua script.lua ...
>
> texlua says it can't.

Taco, correct me if I'm wrong, but that's because texlua by itself
does not initialize kpathsea, only luatex does.  Or to be more
precise, kpathsea is not initialized when you run the engine in the
lua-interpreter mode.

Cheers,

Tomek


From rdt at cs.queensu.ca  Wed Apr 20 22:26:06 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 16:26:06 -0400
Subject: [luatex]  lua scripts
Message-ID: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>


> Ask on the MikTeX list.

I did. They sent me here.

> AFAIR, MikTeX automatically creates exe stubs
  for perl and batch scripts located under <TEXMF>/scripts.  I wouldn't
  be surprised if the same is done for (TeX)Lua scripts.

That would seem sensible. But it doesn't happen if you just put a lua
script under <TEXMF>/scripts and hit "Refresh FNDB"; perhaps it happens
when a MikTeX package is being put together.

Bob T.

From t34www at googlemail.com  Thu Apr 21 00:03:32 2011
From: t34www at googlemail.com (T T)
Date: Wed, 20 Apr 2011 23:03:32 +0100
Subject: [luatex] lua scripts
In-Reply-To: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
References: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
Message-ID: <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>

On 20 April 2011 21:26, Bob Tennent <rdt at cs.queensu.ca> wrote:
>
>> Ask on the MikTeX list.
>
> I did. They sent me here.

Who did?  Odd advice.  We are not developing MikTeX.  I can tell you
all about script wrapping in TeX Live, but not in MikTeX.  This is not
something standardized, like TDS.

>
>> AFAIR, MikTeX automatically creates exe stubs
> ?for perl and batch scripts located under <TEXMF>/scripts. ?I wouldn't
> ?be surprised if the same is done for (TeX)Lua scripts.
>
> That would seem sensible. But it doesn't happen if you just put a lua
> script under <TEXMF>/scripts and hit "Refresh FNDB"; perhaps it happens
> when a MikTeX package is being put together.

I just tried, it doesn't seem to work even for perl / batch scripts.
Maybe I remember it wrong.

Anyway, on MikTeX 2.9 the following batch works (should be a single
line in case it gets broken):

  @for /f "delims=" %%I in ('kpsewhich --format=texmfscripts
%~n0.lua') do texlua %%I %*

(If you save it as foo.bat, it will search and launch foo.lua script.)

Cheers,

Tomek


From preining at logic.at  Thu Apr 21 00:48:53 2011
From: preining at logic.at (Norbert Preining)
Date: Thu, 21 Apr 2011 07:48:53 +0900
Subject: [luatex] lua scripts
In-Reply-To: <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
References: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
 <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
Message-ID: <20110420224853.GB18429@gamma.logic.tuwien.ac.at>

On Mi, 20 Apr 2011, T T wrote:
> Who did?  Odd advice.  We are not developing MikTeX.  I can tell you
> all about script wrapping in TeX Live, but not in MikTeX.  This is not
> something standardized, like TDS.

Hehe, I would have expected that the MikTeX list/dev(s) know *much*
better about the peculiarities of Windows. Not very convincing aspect
of Miktex.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
YADDLETHORPE (vb.)
(Of offended pooves.) To exit huffily from a boutique.
			--- Douglas Adams, The Meaning of Liff

From reinhard.kotucha at web.de  Thu Apr 21 02:56:53 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 21 Apr 2011 02:56:53 +0200
Subject: [luatex] lua scripts
In-Reply-To: <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
References: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
 <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
Message-ID: <19887.32981.637898.325513@zaphod.ms25.net>

On 2011-04-20 at 23:03:32 +0100, T T wrote:

 > On 20 April 2011 21:26, Bob Tennent <rdt at cs.queensu.ca> wrote:
 > >
 > >> Ask on the MikTeX list.
 > >
 > > I did. They sent me here.
 > 
 > Who did?  Odd advice.  We are not developing MikTeX.  I can tell you
 > all about script wrapping in TeX Live, but not in MikTeX.  This is not
 > something standardized, like TDS.
 > 
 > >
 > >> AFAIR, MikTeX automatically creates exe stubs
 > > ?for perl and batch scripts located under <TEXMF>/scripts. ?I wouldn't
 > > ?be surprised if the same is done for (TeX)Lua scripts.
 > >
 > > That would seem sensible. But it doesn't happen if you just put a lua
 > > script under <TEXMF>/scripts and hit "Refresh FNDB"; perhaps it happens
 > > when a MikTeX package is being put together.
 > 
 > I just tried, it doesn't seem to work even for perl / batch scripts.
 > Maybe I remember it wrong.
 > 
 > Anyway, on MikTeX 2.9 the following batch works (should be a single
 > line in case it gets broken):
 > 
 >   @for /f "delims=" %%I in ('kpsewhich --format=texmfscripts
 > %~n0.lua') do texlua %%I %*
 > 
 > (If you save it as foo.bat, it will search and launch foo.lua script.)

Bob, is your question related to the texlua scripts you just uploaded
to CTAN?

It's great that you ported the system-dependent programs to texlua.  
I suppose that musixflex can only be replaced when TeX Live is frozen
because the binaries have to be removed.

Regarding MiKTeX, I recommend to ask Christian Schenk directly.
I don't think that MiKTeX users can be convinced to install the
scripts and create wrappers themselves.

BTW, in musixtex.lua:

 print("This is musixtex.lua.")

I would add the version number here.

 tex = "etex "  -- can replace etex by epdftex if not using Postscript slurs

s/epdftex/pdfetex/

If you want encourage people to modify the source code, it's better
not to rely on the space in the tex variable.  It's better to write

os.execute(tex .. " " .. basename)

It would be better to allow people to specify an alternative engine on
the command line instead of changing the code.

Is it necessary to disallow users to enter the file name properly?
IMO it's bad enough that TeX allows to omit the extension.

Instead of 

  basename = arg[1]
  io.open(basename .. ".tex", "r")
  os.execute(tex .. basename)
  
you can simply write:

  io.open(arg[1], "r")
  os.execute(tex .. " " .. arg[1])
  
In order to create the .ps and .pdf names, you can strip the extension
".tex" if it exists.

BTW, there is a manual page for musixflx in TeX Live.  I fear that it
gets lost if you don't copy it to the CTAN package.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From rdt at cs.queensu.ca  Thu Apr 21 04:33:02 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 22:33:02 -0400
Subject: [luatex]  lua scripts
Message-ID: <4daf975e.jwacKw9XTJg5xvUv%rdt@cs.queensu.ca>

>> Ask on the MikTeX list.
>
> I did. They sent me here.

> Who did?  Odd advice.  We are not developing MikTeX.  I can tell you
  all about script wrapping in TeX Live, but not in MikTeX.  This is not
  something standardized, like TDS.

My initial question was interpreted as a luatex/texlua issue, for which
this is the appropriate list.

> Anyway, on MikTeX 2.9 the following batch works (should be a single
  line in case it gets broken):

    @for /f "delims=" %%I in ('kpsewhich --format=texmfscripts
     %~n0.lua') do texlua %%I %*

  (If you save it as foo.bat, it will search and launch foo.lua script.)

Thanks. For the record, this fails if a file name on the path has a
blank, such as Documents and Settings. Adding quotes around the second
occurrence of %%I fixes this. 

Will this batch script work on non-MikTeX Windows, such as TeXLive? I
know that MikTeX and TeXLive will wrap lua scripts in their packages.
But a package at CTAN might be installed "privately" and so I think a
generic wrapper script has to be provided for Windows users (who can't
use the #! trick).

Bob T.

From rdt at cs.queensu.ca  Thu Apr 21 04:41:56 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Wed, 20 Apr 2011 22:41:56 -0400
Subject: [luatex]  lua scripts
Message-ID: <4daf9974.Azju6xZ7Gvx9pVxG%rdt@cs.queensu.ca>

> It would be better to allow people to specify an alternative engine on
  the command line instead of changing the code.

  Is it necessary to disallow users to enter the file name properly?

To get the lua scripts into texlive-2011, I had to rush.  I'll refine
the musixtex.lua script. 

> BTW, there is a manual page for musixflx in TeX Live.  I fear that it
  gets lost if you don't copy it to the CTAN package.

It needs revision. I'll get to it ASAP.

Thanks for the suggestions.

Bob T.

From taco at elvenkind.com  Thu Apr 21 07:19:40 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 21 Apr 2011 07:19:40 +0200
Subject: [luatex] lua scripts
In-Reply-To: <BANLkTimGuW2vcV0MKERo9E-kF7k25Ox=Dg@mail.gmail.com>
References: <4daf23da.4/oQvj5RnTKPjasE%rdt@cs.queensu.ca>
 <BANLkTimGuW2vcV0MKERo9E-kF7k25Ox=Dg@mail.gmail.com>
Message-ID: <4DAFBE6C.2070209@elvenkind.com>



On 04/20/11 21:48, T T wrote:
> On 20 April 2011 19:20, Bob Tennent <rdt at cs.queensu.ca> wrote:
>>> There are quite a few options.
>>
>>  $ kpsewhich -show-path lua
>>
>> I moved the relevant lua scripts below texmf/scripts/lua and now
>> kpsewhich reports that it can find them.  But when I do
>>
>>  texlua script.lua ...
>>
>> texlua says it can't.
> 
> Taco, correct me if I'm wrong, but that's because texlua by itself
> does not initialize kpathsea, only luatex does.  Or to be more
> precise, kpathsea is not initialized when you run the engine in the
> lua-interpreter mode.

True.

Best wishes,
Taco

From luatex at nililand.de  Thu Apr 21 09:58:31 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 21 Apr 2011 09:58:31 +0200
Subject: [luatex] lua scripts
References: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
 <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
Message-ID: <10q08rvlay3c1$.dlg@nililand.de>

Am Wed, 20 Apr 2011 23:03:32 +0100 schrieb T T:

>>> Ask on the MikTeX list.

>> I did. They sent me here.
 
> Who did?  Odd advice.  We are not developing MikTeX.  I can tell you
> all about script wrapping in TeX Live, but not in MikTeX.  This is not
> something standardized, like TDS.

I did. And I did because the first question was simply how texlua
finds the files not how to make stubs for scripts in miktex.

>>>  AFAIR, MikTeX automatically creates exe stubs
>>> ?for perl and batch scripts located under <TEXMF>/scripts. ?I wouldn't
>>> ?be surprised if the same is done for (TeX)Lua scripts.

>> That would seem sensible. But it doesn't happen if you just put a lua
>> script under <TEXMF>/scripts and hit "Refresh FNDB"; perhaps it happens
>> when a MikTeX package is being put together.
 
> I just tried, it doesn't seem to work even for perl / batch scripts.
> Maybe I remember it wrong.

I investigated a bit. 

Miktex has in its bin-folder various .exe which are wrappers to call
scripts, e.g. 

mkluatexfontdb.exe= texlua mkluatexfontdb.lua
makeglossaries.exe= perl makeglossaries
ps2pdfxx.exe      =  ps2pdfxx.bat

There exist a scripts.ini in miktex/config which contains the pathes
to the actual scripts. E.g.

[perl]
makeglossaries=scripts/glossaries/makeglossaries

I also found in miktex\bin\internal applications called runperl.exe,
runtexlua.exe and runbat.exe.

One can rename copy runperl.exe to temporary folder and rename it to
makeglossaries.exe and it will behave like the original
makeglossaries, runmtxrun.exe renamed to context.exe works like
context.

But I don't know how to make new wrappers with this applications.
The scripts.ini file is signed and if one tries to add a line for
e.g. a mycontext.exe one get errors:

mycontext: Damaged configuration file.
mycontext: Data: J:\MiKTeX2.9\miktex\config\scripts.ini:232: the
file has been tampered with. 

Miktex also doesn't use "local" scripts.ini. Only the one in the
main tree (in a single user installation) is used. So I think one
would have to ask Christian if and how one can add own scripts.


-- 
Ulrike Fischer 


From t34www at googlemail.com  Thu Apr 21 15:22:35 2011
From: t34www at googlemail.com (T T)
Date: Thu, 21 Apr 2011 14:22:35 +0100
Subject: [luatex] lua scripts
In-Reply-To: <4daf975e.jwacKw9XTJg5xvUv%rdt@cs.queensu.ca>
References: <4daf975e.jwacKw9XTJg5xvUv%rdt@cs.queensu.ca>
Message-ID: <BANLkTi=7v6p2v6jwv2omgVO+_eq33PDKXA@mail.gmail.com>

On 21 April 2011 03:33, Bob Tennent <rdt at cs.queensu.ca> wrote:
>
> Will this batch script work on non-MikTeX Windows, such as TeXLive? I

It will.  I tried also on MikTeX 2.7 and it works there too, so
chances are it will also work on older versions.

> know that MikTeX and TeXLive will wrap lua scripts in their packages.
> But a package at CTAN might be installed "privately" and so I think a
> generic wrapper script has to be provided for Windows users (who can't
> use the #! trick).

In that case I would first check the current directory for the script
and then search with kpsewhich.  I would suggest something like this:

  @setlocal
  @set script=
  @if exist "%~dpn0.lua" set script="%~dpn0.lua"
  @if not defined script for /f "delims=" %%I in ('kpsewhich
--format=texmfscripts %~n0.tlu') do @set script="%%I"
  @if not defined script goto :scriptnotfound
  @texlua %script% %*
  @goto :eof
  :scriptnotfound
  @echo script not found: %~n0.lua 1>&2
  @exit /b 1

Cheers,

Tomek

From t34www at googlemail.com  Thu Apr 21 15:27:24 2011
From: t34www at googlemail.com (T T)
Date: Thu, 21 Apr 2011 14:27:24 +0100
Subject: [luatex] lua scripts
In-Reply-To: <10q08rvlay3c1$.dlg@nililand.de>
References: <4daf415e.T9G+GIl0/dSnsWWX%rdt@cs.queensu.ca>
 <BANLkTi=cJfzqcKyO20A5jpv4_i_t1ji=nA@mail.gmail.com>
 <10q08rvlay3c1$.dlg@nililand.de>
Message-ID: <BANLkTi=pEt1jT2SrEPh8mX20=C5Q=mAKxw@mail.gmail.com>

On 21 April 2011 08:58, Ulrike Fischer <luatex at nililand.de> wrote:
> Am Wed, 20 Apr 2011 23:03:32 +0100 schrieb T T:
>
> I did. And I did because the first question was simply how texlua
> finds the files not how to make stubs for scripts in miktex.

Fair enough.

>
>> I just tried, it doesn't seem to work even for perl / batch scripts.
>> Maybe I remember it wrong.
>
> I investigated a bit.

Thanks for your investigations.

> One can rename copy runperl.exe to temporary folder and rename it to
> makeglossaries.exe and it will behave like the original
> makeglossaries, runmtxrun.exe renamed to context.exe works like
> context.
>
> But I don't know how to make new wrappers with this applications.
> The scripts.ini file is signed and if one tries to add a line for
> e.g. a mycontext.exe one get errors:

Seems pretty locked down.

> So I think one
> would have to ask Christian if and how one can add own scripts.

Indeed.

Cheers,

Tomek

From reinhard.kotucha at web.de  Fri Apr 22 00:11:11 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 22 Apr 2011 00:11:11 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4daf9974.Azju6xZ7Gvx9pVxG%rdt@cs.queensu.ca>
References: <4daf9974.Azju6xZ7Gvx9pVxG%rdt@cs.queensu.ca>
Message-ID: <19888.43903.777968.771496@zaphod.ms25.net>

On 2011-04-20 at 22:41:56 -0400, Bob Tennent wrote:

 > > It would be better to allow people to specify an alternative engine on
 >   the command line instead of changing the code.
 > 
 >   Is it necessary to disallow users to enter the file name properly?
 > 
 > To get the lua scripts into texlive-2011, I had to rush.  I'll refine
 > the musixtex.lua script. 

There is no need to hurry.  Even when the TL updater is turned off,
packages from CTAN will still be included.  Updating of CTAN packages
ceases when test images are provided, so there is still a lot of time.

I just see that in your CTAN package there is a file

   fonts/map/dvipdfm/musixtex/musix.map

which is waste.  map files for dvipdfm have never been used.  Instead,
updmap creates dvipdfm.map automatically from the files in
fonts/map/dvips and fonts/map/pdftex.  The TeX Live 2011 version of
updmap will not create a dvipdfm.map file because there is no program
anymore which uses it.  dvipdfm is a symlink to dvipdfmx, and the
latter understands pdftex.map.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From rdt at cs.queensu.ca  Fri Apr 22 14:36:08 2011
From: rdt at cs.queensu.ca (Bob Tennent)
Date: Fri, 22 Apr 2011 08:36:08 -0400
Subject: [luatex]  lua scripts
Message-ID: <4db17638.TcjcCUPgnbJ5MOpB%rdt@cs.queensu.ca>

 >| > > It would be better to allow people to specify an alternative
 >| engine on
 >| >   the command line instead of changing the code.
 >| >
 >| >   Is it necessary to disallow users to enter the file name properly?
 >| >
 >| > To get the lua scripts into texlive-2011, I had to rush.  I'll refine
 >| > the musixtex.lua script.
 >|
 >|There is no need to hurry.  Even when the TL updater is turned off,
 >|packages from CTAN will still be included.  Updating of CTAN packages
 >|ceases when test images are provided, so there is still a lot of time.

Reinhard: An off-list message from Karl led me to think a change from
compiled binary and shell script to lua scripts *was* urgent (one week
was mentioned). In any case, I've implemented all your suggestions (for
which I thank you) and the revised versions are now at CTAN.

 >|I just see that in your CTAN package there is a file
 >|
 >|   fonts/map/dvipdfm/musixtex/musix.map
 >|
 >|which is waste.  map files for dvipdfm have never been used.  Instead,
 >|updmap creates dvipdfm.map automatically from the files in
 >|fonts/map/dvips and fonts/map/pdftex.  The TeX Live 2011 version of
 >|updmap will not create a dvipdfm.map file because there is no program
 >|anymore which uses it.  dvipdfm is a symlink to dvipdfmx, and the
 >|latter understands pdftex.map.

TeXLive isn't the *only* consumer of CTAN files. The dvipdfm map was in
the upstream bundle and presumably dvipdfm is used by some musixtex-ers.
The map file could be omitted from TeXLive if it's useless there.

Bob T.

From reinhard.kotucha at web.de  Sat Apr 23 01:52:33 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 23 Apr 2011 01:52:33 +0200
Subject: [luatex] lua scripts
In-Reply-To: <4db17638.TcjcCUPgnbJ5MOpB%rdt@cs.queensu.ca>
References: <4db17638.TcjcCUPgnbJ5MOpB%rdt@cs.queensu.ca>
Message-ID: <19890.5313.190989.115562@zaphod.ms25.net>

On 2011-04-22 at 08:36:08 -0400, Bob Tennent wrote:

 > >|I just see that in your CTAN package there is a file
 > >|
 > >|   fonts/map/dvipdfm/musixtex/musix.map
 > >|
 > >|which is waste.  map files for dvipdfm have never been used.
 > >|Instead, updmap creates dvipdfm.map automatically from the files
 > >|in fonts/map/dvips and fonts/map/pdftex.  The TeX Live 2011
 > >|version of updmap will not create a dvipdfm.map file because
 > >|there is no program anymore which uses it.  dvipdfm is a symlink
 > >|to dvipdfmx, and the latter understands pdftex.map.
 
Hi Bob,

 > TeXLive isn't the *only* consumer of CTAN files. 

whenever I talk about CTAN packages, I'm aware that there are other
distributions than TeX Live and I have them in mind.

 > The dvipdfm map was in the upstream bundle and presumably dvipdfm
 > is used by some musixtex-ers.

dvipdfm never used these files and dvipdfm.map was always created
automatically from the same sources as psfonts.map and pdftex.map.

If there would be any TeX distribution which needs these files, then
dvipdfm won't work anyway because there are only very few of these map
files on CTAN.  There had been zillions of fonts on CTAN already when
the author of dvipdfm decided to invent his own, deliberately
incompatible, map-file format.

 > The map file could be omitted from TeXLive if it's useless there.

In principle, yes.  But it can be done only semi-automatically.  It's
necessary to add some code to the scripts in order to process your
package properly.  And whenever your package is updated, the scripts
say that files have been rejected and it's necessary to check whether
this is ok or whether you moved files around and the scripts must be
adapted.

It would be better not to upload superfluous files to CTAN.  I just
ran

  find tex-archive -type d -name dvipdfm 

on my CTAN mirror.  It didn't find much, most of the font related
things are only in .zip files.  But the first thing that was found is:

  tex-archive/language/georgian/texmf-local/fonts/map/dvipdfm/djg.map 

I loaded this file into a text editor, and, SIGH, this file is only
understood by dvips and pdftex, but definiteley not by dvipdfm, as the
directory name implies.  

Please note that this was only the first file in a dvipdfm directory I
found on CTAN!  I didn't look into the others and I didn't look into
all the .zip files.

This means that one cannot rely on file/directory names at all, one
has to look into each file in order to be absolutely sure.  But this
is impossible:

$ find /usr/local/texlive/2010 -type f | wc -l
96781

It's obvious now that any superfluous file on CTAN causes a lot of
avoidable trouble, isn't it?

Your package contains two different map files with the same name in
different directories.  This is always problematic.  It's even more
problematic because names of map files are always supposed to be
unique.  A file foo.map is either in fonts/map/dvips *or* in
fonts/map/pdftex, but never in both.  Thus, if someone writes a
consistency checker, it will always stumble over your package.

Certainly, the easiest way to put something on CTAN is to include
everything you don't know what it's good for and let things be sorted
out by others.  But according to the TeX Catalogue, abt. 1800 people
uploaded stuff to CTAN, and there is only one who sorts things out in
order to get the stuff into TeX distributions.  

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From till.heilmann at unibas.ch  Wed Apr 27 14:05:24 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Wed, 27 Apr 2011 14:05:24 +0200
Subject: [luatex] Kerning: when does it not work?
Message-ID: <55818EF7-78B3-4414-8559-3D6B0558666A@unibas.ch>

I am trying to understand--as a mere user, I must confess--exactly when and why kerning (or, to be more precise, my own adjustments to the kerning of a given OpenType font made in an OTF feature file) does _not_ work.

In the last couple of weeks, I?ve received excellent advice from the community and was able to solve a few of my problems. But some problems persist and I keep stumbling over new ones. For example, customized kerning does not work at some positions in URLs typeset with the url package and is also suppressed at some positions of citations and bibliographic entries generated by biblatex (see minimal example below).

>From Khaled Hosny, Ulrike Fischer, Philipp Lehmann and others I learn that a fundamental issue (if not the _one_ cause for all the seemingly diverse problems I encounter) is the existence of penalized breakpoints: Even if no line breaking occurs the kerning is suppressed at that point. Philipp told me that this was a long-standing limitation of TeX that apparently has not been lifted in LuaTeX.

My--fairly general--question is whether I am indeed dealing here with various implications of a single cause within the code of (Lua)TeX and, if yes, if there is any chance of this being addressed in the foreseeable future.

I don't want to sound ungrateful considering the developer's fantastic commitment and the immense work the whole community is putting into (Lua)TeX and its diverse packages. It is simply driving me crazy that I have such a powerful and sophisticated tool for digital typesetting at hand and still I cannot get something as (typographically) fundamental as customized kerning to work. Unfortunately, one cannot always choose the fonts used in a document and many (if not most) professional fonts contain some really poor kern pairs that have to be corrected.

Thanks and best regards
--Till

\begin{filecontents*}{test.bib}
@article{stiegler.b:2009,
  Author = {Bernard Stiegler},
  Journal = {Theory, Culture~\& Society},
  Number = {2?3},
  Pages = {33-45},
  Title = {Teleologics of the Snail},
  Volume = {26},
  Year = {2009}}
\end{filecontents*}
\begin{filecontents*}{mybonum.fea}
languagesystem DFLT dflt ;
languagesystem latn dflt ;
feature kern {
  pos six slash 100 ;
  pos slash two 100 ;
  pos colon slash 100 ;
  pos slash slash -150 ;
} kern ;
\end{filecontents*}
\documentclass{article}
\usepackage{url}
\urlstyle{same}
\usepackage{fontspec}
\usepackage[ngerman]{babel}
\setmainfont[FeatureFile=mybonum.fea]{TeX Gyre Bonum}
\usepackage[style=authortitle-dw,backend=biber]{biblatex}
\bibliography{test}
\makeatletter
\renewcommand*{\jourvolnumsep}{/}
\makeatother
\begin{document}
\fullcite{stiegler.b:2009} 6/2\par
http:// \url{http://}
\end{document}

From zappathustra at free.fr  Thu Apr 28 19:27:26 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 28 Apr 2011 19:27:26 +0200
Subject: [luatex] Kerning: when does it not work?
In-Reply-To: <55818EF7-78B3-4414-8559-3D6B0558666A@unibas.ch>
References: <55818EF7-78B3-4414-8559-3D6B0558666A@unibas.ch>
Message-ID: <4DB9A37E.7010806@free.fr>

Le 27/04/2011 14:05, Heilmann, Till A. a ?crit :
> I am trying to understand--as a mere user, I must confess--exactly when and why kerning (or, to be more precise, my own adjustments to the kerning of a given OpenType font made in an OTF feature file) does _not_ work.
>
> In the last couple of weeks, I?ve received excellent advice from the community and was able to solve a few of my problems. But some problems persist and I keep stumbling over new ones. For example, customized kerning does not work at some positions in URLs typeset with the url package and is also suppressed at some positions of citations and bibliographic entries generated by biblatex (see minimal example below).
>
> > From Khaled Hosny, Ulrike Fischer, Philipp Lehmann and others I learn that a fundamental issue (if not the _one_ cause for all the seemingly diverse problems I encounter) is the existence of penalized breakpoints: Even if no line breaking occurs the kerning is suppressed at that point. Philipp told me that this was a long-standing limitation of TeX that apparently has not been lifted in LuaTeX.
>
> My--fairly general--question is whether I am indeed dealing here with various implications of a single cause within the code of (Lua)TeX and, if yes, if there is any chance of this being addressed in the foreseeable future.
>
> I don't want to sound ungrateful considering the developer's fantastic commitment and the immense work the whole community is putting into (Lua)TeX and its diverse packages. It is simply driving me crazy that I have such a powerful and sophisticated tool for digital typesetting at hand and still I cannot get something as (typographically) fundamental as customized kerning to work. Unfortunately, one cannot always choose the fonts used in a document and many (if not most) professional fonts contain some really poor kern pairs that have to be corrected.

Two remarks (unfortunately you haven't had many answers...):

- Contrary to what might be implied (or simply misunderstood by me) in 
your last remark, penalties (and by the way \special's and whatever is 
between two glyphs) affect all font kerns, not only those you set by 
yourself in a feature file;
- There exists a solution: add the kerns by yourself; this means 
browsing a list of nodes, and for each pair of contiguous nodes, insert 
a kern if required in the font, where /contiguous/ means next to each 
other or separated by such things as penalties, specials, etc.

Best,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110428/756612c9/attachment.html>

From zappathustra at free.fr  Thu Apr 28 23:57:01 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 28 Apr 2011 23:57:01 +0200
Subject: [luatex] Strange behavior of tex.print.
Message-ID: <4DB9E2AD.6000504@free.fr>

Hello there,

The manual states about tex.print(n, <strings>) that ``if n is not a 
valid catcode table, then it is ignored, and the currently active 
catcode regime is used instead.'' However (with catcode table 1 not 
initialized):

tex.print(1, "a", "\relax")

returns ``aflflelax'' (with the ``fl'' ligature, i.e. character 13 in 
CM). So: is that a bug, an inaccuracy in the manual, or have I 
misunderstood something? My LuaTeX is v.0.66.

Best,
Paul

From patrick at gundla.ch  Fri Apr 29 07:46:06 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 29 Apr 2011 07:46:06 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <4DB9E2AD.6000504@free.fr>
References: <4DB9E2AD.6000504@free.fr>
Message-ID: <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>

Hi Paul,

> The manual states about tex.print(n, <strings>) that ``if n is not a valid catcode table, then it is ignored, and the currently active catcode regime is used instead.'' However (with catcode table 1 not initialized):
> 
> tex.print(1, "a", "\relax")
> 
> returns ``aflflelax'' (with the ``fl'' ligature, i.e. character 13 in CM). So: is that a bug, an inaccuracy in the manual, or have I misunderstood something? My LuaTeX is v.0.66.

I am not awake yet: isn't this due to the single backslash? \r = 13 so that the chars 97,13,101,... get printed. I can't explain the f before the e, so my attempt is probably wrong.

Patrick



From luatex at nililand.de  Fri Apr 29 09:25:46 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 29 Apr 2011 09:25:46 +0200
Subject: [luatex] Strange behavior of tex.print.
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
Message-ID: <1d0x0unskr927$.dlg@nililand.de>

Am Fri, 29 Apr 2011 07:46:06 +0200 schrieb Patrick Gundlach:

> Hi Paul,
 
>> The manual states about tex.print(n, <strings>) that ``if n is
>> not a valid catcode table, then it is ignored, and the currently
>> active catcode regime is used instead.'' However (with catcode
>> table 1 not initialized):

>> tex.print(1, "a", "\relax")
 
>> returns ``aflflelax'' (with the ``fl'' ligature, i.e. character
>> 13 in CM). So: is that a bug, an inaccuracy in the manual, or
>> have I misunderstood something? My LuaTeX is v.0.66.

> I am not awake yet: isn't this due to the single backslash? \r =
> 13 so that the chars 97,13,101,... get printed. I can't explain
> the f before the e, so my attempt is probably wrong.

The first "fl" is dued to the newline between the two strings, the
second to the carriage return "\r". But the question is why one
doesn't get the same results as with tex.print(-1,...):

tex.print(-1, "a", "b")       --gives "a b"
tex.print(-2, "a", "b")       --gives "ab"  
tex.print(111, "a", "b")      --gives "aflb" why?
tex.print(-1, "c", "\relax")  --gives "c" 
tex.print(9, "c", "\relax")   --gives "cflflelax" why?


-- 
Ulrike Fischer 


From zappathustra at free.fr  Fri Apr 29 09:46:27 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 29 Apr 2011 09:46:27 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <1d0x0unskr927$.dlg@nililand.de>
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
 <1d0x0unskr927$.dlg@nililand.de>
Message-ID: <4DBA6CD3.3020508@free.fr>

Le 29/04/2011 09:25, Ulrike Fischer a ?crit :
> Am Fri, 29 Apr 2011 07:46:06 +0200 schrieb Patrick Gundlach:
>
>> Hi Paul,
>
>>> The manual states about tex.print(n,<strings>) that ``if n is
>>> not a valid catcode table, then it is ignored, and the currently
>>> active catcode regime is used instead.'' However (with catcode
>>> table 1 not initialized):
>>> tex.print(1, "a", "\relax")
>
>>> returns ``aflflelax'' (with the ``fl'' ligature, i.e. character
>>> 13 in CM). So: is that a bug, an inaccuracy in the manual, or
>>> have I misunderstood something? My LuaTeX is v.0.66.
>> I am not awake yet: isn't this due to the single backslash? \r =
>> 13 so that the chars 97,13,101,... get printed. I can't explain
>> the f before the e, so my attempt is probably wrong.
> The first "fl" is dued to the newline between the two strings, the
> second to the carriage return "\r". But the question is why one
> doesn't get the same results as with tex.print(-1,...):
>
> tex.print(-1, "a", "b")       --gives "a b"
> tex.print(-2, "a", "b")       --gives "ab"
> tex.print(111, "a", "b")      --gives "aflb" why?
> tex.print(-1, "c", "\relax")  --gives "c"
> tex.print(9, "c", "\relax")   --gives "cflflelax" why?

Thanks Patrick and Ulrike, the second fl is indeed \r, I missed that; 
now the questions is: why are end-of-line characters printed as if they 
had catcode 12?

Paul

From till.heilmann at unibas.ch  Fri Apr 29 11:52:28 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Fri, 29 Apr 2011 11:52:28 +0200
Subject: [luatex] Kerning: when does it not work?
Message-ID: <C32469D3-9F62-49ED-95CE-0A31E0E824BB@unibas.ch>

On 28/04/2011 07:27 PM, Paul Isambert wrote:

> Two remarks (unfortunately you haven't had many answers...):
> - Contrary to what might be implied (or simply misunderstood by me)  
> in your last remark, penalties (and by the way \special's and  
> whatever is between two glyphs) affect all font kerns, not only  
> those you set by yourself in a feature file;
> - There exists a solution: add the kerns by yourself; this means  
> browsing a list of nodes, and for each pair of contiguous nodes,  
> insert a kern if required in the font, where /contiguous/ means  
> next to each other or separated by such things as penalties,  
> specials, etc.


Thank you, Paul, for your remarks and your advice. I am afraid,  
though, that what you propose is beyond my capability as a (somewhat  
experienced) user since it seems to require a good knowledge of  
LuaTeX and at least some programming.

I can work with the popular (La)TeX packages, not least because of  
the good documentation provided and the friendly support from the  
community. But actual programming is another thing. (I tried to read  
the LuaTeX beta 0.66.0 manual but had to admit defeat).

It looks like I have to do without customized kerning in LuaTeX and  
for my future book projects must consider (horror, horror) switching  
to a commercial DTP solution like InDesign.

Thanks once again and best regards
--Till

From heiko.oberdiek at googlemail.com  Fri Apr 29 12:36:08 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Fri, 29 Apr 2011 12:36:08 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <4DBA6CD3.3020508@free.fr>
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
 <1d0x0unskr927$.dlg@nililand.de> <4DBA6CD3.3020508@free.fr>
Message-ID: <20110429103607.GA24642@oberdiek.my-fqdn.de>

On Fri, Apr 29, 2011 at 09:46:27AM +0200, Paul Isambert wrote:

> Le 29/04/2011 09:25, Ulrike Fischer a ?crit :
> >Am Fri, 29 Apr 2011 07:46:06 +0200 schrieb Patrick Gundlach:
> >
> >>Hi Paul,
> >
> >>>The manual states about tex.print(n,<strings>) that ``if n is
> >>>not a valid catcode table, then it is ignored, and the currently
> >>>active catcode regime is used instead.'' However (with catcode
> >>>table 1 not initialized):
> >>>tex.print(1, "a", "\relax")
> >
> >>>returns ``aflflelax'' (with the ``fl'' ligature, i.e. character
> >>>13 in CM). So: is that a bug, an inaccuracy in the manual, or
> >>>have I misunderstood something? My LuaTeX is v.0.66.
> >>I am not awake yet: isn't this due to the single backslash? \r =
> >>13 so that the chars 97,13,101,... get printed. I can't explain
> >>the f before the e, so my attempt is probably wrong.
> >The first "fl" is dued to the newline between the two strings, the
> >second to the carriage return "\r". But the question is why one
> >doesn't get the same results as with tex.print(-1,...):
> >
> >tex.print(-1, "a", "b")       --gives "a b"

Looks ok.

> >tex.print(-2, "a", "b")       --gives "ab"

The only exception of the documentation is the last string argument
that doesn't get the \endlinechar character appended. According
to the documentation the end of line character is inserted after
"a" with catcode 12 (or 10 if \endlinechar = 32).

> >tex.print(111, "a", "b")      --gives "aflb" why?

If 111 is not a valid catcode table, then the result
should use the current catcode regime with the same
result of tex.print(-1, "a", "b").

> >tex.print(-1, "c", "\relax")  --gives "c"

No. It gives "c \par". (Put \directlua{tex.print...)} in \edef).
There is a line end after "c" and by "\r".
  The documentation says, each line is treated as input line.
The string contains "\r" that happens to be the line terminator.
The behaviour seems to be unspecified, who takes care of the
part after the line end. It is thrown away by tex.print,
should it be parsed by TeX with the result of two lines, ...

> >tex.print(9, "c", "\relax")   --gives "cflflelax" why?
> 
> Thanks Patrick and Ulrike, the second fl is indeed \r, I missed
> that; now the questions is: why are end-of-line characters printed
> as if they had catcode 12?

Perhaps in your case is \catcode\endlinechar=12?

Yours sincerely
  Heiko Oberdiek

From taco at elvenkind.com  Sat Apr 30 09:26:19 2011
From: taco at elvenkind.com (taco)
Date: Sat, 30 Apr 2011 09:26:19 +0200
Subject: [luatex] Kerning: when does it not work?
In-Reply-To: <55818EF7-78B3-4414-8559-3D6B0558666A@unibas.ch>
References: <55818EF7-78B3-4414-8559-3D6B0558666A@unibas.ch>
Message-ID: <4DBBB99B.3030806@elvenkind.com>

Heilmann, Till A. wrote:
> 
>> From Khaled Hosny, Ulrike Fischer, Philipp Lehmann and others I
>> learn that a fundamental issue (if not the _one_ cause for all the
>> seemingly diverse problems I encounter) is the existence of
>> penalized breakpoints: Even if no line breaking occurs the kerning
>> is suppressed at that point. Philipp told me that this was a
>> long-standing limitation of TeX that apparently has not been lifted
>> in LuaTeX.

That limitation is indeed still there, but technically it would not be 
very hard to remove it. I'll add a preliminary tracker item and discuss 
it with Hans.

Best wishes,
Taco


From zappathustra at free.fr  Sat Apr 30 11:43:02 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 30 Apr 2011 11:43:02 +0200
Subject: [luatex] Kerning: when does it not work?
In-Reply-To: <C32469D3-9F62-49ED-95CE-0A31E0E824BB@unibas.ch>
References: <C32469D3-9F62-49ED-95CE-0A31E0E824BB@unibas.ch>
Message-ID: <4DBBD9A6.5080605@free.fr>

Le 29/04/2011 11:52, Heilmann, Till A. a ?crit :
> On 28/04/2011 07:27 PM, Paul Isambert wrote:
>
>> Two remarks (unfortunately you haven't had many answers...):
>> - Contrary to what might be implied (or simply misunderstood by me) 
>> in your last remark, penalties (and by the way \special's and 
>> whatever is between two glyphs) affect all font kerns, not only those 
>> you set by yourself in a feature file;
>> - There exists a solution: add the kerns by yourself; this means 
>> browsing a list of nodes, and for each pair of contiguous nodes, 
>> insert a kern if required in the font, where /contiguous/ means next 
>> to each other or separated by such things as penalties, specials, etc.
>
>
> Thank you, Paul, for your remarks and your advice. I am afraid, 
> though, that what you propose is beyond my capability as a (somewhat 
> experienced) user since it seems to require a good knowledge of LuaTeX 
> and at least some programming.
>
> I can work with the popular (La)TeX packages, not least because of the 
> good documentation provided and the friendly support from the 
> community. But actual programming is another thing. (I tried to read 
> the LuaTeX beta 0.66.0 manual but had to admit defeat).
>
> It looks like I have to do without customized kerning in LuaTeX and 
> for my future book projects must consider (horror, horror) switching 
> to a commercial DTP solution like InDesign.

Ah, this cannot be allowed; Taco has turned your problem into a feature 
request; in the meanwhile, here's some experimental code that add kerns 
between glyphs even though they are separated by penalties:

%%%
\directlua{
local GLYF = node.id("glyph")
local PNTY = node.id("penalty")
local KERN = node.id("kern")

local function add_kerns (head)
   node.kerning(head)
   for glyph in node.traverse_id(GLYF, head) do
     local next = glyph.next
     while next and next.id == PNTY do
       next = next.next
     end
     if next and next.id == GLYF then
       if glyph.font == next.font then
         local kerns = font.getfont(glyph.font).characters[glyph.char].kerns
         if kerns and kerns[next.char] then
           local kern = node.new(KERN, 1)
           kern.kern = kerns[next.char]
           node.insert_after(head, glyph, kern)
         end
       end
     end
   end
end

luatexbase.add_to_callback("kerning", add_kerns, "add_kerns")
}
%%%

Some remarks:
- I use luatexbase.add_to_callback because I suppose you're using 
luatexbase (even if you might not know that), and thus callback.register 
(the original function) isn't available.
- I add kerns with subtype 1, equivalent to \kern, although what you 
really want is /font/ kerns (subtype 0); the difference is that font 
kerns may vary in width if you use font expansion, while normal kerns 
don't. However, if I inserted font kerns, they might disappear by the 
same process of font expansion and never reappear precisely because TeX 
hasn't inserted them by itself (at least that's what happened last 
summer and I suppose that hasn't changed, since it's normal behavior).
- Also, kerns won't be properly added in case of discretionaries. All in 
all, Taco's implementation will be better, of course, because it won't 
face this issue and the previous one.
- The code hasn't been put to any stringent test.
- Hope you haven't switched to InDesign yet.

Best,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110430/8c86f9d1/attachment.html>

From zappathustra at free.fr  Sat Apr 30 12:03:35 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 30 Apr 2011 12:03:35 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <20110429103607.GA24642@oberdiek.my-fqdn.de>
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
 <1d0x0unskr927$.dlg@nililand.de> <4DBA6CD3.3020508@free.fr>
 <20110429103607.GA24642@oberdiek.my-fqdn.de>
Message-ID: <4DBBDE77.3040207@free.fr>



Le 29/04/2011 12:36, Heiko Oberdiek a ?crit :
> On Fri, Apr 29, 2011 at 09:46:27AM +0200, Paul Isambert wrote:
>
>> Le 29/04/2011 09:25, Ulrike Fischer a ?crit :
>>> tex.print(9, "c", "\relax")   --gives "cflflelax" why?
>> Thanks Patrick and Ulrike, the second fl is indeed \r, I missed
>> that; now the questions is: why are end-of-line characters printed
>> as if they had catcode 12?
> Perhaps in your case is \catcode\endlinechar=12?

No. I tested with usual catcodes around. But does this mean that you 
don't encounter the problem, Heiko, and so perhaps it's version-bound? 
(Mine is v.0.66 rev 4136).

Best,
Paul

From heiko.oberdiek at googlemail.com  Sat Apr 30 12:58:59 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Sat, 30 Apr 2011 12:58:59 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <4DBBDE77.3040207@free.fr>
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
 <1d0x0unskr927$.dlg@nililand.de> <4DBA6CD3.3020508@free.fr>
 <20110429103607.GA24642@oberdiek.my-fqdn.de>
 <4DBBDE77.3040207@free.fr>
Message-ID: <20110430105858.GA29722@oberdiek.my-fqdn.de>

On Sat, Apr 30, 2011 at 12:03:35PM +0200, Paul Isambert wrote:

> Le 29/04/2011 12:36, Heiko Oberdiek a ?crit :
> >On Fri, Apr 29, 2011 at 09:46:27AM +0200, Paul Isambert wrote:
> >
> >>Le 29/04/2011 09:25, Ulrike Fischer a ?crit :
> >>>tex.print(9, "c", "\relax")   --gives "cflflelax" why?
> >>Thanks Patrick and Ulrike, the second fl is indeed \r, I missed
> >>that; now the questions is: why are end-of-line characters printed
> >>as if they had catcode 12?
> >Perhaps in your case is \catcode\endlinechar=12?
> 
> No. I tested with usual catcodes around. But does this mean that you
> don't encounter the problem, Heiko, and so perhaps it's
> version-bound? (Mine is v.0.66 rev 4136).

I also get tokens with catcode 12 in case of unknown catcode tables:

\catcode`\{=1
\catcode`\}=2
\catcode`\#=6
\def\msg#{\immediate\write16}

\edef\x{\directlua{tex.print(100, "", "")}}

\begingroup
  \lccode`\!=\endlinechar
\lowercase{\endgroup
  \def\y{!}  
}
\ifx\x\y
  \msg{* Catcode of endlinechar: 12}%
\else
  \msg{* ??}%
\fi
\csname @@end\endcsname\end

Versions:
* beta-0.60.2-2010071217 (TeX Live 2010) (rev 3736)
* branches/0.70.x beta-0.67.0-2011042412 (rev 4171)

Yours sincerely
  Heiko Oberdiek

From taco at elvenkind.com  Sat Apr 30 16:16:37 2011
From: taco at elvenkind.com (taco)
Date: Sat, 30 Apr 2011 16:16:37 +0200
Subject: [luatex] Strange behavior of tex.print.
In-Reply-To: <20110430105858.GA29722@oberdiek.my-fqdn.de>
References: <4DB9E2AD.6000504@free.fr>
 <5EF2A5C6-4FC4-4C13-ABCA-31ADAA0FB505@gundla.ch>
 <1d0x0unskr927$.dlg@nililand.de> <4DBA6CD3.3020508@free.fr>
 <20110429103607.GA24642@oberdiek.my-fqdn.de> <4DBBDE77.3040207@free.fr>
 <20110430105858.GA29722@oberdiek.my-fqdn.de>
Message-ID: <4DBC19C5.3090108@elvenkind.com>

Heiko Oberdiek wrote:
> On Sat, Apr 30, 2011 at 12:03:35PM +0200, Paul Isambert wrote:
> 
>> Le 29/04/2011 12:36, Heiko Oberdiek a ?crit :
>>> On Fri, Apr 29, 2011 at 09:46:27AM +0200, Paul Isambert wrote:
>>>
>>>> Le 29/04/2011 09:25, Ulrike Fischer a ?crit :
>>>>> tex.print(9, "c", "\relax")   --gives "cflflelax" why?
>>>> Thanks Patrick and Ulrike, the second fl is indeed \r, I missed
>>>> that; now the questions is: why are end-of-line characters printed
>>>> as if they had catcode 12?
>>> Perhaps in your case is \catcode\endlinechar=12?
>> No. I tested with usual catcodes around. But does this mean that you
>> don't encounter the problem, Heiko, and so perhaps it's
>> version-bound? (Mine is v.0.66 rev 4136).
> 
> I also get tokens with catcode 12 in case of unknown catcode tables:

It took me a while to realize this thread is about a luatex bug.
Currently, invalid catcode tables are *not* ignored. Instead a request
is made internally for a non-existent catcode table, and in such tables,
all catcodes are presumed 12.

Fixed now in commit 4233 (trunk) and 4234 (branches/0.70.x)


Best wishes,
Taco

