From zappathustra at free.fr  Sun Oct  2 09:30:17 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 02 Oct 2011 09:30:17 +0200
Subject: [luatex] Building LuaTeX (again).
Message-ID: <4E881309.7030702@free.fr>

Hello all,

It's been some time since I've tried to build from the sources, and now 
it doesn't work anymore, no matter whether I use the "--make" option or 
not (actually it seems to work except no luatex.exe is produced). I'm 
using Msys 1.0 under Windows 7. Since I know nothing about such things, 
I can't see any relevant information to add, so I've attached the log of 
a compilation with "build.sh --make"; the last lines apparently report 
errors (``pas de fichier comme tel'' means ``no such file'').

The title says ``again'' because I'd already have trouble building in 
the past, but I've checked and it's not the same thing.

Best,
Paul
-------------- next part --------------
A non-text attachment was scrubbed...
Name: build.log
Type: text/x-log
Size: 8681 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20111002/5132b714/attachment.bin>

From fabricio.puppi at gmail.com  Mon Oct  3 19:40:44 2011
From: fabricio.puppi at gmail.com (puppi ;)
Date: Mon, 3 Oct 2011 14:40:44 -0300
Subject: [luatex] Loading Lua modules
Message-ID: <CAC+YFewkLQLnc=JO76CuyRhz+BVZOgo2OoFdG=-i8AsJQ_F+5g@mail.gmail.com>

I'm very new to LuaTex, but a reasonably experienced Lua programmer. The
major drawback I face in using LuaTex for any practical purposes is the lack
of support for loading regular Lua modules, in the usual way. I can't see
why the devs didn't preserve the usual entries in package.loaders, just
pushing them a few indices forth. Does anyone know a (practical, preferably
portable) workaround?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111003/3af4c9d5/attachment.html>

From hartmut_henkel at gmx.de  Tue Oct  4 00:51:19 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue, 4 Oct 2011 00:51:19 +0200 (CEST)
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <4E881309.7030702@free.fr>
References: <4E881309.7030702@free.fr>
Message-ID: <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe>

Hello Paul,

On Sun, 2 Oct 2011, Paul Isambert wrote:

> It's been some time since I've tried to build from the sources, and
> now it doesn't work anymore, no matter whether I use the "--make"
> option or not (actually it seems to work except no luatex.exe is
> produced). I'm using Msys 1.0 under Windows 7. Since I know nothing
> about such things, I can't see any relevant information to add, so
> I've attached the log of a compilation with "build.sh --make"; the
> last lines apparently report errors (``pas de fichier comme tel''
> means ``no such file'').
>
> The title says ``again'' because I'd already have trouble building in
> the past, but I've checked and it's not the same thing.

luatex SVN 4352 hopefully fixes this (can't test, as i don't have
MinGW). Please try.

Regards, Hartmut

From zappathustra at free.fr  Tue Oct  4 08:17:07 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 04 Oct 2011 08:17:07 +0200
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe>
Message-ID: <4E8AA4E3.4040708@free.fr>



Le 04/10/2011 00:51, Hartmut Henkel a ?crit :
> Hello Paul,
>
> On Sun, 2 Oct 2011, Paul Isambert wrote:
>
>> It's been some time since I've tried to build from the sources, and
>> now it doesn't work anymore, no matter whether I use the "--make"
>> option or not (actually it seems to work except no luatex.exe is
>> produced). I'm using Msys 1.0 under Windows 7. Since I know nothing
>> about such things, I can't see any relevant information to add, so
>> I've attached the log of a compilation with "build.sh --make"; the
>> last lines apparently report errors (``pas de fichier comme tel''
>> means ``no such file'').
>>
>> The title says ``again'' because I'd already have trouble building in
>> the past, but I've checked and it's not the same thing.
> luatex SVN 4352 hopefully fixes this (can't test, as i don't have
> MinGW). Please try.

Thank you Hartmut, but unfortunately it doesn't work, with or without 
--make. I've attached the log.

Best,
Paul
-------------- next part --------------
A non-text attachment was scrubbed...
Name: build.log
Type: text/x-log
Size: 7126 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20111004/521aebce/attachment.bin>

From patrick at gundla.ch  Tue Oct  4 09:50:00 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 4 Oct 2011 09:50:00 +0200
Subject: [luatex] Loading Lua modules
In-Reply-To: <CAC+YFewkLQLnc=JO76CuyRhz+BVZOgo2OoFdG=-i8AsJQ_F+5g@mail.gmail.com>
References: <CAC+YFewkLQLnc=JO76CuyRhz+BVZOgo2OoFdG=-i8AsJQ_F+5g@mail.gmail.com>
Message-ID: <86DA7CD5-A120-4236-92A4-EFCEA99CC55C@gundla.ch>

Hi,

> I can't see why the devs didn't preserve the usual entries in package.loaders, just pushing them a few indices forth.

My guess would be that TeX systems should live in their own world and not be system dependent. But that's just a wild guess.


> Does anyone know a (practical, preferably portable) workaround?

Put the modules in a texmf tree. But then you won't be happy because loading Lua modules is a game of luck with LuaTeX (on OS X at least). Unless you edit the build script and compile LuaTeX yourself. 

(Sorry to keep on about this - it's really a pity that this is the case with LuaTeX and I have no idea how to help here.)

Patrick



From patrick at gundla.ch  Tue Oct  4 09:53:44 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 4 Oct 2011 09:53:44 +0200
Subject: [luatex] File name behavior?
Message-ID: <DDFADCDB-C09A-4788-86F8-0156D9466D3F@gundla.ch>

Hi,

when I call "luatex foo.lua" luatex goes into lua mode. Is that on purpose?

Patrick




From zappathustra at free.fr  Tue Oct  4 09:55:25 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 04 Oct 2011 09:55:25 +0200
Subject: [luatex] File name behavior?
In-Reply-To: <DDFADCDB-C09A-4788-86F8-0156D9466D3F@gundla.ch>
References: <DDFADCDB-C09A-4788-86F8-0156D9466D3F@gundla.ch>
Message-ID: <4E8ABBED.90400@free.fr>

Le 04/10/2011 09:53, Patrick Gundlach a ?crit :
> Hi,
>
> when I call "luatex foo.lua" luatex goes into lua mode. Is that on purpose?
>
> Patrick

Yes, see manual 3.1.1.

Best,
Paul

From patrick at gundla.ch  Tue Oct  4 10:00:11 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 4 Oct 2011 10:00:11 +0200
Subject: [luatex] File name behavior?
In-Reply-To: <4E8ABBED.90400@free.fr>
References: <DDFADCDB-C09A-4788-86F8-0156D9466D3F@gundla.ch>
 <4E8ABBED.90400@free.fr>
Message-ID: <403EAF02-5726-430F-9762-0D7B7599DAF0@gundla.ch>



>> when I call "luatex foo.lua" luatex goes into lua mode. Is that on purpose?
>> 
>> Patrick
> 
> Yes, see manual 3.1.1.

embarrassing - I thought I had known _everything_ in the manual.

Thanks!

Patrick



From schultzk at gmx.net  Tue Oct  4 11:10:32 2011
From: schultzk at gmx.net (Keith J. Schultz)
Date: Tue, 4 Oct 2011 11:10:32 +0200
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <4E8AA4E3.4040708@free.fr>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe> <4E8AA4E3.4040708@free.fr>
Message-ID: <283D377B-9245-47C6-ADB9-99D06EED177B@gmx.net>

Hi Hartmut,

I am not know the system you are using, but I can other you some thoughts.

1) a missing file error is generally an indication of a faulty set up or something missing.
 
The important message is: 

This should work unless it involves constant data structures referencing symbols from auto-imported DLLs.
c:/texlive/luatex/trunk/build/libs/poppler/libpoppler.a(GlobalParams.o):c:\texlive\luatex\trunk\build\libs\poppler/../../../source/libs/poppler/poppler-0.18.0/poppler/GlobalParams.cc:436: undefined reference to `EnumFontsA at 16'
c:/texlive/luatex/trunk/build/libs/poppler/libpoppler.a(GlobalParams.o): In function `WinFontList':
c:\texlive\luatex\trunk\build\libs\poppler/../../../source/libs/poppler/poppler-0.18.0/poppler/GlobalParams.cc:338: undefined reference to `EnumFontsA at 16)

2) the is not finding the reference for EnumFontsA at 16
     this can be diverse reasons.
	a) a missing include in a header file
	b) a missing library of object file in the make file
	c) a faulty make file (for your system)
	d) a wrong library or object is being accessed
	e) the start of the message gives a hint, but I have no idea what it suppose to mean.
             Though it seems to say this is designed to work on some systems, but not all and if it does not
	      you will have to fix it yourself.

3) the build command of batch file is not designed properly!!! It should have exited when the above failed. 
     luatex.exe will not exist when the above fails!

hope tis helps

regards
	Keith.

Am 04.10.2011 um 08:17 schrieb Paul Isambert:

> 
> 
> Le 04/10/2011 00:51, Hartmut Henkel a ?crit :
>> Hello Paul,
>> 
>> On Sun, 2 Oct 2011, Paul Isambert wrote:
>> 
>>> It's been some time since I've tried to build from the sources, and
>>> now it doesn't work anymore, no matter whether I use the "--make"
>>> option or not (actually it seems to work except no luatex.exe is
>>> produced). I'm using Msys 1.0 under Windows 7. Since I know nothing
>>> about such things, I can't see any relevant information to add, so
>>> I've attached the log of a compilation with "build.sh --make"; the
>>> last lines apparently report errors (``pas de fichier comme tel''
>>> means ``no such file'').
>>> 
>>> The title says ``again'' because I'd already have trouble building in
>>> the past, but I've checked and it's not the same thing.
>> luatex SVN 4352 hopefully fixes this (can't test, as i don't have
>> MinGW). Please try.
> 
> Thank you Hartmut, but unfortunately it doesn't work, with or without --make. I've attached the log.
> 
> Best,
> Paul
> <build.log>



From luigi.scarso at gmail.com  Tue Oct  4 14:55:21 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 4 Oct 2011 14:55:21 +0200
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <4E8AA4E3.4040708@free.fr>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe>
 <4E8AA4E3.4040708@free.fr>
Message-ID: <CAG5iGsD4AtfJ3v+fCOHKp76dsy4t21OSV-eDwghQNqUQ+Kaexw@mail.gmail.com>

On Tue, Oct 4, 2011 at 8:17 AM, Paul Isambert <zappathustra at free.fr> wrote:
> Thank you Hartmut, but unfortunately it doesn't work, with or without
same error if I cross-compile for windows under linux
Rev 4352.

-- 
luigi

From luigi.scarso at gmail.com  Tue Oct  4 16:48:37 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 4 Oct 2011 16:48:37 +0200
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <CAG5iGsD4AtfJ3v+fCOHKp76dsy4t21OSV-eDwghQNqUQ+Kaexw@mail.gmail.com>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe>
 <4E8AA4E3.4040708@free.fr>
 <CAG5iGsD4AtfJ3v+fCOHKp76dsy4t21OSV-eDwghQNqUQ+Kaexw@mail.gmail.com>
Message-ID: <CAG5iGsCB7p4Yz+tpx-iXkhFcuqUeKv8g0hAuyRH391Q3iPG6hw@mail.gmail.com>

On Tue, Oct 4, 2011 at 2:55 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Tue, Oct 4, 2011 at 8:17 AM, Paul Isambert <zappathustra at free.fr> wrote:
>> Thank you Hartmut, but unfortunately it doesn't work, with or without
> same error if I cross-compile for windows under linux
> Rev 4352.
Cross compiling for i686-apple-darwin8 seems ok: the luatex binary works.
So it looks like a windows (linker ?) issue.

-- 
luigi

From hartmut_henkel at gmx.de  Tue Oct  4 20:40:28 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue, 4 Oct 2011 20:40:28 +0200 (CEST)
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <4E8AA4E3.4040708@free.fr>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe> <4E8AA4E3.4040708@free.fr>
Message-ID: <alpine.DEB.2.00.1110042031540.6092@hahepc1.hahe>

On Tue, 4 Oct 2011, Paul Isambert wrote:
> Le 04/10/2011 00:51, Hartmut Henkel a ?crit :
> > On Sun, 2 Oct 2011, Paul Isambert wrote:
> >
> > > It's been some time since I've tried to build from the sources,
> > > and now it doesn't work anymore, no matter whether I use the
> > > "--make" option or not (actually it seems to work except no
> > > luatex.exe is produced). I'm using Msys 1.0 under Windows 7. Since
> > > I know nothing about such things, I can't see any relevant
> > > information to add, so I've attached the log of a compilation with
> > > "build.sh --make"; the last lines apparently report errors (``pas
> > > de fichier comme tel'' means ``no such file'').
> > >
> > > The title says ``again'' because I'd already have trouble building
> > > in the past, but I've checked and it's not the same thing.
> > luatex SVN 4352 hopefully fixes this (can't test, as i don't have
> > MinGW). Please try.
>
> Thank you Hartmut, but unfortunately it doesn't work, with or without
> --make. I've attached the log.

thanks, your log shows that the strtok_r problem went away now. But no
idea about the remaining EnumFontsA bug, needs a Windows wizard.

Regards, Hartmut

From patrick at gundla.ch  Thu Oct  6 06:45:53 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 6 Oct 2011 06:45:53 +0200
Subject: [luatex] [lltx] luaotfload update
In-Reply-To: <20111006012242.GA7891@khaled-laptop>
References: <20111006012242.GA7891@khaled-laptop>
Message-ID: <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>

(I'll leave the full quote for the CC to the luatex list)


Hi Khaled. Many, many thanks to your work with luaotfload! Does that also imply the ff, ... -ligatures? (I guess so). Why can't we (=you) stick to the current master branch? 

Patrick



Am 06.10.2011 um 03:22 schrieb Khaled Hosny:

> Hello list,
> 
> I managed to finish the long due syncing of luaotfload with ConTeXt,
> in the unstable branch:
> https://github.com/khaledhosny/luaotfload/tree/unstable
> 
> and updated fontspec as well:
> https://github.com/wspr/fontspec/tree/otfl-unstable
> 
> There are many internal changes in this update which would break any
> package depending on internal lua interfaces, also bugs and breakage are
> highly probable. I did some basic testing, but more testing are
> welcomed.
> 
> In this update too the support for non-standard features were dropped,
> namely tlig & trep (AKA TeX ligatures) and anum (was anybody using
> this?). Hans no longer includes that code in his "plain variant" from
> which luaotfload is derived, and even when he did only -- and --- were
> supported and I had to patch it to add the rest. Someone have to
> convince Hans to implement this in the "plain variant" or implement it
> himself, I don't really need this feature myself.
> 
> Also loading of OFM fonts is now broken, I don't feel like debugging
> this and I doubt anyone is using them, but the above applies here too.
> 
> Finally, if someone can put this on tlcontrib, this would be great.
> 
> Regards,
> Khaled
> 
> -- 
> Khaled Hosny
> Egyptian
> Arab




From khaledhosny at eglug.org  Thu Oct  6 08:26:16 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 08:26:16 +0200
Subject: [luatex] [lltx] luaotfload update
In-Reply-To: <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>
References: <20111006012242.GA7891@khaled-laptop>
 <C2EFDC51-66A5-4CD2-92E4-E9CAE44B3D3E@gundla.ch>
Message-ID: <20111006062616.GA13490@khaled-laptop>

"Real" OpenType features should be fine, any regressions ought to be
fixed.

Regards,
 Khaled

On Thu, Oct 06, 2011 at 06:45:53AM +0200, Patrick Gundlach wrote:
> (I'll leave the full quote for the CC to the luatex list)
> 
> 
> Hi Khaled. Many, many thanks to your work with luaotfload! Does that also imply the ff, ... -ligatures? (I guess so). Why can't we (=you) stick to the current master branch? 
> 
> Patrick
> 
> 
> 
> Am 06.10.2011 um 03:22 schrieb Khaled Hosny:
> 
> > Hello list,
> > 
> > I managed to finish the long due syncing of luaotfload with ConTeXt,
> > in the unstable branch:
> > https://github.com/khaledhosny/luaotfload/tree/unstable
> > 
> > and updated fontspec as well:
> > https://github.com/wspr/fontspec/tree/otfl-unstable
> > 
> > There are many internal changes in this update which would break any
> > package depending on internal lua interfaces, also bugs and breakage are
> > highly probable. I did some basic testing, but more testing are
> > welcomed.
> > 
> > In this update too the support for non-standard features were dropped,
> > namely tlig & trep (AKA TeX ligatures) and anum (was anybody using
> > this?). Hans no longer includes that code in his "plain variant" from
> > which luaotfload is derived, and even when he did only -- and --- were
> > supported and I had to patch it to add the rest. Someone have to
> > convince Hans to implement this in the "plain variant" or implement it
> > himself, I don't really need this feature myself.
> > 
> > Also loading of OFM fonts is now broken, I don't feel like debugging
> > this and I doubt anyone is using them, but the above applies here too.
> > 
> > Finally, if someone can put this on tlcontrib, this would be great.
> > 
> > Regards,
> > Khaled
> > 
> > -- 
> > Khaled Hosny
> > Egyptian
> > Arab
> 
> 

-- 
 Khaled Hosny
 Egyptian
 Arab

From p.stephani2 at googlemail.com  Thu Oct  6 23:31:38 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 6 Oct 2011 23:31:38 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111006071234.GA14363@khaled-laptop>
References: <20111006071234.GA14363@khaled-laptop>
Message-ID: <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>

2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
> Hi all,
>
> After a long night of debugging and hair pulling, I finally found why
> italic correction for OpenType math fonts is ignored in luatex and
> lualatex formats but not in context.
>
> For some reason not yet clear to me, the setting of catcode to 11 in
> luatex-unicode-letters.tex causes luatex to not apply italic correction
> (might be related to the fact that luatex applies IC selectively).
>
> This minimal example shows the issues:
>
> \input luaotfload.sty
> \font\xits={file:xits-math.otf} at 10pt
> \textfont0=\xits
> $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
> \bye
>
> after commenting the \catcode part in line 18 of
> luatex-unicode-letters.tex and rebuilding the format, italic correction
> is applied.
>
> I'm not sure what is the proper fix here, though.

LuaTeX explicitly removes italic correction after letters:

            if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
                *delta = 0;     /* no italic correction in mid-word of
text font */
	    }

This seems like a bug to me.

From khaledhosny at eglug.org  Thu Oct  6 23:49:56 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 6 Oct 2011 23:49:56 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
Message-ID: <20111006214956.GA4444@khaled-laptop>

On Thu, Oct 06, 2011 at 11:31:38PM +0200, Philipp Stephani wrote:
> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
> > Hi all,
> >
> > After a long night of debugging and hair pulling, I finally found why
> > italic correction for OpenType math fonts is ignored in luatex and
> > lualatex formats but not in context.
> >
> > For some reason not yet clear to me, the setting of catcode to 11 in
> > luatex-unicode-letters.tex causes luatex to not apply italic correction
> > (might be related to the fact that luatex applies IC selectively).
> >
> > This minimal example shows the issues:
> >
> > \input luaotfload.sty
> > \font\xits={file:xits-math.otf} at 10pt
> > \textfont0=\xits
> > $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
> > \bye
> >
> > after commenting the \catcode part in line 18 of
> > luatex-unicode-letters.tex and rebuilding the format, italic correction
> > is applied.
> >
> > I'm not sure what is the proper fix here, though.
> 
> LuaTeX explicitly removes italic correction after letters:
> 
>             if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
>                 *delta = 0;     /* no italic correction in mid-word of
> text font */
> 	    }
> 
> This seems like a bug to me.

This is on purpose, following to MS implementation/Cambria Math. In
either case it makes no sense IMO to give non-letter characters a letter
catcode.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From p.stephani2 at googlemail.com  Thu Oct  6 23:59:56 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 6 Oct 2011 23:59:56 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111006214956.GA4444@khaled-laptop>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
Message-ID: <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>

2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
> On Thu, Oct 06, 2011 at 11:31:38PM +0200, Philipp Stephani wrote:
>> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
>> > Hi all,
>> >
>> > After a long night of debugging and hair pulling, I finally found why
>> > italic correction for OpenType math fonts is ignored in luatex and
>> > lualatex formats but not in context.
>> >
>> > For some reason not yet clear to me, the setting of catcode to 11 in
>> > luatex-unicode-letters.tex causes luatex to not apply italic correction
>> > (might be related to the fact that luatex applies IC selectively).
>> >
>> > This minimal example shows the issues:
>> >
>> > \input luaotfload.sty
>> > \font\xits={file:xits-math.otf} at 10pt
>> > \textfont0=\xits
>> > $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
>> > \bye
>> >
>> > after commenting the \catcode part in line 18 of
>> > luatex-unicode-letters.tex and rebuilding the format, italic correction
>> > is applied.
>> >
>> > I'm not sure what is the proper fix here, though.
>>
>> LuaTeX explicitly removes italic correction after letters:
>>
>> ? ? ? ? ? ? if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
>> ? ? ? ? ? ? ? ? *delta = 0; ? ? /* no italic correction in mid-word of
>> text font */
>> ? ? ? ? ? }
>>
>> This seems like a bug to me.
>
> This is on purpose, following to MS implementation/Cambria Math.

How can this be, given that Word has no catcodes? Anyway, with Cambria
Math it works as expected, maybe even a font bug?

> In
> either case it makes no sense IMO to give non-letter characters a letter
> catcode.

The italic P you used in your example is a letter, and the parenthesis
has catcode 12.


From khaledhosny at eglug.org  Fri Oct  7 00:21:40 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 7 Oct 2011 00:21:40 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
Message-ID: <20111006222140.GA4586@khaled-laptop>

On Thu, Oct 06, 2011 at 11:59:56PM +0200, Philipp Stephani wrote:
> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
> > On Thu, Oct 06, 2011 at 11:31:38PM +0200, Philipp Stephani wrote:
> >> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
> >> > Hi all,
> >> >
> >> > After a long night of debugging and hair pulling, I finally found why
> >> > italic correction for OpenType math fonts is ignored in luatex and
> >> > lualatex formats but not in context.
> >> >
> >> > For some reason not yet clear to me, the setting of catcode to 11 in
> >> > luatex-unicode-letters.tex causes luatex to not apply italic correction
> >> > (might be related to the fact that luatex applies IC selectively).
> >> >
> >> > This minimal example shows the issues:
> >> >
> >> > \input luaotfload.sty
> >> > \font\xits={file:xits-math.otf} at 10pt
> >> > \textfont0=\xits
> >> > $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
> >> > \bye
> >> >
> >> > after commenting the \catcode part in line 18 of
> >> > luatex-unicode-letters.tex and rebuilding the format, italic correction
> >> > is applied.
> >> >
> >> > I'm not sure what is the proper fix here, though.
> >>
> >> LuaTeX explicitly removes italic correction after letters:
> >>
> >> ? ? ? ? ? ? if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
> >> ? ? ? ? ? ? ? ? *delta = 0; ? ? /* no italic correction in mid-word of
> >> text font */
> >> ? ? ? ? ? }
> >>
> >> This seems like a bug to me.
> >
> > This is on purpose, following to MS implementation/Cambria Math.
> 
> How can this be, given that Word has no catcodes? Anyway, with Cambria
> Math it works as expected, maybe even a font bug?

Word does not apply italic correction between letters (i.e. middle of
the word), catcodes it what luatex is using ti differentiate letters
from non-letters. Cambria has minimal italic correction so the
difference is not so visible and its sub/superscripts are handled with
math kerning so the difference is even more invisible. XITS renders fine
in Word.

> > In
> > either case it makes no sense IMO to give non-letter characters a letter
> > catcode.
> 
> The italic P you used in your example is a letter, and the parenthesis
> has catcode 12.

I see, but then I don't know what the exact detail of what luatex is
doing, all I know is that it applies italic correction selectively.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From reinhard.kotucha at web.de  Fri Oct  7 00:45:03 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 7 Oct 2011 00:45:03 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111006214956.GA4444@khaled-laptop>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
Message-ID: <20110.12143.222238.808772@zaphod.ms25.net>

On 2011-10-06 at 23:49:56 +0200, Khaled Hosny wrote:

 > In either case it makes no sense IMO to give non-letter characters
 > a letter catcode.

A catcode 11 does *not* mean that a character is a letter.  It means
that it's allowed in control sequence names.  I don't think catcodes
are the right thing in order to determine where to apply italic
correction.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Fri Oct  7 01:01:52 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Fri, 7 Oct 2011 00:01:52 +0100
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20110.12143.222238.808772@zaphod.ms25.net>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
Message-ID: <20111006230152.GC27034@phare.normalesup.org>

>                                               I don't think catcodes
> are the right thing in order to determine where to apply italic
> correction.

  They are for hyphenation...

	Arthur

From reinhard.kotucha at web.de  Sat Oct  8 00:05:31 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 8 Oct 2011 00:05:31 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111006230152.GC27034@phare.normalesup.org>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
 <20111006230152.GC27034@phare.normalesup.org>
Message-ID: <20111.30635.661281.93178@zaphod.ms25.net>

On 2011-10-07 at 00:01:52 +0100, Arthur Reutenauer wrote:

 > >                                               I don't think catcodes
 > > are the right thing in order to determine where to apply italic
 > > correction.
 > 
 >   They are for hyphenation...

I must admit that it's unclear to me where catcodes are involved.  I
would expect that hyphenation works on character codes only.  At which
point are catcodes involved?  Anyway, hyphenation is applied between
letters, and letters always have catcode 11.  This seems to be safe
because when I set \catcode`\e=12 , I break the system anyway (can't
even say \bye).

As far as italic correction is concerned, I'm even more clueless.  An
italic correction is applied if one switches from an italic font to an
upright font.  Font switching is usually done by a (La)TeX command,
such as \emph{}.  If catcodes are involved, does LuaTeX insert italic
correction automatically?  If yes, when?  What I'm concerned about is
that, for instance, an exclamation mark can have catcode 11 if one
want to use it in control sequence names, or catcode 12 otherwise.
I would expect to get the same amount of kerning in both cases.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From karl at freefriends.org  Sat Oct  8 00:11:34 2011
From: karl at freefriends.org (Karl Berry)
Date: Fri, 7 Oct 2011 22:11:34 GMT
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111.30635.661281.93178@zaphod.ms25.net>
Message-ID: <201110072211.p97MBYLY008306@freefriends.org>

To reiterate: catcodes are not involved in hyphenation; it is the
\lccode table that matters there.  Read Appendix H.

And anyway, hyphenation is irrelevant to italic corrections.  And we are
talking about use of i.c. in math, not text (as Dan explained at some
length), and, finally there is nothing to be done.  The catcode
assignments just have to be taken out of lua(la)tex format files, and
those chars can unfortunately not be used in control sequence names as a
result.  It seems to me.

karl

From khaledhosny at eglug.org  Sat Oct  8 00:13:15 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 00:13:15 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111.30635.661281.93178@zaphod.ms25.net>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
 <20111006230152.GC27034@phare.normalesup.org>
 <20111.30635.661281.93178@zaphod.ms25.net>
Message-ID: <20111007221314.GA13381@khaled-laptop>

On Sat, Oct 08, 2011 at 12:05:31AM +0200, Reinhard Kotucha wrote:
> As far as italic correction is concerned, I'm even more clueless.  An
> italic correction is applied if one switches from an italic font to an
> upright font.  Font switching is usually done by a (La)TeX command,
> such as \emph{}.

This is about math italic correction.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From reinhard.kotucha at web.de  Sat Oct  8 00:22:55 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 8 Oct 2011 00:22:55 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111007221314.GA13381@khaled-laptop>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
 <20111006230152.GC27034@phare.normalesup.org>
 <20111.30635.661281.93178@zaphod.ms25.net>
 <20111007221314.GA13381@khaled-laptop>
Message-ID: <20111.31679.908341.586052@zaphod.ms25.net>

On 2011-10-08 at 00:13:15 +0200, Khaled Hosny wrote:

 > On Sat, Oct 08, 2011 at 12:05:31AM +0200, Reinhard Kotucha wrote:
 > > As far as italic correction is concerned, I'm even more clueless.  An
 > > italic correction is applied if one switches from an italic font to an
 > > upright font.  Font switching is usually done by a (La)TeX command,
 > > such as \emph{}.
 > 
 > This is about math italic correction.

This explains a lot, thanks!

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From p.stephani2 at googlemail.com  Sat Oct  8 09:18:14 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:18:14 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111006222140.GA4586@khaled-laptop>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
 <20111006222140.GA4586@khaled-laptop>
Message-ID: <CAArVCkQUQTDY_kxWGHqRyxzwPf-67qGmzOoOwrkrijkU+FyiQA@mail.gmail.com>

2011/10/7 Khaled Hosny <khaledhosny at eglug.org>:
> On Thu, Oct 06, 2011 at 11:59:56PM +0200, Philipp Stephani wrote:
>> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
>> > On Thu, Oct 06, 2011 at 11:31:38PM +0200, Philipp Stephani wrote:
>> >> 2011/10/6 Khaled Hosny <khaledhosny at eglug.org>:
>> >> > Hi all,
>> >> >
>> >> > After a long night of debugging and hair pulling, I finally found why
>> >> > italic correction for OpenType math fonts is ignored in luatex and
>> >> > lualatex formats but not in context.
>> >> >
>> >> > For some reason not yet clear to me, the setting of catcode to 11 in
>> >> > luatex-unicode-letters.tex causes luatex to not apply italic correction
>> >> > (might be related to the fact that luatex applies IC selectively).
>> >> >
>> >> > This minimal example shows the issues:
>> >> >
>> >> > \input luaotfload.sty
>> >> > \font\xits={file:xits-math.otf} at 10pt
>> >> > \textfont0=\xits
>> >> > $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
>> >> > \bye
>> >> >
>> >> > after commenting the \catcode part in line 18 of
>> >> > luatex-unicode-letters.tex and rebuilding the format, italic correction
>> >> > is applied.
>> >> >
>> >> > I'm not sure what is the proper fix here, though.
>> >>
>> >> LuaTeX explicitly removes italic correction after letters:
>> >>
>> >> ? ? ? ? ? ? if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
>> >> ? ? ? ? ? ? ? ? *delta = 0; ? ? /* no italic correction in mid-word of
>> >> text font */
>> >> ? ? ? ? ? }
>> >>
>> >> This seems like a bug to me.
>> >
>> > This is on purpose, following to MS implementation/Cambria Math.
>>
>> How can this be, given that Word has no catcodes? Anyway, with Cambria
>> Math it works as expected, maybe even a font bug?
>
> Word does not apply italic correction between letters (i.e. middle of
> the word), catcodes it what luatex is using ti differentiate letters
> from non-letters.

But this is rather contrary to the behavior of traditional TeX which
doesn't use catcodes at all at this stage (see e.g. Dan's posting).

> Cambria has minimal italic correction so the
> difference is not so visible and its sub/superscripts are handled with
> math kerning so the difference is even more invisible. XITS renders fine
> in Word.

For Cambria, the test looks better without italic correction. The
OpenType math document allows math italic correction to be applied
after a run of italic characters, but does not specify how to tell
italic and upright characters apart. But I'm quite sure that catcodes
are the wrong way to make this distinction. Probably LuaTeX needs a
list of all italic characters (there doesn't seem to be a Unicode
property for this).

>
>> > In
>> > either case it makes no sense IMO to give non-letter characters a letter
>> > catcode.
>>
>> The italic P you used in your example is a letter, and the parenthesis
>> has catcode 12.
>
> I see, but then I don't know what the exact detail of what luatex is
> doing, all I know is that it applies italic correction selectively.

It uses the code I posted above: it removes italic corrections after
category-11 characters, but leaves it after category-12 characters.
That's why ConTeXt appears to work. But the mathematical characters
should absolutely have catcode 11 since they have the properties
ID_Start and ID_Continue (by virtue of being letters), so the LuaLaTeX
behavior is correct and should not be altered.


From p.stephani2 at googlemail.com  Sat Oct  8 09:20:14 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:20:14 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20110.12143.222238.808772@zaphod.ms25.net>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
Message-ID: <CAArVCkTHqn1WR1a4rMQsckwxEj+FymYRR4VuZyALFn4oEVBc6Q@mail.gmail.com>

2011/10/7 Reinhard Kotucha <reinhard.kotucha at web.de>:
> On 2011-10-06 at 23:49:56 +0200, Khaled Hosny wrote:
>
> ?> In either case it makes no sense IMO to give non-letter characters
> ?> a letter catcode.
>
> A catcode 11 does *not* mean that a character is a letter. ?It means
> that it's allowed in control sequence names.

Indeed, and therefore category 11 is roughly equivalent to the Unicode
properties ID_Start and/or ID_Continue.

>?I don't think catcodes
> are the right thing in order to determine where to apply italic
> correction.

I totally agree. The distinction that LuaTeX makes between 11 and 12
is very surprising and not in line of traditional TeX behavior.


From p.stephani2 at googlemail.com  Sat Oct  8 09:27:11 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:27:11 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <0LSP00IXVHX6RH7E@mailhost.uark.edu>
References: <0LSP00IXVHX6RH7E@mailhost.uark.edu>
Message-ID: <CAArVCkQmG_h2GqWBPqAA9DtvKozJqWPAgSAye+7iFm_eX22YuQ@mail.gmail.com>

2011/10/7 Dan Luecking <luecking at uark.edu>:
> On Thu Oct 6, 2011 at 23:31:38 CEST, Philipp Stephani wrote
>
>> 2011/10/6 Khaled Hosny
>> <<http://tug.org/mailman/listinfo/tex-live>khaledhosny at eglug.org>:
>> > Hi all,
>> >
>> > After a long night of debugging and hair pulling, I finally found why
>> > italic correction for OpenType math fonts is ignored in luatex and
>> > lualatex formats but not in context.
>> >
>> > For some reason not yet clear to me, the setting of catcode to 11 in
>> > luatex-unicode-letters.tex causes luatex to not apply italic correction
>> > (might be related to the fact that luatex applies IC selectively).
>> >
>> > This minimal example shows the issues:
>> >
>> > \input luaotfload.sty
>> > \font\xits={file:xits-math.otf} at 10pt
>> > \textfont0=\xits
>> > $$\Umathchar"7"0"1D443\Umathchar"4"0`($$
>> > \bye
>> >
>> > after commenting the \catcode part in line 18 of
>> > luatex-unicode-letters.tex and rebuilding the format, italic correction
>> > is applied.
>> >
>> > I'm not sure what is the proper fix here, though.
>>
>> LuaTeX explicitly removes italic correction after letters:
>>
>> ? ? ? ? ? ?if (is_new_mathfont(cur_f) && get_char_cat_code(cur_c) == 11) {
>> ? ? ? ? ? ? ? ?*delta = 0; ? ? /* no italic correction in mid-word of
>> text font */
>> ? ? ? ? ? ?}
>>
>> This seems like a bug to me.
>
> The comment seen above (no italic correction in mid-word)
> is how TeX is supposed to behave in math *unless*
> \fontdimen2 of the font is 0.

This is the traditional approach that LuaTeX uses for non-Unicode
fonts. I've left this out in the above code snippet since it's not
relevant for OpenType math.

> \fontdimen2 is the size of
> a space. Thus, sequences of symbols from cmr are not
> separated by italic correction, but symbols from cmmi
> are.

This behavior cannot be transferred to OpenType math since with
OpenType math, all characters belong to the same family.

>
> On the other hand, at the *end* of a "word" (i.e.,
> where the next symbol is from another math family) an
> italic correction is still appropriate. Perhaps in the
> example given, the "P" and the "(" are from the same
> family?

Yes. This is always/usually the case with OpenType math.

> Caveats: This assumes that I correctly understand the concerns
> of the OP, that my reading of the TeXbook is correct and that
> luaotfload is trying to emulate original TeX as far as possible.

It's in fact not related to luaotfload, but to the engine itself
(therefore I'm CCing the LuaTeX list). Since in OpenType math
typesetting, all characters in a math list are from the same font and
belong to the same family, the TeX method doesn't work any more and
LuaTeX necessarily has to be incompatible. The OpenType math
documentation specifies that italic correction can be applied between
a run of italic characters and an upright character, but there is no
simple way to find out whether a character is italic.


From p.stephani2 at googlemail.com  Sat Oct  8 09:30:49 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:30:49 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111007195819.GC11704@khaled-laptop>
References: <0LSP00IXVHX6RH7E@mailhost.uark.edu>
 <20111007195819.GC11704@khaled-laptop>
Message-ID: <CAArVCkSq0c+q6xEa_LXyXbCaNc=6eCQPqi6OewrKg-x2YfjT6Q@mail.gmail.com>

2011/10/7 Khaled Hosny <khaledhosny at eglug.org>:
> On Fri, Oct 07, 2011 at 12:31:08PM -0500, Dan Luecking wrote:
>> Caveats: This assumes that I correctly understand the concerns
>> of the OP, that my reading of the TeXbook is correct and that
>> luaotfload is trying to emulate original TeX as far as possible.
>
> The issue here is related to the engine, AFAICT luaotfload is properly
> delivering font structure as the engine expects it,

Yes

> the problem seems to
> be related to that catcode thing which is beyond my comprehension,
> whether it is a luatex bug or feature is too beyond me.

I'm quite convinced that the catcode test in mlist.w (line 3387) is
not the desired behavior. As others explained, catcodes should play no
role in that stage of processing. Probably we need another entry in
the character tables that specifies whether the character is italic or
not.

From p.stephani2 at googlemail.com  Sat Oct  8 09:35:24 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:35:24 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111.30635.661281.93178@zaphod.ms25.net>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <20110.12143.222238.808772@zaphod.ms25.net>
 <20111006230152.GC27034@phare.normalesup.org>
 <20111.30635.661281.93178@zaphod.ms25.net>
Message-ID: <CAArVCkQhJUZeTir_gqF+sKdctt7pG7kC0gpL0Px_oiQWcyS71A@mail.gmail.com>

2011/10/8 Reinhard Kotucha <reinhard.kotucha at web.de>:
> On 2011-10-07 at 00:01:52 +0100, Arthur Reutenauer wrote:
>
> ?> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? I don't think catcodes
> ?> > are the right thing in order to determine where to apply italic
> ?> > correction.
> ?>
> ?> ? They are for hyphenation...
>
> I must admit that it's unclear to me where catcodes are involved. ?I
> would expect that hyphenation works on character codes only. ?At which
> point are catcodes involved? ?Anyway, hyphenation is applied between
> letters, and letters always have catcode 11. ?This seems to be safe
> because when I set \catcode`\e=12 , I break the system anyway (can't
> even say \bye).

You could, and most typesetting-related things should still work since
catcodes are only for input processing. Once there is a mlist/hlist,
the catcodes are gone and not used any more.

>
> As far as italic correction is concerned, I'm even more clueless. ?An
> italic correction is applied if one switches from an italic font to an
> upright font.

There is no font switching at all in OpenType math mode. In our
example, the italic P and the opening parentheses are characters from
the same font.

>?If catcodes are involved, does LuaTeX insert italic
> correction automatically? ?If yes, when?

It suppresses italic correction after all category-11 characters.

>?What I'm concerned about is
> that, for instance, an exclamation mark can have catcode 11 if one
> want to use it in control sequence names, or catcode 12 otherwise.
> I would expect to get the same amount of kerning in both cases.

Sure. Another reason why the current LuaTeX behavior is not kosher.
Math typesetting uses the math class and family for distinctions in
typesetting, but should never use the catcode.


From p.stephani2 at googlemail.com  Sat Oct  8 09:36:53 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 09:36:53 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <201110072211.p97MBYLY008306@freefriends.org>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
Message-ID: <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>

2011/10/8 Karl Berry <karl at freefriends.org>:
> The catcode
> assignments just have to be taken out of lua(la)tex format files

Please don't do this. The catcode assignments are totally correct, and
it is LuaTeX which is IMHO buggy.

From taco at elvenkind.com  Sat Oct  8 10:39:54 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 08 Oct 2011 10:39:54 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <CAArVCkQUQTDY_kxWGHqRyxzwPf-67qGmzOoOwrkrijkU+FyiQA@mail.gmail.com>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
 <20111006222140.GA4586@khaled-laptop>
 <CAArVCkQUQTDY_kxWGHqRyxzwPf-67qGmzOoOwrkrijkU+FyiQA@mail.gmail.com>
Message-ID: <4E900C5A.2070604@elvenkind.com>

On 10/08/2011 09:18 AM, Philipp Stephani wrote:
>
>> Cambria has minimal italic correction so the
>> difference is not so visible and its sub/superscripts are handled with
>> math kerning so the difference is even more invisible. XITS renders fine
>> in Word.
>
> For Cambria, the test looks better without italic correction. The
> OpenType math document allows math italic correction to be applied
> after a run of italic characters, but does not specify how to tell
> italic and upright characters apart.

I believe the fix here should be for luatex not to
apply italic corrections in math mode at all, so:

    if (is_new_mathfont(cur_f)) {
        *delta = 0;     /* no italic correction  */
    }

Best wishes,
Taco


From p.stephani2 at googlemail.com  Sat Oct  8 12:15:48 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 12:15:48 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <4E900C5A.2070604@elvenkind.com>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
 <20111006222140.GA4586@khaled-laptop>
 <CAArVCkQUQTDY_kxWGHqRyxzwPf-67qGmzOoOwrkrijkU+FyiQA@mail.gmail.com>
 <4E900C5A.2070604@elvenkind.com>
Message-ID: <CAArVCkTpVCEafLUyikOnHRkj=XqypvucS-9qZ65qitUGbOBFyA@mail.gmail.com>

2011/10/8 Taco Hoekwater <taco at elvenkind.com>:
> On 10/08/2011 09:18 AM, Philipp Stephani wrote:
>>
>>> Cambria has minimal italic correction so the
>>> difference is not so visible and its sub/superscripts are handled with
>>> math kerning so the difference is even more invisible. XITS renders fine
>>> in Word.
>>
>> For Cambria, the test looks better without italic correction. The
>> OpenType math document allows math italic correction to be applied
>> after a run of italic characters, but does not specify how to tell
>> italic and upright characters apart.
>
> I believe the fix here should be for luatex not to
> apply italic corrections in math mode at all, so:
>
> ? if (is_new_mathfont(cur_f)) {
> ? ? ? *delta = 0; ? ? /* no italic correction ?*/
> ? }

This would be allowed according to the OpenType specification and
remove the category code issues, but in our case XITS actually should
have italic correction, otherwise the characters would bump into each
other even in ConTeXt. I think we should find a better solution.
Maybe you can implement a set (hash table or whatever) of characters
that should be treated as italic. Users should be able to set this set
using tex.set_italic_characters({123, 456}) or similar.


From khaledhosny at eglug.org  Sat Oct  8 15:30:04 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 15:30:04 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <4E900C5A.2070604@elvenkind.com>
References: <20111006071234.GA14363@khaled-laptop>
 <CAArVCkRf=tdapcy20+4CyyiFGiJV9xWwh=3hLn-bWDAT_Q5QFw@mail.gmail.com>
 <20111006214956.GA4444@khaled-laptop>
 <CAArVCkQFHG6SRzbbSgQECcTqq-kLXYybTYXG1nEeAYqb+g6c=g@mail.gmail.com>
 <20111006222140.GA4586@khaled-laptop>
 <CAArVCkQUQTDY_kxWGHqRyxzwPf-67qGmzOoOwrkrijkU+FyiQA@mail.gmail.com>
 <4E900C5A.2070604@elvenkind.com>
Message-ID: <20111008133004.GA16449@khaled-laptop>

On Sat, Oct 08, 2011 at 10:39:54AM +0200, Taco Hoekwater wrote:
> On 10/08/2011 09:18 AM, Philipp Stephani wrote:
> >
> >>Cambria has minimal italic correction so the
> >>difference is not so visible and its sub/superscripts are handled with
> >>math kerning so the difference is even more invisible. XITS renders fine
> >>in Word.
> >
> >For Cambria, the test looks better without italic correction. The
> >OpenType math document allows math italic correction to be applied
> >after a run of italic characters, but does not specify how to tell
> >italic and upright characters apart.
> 
> I believe the fix here should be for luatex not to
> apply italic corrections in math mode at all, so:
> 
>    if (is_new_mathfont(cur_f)) {
>        *delta = 0;     /* no italic correction  */
>    }

Not every font can do with no italic correction at all, Cambria can go
away with that but more slanted designs can't.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From khaledhosny at eglug.org  Sat Oct  8 15:46:29 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 15:46:29 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
Message-ID: <20111008134629.GC16449@khaled-laptop>

On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
> 2011/10/8 Karl Berry <karl at freefriends.org>:
> > The catcode
> > assignments just have to be taken out of lua(la)tex format files
> 
> Please don't do this. The catcode assignments are totally correct, and
> it is LuaTeX which is IMHO buggy.

So we have to live with broken rendering (until next year texlive at
least) for some dubious benefit of being able to \def\?????????????

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From p.stephani2 at googlemail.com  Sat Oct  8 15:52:50 2011
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Sat, 8 Oct 2011 15:52:50 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111008134629.GC16449@khaled-laptop>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
Message-ID: <CAArVCkRPqfA16PmV3TtWwfWAgyYWz+Oj+SEjPKV4c_59e=eCEA@mail.gmail.com>

2011/10/8 Khaled Hosny <khaledhosny at eglug.org>:
> On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
>> 2011/10/8 Karl Berry <karl at freefriends.org>:
>> > The catcode
>> > assignments just have to be taken out of lua(la)tex format files
>>
>> Please don't do this. The catcode assignments are totally correct, and
>> it is LuaTeX which is IMHO buggy.
>
> So we have to live with broken rendering (until next year texlive at
> least) for some dubious benefit of being able to \def\?????????????

LuaTeX is still beta, nobody should expect flawlessness. Once a better
italic correction algorithm is found, we can upload a new version of
LuaTeX to TLcontrib.


From khaledhosny at eglug.org  Sat Oct  8 16:09:18 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 16:09:18 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <CAArVCkRPqfA16PmV3TtWwfWAgyYWz+Oj+SEjPKV4c_59e=eCEA@mail.gmail.com>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <CAArVCkRPqfA16PmV3TtWwfWAgyYWz+Oj+SEjPKV4c_59e=eCEA@mail.gmail.com>
Message-ID: <20111008140918.GA16747@khaled-laptop>

On Sat, Oct 08, 2011 at 03:52:50PM +0200, Philipp Stephani wrote:
> 2011/10/8 Khaled Hosny <khaledhosny at eglug.org>:
> > On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
> >> 2011/10/8 Karl Berry <karl at freefriends.org>:
> >> > The catcode
> >> > assignments just have to be taken out of lua(la)tex format files
> >>
> >> Please don't do this. The catcode assignments are totally correct, and
> >> it is LuaTeX which is IMHO buggy.
> >
> > So we have to live with broken rendering (until next year texlive at
> > least) for some dubious benefit of being able to \def\?????????????
> 
> LuaTeX is still beta, nobody should expect flawlessness. Once a better
> italic correction algorithm is found, we can upload a new version of
> LuaTeX to TLcontrib.

No, I'm not convinced that we have to keep a feature that no one needs
just to break a feature that many need. If ConTeXt is doing fine without
the cactcode assignment, I think LaTeX can survive it too.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From luatex at nililand.de  Sat Oct  8 18:21:46 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 8 Oct 2011 18:21:46 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
Message-ID: <1u1to97usqlv2$.dlg@nililand.de>

Am Sat, 8 Oct 2011 15:46:29 +0200 schrieb Khaled Hosny:

>>> The catcode
>>> assignments just have to be taken out of lua(la)tex format files

>> Please don't do this. The catcode assignments are totally correct, and
>> it is LuaTeX which is IMHO buggy.
 
> So we have to live with broken rendering (until next year texlive at
> least) for some dubious benefit of being able to \def\?????????????

I'm obviously not able to follow. Of which letters are you speaking?
My version of luatex-unicode-letters.tex doesn't contain a \catcode
setting in line 18 (there is the \begingroup-command). 

Also why it is necessary to change the formats? Why can't the
problematic catcodes be changed in the document?


-- 
Ulrike Fischer 


From javieraritz.ribadeo at gmail.com  Sat Oct  8 18:55:01 2011
From: javieraritz.ribadeo at gmail.com (=?ISO-8859-1?Q?Javier_M=FAgica_de_Rivera?=)
Date: Sat, 8 Oct 2011 18:55:01 +0200
Subject: [luatex] ligatures with luaotfload
Message-ID: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>

I have used the luaotfload package for the first time, and worte the
following code in order to do so:

%def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
\def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}

\otffont\tenrm=LMRoman10-Regular at 10pt

The font appears to be right at first sight but looking closer I see
that kerning and ligatures are missing. How can that be solved?

Another issue is the tlig and trep substitutions. If I write
``hello'', I get the right output if I use the node mode, but if I use
the base mode I have to remove the trep option in order to get it
right, otherwise what I get is two consecutive single-left-quotes. It
seems that the package in base mode first applies the option trep,
replacing the each ` with a quote, and then tlig is useless since the
couple `` of original input characters is already gone. Since I
perceived no differences between base and node modes I simply switched
to node mode.

Regards,
Javier A. M?gica


From khaledhosny at eglug.org  Sat Oct  8 19:42:29 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 19:42:29 +0200
Subject: [luatex] ligatures with luaotfload
In-Reply-To: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
References: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
Message-ID: <20111008174229.GC19263@khaled-laptop>

On Sat, Oct 08, 2011 at 06:55:01PM +0200, Javier M?gica de Rivera wrote:
> I have used the luaotfload package for the first time, and worte the
> following code in order to do so:
> 
> %def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
> \def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}
> 
> \otffont\tenrm=LMRoman10-Regular at 10pt
> 
> The font appears to be right at first sight but looking closer I see
> that kerning and ligatures are missing. How can that be solved?

I don't know what version of luaotfload you are using, but in some old
versions you had to explicitly enable each feature you want.

> Another issue is the tlig and trep substitutions. If I write
> ``hello'', I get the right output if I use the node mode, but if I use
> the base mode I have to remove the trep option in order to get it
> right, otherwise what I get is two consecutive single-left-quotes. It
> seems that the package in base mode first applies the option trep,
> replacing the each ` with a quote, and then tlig is useless since the
> couple `` of original input characters is already gone. Since I
> perceived no differences between base and node modes I simply switched
> to node mode.

tlig and trep are essentially broken by design, they are removed
altogether from the unstable branch, I'm not sure if there will ever be
a replacement in luaotfload so you would better find a different way to
input typographic quotes.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From patrick at gundla.ch  Sat Oct  8 20:03:18 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 8 Oct 2011 20:03:18 +0200
Subject: [luatex] ligatures with luaotfload
In-Reply-To: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
References: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
Message-ID: <B6C36A5E-A3C4-4A6F-BEB3-1EA8588CD354@gundla.ch>


Am 08.10.2011 um 18:55 schrieb Javier M?gica de Rivera:

> I have used the luaotfload package for the first time, and worte the
> following code in order to do so:
> 
> %def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
> \def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}
> 
> \otffont\tenrm=LMRoman10-Regular at 10pt
> 
> The font appears to be right at first sight but looking closer I see
> that kerning and ligatures are missing. How can that be solved?

you have to explicitly set kern and ligatures:

\def\x{Va Va Va Va Va Va Va fish fluffiest\par}
\input luaotfload.sty
\font\myfont="Linux Libertine O"
\myfont\x
\font\myfont="Linux Libertine O:+liga;"
\myfont\x
\font\myfont="Linux Libertine O:+liga;+kern"
\myfont\x
\bye




Patrick

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111008/7c46e261/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fluffyfish.png
Type: image/png
Size: 32035 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20111008/7c46e261/attachment-0001.png>

From khaledhosny at eglug.org  Sat Oct  8 20:14:09 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 8 Oct 2011 20:14:09 +0200
Subject: [luatex] ligatures with luaotfload
In-Reply-To: <20111008174229.GC19263@khaled-laptop>
References: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
 <20111008174229.GC19263@khaled-laptop>
Message-ID: <20111008181409.GA19904@khaled-laptop>

On Sat, Oct 08, 2011 at 07:42:29PM +0200, Khaled Hosny wrote:
> On Sat, Oct 08, 2011 at 06:55:01PM +0200, Javier M?gica de Rivera wrote:
> > I have used the luaotfload package for the first time, and worte the
> > following code in order to do so:
> > 
> > %def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
> > \def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}
> > 
> > \otffont\tenrm=LMRoman10-Regular at 10pt
> > 
> > The font appears to be right at first sight but looking closer I see
> > that kerning and ligatures are missing. How can that be solved?
> 
> I don't know what version of luaotfload you are using, but in some old
> versions you had to explicitly enable each feature you want.

Checking the code, if you don't select a script no feature will be
enabled by default.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From mohamed at bana.org.uk  Sat Oct  8 19:45:03 2011
From: mohamed at bana.org.uk (Mohamed Bana)
Date: Sat, 8 Oct 2011 18:45:03 +0100
Subject: [luatex] luatex Digest, Vol 34, Issue 8
In-Reply-To: <mailman.11615.1318095761.3619.luatex@tug.org>
References: <mailman.11615.1318095761.3619.luatex@tug.org>
Message-ID: <CAPPjOLp78ZWobkRH+Ft2J0tbsuF3g_9uti2gOgYuQA3EHeDqzw@mail.gmail.com>

Would someone please un-subscribe.  I've tried endlessly but it doesn't seem
to work.

Thank you.
 ?Mohamed


On 8 October 2011 18:42, <luatex-request at tug.org> wrote:

> Send luatex mailing list submissions to
>        luatex at tug.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        http://tug.org/mailman/listinfo/luatex
> or, via email, send a message with subject or body 'help' to
>        luatex-request at tug.org
>
> You can reach the person managing the list at
>        luatex-owner at tug.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of luatex digest..."
>
>
> Today's Topics:
>
>   1. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Philipp Stephani)
>   2. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Khaled Hosny)
>   3. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Khaled Hosny)
>   4. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Philipp Stephani)
>   5. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Khaled Hosny)
>   6. Re: [tex-live] Ignored italic correction with lua(la)tex
>      format (Ulrike Fischer)
>   7. ligatures with luaotfload (Javier M?gica de Rivera)
>   8. Re: ligatures with luaotfload (Khaled Hosny)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sat, 8 Oct 2011 12:15:48 +0200
> From: Philipp Stephani <p.stephani2 at googlemail.com>
> To: Taco Hoekwater <taco at elvenkind.com>
> Cc: TeX Live mailing list <tex-live at tug.org>, "General discussion of
>        LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex      format
> Message-ID:
>        <CAArVCkTpVCEafLUyikOnHRkj=XqypvucS-9qZ65qitUGbOBFyA at mail.gmail.com
> >
> Content-Type: text/plain; charset=ISO-8859-1
>
> 2011/10/8 Taco Hoekwater <taco at elvenkind.com>:
> > On 10/08/2011 09:18 AM, Philipp Stephani wrote:
> >>
> >>> Cambria has minimal italic correction so the
> >>> difference is not so visible and its sub/superscripts are handled with
> >>> math kerning so the difference is even more invisible. XITS renders
> fine
> >>> in Word.
> >>
> >> For Cambria, the test looks better without italic correction. The
> >> OpenType math document allows math italic correction to be applied
> >> after a run of italic characters, but does not specify how to tell
> >> italic and upright characters apart.
> >
> > I believe the fix here should be for luatex not to
> > apply italic corrections in math mode at all, so:
> >
> > ? if (is_new_mathfont(cur_f)) {
> > ? ? ? *delta = 0; ? ? /* no italic correction ?*/
> > ? }
>
> This would be allowed according to the OpenType specification and
> remove the category code issues, but in our case XITS actually should
> have italic correction, otherwise the characters would bump into each
> other even in ConTeXt. I think we should find a better solution.
> Maybe you can implement a set (hash table or whatever) of characters
> that should be treated as italic. Users should be able to set this set
> using tex.set_italic_characters({123, 456}) or similar.
>
>
>
> ------------------------------
>
> Message: 2
> Date: Sat, 8 Oct 2011 15:30:04 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: Taco Hoekwater <taco at elvenkind.com>
> Cc: TeX Live mailing list <tex-live at tug.org>, "General discussion of
>        LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex      format
> Message-ID: <20111008133004.GA16449 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Sat, Oct 08, 2011 at 10:39:54AM +0200, Taco Hoekwater wrote:
> > On 10/08/2011 09:18 AM, Philipp Stephani wrote:
> > >
> > >>Cambria has minimal italic correction so the
> > >>difference is not so visible and its sub/superscripts are handled with
> > >>math kerning so the difference is even more invisible. XITS renders
> fine
> > >>in Word.
> > >
> > >For Cambria, the test looks better without italic correction. The
> > >OpenType math document allows math italic correction to be applied
> > >after a run of italic characters, but does not specify how to tell
> > >italic and upright characters apart.
> >
> > I believe the fix here should be for luatex not to
> > apply italic corrections in math mode at all, so:
> >
> >    if (is_new_mathfont(cur_f)) {
> >        *delta = 0;     /* no italic correction  */
> >    }
>
> Not every font can do with no italic correction at all, Cambria can go
> away with that but more slanted designs can't.
>
> Regards,
>  Khaled
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> Message: 3
> Date: Sat, 8 Oct 2011 15:46:29 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Cc: tex-live at tug.org
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex format
> Message-ID: <20111008134629.GC16449 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
> > 2011/10/8 Karl Berry <karl at freefriends.org>:
> > > The catcode
> > > assignments just have to be taken out of lua(la)tex format files
> >
> > Please don't do this. The catcode assignments are totally correct, and
> > it is LuaTeX which is IMHO buggy.
>
> So we have to live with broken rendering (until next year texlive at
> least) for some dubious benefit of being able to \def\?????????????
>
> Regards,
>  Khaled
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> Message: 4
> Date: Sat, 8 Oct 2011 15:52:50 +0200
> From: Philipp Stephani <p.stephani2 at googlemail.com>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Cc: tex-live at tug.org
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex      format
> Message-ID:
>        <CAArVCkRPqfA16PmV3TtWwfWAgyYWz+Oj+SEjPKV4c_59e=eCEA at mail.gmail.com
> >
> Content-Type: text/plain; charset=UTF-8
>
> 2011/10/8 Khaled Hosny <khaledhosny at eglug.org>:
> > On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
> >> 2011/10/8 Karl Berry <karl at freefriends.org>:
> >> > The catcode
> >> > assignments just have to be taken out of lua(la)tex format files
> >>
> >> Please don't do this. The catcode assignments are totally correct, and
> >> it is LuaTeX which is IMHO buggy.
> >
> > So we have to live with broken rendering (until next year texlive at
> > least) for some dubious benefit of being able to \def\?????????????
>
> LuaTeX is still beta, nobody should expect flawlessness. Once a better
> italic correction algorithm is found, we can upload a new version of
> LuaTeX to TLcontrib.
>
>
>
> ------------------------------
>
> Message: 5
> Date: Sat, 8 Oct 2011 16:09:18 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Cc: tex-live at tug.org
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex format
> Message-ID: <20111008140918.GA16747 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Sat, Oct 08, 2011 at 03:52:50PM +0200, Philipp Stephani wrote:
> > 2011/10/8 Khaled Hosny <khaledhosny at eglug.org>:
> > > On Sat, Oct 08, 2011 at 09:36:53AM +0200, Philipp Stephani wrote:
> > >> 2011/10/8 Karl Berry <karl at freefriends.org>:
> > >> > The catcode
> > >> > assignments just have to be taken out of lua(la)tex format files
> > >>
> > >> Please don't do this. The catcode assignments are totally correct, and
> > >> it is LuaTeX which is IMHO buggy.
> > >
> > > So we have to live with broken rendering (until next year texlive at
> > > least) for some dubious benefit of being able to \def\?????????????
> >
> > LuaTeX is still beta, nobody should expect flawlessness. Once a better
> > italic correction algorithm is found, we can upload a new version of
> > LuaTeX to TLcontrib.
>
> No, I'm not convinced that we have to keep a feature that no one needs
> just to break a feature that many need. If ConTeXt is doing fine without
> the cactcode assignment, I think LaTeX can survive it too.
>
> Regards,
>  Khaled
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> Message: 6
> Date: Sat, 8 Oct 2011 18:21:46 +0200
> From: Ulrike Fischer <luatex at nililand.de>
> To: luatex at tug.org
> Cc: tex-live at tug.org
> Subject: Re: [luatex] [tex-live] Ignored italic correction with
>        lua(la)tex      format
> Message-ID: <1u1to97usqlv2$.dlg at nililand.de>
> Content-Type: text/plain; charset="utf-8"
>
> Am Sat, 8 Oct 2011 15:46:29 +0200 schrieb Khaled Hosny:
>
> >>> The catcode
> >>> assignments just have to be taken out of lua(la)tex format files
>
> >> Please don't do this. The catcode assignments are totally correct, and
> >> it is LuaTeX which is IMHO buggy.
>
> > So we have to live with broken rendering (until next year texlive at
> > least) for some dubious benefit of being able to \def\?????????????
>
> I'm obviously not able to follow. Of which letters are you speaking?
> My version of luatex-unicode-letters.tex doesn't contain a \catcode
> setting in line 18 (there is the \begingroup-command).
>
> Also why it is necessary to change the formats? Why can't the
> problematic catcodes be changed in the document?
>
>
> --
> Ulrike Fischer
>
>
>
> ------------------------------
>
> Message: 7
> Date: Sat, 8 Oct 2011 18:55:01 +0200
> From: Javier M?gica de Rivera  <javieraritz.ribadeo at gmail.com>
> To: luatex at tug.org
> Subject: [luatex] ligatures with luaotfload
> Message-ID:
>        <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw at mail.gmail.com
> >
> Content-Type: text/plain; charset=ISO-8859-1
>
> I have used the luaotfload package for the first time, and worte the
> following code in order to do so:
>
> %def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
> \def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}
>
> \otffont\tenrm=LMRoman10-Regular at 10pt
>
> The font appears to be right at first sight but looking closer I see
> that kerning and ligatures are missing. How can that be solved?
>
> Another issue is the tlig and trep substitutions. If I write
> ``hello'', I get the right output if I use the node mode, but if I use
> the base mode I have to remove the trep option in order to get it
> right, otherwise what I get is two consecutive single-left-quotes. It
> seems that the package in base mode first applies the option trep,
> replacing the each ` with a quote, and then tlig is useless since the
> couple `` of original input characters is already gone. Since I
> perceived no differences between base and node modes I simply switched
> to node mode.
>
> Regards,
> Javier A. M?gica
>
>
>
> ------------------------------
>
> Message: 8
> Date: Sat, 8 Oct 2011 19:42:29 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] ligatures with luaotfload
> Message-ID: <20111008174229.GC19263 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Sat, Oct 08, 2011 at 06:55:01PM +0200, Javier M?gica de Rivera wrote:
> > I have used the luaotfload package for the first time, and worte the
> > following code in order to do so:
> >
> > %def\otffont#1=#2 at{\font#1={#2: mode=base;tlig;trep} at}
> > \def\otffont#1=#2 at{\font#1={#2: mode=node;tlig;trep} at}
> >
> > \otffont\tenrm=LMRoman10-Regular at 10pt
> >
> > The font appears to be right at first sight but looking closer I see
> > that kerning and ligatures are missing. How can that be solved?
>
> I don't know what version of luaotfload you are using, but in some old
> versions you had to explicitly enable each feature you want.
>
> > Another issue is the tlig and trep substitutions. If I write
> > ``hello'', I get the right output if I use the node mode, but if I use
> > the base mode I have to remove the trep option in order to get it
> > right, otherwise what I get is two consecutive single-left-quotes. It
> > seems that the package in base mode first applies the option trep,
> > replacing the each ` with a quote, and then tlig is useless since the
> > couple `` of original input characters is already gone. Since I
> > perceived no differences between base and node modes I simply switched
> > to node mode.
>
> tlig and trep are essentially broken by design, they are removed
> altogether from the unstable branch, I'm not sure if there will ever be
> a replacement in luaotfload so you would better find a different way to
> input typographic quotes.
>
> Regards,
>  Khaled
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> _______________________________________________
> luatex mailing list
> luatex at tug.org
> http://tug.org/mailman/listinfo/luatex
>
>
> End of luatex Digest, Vol 34, Issue 8
> *************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111008/3d9ef851/attachment-0001.html>

From reinhard.kotucha at web.de  Sun Oct  9 01:45:45 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 9 Oct 2011 01:45:45 +0200
Subject: [luatex] luatex Digest, Vol 34, Issue 8
In-Reply-To: <CAPPjOLp78ZWobkRH+Ft2J0tbsuF3g_9uti2gOgYuQA3EHeDqzw@mail.gmail.com>
References: <mailman.11615.1318095761.3619.luatex@tug.org>
 <CAPPjOLp78ZWobkRH+Ft2J0tbsuF3g_9uti2gOgYuQA3EHeDqzw@mail.gmail.com>
Message-ID: <20112.57513.418536.703460@zaphod.ms25.net>

On 2011-10-08 at 18:45:03 +0100, Mohamed Bana wrote:

 > Would someone please un-subscribe.  I've tried endlessly but it
 > doesn't seem to work.
 > 
 > Thank you.
 >  ?Mohamed
 > 
 > 
 > On 8 October 2011 18:42, <luatex-request at tug.org> wrote:
 > 
 > > [...]
 > > You can reach the person managing the list at
 > >        luatex-owner at tug.org

You can reach the person managing the list at luatex-owner at tug.org

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From javieraritz.ribadeo at gmail.com  Sun Oct  9 12:58:37 2011
From: javieraritz.ribadeo at gmail.com (=?ISO-8859-1?Q?Javier_M=FAgica_de_Rivera?=)
Date: Sun, 9 Oct 2011 12:58:37 +0200
Subject: [luatex] ligatures with luaotfload
In-Reply-To: <20111008173738.GB19263@khaled-laptop>
References: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
 <CALBOmsYVAK2=DYOdkUsccZj1K2mP=7qDL9=WoJXDUgVtfQNpDQ@mail.gmail.com>
 <20111008173738.GB19263@khaled-laptop>
Message-ID: <CABCShTg3Oe25L1bP8V-g_FqW1D1T+OMcPQBKoEUM3Bib4vXEbg@mail.gmail.com>

> you have to explicitly set kern and ligatures: [...] +liga;+kern

> if you don't select a script no feature will be enabled by default

Thank you two, both of

\def\otffont#1=#2 at{\font#1={#2: +kern;+liga} at}
\def\otffont#1=#2 at{\font#1={#2: script=latn} at}

work.

Now that I know the answer I have looked again into the luaoftload
manual and the OpenType Feature File Specification, and see that all
the nedeed pieces are present, but they appear scatered here and
there. You don't need to know anything about .tfm fonts in order to
use them. I would expect the same for otf fonts as long as you don't
ask for complicate operations. That is, I would expect

\input luaotfload.sty
\font\tenrm=LMRoman10-Regular

to be the same as

\font\tenrm=ec-lmr10


I _had_ read:

"script
OpenType script string, default value is dflt. Some fonts don?t assign
features to
the dflt script, in which case the script need to be set explicitly."

but since Latin Modern fonts are designed just for the Latin script I
could not imagine that keeping the default would miss features.
And it is true that at the section of "Troubleshooting" there appears
the example

\font\myfont = MyFont.otf:script=latn;+liga;

but here the key words latn and liga just happen to appear. That is,
if you want kerning you still have to find the appropriate word for
that somewhere else, as well as if you want some other script. And
after a good deal of browsing through the Internet to find the right
answer (the name for the kerning and ligature features) I had simply
forgotten about this last example, something likely to happen if you
need to put ten different pieces of information together in order to
make something work.

To summarize, in my opinion

    a) The package should try hard to make its default behavior what a
user would want when loading an OpenType font.

and

    b) It should provide a list of script names when it describes the
keyword script, and a list of feature names when it mentions that font
features are enabled/disabled "in the form of +feat/-feat" (there is
not a single example).

   The solution for point a) may just be to always activate kerning,
ligatures and final or other alternatives shapes for glyphs (is this
what is called contextual ligatures?)


Finally, Khaled, thank you very much for the package! I had asked some
two or three years ago how I could use an OpenType font in Luatex and
the answer was essentially "program it yourself"

Regards
Javier A. M?gica


From khaledhosny at eglug.org  Mon Oct 10 01:56:15 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 10 Oct 2011 01:56:15 +0200
Subject: [luatex] ligatures with luaotfload
In-Reply-To: <CABCShTg3Oe25L1bP8V-g_FqW1D1T+OMcPQBKoEUM3Bib4vXEbg@mail.gmail.com>
References: <CABCShTht996HKnF8DkM+uzBHm+XNwtAwN5f4--cexzn_04Dfnw@mail.gmail.com>
 <CALBOmsYVAK2=DYOdkUsccZj1K2mP=7qDL9=WoJXDUgVtfQNpDQ@mail.gmail.com>
 <20111008173738.GB19263@khaled-laptop>
 <CABCShTg3Oe25L1bP8V-g_FqW1D1T+OMcPQBKoEUM3Bib4vXEbg@mail.gmail.com>
Message-ID: <20111009235615.GA13725@khaled-laptop>

On Sun, Oct 09, 2011 at 12:58:37PM +0200, Javier M?gica de Rivera wrote:
> > you have to explicitly set kern and ligatures: [...] +liga;+kern
> 
> > if you don't select a script no feature will be enabled by default
> 
> Thank you two, both of
> 
> \def\otffont#1=#2 at{\font#1={#2: +kern;+liga} at}
> \def\otffont#1=#2 at{\font#1={#2: script=latn} at}
> 
> work.
> 
> Now that I know the answer I have looked again into the luaoftload
> manual and the OpenType Feature File Specification, and see that all
> the nedeed pieces are present, but they appear scatered here and
> there. You don't need to know anything about .tfm fonts in order to
> use them. I would expect the same for otf fonts as long as you don't
> ask for complicate operations. That is, I would expect
> 
> \input luaotfload.sty
> \font\tenrm=LMRoman10-Regular
> 
> to be the same as
> 
> \font\tenrm=ec-lmr10
> 
> 
> I _had_ read:
> 
> "script
> OpenType script string, default value is dflt. Some fonts don?t assign
> features to
> the dflt script, in which case the script need to be set explicitly."
> 
> but since Latin Modern fonts are designed just for the Latin script I
> could not imagine that keeping the default would miss features.
> And it is true that at the section of "Troubleshooting" there appears
> the example
> 
> \font\myfont = MyFont.otf:script=latn;+liga;
> 
> but here the key words latn and liga just happen to appear. That is,
> if you want kerning you still have to find the appropriate word for
> that somewhere else, as well as if you want some other script. And
> after a good deal of browsing through the Internet to find the right
> answer (the name for the kerning and ligature features) I had simply
> forgotten about this last example, something likely to happen if you
> need to put ten different pieces of information together in order to
> make something work.
> 
> To summarize, in my opinion
> 
>     a) The package should try hard to make its default behavior what a
> user would want when loading an OpenType font.

OpenType is a complicated beast and will never be as simple as old TFM
fonts (feature activation wise, else I see nothing simple about TFM
fonts; you had to do a good deal of complicated setup to merely install
them). However, \font\tenrm=LMRoman10-Regular was supposed to such work,
but the way it was actually implemented requires selecting a script for
things to work. This have been fixed in the unstable branch, so you may
want to use that until there is a release.

> and
> 
>     b) It should provide a list of script names when it describes the
> keyword script, and a list of feature names when it mentions that font
> features are enabled/disabled "in the form of +feat/-feat" (there is
> not a single example).

I'm not going to duplicate OpenType layout tag[1] registry in the
package documentation, sorry. However, improvements to make the
documentation more clear to people not familiar with OpenType are very
welcomed.

>    The solution for point a) may just be to always activate kerning,
> ligatures and final or other alternatives shapes for glyphs (is this
> what is called contextual ligatures?)

Things are more complicated than that since different scripts have
different set of features that need to be activated by default, this why
the old code required setting a script, now if no script is specified I
just assume it is DFLT and activates the respective set of feature
(which is the same as that of Latin script).

> Finally, Khaled, thank you very much for the package! I had asked some
> two or three years ago how I could use an OpenType font in Luatex and
> the answer was essentially "program it yourself"

Thanks all goes to Hans who is doing all the real work, Elie and others
who wrote the plain tex/latex package, I'm merely glueing things
together.

Regards,
 Khaled

[1] http://www.microsoft.com/typography/otspec/ttoreg.htm

-- 
 Khaled Hosny
 Egyptian
 Arab

From taco at elvenkind.com  Mon Oct 10 10:05:32 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 10 Oct 2011 10:05:32 +0200
Subject: [luatex] Building LuaTeX (again).
In-Reply-To: <283D377B-9245-47C6-ADB9-99D06EED177B@gmx.net>
References: <4E881309.7030702@free.fr>
 <alpine.DEB.2.00.1110040049440.10702@hahepc1.hahe> <4E8AA4E3.4040708@free.fr>
 <283D377B-9245-47C6-ADB9-99D06EED177B@gmx.net>
Message-ID: <4E92A74C.4050203@elvenkind.com>


Hi,

On 10/04/2011 11:10 AM, Keith J. Schultz wrote:
> Hi Hartmut,
>
> I am not know the system you are using, but I can other you some thoughts.

Same failure during crosscompile here

> 2) the is not finding the reference for EnumFontsA at 16

EnumFonts() is in gdi32.dll, which is not linked in luatex. That bit of 
code in GlobalParams.cc should have been preprocessed out (as it was in 
earlier versions, I think, thanks to PDF_PARSER_ONLY). Hartmut, is that 
enough information for you to fix it?

Best wishes,
Taco

From mohamed at bana.org.uk  Mon Oct 10 13:25:32 2011
From: mohamed at bana.org.uk (Mohamed Bana)
Date: Mon, 10 Oct 2011 12:25:32 +0100
Subject: [luatex] luatex Digest, Vol 34, Issue 12
In-Reply-To: <mailman.13.1318240801.5988.luatex@tug.org>
References: <mailman.13.1318240801.5988.luatex@tug.org>
Message-ID: <CAPPjOLpPvUt8FWQNJbp_Lb3rAEDoAMDkvVEWvgXZh=79U1JGyQ@mail.gmail.com>

I am having problems unsubscribing to this list.  Could someone please do
it.

I tried using the online interface but that did not work.  Someone please
help.

 ?Mohamed


On 10 October 2011 11:00, <luatex-request at tug.org> wrote:

> Send luatex mailing list submissions to
>        luatex at tug.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        http://tug.org/mailman/listinfo/luatex
> or, via email, send a message with subject or body 'help' to
>        luatex-request at tug.org
>
> You can reach the person managing the list at
>        luatex-owner at tug.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of luatex digest..."
>
>
> Today's Topics:
>
>   1. Re: ligatures with luaotfload (Javier M?gica de Rivera)
>   2. Re: ligatures with luaotfload (Khaled Hosny)
>   3. Re: Building LuaTeX (again). (Taco Hoekwater)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sun, 9 Oct 2011 12:58:37 +0200
> From: Javier M?gica de Rivera  <javieraritz.ribadeo at gmail.com>
> To: luatex at tug.org
> Subject: Re: [luatex] ligatures with luaotfload
> Message-ID:
>        <CABCShTg3Oe25L1bP8V-g_FqW1D1T+OMcPQBKoEUM3Bib4vXEbg at mail.gmail.com
> >
> Content-Type: text/plain; charset=windows-1252
>
> > you have to explicitly set kern and ligatures: [...] +liga;+kern
>
> > if you don't select a script no feature will be enabled by default
>
> Thank you two, both of
>
> \def\otffont#1=#2 at{\font#1={#2: +kern;+liga} at}
> \def\otffont#1=#2 at{\font#1={#2: script=latn} at}
>
> work.
>
> Now that I know the answer I have looked again into the luaoftload
> manual and the OpenType Feature File Specification, and see that all
> the nedeed pieces are present, but they appear scatered here and
> there. You don't need to know anything about .tfm fonts in order to
> use them. I would expect the same for otf fonts as long as you don't
> ask for complicate operations. That is, I would expect
>
> \input luaotfload.sty
> \font\tenrm=LMRoman10-Regular
>
> to be the same as
>
> \font\tenrm=ec-lmr10
>
>
> I _had_ read:
>
> "script
> OpenType script string, default value is dflt. Some fonts don?t assign
> features to
> the dflt script, in which case the script need to be set explicitly."
>
> but since Latin Modern fonts are designed just for the Latin script I
> could not imagine that keeping the default would miss features.
> And it is true that at the section of "Troubleshooting" there appears
> the example
>
> \font\myfont = MyFont.otf:script=latn;+liga;
>
> but here the key words latn and liga just happen to appear. That is,
> if you want kerning you still have to find the appropriate word for
> that somewhere else, as well as if you want some other script. And
> after a good deal of browsing through the Internet to find the right
> answer (the name for the kerning and ligature features) I had simply
> forgotten about this last example, something likely to happen if you
> need to put ten different pieces of information together in order to
> make something work.
>
> To summarize, in my opinion
>
>    a) The package should try hard to make its default behavior what a
> user would want when loading an OpenType font.
>
> and
>
>    b) It should provide a list of script names when it describes the
> keyword script, and a list of feature names when it mentions that font
> features are enabled/disabled "in the form of +feat/-feat" (there is
> not a single example).
>
>   The solution for point a) may just be to always activate kerning,
> ligatures and final or other alternatives shapes for glyphs (is this
> what is called contextual ligatures?)
>
>
> Finally, Khaled, thank you very much for the package! I had asked some
> two or three years ago how I could use an OpenType font in Luatex and
> the answer was essentially "program it yourself"
>
> Regards
> Javier A. M?gica
>
>
>
> ------------------------------
>
> Message: 2
> Date: Mon, 10 Oct 2011 01:56:15 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] ligatures with luaotfload
> Message-ID: <20111009235615.GA13725 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Sun, Oct 09, 2011 at 12:58:37PM +0200, Javier M?gica de Rivera wrote:
> > > you have to explicitly set kern and ligatures: [...] +liga;+kern
> >
> > > if you don't select a script no feature will be enabled by default
> >
> > Thank you two, both of
> >
> > \def\otffont#1=#2 at{\font#1={#2: +kern;+liga} at}
> > \def\otffont#1=#2 at{\font#1={#2: script=latn} at}
> >
> > work.
> >
> > Now that I know the answer I have looked again into the luaoftload
> > manual and the OpenType Feature File Specification, and see that all
> > the nedeed pieces are present, but they appear scatered here and
> > there. You don't need to know anything about .tfm fonts in order to
> > use them. I would expect the same for otf fonts as long as you don't
> > ask for complicate operations. That is, I would expect
> >
> > \input luaotfload.sty
> > \font\tenrm=LMRoman10-Regular
> >
> > to be the same as
> >
> > \font\tenrm=ec-lmr10
> >
> >
> > I _had_ read:
> >
> > "script
> > OpenType script string, default value is dflt. Some fonts don?t assign
> > features to
> > the dflt script, in which case the script need to be set explicitly."
> >
> > but since Latin Modern fonts are designed just for the Latin script I
> > could not imagine that keeping the default would miss features.
> > And it is true that at the section of "Troubleshooting" there appears
> > the example
> >
> > \font\myfont = MyFont.otf:script=latn;+liga;
> >
> > but here the key words latn and liga just happen to appear. That is,
> > if you want kerning you still have to find the appropriate word for
> > that somewhere else, as well as if you want some other script. And
> > after a good deal of browsing through the Internet to find the right
> > answer (the name for the kerning and ligature features) I had simply
> > forgotten about this last example, something likely to happen if you
> > need to put ten different pieces of information together in order to
> > make something work.
> >
> > To summarize, in my opinion
> >
> >     a) The package should try hard to make its default behavior what a
> > user would want when loading an OpenType font.
>
> OpenType is a complicated beast and will never be as simple as old TFM
> fonts (feature activation wise, else I see nothing simple about TFM
> fonts; you had to do a good deal of complicated setup to merely install
> them). However, \font\tenrm=LMRoman10-Regular was supposed to such work,
> but the way it was actually implemented requires selecting a script for
> things to work. This have been fixed in the unstable branch, so you may
> want to use that until there is a release.
>
> > and
> >
> >     b) It should provide a list of script names when it describes the
> > keyword script, and a list of feature names when it mentions that font
> > features are enabled/disabled "in the form of +feat/-feat" (there is
> > not a single example).
>
> I'm not going to duplicate OpenType layout tag[1] registry in the
> package documentation, sorry. However, improvements to make the
> documentation more clear to people not familiar with OpenType are very
> welcomed.
>
> >    The solution for point a) may just be to always activate kerning,
> > ligatures and final or other alternatives shapes for glyphs (is this
> > what is called contextual ligatures?)
>
> Things are more complicated than that since different scripts have
> different set of features that need to be activated by default, this why
> the old code required setting a script, now if no script is specified I
> just assume it is DFLT and activates the respective set of feature
> (which is the same as that of Latin script).
>
> > Finally, Khaled, thank you very much for the package! I had asked some
> > two or three years ago how I could use an OpenType font in Luatex and
> > the answer was essentially "program it yourself"
>
> Thanks all goes to Hans who is doing all the real work, Elie and others
> who wrote the plain tex/latex package, I'm merely glueing things
> together.
>
> Regards,
>  Khaled
>
> [1] http://www.microsoft.com/typography/otspec/ttoreg.htm
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 10 Oct 2011 10:05:32 +0200
> From: Taco Hoekwater <taco at elvenkind.com>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] Building LuaTeX (again).
> Message-ID: <4E92A74C.4050203 at elvenkind.com>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
>
> Hi,
>
> On 10/04/2011 11:10 AM, Keith J. Schultz wrote:
> > Hi Hartmut,
> >
> > I am not know the system you are using, but I can other you some
> thoughts.
>
> Same failure during crosscompile here
>
> > 2) the is not finding the reference for EnumFontsA at 16
>
> EnumFonts() is in gdi32.dll, which is not linked in luatex. That bit of
> code in GlobalParams.cc should have been preprocessed out (as it was in
> earlier versions, I think, thanks to PDF_PARSER_ONLY). Hartmut, is that
> enough information for you to fix it?
>
> Best wishes,
> Taco
>
>
> ------------------------------
>
> _______________________________________________
> luatex mailing list
> luatex at tug.org
> http://tug.org/mailman/listinfo/luatex
>
>
> End of luatex Digest, Vol 34, Issue 12
> **************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111010/6545241b/attachment.html>

From kuehnelf at gmail.com  Tue Oct 11 02:13:45 2011
From: kuehnelf at gmail.com (Frank Kuehnel)
Date: Mon, 10 Oct 2011 17:13:45 -0700
Subject: [luatex] another mlist callback
Message-ID: <7CF1C3F5-9963-476E-B241-39E123AD5906@gmail.com>

I recently started playing with LuaTex to see whether it is suitable for addressing the following problem:

For every math formula in a document I'd like to generate an equivalent content MathML expression and write
it out into a separate file. Content MathML doesn't require any style elements.

I thought the mlist_hlist callback function may be suitable for this task. However, I couldn't find any suitable
examples on how to use the mlist_to_hlist callback. I also looked briefly into the code base: "texmath.w".

Here, it seems like that the after_math function could neatly implement another mlist related callback, right after
the call to the fin_mlist routine (line 2249). The proposed callback function would take an mlist as the argument and return
either the same mlist or a modified mlist, which would then be processed into an hlist.

I just put out this idea for discussion to see whether somebody else has a better idea?

Thanks,
Frank
 




From zappathustra at free.fr  Tue Oct 11 10:32:33 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 11 Oct 2011 10:32:33 +0200
Subject: [luatex] another mlist callback
In-Reply-To: <7CF1C3F5-9963-476E-B241-39E123AD5906@gmail.com>
References: <7CF1C3F5-9963-476E-B241-39E123AD5906@gmail.com>
Message-ID: <4E93FF21.1020802@free.fr>

Le 11/10/2011 02:13, Frank Kuehnel a ?crit :
> I recently started playing with LuaTex to see whether it is suitable for addressing the following problem:
>
> For every math formula in a document I'd like to generate an equivalent content MathML expression and write
> it out into a separate file. Content MathML doesn't require any style elements.
>
> I thought the mlist_hlist callback function may be suitable for this task. However, I couldn't find any suitable
> examples on how to use the mlist_to_hlist callback. I also looked briefly into the code base: "texmath.w".
>
> Here, it seems like that the after_math function could neatly implement another mlist related callback, right after
> the call to the fin_mlist routine (line 2249). The proposed callback function would take an mlist as the argument and return
> either the same mlist or a modified mlist, which would then be processed into an hlist.
>
> I just put out this idea for discussion to see whether somebody else has a better idea?

You can do that directly in mlist_to_hlist, which should host a function 
that does what is described in Appendix G of the TeXbook -- so, no small 
task, but fortunately the function already exists in LuaTeX: 
node.mlist_to_hlist. So you can do whatever you want to your mlist and 
then pass it to node.mlist_to_hlist and return the result.

I hope this answer your question. I'll admit I didn't see the necessity 
of a new callback here.

Best,
Paul

From luigi.scarso at gmail.com  Tue Oct 11 10:33:57 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 11 Oct 2011 10:33:57 +0200
Subject: [luatex] another mlist callback
In-Reply-To: <7CF1C3F5-9963-476E-B241-39E123AD5906@gmail.com>
References: <7CF1C3F5-9963-476E-B241-39E123AD5906@gmail.com>
Message-ID: <CAG5iGsA6UNizrVYn=YZDAa3MGtqgsmKeXwRFbxfvdDC3BZ=jKA@mail.gmail.com>

On Tue, Oct 11, 2011 at 2:13 AM, Frank Kuehnel <kuehnelf at gmail.com> wrote:
> I recently started playing with LuaTex to see whether it is suitable for addressing the following problem:
>
> For every math formula in a document I'd like to generate an equivalent content MathML expression and write
> it out into a separate file. Content MathML doesn't require any style elements.
>
> I thought the mlist_hlist callback function may be suitable for this task. However, I couldn't find any suitable
> examples on how to use the mlist_to_hlist callback. I also looked briefly into the code base: "texmath.w".
>
> Here, it seems like that the after_math function could neatly implement another mlist related callback, right after
> the call to the fin_mlist routine (line 2249). The proposed callback function would take an mlist as the argument and return
> either the same mlist or a modified mlist, which would then be processed into an hlist.
>
> I just put out this idea for discussion to see whether somebody else has a better idea?
Have you seen ConTeXt MKIV ?
wiki.contexgarden.net
http://meeting.contextgarden.net/2011/talks/day3_01_hans_mathml/
-- 
luigi

From kuehnelf at gmail.com  Tue Oct 11 17:45:50 2011
From: kuehnelf at gmail.com (Frank Kuehnel)
Date: Tue, 11 Oct 2011 08:45:50 -0700
Subject: [luatex] another mlist callback
Message-ID: <FD4D9434-AA5E-4410-9C9C-F9A959529483@gmail.com>

Le 11/10/2011 02:13, Frank Kuehnel a ?crit :
> I recently started playing with LuaTex to see whether it is suitable for addressing the following problem:
>
> For every math formula in a document I'd like to generate an equivalent content MathML expression and write
> it out into a separate file. Content MathML doesn't require any style elements.
>
> I thought the mlist_hlist callback function may be suitable for this task. However, I couldn't find any suitable
> examples on how to use the mlist_to_hlist callback. I also looked briefly into the code base: "texmath.w".
>
> Here, it seems like that the after_math function could neatly implement another mlist related callback, right after
> the call to the fin_mlist routine (line 2249). The proposed callback function would take an mlist as the argument and return
> either the same mlist or a modified mlist, which would then be processed into an hlist.
>
> I just put out this idea for discussion to see whether somebody else has a better idea?

You can do that directly in mlist_to_hlist, which should host a function 
that does what is described in Appendix G of the TeXbook -- so, no small 
task, but fortunately the function already exists in LuaTeX: 
node.mlist_to_hlist. So you can do whatever you want to your mlist and 
then pass it to node.mlist_to_hlist and return the result.

I hope this answer your question. I'll admit I didn't see the necessity 
of a new callback here.

Best,
Paul

Thank you Paul, that is indeed an elegant solution!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111011/26860960/attachment.html>

From khaledhosny at eglug.org  Thu Oct 13 11:49:02 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 13 Oct 2011 11:49:02 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <1u1to97usqlv2$.dlg@nililand.de>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
Message-ID: <20111013094902.GA22364@khaled-laptop>

On Sat, Oct 08, 2011 at 06:21:46PM +0200, Ulrike Fischer wrote:
> Am Sat, 8 Oct 2011 15:46:29 +0200 schrieb Khaled Hosny:
> 
> >>> The catcode
> >>> assignments just have to be taken out of lua(la)tex format files
> 
> >> Please don't do this. The catcode assignments are totally correct, and
> >> it is LuaTeX which is IMHO buggy.
>  
> > So we have to live with broken rendering (until next year texlive at
> > least) for some dubious benefit of being able to \def\?????????????????????????????????????
> 
> I'm obviously not able to follow. Of which letters are you speaking?
> My version of luatex-unicode-letters.tex doesn't contain a \catcode
> setting in line 18 (there is the \begingroup-command). 

Sorry, line 28.

> Also why it is necessary to change the formats? Why can't the
> problematic catcodes be changed in the document?

I don't know which cat code is problematic and which is not (there are
so many characters used in math), but I think just resetting the catcode
table inside math mode would be less invasive, in latex something like:

\everymath{\luatexcatcodetable\CatcodeTableLaTeX}

(assumes luatexbase-cctb package is loaded).

P.S. this was given as an answer to this question on tex.stackexchange:
http://tex.stackexchange.com/questions/31438/how-can-i-enable-italic-correction-for-luatex

Regards,
 Khaled

From luatex at nililand.de  Thu Oct 13 15:47:01 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 13 Oct 2011 15:47:01 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
Message-ID: <1iyifb0oohapr$.dlg@nililand.de>

Am Thu, 13 Oct 2011 11:49:02 +0200 schrieb Khaled Hosny:


>> I'm obviously not able to follow. Of which letters are you speaking?
>> My version of luatex-unicode-letters.tex doesn't contain a \catcode
>> setting in line 18 (there is the \begingroup-command). 
 
> Sorry, line 28.
 
>> Also why it is necessary to change the formats? Why can't the
>> problematic catcodes be changed in the document?
> 
> I don't know which cat code is problematic and which is not (there are
> so many characters used in math),

Well in this case it is obviously the catcode of U+1D443. 

(I too find it a bit suspect that the catcode is used to decide if a
font related feature (italic correction) should be used.) 

>> but I think just resetting the catcode
>> table inside math mode would be less invasive, in latex something like:
>> 
>> \everymath{\luatexcatcodetable\CatcodeTableLaTeX}

I find it a bit problematic to reset the catcode table completly in
math. While it is unprobable that someone would try to use U+1D443
in a command name in math, I think it is not improbable that in
future a greek will use a beta, or a french an "?", or a german an
"?" in a command name. I think that an unicode engine like luatex
should not force its users to use only ascii-commands in math. 

If the catcode must be reset (that is if the engine can not handle
the problem better) it would be much better to set it only at the
end of the math:

\documentclass{article}
\usepackage{unicode-math}
\setmathfont{XITS Math}

\begin{document}

$P($

{\catcode`\^^^^^1d443=12 
$P($} 

\def\t?t{abc}

$ \t?t P(\luatexcatcodetable\CatcodeTableLaTeX$

\t?t

\everymath{\luatexcatcodetable\CatcodeTableLaTeX}
$ \t?t P($ %wrong
\end{document}



-- 
Ulrike Fischer 


From taco at elvenkind.com  Thu Oct 13 16:21:47 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 13 Oct 2011 16:21:47 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <1iyifb0oohapr$.dlg@nililand.de>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop> <1iyifb0oohapr$.dlg@nililand.de>
Message-ID: <4E96F3FB.7050409@elvenkind.com>

On 10/13/2011 03:47 PM, Ulrike Fischer wrote:
>
> (I too find it a bit suspect that the catcode is used to decide if a
> font related feature (italic correction) should be used.)

Agreed. But also I find it weird to have math variables with \catcode 
11, so I wonder what the rationale behind that is.

Best wishes,
Taco

From luatex at nililand.de  Thu Oct 13 16:35:40 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 13 Oct 2011 16:35:40 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop> <1iyifb0oohapr$.dlg@nililand.de>
 <4E96F3FB.7050409@elvenkind.com>
Message-ID: <hflgm0a2hvmy.dlg@nililand.de>

Am Thu, 13 Oct 2011 16:21:47 +0200 schrieb Taco Hoekwater:

> On 10/13/2011 03:47 PM, Ulrike Fischer wrote:
>>
>> (I too find it a bit suspect that the catcode is used to decide if a
>> font related feature (italic correction) should be used.)
> 
> Agreed. But also I find it weird to have math variables with \catcode 
> 11, so I wonder what the rationale behind that is.

Tthe file has been generated by a perl script (unicode-char-prep.pl)
with the help of the informations in
http://unicode.org/Public/UNIDATA/UnicodeData.txt. 

The perl script says "# \catcode = 11 for everything with GC=L*"

and the unicode-data entry for e.g. the mathematical P is:

1D443;MATHEMATICAL ITALIC CAPITAL P;Lu;0;L;<font> 0050;;;;N;;;;;

So I would say it has catcode 11 because unicode says it is a
letter. 

-- 
Ulrike Fischer 


From taco at elvenkind.com  Thu Oct 13 17:32:53 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 13 Oct 2011 17:32:53 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <hflgm0a2hvmy.dlg@nililand.de>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop> <1iyifb0oohapr$.dlg@nililand.de>
 <4E96F3FB.7050409@elvenkind.com> <hflgm0a2hvmy.dlg@nililand.de>
Message-ID: <4E9704A5.9050201@elvenkind.com>

On 10/13/2011 04:35 PM, Ulrike Fischer wrote:
>
> The perl script says "# \catcode = 11 for everything with GC=L*"
>
> and the unicode-data entry for e.g. the mathematical P is:
>
> 1D443;MATHEMATICAL ITALIC CAPITAL P;Lu;0;L;<font>  0050;;;;N;;;;;
>
> So I would say it has catcode 11 because unicode says it is a
> letter.

IMHO, The Unicode specification is being silly, but nothing can be done 
about that, I am quite sure.

In any case: probably luatex should not be using \catcode's to make 
decisions. Luckily, following the Unicode logic, it would be allowed to 
use \lccode <> 0 instead. It would still be wrong though, and that is 
the frustrating part here: it is not at all clear to me what the 
algorithm should be on when to apply italic corrections in math mode.

Best wishes,
Taco


From khaledhosny at eglug.org  Thu Oct 13 19:00:43 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 13 Oct 2011 19:00:43 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <4E9704A5.9050201@elvenkind.com>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <1iyifb0oohapr$.dlg@nililand.de> <4E96F3FB.7050409@elvenkind.com>
 <hflgm0a2hvmy.dlg@nililand.de> <4E9704A5.9050201@elvenkind.com>
Message-ID: <20111013170043.GA22726@khaled-laptop>

On Thu, Oct 13, 2011 at 05:32:53PM +0200, Taco Hoekwater wrote:
> On 10/13/2011 04:35 PM, Ulrike Fischer wrote:
> >
> >The perl script says "# \catcode = 11 for everything with GC=L*"
> >
> >and the unicode-data entry for e.g. the mathematical P is:
> >
> >1D443;MATHEMATICAL ITALIC CAPITAL P;Lu;0;L;<font>  0050;;;;N;;;;;
> >
> >So I would say it has catcode 11 because unicode says it is a
> >letter.
> 
> IMHO, The Unicode specification is being silly, but nothing can be
> done about that, I am quite sure.
> 
> In any case: probably luatex should not be using \catcode's to make
> decisions. Luckily, following the Unicode logic, it would be allowed
> to use \lccode <> 0 instead. It would still be wrong though, and
> that is the frustrating part here: it is not at all clear to me what
> the algorithm should be on when to apply italic corrections in math
> mode.

I did a bit of testing with Word, it seems for alphanumeric symbols
(e.g. f,?? or 1) the italic correction is only applied when it is
followed by a non-alphanumeric symbol, e.g. between "??(", "f(" and "1("
but not "????" or "????" or "f1". For non alphanumeric symbols, e.g. "+" or
"?" (as a symbol not an operator), italic correction is always applied,
e.g.  between "+++" or "???" or "?+?+". At the end of math mode italic
correction is always applied.

So, it seems to me the algorithm is something like:

if not isalphanum(current)
  apply_ic(current)
else
  if not next or not isalphanum(next)
    apply_ic(current)

Regards,
 Khaled

From khaledhosny at eglug.org  Thu Oct 13 19:11:06 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 13 Oct 2011 19:11:06 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
Message-ID: <20111013171106.GA23308@khaled-laptop>

On Fri, Oct 14, 2011 at 04:04:37AM +1100, Vafa Khalighi wrote:
> 
> > On Thu, Oct 13, 2011 at 8:49 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:
> > I don't know which cat code is problematic and which is not (there are
> > so many characters used in math), but I think just resetting the catcode
> > table inside math mode would be less invasive, in latex something like:
> > 
> > \everymath{\luatexcatcodetable\CatcodeTableLaTeX}
> 
> then you should also do it for display math with \everydisplay hook!

Right, I missed that.

Regards,
 Khaled

From vafaklg at gmail.com  Thu Oct 13 19:04:37 2011
From: vafaklg at gmail.com (Vafa Khalighi)
Date: Fri, 14 Oct 2011 04:04:37 +1100
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <20111013094902.GA22364@khaled-laptop>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
Message-ID: <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>

On Thu, Oct 13, 2011 at 8:49 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:

> On Sat, Oct 08, 2011 at 06:21:46PM +0200, Ulrike Fischer wrote:
> > Am Sat, 8 Oct 2011 15:46:29 +0200 schrieb Khaled Hosny:
> >
> > >>> The catcode
> > >>> assignments just have to be taken out of lua(la)tex format files
> >
> > >> Please don't do this. The catcode assignments are totally correct, and
> > >> it is LuaTeX which is IMHO buggy.
> >
> > > So we have to live with broken rendering (until next year texlive at
> > > least) for some dubious benefit of being able to
> \def\?????????????????????????????????????
> >
> > I'm obviously not able to follow. Of which letters are you speaking?
> > My version of luatex-unicode-letters.tex doesn't contain a \catcode
> > setting in line 18 (there is the \begingroup-command).
>
> Sorry, line 28.
>
> > Also why it is necessary to change the formats? Why can't the
> > problematic catcodes be changed in the document?
>
> I don't know which cat code is problematic and which is not (there are
> so many characters used in math), but I think just resetting the catcode
> table inside math mode would be less invasive, in latex something like:
>
> \everymath{\luatexcatcodetable\CatcodeTableLaTeX}
>
>
>
then you should also do it for display math with \everydisplay hook!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111014/32f22f64/attachment.html>

From kuehnelf at gmail.com  Sat Oct 15 03:10:59 2011
From: kuehnelf at gmail.com (Frank Kuehnel)
Date: Fri, 14 Oct 2011 18:10:59 -0700
Subject: [luatex] writing to tex stream
Message-ID: <5F48BF13-42B9-44DC-99A3-278881858F0D@gmail.com>

Is there any documentation on how to write to a custom defined output-stream?

I couldn't find any help on how to set up an output stream defined in tex and used
in lua, i.e

\newwrite\xmlfile
\immediate\openout\xmlfile=test.xml
\immediate\write\xmlfile{<?xml version="1.0"?>}

\directlua{
	tex.print(... ???
}

Thanks for your help,

Frank

From schuster.wolfgang at googlemail.com  Sat Oct 15 13:42:51 2011
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Sat, 15 Oct 2011 13:42:51 +0200
Subject: [luatex] writing to tex stream
In-Reply-To: <5F48BF13-42B9-44DC-99A3-278881858F0D@gmail.com>
References: <5F48BF13-42B9-44DC-99A3-278881858F0D@gmail.com>
Message-ID: <741793F7-D994-4E46-9C68-0FF1C404295F@googlemail.com>


Am 15.10.2011 um 03:10 schrieb Frank Kuehnel:

> Is there any documentation on how to write to a custom defined output-stream?
> 
> I couldn't find any help on how to set up an output stream defined in tex and used
> in lua, i.e
> 
> \newwrite\xmlfile
> \immediate\openout\xmlfile=test.xml
> \immediate\write\xmlfile{<?xml version="1.0"?>}
> 
> \directlua{
> 	tex.print(... ???
> }
> 
> Thanks for your help,

Use Lua to open a file and write into the file, i wrote short example in ConTeXt to show you how it can be done.

\startluacode

export = io.open("test.xml","wb")

function writexml(str)
    export:write(str,"\n")
end

\stopluacode

\def\writexml#1{\ctxlua{writexml([==[#1]==])}}

\starttext

\writexml{<?xml version="1.0"?>}
\writexml{<document>}
\writexml{<p>Text</p>}
\writexml{</document>}

\stoptext

Wolfgang

From yannis.haralambous at telecom-bretagne.eu  Sun Oct 16 16:43:56 2011
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 16 Oct 2011 16:43:56 +0200
Subject: [luatex] How to avoid update of otfl-names.lua
Message-ID: <70BE93D0-FE8E-46E0-8CB8-8E5118224BDB@telecom-bretagne.eu>

Hi,

for the zebrackets system I have manually changed the otfl-names.lua file (all Latin Modern file names
have been replaced by those of the zebracketed ones). For example:

  {
   ["familyname"]="LMRoman17",
   ["filename"]={ "zebralmroman17-regular.otf", false },
   ["fontname"]="LMRoman17-Regular",
   ["fontstyle_name"]="Regular",
   ["fullname"]="LMRoman17-Regular",
   ["names"]={
    ["family"]="Latin Modern Roman",
    ["fullname"]="LM Roman 17 Regular",
    ["psname"]="LMRoman17-Regular",
    ["subfamily"]="Regular",
   },
   ["size"]={ 172, 240, 140 },
   ["slant"]=0,
   ["weight"]=400,
   ["width"]=5,
  },

This works perfectly (lualatex thinks it is using
Latin Modern Roman and in reality the font files embedded are those of the zebracketed version),
but *every time* I run a file, the font names database is updated anew: I get the message

luaotfload | Font names database loaded: /Users/yannis/.texlive2011/texmf-var/l
uatex-cache/generic/names/otfl-names.lua
luaotfload | Updating the font names database:
luaotfload | Scanning TEXMF fonts...
luaotfload | Scanning OS fonts...
luaotfload | Font names database saved: %s 
: /Users/yannis/.texlive2011/texmf-var/luatex-cache/generic/names/otfl-names.lua

This takes some time, and this is quite annoying. I wonder why the file has to be updated every time?
Has it to do with the timestamps at the end?

  ["zebralmroman17-regular.otf"]={
   ["index"]={ 212 },
   ["timestamp"]=1255129361,
  },

Since lmroman17-regular.otf has been replaced by zebralmroman17-regular.otf, I guess that the timestamp
is not correct, is this why the database is updated every time?

If yes, how are the timestamps calculated, so that I can recalculate them?

If not, is there some other reason?

thanks in advance

Yannis

-- 
-------------------------------------------------------
Yannis Haralambous
Directeur d'?tudes
Institut T?l?com, T?l?com Bretagne
D?partement Informatique
UMR CNRS 3192 Lab-STICC
Technop?le Brest Iroise
CS 83818, 29238 Brest Cedex 3, France
Tel: +33 2 29 00 14 27
Fax: +33 2 29 00 12 82
Email: yannis.haralambous at telecom-bretagne.eu
Internet: http://omega.enstb.org/yannis
ICBM address: 48?21'31.57"N 4?34'16.76"W
Twitter: y_haralambous
-------------------------------------------------------
...pour distinguer l'ext?rieur d'un aquarium,
mieux vaut n'?tre pas poisson

...the ball I threw while playing in the park
has not yet reached the ground

Es gab eine Zeit, wo ich nur ungern ?ber Schubert sprechen,
nur N?chtens den B?umen und Sternen von ihm vorerz?hlen m?gen.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20111016/031219c1/attachment.bin>
-------------- next part --------------


From khaledhosny at eglug.org  Sun Oct 16 17:12:56 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 16 Oct 2011 17:12:56 +0200
Subject: [luatex] How to avoid update of otfl-names.lua
In-Reply-To: <70BE93D0-FE8E-46E0-8CB8-8E5118224BDB@telecom-bretagne.eu>
References: <70BE93D0-FE8E-46E0-8CB8-8E5118224BDB@telecom-bretagne.eu>
Message-ID: <20111016151256.GA1861@khaled-laptop>

On Sun, Oct 16, 2011 at 04:43:56PM +0200, Yannis Haralambous wrote:
> Hi,
> 
> for the zebrackets system I have manually changed the otfl-names.lua
> file (all Latin Modern file names have been replaced by those of the
> zebracketed ones). For example:

And why you are doing that any way, why not loading zebrackets fonts
(whatever is that) directly?

[...]

> If yes, how are the timestamps calculated, so that I can recalculate
> them?

Timestamps are calculated using lfs.attributes(file, "modification"),
but it should not cause regenerating otfl-names.lua (they are used to
avoid re-scanning font files unnecessarily).

> If not, is there some other reason?

otfl-names.lua gets (re)generated if no one exits or when asking for a
font that is not found in the database.

Regards,
 Khaled

From yannis.haralambous at telecom-bretagne.eu  Sun Oct 16 19:13:10 2011
From: yannis.haralambous at telecom-bretagne.eu (Yannis Haralambous)
Date: Sun, 16 Oct 2011 19:13:10 +0200
Subject: [luatex] math list?
Message-ID: <9AF265EA-71ED-4D66-9DC2-1E8A13B6108E@telecom-bretagne.eu>

Hi,

I'm using

for t in node.traverse(h) do
     texio.write_nl(string.rep("...",prof) .. 'NODE type=' ..  node.type(t.id) .. ' subtype=' .. t.subtype )
end

in the pre_linebreak_filter to display all nodes in an hlist. This works well.

My question is: how to access math lists? When there is math in my document I get only one node, of type "math" (subtype 1),
I guess that behind that node there is an mlist, but how can I traverse it?

I found the mlist_to_hlist() method, but when I do

for x in node.traverse(node.mlist_to_hlist(t,"text",true)) do
     		texio.write_nl('in MATH list ' .. string.rep("...",prof) .. 'NODE type=' ..  node.type(x.id) .. ' subtype=' .. x.subtype )
     	end

I get the following error:

! This can't happen (mlist1).
l.14 
I'm broken. Please show this to someone who can fix can fix

And even if I manage to convert the mlist into a hlist to traverse it, the question is: how do I get back to the mlist? (since I want
to replace some glyphs by others).

thanks in advance for any help?

Yannis

-- 
-------------------------------------------------------
Yannis Haralambous
Directeur d'?tudes
Institut T?l?com, T?l?com Bretagne
D?partement Informatique
UMR CNRS 3192 Lab-STICC
Technop?le Brest Iroise
CS 83818, 29238 Brest Cedex 3, France
Tel: +33 2 29 00 14 27
Fax: +33 2 29 00 12 82
Email: yannis.haralambous at telecom-bretagne.eu
Internet: http://omega.enstb.org/yannis
ICBM address: 48?21'31.57"N 4?34'16.76"W
Twitter: y_haralambous
-------------------------------------------------------
...pour distinguer l'ext?rieur d'un aquarium,
mieux vaut n'?tre pas poisson

...the ball I threw while playing in the park
has not yet reached the ground

Es gab eine Zeit, wo ich nur ungern ?ber Schubert sprechen,
nur N?chtens den B?umen und Sternen von ihm vorerz?hlen m?gen.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yannis Haralambous.vcf
Type: text/directory
Size: 508 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20111016/0896bbf2/attachment.bin>
-------------- next part --------------


From vafaklg at gmail.com  Mon Oct 17 04:28:47 2011
From: vafaklg at gmail.com (Vafa Khalighi)
Date: Mon, 17 Oct 2011 13:28:47 +1100
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111013171106.GA23308@khaled-laptop>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
 <20111013171106.GA23308@khaled-laptop>
Message-ID: <CAB6rp_a=tOzcV_6GrqkNXeDovU0SHNE5dizC=HPpjN4XGCuadQ@mail.gmail.com>

Also it would be better to do it as:

\everymath\expandafter{\the\everymath \luatexcatcodetable\CatcodeTableLaTeX}

then, if some other packages also use \everymath and \everydisplay, their
contents does not get lost. As an example amsmath package puts \@displaytrue
inside \everydisplay.

or even better, you can use everyhook package.<http://ctan.org/pkg/everyhook>

On Fri, Oct 14, 2011 at 4:11 AM, Khaled Hosny <khaledhosny at eglug.org> wrote:

> On Fri, Oct 14, 2011 at 04:04:37AM +1100, Vafa Khalighi wrote:
> >
> > > On Thu, Oct 13, 2011 at 8:49 PM, Khaled Hosny <khaledhosny at eglug.org>
> wrote:
> > > I don't know which cat code is problematic and which is not (there are
> > > so many characters used in math), but I think just resetting the
> catcode
> > > table inside math mode would be less invasive, in latex something like:
> > >
> > > \everymath{\luatexcatcodetable\CatcodeTableLaTeX}
> >
> > then you should also do it for display math with \everydisplay hook!
>
> Right, I missed that.
>
> Regards,
>  Khaled
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20111017/34ebb635/attachment.html>

From zappathustra at free.fr  Mon Oct 17 08:27:54 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 17 Oct 2011 08:27:54 +0200
Subject: [luatex] math list?
In-Reply-To: <9AF265EA-71ED-4D66-9DC2-1E8A13B6108E@telecom-bretagne.eu>
References: <9AF265EA-71ED-4D66-9DC2-1E8A13B6108E@telecom-bretagne.eu>
Message-ID: <4E9BCAEA.8020202@free.fr>

Le 16/10/2011 19:13, Yannis Haralambous a ?crit :
> Hi,
>
> I'm using
>
> for t in node.traverse(h) do
>       texio.write_nl(string.rep("...",prof) .. 'NODE type=' ..  node.type(t.id) .. ' subtype=' .. t.subtype )
> end
>
> in the pre_linebreak_filter to display all nodes in an hlist. This works well.
>
> My question is: how to access math lists? When there is math in my document I get only one node, of type "math" (subtype 1),
> I guess that behind that node there is an mlist, but how can I traverse it?
>
> I found the mlist_to_hlist() method, but when I do
>
> for x in node.traverse(node.mlist_to_hlist(t,"text",true)) do
>       		texio.write_nl('in MATH list ' .. string.rep("...",prof) .. 'NODE type=' ..  node.type(x.id) .. ' subtype=' .. x.subtype )
>       	end
>
> I get the following error:
>
> ! This can't happen (mlist1).
> l.14
> I'm broken. Please show this to someone who can fix can fix
>
> And even if I manage to convert the mlist into a hlist to traverse it, the question is: how do I get back to the mlist? (since I want
> to replace some glyphs by others).

In the pre_linebreak_filter the mlist has already been turned into an 
hlist. So you'll find usual nodes surrounded by math nodes. To access 
the mlist itself, you have to use the mlist_to_hlist callback:

callback.register("mlist_to_hlist",
function (h, d, p)
     for t in node.traverse(h) do
         texio.write_nl(string.rep("...",prof) .. 'NODE type=' .. 
node.type(t.id) .. ' subtype=' .. t.subtype )
     end
     return node.mlist_to_hlist(h, d, p)
end)

Note that the node.mlist_to_hlist function is called there, to do the 
conversion the callback normally does by itself.

Best,
Paul


From luatex at nililand.de  Mon Oct 17 09:42:53 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 17 Oct 2011 09:42:53 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
 <20111013171106.GA23308@khaled-laptop>
 <CAB6rp_a=tOzcV_6GrqkNXeDovU0SHNE5dizC=HPpjN4XGCuadQ@mail.gmail.com>
Message-ID: <1c26vobh5nbdu$.dlg@nililand.de>

Am Mon, 17 Oct 2011 13:28:47 +1100 schrieb Vafa Khalighi:

> Also it would be better to do it as:
> 
> \everymath\expandafter{\the\everymath \luatexcatcodetable\CatcodeTableLaTeX}
> 
> then, if some other packages also use \everymath and \everydisplay, their
> contents does not get lost. As an example amsmath package puts \@displaytrue
> inside \everydisplay.

To repeat my comment in another branch of this thread:

I find it a bit problematic to reset the catcode table completly in
math. While it is unprobable that someone would try to use U+1D443
in a command name in math, I think it is not improbable that in
future a greek will use a beta, or a french an "?", or a german an
"?" in a command name. I think that an unicode engine like luatex
should not force its users to use only ascii-commands in math. 

If the catcode must be reset (that is if the engine can not handle
the problem better) it would be much better to set it at the
*end* of the math environment (this will be enough for the problem
discussed here). But as Taco said he will change the engine,
resetting the catcode will probably not be necessary at all.

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Oct 17 10:43:13 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 10:43:13 +0200
Subject: [luatex] math list?
In-Reply-To: <4E9BCAEA.8020202@free.fr>
References: <9AF265EA-71ED-4D66-9DC2-1E8A13B6108E@telecom-bretagne.eu>
 <4E9BCAEA.8020202@free.fr>
Message-ID: <20111017084313.GB7517@khaled-laptop>

On Mon, Oct 17, 2011 at 08:27:54AM +0200, Paul Isambert wrote:
> In the pre_linebreak_filter the mlist has already been turned into
> an hlist. So you'll find usual nodes surrounded by math nodes.

IIRC, this is true only for inline math, display math-resulting nodes
are only accessible in one of the (h|v)pack filters.

Regards,
 Khaled

From khaledhosny at eglug.org  Mon Oct 17 10:45:14 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 10:45:14 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <1c26vobh5nbdu$.dlg@nililand.de>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
 <20111013171106.GA23308@khaled-laptop>
 <CAB6rp_a=tOzcV_6GrqkNXeDovU0SHNE5dizC=HPpjN4XGCuadQ@mail.gmail.com>
 <1c26vobh5nbdu$.dlg@nililand.de>
Message-ID: <20111017084514.GA8266@khaled-laptop>

On Mon, Oct 17, 2011 at 09:42:53AM +0200, Ulrike Fischer wrote:
> But as Taco said he will change the engine, resetting the catcode will
> probably not be necessary at all.

Not before texlive2012 at least.

Regards,
 Khaled

From taco at elvenkind.com  Mon Oct 17 10:47:53 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 17 Oct 2011 10:47:53 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
	format
In-Reply-To: <20111017084514.GA8266@khaled-laptop>
References: <20111.30635.661281.93178@zaphod.ms25.net>
 <201110072211.p97MBYLY008306@freefriends.org>
 <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop> <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
 <20111013171106.GA23308@khaled-laptop>
 <CAB6rp_a=tOzcV_6GrqkNXeDovU0SHNE5dizC=HPpjN4XGCuadQ@mail.gmail.com>
 <1c26vobh5nbdu$.dlg@nililand.de> <20111017084514.GA8266@khaled-laptop>
Message-ID: <AB0565D7-E7A5-4EED-BAE1-6A07A1ABDAC2@elvenkind.com>


On Oct 17, 2011, at 10:45 AM, Khaled Hosny wrote:

> On Mon, Oct 17, 2011 at 09:42:53AM +0200, Ulrike Fischer wrote:
>> But as Taco said he will change the engine, resetting the catcode will
>> probably not be necessary at all.
> 
> Not before texlive2012 at least.

I am positive that this issue will be fixed in the engine one way or another before texlive 2012...

From khaledhosny at eglug.org  Mon Oct 17 10:53:41 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 17 Oct 2011 10:53:41 +0200
Subject: [luatex] [tex-live] Ignored italic correction with lua(la)tex
 format
In-Reply-To: <AB0565D7-E7A5-4EED-BAE1-6A07A1ABDAC2@elvenkind.com>
References: <CAArVCkQgg_gfJ+YCeUzTVYm6GGYtKgmTzLS5a3yGux3bw7CyEg@mail.gmail.com>
 <20111008134629.GC16449@khaled-laptop>
 <1u1to97usqlv2$.dlg@nililand.de>
 <20111013094902.GA22364@khaled-laptop>
 <CAB6rp_b8j2nebxaMiuZ39yYPj-Bh8BaO6Y3xgUF_9SjvMUvPRw@mail.gmail.com>
 <20111013171106.GA23308@khaled-laptop>
 <CAB6rp_a=tOzcV_6GrqkNXeDovU0SHNE5dizC=HPpjN4XGCuadQ@mail.gmail.com>
 <1c26vobh5nbdu$.dlg@nililand.de>
 <20111017084514.GA8266@khaled-laptop>
 <AB0565D7-E7A5-4EED-BAE1-6A07A1ABDAC2@elvenkind.com>
Message-ID: <20111017085341.GA8302@khaled-laptop>

On Mon, Oct 17, 2011 at 10:47:53AM +0200, Taco Hoekwater wrote:
> 
> On Oct 17, 2011, at 10:45 AM, Khaled Hosny wrote:
> 
> > On Mon, Oct 17, 2011 at 09:42:53AM +0200, Ulrike Fischer wrote:
> >> But as Taco said he will change the engine, resetting the catcode will
> >> probably not be necessary at all.
> > 
> > Not before texlive2012 at least.
> 
> I am positive that this issue will be fixed in the engine one way or
> another before texlive 2012...

I meant that even if fixed today, new binaries will not hit texlive
before 2012 release.

Regards,
 Khaled

From Arno.Trautmann at gmx.de  Mon Oct 31 12:50:21 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Mon, 31 Oct 2011 12:50:21 +0100
Subject: [luatex] reverse node lists
Message-ID: <4EAE8B7D.6000000@gmx.de>

Hi all,

this is again a rather simple question and I am sorry for taking your 
time for this ?
In short, I want to reverse all glyph nodes in a line, and/or all lines 
in a paragraph. I tried something like the following (with the idea to 
store all lines in a list, then replace the lines with the list in 
reversed order):

function reverse(head)

newlines = {}
i = 1
   for line in node.traverse_id(node.id"hhead",head) do
     newlines[i] = line
     i = i+1
   end

j = #newlines

   for line in node.traverse_id(node.id"hhead",head) do
     node.insert_before(head,line,newlines[j])
     j = j-1
   end
   return head
end

to be registered in the post_linebreak_callback. But then LuaTeX just 
stops, without errors or something. Using a node.remove in the second 
loop also does not help, and in total, everything I tried did not work 
as suspected. I guess I'm doing something small wrong again, but just 
can't figure out what ?

cheers
Arno

