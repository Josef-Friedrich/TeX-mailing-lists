From aschmittbuhl at libertysurf.fr  Wed Jun  1 08:22:14 2011
From: aschmittbuhl at libertysurf.fr (Arnaud Schmittbuhl)
Date: Wed, 1 Jun 2011 08:22:14 +0200
Subject: [luatex] Bug when changing delimiter size?
Message-ID: <20110601082214.5658eb82@debian>


Hi all,

This code does not give the same result with a luatex compilation or a
pdf one (pb seen by V. Garibal on fctt)

- [bad]  This is LuaTeX, Version beta-0.70.1-2011051923 (rev 4277)
- [good] This is pdfTeX, Version 3.1415926-1.40.11 (TeX Live 2010)
- [good] This is XeTeX, Version 3.1415926-2.2-0.9997.4 (TeX Live 2010)

$\Arrowvert \big\Arrowvert$
\bye

I remember something similar with brackets in a math formula and some
otf fonts. In high size, left bracket got changed to a right one!


-- 
Arnaud Schmittbuhl

From taco at elvenkind.com  Wed Jun  1 08:49:43 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 01 Jun 2011 08:49:43 +0200
Subject: [luatex] Bug when changing delimiter size?
In-Reply-To: <20110601082214.5658eb82@debian>
References: <20110601082214.5658eb82@debian>
Message-ID: <4DE5E107.6090205@elvenkind.com>



On 06/01/11 08:22, Arnaud Schmittbuhl wrote:
> This code does not give the same result with a luatex compilation or a
> pdf one (pb seen by V. Garibal on fctt)
> 
> - [bad]  This is LuaTeX, Version beta-0.70.1-2011051923 (rev 4277)
> - [good] This is pdfTeX, Version 3.1415926-1.40.11 (TeX Live 2010)
> - [good] This is XeTeX, Version 3.1415926-2.2-0.9997.4 (TeX Live 2010)
> 
> $\Arrowvert \big\Arrowvert$
> \bye

> I remember something similar with brackets in a math formula and some
> otf fonts. In high size, left bracket got changed to a right one!

Tracker item added. I think I understand what is going on, but finding
a perfect fix could turn out to be somewhat hard.

cmex10 has an extensible character list for the \Arrowvert delimiter
that starts at the middle of the right brace (that is "3B in family 3).
Clearly this glyph is supposed to be *always* skipped/ignored itself,
but luatex does not do that (obviously).

Best wishes,
Taco

From reiner.pope at gmail.com  Wed Jun  1 17:01:12 2011
From: reiner.pope at gmail.com (Reiner Pope)
Date: Thu, 02 Jun 2011 01:01:12 +1000
Subject: [luatex] Getting macro expansions from Lua
Message-ID: <4DE65438.9080108@gmail.com>

Hi,

I'm trying to expand TeX macros from within Lua code, but I can't work 
out how to do this.

I would like to write code like this

\def\A{1}
\directlua{
   t = token.create("A")
   toks = tex.get_expansion(t)  % the tex.get_expansion function is what 
I want
   % toks should consist of the token '1'.
   }

\bye

My motivation is that I want to access LaTeX's referencing information 
from Lua. To find the label number for, say, 'equationone', I need to 
look in the macro \r at equationone.

It is possible to achieve roughly what I want by calling out of Lua and 
back into it, but it's ugly:

(file test.tex)
\def\A{2}
\directlua{
   s = "A"
   dofile('run.lua')
}
\bye

(file test.lua)
tex.sprint('\\directlua{ t = "\\' .. s .. '"\
     if t == "1" then tex.sprint("got 1") else tex.sprint("not 1") end\
  }')

(This will print "got 1" if the first line is \def\A{1}, and will print 
"not 1" otherwise.)

What I'm looking for is a way to do this without nesting 
\directlua{tex.sprint("\directlua{...}")}.

Cheers,
Reiner

From taco at elvenkind.com  Thu Jun  2 10:28:45 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 02 Jun 2011 10:28:45 +0200
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <4DE65438.9080108@gmail.com>
References: <4DE65438.9080108@gmail.com>
Message-ID: <4DE749BD.70708@elvenkind.com>

On 06/01/2011 05:01 PM, Reiner Pope wrote:
>
> What I'm looking for is a way to do this without nesting
> \directlua{tex.sprint("\directlua{...}")}.

Not possible yet (but it is on the todo list).

Best wishes,
Taco

From zappathustra at free.fr  Thu Jun  2 11:22:27 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 02 Jun 2011 11:22:27 +0200
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <4DE749BD.70708@elvenkind.com>
References: <4DE65438.9080108@gmail.com> <4DE749BD.70708@elvenkind.com>
Message-ID: <4DE75653.5060904@free.fr>

Le 02/06/2011 10:28, Taco Hoekwater a ?crit :
> On 06/01/2011 05:01 PM, Reiner Pope wrote:
>>
>> What I'm looking for is a way to do this without nesting
>> \directlua{tex.sprint("\directlua{...}")}.
>
> Not possible yet (but it is on the todo list).

I wanted to try some hack with token.create/token.expand, but I found that:

\def\A{1}
\directlua{
   local A = token.create("A")
   token.expand(A)
}

produces an "Undefined control sequence" error. Which is all the more 
surprising as if the token is fed to TeX in the token_filter callback, 
as in the stupid example below, the control sequence is fine:

\def\A{1}
\directlua{
callback.register("token_filter",
   function ()
     callback.register("token_filter", nil)
     return token.create("A")
   end)
}

Have I misunderstood something or should I pay a visit to the bug tracker?

Best,
Paul

From reiner.pope at gmail.com  Thu Jun  2 11:46:14 2011
From: reiner.pope at gmail.com (Reiner Pope)
Date: Thu, 02 Jun 2011 19:46:14 +1000
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <4DE749BD.70708@elvenkind.com>
References: <4DE65438.9080108@gmail.com> <4DE749BD.70708@elvenkind.com>
Message-ID: <4DE75BE6.3070108@gmail.com>

On 02/06/11 18:28, Taco Hoekwater wrote:
> On 06/01/2011 05:01 PM, Reiner Pope wrote:
>>
>> What I'm looking for is a way to do this without nesting
>> \directlua{tex.sprint("\directlua{...}")}.
>
> Not possible yet (but it is on the todo list).
>
> Best wishes,
> Taco

Ok, good to know.

Best wishes,
Reiner

From jorssen.leraincy at free.fr  Thu Jun  2 12:25:00 2011
From: jorssen.leraincy at free.fr (Christophe Jorssen)
Date: Thu, 2 Jun 2011 12:25:00 +0200
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <4DE75653.5060904@free.fr>
References: <4DE65438.9080108@gmail.com> <4DE749BD.70708@elvenkind.com>
 <4DE75653.5060904@free.fr>
Message-ID: <BANLkTimXKCnkOqYrYU5Rbcofxj1PwrC7tA@mail.gmail.com>

2011/6/2 Paul Isambert <zappathustra at free.fr>:

> I wanted to try some hack with token.create/token.expand, but I found that:
>
> \def\A{1}
> \directlua{
> ?local A = token.create("A")
> ?token.expand(A)
> }
>
> produces an "Undefined control sequence" error. Which is all the more
> surprising as if the token is fed to TeX in the token_filter callback, as in
> the stupid example below, the control sequence is fine:
>
> \def\A{1}
> \directlua{
> callback.register("token_filter",
> ?function ()
> ? ?callback.register("token_filter", nil)
> ? ?return token.create("A")
> ?end)
> }
>
> Have I misunderstood something or should I pay a visit to the bug tracker?

I did exactly the same thing (well, the first part, I don't understand
the second with the callback yet...) and got the same error but I felt
ashamed of posting it here thinking I may have missed something
trivial. So thank you Paul :-)

By the way, I would highly appreciate some basic usage examples ot the
token_filter callback and the token library.

TIA

Best regards

-- 
Christophe


From zappathustra at free.fr  Thu Jun  2 13:01:28 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 02 Jun 2011 13:01:28 +0200
Subject: [luatex] Opentype init/medi/fina.
Message-ID: <4DE76D88.4090406@free.fr>

Hello all,

  The init, medi and fina tags in OT fonts set variants of glyphs 
according to position (used by arabic fonts or scripts). Now you'd think 
it's a contextual substitution.

However, Microsoft 
(http://www.microsoft.com/typography/otspec/features_fj.htm#init) says 
those features should be implemented as single substitutions (GSYB 
lookup type 1), and that "the application is responsible for noting word 
boundaries".

Now, in my (ideal) view of opentype, tags are just pointers to lookups, 
and only lookup types decide how things are implemented, so that you can 
ignore the tag once you have the lookup. But this is not the case here: 
the tag modifies how the lookup should be implemented (so that a simple 
substitution should be implemented as a contextual one).

So: have I misunderstood something? Or: should I correct my view of tags 
and lookups (so that tags can't be ignored)? And in the latter case, any 
idea why init/medi/fina weren't implemented as contextual subtitutions 
in the first place (as are e.g. word-final variants in Minion)?

Best,
Paul

From arthur.reutenauer at normalesup.org  Thu Jun  2 13:06:52 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 2 Jun 2011 12:06:52 +0100
Subject: [luatex] Opentype init/medi/fina.
In-Reply-To: <4DE76D88.4090406@free.fr>
References: <4DE76D88.4090406@free.fr>
Message-ID: <20110602110652.GC1436@phare.normalesup.org>

>  The init, medi and fina tags in OT fonts set variants of glyphs
> according to position (used by arabic fonts or scripts). Now you'd
> think it's a contextual substitution.

  No, it's really not.  The layout engine is responsible for contextual
analysis, and has to decide what feature to apply, if any.

	Arthur

From taco at elvenkind.com  Thu Jun  2 13:16:48 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 02 Jun 2011 13:16:48 +0200
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <4DE75653.5060904@free.fr>
References: <4DE65438.9080108@gmail.com> <4DE749BD.70708@elvenkind.com>
 <4DE75653.5060904@free.fr>
Message-ID: <4DE77120.50109@elvenkind.com>

On 06/02/2011 11:22 AM, Paul Isambert wrote:
> }
>
> Have I misunderstood something or should I pay a visit to the bug tracker?

token.expand() is broken, I added a tracker item myself.

Best wishes,
Taco

From zappathustra at free.fr  Thu Jun  2 19:42:38 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 02 Jun 2011 19:42:38 +0200
Subject: [luatex] Opentype init/medi/fina.
In-Reply-To: <20110602110652.GC1436@phare.normalesup.org>
References: <4DE76D88.4090406@free.fr>
 <20110602110652.GC1436@phare.normalesup.org>
Message-ID: <4DE7CB8E.7030504@free.fr>

Le 02/06/2011 13:06, Arthur Reutenauer a ?crit :
>>   The init, medi and fina tags in OT fonts set variants of glyphs
>> according to position (used by arabic fonts or scripts). Now you'd
>> think it's a contextual substitution.
>    No, it's really not.  The layout engine is responsible for contextual
> analysis, and has to decide what feature to apply, if any.

So that such an analysis must be done depends only on the tags 
themselves? I.e. you have to know that even though init and e.g. smcp 
point to similar lookups (simple substitution), they shouldn't be 
treated similarly: in the case of smcp, the lookup suffices, while in 
the case of init it doesn't. It is surprising that nothing in the font 
signals such a difference... but now I discover Microsoft says so 
clearly (http://www.microsoft.com/typography/otspec/featuretags.htm), 
mentioning precisely the init tag!

Best,
Paul

From zappathustra at free.fr  Thu Jun  2 19:49:15 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 02 Jun 2011 19:49:15 +0200
Subject: [luatex] Getting macro expansions from Lua
In-Reply-To: <BANLkTimXKCnkOqYrYU5Rbcofxj1PwrC7tA@mail.gmail.com>
References: <4DE65438.9080108@gmail.com> <4DE749BD.70708@elvenkind.com>
 <4DE75653.5060904@free.fr>
 <BANLkTimXKCnkOqYrYU5Rbcofxj1PwrC7tA@mail.gmail.com>
Message-ID: <4DE7CD1B.10404@free.fr>

Le 02/06/2011 12:25, Christophe Jorssen a ?crit :
> 2011/6/2 Paul Isambert<zappathustra at free.fr>:
>
>> I wanted to try some hack with token.create/token.expand, but I found that:
>>
>> \def\A{1}
>> \directlua{
>>   local A = token.create("A")
>>   token.expand(A)
>> }
>>
>> produces an "Undefined control sequence" error. Which is all the more
>> surprising as if the token is fed to TeX in the token_filter callback, as in
>> the stupid example below, the control sequence is fine:
>>
>> \def\A{1}
>> \directlua{
>> callback.register("token_filter",
>>   function ()
>>     callback.register("token_filter", nil)
>>     return token.create("A")
>>   end)
>> }
>>
>> Have I misunderstood something or should I pay a visit to the bug tracker?
> I did exactly the same thing (well, the first part, I don't understand
> the second with the callback yet...) and got the same error but I felt
> ashamed of posting it here thinking I may have missed something
> trivial. So thank you Paul :-)

You're welcome. But nobody should refrain from posting here, even simple 
questions (which aren't necessarily so trivial as they seem) can be 
answered.

> By the way, I would highly appreciate some basic usage examples ot the
> token_filter callback and the token library.

If you're a TUG member, you can have a look at my paper in the last 
TUGboat: https://www.tug.org/members/TUGboat/tb32-1/tb100isambert.pdf. 
Note that the example of use is pretty stupid, you can do things much 
more easily with tex.print (something I realized only later in a post by 
Ulrike on this list).

Anyway, I'll try to write something in the wiki, although I don't have 
any convincing example of use (I haven't investigated the matter much).

Best,
Paul

From arthur.reutenauer at normalesup.org  Thu Jun  2 20:26:31 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 2 Jun 2011 19:26:31 +0100
Subject: [luatex] Opentype init/medi/fina.
In-Reply-To: <4DE7CB8E.7030504@free.fr>
References: <4DE76D88.4090406@free.fr>
 <20110602110652.GC1436@phare.normalesup.org> <4DE7CB8E.7030504@free.fr>
Message-ID: <024186D0-EE76-4529-9FD5-B1B0491F0A00@normalesup.org>

> So that such an analysis must be done depends only on the tags themselves?

  Yes, there is a semantic value to the feature tags, as opposed to the lookups that implement them (otherwise there would be little point in having two different levels).  This is why there can be "typographic" and "linguistic" features (smcp would be of the former type, init of the latter).

> I.e. you have to know that even though init and e.g. smcp point to similar lookups (simple substitution), they shouldn't be treated similarly: in the case of smcp, the lookup suffices, while in the case of init it doesn't. It is surprising that nothing in the font signals such a difference...

  The features an OpenType font contains are only half the story.  The complete implementation of an OpenType-compliant system needs to take into account the specification of the layout engine (that commands to apply some features in a specific order, to do contextual analysis, etc.).  There is indeed an implementation choice here, but it has been made at the very beginning of OpenType.  In my opinion, it provides for a more balanced workload between the font designer and the implementer of the typesetting system.

    Arthur

From zappathustra at free.fr  Fri Jun  3 09:04:47 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 03 Jun 2011 09:04:47 +0200
Subject: [luatex] Opentype init/medi/fina.
In-Reply-To: <024186D0-EE76-4529-9FD5-B1B0491F0A00@normalesup.org>
References: <4DE76D88.4090406@free.fr>
 <20110602110652.GC1436@phare.normalesup.org> <4DE7CB8E.7030504@free.fr>
 <024186D0-EE76-4529-9FD5-B1B0491F0A00@normalesup.org>
Message-ID: <4DE8878F.3000401@free.fr>

Le 02/06/2011 20:26, Arthur Reutenauer a ?crit :
>> So that such an analysis must be done depends only on the tags themselves?
>    Yes, there is a semantic value to the feature tags, as opposed to the lookups that implement them (otherwise there would be little point in having two different levels).

The two levels made sense to me as a handle or button (the tag) and a 
machine (the lookup). Actually, I was wondering why there were two 
levels since they did the same job (i.e. tell you what should be done to 
implement a feature).

>    This is why there can be "typographic" and "linguistic" features (smcp would be of the former type, init of the latter).
>
>> I.e. you have to know that even though init and e.g. smcp point to similar lookups (simple substitution), they shouldn't be treated similarly: in the case of smcp, the lookup suffices, while in the case of init it doesn't. It is surprising that nothing in the font signals such a difference...
>    The features an OpenType font contains are only half the story.  The complete implementation of an OpenType-compliant system needs to take into account the specification of the layout engine (that commands to apply some features in a specific order, to do contextual analysis, etc.).  There is indeed an implementation choice here, but it has been made at the very beginning of OpenType.  In my opinion, it provides for a more balanced workload between the font designer and the implementer of the typesetting system.

Thank you very much for the explanation.
What confused me, I think, was that I thought tags could be made up at 
will by font designers, unlike lookup types, and so applications 
couldn't be expected to ``understand'' them, so to speak. Now I've 
checked that they must be registered beforehand, so they aren't so 
unruly after all, and it makes more sense to assign a meaning to them.

Best,
Paul

From igor.kotelnikov at gmail.com  Sat Jun 11 02:49:26 2011
From: igor.kotelnikov at gmail.com (Igor Kotelnikov)
Date: Sat, 11 Jun 2011 07:49:26 +0700
Subject: [luatex] bug: double quotes are not printed
Message-ID: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>

Dear sir/madam,

I noted that double qoutes are not printed if they are typed in source file
by double quotes  but not ligatures. This problems appears only if the sorce
file is compiled with lualatex. Here is minimal test file:

% =================================
\documentclass{article}
\usepackage{fontspec}
\begin{document}
1. <<ligatures>> are printed
2. ?double quotes? are not printed
\end{document}
% =================================

See also attached files.

-------------------------------------------
Igor A. Kotelnikov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110611/1a9ea593/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-ligatures.log
Type: application/octet-stream
Size: 27322 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110611/1a9ea593/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-ligatures.pdf
Type: application/pdf
Size: 5245 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110611/1a9ea593/attachment-0001.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-ligatures.tex
Type: application/x-tex
Size: 352 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110611/1a9ea593/attachment-0001.tex>

From mojca.miklavec.lists at gmail.com  Sat Jun 11 11:56:56 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 11 Jun 2011 11:56:56 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
Message-ID: <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>

On Sat, Jun 11, 2011 at 02:49, Igor Kotelnikov wrote:
> Dear sir/madam,
> I noted that double qoutes are not printed if they are typed in source file
> by double quotes ?but not ligatures

... if you use ISO Latin 1 encoding instead of UTF-8 (which is the
expected behaviour).

Set up your editor to use UTF-8 and it will work fine.

Mojca


From luatex at nililand.de  Sat Jun 11 12:13:02 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 11 Jun 2011 12:13:02 +0200
Subject: [luatex] bug: double quotes are not printed
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
Message-ID: <c19o14is1gco.dlg@nililand.de>

Am Sat, 11 Jun 2011 07:49:26 +0700 schrieb Igor Kotelnikov:

> Dear sir/madam,
> 
> I noted that double qoutes are not printed if they are typed in source file
> by double quotes  but not ligatures. This problems appears only if the sorce
> file is compiled with lualatex. Here is minimal test file:
> 
> % =================================
> \documentclass{article}
> \usepackage{fontspec}
> \begin{document}
> 1. <<ligatures>> are printed
> 2. ?double quotes? are not printed
> \end{document}
> % =================================
> 
> See also attached files.

And your log file shows two error messages:

! String contains an invalid utf-8 sequence.
l.15 2. 
        ?double quotes? are not printed
? 
! String contains an invalid utf-8 sequence.
l.15 2. ?double quotes


You can try luainputenc if you want to use 8bit encoded files, but
it is better to save everything in utf8 if you want to use luatex.

-- 
Ulrike Fischer 


From st_philipp at yahoo.de  Sat Jun 11 15:55:43 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Sat, 11 Jun 2011 15:55:43 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
Message-ID: <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>


Am 11.06.2011 um 11:56 schrieb Mojca Miklavec:

> On Sat, Jun 11, 2011 at 02:49, Igor Kotelnikov wrote:
>> Dear sir/madam,
>> I noted that double qoutes are not printed if they are typed in source file
>> by double quotes  but not ligatures
> 
> ... if you use ISO Latin 1 encoding instead of UTF-8 (which is the
> expected behaviour).
> 
> Set up your editor to use UTF-8 and it will work fine.

shouldn't LuaTeX issue an error about an invalid code unit sequence in such cases?

From mojca.miklavec.lists at gmail.com  Sat Jun 11 16:01:04 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 11 Jun 2011 16:01:04 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
Message-ID: <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>

On Sat, Jun 11, 2011 at 15:55, Philipp Stephani wrote:
> Am 11.06.2011 um 11:56 schrieb Mojca Miklavec:
>
>> On Sat, Jun 11, 2011 at 02:49, Igor Kotelnikov wrote:
>>> Dear sir/madam,
>>> I noted that double qoutes are not printed if they are typed in source file
>>> by double quotes ?but not ligatures
>>
>> ... if you use ISO Latin 1 encoding instead of UTF-8 (which is the
>> expected behaviour).
>>
>> Set up your editor to use UTF-8 and it will work fine.
>
> shouldn't LuaTeX issue an error about an invalid code unit sequence in such cases?

As Ulrike pointed out, my LuaTeX does break with

! String contains an invalid utf-8 sequence.
l.15 2.
       ?double quotes? are not printed

and it seems that Igor's broke as well. But for some reason MikTeX
generated the final document (possibly after hitting enter for a
couple of times or if editor passes some argument).

Mojca


From luatex at nililand.de  Sat Jun 11 17:14:36 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 11 Jun 2011 17:14:36 +0200
Subject: [luatex] bug: double quotes are not printed
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
Message-ID: <kcip4b41tcjh.dlg@nililand.de>

Am Sat, 11 Jun 2011 16:01:04 +0200 schrieb Mojca Miklavec:

>> shouldn't LuaTeX issue an error about an invalid code unit sequence in such cases?
> 
> As Ulrike pointed out, my LuaTeX does break with
> 
> ! String contains an invalid utf-8 sequence.
> l.15 2.
>        ?double quotes? are not printed
> 
> and it seems that Igor's broke as well. But for some reason MikTeX
> generated the final document (possibly after hitting enter for a
> couple of times or if editor passes some argument).

Editors set often \scrollmode or --scrollmode as default
(texniccenter certainly, emacs as far as I know too). At my opinion
this is pity. It makes compilation easier when the errors are
temporary (e.g. due to outdated aux-files) but it leads also quite a
lot people to ignore errors as long as a pdf is generated.

-- 
Ulrike Fischer 


From reinhard.kotucha at web.de  Sun Jun 12 03:01:33 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 12 Jun 2011 03:01:33 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <kcip4b41tcjh.dlg@nililand.de>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de>
Message-ID: <19956.4077.57796.473839@zaphod.ms25.net>

On 2011-06-11 at 17:14:36 +0200, Ulrike Fischer wrote:

 > Editors set often \scrollmode or --scrollmode as default
 > (texniccenter certainly, emacs as far as I know too). At my opinion
 > this is pity. It makes compilation easier when the errors are
 > temporary (e.g. due to outdated aux-files) but it leads also quite
 > a lot people to ignore errors as long as a pdf is generated.

Yes, but Emacs (actually AucTeX) reads the log file for you.  If an
error occurs, you can jump to the place where it's detected and you
get a detailed error message.  Emacs even provides more comprehensible
error messages than LaTeX itself.

I never used TeXnicCenter myself but I've seen many people using it.
Sorry, but I have the impression that they are using it *because* they
don't want to see error messages.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Sun Jun 12 08:26:29 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 12 Jun 2011 08:26:29 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <19956.4077.57796.473839@zaphod.ms25.net>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de> <19956.4077.57796.473839@zaphod.ms25.net>
Message-ID: <4DF45C15.2030605@free.fr>

Le 12/06/2011 03:01, Reinhard Kotucha a ?crit :
> On 2011-06-11 at 17:14:36 +0200, Ulrike Fischer wrote:
>
>   >  Editors set often \scrollmode or --scrollmode as default
>   >  (texniccenter certainly, emacs as far as I know too). At my opinion
>   >  this is pity. It makes compilation easier when the errors are
>   >  temporary (e.g. due to outdated aux-files) but it leads also quite
>   >  a lot people to ignore errors as long as a pdf is generated.
>
> Yes, but Emacs (actually AucTeX) reads the log file for you.  If an
> error occurs, you can jump to the place where it's detected and you
> get a detailed error message.  Emacs even provides more comprehensible
> error messages than LaTeX itself.
>
> I never used TeXnicCenter myself but I've seen many people using it.
> Sorry, but I have the impression that they are using it *because* they
> don't want to see error messages.

It's quite hard not to see them, they scroll at the bottom of the editor 
with colorful flags, and you can jump from error to warning to overfull 
box. As far as I'm concerned, it's actually the one thing that I really 
missed when I switched to Vim (then I got used to the command line).

Best,
Paul

From mpg at elzevir.fr  Sun Jun 12 10:24:43 2011
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 12 Jun 2011 10:24:43 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <4DF45C15.2030605@free.fr>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de> <19956.4077.57796.473839@zaphod.ms25.net>
 <4DF45C15.2030605@free.fr>
Message-ID: <4DF477CB.4080103@elzevir.fr>

Le 12/06/2011 08:26, Paul Isambert a ?crit :
> Le 12/06/2011 03:01, Reinhard Kotucha a ?crit :
>> I never used TeXnicCenter myself but I've seen many people using it.
>> Sorry, but I have the impression that they are using it *because* they
>> don't want to see error messages.
> 
> It's quite hard not to see them, they scroll at the bottom of the editor 
> with colorful flags, and you can jump from error to warning to overfull 
> box. As far as I'm concerned, it's actually the one thing that I really 
> missed when I switched to Vim (then I got used to the command line).
> 
TeXnicCenter was my first editor and I really appreciated the error navigation
you mention. However, I concur with Ulrike and Reinhard: I know too many users
of similar editors who don't care about errors as long as they get a PDF. Now,
I'm not sure if it is the editor's job to forcefully educate those people...

Manuel.

From st_philipp at yahoo.de  Sun Jun 12 11:33:04 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Sun, 12 Jun 2011 11:33:04 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <4DF477CB.4080103@elzevir.fr>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de> <19956.4077.57796.473839@zaphod.ms25.net>
 <4DF45C15.2030605@free.fr> <4DF477CB.4080103@elzevir.fr>
Message-ID: <F0AA2290-FCC5-483D-9137-DD535A2EFE5A@yahoo.de>


Am 12.06.2011 um 10:24 schrieb Manuel P?gouri?-Gonnard:

> Le 12/06/2011 08:26, Paul Isambert a ?crit :
>> Le 12/06/2011 03:01, Reinhard Kotucha a ?crit :
>>> I never used TeXnicCenter myself but I've seen many people using it.
>>> Sorry, but I have the impression that they are using it *because* they
>>> don't want to see error messages.
>> 
>> It's quite hard not to see them, they scroll at the bottom of the editor 
>> with colorful flags, and you can jump from error to warning to overfull 
>> box. As far as I'm concerned, it's actually the one thing that I really 
>> missed when I switched to Vim (then I got used to the command line).
>> 
> TeXnicCenter was my first editor and I really appreciated the error navigation
> you mention. However, I concur with Ulrike and Reinhard: I know too many users
> of similar editors who don't care about errors as long as they get a PDF. Now,
> I'm not sure if it is the editor's job to forcefully educate those people...

It is more the compiler's job: it should refuse to produce a PDF if an error is encountered.

From zappathustra at free.fr  Sun Jun 12 11:50:56 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 12 Jun 2011 11:50:56 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <F0AA2290-FCC5-483D-9137-DD535A2EFE5A@yahoo.de>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de> <19956.4077.57796.473839@zaphod.ms25.net>
 <4DF45C15.2030605@free.fr> <4DF477CB.4080103@elzevir.fr>
 <F0AA2290-FCC5-483D-9137-DD535A2EFE5A@yahoo.de>
Message-ID: <4DF48C00.2070105@free.fr>

Le 12/06/2011 11:33, Philipp Stephani a ?crit :
> Am 12.06.2011 um 10:24 schrieb Manuel P?gouri?-Gonnard:
>
>> Le 12/06/2011 08:26, Paul Isambert a ?crit :
>>> Le 12/06/2011 03:01, Reinhard Kotucha a ?crit :
>>>> I never used TeXnicCenter myself but I've seen many people using it.
>>>> Sorry, but I have the impression that they are using it *because* they
>>>> don't want to see error messages.
>>> It's quite hard not to see them, they scroll at the bottom of the editor
>>> with colorful flags, and you can jump from error to warning to overfull
>>> box. As far as I'm concerned, it's actually the one thing that I really
>>> missed when I switched to Vim (then I got used to the command line).
>>>
>> TeXnicCenter was my first editor and I really appreciated the error navigation
>> you mention. However, I concur with Ulrike and Reinhard: I know too many users
>> of similar editors who don't care about errors as long as they get a PDF. Now,
>> I'm not sure if it is the editor's job to forcefully educate those people...
> It is more the compiler's job: it should refuse to produce a PDF if an error is encountered.

Not exactly the kind of behavior I'd like. Anyway you can enforce it 
with the "--halt-on-error" switch (at least in LuaTeX).

Best,
Paul

From reinhard.kotucha at web.de  Sun Jun 12 12:52:28 2011
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 12 Jun 2011 12:52:28 +0200
Subject: [luatex] bug: double quotes are not printed
In-Reply-To: <4DF45C15.2030605@free.fr>
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de>
 <19956.4077.57796.473839@zaphod.ms25.net>
 <4DF45C15.2030605@free.fr>
Message-ID: <19956.39532.134391.20744@zaphod.ms25.net>

On 2011-06-12 at 08:26:29 +0200, Paul Isambert wrote:

 > Le 12/06/2011 03:01, Reinhard Kotucha a ?crit :
 > > On 2011-06-11 at 17:14:36 +0200, Ulrike Fischer wrote:
 > >
 > >   >  Editors set often \scrollmode or --scrollmode as default
 > >   >  (texniccenter certainly, emacs as far as I know too). At my
 > >   >  opinion this is pity. It makes compilation easier when the
 > >   >  errors are temporary (e.g. due to outdated aux-files) but it
 > >   >  leads also quite a lot people to ignore errors as long as a
 > >   >  pdf is generated.
 > >
 > > Yes, but Emacs (actually AucTeX) reads the log file for you.  If
 > > an error occurs, you can jump to the place where it's detected
 > > and you get a detailed error message.  Emacs even provides more
 > > comprehensible error messages than LaTeX itself.
 > >
 > > I never used TeXnicCenter myself but I've seen many people using
 > > it.  Sorry, but I have the impression that they are using it
 > > *because* they don't want to see error messages.
 > 
 > It's quite hard not to see them, they scroll at the bottom of the
 > editor with colorful flags, and you can jump from error to warning
 > to overfull box. As far as I'm concerned, it's actually the one
 > thing that I really missed when I switched to Vim (then I got used
 > to the command line).

They usually decrease the size of this window so that they never see
the whole error message.  They are only interested in the colorful
icons.  Maybe it has a little bit to do with the fact that if you
enlarge this window you have decrease the editor window.  IMO it's
much better solved in TeXworks.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From luatex at nililand.de  Sun Jun 12 13:24:22 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Sun, 12 Jun 2011 13:24:22 +0200
Subject: [luatex] bug: double quotes are not printed
References: <BANLkTimhtfV-jHDT11fMwOf2LPSxjGnkSg@mail.gmail.com>
 <BANLkTi=_3BSCLb2h+-BOY-43Ot6rN3_dww@mail.gmail.com>
 <BF655DDF-68A0-4840-86A4-C8ECBAB3489B@yahoo.de>
 <BANLkTikeoMR8EA1rV3nb_nPuQOXAhDD5Pg@mail.gmail.com>
 <kcip4b41tcjh.dlg@nililand.de> <19956.4077.57796.473839@zaphod.ms25.net>
Message-ID: <2c4qsnv351cp.dlg@nililand.de>

Am Sun, 12 Jun 2011 03:01:33 +0200 schrieb Reinhard Kotucha:

>  > Editors set often \scrollmode or --scrollmode as default
>  > (texniccenter certainly, emacs as far as I know too). At my opinion
>  > this is pity. It makes compilation easier when the errors are
>  > temporary (e.g. due to outdated aux-files) but it leads also quite
>  > a lot people to ignore errors as long as a pdf is generated.
> 
> Yes, but Emacs (actually AucTeX) reads the log file for you.  If an
> error occurs, you can jump to the place where it's detected and you
> get a detailed error message.  Emacs even provides more comprehensible
> error messages than LaTeX itself.
> 
> I never used TeXnicCenter myself but I've seen many people using it.
> Sorry, but I have the impression that they are using it *because* they
> don't want to see error messages.

I have never used TeXnicCenter either but as far as I know it flags
the number of errors at the bottom and has like winedt and emacs
some means to jump through all the errors.

But I didn't critzise this error-jumping but scrollmode. For you and
me it is simply a matter of taste and personal working habits. But
for beginners it imho psychological wrong. As you said: quite a lot
people don't want to see error messages - and if the editor allows
them to ignore them they will happily do it. I see quite often
variants of "until know I got my pdf so why should I have looked at
the list of errors?". 

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Sun Jun 19 21:44:24 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 19 Jun 2011 21:44:24 +0200
Subject: [luatex] node.isert_before() bug?
Message-ID: <20110619194424.GA11136@khaled-laptop>

Hi all,

While trying to do some right-to-left math experimentation (with very
good results so far[1]) I tried writing some lua code that takes care of
keeping numbers left-to-right by inserting TLT dir nodes around them.

I just found that when node.insert_before() is executed on the very
first node in an hlist no nodes get inserted, I'm not sure if this is a
bug, feature or some dumb thing in the code I wrote. Tested with luatex
0.70.1 and 0.67.0.

See the attached files.

[1] http://tex.stackexchange.com/questions/20666/typesetting-right-to-left-math/21082#21082

BTW, I noticed that \textdir and \mathdir has no effect inside math
formulas, is there any other way to override the global math direction
(apart from fiddling with lua.)

Regards,
 Khaled


-- 
 Khaled Hosny
 Egyptian
 Arab
-------------- next part --------------
A non-text attachment was scrubbed...
Name: m.tex
Type: text/x-tex
Size: 167 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110619/dd5f1421/attachment.bin>
-------------- next part --------------
rtlmath = {}

local glyph     = node.id("glyph")
local hlist     = node.id("hlist")
local vlist     = node.id("vlist")

local function isnumber(n)
    local c = n.char
    if c <= 0x39 and c >= 0x30 then
        return true
    else
        return false
    end
end

local function newdir(dir)
    local n = node.new("whatsit","dir")
    n.dir = dir
    return n
end

local function donumbers(head)
    local start = false
    for n in node.traverse(head) do
        if n.id == glyph then
            if isnumber(n) then
                if start then
                    if n.next and n.next.id == glyph and isnumber(n.next) then
                    else
                        node.insert_after(head, n, newdir("-TLT"))
                        start = false
                    end
                else
                    if n.next and n.next.id == glyph and isnumber(n.next) then
                        node.insert_before(head, n, newdir("+TLT"))
                        start = true
                    else
                    end
                end
            end
        else
            if start then
                node.insert_after(head, n, newdir("-TLT"))
                start = false
            end
            if n.id == hlist or n.id == vlist then
                donumbers(n.list)
            end
        end
    end
    return head
end

rtlmath.numbers = donumbers

--nodes.tasks.appendaction("math", "after", "rtlmath.numbers")
callback.register("mlist_to_hlist",
    function(h, s, b)
        h = node.mlist_to_hlist(h, s, b)
        h = donumbers(h)
        return h
    end
    )

From taco at elvenkind.com  Sun Jun 19 23:40:44 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 19 Jun 2011 23:40:44 +0200
Subject: [luatex] node.isert_before() bug?
In-Reply-To: <20110619194424.GA11136@khaled-laptop>
References: <20110619194424.GA11136@khaled-laptop>
Message-ID: <68C8107A-4B3E-4F8B-8140-4D7DC56608C9@elvenkind.com>

Hi,

On 19 jun. 2011, at 21:44, Khaled Hosny <khaledhosny at eglug.org> wrote:

> Hi all,
> I just found that when node.insert_before() is executed on the very
> first node in an hlist no nodes get inserted, I'm not sure if this is a
> bug, feature or some dumb thing in the code I wrote. Tested with luatex
> 0.70.1 and 0.67.0.
 
I write this 'blind' now, but iirc node.insert_before() has  a return value. But if not, remeber that variables do not auto-update themselves in side-effects in lua, so if you need to alter a list head, you will need to do something like 

  head = newdir_var

somewhere.
> 


Hope this makes sense,

Taco

From zappathustra at free.fr  Mon Jun 20 07:45:52 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 20 Jun 2011 07:45:52 +0200
Subject: [luatex] node.isert_before() bug?
In-Reply-To: <68C8107A-4B3E-4F8B-8140-4D7DC56608C9@elvenkind.com>
References: <20110619194424.GA11136@khaled-laptop>
 <68C8107A-4B3E-4F8B-8140-4D7DC56608C9@elvenkind.com>
Message-ID: <4DFEDE90.1040807@free.fr>

Le 19/06/2011 23:40, Taco Hoekwater a ?crit :
> Hi,
>
> On 19 jun. 2011, at 21:44, Khaled Hosny<khaledhosny at eglug.org>  wrote:
>
>> Hi all,
>> I just found that when node.insert_before() is executed on the very
>> first node in an hlist no nodes get inserted, I'm not sure if this is a
>> bug, feature or some dumb thing in the code I wrote. Tested with luatex
>> 0.70.1 and 0.67.0.
>
> I write this 'blind' now, but iirc node.insert_before() has  a return value. But if not, remeber that variables do not auto-update themselves in side-effects in lua, so if you need to alter a list head, you will need to do something like
>
>    head = newdir_var
>
> somewhere.

To say it otherwise, the new node is correctly inserted before the head 
(i.e. prev and next pointers are right), but the container (the box) 
still points to the original head; hence the new node is in the list but 
before its starting point, and thus ignored. Thus node.insert_before() 
should be used as:

head = node.insert_before(head, head, n)

if the head is returned somewhere, or even more explicitely otherwise, e.g:

tex.box[0].head = node.insert_before(tex.box[0].head, tex.box[0].head, n)

Best,
Paul

From khaledhosny at eglug.org  Mon Jun 20 08:38:34 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 20 Jun 2011 08:38:34 +0200
Subject: [luatex] node.isert_before() bug?
In-Reply-To: <4DFEDE90.1040807@free.fr>
References: <20110619194424.GA11136@khaled-laptop>
 <68C8107A-4B3E-4F8B-8140-4D7DC56608C9@elvenkind.com>
 <4DFEDE90.1040807@free.fr>
Message-ID: <20110620063834.GA2179@khaled-laptop>

On Mon, Jun 20, 2011 at 07:45:52AM +0200, Paul Isambert wrote:
> Le 19/06/2011 23:40, Taco Hoekwater a ?crit :
> >Hi,
> >
> >On 19 jun. 2011, at 21:44, Khaled Hosny<khaledhosny at eglug.org>  wrote:
> >
> >>Hi all,
> >>I just found that when node.insert_before() is executed on the very
> >>first node in an hlist no nodes get inserted, I'm not sure if this is a
> >>bug, feature or some dumb thing in the code I wrote. Tested with luatex
> >>0.70.1 and 0.67.0.
> >
> >I write this 'blind' now, but iirc node.insert_before() has  a return value. But if not, remeber that variables do not auto-update themselves in side-effects in lua, so if you need to alter a list head, you will need to do something like
> >
> >   head = newdir_var
> >
> >somewhere.
> 
> To say it otherwise, the new node is correctly inserted before the
> head (i.e. prev and next pointers are right), but the container (the
> box) still points to the original head; hence the new node is in the
> list but before its starting point, and thus ignored. Thus
> node.insert_before() should be used as:
> 
> head = node.insert_before(head, head, n)
> 
> if the head is returned somewhere, or even more explicitely otherwise, e.g:
> 
> tex.box[0].head = node.insert_before(tex.box[0].head, tex.box[0].head, n)

Thanks Taco and Paul, I got it to work now. I already tried:

   head = node.insert_before(head, n, newdir("+TLT"))

but I missed the point of assigning to sublists (the code checks if a
node is an {h,v}list and runs recursively but never assigns the new,
mutated, head to the sublist). Now I can see why I've weired bugs in all
my node manipulation code :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab
-------------- next part --------------
rtlmath = {}

local glyph     = node.id("glyph")
local hlist     = node.id("hlist")
local vlist     = node.id("vlist")

local function isnumber(n)
    local c = n.char
    if c <= 0x39 and c >= 0x30 then
        return true
    else
        return false
    end
end

local function newdir(dir)
    local n = node.new("whatsit","dir")
    n.dir = dir
    return n
end

local function donumbers(head)
    local start = false
    for n in node.traverse(head) do
        if n.id == glyph then
            if isnumber(n) then
                if start then
                    if n.next and n.next.id == glyph and isnumber(n.next) then
                    else
                        head = node.insert_after(head, n, newdir("-TLT"))
                        start = false
                    end
                else
                    if n.next and n.next.id == glyph and isnumber(n.next) then
                        head = node.insert_before(head, n, newdir("+TLT"))
                        start = true
                    else
                    end
                end
            end
        else
            if start then
                head = node.insert_after(head, n, newdir("-TLT"))
                start = false
            end
            if n.id == hlist or n.id == vlist then
                n.list = donumbers(n.list)
            end
        end
    end
    return head
end

rtlmath.numbers = donumbers

nodes.tasks.appendaction("math", "after", "rtlmath.numbers")
--[[
callback.register("mlist_to_hlist",
    function(h, s, b)
        h = node.mlist_to_hlist(h, s, b)
        h = donumbers(h)
        return h
    end
    )
--]]

From luatex at nililand.de  Mon Jun 20 18:21:14 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 20 Jun 2011 18:21:14 +0200
Subject: [luatex] dump a tfm to a file
Message-ID: <1gzoj33qe0oms.dlg@nililand.de>


Do someone know if and how I could dump the "virtual" tfm of a font
like Arial or another system font to a file? I don't want a lua
table or something like this but really a "normal" tfm file (apart
from the fact that it will contain more chars). 

(I'm trying to find out if I can use tex4ht with luatex and need the
tfm for tests).



-- 
Ulrike Fischer 


From patrick at gundla.ch  Mon Jun 20 19:19:58 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 20 Jun 2011 19:19:58 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <1gzoj33qe0oms.dlg@nililand.de>
References: <1gzoj33qe0oms.dlg@nililand.de>
Message-ID: <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>


Am 20.06.2011 um 18:21 schrieb Ulrike Fischer:

> 
> Do someone know if and how I could dump the "virtual" tfm of a font
> like Arial or another system font to a file?

ttf2tfm - build TeX metric files from a TrueType font

> table or something like this but really a "normal" tfm file (apart
> from the fact that it will contain more chars).

I am pretty sure a tfm file can only hold 256 chars. So you need an encoding.

Patrick


From taco at elvenkind.com  Mon Jun 20 19:52:06 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 20 Jun 2011 19:52:06 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
Message-ID: <B7B206B6-3294-4BBE-8837-11405B6AC719@elvenkind.com>

Hi,

On 20 jun. 2011, at 19:19, Patrick Gundlach <patrick at gundla.ch> wrote:

> 
> Am 20.06.2011 um 18:21 schrieb Ulrike Fischer:
> 
>> 
>> Do someone know if and how I could dump the "virtual" tfm of a font
>> like Arial or another system font to a file?
> 
> ttf2tfm - build TeX metric files from a TrueType font

Yes. (or Generate Fonts ... in fontforge, generate a type1 font, and turn 'create tfm' on in the generation options.)

> 
>> table or something like this but really a "normal" tfm file (apart
>> from the fact that it will contain more chars).
> 
> I am pretty sure a tfm file can only hold 256 chars. So you need an encoding.
> 

Yes, 256 is the maximum number of characters in a tfm. If you need other glyphs as well, you need to create multiple tfms. But I think ttf2tfm supports that without too much hassle. After all, ttf2tfm was written specifically to get usable truetype font support in pdftex.

Best wishes,
Taco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110620/cb90e4bb/attachment.html>

From martin at oneiros.de  Tue Jun 21 01:07:17 2011
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 21 Jun 2011 01:07:17 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <B7B206B6-3294-4BBE-8837-11405B6AC719@elvenkind.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <B7B206B6-3294-4BBE-8837-11405B6AC719@elvenkind.com>
Message-ID: <BANLkTinCd4ppn0yhLJg+AFPo_NA+eSEHtA@mail.gmail.com>

2011/6/20 Taco Hoekwater <taco at elvenkind.com>:
> Yes, 256 is the maximum number of characters in a tfm. If you need other
> glyphs as well, you need to create multiple tfms. But I think ttf2tfm
> supports that without too much hassle. After all, ttf2tfm was written
> specifically to get usable truetype font support in pdftex.

One could use ofms etc. But nobody should. :-)

Best
   Martin

From luatex at nililand.de  Tue Jun 21 09:50:49 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 21 Jun 2011 09:50:49 +0200
Subject: [luatex] dump a tfm to a file
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
Message-ID: <m0zjwuq0dn6m$.dlg@nililand.de>

Am Mon, 20 Jun 2011 19:19:58 +0200 schrieb Patrick Gundlach:

> Am 20.06.2011 um 18:21 schrieb Ulrike Fischer:
> 
>> 
>> Do someone know if and how I could dump the "virtual" tfm of a font
>> like Arial or another system font to a file?
 
> ttf2tfm - build TeX metric files from a TrueType font

Hm. I was so concentrated on looking for a luatex solution that I
didn't consider the standard tools. I will check ttf2tfm and otf2tfm
but I fear they will generate only tfm's with the standard maximum
of 256 character.


>> table or something like this but really a "normal" tfm file (apart
>> from the fact that it will contain more chars).
 
> I am pretty sure a tfm file can only hold 256 chars. So you need an encoding.

I know that normal tfm's should contain only 256 chars. But after
all a tfm is more or less only a long list of 
 (CHARACTER <number>
  (CHARWD ...)).

So I don't see a logical reason why one shouldn't be able to
generate a large tfm with the informations of more characters (and
luatex is generating large "virtual tfm" with metrics information).

I want to try out if tex4ht can handle such large, unstandard tfm's
or if it has built-in a hard 256 barrier. 



-- 
Ulrike Fischer 


From taco at elvenkind.com  Tue Jun 21 10:03:14 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 10:03:14 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <m0zjwuq0dn6m$.dlg@nililand.de>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de>
Message-ID: <4E005042.10906@elvenkind.com>

On 06/21/2011 09:50 AM, Ulrike Fischer wrote:
>
> I know that normal tfm's should contain only 256 chars. But after
> all a tfm is more or less only a long list of
>   (CHARACTER<number>
>    (CHARWD ...)).
>
> So I don't see a logical reason why one shouldn't be able to
> generate a large tfm with the informations of more characters (and

It would not be a TFM if it allowed more than 256 glyphs. TFM is
a binary format with fixed sizes for various fields (expressed in bits).
The 'human-readable' PL format is a dump of a TFM file, so that is
derived from TFM, not the other way around.

OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
but still not enough to encode Unicode Math properly. I do not
think there is *any* extension to TFM anywhere that supports the
full Unicode range.

> luatex is generating large "virtual tfm" with metrics information).

It is convenient to think of it that way, but what actually happens
is that luatex fills a C data structure by extracting information
from a lua table. Nowhere in that process is tfm or vf format used
directly.

Best wishes,
Taco

From luigi.scarso at gmail.com  Tue Jun 21 10:10:00 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 21 Jun 2011 10:10:00 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <4E005042.10906@elvenkind.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de> <4E005042.10906@elvenkind.com>
Message-ID: <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>

On Tue, Jun 21, 2011 at 10:03 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> On 06/21/2011 09:50 AM, Ulrike Fischer wrote:
>>
>> I know that normal tfm's should contain only 256 chars. But after
>> all a tfm is more or less only a long list of
>> ?(CHARACTER<number>
>> ? (CHARWD ...)).
>>
>> So I don't see a logical reason why one shouldn't be able to
>> generate a large tfm with the informations of more characters (and
>
> It would not be a TFM if it allowed more than 256 glyphs. TFM is
> a binary format with fixed sizes for various fields (expressed in bits).
> The 'human-readable' PL format is a dump of a TFM file, so that is
> derived from TFM, not the other way around.
>
> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
> but still not enough to encode Unicode Math properly. I do not
> think there is *any* extension to TFM anywhere that supports the
> full Unicode range.
But  OpenType allows only 65536 glyphs, so maybe it's not so serious.

-- 
luigi


From taco at elvenkind.com  Tue Jun 21 10:12:43 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 10:12:43 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de> <4E005042.10906@elvenkind.com>
 <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>
Message-ID: <4E00527B.5000603@elvenkind.com>

On 06/21/2011 10:10 AM, luigi scarso wrote:
>>
>> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
>> but still not enough to encode Unicode Math properly. I do not
>> think there is *any* extension to TFM anywhere that supports the
>> full Unicode range.
> But  OpenType allows only 65536 glyphs, so maybe it's not so serious.

You get the traditional TeX font encoding issue, only shifted 8 bits.

Best wishes,
Taco


From Robin.Fairbairns at cl.cam.ac.uk  Tue Jun 21 10:17:10 2011
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 21 Jun 2011 09:17:10 +0100
Subject: [luatex] dump a tfm to a file
In-Reply-To: Your message of Tue, 21 Jun 2011 10:10:00 +0200.
 <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>
Message-ID: <3180.1308644230@cl.cam.ac.uk>

luigi scarso <luigi.scarso at gmail.com> wrote:

> On Tue, Jun 21, 2011 at 10:03 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> > OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
> > but still not enough to encode Unicode Math properly. I do not
> > think there is *any* extension to TFM anywhere that supports the
> > full Unicode range.
>
> But  OpenType allows only 65536 glyphs, so maybe it's not so serious.

ofm, surely, allows glyphs 0..65535, whereas otf allows its 64k to be
anywhere in the unicode space.

aiui, anyway (it's a long time since i reviewed omega -- specifically,
since the weird "development briefing" at tug 2000).

r

From luigi.scarso at gmail.com  Tue Jun 21 10:17:28 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 21 Jun 2011 10:17:28 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <4E00527B.5000603@elvenkind.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de> <4E005042.10906@elvenkind.com>
 <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>
 <4E00527B.5000603@elvenkind.com>
Message-ID: <BANLkTi=JWZ+HR9NdNMgK0ZQRNwYSURpPQg@mail.gmail.com>

On Tue, Jun 21, 2011 at 10:12 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> On 06/21/2011 10:10 AM, luigi scarso wrote:
>>>
>>> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
>>> but still not enough to encode Unicode Math properly. I do not
>>> think there is *any* extension to TFM anywhere that supports the
>>> full Unicode range.
>>
>> But ?OpenType allows only 65536 glyphs, so maybe it's not so serious.
>
> You get the traditional TeX font encoding issue, only shifted 8 bits.
right, but this time it's an OpenType limitation
Perhaps one can design an UFM (Unicode extension to TFM) with 32 bit,
but still have to fight against the OpenType limitation.

-- 
luigi


From taco at elvenkind.com  Tue Jun 21 10:20:31 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 10:20:31 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTi=JWZ+HR9NdNMgK0ZQRNwYSURpPQg@mail.gmail.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de> <4E005042.10906@elvenkind.com>
 <BANLkTin2Pn30MYxiew9BtO4LppA_Pxf=vQ@mail.gmail.com>
 <4E00527B.5000603@elvenkind.com>
 <BANLkTi=JWZ+HR9NdNMgK0ZQRNwYSURpPQg@mail.gmail.com>
Message-ID: <4E00544F.60002@elvenkind.com>

On 06/21/2011 10:17 AM, luigi scarso wrote:
> On Tue, Jun 21, 2011 at 10:12 AM, Taco Hoekwater<taco at elvenkind.com>  wrote:
>> On 06/21/2011 10:10 AM, luigi scarso wrote:
>>>>
>>>> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
>>>> but still not enough to encode Unicode Math properly. I do not
>>>> think there is *any* extension to TFM anywhere that supports the
>>>> full Unicode range.
>>>
>>> But  OpenType allows only 65536 glyphs, so maybe it's not so serious.
>>
>> You get the traditional TeX font encoding issue, only shifted 8 bits.
> right, but this time it's an OpenType limitation
> Perhaps one can design an UFM (Unicode extension to TFM) with 32 bit,
> but still have to fight against the OpenType limitation.

I fail to see the usefulness of such an extension.




From Robin.Fairbairns at cl.cam.ac.uk  Tue Jun 21 10:25:16 2011
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 21 Jun 2011 09:25:16 +0100
Subject: [luatex] dump a tfm to a file
In-Reply-To: Your message of Tue, 21 Jun 2011 10:20:31 +0200.
 <4E00544F.60002@elvenkind.com>
Message-ID: <4237.1308644716@cl.cam.ac.uk>

Taco Hoekwater <taco at elvenkind.com> wrote:

> On 06/21/2011 10:17 AM, luigi scarso wrote:
> > On Tue, Jun 21, 2011 at 10:12 AM, Taco Hoekwater<taco at elvenkind.com>  wrote:
> >> On 06/21/2011 10:10 AM, luigi scarso wrote:
> >>>>
> >>>> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
> >>>> but still not enough to encode Unicode Math properly. I do not
> >>>> think there is *any* extension to TFM anywhere that supports the
> >>>> full Unicode range.
> >>>
> >>> But  OpenType allows only 65536 glyphs, so maybe it's not so serious.
> >>
> >> You get the traditional TeX font encoding issue, only shifted 8 bits.
> >
> > right, but this time it's an OpenType limitation
> > Perhaps one can design an UFM (Unicode extension to TFM) with 32 bit,
> > but still have to fight against the OpenType limitation.
> 
> I fail to see the usefulness of such an extension.

solves ulrike's problem by providing an easy route ... but what she
actually _needs_ is a lua script to dump the tables in the format tex4ht
wants.

i assume.

robin

From taco at elvenkind.com  Tue Jun 21 10:28:20 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 10:28:20 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <4237.1308644716@cl.cam.ac.uk>
References: <4237.1308644716@cl.cam.ac.uk>
Message-ID: <4E005624.2000400@elvenkind.com>

On 06/21/2011 10:25 AM, Robin Fairbairns wrote:
>
> solves ulrike's problem by providing an easy route ... but what she
> actually _needs_ is a lua script to dump the tables in the format tex4ht
> wants.

I know nothing about tex4ht except that it exists and is annoyingly hard
to set up right (which is exactly why that is the only thing I know
about it). But if there is a dedicated format that tex4ht understands,
then it should be quite straightforward to create such a file based on
the internal metrics representation, especially if it is a 
human-readable format.

Best wishes,
Taco


From mojca.miklavec.lists at gmail.com  Tue Jun 21 10:28:37 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 21 Jun 2011 10:28:37 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <m0zjwuq0dn6m$.dlg@nililand.de>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de>
Message-ID: <BANLkTi=Jg36XJnTetezi2u8QrvHOnX7ixg@mail.gmail.com>

On Tue, Jun 21, 2011 at 09:50, Ulrike Fischer wrote:
>
> So I don't see a logical reason why one shouldn't be able to
> generate a large tfm with the informations of more characters (and
> luatex is generating large "virtual tfm" with metrics information).
>
> I want to try out if tex4ht can handle such large, unstandard tfm's
> or if it has built-in a hard 256 barrier.

For normal TFM files tex4ht uses more-or-less-manually-generated files
with mappings between TFM slots and Unicode values. It would be
*waaaaay* easier to convince tex4ht to use UTF-8 encoding directly (if
you know how to patch tex4ht). Just having "fat TFM" won't help you at
all.

A few years ago this could have been a trivial request with a
"trivial" and quick solution.

Mojca

From luatex at nililand.de  Tue Jun 21 10:29:57 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 21 Jun 2011 10:29:57 +0200
Subject: [luatex] dump a tfm to a file
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de> <4E005042.10906@elvenkind.com>
Message-ID: <typljip4vgu2.dlg@nililand.de>

Am Tue, 21 Jun 2011 10:03:14 +0200 schrieb Taco Hoekwater:

>> I know that normal tfm's should contain only 256 chars. But after
>> all a tfm is more or less only a long list of
>>   (CHARACTER<number>
>>    (CHARWD ...)).
>>
>> So I don't see a logical reason why one shouldn't be able to
>> generate a large tfm with the informations of more characters (and
> 
> It would not be a TFM if it allowed more than 256 glyphs. TFM is
> a binary format with fixed sizes for various fields (expressed in bits).
> The 'human-readable' PL format is a dump of a TFM file, so that is
> derived from TFM, not the other way around.

OK

> OFM (Omega's extensions to TFM) allows 65536 glyphs which is more,
> but still not enough to encode Unicode Math properly. I do not
> think there is *any* extension to TFM anywhere that supports the
> full Unicode range.

I don't need a full unicode range only a bit more than 256 ;-). Do
you know if somewhere a tool exist which could generate a ofm that
could be used as a represent for a normal, not to large unicode
font?  I have opl2ofm but I really don't want to write such a file
manually. 


-- 
Ulrike Fischer 


From mojca.miklavec.lists at gmail.com  Tue Jun 21 10:33:26 2011
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 21 Jun 2011 10:33:26 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <4E005624.2000400@elvenkind.com>
References: <4237.1308644716@cl.cam.ac.uk>
	<4E005624.2000400@elvenkind.com>
Message-ID: <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>

On Tue, Jun 21, 2011 at 10:28, Taco Hoekwater wrote:
> On 06/21/2011 10:25 AM, Robin Fairbairns wrote:
>>
>> solves ulrike's problem by providing an easy route ... but what she
>> actually _needs_ is a lua script to dump the tables in the format tex4ht
>> wants.
>
> I know nothing about tex4ht except that it exists and is annoyingly hard
> to set up right (which is exactly why that is the only thing I know
> about it). But if there is a dedicated format that tex4ht understands,
> then it should be quite straightforward to create such a file based on
> the internal metrics representation, especially if it is a human-readable
> format.

It is. See:
    /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf

The problem is that I'm not sure if it would work out of the box with
>256 characters (no matter how tiny fix would be required to fix it,
one might need to patch tex4ht, but I didn't test anything).

Mojca


lm-ec 0 255
'&#x0060;' ''     0 % lm-ec.htf 2009-05-06 %
'&#x00B4;' ''     1 % Copyright (C) 2005--2009
Eitan M. Gurari
'&#x02C6;' ''     2 %
                  %
'&#x02DC;' ''     3 % This work may be distributed and/or modified
under the conditions  %
'&#x00A8;' ''     4 % of the LaTeX Project Public License, either
version 1.3 of this    %
'&#x02DD;' ''     5 % license or (at your option) any later version.
The latest version  %
'&#x02DA;' ''     6 % of this license is in
http://www.latex-project.org/lppl.txt and    %
'&#x02C7;' ''     7 % version 1.3 or later is part of all
distributions of LaTeX version %
'&#x02D8;' ''     8 % 2003/12/01 or later.
                  %
'&#x00AF;' ''     9 %  This work has the LPPL maintenance status
"maintained". This      %
'&#x02D9;' ''     10 % Current Maintainer of this work is Eitan M.
Gurari.                %
'&#x00B8;' ''     11 %
                   %
'&#x02DB;' ''     12 % If you modify this file your your adding a note
of                 %
'&#x201A;' ''     13 % your own after this copyright note will be
appreciated.            %
'&#x2039;' ''     14 %
                   %
'&#x203A;' ''     15 %
gurari at cse.ohio-state.edu %
'&#x201C;' ''     16 %
http://www.cse.ohio-state.edu/~gurari %
'&#x201D;' ''     17
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
'&#x201E;' ''     18~
'&#x00AB;' ''     19
'&#x00BB;' ''     20
'&#x2013;' ''     21
'&#x2014;' ''     22
'&#xFEFF;' ''   23
'0' ''     24
'&#x0131;' ''     25
'&#x0237;' ''     26
'&#xFB00;' ''     27
'&#xFB01;' ''     28
'&#xFB02;' ''     29
'&#xFB03;' ''     30
'&#xFB04;' ''     31
'&#x2423;' ''     32
'!' ''     33
'&#x0022;' ''     34
'#' ''  35
'$' ''  36
'%' ''  37
'&#x0026;' ''  38
'&#x2019;' ''     39

From khaledhosny at eglug.org  Tue Jun 21 10:57:35 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 21 Jun 2011 10:57:35 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTi=Jg36XJnTetezi2u8QrvHOnX7ixg@mail.gmail.com>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de>
 <BANLkTi=Jg36XJnTetezi2u8QrvHOnX7ixg@mail.gmail.com>
Message-ID: <20110621085735.GA9703@khaled-laptop>

On Tue, Jun 21, 2011 at 10:28:37AM +0200, Mojca Miklavec wrote:
> On Tue, Jun 21, 2011 at 09:50, Ulrike Fischer wrote:
> >
> > So I don't see a logical reason why one shouldn't be able to
> > generate a large tfm with the informations of more characters (and
> > luatex is generating large "virtual tfm" with metrics information).
> >
> > I want to try out if tex4ht can handle such large, unstandard tfm's
> > or if it has built-in a hard 256 barrier.
> 
> For normal TFM files tex4ht uses more-or-less-manually-generated files
> with mappings between TFM slots and Unicode values. It would be
> *waaaaay* easier to convince tex4ht to use UTF-8 encoding directly (if
> you know how to patch tex4ht). Just having "fat TFM" won't help you at
> all.

Or one can just ditch tex4ht entirely and go with more sane lua based
solution like the amazing x(h)ml export work that Hans is doing (it can
even export xii.tex ;) ).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From taco at elvenkind.com  Tue Jun 21 10:59:11 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 10:59:11 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
References: <4237.1308644716@cl.cam.ac.uk>	<4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
Message-ID: <4E005D5F.40208@elvenkind.com>

On 06/21/2011 10:33 AM, Mojca Miklavec wrote:
>
> It is. See:
>      /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf
>
> The problem is that I'm not sure if it would work out of the box with
>> 256 characters (no matter how tiny fix would be required to fix it,
> one might need to patch tex4ht, but I didn't test anything).

 From the looks of it, these files have the names of encoding vectors,
so I guess some black magic is needed for tex4ht itself, but a single
'unicode' encoding vector would be good enough.

In fact, it seems that tex4ht maps the PUA one-on-one as well, so the
whole thing appears to be just an identity mapping from Unicode code
points to HTML character references. It seems silly to have a dedicated
(large) file for that.

Best wishes,
Taco

From luatex at nililand.de  Tue Jun 21 18:30:19 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 21 Jun 2011 18:30:19 +0200
Subject: [luatex] dump a tfm to a file
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
Message-ID: <15b67h71makxr$.dlg@nililand.de>

Am Tue, 21 Jun 2011 10:33:26 +0200 schrieb Mojca Miklavec:

>> I know nothing about tex4ht except that it exists and is annoyingly hard
>> to set up right (which is exactly why that is the only thing I know
>> about it).

And this from the user of a system which so hard to set up that it
breaks permanently in miktex ;-) 

Actually I don't think that tex4ht is overly complicated, but yes
tex4ht it is not really easy to debug or to get details right or to
expand. 

One central problem is that not much of its "inner working" is
known. Eitan Gurari was always very helpful on c.t.t. If someone
mentioned a bug or a feature request a new beta arrived. But as far
as I know he was the only one who worked with the source and
actually understood what the various pieces do. And while there is
some code documentation it is not helpful as it contains a lot of
personal remarks, e-mail snippets and obviously simply evolved over
time. And this makes it difficult to find a new maintainer, or
someone who can help with problems and insights.

But on the other side texh4t contains a lot of useful code. I was
quite impressed some days ago when I could convert a document
containing a biblatex bibliography without much problems to an open
office document. And the html generation is really quite powerful
and sophisticated. It would be a pity if one would do all the work
again instead of trying first if it can be reused and adapted.


>> But if there is a dedicated format that tex4ht understands,
>> then it should be quite straightforward to create such a file based on
>> the internal metrics representation, especially if it is a human-readable
>> format.
> 
> It is. See:
>     /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf

tex4ht doesn't use only this htf-files. At first it loads the tfm's
of the fonts mentioned in the dvi (I don't know exactly why).


-- 
Ulrike Fischer 


From luatex at nililand.de  Tue Jun 21 18:37:50 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 21 Jun 2011 18:37:50 +0200
Subject: [luatex] dump a tfm to a file
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de>
 <BANLkTi=Jg36XJnTetezi2u8QrvHOnX7ixg@mail.gmail.com>
 <20110621085735.GA9703@khaled-laptop>
Message-ID: <m4n3f9412s4a$.dlg@nililand.de>

Am Tue, 21 Jun 2011 10:57:35 +0200 schrieb Khaled Hosny:


> Or one can just ditch tex4ht entirely and go with more sane lua based
> solution like the amazing x(h)ml export work that Hans is doing (it can
> even export xii.tex ;) ).

tex4ht can export xii.tex too. I tried ;-) And while I would
certainly like to try Hans code: it probably doesn't work for latex,
so it would need someone who 1. understand it and 2. can adapt it.
Both not very easy without some good documentation.

Btw: Do you have time to synch the unstable branch of luaotfload
with the newest context code?

-- 
Ulrike Fischer 


From taco at elvenkind.com  Tue Jun 21 19:42:51 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 21 Jun 2011 19:42:51 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <15b67h71makxr$.dlg@nililand.de>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
Message-ID: <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>





On 21 jun. 2011, at 18:30, Ulrike Fischer <luatex at nililand.de> wrote:

> Am Tue, 21 Jun 2011 10:33:26 +0200 schrieb Mojca Miklavec:
> 
>>> I know nothing about tex4ht except that it exists and is annoyingly hard
>>> to set up right (which is exactly why that is the only thing I know
>>> about it).
> 
> And this from the user of a system which so hard to set up that it
> breaks permanently in miktex ;-) 
> 

Actually, that quote was me talking. I don't think Mojca would claim that anything at all is hard to set up ;)

>> It is. See:
>>    /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf
> 
> tex4ht doesn't use only this htf-files. At first it loads the tfm's
> of the fonts mentioned in the dvi (I don't know exactly why).

If it really needs TFMs, I do not think it can ever be compatible with luatex (or xetex, for that matter).

Best wishes,
Taco
> 


From jlrn77 at gmail.com  Tue Jun 21 21:09:04 2011
From: jlrn77 at gmail.com (Luis Rivera)
Date: Tue, 21 Jun 2011 14:09:04 -0500
Subject: [luatex] dump a tfm to a file
In-Reply-To: <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
Message-ID: <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>

On 21/06/2011, Taco Hoekwater <taco at elvenkind.com> wrote:
>
> On 21 jun. 2011, at 18:30, Ulrike Fischer <luatex at nililand.de> wrote:
>
>>
>> tex4ht doesn't use only this htf-files. At first it loads the tfm's
>> of the fonts mentioned in the dvi (I don't know exactly why).
>
> If it really needs TFMs, I do not think it can ever be compatible with
> luatex (or xetex, for that matter).
>

afaik, tex4ht doesn't load the tfms to generate the dvi: that's
required by some tex engine (pdfTeX, afaik) which generates a dvi with
some tailored suited macros (it makes three passes, to ensure the bbl,
idx and other stuff are properly compiled); then, in the second stage,
tex4ht deciphers the dvi with the htf files to generate some xml
files; and in the third stage, t4ht assembles the final html/odt file
with the xmls, the images, and all the other stuff generated by the
previous steps. I collect that from reading the oolatex script, which
actually controls the whole process.

So, in my not very enlightened opinion, htf files are necessary only
because the tfm files that generate a dvi may have different
encodings, so the resulting dvi files are spaghetti encoded, and there
is some need to ensure that appropriate utf8 sequences are produced
from the messy dvi into the the generated xml files. htf files are
mainly maps from 8 bit encoded fonts into utf8.

If a TeX engine could read and write files properly UTF8 encoded, the
need for htf files would be bypassed; tex4ht would only have to
translate typesetting instructions (from a target successor of dvi
format) into xml tags, since the encoding would be UTF8 right from the
beginning.

-- 
Luis Rivera
O< http://www.asciiribbon.org/ campaign

From khaledhosny at eglug.org  Tue Jun 21 23:05:36 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 21 Jun 2011 23:05:36 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <m4n3f9412s4a$.dlg@nililand.de>
References: <1gzoj33qe0oms.dlg@nililand.de>
 <16D3AEF2-E7B8-41D4-A8A7-9B1DC41AF374@gundla.ch>
 <m0zjwuq0dn6m$.dlg@nililand.de>
 <BANLkTi=Jg36XJnTetezi2u8QrvHOnX7ixg@mail.gmail.com>
 <20110621085735.GA9703@khaled-laptop>
 <m4n3f9412s4a$.dlg@nililand.de>
Message-ID: <20110621210536.GA15999@khaled-laptop>

On Tue, Jun 21, 2011 at 06:37:50PM +0200, Ulrike Fischer wrote:
> Am Tue, 21 Jun 2011 10:57:35 +0200 schrieb Khaled Hosny:
> 
> 
> > Or one can just ditch tex4ht entirely and go with more sane lua based
> > solution like the amazing x(h)ml export work that Hans is doing (it can
> > even export xii.tex ;) ).
> 
> tex4ht can export xii.tex too. I tried ;-) And while I would
> certainly like to try Hans code: it probably doesn't work for latex,
> so it would need someone who 1. understand it and 2. can adapt it.
> Both not very easy without some good documentation.

Hans code is probably deeply tied with ConTeXt, I was only suggesting
that someone would try a similar approach (I don't know much about
tex4ht either, but from where I stand it looks like a big, complex and
fragile hack that is only necessary because TeX can't do better.)

> Btw: Do you have time to synch the unstable branch of luaotfload
> with the newest context code?

I don't think so, Hans did some big changes (to make the code even more
separable) and it might require rewriting luaotfload's glue layer, but I
can't afford time for that (I can only do small and interesting hacks :)
for the time being.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From luatex at nililand.de  Wed Jun 22 10:56:58 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 22 Jun 2011 10:56:58 +0200
Subject: [luatex] dump a tfm to a file
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
Message-ID: <h0k1gi80icam.dlg@nililand.de>

Am Tue, 21 Jun 2011 14:09:04 -0500 schrieb Luis Rivera:

>>> tex4ht doesn't use only this htf-files. At first it loads the tfm's
>>> of the fonts mentioned in the dvi (I don't know exactly why).
>>
>> If it really needs TFMs, I do not think it can ever be compatible with
>> luatex (or xetex, for that matter).
>>
> 
> afaik, tex4ht doesn't load the tfms to generate the dvi: that's
> required by some tex engine (pdfTeX, afaik) which generates a dvi with
> some tailored suited macros (it makes three passes, to ensure the bbl,
> idx and other stuff are properly compiled); then, in the second stage,
> tex4ht deciphers the dvi with the htf files to generate some xml
> files; and in the third stage, t4ht assembles the final html/odt file
> with the xmls, the images, and all the other stuff generated by the
> previous steps. I collect that from reading the oolatex script, which
> actually controls the whole process.
> 



To avoid some confusion: There is tex4ht as "system", large package
with various files, folders, configuration etc. And there is the
central application tex4ht.exe. 

tex4ht.exe is a dvi-driver. It takes a dvi and generates eg a
html-file. To be able to do this the dvi must contain a lot
\specials. This specials are inserted by tex4ht.sty and various
4ht-files during the previous (lua)latex runs.  


> So, in my not very enlightened opinion, htf files are necessary only
> because the tfm files that generate a dvi may have different
> encodings, so the resulting dvi files are spaghetti encoded, and there
> is some need to ensure that appropriate utf8 sequences are produced
> from the messy dvi into the the generated xml files. htf files are
> mainly maps from 8 bit encoded fonts into utf8.
> 
> If a TeX engine could read and write files properly UTF8 encoded, the
> need for htf files would be bypassed; tex4ht would only have to
> translate typesetting instructions (from a target successor of dvi
> format) into xml tags, since the encoding would be UTF8 right from the
> beginning.

The htf-files don't do only reencoding or mapping. They are used to
control the "look" of the output. E.g. 

'b' ''     98 

will give the expected "b" if the input is char98 (= b). But in
another htf-file you find at position 98 this:

'B' '4'    98

and this will give 

<span class="small-caps">B</span>

(The <span>  comes from the '4' which is a class number). 

So the htf-files gives you a low-level mapping characters to other
representations (like html entities) and of fonts to font features
in html like small-caps, bold etc. 


The generation of the dvi works fine with luatex. The problems
starts at the dvi -> html step with tex4ht (if the document uses
system fonts). The dvi contains font names like "file:lm-modern..."
and tex4ht looks (for still unknown reasons) for its tfm and can't
find it. 

For a simple document I got around the problem by using the
low-level command \font\test=Arial and renaming an arbitrary tfm to
arial.tfm.  Currently I seem to be able to use ASCII and ???, but
the ? is output to  ?. This looks like a 256-barrier ;-(. But
perhaps one can get around it by extending the htf-files.



-- 
Ulrike Fischer 


From luigi.scarso at gmail.com  Wed Jun 22 11:23:14 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 22 Jun 2011 11:23:14 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <h0k1gi80icam.dlg@nililand.de>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
 <h0k1gi80icam.dlg@nililand.de>
Message-ID: <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>

On Wed, Jun 22, 2011 at 10:56 AM, Ulrike Fischer <luatex at nililand.de> wrote:
> Am Tue, 21 Jun 2011 14:09:04 -0500 schrieb Luis Rivera:
>
>>>> tex4ht doesn't use only this htf-files. At first it loads the tfm's
>>>> of the fonts mentioned in the dvi (I don't know exactly why).
>>>
>>> If it really needs TFMs, I do not think it can ever be compatible with
>>> luatex (or xetex, for that matter).
>>>
>>
>> afaik, tex4ht doesn't load the tfms to generate the dvi: that's
>> required by some tex engine (pdfTeX, afaik) which generates a dvi with
>> some tailored suited macros (it makes three passes, to ensure the bbl,
>> idx and other stuff are properly compiled); then, in the second stage,
>> tex4ht deciphers the dvi with the htf files to generate some xml
>> files; and in the third stage, t4ht assembles the final html/odt file
>> with the xmls, the images, and all the other stuff generated by the
>> previous steps. I collect that from reading the oolatex script, which
>> actually controls the whole process.
>>
>
>
>
> To avoid some confusion: There is tex4ht as "system", large package
> with various files, folders, configuration etc. And there is the
> central application tex4ht.exe.
>
> tex4ht.exe is a dvi-driver. It takes a dvi and generates eg a
> html-file. To be able to do this the dvi must contain a lot
> \specials. This specials are inserted by tex4ht.sty and various
> 4ht-files during the previous (lua)latex runs.
>
>
>> So, in my not very enlightened opinion, htf files are necessary only
>> because the tfm files that generate a dvi may have different
>> encodings, so the resulting dvi files are spaghetti encoded, and there
>> is some need to ensure that appropriate utf8 sequences are produced
>> from the messy dvi into the the generated xml files. htf files are
>> mainly maps from 8 bit encoded fonts into utf8.
>>
>> If a TeX engine could read and write files properly UTF8 encoded, the
>> need for htf files would be bypassed; tex4ht would only have to
>> translate typesetting instructions (from a target successor of dvi
>> format) into xml tags, since the encoding would be UTF8 right from the
>> beginning.
>
> The htf-files don't do only reencoding or mapping. They are used to
> control the "look" of the output. E.g.
>
> 'b' '' ? ? 98
>
> will give the expected "b" if the input is char98 (= b). But in
> another htf-file you find at position 98 this:
>
> 'B' '4' ? ?98
>
> and this will give
>
> <span class="small-caps">B</span>
>
> (The <span> ?comes from the '4' which is a class number).
>
> So the htf-files gives you a low-level mapping characters to other
> representations (like html entities) and of fonts to font features
> in html like small-caps, bold etc.
>
>
> The generation of the dvi works fine with luatex. The problems
> starts at the dvi -> html step with tex4ht (if the document uses
> system fonts). The dvi contains font names like "file:lm-modern..."
> and tex4ht looks (for still unknown reasons) for its tfm and can't
> find it.
>
> For a simple document I got around the problem by using the
> low-level command \font\test=Arial and renaming an arbitrary tfm to
> arial.tfm. ?Currently I seem to be able to use ASCII and ???, but
> the ? is output to ??. This looks like a 256-barrier ;-(. But
> perhaps one can get around it by extending the htf-files.
With context mkii (texlive 2009, pdftex engine: test.mkii is an utf-8 file)

%%% test.mkii
\enableregime[utf]
\starttext
goo
???@??
\stoptext
%%%

$>texexec --dvi  test.mkii
$>tex4ht test.dvi


----------------------------
tex4ht.c (2009-01-31-07:33 kpathsea)
/opt/TeXLive2009/tl2009/bin/i386-linux/tex4ht test.dvi
(/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/base/unix/tex4ht.env)
(/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/iso8859/1/charset/unicode.4hf)
(/opt/TeXLive2009/tl2009/texmf-dist/fonts/tfm/hoekwater/context/fmvr8x.tfm)
(/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/unicode/marvosym/fmvr8x.htf)
(/opt/TeXLive2009/tl2009/texmf-dist/fonts/tfm/public/lm/ec-lmr12.tfm)
(/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/alias/lm/lm-ec/ec-lm.htf)
Searching `lm-ec.htf' for `ec-lmr12.htf'
(/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf)
[1 file test.html
]
Execute script `test.lg'


test.lg is
----------------------
htfcss: ec-lmbo  font-style: oblique;
htfcss: ec-lmbx  font-weight: bold;
htfcss: ec-lmbxi  font-style:italic; font-weight: bold;
htfcss: ec-lmbxo  font-style: oblique; font-weight: bold;
htfcss: ec-lmcsco  font-style: oblique;
htfcss: ec-lmri  font-style:italic;
htfcss: ec-lmro  font-style: oblique;
htfcss: ec-lmss  font-family: sans-serif;
htfcss: ec-lmssbo  font-family: sans-serif; font-style: oblique;
font-weight: bold;
htfcss: ec-lmssbx  font-family: sans-serif; font-weight: bold;
htfcss: ec-lmssdc  font-family: sans-serif;
htfcss: ec-lmssdo  font-family: sans-serif; font-style: oblique;
htfcss: ec-lmsso  font-family: sans-serif; font-style: oblique;
htfcss: ec-lmssq  font-family: sans-serif;
htfcss: ec-lmssqbo  font-family: sans-serif; font-style: oblique;
font-weight: bold;
htfcss: ec-lmssqbx  font-family: sans-serif; font-weight: bold;
htfcss: ec-lmssqo  font-family: sans-serif; font-style: oblique;
htfcss: ec-lmtcsc  font-family: monospace;
htfcss: ec-lmtcso  font-style: oblique; font-family: monospace;
htfcss: ec-lmtk  font-family: monospace;
htfcss: ec-lmtko  font-style: oblique; font-family: monospace;
htfcss: ec-lmtl  font-weight: light; font-family: monospace;
htfcss: ec-lmtlc  font-weight: light; font-family: monospace;
htfcss: ec-lmtlco  font-weight: light; font-style: oblique;
font-family: monospace;
htfcss: ec-lmtlo  font-weight: light; font-style: oblique;
font-family: monospace;
htfcss: ec-lmtt  font-family: monospace;
htfcss: ec-lmtti  font-family: monospace; font-style:italic;
htfcss: ec-lmtto  font-style: oblique; font-family: monospace;
htfcss: ec-lmvtk  font-family: monospace;
htfcss: ec-lmvtko  font-style: oblique; font-family: monospace;
htfcss: ec-lmvtl  font-weight: light; font-family: monospace;
htfcss: ec-lmvtlo  font-weight: light; font-style: oblique;
font-family: monospace;
htfcss: ec-lmvtt  font-family: monospace;
htfcss: ec-lmvtto  font-style: oblique; font-family: monospace;
File: test.html
--- characters ---
Font("ec-lmr","12","12","100")
Font("fmvr8x","","10","120")
------------------


The result is

1
goo &#x20AC;??@cc


(where 1 is the pagenumber on the header)




-- 
luigi


From mohamed at bana.org.uk  Wed Jun 22 17:40:39 2011
From: mohamed at bana.org.uk (Mohamed Bana)
Date: Wed, 22 Jun 2011 16:40:39 +0100
Subject: [luatex] luatex Digest, Vol 30, Issue 13
In-Reply-To: <mailman.9082.1308734602.3597.luatex@tug.org>
References: <mailman.9082.1308734602.3597.luatex@tug.org>
Message-ID: <BANLkTin9W9_rxM97L=kEEyMApkkSQDdTfw@mail.gmail.com>

Would someone please unsubscribe me.  I can't seem to do it myself.

 ?Mohamed


On 22 June 2011 10:23, <luatex-request at tug.org> wrote:

> Send luatex mailing list submissions to
>        luatex at tug.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        http://tug.org/mailman/listinfo/luatex
> or, via email, send a message with subject or body 'help' to
>        luatex-request at tug.org
>
> You can reach the person managing the list at
>        luatex-owner at tug.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of luatex digest..."
>
>
> Today's Topics:
>
>   1. Re: dump a tfm to a file (Ulrike Fischer)
>   2. Re: dump a tfm to a file (Ulrike Fischer)
>   3. Re: dump a tfm to a file (Taco Hoekwater)
>   4. Re: dump a tfm to a file (Luis Rivera)
>   5. Re: dump a tfm to a file (Khaled Hosny)
>   6. Re: dump a tfm to a file (Ulrike Fischer)
>   7. Re: dump a tfm to a file (luigi scarso)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Tue, 21 Jun 2011 18:30:19 +0200
> From: Ulrike Fischer <luatex at nililand.de>
> To: luatex at tug.org
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <15b67h71makxr$.dlg at nililand.de>
> Content-Type: text/plain; charset="us-ascii"
>
> Am Tue, 21 Jun 2011 10:33:26 +0200 schrieb Mojca Miklavec:
>
> >> I know nothing about tex4ht except that it exists and is annoyingly hard
> >> to set up right (which is exactly why that is the only thing I know
> >> about it).
>
> And this from the user of a system which so hard to set up that it
> breaks permanently in miktex ;-)
>
> Actually I don't think that tex4ht is overly complicated, but yes
> tex4ht it is not really easy to debug or to get details right or to
> expand.
>
> One central problem is that not much of its "inner working" is
> known. Eitan Gurari was always very helpful on c.t.t. If someone
> mentioned a bug or a feature request a new beta arrived. But as far
> as I know he was the only one who worked with the source and
> actually understood what the various pieces do. And while there is
> some code documentation it is not helpful as it contains a lot of
> personal remarks, e-mail snippets and obviously simply evolved over
> time. And this makes it difficult to find a new maintainer, or
> someone who can help with problems and insights.
>
> But on the other side texh4t contains a lot of useful code. I was
> quite impressed some days ago when I could convert a document
> containing a biblatex bibliography without much problems to an open
> office document. And the html generation is really quite powerful
> and sophisticated. It would be a pity if one would do all the work
> again instead of trying first if it can be reused and adapted.
>
>
> >> But if there is a dedicated format that tex4ht understands,
> >> then it should be quite straightforward to create such a file based on
> >> the internal metrics representation, especially if it is a
> human-readable
> >> format.
> >
> > It is. See:
> >
> /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf
>
> tex4ht doesn't use only this htf-files. At first it loads the tfm's
> of the fonts mentioned in the dvi (I don't know exactly why).
>
>
> --
> Ulrike Fischer
>
>
>
> ------------------------------
>
> Message: 2
> Date: Tue, 21 Jun 2011 18:37:50 +0200
> From: Ulrike Fischer <luatex at nililand.de>
> To: luatex at tug.org
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <m4n3f9412s4a$.dlg at nililand.de>
> Content-Type: text/plain; charset="us-ascii"
>
> Am Tue, 21 Jun 2011 10:57:35 +0200 schrieb Khaled Hosny:
>
>
> > Or one can just ditch tex4ht entirely and go with more sane lua based
> > solution like the amazing x(h)ml export work that Hans is doing (it can
> > even export xii.tex ;) ).
>
> tex4ht can export xii.tex too. I tried ;-) And while I would
> certainly like to try Hans code: it probably doesn't work for latex,
> so it would need someone who 1. understand it and 2. can adapt it.
> Both not very easy without some good documentation.
>
> Btw: Do you have time to synch the unstable branch of luaotfload
> with the newest context code?
>
> --
> Ulrike Fischer
>
>
>
> ------------------------------
>
> Message: 3
> Date: Tue, 21 Jun 2011 19:42:51 +0200
> From: Taco Hoekwater <taco at elvenkind.com>
> To: "luatex at nililand.de" <luatex at nililand.de>, "General discussion of
>        LuaTeX." <luatex at tug.org>
> Cc: "luatex at tug.org" <luatex at tug.org>
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <06A802EF-6FA7-4778-81D7-FEBEA5213813 at elvenkind.com>
> Content-Type: text/plain;       charset=us-ascii
>
>
>
>
>
> On 21 jun. 2011, at 18:30, Ulrike Fischer <luatex at nililand.de> wrote:
>
> > Am Tue, 21 Jun 2011 10:33:26 +0200 schrieb Mojca Miklavec:
> >
> >>> I know nothing about tex4ht except that it exists and is annoyingly
> hard
> >>> to set up right (which is exactly why that is the only thing I know
> >>> about it).
> >
> > And this from the user of a system which so hard to set up that it
> > breaks permanently in miktex ;-)
> >
>
> Actually, that quote was me talking. I don't think Mojca would claim that
> anything at all is hard to set up ;)
>
> >> It is. See:
> >>
>  /usr/local/texlive/2011/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf
> >
> > tex4ht doesn't use only this htf-files. At first it loads the tfm's
> > of the fonts mentioned in the dvi (I don't know exactly why).
>
> If it really needs TFMs, I do not think it can ever be compatible with
> luatex (or xetex, for that matter).
>
> Best wishes,
> Taco
> >
>
>
>
> ------------------------------
>
> Message: 4
> Date: Tue, 21 Jun 2011 14:09:04 -0500
> From: Luis Rivera <jlrn77 at gmail.com>
> To: "General discussion of LuaTeX." <luatex at tug.org>
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> On 21/06/2011, Taco Hoekwater <taco at elvenkind.com> wrote:
> >
> > On 21 jun. 2011, at 18:30, Ulrike Fischer <luatex at nililand.de> wrote:
> >
> >>
> >> tex4ht doesn't use only this htf-files. At first it loads the tfm's
> >> of the fonts mentioned in the dvi (I don't know exactly why).
> >
> > If it really needs TFMs, I do not think it can ever be compatible with
> > luatex (or xetex, for that matter).
> >
>
> afaik, tex4ht doesn't load the tfms to generate the dvi: that's
> required by some tex engine (pdfTeX, afaik) which generates a dvi with
> some tailored suited macros (it makes three passes, to ensure the bbl,
> idx and other stuff are properly compiled); then, in the second stage,
> tex4ht deciphers the dvi with the htf files to generate some xml
> files; and in the third stage, t4ht assembles the final html/odt file
> with the xmls, the images, and all the other stuff generated by the
> previous steps. I collect that from reading the oolatex script, which
> actually controls the whole process.
>
> So, in my not very enlightened opinion, htf files are necessary only
> because the tfm files that generate a dvi may have different
> encodings, so the resulting dvi files are spaghetti encoded, and there
> is some need to ensure that appropriate utf8 sequences are produced
> from the messy dvi into the the generated xml files. htf files are
> mainly maps from 8 bit encoded fonts into utf8.
>
> If a TeX engine could read and write files properly UTF8 encoded, the
> need for htf files would be bypassed; tex4ht would only have to
> translate typesetting instructions (from a target successor of dvi
> format) into xml tags, since the encoding would be UTF8 right from the
> beginning.
>
> --
> Luis Rivera
> O< http://www.asciiribbon.org/ campaign
>
>
> ------------------------------
>
> Message: 5
> Date: Tue, 21 Jun 2011 23:05:36 +0200
> From: Khaled Hosny <khaledhosny at eglug.org>
> To: luatex at nililand.de, "General discussion of LuaTeX."
>        <luatex at tug.org>
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <20110621210536.GA15999 at khaled-laptop>
> Content-Type: text/plain; charset=utf-8
>
> On Tue, Jun 21, 2011 at 06:37:50PM +0200, Ulrike Fischer wrote:
> > Am Tue, 21 Jun 2011 10:57:35 +0200 schrieb Khaled Hosny:
> >
> >
> > > Or one can just ditch tex4ht entirely and go with more sane lua based
> > > solution like the amazing x(h)ml export work that Hans is doing (it can
> > > even export xii.tex ;) ).
> >
> > tex4ht can export xii.tex too. I tried ;-) And while I would
> > certainly like to try Hans code: it probably doesn't work for latex,
> > so it would need someone who 1. understand it and 2. can adapt it.
> > Both not very easy without some good documentation.
>
> Hans code is probably deeply tied with ConTeXt, I was only suggesting
> that someone would try a similar approach (I don't know much about
> tex4ht either, but from where I stand it looks like a big, complex and
> fragile hack that is only necessary because TeX can't do better.)
>
> > Btw: Do you have time to synch the unstable branch of luaotfload
> > with the newest context code?
>
> I don't think so, Hans did some big changes (to make the code even more
> separable) and it might require rewriting luaotfload's glue layer, but I
> can't afford time for that (I can only do small and interesting hacks :)
> for the time being.)
>
> Regards,
>  Khaled
>
> --
>  Khaled Hosny
>  Egyptian
>  Arab
>
>
> ------------------------------
>
> Message: 6
> Date: Wed, 22 Jun 2011 10:56:58 +0200
> From: Ulrike Fischer <luatex at nililand.de>
> To: luatex at tug.org
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <h0k1gi80icam.dlg at nililand.de>
> Content-Type: text/plain; charset="iso-8859-15"
>
> Am Tue, 21 Jun 2011 14:09:04 -0500 schrieb Luis Rivera:
>
> >>> tex4ht doesn't use only this htf-files. At first it loads the tfm's
> >>> of the fonts mentioned in the dvi (I don't know exactly why).
> >>
> >> If it really needs TFMs, I do not think it can ever be compatible with
> >> luatex (or xetex, for that matter).
> >>
> >
> > afaik, tex4ht doesn't load the tfms to generate the dvi: that's
> > required by some tex engine (pdfTeX, afaik) which generates a dvi with
> > some tailored suited macros (it makes three passes, to ensure the bbl,
> > idx and other stuff are properly compiled); then, in the second stage,
> > tex4ht deciphers the dvi with the htf files to generate some xml
> > files; and in the third stage, t4ht assembles the final html/odt file
> > with the xmls, the images, and all the other stuff generated by the
> > previous steps. I collect that from reading the oolatex script, which
> > actually controls the whole process.
> >
>
>
>
> To avoid some confusion: There is tex4ht as "system", large package
> with various files, folders, configuration etc. And there is the
> central application tex4ht.exe.
>
> tex4ht.exe is a dvi-driver. It takes a dvi and generates eg a
> html-file. To be able to do this the dvi must contain a lot
> \specials. This specials are inserted by tex4ht.sty and various
> 4ht-files during the previous (lua)latex runs.
>
>
> > So, in my not very enlightened opinion, htf files are necessary only
> > because the tfm files that generate a dvi may have different
> > encodings, so the resulting dvi files are spaghetti encoded, and there
> > is some need to ensure that appropriate utf8 sequences are produced
> > from the messy dvi into the the generated xml files. htf files are
> > mainly maps from 8 bit encoded fonts into utf8.
> >
> > If a TeX engine could read and write files properly UTF8 encoded, the
> > need for htf files would be bypassed; tex4ht would only have to
> > translate typesetting instructions (from a target successor of dvi
> > format) into xml tags, since the encoding would be UTF8 right from the
> > beginning.
>
> The htf-files don't do only reencoding or mapping. They are used to
> control the "look" of the output. E.g.
>
> 'b' ''     98
>
> will give the expected "b" if the input is char98 (= b). But in
> another htf-file you find at position 98 this:
>
> 'B' '4'    98
>
> and this will give
>
> <span class="small-caps">B</span>
>
> (The <span>  comes from the '4' which is a class number).
>
> So the htf-files gives you a low-level mapping characters to other
> representations (like html entities) and of fonts to font features
> in html like small-caps, bold etc.
>
>
> The generation of the dvi works fine with luatex. The problems
> starts at the dvi -> html step with tex4ht (if the document uses
> system fonts). The dvi contains font names like "file:lm-modern..."
> and tex4ht looks (for still unknown reasons) for its tfm and can't
> find it.
>
> For a simple document I got around the problem by using the
> low-level command \font\test=Arial and renaming an arbitrary tfm to
> arial.tfm.  Currently I seem to be able to use ASCII and ???, but
> the ? is output to  ?. This looks like a 256-barrier ;-(. But
> perhaps one can get around it by extending the htf-files.
>
>
>
> --
> Ulrike Fischer
>
>
>
> ------------------------------
>
> Message: 7
> Date: Wed, 22 Jun 2011 11:23:14 +0200
> From: luigi scarso <luigi.scarso at gmail.com>
> To: luatex at tug.org
> Subject: Re: [luatex] dump a tfm to a file
> Message-ID: <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> On Wed, Jun 22, 2011 at 10:56 AM, Ulrike Fischer <luatex at nililand.de>
> wrote:
> > Am Tue, 21 Jun 2011 14:09:04 -0500 schrieb Luis Rivera:
> >
> >>>> tex4ht doesn't use only this htf-files. At first it loads the tfm's
> >>>> of the fonts mentioned in the dvi (I don't know exactly why).
> >>>
> >>> If it really needs TFMs, I do not think it can ever be compatible with
> >>> luatex (or xetex, for that matter).
> >>>
> >>
> >> afaik, tex4ht doesn't load the tfms to generate the dvi: that's
> >> required by some tex engine (pdfTeX, afaik) which generates a dvi with
> >> some tailored suited macros (it makes three passes, to ensure the bbl,
> >> idx and other stuff are properly compiled); then, in the second stage,
> >> tex4ht deciphers the dvi with the htf files to generate some xml
> >> files; and in the third stage, t4ht assembles the final html/odt file
> >> with the xmls, the images, and all the other stuff generated by the
> >> previous steps. I collect that from reading the oolatex script, which
> >> actually controls the whole process.
> >>
> >
> >
> >
> > To avoid some confusion: There is tex4ht as "system", large package
> > with various files, folders, configuration etc. And there is the
> > central application tex4ht.exe.
> >
> > tex4ht.exe is a dvi-driver. It takes a dvi and generates eg a
> > html-file. To be able to do this the dvi must contain a lot
> > \specials. This specials are inserted by tex4ht.sty and various
> > 4ht-files during the previous (lua)latex runs.
> >
> >
> >> So, in my not very enlightened opinion, htf files are necessary only
> >> because the tfm files that generate a dvi may have different
> >> encodings, so the resulting dvi files are spaghetti encoded, and there
> >> is some need to ensure that appropriate utf8 sequences are produced
> >> from the messy dvi into the the generated xml files. htf files are
> >> mainly maps from 8 bit encoded fonts into utf8.
> >>
> >> If a TeX engine could read and write files properly UTF8 encoded, the
> >> need for htf files would be bypassed; tex4ht would only have to
> >> translate typesetting instructions (from a target successor of dvi
> >> format) into xml tags, since the encoding would be UTF8 right from the
> >> beginning.
> >
> > The htf-files don't do only reencoding or mapping. They are used to
> > control the "look" of the output. E.g.
> >
> > 'b' '' ? ? 98
> >
> > will give the expected "b" if the input is char98 (= b). But in
> > another htf-file you find at position 98 this:
> >
> > 'B' '4' ? ?98
> >
> > and this will give
> >
> > <span class="small-caps">B</span>
> >
> > (The <span> ?comes from the '4' which is a class number).
> >
> > So the htf-files gives you a low-level mapping characters to other
> > representations (like html entities) and of fonts to font features
> > in html like small-caps, bold etc.
> >
> >
> > The generation of the dvi works fine with luatex. The problems
> > starts at the dvi -> html step with tex4ht (if the document uses
> > system fonts). The dvi contains font names like "file:lm-modern..."
> > and tex4ht looks (for still unknown reasons) for its tfm and can't
> > find it.
> >
> > For a simple document I got around the problem by using the
> > low-level command \font\test=Arial and renaming an arbitrary tfm to
> > arial.tfm. ?Currently I seem to be able to use ASCII and ???, but
> > the ? is output to ??. This looks like a 256-barrier ;-(. But
> > perhaps one can get around it by extending the htf-files.
> With context mkii (texlive 2009, pdftex engine: test.mkii is an utf-8 file)
>
> %%% test.mkii
> \enableregime[utf]
> \starttext
> goo
> ???@??
> \stoptext
> %%%
>
> $>texexec --dvi  test.mkii
> $>tex4ht test.dvi
>
>
> ----------------------------
> tex4ht.c (2009-01-31-07:33 kpathsea)
> /opt/TeXLive2009/tl2009/bin/i386-linux/tex4ht test.dvi
> (/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/base/unix/tex4ht.env)
>
> (/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/iso8859/1/charset/unicode.4hf)
> (/opt/TeXLive2009/tl2009/texmf-dist/fonts/tfm/hoekwater/context/fmvr8x.tfm)
>
> (/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/unicode/marvosym/fmvr8x.htf)
> (/opt/TeXLive2009/tl2009/texmf-dist/fonts/tfm/public/lm/ec-lmr12.tfm)
>
> (/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/alias/lm/lm-ec/ec-lm.htf)
> Searching `lm-ec.htf' for `ec-lmr12.htf'
> (/opt/TeXLive2009/tl2009/texmf-dist/tex4ht/ht-fonts/unicode/lm/lm-ec.htf)
> [1 file test.html
> ]
> Execute script `test.lg'
>
>
> test.lg is
> ----------------------
> htfcss: ec-lmbo  font-style: oblique;
> htfcss: ec-lmbx  font-weight: bold;
> htfcss: ec-lmbxi  font-style:italic; font-weight: bold;
> htfcss: ec-lmbxo  font-style: oblique; font-weight: bold;
> htfcss: ec-lmcsco  font-style: oblique;
> htfcss: ec-lmri  font-style:italic;
> htfcss: ec-lmro  font-style: oblique;
> htfcss: ec-lmss  font-family: sans-serif;
> htfcss: ec-lmssbo  font-family: sans-serif; font-style: oblique;
> font-weight: bold;
> htfcss: ec-lmssbx  font-family: sans-serif; font-weight: bold;
> htfcss: ec-lmssdc  font-family: sans-serif;
> htfcss: ec-lmssdo  font-family: sans-serif; font-style: oblique;
> htfcss: ec-lmsso  font-family: sans-serif; font-style: oblique;
> htfcss: ec-lmssq  font-family: sans-serif;
> htfcss: ec-lmssqbo  font-family: sans-serif; font-style: oblique;
> font-weight: bold;
> htfcss: ec-lmssqbx  font-family: sans-serif; font-weight: bold;
> htfcss: ec-lmssqo  font-family: sans-serif; font-style: oblique;
> htfcss: ec-lmtcsc  font-family: monospace;
> htfcss: ec-lmtcso  font-style: oblique; font-family: monospace;
> htfcss: ec-lmtk  font-family: monospace;
> htfcss: ec-lmtko  font-style: oblique; font-family: monospace;
> htfcss: ec-lmtl  font-weight: light; font-family: monospace;
> htfcss: ec-lmtlc  font-weight: light; font-family: monospace;
> htfcss: ec-lmtlco  font-weight: light; font-style: oblique;
> font-family: monospace;
> htfcss: ec-lmtlo  font-weight: light; font-style: oblique;
> font-family: monospace;
> htfcss: ec-lmtt  font-family: monospace;
> htfcss: ec-lmtti  font-family: monospace; font-style:italic;
> htfcss: ec-lmtto  font-style: oblique; font-family: monospace;
> htfcss: ec-lmvtk  font-family: monospace;
> htfcss: ec-lmvtko  font-style: oblique; font-family: monospace;
> htfcss: ec-lmvtl  font-weight: light; font-family: monospace;
> htfcss: ec-lmvtlo  font-weight: light; font-style: oblique;
> font-family: monospace;
> htfcss: ec-lmvtt  font-family: monospace;
> htfcss: ec-lmvtto  font-style: oblique; font-family: monospace;
> File: test.html
> --- characters ---
> Font("ec-lmr","12","12","100")
> Font("fmvr8x","","10","120")
> ------------------
>
>
> The result is
>
> 1
> goo &#x20AC;??@cc
>
>
> (where 1 is the pagenumber on the header)
>
>
>
>
> --
> luigi
>
>
>
> ------------------------------
>
> _______________________________________________
> luatex mailing list
> luatex at tug.org
> http://tug.org/mailman/listinfo/luatex
>
>
> End of luatex Digest, Vol 30, Issue 13
> **************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110622/6f31ffd9/attachment-0001.html>

From rivanvx at gmail.com  Wed Jun 22 18:09:43 2011
From: rivanvx at gmail.com (=?UTF-8?Q?Vedran_Mileti=C4=87?=)
Date: Wed, 22 Jun 2011 18:09:43 +0200
Subject: [luatex] Memory leaks
Message-ID: <BANLkTikip4u87dNtm3twGyEqC=2seeAnpg@mail.gmail.com>

Hi,

are memory leaks something that should be reported as a bug or not yet?

Vedran Mileti?


From taco at elvenkind.com  Wed Jun 22 18:12:19 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 22 Jun 2011 18:12:19 +0200
Subject: [luatex] Memory leaks
In-Reply-To: <BANLkTikip4u87dNtm3twGyEqC=2seeAnpg@mail.gmail.com>
References: <BANLkTikip4u87dNtm3twGyEqC=2seeAnpg@mail.gmail.com>
Message-ID: <4E021463.2010600@elvenkind.com>



On 06/22/11 18:09, Vedran Mileti? wrote:
> Hi,
> 
> are memory leaks something that should be reported as a bug or not yet?

Only big ones. ;)

From patrick at gundla.ch  Thu Jun 23 10:59:09 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Jun 2011 10:59:09 +0200
Subject: [luatex] find breakpoints in a word
Message-ID: <5BD38BE9-D240-48F6-AD03-8EF7FCC416B3@gundla.ch>

Hi,

I'd like to find out the breakpoints of a word (with Lua), such as 

\showhyphens{office}

The ideal solution would be to get a string like "of-fice".

I think I can do a call to tex.hyphenation and analyze the nodelist afterwards. But perhaps there is a clean solution already present.

Patrick


BTW: what is preferred: tex.lccode[x]=y or tex.setlccode(x,y)?




From zappathustra at free.fr  Thu Jun 23 11:12:02 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 23 Jun 2011 11:12:02 +0200
Subject: [luatex] find breakpoints in a word
In-Reply-To: <5BD38BE9-D240-48F6-AD03-8EF7FCC416B3@gundla.ch>
References: <5BD38BE9-D240-48F6-AD03-8EF7FCC416B3@gundla.ch>
Message-ID: <4E030362.1050000@free.fr>



Le 23/06/2011 10:59, Patrick Gundlach a ?crit :
> Hi,
>
> I'd like to find out the breakpoints of a word (with Lua), such as
>
> \showhyphens{office}
>
> The ideal solution would be to get a string like "of-fice".
>
> I think I can do a call to tex.hyphenation and analyze the nodelist afterwards. But perhaps there is a clean solution already present.

You have to call tex.ligaturing too, because ligatures may change 
hyphenation. And you might get special kinds of disc nodes. See section 
6.5 of the manual.

> Patrick
>
>
> BTW: what is preferred: tex.lccode[x]=y or tex.setlccode(x,y)?

In the second case you can specify "global", whereas in the first case 
the assignment is necessary local. So in some cases the function 
approach is the only one that'll work.

Best,
Paul

From taco at elvenkind.com  Thu Jun 23 11:34:26 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 23 Jun 2011 11:34:26 +0200
Subject: [luatex] find breakpoints in a word
In-Reply-To: <4E030362.1050000@free.fr>
References: <5BD38BE9-D240-48F6-AD03-8EF7FCC416B3@gundla.ch>
 <4E030362.1050000@free.fr>
Message-ID: <4E0308A2.9030504@elvenkind.com>



On 06/23/11 11:12, Paul Isambert wrote:
> 
> 
> Le 23/06/2011 10:59, Patrick Gundlach a ?crit :
>> Hi,
>>
>> I'd like to find out the breakpoints of a word (with Lua), such as
>>
>> \showhyphens{office}
>>
>> The ideal solution would be to get a string like "of-fice".
>>
>> I think I can do a call to tex.hyphenation and analyze the nodelist
>> afterwards. 

This is the way to go, but note that this may find breakpoints that
are not actually going to be used (e.g. \hbox{office} does have
breakpoints).

> But perhaps there is a clean solution already present.
> 
> You have to call tex.ligaturing too, because ligatures may change
> hyphenation. And you might get special kinds of disc nodes. See section
> 6.5 of the manual.

That is not true. Ligatures may change the node list in fairly complex
ways (because the disc nodes have contain extra branches to allow
ligatures), but they cannot alter the chosen hyphenation points, so
there is no need to call tex.ligaturing() if you are only interested in
the actual breakpoints.

Best wishes,
Taco

From patrick at gundla.ch  Thu Jun 23 11:46:47 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Jun 2011 11:46:47 +0200
Subject: [luatex] setting lccode "automatically"
Message-ID: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>

Another question regarding hyphenation (thanks Paul and Taco for the answer to the first one).

Hyphenation is only done when the lccode of each char is not 0. Now most languages have chars beyond a-z, such as ? or ? or ?. Now how do I set these lccodes?

Currently I do something like:

for i in string.utfvalues("???????") do
  tex.lccode[i] = i
end

but this has two disadvantages I can see:

1) I have to manually pick the foreign characters and set the lccode manually
2) What is the lowercase of I (LATIN CAPITAL LETTER I)? Is it i or ? (LATIN SMALL LETTER DOTLESS I)?


I guess that I should use a unicode data table for the characters. But that is still not 100% correct for languages like Turkish and Azeri, right? Since the lccodes are not language-local, we cannot achieve a 100% correct solution, correct?

Patrick



From taco at elvenkind.com  Thu Jun 23 12:00:11 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 23 Jun 2011 12:00:11 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
Message-ID: <4E030EAB.4080502@elvenkind.com>



On 06/23/11 11:46, Patrick Gundlach wrote:
> Another question regarding hyphenation (thanks Paul and Taco for the answer to the first one).
> 
> Hyphenation is only done when the lccode of each char is not 0. Now most languages have chars beyond a-z, such as ? or ? or ?. Now how do I set these lccodes?
> 
> Currently I do something like:
> 
> for i in string.utfvalues("???????") do
>   tex.lccode[i] = i
> end

Yes, pretty much. That is also what luatex-unicode-letters.tex does
(but it uses TeX syntax, because it was borrowed from XeTeX).

> but this has two disadvantages I can see:
> 
> 1) I have to manually pick the foreign characters and set the lccode manually

Here luatex-unicode-letters can help.

> 2) What is the lowercase of I (LATIN CAPITAL LETTER I)? Is it i or ? (LATIN SMALL LETTER DOTLESS I)?

This problem is not fixable without knowing the current language ...

> I guess that I should use a unicode data table for the characters. But that is still not 100% correct for languages like Turkish and Azeri, right? Since the lccodes are not language-local, we cannot achieve a 100% correct solution, correct?

.. correct, you need a per-language table, which (as far as I know)
does not actually exist. That is what the \savinghyphcodes of etex was
for, but the implementation of that was unusable in luatex and
therefore removed. A new implementation of \savinghyphcodes will come
eventually.

Best wishes,
Taco

From arthur.reutenauer at normalesup.org  Thu Jun 23 12:14:13 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 23 Jun 2011 11:14:13 +0100
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E030EAB.4080502@elvenkind.com>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <4E030EAB.4080502@elvenkind.com>
Message-ID: <20110623101413.GC20185@phare.normalesup.org>

> .. correct, you need a per-language table, which (as far as I know)
> does not actually exist.

  It does, it's SpecialCasing.txt in the Unicode Character Database
(http://www.unicode.org/Public/6.0.0/ucd/SpecialCasing.txt); see
sections 3.13 and 5.18 of the Unicode Standard for more details
(http://www.unicode.org/versions/Unicode6.0.0/{ch03,ch05}.pdf).

  It actually has much more information than language-specific casing
exceptions, of which there are rather few (mostly for Turkish and Azeri,
and Lithuanian).

	Arthur

From st_philipp at yahoo.de  Thu Jun 23 12:27:36 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Thu, 23 Jun 2011 12:27:36 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
Message-ID: <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>


Am 23.06.2011 um 11:46 schrieb Patrick Gundlach:

> Another question regarding hyphenation (thanks Paul and Taco for the answer to the first one).
> 
> Hyphenation is only done when the lccode of each char is not 0. Now most languages have chars beyond a-z, such as ? or ? or ?. Now how do I set these lccodes?
> 
> Currently I do something like:
> 
> for i in string.utfvalues("???????") do
>  tex.lccode[i] = i
> end
> 
> but this has two disadvantages I can see:
> 
> 1) I have to manually pick the foreign characters and set the lccode manually
> 2) What is the lowercase of I (LATIN CAPITAL LETTER I)? Is it i or ? (LATIN SMALL LETTER DOTLESS I)?
> 
> 
> I guess that I should use a unicode data table for the characters. But that is still not 100% correct for languages like Turkish and Azeri, right? Since the lccodes are not language-local, we cannot achieve a 100% correct solution, correct?

No, and even without those local-dependent cases, it would still be impossible to build a correct lccode/uccode table since lowercasing/uppercasing one character is context-dependent and can result in more than one character: the uppercase of ? is SS. \lccode/\uccode (and by extension, \lowercase/\uppercase) is just not usable in the Unicode world. LuaTeX might implement the casing algorithms (with tailoring) described in section 3.13 of the standard. This includes
- Locale-dependent mappings
- Context-dependent mappings
- Length-changing mappings

From taco at elvenkind.com  Thu Jun 23 12:35:42 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 23 Jun 2011 12:35:42 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
Message-ID: <4E0316FE.3080506@elvenkind.com>


> 
> No, and even without those local-dependent cases, it would still be
> impossible to build a correct lccode/uccode table since
> lowercasing/uppercasing one character is context-dependent and can
> result in more than one character: the uppercase of ? is SS.

Well, in this particular example, there is ... U+1E9E ! :) :)

> \lccode/\uccode (and by extension, \lowercase/\uppercase) is just not
> usable in the Unicode world. 

It is actually quite usable, I think. It may not be applicable in
all 100% of cases, but it scores well above 99% of practical cases,
and that is not at all the same as not usable.

> LuaTeX might implement the casing
> algorithms (with tailoring) described in section 3.13 of the
> standard. 

You do not happen to be bored and looking for something interesting
to do in the coming few weeks, by any chance?

Best wishes,
Taco

From st_philipp at yahoo.de  Thu Jun 23 13:02:54 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Thu, 23 Jun 2011 13:02:54 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E0316FE.3080506@elvenkind.com>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
Message-ID: <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>


Am 23.06.2011 um 12:35 schrieb Taco Hoekwater:

> 
>> 
>> No, and even without those local-dependent cases, it would still be
>> impossible to build a correct lccode/uccode table since
>> lowercasing/uppercasing one character is context-dependent and can
>> result in more than one character: the uppercase of ? is SS.
> 
> Well, in this particular example, there is ... U+1E9E ! :) :)

No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has

# The German es-zed is special--the normal mapping is to SS.
# Note: the titlecase should never occur in practice. It is equal to titlecase(uppercase(<es-zed>))

00DF; 00DF; 0053 0073; 0053 0053; # LATIN SMALL LETTER SHARP S

>> LuaTeX might implement the casing
>> algorithms (with tailoring) described in section 3.13 of the
>> standard. 
> 
> You do not happen to be bored and looking for something interesting
> to do in the coming few weeks, by any chance?

The casing algorithms are already implemented in the ICU library (and probably in other libraries as well).

From taco at elvenkind.com  Thu Jun 23 13:06:34 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 23 Jun 2011 13:06:34 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
Message-ID: <4E031E3A.70809@elvenkind.com>



On 06/23/11 13:02, Philipp Stephani wrote:
> 
> Am 23.06.2011 um 12:35 schrieb Taco Hoekwater:
> 
>>
>>>
>>> No, and even without those local-dependent cases, it would still be
>>> impossible to build a correct lccode/uccode table since
>>> lowercasing/uppercasing one character is context-dependent and can
>>> result in more than one character: the uppercase of ? is SS.
>>
>> Well, in this particular example, there is ... U+1E9E ! :) :)
> 
> No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has

I think you missed the smileys.

>>
>> You do not happen to be bored and looking for something interesting
>> to do in the coming few weeks, by any chance?
> 
> The casing algorithms are already implemented in the ICU library (and probably in other libraries as well).

Sure, but that does not help luatex, does it? I, for one, am not going
to wade through the ICU sources trying to extract an algorithm that
is fairly easy to implement based on the actual specification.

Best wishes,
Taco

From st_philipp at yahoo.de  Thu Jun 23 13:23:55 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Thu, 23 Jun 2011 13:23:55 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E031E3A.70809@elvenkind.com>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <4E031E3A.70809@elvenkind.com>
Message-ID: <01DEA33B-F59A-44B6-8733-9D322B005A32@yahoo.de>


Am 23.06.2011 um 13:06 schrieb Taco Hoekwater:

> 
> 
> On 06/23/11 13:02, Philipp Stephani wrote:
>> 
>> Am 23.06.2011 um 12:35 schrieb Taco Hoekwater:
>> 
>>> 
>>>> 
>>>> No, and even without those local-dependent cases, it would still be
>>>> impossible to build a correct lccode/uccode table since
>>>> lowercasing/uppercasing one character is context-dependent and can
>>>> result in more than one character: the uppercase of ? is SS.
>>> 
>>> Well, in this particular example, there is ... U+1E9E ! :) :)
>> 
>> No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has
> 
> I think you missed the smileys.

Those weren't ;-) smileys, right? ;-)

> 
>>> 
>>> You do not happen to be bored and looking for something interesting
>>> to do in the coming few weeks, by any chance?
>> 
>> The casing algorithms are already implemented in the ICU library (and probably in other libraries as well).
> 
> Sure, but that does not help luatex, does it? I, for one, am not going
> to wade through the ICU sources trying to extract an algorithm that
> is fairly easy to implement based on the actual specification.

Where do you want these algorithms actually? I think for case conversion user should just ignore \lowercase etc. and use a (to-be-written) Lua wrapper to ICU (icu4lua seems to be dormant and includes only a tiny fraction of ICU). Hyphenation is another story, but I think it has to be rethought anyway (multistage hyphenation, composed words, dictionary-based algorithms, locale-tailored algorithms etc.). Unfortunately I'm not aware of a good free hyphenation library.

From taco at elvenkind.com  Thu Jun 23 13:27:33 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 23 Jun 2011 13:27:33 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <01DEA33B-F59A-44B6-8733-9D322B005A32@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <4E031E3A.70809@elvenkind.com>
 <01DEA33B-F59A-44B6-8733-9D322B005A32@yahoo.de>
Message-ID: <4E032325.1070103@elvenkind.com>

Hi,

> Where do you want these algorithms actually? I think for case
> conversion user should just ignore \lowercase etc. and use a
> (to-be-written) Lua wrapper to ICU 

Well, if someone wants to write a lua wrapper for ICU and then
use a lua replacement for \uppercase and \lowercase, that is fine.
Not me though, as I do not want luatex to be dependent on libICU.

Best wishes,
Taco

From khaledhosny at eglug.org  Thu Jun 23 13:34:55 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 23 Jun 2011 13:34:55 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E032325.1070103@elvenkind.com>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <4E031E3A.70809@elvenkind.com>
 <01DEA33B-F59A-44B6-8733-9D322B005A32@yahoo.de>
 <4E032325.1070103@elvenkind.com>
Message-ID: <20110623113455.GA29444@khaled-laptop>

On Thu, Jun 23, 2011 at 01:27:33PM +0200, Taco Hoekwater wrote:
> Hi,
> 
> > Where do you want these algorithms actually? I think for case
> > conversion user should just ignore \lowercase etc. and use a
> > (to-be-written) Lua wrapper to ICU 
> 
> Well, if someone wants to write a lua wrapper for ICU and then
> use a lua replacement for \uppercase and \lowercase, that is fine.
> Not me though, as I do not want luatex to be dependent on libICU.

No one in his right mind wants his code to be dependant on libICU, even
a mammoth like LibreOffice are looking for ways to get rid of such
dependency.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From heiko.oberdiek at googlemail.com  Thu Jun 23 13:54:59 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 23 Jun 2011 13:54:59 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
Message-ID: <20110623115459.GA27727@oberdiek.my-fqdn.de>

On Thu, Jun 23, 2011 at 01:02:54PM +0200, Philipp Stephani wrote:

> No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has
> 
> # The German es-zed is special--the normal mapping is to SS.
> # Note: the titlecase should never occur in practice. It is equal to titlecase(uppercase(<es-zed>))
> 
> 00DF; 00DF; 0053 0073; 0053 0053; # LATIN SMALL LETTER SHARP S

And it's context dependent. The German language has two
words "Ma?e" and "Masse" meaning different things.
The uppercase variant would be the same ("MASSE"). Therefore
also "SZ" can be used for the uppercase form of "?": "MASZE".

Yours sincerely
  Heiko Oberdiek

From st_philipp at yahoo.de  Thu Jun 23 13:52:28 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Thu, 23 Jun 2011 13:52:28 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <20110623115459.GA27727@oberdiek.my-fqdn.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <20110623115459.GA27727@oberdiek.my-fqdn.de>
Message-ID: <D1AA3956-5AA6-4788-927C-97B7E81CB400@yahoo.de>


Am 23.06.2011 um 13:54 schrieb Heiko Oberdiek:

> On Thu, Jun 23, 2011 at 01:02:54PM +0200, Philipp Stephani wrote:
> 
>> No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has
>> 
>> # The German es-zed is special--the normal mapping is to SS.
>> # Note: the titlecase should never occur in practice. It is equal to titlecase(uppercase(<es-zed>))
>> 
>> 00DF; 00DF; 0053 0073; 0053 0053; # LATIN SMALL LETTER SHARP S
> 
> And it's context dependent. The German language has two
> words "Ma?e" and "Masse" meaning different things.
> The uppercase variant would be the same ("MASSE"). Therefore
> also "SZ" can be used for the uppercase form of "?": "MASZE".

This (and also the reverse operation) cannot be covered by Unicode or any other automated system that doesn't understand human language. (And I think the current orthography forbids SZ as uppercase version of ?.)

From patrick at gundla.ch  Thu Jun 23 14:12:21 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Jun 2011 14:12:21 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E030EAB.4080502@elvenkind.com>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <4E030EAB.4080502@elvenkind.com>
Message-ID: <E1AD1A37-AF67-436B-B575-4D6961780B06@gundla.ch>

Hi,

thanks to all answers. I use this now:

  for _,i in ipairs
    {181,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,  .... }  do
    tex.lccode[i] = i
  end

  for _,i in ipairs  {{192, 224},{193, 225},{194, 226},{195, 227},{196, 228},{197, 229},{198, 230},{199, 231}, ... }
  do
    tex.lccode[i[1]]=i[2]
  end

I guess this handles around 100% of all my documents.

Patrick



From khaledhosny at eglug.org  Thu Jun 23 14:15:30 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 23 Jun 2011 14:15:30 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <D1AA3956-5AA6-4788-927C-97B7E81CB400@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <20110623115459.GA27727@oberdiek.my-fqdn.de>
 <D1AA3956-5AA6-4788-927C-97B7E81CB400@yahoo.de>
Message-ID: <20110623121530.GA29671@khaled-laptop>

On Thu, Jun 23, 2011 at 01:52:28PM +0200, Philipp Stephani wrote:
> 
> Am 23.06.2011 um 13:54 schrieb Heiko Oberdiek:
> 
> > On Thu, Jun 23, 2011 at 01:02:54PM +0200, Philipp Stephani wrote:
> > 
> >> No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has
> >> 
> >> # The German es-zed is special--the normal mapping is to SS.
> >> # Note: the titlecase should never occur in practice. It is equal to titlecase(uppercase(<es-zed>))
> >> 
> >> 00DF; 00DF; 0053 0073; 0053 0053; # LATIN SMALL LETTER SHARP S
> > 
> > And it's context dependent. The German language has two
> > words "Ma?e" and "Masse" meaning different things.
> > The uppercase variant would be the same ("MASSE"). Therefore
> > also "SZ" can be used for the uppercase form of "?": "MASZE".
> 
> This (and also the reverse operation) cannot be covered by Unicode or
> any other automated system that doesn't understand human language.
> (And I think the current orthography forbids SZ as uppercase version
> of ?.)

I read somewhere that some official German institutions are now
strongly recommending using the new ? as an uppercase form for ? to
avoid this ambiguity.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From Robin.Fairbairns at cl.cam.ac.uk  Thu Jun 23 15:23:18 2011
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 23 Jun 2011 14:23:18 +0100
Subject: [luatex] setting lccode "automatically"
In-Reply-To: Your message of Thu, 23 Jun 2011 13:54:59 +0200.
 <20110623115459.GA27727@oberdiek.my-fqdn.de>
Message-ID: <12279.1308835398@cl.cam.ac.uk>

Heiko Oberdiek <heiko.oberdiek at googlemail.com> wrote:

> On Thu, Jun 23, 2011 at 01:02:54PM +0200, Philipp Stephani wrote:
> 
> > No, the capital ? is not the uppercase version of ?. SpecialCasing.txt has
> > 
> > # The German es-zed is special--the normal mapping is to SS.
> > # Note: the titlecase should never occur in practice. It is equal to titlecase(uppercase(<es-zed>))
> > 
> > 00DF; 00DF; 0053 0073; 0053 0053; # LATIN SMALL LETTER SHARP S
> 
> And it's context dependent. The German language has two
> words "Ma?e" and "Masse" meaning different things.
> The uppercase variant would be the same ("MASSE"). Therefore
> also "SZ" can be used for the uppercase form of "?": "MASZE".

anyone would think that the people who designed the german language had
simply not thought of computerisation...


From preining at logic.at  Thu Jun 23 15:31:45 2011
From: preining at logic.at (Norbert Preining)
Date: Thu, 23 Jun 2011 22:31:45 +0900
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <12279.1308835398@cl.cam.ac.uk>
References: <20110623115459.GA27727@oberdiek.my-fqdn.de>
 <12279.1308835398@cl.cam.ac.uk>
Message-ID: <20110623133145.GB8920@gamma.logic.tuwien.ac.at>

On Do, 23 Jun 2011, Robin Fairbairns wrote:
> > also "SZ" can be used for the uppercase form of "?": "MASZE".
> 
> anyone would think that the people who designed the german language had
> simply not thought of computerisation...

As it is with other languages: Italian lowercase ? and ?(=e) end
up in the upper case as E (at least in normal writing).

And probably many other languages have these kind of problems ;-)
But I dont want to defend German, it is one of the craziest languages.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
NUBBOCK (n.)
The kind of person who has to leave before a party can relax and enjoy
itself.
			--- Douglas Adams, The Meaning of Liff

From arthur.reutenauer at normalesup.org  Thu Jun 23 16:01:33 2011
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Thu, 23 Jun 2011 15:01:33 +0100
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <20110623133145.GB8920@gamma.logic.tuwien.ac.at>
References: <20110623115459.GA27727@oberdiek.my-fqdn.de>
 <12279.1308835398@cl.cam.ac.uk>
 <20110623133145.GB8920@gamma.logic.tuwien.ac.at>
Message-ID: <20110623140133.GB27029@phare.normalesup.org>

> As it is with other languages: Italian lowercase ? and ?(=e) end
> up in the upper case as E (at least in normal writing).

  And English: "record" is hyphenated different according to whether it
is a noun or a verb.  As are many other words.

	Arthur

From Robin.Fairbairns at cl.cam.ac.uk  Thu Jun 23 16:15:25 2011
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 23 Jun 2011 15:15:25 +0100
Subject: [luatex] setting lccode "automatically"
In-Reply-To: Your message of Thu, 23 Jun 2011 22:31:45 +0900.
 <20110623133145.GB8920@gamma.logic.tuwien.ac.at>
Message-ID: <13028.1308838525@cl.cam.ac.uk>

Norbert Preining <preining at logic.at> wrote:

> But I dont want to defend German, it is one of the craziest languages.

an intriguing claim.  the language i speak is a mish-mash of nordic,
germanic and celtic tongues, with norman french accretions, and was
hugely expanded by a single man in late c.16/early c.17.  it's split
into two, with ferociously confusing consequences (american words often
mean the exact opposite of the same word in british english).

and on top of it all, following our political imperialism, and the usa's
(largely) economic imperialism, myriads of people feel impelled to learn
some version of our mish-mash tongue, "in order to get on".

robin

time flies like an arrow.

From luigi.scarso at gmail.com  Thu Jun 23 16:28:28 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 23 Jun 2011 16:28:28 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <20110623133145.GB8920@gamma.logic.tuwien.ac.at>
References: <20110623115459.GA27727@oberdiek.my-fqdn.de>
 <12279.1308835398@cl.cam.ac.uk>
 <20110623133145.GB8920@gamma.logic.tuwien.ac.at>
Message-ID: <BANLkTi=7BHwHSj_3Fu7k5Pxt2hf7JYFdoA@mail.gmail.com>

On Thu, Jun 23, 2011 at 3:31 PM, Norbert Preining <preining at logic.at> wrote:
> On Do, 23 Jun 2011, Robin Fairbairns wrote:
>> > also "SZ" can be used for the uppercase form of "?": "MASZE".
>>
>> anyone would think that the people who designed the german language had
>> simply not thought of computerisation...
>
> As it is with other languages: Italian lowercase ? and ?(=e) end
> up in the upper case as E (at least in normal writing).
?
? != e
" e " is also conjunction, " ? " it is not.
Also
e => E
? => ?
? => ?
It's true that we use E' for ? / ? --- the italian keyboard is quite limited ---
and also  e' for ?/?  --- it's an error, btw.
Infact
" un po' "  (a few)
is correct,
" un p? " is wrong

and
" perch? " (because)
is correct while
" perch? " is wrong as is " perche' "

There are many situations where  the accent make difference
?ncora :=anchor
anc?ra :=still, again
but,  ahim?, few of us know the rules...

-- 
luigi


From heiko.oberdiek at googlemail.com  Thu Jun 23 20:56:52 2011
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 23 Jun 2011 20:56:52 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <D1AA3956-5AA6-4788-927C-97B7E81CB400@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E0316FE.3080506@elvenkind.com>
 <69C1BA02-3368-4203-9339-FC3C42070DD9@yahoo.de>
 <20110623115459.GA27727@oberdiek.my-fqdn.de>
 <D1AA3956-5AA6-4788-927C-97B7E81CB400@yahoo.de>
Message-ID: <20110623185652.GA28943@oberdiek.my-fqdn.de>

On Thu, Jun 23, 2011 at 01:52:28PM +0200, Philipp Stephani wrote:

> 
> Am 23.06.2011 um 13:54 schrieb Heiko Oberdiek:
> 
> > And it's context dependent. The German language has two
> > words "Ma?e" and "Masse" meaning different things.
> > The uppercase variant would be the same ("MASSE"). Therefore
> > also "SZ" can be used for the uppercase form of "?": "MASZE".
> 
> This (and also the reverse operation) cannot be covered by Unicode or any
> other automated system that doesn't understand human language. (And I
> think the current orthography forbids SZ as uppercase version of ?.)

\S 25, E3 says that "SS" is used as uppercase version of "?".

Yours sincerely
  Heiko Oberdiek

From jlrn77 at gmail.com  Thu Jun 23 23:56:47 2011
From: jlrn77 at gmail.com (Luis Rivera)
Date: Thu, 23 Jun 2011 16:56:47 -0500
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
 <h0k1gi80icam.dlg@nililand.de>
 <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>
Message-ID: <BANLkTineSY_FZrK3VnmRCa9pHmZLV7rYWA@mail.gmail.com>

On 22 June 2011 04:23, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Wed, Jun 22, 2011 at 10:56 AM, Ulrike Fischer <luatex at nililand.de> wrote:
>>
>> tex4ht.exe is a dvi-driver. It takes a dvi and generates eg a
>> html-file. To be able to do this the dvi must contain a lot
>> \specials. This specials are inserted by tex4ht.sty and various
>> 4ht-files during the previous (lua)latex runs.
>>
>> [...]
>>
>> The htf-files don't do only reencoding or mapping. They are used to
>> control the "look" of the output. E.g.
>>
>> 'b' '' ? ? 98
>>
>> will give the expected "b" if the input is char98 (= b). But in
>> another htf-file you find at position 98 this:
>>
>> 'B' '4' ? ?98
>>
>> and this will give
>>
>> <span class="small-caps">B</span>
>>
>> (The <span> ?comes from the '4' which is a class number).
>>
>> So the htf-files gives you a low-level mapping characters to other
>> representations (like html entities) and of fonts to font features
>> in html like small-caps, bold etc.
>>
>>
>> The generation of the dvi works fine with luatex. The problems
>> starts at the dvi -> html step with tex4ht (if the document uses
>> system fonts). The dvi contains font names like "file:lm-modern..."
>> and tex4ht looks (for still unknown reasons) for its tfm and can't
>> find it.
>>
>> For a simple document I got around the problem by using the
>> low-level command \font\test=Arial and renaming an arbitrary tfm to
>> arial.tfm. ?Currently I seem to be able to use ASCII and ???, but
>> the ? is output to ??. This looks like a 256-barrier ;-(. But
>> perhaps one can get around it by extending the htf-files.
> With context mkii (texlive 2009, pdftex engine: test.mkii is an utf-8 file)
>
> %%% test.mkii
> \enableregime[utf]
> \starttext
> goo
> ???@??
> \stoptext
> %%%
>
> $>texexec --dvi ?test.mkii
> $>tex4ht test.dvi
>
> [...]
>
> The result is
>
> 1
> goo &#x20AC;??@cc
>

>From above I infer that the translation works only for the UTF8
characters that fit in ISO-8859-1 (Latin 1): since ISO-8859-1 is
effectively a superset of ASCII and a subset of UNICODE, all the slots
that are in the right position ("goo" "??@" in the example above)
translate properly; any other charecter besides (?) or above (?)
ISO-8859-1 breaks the remapping/transcoding of UTF8 (euro is
represented as an hexadecimal xml entity, and I don't know why ?
breaks down).

If Ulrike's only problem is the Euro character, she may try dumping
(and/or patching) a tfm/htf with ISO-8859-15 (Latin 9) encoding for
the remapping. I doubt tex4ht will complain, as long as the character
is in the single 8 bit range allowed by the dvi format, and she
provides the appropriate slot numbers in the translation tables. So
instead of yielding the hexadecimal entity the tex4ht font would
produce the Euro. In fact, that tfm/htf file may be already lurking in
the massive whole of htf files in tex4ht's distro.

<speculation>

If indeed tex4ht is a dvi driver, it should *not* work with UTF8 (or
even BMP encoded ofm files), given the specification (single 8 bit
integer) of the dvi format, regardless how you patch the tfm/htf
files. She really needs, as Robin suggests, a successor to tex4ht that
ignores the single 8 bit limitation of the input (dvi) format.

Now I wonder whether LuaTeX may be used to implement that successor:
perhaps an appropriate Lua script may call LuaTeX to process the UTF8
encoded tex source to produce a properly UTF8 encoded file in a UTF8
extension to the dvi format (let's call it dui, for the sake of this
argument ;-); then the very same Lua script would call TeXLua to run
some Lua code to do the remapping of all the \special-ly embedded xml
entities and produce the xml or html file(s) required, leaving the
UTF8 encoded characters alone.

</speculation>

-- 
Luis Rivera
O< http://www.asciiribbon.org/ campaign


From Arno.Trautmann at gmx.de  Fri Jun 24 07:44:06 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Fri, 24 Jun 2011 07:44:06 +0200
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
Message-ID: <4E042426.5010100@gmx.de>

Slightly off-topic, but:

Philipp Stephani wrote:
> [?] lowercasing/uppercasing one character is context-dependent and can result in more than one character: the uppercase of ? is SS.

Actually, it is (or at least, can be, I don't want to start a
fundamental discussion) ?.

cheers
Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20110624/aa91dd8f/attachment.bin>

From wl at gnu.org  Fri Jun 24 08:02:48 2011
From: wl at gnu.org (Werner LEMBERG)
Date: Fri, 24 Jun 2011 08:02:48 +0200 (CEST)
Subject: [luatex] setting lccode "automatically"
In-Reply-To: <4E042426.5010100@gmx.de>
References: <1D2BBE62-5846-4AE5-B017-674E25EBF2B6@gundla.ch>
 <046BA264-ABA7-48B3-A330-9ADCE806188F@yahoo.de>
 <4E042426.5010100@gmx.de>
Message-ID: <20110624.080248.449154392.wl@gnu.org>


>> [?] lowercasing/uppercasing one character is context-dependent and
>> can result in more than one character: the uppercase of ? is SS.
> 
> Actually, it is (or at least, can be, I don't want to start a
> fundamental discussion) ?.

But only in certain circumstances, like uppercased family names in
passports (e.g. Dre?en -> DRE?EN).


    Werner


From taco at elvenkind.com  Fri Jun 24 08:55:17 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 24 Jun 2011 08:55:17 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <BANLkTineSY_FZrK3VnmRCa9pHmZLV7rYWA@mail.gmail.com>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
 <h0k1gi80icam.dlg@nililand.de>
 <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>
 <BANLkTineSY_FZrK3VnmRCa9pHmZLV7rYWA@mail.gmail.com>
Message-ID: <491EA80D-E8F5-4A4B-B21D-C0C464933677@elvenkind.com>





On 23 jun. 2011, at 23:56, Luis Rivera <jlrn77 at gmail.com> wrote:

> If indeed tex4ht is a dvi driver, it should *not* work with UTF8 (or
> even BMP encoded ofm files), given the specification (single 8 bit
> integer) of the dvi format, regardless how you patch the tfm/htf
> files. She really needs, as Robin suggests, a successor to tex4ht that
> ignores the single 8 bit limitation of the input (dvi) format.

This is a misconception. Dvi format does actually allow multi-byte setchar commands. Most dvi processors pretend it does not simply because TeX90 never used those, but that is not a format limitation.
> 


Best wishes,
Taco

From luatex at nililand.de  Fri Jun 24 09:40:12 2011
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 24 Jun 2011 09:40:12 +0200
Subject: [luatex] dump a tfm to a file
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
 <h0k1gi80icam.dlg@nililand.de>
 <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>
 <BANLkTineSY_FZrK3VnmRCa9pHmZLV7rYWA@mail.gmail.com>
Message-ID: <ml4f7eqpwlr1.dlg@nililand.de>

Am Thu, 23 Jun 2011 16:56:47 -0500 schrieb Luis Rivera:

>> With context mkii (texlive 2009, pdftex engine: test.mkii is an utf-8 file)
>> %%% test.mkii

>> goo &#x20AC;??@cc

> From above I infer that the translation works only for the UTF8
> characters that fit in ISO-8859-1 (Latin 1):

No, tex4ht/mkii (which use 8-bit-pdftex) can handle a much larger
part of utf8 the same way as tex4ht/latex can do it: by using
various font encodings. 

tex4ht contains already a lot of support for various font encodings
so it is no wonder that a test with mkii gives something sensible.
 

> If Ulrike's only problem is the Euro character, 

No the euro is only a good test object as it is in ansinew encoding
but in unicode outside the  < 256 block. 

If you want to write a text with e.g. greek and english with
pdflatex you need at least two font encodings (T1 and LGR) and two
fonts. 

With luatex one encoding ("Unicode") and one large "unicode" font is
enough. 

I want to find out if tex4ht can handle large "unicode" htf-fonts
too. 


> If indeed tex4ht is a dvi driver, it should *not* work with UTF8 (or
> even BMP encoded ofm files), given the specification (single 8 bit
> integer) of the dvi format, regardless how you patch the tfm/htf
> files. She really needs, as Robin suggests, a successor to tex4ht that
> ignores the single 8 bit limitation of the input (dvi) format.

dvi doesn't care about the input encoding, it encodes character
positions in fonts. 

The dvi's generated by luatex (if I inspect them with dv2dt) look
actually quite similar to dvi's generated by latex. E.g. they
contain - if I use an unicode font and input an ? - the entry "s1
8364" (8364 = hex 20AC). "Normal" dvi have similar entries - only
the numbers are smaller. 

So tex4ht could work with luatex if
1. the tfm of the fonts loaded is not needed for something essentiel
(I hope only for ligatures) and that ine can use some simple
dummies.

2. tex4ht can handle large versions of its htf-fonts and don't
tumble over the large character numbers.

I don't have time this week-end to make more tests but I will look
again next week.



-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Fri Jun 24 09:58:27 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 24 Jun 2011 09:58:27 +0200
Subject: [luatex] dump a tfm to a file
In-Reply-To: <ml4f7eqpwlr1.dlg@nililand.de>
References: <4237.1308644716@cl.cam.ac.uk> <4E005624.2000400@elvenkind.com>
 <BANLkTikcMbm5Tkc5-aVK_gH78dx1ZPRfNg@mail.gmail.com>
 <15b67h71makxr$.dlg@nililand.de>
 <06A802EF-6FA7-4778-81D7-FEBEA5213813@elvenkind.com>
 <BANLkTimorM91Futmw9YRsiiwWw6u6J+WQw@mail.gmail.com>
 <h0k1gi80icam.dlg@nililand.de>
 <BANLkTimi32cT5DQGCT4LMEzizhoe3pvh9g@mail.gmail.com>
 <BANLkTineSY_FZrK3VnmRCa9pHmZLV7rYWA@mail.gmail.com>
 <ml4f7eqpwlr1.dlg@nililand.de>
Message-ID: <20110624075827.GA7521@khaled-laptop>

On Fri, Jun 24, 2011 at 09:40:12AM +0200, Ulrike Fischer wrote:
> The dvi's generated by luatex (if I inspect them with dv2dt) look
> actually quite similar to dvi's generated by latex. E.g. they
> contain - if I use an unicode font and input an ? - the entry "s1
> 8364" (8364 = hex 20AC). "Normal" dvi have similar entries - only
> the numbers are smaller. 

There is also the problem of unencoded glyphs (e.g. smallcaps or
oldstyle figures in most OpenType fonts), IIRC the dvi will contain the
internal PUA code points that luatex maps these glyphs to, I'm not sure
if it is easy/possible to do the reverse mapping outside luatex (and
even getting glyph indices is not enough as you need to map them back to
Unicode code points using some heuristics based on glyph names).

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From Arno.Trautmann at gmx.de  Sat Jun 25 21:20:39 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 25 Jun 2011 21:20:39 +0200
Subject: [luatex] inserting
Message-ID: <4E063507.2090709@gmx.de>

Hi all,

I'm becoming desparate and I guess it's only a small error I'm making. I
try to (please don't ask why ?) to colorize all letters in a document. I
do so by registering the following function in the post_linebreak_filter:

local color_push = node.new(WHAT,COL)
local color_pop = node.new(WHAT,COL)
color_push.cmd = 1
color_pop.cmd = 2

uppercasecolor = function (head)
  for line in node.traverse_id(HLIST,head) do
    for letter in node.traverse_id(GLYPH,line.head) do
        color_push.data = math.random().." .5 .5 rg"
        node.insert_before(line.head,letter,node.copy(color_push))
        node.insert_after(line.head,letter,node.copy(color_pop))
    end
  end
  return head
end

This works fine /except/ for the first letter of every line except the
first line. So the first line is fine, but for every following line in a
paragraph, the first letter is not colored. I also get warnings

LuaTeX warning: pop empty color page stack 0

so it seems that the color_push does not work in that cases? But I don't
see what I'm doing wrong ?
To understand what mistake I'm making, I tried to use

letter = node.first_glyph(line) [or line.head?]

instead of the for loop, but then letter doesn't seem to be a node at all.

I work with LuaLaTeX, luacode and luatexbase, and
This is LuaTeX, Version beta-0.70.1-2011061410 (rev 4277)

cheers
Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20110625/0abf359c/attachment.bin>

From khaledhosny at eglug.org  Sun Jun 26 07:01:18 2011
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 26 Jun 2011 07:01:18 +0200
Subject: [luatex] inserting
In-Reply-To: <4E063507.2090709@gmx.de>
References: <4E063507.2090709@gmx.de>
Message-ID: <20110626050118.GA3110@khaled-laptop>

On Sat, Jun 25, 2011 at 09:20:39PM +0200, Arno Trautmann wrote:
> Hi all,
> 
> I'm becoming desparate and I guess it's only a small error I'm making. I
> try to (please don't ask why ?) to colorize all letters in a document. I
> do so by registering the following function in the post_linebreak_filter:
> 
> local color_push = node.new(WHAT,COL)
> local color_pop = node.new(WHAT,COL)
> color_push.cmd = 1
> color_pop.cmd = 2
> 
> uppercasecolor = function (head)
>   for line in node.traverse_id(HLIST,head) do
>     for letter in node.traverse_id(GLYPH,line.head) do
>         color_push.data = math.random().." .5 .5 rg"
>         node.insert_before(line.head,letter,node.copy(color_push))
>         node.insert_after(line.head,letter,node.copy(color_pop))
>     end
>   end
>   return head
> end
> 
> This works fine /except/ for the first letter of every line except the
> first line. So the first line is fine, but for every following line in a
> paragraph, the first letter is not colored. I also get warnings

Try:
  head = node.insert_...

See the thread started by me few days ago.

Regards,
 Khaled

-- 
 Khaled Hosny
 Egyptian
 Arab

From zappathustra at free.fr  Sun Jun 26 07:53:59 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 26 Jun 2011 07:53:59 +0200
Subject: [luatex] inserting
In-Reply-To: <4E063507.2090709@gmx.de>
References: <4E063507.2090709@gmx.de>
Message-ID: <4E06C977.80008@free.fr>

Le 25/06/2011 21:20, Arno Trautmann a ?crit :
> Hi all,
>
> I'm becoming desparate and I guess it's only a small error I'm making. I
> try to (please don't ask why ?) to colorize all letters in a document. I
> do so by registering the following function in the post_linebreak_filter:
>
> local color_push = node.new(WHAT,COL)
> local color_pop = node.new(WHAT,COL)
> color_push.cmd = 1
> color_pop.cmd = 2
>
> uppercasecolor = function (head)
>    for line in node.traverse_id(HLIST,head) do
>      for letter in node.traverse_id(GLYPH,line.head) do
>          color_push.data = math.random().." .5 .5 rg"
>          node.insert_before(line.head,letter,node.copy(color_push))
>          node.insert_after(line.head,letter,node.copy(color_pop))
>      end
>    end
>    return head
> end
>
> This works fine /except/ for the first letter of every line except the
> first line. So the first line is fine, but for every following line in a
> paragraph, the first letter is not colored.

As already remarked by Khaled, you have to do:
line.head = node.insert_before...
The thing is the node is inserted, but the head field of the hlist still 
points to the old head, so the new head is ignored.

>   I also get warnings
>
> LuaTeX warning: pop empty color page stack 0
>
> so it seems that the color_push does not work in that cases?

It is simply ignored, so the color stack is still empty when the first 
pop occurs.

>   But I don't
> see what I'm doing wrong ?
> To understand what mistake I'm making, I tried to use
>
> letter = node.first_glyph(line) [or line.head?]
>
> instead of the for loop, but then letter doesn't seem to be a node at all.

That should be node.first_glyph(line.head) (otherwise you browse over 
the list of nodes of which the line is part, not the list of nodes which 
is the contents of the line). But anyway node.first_glyph only finds 
glyph nodes (id 37) with subtype 1 (real glyphs). It's not quite clear 
to me what's the difference between a glyph-character (subtype 0) and a 
glyph-glyph (subtype 1), but the function is concerned with the latter only.

Best,
Paul

From Arno.Trautmann at gmx.de  Sun Jun 26 12:44:58 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 26 Jun 2011 12:44:58 +0200
Subject: [luatex] inserting
In-Reply-To: <4E06C977.80008@free.fr>
References: <4E063507.2090709@gmx.de> <4E06C977.80008@free.fr>
Message-ID: <4E070DAA.9010109@gmx.de>

Paul Isambert wrote:
> Le 25/06/2011 21:20, Arno Trautmann a ?crit :
>> uppercasecolor = function (head)
>>    for line in node.traverse_id(HLIST,head) do
>>      for letter in node.traverse_id(GLYPH,line.head) do
>>          color_push.data = math.random().." .5 .5 rg"
>>          node.insert_before(line.head,letter,node.copy(color_push))
>>          node.insert_after(line.head,letter,node.copy(color_pop))
>>      end
>>    end
>>    return head
>> end
>>
>> This works fine /except/ for the first letter of every line except the
>> first line. So the first line is fine, but for every following line in a
>> paragraph, the first letter is not colored.
> 
> As already remarked by Khaled, you have to do:
> line.head = node.insert_before...
> The thing is the node is inserted, but the head field of the hlist still
> points to the old head, so the new head is ignored.

Ok, now I understand, and the code works, thanks! (just to clarify: it
worked for the first line, because there is another node before the
first glyph node, so my whatsit is not inserted as the first node of
that list?)

>>   I also get warnings
>>
>> LuaTeX warning: pop empty color page stack 0
>>
>> so it seems that the color_push does not work in that cases?
> 
> It is simply ignored, so the color stack is still empty when the first
> pop occurs.

Now that makes sense ?

>>   But I don't
>> see what I'm doing wrong ?
>> To understand what mistake I'm making, I tried to use
>>
>> letter = node.first_glyph(line) [or line.head?]
>>
>> instead of the for loop, but then letter doesn't seem to be a node at
>> all.
> 
> That should be node.first_glyph(line.head) (otherwise you browse over
> the list of nodes of which the line is part, not the list of nodes which
> is the contents of the line). But anyway node.first_glyph only finds
> glyph nodes (id 37) with subtype 1 (real glyphs). It's not quite clear
> to me what's the difference between a glyph-character (subtype 0) and a
> glyph-glyph (subtype 1), but the function is concerned with the latter
> only.

So that is ment by ?with a subtype indicating it is a
glyph?. Indeed, I thought what I had were glyphs, but appearently they
are not. Do you have a suggestion where I can find information about this?

Thanks for your help again (also to Khaled),

cheers
Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20110626/38cd8781/attachment.bin>

From zappathustra at free.fr  Sun Jun 26 12:51:16 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 26 Jun 2011 12:51:16 +0200
Subject: [luatex] inserting
In-Reply-To: <4E070DAA.9010109@gmx.de>
References: <4E063507.2090709@gmx.de> <4E06C977.80008@free.fr>
 <4E070DAA.9010109@gmx.de>
Message-ID: <4E070F24.8050005@free.fr>

Le 26/06/2011 12:44, Arno Trautmann a ?crit :
> just to clarify: it
> worked for the first line, because there is another node before the
> first glyph node, so my whatsit is not inserted as the first node of
> that list?

Yes. There's a whatsit and the identation box at the beginning of the 
first line.

>>>    But I don't
>>> see what I'm doing wrong ?
>>> To understand what mistake I'm making, I tried to use
>>>
>>> letter = node.first_glyph(line) [or line.head?]
>>>
>>> instead of the for loop, but then letter doesn't seem to be a node at
>>> all.
>> That should be node.first_glyph(line.head) (otherwise you browse over
>> the list of nodes of which the line is part, not the list of nodes which
>> is the contents of the line). But anyway node.first_glyph only finds
>> glyph nodes (id 37) with subtype 1 (real glyphs). It's not quite clear
>> to me what's the difference between a glyph-character (subtype 0) and a
>> glyph-glyph (subtype 1), but the function is concerned with the latter
>> only.
> So that is ment by ?with a subtype indicating it is a
> glyph?. Indeed, I thought what I had were glyphs, but appearently they
> are not. Do you have a suggestion where I can find information about this?

Apart from Taco's head, I know of no better place to get information 
than the manual or your own experiments.

Best,
Paul

From Arno.Trautmann at gmx.de  Sun Jun 26 13:26:31 2011
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 26 Jun 2011 13:26:31 +0200
Subject: [luatex] inserting
In-Reply-To: <4E070F24.8050005@free.fr>
References: <4E063507.2090709@gmx.de> <4E06C977.80008@free.fr>
 <4E070DAA.9010109@gmx.de> <4E070F24.8050005@free.fr>
Message-ID: <4E071767.2000508@gmx.de>

Paul Isambert wrote:
> Le 26/06/2011 12:44, Arno Trautmann a ?crit :
>> So that is ment by ?with a subtype indicating it is a
>> glyph?. Indeed, I thought what I had were glyphs, but appearently they
>> are not. Do you have a suggestion where I can find information about
>> this?
> 
> Apart from Taco's head, I know of no better place to get information
> than the manual or your own experiments.

Well, there's a blog, and soon also a book by Patrick Gundlach ? but
only in german ?

cheers
Arno

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20110626/adf60692/attachment.bin>

From till.heilmann at unibas.ch  Sun Jun 26 21:31:24 2011
From: till.heilmann at unibas.ch (Heilmann, Till A.)
Date: Sun, 26 Jun 2011 21:31:24 +0200
Subject: [luatex] Kerning (again) and biblatex
Message-ID: <22DB289B-E869-4A92-B8BA-3BD9044782C4@unibas.ch>

Sorry to bother you again with kerning problems. This time it is  
about citations generated by biblatex. I know that this is not  
exclusively a LuaTeX issue but I think the experts are on this list,  
so here I go anyway: Custom kerns are not inserted at some places  
within citations generated by biblatex (see--quite lengthy--minimal  
example below). It might have to do with mechanisms already discussed  
earlier here, i.e. penalties or glues preventing kerning.

In this particular case, I tracked the problem down to biblatex's  
\printfield and \printtext commands (see the \renewbibmacro*{journal 
+issuetitle+standard} command in the example): Avoiding the  
\printtext command for the output of the date field in articles, for  
example, solves the problem. But I cannot really avoid using these  
commands, of course, and my knowledge of TeX is not sufficient for a  
further analysis of \printfield and \printtext. I asked Philipp  
Lehman about this some time ago but he has not replied so far. Maybe  
someone on this list has an idea.

Thanks and best regards,
Till

\begin{filecontents*}{test.bib}
@article{stiegler.b:2009,
   Author = {Bernard Stiegler},
   Journal = {Theory, Culture~\& Society},
   Number = {2?3},
   Pages = {33-45},
   Title = {Teleologics of the Snail},
   Volume = {26},
   Year = {2009}}
\end{filecontents*}
\begin{filecontents*}{test.fea}
languagesystem DFLT dflt ;
languagesystem latn dflt ;
feature kern {
   pos six slash 500 ;
   pos slash two 500 ;
   pos parenleft two 500 ;
   pos nine parenright 500 ;
} kern ;
\end{filecontents*}
\documentclass{article}
\usepackage{fontspec}
\setmainfont[FeatureFile=test.fea]{TeX Gyre Bonum}
\usepackage[style=authortitle-dw]{biblatex}
\bibliography{test}
\renewcommand*{\jourvolnumsep}{\addslash}
\renewbibmacro*{journal+issuetitle+standard}{%
   \iffieldundef{volume}
     {\iffieldundef{number}
       {}
       {\blxdw at warning{%
         Field 'number' set, but 'volume' is empty
         \MessageBreak at entry '\abx at field@entrykey'.
         The output might not \MessageBreak be correct}}}
     {\setunit{\jourvolnumsep}%
      \printfield{number}}%
   \setunit{\addcomma\space}%
   \printfield{eid}%
   \setunit{\addspace}%
   \iffieldundef{volume}
     {\iffieldundef{month}
       {}
       {\setunit{\addcomma\space}}%
      \usebibmacro{issue+date}}
     {\printtext[parens]{\usebibmacro{issue+date}}}%
%    { (\usebibmacro{issue+date})}% <-- change previous line to this !
   \newunit\newblock
   \usebibmacro{issue}%
   \newunit
   \usebibmacro{byeditor+others}%
   \newunit}
\begin{document}
\fullcite{stiegler.b:2009}\\
26/2?3 (2009)
\end{document}



From jorssen.leraincy at free.fr  Tue Jun 28 10:29:22 2011
From: jorssen.leraincy at free.fr (Christophe Jorssen)
Date: Tue, 28 Jun 2011 10:29:22 +0200
Subject: [luatex] [A bit out of topic] Extend the arithmetic expressions
 parser from lpeg example
Message-ID: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>

Hello all,

I posted the following question to the lua list a week ago but got no
answer. So I try here... For sure, it is a bit out of topic (well, it
is remotely connected with some work on a lua way to perform math in
pgf) but I know there must be some lpeg (context?) wizards here who
could probably help me on this matter. Thanks in advance. Best
regards.

-- Begin forwarded mail
Hello all,

I'm trying to add basic functions parsing to the parser proposed in
the lpeg webpage [1].

Here is the code I adapted.

---------------
require("lpeg")
-- Lexical Elements
local Space = lpeg.S(" \n\t")^0
local Number = lpeg.C(lpeg.P"-"^-1 * lpeg.R("09")^1) * Space
local FactorOp = lpeg.C(lpeg.S("+-")) * Space
local TermOp = lpeg.C(lpeg.S("*/")) * Space
local Open = "(" * Space
local Close = ")" * Space

local lower_letter = lpeg.R("az")
local upper_letter = lpeg.R("AZ")
local letter = lower_letter + upper_letter
local alphanum = letter + digit
local alphanum_ = alphanum + lpeg.S("_")
local alpha_ = letter + lpeg.S("_")
local func_pattern = alpha_ * alphanum_^0
local func = C(func_pattern) * Space
local param_beg = P("(") * Space
local param_end = P(")") * Space


-- Auxiliary function
function eval (v1, op, v2)
 if (op == "+") then return v1 + v2
 elseif (op == "-") then return v1 - v2
 elseif (op == "*") then return v1 * v2
 elseif (op == "/") then return v1 / v2
 end
end

function_table = {
  ["abs"] = function (x) return math.abs(x) end,
}

function evalfunc(f,x)
  return function_table[f](x)
end

-- Grammar
local V = lpeg.V
G = lpeg.P{ "Exp",
 Exp = lpeg.Cf(V"Factor" * lpeg.Cg(FactorOp * V"Factor")^0, eval);
 Factor = lpeg.Cf(V"Term" * lpeg.Cg(TermOp * V"Term")^0, eval);
 func_E = lpeg.Cf(Cg(func) * param_beg * lpeg.Cg(V("Exp")) *
           lpeg.Cg(comma * V("Exp"))^0 * param_end,evalfunc),
 Term = Number / tonumber + Open * V"Exp" * Close + func_E;
}

-- small example
print(lpeg.match(G, "3 + 5*9 / (1+1) - abs(12-1)"))
--------------------

But, it does not work. I got this error

bad argument #2 to '?' (pattern expected, got nil)

In addition, I'm afraid I don't really understand the Cg capture
function. What would be, for instance, the structure captured by Cg
inside Exp for the above example.

Thanks in advance.

Best regards.

[1] http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html (at the very end)

--
Christophe

From taco at elvenkind.com  Tue Jun 28 10:45:18 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 28 Jun 2011 10:45:18 +0200
Subject: [luatex] [A bit out of topic] Extend the arithmetic expressions
 parser from lpeg example
In-Reply-To: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
References: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
Message-ID: <4E09949E.1060000@elvenkind.com>

On 06/28/2011 10:29 AM, Christophe Jorssen wrote:
> Hello all,
>
> I posted the following question to the lua list a week ago but got no
> answer. So I try here... For sure, it is a bit out of topic (well, it
> is remotely connected with some work on a lua way to perform math in
> pgf) but I know there must be some lpeg (context?) wizards here who
> could probably help me on this matter. Thanks in advance. Best
> regards.

There were a bunch of small errors in your lua code, see attachment.

Best wishes,
Taco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: exprcalc.lua
Type: text/x-lua
Size: 1498 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20110628/33634df2/attachment.bin>

From patrick at gundla.ch  Tue Jun 28 11:58:02 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 11:58:02 +0200
Subject: [luatex] pdfoutline in lua
Message-ID: <442AE319-808B-4B59-988D-F5653E6913B3@gundla.ch>

Hi,

can I do the same as \pdfoutline in Lua? That is: create PDF bookmarks in Lua?

Patrick




From patrick at gundla.ch  Tue Jun 28 14:07:04 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 14:07:04 +0200
Subject: [luatex] shipout a page
Message-ID: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>

Hi,

I use node.write(...) to push nodes to the current page. Now: how do I ship out these boxes and go to the next page (with Lua, of course :-))
I thinks tex.shipout() is the right function, but which box do I need to ship out?

Patrick




From luigi.scarso at gmail.com  Tue Jun 28 14:08:14 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 14:08:14 +0200
Subject: [luatex] shipout a page
In-Reply-To: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
Message-ID: <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>

On Tue, Jun 28, 2011 at 2:07 PM, Patrick Gundlach <patrick at gundla.ch> wrote:

> Hi,
>
> I use node.write(...) to push nodes to the current page. Now: how do I ship
> out these boxes and go to the next page (with Lua, of course :-))
> I thinks tex.shipout() is the right function, but which box do I need to
> ship out?
>
> \box255  ?

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/ef926c1f/attachment.html>

From st_philipp at yahoo.de  Tue Jun 28 14:19:07 2011
From: st_philipp at yahoo.de (Philipp Stephani)
Date: Tue, 28 Jun 2011 14:19:07 +0200
Subject: [luatex] shipout a page
In-Reply-To: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
Message-ID: <4E09C6BB.60002@yahoo.de>

Am 28.06.2011 14:07, schrieb Patrick Gundlach:
> which box do I need to ship out?

\outputbox?

From patrick at gundla.ch  Tue Jun 28 14:20:21 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 14:20:21 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
Message-ID: <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>

Hi all,

> I use node.write(...) to push nodes to the current page. Now: how do I ship out these boxes and go to the next page (with Lua, of course :-))
> I thinks tex.shipout() is the right function, but which box do I need to ship out?
> 
> \box255  ?

No:

foo.tex:
----------------------
\directlua{dofile("mknodes.lua")}

\bye
----------------------


mknodes.lua:
----------------------
local tenpt = 10 * 2^16

local r = node.new("rule")
r.width = tenpt
r.height = tenpt
r.depth = tenpt

local v = node.vpack(r)
node.write(v)

tex.shipout(255)
----------------------
Assertion failed: (0), function ship_out, file ../../../source/texk/web2c/luatexdir/pdf/pdfshipout.w, line 281.
 [1Abort trap



Patrick



From luigi.scarso at gmail.com  Tue Jun 28 15:04:03 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 15:04:03 +0200
Subject: [luatex] shipout a page
In-Reply-To: <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
Message-ID: <BANLkTim9hkFVUoA9fcYvYcfMm+95yaPCbQ@mail.gmail.com>

On Tue, Jun 28, 2011 at 2:20 PM, Patrick Gundlach <patrick at gundla.ch> wrote:

> Hi all,
>
> > I use node.write(...) to push nodes to the current page. Now: how do I
> ship out these boxes and go to the next page (with Lua, of course :-))
> > I thinks tex.shipout() is the right function, but which box do I need to
> ship out?
> >
> > \box255  ?
>
> No:
>
> foo.tex:
> ----------------------
> \directlua{dofile("mknodes.lua")}
>
> \bye
> ----------------------
>
>
> mknodes.lua:
> ----------------------
> local tenpt = 10 * 2^16
>
> local r = node.new("rule")
> r.width = tenpt
> r.height = tenpt
> r.depth = tenpt
>
> local v = node.vpack(r)
> node.write(v)
>
> tex.shipout(255)
> ----------------------
> Assertion failed: (0), function ship_out, file
> ../../../source/texk/web2c/luatexdir/pdf/pdfshipout.w, line 281.
>  [1Abort trap
>
>
>
> Patrick
>
>
> With
\tracingall
--\directlua{dofile("mknodes.lua")}
\bye

we can see the otr:

\output->{\plainoutput }

\plainoutput ->\shipout \vbox {\makeheadline \pagebody \makefootline
}\advancep
ageno \ifnum \outputpenalty >-\@MM \else \dosupereject \fi
{internal vertical mode: \shipout}

Does it help ?
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/94147a66/attachment.html>

From zappathustra at free.fr  Tue Jun 28 15:26:32 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 28 Jun 2011 15:26:32 +0200
Subject: [luatex] shipout a page
In-Reply-To: <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
Message-ID: <4E09D688.9030509@free.fr>



Le 28/06/2011 14:20, Patrick Gundlach a ?crit :
>
> tex.shipout(255)

That should be:
tex.shipout(tex.box[255])

Best,
Paul

From luigi.scarso at gmail.com  Tue Jun 28 15:30:08 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 15:30:08 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E09D688.9030509@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <4E09D688.9030509@free.fr>
Message-ID: <BANLkTimKvrjYuJ=85DKQG9d=irL_twF22g@mail.gmail.com>

On Tue, Jun 28, 2011 at 3:26 PM, Paul Isambert <zappathustra at free.fr> wrote:

>
>
> Le 28/06/2011 14:20, Patrick Gundlach a ?crit :
>
>>
>> tex.shipout(255)
>>
>
> That should be:
> tex.shipout(tex.box[255])
>
> Best,
> Paul
>
right --- me stupid.
I have 2 pages and this warning:
!
! Attribute 0 is reserved for ConTeXt's font feature management and has to
be
! set to zero. Also, some attributes in the range 1-255 are used for special
! purposes so setting them at the TeX end might break the font handler.
!
!
! I am using the merged version of 'luatex-fonts.lua' here. If
! you run into problems or experience unexpected behaviour, and
! if you have ConTeXt installed you can try to delete the file
! 'luatex-font-merged.lua' as I might then use the possibly
! updated libraries. The merged version is not supported as it
! is a frozen instance. Problems can be reported to the ConTeXt
! mailing list.
! <luatex-fonts.lua loaded in 0.072 seconds> <pop namespace>)



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/13fa35af/attachment.html>

From patrick at gundla.ch  Tue Jun 28 16:03:29 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 16:03:29 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E09D688.9030509@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
Message-ID: <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>

Hi Paul,

>> 
>> tex.shipout(255)
> 
> That should be:
> tex.shipout(tex.box[255])

That is in conflict with the manual (which states that tex.shipout's argument is a number) as well does not give the desired result. (There should be a 10pt by 20pt box on the first page.

Patrick




From patrick at gundla.ch  Tue Jun 28 16:04:52 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 16:04:52 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTim9hkFVUoA9fcYvYcfMm+95yaPCbQ@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <BANLkTim9hkFVUoA9fcYvYcfMm+95yaPCbQ@mail.gmail.com>
Message-ID: <1DF8BA3E-D4AC-4E3E-B6EA-BFB783BF74E3@gundla.ch>

> With 
> \tracingall
> --\directlua{dofile("mknodes.lua")}
> \bye
> 
> we can see the otr:
> 
> \output->{\plainoutput }
> 
> \plainoutput ->\shipout \vbox {\makeheadline \pagebody \makefootline }\advancep
> ageno \ifnum \outputpenalty >-\@MM \else \dosupereject \fi 
> {internal vertical mode: \shipout}
> 
> Does it help ?

I have no idea how this should help me with the problem.

Patrick



From luigi.scarso at gmail.com  Tue Jun 28 16:19:31 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 16:19:31 +0200
Subject: [luatex] shipout a page
In-Reply-To: <1DF8BA3E-D4AC-4E3E-B6EA-BFB783BF74E3@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <BANLkTim9hkFVUoA9fcYvYcfMm+95yaPCbQ@mail.gmail.com>
 <1DF8BA3E-D4AC-4E3E-B6EA-BFB783BF74E3@gundla.ch>
Message-ID: <BANLkTikoPbOnZndhU6E7WDuQzte4cx7e_w@mail.gmail.com>

On Tue, Jun 28, 2011 at 4:04 PM, Patrick Gundlach <patrick at gundla.ch> wrote:

> > With
> > \tracingall
> > --\directlua{dofile("mknodes.lua")}
> > \bye
> >
> > we can see the otr:
> >
> > \output->{\plainoutput }
> >
> > \plainoutput ->\shipout \vbox {\makeheadline \pagebody \makefootline
> }\advancep
> > ageno \ifnum \outputpenalty >-\@MM \else \dosupereject \fi
> > {internal vertical mode: \shipout}
> >
> > Does it help ?
>
> I have no idea how this should help me with the problem.
>
> just to be sure that it's box255
Following \pagebody
in tex/texmf/tex/plain/base/plain.tex
one can see
\def\pagecontents{\ifvoid\topins\else\unvbox\topins\fi
  \dimen@=\dp\@cclv \unvbox\@cclv % open up \box255

..also an idea on how to implement your otr in pure lua...

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/5e170fa0/attachment.html>

From zappathustra at free.fr  Tue Jun 28 16:34:15 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 28 Jun 2011 16:34:15 +0200
Subject: [luatex] shipout a page
In-Reply-To: <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
Message-ID: <4E09E667.5070500@free.fr>



Le 28/06/2011 16:03, Patrick Gundlach a ?crit :
> Hi Paul,
>
>>> tex.shipout(255)
>> That should be:
>> tex.shipout(tex.box[255])
> That is in conflict with the manual (which states that tex.shipout's argument is a number)

Indeed, there's an error in the manual.

>   as well does not give the desired result. (There should be a 10pt by 20pt box on the first page.

If I'm not mistaken, when tex.shipout() occurs, the node appended to the 
main vertical list hasn't been moved to box 255 yet. I can't remember 
exactly the places when TeX does move material to the output box, but I 
think you should consider them.

Best,
Paul

From zappathustra at free.fr  Tue Jun 28 16:44:57 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 28 Jun 2011 16:44:57 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E09E667.5070500@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
Message-ID: <4E09E8E9.1040306@free.fr>

Le 28/06/2011 16:34, Paul Isambert a ?crit :
>
>
> Le 28/06/2011 16:03, Patrick Gundlach a ?crit :
>> Hi Paul,
>>
>>>> tex.shipout(255)
>>> That should be:
>>> tex.shipout(tex.box[255])
>> That is in conflict with the manual (which states that tex.shipout's 
>> argument is a number)
>
> Indeed, there's an error in the manual.
>
>>   as well does not give the desired result. (There should be a 10pt 
>> by 20pt box on the first page.
>
> If I'm not mistaken, when tex.shipout() occurs, the node appended to 
> the main vertical list hasn't been moved to box 255 yet. I can't 
> remember exactly the places when TeX does move material to the output 
> box, but I think you should consider them.

Sorry, what I've said is completely wrong. tex.shipout() does take a 
number as its argument. But material is added to box 255 only when TeX 
is calling \output. So tex.shipout() outside an output routine is very 
likely to shipout an empty box. I /think/ I got it right this time :)

Best,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/1c6d771a/attachment.html>

From patrick at gundla.ch  Tue Jun 28 17:10:44 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 17:10:44 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E09E8E9.1040306@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr>
Message-ID: <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>


Am 28.06.2011 um 16:44 schrieb Paul Isambert:

> Le 28/06/2011 16:34, Paul Isambert a ?crit :
>> 
>> 
>> Le 28/06/2011 16:03, Patrick Gundlach a ?crit : 
>>> Hi Paul, 
>>> 
>>>>> tex.shipout(255) 
>>>> That should be: 
>>>> tex.shipout(tex.box[255]) 
>>> That is in conflict with the manual (which states that tex.shipout's argument is a number) 
>> 
>> Indeed, there's an error in the manual. 
>> 
>>>   as well does not give the desired result. (There should be a 10pt by 20pt box on the first page. 
>> 
>> If I'm not mistaken, when tex.shipout() occurs, the node appended to the main vertical list hasn't been moved to box 255 yet. I can't remember exactly the places when TeX does move material to the output box, but I think you should consider them. 
> 
> Sorry, what I've said is completely wrong. tex.shipout() does take a number as its argument. But material is added to box 255 only when TeX is calling \output. So tex.shipout() outside an output routine is very likely to shipout an empty box. I think I got it right this time :)


Which leads to my beginning question: 

 how do I ship out these boxes and go to the next page (with Lua, of course :-))

I want to avoid \TeX as much as possible. I wonder what the "current list" is, that is written in the manual for node.write().

Thanks Paul

Patrick



From zappathustra at free.fr  Tue Jun 28 17:17:53 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 28 Jun 2011 17:17:53 +0200
Subject: [luatex] shipout a page
In-Reply-To: <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
Message-ID: <4E09F0A1.1040907@free.fr>

Le 28/06/2011 17:10, Patrick Gundlach a ?crit :
> Am 28.06.2011 um 16:44 schrieb Paul Isambert:
>
>> Le 28/06/2011 16:34, Paul Isambert a ?crit :
>>>
>>> Le 28/06/2011 16:03, Patrick Gundlach a ?crit :
>>>> Hi Paul,
>>>>
>>>>>> tex.shipout(255)
>>>>> That should be:
>>>>> tex.shipout(tex.box[255])
>>>> That is in conflict with the manual (which states that tex.shipout's argument is a number)
>>> Indeed, there's an error in the manual.
>>>
>>>>    as well does not give the desired result. (There should be a 10pt by 20pt box on the first page.
>>> If I'm not mistaken, when tex.shipout() occurs, the node appended to the main vertical list hasn't been moved to box 255 yet. I can't remember exactly the places when TeX does move material to the output box, but I think you should consider them.
>> Sorry, what I've said is completely wrong. tex.shipout() does take a number as its argument. But material is added to box 255 only when TeX is calling \output. So tex.shipout() outside an output routine is very likely to shipout an empty box. I think I got it right this time :)
>
> Which leads to my beginning question:
>
>   how do I ship out these boxes and go to the next page (with Lua, of course :-))
>
> I want to avoid \TeX as much as possible. I wonder what the "current list" is, that is written in the manual for node.write().

If I'm not mistaken (again!), the current list is... the current list. 
I.e. the main vertical list in case you aren't in a \hbox or \vbox, and 
those ones otherwise. Now, you're adding nodes to the MVL, which will 
make it to box 255 at output time only, except perhaps if you put it 
there yourself with the "special list heads" (page_head, I suppose), but 
I don't know much there. Otherwise, don't add those nodes to the MVL, 
but to a made-up box, which you then ship out. Hope it'll answer your 
question :)

Best,
Paul

From patrick at gundla.ch  Tue Jun 28 17:32:29 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 17:32:29 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E09F0A1.1040907@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr>
Message-ID: <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>



> Otherwise, don't add those nodes to the MVL, but to a made-up box, which you then ship out. 

I am thinking about this right now. I use node.write only twice, so that is not much to do.

I'll report back after my experiments.

But I am still interested in a solution without an intermediate box.

Patrick



From luigi.scarso at gmail.com  Tue Jun 28 17:42:35 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 17:42:35 +0200
Subject: [luatex] shipout a page
In-Reply-To: <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
 <4E09E667.5070500@free.fr> <4E09E8E9.1040306@free.fr>
 <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr>
 <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
Message-ID: <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>

On Tue, Jun 28, 2011 at 5:32 PM, Patrick Gundlach <patrick at gundla.ch> wrote:

>
>
> > Otherwise, don't add those nodes to the MVL, but to a made-up box, which
> you then ship out.
>
> I am thinking about this right now. I use node.write only twice, so that is
> not much to do.
>
> I'll report back after my experiments.
>
> But I am still interested in a solution without an intermediate box.
>
> Patrick
>
>
>
\shipout writes a box.
Hence or you shipout your box, or you add the material into the MVL and pass
the control to luatex
that will shipout it with the current otr (\plainoutput in my case, luatex
from minimals)


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/93823740/attachment.html>

From luigi.scarso at gmail.com  Tue Jun 28 17:56:20 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 17:56:20 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
 <4E09E667.5070500@free.fr> <4E09E8E9.1040306@free.fr>
 <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr>
 <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
Message-ID: <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>

On Tue, Jun 28, 2011 at 5:42 PM, luigi scarso <luigi.scarso at gmail.com>wrote:

>
>
> On Tue, Jun 28, 2011 at 5:32 PM, Patrick Gundlach <patrick at gundla.ch>wrote:
>
>>
>>
>> > Otherwise, don't add those nodes to the MVL, but to a made-up box, which
>> you then ship out.
>>
>> I am thinking about this right now. I use node.write only twice, so that
>> is not much to do.
>>
>> I'll report back after my experiments.
>>
>> But I am still interested in a solution without an intermediate box.
>>
>> Patrick
>>
>>
>>
> \shipout writes a box.
> Hence or you shipout your box, or you add the material into the MVL and
> pass the control to luatex
> that will shipout it with the current otr (\plainoutput in my case, luatex
> from minimals)
>
>
> --
> luigi
>
>
I mean

%% Box solution
\tracingall
\directlua{dofile("mknodes.lua")}
\directlua{dofile("mknodes.lua")}
\bye

-- mknodes.lua
local tenpt = 10 * 2^16

local r = node.new("rule")
r.width = tenpt
r.height = tenpt
r.depth = tenpt

local v = node.vpack(r)
tex.setbox(8192, v)
tex.shipout(8192)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% MVL solution
\tracingall
\directlua{dofile("mknodes.lua")}
\bye

-- mknodes.lua
local tenpt = 10 * 2^16

local r = node.new("rule")
r.width = tenpt
r.height = tenpt
r.depth = tenpt

local v = node.vpack(r)
node.write(v)





-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/10e9f970/attachment-0001.html>

From patrick at gundla.ch  Tue Jun 28 18:49:24 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 18:49:24 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
Message-ID: <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>


The box solution works fine, but

> 
> %%% MVL solution
> \tracingall
> \directlua{dofile("mknodes.lua")}
> \bye
> 
> -- mknodes.lua
> local tenpt = 10 * 2^16
> 
> local r = node.new("rule")
> r.width = tenpt
> r.height = tenpt
> r.depth = tenpt
> 
> local v = node.vpack(r)
> node.write(v)


this one does not work.

See the reply to Paul: I am still interested in a solution without an intermediate box.


Thanks

Patrick




From luigi.scarso at gmail.com  Tue Jun 28 19:24:01 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 Jun 2011 19:24:01 +0200
Subject: [luatex] shipout a page
In-Reply-To: <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
 <4E09E667.5070500@free.fr> <4E09E8E9.1040306@free.fr>
 <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr>
 <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
Message-ID: <BANLkTin-A=+9ZwvfC_2Y9d-=qf4OTM4BHQ@mail.gmail.com>

On Tue, Jun 28, 2011 at 6:49 PM, Patrick Gundlach <patrick at gundla.ch> wrote:

>
> The box solution works fine, but
>
> >
> > %%% MVL solution
> > \tracingall
> > \directlua{dofile("mknodes.lua")}
> > \bye
> >
> > -- mknodes.lua
> > local tenpt = 10 * 2^16
> >
> > local r = node.new("rule")
> > r.width = tenpt
> > r.height = tenpt
> > r.depth = tenpt
> >
> > local v = node.vpack(r)
> > node.write(v)
>
>
> this one does not work.
>
> Where is the problem ?
No error with luatex from minimals and luatex-plain as format, and the pdf
is also ok.
Isn't the rule 10 pt ?

vbox(667.20255+0.0)x469.75499, direction TLT
.\vbox(0.0+0.0)x469.75499, glue set 14.0fil, direction TLT
..\glue -22.5
..\hbox(8.5+0.0)x469.75499, glue set 469.755fil, direction TLT
...\vbox(8.5+0.0)x0.0, direction TLT
...\glue 0.0 plus 1.0fil
..\glue 0.0 plus 1.0fil minus 1.0fil
.\vbox(643.20255+0.0)x10.0, glue set 623.20251fill, direction TLT
..\glue(\topskip) 0.0
..\vbox(10.0+10.0)x10.0, direction TLT
...\rule(10.0+10.0)x10.0
..\glue 0.0 plus 1.0fill
.\glue(\baselineskip) 17.55556
.\hbox(6.44444+0.0)x469.75499, glue set 232.37749fil, direction TLT
..\glue 0.0 plus 1.0fil minus 1.0fil
..\tenrm 1
..\glue 0.0 plus 1.0fil minus 1.0fil





See the reply to Paul: I am still interested in a solution without an
> intermediate box.
>
My examples follow  Paul's indications:  build a box and shipout, or put
material into the MVL
and let  the current otr   shipout the material, as one can see from the
page size (and the pagenumber at the bottom)

Creator:        TeX
Producer:       LuaTeX-0.70.1
CreationDate:   Tue Jun 28 19:10:41 2011
ModDate:        Tue Jun 28 19:10:41 2011
Tagged:         no
Pages:          1
Encrypted:      no
Page size:      612 x 808.71 pts
File size:      17460 bytes
Optimized:      no
PDF version:    1.4



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110628/3ca5753f/attachment.html>

From patrick at gundla.ch  Tue Jun 28 19:42:37 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Jun 2011 19:42:37 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTin-A=+9ZwvfC_2Y9d-=qf4OTM4BHQ@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
 <BANLkTin-A=+9ZwvfC_2Y9d-=qf4OTM4BHQ@mail.gmail.com>
Message-ID: <A212B9B9-B348-4393-81AC-CC5B7616744B@gundla.ch>


Am 28.06.2011 um 19:24 schrieb luigi scarso:

> 
> 
> On Tue, Jun 28, 2011 at 6:49 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> 
> The box solution works fine, but
> 
> >
> > %%% MVL solution
> > \tracingall
> > \directlua{dofile("mknodes.lua")}
> > \bye
> >
> > -- mknodes.lua
> > local tenpt = 10 * 2^16
> >
> > local r = node.new("rule")
> > r.width = tenpt
> > r.height = tenpt
> > r.depth = tenpt
> >
> > local v = node.vpack(r)
> > node.write(v)
> 
> 
> this one does not work.
> 
> Where is the problem ?

No shipout possible with tex.shipout(). And that was my question. But perhaps I have misunderstood you.

Patrick



From taco at elvenkind.com  Tue Jun 28 19:45:55 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 28 Jun 2011 19:45:55 +0200
Subject: [luatex] shipout a page
In-Reply-To: <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
Message-ID: <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>





On 28 jun. 2011, at 18:49, Patrick Gundlach <patrick at gundla.ch> wrote:
> See the reply to Paul: I am still interested in a solution without an intermediate box.
> 
> 

The only way to get stuff to the pdf is via a box register (unless you count creating the low-level pdf code for the page stream yourself via pdf literals, but I assume that is not what you had in mind). That's just how it is. If you want to hide this effect, write a two-line function based on Luigi's code.

Best wishes,
Taco




From adityam at umich.edu  Tue Jun 28 20:26:20 2011
From: adityam at umich.edu (Aditya Mahajan)
Date: Tue, 28 Jun 2011 14:26:20 -0400
Subject: [luatex] [A bit out of topic] Extend the arithmetic expressions
 parser from lpeg example
In-Reply-To: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
References: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
Message-ID: <alpine.LNX.2.01.1106281424020.1248@ybpnyubfg.ybpnyqbznva>

On Tue, 28 Jun 2011, Christophe Jorssen wrote:

> Hello all,
>
> I posted the following question to the lua list a week ago but got no
> answer. So I try here... For sure, it is a bit out of topic (well, it
> is remotely connected with some work on a lua way to perform math in
> pgf) but I know there must be some lpeg (context?) wizards here who
> could probably help me on this matter. Thanks in advance. Best
> regards.

You can also look at x-calcmath.(mkiv|lua) in ConTeXt distribution. That 
code is for converting "calculator math" to TeX rather than evaluating it, 
but it can give hints about parsing.

Aditya


From jorssen.leraincy at free.fr  Tue Jun 28 20:47:20 2011
From: jorssen.leraincy at free.fr (Christophe Jorssen)
Date: Tue, 28 Jun 2011 20:47:20 +0200
Subject: [luatex] [A bit out of topic] Extend the arithmetic expressions
 parser from lpeg example
In-Reply-To: <4E09949E.1060000@elvenkind.com>
References: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
 <4E09949E.1060000@elvenkind.com>
Message-ID: <BANLkTikOzqqMSvaombL0anizduiQ2NO7EQ@mail.gmail.com>

2011/6/28 Taco Hoekwater <taco at elvenkind.com>:
>
> There were a bunch of small errors in your lua code, see attachment.
>

You're right. Lots of small errors (I set the complete minimal non
working exemple too quickly...). Thanks a lot for the corrected file
:-)

Best regards

-- 
Christophe

From jorssen.leraincy at free.fr  Tue Jun 28 20:49:04 2011
From: jorssen.leraincy at free.fr (Christophe Jorssen)
Date: Tue, 28 Jun 2011 20:49:04 +0200
Subject: [luatex] [A bit out of topic] Extend the arithmetic expressions
 parser from lpeg example
In-Reply-To: <alpine.LNX.2.01.1106281424020.1248@ybpnyubfg.ybpnyqbznva>
References: <BANLkTimRPipxZ+PoymSO+4PVgSL2eYTWHg@mail.gmail.com>
 <alpine.LNX.2.01.1106281424020.1248@ybpnyubfg.ybpnyqbznva>
Message-ID: <BANLkTi=8f-Sz7DUOTKeSibSx7+50KvWn=A@mail.gmail.com>

2011/6/28 Aditya Mahajan <adityam at umich.edu>:
> On Tue, 28 Jun 2011, Christophe Jorssen wrote:
>
> You can also look at x-calcmath.(mkiv|lua) in ConTeXt distribution. That
> code is for converting "calculator math" to TeX rather than evaluating it,
> but it can give hints about parsing.
>

Thanks for the hint. It happens it had been my starting point for lpeg
grammar even before I had a look at Roberto's examples!

Best regards

-- 
Christophe

From adam.reviczky at kcl.ac.uk  Tue Jun 28 21:38:59 2011
From: adam.reviczky at kcl.ac.uk (Reviczky, Adam)
Date: Tue, 28 Jun 2011 20:38:59 +0100
Subject: [luatex] compiling on MINIX3
Message-ID: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F01@KCL-MAIL05.kclad.ds.kcl.ac.uk>

Hi,

I'm trying to compile luatex beta0.70.1 on my MINIX 3.2.0.

gmake and gcc is installed:
---
GNU Make 3.82
Built for i386-pc-minix
---
gcc (GCC) 4.4.3
---

By running build.sh, I get:
---
You have a GNU-make installed as gmake; I will use that
...
---

However, the configure stage fails with:
---
checking for TeXk programs to build... 
configure: creating ./config.status
config.status: creating Makefile
config.status: executing depfiles commands
configure: error: Building TeX Live requires GNU make
---

The same happened a while ago on FreeBSD, see:
http://www.ntg.nl/pipermail/dev-luatex/2010-March/003473.html

I believe it is the same problem, and setting TL_MAKE or MAKE doesn't help either.

The ${MAKE-make} variable in the configure file returns "make" in my case, where it should be gmake.
The line in question is: "if test -z "`${MAKE-make} -v 2>/dev/null | grep GNU`"; then".

Changing that line to use gmake directly ("if test -z "`gmake -v 2>/dev/null | grep GNU`"; then") gets past the configure stage, but the compilation fails with:
---
gcc -DHAVE_CONFIG_H -I. -I../../../source/libs/zziplib -Iinclude -I../../../source/libs/zziplib/zziplib-0.13.60 -I/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zlib/include -D_USE_MMAP  -Wall -Wunused -Wimplicit -Wreturn-type -Wdeclaration-after-statement -Wno-unknown-pragmas -Wmissing-prototypes -Wmissing-declarations -g -O2 -MT stat.o -MD -MP -MF .deps/stat.Tpo -c -o stat.o `test -f 'zziplib-0.13.60/zzip/stat.c' || echo '../../../source/libs/zziplib/'`zziplib-0.13.60/zzip/stat.c
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c: In function 'zzip_dir_stat':
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: 'strcasecmp' undeclared (first use in this function)
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: (Each undeclared identifier is reported only once
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: for each function it appears in.)
gmake[3]: *** [stat.o] Error 1
gmake[3]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake[2]: *** [all-recursive] Error 1
gmake[2]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake[1]: *** [all] Error 2
gmake[1]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake: *** [../../libs/zziplib/libzzip.a] Error 2
strip: 'build/texk/web2c/luatex': No such file
ls: build/texk/web2c/luatex: No such file or directory
---

I'm attaching the full log.

Adam
-------------- next part --------------
A non-text attachment was scrubbed...
Name: out.log.gz
Type: application/x-gzip
Size: 17322 bytes
Desc: out.log.gz
URL: <http://tug.org/pipermail/luatex/attachments/20110628/b287b0c9/attachment-0001.gz>

From zappathustra at free.fr  Tue Jun 28 23:41:22 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 28 Jun 2011 23:41:22 +0200
Subject: [luatex] shipout a page
In-Reply-To: <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
 <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>
Message-ID: <4E0A4A82.3050901@free.fr>

Le 28/06/2011 19:45, Taco Hoekwater a ?crit :
>
>
>
> On 28 jun. 2011, at 18:49, Patrick Gundlach<patrick at gundla.ch>  wrote:
>> See the reply to Paul: I am still interested in a solution without an intermediate box.
>>
>>
> The only way to get stuff to the pdf is via a box register (unless you count creating the low-level pdf code for the page stream yourself via pdf literals, but I assume that is not what you had in mind). That's just how it is. If you want to hide this effect, write a two-line function based on Luigi's code.

I suppose Patrick wants to retrieve the contents of the MVL. This does it:

   local p1 = node.copy_list(tex.lists.page_head)
   local p2 = node.copy_list(tex.lists.contrib_head)
   node.insert_after(p1, node.tail(p1), p2)
   tex.box[0].head = p1
   tex.lists.page_head = nil
   tex.lists.contrib_head = nil
   tex.shipout(0)

Well, it seems to work, but something tells me it is a very bad idea. 
Not the kind of thing I'd rely on until I've had a better understanding 
of the page_head/contrib_head interaction, at least.

Best,
Paul



From patrick at gundla.ch  Wed Jun 29 09:46:03 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 09:46:03 +0200
Subject: [luatex] double free noded
Message-ID: <6400E34A-0F81-4628-867E-13A24DDF2268@gundla.ch>

Hi,

can someone explain this behavior to me?

test.tex:
------
\directlua{dofile("test.lua")}
\bye
------

test.lua:
------------------
local tenpt = 10 * 2^16

local r1 = node.new("rule")
r1.width = 2* tenpt
r1.height = tenpt
r1.depth = tenpt
local tmp = node.vpack(r1)
tex.box[666] = tmp

tmp = node.vpack(tex.box[666])
tex.box[777] = tmp

tex.shipout(777)

local r1 = node.new("rule")
r1.width = 2* tenpt
r1.height = tenpt
r1.depth = tenpt
local tmp = node.vpack(r1)

-- to make sure it's this box that is double freed:
-- print(tostring(tex.box[666])) 

tex.box[666] = tmp
------------------


this results in 

This is LuaTeX, Version beta-0.65.0-2011010915 (rev 4045) 
 restricted \write18 enabled.
(./test.tex [1]
! Attempt to double-free vlist node 198, ignored.
l.1 \directlua{dofile("test.lua")}
                                  
and node 198 seems to be the one in tex.box[666]

At the last line, tmp is a valid vbox, I assume, and assigning the vbox to the box register 666 seems to run a "free node" routine, which seems to fail. I suppose that the box 666 should have been cleared by tex.shipout(777) which has 666 in its vbox.

Patrick





From patrick at gundla.ch  Wed Jun 29 09:49:40 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 09:49:40 +0200
Subject: [luatex] shipout a page
In-Reply-To: <4E0A4A82.3050901@free.fr>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
 <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>
 <4E0A4A82.3050901@free.fr>
Message-ID: <7CBEBFA3-A51F-481D-9E2F-15CDF47700C1@gundla.ch>


Am 28.06.2011 um 23:41 schrieb Paul Isambert:

> I suppose Patrick wants to retrieve the contents of the MVL. This does it:
> 
>  local p1 = node.copy_list(tex.lists.page_head)
>  local p2 = node.copy_list(tex.lists.contrib_head)

I completely missed tex.lists.* and now I understand a bit (well only a tiny bit) more.

> Well, it seems to work, but something tells me it is a very bad idea. Not the kind of thing I'd rely on until I've had a better understanding of the page_head/contrib_head interaction, at least.

I like bad ideas :) Those challenge me.

Patrick




From luigi.scarso at gmail.com  Wed Jun 29 09:52:59 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 29 Jun 2011 09:52:59 +0200
Subject: [luatex] shipout a page
In-Reply-To: <7CBEBFA3-A51F-481D-9E2F-15CDF47700C1@gundla.ch>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch>
 <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch>
 <4E09E667.5070500@free.fr> <4E09E8E9.1040306@free.fr>
 <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr>
 <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
 <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>
 <4E0A4A82.3050901@free.fr>
 <7CBEBFA3-A51F-481D-9E2F-15CDF47700C1@gundla.ch>
Message-ID: <BANLkTinQxk5c5MbNZf1oGiEZ_-CwD43DWA@mail.gmail.com>

On Wed, Jun 29, 2011 at 9:49 AM, Patrick Gundlach <patrick at gundla.ch> wrote:

>
> Am 28.06.2011 um 23:41 schrieb Paul Isambert:
>
> > I suppose Patrick wants to retrieve the contents of the MVL. This does
> it:
> >
> >  local p1 = node.copy_list(tex.lists.page_head)
> >  local p2 = node.copy_list(tex.lists.contrib_head)
>
> I completely missed tex.lists.* and now I understand a bit (well only a
> tiny bit) more.
>
> > Well, it seems to work, but something tells me it is a very bad idea. Not
> the kind of thing I'd rely on until I've had a better understanding of the
> page_head/contrib_head interaction, at least.
>
> I like bad ideas :) Those challenge me.
>
> ok, but you are still shipout a box. It's a variation of a previous
example.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20110629/4d47981d/attachment.html>

From patrick at gundla.ch  Wed Jun 29 09:58:26 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 09:58:26 +0200
Subject: [luatex] shipout a page
In-Reply-To: <BANLkTinQxk5c5MbNZf1oGiEZ_-CwD43DWA@mail.gmail.com>
References: <D5E45F2D-CEAD-4CF0-BA19-E2568E70C6BD@gundla.ch>
 <BANLkTikfniFrRX49JSxT1c==TjtP6Lj6oQ@mail.gmail.com>
 <62F07B95-1255-45EF-8BB0-3FEFC2A7E1BA@gundla.ch> <4E09D688.9030509@free.fr>
 <6AA74A05-CC12-425C-87EA-843285CDACE8@gundla.ch> <4E09E667.5070500@free.fr>
 <4E09E8E9.1040306@free.fr> <B9E5A05C-2F2C-4F61-8807-33B513BA2890@gundla.ch>
 <4E09F0A1.1040907@free.fr> <DD4EB9A2-B59C-487A-B3AA-60BF445D79E8@gundla.ch>
 <BANLkTinMWwdGAW0QjksAr8fJunCMS1Q+kw@mail.gmail.com>
 <BANLkTimD9ZJTu-tz=c1whTMjrDTiXNWDzg@mail.gmail.com>
 <7B937783-B2F3-4966-AE56-43A7119F35EF@gundla.ch>
 <8E138F8E-0E8E-4433-96BF-499EE1D5371B@elvenkind.com>
 <4E0A4A82.3050901@free.fr> <7CBEBFA3-A51F-481D-9E2F-15CDF47700C1@gundla.ch>
 <BANLkTinQxk5c5MbNZf1oGiEZ_-CwD43DWA@mail.gmail.com>
Message-ID: <FF94E3B6-242B-4F93-8B05-EE81213B170E@gundla.ch>

Hi Luigi,

> ok, but you are still shipout a box. It's a variation of a previous example.

I am currently trying to use your solution with an intermediate box, but I am stuck with my approach, which I'd like to solve first.

Thanks

Patrick



From patrick at gundla.ch  Wed Jun 29 10:04:29 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 10:04:29 +0200
Subject: [luatex] pdfoutline in lua
In-Reply-To: <442AE319-808B-4B59-988D-F5653E6913B3@gundla.ch>
References: <442AE319-808B-4B59-988D-F5653E6913B3@gundla.ch>
Message-ID: <6A254914-124D-447C-99D2-1F193727420E@gundla.ch>

Any idea on this one?


Am 28.06.2011 um 11:58 schrieb Patrick Gundlach:

> Hi,
> 
> can I do the same as \pdfoutline in Lua? That is: create PDF bookmarks in Lua?
> 
> Patrick




From zappathustra at free.fr  Wed Jun 29 10:30:05 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 29 Jun 2011 10:30:05 +0200
Subject: [luatex] pdfoutline in lua
In-Reply-To: <6A254914-124D-447C-99D2-1F193727420E@gundla.ch>
References: <442AE319-808B-4B59-988D-F5653E6913B3@gundla.ch>
 <6A254914-124D-447C-99D2-1F193727420E@gundla.ch>
Message-ID: <4E0AE28D.1060107@free.fr>

I'd say you're ripe for a feature request :)

Le 29/06/2011 10:04, Patrick Gundlach a ?crit :
> Any idea on this one?
>
>
> Am 28.06.2011 um 11:58 schrieb Patrick Gundlach:
>
>> Hi,
>>
>> can I do the same as \pdfoutline in Lua? That is: create PDF bookmarks in Lua?
>>
>> Patrick
>
>

From patrick at gundla.ch  Wed Jun 29 10:33:20 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 10:33:20 +0200
Subject: [luatex] pdfoutline in lua
In-Reply-To: <4E0AE28D.1060107@free.fr>
References: <442AE319-808B-4B59-988D-F5653E6913B3@gundla.ch>
 <6A254914-124D-447C-99D2-1F193727420E@gundla.ch> <4E0AE28D.1060107@free.fr>
Message-ID: <329FB1F4-DBC9-4A47-91DE-4CD94CA5CCF8@gundla.ch>


Am 29.06.2011 um 10:30 schrieb Paul Isambert:

> I'd say you're ripe for a feature request :)

done.

Patrick


From taco at elvenkind.com  Wed Jun 29 15:07:47 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 29 Jun 2011 15:07:47 +0200
Subject: [luatex] double free noded
In-Reply-To: <6400E34A-0F81-4628-867E-13A24DDF2268@gundla.ch>
References: <6400E34A-0F81-4628-867E-13A24DDF2268@gundla.ch>
Message-ID: <4E0B23A3.3080909@elvenkind.com>



On 06/29/11 09:46, Patrick Gundlach wrote:
> Hi,
> 
> can someone explain this behavior to me?

Eh, yes. But is it intuitive?  no, not really. So, for
explanations only:

> tmp = node.vpack(tex.box[666])
> tex.box[777] = tmp
> 
> tex.shipout(777)

The tex.shipout() frees `tmp`, which also contains box[666].

> local r1 = node.new("rule")
> r1.width = 2* tenpt
> r1.height = tenpt
> r1.depth = tenpt
> local tmp = node.vpack(r1)
> 
> -- to make sure it's this box that is double freed:
> -- print(tostring(tex.box[666])) 
> 
> tex.box[666] = tmp

This again frees box[666], now to make room for the new
`tmp`. (but it is already freed).


From patrick at gundla.ch  Wed Jun 29 15:18:51 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Jun 2011 15:18:51 +0200
Subject: [luatex] double free noded
In-Reply-To: <4E0B23A3.3080909@elvenkind.com>
References: <6400E34A-0F81-4628-867E-13A24DDF2268@gundla.ch>
 <4E0B23A3.3080909@elvenkind.com>
Message-ID: <0A4B651E-9CF9-44BE-898F-5BEE01D641D1@gundla.ch>


Am 29.06.2011 um 15:07 schrieb Taco Hoekwater:

> 
> Eh, yes. But is it intuitive?  no, not really. So, for
> explanations only:

[...]

OK, thats what I assumed. Is this the intended behavior?

(if yes, then my next question will be how to deal with this problem).

Patrick


From taco at elvenkind.com  Wed Jun 29 15:22:12 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 29 Jun 2011 15:22:12 +0200
Subject: [luatex] double free noded
In-Reply-To: <0A4B651E-9CF9-44BE-898F-5BEE01D641D1@gundla.ch>
References: <6400E34A-0F81-4628-867E-13A24DDF2268@gundla.ch>
 <4E0B23A3.3080909@elvenkind.com>
 <0A4B651E-9CF9-44BE-898F-5BEE01D641D1@gundla.ch>
Message-ID: <4E0B2704.2060905@elvenkind.com>



On 06/29/11 15:18, Patrick Gundlach wrote:
> 
> Am 29.06.2011 um 15:07 schrieb Taco Hoekwater:
> 
>>
>> Eh, yes. But is it intuitive?  no, not really. So, for
>> explanations only:
> 
> [...]
> 
> OK, thats what I assumed. Is this the intended behavior?

Pretty much, for now.

> (if yes, then my next question will be how to deal with this problem).

copy the node list while assigning to the box you will be outputting.
(or do not reuse parts of boxes in other boxes)

From taco at elvenkind.com  Wed Jun 29 15:46:27 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 29 Jun 2011 15:46:27 +0200
Subject: [luatex] compiling on MINIX3
In-Reply-To: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F01@KCL-MAIL05.kclad.ds.kcl.ac.uk>
References: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F01@KCL-MAIL05.kclad.ds.kcl.ac.uk>
Message-ID: <4E0B2CB3.8010008@elvenkind.com>

Hi,

On 06/28/11 21:38, Reviczky, Adam wrote:
> 
> The same happened a while ago on FreeBSD, see:
> http://www.ntg.nl/pipermail/dev-luatex/2010-March/003473.html
> 
> I believe it is the same problem, and setting TL_MAKE or MAKE doesn't help either.

There is not a lot I can do about this problem from here, I fear.
You could try to do an explicit export of MAKE=gmake, maybe that
helps.

> ---
> gcc -DHAVE_CONFIG_H -I. -I../../../source/libs/zziplib -Iinclude -I../../../source/libs/zziplib/zziplib-0.13.60 -I/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zlib/include -D_USE_MMAP  -Wall -Wunused -Wimplicit -Wreturn-type -Wdeclaration-after-statement -Wno-unknown-pragmas -Wmissing-prototypes -Wmissing-declarations -g -O2 -MT stat.o -MD -MP -MF .deps/stat.Tpo -c -o stat.o `test -f 'zziplib-0.13.60/zzip/stat.c' || echo '../../../source/libs/zziplib/'`zziplib-0.13.60/zzip/stat.c
> ../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c: In function 'zzip_dir_stat':
> ../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: 'strcasecmp' undeclared (first use in this function)
> ../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: (Each undeclared identifier is reported only once
> ../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:44: error: for each function it appears in.)

This is completely different. It looks like a small portability bug in
zziplib, it should #include <strings.h> (or possibly #define
_POSIX_SOURCE).

I do not know whether gcc has a predefined macro
for minix, but you can definitely try adding

  #define _POSIX_SOURCE 1

in zzip/stat.c

Please let me know whether that works.

Best wishes,
Taco






Best wishes,
Taco

From nomosnomos at gmail.com  Thu Jun 30 03:18:20 2011
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Thu, 30 Jun 2011 10:18:20 +0900
Subject: [luatex] strange behavior of zero-width box
Message-ID: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>

Hi,

\font\X={Junicode-Regular:mode=node;salt=1}
\font\Y={Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

On compiling the above code with luatex-plain,
I get a pdf in which "2" is overwritten on "3".  This is not correct, of course.

Now if I insert "\kern-52sp" (why 52sp? I don't know.)
between "1" and "\llap", that is

\leavevmode\X\hbox{1\kern-52sp\llap{\Y2}}3

then "2" is correctly overwitten over "1".

I am not sure whether this problem comes from luatex engine
or from luatex-plain macro.  So I'm posting here.

Best,
-- 
Dohyun Kim
College of Law, Dongguk University
Seoul, Republic of Korea

From taco at elvenkind.com  Thu Jun 30 06:55:05 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 30 Jun 2011 06:55:05 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
Message-ID: <4E0C01A9.203@elvenkind.com>



On 06/30/11 03:18, Dohyun Kim wrote:
> Hi,
> 
> \font\X={Junicode-Regular:mode=node;salt=1}
> \font\Y={Junicode-Regular:mode=node;salt=2}
> \leavevmode\X\hbox{1\llap{\Y2}}3
> \bye
> 
> On compiling the above code with luatex-plain,
> I get a pdf in which "2" is overwritten on "3".  This is not correct, of course.
> 
> Now if I insert "\kern-52sp" (why 52sp? I don't know.)
> between "1" and "\llap", that is
> 
> \leavevmode\X\hbox{1\kern-52sp\llap{\Y2}}3
> 
> then "2" is correctly overwitten over "1".
> 
> I am not sure whether this problem comes from luatex engine
> or from luatex-plain macro.  So I'm posting here.

This seems to be an engine problem. Luatex does not output a text
matrix in between the '1' and '2' in the wrong case:

  1 0 0 1 91.925 714.792 Tm [<0014>]TJ
  [<0015>]TJ
  1 0 0 1 96.576 714.792 Tm [<0016>]TJ

It looks to me like that is because that matrix would be identical to
the first one.

The version with 52sp difference produces either

  1 0 0 1 91.925 702.837 Tm [<0014>]TJ
  1 0 0 1 91.924 702.837 Tm [<0015>]TJ
  1 0 0 1 96.575 702.837 Tm [<0016>]TJ

or

  1 0 0 1 91.925 702.837 Tm [<0014>]TJ
  1 0 0 1 91.926 702.837 Tm [<0015>]TJ
  1 0 0 1 96.575 702.837 Tm [<0016>]TJ

depending on the sign of the \kern. Hartmut?

Best wishes,
Taco





From patrick at gundla.ch  Thu Jun 30 10:48:18 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 30 Jun 2011 10:48:18 +0200
Subject: [luatex] pdf_dest node explained
Message-ID: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>

Hi,

I am playing with links in PDF now. Can someone help me explaining the fields of the dest node?

I guess that dest_type is the contents of the struct pdf_destination_types in pdfdest.h source:

    pdf_dest_xyz = 0,
    pdf_dest_fit = 1,
    pdf_dest_fith = 2,
    pdf_dest_fitv = 3,
    pdf_dest_fitb = 4,
    pdf_dest_fitbh = 5,
    pdf_dest_fitbv = 6,
    pdf_dest_fitr = 7

correct?

"xyz zoom" is the amount of zoom when dest_type == 0
"named_id" is 0 if dest is a number, 1 if it is a string (named dest)
"dest_id" is either the number or the string


width/height/depth: what is this?
what is the objnum?


Thanks

Patrick



From taco at elvenkind.com  Thu Jun 30 11:19:54 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 30 Jun 2011 11:19:54 +0200
Subject: [luatex] pdf_dest node explained
In-Reply-To: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>
References: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>
Message-ID: <4E0C3FBA.90009@elvenkind.com>



On 06/30/11 10:48, Patrick Gundlach wrote:
> Hi,
> 
> I am playing with links in PDF now. Can someone help me explaining the fields of the dest node?
> 
> I guess that dest_type is the contents of the struct pdf_destination_types in pdfdest.h source:
> 
>     pdf_dest_xyz = 0,
>     pdf_dest_fit = 1,
>     pdf_dest_fith = 2,
>     pdf_dest_fitv = 3,
>     pdf_dest_fitb = 4,
>     pdf_dest_fitbh = 5,
>     pdf_dest_fitbv = 6,
>     pdf_dest_fitr = 7
> 
> correct?

yes.

> "xyz zoom" is the amount of zoom when dest_type == 0
> "named_id" is 0 if dest is a number, 1 if it is a string (named dest)
> "dest_id" is either the number or the string
> 
> 
> width/height/depth: what is this?

width, height & depth of the destination annotation. Various types
of destinations need to know its size to be able to do sensible
'fit's. (after writing, the meaning changes subtly to be a rectangle
instead of whd, iirc).

> what is the objnum?

pdf object number (if already written). This is needed internally

Best wishes,
Taco

From patrick at gundla.ch  Thu Jun 30 11:30:48 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 30 Jun 2011 11:30:48 +0200
Subject: [luatex] pdf_dest node explained
In-Reply-To: <4E0C3FBA.90009@elvenkind.com>
References: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>
 <4E0C3FBA.90009@elvenkind.com>
Message-ID: <AB90CAAA-BA1D-40D2-AE41-777953B0DC75@gundla.ch>


Am 30.06.2011 um 11:19 schrieb Taco Hoekwater:

>> what is the objnum?
> 
> pdf object number (if already written). This is needed internally

Now I am a bit clueless on how I could create a link/dest pair.

If I understand things right: I have to create a pdf_dest node and find out its object number. Then I create a pdf_start_link/pdf_end_link pair with that object number for jumping to that place. 



Now: how do I know the object number? When I call tex.shipout(), the memory of that pdf_dest node is invalid (??), so I can't check anymore.


Patrick




From zappathustra at free.fr  Thu Jun 30 11:30:56 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 30 Jun 2011 11:30:56 +0200
Subject: [luatex] pdf_dest node explained
In-Reply-To: <4E0C3FBA.90009@elvenkind.com>
References: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>
 <4E0C3FBA.90009@elvenkind.com>
Message-ID: <4E0C4250.3060005@free.fr>

Le 30/06/2011 11:19, Taco Hoekwater a ?crit :
>
> On 06/30/11 10:48, Patrick Gundlach wrote:
>
>> what is the objnum?
> pdf object number (if already written). This is needed internally

It seems to stick to 0, though. Is that because its numbers is 
determined at shipout only? But then it's useless, since after shipout 
you can't retrieve it... I suppose the object number is reserved in 
advance, but the field here isn't correctly updated? See:

\output{
     \directlua{
         local dest = tex.box[255].head.next.head
         while not(dest.id == 8 and dest.subtype == 19) do
             dest = dest.next
          end
          texio.write_nl(dest.objnum)}
\shipout\box255
}

abc \pdfdest num 1 fitr
\bye

This prints 0, even though 0 is an illegal object number (and the 
destination is in object 5 anyway).



Also, totally unrelated: with object streams, pdfTeX signals the 
objects' numbers in a comment:

% 2 0 obj
...
% 8 0 obj
...
% 25 0 obj
...

LuaTeX does so too, but the comment is at the end of the last line of 
the previous object, which is quite unreadable:
% 2 0 obj
... % 8 0 obj
... % 25 0 obj
...

I think somebody forgot a carriage return, or is that on purpose?

Best,
Paul

From zappathustra at free.fr  Thu Jun 30 11:32:51 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 30 Jun 2011 11:32:51 +0200
Subject: [luatex] pdf_dest node explained
In-Reply-To: <AB90CAAA-BA1D-40D2-AE41-777953B0DC75@gundla.ch>
References: <6F85A0AE-F3BC-4F17-912D-985AA1A62F4F@gundla.ch>
 <4E0C3FBA.90009@elvenkind.com>
 <AB90CAAA-BA1D-40D2-AE41-777953B0DC75@gundla.ch>
Message-ID: <4E0C42C3.40705@free.fr>

Le 30/06/2011 11:30, Patrick Gundlach a ?crit :
> Am 30.06.2011 um 11:19 schrieb Taco Hoekwater:
>
>>> what is the objnum?
>> pdf object number (if already written). This is needed internally
> Now I am a bit clueless on how I could create a link/dest pair.
>
> If I understand things right: I have to create a pdf_dest node and find out its object number. Then I create a pdf_start_link/pdf_end_link pair with that object number for jumping to that place.

Oh no, you refer to a destination with its id (name or num). See 
action-type nodes.
Best,
Paul

From patrick at gundla.ch  Thu Jun 30 12:40:10 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 30 Jun 2011 12:40:10 +0200
Subject: [luatex] small manual question
Message-ID: <6EE90D55-5A5D-47CE-A350-564715F4A378@gundla.ch>

8.1.4.13 pdf_start_link nodes (p. 179/183)

link_attr seems to be a string, not a table. Or could this switch between a table and a string?

Patrick




From taco at elvenkind.com  Thu Jun 30 12:43:27 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 30 Jun 2011 12:43:27 +0200
Subject: [luatex] small manual question
In-Reply-To: <6EE90D55-5A5D-47CE-A350-564715F4A378@gundla.ch>
References: <6EE90D55-5A5D-47CE-A350-564715F4A378@gundla.ch>
Message-ID: <4E0C534F.3030101@elvenkind.com>



On 06/30/11 12:40, Patrick Gundlach wrote:
> 8.1.4.13 pdf_start_link nodes (p. 179/183)
> 
> link_attr seems to be a string, 

On assign it can be either a table or a string,
on query it returns a string always.

Best wishes,
Taco

From patrick at gundla.ch  Thu Jun 30 12:57:25 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 30 Jun 2011 12:57:25 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
Message-ID: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>

Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.

Thanks to all again!

Patrick




test.tex:
-------------------
\directlua{dofile("mknodes.lua")}
\end
-------------------

mknodes.lua:
-------------------
local tenpt = 10 * 2^16

function add_to_page( list )
  local tail = node.tail(global_pagebox)
  tail.next = list
  list.prev = tail
end

function new_page()
  global_pagebox = node.new("vlist")
end

function shipout()
  local x = node.vpack(global_pagebox)
  tex.box[666] = x
  tex.shipout(666)
end

function mkrule( size )
  local r = node.new("rule")
  r.width  = size * 2
  r.height = size
  r.depth  = size
  return r
end
function mkdest()
  local d = node.new("whatsit","pdf_dest")
  d.named_id = 0
  d.dest_id = 1
  d.dest_type = 3
  return d
end

new_page()

add_to_page(mkdest())
add_to_page(mkrule(tenpt))
add_to_page(mkrule(2 * tenpt))
add_to_page(mkrule(tenpt))

shipout()
new_page()

local start_link = node.new("whatsit","pdf_start_link")
local end_link = node.new("whatsit","pdf_end_link")
local action = node.new("action")

action.action_type = 1
action.action_id = 1

start_link.width = 2 * tenpt
start_link.height = tenpt
start_link.depth  = tenpt
start_link.action = action
start_link.link_attr = "/C [0.9 1 0] /Border [0 0 2]"

local r = mkrule(tenpt)

start_link.next = r
r.next = end_link
node.slide(start_link)

local h = node.hpack(start_link)
add_to_page(h)


add_to_page(mkrule(2 * tenpt))
add_to_page(mkrule(tenpt))

shipout()
-------------------



From zappathustra at free.fr  Thu Jun 30 13:06:45 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 30 Jun 2011 13:06:45 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
Message-ID: <4E0C58C5.5070608@free.fr>

Le 30/06/2011 12:57, Patrick Gundlach a ?crit :
> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.

Patrick, LuaTeX is supposed to put an end to dirty tricks :)
It's nice anyway. Some comment in your code.

> test.tex:
> -------------------
> \directlua{dofile("mknodes.lua")}
> \end
> -------------------
>
> mknodes.lua:
> -------------------
> local tenpt = 10 * 2^16
>
> function add_to_page( list )
>    local tail = node.tail(global_pagebox)
>    tail.next = list
>    list.prev = tail
> end
>
> function new_page()
>    global_pagebox = node.new("vlist")
> end

You could make global_pagebox local. Actually you could make do without 
new_page(), with add_to_page() initializing global_pagebox if nil.

> function shipout()
>    local x = node.vpack(global_pagebox)
>    tex.box[666] = x
>    tex.shipout(666)
> end
>
> function mkrule( size )
>    local r = node.new("rule")
>    r.width  = size * 2
>    r.height = size
>    r.depth  = size
>    return r
> end
> function mkdest()
>    local d = node.new("whatsit","pdf_dest")
>    d.named_id = 0
>    d.dest_id = 1
>    d.dest_type = 3
>    return d
> end

You have to give a different id to all dest, otherwise TeX will complain.

> new_page()
>
> add_to_page(mkdest())
> add_to_page(mkrule(tenpt))
> add_to_page(mkrule(2 * tenpt))
> add_to_page(mkrule(tenpt))
>
> shipout()
> new_page()
>
> local start_link = node.new("whatsit","pdf_start_link")
> local end_link = node.new("whatsit","pdf_end_link")
> local action = node.new("action")
>
> action.action_type = 1
> action.action_id = 1
>
> start_link.width = 2 * tenpt
> start_link.height = tenpt
> start_link.depth  = tenpt
> start_link.action = action
> start_link.link_attr = "/C [0.9 1 0] /Border [0 0 2]"

Oh no, no border on links, please!

Best,
Paul

From patrick at gundla.ch  Thu Jun 30 13:13:21 2011
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 30 Jun 2011 13:13:21 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <4E0C58C5.5070608@free.fr>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
 <4E0C58C5.5070608@free.fr>
Message-ID: <5A6B4DAC-4DD6-4E52-A0D0-78E94B377F77@gundla.ch>


Am 30.06.2011 um 13:06 schrieb Paul Isambert:

> Le 30/06/2011 12:57, Patrick Gundlach a ?crit :
>> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.
> 
> Patrick, LuaTeX is supposed to put an end to dirty tricks :)


Isn't the LuaTeX reference manual the new contents of appendix D of Knuth's TeXbook?


Thanks for your comments. I'll release my production code soon and you will find much more dirt.



Patrick



From taco at elvenkind.com  Thu Jun 30 13:15:49 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 30 Jun 2011 13:15:49 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <5A6B4DAC-4DD6-4E52-A0D0-78E94B377F77@gundla.ch>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
 <4E0C58C5.5070608@free.fr> <5A6B4DAC-4DD6-4E52-A0D0-78E94B377F77@gundla.ch>
Message-ID: <4E0C5AE5.70206@elvenkind.com>



On 06/30/11 13:13, Patrick Gundlach wrote:
> 
> Am 30.06.2011 um 13:06 schrieb Paul Isambert:
> 
>> Le 30/06/2011 12:57, Patrick Gundlach a ?crit :
>>> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.
>>
>> Patrick, LuaTeX is supposed to put an end to dirty tricks :)
> 
> 
> Isn't the LuaTeX reference manual the new contents of appendix D of Knuth's TeXbook?

No, no. First there will be luatex version 1.0 (or thereabouts), then
we will release the manual as the 'luatexbook', and for that we will
look at your production code to fill Appendix D ;)

Best wishes,
Taco

From luigi.scarso at gmail.com  Thu Jun 30 13:24:45 2011
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 30 Jun 2011 13:24:45 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
Message-ID: <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>

On Thu, Jun 30, 2011 at 12:57 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.
>
> Thanks to all again!
Why not put all on wiki.luatex.org ?
(just ignore if you have already done)

-- 
luigi

From taco at elvenkind.com  Thu Jun 30 13:30:58 2011
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 30 Jun 2011 13:30:58 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
 <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>
Message-ID: <4E0C5E72.2050404@elvenkind.com>



On 06/30/11 13:24, luigi scarso wrote:
> On Thu, Jun 30, 2011 at 12:57 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
>> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.
>>
>> Thanks to all again!
> Why not put all on wiki.luatex.org ?


Btw, I just switched to a new captcha subsystem there. I hope this will
make Paul's life easier :)

Best wishes,
Taco

From zappathustra at free.fr  Thu Jun 30 13:32:21 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 30 Jun 2011 13:32:21 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
 <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>
Message-ID: <4E0C5EC5.90409@free.fr>

Le 30/06/2011 13:24, luigi scarso a ?crit :
> On Thu, Jun 30, 2011 at 12:57 PM, Patrick Gundlach<patrick at gundla.ch>  wrote:
>> Just in case someone is interested in my experiments with tex.shipout and the pdf_dest, pdf_start_link nodes, here is a simple example. Not clever, but you get the point.
>>
>> Thanks to all again!
> Why not put all on wiki.luatex.org ?
> (just ignore if you have already done)

I concur! I've been told the wiki is starving, so much so it's been 
eating spams recently. Poor thing.

Best,
Paul

From zappathustra at free.fr  Thu Jun 30 13:52:31 2011
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 30 Jun 2011 13:52:31 +0200
Subject: [luatex] FYI: my experiments on tex.shipout() and links
In-Reply-To: <4E0C5E72.2050404@elvenkind.com>
References: <724D87DF-9B7E-49D5-9665-4C053AE2545F@gundla.ch>
 <BANLkTikwnsqU_AOYQj=JbeDHBGkW=00kdA@mail.gmail.com>
 <4E0C5E72.2050404@elvenkind.com>
Message-ID: <4E0C637F.9040200@free.fr>

Le 30/06/2011 13:30, Taco Hoekwater a ?crit :
> Btw, I just switched to a new captcha subsystem there. I hope this will
> make Paul's life easier :)

Thank you, it probably will... when I learn what a captcha subsystem is! 
I'll teach myself later.
Paul

From hartmut_henkel at gmx.de  Thu Jun 30 14:08:07 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Jun 2011 14:08:07 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <4E0C01A9.203@elvenkind.com>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
 <4E0C01A9.203@elvenkind.com>
Message-ID: <20110630120807.194730@gmx.net>

> On 06/30/11 03:18, Dohyun Kim wrote:
> > Hi,
> > 
> > \font\X={Junicode-Regular:mode=node;salt=1}
> > \font\Y={Junicode-Regular:mode=node;salt=2}
> > \leavevmode\X\hbox{1\llap{\Y2}}3
> > \bye
> > 
> > On compiling the above code with luatex-plain,
> > I get a pdf in which "2" is overwritten on "3".  This is not
> > correct,of course.
> > 
> > Now if I insert "\kern-52sp" (why 52sp? I don't know.)
> > between "1" and "\llap", that is
> > 
> > \leavevmode\X\hbox{1\kern-52sp\llap{\Y2}}3
> > 
> > then "2" is correctly overwitten over "1".
> > 
> > I am not sure whether this problem comes from luatex engine
> > or from luatex-plain macro.  So I'm posting here.
> 
> This seems to be an engine problem. Luatex does not output a text
> matrix in between the '1' and '2' in the wrong case:
> 
>   1 0 0 1 91.925 714.792 Tm [<0014>]TJ
>   [<0015>]TJ
>   1 0 0 1 96.576 714.792 Tm [<0016>]TJ
> 
> It looks to me like that is because that matrix would be identical to
> the first one.
> 
> The version with 52sp difference produces either
> 
>   1 0 0 1 91.925 702.837 Tm [<0014>]TJ
>   1 0 0 1 91.924 702.837 Tm [<0015>]TJ
>   1 0 0 1 96.575 702.837 Tm [<0016>]TJ
> 
> or
> 
>   1 0 0 1 91.925 702.837 Tm [<0014>]TJ
>   1 0 0 1 91.926 702.837 Tm [<0015>]TJ
>   1 0 0 1 96.575 702.837 Tm [<0016>]TJ
> 
> depending on the sign of the \kern. Hartmut?

hm, it's ok with old-style Type1 fonts:

\pdfcompresslevel=0
\font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
\font\Y=cmbxti10 % {Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

gives:

BT
/F51 9.96264 Tf 1 0 0 1 91.925 759.927 Tm [(1)]TJ
/F52 9.96264 Tf 1 0 0 1 91.018 759.927 Tm [(2)]TJ
/F51 9.96264 Tf 1 0 0 1 96.907 759.927 Tm [(3)]TJ
1 0 0 1 303.509 105.18 Tm [(1)]TJ
ET

no idea about the salt, will need checking...

Regards, Hartmut

-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From hartmut_henkel at gmx.de  Thu Jun 30 14:08:07 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Jun 2011 14:08:07 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <4E0C01A9.203@elvenkind.com>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
 <4E0C01A9.203@elvenkind.com>
Message-ID: <20110630120807.194730@gmx.net>

> On 06/30/11 03:18, Dohyun Kim wrote:
> > Hi,
> > 
> > \font\X={Junicode-Regular:mode=node;salt=1}
> > \font\Y={Junicode-Regular:mode=node;salt=2}
> > \leavevmode\X\hbox{1\llap{\Y2}}3
> > \bye
> > 
> > On compiling the above code with luatex-plain,
> > I get a pdf in which "2" is overwritten on "3".  This is not
> > correct,of course.
> > 
> > Now if I insert "\kern-52sp" (why 52sp? I don't know.)
> > between "1" and "\llap", that is
> > 
> > \leavevmode\X\hbox{1\kern-52sp\llap{\Y2}}3
> > 
> > then "2" is correctly overwitten over "1".
> > 
> > I am not sure whether this problem comes from luatex engine
> > or from luatex-plain macro.  So I'm posting here.
> 
> This seems to be an engine problem. Luatex does not output a text
> matrix in between the '1' and '2' in the wrong case:
> 
>   1 0 0 1 91.925 714.792 Tm [<0014>]TJ
>   [<0015>]TJ
>   1 0 0 1 96.576 714.792 Tm [<0016>]TJ
> 
> It looks to me like that is because that matrix would be identical to
> the first one.
> 
> The version with 52sp difference produces either
> 
>   1 0 0 1 91.925 702.837 Tm [<0014>]TJ
>   1 0 0 1 91.924 702.837 Tm [<0015>]TJ
>   1 0 0 1 96.575 702.837 Tm [<0016>]TJ
> 
> or
> 
>   1 0 0 1 91.925 702.837 Tm [<0014>]TJ
>   1 0 0 1 91.926 702.837 Tm [<0015>]TJ
>   1 0 0 1 96.575 702.837 Tm [<0016>]TJ
> 
> depending on the sign of the \kern. Hartmut?

hm, it's ok with old-style Type1 fonts:

\pdfcompresslevel=0
\font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
\font\Y=cmbxti10 % {Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

gives:

BT
/F51 9.96264 Tf 1 0 0 1 91.925 759.927 Tm [(1)]TJ
/F52 9.96264 Tf 1 0 0 1 91.018 759.927 Tm [(2)]TJ
/F51 9.96264 Tf 1 0 0 1 96.907 759.927 Tm [(3)]TJ
1 0 0 1 303.509 105.18 Tm [(1)]TJ
ET

no idea about the salt, will need checking...

Regards, Hartmut

-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From hartmut_henkel at gmx.de  Thu Jun 30 14:17:04 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Jun 2011 14:17:04 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <20110630120807.194730@gmx.net>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
 <4E0C01A9.203@elvenkind.com> <20110630120807.194730@gmx.net>
Message-ID: <20110630121704.129930@gmx.net>

> hm, it's ok with old-style Type1 fonts:
> 
> \pdfcompresslevel=0
> \font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
> \font\Y=cmbxti10 % {Junicode-Regular:mode=node;salt=2}
> \leavevmode\X\hbox{1\llap{\Y2}}3
> \bye

but there is indeed a luatex bug when the font is the same:

pdfcompresslevel=0
\font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
\font\Y=cmr10 % {Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

interesting that this remained undetected for such long time.

Regards, Hartmut
-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From hartmut_henkel at gmx.de  Thu Jun 30 14:17:04 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Jun 2011 14:17:04 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <20110630120807.194730@gmx.net>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
 <4E0C01A9.203@elvenkind.com> <20110630120807.194730@gmx.net>
Message-ID: <20110630121704.129930@gmx.net>

> hm, it's ok with old-style Type1 fonts:
> 
> \pdfcompresslevel=0
> \font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
> \font\Y=cmbxti10 % {Junicode-Regular:mode=node;salt=2}
> \leavevmode\X\hbox{1\llap{\Y2}}3
> \bye

but there is indeed a luatex bug when the font is the same:

pdfcompresslevel=0
\font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
\font\Y=cmr10 % {Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

interesting that this remained undetected for such long time.

Regards, Hartmut
-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From hartmut_henkel at gmx.de  Thu Jun 30 14:17:04 2011
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Thu, 30 Jun 2011 14:17:04 +0200
Subject: [luatex] strange behavior of zero-width box
In-Reply-To: <20110630120807.194730@gmx.net>
References: <BANLkTimsM_9x=iwSGNgj4tLCuPJDygpOHA@mail.gmail.com>
 <4E0C01A9.203@elvenkind.com> <20110630120807.194730@gmx.net>
Message-ID: <20110630121704.129930@gmx.net>

> hm, it's ok with old-style Type1 fonts:
> 
> \pdfcompresslevel=0
> \font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
> \font\Y=cmbxti10 % {Junicode-Regular:mode=node;salt=2}
> \leavevmode\X\hbox{1\llap{\Y2}}3
> \bye

but there is indeed a luatex bug when the font is the same:

pdfcompresslevel=0
\font\X=cmr10 % {Junicode-Regular:mode=node;salt=1}
\font\Y=cmr10 % {Junicode-Regular:mode=node;salt=2}
\leavevmode\X\hbox{1\llap{\Y2}}3
\bye

interesting that this remained undetected for such long time.

Regards, Hartmut
-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From adam.reviczky at kcl.ac.uk  Thu Jun 30 18:02:14 2011
From: adam.reviczky at kcl.ac.uk (Reviczky, Adam)
Date: Thu, 30 Jun 2011 17:02:14 +0100
Subject: [luatex] compiling on MINIX3
In-Reply-To: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F01@KCL-MAIL05.kclad.ds.kcl.ac.uk>
References: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F01@KCL-MAIL05.kclad.ds.kcl.ac.uk>
Message-ID: <7B4626C28B06A7418E938BF73D6DEE18FED4AA0F1D@KCL-MAIL05.kclad.ds.kcl.ac.uk>

Hi Taco

> There is not a lot I can do about this problem from here, I fear.
> You could try to do an explicit export of MAKE=gmake, maybe that
> helps.

Thanks, that indeed helps.
Any chance we can change build.sh?

---
 # try to find gnu make; we may need it
 MAKE=make;
 if make -v 2>&1| grep "GNU Make" >/dev/null
 then 
   echo "Your make is a GNU-make; I will use that"
 elif gmake -v >/dev/null 2>&1
 then
   MAKE=gmake;
+  export MAKE
   echo "You have a GNU-make installed as gmake; I will use that"
 else
   echo "I can't find a GNU-make; I'll try to use make and hope that works." 
   echo "If it doesn't, please install GNU-make."
 fi
---

That shouldn't break anything and makes it work on minix.

> I do not know whether gcc has a predefined macro
> for minix, but you can definitely try adding
> 
>   #define _POSIX_SOURCE 1
> 
> in zzip/stat.c
> 
> Please let me know whether that works.

I've tried the _POSIX_SOURCE, but that didn't help, still the same:

gcc -DHAVE_CONFIG_H -I. -I../../../source/libs/zziplib -Iinclude -I../../../source/libs/zziplib/zziplib-0.13.60 -I/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zlib/include -D_USE_MMAP  -Wall -Wunused -Wimplicit -Wreturn-type -Wdeclaration-after-statement -Wno-unknown-pragmas -Wmissing-prototypes -Wmissing-declarations -g -O2 -MT stat.o -MD -MP -MF .deps/stat.Tpo -c -o stat.o `test -f 'zziplib-0.13.60/zzip/stat.c' || echo '../../../source/libs/zziplib/'`zziplib-0.13.60/zzip/stat.c
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c: In function 'zzip_dir_stat':
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:46: error: 'strcasecmp' undeclared (first use in this function)
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:46: error: (Each undeclared identifier is reported only once
../../../source/libs/zziplib/zziplib-0.13.60/zzip/stat.c:46: error: for each function it appears in.)
gmake[3]: *** [stat.o] Error 1
gmake[3]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake[2]: *** [all-recursive] Error 1
gmake[2]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake[1]: *** [all] Error 2
gmake[1]: Leaving directory `/home/reviczky/minimals/luatex-beta-0.70.1/build/libs/zziplib'
gmake: *** [../../libs/zziplib/libzzip.a] Error 2
strip: 'build/texk/web2c/luatex': No such file
ls: build/texk/web2c/luatex: No such file or directory

It looks like we can check for minix though by:

---
-#if defined(_AIX)
+#if defined(_AIX) || defined(__minix)
 #include <strings.h> /* for strcasecmp */
 #endif
---

Then it gets past zzip, but fails later on with:

gcc -DHAVE_CONFIG_H -I. -I../../../source/texk/web2c -I./w2c  -DLUASOCKET_DEBUG -I../../../source/texk/web2c/luatexdir/luasocket -I../../../source/texk/web2c/luatexdir/lua51   -g -O2 -MT libluasocket_a-options.o -MD -MP -MF .deps/libluasocket_a-options.Tpo -c -o libluasocket_a-options.o `test -f 'luatexdir/luasocket/src/options.c' || echo '../../../source/texk/web2c/'`luatexdir/luasocket/src/options.c
../../../source/texk/web2c/luatexdir/luasocket/src/options.c: In function 'opt_dontroute':
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:62: error: 'SO_DONTROUTE' undeclared (first use in this function)
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:62: error: (Each undeclared identifier is reported only once
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:62: error: for each function it appears in.)
../../../source/texk/web2c/luatexdir/luasocket/src/options.c: In function 'opt_broadcast':
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:67: error: 'SO_BROADCAST' undeclared (first use in this function)
../../../source/texk/web2c/luatexdir/luasocket/src/options.c: In function 'opt_ip_multicast_loop':
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:72: error: 'IP_MULTICAST_LOOP' undeclared (first use in this function)
../../../source/texk/web2c/luatexdir/luasocket/src/options.c: In function 'opt_linger':
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:77: error: storage size of 'li' isn't known
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:89: error: 'SO_LINGER' undeclared (first use in this function)
../../../source/texk/web2c/luatexdir/luasocket/src/options.c: In function 'opt_ip_multicast_ttl':
../../../source/texk/web2c/luatexdir/luasocket/src/options.c:95: error: 'SO_LINGER' undeclared (first use in this function)
gmake: *** [libluasocket_a-options.o] Error 1
strip: 'build/texk/web2c/luatex': No such file
ls: build/texk/web2c/luatex: No such file or directory

Any clues on that one?

Thanks for your help.

Best wishes
Adam


