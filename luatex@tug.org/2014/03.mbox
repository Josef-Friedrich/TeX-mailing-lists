From prannoy.bits at gmail.com  Sat Mar  1 17:40:14 2014
From: prannoy.bits at gmail.com (Prannoy Pilligundla)
Date: Sat, 1 Mar 2014 22:10:14 +0530
Subject: [luatex] XML export from Latex
Message-ID: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>

Hi Everyone,

I am Prannoy Pilligundla from India. Luatex has an XML export option from
Context but i want to do the same from Latex. It would be great if someone
could guide me on how to go ahead with this

Looking forward to hear from you guys

Thanks and Regards
Prannoy Pilligundla
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140301/412fa86b/attachment.html>

From michal.h21 at gmail.com  Sat Mar  1 19:23:41 2014
From: michal.h21 at gmail.com (Michal Hoftich)
Date: Sat, 1 Mar 2014 19:23:41 +0100
Subject: [luatex] XML export from Latex
In-Reply-To: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
Message-ID: <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>

Hi,

you can use tex4ht for this. It uses LaTeX by default, but it can be
configured to use lualatex instead. See [1] for htlualatex script, other
option is to use make4ht [2] with `-l` option.

Note that some problems exist, biggest is that tex4ht fails with opentype
fonts, which means that you cannot use fontspec package. You can try
experimental patched version of fontspec [3, sample document 4] with tex4ht
support (do not replace original fontspec with this verson, it is really
just an experiment and this version has some serious issues!).

Best regards,
Michal


[1] http://tex.stackexchange.com/q/27519/2891
[2] https://github.com/michal-h21/make4ht
[3] https://github.com/michal-h21/fontspec
[4] http://michal-h21.github.io/fontspec/fontspec-4ht.html


2014-03-01 17:40 GMT+01:00 Prannoy Pilligundla <prannoy.bits at gmail.com>:

> Hi Everyone,
>
> I am Prannoy Pilligundla from India. Luatex has an XML export option from
> Context but i want to do the same from Latex. It would be great if someone
> could guide me on how to go ahead with this
>
> Looking forward to hear from you guys
>
> Thanks and Regards
> Prannoy Pilligundla
> ?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140301/88a0dbce/attachment.html>

From stefano.franchi at gmail.com  Sat Mar  1 21:00:02 2014
From: stefano.franchi at gmail.com (stefano franchi)
Date: Sat, 1 Mar 2014 14:00:02 -0600
Subject: [luatex] XML export from Latex
In-Reply-To: <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
 <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
Message-ID: <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>

On Sat, Mar 1, 2014 at 12:23 PM, Michal Hoftich <michal.h21 at gmail.com>wrote:

> Hi,
>
> you can use tex4ht for this. It uses LaTeX by default, but it can be
> configured to use lualatex instead. See [1] for htlualatex script, other
> option is to use make4ht [2] with `-l` option.
>
>
Hi Michal,

I use mk4ht often but my impression was that htlatex does not really work
with LuaTeX. It does work with XeTeX, though, and that's what I've been
using.


The problem with htlatex, besides its current state of suspended animation,
is that it really uses a roundabout way to produce its output, having first
to go through (la|xe|lua)TeX processing to produce a customized DVI file
and then process the DVI to produce its final output.

I am thinking that the first part of htlatex process essentially duplicates
(Lua)TeX functionalities, and it would be easier, perhaps, to intervene in
LuaTeX itself and "redirect" the output to XML instead of DVI|pdf. The
existence of a XML module for context seems to validate this option (big
differences between Context and LaTex notwithstanding), but I admit I have
no knowledge whatsoever of LuaTeX internals and only a cursory one of
Context.

Any thought?


Stefano

-- 
__________________________________________________
Stefano Franchi
Associate Research Professor
Department of Hispanic Studies         Ph:   +1 (979) 845-2125
Texas A&M University                          Fax:  +1 (979) 845-6421
College Station, Texas, USA

stefano at tamu.edu
http://stefano.cleinias.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140301/525c67c0/attachment.html>

From michal.h21 at gmail.com  Fri Mar  7 10:26:58 2014
From: michal.h21 at gmail.com (Michal Hoftich)
Date: Fri, 7 Mar 2014 10:26:58 +0100
Subject: [luatex] XML export from Latex
In-Reply-To: <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
 <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
 <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>
Message-ID: <CAOCj1Oduw=fbmRSQ-N9rKq6vqBwoFkkVs-p3TkjmOfBH9NT+_A@mail.gmail.com>

Hi Stefano,

tex4ht works with LuaLaTeX, but no htlualatex script is provided by
default.  There are some conflicts between tex4ht and babel, but these
errors don't affect output, only compilation is stoped.
To workaround problems with babel, making local copy of html4.4ht file
and converting it to utf8 encoding should help. Note that polyglossia
doesn't work, because it loads fontspec and opentype fonts (or, more
precisely, fonts without tfm table) don't work with tex4ht dvi to xml
converter.

Regarding direct conversion conversion from LuaLaTeX to xml without
need to use dvi processing, it is possible. I created simple demo, or
proof of concept [1]. Not all things supported by tex4ht works, but as
you can see, fontspec works without the need of patching.

PS.
Note that make4ht [2] is not the same thing as mk4ht, it is simple
build tool which enables configuration of commands used for conversion
of images, post-processig generated files etc.

Best regards,
Michal

[1] https://github.com/michal-h21/lua4ht
[2] https://github.com/michal-h21/make4ht

2014-03-01 21:00 GMT+01:00 stefano franchi <stefano.franchi at gmail.com>:
>
>
>
> On Sat, Mar 1, 2014 at 12:23 PM, Michal Hoftich <michal.h21 at gmail.com>
> wrote:
>>
>> Hi,
>>
>> you can use tex4ht for this. It uses LaTeX by default, but it can be
>> configured to use lualatex instead. See [1] for htlualatex script, other
>> option is to use make4ht [2] with `-l` option.
>>
>
> Hi Michal,
>
> I use mk4ht often but my impression was that htlatex does not really work
> with LuaTeX. It does work with XeTeX, though, and that's what I've been
> using.
>
>
> The problem with htlatex, besides its current state of suspended animation,
> is that it really uses a roundabout way to produce its output, having first
> to go through (la|xe|lua)TeX processing to produce a customized DVI file and
> then process the DVI to produce its final output.
>
> I am thinking that the first part of htlatex process essentially duplicates
> (Lua)TeX functionalities, and it would be easier, perhaps, to intervene in
> LuaTeX itself and "redirect" the output to XML instead of DVI|pdf. The
> existence of a XML module for context seems to validate this option (big
> differences between Context and LaTex notwithstanding), but I admit I have
> no knowledge whatsoever of LuaTeX internals and only a cursory one of
> Context.
>
> Any thought?
>
>
> Stefano
>
> --
> __________________________________________________
> Stefano Franchi
> Associate Research Professor
> Department of Hispanic Studies         Ph:   +1 (979) 845-2125
> Texas A&M University                          Fax:  +1 (979) 845-6421
> College Station, Texas, USA
>
> stefano at tamu.edu
> http://stefano.cleinias.org


From stefano.franchi at gmail.com  Mon Mar 10 20:18:34 2014
From: stefano.franchi at gmail.com (stefano franchi)
Date: Mon, 10 Mar 2014 14:18:34 -0500
Subject: [luatex] XML export from Latex
In-Reply-To: <CAOCj1Oduw=fbmRSQ-N9rKq6vqBwoFkkVs-p3TkjmOfBH9NT+_A@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
 <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
 <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>
 <CAOCj1Oduw=fbmRSQ-N9rKq6vqBwoFkkVs-p3TkjmOfBH9NT+_A@mail.gmail.com>
Message-ID: <CAJODLwbwsjEXhm2_dqC2OaG2Oe_fsCHjV73RUKEyKpKpYX38yQ@mail.gmail.com>

On Fri, Mar 7, 2014 at 3:26 AM, Michal Hoftich <michal.h21 at gmail.com> wrote:
> Hi Stefano,
>
> tex4ht works with LuaLaTeX, but no htlualatex script is provided by
> default.  There are some conflicts between tex4ht and babel, but these
> errors don't affect output, only compilation is stoped.
> To workaround problems with babel, making local copy of html4.4ht file
> and converting it to utf8 encoding should help. Note that polyglossia
> doesn't work, because it loads fontspec and opentype fonts (or, more
> precisely, fonts without tfm table) don't work with tex4ht dvi to xml
> converter.
>
> Regarding direct conversion conversion from LuaLaTeX to xml without
> need to use dvi processing, it is possible. I created simple demo, or
> proof of concept [1]. Not all things supported by tex4ht works, but as
> you can see, fontspec works without the need of patching.
>
> PS.
> Note that make4ht [2] is not the same thing as mk4ht, it is simple
> build tool which enables configuration of commands used for conversion
> of images, post-processig generated files etc.
>

Hi Michal,

thanks for your suggestions. Both the approaches you suggested sound
very promising.
I haven't tried either yet, but I will definitely look into them
closely in the near future.
The direct Luatex-->XML approach you provided a proof of concept for
would definitely be my choice,
but I admit it seems quite a challenging task to bring over all the
Latex features I would like to see in the final XML output.

There is something I am not quite sure about: where is the conversion
from latex commands to html code configured?
In tex4ht that happens in the .4ht files corresponding to the single
packages, if I'm not mistaken.
Are you relying on the same .4ht files?

Stefano




-- 
__________________________________________________
Stefano Franchi
Associate Research Professor
Department of Hispanic Studies         Ph:   +1 (979) 845-2125
Texas A&M University                          Fax:  +1 (979) 845-6421
College Station, Texas, USA

stefano at tamu.edu
http://stefano.cleinias.org


From michal.h21 at gmail.com  Tue Mar 11 17:05:07 2014
From: michal.h21 at gmail.com (Michal Hoftich)
Date: Tue, 11 Mar 2014 17:05:07 +0100
Subject: [luatex] XML export from Latex
In-Reply-To: <CAJODLwbwsjEXhm2_dqC2OaG2Oe_fsCHjV73RUKEyKpKpYX38yQ@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
 <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
 <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>
 <CAOCj1Oduw=fbmRSQ-N9rKq6vqBwoFkkVs-p3TkjmOfBH9NT+_A@mail.gmail.com>
 <CAJODLwbwsjEXhm2_dqC2OaG2Oe_fsCHjV73RUKEyKpKpYX38yQ@mail.gmail.com>
Message-ID: <CAOCj1OfsRE_Km-QxqM=ARaNpYC04Hn4rOcGUOEK7zDcz6HCT1Q@mail.gmail.com>

Hi Stefano,

yes I am relying on .4ht files provided by tex4ht, tex4ht.sty is
loaded by lua4ht.sty in the case it wasn't loaded by calling script
(like `make4ht -lun -m draft filename`). So this means that you still
need to provide .4ht files in order to insert html tags.

But because lua4ht has full access to nodes created by luatex, some
interesting things are possible. I am exploring possibility of using
`mlist_to_hlist` callback to convert math nodes to mathml, because
mathml implementation in tex4ht depends on some tricks with dvi file
and I don't know whether these tricks are possible to emulate in node
callbacks. Other things which may be possible and which are not
supported with tex4ht is support for vertical skips and rules.

Best regards,
Michal





2014-03-10 20:18 GMT+01:00 stefano franchi <stefano.franchi at gmail.com>:
> On Fri, Mar 7, 2014 at 3:26 AM, Michal Hoftich <michal.h21 at gmail.com> wrote:
>> Hi Stefano,
>>
>> tex4ht works with LuaLaTeX, but no htlualatex script is provided by
>> default.  There are some conflicts between tex4ht and babel, but these
>> errors don't affect output, only compilation is stoped.
>> To workaround problems with babel, making local copy of html4.4ht file
>> and converting it to utf8 encoding should help. Note that polyglossia
>> doesn't work, because it loads fontspec and opentype fonts (or, more
>> precisely, fonts without tfm table) don't work with tex4ht dvi to xml
>> converter.
>>
>> Regarding direct conversion conversion from LuaLaTeX to xml without
>> need to use dvi processing, it is possible. I created simple demo, or
>> proof of concept [1]. Not all things supported by tex4ht works, but as
>> you can see, fontspec works without the need of patching.
>>
>> PS.
>> Note that make4ht [2] is not the same thing as mk4ht, it is simple
>> build tool which enables configuration of commands used for conversion
>> of images, post-processig generated files etc.
>>
>
> Hi Michal,
>
> thanks for your suggestions. Both the approaches you suggested sound
> very promising.
> I haven't tried either yet, but I will definitely look into them
> closely in the near future.
> The direct Luatex-->XML approach you provided a proof of concept for
> would definitely be my choice,
> but I admit it seems quite a challenging task to bring over all the
> Latex features I would like to see in the final XML output.
>
> There is something I am not quite sure about: where is the conversion
> from latex commands to html code configured?
> In tex4ht that happens in the .4ht files corresponding to the single
> packages, if I'm not mistaken.
> Are you relying on the same .4ht files?
>
> Stefano
>
>
>
>
> --
> __________________________________________________
> Stefano Franchi
> Associate Research Professor
> Department of Hispanic Studies         Ph:   +1 (979) 845-2125
> Texas A&M University                          Fax:  +1 (979) 845-6421
> College Station, Texas, USA
>
> stefano at tamu.edu
> http://stefano.cleinias.org
>


From stefano.franchi at gmail.com  Tue Mar 11 17:47:43 2014
From: stefano.franchi at gmail.com (stefano franchi)
Date: Tue, 11 Mar 2014 11:47:43 -0500
Subject: [luatex] XML export from Latex
In-Reply-To: <CAOCj1OfsRE_Km-QxqM=ARaNpYC04Hn4rOcGUOEK7zDcz6HCT1Q@mail.gmail.com>
References: <CAMy5z4f=ZYZ91K_NF7r8xqytiepDkA_5o7-eV9FawLddmfY8Dg@mail.gmail.com>
 <CAOCj1OeGwHDvJF2CfsBZy7t0kZL4V0D1V47jg5bWHwQXqrXB-w@mail.gmail.com>
 <CAJODLwav_rv=Dta2VHjMP=xid4gQKbs4=a6Jo0rC0HkUYeYzWg@mail.gmail.com>
 <CAOCj1Oduw=fbmRSQ-N9rKq6vqBwoFkkVs-p3TkjmOfBH9NT+_A@mail.gmail.com>
 <CAJODLwbwsjEXhm2_dqC2OaG2Oe_fsCHjV73RUKEyKpKpYX38yQ@mail.gmail.com>
 <CAOCj1OfsRE_Km-QxqM=ARaNpYC04Hn4rOcGUOEK7zDcz6HCT1Q@mail.gmail.com>
Message-ID: <CAJODLwZ7=2OPx3wmg2LQ-4tKb77C9Ag_zc_hYvNehqaR0biE6A@mail.gmail.com>

On Tue, Mar 11, 2014 at 11:05 AM, Michal Hoftich <michal.h21 at gmail.com> wrote:
> Hi Stefano,
>
> yes I am relying on .4ht files provided by tex4ht, tex4ht.sty is
> loaded by lua4ht.sty in the case it wasn't loaded by calling script
> (like `make4ht -lun -m draft filename`). So this means that you still
> need to provide .4ht files in order to insert html tags.
>

Hi Michal,

thanks for your reply. This is actually very good news for me. I am
working with the LyX project within the context of GSOC 2014 to
provide a (LyX)/LaTeX export to (and possibly round-trip from)
Word/ODT XML formats. As many before me have realized, the only
practical solution is to go through tex4ht to have TeX iteself do the
processing and then process the results. However, we have found
several problems in tex4ht's  XML output that need to be fixed by
operating on the 4ht styles. So our first order of business is to get
those right.
Eventually, though, we would like to move beyond the current state of
tex4ht and move to Luatex, for the reasons you detail in your posting,
the fontspec issue, and so. It is very good news to hear that our
current work at the .4ht style level will not be lost in the mi-term
scenario.

> But because lua4ht has full access to nodes created by luatex, some
> interesting things are possible. I am exploring possibility of using
> `mlist_to_hlist` callback to convert math nodes to mathml, because
> mathml implementation in tex4ht depends on some tricks with dvi file
> and I don't know whether these tricks are possible to emulate in node
> callbacks. Other things which may be possible and which are not
> supported with tex4ht is support for vertical skips and rules.


This is something we are looking forward to. Hopefully by the end of
the summer we can start contributing to this project.

Best,

Stefano


-- 
__________________________________________________
Stefano Franchi
Associate Research Professor
Department of Hispanic Studies         Ph:   +1 (979) 845-2125
Texas A&M University                          Fax:  +1 (979) 845-6421
College Station, Texas, USA

stefano at tamu.edu
http://stefano.cleinias.org


From luatex at nililand.de  Wed Mar 12 17:04:03 2014
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 12 Mar 2014 17:04:03 +0100
Subject: [luatex] luaotfload: Random font changes with mode=base
Message-ID: <i8shwidio73e.dlg@nililand.de>

If I compile this document more than once (I think I have now
compiled it and similar documents around 200 times ;-))

\documentclass{scrreprt}
\usepackage{luaotfload}
\font\sup={name:Linux Libertine O:+onum;+sups;mode=base}
\begin{document}
abc\sup123467
\end{document}

then in around 50% of the pdf the numbers are (as wanted)
superscripts, and in the other pdf the numbers are normal old style
numbers. 

I can accept that you can't combine onum + sups, but why is the
result so random? (with mode=node +sups wins always).

(Btw: The starting point was a real document which used oldstyle
numbers together with the realscript package.)



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/



From Philipp.Gesang at alumni.uni-heidelberg.de  Wed Mar 12 20:31:30 2014
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Wed, 12 Mar 2014 20:31:30 +0100
Subject: [luatex] luaotfload: Random font changes with mode=base
In-Reply-To: <i8shwidio73e.dlg@nililand.de>
References: <i8shwidio73e.dlg@nililand.de>
Message-ID: <20140312193130.GA19304@acheron>

Hi Ulrike!

???<Datum: Wednesday, 12. March 2014>???<Von: Ulrike Fischer>???

> If I compile this document more than once (I think I have now
> compiled it and similar documents around 200 times ;-))
> 
> \documentclass{scrreprt}
> \usepackage{luaotfload}
> \font\sup={name:Linux Libertine O:+onum;+sups;mode=base}
> \begin{document}
> abc\sup123467
> \end{document}
> 
> then in around 50% of the pdf the numbers are (as wanted)
> superscripts, and in the other pdf the numbers are normal old style
> numbers. 

Confirmed for version 0.78.2 (4746) and the most recent
fontloader as part of Context, version 2014.03.07 11:42.

Here?s the code for Plain and Context:

    https://bitbucket.org/phg/lua-la-tex-tests/src/5460c0b7718a49f4831adacd84b9791e10e305f1/pln-superscript-textfigures-1.tex
    https://bitbucket.org/phg/lua-la-tex-tests/src/47f2f2e7dcd605a8744357aa9a7996ec9525e75c/cnt-superscript-textfigures-1.tex

> I can accept that you can't combine onum + sups, but why is the
> result so random?

Lua makes no guarantees about the order of indexes on the hash
part of tables. The behavior you observed is consistent with the
feature strings being used as indices (which indeed they are) and
then iterated over with next().

>                   (with mode=node +sups wins always).

No idea why. Xetex appears to prefer onum ?

Best regards,
Philipp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 490 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20140312/a3af91fd/attachment.bin>

From khaledhosny at eglug.org  Thu Mar 13 02:08:48 2014
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 13 Mar 2014 03:08:48 +0200
Subject: [luatex] luaotfload: Random font changes with mode=base
In-Reply-To: <20140312193130.GA19304@acheron>
References: <i8shwidio73e.dlg@nililand.de> <20140312193130.GA19304@acheron>
Message-ID: <20140313010848.GA13051@khaled-laptop>

On Wed, Mar 12, 2014 at 08:31:30PM +0100, Philipp Gesang wrote:
> Hi Ulrike!
> 
> ???<Datum: Wednesday, 12. March 2014>???<Von: Ulrike Fischer>???
> 
> > If I compile this document more than once (I think I have now
> > compiled it and similar documents around 200 times ;-))
> > 
> > \documentclass{scrreprt}
> > \usepackage{luaotfload}
> > \font\sup={name:Linux Libertine O:+onum;+sups;mode=base}
> > \begin{document}
> > abc\sup123467
> > \end{document}
> > 
> > then in around 50% of the pdf the numbers are (as wanted)
> > superscripts, and in the other pdf the numbers are normal old style
> > numbers. 
> 
> Confirmed for version 0.78.2 (4746) and the most recent
> fontloader as part of Context, version 2014.03.07 11:42.
> 
> Here?s the code for Plain and Context:
> 
>     https://bitbucket.org/phg/lua-la-tex-tests/src/5460c0b7718a49f4831adacd84b9791e10e305f1/pln-superscript-textfigures-1.tex
>     https://bitbucket.org/phg/lua-la-tex-tests/src/47f2f2e7dcd605a8744357aa9a7996ec9525e75c/cnt-superscript-textfigures-1.tex
> 
> > I can accept that you can't combine onum + sups, but why is the
> > result so random?
> 
> Lua makes no guarantees about the order of indexes on the hash
> part of tables. The behavior you observed is consistent with the
> feature strings being used as indices (which indeed they are) and
> then iterated over with next().
> 
> >                   (with mode=node +sups wins always).
> 
> No idea why. Xetex appears to prefer onum ?

Which feature wins depends on several factors (some features should be
processed before others per the OpenType standard, the order of the
lookups in the font, and how the font developer designed its features),
the order of the features in the font definition is irrelevant except
when a feature is specified multiple times (e.g. +onum;-onum), then the
last one takes precedence.

Regards,
Khaled
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20140313/9086b803/attachment.bin>

From luatex at nililand.de  Thu Mar 13 10:40:45 2014
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 13 Mar 2014 10:40:45 +0100
Subject: [luatex] luaotfload: Random font changes with mode=base
References: <i8shwidio73e.dlg@nililand.de> <20140312193130.GA19304@acheron>
Message-ID: <7nry3qutgdrl$.dlg@nililand.de>

Am Wed, 12 Mar 2014 20:31:30 +0100 schrieb Philipp Gesang:

>> If I compile this document more than once (I think I have now
>> compiled it and similar documents around 200 times ;-))
>> 
>> \documentclass{scrreprt}
>> \usepackage{luaotfload}
>> \font\sup={name:Linux Libertine O:+onum;+sups;mode=base}
>> \begin{document}
>> abc\sup123467
>> \end{document}
>> 
>> then in around 50% of the pdf the numbers are (as wanted)
>> superscripts, and in the other pdf the numbers are normal old style
>> numbers. 
> 
> Confirmed for version 0.78.2 (4746) and the most recent
> fontloader as part of Context, version 2014.03.07 11:42.
> 
> Here?s the code for Plain and Context:
> 
>     https://bitbucket.org/phg/lua-la-tex-tests/src/5460c0b7718a49f4831adacd84b9791e10e305f1/pln-superscript-textfigures-1.tex
>     https://bitbucket.org/phg/lua-la-tex-tests/src/47f2f2e7dcd605a8744357aa9a7996ec9525e75c/cnt-superscript-textfigures-1.tex
> 
>> I can accept that you can't combine onum + sups, but why is the
>> result so random?
> 
> Lua makes no guarantees about the order of indexes on the hash
> part of tables. The behavior you observed is consistent with the
> feature strings being used as indices (which indeed they are) and
> then iterated over with next().

Ah. This makes sense. That's the first time that I had to make a
statistic while debugging a problem ;-). 


>>                   (with mode=node +sups wins always).
 
> No idea why. Xetex appears to prefer onum ?

Perhaps because of the order. I didn't make tests with xelatex (but
I remember from an old discussion that conflicting features like
+onum,-onum can be difficult there too).

But this problems shows again that \addfontfeatures is a bit
problematic -- and that one needs a "\removefontfeatures". 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/




From Arno.Trautmann at gmx.de  Mon Mar 24 22:31:32 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Mon, 24 Mar 2014 22:31:32 +0100
Subject: [luatex] What happens to glyphs not in the font?
Message-ID: <5330A434.4010604@gmx.de>

Hi all,

this might be a quite strange question, but it bothers me for some time 
now: What happens when I input a character that is not available in the 
current font?

Consider the following minimal example:

\pdfcompresslevel0
a?a
\bye

In the pdf, I only get the ?aa? as expected. However, for a long time 
now I thought, the ??? would still make its way into the pdf but would 
just not be shown by the viewer. Loading a font, e.g. by using fontspec, 
the ? of course is there. So I inspected the pdf (hence 
\pdfcompresslevel0) and indee I see:

/F15 9.96264 Tf 1 0 0 1 91.925 759.927 Tm [(aa)]TJ

But when I look into some callbacks, I see that still in the 
pre_output_filter the ? node is present, with the width 0 which makes 
sense to me.

So, at what point is the information lost that there is an additional 
glyph node?

cheers
Arno



From martin at oneiros.de  Tue Mar 25 11:55:04 2014
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 25 Mar 2014 11:55:04 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <5330A434.4010604@gmx.de>
References: <5330A434.4010604@gmx.de>
Message-ID: <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>

2014-03-24 22:31 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
> What happens when I input a character that is not available in the current
> font?

I'd expect
Missing character: There is no ? in font cmr10!
(maybe even with an "?" :)

Best
   Martin



From Arno.Trautmann at gmx.de  Tue Mar 25 22:12:10 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Tue, 25 Mar 2014 22:12:10 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
Message-ID: <5331F12A.6000408@gmx.de>

Martin Schr?der wrote:
> 2014-03-24 22:31 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
>> What happens when I input a character that is not available in the current
>> font?
>
> I'd expect
> Missing character: There is no ? in font cmr10!
> (maybe even with an "?" :)

Well ? no. The minimal example I posted compiles just fine, neither a 
warning or an error. (With an ?eszett? in case it was broken by my mail 
client?)

cheers
Arno



From arthur.reutenauer at normalesup.org  Tue Mar 25 22:34:02 2014
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 25 Mar 2014 21:34:02 +0000
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <5331F12A.6000408@gmx.de>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de>
Message-ID: <20140325213402.GH11083@phare.normalesup.org>

> Well ? no. The minimal example I posted compiles just fine, neither
> a warning or an error.

  Even in the log file?

	Arthur



From Arno.Trautmann at gmx.de  Tue Mar 25 22:51:25 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Tue, 25 Mar 2014 22:51:25 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <20140325213402.GH11083@phare.normalesup.org>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de> <20140325213402.GH11083@phare.normalesup.org>
Message-ID: <5331FA5D.2020502@gmx.de>

Arthur Reutenauer wrote:
>> Well ? no. The minimal example I posted compiles just fine, neither
>> a warning or an error.
>
>    Even in the log file?

No, nothing.

? Arno



From martin at oneiros.de  Tue Mar 25 23:22:01 2014
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 25 Mar 2014 23:22:01 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <5331F12A.6000408@gmx.de>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de>
Message-ID: <CAP7DCDeysvstf6qh+xVGeqNhHaYQEsRdyu3DtqidDoiXas=5rA@mail.gmail.com>

2014-03-25 22:12 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
> Martin Schr?der wrote:
>> I'd expect
>> Missing character: There is no ? in font cmr10!
>> (maybe even with an "?" :)
>
> Well ? no. The minimal example I posted compiles just fine, neither a
> warning or an error. (With an ?eszett? in case it was broken by my mail
> client?)

Yes, but that's clearly a bug.

Best
   Martin



From Arno.Trautmann at gmx.de  Tue Mar 25 23:32:23 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Tue, 25 Mar 2014 23:32:23 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <CAP7DCDeysvstf6qh+xVGeqNhHaYQEsRdyu3DtqidDoiXas=5rA@mail.gmail.com>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de>
 <CAP7DCDeysvstf6qh+xVGeqNhHaYQEsRdyu3DtqidDoiXas=5rA@mail.gmail.com>
Message-ID: <533203F7.40505@gmx.de>

Martin Schr?der wrote:
> 2014-03-25 22:12 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
>> Martin Schr?der wrote:
>>> I'd expect
>>> Missing character: There is no ? in font cmr10!
>>> (maybe even with an "?" :)
>>
>> Well ? no. The minimal example I posted compiles just fine, neither a
>> warning or an error. (With an ?eszett? in case it was broken by my mail
>> client?)
>
> Yes, but that's clearly a bug.

oh ? I thought it was a feature. Same happens with pdfTeX, btw.

cheers
Arno



From reinhard.kotucha at web.de  Wed Mar 26 03:16:08 2014
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 26 Mar 2014 03:16:08 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
Message-ID: <21298.14440.478660.303456@zaphod.ms25.net>

On 2014-03-25 at 11:55:04 +0100, Martin Schr?der wrote:

 > 2014-03-24 22:31 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
 > > What happens when I input a character that is not available in
 > > the current font?
 > 
 > I'd expect
 > Missing character: There is no ? in font cmr10!
 > (maybe even with an "?" :)

Well, I wouldn't expect ? in error messages.  And I wouldn't expect it
in the TeX world at all.  You certainly know this glyph from web
browsers or Harald's T-shirt ("schei? encoding"). 

I would expect either ? or ^^df, for example, in the log.

Furthermore, if TeX doesn't complain about a missing glyph then it
might be worthwhile to examine the tfm file.  Everything TeX knows
about glyphs of a particular font is in the tfm file.

  man tftopl

There might be a few things one can do wrong with dvips/pdfTeX map
files.  What happens if an entry maps an 8-bit-aware tfm file to a
7-bit font?  At which stage will this error be detected?

Regarding web browsers, I don't think that the glyph ? comes from any
font you have installed on your system.  This doesn't make sense.
I suppose that web browsers provide a dedicated font containing this
glyph.  This would be quite similar to Adobe Reader.  It's shipped
with some fonts for internal use too.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
30167 Hannover
mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------



From taco at elvenkind.com  Wed Mar 26 09:27:20 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 26 Mar 2014 09:27:20 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <533203F7.40505@gmx.de>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de>
 <CAP7DCDeysvstf6qh+xVGeqNhHaYQEsRdyu3DtqidDoiXas=5rA@mail.gmail.com>
 <533203F7.40505@gmx.de>
Message-ID: <39C9CA20-A514-43EA-9D1F-594FC5381B54@elvenkind.com>

Hi,

On 25 Mar 2014, at 23:32, Arno Trautmann <Arno.Trautmann at gmx.de> wrote:

> Martin Schr?der wrote:
>> 2014-03-25 22:12 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
>>> Martin Schr?der wrote:
>>>> I'd expect
>>>> Missing character: There is no ? in font cmr10!
>>>> (maybe even with an "?" :)
>>> 
>>> Well ? no. The minimal example I posted compiles just fine, neither a
>>> warning or an error. (With an ?eszett? in case it was broken by my mail
>>> client?)
>> 
>> Yes, but that's clearly a bug.
> 
> oh ? I thought it was a feature. Same happens with pdfTeX, btw.

In pdftex you probably see nothing because it depends on the setting of
\tracinglostchars. In luatex, there was a bug, where nothing was ever
printed except in some odd cases inside math and the virtual font definition
processing.
 
I?ve committed a fix that checks during shipout and,  with \tracinglostchars=2, 
I now get this output on the terminal:

  [1{/Users/taco/context/tex/texmf/fonts/map/pdftex/plain/pdftex.map}
  Missing character: There is no ? (U+00DF) in font cmr10!
  ]

that is not completely perfectly right, because it is not really a character at 
that point, but that is mostly cosmetics, and this message is a bit easier to
comprehend than ?Missing glyph?.

Best wishes,
Taco





From martin at oneiros.de  Wed Mar 26 13:47:11 2014
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Wed, 26 Mar 2014 13:47:11 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <21298.14440.478660.303456@zaphod.ms25.net>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <21298.14440.478660.303456@zaphod.ms25.net>
Message-ID: <CAP7DCDedfuHywmfN_k_TrJcw4Mb=4wDmEsN_Fvj_msU6FGKUWA@mail.gmail.com>

2014-03-26 3:16 GMT+01:00 Reinhard Kotucha <reinhard.kotucha at web.de>:
> Furthermore, if TeX doesn't complain about a missing glyph then it
> might be worthwhile to examine the tfm file.  Everything TeX knows

Reinhard,
with the test file pdftex complains but luatex doesn't.
And the font in question is cmr10, which doesn't have a ?.

Best
   Martin



From Arno.Trautmann at gmx.de  Wed Mar 26 21:33:04 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 26 Mar 2014 21:33:04 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <CAP7DCDedfuHywmfN_k_TrJcw4Mb=4wDmEsN_Fvj_msU6FGKUWA@mail.gmail.com>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <21298.14440.478660.303456@zaphod.ms25.net>
 <CAP7DCDedfuHywmfN_k_TrJcw4Mb=4wDmEsN_Fvj_msU6FGKUWA@mail.gmail.com>
Message-ID: <53333980.5050006@gmx.de>

Martin Schr?der wrote:
> 2014-03-26 3:16 GMT+01:00 Reinhard Kotucha <reinhard.kotucha at web.de>:
>> Furthermore, if TeX doesn't complain about a missing glyph then it
>> might be worthwhile to examine the tfm file.  Everything TeX knows
>
> Reinhard,
> with the test file pdftex complains but luatex doesn't.

Huh, that's interesting because neither one does on my machine. (Arch 
Linux x86_64, TeX Live 2013,

This is pdfTeX, Version 3.1415926-2.5-1.40.14 (TeX Live 2013)
This is LuaTeX, Version beta-0.76.0-2013061708 (rev 4627)

That's why I assumed it's a TeX feature ?

cheers
Arno



From Arno.Trautmann at gmx.de  Wed Mar 26 21:47:31 2014
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 26 Mar 2014 21:47:31 +0100
Subject: [luatex] What happens to glyphs not in the font?
In-Reply-To: <39C9CA20-A514-43EA-9D1F-594FC5381B54@elvenkind.com>
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <5331F12A.6000408@gmx.de>
 <CAP7DCDeysvstf6qh+xVGeqNhHaYQEsRdyu3DtqidDoiXas=5rA@mail.gmail.com>
 <533203F7.40505@gmx.de> <39C9CA20-A514-43EA-9D1F-594FC5381B54@elvenkind.com>
Message-ID: <53333CE3.2020101@gmx.de>

Taco Hoekwater wrote:
> Hi,
>
> On 25 Mar 2014, at 23:32, Arno Trautmann <Arno.Trautmann at gmx.de> wrote:
>
>> Martin Schr?der wrote:
>>> 2014-03-25 22:12 GMT+01:00 Arno Trautmann <Arno.Trautmann at gmx.de>:
>>>> Martin Schr?der wrote:
>>>>> I'd expect
>>>>> Missing character: There is no ? in font cmr10!
>>>>> (maybe even with an "?" :)
>>>>
>>>> Well ? no. The minimal example I posted compiles just fine, neither a
>>>> warning or an error. (With an ?eszett? in case it was broken by my mail
>>>> client?)
>>>
>>> Yes, but that's clearly a bug.
>>
>> oh ? I thought it was a feature. Same happens with pdfTeX, btw.
>
> In pdftex you probably see nothing because it depends on the setting of
> \tracinglostchars.

Seems to be 1 in my case. As far as I understand the TeXbook, I would 
expect some record then?

> In luatex, there was a bug, where nothing was ever
> printed except in some odd cases inside math and the virtual font definition
> processing.
>
> I?ve committed a fix that checks during shipout and,  with \tracinglostchars=2,
> I now get this output on the terminal:
>
>    [1{/Users/taco/context/tex/texmf/fonts/map/pdftex/plain/pdftex.map}
>    Missing character: There is no ? (U+00DF) in font cmr10!
>    ]
>
> that is not completely perfectly right, because it is not really a character at
> that point, but that is mostly cosmetics, and this message is a bit easier to
> comprehend than ?Missing glyph?.

That's nice. Thanks for explaining and fixing! (Although I'm not sure 
what exactly the best behaviour would be here ?)

cheers
Arno



From luatex at nililand.de  Thu Mar 27 10:20:44 2014
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 27 Mar 2014 10:20:44 +0100
Subject: [luatex] What happens to glyphs not in the font?
References: <5330A434.4010604@gmx.de>
 <CAP7DCDeB+VyP0c2oBXwYuPLQAZHZ6SaDn6wJKcY1o1ObEey3Ng@mail.gmail.com>
 <21298.14440.478660.303456@zaphod.ms25.net>
Message-ID: <vb6svprp4ttz.dlg@nililand.de>

Am Wed, 26 Mar 2014 03:16:08 +0100 schrieb Reinhard Kotucha:

> There might be a few things one can do wrong with dvips/pdfTeX map
> files.  What happens if an entry maps an 8-bit-aware tfm file to a
> 7-bit font?  At which stage will this error be detected?

latex wouldn't realize it. But dvips gives a warning:
Warning: module writet1 of dvips (file cmr10.pfb): glyph `Eng'
undefined

pdflatex gives a warning too:

\documentclass{article}
\usepackage[T1]{fontenc}
\pdfmapline{=ecrm1000 SFRM1000 " T1Encoding ReEncodeFont "
<cm-super-t1.enc <cmr10.pfb}
\begin{document}
abc\symbol{"8D}
\end{document}

gives

pdfTeX warning: pdflatex.exe (file
D:/MiKTeX2.9/fonts/type1/public/amsfonts/cm/
cmr10.pfb): glyph `Eng' undefined

But naturally only at the end of the compilation when the fonts are
included. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/



From h_kitagawa2001 at yahoo.co.jp  Thu Mar 27 14:54:51 2014
From: h_kitagawa2001 at yahoo.co.jp (Hironori KITAGAWA)
Date: Thu, 27 Mar 2014 22:54:51 +0900
Subject: [luatex] Assigning shrink_order of glue_spec in LuaTeX r4917
Message-ID: <53342DAB.8050408@yahoo.co.jp>

Hi,

I typeset the following test.tex by LuaTeX r4917:
===
\directlua{
   local s = node.new( node.id('glue_spec') )
   s.width = 65536
   s.stretch_order, s.stretch = 1, 10000
   s.shrink_order, s.shrink = 2, 655360
   tex.setskip(0, s)
}
\showthe\skip0
\bye
===
Then, I got
===
$ mtxrun --script plain test
...
 > 1.0pt plus 0.15259fi minus 10.0pt.
l.9 \showthe\skip0
===
which should be "... minus 10.0fil", I think.

Regards
Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>


From zappathustra at free.fr  Fri Mar 28 08:06:27 2014
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 28 Mar 2014 08:06:27 +0100
Subject: [luatex] Assigning shrink_order of glue_spec in LuaTeX r4917
In-Reply-To: <53342DAB.8050408@yahoo.co.jp>
References: <53342DAB.8050408@yahoo.co.jp>
Message-ID: <20140328060630.64B969400C9@smtp1-g21.free.fr>

Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp> a ?crit:
> I typeset the following test.tex by LuaTeX r4917:
> ===
> \directlua{
>    local s = node.new( node.id('glue_spec') )
>    s.width = 65536
>    s.stretch_order, s.stretch = 1, 10000
>    s.shrink_order, s.shrink = 2, 655360
>    tex.setskip(0, s)
> }
> \showthe\skip0
> \bye
> ===
> Then, I got
> ===
> $ mtxrun --script plain test
> ...
>  > 1.0pt plus 0.15259fi minus 10.0pt.
> l.9 \showthe\skip0
> ===
> which should be "... minus 10.0fil", I think.

Yes, you?ve got a problem here; more generally, you can?t write to
?shrink_order?:

    \skip0=0pt plus 1fi minus 1fil
    \directlua{
       local x = tex.getskip(0)
       x.shrink_order = 0
       texio.write_nl(x.shrink_order)
    }
    \bye

?2? is printed, it should be ?0?. With ?stretch_order?, things are ok.

So, you should pay a visit to: http://tracker.luatex.org.

Best,
Paul



From taco at elvenkind.com  Fri Mar 28 16:43:21 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 28 Mar 2014 16:43:21 +0100
Subject: [luatex] Luatex 0.79.0 announcement
Message-ID: <53359899.6050709@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.79.0.
This fixes a few of the outstanding bugs, and is the version that
will be included in TeXLive 2014.

Changes:

* The luafontloader now returns 'tsidebearing' glyph values
   for OT/TT fonts, if applicable.

* new lua variables: stats.luatex_hashtype, stats.luatex_hashchars,
   stats.lastluaerrorstring; the luajittex string hash method is now
   lua 5.1 compliant which gives better results for similar strings

* new lua functions: tex.init_rand(), tex.uniform_rand(),
   tex.normal_rand(), tex.lua_math_randomseed(), tex.lua_math_random(),
   tex.show_context(); these helpers make luatex and luajittex compatible

* In the lua node interface, there were often issues with rubbish
   in (especially) 'prev' fields because luatex itself never looks
   at those values. This is now cleaned up to prevent weird stuff
   happening inside lua node processing code.

* pdf.pageattributes, pdf.pagesattributes, pdf.info, pdf.catalog,
   pdf.names and pdf.trailer now behave consistent and can be used
   to add these properties at the lua end in addition to their \pdf*
   counterparts atthe tex end; there are now pdf.get* and pdf.set*
   commands for them too (in future versions the old ways can become
   obsolete)

* new accessors pdf.geth, pdfgetv, pdfgetpos, getgetmatrix as well
   as pdfhasmatrix helpers (in future versions the direct pdf.h and
   pdf.v accessor can become obsolete)

* the pdf.pdf* variables have been removed (they were already
   obsolete for some years)

* a new properties mechanism for associating lua tables with nodes
   that get cleaned up when nodes a freed (see manual for details)

* several improvements to the way temporary (backend) data is stored
   at the lua end (better protection, more consistent)

* a 'l' type for user nodes that holds a lua variable (can be set
   at the lua end)

* if a late lua node is set at the lua end the string value can be
   a function as well which is then executed during serialization to
   the backend stream

* Various small speedups

* Various smallish fixes to the node direct interface

* LPeg is now at version 0.12

* Some small fixes to the CFF (font) parsing

* Font file inclusion reporting messages on the terminal now
   comply to the texconfig.trace_file_names setting

* Removed some of the additional luafontloader.info() return
   information that was added in 0.78.2, but could not work
   properly.

* new primitive \luafunction (see manual), with associated
   lua.get_functions_table() function

* lua error message reporting has been altered a bit to make
   the distinction between \directlua and other lua source code
   sources clearer

* Additional pdf document data functionality in the 'pdf' table
   has been cleaned up internally

* Additional pdf destination names can now be set via lua.

* New callbacks: finish_pdfpage, show_error_message,
   show_lua_error_hook, start_file, stop_file

* Handling of \tracinglostchars is fixed

* Embedded metapost library version is now 1.900

* luajittex is now included in the distribution. One can use
   buildjit.sh to build both luatex and luajittex, where
   supported by the platform

* Synchronization with the TeXLive sources updated the following
   libraries:
   * libpng is now 1.6.10
   * poppler is now 0.25.2


The archives can be downloaded from supelec as usual:

         https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

   svn co --username anonsvn --password anonsvn              \
       https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,

Taco


From elie.roux at telecom-bretagne.eu  Fri Mar 28 18:09:25 2014
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Fri, 28 Mar 2014 18:09:25 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <53359899.6050709@elvenkind.com>
References: <53359899.6050709@elvenkind.com>
Message-ID: <5335ACC5.8070202@telecom-bretagne.eu>

Dear Taco,

Thank you very much for this very exciting version!

I've just tried to test it, but the compilation failed with

../../../source/texk/web2c/luatexdir/lua/luanode.w:63:1: error:
conflicting types for ?lua_node_filter_s?
 lua_node_filter_s(int filterid, int extrainfo)
 ^
In file included from
../../../source/texk/web2c/luatexdir/lua/luanode.w:28:0:
../../../source/texk/web2c/luatexdir/ptexlib.h:258:6: note: previous
declaration of ?lua_node_filter_s? was here
 void lua_node_filter_s(int filterid, const char *extrainfo);

I had to apply the attached patch to make everything compile and (seem
to) work... I'm sorry for the noise if I'm not the first one to tell you
this (I'm not on dev-context mailing-list).

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: patch-luatex-079.diff
Type: text/x-patch
Size: 667 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20140328/14c13a25/attachment.bin>

From luigi.scarso at gmail.com  Fri Mar 28 18:52:17 2014
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 28 Mar 2014 18:52:17 +0100
Subject: [luatex] [Dev-luatex]  Luatex 0.79.0 announcement
In-Reply-To: <5335ACC5.8070202@telecom-bretagne.eu>
References: <53359899.6050709@elvenkind.com>
 <5335ACC5.8070202@telecom-bretagne.eu>
Message-ID: <CAG5iGsA2GceMkMivtPLwTT1LV7esT7_CQVoUx8Ns6P98uWkGdg@mail.gmail.com>

On Fri, Mar 28, 2014 at 6:09 PM, ?lie Roux <elie.roux at telecom-bretagne.eu>wrote:

> Dear Taco,
>
> Thank you very much for this very exciting version!
>
> I've just tried to test it, but the compilation failed with
>
> ../../../source/texk/web2c/luatexdir/lua/luanode.w:63:1: error:
> conflicting types for ?lua_node_filter_s?
>  lua_node_filter_s(int filterid, int extrainfo)
>  ^
> In file included from
> ../../../source/texk/web2c/luatexdir/lua/luanode.w:28:0:
> ../../../source/texk/web2c/luatexdir/ptexlib.h:258:6: note: previous
> declaration of ?lua_node_filter_s? was here
>  void lua_node_filter_s(int filterid, const char *extrainfo);
>
> I had to apply the attached patch to make everything compile and (seem
> to) work... I'm sorry for the noise if I'm not the first one to tell you
> this (I'm not on dev-context mailing-list).
>
> Thank you,
> --
> Elie
>
> _______________________________________________
> dev-luatex mailing list
> dev-luatex at ntg.nl
> http://www.ntg.nl/mailman/listinfo/dev-luatex
>
>
rev 4965 should be ok.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140328/30ce2e6f/attachment.html>

From elie.roux at telecom-bretagne.eu  Fri Mar 28 19:19:20 2014
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Fri, 28 Mar 2014 19:19:20 +0100
Subject: [luatex] [Dev-luatex]  Luatex 0.79.0 announcement
In-Reply-To: <CAG5iGsA2GceMkMivtPLwTT1LV7esT7_CQVoUx8Ns6P98uWkGdg@mail.gmail.com>
References: <53359899.6050709@elvenkind.com>
 <5335ACC5.8070202@telecom-bretagne.eu>
 <CAG5iGsA2GceMkMivtPLwTT1LV7esT7_CQVoUx8Ns6P98uWkGdg@mail.gmail.com>
Message-ID: <5335BD28.9020605@telecom-bretagne.eu>

> rev 4965 should be ok.

Ok thanks!

Out of curiosity: are there plans to have a luajittex, luajitlatex, etc.
commands and formats in TeXLive?

Also, luajittex recompiles the format (lualatex.fmt) at each compilation
though I built it with fmtutil and fmtutil-sys... I believe there is a
file to replace somewhere for kpathsea?

Finally, if I try to compile with luajitex I get:

Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
(/usr/share/texlive/texmf-dist/tex/latex/base/size11.clo))
(./testluajitex.aux)
[1{/var/lib/texmf/fonts/map/pdftex/updmap/pdftex.map}] (./testluajitex.aux))
 264 words of node memory still in use:
   2 hlist, 1 vlist, 1 rule, 2 glue, 40 glue_spec, 1 write nodes
   avail lists: 2:12,3:2,4:22,6:13,7:1,9:6
<</usr/share/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
Program received signal SIGSEGV, Segmentation fault.
0x00000000004beb59 in pdf_print_info (pdf=0x1fa8900, luatexversion=79,
luatexrevision=48) at ../../../source/texk/web2c/luatexdir/pdf/pdfgen.w:2287
2287	    if (strlen(p) > 0) {

the attached patch fixes this.

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luajitex-segfault.diff
Type: text/x-patch
Size: 923 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20140328/4f60b2fe/attachment-0001.bin>

From j.tosovsky at email.cz  Fri Mar 28 19:23:10 2014
From: j.tosovsky at email.cz (Jan Tosovsky)
Date: Fri, 28 Mar 2014 19:23:10 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <53359899.6050709@elvenkind.com>
References: <53359899.6050709@elvenkind.com>
Message-ID: <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>

On 2014-03-28 Taco Hoekwater wrote:
>
> I have just uploaded the archives for a new luatex release, 0.79.0.
> This fixes a few of the outstanding bugs, and is the version that
> will be included in TeXLive 2014.

Thanks for that!

Btw, has anybody any idea where the following 'dotlessi' patch has been
lost?

http://www.ntg.nl/pipermail/ntg-context/2013/076306.html

It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on Windows
7

But it stop to work in February:

http://permalink.gmane.org/gmane.comp.tex.context/86322

Together with the version switch 0.77 -> 0.78/0.79 ?

Is there any chance to include this patch in TeXLive version?

Thanks, Jan



From pragma at wxs.nl  Fri Mar 28 23:28:52 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 28 Mar 2014 23:28:52 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
Message-ID: <5335F7A4.6050700@wxs.nl>

On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
> On 2014-03-28 Taco Hoekwater wrote:
>>
>> I have just uploaded the archives for a new luatex release, 0.79.0.
>> This fixes a few of the outstanding bugs, and is the version that
>> will be included in TeXLive 2014.
>
> Thanks for that!
>
> Btw, has anybody any idea where the following 'dotlessi' patch has been
> lost?
>
> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
>
> It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on Windows
> 7

because it was not okay (too much fuzziness and dead slow too) ... it 
might be that i can cook up a version at the context end (like an 
overload) so if needed bring it up on the context list

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From j.tosovsky at email.cz  Sat Mar 29 07:51:20 2014
From: j.tosovsky at email.cz (Jan Tosovsky)
Date: Sat, 29 Mar 2014 07:51:20 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <5335F7A4.6050700@wxs.nl>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz> <5335F7A4.6050700@wxs.nl>
Message-ID: <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>

On 2014-03-28 Hans Hagen wrote:
> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
> > On 2014-03-28 Taco Hoekwater wrote:
> >>
> >> I have just uploaded the archives for a new luatex release, 0.79.0.
> >> This fixes a few of the outstanding bugs, and is the version that
> >> will be included in TeXLive 2014.
> >
> > Thanks for that!
> >
> > Btw, has anybody any idea where the following 'dotlessi' patch has
> > been lost?
> >
> > http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
> >
> > It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
> > Windows 7
> 
> because it was not okay (too much fuzziness and dead slow too) ... 

Sad to hear that. I thought the patch was about removing duplicates when
building the initial glyph table and didn't expected these severe side
effects...

> might be that i can cook up a version at the context end (like an
> overload)

>From my POV the font handling is a very low level part and should be kept in
luatex...

Thanks, Jan



From taco at elvenkind.com  Sat Mar 29 09:01:38 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 29 Mar 2014 09:01:38 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
 <5335F7A4.6050700@wxs.nl> <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
Message-ID: <53367DE2.8090006@elvenkind.com>

On 03/29/2014 07:51 AM, Jan Tosovsky wrote:
>
> From my POV the font handling is a very low level part and should be kept in
> luatex...

I agree with that in principle, but it needs some amount of work at
to fix it in the engine. Meanwhile, a lua solution would be better
than nothing.

Best wishes,
Taco



From taco at elvenkind.com  Sat Mar 29 08:53:36 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 29 Mar 2014 08:53:36 +0100
Subject: [luatex] [Dev-luatex]  Luatex 0.79.0 announcement
In-Reply-To: <5335BD28.9020605@telecom-bretagne.eu>
References: <53359899.6050709@elvenkind.com>
 <5335ACC5.8070202@telecom-bretagne.eu>
 <CAG5iGsA2GceMkMivtPLwTT1LV7esT7_CQVoUx8Ns6P98uWkGdg@mail.gmail.com>
 <5335BD28.9020605@telecom-bretagne.eu>
Message-ID: <53367C00.1050102@elvenkind.com>

On 03/28/2014 07:19 PM, ?lie Roux wrote:
> Program received signal SIGSEGV, Segmentation fault.
> 0x00000000004beb59 in pdf_print_info (pdf=0x1fa8900, luatexversion=79,
> luatexrevision=48) at ../../../source/texk/web2c/luatexdir/pdf/pdfgen.w:2287
> 2287	    if (strlen(p) > 0) {
>
> the attached patch fixes this.

Applied by Luigi. There will be a new release momentarily.

Best wishes,
Taco





From mojca.miklavec.lists at gmail.com  Sat Mar 29 09:18:13 2014
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sat, 29 Mar 2014 09:18:13 +0100
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <53366db0.46250e0a.7e7d.ffffe4b8SMTPIN_ADDED_BROKEN@mx.google.com>
References: <53359899.6050709@elvenkind.com>	<5335F7A4.6050700@wxs.nl>
 <53366db0.46250e0a.7e7d.ffffe4b8SMTPIN_ADDED_BROKEN@mx.google.com>
Message-ID: <CALBOmsY=JK2q_wesHLBSkDD56-eE5Q5G-sTQJFRjePr_pvb+ew@mail.gmail.com>

On Sat, Mar 29, 2014 at 7:51 AM, Jan Tosovsky wrote:
> On 2014-03-28 Hans Hagen wrote:
>> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
>>
>> > Btw, has anybody any idea where the following 'dotlessi' patch has
>> > been lost?
>> >
>> > http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
>> >
>> > It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
>> > Windows 7
>>
>> because it was not okay (too much fuzziness and dead slow too) ...
>
> Sad to hear that. I thought the patch was about removing duplicates when
> building the initial glyph table and didn't expected these severe side
> effects...

I don't know if we are talking about the same "issues" (there have
been plenty of problems with building the font database), but building
the font database dropped from 45 minutes to less than a minute on my
machine. (OK, half an hour was due to a single font.) Reading the
whole font for each font in the system when building the database was
an overkill.

Some problems could be fixed per-font during font loading though. I'm
just speculating because I don't know the code. But doing an O(n^2)
comparison of glyph names on a font that covers the whole Unicode
should be avoided in principle.

Mojca


From taco at elvenkind.com  Sat Mar 29 10:01:06 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 29 Mar 2014 10:01:06 +0100
Subject: [luatex] Luatex 0.79.1 announcement
Message-ID: <53368BD2.7020307@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.79.1.

Changes:

* Fixed a bug that caused crashes if pdf.info was not set.

* The top-level build scripts have been merged again, use
     build.sh --jit
   to build luajittex as well as luatex itself

The archives can be downloaded from supelec as usual:

         https://foundry.supelec.fr/projects/luatex/

You could also check out the sources via anonymous svn:

   svn co --username anonsvn --password anonsvn              \
       https://foundry.supelec.fr/svn/luatex/tags/beta-0.79.1

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,

Taco


From mico.loretan at mac.com  Sun Mar 30 10:40:24 2014
From: mico.loretan at mac.com (Mico Loretan)
Date: Sun, 30 Mar 2014 10:40:24 +0200
Subject: [luatex] how to assign a width to a node of type "glue"
Message-ID: <27DB886C-2005-4098-8EF4-B4FB2C92F052@mac.com>

I'm trying to create a glue node that has a specific width. Unfortunately, I seem to be missing something (probably entirely trivial to somebody who knows how it's done).

Here's what I've tried so far:

local glue        = node.id ( "glue" )       -- 10
local gluespec    = node.id ( "glue_spec" )  -- 47
local gluenode    = node.new ( glue )        -- create the node
gluenode.subtype  = 0                        -- "skip"
-- what next??

I would like to make this node have a width of 0.03em (no stretchability or shrinkability needed).

The LuaTeX reference manual (p. 178) says that I should do something with the node's field called "gluenode.spec". If I understand the manual correctly, this field should be a "pointer to an item of type 'glue_spec'." However, there's no indication on how this should be done, and the explanation of glue_spec on pp. 173f. is even terser.

This is where I'm stuck for now. All help and suggestions will be much appreciated. Best, Mico


From zappathustra at free.fr  Sun Mar 30 11:10:14 2014
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 30 Mar 2014 11:10:14 +0200
Subject: [luatex] how to assign a width to a node of type "glue"
In-Reply-To: <27DB886C-2005-4098-8EF4-B4FB2C92F052@mac.com>
References: <27DB886C-2005-4098-8EF4-B4FB2C92F052@mac.com>
Message-ID: <20140330091016.4C47C8225F@smtp6-g21.free.fr>

Mico Loretan <mico.loretan at mac.com> a ?crit:
> I'm trying to create a glue node that has a specific width. Unfortunately, I seem to be missing something (probably entirely trivial to somebody who knows how it's done).
> 
> Here's what I've tried so far:
> 
> local glue        = node.id ( "glue" )       -- 10
> local gluespec    = node.id ( "glue_spec" )  -- 47
> local gluenode    = node.new ( glue )        -- create the node
> gluenode.subtype  = 0                        -- "skip"
> -- what next??
> 
> I would like to make this node have a width of 0.03em (no stretchability or shrinkability needed).
> 
> The LuaTeX reference manual (p. 178) says that I should do something with the node's field called "gluenode.spec". If I understand the manual correctly, this field should be a "pointer to an item of type 'glue_spec'." However, there's no indication on how this should be done, and the explanation of glue_spec on pp. 173f. is even terser.

A glue node points to a glue_spec node that contains the real stuff; I
*think* that that akward interface will disappear one day and glue
nodes will contain their own information. Meanwhile:

    local gluenode = node.new(node.id("glue"))
    local gluespec = node.new(node.id("glue_spec"))

    gluespec.width = tex.sp("0.03em")
    gluenode.spec = gluespec

Best,
Paul



From mico.loretan at mac.com  Sun Mar 30 11:46:36 2014
From: mico.loretan at mac.com (Mico Loretan)
Date: Sun, 30 Mar 2014 11:46:36 +0200
Subject: [luatex] how to assign a width to a node of type "glue"
Message-ID: <FF6C9D7F-A10C-4D26-9DDB-EEDDA56FFEDB@mac.com>

> Paul Isambert <zappathustra at free.fr> wrote:
> > Mico Loretan <mico.loretan at mac.com a ?crit:
> > I'm trying to create a glue node that has a specific width. Unfortunately, I seem to be missing something (probably entirely trivial to somebody who knows how it's done).
> >
> > Here's what I've tried so far:
> >
> > local glue        = node.id ( "glue" )       -- 10
> > local gluespec    = node.id ( "glue_spec" )  -- 47
> > local gluenode    = node.new ( glue )        -- create the node
> > gluenode.subtype  = 0                        -- "skip"
> > -- what next??
> >
> > I would like to make this node have a width of 0.03em (no stretchability or shrinkability needed).
> >
> > The LuaTeX reference manual (p. 178) says that I should do something with the node's field called "gluenode.spec". If I understand the manual correctly, this field should be a "pointer to an item of type 'glue_spec'." However, there's no indication on how this should be done, and the explanation of glue_spec on pp. 173f. is even terser.
> 
> 
> A glue node points to a glue_spec node that contains the real stuff; I
> *think* that that akward interface will disappear one day and glue
> nodes will contain their own information. Meanwhile:
> 
>     local gluenode = node.new(node.id("glue"))
>     local gluespec = node.new(node.id("glue_spec"))
> 
>     gluespec.width = tex.sp("0.03em")
>     gluenode.spec = gluespec
> 
> Best,
> Paul

Thanks! This is exactly what I need. Best, Mico




From pragma at wxs.nl  Mon Mar 31 01:07:33 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 31 Mar 2014 01:07:33 +0200
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
 <5335F7A4.6050700@wxs.nl> <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
Message-ID: <5338A3B5.1030403@wxs.nl>

On 3/29/2014 7:51 AM, Jan Tosovsky wrote:
> On 2014-03-28 Hans Hagen wrote:
>> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
>>> On 2014-03-28 Taco Hoekwater wrote:
>>>>
>>>> I have just uploaded the archives for a new luatex release, 0.79.0.
>>>> This fixes a few of the outstanding bugs, and is the version that
>>>> will be included in TeXLive 2014.
>>>
>>> Thanks for that!
>>>
>>> Btw, has anybody any idea where the following 'dotlessi' patch has
>>> been lost?
>>>
>>> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
>>>
>>> It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
>>> Windows 7
>>
>> because it was not okay (too much fuzziness and dead slow too) ...
>
> Sad to hear that. I thought the patch was about removing duplicates when
> building the initial glyph table and didn't expected these severe side
> effects...
>
>> might be that i can cook up a version at the context end (like an
>> overload)
>
>>From my POV the font handling is a very low level part and should be kept in
> luatex...

we're talking of heuristics for determining glyphnames when not present 
and that is a real messy thing ... in fact, better would be to keep all 
that at the lua end (easier to overload) and eventually that might 
happen (it's quite hard to fight frozen invalid properties)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From pragma at wxs.nl  Mon Mar 31 01:10:11 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 31 Mar 2014 01:10:11 +0200
Subject: [luatex] Luatex 0.79.0 announcement
In-Reply-To: <CALBOmsY=JK2q_wesHLBSkDD56-eE5Q5G-sTQJFRjePr_pvb+ew@mail.gmail.com>
References: <53359899.6050709@elvenkind.com>	<5335F7A4.6050700@wxs.nl>
 <53366db0.46250e0a.7e7d.ffffe4b8SMTPIN_ADDED_BROKEN@mx.google.com>
 <CALBOmsY=JK2q_wesHLBSkDD56-eE5Q5G-sTQJFRjePr_pvb+ew@mail.gmail.com>
Message-ID: <5338A453.60602@wxs.nl>

On 3/29/2014 9:18 AM, Mojca Miklavec wrote:
> On Sat, Mar 29, 2014 at 7:51 AM, Jan Tosovsky wrote:
>> On 2014-03-28 Hans Hagen wrote:
>>> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
>>>
>>>> Btw, has anybody any idea where the following 'dotlessi' patch has
>>>> been lost?
>>>>
>>>> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
>>>>
>>>> It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
>>>> Windows 7
>>>
>>> because it was not okay (too much fuzziness and dead slow too) ...
>>
>> Sad to hear that. I thought the patch was about removing duplicates when
>> building the initial glyph table and didn't expected these severe side
>> effects...
>
> I don't know if we are talking about the same "issues" (there have
> been plenty of problems with building the font database), but building
> the font database dropped from 45 minutes to less than a minute on my
> machine. (OK, half an hour was due to a single font.) Reading the
> whole font for each font in the system when building the database was
> an overkill.
>
> Some problems could be fixed per-font during font loading though. I'm
> just speculating because I don't know the code. But doing an O(n^2)
> comparison of glyph names on a font that covers the whole Unicode
> should be avoided in principle.

another aspect is that once a glyph would be tagged as 'foo' and that 
goes though the system it gets harder to figure out what it originally 
was; using indices throughout the system is more robust (accompanied by 
some lua magic) but that is a rather intrusive solution (i have some 
ideas on that and will experiment with that later this year as it is not 
something we want to mess with around tl freeze time)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From j.tosovsky at email.cz  Mon Mar 31 19:42:41 2014
From: j.tosovsky at email.cz (Jan Tosovsky)
Date: Mon, 31 Mar 2014 19:42:41 +0200
Subject: [luatex] Glyph names heuristics
In-Reply-To: <5338A3B5.1030403@wxs.nl>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
 <5335F7A4.6050700@wxs.nl>
 <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz> <5338A3B5.1030403@wxs.nl>
Message-ID: <014401cf4d08$9da11350$d8e339f0$@tosovsky@email.cz>

On 2014-03-31 Hans Hagen wrote:
> On 3/29/2014 7:51 AM, Jan Tosovsky wrote:
> > On 2014-03-28 Hans Hagen wrote:
> >> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
> >>>
> >>> Btw, has anybody any idea where the following 'dotlessi' patch has
> >>> been lost?
> >>>
> >>> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
> >>>
> >>> It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
> >>> Windows 7
> >>
> >> might be that i can cook up a version at the context end (like an
> >> overload)
> >
> >> From my POV the font handling is a very low level part and should be
> >> kept in luatex...
> 
> we're talking of heuristics for determining glyphnames when not present
> and that is a real messy thing ... in fact, better would be to keep all
> that at the lua end (easier to overload) and eventually that might
> happen (it's quite hard to fight frozen invalid properties)
> 

My only wish is to automate it and distribute out-of-the-box without any
additional tweaking and interventions from end users.

I understand that hardcoding it into LuaTeX may be risky, but if done
properly according to the logic of other font libraries/typesetting
software, it could be more efficient. As LuaTeX can be theoretically used by
various macropackages, it means all of them would have to implement the same
thing separately.

I think that current heuristics is very good and Khaled patch made it even
better, IMHO comparable to e.g. InDesign.

Regarding efficiency. Would it be possible to create the font database as
usual and those fonts with missing glyph names mark with a special flag?
They would be 'finalized' on the first request/real use. By finalizing I
mean the complete glyphs names determination.
Why to process all of them in advance even never used? It is just an idea -
without a deep analysis of the corresponding source code.

Jan



From pragma at wxs.nl  Mon Mar 31 19:57:50 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 31 Mar 2014 19:57:50 +0200
Subject: [luatex] Glyph names heuristics
In-Reply-To: <014401cf4d08$9da11350$d8e339f0$@tosovsky@email.cz>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
 <5335F7A4.6050700@wxs.nl>
 <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
 <5338A3B5.1030403@wxs.nl> <014401cf4d08$9da11350$d8e339f0$@tosovsky@email.cz>
Message-ID: <5339AC9E.6000208@wxs.nl>

On 3/31/2014 7:42 PM, Jan Tosovsky wrote:
> On 2014-03-31 Hans Hagen wrote:
>> On 3/29/2014 7:51 AM, Jan Tosovsky wrote:
>>> On 2014-03-28 Hans Hagen wrote:
>>>> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
>>>>>
>>>>> Btw, has anybody any idea where the following 'dotlessi' patch has
>>>>> been lost?
>>>>>
>>>>> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
>>>>>
>>>>> It was working in December in ConTeXt 2013.12.20 / LuaTeX 0.77.0 on
>>>>> Windows 7
>>>>
>>>> might be that i can cook up a version at the context end (like an
>>>> overload)
>>>
>>>>  From my POV the font handling is a very low level part and should be
>>>> kept in luatex...
>>
>> we're talking of heuristics for determining glyphnames when not present
>> and that is a real messy thing ... in fact, better would be to keep all
>> that at the lua end (easier to overload) and eventually that might
>> happen (it's quite hard to fight frozen invalid properties)
>>
>
> My only wish is to automate it and distribute out-of-the-box without any
> additional tweaking and interventions from end users.
>
> I understand that hardcoding it into LuaTeX may be risky, but if done
> properly according to the logic of other font libraries/typesetting
> software, it could be more efficient. As LuaTeX can be theoretically used by
> various macropackages, it means all of them would have to implement the same
> thing separately.

the problem is that when hardcoding is based on fuzzy logic one looses 
information to get back to the original .. a trade of between user 
friendliness and perfection

a specific usage overload (e.g in a context setup) will not harm oither 
users with different demands

> I think that current heuristics is very good and Khaled patch made it even
> better, IMHO comparable to e.g. InDesign.

well, most heuristics are actually not that perfect and in the end one 
has to use the adobe glyph list anyway

> Regarding efficiency. Would it be possible to create the font database as
> usual and those fonts with missing glyph names mark with a special flag?
> They would be 'finalized' on the first request/real use. By finalizing I
> mean the complete glyphs names determination.
> Why to process all of them in advance even never used? It is just an idea -
> without a deep analysis of the corresponding source code.

the only robust solution is not to use glyph names in lookup definitions 
but indices (glyph names are only useful for tracing and tounicode)

anyway, as said: i'll look into it later this year but the current 
binary stays as it is

(btw, the specific problem is a dotlessi vs i issue and it's always 
debatable if one should then tag as dotless i or i if it's used for both 
cases)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From j.tosovsky at email.cz  Mon Mar 31 20:53:26 2014
From: j.tosovsky at email.cz (Jan Tosovsky)
Date: Mon, 31 Mar 2014 20:53:26 +0200
Subject: [luatex] Glyph names heuristics
In-Reply-To: <5339AC9E.6000208@wxs.nl>
References: <53359899.6050709@elvenkind.com>
 <014f01cf4ab2$c6769cd0$5363d670$@tosovsky@email.cz>
 <5335F7A4.6050700@wxs.nl>
 <002701cf4b1b$4ae697a0$e0b3c6e0$@tosovsky@email.cz>
 <5338A3B5.1030403@wxs.nl>
 <014401cf4d08$9da11350$d8e339f0$@tosovsky@email.cz> <5339AC9E.6000208@wxs.nl>
Message-ID: <016b01cf4d12$800efe10$802cfa30$@tosovsky@email.cz>

On 2014-03-31 Hans Hagen wrote:
> On 3/31/2014 7:42 PM, Jan Tosovsky wrote:
> > On 2014-03-31 Hans Hagen wrote:
> >> On 3/29/2014 7:51 AM, Jan Tosovsky wrote:
> >>> On 2014-03-28 Hans Hagen wrote:
> >>>> On 3/28/2014 7:23 PM, Jan Tosovsky wrote:
> >>>>>
> >>>>> Btw, has anybody any idea where the following 'dotlessi' patch
> >>>>> has been lost?
> >>>>>
> >>>>> http://www.ntg.nl/pipermail/ntg-context/2013/076306.html
> >>>>>
> >>>> might be that i can cook up a version at the context end (like an
> >>>> overload)
> >>>
> >>>> From my POV the font handling is a very low level part and should
> >>>> be kept in luatex...
> >>
> >> we're talking of heuristics for determining glyphnames when not
> >> present and that is a real messy thing ... in fact, better would be 
> >> to keep all that at the lua end (easier to overload) and eventually 
> >> that might happen (it's quite hard to fight frozen invalid properties)
> >>
> >
> > My only wish is to automate it and distribute out-of-the-box without
> > any additional tweaking and interventions from end users.
> >
> > I understand that hardcoding it into LuaTeX may be risky, but if done
> > properly according to the logic of other font libraries/typesetting
> > software, it could be more efficient. As LuaTeX can be theoretically
> > used by various macropackages, it means all of them would have to 
> > implement the same thing separately.
> 
> the problem is that when hardcoding is based on fuzzy logic one looses
> information to get back to the original .. a trade of between user
> friendliness and perfection
> 
> a specific usage overload (e.g in a context setup) will not harm oither
> users with different demands
> 

It makes sense. You know much better possible consequences.
 
> the only robust solution is not to use glyph names in lookup
> definitions but indices (glyph names are only useful for tracing and 
> tounicode)
> 
> anyway, as said: i'll look into it later this year but the current
> binary stays as it is

Ok, thanks.

Jan



