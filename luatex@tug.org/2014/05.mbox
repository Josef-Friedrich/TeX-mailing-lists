From eduardoochs at gmail.com  Fri May  2 00:52:22 2014
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Thu, 1 May 2014 19:52:22 -0300
Subject: [luatex] Newbie problem with luamplib, part 1
Message-ID: <CADs++6hS2gQSM8Ce9JaZVAZfzSzrVPz_mogh_wMV7hYnP2QXaA@mail.gmail.com>

Hi list,

I am trying to use luamplib to create some drawings, but all my
attempts to follow the recipes that I found at the web are failing at
essentially the same point... for example, this shell code

  cd /tmp/
  cat > luamplibtest.tex <<'@@@'
  \documentclass[a4paper]{article}
  \usepackage{luamplib}
  \begin{document}
  Some text, a drawing (%
  \begin{mplibcode}
  beginfig(1);
  draw (0,0)--(100,0)--(100,100)--(0,100)--cycle;
  endfig;
  \end{mplibcode}
  ), more text
  \end{document}
  @@@
  lualatex luamplibtest.tex

yields this:

  /tmp(edrx:la)# lualatex luamplibtest.tex
  This is LuaTeX, Version beta-0.70.2-2012070301 (TeX Live 2012/Debian)
   restricted \write18 enabled.
  (./luamplibtest.tex
  LaTeX2e <2011/06/27>
  LuaTeX adaptation of babel <v3.8m-luatex-1.5> and hyphenation
patterns for engl
  ish, dumylang, nohyphenation, loaded.
  (/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
  Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
  (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo))
  (/usr/share/texlive/texmf-dist/tex/luatex/luamplib/luamplib.sty
  (/usr/share/texlive/texmf-dist/tex/luatex/luatexbase/luatexbase-modutils.sty
  (/usr/share/texlive/texmf-dist/tex/generic/oberdiek/ifluatex.sty)
  (/usr/share/texlive/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty
  (/usr/share/texlive/texmf-dist/tex/luatex/luatexbase/luatexbase-compat.sty)
  (/usr/share/texlive/texmf-dist/tex/luatex/luatexbase/luatexbase.loader.lua))
  (/usr/share/texlive/texmf-dist/tex/luatex/luatexbase/modutils.lua))
  (/usr/share/texlive/texmf-dist/tex/latex/fancyvrb/fancyvrb.sty
  Style option: `fancyvrb' v2.7a, with DG/SPQR fixes, and firstline=lastline fix
  <2008/02/07> (tvz)
(/usr/share/texlive/texmf-dist/tex/latex/graphics/keyval.sty
  ))
  (/usr/share/texlive/texmf-dist/tex/luatex/luamplib/luamplib.lua))
  (./luamplibtest.aux)
  ! LuaTeX error
.../texlive/texmf-dist/tex/luatex/luamplib/luamplib.lua:85: Modu
  le luamplib error: unknown error, no error, terminal or log
messages, maybe mis
  sing beginfig/endfig

  stack traceback:
        [C]: in function 'error'
        ...exlive/texmf-dist/tex/luatex/luatexbase/modutils.lua:26: in
function 'module_error_int'
        ...exlive/texmf-dist/tex/luatex/luatexbase/modutils.lua:45: in
function 'err'
        .../texlive/texmf-dist/tex/luatex/luamplib/luamplib.lua:85: in
function 'report'
        .../texlive/texmf-dist/tex/luatex/luamplib/luamplib.lua:99: in
function 'process'
        .../texlive/texmf-dist/tex/luatex/luamplib/luamplib.lua:34: in
function 'processlines'
        <\directlua >:1: in main chunk.
  \endmplibcode ...rectlua {luamplib.processlines()}

  l.9 \end{mplibcode}

  ? x
   384 words of node memory still in use:
     2 hlist, 1 rule, 4 glue, 18 glyph, 40 glue_spec, 1 temp, 1 write,
1 local_pa
  r, 1 dir nodes
     avail lists: 2:11,3:1,7:1,9:2
  No pages of output.
  Transcript written on luamplibtest.log.
  /tmp(edrx:la)#

Any hints? I am running Debian stable here, and luatex
beta-0.70.2-2012070301 ... I tried to compile a newer version of
luatex from

https://foundry.supelec.fr/frs/download.php/file/15761/luatex-beta-0.79.0-source.tar.bz2

but the compilation failed, with an error that I will send in another
e-mail in a few minutes...

  Thanks in advance,
    Eduardo Ochs
    eduardoochs at gmail.com
    http://angg.twu.net/
    http://angg.twu.net/dednat4.html



P.S.: I indented each of the code/log lines above with two spaces to
make the message look nicer.


From eduardoochs at gmail.com  Fri May  2 01:05:43 2014
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Thu, 1 May 2014 20:05:43 -0300
Subject: [luatex] Newbie problem with luamplib,
	part 2 (compiling luatex-beta-0.79.0)
Message-ID: <CADs++6hvKyTku0gp8QEH2-bjr35Hn6H+xhVGEKW+zL0uuBLA5g@mail.gmail.com>

Hi list,

is this supposed to be the right way to download and build
luatex-beta-0.79.0?

  export S=$HOME/snarf
  #
  # http://www.luatex.org/download.html
  # https://foundry.supelec.fr/frs/download.php/file/15761/luatex-beta-0.79.0-source.tar.bz2
  mkdir -p $S/https/foundry.supelec.fr/frs/download.php/file/15761/
  cd       $S/https/foundry.supelec.fr/frs/download.php/file/15761/
  wget     'https://foundry.supelec.fr/frs/download.php/file/15761/luatex-beta-0.79.0-source.tar.bz2'
  #
  rm -Rv ~/bigsrc/luatex-beta-0.79.0/
  tar -C ~/bigsrc/ -xvjf \
    $S/https/foundry.supelec.fr/frs/download.php/file/15761/luatex-beta-0.79.0-source.tar.bz2
  cd     ~/bigsrc/luatex-beta-0.79.0/
  #
  find * -type f | sort > .files
  #
  ./build.sh  2>&1 | tee obsh

because "./build.sh" is failing in an unexpected way... here are the
last lines (more precisely: lines 1498-1617) of the compilation log,
each indented two spaces...

  make[3]: Leaving directory
`/home/edrx/bigsrc/luatex-beta-0.79.0/build/libs/cairo'
  echo timestamp >rebuild.stamp
  make[2]: Leaving directory
`/home/edrx/bigsrc/luatex-beta-0.79.0/build/libs/cairo'
  make[1]: Leaving directory
`/home/edrx/bigsrc/luatex-beta-0.79.0/build/libs/cairo'
  cd ./../../libs/cairo && make  rebuild
  make[1]: Entering directory
`/home/edrx/bigsrc/luatex-beta-0.79.0/build/libs/cairo'
  make[1]: Leaving directory
`/home/edrx/bigsrc/luatex-beta-0.79.0/build/libs/cairo'
    CC       mplibdir/libmplib_a-avl.o
    CC       mplibdir/libmplib_a-decNumber.o
    CC       mplibdir/libmplib_a-decContext.o
    CC       libmplib_a-tfmin.o
    CC       libmplib_a-mp.o
    CC       libmplib_a-mpmath.o
    CC       libmplib_a-mpmathdecimal.o
    CC       libmplib_a-mpmathdouble.o
    CC       libmplib_a-mpstrings.o
    CC       libmplib_a-pngout.o
    CC       libmplib_a-psout.o
    CC       libmplib_a-svgout.o
    AR       libmplib.a
    CC       luatexdir/lua/libluatex_a-lstrlibext.o
    CTANGLE  luastuff.c
    CC       libluatex_a-luastuff.o
    CTANGLE  texluac.c
    CC       libluatex_a-texluac.o
    CC       luatexdir/lua/libluatex_a-lcallbacklib.o
    CC       luatexdir/lua/libluatex_a-lfontlib.o
    CC       luatexdir/lua/libluatex_a-limglib.o
    CXX      luatexdir/lua/libluatex_a-lpdfscannerlib.o
    CXX      luatexdir/lua/libluatex_a-lepdflib.o
    CC       luatexdir/lua/libluatex_a-lkpselib.o
    CC       luatexdir/lua/libluatex_a-llanglib.o
    CC       luatexdir/lua/libluatex_a-llualib.o
    CC       luatexdir/lua/libluatex_a-llfslibext.o
    CC       luatexdir/lua/libluatex_a-lnodelib.o
    CC       luatexdir/lua/libluatex_a-liolibext.o
    CC       luatexdir/lua/libluatex_a-loslibext.o
    CC       luatexdir/lua/libluatex_a-lpdflib.o
    CC       luatexdir/lua/libluatex_a-lstatslib.o
    CC       luatexdir/lua/libluatex_a-ltexiolib.o
    CC       luatexdir/lua/libluatex_a-ltexlib.o
    CC       luatexdir/lua/libluatex_a-ltokenlib.o
    CC       luatexdir/utils/libluatex_a-avl.o
    CC       synctexdir/libluatex_a-synctex.o
    CC       mplibdir/libluatex_a-lmplib.o
    CTANGLE  dvigen.c
    CC       libluatex_a-dvigen.o
    CTANGLE  dofont.c
    CC       libluatex_a-dofont.o
    CTANGLE  luafont.c
    CC       libluatex_a-luafont.o
    CTANGLE  mapfile.c
    CC       libluatex_a-mapfile.o
    CTANGLE  pkin.c
    CC       libluatex_a-pkin.o
    CTANGLE  sfnt.c
    CC       libluatex_a-sfnt.o
    CTANGLE  subfont.c
    CC       libluatex_a-subfont.o
    CTANGLE  texfont.c
    CC       libluatex_a-texfont.o
    CTANGLE  tfmofm.c
    CC       libluatex_a-tfmofm.o
    CTANGLE  tounicode.c
    CC       libluatex_a-tounicode.o
    CTANGLE  tt_glyf.c
    CC       libluatex_a-tt_glyf.o
    CTANGLE  tt_table.c
    CC       libluatex_a-tt_table.o
    CTANGLE  vfovf.c
    CC       libluatex_a-vfovf.o
    CTANGLE  vfpacket.c
    CC       libluatex_a-vfpacket.o
    CTANGLE  writecff.c
    CC       libluatex_a-writecff.o
    CTANGLE  writeenc.c
    CC       libluatex_a-writeenc.o
    CTANGLE  writefont.c
    CC       libluatex_a-writefont.o
    CTANGLE  writet1.c
    CC       libluatex_a-writet1.o
    CTANGLE  writet3.c
    CC       libluatex_a-writet3.o
    CTANGLE  writettf.c
    CC       libluatex_a-writettf.o
    CTANGLE  writetype0.c
    CC       libluatex_a-writetype0.o
    CTANGLE  writetype2.c
    CC       libluatex_a-writetype2.o
    CTANGLE  writeimg.c
    CC       libluatex_a-writeimg.o
    CTANGLE  writejbig2.c
    CC       libluatex_a-writejbig2.o
    CTANGLE  writejpg.c
    CC       libluatex_a-writejpg.o
    CTANGLE  writejp2.c
    CC       libluatex_a-writejp2.o
    CTANGLE  writepng.c
    CC       libluatex_a-writepng.o
    CTANGLE  pdftoepdf.cc
    CXX      libluatex_a-pdftoepdf.o
    CTANGLE  texlang.c
    CC       libluatex_a-texlang.o
    CTANGLE  hyphen.c
    CC       libluatex_a-hyphen.o
    CTANGLE  hnjalloc.c
    CC       libluatex_a-hnjalloc.o
    CTANGLE  luagen.c
    CC       libluatex_a-luagen.o
    CTANGLE  luainit.c
    CC       libluatex_a-luainit.o
    CTANGLE  luanode.c
    CC       libluatex_a-luanode.o
  ../../../source/texk/web2c/luatexdir/lua/luanode.w:63:1: error:
conflicting types for 'lua_node_filter_s'
  In file included from ../../../source/texk/web2c/luatexdir/lua/luanode.w:28:0:
  ../../../source/texk/web2c/luatexdir/ptexlib.h:258:6: note: previous
declaration of 'lua_node_filter_s' was here
  make: *** [libluatex_a-luanode.o] Error 1
  strip: 'build/texk/web2c/luatex': No such file
  ls: cannot access build/texk/web2c/luatex: No such file or directory

Thanks in advance... =)
  Cheers,
    Eduardo Ochs
    eduardoochs at gmail.com
    http://angg.twu.net/
    http://angg.twu.net/dednat4.html


From mojca.miklavec.lists at gmail.com  Fri May  2 01:20:24 2014
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 2 May 2014 01:20:24 +0200
Subject: [luatex] Newbie problem with luamplib,
	part 2 (compiling luatex-beta-0.79.0)
In-Reply-To: <CADs++6hvKyTku0gp8QEH2-bjr35Hn6H+xhVGEKW+zL0uuBLA5g@mail.gmail.com>
References: <CADs++6hvKyTku0gp8QEH2-bjr35Hn6H+xhVGEKW+zL0uuBLA5g@mail.gmail.com>
Message-ID: <CALBOmsZvV7z9eKnnNLQxq-PQsV3Mi9NbriJcynZaZMpZRegNaA@mail.gmail.com>

On Fri, May 2, 2014 at 1:05 AM, Eduardo Ochs wrote:
> Hi list,
>
> is this supposed to be the right way to download and build
> luatex-beta-0.79.0?

Yes, this is the supposed way to build luatex (other than fetching it
from svn tag or TeX Live). But you are "not supposed" to build version
0.79.0. Version 0.79.1 has been released precisely to solve the
problems you are experiencing.

Mojca


From eduardoochs at gmail.com  Fri May  2 19:55:23 2014
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Fri, 2 May 2014 14:55:23 -0300
Subject: [luatex] Newbie question: how do create (and use) a lualatex.fmt
	with luatex-0.79.1?
Message-ID: <CADs++6iBvfi8tJp0-rfcLa_cFg1frVADbVpm5KChe4E_FUoC8g@mail.gmail.com>

On Thu, May 1, 2014 at 8:20 PM, Mojca Miklavec
<mojca.miklavec.lists at gmail.com> wrote:
> Yes, this is the supposed way to build luatex (other than fetching it
> from svn tag or TeX Live). But you are "not supposed" to build version
> 0.79.0. Version 0.79.1 has been released precisely to solve the
> problems you are experiencing.

I have now been able to compile luatex-0.79.1 at my Debian box, but I
can't figure out how to make it run as lualatex... in other words, I
am stuck at trying to translate this paragraph of the "INSTALL" file,

  Post-compilation installation should be a simple matter
  of copying the executable to a normal place for web2c
  binaries and generating the desired formats.

into executable commands - sorry! And: help, please! 8-(

Here's my understanding of what should happen after the "./build.sh".
I now have a binary at

  ~/bigsrc/luatex-beta-0.79.1/build/texk/web2c/luatex

It is a kind of an "initex", so I need to use it to generate a
"lualatex.fmt". I run

  cd /tmp/
  ~/bigsrc/luatex-beta-0.79.1/build/texk/web2c/luatex '&lualatex'  2>&1 | tee o

and then the log file (/tmp/o) says that it read the "lualatex.ini"
and friends from the current texlive installation, and created a .fmt
and a .log file at:

  ~/.texmf-var/web2c/luatex/lualatex.fmt
  ~/.texmf-var/web2c/luatex/lualatex.log

Now how do I run the luatex binary in non-initex mode, and make it use
the newly-created "lualatex.fmt" instead of the one from texlive, that
is here?

  /var/lib/texmf/web2c/luatex/lualatex.fmt

That ought to be trivial - I am probably overlooking something in the
docs...

  Thanks in advance,
    Eduardo Ochs
    eduardoochs at gmail.com
    http://angg.twu.net/dednat4.html


From feliphil at gmx.net  Mon May  5 20:52:48 2014
From: feliphil at gmx.net (Wolfgang Keller)
Date: Mon, 5 May 2014 20:52:48 +0200
Subject: [luatex] Luaotfload still (or again?) broken in current TeXLive
 2013 (frozen)
Message-ID: <20140505205248.77a84c91a4998f082a42d268@gmx.net>

Hello,

the luaotfload manual claims:

> Font names database
>
> As mentioned above, luaotfload keeps track of which fonts are
> available to LuaTEX by means of a database. This allows referring to
> fonts not only by explicit filenames but also by the proper names
> contained in the metadata which is often more accessible to humans.
>
> When luaotfload is asked to load a font by a font name, it will check
> if the database exists and load it, or else generate a fresh one.
> Should it then fail to locate the font, an update to the database is
> performed in case the font has been added to the system only
> recently. As soon as the database is updated, the resolver will try
> and look up the font again, all without user intervention. The goal
> is for luaotfload to act in the background and behave as
> unobtrusively as possible, while providing a convenient interface to
> the fonts installed on the system.

The part "without user intervention" is obviously not true, because
for the umpteenth time I had to run a manual 

luaotfload-tool --update

because luaotfload complained that it could not find some latin modern
font despite the fact that the document was *not* using any of the
latin modern fonts at all. In fact the "minimal" test document I used
to reproduce the error was *empty*.

So I would recommend that you either fix the software or the
documentation.

Or, if it has already been fixed in some version that has not been
uploaded to CTAN, then I recommend fixing the process of updating the
package there.

A luaotfload-tool --version yields:
 
> luaotfload-tool:
>         Luaotfload font management and diagnostic utility.
>         License: GNU GPL v2.0.
>         Report problems to
> <https://github.com/lualatex/luaotfload/issues>
> 
> luaotfload-tool version "2.4-3"
> revision "bd307a8fe8047d322317037c1a832720c236fb48"
> database version "2.41"
> Lua interpreter: stock; version "Lua 5.2"
> Luatex SVN revision 4627
> Luatex version 0.76.0

TIA,

Sincerely,

Wolfgang


From mojca.miklavec.lists at gmail.com  Mon May  5 23:51:03 2014
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 5 May 2014 23:51:03 +0200
Subject: [luatex] Newbie question: how do create (and use) a
 lualatex.fmt with luatex-0.79.1?
In-Reply-To: <CADs++6iBvfi8tJp0-rfcLa_cFg1frVADbVpm5KChe4E_FUoC8g@mail.gmail.com>
References: <CADs++6iBvfi8tJp0-rfcLa_cFg1frVADbVpm5KChe4E_FUoC8g@mail.gmail.com>
Message-ID: <CALBOmsa6Wifi+Tn55X1Fk62MJ33WPPn04jb1M5MOfeBBMhMO2Q@mail.gmail.com>

On Fri, May 2, 2014 at 7:55 PM, Eduardo Ochs wrote:
> On Thu, May 1, 2014 at 8:20 PM, Mojca Miklavec wrote:
>> Yes, this is the supposed way to build luatex (other than fetching it
>> from svn tag or TeX Live). But you are "not supposed" to build version
>> 0.79.0. Version 0.79.1 has been released precisely to solve the
>> problems you are experiencing.
>
> I have now been able to compile luatex-0.79.1 at my Debian box, but I
> can't figure out how to make it run as lualatex...

The easiest way by far is to install TeX Live 2014 from one of the
tlpretest mirrors.

https://www.tug.org/texlive/pretest.html

And from what I understood the TL 2014 testing packages for Debian are
ready as well.

The second-easiest thing is to replace the existing luatex binary and
run "fmtutil --all" or "sudo fmtutil-sys --all" (or "--byfmt lualatex"
or something similar) to generate the formats for you.

Please keep in mind that once you run those commands, you might need
to deleted the user-generated formats when you upgrade TeX Live.

> in other words, I
> am stuck at trying to translate this paragraph of the "INSTALL" file,
>
>   Post-compilation installation should be a simple matter
>   of copying the executable to a normal place for web2c
>   binaries and generating the desired formats.
>
> into executable commands - sorry! And: help, please! 8-(
>
> Here's my understanding of what should happen after the "./build.sh".
> I now have a binary at
>
>   ~/bigsrc/luatex-beta-0.79.1/build/texk/web2c/luatex
>
> It is a kind of an "initex", so I need to use it to generate a
> "lualatex.fmt". I run
>
>   cd /tmp/
>   ~/bigsrc/luatex-beta-0.79.1/build/texk/web2c/luatex '&lualatex'  2>&1 | tee o
>
> and then the log file (/tmp/o) says that it read the "lualatex.ini"
> and friends from the current texlive installation, and created a .fmt
> and a .log file at:
>
>   ~/.texmf-var/web2c/luatex/lualatex.fmt
>   ~/.texmf-var/web2c/luatex/lualatex.log
>
> Now how do I run the luatex binary in non-initex mode, and make it use
> the newly-created "lualatex.fmt" instead of the one from texlive, that
> is here?
>
>   /var/lib/texmf/web2c/luatex/lualatex.fmt
>
> That ought to be trivial - I am probably overlooking something in the
> docs...

I'm not 100% sure if that applies in your case, but if you place the
luatex binary at some weird location, you might need to redefine a
bunch of configuration variables to allow luatex to properly find the
relevant files. The search is always done relative to the original
binary. Unless you know what you are doing ... it could get tricky and
it could depend on how exactly you installed TL. And if you took
Debian's TL, there is a fair chance that texmf.cnf uses different
variables than your self-compiled binary. You can take a look at all
instances of texmf.cnf on your machine.

Mojca


From reinhard.kotucha at web.de  Tue May  6 01:16:26 2014
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 6 May 2014 01:16:26 +0200
Subject: [luatex] Newbie question: how do create (and use) a
 lualatex.fmt with luatex-0.79.1?
In-Reply-To: <CALBOmsa6Wifi+Tn55X1Fk62MJ33WPPn04jb1M5MOfeBBMhMO2Q@mail.gmail.com>
References: <CADs++6iBvfi8tJp0-rfcLa_cFg1frVADbVpm5KChe4E_FUoC8g@mail.gmail.com>
 <CALBOmsa6Wifi+Tn55X1Fk62MJ33WPPn04jb1M5MOfeBBMhMO2Q@mail.gmail.com>
Message-ID: <21352.7114.936158.126676@zaphod.ms25.net>

On 2014-05-05 at 23:51:03 +0200, Mojca Miklavec wrote:

 > On Fri, May 2, 2014 at 7:55 PM, Eduardo Ochs wrote:
 > > On Thu, May 1, 2014 at 8:20 PM, Mojca Miklavec wrote:
 > >> Yes, this is the supposed way to build luatex (other than fetching it
 > >> from svn tag or TeX Live). But you are "not supposed" to build version
 > >> 0.79.0. Version 0.79.1 has been released precisely to solve the
 > >> problems you are experiencing.
 > >
 > > I have now been able to compile luatex-0.79.1 at my Debian box, but I
 > > can't figure out how to make it run as lualatex...
 > 
 > The easiest way by far is to install TeX Live 2014 from one of the
 > tlpretest mirrors.
 > 
 > https://www.tug.org/texlive/pretest.html
 > 
 > And from what I understood the TL 2014 testing packages for Debian are
 > ready as well.
 > 
 > The second-easiest thing is to replace the existing luatex binary and
 > run "fmtutil --all" or "sudo fmtutil-sys --all" (or "--byfmt lualatex"
 > or something similar) to generate the formats for you.
 > 
 > Please keep in mind that once you run those commands, you might need
 > to deleted the user-generated formats when you upgrade TeX Live.

Since TL2013 is frozen forever, I can't recommend the second approach
any more.  I already replaced binaries in TL-2013 with files from the
luatex repository when severe bugs had been fixed.  However, it's
always advisable to backup the original files before.  Since the
TL-2014 pretest is available, it's certainly not worth the trouble and
it's best to leave the TL-2013 installation untouched.

If you install TL-2014-pretest now, you don't have to install the
official TL-2014 release again.  It's sufficient to change the mirror.
You definitely don't gain anything by changing your TL-2013
installation though TL-2014 is already available.

Upgrading from pretest to the official release worked always smoothly
in the past.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From khaledhosny at eglug.org  Tue May  6 01:16:24 2014
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 6 May 2014 01:16:24 +0200
Subject: [luatex] Luaotfload still (or again?) broken in current TeXLive
 2013 (frozen)
In-Reply-To: <20140505205248.77a84c91a4998f082a42d268@gmx.net>
References: <20140505205248.77a84c91a4998f082a42d268@gmx.net>
Message-ID: <20140505231624.GA8557@khaled-laptop>

On Mon, May 05, 2014 at 08:52:48PM +0200, Wolfgang Keller wrote:
> A luaotfload-tool --version yields:
>  
> > luaotfload-tool:
> >         Luaotfload font management and diagnostic utility.
> >         License: GNU GPL v2.0.
> >         Report problems to
> > <https://github.com/lualatex/luaotfload/issues>

May be you should try reporting problems to this URL.

Regards,
Khaled


From luatex at nililand.de  Wed May  7 08:38:52 2014
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 7 May 2014 08:38:52 +0200
Subject: [luatex] Luaotfload still (or again?) broken in current TeXLive
	2013 (frozen)
References: <20140505205248.77a84c91a4998f082a42d268@gmx.net>
Message-ID: <bbeync3wiram$.dlg@nililand.de>

Am Mon, 5 May 2014 20:52:48 +0200 schrieb Wolfgang Keller:

> Hello,
> 
> the luaotfload manual claims:
> 
>> Font names database
>>
>> As mentioned above, luaotfload keeps track of which fonts are
>> available to LuaTEX by means of a database. This allows referring to
>> fonts not only by explicit filenames but also by the proper names
>> contained in the metadata which is often more accessible to humans.
>>
>> When luaotfload is asked to load a font by a font name, it will check
>> if the database exists and load it, or else generate a fresh one.
>> Should it then fail to locate the font, an update to the database is
>> performed in case the font has been added to the system only
>> recently. As soon as the database is updated, the resolver will try
>> and look up the font again, all without user intervention. The goal
>> is for luaotfload to act in the background and behave as
>> unobtrusively as possible, while providing a convenient interface to
>> the fonts installed on the system.
> 
> The part "without user intervention" is obviously not true, because
> for the umpteenth time I had to run a manual 
> 
> luaotfload-tool --update
> 
> because luaotfload complained that it could not find some latin modern
> font despite the fact that the document was *not* using any of the
> latin modern fonts at all. In fact the "minimal" test document I used
> to reproduce the error was *empty*.

If you are using fontspec it would try to load latin modern at
latest at the \normalfont command in \begin{document}. 

> 
> So I would recommend that you either fix the software or the
> documentation.

I would recommend that you make better bug reports. luaotfload is
obviously working fine for quite a number of people, so there is
something special to your document or your system. A minimal
document and log-files are needed. You should also describe if you
tried to update the database manually and if this succeded (and if
not if you blacklisted all problematic fonts as described in the
manual). 

> A luaotfload-tool --version yields:

luaotfload is about system fonts. So you should also mention your
OS. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/



From feliphil at gmx.net  Thu May  8 18:57:11 2014
From: feliphil at gmx.net (Wolfgang Keller)
Date: Thu, 8 May 2014 18:57:11 +0200
Subject: [luatex] Luaotfload still (or again?) broken in current TeXLive
 2013 (frozen)
In-Reply-To: <bbeync3wiram$.dlg@nililand.de>
References: <20140505205248.77a84c91a4998f082a42d268@gmx.net>
 <bbeync3wiram$.dlg@nililand.de>
Message-ID: <20140508185711.8dc04bf78bdab9ccd37a6b80@gmx.net>

> > The part "without user intervention" is obviously not true, because
> > for the umpteenth time I had to run a manual 
> > 
> > luaotfload-tool --update
> > 
> > because luaotfload complained that it could not find some latin
> > modern font despite the fact that the document was *not* using any
> > of the latin modern fonts at all. In fact the "minimal" test
> > document I used to reproduce the error was *empty*.
> 
> If you are using fontspec it would try to load latin modern at
> latest at the \normalfont command in \begin{document}. 

I *never* use(d) Latin Modern. In *no* document.

In fact I only started to use LaTeX at all when it became possible to
use different (OTF) typefaces together with Microtype.
 
> I would recommend that you make better bug reports. luaotfload is
> obviously working fine for quite a number of people, so there is
> something special to your document or your system. 

The bug that I described is found hundreds of times by Google in dozens
of LaTeX "forums", mailinglists, newsgroups, web sites etc. all over the
world. And it seems to keep re-surfacing like the monster of Loch Ness,
in a totally unpredictible way.

And it's always the same: After some update of the lualatex package,
luaotfload complains it can't find lmodern, even if the document does
not at all use lmodern.

> A minimal document and log-files are needed.

The minimal document was *empty*. And of course I have work to do, so I
just ran that update tool manually and got on. So there are no log
files any more.

> > A luaotfload-tool --version yields:
> 
> luaotfload is about system fonts. So you should also mention your
> OS. 

I never use "system" fonts. All my OTF typefaces are in texmf-local.

And again: The text document was *empty*. No reference to *any* typeface
at all, no content.

Sincerely,

Wolfgang


From luatex at nililand.de  Thu May  8 19:47:34 2014
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 8 May 2014 19:47:34 +0200
Subject: [luatex] Luaotfload still (or again?) broken in current TeXLive
	2013 (frozen)
References: <20140505205248.77a84c91a4998f082a42d268@gmx.net>
 <bbeync3wiram$.dlg@nililand.de>
 <20140508185711.8dc04bf78bdab9ccd37a6b80@gmx.net>
Message-ID: <1oh20ehure5ws.dlg@nililand.de>

Am Thu, 8 May 2014 18:57:11 +0200 schrieb Wolfgang Keller:

> The bug that I described is found hundreds of times by Google in dozens
> of LaTeX "forums", mailinglists, newsgroups, web sites etc. all over the
> world. And it seems to keep re-surfacing like the monster of Loch Ness,
> in a totally unpredictible way.

Well I'm reading quite a lot messages in various groups and I can't
remember such message in the last month.


>> A minimal document and log-files are needed.
 
> The minimal document was *empty*.

You are trying to compile an empty file? I don't believe this. Your
document body may be empty, but your preamble contains something and
this something (e.g. fontspec) would setup the latin modern fonts if
you don't change this. 

> The minimal document was *empty*. And of course I have work to do, so I
> just ran that update tool manually and got on. So there are no log
> files any more.

Then don't complain. When I get errors and want them fixed then I
make quite sure that I can sent the maintainers all necessary
informations they need. I don't delete the stuff and complain
afterward why they don't fix things.

>> luaotfload is about system fonts. So you should also mention your
>> OS. 
 
> I never use "system" fonts. All my OTF typefaces are in texmf-local.

But luaotfload also scans the system fonts. So unless your system
font folder is completly empty it matters what fonts are there. 



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/



From mail at michael.kropat.name  Sun May 11 20:38:00 2014
From: mail at michael.kropat.name (Michael Kropat)
Date: Sun, 11 May 2014 14:38:00 -0400
Subject: [luatex] How do you exit luatex?
Message-ID: <536FC388.3000506@michael.kropat.name>

I'm playing around with switching from xetex to luatex. On my first 
attempt to invoke luatex, I encountered this peculiar behavior:

     $ luatex no-such-file.tex
     This is LuaTeX, Version beta-0.76.0-2013061708 (rev 4627)
     restricted \write18 enabled.
     ! I can't find file `no-such-file.tex'.
     <*> no-such-file.tex

     Please type another input file name: ^C! I can't find file 
`no-such-file'.
     <*> no-such-file.tex

     Please type another input file name:

How do I break out of this loop?

I'm encountering this behavior using the TeX Live 2013 version of 
luatex, running under Linux Mint.

Michael


From eduardoochs at gmail.com  Mon May 12 15:48:29 2014
From: eduardoochs at gmail.com (Eduardo Ochs)
Date: Mon, 12 May 2014 10:48:29 -0300
Subject: [luatex] How do you exit luatex?
In-Reply-To: <536FC388.3000506@michael.kropat.name>
References: <536FC388.3000506@michael.kropat.name>
Message-ID: <CADs++6icAEwLS_U5T1rqprFnNcyOT9fFPLudfyBV3yFEkWeUOQ@mail.gmail.com>

On 12 May 2014 10:30, "Michael Kropat" <mail at michael.kropat.name> wrote:
>
> I'm playing around with switching from xetex to luatex. On my first
attempt to invoke luatex, I encountered this peculiar behavior:
>
>     $ luatex no-such-file.tex
>     This is LuaTeX, Version beta-0.76.0-2013061708 (rev 4627)
>     restricted \write18 enabled.
>     ! I can't find file `no-such-file.tex'.
>     <*> no-such-file.tex
>
>     Please type another input file name: ^C! I can't find file
`no-such-file'.
>     <*> no-such-file.tex
>
>     Please type another input file name:
>
> How do I break out of this loop?
>
> I'm encountering this behavior using the TeX Live 2013 version of luatex,
running under Linux Mint.
>
> Michael
>

Try ^D to send an EOF to luatex...
That always works for me - another solution, which usually works but
depends on the paths being well-configured, is to type "x" as the input
file name... this makes (lua)tex read a file called "x.tex", which has
commands to make TeX exit, and is a standard hack described in a chapter of
the TeXbook called "Running TeX", if I remember correctly. .. you may be
able to find it with "locate /x.tex".

Sorry if there's anything wrong, I'm on a cellphone here -
  Cheers,
    Eduardo Ochs
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140512/a3579cf4/attachment.html>

From reinhard.kotucha at web.de  Mon May 12 15:51:19 2014
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 12 May 2014 15:51:19 +0200
Subject: [luatex] How do you exit luatex?
In-Reply-To: <536FC388.3000506@michael.kropat.name>
References: <536FC388.3000506@michael.kropat.name>
Message-ID: <21360.53719.686276.950@zaphod.ms25.net>

On 2014-05-11 at 14:38:00 -0400, Michael Kropat wrote:

 > I'm playing around with switching from xetex to luatex. On my first 
 > attempt to invoke luatex, I encountered this peculiar behavior:
 > 
 >      $ luatex no-such-file.tex
 >      This is LuaTeX, Version beta-0.76.0-2013061708 (rev 4627)
 >      restricted \write18 enabled.
 >      ! I can't find file `no-such-file.tex'.
 >      <*> no-such-file.tex
 > 
 >      Please type another input file name: ^C! I can't find file 
 > `no-such-file'.
 >      <*> no-such-file.tex
 > 
 >      Please type another input file name:
 > 
 > How do I break out of this loop?

press x <return>

  $ luatex no-such-file.tex
  This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971) 
  restricted \write18 enabled.
  ! I can't find file `no-such-file.tex'.
  <*> no-such-file.tex
                 
  Please type another input file name: x
  (/usr/local/texlive/2014/texmf-dist/tex/latex/tools/x.tex

There is a file x.tex which causes TeX to abort.  It works for both,
LaTeX and plain TeX.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From mq at ucw.cz  Mon May 12 16:02:08 2014
From: mq at ucw.cz (Jan Moskyto Matejka)
Date: Mon, 12 May 2014 16:02:08 +0200
Subject: [luatex] How do you exit luatex?
In-Reply-To: <536FC388.3000506@michael.kropat.name>
References: <536FC388.3000506@michael.kropat.name>
Message-ID: <20140512140208.GD15062@moskyto.dyndns.org>

>     $ luatex no-such-file.tex
>     This is LuaTeX, Version beta-0.76.0-2013061708 (rev 4627)
>     restricted \write18 enabled.
>     ! I can't find file `no-such-file.tex'.
>     <*> no-such-file.tex
> 
>     Please type another input file name: ^C! I can't find file
> `no-such-file'.
>     <*> no-such-file.tex
> 
>     Please type another input file name:
> 
> How do I break out of this loop?

Ctrl+D (end of file) worked for me last time I needed that.
-- 
Jan Matejka aka 'Moskyto' <mq at ucw.cz>
--
Truth emerges more readily from error than from confusion.
(Francis Bacon)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: Digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20140512/53c0b3f4/attachment.bin>

From joseph.wright at morningstar2.co.uk  Fri May 16 22:41:49 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Fri, 16 May 2014 21:41:49 +0100
Subject: [luatex] \luaescapestring and \escapechar
Message-ID: <5376780D.4030603@morningstar2.co.uk>

Hello all,

Running some tests today I stumbled across the following issue. With the
demo:

    \def\test{\luaescapestring{\noexpand\foo}}
    \escapechar=-1\relax
    \test

I get

    This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
     restricted \write18 enabled.
    (./test.tex
    ! String contains an invalid utf-8 sequence.
    test ^^@-luaescapestring {noexpand foo }

    l.3 \test

    ?

I was as you'd imagined a bit surprised: I spent a while looking over my
source for dodgy input before concluding there is something more subtle up.

Is this in some way deliberate or a bug?
-- 
Joseph Wright


From pragma at wxs.nl  Sat May 17 00:15:06 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 17 May 2014 00:15:06 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <5376780D.4030603@morningstar2.co.uk>
References: <5376780D.4030603@morningstar2.co.uk>
Message-ID: <53768DEA.4040703@wxs.nl>

On 5/16/2014 10:41 PM, Joseph Wright wrote:
> Hello all,
>
> Running some tests today I stumbled across the following issue. With the
> demo:
>
>      \def\test{\luaescapestring{\noexpand\foo}}
>      \escapechar=-1\relax
>      \test
>
> I get
>
>      This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
>       restricted \write18 enabled.
>      (./test.tex
>      ! String contains an invalid utf-8 sequence.
>      test ^^@-luaescapestring {noexpand foo }
>
>      l.3 \test
>
>      ?
>
> I was as you'd imagined a bit surprised: I spent a while looking over my
> source for dodgy input before concluding there is something more subtle up.
>
> Is this in some way deliberate or a bug?

\escapechar= 65 : \test == Afoo
\escapechar= 66 : \test == Bfoo
\escapechar=466 : \test == ?foo

so,

\escapechar=66 : \test == <utfchar -1>foo

and that is invalid; of course one can argue that -1 should then result 
in no character (in which case one can wonder what then the Lua escape 
character is)

I've added a tracker/

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------



From heiko.oberdiek at googlemail.com  Sat May 17 04:16:01 2014
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Sat, 17 May 2014 04:16:01 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <5376780D.4030603@morningstar2.co.uk>
References: <5376780D.4030603@morningstar2.co.uk>
Message-ID: <5376C661.70108@googlemail.com>

On 16.05.2014 22:41, Joseph Wright wrote:
> Hello all,
> 
> Running some tests today I stumbled across the following issue. With the
> demo:
> 
>     \def\test{\luaescapestring{\noexpand\foo}}
>     \escapechar=-1\relax
>     \test
> 
> I get
> 
>     This is LuaTeX, Version beta-0.79.1 (TeX Live 2014) (rev 4971)
>      restricted \write18 enabled.
>     (./test.tex
>     ! String contains an invalid utf-8 sequence.
>     test ^^@-luaescapestring {noexpand foo }
> 
>     l.3 \test
> 
>     ?
> 
> I was as you'd imagined a bit surprised: I spent a while looking over my
> source for dodgy input before concluding there is something more subtle up.
> 
> Is this in some way deliberate or a bug?

Clearly a bug.

TeX behavior: If \escapechar is negative or greater than 255 the output
of the escape char is suppressed (via \string, writing unexpandable
commands to files, ...).

LuaTeX: Of course the behavior is different for values greater than 255,
because LuaTeX supports Unicode characters. But negative values are erratic:

    \def\test#1{%
      \escapechar=#1\relax
      \immediate\write16{<\relax>}%
    }
    \test{65}% A
    \test{-1}
    \test{-2}
    \test{-127}
    \test{-128}
    \test{-129}
    \test{-254}
    \test{-255}
    \test{-256}
    \test{-257}
    \test{-959}
    \csname @@end\endcsname\end

Result for "tex":
    65: "A"
    0:  ^^@
    other: no escape char

Result for "luatex":

    65: "A"
    0: nothing, but also the rest of the line "relax >" is gone!!
    -1: 0xFF
    -2: 0xFE
    -127: 0x81
    -128: 0x80
    -129: 0x7F
    -254: 0x02
    -255: 0x01
    -256: nothing, but also the rest of the line "relax >" is gone!!
    -257: 0xFF
    -959: "A"

=> Two bugs:
   * \escapechar=0, then the output of the escape char should
      by character zero (^^@) instead of an unexpected end of string
      that kills characters behind.
   * Negative values of \escapechar: The escape char should not
     be printed at all.

Yours sincerely
  Heiko Oberdiek


From pragma at wxs.nl  Sat May 17 13:48:30 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 17 May 2014 13:48:30 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <5376C661.70108@googlemail.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com>
Message-ID: <53774C8E.9080407@wxs.nl>

On 5/17/2014 4:16 AM, Heiko Oberdiek wrote:

> => Two bugs:
>     * \escapechar=0, then the output of the escape char should
>        by character zero (^^@) instead of an unexpected end of string
>        that kills characters behind.

I tested 0 and got a nul character so that might also depend on other 
issues (Lua can handle them in most cases unless it gets fed into som ec 
helper that sees nul as end-of-string and there is nothing we can do 
about that: 0 = 0 ... no funny ^^ stuff in the escape).

>     * Negative values of \escapechar: The escape char should not
>       be printed at all.

Indeed.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From heiko.oberdiek at googlemail.com  Sat May 17 18:14:14 2014
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Sat, 17 May 2014 18:14:14 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <53774C8E.9080407@wxs.nl>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com> <53774C8E.9080407@wxs.nl>
Message-ID: <53778AD6.1010102@googlemail.com>

On 17.05.2014 13:48, Hans Hagen wrote:
> On 5/17/2014 4:16 AM, Heiko Oberdiek wrote:
> 
>> => Two bugs:
>>     * \escapechar=0, then the output of the escape char should
>>        by character zero (^^@) instead of an unexpected end of string
>>        that kills characters behind.
> 
> I tested 0 and got a nul character so that might also depend on other
> issues (Lua can handle them in most cases unless it gets fed into som ec
> helper that sees nul as end-of-string and there is nothing we can do
> about that: 0 = 0 ... no funny ^^ stuff in the escape).

With `\escapechar=0` it is not possible to get the nul byte in the
string like the other positive values?

Yours sincerely
  Heiko Oberdiek


From joseph.wright at morningstar2.co.uk  Mon May 19 23:21:35 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 19 May 2014 22:21:35 +0100
Subject: [luatex] \showtokens oddities
Message-ID: <537A75DF.7070902@morningstar2.co.uk>

Hello all,

Testing a small example

    \def\foo#1{\showtokens{#1}}
    \foo{bar}

I find odd output with LuaTeX:

    > bar.
    \foo #1^^@-\showtokens {#1}

(TL2014 pretest) while pdfTeX/XeTeX give the more reasonable

    > bar.
    \foo #1->\showtokens {#1}

I'm guessing this is not deliberate: know issue?
-- 
Joseph Wright


From taco at elvenkind.com  Tue May 20 09:17:03 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 20 May 2014 09:17:03 +0200
Subject: [luatex] \showtokens oddities
In-Reply-To: <537A75DF.7070902@morningstar2.co.uk>
References: <537A75DF.7070902@morningstar2.co.uk>
Message-ID: <D576CBD5-CBD6-4EB0-A21E-1FB68E69FB9D@elvenkind.com>


On 19 May 2014, at 23:21, Joseph Wright <joseph.wright at morningstar2.co.uk> wrote:

> Hello all,
> 
> Testing a small example
> 
>    \def\foo#1{\showtokens{#1}}
>    \foo{bar}
> 
> I find odd output with LuaTeX:
> 
>> bar.
>    \foo #1^^@-\showtokens {#1}
> 
> (TL2014 pretest) while pdfTeX/XeTeX give the more reasonable
> 
>> bar.
>    \foo #1->\showtokens {#1}
> 
> I'm guessing this is not deliberate: know issue?


No, that appears to be a new report, thanks. Added to the tracker:

  http://tracker.luatex.org/view.php?id=898

Best wishes,
Taco




From pragma at wxs.nl  Tue May 20 09:52:26 2014
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 May 2014 09:52:26 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <53778AD6.1010102@googlemail.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com> <53774C8E.9080407@wxs.nl>
 <53778AD6.1010102@googlemail.com>
Message-ID: <537B09BA.6010606@wxs.nl>

On 5/17/2014 6:14 PM, Heiko Oberdiek wrote:
> On 17.05.2014 13:48, Hans Hagen wrote:
>> On 5/17/2014 4:16 AM, Heiko Oberdiek wrote:
>>
>>> => Two bugs:
>>>      * \escapechar=0, then the output of the escape char should
>>>         by character zero (^^@) instead of an unexpected end of string
>>>         that kills characters behind.
>>
>> I tested 0 and got a nul character so that might also depend on other
>> issues (Lua can handle them in most cases unless it gets fed into som ec
>> helper that sees nul as end-of-string and there is nothing we can do
>> about that: 0 = 0 ... no funny ^^ stuff in the escape).
>
> With `\escapechar=0` it is not possible to get the nul byte in the
> string like the other positive values?

imo it should be, although one can never be sure if the receiving end is 
8 bit clean or sees <nul> as something special

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------


From taco at elvenkind.com  Tue May 20 11:27:09 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 20 May 2014 11:27:09 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <5376C661.70108@googlemail.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com>
Message-ID: <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>

Hi,

On 17 May 2014, at 04:16, Heiko Oberdiek <heiko.oberdiek at googlemail.com> wrote:

> 
> => Two bugs:
>   * \escapechar=0, then the output of the escape char should
>      by character zero (^^@) instead of an unexpected end of string
>      that kills characters behind.
>   * Negative values of \escapechar: The escape char should not
>     be printed at all.


Both issues should be fixed in the luatex repository trunk now.

Best wishes,
Taco




From joseph.wright at morningstar2.co.uk  Tue May 20 11:33:14 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 20 May 2014 10:33:14 +0100
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com>
 <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>
Message-ID: <537B215A.1090907@morningstar2.co.uk>

On 20/05/2014 10:27, Taco Hoekwater wrote:
> Hi,
> 
> On 17 May 2014, at 04:16, Heiko Oberdiek <heiko.oberdiek at googlemail.com> wrote:
> 
>>
>> => Two bugs:
>>   * \escapechar=0, then the output of the escape char should
>>      by character zero (^^@) instead of an unexpected end of string
>>      that kills characters behind.
>>   * Negative values of \escapechar: The escape char should not
>>     be printed at all.
> 
> 
> Both issues should be fixed in the luatex repository trunk now.
> 
> Best wishes,
> Taco

Great, thanks!
-- 
Joseph Wright


From heiko.oberdiek at googlemail.com  Wed May 21 00:12:36 2014
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Wed, 21 May 2014 00:12:36 +0200
Subject: [luatex] Negative value(s) of \endlinechar
Message-ID: <537BD354.7030908@googlemail.com>

Hello,

there is some discussion of `\endlinechar' in the chat
http://chat.stackexchange.com/rooms/41/tex-latex-and-friends

* David Carlisle detects that \endlinechar has only one
  negative value `-1'
  http://chat.stackexchange.com/transcript/message/15629938#15629938

A test file:

\catcode`\{=1
\catcode`\}=2
\catcode`\#=6 %
\def\test#1{%
  \begingroup
    \endlinechar=#1\relax
    \immediate\write16{<#1=\the\endlinechar>}%
  \endgroup
}
\test{1}
\test{0}
\test{-1}
\test{-2}
\test{-126}
\test{-127}
\test{-128}
\test{-129}
\test{-254}
\test{-255}
\test{-256}
\test{-257}
\test{-1000}

\csname @@end\endcsname\end

Result:

<1=1>
<0=0>
<-1=-1>
<-2=-1>
<-126=-1>
<-127=-1>
<-128=-1>
<-129=-1>
<-254=-1>
<-255=-1>
<-256=-1>
<-257=-1>
<-1000=-1>

* \endlinechar has an upper limit of 127. What is the reason
  for this constraint?

Yours sincerely
  Heiko Oberdiek


From heiko.oberdiek at googlemail.com  Wed May 21 01:31:44 2014
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Wed, 21 May 2014 01:31:44 +0200
Subject: [luatex] \luaescapestring and \escapechar
In-Reply-To: <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com>
 <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>
Message-ID: <537BE5E0.3010707@googlemail.com>

On 20.05.2014 11:27, Taco Hoekwater wrote:
> Hi,
> 
> On 17 May 2014, at 04:16, Heiko Oberdiek <heiko.oberdiek at googlemail.com> wrote:
> 
>>
>> => Two bugs:
>>   * \escapechar=0, then the output of the escape char should
>>      by character zero (^^@) instead of an unexpected end of string
>>      that kills characters behind.
>>   * Negative values of \escapechar: The escape char should not
>>     be printed at all.
> 
> 
> Both issues should be fixed in the luatex repository trunk now.

Thanks (I have build it and have run some tests.)

Best regards
  Heiko Oberdiek


From heiko.oberdiek at googlemail.com  Wed May 21 01:37:06 2014
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Wed, 21 May 2014 01:37:06 +0200
Subject: [luatex] build.sh (was: \luaescapestring and \escapechar)
In-Reply-To: <537BE5E0.3010707@googlemail.com>
References: <5376780D.4030603@morningstar2.co.uk>
 <5376C661.70108@googlemail.com>
 <D04FCC21-00CF-4C54-BBAC-9122C3E92458@elvenkind.com>
 <537BE5E0.3010707@googlemail.com>
Message-ID: <537BE722.30500@googlemail.com>

On 21.05.2014 01:31, Heiko Oberdiek wrote:

> Thanks (I have build it and have run some tests.)

Apropos building:

build.sh failed because of non-existent texk/web2c/luatex.

As workaround I have added after calling `../source/configure`:
    TL_MAKE=$MAKE ../source/configure [...]
the lines
    mkdir texk/web2c
    TL_MAKE=$MAKE ../../../source/texk/web2c/configure [...]

(The real cause could also be in the Makefiles, I haven't investigated.)

Yours sincerely
  Heiko Oberdiek


From taco at elvenkind.com  Wed May 21 09:42:15 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 21 May 2014 09:42:15 +0200
Subject: [luatex] Negative value(s) of \endlinechar
In-Reply-To: <537BD354.7030908@googlemail.com>
References: <537BD354.7030908@googlemail.com>
Message-ID: <BC0BCEA4-D2D9-4413-911A-EE98C59BD6EC@elvenkind.com>


On 21 May 2014, at 00:12, Heiko Oberdiek <heiko.oberdiek at googlemail.com> wrote:

> Hello,
> 
> there is some discussion of `\endlinechar' in the chat
> http://chat.stackexchange.com/rooms/41/tex-latex-and-friends
> 
> * David Carlisle detects that \endlinechar has only one
>  negative value `-1?

True, but that is just an implementation detail.

> * \endlinechar has an upper limit of 127. What is the reason
>  for this constraint?

Because some of the internals are still byte-oriented, especially
the ones that deal with file-io. The constraint is meant to be lifted
somewhere before 1.0

Best wishes,
Taco




From d.p.carlisle at gmail.com  Wed May 21 10:37:38 2014
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 21 May 2014 09:37:38 +0100
Subject: [luatex] Negative value(s) of \endlinechar
Message-ID: <CAEW6iOjC-ToFFA0zAn-xLCSWm47CkWJu6TXGfnCd2UerYQ3KzA@mail.gmail.com>

Taco wrote

>>* * David Carlisle detects that \endlinechar has only one
*>>*  negative value `-1?
*
> True, but that is just an implementation detail.


Well yes/no it's not _just_ an implementation detail: I was trying to fix a
bug in the current re-defintion of \typein in lualatex which had been
redefined  to avoid the 127 restriction (the redefinition in current
lualatex makes it unsafe to use a # in the.value supplied on the terminal)

latex normally adds 1000 to \endlinechar to disable it temporarily  and
subtracts it again to restore the old value.

as the restriction on being <127 was documented I thought I'd just switch
it to subtracting -1000 (which gave no error) and was surprised to get an
error when 1000 was added back. So documenting it at some point would be
nice but it's not a big deal especially as you say the restriction is
planned to go in the end.

(I posted a fix to \typein to the texlive list )

The reason the endlinechar was saved/restored this way in the original
rather than setting it in a local group was to save a few tokens so that
latex2e would load on emtex:-)


While testing typein I noticed another difference between pdftex and luatex
that I don't know is intended or not:


\read15 to \zzzz

\bye


in  tex/pdftex/xetex produces

\zzzz=

but in luatex produces


\zzzz =

with a space after the command name.

This probably only makes a difference to people running diff over logs as
part of a regression test suite:-)  But since it does make a difference
could you confirm whether it's intended to be like that (and we should
accommodate it while normalising any test logs) or if it is likely to
change.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20140521/85a87fe4/attachment-0001.html>

From taco at elvenkind.com  Wed May 21 10:49:17 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 21 May 2014 10:49:17 +0200
Subject: [luatex] Negative value(s) of \endlinechar
In-Reply-To: <CAEW6iOjC-ToFFA0zAn-xLCSWm47CkWJu6TXGfnCd2UerYQ3KzA@mail.gmail.com>
References: <CAEW6iOjC-ToFFA0zAn-xLCSWm47CkWJu6TXGfnCd2UerYQ3KzA@mail.gmail.com>
Message-ID: <4C1EFD15-C23B-4C48-9498-DAC55B6B3222@elvenkind.com>


On 21 May 2014, at 10:37, David Carlisle <d.p.carlisle at gmail.com> wrote:

> 
> Taco wrote
> 
> >>
>  * David Carlisle detects that \endlinechar has only one
> 
> >>
>   negative value `-1?
> 
> 
> > True, but that is just an implementation detail.
> 
> 
> Well yes/no it's not _just_ an implementation detail: I was trying to fix a bug in the current re-defintion of \typein in lualatex which had been redefined  to avoid the 127 restriction (the redefinition in current lualatex makes it unsafe to use a # in the.value supplied on the terminal)

One depressing problem with TeX is that every weird bit of tex.web gets documented
and used and counted on :( 

Ok, so I?ll have to change luatex?s \endlinechar to accept invalid negative values just to
be compatible with the other engines. Not a big deal, really.

> While testing typein I noticed another difference between pdftex and luatex that I don't know is intended or not:
> 
> \read15 to \zzzz
> \bye
> 
> in  tex/pdftex/xetex produces
> 
> \zzzz=
> 
> but in luatex produces
> 
> \zzzz =
> 
> with a space after the command name.
> 
> This probably only makes a difference to people running diff over logs as part of a regression test suite:-)  But since it does make a difference
> could you confirm whether it's intended to be like that (and we should accommodate it while normalising any test logs) or if it is likely to change.

That change will stay. The general ?tex? rule is that multi-letter csnames are followed
by a space when printed. The fact that \read is actually an exception to that rule is just
a bit too bizarre to allow for.

Best wishes,
Taco






From d.p.carlisle at gmail.com  Wed May 21 10:56:50 2014
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Wed, 21 May 2014 09:56:50 +0100
Subject: [luatex] Negative value(s) of \endlinechar
In-Reply-To: <4C1EFD15-C23B-4C48-9498-DAC55B6B3222@elvenkind.com>
References: <CAEW6iOjC-ToFFA0zAn-xLCSWm47CkWJu6TXGfnCd2UerYQ3KzA@mail.gmail.com>
 <4C1EFD15-C23B-4C48-9498-DAC55B6B3222@elvenkind.com>
Message-ID: <CAEW6iOgkH4CHr2P+94OVibzObd6-6f1zBooFYyqZ5gfvfF9TBQ@mail.gmail.com>

On 21 May 2014 09:49, Taco Hoekwater <taco at elvenkind.com> wrote:
>

> One depressing problem with TeX is that every weird bit of tex.web gets documented
> and used and counted on :(

Yes well I know that feeling: that's the way we think about macro
programmers using
the dark corners of latex.ltx. Things would be simpler if there were no users:-)


>
> Ok, so I?ll have to change luatex?s \endlinechar to accept invalid negative values just to
> be compatible with the other engines. Not a big deal, really.

Thanks.


> That change will stay. The general ?tex? rule is that multi-letter csnames are followed
> by a space when printed. The fact that \read is actually an exception to that rule is just
> a bit too bizarre to allow for.
>

OK thanks for the confirmation.

David



From joseph.wright at morningstar2.co.uk  Sat May 24 17:23:49 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Sat, 24 May 2014 16:23:49 +0100
Subject: [luatex] Minor formatting bugs in output
Message-ID: <5380B985.7060106@morningstar2.co.uk>

Hello all,

Setting up some tests which use log file differences, I've run across a
few oddities with LuaTeX. These may or may not be bugs: what I'm after
is status on them. (All tested with an up-to-date TL2014 pretest, luatex
executable.)

First one is the 'more help text for something like:

    \def\foo{#1}

which with LuaTeX reads:

    You meant to type ## instead of #, right?
    Or maybe a } was forgotten somewhere earlier, and things
    are all screwed up? I''m going to assume that you meant ##.

Notice the extra "'" in "I'm" on on the last line. Clear bug, I think :-)

The second one is

    \immediate\write0{\the\foo}

where if we scroll down the log a bit we get

    ! Forbidden control sequence found while scanning text of \write.
    <inserted text>
                    }
    <to be read again>
                       \endwrite
    <inserted text> }\endwrite

    l.5 \immediate\write0{\the\foo}

    ?
    0
    ! Missing { inserted.
    <to be read again>

The difference this time is a space: with pdfTeX/XeTeX that "0" has a
space after it, but with LuaTeX it doesn't. No idea if this is deliberate!

Third one is more serious or at least surprising:

    \expandafter\show\csname foo#\endcsname

gives

    > \foo##=\relax.
    <recently read> \foo##

with LuaTeX but

    > \foo#=\relax.
    <recently read> \foo#

with pdfTeX/XeTeX. The pdfTeX behaviour allows for use of 'odd' catcodes
in csnames, whereas the LuaTeX behaviour means a test would be needed.
--
Joseph Wright


From joseph.wright at morningstar2.co.uk  Mon May 26 08:07:47 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 26 May 2014 07:07:47 +0100
Subject: [luatex] 'Out by one' when writing to log file
Message-ID: <5382DA33.4060208@morningstar2.co.uk>

Hello all,

Another formatting bug/difference between LuaTeX and pdfTeX/XeTeX. With
the example

\immediate\write-1{%
12345678901234567890123456789012345678901234567890123456789012345678901234567890%
}

LuaTeX writes all of the chars (80 of them) to one line in the log. On
the other hand, pdfTeX and XeTeX write 79 chars then wrap, as expected from

    max_print_line = 79

in texmf.cnf. (Testing with TL2014 pretest.)

Bug?
-- 
Joseph Wright


From taco at elvenkind.com  Mon May 26 09:47:10 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 May 2014 09:47:10 +0200
Subject: [luatex] 'Out by one' when writing to log file
In-Reply-To: <5382DA33.4060208@morningstar2.co.uk>
References: <5382DA33.4060208@morningstar2.co.uk>
Message-ID: <2B0F31DF-2FCA-4DB0-84E3-9C5699BFDC49@elvenkind.com>

Hi Joseph,

On 26 May 2014, at 08:07, Joseph Wright <joseph.wright at morningstar2.co.uk> wrote:

> LuaTeX writes all of the chars (80 of them) to one line in the log. On
> the other hand, pdfTeX and XeTeX write 79 chars then wrap, as expected from
> 
>    max_print_line = 79
> 
> in texmf.cnf. (Testing with TL2014 pretest.)
> 
> Bug?

This one is clearly a bug. Tracker at http://tracker.luatex.org/view.php?id=900

Best wishes,
Taco





From taco at elvenkind.com  Mon May 26 09:53:28 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 May 2014 09:53:28 +0200
Subject: [luatex] Minor formatting bugs in output
In-Reply-To: <5380B985.7060106@morningstar2.co.uk>
References: <5380B985.7060106@morningstar2.co.uk>
Message-ID: <72A062DB-7132-49E1-91F6-2B87D28184F9@elvenkind.com>

Hi Joseph,

On 24 May 2014, at 17:23, Joseph Wright <joseph.wright at morningstar2.co.uk> wrote:

> Hello all,
> 
> Setting up some tests which use log file differences, I've run across a
> few oddities with LuaTeX. These may or may not be bugs: what I'm after
> is status on them. (All tested with an up-to-date TL2014 pretest, luatex
> executable.)
> 
> First one is the 'more help text for something like:
> 
>    \def\foo{#1}
> 
> which with LuaTeX reads:
> 
>    You meant to type ## instead of #, right?
>    Or maybe a } was forgotten somewhere earlier, and things
>    are all screwed up? I''m going to assume that you meant ##.
> 
> Notice the extra "'" in "I'm" on on the last line. Clear bug, I think :-)

Yeah, that one was clear and easy, already fixed.

> 
> The second one is
> 
>    \immediate\write0{\the\foo}
> 
> where if we scroll down the log a bit we get
> 
>    ! Forbidden control sequence found while scanning text of \write.
>    <inserted text>
>                    }
>    <to be read again>
>                       \endwrite
>    <inserted text> }\endwrite
> 
>    l.5 \immediate\write0{\the\foo}
> 
>    ?
>    0
>    ! Missing { inserted.
>    <to be read again>
> 
> The difference this time is a space: with pdfTeX/XeTeX that "0" has a
> space after it, but with LuaTeX it doesn't. No idea if this is deliberate!

Neither do I.  Tracked as http://tracker.luatex.org/view.php?id=901

> 
> Third one is more serious or at least surprising:
> 
>    \expandafter\show\csname foo#\endcsname
> 
> gives
> 
>> \foo##=\relax.
>    <recently read> \foo##
> 
> with LuaTeX but
> 
>> \foo#=\relax.
>    <recently read> \foo#
> 
> with pdfTeX/XeTeX. The pdfTeX behaviour allows for use of 'odd' catcodes
> in csnames, whereas the LuaTeX behaviour means a test would be needed.

Neither do I.  Tracked as http://tracker.luatex.org/view.php?id=902

Groetjes,
Taco




From taco at elvenkind.com  Mon May 26 09:57:45 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 May 2014 09:57:45 +0200
Subject: [luatex] Minor formatting bugs in output
In-Reply-To: <72A062DB-7132-49E1-91F6-2B87D28184F9@elvenkind.com>
References: <5380B985.7060106@morningstar2.co.uk>
 <72A062DB-7132-49E1-91F6-2B87D28184F9@elvenkind.com>
Message-ID: <33C241B1-90FC-49A2-A355-755D5B246FC0@elvenkind.com>


On 26 May 2014, at 09:53, Taco Hoekwater <taco at elvenkind.com> wrote:

> 
>> 
>> Third one is more serious or at least surprising:
>> 
>>   \expandafter\show\csname foo#\endcsname
>> 
>> gives
>> 
>>> \foo##=\relax.
>>   <recently read> \foo##
>> 
>> with LuaTeX but
>> 
>>> \foo#=\relax.
>>   <recently read> \foo#
>> 
>> with pdfTeX/XeTeX. The pdfTeX behaviour allows for use of 'odd' catcodes
>> in csnames, whereas the LuaTeX behaviour means a test would be needed.
> 
> Neither do I.  

What I meant to say was that that is almost certainly a bug.

> Tracked as http://tracker.luatex.org/view.php?id=902
> 
> Groetjes,
> Taco
> 
> 
> 



From joseph.wright at morningstar2.co.uk  Mon May 26 10:53:37 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 26 May 2014 09:53:37 +0100
Subject: [luatex] Undefined control sequence: message length/truncation
Message-ID: <53830111.10003@morningstar2.co.uk>

Hello all,

With the minimal test

\def\use#1{#1}
\use{\foo123456789012345678901234567890123456789012345678901234567890XXXXXXXXXXXXXXY}

pdfTeX and LuaTeX give

! Undefined control sequence.
<argument> \foo

123456789012345678901234567890123456789012345678901234567890...

with the "123" starts at column 16, whereas LuaTeX gives

<argument> \foo

123456789012345678901234567890123456789012345678901234567890XXXXXXXXXXXXXX

with the "123" starting at column 5. I'm not sure why this is:
deliberate or not.

Notice that as well as being out in position, LuaTeX truncates with no
"..." so it's not clear that this has happened: again, is this deliberate?

P.S. Thanks for feedback on other issues.
-- 
Joseph Wright


From taco at elvenkind.com  Mon May 26 12:03:44 2014
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 May 2014 12:03:44 +0200
Subject: [luatex] Undefined control sequence: message length/truncation
In-Reply-To: <53830111.10003@morningstar2.co.uk>
References: <53830111.10003@morningstar2.co.uk>
Message-ID: <8538DA71-87E4-44F5-A0F8-2725F6AA71A1@elvenkind.com>


Hi again,


http://tracker.luatex.org/view.php?id=903

Sorry, no time to get into it now.

Best wishes,
Taco

On 26 May 2014, at 10:53, Joseph Wright <joseph.wright at morningstar2.co.uk> wrote:

> Hello all,
> 
> With the minimal test
> 
> \def\use#1{#1}
> \use{\foo123456789012345678901234567890123456789012345678901234567890XXXXXXXXXXXXXXY}
> 
> pdfTeX and LuaTeX give
> 
> ! Undefined control sequence.
> <argument> \foo
> 
> 123456789012345678901234567890123456789012345678901234567890...
> 
> with the "123" starts at column 16, whereas LuaTeX gives
> 
> <argument> \foo
> 
> 123456789012345678901234567890123456789012345678901234567890XXXXXXXXXXXXXX
> 
> with the "123" starting at column 5. I'm not sure why this is:
> deliberate or not.
> 
> Notice that as well as being out in position, LuaTeX truncates with no
> "..." so it's not clear that this has happened: again, is this deliberate?
> 
> P.S. Thanks for feedback on other issues.
> -- 
> Joseph Wright
> 




From joseph.wright at morningstar2.co.uk  Mon May 26 13:15:59 2014
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 26 May 2014 12:15:59 +0100
Subject: [luatex] Undefined control sequence: message length/truncation
In-Reply-To: <8538DA71-87E4-44F5-A0F8-2725F6AA71A1@elvenkind.com>
References: <53830111.10003@morningstar2.co.uk>
 <8538DA71-87E4-44F5-A0F8-2725F6AA71A1@elvenkind.com>
Message-ID: <5383226F.5030803@morningstar2.co.uk>

On 26/05/2014 11:03, Taco Hoekwater wrote:
> 
> Hi again,
> 
> 
> http://tracker.luatex.org/view.php?id=903
> 
> Sorry, no time to get into it now.
> 
> Best wishes,
> Taco

Hello Taco,

Thanks: Key thing for me at this stage is to know that these are bugs.
For the moment I can live with them (all rather esoteric) :-)
-- 
Joseph Wright


From daniel.flipo at free.fr  Sat May 31 18:43:06 2014
From: daniel.flipo at free.fr (Daniel Flipo)
Date: Sat, 31 May 2014 18:43:06 +0200
Subject: [luatex] Error: "! This can't happen (add_disc_widths)."
Message-ID: <538A069A.5000504@free.fr>

Hi all,

In French typography, when two quotations are embedded, every line of 
the inner one should start with a quote character (?) followed by a kern 
(there are variants, but let's stick to this one).

I am trying to implement this in LuaTeX using the following trick inside 
inner quotations:

-- When a line break occurs on a disc node, it is easy to add any hlist 
(? + kern in my case) at the beginning of the next line using the "post" 
field of the disc node; this part works fine.

-- As most line breaks occur on a glue node, I try to replace any glue 
node by a disc node with
"pre"     = empty,
"post"    = "? + kern",
"replace" = the replaced glue.

When I add the Lua code implementing this replacement (glue -> disc) to 
pre_linebreak_filter, and I get the error message:

"! This can't happen (add_disc_widths)."

Thanks in advance for comments and/or ideas for a workaround.

Best wishes,
--
Daniel Flipo



From zappathustra at free.fr  Sat May 31 19:01:55 2014
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 31 May 2014 19:01:55 +0200
Subject: [luatex] Error: "! This can't happen (add_disc_widths)."
In-Reply-To: <538A069A.5000504@free.fr>
References: <538A069A.5000504@free.fr>
Message-ID: <20140531170155.GA3619@attila>

It?s a known bug. See:

    http://tracker.luatex.org/view.php?id=666

(Let?s hope the bug id won?t prevent Saint Taco from exorcizing it.)

Best,
Paul

Le samedi 31 mai 2014 ? 06:43, Daniel Flipo a ?crit:
> Hi all,
> 
> In French typography, when two quotations are embedded, every line of the
> inner one should start with a quote character (?) followed by a kern (there
> are variants, but let's stick to this one).
> 
> I am trying to implement this in LuaTeX using the following trick inside
> inner quotations:
> 
> -- When a line break occurs on a disc node, it is easy to add any hlist (? +
> kern in my case) at the beginning of the next line using the "post" field of
> the disc node; this part works fine.
> 
> -- As most line breaks occur on a glue node, I try to replace any glue node
> by a disc node with
> "pre"     = empty,
> "post"    = "? + kern",
> "replace" = the replaced glue.
> 
> When I add the Lua code implementing this replacement (glue -> disc) to
> pre_linebreak_filter, and I get the error message:
> 
> "! This can't happen (add_disc_widths)."
> 
> Thanks in advance for comments and/or ideas for a workaround.
> 
> Best wishes,
> --
> Daniel Flipo
> 
> 



From zappathustra at free.fr  Sat May 31 20:30:42 2014
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 31 May 2014 20:30:42 +0200
Subject: [luatex] Error: "! This can't happen (add_disc_widths)."
In-Reply-To: <20140531170155.GA3619@attila>
References: <538A069A.5000504@free.fr> <20140531170155.GA3619@attila>
Message-ID: <20140531183042.GA4974@attila>

I forgot an important point:

French ?guillemets continus? can be easily implemented with
\localleftbox (originally from Omega). No need for a hack.

Best,
Paul

Le samedi 31 mai 2014 ? 07:01, Paul Isambert a ?crit:
> It?s a known bug. See:
> 
>     http://tracker.luatex.org/view.php?id=666
> 
> (Let?s hope the bug id won?t prevent Saint Taco from exorcizing it.)
> 
> Best,
> Paul
> 
> Le samedi 31 mai 2014 ? 06:43, Daniel Flipo a ?crit:
> > Hi all,
> > 
> > In French typography, when two quotations are embedded, every line of the
> > inner one should start with a quote character (?) followed by a kern (there
> > are variants, but let's stick to this one).
> > 
> > I am trying to implement this in LuaTeX using the following trick inside
> > inner quotations:
> > 
> > -- When a line break occurs on a disc node, it is easy to add any hlist (? +
> > kern in my case) at the beginning of the next line using the "post" field of
> > the disc node; this part works fine.
> > 
> > -- As most line breaks occur on a glue node, I try to replace any glue node
> > by a disc node with
> > "pre"     = empty,
> > "post"    = "? + kern",
> > "replace" = the replaced glue.
> > 
> > When I add the Lua code implementing this replacement (glue -> disc) to
> > pre_linebreak_filter, and I get the error message:
> > 
> > "! This can't happen (add_disc_widths)."
> > 
> > Thanks in advance for comments and/or ideas for a workaround.
> > 
> > Best wishes,
> > --
> > Daniel Flipo
> > 
> > 
> 
> 



