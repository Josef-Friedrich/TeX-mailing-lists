From mpg at elzevir.fr  Tue Jun  1 11:32:56 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 01 Jun 2010 11:32:56 +0200
Subject: [luatex] [ann] Improved pattern loading for Plain and LaTeX
Message-ID: <4C04D3C8.10301@elzevir.fr>

Dear all,

Users of LuaTeX Plain- or LaTeX-based formats in TeX Live 2009 probably noticed
(and were annoyed by) the very long loading time of these formats. This was due
to hyphenation patterns for all languages being dumped in the format, then
re-hashed by LuaTeX at format loading time, since LuaTeX doesn't do that at
iniTeX time any more.

Recently, LuaTeX-specific versions of babel's and etex's pattern loading systems
have been made (by Khaled, ?lie and myself, with kind support by Mojca and
others) to avoid this problem by only allocating the languages statically, but
loading the actual patterns dynamically at runtime, so that only the patterns
for the languages actually used are loaded. This results in a considerably
shorter start-up time.

This system is installed in TeX Live pretest builds since today. I tested it as
well as I could, but experience proves things always go wrong in weird and
unpredicted ways, so more testing in various situations is most welcome, as well
as suggestions and bug reports.

If you are curious, you may read more about this in luatex-hyphen.pdf, tlmgr(1)
(action "generate") and the file language.dat.lua itself.

Many thanks to all the courageous testers,
Manuel.


PS: of course a completely dynamic system for languages is desirable, but our
goal here was to make minimal changes to the existing systems to fix the problem
with format loading time. Hopefully, (parts of) this work will be useful for
implementing a fully dynamic system later.

From jropers at gmail.com  Tue Jun  1 12:54:21 2010
From: jropers at gmail.com (Jacques ROPERS)
Date: Tue, 1 Jun 2010 12:54:21 +0200
Subject: [luatex] LuaLaTeX and fontspec
In-Reply-To: <htr2ko$ghq$1@dough.gmane.org>
References: <htr2ko$ghq$1@dough.gmane.org>
Message-ID: <AANLkTimFKM3gJDqGZVfAVOPvp4ZFQsKKOrwKQa7TskBL@mail.gmail.com>

Dear Will and all,
I've managed to make lualatex compile a document using fontspec (under win32
using Akira Kakuto's W32TEX + all recently uploaded packages).
However on the same document, xelatex now hangs with the following error
message:

! Undefined control sequence.
<argument> ..._mode_tl {node}\luatexprehyphenchar
                                                  =`\-\luatexposthyphenchar
...
l.68 ...nt = {Futura Std Bold}]{Futura Std Medium}

?

The previous Fontspec compiles perfectly the same document.

Thanks all for your hard work on making Luatex available for Latex.

Best wishes
Jacques




On 5/29/10, Will Robertson <wspr81 at gmail.com> wrote:
>
> Dear all,
>
> New versions of luaotfload and fontspec have recently been uploaded to
> CTAN, and the next test release of TeX Live 2010 will contain support for
> using system fonts in LuaLaTeX. (Apologies to those who get this message
> twice.)
>
> Previous users of fontspec will be familiar with the process, but there are
> some changes in fontspec for LuaLaTeX compared to its XeLaTeX counterpart.
> For those interested, I've written about the biggest changes here: <
> http://latex-alive.tumblr.com/post/643148677/fontspec-for-luatex>
>
> To date, there has been very little testing of the new version of fontspec,
> especially with OpenType font loading in LuaTeX. Any testing you would like
> to perform would be greatly appreciated, especially running the
> mkluatexfontdb script in the luaotfload package and then attempting to
> access system fonts in LuaLaTeX with fontspec.
>
> (E.g., \usepackage{fontspec}...\setmainfont{Georgia} )
>
> Suggestions and (especially) bug reports most appreciated.
>
> Many thanks,
> -- Will
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20100601/7b28565a/attachment.html>

From wspr81 at gmail.com  Tue Jun  1 14:50:10 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 1 Jun 2010 22:20:10 +0930
Subject: [luatex] LuaLaTeX and fontspec
References: <htr2ko$ghq$1@dough.gmane.org>
	<AANLkTimFKM3gJDqGZVfAVOPvp4ZFQsKKOrwKQa7TskBL@mail.gmail.com>
Message-ID: <hu2vm2$rg0$1@dough.gmane.org>

Hi Jacques,

Thank you very much for the feedback.

On 2010-06-01 20:24:21 +0930, Jacques ROPERS 
<jropers at gmail.com> said:


> However on the same document, xelatex now hangs with the following error
> message:
> 
> ! Undefined control sequence.
> <argument> ..._mode_tl {node}\luatexprehyphenchar
>                                                   =`\-\luatexposthyphenchar
> ...
> l.68 ...nt = {Futura Std Bold}]{Futura Std Medium}

This doesn't make much sense to me; I can't imagine how this happens. 
Would you be able to trim down your document into a minimal example of 
the problem and post it here? Also, which version of LuaTeX are you 
using?

Best regards,
Will





From jropers at gmail.com  Tue Jun  1 15:52:22 2010
From: jropers at gmail.com (Jacques ROPERS)
Date: Tue, 1 Jun 2010 15:52:22 +0200
Subject: [luatex] LuaLaTeX and fontspec
In-Reply-To: <hu2vm2$rg0$1@dough.gmane.org>
References: <htr2ko$ghq$1@dough.gmane.org>
	<AANLkTimFKM3gJDqGZVfAVOPvp4ZFQsKKOrwKQa7TskBL@mail.gmail.com>
	<hu2vm2$rg0$1@dough.gmane.org>
Message-ID: <AANLkTinwjvPrqxNe-Dlt8-_ZazR2CXPB4w9VMmLT_P3S@mail.gmail.com>

Hi
During the trimming down process, I found the culprit which appears to be
the "iftex" package.

%******************************************************
\makeatletter\let\ifGm at compatii\relax\makeatother
\documentclass{beamer}

\usepackage{iftex} % Compiles with xelatex only if commented

\usepackage{fontspec}
\setromanfont[Mapping=tex-text]{Futura Std Medium}

\begin{document}
\begin{frame}
lorem ipsum
\end{frame}

\end{document}

%******************************************************

Best regards,

Jacques



On 6/1/10, Will Robertson <wspr81 at gmail.com> wrote:
>
> Hi Jacques,
>
> Thank you very much for the feedback.
>
> On 2010-06-01 20:24:21 +0930, Jacques ROPERS <jropers at gmail.com> said:
>
>
> However on the same document, xelatex now hangs with the following error
>> message:
>>
>> ! Undefined control sequence.
>> <argument> ..._mode_tl {node}\luatexprehyphenchar
>>                                                  =`\-\luatexposthyphenchar
>> ...
>> l.68 ...nt = {Futura Std Bold}]{Futura Std Medium}
>>
>
> This doesn't make much sense to me; I can't imagine how this happens. Would
> you be able to trim down your document into a minimal example of the problem
> and post it here? Also, which version of LuaTeX are you using?
>
> Best regards,
> Will
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20100601/27c90fd7/attachment.html>

From wspr81 at gmail.com  Wed Jun  2 08:42:18 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 2 Jun 2010 16:12:18 +0930
Subject: [luatex] LuaLaTeX and fontspec
References: <htr2ko$ghq$1@dough.gmane.org>
	<AANLkTimFKM3gJDqGZVfAVOPvp4ZFQsKKOrwKQa7TskBL@mail.gmail.com>
	<hu2vm2$rg0$1@dough.gmane.org>
	<AANLkTinwjvPrqxNe-Dlt8-_ZazR2CXPB4w9VMmLT_P3S@mail.gmail.com>
Message-ID: <hu4uga$ito$1@dough.gmane.org>

On 2010-06-01 23:22:22 +0930, Jacques ROPERS 
<jropers at gmail.com> said:

> During the trimming down process, I found the culprit which appears to be
> the "iftex" package.

Ah, thanks. I've written to Vafa to fix the problem. I'll make the 
necessary adjustments in expl3 to avoid a similar issue recurring in 
the future.

You can work around the problem by writing

    \ifxetex\let\directlua\undefined\fi

before \usepackage{fontspec}.

Many thanks,
Will




From wspr81 at gmail.com  Wed Jun  2 09:13:50 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 2 Jun 2010 16:43:50 +0930
Subject: [luatex] Printing to the console
Message-ID: <hu50bd$oth$1@dough.gmane.org>

Hi,

I apologise in advance if this is a silly question.

In luaotfload & fontspec, we're automatically (re-)generating the font 
names database as users load fonts; this is very slow the first time it 
occurs.

In trying to output some messages to tell the user what is taking so 
long, I've found that I can't get anything printed to the console until 
*after* the very-slow-operation has occurred. For example: (change the 
number of zeros if this takes too long)

\directlua{ texio.write_nl("start") }
\directlua{
  local x = 1
  local s = 1
  for i = 1,100000000 do
    x = x+s*i/x
    s = -s
  end
  texio.write_nl(x)
}
\directlua{ texio.write_nl("stop") }
\bye

Is there any way to "flush" the console buffer before the 
very-slow-operation begins?

Many thanks,
Will



From taco at elvenkind.com  Wed Jun  2 13:08:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 02 Jun 2010 13:08:37 +0200
Subject: [luatex] Printing to the console
In-Reply-To: <hu50bd$oth$1@dough.gmane.org>
References: <hu50bd$oth$1@dough.gmane.org>
Message-ID: <4C063BB5.2080103@elvenkind.com>



Will Robertson wrote:
> 
> Is there any way to "flush" the console buffer before the
> very-slow-operation begins?

No, but you can split your print statements: use the
'standard' lua function io.write(..) for the console
and texio.write_nl('log', ...) for the log file.

Best wishes,
Taco

From wspr81 at gmail.com  Thu Jun  3 06:36:05 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 3 Jun 2010 14:06:05 +0930
Subject: [luatex] Printing to the console
References: <hu50bd$oth$1@dough.gmane.org> <4C063BB5.2080103@elvenkind.com>
Message-ID: <hu7bfl$r38$1@dough.gmane.org>

On 2010-06-02 20:38:37 +0930, Taco Hoekwater 
<taco at elvenkind.com> said:

> Will Robertson wrote:
>> 
>> Is there any way to "flush" the console buffer before the
>> very-slow-operation begins?
> 
> No, but you can split your print statements: use the
> 'standard' lua function io.write(..) for the console
> and texio.write_nl('log', ...) for the log file.


Sorry, Taco, I don't follow. You can use texio.write_nl('term', ...) to 
split them up anyway, right? I want both statements set to the console, 
I just want the first one to arrive *before* the big wait while the 
font cache is being built.

The closest I've managed to achieve this with some sort of manual 
effect (albeit totally unuseable) is

\directlua{ io.write("start") }
\def\1{^^J WAIT!}
\def\2{\1\1\1\1\1\1\1\1\1\1\1}
\def\3{\2\2\2\2\2\2\2\2\2\2\2}
\def\4{\3\3\3\3\3\3\3\3\3\3}
\typeout{\4\4 HERE:}

which sends enough data to the console that it prints it all before the 
long operation occurs.

Is it technically feasible to imagine a command like 
"texio.write_flush" that sends its output to the terminal *immediately*?

Will



From taco at elvenkind.com  Thu Jun  3 06:48:30 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 03 Jun 2010 06:48:30 +0200
Subject: [luatex] Printing to the console
In-Reply-To: <hu7bfl$r38$1@dough.gmane.org>
References: <hu50bd$oth$1@dough.gmane.org> <4C063BB5.2080103@elvenkind.com>
	<hu7bfl$r38$1@dough.gmane.org>
Message-ID: <4C07341E.10009@elvenkind.com>



Will Robertson wrote:
> 
> 
> Sorry, Taco, I don't follow. You can use texio.write_nl('term', ...) to
> split them up anyway, right? 

Sorry, I should have tried your example, I misunderstood.

You need this:

  \directlua{ texio.write_nl("start") io.flush()}

Best wishes,
Taco

From wspr81 at gmail.com  Thu Jun  3 06:56:55 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 3 Jun 2010 14:26:55 +0930
Subject: [luatex] Printing to the console
References: <hu50bd$oth$1@dough.gmane.org> <4C063BB5.2080103@elvenkind.com>
	<hu7bfl$r38$1@dough.gmane.org> <4C07341E.10009@elvenkind.com>
Message-ID: <hu7cmm$tni$1@dough.gmane.org>

On 2010-06-03 14:18:30 +0930, Taco Hoekwater 
<taco at elvenkind.com> said:

>   \directlua{ texio.write_nl("start") io.flush()}

Fantastic, thanks!

W



From wspr81 at gmail.com  Fri Jun  4 07:56:21 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 4 Jun 2010 15:26:21 +0930
Subject: [luatex] unicode-math for XeLaTeX & LuaLaTeX
Message-ID: <hua4i5$put$1@dough.gmane.org>

Dear all,

In case you haven't seen already via other sources, I've just uploaded 
the first release of unicode-math to CTAN (see below). Originally 
written to support XeLaTeX, it has tentative support for LuaLaTeX as 
well -- the example file compiles, at least, but the nooks and crannies 
of the package remain unexplored.

If you have a bleeding edge TeX Live 2010 or are happy to install 
packages by hand, any feedback -- and even better, bug fixes :) -- for 
LuaLaTeX support are warmly encouraged.

Long term development of the package is planned to involve 
collaborating with the ConTeXt maths support so that we're all working 
from a common database of unicode math symbols and what to call them. 
But Aditya and I haven't spent much time on that yet. (That's why it's 
"long term" :))

Best regards,
Will


From: CTAN Announcements <ctan-ann at dante.de>
Subject: New on CTAN: unicode-math

the daemon perks up with the appearance of the following (which he had
previously imagined to be a myth concocted by people on the net):

The following information was provided by the package's contributor.

Name of contribution: unicode-math
Author's name: Will Robertson
Location on CTAN: macros/latex/contrib/unicode-math
Summary description: Unicode math support for XeTeX and LuaTeX
License type: lppl

Announcement text given by the package's contributor:
----------------------------------------------------------------------
> Well, I guess it's now or never. With an archive of emails about the
> thing going back to 2006, I think it's finally time to release this
> package. (Sorry about the hold-up, really.)
> 
> This is the initial release of the unicode-math package for inclusion
> in TeX Live 2010. It is designed to typeset mathematics with unicode
> input and using OpenType math fonts. (There is very very little
> compatibility with older maths packages.) XeTeX support is fully
> tested but LuaTeX not quite so much. (At least the example file
> runs...)
> 
> You can typeset with the STIX fonts with the present version of the
> package, but there is no support yet for its extra alphabets in the
> Unicode `private use area'. I hope to add support for them soon.
> 
> Thanks to all the people who've provided valuable feedback over the
> years, and especially to Barbara Beeton for laying the foundations
> with her work with the STIX fonts.
> 
> Good luck; I hope it works. Let me know if it doesn't. Finally, this
> package is by no means complete (it's called the "initial release" for
> a reason). Your feedback and suggestions now are greatly
> appreciated. Anyone coming along to the TUG 2010 conference will have
> the opportunity to hear me speak about it in a couple of weeks. (But
> will I be able to muster up a full 30 minutes? Actually, yeah, I
> probably will.)
> 
> Time for a beer.

have a good one!

i have installed the package and created an entry in the catalogue
repository.

Users may view the package catalogue entry at
http://www.tex.ac.uk/tex-archive/help/Catalogue/entries/unicode-math.html
or they may browse the package directory at
http://www.tex.ac.uk/tex-archive/macros/latex/contrib/unicode-math

though, of course, the catalogue entry won't appear on the web until
some time tonight.

Robin Fairbairns

For the CTAN team


-- Will



From oinos at web.de  Sat Jun  5 13:12:33 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sat, 05 Jun 2010 13:12:33 +0200
Subject: [luatex] on lualatex
Message-ID: <4C0A3121.90206@web.de>

Hi there,

I have just subscribed to the list and I guess this is the right list to 
raise questions about LuaLaTeX issues, isn't it?

I'm using TL2009 as packaged for Ubuntu 10.04 (it is not easy to replace 
this). This means that I don't have access to fontspec version 2.

I would like to start checking LuaLaTeX for micro-typographic features 
(my texts contain no mathematical formulae). My questions are:

How do I get hyphenation for ancient Greek. I mean, babel seems to work 
for Spanish, German and English and I guess it would be the same for 
Latin, French and Italian. How could I get hyphenation for ancient Greek?

I would like to be able to use OpenType fonts without fontspec 2. How 
can rewrite the defaults for roman, sans serif and monospaced families 
(in all fonts), so I would be able to use other fonts than LM or CM.

Thanks for your help,


Pablo

From oinos at web.de  Sat Jun  5 13:21:03 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sat, 05 Jun 2010 13:21:03 +0200
Subject: [luatex] soulutf8 letterspacing and Lua(La)TeX
Message-ID: <4C0A331F.1020605@web.de>

Hi there,

I'm trying to compile the following document:

\documentclass[10pt]{book}
\usepackage[utf8x]{luainputenc}
\usepackage{soulutf8}
\makeatletter\font\SOUL at tt="FreeMono.ttf"\setbox\z@\hbox{\SOUL at tt-}\SOUL at ttwidth\wd\z@\makeatother
\begin{document}
\font\foo="TheanoDidot-Regular.ttf"\foo
This is only a \so{test}.

The Greek sentence {\so{?????? ?? ????}}.

The Greek sentence {\so{??????. ??. ????}}.

The Greek sentence {?????? ?? ????}.
\end{document}

(Theano Classical fonts are available at 
http://www.thessalonica.org.ru/en/fonts-download.html.)

And I get the error: "Reconstruction failed" each time the \so command 
is processed.

The code added to after loading soulutf8 are are two patches from Ulrike 
Fischer (http://tug.org/pipermail/xetex/2010-May/016755.html and 
http://tug.org/pipermail/xetex/2010-May/016763.html) that work with 
Xe(La)TeX.

Would it be possible to fix letterspacing from soulutf8 in Lua(La)TeX?

Thanks for your help,


Pablo

From Arno.Trautmann at gmx.de  Sat Jun  5 13:23:53 2010
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 05 Jun 2010 13:23:53 +0200
Subject: [luatex] on lualatex
In-Reply-To: <4C0A3121.90206@web.de>
References: <4C0A3121.90206@web.de>
Message-ID: <4C0A33C9.8000404@gmx.de>

Hi!

Pablo Rodr?guez wrote:
> Hi there,
> 
> I have just subscribed to the list and I guess this is the right list to
> raise questions about LuaLaTeX issues, isn't it?

This list is about luaTeX as engine; for luaLaTeX better use the list:

lualatex-dev at tug.org

http://www.tug.org/mailman/listinfo/lualatex-dev

cheers
Arno

> I'm using TL2009 as packaged for Ubuntu 10.04 (it is not easy to replace
> this). This means that I don't have access to fontspec version 2.
> 
> I would like to start checking LuaLaTeX for micro-typographic features
> (my texts contain no mathematical formulae). My questions are:
> 
> How do I get hyphenation for ancient Greek. I mean, babel seems to work
> for Spanish, German and English and I guess it would be the same for
> Latin, French and Italian. How could I get hyphenation for ancient Greek?
> 
> I would like to be able to use OpenType fonts without fontspec 2. How
> can rewrite the defaults for roman, sans serif and monospaced families
> (in all fonts), so I would be able to use other fonts than LM or CM.
> 
> Thanks for your help,
> 
> 
> Pablo
> 


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
URL: <http://tug.org/pipermail/luatex/attachments/20100605/ed5a73a8/attachment.bin>

From dcnieho at gmail.com  Sat Jun  5 13:42:34 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Sat, 5 Jun 2010 19:42:34 +0800
Subject: [luatex] on lualatex
In-Reply-To: <4C0A3121.90206@web.de>
References: <4C0A3121.90206@web.de>
Message-ID: <AANLkTimrqx3r1G3Y73alQ5-XPgvcRUtpNyHP6iamHWmj@mail.gmail.com>

>
> I'm using TL2009 as packaged for Ubuntu 10.04 (it is not easy to replace
> this). This means that I don't have access to fontspec version 2.
>
> I would like to start checking LuaLaTeX for micro-typographic features (my
> texts contain no mathematical formulae). My questions are:
>

Do you mean Ubuntu is not easy to replace or TL2009 isn't? The luatex
that comes with 2009 is horribly out of date, you might want to use
TL2010 pretest which should come with an up-to-date luatex and also
fontspec 2 as an added benefit.

If it isn't possible to get TL2010, you could still selectively
replace some binaries and packages in 2009. Gt the binary from
http://www.luatex.org/download.html (I only know about the windows
one, that one seems to be pretty bleeding edge). Don't forget to
rebuild formats after replacing the binary. Fontspec and the needed
luaotfload and luaextra, luatextra etc can be found on github, dont
have the exact links ready but they are floating around here and on
the lualagtex-dev list (where it would indeed be best to ask for
further help, also if you want to follow these steps).

Best,
Dee

From wspr81 at gmail.com  Sat Jun  5 17:35:13 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 6 Jun 2010 01:05:13 +0930
Subject: [luatex] on lualatex
References: <4C0A3121.90206@web.de>
Message-ID: <hudqri$n06$1@dough.gmane.org>

On 2010-06-05 20:42:33 +0930, Pablo Rodr?guez 
<oinos at web.de> said:

> I would like to start checking LuaLaTeX for micro-typographic features 
> (my texts contain no mathematical formulae).

I believe recent versions of microtype support LuaLaTeX now. At some 
stage we might need to coordinate how microtype and fontspec 
communicate. Haven't looked into it yet.

In the meantime you can use Hans' luatex-fonts.tex package to load 
OpenType fonts with Lua(La)TeX. But you'll need to write your own .fd 
files using them if you want to use them with LaTeX without fontspec. 
(E.g., see the eu2lmr.fd files with the euenc package.)

But downloading a recent LuaTeX binary plus the latest versions of 
fontspec, luaotfload, etc., are probably easier :)

Will



From oinos at web.de  Sat Jun  5 18:01:10 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sat, 05 Jun 2010 18:01:10 +0200
Subject: [luatex] on lualatex
In-Reply-To: <4C0A33C9.8000404@gmx.de>
References: <4C0A3121.90206@web.de> <4C0A33C9.8000404@gmx.de>
Message-ID: <4C0A74C6.7090303@web.de>

On 06/05/2010 01:23 PM, Arno Trautmann wrote:
> Hi!
>
> Pablo Rodr?guez wrote:
>> Hi there,
>>
>> I have just subscribed to the list and I guess this is the right list to
>> raise questions about LuaLaTeX issues, isn't it?
>
> This list is about luaTeX as engine; for luaLaTeX better use the list:
>
> lualatex-dev at tug.org
>
> http://www.tug.org/mailman/listinfo/lualatex-dev

Thanks, Arno, for the reply.

I'm afraid that the list you mention is for LuaLaTeX development, not 
for end-users.

Thanks,


Pablo

From mpg at elzevir.fr  Sat Jun  5 18:12:32 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 05 Jun 2010 18:12:32 +0200
Subject: [luatex] on lualatex
In-Reply-To: <AANLkTimrqx3r1G3Y73alQ5-XPgvcRUtpNyHP6iamHWmj@mail.gmail.com>
References: <4C0A3121.90206@web.de>
	<AANLkTimrqx3r1G3Y73alQ5-XPgvcRUtpNyHP6iamHWmj@mail.gmail.com>
Message-ID: <4C0A7770.7040603@elzevir.fr>

Le 05/06/2010 13:42, Diederick C. Niehorster a ?crit :
> Do you mean Ubuntu is not easy to replace or TL2009 isn't? The luatex
> that comes with 2009 is horribly out of date,

For upstream TeX Live, this is true. But Debian (hence, I assume, Ubuntu) ship
the lastest version in their "luatex" package. Currently, LuaTeX 0.60.1 is in
Debian testing.

Manuel.

From wspr81 at gmail.com  Sat Jun  5 18:19:36 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 6 Jun 2010 01:49:36 +0930
Subject: [luatex] on lualatex
References: <4C0A3121.90206@web.de> <4C0A33C9.8000404@gmx.de>
	<4C0A74C6.7090303@web.de>
Message-ID: <hudteo$ujv$1@dough.gmane.org>

On 2010-06-06 01:31:10 +0930, Pablo Rodr?guez 
<oinos at web.de> said:

> On 06/05/2010 01:23 PM, Arno Trautmann wrote:
>> Hi!
>> 
>> Pablo Rodr?guez wrote:
>>> Hi there,
>>> 
>>> I have just subscribed to the list and I guess this is the right list
> to
>>> raise questions about LuaLaTeX issues, isn't it?
>> 
>> This list is about luaTeX as engine; for luaLaTeX better use the list:
>> 
>> lualatex-dev at tug.org
>> 
>> http://www.tug.org/mailman/listinfo/lualatex-dev
> 
> Thanks, Arno, for the reply.
> 
> I'm afraid that the list you mention is for LuaLaTeX development, not 
> for end-users.

Either here or there is fine :)

We discuss minutiae on lualatex-dev, hence not using this list for 
everything, but we're certainly open to questions from all.

Cheers,
W



From oinos at web.de  Sat Jun  5 18:56:46 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sat, 05 Jun 2010 18:56:46 +0200
Subject: [luatex] on lualatex
In-Reply-To: <AANLkTimrqx3r1G3Y73alQ5-XPgvcRUtpNyHP6iamHWmj@mail.gmail.com>
References: <4C0A3121.90206@web.de>
	<AANLkTimrqx3r1G3Y73alQ5-XPgvcRUtpNyHP6iamHWmj@mail.gmail.com>
Message-ID: <4C0A81CE.3000207@web.de>

On 06/05/2010 01:42 PM, Diederick C. Niehorster wrote:
>>
>> I'm using TL2009 as packaged for Ubuntu 10.04 (it is not easy to replace
>> this). This means that I don't have access to fontspec version 2.
>>
>> I would like to start checking LuaLaTeX for micro-typographic features (my
>> texts contain no mathematical formulae). My questions are:
>>
>
> Do you mean Ubuntu is not easy to replace or TL2009 isn't? The luatex
> that comes with 2009 is horribly out of date, you might want to use
> TL2010 pretest which should come with an up-to-date luatex and also
> fontspec 2 as an added benefit.

Thanks for your reply. Diederick.

I meant that I don't really have the required time to mess with that, 
since it takes some (at least downloading the whole distribution and 
configuring it).

If I replace TL2009 with TL2010, I'll have a TeXLive version, which I 
don't know whether is in ? or ? status, not advisable for everyday use.

> If it isn't possible to get TL2010, you could still selectively
> replace some binaries and packages in 2009. Gt the binary from
> http://www.luatex.org/download.html (I only know about the windows
> one, that one seems to be pretty bleeding edge). Don't forget to
> rebuild formats after replacing the binary. Fontspec and the needed
> luaotfload and luaextra, luatextra etc can be found on github, dont
> have the exact links ready but they are floating around here and on
> the lualagtex-dev list (where it would indeed be best to ask for
> further help, also if you want to follow these steps).

Thanks again, but too complicated.

I thought MikTeX Portable 2.8 would include Lua(La)TeX, but this is 
planned for the next 2.9 release.

I'll have to wait for the next TeXLive 2010.

Many thanks for your advice,


Pablo

From oinos at web.de  Sat Jun  5 19:45:09 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sat, 05 Jun 2010 19:45:09 +0200
Subject: [luatex] on lualatex
In-Reply-To: <hudqri$n06$1@dough.gmane.org>
References: <4C0A3121.90206@web.de> <hudqri$n06$1@dough.gmane.org>
Message-ID: <4C0A8D25.1090106@web.de>

On 06/05/2010 05:35 PM, Will Robertson wrote:
> On 2010-06-05 20:42:33 +0930, Pablo Rodr?guez <oinos at web.de> said:
>
>> I would like to start checking LuaLaTeX for micro-typographic features
>> (my texts contain no mathematical formulae).
>
> I believe recent versions of microtype support LuaLaTeX now. At some
> stage we might need to coordinate how microtype and fontspec
> communicate. Haven't looked into it yet.
>
> In the meantime you can use Hans' luatex-fonts.tex package to load
> OpenType fonts with Lua(La)TeX. But you'll need to write your own .fd
> files using them if you want to use them with LaTeX without fontspec.
> (E.g., see the eu2lmr.fd files with the euenc package.)
>
> But downloading a recent LuaTeX binary plus the latest versions of
> fontspec, luaotfload, etc., are probably easier :)

Thanks for your answer, Will.

Writing my own .fd files could be more difficult (I don't think this 
would be so complicated [I had to do that for Lambda, although I 
completely forgot how to do it ;-)]), but it won't take longer than 
downloading and updating.

I have solved it by copying eu2lmr.fd to the same directory where I 
compile the LuaLaTeX file and changing the following:

\DeclareFontShape{EU2}{lmr}{m}{n}%
      {<-10000>    "TheanoDidot-Regular:+tlig;+tsub;+liga;+rlig;"
       }{}

I have two questions:

How could I avoid the <-10000> in fonts that don't have optical sizes?

This only works if I have a copy of the font in the directory where I 
compile the LuaLaTeX document. Is there no way to specify the directory 
where the font is located or isn't it possible to instruct LuaLaTeX to 
find in an external directory (outside the texmf tree)?

Thanks for your help,


Pablo

From wspr81 at gmail.com  Sat Jun  5 20:32:19 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 6 Jun 2010 04:02:19 +0930
Subject: [luatex] on lualatex
References: <4C0A3121.90206@web.de> <hudqri$n06$1@dough.gmane.org>
	<4C0A8D25.1090106@web.de>
Message-ID: <hue57k$mau$1@dough.gmane.org>

On 2010-06-06 03:15:09 +0930, Pablo Rodr?guez 
<oinos at web.de> said:

> Writing my own .fd files could be more difficult (I don't think this 
> would be so complicated [I had to do that for Lambda, although I 
> completely forgot how to do it ;-)]), but it won't take longer than 
> downloading and updating.

You're probably right :)
If you've got a template then .fd files are easy to replicate.

> I have solved it by copying eu2lmr.fd to the same directory where I 
> compile the LuaLaTeX file and changing the following:
> 
> \DeclareFontShape{EU2}{lmr}{m}{n}%
>       {<-10000>    "TheanoDidot-Regular:+tlig;+tsub;+liga;+rlig;"
>        }{}
> 
> I have two questions:
> 
> How could I avoid the <-10000> in fonts that don't have optical sizes?

`texdoc fntguide` tells all.
In this case, just write <->.

> This only works if I have a copy of the font in the directory where I 
> compile the LuaLaTeX document. Is there no way to specify the directory 
> where the font is located or isn't it possible to instruct LuaLaTeX to 
> find in an external directory (outside the texmf tree)?

Using luatex-fonts.tex? I think the fonts have to be in a proper texmf 
location, but perhaps absolute paths work as well.

Cheers,
Will



From oinos at web.de  Sun Jun  6 01:46:58 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 06 Jun 2010 01:46:58 +0200
Subject: [luatex] on lualatex
In-Reply-To: <hue57k$mau$1@dough.gmane.org>
References: <4C0A3121.90206@web.de>
	<hudqri$n06$1@dough.gmane.org>	<4C0A8D25.1090106@web.de>
	<hue57k$mau$1@dough.gmane.org>
Message-ID: <4C0AE1F2.2010909@web.de>

On 06/05/2010 08:32 PM, Will Robertson wrote:
>> [...]
>>
>> How could I avoid the <-10000> in fonts that don't have optical sizes?
>
> `texdoc fntguide` tells all.
> In this case, just write <->.

Thanks. Will.

I didn't remember this (I have been using XeLaTeX for almost 4 years and 
I forgot how to set fonts in LaTeX :-)).

>> This only works if I have a copy of the font in the directory where I
>> compile the LuaLaTeX document. Is there no way to specify the
>> directory where the font is located or isn't it possible to instruct
>> LuaLaTeX to find in an external directory (outside the texmf tree)?
>
> Using luatex-fonts.tex? I think the fonts have to be in a proper texmf
> location, but perhaps absolute paths work as well.

Not using luatex-fonts.tex, since I don't really know how it works.

Symbolic links seemed to do the job in order to find the fonts, but 
besides from that I'm afraid that *nothing else works* properly (no 
ligatures, no font switching, no proper hyphenation in German, ? in crm 
family, no copying and searching text with accents or umlauts [???]...).

Even microtype contains undefined control sequences that render it 
unusable with LuaTeX (I wonder how can this be used with pure LuaTeX).

I'm afraid I'll have to wait for the next TeXLive release.

Just in case I'm totally wrong or missing everything ;-), my sample is 
at http://www.ousia.tk/basic-lualatex.tex (with 
http://www.ousia.tk/basic-lualatex.pdf, 
http://www.ousia.tk/basic-lualatex.log and http://www.ousia.tk/eu2lmr.fd).

Thanks for yoru help,


Pablo

From patrick at gundla.ch  Sun Jun  6 08:27:01 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 6 Jun 2010 08:27:01 +0200
Subject: [luatex] on lualatex
In-Reply-To: <4C0AE1F2.2010909@web.de>
References: <4C0A3121.90206@web.de>
	<hudqri$n06$1@dough.gmane.org>	<4C0A8D25.1090106@web.de>
	<hue57k$mau$1@dough.gmane.org> <4C0AE1F2.2010909@web.de>
Message-ID: <878BBEAF-9EEE-4178-B249-2922E94C310C@gundla.ch>



> Just in case I'm totally wrong or missing everything ;-), my sample is at http://www.ousia.tk/basic-lualatex.tex

don't use luainputenc.

If you understand German: http://www.luatex.de/2010/02/einfaches-lualatex-beispiel-zweite-variante/



Patrick




From oinos at web.de  Sun Jun  6 09:24:30 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 06 Jun 2010 09:24:30 +0200
Subject: [luatex] on lualatex
In-Reply-To: <878BBEAF-9EEE-4178-B249-2922E94C310C@gundla.ch>
References: <4C0A3121.90206@web.de>	<hudqri$n06$1@dough.gmane.org>	<4C0A8D25.1090106@web.de>	<hue57k$mau$1@dough.gmane.org>
	<4C0AE1F2.2010909@web.de>
	<878BBEAF-9EEE-4178-B249-2922E94C310C@gundla.ch>
Message-ID: <4C0B4D2E.60801@web.de>

On 06/06/2010 08:27 AM, Patrick Gundlach wrote:
>
>
>> Just in case I'm totally wrong or missing everything ;-), my sample is at http://www.ousia.tk/basic-lualatex.tex
>
> don't use luainputenc.
>
> If you understand German: http://www.luatex.de/2010/02/einfaches-lualatex-beispiel-zweite-variante/

Many thanks for your help, Patrick.

This solved part of the problems with German hyphenation and characters,

But I'm afraid that font switching and either +liga nor +rlig are 
working with another font than Latin Modern.

Thanks for your help,


Pablo

From oinos at web.de  Sun Jun  6 12:15:12 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 06 Jun 2010 12:15:12 +0200
Subject: [luatex] on lualatex
In-Reply-To: <4C0B4D2E.60801@web.de>
References: <4C0A3121.90206@web.de>	<hudqri$n06$1@dough.gmane.org>	<4C0A8D25.1090106@web.de>	<hue57k$mau$1@dough.gmane.org>	<4C0AE1F2.2010909@web.de>	<878BBEAF-9EEE-4178-B249-2922E94C310C@gundla.ch>
	<4C0B4D2E.60801@web.de>
Message-ID: <4C0B7530.2020209@web.de>

On 06/06/2010 09:24 AM, Pablo Rodr?guez wrote:
> On 06/06/2010 08:27 AM, Patrick Gundlach wrote:
>>
>>
>>> Just in case I'm totally wrong or missing everything ;-), my sample
>>> is at http://www.ousia.tk/basic-lualatex.tex
>>
>> don't use luainputenc.
>>
>> If you understand German:
>> http://www.luatex.de/2010/02/einfaches-lualatex-beispiel-zweite-variante/
>
> Many thanks for your help, Patrick.
>
> This solved part of the problems with German hyphenation and characters,
>
> But I'm afraid that font switching and either +liga nor +rlig are
> working with another font than Latin Modern.

Sorry, my previous statement was wrong, it should read:

But I'm afraid that font switching and either +liga or +rlig are *not* 
working with another font than Latin Modern.

And even that is wrong, since Latin Modern doesn't switch between 
italic, bold roman, smallcaps and similar fonts.

Thanks for your help,


Pablo

From maikekittelmann at web.de  Sat Jun  5 18:13:52 2010
From: maikekittelmann at web.de (Maike Kittelmann)
Date: Sat, 05 Jun 2010 18:13:52 +0200
Subject: [luatex] makor2
Message-ID: <4C0A77C0.6090308@web.de>

Hello!

I am completely new to Luatex. I have used LaTex for quite a long time
and just wanted to use makor2 for hebrew font.

Therefore I did research on Omega, whose development seems to be
completely shut down by now.

Is there a possibility to use makor2 with Luatex? I suppose no, for it
is a completely different programme. Is there a hebrew font support in
Luatex which you could compare to makor2?

Thank you,

M. Kittelmann

From khaledhosny at eglug.org  Sun Jun  6 16:07:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 6 Jun 2010 17:07:59 +0300
Subject: [luatex] makor2
In-Reply-To: <4C0A77C0.6090308@web.de>
References: <4C0A77C0.6090308@web.de>
Message-ID: <20100606140759.GA7635@khaled-laptop>

On Sat, Jun 05, 2010 at 06:13:52PM +0200, Maike Kittelmann wrote:
> Hello!
> 
> I am completely new to Luatex. I have used LaTex for quite a long time
> and just wanted to use makor2 for hebrew font.
> 
> Therefore I did research on Omega, whose development seems to be
> completely shut down by now.
> 
> Is there a possibility to use makor2 with Luatex? I suppose no, for it
> is a completely different programme. Is there a hebrew font support in
> Luatex which you could compare to makor2?

Most of Omega machinery still there, though not regularly tested (if at
all), so there is a possibility for makor2 to work.

I didn't check what makor2 provides myself, but if you are only
interested in Hebrew fonts, then you may just use any standard OpenType
Hebrew font with fontspec package, it should just work.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From rivanvx at gmail.com  Sun Jun  6 21:43:02 2010
From: rivanvx at gmail.com (=?UTF-8?Q?Vedran_Mileti=C4=87?=)
Date: Sun, 6 Jun 2010 21:43:02 +0200
Subject: [luatex] LuaLaTeX 0.60.1
Message-ID: <AANLkTil0yOGOl1tLFt1zfmucgF3D8ukc5A1w-tUFFiVJ@mail.gmail.com>

Hi,

I just want to thank everyone involved in LuaTeX (and LuaLaTeX)
development for 0.60 that is in TL 2010 pretest. It has MUCH improved
in terms of performance compared to 0.40, and it's really quite usable
now.

You guys are awesome. Thank you for the work you have done.

-- 
Vedran Mileti?


From ulrik.vieth at arcor.de  Sun Jun  6 22:55:13 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 06 Jun 2010 22:55:13 +0200
Subject: [luatex] Unicode-math strange results
Message-ID: <4C0C0B31.8030803@arcor.de>

Hi all,

I've doing some testing and found a couple of strange issues,
which might be engine-related rather than macro-related.

I have been running my tests using the following versions:

- fontspec, unicode-math, luaotfload from CTAN (today)
- luatex and xetex binaries from context-minimals

luatex --version
This is LuaTeX, Version beta-0.60.1-2010042811

xetex --version
XeTeX 3.1415926-2.2-0.9995.2 (Web2C 7.5.6)

I have found the following problems:

1. Delimiters:
With xelatex, \left and \right delimiters do not grow.
\big, \Big, \bigg, \Bigg produce only the default size.
With lualatex, delimiters are fine (no problem).

2. Radicals:
With xelatex, I only get a radical sign without a bar.
With lualatex, I get a misplaced radical sign with a very thick bar.
(The radical sign should hang below the baseline, but doesn't.)

Enclosed is a zip file with all test sources and log files.

Regards, Ulrik

P.S: Sorry, for cross-posting, but I wasn't sure,
if everyone was following the unimath group.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: unimath-test.zip
Type: application/zip
Size: 182051 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100606/3af76231/attachment-0001.zip>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lua-test-delim.pdf
Type: application/pdf
Size: 28698 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100606/3af76231/attachment-0004.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lua-test-sqrt.pdf
Type: application/pdf
Size: 28830 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100606/3af76231/attachment-0005.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xe-test-delim.pdf
Type: application/pdf
Size: 20947 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100606/3af76231/attachment-0006.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xe-test-sqrt.pdf
Type: application/pdf
Size: 21071 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100606/3af76231/attachment-0007.pdf>

From khaledhosny at eglug.org  Sun Jun  6 23:01:03 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 7 Jun 2010 00:01:03 +0300
Subject: [luatex] [unimath] Unicode-math strange results
In-Reply-To: <4C0C0B31.8030803@arcor.de>
References: <4C0C0B31.8030803@arcor.de>
Message-ID: <20100606210103.GA13906@khaled-laptop>

On Sun, Jun 06, 2010 at 10:55:13PM +0200, Ulrik Vieth wrote:
>
> 2. Radicals:
> With xelatex, I only get a radical sign without a bar.
> With lualatex, I get a misplaced radical sign with a very thick bar.
> (The radical sign should hang below the baseline, but doesn't.)

This usually means the value of RadicalRuleThikness is ignored and the
engine is falling back to the old TeX method (the hight of radical
glyph).


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Jun  6 23:05:01 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 7 Jun 2010 00:05:01 +0300
Subject: [luatex] [unimath] Unicode-math strange results
In-Reply-To: <20100606210103.GA13906@khaled-laptop>
References: <4C0C0B31.8030803@arcor.de> <20100606210103.GA13906@khaled-laptop>
Message-ID: <20100606210501.GB13906@khaled-laptop>

On Mon, Jun 07, 2010 at 12:01:03AM +0300, Khaled Hosny wrote:
> On Sun, Jun 06, 2010 at 10:55:13PM +0200, Ulrik Vieth wrote:
> >
> > 2. Radicals:
> > With xelatex, I only get a radical sign without a bar.
> > With lualatex, I get a misplaced radical sign with a very thick bar.
> > (The radical sign should hang below the baseline, but doesn't.)
> 
> This usually means the value of RadicalRuleThikness is ignored and the
> engine is falling back to the old TeX method (the hight of radical
> glyph).

I was referring to the lualatex issue.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Sun Jun  6 23:19:41 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 06 Jun 2010 23:19:41 +0200
Subject: [luatex] [unimath] Unicode-math strange results
In-Reply-To: <20100606210501.GB13906@khaled-laptop>
References: <4C0C0B31.8030803@arcor.de> <20100606210103.GA13906@khaled-laptop>
	<20100606210501.GB13906@khaled-laptop>
Message-ID: <4C0C10ED.4040002@arcor.de>

On 06/06/2010 11:05 PM, Khaled Hosny wrote:
>> This usually means the value of RadicalRuleThikness is ignored and the
>> engine is falling back to the old TeX method (the hight of radical
>> glyph).

Yes, but why?  It doesn't seem to be font-dependent.
It also happens if I replace Cambria Math by XITS Math.

Could this be an architecture / library-dependent? (Linux, 64 bit)

Regards, Ulrik

From khaledhosny at eglug.org  Mon Jun  7 07:04:23 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 7 Jun 2010 08:04:23 +0300
Subject: [luatex] [unimath] Unicode-math strange results
In-Reply-To: <4C0C10ED.4040002@arcor.de>
References: <4C0C0B31.8030803@arcor.de> <20100606210103.GA13906@khaled-laptop>
	<20100606210501.GB13906@khaled-laptop> <4C0C10ED.4040002@arcor.de>
Message-ID: <20100607050423.GA3260@khaled-laptop>

On Sun, Jun 06, 2010 at 11:19:41PM +0200, Ulrik Vieth wrote:
> On 06/06/2010 11:05 PM, Khaled Hosny wrote:
> >>This usually means the value of RadicalRuleThikness is ignored and the
> >>engine is falling back to the old TeX method (the hight of radical
> >>glyph).
> 
> Yes, but why?  It doesn't seem to be font-dependent.
> It also happens if I replace Cambria Math by XITS Math.
> 
> Could this be an architecture / library-dependent? (Linux, 64 bit)

I don't think so, it is likely a macro package issue, but we need to do
more bare bone testing (no luaotfload, no fontspec or unicode-math).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Fri Jun 11 23:14:14 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Fri, 11 Jun 2010 23:14:14 +0200
Subject: [luatex] hyphenating ancient Greek
Message-ID: <4C12A726.7040600@web.de>

Hi there,

I hyphenate ancient Greek with babel on LaTeX or polyglossia with XeLaTeX.

How could I do it using Lua(La)TeX?

Thanks,


Pablo

From khaledhosny at eglug.org  Sat Jun 12 00:00:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 12 Jun 2010 01:00:11 +0300
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <4C12A726.7040600@web.de>
References: <4C12A726.7040600@web.de>
Message-ID: <20100611220011.GA12601@khaled-laptop>

On Fri, Jun 11, 2010 at 11:14:14PM +0200, Pablo Rodr?guez wrote:
> Hi there,
> 
> I hyphenate ancient Greek with babel on LaTeX or polyglossia with XeLaTeX.
> 
> How could I do it using Lua(La)TeX?

Assuming you are running a modern tex distro, say texlive 2009, there
nothing special needed, just make sure your document is utf-8, then
activate greek hyphenation in babel as usual.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Sat Jun 12 13:57:02 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sat, 12 Jun 2010 13:57:02 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <20100611220011.GA12601@khaled-laptop>
References: <4C12A726.7040600@web.de> <20100611220011.GA12601@khaled-laptop>
Message-ID: <4C13760E.7060400@web.de>

On 06/12/2010 12:00 AM, Khaled Hosny wrote:
> On Fri, Jun 11, 2010 at 11:14:14PM +0200, Pablo Rodr?guez wrote:
>> Hi there,
>>
>> I hyphenate ancient Greek with babel on LaTeX or polyglossia with XeLaTeX.
>>
>> How could I do it using Lua(La)TeX?
>
> Assuming you are running a modern tex distro, say texlive 2009, there
> nothing special needed, just make sure your document is utf-8, then
> activate greek hyphenation in babel as usual.

Thanks for your reply, Khaled.

I use TL2009, my document is utf8, babel is invoked the usual way (at 
least for greek), pdflatex and xelatex work, but lualatex doesn't:

\documentclass[a5paper,12pt]{article}
\usepackage[greek]{babel}
\usepackage{ifluatex}
\usepackage{ifxetex}
\ifluatex
\usepackage{luaotfload}
\usepackage[EU2]{fontenc}
\renewcommand*{\greektext}{}
\else
\ifxetex
\usepackage{xltxtra}
\setmainfont{Theano Didot}
\renewcommand*{\greektext}{}
\else
\usepackage[utf8x]{inputenc}
\fi
\fi
\begin{document}
\showhyphens{??????}
? ????????  ?????  ???????????  ?? ??????????: ?????????  ???  ???? 
????????  ?????  ?????  ? ?????  ??????  ????  ???????  ????  ????????? 
  ???  ????????  ?????????  ???????????: ???  ???  ??????  ??????  ???? 
  ??????????  ??????: ??????  ???  ????? ????? ??? ????????? ??? ??????? 
????? ??? ???????????? ??? ?????????? ???????????.
\end{document}

Am I missing something?

Thanks for your help,


Pablo

From khaledhosny at eglug.org  Sat Jun 12 17:07:14 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 12 Jun 2010 18:07:14 +0300
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <4C13760E.7060400@web.de>
References: <4C12A726.7040600@web.de> <20100611220011.GA12601@khaled-laptop>
	<4C13760E.7060400@web.de>
Message-ID: <20100612150714.GA2729@khaled-laptop>

On Sat, Jun 12, 2010 at 01:57:02PM +0200, Pablo Rodr?guez wrote:
> On 06/12/2010 12:00 AM, Khaled Hosny wrote:
> >On Fri, Jun 11, 2010 at 11:14:14PM +0200, Pablo Rodr?guez wrote:
> >>Hi there,
> >>
> >>I hyphenate ancient Greek with babel on LaTeX or polyglossia with XeLaTeX.
> >>
> >>How could I do it using Lua(La)TeX?
> >
> >Assuming you are running a modern tex distro, say texlive 2009, there
> >nothing special needed, just make sure your document is utf-8, then
> >activate greek hyphenation in babel as usual.
> 
> Thanks for your reply, Khaled.
> 
> I use TL2009, my document is utf8, babel is invoked the usual way
> (at least for greek), pdflatex and xelatex work, but lualatex
> doesn't:

I should have kept my mouth shut up, sorry but was just a clueless
comment that I gave.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From patrick at gundla.ch  Sat Jun 12 17:57:11 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 12 Jun 2010 17:57:11 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <4C13760E.7060400@web.de>
References: <4C12A726.7040600@web.de> <20100611220011.GA12601@khaled-laptop>
	<4C13760E.7060400@web.de>
Message-ID: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>

Hi,

> 
> \documentclass[a5paper,12pt]{article}
> \usepackage[greek]{babel}
> \usepackage{ifluatex}
> \usepackage{ifxetex}
> \ifluatex


\lccode`?=`?
\lccode`?=`?
\lccode`?=`?
\lccode`?=`?
\lccode`?=`?
\lccode`?=`?


> \usepackage{luaotfload}
> \usepackage[EU2]{fontenc}
> \renewcommand*{\greektext}{}
> \else
> \ifxetex
> \usepackage{xltxtra}
> \setmainfont{Theano Didot}
> \renewcommand*{\greektext}{}
> \else
> \usepackage[utf8x]{inputenc}
> \fi
> \fi
> \begin{document}
> \showhyphens{??????}
> ? ????????  ?????  ???????????  ?? ??????????: ?????????  ???  ???? ????????  ?????  ?????  ? ?????  ??????  ????  ???????  ????  ?????????  ???  ????????  ?????????  ???????????: ???  ???  ??????  ??????  ????  ??????????  ??????: ??????  ???  ????? ????? ??? ????????? ??? ??????? ????? ??? ???????????? ??? ?????????? ???????????.
> \end{document}
> 
> Am I missing something?



... to set lccode for every greek letter (as far as understand it, but someone else should confirm).

Underfull \hbox (badness 10000) in paragraph at lines 29--29
[][] \EU2/cmr/m/n/12 ??-??-??


Patrick

... whishing that this could be done at the engine level....



From mpg at elzevir.fr  Sat Jun 12 19:34:03 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 12 Jun 2010 19:34:03 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
References: <4C12A726.7040600@web.de>
	<20100611220011.GA12601@khaled-laptop>	<4C13760E.7060400@web.de>
	<9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
Message-ID: <4C13C50B.7040203@elzevir.fr>

Le 12/06/2010 17:57, Patrick Gundlach a ?crit :
> ... whishing that this could be done at the engine level....
> 
It doesn't belong to the engine level, IMO.

Anyway, with XeTeX it's not done at the engine level either: the file
unicode-letters.tex, loaded in xetex-based formats, takes care of this.
(However, it is true that this file, or more precisely the script that generates
it, is part of the XeTeX sources.)

It is certainly desirable to have something similar in the LuaLaTeX world. It
shouldn't be too difficult to generate a version of unicode-letters for LuaTeX,
we could then \input it in the formats too.

Manuel.

From patrick at gundla.ch  Sat Jun 12 19:36:39 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 12 Jun 2010 19:36:39 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <4C13C50B.7040203@elzevir.fr>
References: <4C12A726.7040600@web.de>
	<20100611220011.GA12601@khaled-laptop>	<4C13760E.7060400@web.de>
	<9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
	<4C13C50B.7040203@elzevir.fr>
Message-ID: <22C817E5-8DA3-49E0-BBFD-2FBF15131617@gundla.ch>


Am 12.06.2010 um 19:34 schrieb Manuel P?gouri?-Gonnard:

> Le 12/06/2010 17:57, Patrick Gundlach a ?crit :
>> ... whishing that this could be done at the engine level....
>> 
> It doesn't belong to the engine level, IMO.

You're right. But perhaps a Lua-helper that iterates over all lowercase unicode characters? Or... OK I assume that I need to do that myself.

Patrick



From mpg at elzevir.fr  Sat Jun 12 19:51:51 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 12 Jun 2010 19:51:51 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <22C817E5-8DA3-49E0-BBFD-2FBF15131617@gundla.ch>
References: <4C12A726.7040600@web.de>	<20100611220011.GA12601@khaled-laptop>	<4C13760E.7060400@web.de>	<9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>	<4C13C50B.7040203@elzevir.fr>
	<22C817E5-8DA3-49E0-BBFD-2FBF15131617@gundla.ch>
Message-ID: <4C13C937.8040406@elzevir.fr>

Le 12/06/2010 19:36, Patrick Gundlach a ?crit :
> 
> Am 12.06.2010 um 19:34 schrieb Manuel P?gouri?-Gonnard:
> 
>> Le 12/06/2010 17:57, Patrick Gundlach a ?crit :
>>> ... whishing that this could be done at the engine level....
>>>
>> It doesn't belong to the engine level, IMO.
> 
> You're right. But perhaps a Lua-helper that iterates over all lowercase
> unicode characters? Or... OK I assume that I need to do that myself.
> 
I just started a discussion on lualatex-dev about that, we'll most probably do
that in the format at some point. Atm, the solution I considered was to adapt
unicode-letters, but a Lua-based version would be fine too.

Feel free to join the discussion, and anyway if you do something like that
yourself, please keep us informed so that we avoid duplicated work.

Thanks,
Manuel.

From patrick at gundla.ch  Sat Jun 12 20:00:54 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 12 Jun 2010 20:00:54 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <4C13C937.8040406@elzevir.fr>
References: <4C12A726.7040600@web.de>	<20100611220011.GA12601@khaled-laptop>	<4C13760E.7060400@web.de>	<9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>	<4C13C50B.7040203@elzevir.fr>
	<22C817E5-8DA3-49E0-BBFD-2FBF15131617@gundla.ch>
	<4C13C937.8040406@elzevir.fr>
Message-ID: <489F2318-009E-4F02-84A9-D10470EF0C40@gundla.ch>

> Feel free to join the discussion, and anyway if you do something like that
> yourself, please keep us informed so that we avoid duplicated work.

I have just subscribed to the list.


I'd rather wait for

http://tracker.luatex.org/view.php?id=364

to be finished (as I am not keen to do this on the \TeX level). This (for me) is not LaTeX related.

Patrick



From Robin.Fairbairns at cl.cam.ac.uk  Sat Jun 12 20:16:48 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sat, 12 Jun 2010 19:16:48 +0100
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: Your message of Sat, 12 Jun 2010 17:57:11 +0200.
	<9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
Message-ID: <29967.1276366608@cl.cam.ac.uk>

Patrick Gundlach <patrick at gundla.ch> wrote:

> ... to set lccode for every greek letter (as far as understand it, but someone else should confirm).
> 
> Underfull \hbox (badness 10000) in paragraph at lines 29--29
> [][] \EU2/cmr/m/n/12 ??-??-??
> 
> ... whishing that this could be done at the engine level....

what?  setting uc/lccode tables?  that would require a further primitive
to specify the language (and probably also writing scheme -- i'm not
enough of a linguist to know), since the meanings and relations of
glyphs differ in some languages.

type example:

in english, the uccode of i gives you I
in turkish, the uccode of i gives you \.I
       (and the lccode of I gives you \i)

robin




From patrick at gundla.ch  Sat Jun 12 20:29:58 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 12 Jun 2010 20:29:58 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <29967.1276366608@cl.cam.ac.uk>
References: <29967.1276366608@cl.cam.ac.uk>
Message-ID: <BF5FA519-5BBF-4DD4-806D-B20F00E88DEF@gundla.ch>


Am 12.06.2010 um 20:16 schrieb Robin Fairbairns:

> Patrick Gundlach <patrick at gundla.ch> wrote:
> 
>> ... to set lccode for every greek letter (as far as understand it, but someone else should confirm).
>> 
>> Underfull \hbox (badness 10000) in paragraph at lines 29--29
>> [][] \EU2/cmr/m/n/12 ??-??-??
>> 
>> ... whishing that this could be done at the engine level....
> 
> what?  setting uc/lccode tables?

Yes. But I realize that this is not very clever and thus I take back my suggestion.

Patrick



From khaledhosny at eglug.org  Sat Jun 12 21:07:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 12 Jun 2010 22:07:43 +0300
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <29967.1276366608@cl.cam.ac.uk>
References: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
	<29967.1276366608@cl.cam.ac.uk>
Message-ID: <20100612190743.GA4917@khaled-laptop>

On Sat, Jun 12, 2010 at 07:16:48PM +0100, Robin Fairbairns wrote:
> Patrick Gundlach <patrick at gundla.ch> wrote:
> 
> > ... to set lccode for every greek letter (as far as understand it, but someone else should confirm).
> > 
> > Underfull \hbox (badness 10000) in paragraph at lines 29--29
> > [][] \EU2/cmr/m/n/12 ??-??-??
> > 
> > ... whishing that this could be done at the engine level....
> 
> what?  setting uc/lccode tables?  that would require a further primitive
> to specify the language (and probably also writing scheme -- i'm not
> enough of a linguist to know), since the meanings and relations of
> glyphs differ in some languages.
> 
> type example:
> 
> in english, the uccode of i gives you I
> in turkish, the uccode of i gives you \.I
>        (and the lccode of I gives you \i)

Unicode have uppercase/lowe case matching some where in its data, so we
could just follow whatever unicode suggests.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From reinhard.kotucha at web.de  Sat Jun 12 22:55:56 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 12 Jun 2010 22:55:56 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <20100612190743.GA4917@khaled-laptop>
References: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
	<29967.1276366608@cl.cam.ac.uk>
	<20100612190743.GA4917@khaled-laptop>
Message-ID: <19475.62556.67789.676478@zaphod.ms25.net>

On 12 June 2010 Khaled Hosny wrote:

 > On Sat, Jun 12, 2010 at 07:16:48PM +0100, Robin Fairbairns wrote:
 > > Patrick Gundlach <patrick at gundla.ch> wrote:
 > > 
 > > > ... to set lccode for every greek letter (as far as understand it, but someone else should confirm).
 > > > 
 > > > Underfull \hbox (badness 10000) in paragraph at lines 29--29
 > > > [][] \EU2/cmr/m/n/12 ??-??-??
 > > > 
 > > > ... whishing that this could be done at the engine level....
 > > 
 > > what?  setting uc/lccode tables?  that would require a further primitive
 > > to specify the language (and probably also writing scheme -- i'm not
 > > enough of a linguist to know), since the meanings and relations of
 > > glyphs differ in some languages.
 > > 
 > > type example:
 > > 
 > > in english, the uccode of i gives you I
 > > in turkish, the uccode of i gives you \.I
 > >        (and the lccode of I gives you \i)
 > 
 > Unicode have uppercase/lowe case matching some where in its data, so we
 > could just follow whatever unicode suggests.

Sure, but I fear that Robin's objection is still valid.  Unicode
treats Turkish as an exception too, see:

   http://unicode.org/Public/UNIDATA/CaseFolding.txt

As far as I understand you have to know in advance whether you are
typesetting Turkish.  A static table for all languages isn't
sufficient.

It would be much more convenient if case folding wouldn't depend on
the language, i.e. the Turkish "i" had a separate code point.

However, I think it's solvable.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From khaledhosny at eglug.org  Sat Jun 12 23:08:04 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 00:08:04 +0300
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <19475.62556.67789.676478@zaphod.ms25.net>
References: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>
	<29967.1276366608@cl.cam.ac.uk>
	<20100612190743.GA4917@khaled-laptop>
	<19475.62556.67789.676478@zaphod.ms25.net>
Message-ID: <20100612210804.GA5438@khaled-laptop>

On Sat, Jun 12, 2010 at 10:55:56PM +0200, Reinhard Kotucha wrote:
> On 12 June 2010 Khaled Hosny wrote:
> 
>  > On Sat, Jun 12, 2010 at 07:16:48PM +0100, Robin Fairbairns wrote:
>  > > Patrick Gundlach <patrick at gundla.ch> wrote:
>  > > 
>  > > > ... to set lccode for every greek letter (as far as understand it, but someone else should confirm).
>  > > > 
>  > > > Underfull \hbox (badness 10000) in paragraph at lines 29--29
>  > > > [][] \EU2/cmr/m/n/12 ??-??-??
>  > > > 
>  > > > ... whishing that this could be done at the engine level....
>  > > 
>  > > what?  setting uc/lccode tables?  that would require a further primitive
>  > > to specify the language (and probably also writing scheme -- i'm not
>  > > enough of a linguist to know), since the meanings and relations of
>  > > glyphs differ in some languages.
>  > > 
>  > > type example:
>  > > 
>  > > in english, the uccode of i gives you I
>  > > in turkish, the uccode of i gives you \.I
>  > >        (and the lccode of I gives you \i)
>  > 
>  > Unicode have uppercase/lowe case matching some where in its data, so we
>  > could just follow whatever unicode suggests.
> 
> Sure, but I fear that Robin's objection is still valid.  Unicode
> treats Turkish as an exception too, see:
> 
>    http://unicode.org/Public/UNIDATA/CaseFolding.txt
> 
> As far as I understand you have to know in advance whether you are
> typesetting Turkish.  A static table for all languages isn't
> sufficient.
> 
> It would be much more convenient if case folding wouldn't depend on
> the language, i.e. the Turkish "i" had a separate code point.
> 
> However, I think it's solvable.

Well, tex hyphenation still kind of black art to me, but if the tables
are to be language specific, then we shouldn't it in the format, but
rather hook some (lua?) code to the language activation sytem that would
do that on the fly, right?

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sat Jun 12 23:15:00 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 12 Jun 2010 23:15:00 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <20100612210804.GA5438@khaled-laptop>
References: <9B95EA08-DF39-42A7-BDC3-CD4CCB0752FC@gundla.ch>	<29967.1276366608@cl.cam.ac.uk>	<20100612190743.GA4917@khaled-laptop>	<19475.62556.67789.676478@zaphod.ms25.net>
	<20100612210804.GA5438@khaled-laptop>
Message-ID: <4C13F8D4.9040601@elzevir.fr>

Le 12/06/2010 23:08, Khaled Hosny a ?crit :
>> As far as I understand you have to know in advance whether you are
>> typesetting Turkish.  A static table for all languages isn't
>> sufficient.
>>
>> It would be much more convenient if case folding wouldn't depend on
>> the language, i.e. the Turkish "i" had a separate code point.
>>
>> However, I think it's solvable.
> 
> Well, tex hyphenation still kind of black art to me, but if the tables
> are to be language specific, then we shouldn't it in the format, but
> rather hook some (lua?) code to the language activation sytem that would
> do that on the fly, right?
> 
IMO, if Turkish is the only exception, it's better to set the non-Turkish
\lccode's in the format, and let the the supporting macros for Turkish handle
the few changes needed (with babel, it is easy to do using \(no)extrastrukish
for example).

Manuel.

From Robin.Fairbairns at cl.cam.ac.uk  Sat Jun 12 23:20:28 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sat, 12 Jun 2010 22:20:28 +0100
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: Your message of Sat, 12 Jun 2010 22:55:56 +0200.
	<19475.62556.67789.676478@zaphod.ms25.net>
Message-ID: <5515.1276377628@cl.cam.ac.uk>

Reinhard Kotucha <reinhard.kotucha at web.de> wrote:

> On 12 June 2010 Khaled Hosny wrote:
> 
>  > Unicode have uppercase/lowe case matching some where in its data, so we
>  > could just follow whatever unicode suggests.

i didn't know about that.  i haven't finished reading even the wildly
out of date unicode standard i have (dating from some time in the 90s),
let alone a current version.

> Sure, but I fear that Robin's objection is still valid.  Unicode
> treats Turkish as an exception too, see:
> 
>    http://unicode.org/Public/UNIDATA/CaseFolding.txt
> 
> As far as I understand you have to know in advance whether you are
> typesetting Turkish.  A static table for all languages isn't
> sufficient.
> 
> It would be much more convenient if case folding wouldn't depend on
> the language, i.e. the Turkish "i" had a separate code point.

interesting the difference in attitude as between different languages.
for example, the glyph capital A appears in english, greek and russian
-- three different alphabets --- with the same sound (to first order).

yet a significantly different pair of glyphs (i in english and turkish)
apparently occupy the same code point.  (unfortunately, in the russian-
greek-english i speak from some knowledge of all three languages, but i
know no turkish at all, beyond its typographic issues and what spam in
turkish looks like...).

> However, I think it's solvable.

it would be interesting to know how.

robin

From Robin.Fairbairns at cl.cam.ac.uk  Sat Jun 12 23:31:39 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sat, 12 Jun 2010 22:31:39 +0100
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: Your message of Sat, 12 Jun 2010 23:15:00 +0200.
	<4C13F8D4.9040601@elzevir.fr>
Message-ID: <5998.1276378299@cl.cam.ac.uk>

Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:

> Le 12/06/2010 23:08, Khaled Hosny a ?crit :
> >> As far as I understand you have to know in advance whether you are
> >> typesetting Turkish.  A static table for all languages isn't
> >> sufficient.
> >>
> >> It would be much more convenient if case folding wouldn't depend on
> >> the language, i.e. the Turkish "i" had a separate code point.
> >>
> >> However, I think it's solvable.
> > 
> > Well, tex hyphenation still kind of black art to me, but if the tables
> > are to be language specific, then we shouldn't it in the format, but
> > rather hook some (lua?) code to the language activation sytem that would
> > do that on the fly, right?
> 
> IMO, if Turkish is the only exception,

i doubt it is, but i don't know.  there are certainly other languages
that have dotted and un-dotted "i" in bother lower and upper case (i
_think_ ukrainian, but memory's not clear).

> it's better to set the non-Turkish
> \lccode's in the format, and let the the supporting macros for Turkish handle
> the few changes needed (with babel, it is easy to do using \(no)extrastrukish
> for example).

create one exception, and before you know where you are, it's taken over
the world.

using standard uc/lc tables is attractive, but one shouldn't assume it
will "simply avoid" the straightjacket we're already in, in latex 2e,
about the way encodings work.

robin


From ulrik.vieth at arcor.de  Sun Jun 13 01:55:51 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 01:55:51 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
Message-ID: <4C141E87.9020904@arcor.de>

Hi all,

last week I reported some weird results while testing unicode-math with 
xelatex und lualatex.

While the xelatex issue has been confirmed by others and seems to be a 
specific problem of 64 bit systems, the luatex issues remained unclear.

I have now done some more testing to investigate what's going on.

My test essentially consists of $\sqrt{x}$ followed by \showlists within 
the wrapper of a minimal LuaLaTeX document.

What happens is that the radical rule thickness is caclulated based
on the height of the radical glyph instead (as for TFM fonts) instead of 
using the RadicalRuleThicknessParameter (as for OpenType fonts).

(I'm looking at note 2 in section 5.5 of the LuaTeX reference,
which is about the difference between TFM and OpenType fonts.)

Here is the relevant output of \showlist for $\sqrt{x}$:

\mathon
\hbox(15.03995+0.09)x14.78, direction TLT
.\hbox(9.73+2.59)x9.28, shifted -4.90997, direction TLT
..\EU2/XITSMath(0)/m/n/10 ?
.\vbox(15.03995+0.09)x5.5, direction TLT
..\kern0.39998      <- should be \kern 0.49997 (RadicalExtraAscender 50)
..\rule(9.73+0.0)x* <- should be \rule 0.66667 (RadicalRuleThickness 66)
..\kern0.49997      <- seems  OK \kern 0.49997 (RadicalVerticalGap 50)
..\hbox(4.41+0.09)x5.5, direction TLT
...\EU2/XITSMath(0)/m/n/10 ??
\mathoff

Form the log file, it appears that XITSMath is loaded in \fam 4,
but I do not see any \Umathradical... assignments for this font.

Could it be that some of the TFM-based \Umathradical... parameters
from cmsy + cmex in \fam2 + \fam3 are retained instead of applying
the OpenType math parameters from XITSMath in \fam 4?

Traditional \TeX always used to treat \fam2 + \fam3 as the source
of global \fontdimen parameters applicable to all font families.
Does this still hold for LuaTeX?  Does it no longer apply for XeTeX?

Could it be that unicode-math.sty is taking an inappropriate approach
by loading the new OpenType math font into a new family, instead of 
replacing and overriding the default value in \fam2 + \fam3?

So much for my analysis of the LuaLaTeX problem with unicode-math.
Hopefully, it should be simple now to fix it, once it is understood.

Regards, Ulrik

-------------- next part --------------
A non-text attachment was scrubbed...
Name: lua-test-sqrt.zip
Type: application/zip
Size: 48133 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100613/d52d1950/attachment-0001.zip>

From ulrik.vieth at arcor.de  Sun Jun 13 11:56:56 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 11:56:56 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C141E87.9020904@arcor.de>
References: <4C141E87.9020904@arcor.de>
Message-ID: <4C14AB68.5020400@arcor.de>

On 06/13/2010 01:55 AM, Ulrik Vieth wrote:
>
> Could it be that some of the TFM-based \Umathradical... parameters
> from cmsy + cmex in \fam2 + \fam3 are retained instead of applying
> the OpenType math parameters from XITSMath in \fam 4?
>
> Traditional \TeX always used to treat \fam2 + \fam3 as the source
> of global \fontdimen parameters applicable to all font families.
> Does this still hold for LuaTeX? Does it no longer apply for XeTeX?
>
> Could it be that unicode-math.sty is taking an inappropriate approach
> by loading the new OpenType math font into a new family, instead of
> replacing and overriding the default value in \fam2 + \fam3?

After a bit of thinking, I wonder if LuaTeX should reconsider its
approach to handling OpenType math font parameters:

For example, if you load CambriaMath, AsanaMath and XITSMath into
\fam 4, 5, 6, and each comes with its own set of OT math parameters, why 
should any set of parameters from \fam 2 + \fam 3 apply globally?

  Why not take the parameters directly from each font in the case of
OpenType and apply the global defaults only in the case of TFM fonts?
Apparently, that seems to be the way that XeTeX handles this case.

Regards, Ulrik

From taco at elvenkind.com  Sun Jun 13 11:58:31 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 11:58:31 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14AB68.5020400@arcor.de>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
Message-ID: <4C14ABC7.1090408@elvenkind.com>

Ulrik Vieth wrote:
> On 06/13/2010 01:55 AM, Ulrik Vieth wrote:
>>
>> Could it be that some of the TFM-based \Umathradical... parameters
>> from cmsy + cmex in \fam2 + \fam3 are retained instead of applying
>> the OpenType math parameters from XITSMath in \fam 4?
>>
>> Traditional \TeX always used to treat \fam2 + \fam3 as the source
>> of global \fontdimen parameters applicable to all font families.
>> Does this still hold for LuaTeX? Does it no longer apply for XeTeX?
>>
>> Could it be that unicode-math.sty is taking an inappropriate approach
>> by loading the new OpenType math font into a new family, instead of
>> replacing and overriding the default value in \fam2 + \fam3?
> 
> After a bit of thinking, I wonder if LuaTeX should reconsider its
> approach to handling OpenType math font parameters:
> 
> For example, if you load CambriaMath, AsanaMath and XITSMath into
> \fam 4, 5, 6, and each comes with its own set of OT math parameters, why 
> should any set of parameters from \fam 2 + \fam 3 apply globally?

Is there a $\fam=3 $ set up in lualatex?

Best wishes,
Taco

From taco at elvenkind.com  Sun Jun 13 12:01:24 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 12:01:24 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14ABC7.1090408@elvenkind.com>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com>
Message-ID: <4C14AC74.9060104@elvenkind.com>

Taco Hoekwater wrote:
> Ulrik Vieth wrote:
>> On 06/13/2010 01:55 AM, Ulrik Vieth wrote:
>>>
>>> Could it be that some of the TFM-based \Umathradical... parameters
>>> from cmsy + cmex in \fam2 + \fam3 are retained instead of applying
>>> the OpenType math parameters from XITSMath in \fam 4?
>>>
>>> Traditional \TeX always used to treat \fam2 + \fam3 as the source
>>> of global \fontdimen parameters applicable to all font families.
>>> Does this still hold for LuaTeX? Does it no longer apply for XeTeX?
>>>
>>> Could it be that unicode-math.sty is taking an inappropriate approach
>>> by loading the new OpenType math font into a new family, instead of
>>> replacing and overriding the default value in \fam2 + \fam3?
>>
>> After a bit of thinking, I wonder if LuaTeX should reconsider its
>> approach to handling OpenType math font parameters:
>>
>> For example, if you load CambriaMath, AsanaMath and XITSMath into
>> \fam 4, 5, 6, and each comes with its own set of OT math parameters, 
>> why should any set of parameters from \fam 2 + \fam 3 apply globally?
> 
> Is there a $\fam=3 $ set up in lualatex?

Sorry, that should be \fam=4, I guess. Luatex takes the parameters
from the currently active math family, I think.

To verify this: could someone give me a plain luatex test file ?

Best wishes,
Taco

From ulrik.vieth at arcor.de  Sun Jun 13 12:16:59 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 12:16:59 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14AC74.9060104@elvenkind.com>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>
Message-ID: <4C14B01B.2080202@arcor.de>

On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>
>> Is there a $\fam=3 $ set up in lualatex?
>
> Sorry, that should be \fam=4, I guess. Luatex takes the parameters
> from the currently active math family, I think.

Seems to me that LuaLaTeX starts out with TFM-based CM fonts preloaded 
in \fam 0...3.  (That's still the default setup for LaTeX, after all.)
After that, unicode-math.sty begins to load additional OT math fonts
in \fam 4 and upwards.

That's what the log file showed:

\symum_allsym=\mathgroup4

math at fonts ->
textfont symoperators OT1/cmr/m/n/10
scriptfont symoperators OT1/cmr/m/n/7
scriptscriptfont symoperators OT1/cmr/m/n/5
textfont symletters OML/cmm/m/it/10
scriptfont symletters OML/cmm/m/it/7
scriptscriptfont symletters OML/cmm/m/it/5
textfont symsymbols OMS/cmsy/m/n/10
scriptfont symsymbols OMS/cmsy/m/n/7
scriptscriptfont symsymbols OMS/cmsy/m/n/5
textfont symlargesymbols OMX/cmex/m/n/10
scriptfont symlargesymbols OMX/cmex/m/n/7
scriptscriptfont symlargesymbols OMX/cmex/m/n/5
textfont symum_allsym EU2/XITSMath(0)/m/n/10
scriptfont symum_allsym EU2/XITSMath(0)/m/n/7
scriptscriptfont symum_allsym EU2/XITSMath(0)/m/n/5

{\textfont}
{assigning \textfont4=EU2/XITSMath(0)/m/n/10}
{\scriptfont}
{assigning \scriptfont4=EU2/XITSMath(0)/m/n/7}
{\scriptscriptfont}
{assigning \scriptscriptfont4=EU2/XITSMath(0)/m/n/5}

The interesting thing is, that assigning fonts for \fam2 + \fam3
triggers all kinds of tracing output {assigning \Umath<param>=<value>},
whereas assigning \fam 4 doesn't do anything of this kind.

> To verify this: could someone give me a plain luatex test file ?

I don't have one at hand.  I need to work on it.

Regards, Ulrik


From ulrik.vieth at arcor.de  Sun Jun 13 12:18:33 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 12:18:33 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14AC74.9060104@elvenkind.com>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>
Message-ID: <4C14B079.5030809@arcor.de>

On 06/13/2010 12:01 PM, Taco Hoekwater wrote:

> Luatex takes the parameters
> from the currently active math family, I think.

Do you just belive so or are you sure about this?

Regards, Ulrik

From taco at elvenkind.com  Sun Jun 13 12:19:25 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 12:19:25 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14B079.5030809@arcor.de>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de>
Message-ID: <4C14B0AD.8080301@elvenkind.com>

Ulrik Vieth wrote:
> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
> 
>> Luatex takes the parameters
>> from the currently active math family, I think.
> 
> Do you just belive so or are you sure about this?


If I was sure I wouldn't need a test file ;)

From ulrik.vieth at arcor.de  Sun Jun 13 12:47:22 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 12:47:22 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14B0AD.8080301@elvenkind.com>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>
Message-ID: <4C14B73A.5030508@arcor.de>

On 06/13/2010 12:19 PM, Taco Hoekwater wrote:
> Ulrik Vieth wrote:
>> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>
>>> Luatex takes the parameters
>>> from the currently active math family, I think.
>>
>> Do you just belive so or are you sure about this?
>
>
> If I was sure I wouldn't need a test file ;)

OK, here's a test file for plain LuaTeX.

Regards, Ulrik

-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex-test.tex
Type: text/x-tex
Size: 548 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100613/7dca4f87/attachment-0001.bin>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: luatex-test.log
URL: <http://tug.org/pipermail/luatex/attachments/20100613/7dca4f87/attachment-0001.pl>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex-test.pdf
Type: application/pdf
Size: 10461 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100613/7dca4f87/attachment-0001.pdf>

From taco at elvenkind.com  Sun Jun 13 13:00:39 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 13:00:39 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14B73A.5030508@arcor.de>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>	<4C14B0AD.8080301@elvenkind.com>
	<4C14B73A.5030508@arcor.de>
Message-ID: <4C14BA57.40004@elvenkind.com>

Ulrik Vieth wrote:
> On 06/13/2010 12:19 PM, Taco Hoekwater wrote:
>> Ulrik Vieth wrote:
>>> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>>
>>>> Luatex takes the parameters
>>>> from the currently active math family, I think.
>>>
>>> Do you just belive so or are you sure about this?
>>
>>
>> If I was sure I wouldn't need a test file ;)
> 
> OK, here's a test file for plain LuaTeX.

Thanks. More later, first I have to download a bunch of
packages...

From ulrik.vieth at arcor.de  Sun Jun 13 13:09:40 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 13:09:40 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14BA57.40004@elvenkind.com>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>
	<4C14BA57.40004@elvenkind.com>
Message-ID: <4C14BC74.5000604@arcor.de>

On 06/13/2010 01:00 PM, Taco Hoekwater wrote:
> Ulrik Vieth wrote:
>> On 06/13/2010 12:19 PM, Taco Hoekwater wrote:
>>> Ulrik Vieth wrote:
>>>> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>>>
>>>>> Luatex takes the parameters
>>>>> from the currently active math family, I think.
>>>>
>>>> Do you just belive so or are you sure about this?
>>>
>>>
>>> If I was sure I wouldn't need a test file ;)
>>
>> OK, here's a test file for plain LuaTeX.
>
> Thanks. More later, first I have to download a bunch of
> packages...
>

Sorry for that, but that seems to be unavoidable.
Using OpenType math fonts in plain LuaTeX without
luaotfload would be a bit tricky.

Regards, Ulrik

From Robin.Fairbairns at cl.cam.ac.uk  Sun Jun 13 14:09:07 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Sun, 13 Jun 2010 13:09:07 +0100
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: Your message of Sun, 13 Jun 2010 12:16:59 +0200.
	<4C14B01B.2080202@arcor.de>
Message-ID: <26927.1276430947@cl.cam.ac.uk>

Ulrik Vieth <ulrik.vieth at arcor.de> wrote:

> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
> >>
> >> Is there a $\fam=3 $ set up in lualatex?
> >
> > Sorry, that should be \fam=4, I guess. Luatex takes the parameters
> > from the currently active math family, I think.
> 
> Seems to me that LuaLaTeX starts out with TFM-based CM fonts preloaded
> in \fam 0...3.  (That's still the default setup for LaTeX, after all.)
> After that, unicode-math.sty begins to load additional OT math fonts
> in \fam 4 and upwards.

no.  latex sets up the fonts thus, but doesn't assign the families until
the first maths group; this way, you can have a non-cm font family
without being having 4 families already set up -- remember, there's a
chronic shortage of maths font families.

run the following small doc:

\documentclass{article}
%deliberately not minimal...
\begin{document}
 \typeout{\string\the\string\textfont0\space is \the\textfont0}
$\typeout{\string\the\string\textfont0\space is \the\textfont0}$
\end{document}

the output is

  \the\textfont0 is \nullfont 
  \the\textfont0 is \OT1/cmr/m/n/10 

latex has set up fam0--fam3 at the start of the first group.

plain doesn't, of course, do this.  latex can, since it has the luxury
of a highly complex font-handling mechanism.

robin

From taco at elvenkind.com  Sun Jun 13 14:10:29 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 14:10:29 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14BC74.5000604@arcor.de>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>	<4C14BA57.40004@elvenkind.com>
	<4C14BC74.5000604@arcor.de>
Message-ID: <4C14CAB5.40102@elvenkind.com>

Ulrik Vieth wrote:
> On 06/13/2010 01:00 PM, Taco Hoekwater wrote:
>> Ulrik Vieth wrote:
>>> On 06/13/2010 12:19 PM, Taco Hoekwater wrote:
>>>> Ulrik Vieth wrote:
>>>>> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>>>>
>>>>>> Luatex takes the parameters
>>>>>> from the currently active math family, I think.
>>>>>
>>>>> Do you just belive so or are you sure about this?
>>>>
>>>>
>>>> If I was sure I wouldn't need a test file ;)
>>>
>>> OK, here's a test file for plain LuaTeX.
>>
>> Thanks. More later, first I have to download a bunch of
>> packages...
> 
> Sorry for that, but that seems to be unavoidable.
> Using OpenType math fonts in plain LuaTeX without
> luaotfload would be a bit tricky.

No problem, it worked out fine (fetched the zips from ctan).
The only odd thing is that 'docstrip' is part of 'latex'
in texlive, so I had to copy a docstrip.tex by hand.

The problem with unicode-math is that the lua table for
the XITS Math font is *not* created with a valid MathConstants
table. I do not know why that happens, but it is definitely a
macro package issue.

Best wishes,
Taco


From taco at elvenkind.com  Sun Jun 13 14:11:41 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 14:11:41 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <26927.1276430947@cl.cam.ac.uk>
References: <26927.1276430947@cl.cam.ac.uk>
Message-ID: <4C14CAFD.7000501@elvenkind.com>

Robin Fairbairns wrote:
> Ulrik Vieth <ulrik.vieth at arcor.de> wrote:
> 
>> On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
>>>> Is there a $\fam=3 $ set up in lualatex?
>>> Sorry, that should be \fam=4, I guess. Luatex takes the parameters
>>> from the currently active math family, I think.
>> Seems to me that LuaLaTeX starts out with TFM-based CM fonts preloaded
>> in \fam 0...3.  (That's still the default setup for LaTeX, after all.)
>> After that, unicode-math.sty begins to load additional OT math fonts
>> in \fam 4 and upwards.
> 
> no.  latex sets up the fonts thus, but doesn't assign the families until
> the first maths group; this way, you can have a non-cm font family
> without being having 4 families already set up -- remember, there's a
> chronic shortage of maths font families.

There was a chronic shortage of math families :)

Thanks for clearing this up, but it turns out this is not related to the
bug at hand at all (see my other email).

Best wishes,
Taco

From ulrik.vieth at arcor.de  Sun Jun 13 14:33:22 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 14:33:22 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14CAB5.40102@elvenkind.com>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>	<4C14BA57.40004@elvenkind.com>	<4C14BC74.5000604@arcor.de>
	<4C14CAB5.40102@elvenkind.com>
Message-ID: <4C14D012.1030802@arcor.de>

On 06/13/2010 02:10 PM, Taco Hoekwater wrote:
>
> The problem with unicode-math is that the lua table for
> the XITS Math font is *not* created with a valid MathConstants
> table. I do not know why that happens, but it is definitely a
> macro package issue.

So, you mean this is something related to luaotfload ?

I actually did some more testing in the meantime and found some weird 
results, which seem to indicate problems parsing the font params:

Instead of loading the OT font into \fam4, I tried loading it into
\fam 0...3 to make sure that all CM-based values are overidden.

\font\1="XITS Math:script=math" at 10pt
\font\2="XITS Math:script=math;+ssty=0" at 7pt
\font\3="XITS Math:script=math;+ssty=1" at 5pt

\textfont0=\1 \scriptfont0=\2 \scriptscriptfont0=\3
\textfont1=\1 \scriptfont1=\2 \scriptscriptfont1=\3
\textfont2=\1 \scriptfont2=\2 \scriptscriptfont2=\3
\textfont3=\1 \scriptfont3=\2 \scriptscriptfont3=\3

What happens is that I now get a much bigger vertical gap and a
much bigger version of the sqrt sign.

...\hbox(39.86499+0.09)x16.74, direction TLT
....\hbox(20.56+4.04)x11.24, shifted -12.685, direction TLT
.....\1 ??
....\vbox(39.86499+0.09)x5.5, direction TLT
.....\kern6.62
.....\rule(20.56+0.0)x*
.....\kern8.275
.....\hbox(4.41+0.09)x5.5, direction TLT
......\1 ??
...\mathoff

So I end up with the following values:

RadicalExtraAscender 	6.62pt instead of 0.5pt
RadicalRuleThickness	height of radical glyph instead of 0.66 pt
RadicalVerticalGap	8.275 pt instead of 0.5 pt

 From the \tracingall output, I see the following assignments of values:

{assigning \Umathradicalvgap\displaystyle=99941}
{assigning \Umathradicalvgap\crampeddisplaystyle=99941}
{assigning \textfont2=\1}

{assigning \Umathradicalvgap\textstyle=542310}
{assigning \Umathradicalvgap\crampedtextstyle=542310}
{assigning \Umathradicalvgap\displaystyle=507576}
{assigning \Umathradicalvgap\crampeddisplaystyle=507576}
{assigning \textfont3=\1}

There are no values of \Umathradicalrule, so the TFM height is used,
and the value of \Umathradicalvgap is very strange:
542310 sp / 65536 = 8.285 pt

If I look into the font cache for xits-math.lua, I can clearly see
the following values:

RadicalExtraAscender=50,
RadicalRuleThickness=66,
RadicalVerticalGap=50,

Somehow the parsing of these values seems to be very wrong.
If I understand correctly, that's a matter of luaotfload. Right?!

Regards, Ulrik

From taco at elvenkind.com  Sun Jun 13 14:52:15 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 13 Jun 2010 14:52:15 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14D012.1030802@arcor.de>
References: <4C141E87.9020904@arcor.de>	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>	<4C14BA57.40004@elvenkind.com>	<4C14BC74.5000604@arcor.de>	<4C14CAB5.40102@elvenkind.com>
	<4C14D012.1030802@arcor.de>
Message-ID: <4C14D47F.3000200@elvenkind.com>

Ulrik Vieth wrote:
> 
> Somehow the parsing of these values seems to be very wrong.
> If I understand correctly, that's a matter of luaotfload. Right?!

Something is wrong in luaotfload, yes.

Best wishes,
Taco

From joelcsalomon at gmail.com  Sun Jun 13 13:46:30 2010
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Sun, 13 Jun 2010 07:46:30 -0400
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <5515.1276377628@cl.cam.ac.uk>
References: <5515.1276377628@cl.cam.ac.uk>
Message-ID: <4C14C516.6040505@gmail.com>

On 06/12/2010 05:20 PM, Robin Fairbairns wrote:
> Reinhard Kotucha <reinhard.kotucha at web.de> wrote:
>> It would be much more convenient if case folding wouldn't depend on
>> the language, i.e. the Turkish "i" had a separate code point.
> 
> interesting the difference in attitude as between different languages.
> for example, the glyph capital A appears in english, greek and russian
> -- three different alphabets --- with the same sound (to first order).
> 
> yet a significantly different pair of glyphs (i in english and turkish)
> apparently occupy the same code point.

Well, there are three different alphabets at play here: Latin, Greek,
and Cyrillic.  For all that Turkish is using rules unlike most
Latin-alphabet languages, it is still using the Latin letters.

It might have been useful to encode a new letter that looks like ?i?
whose uppercasing is ??? and a clone of ?I? whose lowercase is ???, but
preexisting Turkish texts use ASCII ?i? and ?I? and Unicode was
constrained to backward-compatibility in these cases.

(Creating a new character is no panacea; consider:  What is the
uppercasing of ????  If you?re uppercasing the word ?wei?e?, you should
get ?WEISSE?, i.e., ?????SS? (but not the reverse: ?ss???SS?); if it?s
the _name_ ?Wei?e? you?re uppercasing, you should get ?WEI?E?, i.e.,
???????.  Would you care to tell Germans that the Eszett/?sharp s? used
in names is a different letter from the one used in common words?)

?Joel

From reinhard.kotucha at web.de  Sun Jun 13 15:29:08 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 13 Jun 2010 15:29:08 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <5515.1276377628@cl.cam.ac.uk>
References: <19475.62556.67789.676478@zaphod.ms25.net>
	<5515.1276377628@cl.cam.ac.uk>
Message-ID: <19476.56612.431080.336238@zaphod.ms25.net>

On 12 June 2010 Robin Fairbairns wrote:

 > Reinhard Kotucha <reinhard.kotucha at web.de> wrote:
 > 
 > > It would be much more convenient if case folding wouldn't depend on
 > > the language, i.e. the Turkish "i" had a separate code point.
 > 
 > interesting the difference in attitude as between different languages.
 > for example, the glyph capital A appears in english, greek and russian
 > -- three different alphabets --- with the same sound (to first order).
 > 
 > yet a significantly different pair of glyphs (i in english and turkish)
 > apparently occupy the same code point.  (unfortunately, in the russian-
 > greek-english i speak from some knowledge of all three languages, but i
 > know no turkish at all, beyond its typographic issues and what spam in
 > turkish looks like...).
 > 
 > > However, I think it's solvable.
 > 
 > it would be interesting to know how.

I suppose that the data will be stored in a Lua table (associative
array).  Values in tables are not restricted to strings or numbers.
They can also be functions or other tables.

  uccode = {} -- create a table

  uccode[0x0061] = 0x0041  -- a
  uccode[0x0062] = 0x0042  -- b
  uccode[0x0063] = 0x0043  -- c
  ...
  uccode[0x0069] = { default = 0x0049, turkish = 0x0130 } -- i
  ...

When TeX's uccode array is initialized (yes, I think TeX can't use
this table directly), the default value is used if the type of a table
entry is a table instead of a number.  If you switch from English to
Turkish, you have to change TeX's \uccode and restore it afterwards
(at the same time you switch between hyphenation patterns).

This is _one_ approach.  Others are thinkable but this one might work
without changing the TeX engine too much.  The only requirement is
that TeX's \uccode array can have more than 256 entries, but I suppose
this is already the case in LuaTeX.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From pragma at wxs.nl  Sun Jun 13 16:24:57 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 13 Jun 2010 16:24:57 +0200
Subject: [luatex] hyphenating ancient Greek
In-Reply-To: <19476.56612.431080.336238@zaphod.ms25.net>
References: <19475.62556.67789.676478@zaphod.ms25.net>	<5515.1276377628@cl.cam.ac.uk>
	<19476.56612.431080.336238@zaphod.ms25.net>
Message-ID: <4C14EA39.9090406@wxs.nl>

On 13-6-2010 3:29, Reinhard Kotucha wrote:
> On 12 June 2010 Robin Fairbairns wrote:
>
>   >  Reinhard Kotucha<reinhard.kotucha at web.de>  wrote:
>   >
>   >  >  It would be much more convenient if case folding wouldn't depend on
>   >  >  the language, i.e. the Turkish "i" had a separate code point.
>   >
>   >  interesting the difference in attitude as between different languages.
>   >  for example, the glyph capital A appears in english, greek and russian
>   >  -- three different alphabets --- with the same sound (to first order).
>   >
>   >  yet a significantly different pair of glyphs (i in english and turkish)
>   >  apparently occupy the same code point.  (unfortunately, in the russian-
>   >  greek-english i speak from some knowledge of all three languages, but i
>   >  know no turkish at all, beyond its typographic issues and what spam in
>   >  turkish looks like...).
>   >
>   >  >  However, I think it's solvable.
>   >
>   >  it would be interesting to know how.
>
> I suppose that the data will be stored in a Lua table (associative
> array).  Values in tables are not restricted to strings or numbers.
> They can also be functions or other tables.
>
>    uccode = {} -- create a table
>
>    uccode[0x0061] = 0x0041  -- a
>    uccode[0x0062] = 0x0042  -- b
>    uccode[0x0063] = 0x0043  -- c
>    ...
>    uccode[0x0069] = { default = 0x0049, turkish = 0x0130 } -- i
>    ...
>
> When TeX's uccode array is initialized (yes, I think TeX can't use
> this table directly), the default value is used if the type of a table
> entry is a table instead of a number.  If you switch from English to
> Turkish, you have to change TeX's \uccode and restore it afterwards
> (at the same time you switch between hyphenation patterns).

future luatex versions will store the lccodes with the language (as in 
etex) so then this switching will happen automatically

> This is _one_ approach.  Others are thinkable but this one might work
> without changing the TeX engine too much.  The only requirement is
> that TeX's \uccode array can have more than 256 entries, but I suppose
> this is already the case in LuaTeX.

om this respect there is no difference between regular etex and luatex 
(given that lccodes are stored with th elanguag ewhich is in on the agenda)

initializing lc codes when loading the format can be done using the 
lccode primitive in the usual way (on the agenda is a tex.setlccode 
function but it will not be more efficient than \lccode n = m)

such things are mostly a macro package issue

(related upper/lowercas issues are another matter and definitely a macro 
package issue; tex's lowercase / uppercase is hardly useful for more 
complex cases anyway)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Jun 13 17:24:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 18:24:21 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14B73A.5030508@arcor.de>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<4C14B73A.5030508@arcor.de>
Message-ID: <20100613152421.GA2354@khaled-laptop>

On Sun, Jun 13, 2010 at 12:47:22PM +0200, Ulrik Vieth wrote:
> On 06/13/2010 12:19 PM, Taco Hoekwater wrote:
> >Ulrik Vieth wrote:
> >>On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
> >>
> >>>Luatex takes the parameters
> >>>from the currently active math family, I think.
> >>
> >>Do you just belive so or are you sure about this?
> >
> >
> >If I was sure I wouldn't need a test file ;)
> 
> OK, here's a test file for plain LuaTeX.

> \font\4="XITS Math:script=math;mapping=math-italic" at 10pt

"mapping" is not a defined luaotfload feature, so you can safely remove
this. You may aso want to set "mode=base".



-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Jun 13 17:28:35 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 18:28:35 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14D47F.3000200@elvenkind.com>
References: <4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<4C14B73A.5030508@arcor.de> <4C14BA57.40004@elvenkind.com>
	<4C14BC74.5000604@arcor.de> <4C14CAB5.40102@elvenkind.com>
	<4C14D012.1030802@arcor.de> <4C14D47F.3000200@elvenkind.com>
Message-ID: <20100613152820.GB2354@khaled-laptop>

On Sun, Jun 13, 2010 at 02:52:15PM +0200, Taco Hoekwater wrote:
> Ulrik Vieth wrote:
> >
> >Somehow the parsing of these values seems to be very wrong.
> >If I understand correctly, that's a matter of luaotfload. Right?!
> 
> Something is wrong in luaotfload, yes.

For the record, I once imported the whole ConTeXt math lua modules into
luaotfload, some issues were fixed, but I got a bunch of new issues that
I reverted that since I wasn't sure what was actually needed.

Now if some one can tell me what luaotfload is supposed to do, e.g. what
TFM tables are missing, I can work on that.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Sun Jun 13 17:38:32 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 17:38:32 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100613152421.GA2354@khaled-laptop>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>
	<20100613152421.GA2354@khaled-laptop>
Message-ID: <4C14FB78.4040405@arcor.de>

On 06/13/2010 05:24 PM, Khaled Hosny wrote:
>
>> \font\4="XITS Math:script=math;mapping=math-italic" at 10pt
>
> "mapping" is not a defined luaotfload feature, so you can safely remove
> this. You may aso want to set "mode=base".

Yes, I noticed that myself. This was accidently copied that from another 
test file for plain XeTeX, but it shouldn't matter.

Regards, Ulrik.

From khaledhosny at eglug.org  Sun Jun 13 17:50:36 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 18:50:36 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14B0AD.8080301@elvenkind.com>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
Message-ID: <20100613155036.GA2721@khaled-laptop>

On Sun, Jun 13, 2010 at 12:19:25PM +0200, Taco Hoekwater wrote:
> Ulrik Vieth wrote:
> >On 06/13/2010 12:01 PM, Taco Hoekwater wrote:
> >
> >>Luatex takes the parameters
> >>from the currently active math family, I think.
> >
> >Do you just belive so or are you sure about this?
> 
> 
> If I was sure I wouldn't need a test file ;)

The manual, 5.5, says:

While it is nice to have these math parameters available for tweaking,
it would be tedious to have to set each of them by hand. For this
reason, LuaTEX initializes a bunch of these parameters whenever you
assign a font identifier to a math family based on either the
traditional math font dimensions in the font (for assignments to math
family 2 and 3 using tfm-based fonts like cmsy and cmex), or based
on the named values in a potential MathConstants table when the font is
loaded via Lua. If there is a MathConstants table, this takes precedence
over font dimensions, and in that case no attention is paid to which
family is being assigned to: the MathConstants tables in the last
assigned family sets all parameters.

I think it is a bit clear what we are missing now, a MathConstants
table. Just to be sure, is there any thing else we should consider?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Sun Jun 13 17:56:01 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 17:56:01 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100613152820.GB2354@khaled-laptop>
References: <4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>	<4C14B73A.5030508@arcor.de>
	<4C14BA57.40004@elvenkind.com>	<4C14BC74.5000604@arcor.de>
	<4C14CAB5.40102@elvenkind.com>	<4C14D012.1030802@arcor.de>
	<4C14D47F.3000200@elvenkind.com>
	<20100613152820.GB2354@khaled-laptop>
Message-ID: <4C14FF91.5080402@arcor.de>

On 06/13/2010 05:28 PM, Khaled Hosny wrote:
> On Sun, Jun 13, 2010 at 02:52:15PM +0200, Taco Hoekwater wrote:
>> Ulrik Vieth wrote:
>>>
>>> Somehow the parsing of these values seems to be very wrong.
>>> If I understand correctly, that's a matter of luaotfload. Right?!
>>
>> Something is wrong in luaotfload, yes.
>
> For the record, I once imported the whole ConTeXt math lua modules into
> luaotfload, some issues were fixed, but I got a bunch of new issues that
> I reverted that since I wasn't sure what was actually needed.
>
> Now if some one can tell me what luaotfload is supposed to do, e.g. what
> TFM tables are missing, I can work on that.

 From my understanding, there may be actually two problems:

1. If an OT math font is loaded in \fam 4 (as in unicode-math.sty),
its OT math parameters are not used, so LuaTeX ends up applying
the TFM-based parameters from CM fonts in \fam2+3, which implies
using the height of the radical glyph to determine the rule thickness.

2. If an OT math font is loaded in \fam 2+3, some of its OT math 
parameters are not loaded correctly and some are getting strange values.

For example, in XITS Math you have the following values:

RadicalExtraAscender=50,
RadicalRuleThickness=66,
RadicalVerticalGap=50,

I would expect those values to be converted as follows
during the loading of \textfont3:

{assigning \Umathradicalkern\textstyle=32768} % 0.5 pt
{assigning \Umathradicalrule\textstyle=43254} % 0.66 pt
{assigning \Umathradicalvgap\textstyle=32768} % 0.5 pt

However, I actually end up with the following values:

{assigning \Umathradicalkern\textstyle=433848} % 6.62 pt
{assigning \Umathradicavgap\textstyle=542310} % 8.275 pt
- no value for \Umathradicalrule -> fallback to TFM method

Somehow, deeply buried inside luatofload, soemthing goes wrong,
but I have no idea what really happens or how to trace it.

All I can see are the implicit assignments of \Umath ... parameters
shown in the output of \tracingall.

Regards, Ulrik


From ulrik.vieth at arcor.de  Sun Jun 13 18:03:16 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 13 Jun 2010 18:03:16 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100613155036.GA2721@khaled-laptop>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop>
Message-ID: <4C150144.40409@arcor.de>

On 06/13/2010 05:50 PM, Khaled Hosny wrote:
>
> I think it is a bit clear what we are missing now, a MathConstants
> table. Just to be sure, is there any thing else we should consider?

I think that is exactly what Taco was saying earlier today.

Somehow the MathConstants table is missing or incomplete or invalid
when an OT math font like XITS or Cambria is loaded via luaotfload.

Unfortunately, I don't enough how this is supposed to work.

Regards, Ulrik

From khaledhosny at eglug.org  Sun Jun 13 20:42:24 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 21:42:24 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C150144.40409@arcor.de>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
Message-ID: <20100613184224.GA3915@khaled-laptop>

On Sun, Jun 13, 2010 at 06:03:16PM +0200, Ulrik Vieth wrote:
> On 06/13/2010 05:50 PM, Khaled Hosny wrote:
> >
> >I think it is a bit clear what we are missing now, a MathConstants
> >table. Just to be sure, is there any thing else we should consider?
> 
> I think that is exactly what Taco was saying earlier today.
> 
> Somehow the MathConstants table is missing or incomplete or invalid
> when an OT math font like XITS or Cambria is loaded via luaotfload.
> 
> Unfortunately, I don't enough how this is supposed to work.

Adding the following after line 131 in luaotfload.lua should fill
MathContants table:

if otfdata.metadata.math then
    for k,v in next, otfdata.metadata.math do
        fontdata.MathConstants[k] = v / units * size
    end
end

If this works for you, I can added this hack for now, until we figure out
why luaotfload isn't doing this.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Jun 13 21:13:09 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 13 Jun 2010 22:13:09 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C14D47F.3000200@elvenkind.com>
References: <4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<4C14B73A.5030508@arcor.de> <4C14BA57.40004@elvenkind.com>
	<4C14BC74.5000604@arcor.de> <4C14CAB5.40102@elvenkind.com>
	<4C14D012.1030802@arcor.de> <4C14D47F.3000200@elvenkind.com>
Message-ID: <20100613191309.GA4138@khaled-laptop>

On Sun, Jun 13, 2010 at 02:52:15PM +0200, Taco Hoekwater wrote:
> Ulrik Vieth wrote:
> >
> >Somehow the parsing of these values seems to be very wrong.
> >If I understand correctly, that's a matter of luaotfload. Right?!
> 
> Something is wrong in luaotfload, yes.

Hans: this seems to be a luatex-fonts issue, see the attached sample.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mathcontants.tex
Type: text/x-tex
Size: 161 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100613/7bcc6808/attachment.bin>

From ulrik.vieth at arcor.de  Mon Jun 14 00:12:42 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Mon, 14 Jun 2010 00:12:42 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100613184224.GA3915@khaled-laptop>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>	<20100613155036.GA2721@khaled-laptop>
	<4C150144.40409@arcor.de> <20100613184224.GA3915@khaled-laptop>
Message-ID: <4C1557DA.3090906@arcor.de>

On 06/13/2010 08:42 PM, Khaled Hosny wrote:
>
> If this works for you, I can added this hack for now, until we figure out
> why luaotfload isn't doing this.

I'll hopefully get to try it tomorrow night. I just returned from a 
concert and it's too late now. I don't feel like concentrating anymore.

Regards, Ulrik

From taco at elvenkind.com  Mon Jun 14 08:40:04 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Jun 2010 08:40:04 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100613184224.GA3915@khaled-laptop>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>	<20100613155036.GA2721@khaled-laptop>
	<4C150144.40409@arcor.de> <20100613184224.GA3915@khaled-laptop>
Message-ID: <4C15CEC4.8080501@elvenkind.com>

Khaled Hosny wrote:
> 
> Adding the following after line 131 in luaotfload.lua should fill
> MathContants table:
> 
> if otfdata.metadata.math then
>     for k,v in next, otfdata.metadata.math do
>         fontdata.MathConstants[k] = v / units * size
>     end
> end

This should work fine I think, except for the one MathConstants
variable that is a percentage: RadicalDegreeBottomRaisePercent
should not be multiplied.

Best wishes,
Taco



From khaledhosny at eglug.org  Mon Jun 14 09:18:35 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Jun 2010 10:18:35 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C15CEC4.8080501@elvenkind.com>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
	<20100613184224.GA3915@khaled-laptop>
	<4C15CEC4.8080501@elvenkind.com>
Message-ID: <20100614071835.GA17933@khaled-laptop>

On Mon, Jun 14, 2010 at 08:40:04AM +0200, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >
> >Adding the following after line 131 in luaotfload.lua should fill
> >MathContants table:
> >
> >if otfdata.metadata.math then
> >    for k,v in next, otfdata.metadata.math do
> >        fontdata.MathConstants[k] = v / units * size
> >    end
> >end
> 
> This should work fine I think, except for the one MathConstants
> variable that is a percentage: RadicalDegreeBottomRaisePercent
> should not be multiplied.

I overlooked that. I'm going to push this for now.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Jun 14 16:23:34 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Jun 2010 17:23:34 +0300
Subject: [luatex] kpse and --output-directory
Message-ID: <20100614142334.GA28229@khaled-laptop>

Does the built-in kpse library look for files under the directory
specified with --output-directory. It doesn't here, but I'm not sure if
this a misconfiguration, a bug or a feature.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Mon Jun 14 16:30:39 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Jun 2010 16:30:39 +0200
Subject: [luatex] kpse and --output-directory
In-Reply-To: <20100614142334.GA28229@khaled-laptop>
References: <20100614142334.GA28229@khaled-laptop>
Message-ID: <4C163D0F.1060902@elvenkind.com>

Khaled Hosny wrote:
> Does the built-in kpse library look for files under the directory
> specified with --output-directory. It doesn't here, 
> but I'm not sure if this a misconfiguration, a bug or a feature.

I doubt it is a misconfiguration on your part, but I have no idea
whether it is a bug or a feature, I am not that much of a kpathsea
user. Does kpsewhich find files in the output directory?

Best wishes,
Taco







From khaledhosny at eglug.org  Mon Jun 14 16:41:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Jun 2010 17:41:43 +0300
Subject: [luatex] HTML version of the manual
Message-ID: <20100614144142.GA28423@khaled-laptop>


I'm not sure how possible it is with the current setup, but I'd really
appreciate an HTML version of the manual. PDF viewers are slow, memory
hogs and unreliable (copying text is always pain), especially when you
have to do it frequently. Web browsers are not the lightest applications
either, but one always have an open browser for some reason, combined
with tabbed interfaces, and it is much more accessible. I'm not
demanding anything, just to put this into your consideration if there
happen to be a chance in the future.

In the mean time, I'd really appreciate changing the PDF focus mode to
some usual setting, having to re-zoom the page each time I use a
hyperlink is not the most pleasing experience (Hans is only one I know
who likes the current behaviour, since he is unlikely to read the
manual, I doubt any one will miss the current behaviour :).

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Jun 14 16:44:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Jun 2010 17:44:17 +0300
Subject: [luatex] kpse and --output-directory
In-Reply-To: <4C163D0F.1060902@elvenkind.com>
References: <20100614142334.GA28229@khaled-laptop>
	<4C163D0F.1060902@elvenkind.com>
Message-ID: <20100614144417.GA28455@khaled-laptop>

On Mon, Jun 14, 2010 at 04:30:39PM +0200, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >Does the built-in kpse library look for files under the directory
> >specified with --output-directory. It doesn't here, but I'm not
> >sure if this a misconfiguration, a bug or a feature.
> 
> I doubt it is a misconfiguration on your part, but I have no idea
> whether it is a bug or a feature, I am not that much of a kpathsea
> user. Does kpsewhich find files in the output directory?

kpsewhich has no --output-directory option, but \input inputs them just
fine.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Mon Jun 14 16:52:05 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Jun 2010 16:52:05 +0200
Subject: [luatex] kpse and --output-directory
In-Reply-To: <20100614144417.GA28455@khaled-laptop>
References: <20100614142334.GA28229@khaled-laptop>	<4C163D0F.1060902@elvenkind.com>
	<20100614144417.GA28455@khaled-laptop>
Message-ID: <4C164215.10208@elvenkind.com>

Khaled Hosny wrote:
> On Mon, Jun 14, 2010 at 04:30:39PM +0200, Taco Hoekwater wrote:
>> Khaled Hosny wrote:
>>> Does the built-in kpse library look for files under the directory
>>> specified with --output-directory. It doesn't here, but I'm not
>>> sure if this a misconfiguration, a bug or a feature.
>> I doubt it is a misconfiguration on your part, but I have no idea
>> whether it is a bug or a feature, I am not that much of a kpathsea
>> user. Does kpsewhich find files in the output directory?
> 
> kpsewhich has no --output-directory option, but \input inputs them just
> fine.

Oh I see, \input and \read have special code to deal with
output-directory, this is not handled by kpathsea at all.

Best wishes,
Taco





From khaledhosny at eglug.org  Mon Jun 14 16:55:31 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 14 Jun 2010 17:55:31 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <4C1557DA.3090906@arcor.de>
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com> <4C14AC74.9060104@elvenkind.com>
	<4C14B079.5030809@arcor.de> <4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
	<20100613184224.GA3915@khaled-laptop> <4C1557DA.3090906@arcor.de>
Message-ID: <20100614145531.GA28597@khaled-laptop>

On Mon, Jun 14, 2010 at 12:12:42AM +0200, Ulrik Vieth wrote:
> On 06/13/2010 08:42 PM, Khaled Hosny wrote:
> >
> >If this works for you, I can added this hack for now, until we figure out
> >why luaotfload isn't doing this.
> 
> I'll hopefully get to try it tomorrow night. I just returned from a
> concert and it's too late now. I don't feel like concentrating
> anymore.

I just synced luaotfload with context, fixed some buglets. Now math is
much better, especially horizontal extensibles. I didn't do more
extensive tests, so more testing is appreciated.

There is one issue that I'm aware of, horizontal variants are ignored
and extensibles are always used, need to be checked.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Mon Jun 14 17:38:02 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 14 Jun 2010 17:38:02 +0200
Subject: [luatex] HTML version of the manual
In-Reply-To: <20100614144142.GA28423@khaled-laptop>
References: <20100614144142.GA28423@khaled-laptop>
Message-ID: <4C164CDA.8040904@elvenkind.com>

Khaled Hosny wrote:
> I'm not sure how possible it is with the current setup, but I'd really
> appreciate an HTML version of the manual. PDF viewers are slow, memory
> hogs and unreliable (copying text is always pain), especially when you
> have to do it frequently. Web browsers are not the lightest applications
> either, but one always have an open browser for some reason, combined
> with tabbed interfaces, and it is much more accessible. I'm not
> demanding anything, just to put this into your consideration if there
> happen to be a chance in the future.

luatexref-t.tex is a fairly simple file, we could convert it to
XML at some point.

> In the mean time, I'd really appreciate changing the PDF focus mode to
> some usual setting, having to re-zoom the page each time I use a
> hyperlink is not the most pleasing experience (Hans is only one I know
> who likes the current behaviour, since he is unlikely to read the
> manual, I doubt any one will miss the current behaviour :).

I will add a focus=standard to the environment file.

Best wishes,
Taco




From khaledhosny at eglug.org  Mon Jun 14 23:17:20 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 15 Jun 2010 00:17:20 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100614145531.GA28597@khaled-laptop>
References: <4C14AB68.5020400@arcor.de> <4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com> <4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
	<20100613184224.GA3915@khaled-laptop> <4C1557DA.3090906@arcor.de>
	<20100614145531.GA28597@khaled-laptop>
Message-ID: <20100614211720.GA1752@khaled-laptop>

On Mon, Jun 14, 2010 at 05:55:31PM +0300, Khaled Hosny wrote:
> On Mon, Jun 14, 2010 at 12:12:42AM +0200, Ulrik Vieth wrote:
> > On 06/13/2010 08:42 PM, Khaled Hosny wrote:
> > >
> > >If this works for you, I can added this hack for now, until we figure out
> > >why luaotfload isn't doing this.
> > 
> > I'll hopefully get to try it tomorrow night. I just returned from a
> > concert and it's too late now. I don't feel like concentrating
> > anymore.
> 
> I just synced luaotfload with context, fixed some buglets. Now math is
> much better, especially horizontal extensibles. I didn't do more
> extensive tests, so more testing is appreciated.
> 
> There is one issue that I'm aware of, horizontal variants are ignored
> and extensibles are always used, need to be checked.

This seems to be a difference between \Umathaccent and
\Umathoverdelimter, the former will use the variants while the later is
always constructed, I'm not sure if this is the expected behaviour,
though. (there is a test file in the repository).

Now it is up to unicode-math to support luatex ;)

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Tue Jun 15 01:50:39 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Tue, 15 Jun 2010 01:50:39 +0200
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <20100614145531.GA28597@khaled-laptop>
References: <4C141E87.9020904@arcor.de>
	<4C14AB68.5020400@arcor.de>	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com>	<4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>	<20100613155036.GA2721@khaled-laptop>
	<4C150144.40409@arcor.de>	<20100613184224.GA3915@khaled-laptop>
	<4C1557DA.3090906@arcor.de> <20100614145531.GA28597@khaled-laptop>
Message-ID: <4C16C04F.3060608@arcor.de>

On 06/14/2010 04:55 PM, Khaled Hosny wrote:
>
> I just synced luaotfload with context, fixed some buglets. Now math is
> much better, especially horizontal extensibles. I didn't do more
> extensive tests, so more testing is appreciated.

Thanks very much!  I did a little bit of testing now, and I can finally 
process my math documents with LuaLaTeX and get correct math output.

There are few little things about fine tuning I want to look at, such as
the positioning of math accents, but those are likely to be font issues.

Regards, Ulrik

P.S: I've got some 2500 pages of textbook material that was originally 
typeset with Times + mathtime in traditional LaTeX many years ago.
I suposse this could make some interesting test material for XITS Math
with LuaLaTeX and unicode-math eventually.


From wspr81 at gmail.com  Tue Jun 15 07:59:58 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 15 Jun 2010 15:29:58 +0930
Subject: [luatex] Unicode math issue with LuaLaTeX
References: <4C141E87.9020904@arcor.de> <4C14AB68.5020400@arcor.de>
	<4C14ABC7.1090408@elvenkind.com>
	<4C14AC74.9060104@elvenkind.com> <4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
	<20100613184224.GA3915@khaled-laptop> <4C1557DA.3090906@arcor.de>
	<20100614145531.GA28597@khaled-laptop>
	<20100614211720.GA1752@khaled-laptop>
Message-ID: <hv74su$i2p$1@dough.gmane.org>

On 2010-06-15 06:47:20 +0930, Khaled Hosny 
<khaledhosny at eglug.org> said:

> Now it is up to unicode-math to support luatex ;)

Some of the pieces are there already -- you can compile a document that 
uses unicode-math under LuaLaTeX and it will do the right thing for 
some maths elements. (I know you know this, Khaled, but others may not.)

But people telling me what's broken is a good way to get things fixed :)

W




From khaledhosny at eglug.org  Tue Jun 15 16:43:47 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 15 Jun 2010 17:43:47 +0300
Subject: [luatex] Unicode math issue with LuaLaTeX
In-Reply-To: <hv74su$i2p$1@dough.gmane.org>
References: <4C14AC74.9060104@elvenkind.com> <4C14B079.5030809@arcor.de>
	<4C14B0AD.8080301@elvenkind.com>
	<20100613155036.GA2721@khaled-laptop> <4C150144.40409@arcor.de>
	<20100613184224.GA3915@khaled-laptop> <4C1557DA.3090906@arcor.de>
	<20100614145531.GA28597@khaled-laptop>
	<20100614211720.GA1752@khaled-laptop>
	<hv74su$i2p$1@dough.gmane.org>
Message-ID: <20100615144347.GA2271@khaled-laptop>

On Tue, Jun 15, 2010 at 03:29:58PM +0930, Will Robertson wrote:
> On 2010-06-15 06:47:20 +0930, Khaled Hosny <khaledhosny at eglug.org>
> said:
> 
> >Now it is up to unicode-math to support luatex ;)
> 
> Some of the pieces are there already -- you can compile a document
> that uses unicode-math under LuaLaTeX and it will do the right thing
> for some maths elements. (I know you know this, Khaled, but others
> may not.)
> 
> But people telling me what's broken is a good way to get things fixed :)

You can start with the amsmath file in the repository :) it doesn't
compile cleanly and the output doesn't look right either.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From zappathustra at free.fr  Sat Jun 19 13:25:34 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 19 Jun 2010 13:25:34 +0200
Subject: [luatex] Errors in the manual.
Message-ID: <4C1CA92E.5020101@free.fr>

Hello all,

The manual online reads:

pdf.pageattributes, pdf.pageresources, pdf.pagesattributes
[...]
The variables have no interaction with the corresponding pdfTEX token 
registers \pageattrib,
\pageresources, and \pagesattrib, but they are written out to the pdf 
file directly after the
pdfTEX token registers.

I suppose one should read \pdfpageattr, \pdfpageresources and \pdfpagesattr?
(The commands as spelled in the manual produce errors.)

By the way, is there any chance that manipulation of those be a little 
more user friendly?
E.g. \pdfpageresources automatically cleared at \shipout time? Or 
(better still), leave \pdfpageresources as is and have a 
\pdfthispageresources that would behave as I have just described?

Best,
Paul


From khaledhosny at eglug.org  Sat Jun 19 19:48:19 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 19 Jun 2010 20:48:19 +0300
Subject: [luatex] OCP broken?
Message-ID: <20100619174819.GA24750@khaled-laptop>

I know such Omega extensions are rarely tested, if at all, but any idea
why the attached OCP is no longer working? It used to work while ago.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: number.tex
Type: text/x-tex
Size: 194 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100619/bed0062c/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: number.otp
Type: application/vnd.oasis.opendocument.presentation-template
Size: 1827 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100619/bed0062c/attachment.otp>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: number.ocp
Type: application/octet-stream
Size: 1200 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100619/bed0062c/attachment.obj>

From rivanvx at gmail.com  Sat Jun 19 20:16:52 2010
From: rivanvx at gmail.com (=?UTF-8?Q?Vedran_Mileti=C4=87?=)
Date: Sat, 19 Jun 2010 20:16:52 +0200
Subject: [luatex] LuaSQL
Message-ID: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com>

Hi,

is there any chance of LuaTeX having LuaSQL module, at least for SQLite?

Or, put it another way, is there a way to add Lua modules post-install
to LuaTeX?

Regards,

-- 
Vedran Mileti?


From patrick at gundla.ch  Sat Jun 19 20:20:11 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 19 Jun 2010 20:20:11 +0200
Subject: [luatex] LuaSQL
In-Reply-To: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com>
References: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com>
Message-ID: <CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>

Hi,

> Or, put it another way, is there a way to add Lua modules post-install
> to LuaTeX?

Yes. You can compile and require the modules from LuaTeX. Perhaps you need a non-stripped LuaTeX binary.

Please tell us in detail where we can help you, where you have trouble etc. 

Patrick



From rivanvx at gmail.com  Sat Jun 19 20:31:19 2010
From: rivanvx at gmail.com (=?UTF-8?Q?Vedran_Mileti=C4=87?=)
Date: Sat, 19 Jun 2010 20:31:19 +0200
Subject: [luatex] LuaSQL
In-Reply-To: <CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>
References: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com> 
	<CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>
Message-ID: <AANLkTik-nfUYd72q8K7WMZ2-rMc9L-BUps7qKzuiCYWH@mail.gmail.com>

2010/6/19 Patrick Gundlach <patrick at gundla.ch>:
> Hi,
>
>> Or, put it another way, is there a way to add Lua modules post-install
>> to LuaTeX?
>
> Yes. You can compile and require the modules from LuaTeX. Perhaps you need a non-stripped LuaTeX binary.
>
> Please tell us in detail where we can help you, where you have trouble etc.

It would be great if you could point me to a guide on how to compile
and install modules for LuaTeX.

-- 
Vedran Mileti?


From taco at elvenkind.com  Sun Jun 20 09:34:42 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 20 Jun 2010 09:34:42 +0200
Subject: [luatex] LuaSQL
In-Reply-To: <AANLkTik-nfUYd72q8K7WMZ2-rMc9L-BUps7qKzuiCYWH@mail.gmail.com>
References: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com>
	<CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>
	<AANLkTik-nfUYd72q8K7WMZ2-rMc9L-BUps7qKzuiCYWH@mail.gmail.com>
Message-ID: <4C1DC492.6010405@elvenkind.com>

Vedran Mileti? wrote:
> 2010/6/19 Patrick Gundlach <patrick at gundla.ch>:
>> Hi,
>>
>>> Or, put it another way, is there a way to add Lua modules post-install
>>> to LuaTeX?
>> Yes. 

Assuming you have luatex version > 0.46.0, yes.

> It would be great if you could point me to a guide on how to compile

Except in complex cases, compilation of modules can be done as you
normally would for lua binary modules, so best is to try that first.

Unless you tell us exactly which module you want and on which platform
you are, we cannot help with that.

> and install modules for LuaTeX.

Copy the generated .so or .dll file to below <bindir>/lib/,
that should be all you have to do.

Best wishes,
Taco

From taco at elvenkind.com  Sun Jun 20 09:56:56 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 20 Jun 2010 09:56:56 +0200
Subject: [luatex] OCP broken?
In-Reply-To: <20100619174819.GA24750@khaled-laptop>
References: <20100619174819.GA24750@khaled-laptop>
Message-ID: <4C1DC9C8.5000200@elvenkind.com>

Khaled Hosny wrote:
> I know such Omega extensions are rarely tested, if at all, but any idea
> why the attached OCP is no longer working? It used to work while ago.

Any idea when it was still ok? I have to disect through past revisions,
I fear.

Best wishes,
Taoc

From taco at elvenkind.com  Sun Jun 20 10:50:58 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 20 Jun 2010 10:50:58 +0200
Subject: [luatex] Errors in the manual.
In-Reply-To: <4C1CA92E.5020101@free.fr>
References: <4C1CA92E.5020101@free.fr>
Message-ID: <4C1DD672.3080609@elvenkind.com>

Paul Isambert wrote:
> Hello all,
> 
> The manual online reads:
> 
> pdf.pageattributes, pdf.pageresources, pdf.pagesattributes
> [...]
> The variables have no interaction with the corresponding pdfTEX token 
> registers \pageattrib,
> \pageresources, and \pagesattrib, but they are written out to the pdf 
> file directly after the
> pdfTEX token registers.
> 
> I suppose one should read \pdfpageattr, \pdfpageresources and 
> \pdfpagesattr?

Yes, fixed.

> (The commands as spelled in the manual produce errors.)
> 
> By the way, is there any chance that manipulation of those be a little 
> more user friendly?
> E.g. \pdfpageresources automatically cleared at \shipout time? Or 
> (better still), leave \pdfpageresources as is and have a 
> \pdfthispageresources that would behave as I have just described?

This is a question for Hartmut, but I would vote for adjusting
the lua commands then, if needed.

Best wishes,
Taco

From zappathustra at free.fr  Sun Jun 20 13:33:28 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 20 Jun 2010 13:33:28 +0200
Subject: [luatex] Errors in the manual.
In-Reply-To: <4C1DD672.3080609@elvenkind.com>
References: <4C1CA92E.5020101@free.fr> <4C1DD672.3080609@elvenkind.com>
Message-ID: <4C1DFC88.9090503@free.fr>

Taco Hoekwater a ?crit :
>
>> (The commands as spelled in the manual produce errors.)
>>
>> By the way, is there any chance that manipulation of those be a 
>> little more user friendly?
>> E.g. \pdfpageresources automatically cleared at \shipout time? Or 
>> (better still), leave \pdfpageresources as is and have a 
>> \pdfthispageresources that would behave as I have just described?
>
> This is a question for Hartmut, but I would vote for adjusting
> the lua commands then, if needed.

Yes, all the more as the asynchronicity of the \pdfpageresource 
assignment (when one doesn't know on which page the current material 
will end) vs. its reading (at \shipout time) is really troublesome (one 
has to rely on an external file), whereas with LuaTeX pdf.pageattributes 
in \latelua works perfectly. Except one has to empty it after each 
shipout, which means the output routine is frozen to some extent, which 
I don't like, as far as I'm concerned. So, actually, a 
pdf.thispageattributes (and -resources) that'd be cleared on every 
shipout would be very nice.

Best,
Paul


From rivanvx at gmail.com  Sun Jun 20 16:21:41 2010
From: rivanvx at gmail.com (=?UTF-8?Q?Vedran_Mileti=C4=87?=)
Date: Sun, 20 Jun 2010 16:21:41 +0200
Subject: [luatex] LuaSQL
In-Reply-To: <4C1DC492.6010405@elvenkind.com>
References: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com> 
	<CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>
	<AANLkTik-nfUYd72q8K7WMZ2-rMc9L-BUps7qKzuiCYWH@mail.gmail.com> 
	<4C1DC492.6010405@elvenkind.com>
Message-ID: <AANLkTimIoIVDE00tN4aSw-4lEGU1OpCytB7EjXRBxfL8@mail.gmail.com>

2010/6/20 Taco Hoekwater <taco at elvenkind.com>:
> Except in complex cases, compilation of modules can be done as you
> normally would for lua binary modules, so best is to try that first.
>
> Unless you tell us exactly which module you want and on which platform
> you are, we cannot help with that.

I'm running TL2010 pretest on Fedora 13.

> Copy the generated .so or .dll file to below <bindir>/lib/,
> that should be all you have to do.

You are awesome! It works!

-- 
Vedran Mileti?


From oinos at web.de  Sun Jun 20 20:37:09 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 20 Jun 2010 20:37:09 +0200
Subject: [luatex] lualatex crash
Message-ID: <4C1E5FD5.7090508@web.de>

Hi there,

after installing TL 2010 (as provided in Fedora 13 development), I got a 
crash compiling an extremely simple document with LuaLaTeX:

\documentclass[a5paper,12pt]{article}
\begin{document}
Hi
\end{document}

What am I missing here? (No log file, so gdb output bellow.)

Thanks,


Pablo



Starting program: /usr/bin/lualatex crash
This is LuaTeX, Version beta-0.60.1-2010061508 (TeX Live 2010) (rev 3720)
  restricted \write18 enabled.
(./crash.tex
LaTeX2e <2009/09/24>
LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns 
for engl
ish, dumylang, nohyphenation, loaded.
(/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
(/usr/share/texlive/texmf-dist/tex/latex/base/size12.clo)) (./crash.aux)
[1{/usr/share/texlive/texmf-config/fonts/map/pdftex/updmap/pdftex.map}
Program received signal SIGSEGV, Segmentation fault.
0x0810d5f6 in pdf_place_glyph ()
Missing separate debuginfos, use: debuginfo-install 
texlive-latex-bin-bin-2010-7.20100615.svn14050.fc13.i686
(gdb) bt
#0  0x0810d5f6 in pdf_place_glyph ()
#1  0x0811062e in hlist_out ()
#2  0x0810f3c5 in vlist_out ()
#3  0x0810f674 in vlist_out ()
#4  0x0810f674 in vlist_out ()
#5  0x0807d198 in ship_out ()
#6  0x08118c51 in box_end ()
#7  0x08118360 in handle_right_brace ()
#8  0x0811b70b in main_control ()
#9  0x080a1d20 in main_body ()
#10 0x0806acc1 in main ()

From khaledhosny at eglug.org  Sun Jun 20 21:45:34 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 20 Jun 2010 22:45:34 +0300
Subject: [luatex] OCP broken?
In-Reply-To: <4C1DC9C8.5000200@elvenkind.com>
References: <20100619174819.GA24750@khaled-laptop>
	<4C1DC9C8.5000200@elvenkind.com>
Message-ID: <20100620194534.GA10960@khaled-laptop>

On Sun, Jun 20, 2010 at 09:56:56AM +0200, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >I know such Omega extensions are rarely tested, if at all, but any idea
> >why the attached OCP is no longer working? It used to work while ago.
> 
> Any idea when it was still ok? I have to disect through past revisions,
> I fear.

Last time I checked was long ago, I'll try to see if I can find when it
broke.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From jfine at pytex.org  Sun Jun 20 22:56:39 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Sun, 20 Jun 2010 21:56:39 +0100
Subject: [luatex] OCP broken? - hg and git bisect commands
In-Reply-To: <20100620194534.GA10960@khaled-laptop>
References: <20100619174819.GA24750@khaled-laptop>	<4C1DC9C8.5000200@elvenkind.com>
	<20100620194534.GA10960@khaled-laptop>
Message-ID: <4C1E8087.9020102@pytex.org>

Khaled Hosny wrote:
> On Sun, Jun 20, 2010 at 09:56:56AM +0200, Taco Hoekwater wrote:
>> Khaled Hosny wrote:
>>> I know such Omega extensions are rarely tested, if at all, but any idea
>>> why the attached OCP is no longer working? It used to work while ago.
>> Any idea when it was still ok? I have to disect through past revisions,
>> I fear.
> 
> Last time I checked was long ago, I'll try to see if I can find when it
> broke.
> 

I've not used them myself, but git and hg have a bisect command for 
doing such searches.

There are tools that will produce git or hg repositories from a svn 
repository.

For copying a svn repository try:
   http://stackoverflow.com/questions/441297/copy-svn-repository
and also svnsync.

Here's the help for hg bisect.
===

$ hg help bisect
hg bisect [-gbsr] [-c CMD] [REV]

subdivision search of changesets

     This command helps to find changesets which introduce problems.
     To use, mark the earliest changeset you know exhibits the problem
     as bad, then mark the latest changeset which is free from the
     problem as good. Bisect will update your working directory to a
     revision for testing (unless the --noupdate option is specified).
     Once you have performed tests, mark the working directory as bad
     or good and bisect will either update to another candidate changeset
     or announce that it has found the bad revision.

     As a shortcut, you can also use the revision argument to mark a
     revision as good or bad without checking it out first.

     If you supply a command it will be used for automatic bisection. 
Its exit
     status will be used as flag to mark revision as bad or good. In 
case exit
     status is 0 the revision is marked as good, 125 - skipped, 127 
(command not
     found) - bisection will be aborted and any other status bigger than 
0 will
     mark revision as bad.

options:

  -r --reset     reset bisect state
  -g --good      mark changeset good
  -b --bad       mark changeset bad
  -s --skip      skip testing changeset
  -c --command   Use command to check changeset state
  -U --noupdate  do not update to target
===

Hope this helps.

-- 
Jonathan

From taco at elvenkind.com  Mon Jun 21 08:33:17 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 21 Jun 2010 08:33:17 +0200
Subject: [luatex] lualatex crash
In-Reply-To: <4C1E5FD5.7090508@web.de>
References: <4C1E5FD5.7090508@web.de>
Message-ID: <4C1F07AD.5090603@elvenkind.com>

Pablo Rodr?guez wrote:
> Hi there,
> 
> after installing TL 2010 (as provided in Fedora 13 development), I got a 
> crash compiling an extremely simple document with LuaLaTeX:
> 
> \documentclass[a5paper,12pt]{article}
> \begin{document}
> Hi
> \end{document}
> 
> What am I missing here? (No log file, so gdb output bellow.)

No idea. It doesn't crash nor report any error for me, but then:

* I am on x86_64-linux
* I have installed the texlive 2010 pretest from TUG (updated this
   morning, luatex rev 3723).

Best wishes,
Taco

From taco at elvenkind.com  Mon Jun 21 09:08:07 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 21 Jun 2010 09:08:07 +0200
Subject: [luatex] OCP broken?
In-Reply-To: <20100620194534.GA10960@khaled-laptop>
References: <20100619174819.GA24750@khaled-laptop>	<4C1DC9C8.5000200@elvenkind.com>
	<20100620194534.GA10960@khaled-laptop>
Message-ID: <4C1F0FD7.1000304@elvenkind.com>

Khaled Hosny wrote:
> On Sun, Jun 20, 2010 at 09:56:56AM +0200, Taco Hoekwater wrote:
>> Khaled Hosny wrote:
>>> I know such Omega extensions are rarely tested, if at all, but any idea
>>> why the attached OCP is no longer working? It used to work while ago.
>> Any idea when it was still ok? I have to disect through past revisions,
>> I fear.
> 
> Last time I checked was long ago, I'll try to see if I can find when it
> broke.

This has been broken since ages. I tried some older versions which did
actually run the otp but produced '987654321TLT ridtxet' because luatex
does not interpret commands in the return values from the otp buffer and 
has not done that since a very,very long time (at least since 0.30).

The otp output buffer enters luatex at a different level than in Omega,
past the 'mouth'. This is a side-effect of the changes to the main
control loop that were made for the separation between glyphs and
characters (getting rid of the ligature building in the mouth).

I could attempt to go back to the state where it runs the otp, but to
be honest I don't see much point in it as it will not work properly
anyway. In fact this may be a good moment to do away with otps altogether.

Best wishes,
Taco




From khaledhosny at eglug.org  Mon Jun 21 10:56:45 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 21 Jun 2010 11:56:45 +0300
Subject: [luatex] OCP broken?
In-Reply-To: <4C1F0FD7.1000304@elvenkind.com>
References: <20100619174819.GA24750@khaled-laptop>
	<4C1DC9C8.5000200@elvenkind.com>
	<20100620194534.GA10960@khaled-laptop>
	<4C1F0FD7.1000304@elvenkind.com>
Message-ID: <20100621085518.GA13393@khaled-laptop>

On Mon, Jun 21, 2010 at 09:08:07AM +0200, Taco Hoekwater wrote:
> Khaled Hosny wrote:
> >On Sun, Jun 20, 2010 at 09:56:56AM +0200, Taco Hoekwater wrote:
> >>Khaled Hosny wrote:
> >>>I know such Omega extensions are rarely tested, if at all, but any idea
> >>>why the attached OCP is no longer working? It used to work while ago.
> >>Any idea when it was still ok? I have to disect through past revisions,
> >>I fear.
> >
> >Last time I checked was long ago, I'll try to see if I can find when it
> >broke.
> 
> This has been broken since ages. I tried some older versions which did
> actually run the otp but produced '987654321TLT ridtxet' because luatex
> does not interpret commands in the return values from the otp buffer
> and has not done that since a very,very long time (at least since
> 0.30).
> 
> The otp output buffer enters luatex at a different level than in Omega,
> past the 'mouth'. This is a side-effect of the changes to the main
> control loop that were made for the separation between glyphs and
> characters (getting rid of the ligature building in the mouth).
> 
> I could attempt to go back to the state where it runs the otp, but to
> be honest I don't see much point in it as it will not work properly
> anyway. In fact this may be a good moment to do away with otps altogether.

I don't have strong need for OTPs either, all what I need can be done in
lua, I was just a bit lazy and thought I'd reuse some old code. I'm fine
with no OTP, just make sure it is documented.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Jun 21 10:57:53 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 21 Jun 2010 11:57:53 +0300
Subject: [luatex] lualatex crash
In-Reply-To: <4C1F07AD.5090603@elvenkind.com>
References: <4C1E5FD5.7090508@web.de>
 <4C1F07AD.5090603@elvenkind.com>
Message-ID: <20100621085753.GB13393@khaled-laptop>

On Mon, Jun 21, 2010 at 08:33:17AM +0200, Taco Hoekwater wrote:
> Pablo Rodr?guez wrote:
> >Hi there,
> >
> >after installing TL 2010 (as provided in Fedora 13 development), I
> >got a crash compiling an extremely simple document with LuaLaTeX:
> >
> >\documentclass[a5paper,12pt]{article}
> >\begin{document}
> >Hi
> >\end{document}
> >
> >What am I missing here? (No log file, so gdb output bellow.)
> 
> No idea. It doesn't crash nor report any error for me, but then:
> 
> * I am on x86_64-linux
> * I have installed the texlive 2010 pretest from TUG (updated this
>   morning, luatex rev 3723).

No crashes here either, x86 linux, texlive 2010 from tug.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From luigi.scarso at gmail.com  Mon Jun 21 11:57:31 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 21 Jun 2010 11:57:31 +0200
Subject: [luatex] LuaSQL
In-Reply-To: <AANLkTimIoIVDE00tN4aSw-4lEGU1OpCytB7EjXRBxfL8@mail.gmail.com>
References: <AANLkTinMjydlMdlwApbQfiwPi8NO3BBBuDBx4VTkPjHF@mail.gmail.com>
	<CC50B56B-C6A3-4769-88BC-EB6A9198A850@gundla.ch>
	<AANLkTik-nfUYd72q8K7WMZ2-rMc9L-BUps7qKzuiCYWH@mail.gmail.com>
	<4C1DC492.6010405@elvenkind.com>
	<AANLkTimIoIVDE00tN4aSw-4lEGU1OpCytB7EjXRBxfL8@mail.gmail.com>
Message-ID: <AANLkTin-VZMQP4RvKUTfmd8axDBc7-crhnY-NU4Fjkv6@mail.gmail.com>

2010/6/20 Vedran Mileti? <rivanvx at gmail.com>:
> 2010/6/20 Taco Hoekwater <taco at elvenkind.com>:
>> Except in complex cases, compilation of modules can be done as you
>> normally would for lua binary modules, so best is to try that first.
>
>> Copy the generated .so or .dll file to below <bindir>/lib/,
>> that should be all you have to do.
>
> You are awesome! It works!
I believe that still there are  some problems if your shared lib (here
I mean .so)
has a dynamic link with a shared library that is included in luatex .
Under linux the typical example is libpng: if your shared library need
libpng then you must use the same of luatex
otherwise you will end in a segfault.

-- 
luigi


From oinos at web.de  Mon Jun 21 18:13:09 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Mon, 21 Jun 2010 18:13:09 +0200
Subject: [luatex] lualatex crash
In-Reply-To: <20100621085753.GB13393@khaled-laptop>
References: <4C1E5FD5.7090508@web.de> <4C1F07AD.5090603@elvenkind.com>
	<20100621085753.GB13393@khaled-laptop>
Message-ID: <4C1F8F95.6090609@web.de>

On 06/21/2010 10:57 AM, Khaled Hosny wrote:
> On Mon, Jun 21, 2010 at 08:33:17AM +0200, Taco Hoekwater wrote:
>> Pablo Rodr?guez wrote:
>>> Hi there,
>>>
>>> after installing TL 2010 (as provided in Fedora 13 development), I
>>> got a crash compiling an extremely simple document with LuaLaTeX:
>>>
>>> [...]
>>>
>>> What am I missing here? (No log file, so gdb output bellow.)
>>
>> No idea. It doesn't crash nor report any error for me, but then:
>>
>> * I am on x86_64-linux
>> * I have installed the texlive 2010 pretest from TUG (updated this
>>    morning, luatex rev 3723).
>
> No crashes here either, x86 linux, texlive 2010 from tug.

Thanks, Taco and Kahled, for your replies.

The problem is not specific to LuaLaTeX, XeLaTeX crashes too (although 
it needs a more complex file to crash).

(pdf)LaTeX doesn't seem to crash (to the extend I've checked it). Even a 
two documents are compiled file with pdfLaTeX, but it crash XeLaTeX.

Pure TeX (XeTeX or LuaTeX) are Greek to me. ConTeXt is totally unknown 
to me. It might be a LaTeX related thing and I even think that it might 
be caused by the hyphenation patterns for Unicode-aware engines in LaTeX 
(but I don't really have no idea and this is only a guess).

Thanks for your help,


Pablo

From luatex at nililand.de  Tue Jun 22 11:07:28 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 22 Jun 2010 11:07:28 +0200
Subject: [luatex] Packages and fonts not found if I load luatextra
Message-ID: <sjyt2ufqseqn$.dlg@nililand.de>

Hello,

I have a special minimal luatex installation "hooked" at my miktex
installation. The binaries are from http://w32tex.org/. The
"luatex"-part use a sort of small texlive-tree with a texmf.cnf and
ls-R-files. I only had to rename mktexlsr and kpsewhich to avoid
conflict with similar applications in the miktex bin.

Today I decided to update everything and run in a  problem with
luatextra: After the package has been loaded various files were no
longer found by luatex. 
E.g. this example

\documentclass{article}
\usepackage{environ}
\usepackage{luatextra}
\usepackage{lipsum}

\begin{document}
abc
\end{document}

will find article.cls, size10.clo, environ.sty, ifluatex and
etex.sty and a lot of luatex-files but then complain:

! LaTeX Error: File `lipsum.sty' not found.


and at the end:

!LuaTeX error (file cmr10): Font cmr10 at 600 not found

After some test I found out that the first problem were due to the
TEXINPUTS-settings. Before luatextra is loaded luatex uses
(pdflualatex is the name of the format): 

TEXINPUTS.pdflualatex =
.;$texroot/{luatex,latex,generic,latex209,platex209,}//

afterwards luatex uses the setting of TEXINPUTS.luatex. Adding a
comma to its value enabled luatex to find files in the tex\latex
folder. But pdflualatex still doesn't find the font.

So my questions are

1. Is is normal that luatextra changes the progname during
compilation?

2. What can I do to enable luatex to find fonts again?

3. Where can I find a current texmf.cnf so that I can check what
else could be wrong with my local one? 





-- 
Ulrike Fischer 


From mpg at elzevir.fr  Tue Jun 22 11:39:40 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 22 Jun 2010 11:39:40 +0200
Subject: [luatex] Packages and fonts not found if I load luatextra
In-Reply-To: <sjyt2ufqseqn$.dlg@nililand.de>
References: <sjyt2ufqseqn$.dlg@nililand.de>
Message-ID: <4C2084DC.2010507@elzevir.fr>

Le 22/06/2010 11:07, Ulrike Fischer a ?crit :
> 1. Is is normal that luatextra changes the progname during
> compilation?
> 
IMO, no. This is due to kpse.set_program_name("luatex") in lualibs.
As a quick fix, I suggest replacing this line with

kpse.set_program_name(arg[-1] or arg[0])

Even better would be to test if kpse is already initialised, but I don't know
how to do that. Alternatively, lualibs could use a private instance:

local mykpse = kpse.new(...)
-- later in load_lualibs_module()
local path = mykpse:find_file(filename)

Or it could just document that kpse should be initialised before lualibs is
loaded (which is only a problem for texlua scripts, but not in tex mode).

Khaled, wdyt?

> 2. What can I do to enable luatex to find fonts again?
> 
I'm afraid I have no idea on that one.

> 3. Where can I find a current texmf.cnf so that I can check what
> else could be wrong with my local one? 
> 
http://tug.org/svn/texlive/trunk/Master/texmf/web2c/texmf.cnf

(Note that is uses lualatex and dvilualatex as format names.)

Manuel.

From luatex at nililand.de  Tue Jun 22 12:35:49 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 22 Jun 2010 12:35:49 +0200
Subject: [luatex] Packages and fonts not found if I load luatextra
References: <sjyt2ufqseqn$.dlg@nililand.de> <4C2084DC.2010507@elzevir.fr>
Message-ID: <1c9jxzbowphc1$.dlg@nililand.de>

Am Tue, 22 Jun 2010 11:39:40 +0200 schrieb Manuel P?gouri?-Gonnard:


>> 2. What can I do to enable luatex to find fonts again?
 
> I'm afraid I have no idea on that one.

The problem was that pdftex.map wasn't found and not included.
Responsable was again the change of progname together with this
texmf.cnf setting (I don't remember why I included it, probably it
was in a texmf.cnf I used as source and saw no reason to remove it)

TEXFONTMAPS.luatex   = .,$TEXMF/fonts/map/{pdftex,dvips,}//

(pdftex.map is in miktex in <texmf>/pdftex/config/pdftex.map, my
general TEXFONTMAPS includes this path.)

> 
>> 3. Where can I find a current texmf.cnf so that I can check what
>> else could be wrong with my local one? 
>> 
> http://tug.org/svn/texlive/trunk/Master/texmf/web2c/texmf.cnf

Thanks

> (Note that is uses lualatex and dvilualatex as format names.)

I'm still fighting if I should use the standard name convention
lualatex/dvilualatex or the convention lualatex/pdflualatex I'm used
to from latex/pdflatex.



-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Tue Jun 22 13:09:57 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 22 Jun 2010 14:09:57 +0300
Subject: [luatex] Packages and fonts not found if I load luatextra
In-Reply-To: <4C2084DC.2010507@elzevir.fr>
References: <sjyt2ufqseqn$.dlg@nililand.de>
 <4C2084DC.2010507@elzevir.fr>
Message-ID: <20100622110956.GA4515@khaled-laptop>

On Tue, Jun 22, 2010 at 11:39:40AM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 22/06/2010 11:07, Ulrike Fischer a ?crit :
> > 1. Is is normal that luatextra changes the progname during
> > compilation?
> > 
> IMO, no. This is due to kpse.set_program_name("luatex") in lualibs.
> As a quick fix, I suggest replacing this line with
> 
> kpse.set_program_name(arg[-1] or arg[0])
> 
> Even better would be to test if kpse is already initialised, but I don't know
> how to do that. Alternatively, lualibs could use a private instance:
> 
> local mykpse = kpse.new(...)
> -- later in load_lualibs_module()
> local path = mykpse:find_file(filename)
> 
> Or it could just document that kpse should be initialised before lualibs is
> loaded (which is only a problem for texlua scripts, but not in tex mode).
> 
> Khaled, wdyt?

I think I'll go with the last one.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From t34www at googlemail.com  Tue Jun 22 14:36:22 2010
From: t34www at googlemail.com (T T)
Date: Tue, 22 Jun 2010 13:36:22 +0100
Subject: [luatex] Packages and fonts not found if I load luatextra
In-Reply-To: <20100622110956.GA4515@khaled-laptop>
References: <sjyt2ufqseqn$.dlg@nililand.de> <4C2084DC.2010507@elzevir.fr>
	<20100622110956.GA4515@khaled-laptop>
Message-ID: <AANLkTinQdeoIafTBSV-SStVorJUy5ZUIgikHl3N5D5gu@mail.gmail.com>

On 22 June 2010 12:09, Khaled Hosny <khaledhosny at eglug.org> wrote:
> On Tue, Jun 22, 2010 at 11:39:40AM +0200, Manuel P?gouri?-Gonnard wrote:
>> Le 22/06/2010 11:07, Ulrike Fischer a ?crit :
>> > 1. Is is normal that luatextra changes the progname during
>> > compilation?
>> >
>> IMO, no. This is due to kpse.set_program_name("luatex") in lualibs.
>> As a quick fix, I suggest replacing this line with
>>
>> kpse.set_program_name(arg[-1] or arg[0])
>>
>> Even better would be to test if kpse is already initialised, but I don't know
>> how to do that. Alternatively, lualibs could use a private instance:
>>
>> local mykpse = kpse.new(...)
>> -- later in load_lualibs_module()
>> local path = mykpse:find_file(filename)
>>
>> Or it could just document that kpse should be initialised before lualibs is
>> loaded (which is only a problem for texlua scripts, but not in tex mode).
>>
>> Khaled, wdyt?
>
> I think I'll go with the last one.

I had a somewhat related dilemma regarding kpse initialization and its
cost.  Perhaps this info will be of some use:

http://www.mail-archive.com/dev-luatex at ntg.nl/msg01396.html

Cheers,

Tomek


From graham.douglas at readytext.co.uk  Wed Jun 23 21:26:43 2010
From: graham.douglas at readytext.co.uk (Graham Douglas)
Date: Wed, 23 Jun 2010 20:26:43 +0100
Subject: [luatex] unicode-math: Undefined control sequence.,
	<argument> \um_prime_single_mchar
Message-ID: <4C225FF3.2070403@readytext.co.uk>

Dear All

Firstly, a huge THANK YOU to Will for his incredible
energy and expertise in writing fontspec and unicode-math.

In summary, I build LuaTeX from source and run it on
Windows Vista with a custom runtime environment (texmf.cnf)
--- hand built (ie hacked) from scratch.

Anyway, it all works fine. I have fontspec working but just
downloaded unicode-math and have hit a problem with it.

Here is my command line

$ luatex --fmt=pdflatex fs.tex
This is LuaTeX, Version beta-0.60.1-2010060119

Here is a  minimal test file

\documentclass[12pt]{article}
\usepackage{unicode-math}
\begin{document}
\setmathfont{Cambria Math}

\end{document}

Output of the run is below.

Any ideas what is tripping me up here?

I'm not an expert is this area at all -- so
simpler explanations would be great :-)

Many thanks in advance

Warm regards

Graham

Here is the end of the run and the error (full run below).


luaotfload | Font names database loaded: 
$TEXMFVAR/luatex/generic/luaotfload/na
mes/otfl-names.lua
luaotfload | Updating the font names database:
luaotfload | Scanning TEXMF fonts...
luaotfload | Scanning OS fonts...
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/unicode-math/unicode-math-table.
tex)
! Undefined control sequence.
<argument> \um_prime_single_mchar

\um_set_mathchar:NNnn #1#2#3#4->\Umathchardef #1
                                                 =\mathchar at type 
#2\csname sy...

\um_make_mathactive:nNN ...#3{\um_symfont_tl }{#1}
 
\char_gmake_mathactive:n {#1}

\um_setup_mathactives: ...e_single_mchar \mathord
 
\um_make_mathactive:nNN {"...

\\setmathfont ..._symbols: \um_setup_mathactives:
                                                   \um_setup_delcodes: 
\um_se...
l.4 \setmathfont{Cambria Math}





==================================
Output of Run
=================
LaTeX2e <2009/09/24>
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/article.cls
Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/size12.clo))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/unicode-math/unicode-math.sty
(g:/texlive/Master/texmf-dist/tex/generic/ifxetex/ifxetex.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/ifluatex.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/expl3.sty
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3names.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/etex.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3basics.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3expan.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3tl.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3intexpr.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3quark.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3seq.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3toks.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3int.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3prg.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3clist.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3token.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3prop.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3msg.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3io.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3skip.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3box.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3keyval.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3keys.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3precom.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3calc.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3xref.sty)
(g:/texlive/Master/texmf-dist/tex/latex/expl3/l3file.sty))
(g:/texlive/Master/texmf-dist/tex/latex/xpackages/xbase/xparse.sty)
(g:/texlive/Master/texmf-dist/tex/latex/xpackages/xtras/l3keys2e.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/fontspec/fontspec.sty
(g:/texlive/Master/texmf-dist/tex/generic/kastrup/binhex.tex)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatextra/luatextra.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-modutils.s
ty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-loader.sty

(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-compat.sty
)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase.loader.lua
))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/modutils.lua))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-attr.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/attr.lua))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-cctb.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/cctb.lua))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-regs.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/luatexbase-mcb.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luatexbase/mcb.lua))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/lualibs/lualibs.lua)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/environ.sty)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luaotfload/luaotfload.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/luaotfload/luaotfload.lua)))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/fontspec/fontspec.lua)
(g:/texlive/Master/texmf-dist/tex/latex/xkeyval/xkeyval.sty
(g:/texlive/Master/texmf-dist/tex/generic/xkeyval/xkeyval.tex
(g:/texlive/Master/texmf-dist/tex/generic/xkeyval/keyval.tex)))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/fontspec/fontspec-patches.sty
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/fixltx2e.sty))
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/base/fontenc.sty
(g:/texlive/Master/texmf-dist/tex/latex/euenc/eu2enc.def)
(g:/texlive/Master/texmf-dist/tex/latex/euenc/eu2lmr.fd))
fontspec.cfg loaded.
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/fontspec/fontspec.cfg))
(g:/texlive/Master/texmf-dist/tex/latex/koma-script/scrlfile.sty
Package scrlfile, 2009/03/25 v3.03 KOMA-Script package (loading files)
                   Copyright (C) Markus Kohm

)) (./fs.aux)
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/unicode-math/unicode-math-table.
tex)
luaotfload | Font names database loaded: 
$TEXMFVAR/luatex/generic/luaotfload/na
mes/otfl-names.lua
luaotfload | Updating the font names database:
luaotfload | Scanning TEXMF fonts...
luaotfload | Scanning OS fonts...
(g:/msys/1.0/trunk/build/texk/formats/pdflatex/unicode-math/unicode-math-table.
tex)
! Undefined control sequence.
<argument> \um_prime_single_mchar

\um_set_mathchar:NNnn #1#2#3#4->\Umathchardef #1
                                                 =\mathchar at type 
#2\csname sy...

\um_make_mathactive:nNN ...#3{\um_symfont_tl }{#1}
 
\char_gmake_mathactive:n {#1}

\um_setup_mathactives: ...e_single_mchar \mathord
 
\um_make_mathactive:nNN {"...

\\setmathfont ..._symbols: \um_setup_mathactives:
                                                   \um_setup_delcodes: 
\um_se...
l.4 \setmathfont{Cambria Math}

?
! Emergency stop.


From pragma at wxs.nl  Thu Jun 24 13:59:28 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 24 Jun 2010 13:59:28 +0200
Subject: [luatex] OCP broken?
In-Reply-To: <4C1F0FD7.1000304@elvenkind.com>
References: <20100619174819.GA24750@khaled-laptop>	<4C1DC9C8.5000200@elvenkind.com>	<20100620194534.GA10960@khaled-laptop>
	<4C1F0FD7.1000304@elvenkind.com>
Message-ID: <4C2348A0.8010500@wxs.nl>

On 21-6-2010 9:08, Taco Hoekwater wrote:

> I could attempt to go back to the state where it runs the otp, but to
> be honest I don't see much point in it as it will not work properly
> anyway. In fact this may be a good moment to do away with otps altogether.

indeed (and it was planned anyway)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From zappathustra at free.fr  Thu Jun 24 22:02:48 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 24 Jun 2010 22:02:48 +0200
Subject: [luatex] LuaTeX doesn't like it when boxes stick together too
	directly.
Message-ID: <4C23B9E8.6020309@free.fr>

Hello all,

And here's one more little bug in that wonderful thing:

\setbox0=\vbox{foo}
\setbox1=\vbox{bar}
\dimen0=\dimexpr(\ht0+\dp0)
\setbox0\vbox{%
  \box0
  \pdfliteral direct {}
  \kern-\dimen0
  \prevdepth-1000pt
  \box1}

\box0
\bye

"bar" should cover "foo", and it is the case if "\pdfliteral direct {}" 
is not there; but here "bar" appears on the right of "foo" (as if they 
shared an hbox). Of course, this doesn't happen with pdfTeX.
The emptiness of \pdfliteral is immaterial (it was quite full when I 
discovered the problem), whereas its directness matters.
Interestingly, if you substract 0.0004pt (not 0.0003pt!) from \dimen0 in 
the \dimexpr, everything goes back to normal.
I use the latest official release and apart from that I'm quite happy 
with it :)

Best,
Paul


From taco at elvenkind.com  Fri Jun 25 07:54:29 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 25 Jun 2010 07:54:29 +0200
Subject: [luatex] LuaTeX doesn't like it when boxes stick together too
 directly.
In-Reply-To: <4C23B9E8.6020309@free.fr>
References: <4C23B9E8.6020309@free.fr>
Message-ID: <4C244495.3010705@elvenkind.com>

Paul Isambert wrote:
> Hello all,
> 
> And here's one more little bug in that wonderful thing:

This bug was fixed in the repository and the texlive 2010 version
of luatex a few weeks ago, in fact. There will be a 0.60.2 soon.

> I use the latest official release and apart from that I'm quite happy 
> with it :)

Always good to hear. :)

Best wishes,
Taco

From wspr81 at gmail.com  Fri Jun 25 18:20:40 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Fri, 25 Jun 2010 09:20:40 -0700
Subject: [luatex] unicode-math: Undefined control sequence.,
	<argument> \um_prime_single_mchar
References: <4C225FF3.2070403@readytext.co.uk>
Message-ID: <i02l0o$pvv$1@dough.gmane.org>

On 2010-06-23 12:26:43 -0700, Graham Douglas 
<graham.douglas at readytext.co.uk> said:

> ! Undefined control sequence.
> <argument> \um_prime_single_mchar


Hi Graham,

I can't reproduce this; can you send me the complete log file of the 
same example with \listfiles in the preamble as well?

Thanks,
Will



From patrick at gundla.ch  Tue Jun 29 21:56:29 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 29 Jun 2010 21:56:29 +0200
Subject: [luatex] memory usage
Message-ID: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>

Hi,

I try to get rid of memory leaks, so I use status.node_mem_usage for tracing. Should status.node_mem_usage be all 0 at the end of a document? 

If I have for example this at the end of a document:

node_mem_usage=2 hlist, 4 vlist, 4 glue, 1 kern, 1 penalty, 3 glyph, 3 attribute, 5 glue_spec, 3 attribute_list, 1 dir

does that mean I forgot to clear the 2 hlists, 4 vlists, 4 glues etc.?


Patrick




From taco at elvenkind.com  Wed Jun 30 09:40:39 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 30 Jun 2010 09:40:39 +0200
Subject: [luatex] memory usage
In-Reply-To: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>
Message-ID: <4C2AF4F7.9090604@elvenkind.com>

On 06/29/2010 09:56 PM, Patrick Gundlach wrote:
> Hi,
>
> I try to get rid of memory leaks, so I use status.node_mem_usage for tracing. Should status.node_mem_usage be all 0 at the end of a document?
>
> If I have for example this at the end of a document:
>
> node_mem_usage=2 hlist, 4 vlist, 4 glue, 1 kern, 1 penalty, 3 glyph, 3 attribute, 5 glue_spec, 3 attribute_list, 1 dir
>
> does that mean I forgot to clear the 2 hlists, 4 vlists, 4 glues etc.?

Essentially, yes. But note:

1. There is some nesting. For example, the attributes are always inside
attribute lists and attribute lists are usually attached to other nodes,
and [hv]lists are likely to contain various other nodes.

2. Some of the 'leaks' come from plain.tex

Best wishes,
Taco

From patrick at gundla.ch  Wed Jun 30 09:50:45 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 30 Jun 2010 09:50:45 +0200
Subject: [luatex] memory usage
In-Reply-To: <4C2AF4F7.9090604@elvenkind.com>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>
	<4C2AF4F7.9090604@elvenkind.com>
Message-ID: <E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>



>> does that mean I forgot to clear the 2 hlists, 4 vlists, 4 glues etc.?
> 
> Essentially, yes. But note:
> 
> 1. There is some nesting. For example, the attributes are always inside
> attribute lists and attribute lists are usually attached to other nodes,
> and [hv]lists are likely to contain various other nodes.

my usecase is 

node.new(glyph_node)
node.set_attribute(....)
node.hpack(...)
node.ligaturing(..)
node.
node.vpack()
node.write(this node)

My naive view tells me that with node.write should clear/flush all these created nodes. Which ones do I have to kill manually? Background of my question is that my application uses several gig of ram and stalls my little notebook (nodebook?) I have several node.copy_list, these are obviously one source of increased memory usage.

Patrick



From taco at elvenkind.com  Wed Jun 30 10:17:47 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 30 Jun 2010 10:17:47 +0200
Subject: [luatex] memory usage
In-Reply-To: <E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>	<4C2AF4F7.9090604@elvenkind.com>
	<E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>
Message-ID: <4C2AFDAB.9090306@elvenkind.com>

On 06/30/2010 09:50 AM, Patrick Gundlach wrote:
>
>
>>> does that mean I forgot to clear the 2 hlists, 4 vlists, 4 glues
>>> etc.?
>>
>> Essentially, yes. But note:
>>
>> 1. There is some nesting. For example, the attributes are always
>> inside attribute lists and attribute lists are usually attached to
>> other nodes, and [hv]lists are likely to contain various other
>> nodes.
>
> my usecase is
>
> node.new(glyph_node) node.set_attribute(....) node.hpack(...)
> node.ligaturing(..) node. node.vpack() node.write(this node)
>
> My naive view tells me that with node.write should clear/flush all
> these created nodes.

Yes, it should.

> Which ones do I have to kill manually?
> Background of my question is that my application uses several gig of
> ram and stalls my little notebook (nodebook?)

A few dozen nodes can not be the problem, as that is less than
one kb. You had better check how much memory is taken up by
the lua state (status.luabytes iirc)

Best wishes,
Taco

