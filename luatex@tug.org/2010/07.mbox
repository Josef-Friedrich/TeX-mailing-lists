From taco at elvenkind.com  Thu Jul  1 09:57:32 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 01 Jul 2010 09:57:32 +0200
Subject: [luatex] Luatex 0.60.2 announcement
Message-ID: <4C2C4A6C.8020004@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.60.2,
a bugfix release for the 0.60 branch.

Bugfixes:

* Various small portability fixes, especially for non-gcc
   compilers.

* Updated synctex from Jerome Laurens.

* fix bug #406: \pdfliteral hinders hyphenation.

* fix pdf overprinting bug (related to \pdfliteral).

* patch from Akira Kakuto that ensures that only absolute commands
that are inside the %PATH% will be executed in win32's restricted
\write18

* fix a buffer overflow in luafontloader.

* fix cross-platform share-ability of generated formats.

* fix a few typos in the manual.

* fix trashing of the null glue spec by attribute reference code.

* documented the deprecated state and brokenness of otp processing.


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.60.2

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org


Have fun,
Taco




From patrick at gundla.ch  Thu Jul  1 11:45:47 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 1 Jul 2010 11:45:47 +0200
Subject: [luatex] memory usage
In-Reply-To: <4C2AFDAB.9090306@elvenkind.com>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>	<4C2AF4F7.9090604@elvenkind.com>
	<E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>
	<4C2AFDAB.9090306@elvenkind.com>
Message-ID: <FA673D9F-E17D-40B6-B60E-1E9A9AE034B8@gundla.ch>


> A few dozen nodes can not be the problem, as that is less than
> one kb. You had better check how much memory is taken up by
> the lua state (status.luabytes iirc)

Its more then a few dozen but this does not justify the > 6 gig memory usage, I'd guess:

node_mem_usage=15654424 hlist, 23395466 vlist, 3925881 rule, 88525 disc, 70867847 glue, 15985958 penalty, 20651657 glyph, 2873213 attribute, 56441926 glue_spec, 2873213 attribute_list, 1 dir, 45 pdf_literal, 20458 pdf_refximage

luastate_bytes=80694 (in kb)


(the pdf is just 15 meg)

Patrick

From taco at elvenkind.com  Thu Jul  1 11:57:25 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 01 Jul 2010 11:57:25 +0200
Subject: [luatex] memory usage
In-Reply-To: <FA673D9F-E17D-40B6-B60E-1E9A9AE034B8@gundla.ch>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>	<4C2AF4F7.9090604@elvenkind.com>	<E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>	<4C2AFDAB.9090306@elvenkind.com>
	<FA673D9F-E17D-40B6-B60E-1E9A9AE034B8@gundla.ch>
Message-ID: <4C2C6685.9080101@elvenkind.com>

On 07/01/2010 11:45 AM, Patrick Gundlach wrote:
>
>> A few dozen nodes can not be the problem, as that is less than
>> one kb. You had better check how much memory is taken up by
>> the lua state (status.luabytes iirc)
>
> Its more then a few dozen but this does not justify the>  6 gig memory usage, I'd guess:
>
> node_mem_usage=15654424 hlist, 23395466 vlist, 3925881 rule, 88525 disc,
> 70867847 glue, 15985958 penalty, 20651657 glyph, 2873213 attribute, 56441926 glue_spec,
> 2873213 attribute_list, 1 dir, 45 pdf_literal, 20458 pdf_refximage

Ouch. That adds up to roughly 200Mln nodes. At roughly 4 memory words
per node and 8 bytes per memory word, you indeed get 6G.

Perhaps you are using copy_list a bit too eagerly (are you
assigning to .list fields without freeing the old content first?).

Best wishes,
Taco

From patrick at gundla.ch  Thu Jul  1 12:14:10 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 1 Jul 2010 12:14:10 +0200
Subject: [luatex] memory usage
In-Reply-To: <4C2C6685.9080101@elvenkind.com>
References: <BAF8499F-0F8D-49F2-B202-FEAFBE4665DE@gundla.ch>	<4C2AF4F7.9090604@elvenkind.com>	<E0413CE7-07FE-4A20-8D94-FE62DA771AB3@gundla.ch>	<4C2AFDAB.9090306@elvenkind.com>
	<FA673D9F-E17D-40B6-B60E-1E9A9AE034B8@gundla.ch>
	<4C2C6685.9080101@elvenkind.com>
Message-ID: <8520AEAA-5711-45B1-9481-77DB2E8904C5@gundla.ch>

Hi Taco,


> 
> Perhaps you are using copy_list a bit too eagerly

Yes, I use copy_list excessively.

> (are you
> assigning to .list fields without freeing the old content first?).

no, not at all - as far as I can see.

Thanks for your answer, I want to make sure I find the problem for the memory usage before fixing it. Now I will look into the millions of copy_list calls.

Patrick



From elie.roux at telecom-bretagne.eu  Thu Jul  1 13:52:20 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Thu, 01 Jul 2010 13:52:20 +0200
Subject: [luatex] LuaTeX doesn't like it when boxes stick together too
 directly.
In-Reply-To: <4C244495.3010705@elvenkind.com>
References: <4C23B9E8.6020309@free.fr> <4C244495.3010705@elvenkind.com>
Message-ID: <4C2C8174.5080605@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> This bug was fixed in the repository and the texlive 2010 version
> of luatex a few weeks ago, in fact. There will be a 0.60.2 soon.

Hello,

I encountered a bug like this one too, but it's not corrected in the 
last trunk version (tell me if I'm wrong, I may have done something 
strange). My file is attached to this mail. I'm sorry this is LaTeX but 
it should not be very difficult. The result is different in pdfTeX and 
LuaTeX, and the very strange thing is that the result is correct if you 
add a \hbox to 0pt{a\hss} just after (the document has both cases).

Thank you,
-- 
Elie

-------------- next part --------------
A non-text attachment was scrubbed...
Name: testbug.tex
Type: application/x-tex
Size: 506 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100701/61e51dbc/attachment.tex>

From taco at elvenkind.com  Thu Jul  1 15:10:25 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 01 Jul 2010 15:10:25 +0200
Subject: [luatex] LuaTeX doesn't like it when boxes stick together too
 directly.
In-Reply-To: <4C2C8174.5080605@telecom-bretagne.eu>
References: <4C23B9E8.6020309@free.fr> <4C244495.3010705@elvenkind.com>
	<4C2C8174.5080605@telecom-bretagne.eu>
Message-ID: <4C2C93C1.6090409@elvenkind.com>

On 07/01/2010 01:52 PM, Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> This bug was fixed in the repository and the texlive 2010 version
>> of luatex a few weeks ago, in fact. There will be a 0.60.2 soon.
>
> Hello,
>
> I encountered a bug like this one too, but it's not corrected in the
> last trunk version (tell me if I'm wrong, I may have done something
> strange). My file is attached to this mail. I'm sorry this is LaTeX but
> it should not be very difficult. The result is different in pdfTeX and
> LuaTeX, and the very strange thing is that the result is correct if you
> add a \hbox to 0pt{a\hss} just after (the document has both cases).

Can you create a tracker item for this, with the output? I expect that
Hartmut will look at it.

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Fri Jul  2 22:16:17 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Fri, 02 Jul 2010 22:16:17 +0200
Subject: [luatex] LuaTeX doesn't like it when boxes stick together too
 directly.
In-Reply-To: <4C2C93C1.6090409@elvenkind.com>
References: <4C23B9E8.6020309@free.fr> <4C244495.3010705@elvenkind.com>
	<4C2C8174.5080605@telecom-bretagne.eu>
	<4C2C93C1.6090409@elvenkind.com>
Message-ID: <4C2E4911.3090207@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Can you create a tracker item for this, with the output? I expect that
> Hartmut will look at it.

Done : http://tracker.luatex.org/view.php?id=421. I managed to reduce a 
bit the example, but it still uses a bit of LaTeX...

Thank you,
-- 
Elie

From steve.b.hafner at gmail.com  Tue Jul  6 05:01:52 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Mon, 5 Jul 2010 20:01:52 -0700
Subject: [luatex] Changing catcodes in \directlua
Message-ID: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>

I'm using luatex beta-0.40.6 in texlive2009.

If file.tex contains the the following two lines

\directlua{\begingroup\catcode`\\=12 tex.print("$\alpha$")\endgroup}
\bye

then

luatex file.tex

gives

! Argument of \\ has an extra }.

But I expected that the argument of \directlua would expand to

tex.print("$\alpha$")

and that $\alpha$ would be sent to the tex stream.

So how do I change catcodes in \directlua?

From zappathustra at free.fr  Tue Jul  6 08:34:15 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 06 Jul 2010 08:34:15 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
Message-ID: <4C32CE67.9040008@free.fr>

Things are expanded in a \directlua statement, like in a \write or 
\special. And what is not exanded, e.g. primitives like \begingroup, is 
interpreted as Lua code, where quite obviously a string like 
"\begingroup" doesn't make sense. The simplest solution to achieve what 
you want is:

\directlua{tex.print("\luaescapestring{$\noexpand\alpha$}")}

which turns into correct Lua code: first because \alpha isn't expanded, 
second because \luaescapestring modifies its argument so that you get 
what you want. Forgetting it leads to Lua reading

tex.print("$\alpha$")

which you might find sensible but to Lua it means ``print the dollar 
character, then a bell, then the `lpha'$ string.'' I say ``a bell'' 
because \a is an escape sequence that refers to this character, which 
let's admit isn't the most often used nowadays. On the other hand the 
sequence with \luaescapestring returns this to Lua:

tex.print("$\\alpha$")

which means ``print a dollar, a backslash `alpha', and a dollar'' and 
that's correctly interpreted by TeX. (Note that I'm using LuaTeX v.0.6, 
hopefully it'll change nothing.)

Now a note for our much admired LuaTeX developpers: experimenting with 
the engine to answer this post I found that

\directlua{tex.print("a\noexpand\alpha b")}

returns ``aXlpha b'' where ``X'' is whatever TeX renders the bell \a 
with (an uppercase upsilon for me). But what surprises me is the space 
before the ``b''. Where does it come from? I'd think ``\alpha'' when it 
was still a command would have gobbled it...?

Best,
Paul





Steve Hafner a ?crit :
> I'm using luatex beta-0.40.6 in texlive2009.
>
> If file.tex contains the the following two lines
>
> \directlua{\begingroup\catcode`\\=12 tex.print("$\alpha$")\endgroup}
> \bye
>
> then
>
> luatex file.tex
>
> gives
>
> ! Argument of \\ has an extra }.
>
> But I expected that the argument of \directlua would expand to
>
> tex.print("$\alpha$")
>
> and that $\alpha$ would be sent to the tex stream.
>
> So how do I change catcodes in \directlua?
>   


From taco at elvenkind.com  Tue Jul  6 09:18:34 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 06 Jul 2010 09:18:34 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C32CE67.9040008@free.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
Message-ID: <4C32D8CA.7010408@elvenkind.com>


Hi,

On 07/06/2010 08:34 AM, Paul Isambert wrote:
>
> Now a note for our much admired LuaTeX developpers: experimenting with
> the engine to answer this post I found that
>
> \directlua{tex.print("a\noexpand\alpha b")}
>
> returns ``aXlpha b'' where ``X'' is whatever TeX renders the bell \a
> with (an uppercase upsilon for me). But what surprises me is the space
> before the ``b''. Where does it come from? I'd think ``\alpha'' when it
> was still a command would have gobbled it...?

That's because the tokens have to be converted back to a string for
use by lua, and that string that is fed into lua is "a\alpha b".
The byte sequence "\a" then becomes a single ^G via lua's string
escape mechanism.

Best wishes,
Taco

From luigi.scarso at gmail.com  Tue Jul  6 09:45:57 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 6 Jul 2010 09:45:57 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C32CE67.9040008@free.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
Message-ID: <AANLkTimVvA1mYbTEacsQ52_K4wDHJb4QgKJOJsqFuBDQ@mail.gmail.com>

On Tue, Jul 6, 2010 at 8:34 AM, Paul Isambert <zappathustra at free.fr> wrote:
> Things are expanded in a \directlua statement, like in a \write or \special.
> And what is not exanded, e.g. primitives like \begingroup, is interpreted as
> Lua code, where quite obviously a string like "\begingroup" doesn't make
> sense. The simplest solution to achieve what you want is:
>
> \directlua{tex.print("\luaescapestring{$\noexpand\alpha$}")}
>
> which turns into correct Lua code: first because \alpha isn't expanded,
> second because \luaescapestring modifies its argument so that you get what
> you want. Forgetting it leads to Lua reading
>
> tex.print("$\alpha$")
>
> which you might find sensible but to Lua it means ``print the dollar
> character, then a bell, then the `lpha'$ string.'' I say ``a bell'' because
> \a is an escape sequence that refers to this character, which let's admit
> isn't the most often used nowadays. On the other hand the sequence with
> \luaescapestring returns this to Lua:
>
> tex.print("$\\alpha$")
>
> which means ``print a dollar, a backslash `alpha', and a dollar'' and that's
> correctly interpreted by TeX. (Note that I'm using LuaTeX v.0.6, hopefully
> it'll change nothing.)
What about
\directlua{tex.print([[$\alpha$]])}
?
-- 
luigi

From mpg at elzevir.fr  Tue Jul  6 10:58:33 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 06 Jul 2010 10:58:33 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C32CE67.9040008@free.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
Message-ID: <4C32F039.9020302@elzevir.fr>

Le 06/07/2010 08:34, Paul Isambert a ?crit :
> \directlua{tex.print("a\noexpand\alpha b")}
> [...] But what surprises me is the space 
> before the ``b''. Where does it come from? I'd think ``\alpha'' when it 
> was still a command would have gobbled it...?
> 
The space is first gobbled, then another space is generated when TeX converts
the unexpanded '\alpha' token to a string of characters. If you don't want any
space, you can use \string\alpha.

This is exactly the same as \write and other TeX82 primitives. Try

\write20{|\noexpand\alpha|\string\alpha|}

and look at the terminal (or log).

Manuel.

From zappathustra at free.fr  Tue Jul  6 11:33:57 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 06 Jul 2010 11:33:57 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C32F039.9020302@elzevir.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>	<4C32CE67.9040008@free.fr>
	<4C32F039.9020302@elzevir.fr>
Message-ID: <4C32F885.8090203@free.fr>


> The space is first gobbled, then another space is generated when TeX converts
> the unexpanded '\alpha' token to a string of characters. If you don't want any
> space, you can use \string\alpha.
>
> This is exactly the same as \write and other TeX82 primitives. Try
>
> \write20{|\noexpand\alpha|\string\alpha|}
>
> and look at the terminal (or log).
>   


Indeed, the good ol' trailing space. I forget it more often than not.
Paul


From steve.b.hafner at gmail.com  Tue Jul  6 16:05:20 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Tue, 6 Jul 2010 07:05:20 -0700
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C32CE67.9040008@free.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
Message-ID: <AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>

On Mon, Jul 5, 2010 at 11:34 PM, Paul Isambert <zappathustra at free.fr> wrote:
> Things are expanded in a \directlua statement, like in a \write or \special.
> And what is not exanded, e.g. primitives like \begingroup, is interpreted as
> Lua code, where quite obviously a string like "\begingroup" doesn't make
> sense. The simplest solution to achieve what you want is:
>
> \directlua{tex.print("\luaescapestring{$\noexpand\alpha$}")}
>
> which turns into correct Lua code: first because \alpha isn't expanded,
> second because \luaescapestring modifies its argument so that you get what
> you want. Forgetting it leads to Lua reading
>
> tex.print("$\alpha$")
>
> which you might find sensible but to Lua it means ``print the dollar
> character, then a bell, then the `lpha'$ string.'' I say ``a bell'' because
> \a is an escape sequence that refers to this character, which let's admit
> isn't the most often used nowadays. On the other hand the sequence with
> \luaescapestring returns this to Lua:
>
> tex.print("$\\alpha$")
>
> which means ``print a dollar, a backslash `alpha', and a dollar'' and that's
> correctly interpreted by TeX. (Note that I'm using LuaTeX v.0.6, hopefully
> it'll change nothing.)
>

Yes, everything works as you say. Thanks for the schooling. However, I
don't want to have to add anything  to the string that I pass to Lua.
I guess what I'm looking for is ConTeXt's \startluacode ...
\stopluacode, but in plain-TeX.  So for my second attempt I took some
code from  tex/context/base/luat-ini.mkiv and pieced the following
together:
--------------------------------------------------------------------------------
 \def\obeylualines
   {\obeylines
    \obeyspaces}

%The above was
% \def\obeylualines
%   {\obeylines      \let\obeyedline   \outputnewlinechar
%    \obeyspaces  \let\obeyedspace\space }


 \def\obeyluatokens % todo: make this a proper catcode table, use let's
   {\catcode`\%=12 \catcode`\#=12
    \catcode`\_=12 \catcode`\^=12
    \catcode`\&=12 \catcode`\|=12
    \catcode`\{=12 \catcode`\}=12
    \catcode`\~=12 \catcode`\$=12
    \def\\{\string\\}\def\|{\string\|}\def\-{\string\-}%
    \def\({\string\(}\def\){\string\)}\def\{{\string\{}\def\}{\string\}}%
    \def\'{\string\'}\def\"{\string\"}%
    \def\n{\string\n}\def\r{\string\r}\def\f{\string\f}\def\t{\string\t}%
    \def\a{\string\a}\def\b{\string\b}\def\v{\string\v}\def\s{\string\s}%
    \def\1{\string\1}\def\2{\string\2}\def\3{\string\3}\def\4{\string\4}\def\5{\string\5}%
    \def\6{\string\6}\def\7{\string\7}\def\8{\string\8}\def\9{\string\9}\def\0{\string\0}}

\long\def\dodostartluacode#1\stopluacode
  {\expanded{\endgroup\noexpand\directlua{#1}}}

%The above was
%\long\def\dodostartluacode#1\stopluacode
%  {\normalexpanded{\endgroup\noexpand\directlua\zerocount{#1}}}

\long\def\dostartluacode
  {\begingroup
   \obeylualines
   \obeyluatokens
   \dodostartluacode}

\def\startluacode{\dostartluacode}
% this was
%\unexpanded\def\startluacode{\dostartluacode}


\startluacode
tex.print([[$\int f(x)\,dx$]]) %thanks Manuel for pointing out [[ ]]
\stopluacode
\bye
--------------------------------------------------------------------------------

And running this in plain luatex seems to work as I want. But I
dropped and modified some stuff as noted, so maybe there's some
gotchas lurking in there. In particular, I as yet can't find the
definition of \zerocount, so I just left it out.

I also realize that I should be using catcode tables, and I will look
into this later today.

- Steve

From mpg at elzevir.fr  Tue Jul  6 16:35:12 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 06 Jul 2010 16:35:12 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>	<4C32CE67.9040008@free.fr>
	<AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
Message-ID: <4C333F20.7060804@elzevir.fr>

Le 06/07/2010 16:05, Steve Hafner a ?crit :
> tex.print([[$\int f(x)\,dx$]]) %thanks Manuel for pointing out [[ ]]

For the record, it was Luigi.

Fwiw, I don't like [[...]]: it doesn't work if your string contains ]]. Sure,
you could use [===[ ... ]===], but the problem remains if your string contains
]===], etc. \luaescapstring, otoh, is guaranteed to always work, which sounds
very appealing to the control freak inside me :-)

Manuel.

From taco at elvenkind.com  Tue Jul  6 17:17:00 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 06 Jul 2010 17:17:00 +0200
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>	<4C32CE67.9040008@free.fr>
	<AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
Message-ID: <4C3348EC.4030803@elvenkind.com>


Hi,

On 07/06/2010 04:05 PM, Steve Hafner wrote:
> --------------------------------------------------------------------------------
>   \def\obeylualines
>     {\obeylines
>      \obeyspaces}

Should be fine. There is tiny difference in the line end
handling, but I doubt it matters any in practice.

> \long\def\dodostartluacode#1\stopluacode
>    {\expanded{\endgroup\noexpand\directlua{#1}}}

That is fine. Unless you have named the lua instance, you don't need
\zerocount (and if you did not understand that remark, you didn't).

> \def\startluacode{\dostartluacode}
> % this was
> %\unexpanded\def\startluacode{\dostartluacode}

The \unexpanded can be useful if you have \startluacode ... \stopluacode
inside expandable things like \write or \edef, otherwise irrelevant.

Best wishes,
Taco

From steve.b.hafner at gmail.com  Wed Jul  7 05:28:35 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Tue, 6 Jul 2010 21:28:35 -0600
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C333F20.7060804@elzevir.fr>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
	<AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
	<4C333F20.7060804@elzevir.fr>
Message-ID: <AANLkTil5iRtBRr68cWnT-NTNmx18cjv9wEqcJp7TJUbn@mail.gmail.com>

On Tue, Jul 6, 2010 at 8:35 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Le 06/07/2010 16:05, Steve Hafner a ?crit :
>> tex.print([[$\int f(x)\,dx$]]) %thanks Manuel for pointing out [[ ]]
>
> For the record, it was Luigi.
>

 My apologies for my carelessness, Manuel and Luigi.

--steve


From steve.b.hafner at gmail.com  Wed Jul  7 05:48:03 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Tue, 6 Jul 2010 21:48:03 -0600
Subject: [luatex] Changing catcodes in \directlua
In-Reply-To: <4C3348EC.4030803@elvenkind.com>
References: <AANLkTileXCsDsmalp-wuTAiBbm1-9BS_yeSIaGXQHgeJ@mail.gmail.com>
	<4C32CE67.9040008@free.fr>
	<AANLkTinUGyM9Hwj5m55fLHJIkM1Q-70t6yLSbbMNK8lg@mail.gmail.com>
	<4C3348EC.4030803@elvenkind.com>
Message-ID: <AANLkTinUF_FjTlm9KnQRJmH1WNfeGvVv0GafMfocouXt@mail.gmail.com>

On Tue, Jul 6, 2010 at 9:17 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
>
> Hi,
>
> On 07/06/2010 04:05 PM, Steve Hafner wrote:
>>
>>
>> --------------------------------------------------------------------------------
>> ?\def\obeylualines
>> ? ?{\obeylines
>> ? ? \obeyspaces}
>
> Should be fine. There is tiny difference in the line end
> handling, but I doubt it matters any in practice.
>
>> \long\def\dodostartluacode#1\stopluacode
>> ? {\expanded{\endgroup\noexpand\directlua{#1}}}
>
> That is fine. Unless you have named the lua instance, you don't need
> \zerocount (and if you did not understand that remark, you didn't).
>
>> \def\startluacode{\dostartluacode}
>> % this was
>> %\unexpanded\def\startluacode{\dostartluacode}
>
> The \unexpanded can be useful if you have \startluacode ... \stopluacode
> inside expandable things like \write or \edef, otherwise irrelevant.
>
> Best wishes,
> Taco
>

Thank you, Taco.

--steve


From patrick at gundla.ch  Wed Jul  7 14:13:53 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 7 Jul 2010 14:13:53 +0200
Subject: [luatex] include a new library in the executable file
Message-ID: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>

Hi,

for the sake of easy distribution of the binary, I would like to include an xml parser (lua-xmlreader, for libxml2) into the executable, if it is not too complicated. I am rather inexperienced when it comes to autotools, but I guess I need to use them.

Can someone help me out? I guess I need to patch luamisc.am and include lua-xmlreader in a subdirectory there. Which steps are needed after that?

I would like to update the sources and run ./build.sh as usual, but with the lua lib included (not necessarily the libxml2).

Does this make sense at all?

Patrick




From patrick at gundla.ch  Wed Jul  7 14:32:08 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 7 Jul 2010 14:32:08 +0200
Subject: [luatex] include a new library in the executable file
In-Reply-To: <4C3472E2.50904@elvenkind.com>
References: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>
	<4C3472E2.50904@elvenkind.com>
Message-ID: <DB22A0BC-32D4-435D-8887-4F6D44545847@gundla.ch>

Hi Taco,


> Not really complicated. Are you using trunk or branches/0.60.x ?

trunk

> 
> I can do this quite quickly and then I could send you (and the ml)
> a patch for future reference.

This is the web page with the lua-xmlreader project. There are others, of course, but this has been working fine so far so I never bothered to try any other lib.

http://asbradbury.org/projects/lua-xmlreader/

There is also a small test file on the page.


Patrick



From taco at elvenkind.com  Wed Jul  7 14:33:04 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 07 Jul 2010 14:33:04 +0200
Subject: [luatex] include a new library in the executable file
In-Reply-To: <DB22A0BC-32D4-435D-8887-4F6D44545847@gundla.ch>
References: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>	<4C3472E2.50904@elvenkind.com>
	<DB22A0BC-32D4-435D-8887-4F6D44545847@gundla.ch>
Message-ID: <4C347400.10100@elvenkind.com>



Patrick Gundlach wrote:
> Hi Taco,
> 
> 
>> Not really complicated. Are you using trunk or branches/0.60.x ?
> 
> trunk

Ok, give me half an hour or so.

From taco at elvenkind.com  Wed Jul  7 15:21:43 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 07 Jul 2010 15:21:43 +0200
Subject: [luatex] include a new library in the executable file
In-Reply-To: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>
References: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>
Message-ID: <4C347F67.9000205@elvenkind.com>


Hi,


Patrick Gundlach wrote:
> Hi,
> 
> for the sake of easy distribution of the binary, I would like to
> include an xml parser (lua-xmlreader, for libxml2) into the
> executable, if it is not too complicated. I am rather inexperienced
> when it comes to autotools, but I guess I need to use them.
> 
> Can someone help me out? I guess I need to patch luamisc.am and
> include lua-xmlreader in a subdirectory there. Which steps are needed
> after that?

It is not overly complex, but there are few extra steps. I'll try
to explain (but note that this is a hackish way of doing things,
nicer would be a dedicated .am file for lua-xmlreader only).

-1. Install the libxml2-devel package.

0. Extract lua-xmlreader-0.1.tar.gz below luatexdir/.

1. Add three source files and an include dir to
luatexdir/am/luamisc.am:

Index: texk/web2c/luatexdir/am/luamisc.am
===================================================================
--- texk/web2c/luatexdir/am/luamisc.am  (revision 3735)
+++ texk/web2c/luatexdir/am/luamisc.am  (working copy)
@@ -15,7 +15,8 @@
 libluamisc_a_CPPFLAGS = \
        $(ZLIB_INCLUDES) \
        $(ZZIPLIB_INCLUDES) \
-       -I$(top_srcdir)/luatexdir/lua51
+       -I$(top_srcdir)/luatexdir/lua51 \
+       -I/usr/include/libxml2
 libluamisc_a_CFLAGS = # $(WARNING_CFLAGS)

 libluamisc_a_SOURCES = \
@@ -26,6 +27,9 @@
        luatexdir/luamd5/md5lib.c \
        luatexdir/luamd5/md5_lua.c \
        luatexdir/luapeg/lpeg.c \
+       luatexdir/lua-xmlreader-0.1/error.c \
+       luatexdir/lua-xmlreader-0.1/error.h \
+       luatexdir/lua-xmlreader-0.1/xmlreader.c \
        luatexdir/luaprofiler/clocks.c \
        luatexdir/luaprofiler/clocks.h \
        luatexdir/luaprofiler/core_profiler.c \

2. Add -lxml2  to luatexdir/am/luatex.am

===================================================================
--- texk/web2c/luatexdir/am/luatex.am   (revision 3735)
+++ texk/web2c/luatexdir/am/luatex.am   (working copy)
@@ -26,7 +26,7 @@

 luatex_LDFLAGS = -export-dynamic

-luatex_LDADD = $(luatex_ldadd) $(LDADD) $(LIBADD_DLOPEN) $(lua_socketlibs)
+luatex_LDADD = $(luatex_ldadd) $(LDADD) $(LIBADD_DLOPEN)
$(lua_socketlibs) -lxml2

 luatex_DEPENDENCIES = $(proglib) $(KPATHSEA_DEPEND) libluatex.a
 luatex_DEPENDENCIES += $(LIBPNG_DEPEND) $(ZLIB_DEPEND) $(XPDF_DEPEND)

3. Run 'autoreconf' in source/texk/web2c.  Actually this is the
tricky bit because you need the right versions of autoconf (>=2.65)
and automake (>=1.11.1).

4. Add the prototype of luaopen_xmlreader in xmlreader.c to
luatexdir/lua/luatex-api.h:

Index: texk/web2c/luatexdir/lua/luatex-api.h
===================================================================
--- texk/web2c/luatexdir/lua/luatex-api.h       (revision 3735)
+++ texk/web2c/luatexdir/lua/luatex-api.h       (working copy)
@@ -60,6 +60,8 @@
 extern int luaopen_md5(lua_State * L);
 extern int luatex_md5_lua_open(lua_State * L);

+extern int luaopen_xmlreader(lua_State * L);
+
 extern int luaopen_zlib(lua_State * L);
 extern int luaopen_gzip(lua_State * L);
 extern int luaopen_ff(lua_State * L);

5. Add the call to luaopen_xmlreader() to the array in
luatexdir/lua/luastuff.w:

Index: texk/web2c/luatexdir/lua/luastuff.w
===================================================================
--- texk/web2c/luatexdir/lua/luastuff.w (revision 3735)
+++ texk/web2c/luatexdir/lua/luastuff.w (working copy)
@@ -105,6 +105,7 @@
     {"unicode", luaopen_unicode},
     {"zip", luaopen_zip},
     {"lpeg", luaopen_lpeg},
+    {"xmlreader", luaopen_xmlreader},
     {"md5", luaopen_md5},
     {"lfs", luaopen_lfs},
     {"profiler", luaopen_profiler},

6. run build.sh

Attached is a patch based on current trunk. It is fairly long simply
because of the modification to Makefile.in that happens thanks to
autoreconf.

Best wishes,
Taco
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: luaxmlreader.patch
URL: <http://tug.org/pipermail/luatex/attachments/20100707/58a6bbd5/attachment.pl>

From patrick at gundla.ch  Wed Jul  7 15:50:52 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 7 Jul 2010 15:50:52 +0200
Subject: [luatex] include a new library in the executable file
In-Reply-To: <4C347F67.9000205@elvenkind.com>
References: <8ED30C76-8231-4CFA-910F-191E62EAB685@gundla.ch>
	<4C347F67.9000205@elvenkind.com>
Message-ID: <0C5FF663-628B-4721-BABE-7AA1B29A2D66@gundla.ch>

Thanks Taco!

I have followed the steps -1 to 6 on my Mac and I got everything working at once! I would have missed the steps 4 and 5 (and didn't know the autoreconf) but of course it makes sense when reading it.

Thanks again!

Patrick



From joseph.wright at morningstar2.co.uk  Sat Jul 10 20:59:34 2010
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Sat, 10 Jul 2010 19:59:34 +0100
Subject: [luatex] On category code tables
Message-ID: <4C38C316.6030409@morningstar2.co.uk>

Hello all,

I'm taking a look at the category code table primitives provided by 
LuaTeX (\completable, \initcatcodetable and \savecatcodetable). I'm not 
entirely clear on a few things.

I'd initially imagined when I first saw about category code tables that 
you'd be able to set up a table then use it to reset a large number of 
category codes in one go. However, I pick up from

   http://tug.org/mailman/htdig/luatex/2010-March/001389.html

that if I have something like

   \catcodetable<number>\relax
   \catcode<char> <code>\relax

then the category code change will become part of the table in force, 
i.e. without an explicit \savecatcodetable<number> instruction. At the 
same time, there does not seem to be a way to copy category codes from 
one table to another. So how do I achieve:

   \savecatcodetable<number>\relax % Fixed table of codes
   \catcode<x> <y>
   ...
   \catcodetable<number>

such that I can treat category code table <number> as a fixed set of 
category codes that will never be accidentally altered? This also seems 
to be an issue in that

   \catcodetable<number>\relax
   \catcode<x> <y>
   \catcodetable<number>\relax

doesn't reset the code for <x>. I must be missing something, as this 
otherwise undermines the entire point, as far as I can see.

At the same time, I don't see how I know which tables I can safely use. 
In a LaTeX2e situation other packages might have already set up tables 
for their own use. So to 'play nicely' I need to find out which tables 
are free before I do \savecatcodetable and potentially trash someone 
else's work?

(The context here is the LaTeX3 \ExplSyntax stack. It would be nice to 
take advantage of LuaTeX, when available, and exploit category code 
tables. However, first I need to understand how they work.)
-- 
Joseph Wright

From steve.b.hafner at gmail.com  Sat Jul 10 21:39:47 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Sat, 10 Jul 2010 12:39:47 -0700
Subject: [luatex] On category code tables
In-Reply-To: <4C38C316.6030409@morningstar2.co.uk>
References: <4C38C316.6030409@morningstar2.co.uk>
Message-ID: <AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>

On Sat, Jul 10, 2010 at 11:59 AM, Joseph Wright
<joseph.wright at morningstar2.co.uk> wrote:
> At the same time, I don't see how I know which tables I can safely use. In a
> LaTeX2e situation other packages might have already set up tables for their
> own use. So to 'play nicely' I need to find out which tables are free before
> I do \savecatcodetable and potentially trash someone else's work?

I'm guessing that the idea is for the macro system to manage the
catcode tables; so for example LaTeX is responsible for providing a
safe environment. To that end you might have a look at sections 1.4
and 3.3 of

http://mirror.ctan.org/macros/luatex/generic/luatextra/luatextra-reference.pdf

From steve.b.hafner at gmail.com  Sat Jul 10 22:58:07 2010
From: steve.b.hafner at gmail.com (Steve Hafner)
Date: Sat, 10 Jul 2010 13:58:07 -0700
Subject: [luatex] On category code tables
In-Reply-To: <4C38C316.6030409@morningstar2.co.uk>
References: <4C38C316.6030409@morningstar2.co.uk>
Message-ID: <AANLkTingXoZDWDM8iLVClOFhRfuZYfToBVDGoKb0EY7L@mail.gmail.com>

On Sat, Jul 10, 2010 at 11:59 AM, Joseph Wright
<joseph.wright at morningstar2.co.uk> wrote:
> Hello all,
>
> I'm taking a look at the category code table primitives provided by LuaTeX
> (\completable, \initcatcodetable and \savecatcodetable). I'm not entirely
> clear on a few things.
>
> I'd initially imagined when I first saw about category code tables that
> you'd be able to set up a table then use it to reset a large number of
> category codes in one go. However, I pick up from
>
> ?http://tug.org/mailman/htdig/luatex/2010-March/001389.html
>
> that if I have something like
>
> ?\catcodetable<number>\relax
> ?\catcode<char> <code>\relax
>
> then the category code change will become part of the table in force, i.e.
> without an explicit \savecatcodetable<number> instruction. At the same time,
> there does not seem to be a way to copy category codes from one table to
> another. So how do I achieve:
>
> ?\savecatcodetable<number>\relax % Fixed table of codes
> ?\catcode<x> <y>
> ?...
> ?\catcodetable<number>
>
> such that I can treat category code table <number> as a fixed set of
> category codes that will never be accidentally altered? This also seems to
> be an issue in that
>
> ?\catcodetable<number>\relax
> ?\catcode<x> <y>
> ?\catcodetable<number>\relax
>
> doesn't reset the code for <x>. I must be missing something, as this
> otherwise undermines the entire point, as far as I can see.

I have little experience, but here is an idea ...

Keep one table position reserved for the "current" catcode table,
suppose this is position 1. Then define all your other "immutable"
tables in other positions. For this example assume we have a table
that we don't want altered in position 2. Then define a command such
as

\def\loadcatcodetable#1{\catcodetable#1\savecatcodetable1\catecodetable1}

Then one can say

\loadcatcodetable2

and a copy of table 2 will be placed in table 1 and table 1 will be
made current. Now, as you indicated in the rest of your post its not
good to have the table numbers hard coded, and so I think you need
some other macros to manage that (see my previous response).


From mpg at elzevir.fr  Sat Jul 10 23:51:41 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 10 Jul 2010 23:51:41 +0200
Subject: [luatex] On category code tables
In-Reply-To: <AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>
References: <4C38C316.6030409@morningstar2.co.uk>
	<AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>
Message-ID: <4C38EB6D.4020002@elzevir.fr>

Le 10/07/2010 21:39, Steve Hafner a ?crit :
> On Sat, Jul 10, 2010 at 11:59 AM, Joseph Wright
> <joseph.wright at morningstar2.co.uk> wrote:
>> At the same time, I don't see how I know which tables I can safely use. In a
>> LaTeX2e situation other packages might have already set up tables for their
>> own use. So to 'play nicely' I need to find out which tables are free before
>> I do \savecatcodetable and potentially trash someone else's work?
> 
> I'm guessing that the idea is for the macro system to manage the
> catcode tables; so for example LaTeX is responsible for providing a
> safe environment.

Sure, in the same way as Plain and LaTeX handle allocation of counters, boxes, etc.

> To that end you might have a look at sections 1.4
> and 3.3 of
> 
> http://mirror.ctan.org/macros/luatex/generic/luatextra/luatextra-reference.pdf

Hum, this document is largely obsolete (I should update it, at least by putting
a warning). I suggest you rather look at

http://mirror.ctan.org/macros/luatex/generic/luatexbase/luatexbase-cctb.pdf
http://mirror.ctan.org/macros/macros/latex/contrib/oberdiek/luatex.pdf

instead. Those two packages are currently incompatible, but Heiko and I plan to
merge them soon, we just didn't have the time for now. (IMO, we're likely to
adopt Heiko's mechanism.)

(By the way, can we hope to see it handled at the kernel level in a future l3
kernel?)

Manuel.

From wspr81 at gmail.com  Sun Jul 11 08:42:42 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Sun, 11 Jul 2010 16:12:42 +0930
Subject: [luatex] On category code tables
References: <4C38C316.6030409@morningstar2.co.uk>
	<AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>
	<4C38EB6D.4020002@elzevir.fr>
Message-ID: <i1bp52$1bj$1@dough.gmane.org>

On 2010-07-11 07:21:41 +0930, Manuel P?gouri?-Gonnard 
<mpg at elzevir.fr> said:

> Those two packages are currently incompatible, but Heiko and I plan to
> merge them soon, we just didn't have the time for now. (IMO, we're likely
>  to adopt Heiko's mechanism.)

Great.

> (By the way, can we hope to see it handled at the kernel level in a 
> future l3kernel?)

My personal opinion is that this should be handled by the lualatex.ini 
file, analogously to what happens with XeLaTeX's interchartoks class 
allocations.

But if not, and people start/continue to use the expl3 syntax for 
programming LuaLaTeX packages, then I think we could expect an l3luatex 
module for expl3 turn up eventually. While the lualatex packages 
provide the necessary features for now, however, I think it's sensible 
to call them the "supported" way to do things.

W



From joseph.wright at morningstar2.co.uk  Sun Jul 11 16:21:01 2010
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Sun, 11 Jul 2010 15:21:01 +0100
Subject: [luatex] On category code tables
In-Reply-To: <i1bp52$1bj$1@dough.gmane.org>
References: <4C38C316.6030409@morningstar2.co.uk>	<AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>	<4C38EB6D.4020002@elzevir.fr>
	<i1bp52$1bj$1@dough.gmane.org>
Message-ID: <4C39D34D.8040105@morningstar2.co.uk>

On 11/07/2010 07:42, Will Robertson wrote:
> On 2010-07-11 07:21:41 +0930, Manuel P?gouri?-Gonnard <mpg at elzevir.fr>
> said:
>
>> Those two packages are currently incompatible, but Heiko and I plan to
>> merge them soon, we just didn't have the time for now. (IMO, we're likely
>> to adopt Heiko's mechanism.)
>
> Great.
>
>> (By the way, can we hope to see it handled at the kernel level in a
>> future l3kernel?)
>
> My personal opinion is that this should be handled by the lualatex.ini
> file, analogously to what happens with XeLaTeX's interchartoks class
> allocations.

I'm with Will here as far as LaTeX2e goes: the current situation is 
sub-optimal as you can't be sure (as a package author) what might have 
happened before \usepackage{...}. Two different packages with 
incompatible approaches is also not good.

At a pure LaTeX3 level, things are different, and there should be a 
kernel-based mechanism. Expect one to appear in the SVN version of expl3 
over the next few days :-) (It will be Heiko's one reworked, I think.)

> But if not, and people start/continue to use the expl3 syntax for
> programming LuaLaTeX packages, then I think we could expect an l3luatex
> module for expl3 turn up eventually. While the lualatex packages provide
> the necessary features for now, however, I think it's sensible to call
> them the "supported" way to do things.

For l3in2e I'm all for simply requiring existing packages that do the 
job, as it keeps down the chance of clashes.
-- 
Joseph Wright

From mpg at elzevir.fr  Sun Jul 11 18:30:24 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 11 Jul 2010 18:30:24 +0200
Subject: [luatex] On category code tables
In-Reply-To: <4C39D34D.8040105@morningstar2.co.uk>
References: <4C38C316.6030409@morningstar2.co.uk>	<AANLkTimAXxS1aMe7e9Mogfbw3aeZiqoqv-mcGFuvhY5j@mail.gmail.com>	<4C38EB6D.4020002@elzevir.fr>	<i1bp52$1bj$1@dough.gmane.org>
	<4C39D34D.8040105@morningstar2.co.uk>
Message-ID: <4C39F1A0.3050401@elzevir.fr>

Le 11/07/2010 16:21, Joseph Wright a ?crit :
> At a pure LaTeX3 level, things are different, and there should be a 
> kernel-based mechanism. Expect one to appear in the SVN version of expl3 
> over the next few days :-) (It will be Heiko's one reworked, I think.)
> 
Great.

> For l3in2e I'm all for simply requiring existing packages that do the 
> job, as it keeps down the chance of clashes.

Sounds like the right thing to do.

Manuel.

From wspr81 at gmail.com  Tue Jul 13 08:25:29 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 13 Jul 2010 15:55:29 +0930
Subject: [luatex] Missing math primitive & assorted remarks
Message-ID: <i1h0sp$o7t$1@dough.gmane.org>

Hi,

I know this is a little late to be reporting the problem... I just 
realised that I missed documenting a maths primitive in xetexref, and 
LuaTeX is also missing it.

\XeTeXmathcharnumdef is the "logical" extension to \mathchar, which 
uses a single integer input to encode the fam/type/slot information. 
This primitive is used where legacy code would look like:

    \mathchardef\foo=\mathcode`\-  % (e.g., see amsmath)

I'm not stuck on any code that needs this feature (and I think that 
\omathchardef probably supports most uses anyway?) but the primitive 
should probably be included in some later version of LuaTeX.

* * *

I should probably just mention that the LuaTeX manual is a little 
unclear on the use of "num" variants of the primitives; they're 
intended for when the mathcode information needs to be passed around as 
in the example above; without the "num" primitives, you could query the 
single-integer mathcode information but you couldn't do anything useful 
with it.

(Not that you can do anything useful easily like break it apart to find 
out what fam your using for a math char, but I don't have any good 
ideas for how you'd approach doing that -- from a TeX programming 
perspective, anyway.)

* * *

While I'm on the topic, I've just discovered a small difference in the 
way XeTeX and LuaTeX handle the legacy "\mathcode" primitive when it is 
used to query the mathcode of a character. See attached example, 
compiled with both engines; the difference is that in LuaTeX, \mathcode 
behaves like \Umathcodenum always, whereas in XeTeX \mathcode retains 
its legacy behaviour.

I'm not sure if this causes any problems in practise (well, the reason 
I discovered it is that amsmath broke in LuaLaTeX but not XeLaTeX, but 
that code probably needs to be patched for unicode maths anyway) but I 
just wanted to mention it in case it's not intentional.

Thanks,
Will

\ifx\directlua\undefined
  \let \Umathcode\XeTeXmathcode
  \let \Umathcodenum\XeTeXmathcodenum
\else
  \input luaotfload.sty\relax
  \let \Umathcode\luatexUmathcode
  \let \Umathcodenum\luatexUmathcodenum
\fi

\def\mth{Cambria Math}
\font\4="\mth:script=math;color=FF0000" at 10pt
\textfont4=\4
\Umathcode `\( = "4 "4 "28

\showthe\mathcode`\(
\showthe\Umathcodenum`\(

$(x)$
\end



From taco at elvenkind.com  Tue Jul 13 09:02:29 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 13 Jul 2010 09:02:29 +0200
Subject: [luatex] Missing math primitive & assorted remarks
In-Reply-To: <i1h0sp$o7t$1@dough.gmane.org>
References: <i1h0sp$o7t$1@dough.gmane.org>
Message-ID: <4C3C0F85.7070306@elvenkind.com>


Hi Will,

On 07/13/2010 08:25 AM, Will Robertson wrote:
> Hi,
>
> I know this is a little late to be reporting the problem... I just
> realised that I missed documenting a maths primitive in xetexref, and
> LuaTeX is also missing it.

That happened precisely because the XeTeX documentation was missing.

> \XeTeXmathcharnumdef is the "logical" extension to \mathchar, which uses
> a single integer input to encode the fam/type/slot information. This
> primitive is used where legacy code would look like:
>
> \mathchardef\foo=\mathcode`\- % (e.g., see amsmath)
>
> I'm not stuck on any code that needs this feature (and I think that
> \omathchardef probably supports most uses anyway?) but the primitive
> should probably be included in some later version of LuaTeX.

Sure.

> I should probably just mention that the LuaTeX manual is a little
> unclear on the use of "num" variants of the primitives; they're intended
> for when the mathcode information needs to be passed around as in the
> example above; without the "num" primitives, you could query the
> single-integer mathcode information but you couldn't do anything useful
> with it.

I don't want to over-document the new 'num' variants because they are
ugly and the (\the) functionality they offer is in most cases better
achieved via \directlua.

> While I'm on the topic, I've just discovered a small difference in the
> way XeTeX and LuaTeX handle the legacy "\mathcode" primitive when it is
> used to query the mathcode of a character. See attached example,
> compiled with both engines; the difference is that in LuaTeX, \mathcode
> behaves like \Umathcodenum always, whereas in XeTeX \mathcode retains
> its legacy behaviour.

What does XeTeX do with \the\mathcode`\( when

   \Umathcode `\( = "4 "20 "1D400

or something?

Best wishes,
Taco

From wspr81 at gmail.com  Tue Jul 13 12:30:20 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Tue, 13 Jul 2010 20:00:20 +0930
Subject: [luatex] Missing math primitive & assorted remarks
In-Reply-To: <4C3C0F85.7070306@elvenkind.com>
References: <i1h0sp$o7t$1@dough.gmane.org> <4C3C0F85.7070306@elvenkind.com>
Message-ID: <BC9C7BFE-98D3-48E0-813A-33AACCA68279@gmail.com>

On 13/07/2010, at 4:32 PM, Taco Hoekwater wrote:

>> I know this is a little late to be reporting the problem... I just
>> realised that I missed documenting a maths primitive in xetexref, and
>> LuaTeX is also missing it.
> 
> That happened precisely because the XeTeX documentation was missing.

Yep, sorry about that; my fault.

> What does XeTeX do with \the\mathcode`\( when
> 
>  \Umathcode `\( = "4 "20 "1D400
> 
> or something?

\Umathcode `\( = "4 "4 "28
\showthe\mathcode`\(

-> 17448

\Umathcode `\( = "4 "20 "1D400
\showthe\mathcode`\(

-> ! Extended mathchar used as mathchar (545379328).


I don't know if this is necessarily behaviour that you'd like to replicate (you could also imagine using the legacy output for regular old mathchars and using the extended output for larger values). Like I said, I'm not aware of any direct problems this might cause; I simply wanted to let you know just in case.

Thanks,
-- Will



From ulrik.vieth at arcor.de  Tue Jul 13 14:25:34 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Tue, 13 Jul 2010 14:25:34 +0200 (CEST)
Subject: [luatex] Missing math primitive & assorted remarks
In-Reply-To: <BC9C7BFE-98D3-48E0-813A-33AACCA68279@gmail.com>
References: <BC9C7BFE-98D3-48E0-813A-33AACCA68279@gmail.com>
	<i1h0sp$o7t$1@dough.gmane.org> <4C3C0F85.7070306@elvenkind.com>
Message-ID: <18512499.1279023934186.JavaMail.ngmail@webmail11.arcor-online.net>

> I don't know if this is necessarily behaviour that you'd like to replicate
> (you could also imagine using the legacy output for regular old mathchars
> and using the extended output for larger values). Like I said, I'm not aware
> of any direct problems this might cause; I simply wanted to let you know
> just in case.
 
Sorry for jumping into this discussion, but there was another thing 
I noticed recently while testing LuaTeX vs. XeTeX.

In LuaTeX the \tracingall ouput (e.g. for assembling boxes) shows 
Unicode characters. These are sometimes not printable on some terminals 
(depending on screen fonts) and it may be difficult to determine exactly
which glyphs are used.

In XeTeX the \tracingall output shows something like glyph#3456,
but those numbers are not the Unicode characters, but seem to be
a technical index in the font file.

I wonder what would be the best way of showing which glyphs are used,
especially in the presence of substitions (e.g. prime -> prime.ssty).
You could display prime as U+2032 or ^^^^2032, but how would 
you display prime.ssty.  Would it be something like U+F0xxxx?

Just an idea.

Regards, Ulrik

From pragma at wxs.nl  Tue Jul 13 15:42:19 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 13 Jul 2010 15:42:19 +0200
Subject: [luatex] Missing math primitive & assorted remarks
In-Reply-To: <18512499.1279023934186.JavaMail.ngmail@webmail11.arcor-online.net>
References: <BC9C7BFE-98D3-48E0-813A-33AACCA68279@gmail.com>	<i1h0sp$o7t$1@dough.gmane.org>
	<4C3C0F85.7070306@elvenkind.com>
	<18512499.1279023934186.JavaMail.ngmail@webmail11.arcor-online.net>
Message-ID: <4C3C6D3B.5070300@wxs.nl>

On 13-7-2010 2:25, ulrik.vieth at arcor.de wrote:

> I wonder what would be the best way of showing which glyphs are used,
> especially in the presence of substitions (e.g. prime ->  prime.ssty).
> You could display prime as U+2032 or ^^^^2032, but how would
> you display prime.ssty.  Would it be something like U+F0xxxx?

it depends on the implementation, as one can map a character anywhere 
and U+F0XXXX is unlikely to be a glyph index and therefore of not much 
information; at the engine end the index is known ((part of the char 
data) so I can imagine mentioning both as option U+XXXXX [I+YYYY] or 
something like that

eventually all messages will be revisioned and then a macro package can 
add extra info

((

we can consider an intermediate resolver callback

callback.register("glyphinfo", function(f,c)
   -- f == font id, c = glyph number
   return "whatever you want injected"
end)

))

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Tue Jul 13 19:28:59 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 13 Jul 2010 20:28:59 +0300
Subject: [luatex] Querying Script and ScriptScriptPercentScaleDown math
	constants
Message-ID: <20100713172859.GA7380@khaled-laptop>

Is there a way to the values of ScriptPercentScaleDown and
ScriptScriptPercentScaleDown either from tex or from lua, other than
reading the MathConstants table directly?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Tue Jul 13 20:02:23 2010
From: taco at elvenkind.com (taco)
Date: Tue, 13 Jul 2010 20:02:23 +0200
Subject: [luatex] Querying Script and ScriptScriptPercentScaleDown math
 constants
In-Reply-To: <20100713172859.GA7380@khaled-laptop>
References: <20100713172859.GA7380@khaled-laptop>
Message-ID: <4C3CAA2F.5070703@elvenkind.com>

Khaled Hosny wrote:
> Is there a way to the values of ScriptPercentScaleDown and
> ScriptScriptPercentScaleDown either from tex or from lua, other than
> reading the MathConstants table directly?

Not reliably, because LuaTeX itself does not actually use
these parameters.

You can get them directly from font.fonts[] if you know
the right font id, but even then there is no guarantee
that they contain the right values as no checks are done
(and for example, in context mkiv, they are scaled
to the font's load size, just like the other math parameters).

Anyway, here is an iterative loop to demonstrate what
is available:

for i=1,100 do
   if font.fonts[i]
      and font.fonts[i].MathConstants
      and font.fonts[i].MathConstants.ScriptPercentScaleDown then
     texio.write_nl('Font '..i..':')
 
texio.write_nl('Script='..font.fonts[i].MathConstants.ScriptPercentScaleDown)
 
texio.write_nl('ScriptScript='..font.fonts[i].MathConstants.ScriptScriptPercentScaleDown)
   end
end;

Best wishes,
Taco


> Regards,
>  Khaled
> 


From khaledhosny at eglug.org  Tue Jul 13 20:08:15 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 13 Jul 2010 21:08:15 +0300
Subject: [luatex] Querying Script and ScriptScriptPercentScaleDown math
 constants
In-Reply-To: <4C3CAA2F.5070703@elvenkind.com>
References: <20100713172859.GA7380@khaled-laptop>
	<4C3CAA2F.5070703@elvenkind.com>
Message-ID: <20100713180815.GA7688@khaled-laptop>

On Tue, Jul 13, 2010 at 08:02:23PM +0200, taco wrote:
> Khaled Hosny wrote:
> >Is there a way to the values of ScriptPercentScaleDown and
> >ScriptScriptPercentScaleDown either from tex or from lua, other than
> >reading the MathConstants table directly?
> 
> Not reliably, because LuaTeX itself does not actually use
> these parameters.
> 
> You can get them directly from font.fonts[] if you know
> the right font id, but even then there is no guarantee
> that they contain the right values as no checks are done
> (and for example, in context mkiv, they are scaled
> to the font's load size, just like the other math parameters).

Yup, I know, that what I meant by "reading the MathConstants table
directly". I already did some basic check and I got the correct values
as I set in the font (luaotfload was scaling it to, but I now simply
don't scale any constant with "Percent" in its name).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Wed Jul 14 08:49:58 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 14 Jul 2010 16:19:58 +0930
Subject: [luatex] "Proper" use of \Udelimiterover &c
Message-ID: <i1jmmm$g2q$1@dough.gmane.org>

Hi,

Just checking that I'm using these primitives correctly.

Plain & LaTeX have some complex alignment definitions for \overbrace 
and friends; am I correct in thinking that \Udelimiterover are designed 
to replace all of that?

Khaled's minimal example is:

\input luaotfload.sty
\font\4={name:XITS Math:mode=base;script=math} at 10pt
\textfont4=\4

$$
  \Udelimiterover  "4 "23DE {a+b}
+ \Udelimiterunder "4 "23DF {a+b} = C
$$

But here the spacing is much too large between the delimiter and its 
contents. Am I supposed to be boxing up/smashing/whatever the argument 
myself?

If not, and it's just a matter of setting the delimitervgap 
appropriately, I'm curious why (philosophically) the 
\mathop{...}\limits construction is required:

\Umathoverdelimitervgap\displaystyle=-3pt % ?
$$
  \mathop{\Udelimiterover  "4 "23DE {a+b}}\limits^{d+e}
+ \Udelimiterunder "4 "23DF {a+b} = C
$$

Would it make sense to treat a \Udelimiterover construction as an 
operator with limits automatically? E.g., I expected

{\Udelimiterover  "4 "23DE {a+b}}^{d+e}

to do the "right thing", but looking at it this way perhaps it's 
impossible to do this with this construction of maths primitives? 
(Sorry I'm not entirely up to speed on the internals of the maths 
engine.)

Cheers,
Will



From taco at elvenkind.com  Wed Jul 14 09:23:51 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 14 Jul 2010 09:23:51 +0200
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <i1jmmm$g2q$1@dough.gmane.org>
References: <i1jmmm$g2q$1@dough.gmane.org>
Message-ID: <4C3D6607.5040403@elvenkind.com>


Hi,

On 07/14/2010 08:49 AM, Will Robertson wrote:
> Hi,
>
> Just checking that I'm using these primitives correctly.
>
> Plain & LaTeX have some complex alignment definitions for \overbrace and
> friends; am I correct in thinking that \Udelimiterover are designed to
> replace all of that?

Yes.

> Khaled's minimal example is:
>
> \input luaotfload.sty
> \font\4={name:XITS Math:mode=base;script=math} at 10pt
> \textfont4=\4
>
> $$
> \Udelimiterover "4 "23DE {a+b}
> + \Udelimiterunder "4 "23DF {a+b} = C
> $$
>
> But here the spacing is much too large between the delimiter and its
> contents. Am I supposed to be boxing up/smashing/whatever the argument
> myself?

No, you are doing it right. Whether *I* am doing it right is a
different question. Ulrik, can you try this overbrace stuff in
Word to see how it looks?

> If not, and it's just a matter of setting the delimitervgap
> appropriately, I'm curious why (philosophically) the \mathop{...}\limits
> construction is required:

> \Umathoverdelimitervgap\displaystyle=-3pt % ?
> $$
> \mathop{\Udelimiterover "4 "23DE {a+b}}\limits^{d+e}
> + \Udelimiterunder "4 "23DF {a+b} = C
> $$
>
> Would it make sense to treat a \Udelimiterover construction as an
> operator with limits automatically? E.g., I expected
>
> {\Udelimiterover "4 "23DE {a+b}}^{d+e}
>
> to do the "right thing", but looking at it this way perhaps it's
> impossible to do this with this construction of maths primitives? (Sorry
> I'm not entirely up to speed on the internals of the maths engine.)

When I implemented this, I did not realise that this would make sense.
Is such a construct as this *always* a large operator?

Best wishes,
Taco

From wspr81 at gmail.com  Wed Jul 14 09:34:09 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 14 Jul 2010 17:04:09 +0930
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <4C3D6607.5040403@elvenkind.com>
References: <i1jmmm$g2q$1@dough.gmane.org> <4C3D6607.5040403@elvenkind.com>
Message-ID: <2864F09E-8AD2-4EFD-86A6-C023C9B18E6A@gmail.com>

Hi Taco,

Thanks for the quick reply.

On 14/07/2010, at 4:53 PM, Taco Hoekwater wrote:

>> Would it make sense to treat a \Udelimiterover construction as an
>> operator with limits automatically? E.g., I expected
>> 
>> {\Udelimiterover "4 "23DE {a+b}}^{d+e}
>> 
>> to do the "right thing", but looking at it this way perhaps it's
>> impossible to do this with this construction of maths primitives? (Sorry
>> I'm not entirely up to speed on the internals of the maths engine.)
> 
> When I implemented this, I did not realise that this would make sense.
> Is such a construct as this *always* a large operator?

Well, the idea is that you either use the overbrace "naked" and it doesn't matter about the operator stuff, or you give it an attached piece of math as in this example.

So the Plain definition of \overbrace is

\mathop{\vbox{[...snip!...]}}\limits

so that you can place material directly on top.

As for your question, I think the answer is, therefore, "yes".

-- Will



From ulrik.vieth at arcor.de  Wed Jul 14 12:13:50 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Wed, 14 Jul 2010 12:13:50 +0200 (CEST)
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <4C3D6607.5040403@elvenkind.com>
References: <4C3D6607.5040403@elvenkind.com> <i1jmmm$g2q$1@dough.gmane.org>
Message-ID: <456904322.120081279102430840.JavaMail.ngmail@webmail07.arcor-online.net>

> Ulrik, can you try this overbrace stuff in Word to see how it looks?

Enclosed is a PDF from Word 2007 using CambriaMath.

In Word, the overbrace stuff is hidden in the accents palette.
You can choose between a simple overbrace or and overbrace 
with an extra group (which TeX typesets as \mathop\limits).

Hope this helps to clarify your issues.

Regards, Ulrik

P.S: The attached docx file is the word2007 file, which is actually 
a zip file containing an xml. I haven't checked if the xml provides
any clues how the stuff is code in a mathml-like notation.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: math-brace.docx
Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document
Size: 10610 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100714/a293074f/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: math-brace.pdf
Type: application/pdf
Size: 10760 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100714/a293074f/attachment-0001.pdf>

From mpg at elzevir.fr  Wed Jul 14 12:39:24 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 14 Jul 2010 12:39:24 +0200
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <2864F09E-8AD2-4EFD-86A6-C023C9B18E6A@gmail.com>
References: <i1jmmm$g2q$1@dough.gmane.org> <4C3D6607.5040403@elvenkind.com>
	<2864F09E-8AD2-4EFD-86A6-C023C9B18E6A@gmail.com>
Message-ID: <4C3D93DC.6040902@elzevir.fr>

Hi Taco, hi Will,

Le 14/07/2010 09:34, Will Robertson a ?crit :
> On 14/07/2010, at 4:53 PM, Taco Hoekwater wrote:
>> When I implemented this, I did not realise that this would make sense.
>> Is such a construct as this *always* a large operator?
> 
> Well, the idea is that you either use the overbrace "naked" and it doesn't
> matter about the operator stuff, or you give it an attached piece of math as
> in this example.
> 
> So the Plain definition of \overbrace is
> 
> \mathop{\vbox{[...snip!...]}}\limits
> 
> so that you can place material directly on top.
> 
> As for your question, I think the answer is, therefore, "yes".
> 
I'm not sure I agree. Your argument about Plain's definition of \overbrace is
very convincing, but does it cover all uses of \Udelimiterover? Or are macros
such as \overrightarrow or "generalized \widehat" likely to be reimplemented
using \Udelimiterover too?

If the answer to the second question is yes, then I think it would be safer to
leave things as they are and continue to handle the \mathop{...}\limits part at
the macro level when it is needed (the new primitive would "only" replace the
\ialign{...} part in the current definition of \overbrace IIUC).

Manuel.



From taco at elvenkind.com  Wed Jul 14 13:03:55 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 14 Jul 2010 13:03:55 +0200
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <456904322.120081279102430840.JavaMail.ngmail@webmail07.arcor-online.net>
References: <4C3D6607.5040403@elvenkind.com> <i1jmmm$g2q$1@dough.gmane.org>
	<456904322.120081279102430840.JavaMail.ngmail@webmail07.arcor-online.net>
Message-ID: <4C3D999B.7060905@elvenkind.com>

On 07/14/2010 12:13 PM, ulrik.vieth at arcor.de wrote:
>> Ulrik, can you try this overbrace stuff in Word to see how it looks?
>
> Enclosed is a PDF from Word 2007 using CambriaMath.
>
> In Word, the overbrace stuff is hidden in the accents palette.
> You can choose between a simple overbrace or and overbrace
> with an extra group (which TeX typesets as \mathop\limits).
>
> Hope this helps to clarify your issues.

Thanks. It sure looks like I am misinterpreting something in
the luatex implementation.

Best wishes,
Taco

From wspr81 at gmail.com  Wed Jul 14 13:10:09 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 14 Jul 2010 20:40:09 +0930
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <4C3D93DC.6040902@elzevir.fr>
References: <i1jmmm$g2q$1@dough.gmane.org> <4C3D6607.5040403@elvenkind.com>
	<2864F09E-8AD2-4EFD-86A6-C023C9B18E6A@gmail.com>
	<4C3D93DC.6040902@elzevir.fr>
Message-ID: <E80431EC-E93A-415A-8672-39A23B03366E@gmail.com>

On 14/07/2010, at 8:09 PM, Manuel P?gouri?-Gonnard wrote:

> I'm not sure I agree. Your argument about Plain's definition of \overbrace is
> very convincing, but does it cover all uses of \Udelimiterover? Or are macros
> such as \overrightarrow or "generalized \widehat" likely to be reimplemented
> using \Udelimiterover too?

I don't *think* so, but I'm not 100% confident. \widehat falls under the usual \mathaccent, and wouldn't \overrightarrow behave the same as \overbrace?

I guess I need to look into implementing all of the LuaLaTeX math extras before I comment further, though.

> If the answer to the second question is yes, then I think it would be safer to
> leave things as they are and continue to handle the \mathop{...}\limits part at
> the macro level when it is needed (the new primitive would "only" replace the
> \ialign{...} part in the current definition of \overbrace IIUC).

Good argument, though. Certainly wise to sit for now.

-- Will



From mpg at elzevir.fr  Wed Jul 14 13:30:55 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Wed, 14 Jul 2010 13:30:55 +0200
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <E80431EC-E93A-415A-8672-39A23B03366E@gmail.com>
References: <i1jmmm$g2q$1@dough.gmane.org>
	<4C3D6607.5040403@elvenkind.com>	<2864F09E-8AD2-4EFD-86A6-C023C9B18E6A@gmail.com>	<4C3D93DC.6040902@elzevir.fr>
	<E80431EC-E93A-415A-8672-39A23B03366E@gmail.com>
Message-ID: <4C3D9FEF.2030307@elzevir.fr>

Le 14/07/2010 13:10, Will Robertson a ?crit :
> On 14/07/2010, at 8:09 PM, Manuel P?gouri?-Gonnard wrote:
> 
>> I'm not sure I agree. Your argument about Plain's definition of \overbrace is
>> very convincing, but does it cover all uses of \Udelimiterover? Or are macros
>> such as \overrightarrow or "generalized \widehat" likely to be reimplemented
>> using \Udelimiterover too?
> 
> I don't *think* so, but I'm not 100% confident. \widehat falls under the
> usual \mathaccent, and wouldn't \overrightarrow behave the same as
> \overbrace?
> 
There is no \mathop in the definition of \overrightarrow in plain.tex, unlike
\overbrace. (But you're obviously right for \widehat.)

Manuel.

From buliabyak at gmail.com  Thu Jul 15 01:56:04 2010
From: buliabyak at gmail.com (bulia byak)
Date: Wed, 14 Jul 2010 20:56:04 -0300
Subject: [luatex] do pdftex extensions work?
Message-ID: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>

Hi all,

I have a LaTeX document using various pdftex extensions. From what I
could gather in the manual, they should work with luatex. I used
beta-0.60.2-2010070511 thus:

$ luatex -ini latex.ini  (worked fine after I commented out some
hyphen files that are not in Unicode)

$ luatex --fmt=latex lw.tex

...

! Undefined control sequence.
l.16 \pdfmapfile
                {myfonts.map}
?

...

! Undefined control sequence.
l.34 \pdfadjustspacing
                      =2
?
! Undefined control sequence.
l.35 \pdfprotrudechars
                      =2
?
! Undefined control sequence.
l.58 \rpcode
            \Gentium`\y=30
?

What am I missing?

Thanks!

-- 
bulia byak
Inkscape. Draw Freely.
http://www.inkscape.org

From buliabyak at gmail.com  Thu Jul 15 03:05:36 2010
From: buliabyak at gmail.com (bulia byak)
Date: Wed, 14 Jul 2010 22:05:36 -0300
Subject: [luatex] do pdftex extensions work?
In-Reply-To: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>
References: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>
Message-ID: <AANLkTinHRs_GY4K3zQ69Hwh_4m3TANRdrXM9n5iqvh2u@mail.gmail.com>

Answering my own question: this worked after I inserted

\directlua { tex.enableprimitives('',tex.extraprimitives()) }

in the format file latex.ltx. Or, inserting it into the tex file
worked just as well. Sorry for the noise.


-- 
bulia byak
Inkscape. Draw Freely.
http://www.inkscape.org

From khaledhosny at eglug.org  Thu Jul 15 06:31:55 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 07:31:55 +0300
Subject: [luatex] Misplaced dot and ddot math accents with Cambria
Message-ID: <20100715043155.GA3020@khaled-laptop>

The accents are shifted to the left in Cambria, no problem with XITS:

 \input luaotfload.sty
 \font\test={name:Cambria Math:mode=base;script=math} at 10pt
%\font\test={name:XITS Math:mode=base;script=math} at 10pt
 \textfont0=\test
 
 $\Umathaccent "0"0"0307 {\Umathchar "0"0"1D434}$
 $\Umathaccent "0"0"0308 {\Umathchar "0"0"1D434}$
 \bye

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From preining at logic.at  Thu Jul 15 07:57:31 2010
From: preining at logic.at (Norbert Preining)
Date: Thu, 15 Jul 2010 14:57:31 +0900
Subject: [luatex] do pdftex extensions work?
In-Reply-To: <AANLkTinHRs_GY4K3zQ69Hwh_4m3TANRdrXM9n5iqvh2u@mail.gmail.com>
References: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>
	<AANLkTinHRs_GY4K3zQ69Hwh_4m3TANRdrXM9n5iqvh2u@mail.gmail.com>
Message-ID: <20100715055731.GK7087@gamma.logic.tuwien.ac.at>

On Mi, 14 Jul 2010, bulia byak wrote:
> Answering my own question: this worked after I inserted
> 
> \directlua { tex.enableprimitives('',tex.extraprimitives()) }
> 
> in the format file latex.ltx. Or, inserting it into the tex file
> worked just as well. Sorry for the noise.

Taking a look into how TeX Live 2010 pretest is doing that would have
helped you ... ;-) as we are shipping all the respective formats
by default.

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
Your file was so big.
It might be very useful.
But now it is gone.
                       --- Windows Error Haiku

From khaledhosny at eglug.org  Thu Jul 15 08:12:31 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 09:12:31 +0300
Subject: [luatex] Delimiters don't grow with \overwithdelims
Message-ID: <20100715061231.GA3993@khaled-laptop>

The parenthesis don't grow in this example:

 \input luaotfload.sty
 \font\test={name:XITS Math:mode=base;script=math} at 10pt
%\font\test="[xits-math.otf]:script=math" at 10pt % for xetex
 \textfont0=\test
 
 $$ a \overwithdelims() b $$
 \bye

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Thu Jul 15 08:26:18 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 15 Jul 2010 15:56:18 +0930
Subject: [luatex] Correct use of \overwithdelims?
Message-ID: <i1m9m9$q1h$1@dough.gmane.org>

Hi,

We're in territory in which I'm a little unfamiliar, so please excuse 
the questions. What is the correct way to use \overwithdelims with 
LuaTeX?

In Plain and XeTeX, the brackets enlarge satisfactorily (see attached 
example), based on (so I read) fontdimens 20 & 21. In LuaTeX with both 
Cambria and XITS, the brackets remain small.

Am I doing it wrong?

Will



\ifx\directlua\undefined
  \ifx\XeTeXversion\undefined\else
    \font\test="Cambria Math:script=math" at 10pt
    \textfont0=\test
  \fi
\else
  \input luaotfload.sty
  \font\test={name:Cambria Math:mode=base;script=math} at 10pt
  \textfont0=\test
\fi

\def\1{{\displaystyle x\over \displaystyle y}}
\def\2{{\displaystyle a\over \displaystyle b}}
\def\3{{\1\over\2}}

$$
\left( {x\over y} \right)
\left( \1\over\2 \right)
\left( \3\over\3 \right)
$$
$$
{x\overwithdelims() y}
{\1 \overwithdelims() \2}
{\3 \overwithdelims() \3}
$$

\bye



From khaledhosny at eglug.org  Thu Jul 15 08:54:56 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 09:54:56 +0300
Subject: [luatex] Correct use of \overwithdelims?
In-Reply-To: <i1m9m9$q1h$1@dough.gmane.org>
References: <i1m9m9$q1h$1@dough.gmane.org>
Message-ID: <20100715065456.GA4290@khaled-laptop>

On Thu, Jul 15, 2010 at 03:56:18PM +0930, Will Robertson wrote:
> Hi,
> 
> We're in territory in which I'm a little unfamiliar, so please
> excuse the questions. What is the correct way to use \overwithdelims
> with LuaTeX?
> 
> In Plain and XeTeX, the brackets enlarge satisfactorily (see
> attached example), based on (so I read) fontdimens 20 & 21. In
> LuaTeX with both Cambria and XITS, the brackets remain small.

>From the TeXBook, p. 152:

The size of the surrounding delimiters depends only on the style, not on
the size of the fractions; larger delimiters are used in styles D and D
(see Appendix G). 

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Thu Jul 15 09:17:24 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 15 Jul 2010 16:47:24 +0930
Subject: [luatex] Delimiters don't grow with \overwithdelims
References: <20100715061231.GA3993@khaled-laptop>
Message-ID: <i1mcm3$3k1$1@dough.gmane.org>

On 2010-07-15 15:42:31 +0930, Khaled Hosny 
<khaledhosny at eglug.org> said:

> The parenthesis don't grow in this example:
> 
>  \input luaotfload.sty
>  \font\test={name:XITS Math:mode=base;script=math} at 10pt
> %\font\test="[xits-math.otf]:script=math" at 10pt % for xetex
>  \textfont0=\test
> 
>  $$ a \overwithdelims() b $$
>  \bye

Looks like we're trying to debug the same thing :)

W



From ulrik.vieth at arcor.de  Thu Jul 15 09:59:36 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Thu, 15 Jul 2010 09:59:36 +0200 (CEST)
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <20100715061231.GA3993@khaled-laptop>
References: <20100715061231.GA3993@khaled-laptop>
Message-ID: <2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>

Now that you mention it, I recall that \overwithdelims had some 
problems mapping OpenType parameters to TeX parameters.

See the section about DelimitedSubFormulaMinHeight in my paper 
about OpenType font dimensions:

https://www.tug.org/members/TUGboat/tb30-1/tb94vieth.pdf
http://www.ntg.nl/maps/38/03.pdf

My connclusion was the following:

In the absence of a better solution, it may be best to simply 
avoid using \atopwithdelims with OpenType math fonts 
in the new TEX engines and to redefine userlevel macros 
(such as \choose) in terms of \left and \right delimiters.

Regards, Ulrik


----- Original Nachricht ----
Von:     Khaled Hosny <khaledhosny at eglug.org>
An:      "General discussion of LuaTeX." <luatex at tug.org>
Datum:   15.07.2010 08:12
Betreff: [luatex] Delimiters don't grow with \overwithdelims

> The parenthesis don't grow in this example:
> 
>  \input luaotfload.sty
>  \font\test={name:XITS Math:mode=base;script=math} at 10pt
> %\font\test="[xits-math.otf]:script=math" at 10pt % for xetex
>  \textfont0=\test
>  
>  $$ a \overwithdelims() b $$
>  \bye
> 
> -- 
>  Khaled Hosny
>  Arabic localiser and member of Arabeyes.org team
>  Free font developer
> 

From taco at elvenkind.com  Thu Jul 15 12:16:46 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jul 2010 12:16:46 +0200
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>
References: <20100715061231.GA3993@khaled-laptop>
	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>
Message-ID: <4C3EE00E.3090802@elvenkind.com>


Hi,

ulrik.vieth at arcor.de wrote:
> Now that you mention it, I recall that \overwithdelims had some 
> problems mapping OpenType parameters to TeX parameters.

Yes. For this reason, LuaTeX supports two extra keys in MathConstants
that do not exist in the MicroSoft documentation of MATH. They are

  FractionDelimiterDisplaySize
  FractionDelimiterSize

Best wishes,
Taco

From taco at elvenkind.com  Thu Jul 15 13:05:00 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jul 2010 13:05:00 +0200
Subject: [luatex] do pdftex extensions work?
In-Reply-To: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>
References: <AANLkTikTPwsYuNVL4KCGl8oDy1S9HHPJAGFKNTI6MSzF@mail.gmail.com>
Message-ID: <4C3EEB5C.6040100@elvenkind.com>

Hi,


bulia byak wrote:
> Hi all,
> 
> I have a LaTeX document using various pdftex extensions. From what I 
> could gather in the manual, they should work with luatex. I used 
> beta-0.60.2-2010070511 thus:
> 
> 
> What am I missing?

Straight from the reference manual:

>From day one, LuaTEX has offered extra functionality when compared to
the superset of pdfTEX and Aleph. That has not been limited to the
possibility to execute lua code via \directlua, but LuaTEX
also adds functionality via new TEX-side primitives.

However, starting with beta 0.39.0, most of that functionality is hidden
by default. When LuaTEX 0.40.0 starts up in `iniluatex' mode (luatex
-ini), it defines only the primitive commands known by TEX82 and the one
extra command \directlua.

As is fitting, a lua function has to be called to add the extra
primitives to the user environment. The simplest method to get access to
all of the new primitive commands is by adding this line to the format
generation file:

\directlua { tex.enableprimitives('',tex.extraprimitives()) }

But be aware, that the curly braces may not have the proper \catcode
assigned to them at this early time (giving a 'Missing number' error),
so it may be needed to put these assignments

\catcode `\{=1
\catcode `\}=2

before the above line. More fine-grained primitives control is possible,
you can look the details in section 4.12.11. For simplicity's sake, this
manual assumes that you have executed the \directlua command as given above.


Best wishes,
Taco

From khaledhosny at eglug.org  Thu Jul 15 14:10:12 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 15:10:12 +0300
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <4C3EE00E.3090802@elvenkind.com>
References: <20100715061231.GA3993@khaled-laptop>
	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>
	<4C3EE00E.3090802@elvenkind.com>
Message-ID: <20100715121012.GC1979@khaled-laptop>

On Thu, Jul 15, 2010 at 12:16:46PM +0200, Taco Hoekwater wrote:
> 
> Hi,
> 
> ulrik.vieth at arcor.de wrote:
> > Now that you mention it, I recall that \overwithdelims had some 
> > problems mapping OpenType parameters to TeX parameters.
> 
> Yes. For this reason, LuaTeX supports two extra keys in MathConstants
> that do not exist in the MicroSoft documentation of MATH. They are
> 
>   FractionDelimiterDisplaySize
>   FractionDelimiterSize

So, should luaotfload fill in those two constants? (I note that
\overwithdelims does not work with ConTeXt too.

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Thu Jul 15 14:55:00 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jul 2010 14:55:00 +0200
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <20100715121012.GC1979@khaled-laptop>
References: <20100715061231.GA3993@khaled-laptop>	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>	<4C3EE00E.3090802@elvenkind.com>
	<20100715121012.GC1979@khaled-laptop>
Message-ID: <4C3F0524.10506@elvenkind.com>



Khaled Hosny wrote:
> On Thu, Jul 15, 2010 at 12:16:46PM +0200, Taco Hoekwater wrote:
>> Hi,
>>
>> ulrik.vieth at arcor.de wrote:
>>> Now that you mention it, I recall that \overwithdelims had some 
>>> problems mapping OpenType parameters to TeX parameters.
>> Yes. For this reason, LuaTeX supports two extra keys in MathConstants
>> that do not exist in the MicroSoft documentation of MATH. They are
>>
>>   FractionDelimiterDisplaySize
>>   FractionDelimiterSize
> 
> So, should luaotfload fill in those two constants? 

Yes.
(cm uses values of 239% and 101% of the font design size)

Best wishes,
Taco



From khaledhosny at eglug.org  Thu Jul 15 15:11:07 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 16:11:07 +0300
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <4C3F0524.10506@elvenkind.com>
References: <20100715061231.GA3993@khaled-laptop>
	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>
	<4C3EE00E.3090802@elvenkind.com>
	<20100715121012.GC1979@khaled-laptop>
	<4C3F0524.10506@elvenkind.com>
Message-ID: <20100715131107.GA2393@khaled-laptop>

On Thu, Jul 15, 2010 at 02:55:00PM +0200, Taco Hoekwater wrote:
> 
> 
> Khaled Hosny wrote:
> > On Thu, Jul 15, 2010 at 12:16:46PM +0200, Taco Hoekwater wrote:
> >> Hi,
> >>
> >> ulrik.vieth at arcor.de wrote:
> >>> Now that you mention it, I recall that \overwithdelims had some 
> >>> problems mapping OpenType parameters to TeX parameters.
> >> Yes. For this reason, LuaTeX supports two extra keys in MathConstants
> >> that do not exist in the MicroSoft documentation of MATH. They are
> >>
> >>   FractionDelimiterDisplaySize
> >>   FractionDelimiterSize
> > 
> > So, should luaotfload fill in those two constants? 
> 
> Yes.
> (cm uses values of 239% and 101% of the font design size)

With the following luaotfload.lua file (replacing the one in texlive), I
get a PANIC:

PANIC: unprotected error in call to Lua API (bad argument #-2 (invalid
option 'FractionDelimiterDisplaySize'))

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Thu Jul 15 15:36:27 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 15 Jul 2010 15:36:27 +0200
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <20100715131107.GA2393@khaled-laptop>
References: <20100715061231.GA3993@khaled-laptop>	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>	<4C3EE00E.3090802@elvenkind.com>	<20100715121012.GC1979@khaled-laptop>	<4C3F0524.10506@elvenkind.com>
	<20100715131107.GA2393@khaled-laptop>
Message-ID: <4C3F0EDB.1020908@elvenkind.com>



Khaled Hosny wrote:
> 
> PANIC: unprotected error in call to Lua API (bad argument #-2 (invalid
> option 'FractionDelimiterDisplaySize'))

Oops, sorry, a bug in the manual (that I c&p-ed). It should be

  FractionDelimiterDisplayStyleSize.
                          ^^^^^

Best wishes,
Taco

From khaledhosny at eglug.org  Thu Jul 15 16:00:22 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 15 Jul 2010 17:00:22 +0300
Subject: [luatex] Delimiters don't grow with \overwithdelims
In-Reply-To: <4C3F0EDB.1020908@elvenkind.com>
References: <20100715061231.GA3993@khaled-laptop>
	<2144627.1279180776922.JavaMail.ngmail@webmail13.arcor-online.net>
	<4C3EE00E.3090802@elvenkind.com>
	<20100715121012.GC1979@khaled-laptop>
	<4C3F0524.10506@elvenkind.com>
	<20100715131107.GA2393@khaled-laptop>
	<4C3F0EDB.1020908@elvenkind.com>
Message-ID: <20100715140022.GA4995@khaled-laptop>

On Thu, Jul 15, 2010 at 03:36:27PM +0200, Taco Hoekwater wrote:
> 
> 
> Khaled Hosny wrote:
> > 
> > PANIC: unprotected error in call to Lua API (bad argument #-2 (invalid
> > option 'FractionDelimiterDisplaySize'))
> 
> Oops, sorry, a bug in the manual (that I c&p-ed). It should be
> 
>   FractionDelimiterDisplayStyleSize.
>                           ^^^^^
> 

Great, the withdelims issue is now fixed.

I think, at some point of time, we should convince George Williams to
support the extra constants in FontForge, or even better talk with MS
people to include them in the yet-to-be-official spec.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mfisher_ix at maine.rr.com  Sat Jul 17 00:56:03 2010
From: mfisher_ix at maine.rr.com (Matthew J. Fisher)
Date: Fri, 16 Jul 2010 18:56:03 -0400
Subject: [luatex] Where to put luatex-fonts-names.lua?
Message-ID: <1279320963.7448.32.camel@gns>

I'm having trouble with the luatex-test.tex file from TeX Live 2010:

$ luatex luatex-test.tex
This is LuaTeX, Version beta-0.60.2-2010071217 (TeX Live 2010) (rev
3736) 
 restricted \write18 enabled.
(/usr/local/texlive/2010/texmf-dist/tex/generic/context/luatex-test.tex
! Font \testa=file:lmroman10-regular at 12pt not loadable: metric data
not found or bad.

Prior to this, I had done a clean install of TeX Live 2010 in my i386
Linux system, and appended TeX Live 2010's bin path to the PATH variable
in /etc/profile. Then:

$ cd /usr/local/texlive/2010/texmf-dist/tex/generic/context
?$ cp luatex-plain.fmt /usr/local/texlive/texmf-local/web2c/luatex/
$ sudo luatex --ini luatex-plain.tex
$ sudo luatools --generate
$ sudo mxtrun --script font --names

As expected, that last step generated the luatex-fonts-names.lua script,
which does contain an entry for ?lmroman10-regular.otf:

return {
 ["mappings"]={
 ....
 ["lmroman10regular"]={ "LMRoman10-Regular", "lmroman10-regular.otf" },
 .... 

Hans Hagen's presentation from TUG 2009 [1] indicates that the
luatex-fonts-names.lua script must be placed where LuaTex can find it. I
thought perhaps one of the paths suggested by kpsewhich might work
(kpsewichi --show-path=lua). But alas, no.

Thanks in advance for any assistance.

 - Matt Fisher

[1] http://luatex.org/talks/print-plain-tug-2009.pdf


From jason.t.stein at gmail.com  Fri Jul 23 19:05:03 2010
From: jason.t.stein at gmail.com (Jason Stein)
Date: Fri, 23 Jul 2010 11:05:03 -0600
Subject: [luatex] =?iso-8859-7?q?Strange_=D9_character_when_using_LuaTeX?=
Message-ID: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>

I am a high school education and intermediate LaTeX user, and was intrigued
with the possibility of using LuaTeX to help me create calendars. I
successfully got my algorithm to work (it is attached), but for some reason
I get an ? character around my tikZ figures. I am using LuaTeX, Version
beta-0.40.6-2009100310 (TeX Live 2009). Any thoughts?

Jason T. Stein, B. Sc. (1998), B. Ed. (2002)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: daybook.lua
Type: application/octet-stream
Size: 1993 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0004.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex_daybook.log
Type: application/octet-stream
Size: 27040 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0005.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex_daybook.pdf
Type: application/pdf
Size: 213644 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0001.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luatex_daybook.tex
Type: application/x-tex
Size: 4053 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0001.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2010_2011_day_cycle.csv
Type: application/octet-stream
Size: 951 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0006.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2010_2011_semester_1_jason_stein.csv
Type: application/octet-stream
Size: 650 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100723/eb6e43c9/attachment-0007.obj>

From luigi.scarso at gmail.com  Fri Jul 23 19:26:17 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 23 Jul 2010 19:26:17 +0200
Subject: [luatex] =?utf-8?q?Strange_=CE=A9_character_when_using_LuaTeX?=
In-Reply-To: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>
References: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>
Message-ID: <AANLkTimmb9jsbdcjdMckhfmuQma+KxRDvf-Ve97nXjG0@mail.gmail.com>

2010/7/23 Jason Stein <jason.t.stein at gmail.com>:
> I am a high school education and intermediate LaTeX user, and was intrigued
> with the possibility of using LuaTeX to help me create calendars. I
> successfully got my algorithm to work (it is attached), but for some reason
> I get an ? character around my tikZ figures. I am using?LuaTeX, Version
> beta-0.40.6-2009100310 (TeX Live 2009). Any thoughts?
> Jason T. Stein, B. Sc. (1998), B. Ed. (2002)
>
version beta-0.40.6-2009100310
is really too old

-- 
luigi


From khaledhosny at eglug.org  Fri Jul 23 19:53:57 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 23 Jul 2010 20:53:57 +0300
Subject: [luatex] =?utf-8?q?Strange_=CE=A9_character_when_using_LuaTeX?=
In-Reply-To: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>
References: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>
Message-ID: <20100723175357.GA6825@khaled-laptop>

On Fri, Jul 23, 2010 at 11:05:03AM -0600, Jason Stein wrote:
> I am a high school education and intermediate LaTeX user, and was intrigued
> with the possibility of using LuaTeX to help me create calendars. I
> successfully got my algorithm to work (it is attached), but for some reason I
> get an ? character around my tikZ figures. I am using?LuaTeX, Version
> beta-0.40.6-2009100310 (TeX Live 2009). Any thoughts?
> 
> Jason T. Stein, B. Sc. (1998), B. Ed. (2002)

First, don't use luainputenc in new documents (luatex is utf-8 by
default, so it doesn't make sense anyway). Second, use locals in your
lua code to avoid conflicts (running your code with texlive-2010, your
"file" clashes with lualibs "file" modules causing luaotfload errors), it
is always good practice to limit the scope of your variables.

Tat being said, I get the omegas too (IIRC this is omega/luatex default
unknown character or something).

Regards,
 khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Fri Jul 23 20:29:30 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 23 Jul 2010 21:29:30 +0300
Subject: [luatex] =?utf-8?q?Strange_=CE=A9_character_when_using_LuaTeX?=
In-Reply-To: <20100723175357.GA6825@khaled-laptop>
References: <AANLkTin9-BRDdbV9xvwoJDYPOmgdaOh0=yrXa-eTLNor@mail.gmail.com>
	<20100723175357.GA6825@khaled-laptop>
Message-ID: <20100723182833.GA7223@khaled-laptop>

On Fri, Jul 23, 2010 at 08:53:57PM +0300, Khaled Hosny wrote:
> On Fri, Jul 23, 2010 at 11:05:03AM -0600, Jason Stein wrote:
> > I am a high school education and intermediate LaTeX user, and was intrigued
> > with the possibility of using LuaTeX to help me create calendars. I
> > successfully got my algorithm to work (it is attached), but for some reason I
> > get an ? character around my tikZ figures. I am using?LuaTeX, Version
> > beta-0.40.6-2009100310 (TeX Live 2009). Any thoughts?
> > 
> > Jason T. Stein, B. Sc. (1998), B. Ed. (2002)
> 
> First, don't use luainputenc in new documents (luatex is utf-8 by
> default, so it doesn't make sense anyway). Second, use locals in your
> lua code to avoid conflicts (running your code with texlive-2010, your
> "file" clashes with lualibs "file" modules causing luaotfload errors), it
> is always good practice to limit the scope of your variables.
> 
> Tat being said, I get the omegas too (IIRC this is omega/luatex default
> unknown character or something).

Actually, I think it has something to do with the new line char "\n", I
don't recall exactly, but the "\n" when passed from lua is not seen as a
new line char at tex end. Removing te two occurrences of "\n" in your
code will git ride of the omegas. If you want to pass new lines to tex,
why not doing tex.print() in the substrings directly instead of
concatenating every thing first.

Regards,
 khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mfisher_ix at maine.rr.com  Sat Jul 24 00:33:30 2010
From: mfisher_ix at maine.rr.com (Matthew J. Fisher)
Date: Fri, 23 Jul 2010 18:33:30 -0400
Subject: [luatex] Where to put luatex-fonts-names.lua?
In-Reply-To: <1279320963.7448.32.camel@gns>
References: <1279320963.7448.32.camel@gns>
Message-ID: <1279924410.5835.4.camel@gns>

> $ luatex luatex-test.tex

I should have read the fine manual. This should have been:

$ luatex --fmt=luatex-plain.fmt luatex-test.tex


From zappathustra at free.fr  Sat Jul 24 09:28:41 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 24 Jul 2010 09:28:41 +0200
Subject: [luatex] \pdfstartlink ... isn't really a link.
Message-ID: <1279956521.4c4a962971066@imp.free.fr>

Hello all,

This message addresses the pdfTeX kernel, but since LuaTeX is the pdfTeX's
future, I think it fits here.

I've just discovered that \pdfstartlink ... \pdfendlink doesn't create a link
when <action spec> is "user" instead of "goto". It simply creates an annotation,
whose /Subtype must be set to /Link (or anything else) in either "attr" or
"user". That's apparently a known fact since Heiko Oberdiek has written on the
pdfTeX list that "`user' must set /Subtype and /A"
(http://tug.org/mailman/htdig/pdftex/2008-August/007789.html).

However it is pretty confusing, all the more as the pdfTeX manual doesn't
mention it, quite the contrary: it says that <user action> is the action
performed when the _link_ is activated.

While that's no big deal once you know it (any insight on the historical reason
why?), it remains incoherent and umotivated (as far as I can see, at least). So,
for the sake of coherency & clarity of the future, wouldn't it be better to have
\pdfstartlink create a link no matter what, and perhaps another primitive
\pdfstartannot ... \pdfendannot that would do the same thing as \pdfstartlink
but without a /Subtype?

As for compatibility, code written up to know with such things as \pdfstartlink
user {/Subtype /Whatever ... } ... will produce an annotation with Subtype set
twice (once to /Link and once to /Whatever), but I've checked and Acrobat at
least doesn't mind, even if the two subtypes differ, and /Whatever wins, so
compatibility is preserved.

What, this, a feature request? Noooo, absolutely not.

Best,
Paul

From jason.t.stein at gmail.com  Sat Jul 24 19:50:55 2010
From: jason.t.stein at gmail.com (Jason Stein)
Date: Sat, 24 Jul 2010 11:50:55 -0600
Subject: [luatex] luatex Digest, Vol 19, Issue 18
In-Reply-To: <mailman.11.1279965601.17650.luatex@tug.org>
References: <mailman.11.1279965601.17650.luatex@tug.org>
Message-ID: <AANLkTikTzcKhZc2hZrkg+mgEvXS578xQCg-fygr9SYkf@mail.gmail.com>

Khaled, thank you so much for your useful insights. Removing the "\n"s
worked, and adding local to all variables cleared up the errors in
processing.

Jason T. Stein, B. Sc. (1998), B. Ed. (2002)


On Sat, Jul 24, 2010 at 4:00 AM, <luatex-request at tug.org> wrote:

> khaled
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20100724/386fab41/attachment.html>

From oinos at web.de  Sun Jul 25 11:59:07 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 11:59:07 +0200
Subject: [luatex] letterspacing in LuaTeX
Message-ID: <4C4C0AEB.6040408@web.de>

Hi there,

I have read in the microtype documentation (page 39) that tracking is 
not supported in LuaTeX because the \letterspacefont is missing.

I'm not a technical guy, but what I read from the LuaTeX Reference beta 
0.60.2 is that the letterspacefont is already implemented.

Is there a way to get letterspacing through the microtype package in 
LuaLaTeX?

Thanks for your help,


Pablo

From elie.roux at telecom-bretagne.eu  Sun Jul 25 12:12:36 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Sun, 25 Jul 2010 12:12:36 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <4C4C0AEB.6040408@web.de>
References: <4C4C0AEB.6040408@web.de>
Message-ID: <4C4C0E14.9010808@telecom-bretagne.eu>

Pablo Rodr?guez a ?crit :
> Hi there,
>
> I have read in the microtype documentation (page 39) that tracking is 
> not supported in LuaTeX because the \letterspacefont is missing.
>
> I'm not a technical guy, but what I read from the LuaTeX Reference 
> beta 0.60.2 is that the letterspacefont is already implemented.
>
> Is there a way to get letterspacing through the microtype package in 
> LuaLaTeX?

Hello,

I think the best way to get an answer is to ask the author of microtype 
(in copy of this mail).

Thank you,
-- 
Elie

From taco at elvenkind.com  Sun Jul 25 12:15:24 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 25 Jul 2010 12:15:24 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <4C4C0E14.9010808@telecom-bretagne.eu>
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
Message-ID: <4C4C0EBC.3040901@elvenkind.com>

On 07/25/2010 12:12 PM, Elie Roux wrote:
> Pablo Rodr?guez a ?crit :
>> Hi there,
>>
>> I have read in the microtype documentation (page 39) that tracking is
>> not supported in LuaTeX because the \letterspacefont is missing.

It is rightly disabled: the primitive exists, but it does not actually
work. I'll add a tracker item. Letterspacing was disabled a long time
ago during the font backend rewrite, and I forgot to restore the
feature afterwards. By now, it takes some work as the code has deviated
quite a bit from the original in pdftex.

Best wishes,
Taco

From oinos at web.de  Sun Jul 25 12:57:02 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 12:57:02 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <4C4C0EBC.3040901@elvenkind.com>
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com>
Message-ID: <4C4C187E.6080100@web.de>

On 07/25/2010 12:15 PM, Taco Hoekwater wrote:
> On 07/25/2010 12:12 PM, Elie Roux wrote:
>> Pablo Rodr?guez a ?crit :
>>> Hi there,
>>>
>>> I have read in the microtype documentation (page 39) that tracking is
>>> not supported in LuaTeX because the \letterspacefont is missing.
>
> It is rightly disabled: the primitive exists, but it does not actually
> work. I'll add a tracker item. Letterspacing was disabled a long time
> ago during the font backend rewrite, and I forgot to restore the
> feature afterwards. By now, it takes some work as the code has deviated
> quite a bit from the original in pdftex.

Thanks, Elie and Taco, for the replies.

In the meantime, a workaround might be to use the \so command from the 
soulutf8 package. This is what I tried first and here is a sample:

\documentclass[10pt]{book}
\usepackage{luaotfload}
\usepackage[EU2]{fontenc}
\usepackage{soulutf8}
\makeatletter\font\SOUL at tt="FreeMono.ttf"\setbox\z@\hbox{\SOUL at tt-}\SOUL at ttwidth\wd\z@\makeatother
\usepackage{fontspec}
\setmainfont{Theano Didot}
\begin{document}
This is only a \so{test}.

The Greek sentence {\so{?????? ?? ????}}.
\end{document}

The patch for XeLaTeX was kindly provided by Ulrike Fisher 
(http://tug.org/pipermail/xetex/2010-May/016763.html), but it doesn't 
seem to work with LuaLaTeX (and I don't have any idea why it doesn't).

All I get is the following message:

     ! Package soul Error: Reconstruction failed.

Just in case it might help, XeLaTeX had problems with non-ASCII 
characters. (Theano Classical fonts are available at 
http://www.thessalonica.org.ru/en/fonts-download.html.)

Thanks for your help,


Pablo

From oinos at web.de  Sun Jul 25 13:03:48 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 25 Jul 2010 13:03:48 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
Message-ID: <4C4C1A14.5080004@web.de>

Hi there,

using the same sources to compile a real book (and XeLaTeX and LuaLaTeX 
from TL2010), I get the following results:

	2.4M Jul 25 09:35 tesis-lualatex.pdf
	945K Jul 25 09:40 tesis-xelatex.pdf

The resulting size for LuaLaTeX is almost 2.5x bigger files.

I guess some proper configuration is missing. How can I enable the same 
compression for LuaTeX system-wide?

Many thanks for your help,


Pablo

From taco at elvenkind.com  Sun Jul 25 14:32:07 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 25 Jul 2010 14:32:07 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C1A14.5080004@web.de>
References: <4C4C1A14.5080004@web.de>
Message-ID: <4C4C2EC7.3060209@elvenkind.com>

On 07/25/2010 01:03 PM, Pablo Rodr?guez wrote:
> Hi there,
>
> using the same sources to compile a real book (and XeLaTeX and LuaLaTeX
> from TL2010), I get the following results:
>
> 2.4M Jul 25 09:35 tesis-lualatex.pdf
> 945K Jul 25 09:40 tesis-xelatex.pdf
>
> The resulting size for LuaLaTeX is almost 2.5x bigger files.
>
> I guess some proper configuration is missing. How can I enable the same
> compression for LuaTeX system-wide?

There are too many possible causes for this to start a guessing game.
Can you put the pdf files on the web somewhere so we can have a look?

Best wishes,
Taco

From oinos at web.de  Sun Jul 25 17:27:19 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 25 Jul 2010 17:27:19 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C2EC7.3060209@elvenkind.com>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
Message-ID: <4C4C57D7.8000101@web.de>

On 07/25/2010 02:32 PM, Taco Hoekwater wrote:
> On 07/25/2010 01:03 PM, Pablo Rodr?guez wrote:
>> Hi there,
>>
>> using the same sources to compile a real book (and XeLaTeX and LuaLaTeX
>> from TL2010), I get the following results:
>>
>> 2.4M Jul 25 09:35 tesis-lualatex.pdf
>> 945K Jul 25 09:40 tesis-xelatex.pdf
>>
>> The resulting size for LuaLaTeX is almost 2.5x bigger files.
>>
>> I guess some proper configuration is missing. How can I enable the same
>> compression for LuaTeX system-wide?
>
> There are too many possible causes for this to start a guessing game.
> Can you put the pdf files on the web somewhere so we can have a look?

Here you have the:

	http://www.ousia.tk/tesis-xelatex.pdf
	http://www.ousia.tk/tesis-lualatex.pdf

I hope it helps,


Pablo

From luigi.scarso at gmail.com  Sun Jul 25 17:51:23 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sun, 25 Jul 2010 17:51:23 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C57D7.8000101@web.de>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
Message-ID: <AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>

2010/7/25 Pablo Rodr?guez <oinos at web.de>:
> On 07/25/2010 02:32 PM, Taco Hoekwater wrote:
>>
>> On 07/25/2010 01:03 PM, Pablo Rodr?guez wrote:
>>>
>>> Hi there,
>>>
>>> using the same sources to compile a real book (and XeLaTeX and LuaLaTeX
>>> from TL2010), I get the following results:
>>>
>>> 2.4M Jul 25 09:35 tesis-lualatex.pdf
>>> 945K Jul 25 09:40 tesis-xelatex.pdf
>>>
>>> The resulting size for LuaLaTeX is almost 2.5x bigger files.
>>>
>>> I guess some proper configuration is missing. How can I enable the same
>>> compression for LuaTeX system-wide?
>>
>> There are too many possible causes for this to start a guessing game.
>> Can you put the pdf files on the web somewhere so we can have a look?
>
> Here you have the:
>
> ? ? ? ?http://www.ousia.tk/tesis-xelatex.pdf
> ? ? ? ?http://www.ousia.tk/tesis-lualatex.pdf
>
> I hope it helps,
>
>
> Pablo
>

I bet on the different ways to manage text.

-- 
luigi


From patrick at gundla.ch  Sun Jul 25 18:37:16 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 25 Jul 2010 18:37:16 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
Message-ID: <808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>



>>>> 2.4M Jul 25 09:35 tesis-lualatex.pdf
>>>> 945K Jul 25 09:40 tesis-xelatex.pdf

Even similar when the streams are uncompressed:


 12M 2010-07-25 18:24 luatex.pdf
4,1M 2010-07-25 18:24 xetex.pdf


> 
> I bet on the different ways to manage text.

"LuaTeX":

0.98 0 0 1 226.832 147.716 Tm [<0057>]TJ
0.985 0 0 1 230.145 147.716 Tm [<0058>]TJ
0.98 0 0 1 235.264 147.716 Tm [<0055>]TJ
0.985 0 0 1 238.686 147.716 Tm [<0044>]TJ
0.98 0 0 1 242.624 147.716 Tm [<004F>]TJ
0.985 0 0 1 247.57 147.716 Tm [<0056>]TJ
0.98 0 0 1 251.064 147.716 Tm [<00B5004F>]TJ
0.985 0 0 1 258.531 147.716 Tm [<0052>-234<00560048>-234<0053>24<005800480047>25<0048>]TJ
0.98 0 0 1 301.038 147.716 Tm [<004F004F>]TJ
0.985 0 0 1 306.19 147.716 Tm [<0048004A0044>]TJ
0.98 0 0 1 318.952 147.716 Tm [<0055>]TJ
0.985 0 0 1 324.744 147.716 Tm [<004B00440056>]TJ
0.98 0 0 1 337.581 147.716 Tm [<0057>]TJ
0.985 0 0 1 340.894 147.716 Tm [<0044>-234<0048>]TJ
0.98 0 0 1 351.344 147.716 Tm [<004F>]TJ
0.985 0 0 1 356.29 147.716 Tm [<00480051>]TJ
0.98 0 0 1 365.713 147.716 Tm [<0057>]TJ
0.985 0 0 1 368.715 147.716 Tm [<004800510047>]TJ
0.98 0 0 1 383.138 147.716 Tm [<004C>]TJ

"XeTeX":

<0028002f>-273<00330035002c00310026002c0033002c0032>-273<00270028002f>-273<00360024002500280035>]TJ ET 0 G 0 g BT /F1 12.328 Tf -14.3 2.34 Td[<0044>-288<005600af>-289<0050004c00560050>33<0052000f>-287<00560048>-289<005300520051>33<0048>-287<0046>23<00520050>34<0052>-288<0047>24<00480057>30<004800550050004c005100440047>25<0052>-288<005300520055>-289<00580051>-288<0031005205fb003c>86<0052000f>]TJ ET BT /F1 12.328 Tf 248.69 2.34 Td[<0074063c063c>]TJ ET BT /F1 12.328 Tf 262.91 2.34 Td[<005c>-288<0047>23<0048>-288<0044004b00af>-288<005400580048>-289<00560048>-289<004f0048>]TJ -277.21 -14.44 Td[<0046>24<005200510056004c>2

No Tm and only few TJ operators in XeTeX.


$ grep -c Tm xetex.pdf luatex.pdf 
xetex.pdf:0
luatex.pdf:218084

$ grep -c TJ xetex.pdf luatex.pdf 
xetex.pdf:264
luatex.pdf:218084

So it seems that XeTeX is more efficient in positioning text, but I am not going to judge which is better, as I have no understanding of the background mechanism.

One thing that strikes me is the alternating 0.98 and 0.985 which doesn't look like a big difference to me but leads to different positioning lines(??).


Patrick



From mpg at elzevir.fr  Sun Jul 25 19:00:17 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 25 Jul 2010 19:00:17 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <4C4C187E.6080100@web.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>
Message-ID: <4C4C6DA1.3080605@elzevir.fr>

Le 25/07/2010 12:57, Pablo Rodr?guez a ?crit :
> In the meantime, a workaround might be to use the \so command from the 
> soulutf8 package. This is what I tried first and here is a sample:
> 
I think you should try the soul package. soulutf8 expects (some) characters to
be many tokens, which is (happily) not the case in LuaTeX. So, the plain soul
package should work.

Manuel.

From oinos at web.de  Sun Jul 25 19:20:46 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 19:20:46 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <4C4C6DA1.3080605@elzevir.fr>
References: <4C4C0AEB.6040408@web.de>	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>	<4C4C187E.6080100@web.de>
	<4C4C6DA1.3080605@elzevir.fr>
Message-ID: <4C4C726E.3070108@web.de>

On 07/25/2010 07:00 PM, Manuel P?gouri?-Gonnard wrote:
> Le 25/07/2010 12:57, Pablo Rodr?guez a ?crit :
>> In the meantime, a workaround might be to use the \so command from the
>> soulutf8 package. This is what I tried first and here is a sample:
>>
> I think you should try the soul package. soulutf8 expects (some) characters to
> be many tokens, which is (happily) not the case in LuaTeX. So, the plain soul
> package should work.

Thanks for your reply, Manuel.

I replaced the soulutf8 package with the soul package and I'm afraid it 
doesn't work.

I get the same error. Any ideas?

Many thanks,


Pablo

From taco at elvenkind.com  Sun Jul 25 19:22:47 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 25 Jul 2010 19:22:47 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
Message-ID: <4C4C72E7.2010203@elvenkind.com>

On 07/25/2010 06:37 PM, Patrick Gundlach wrote:
>
> So it seems that XeTeX is more efficient in positioning text, but I
> am not going to judge which is better, as I have no understanding of
> the background mechanism.

This is a side effect of the font expansion technology, enabled by
the microtype package. To get a smaller lualatex file size, you can
disable that package (at the expense of some typesetting quality).

Best wishes,
Taco

From khaledhosny at eglug.org  Sun Jul 25 19:29:14 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 20:29:14 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C72E7.2010203@elvenkind.com>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
Message-ID: <20100725172914.GA4906@khaled-laptop>

On Sun, Jul 25, 2010 at 07:22:47PM +0200, Taco Hoekwater wrote:
> On 07/25/2010 06:37 PM, Patrick Gundlach wrote:
> >
> >So it seems that XeTeX is more efficient in positioning text, but I
> >am not going to judge which is better, as I have no understanding of
> >the background mechanism.
> 
> This is a side effect of the font expansion technology, enabled by
> the microtype package. To get a smaller lualatex file size, you can
> disable that package (at the expense of some typesetting quality).

Don't know if the lua-based microtypographic stuff fro ConTeXt (more or
less supported by luaotfload) can make any difference, but it is hard to
test without a sampe TeX file.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Sun Jul 25 20:00:25 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 20:00:25 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100725172914.GA4906@khaled-laptop>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<20100725172914.GA4906@khaled-laptop>
Message-ID: <4C4C7BB9.2030302@web.de>

On 07/25/2010 07:29 PM, Khaled Hosny wrote:
> On Sun, Jul 25, 2010 at 07:22:47PM +0200, Taco Hoekwater wrote:
>> On 07/25/2010 06:37 PM, Patrick Gundlach wrote:
>>>
>>> So it seems that XeTeX is more efficient in positioning text, but I
>>> am not going to judge which is better, as I have no understanding of
>>> the background mechanism.
>>
>> This is a side effect of the font expansion technology, enabled by
>> the microtype package. To get a smaller lualatex file size, you can
>> disable that package (at the expense of some typesetting quality).
>
> Don't know if the lua-based microtypographic stuff fro ConTeXt (more or
> less supported by luaotfload) can make any difference, but it is hard to
> test without a sampe TeX file.

Thanks for your explanation, Taco.

Kahled, I don't know how can be tested, but I guess that if all you need 
is only a relative large TeX file, ?TeX for the Impatient? 
(http://www.ctan.org/tex-archive/info/impatient/) should be a good 
choice. Is this what you need?

Thanks again,


Pablo


From khaledhosny at eglug.org  Sun Jul 25 20:06:40 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 21:06:40 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C7BB9.2030302@web.de>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
	<20100725172914.GA4906@khaled-laptop> <4C4C7BB9.2030302@web.de>
Message-ID: <20100725180640.GA5170@khaled-laptop>

On Sun, Jul 25, 2010 at 08:00:25PM +0200, Pablo Rodr?guez wrote:
> On 07/25/2010 07:29 PM, Khaled Hosny wrote:
> >On Sun, Jul 25, 2010 at 07:22:47PM +0200, Taco Hoekwater wrote:
> >>On 07/25/2010 06:37 PM, Patrick Gundlach wrote:
> >>>
> >>>So it seems that XeTeX is more efficient in positioning text, but I
> >>>am not going to judge which is better, as I have no understanding of
> >>>the background mechanism.
> >>
> >>This is a side effect of the font expansion technology, enabled by
> >>the microtype package. To get a smaller lualatex file size, you can
> >>disable that package (at the expense of some typesetting quality).
> >
> >Don't know if the lua-based microtypographic stuff fro ConTeXt (more or
> >less supported by luaotfload) can make any difference, but it is hard to
> >test without a sampe TeX file.
> 
> Thanks for your explanation, Taco.
> 
> Kahled, I don't know how can be tested, but I guess that if all you
> need is only a relative large TeX file, ?TeX for the Impatient?
> (http://www.ctan.org/tex-archive/info/impatient/) should be a good
> choice. Is this what you need?

I was actually interested in your microtype usage, I'm not familiar with
it myself.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Sun Jul 25 20:21:59 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 20:21:59 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100725180640.GA5170@khaled-laptop>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<20100725172914.GA4906@khaled-laptop>
	<4C4C7BB9.2030302@web.de> <20100725180640.GA5170@khaled-laptop>
Message-ID: <4C4C80C7.8080806@web.de>

On 07/25/2010 08:06 PM, Khaled Hosny wrote:
>>
>> Kahled, I don't know how can be tested, but I guess that if all you
>> need is only a relative large TeX file, ?TeX for the Impatient?
>> (http://www.ctan.org/tex-archive/info/impatient/) should be a good
>> choice. Is this what you need?
>
> I was actually interested in your microtype usage, I'm not familiar with
> it myself.

I'm not familiar with microtype. Thanks to a post from Ulrike Fischer, 
my settings are:

\pdfprotrudechars2\pdfadjustspacing2
\defaultfontfeatures{RawFeature={protrusion=default; 
expansion=default;},Mapping=tex-text,Scale=MatchLowercase}

And this is all I know about micro-typographic features in Lua(La)TeX.


Pablo

From ulrik.vieth at arcor.de  Sun Jul 25 20:58:02 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Sun, 25 Jul 2010 20:58:02 +0200
Subject: [luatex] some bits of opentype math testing
Message-ID: <4C4C893A.7010402@arcor.de>

Hi folks,

I've been doing a bit of OpenType math testing once again with
LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
(currently frozen) TL2010 pretest version.

Here are a my observations of rendering and font loading issues.

I expect that none of them are serious show stoppers for the
TL2010 release, but they might lead to subsequent online updates
after the TL release.

Regards, Ulrik


Rendering issues (ConTeXt):

- \hbar in math formulas (e.g. quantum mechanics) is incorrectly
   mapped to U+0127 (text upright) instead of U+210F (math italic).

   For Asana-Math you get a missing (disappearing) character.
   For Cambria and XITS-Math you get an incorrect character shape.

   It works OK if you use \hslash, or if you \let\hbar=\hslash.
   (Except for Neo-Euler which doesn't have the glyph.)

- For prime (U+0232), ConTeXt does not use the font substitution
   prime -> prime.ssty, so the raised prime appears too small.

   This problem was recently fixed in luaotfload for LuaLaTeX
   and the fix probably needs to be ported back to ConTeXt now.
   (Or maybe ConTeXt needs to be updated again in TL2010.)


Rendering issues (LuaLaTeX and XeLaTeX):

- \hbar in math formulas is constructed as a macro using
   an 'h' from the current math font and a bar from cmr10 (!).

   It works OK if you use \hslash, or if you \let\hbar=\hslash.
   (Except for Neo-Euler which doesn't have the glyph.)


Rendering issues (LuaLaTeX):

- For Asana-Math and Cambria-Math displaystyle integrals appear
   too small in LuaLaTeX, whereas they are correct in ConTeXt.
   For Neo-Euler and XITS-Math displaystyle integrals appear
   in the same size in LuaLaTeX and ConTeXt (and also in XeLaTeX).

   Does this depend on how many sizes of integrals are available
   or does it depend on the OT parameter DisplayOperatorMinHeight?

Rendering issues (ConTeXt and LuaLaTeX):

- For Asana-Math a straight version of displaystyle parentheses
   (as in the extensible version) is used in LuaLaTeX and ConTeXt,
   whereas a round version is used in XeTeX.

   Does this depend on how many sizes of integrals are available
   or does it depend on the OT parameter DisplayOperatorMinHeight?


Font loading issues (ConTeXt and LuaLaTeX):

- If cambria.ttc is installed in texmf-local/fonts/opentype,
   luaotfload fails to find the font "Cambria" or "Cambria Math".
   If cambria.ttc is installed in texmf-local/fonts/truetype,
   luaotfload correctly resolves the font name.

   With ConTeXt it doesn't matter where cambria.ttc was installed.
   It was correctly found it both locations.

- If euler.otf is installed in texmf-local/fonts/opentype,
   Context fails to find the font, whereas luaotfload does find it.

   Does this depend on specific names in the defintion of typescript
   pagella-euler in type-otf.mkiv?


Font loading issues (XeLaTeX):

- For Asana-Math, you get a messed up PDF file, if the font
   is loaded with \setmathfont{Asana Math}, because there are
   both OTF and TTF versions of the font in the texmf tree.
   If the font is loaded with \setmathfont{Asana-Math.otf}
   (specific type), there are no problems.

   With LuaLaTeX, using the unspecific type works fine.


Font issues:

- It would be nice if Neo-Euler would have a \hslash glpyh (U+210F).
- It would be nice if Neo-Euler would have a bold \nabla (U+1D6C1).
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lualatex-asana-test.pdf
Type: application/pdf
Size: 20405 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100725/200abd0c/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lualatex-asana-test.tex
Type: text/x-tex
Size: 3347 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100725/200abd0c/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xelatex-asana-test.pdf
Type: application/pdf
Size: 17616 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100725/200abd0c/attachment-0003.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xelatex-asana-test.tex
Type: text/x-tex
Size: 3347 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100725/200abd0c/attachment-0003.bin>

From oinos at web.de  Sun Jul 25 22:07:08 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 25 Jul 2010 22:07:08 +0200
Subject: [luatex] not able to load a PostScript font
Message-ID: <4C4C996C.4030104@web.de>

Hi there,

I have tried to use in the same single LuaLaTeX document an OpenType 
font and a PostScript font.

\documentclass[10pt]{book}
\usepackage{luaotfload}
\usepackage[EU2]{fontenc}
\usepackage{fontspec}
\setmainfont{Theano Didot}
\setmonofont{WebOMints GD}
\begin{document}
This is only a test.
\end{document}

But I get an error, because fontspec is not able to find the metrics for 
the PostScript font.

How should I do it?

Thanks for your help,


Pablo

From pragma at wxs.nl  Sun Jul 25 22:10:05 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 25 Jul 2010 22:10:05 +0200
Subject: [luatex] \pdfstartlink ... isn't really a link.
In-Reply-To: <1279956521.4c4a962971066@imp.free.fr>
References: <1279956521.4c4a962971066@imp.free.fr>
Message-ID: <4C4C9A1D.1070909@wxs.nl>

On 24-7-2010 9:28, Paul Isambert wrote:
> Hello all,
>
> This message addresses the pdfTeX kernel, but since LuaTeX is the pdfTeX's
> future, I think it fits here.
>
> I've just discovered that \pdfstartlink ... \pdfendlink doesn't create a link
> when<action spec>  is "user" instead of "goto". It simply creates an annotation,
> whose /Subtype must be set to /Link (or anything else) in either "attr" or
> "user". That's apparently a known fact since Heiko Oberdiek has written on the
> pdfTeX list that "`user' must set /Subtype and /A"
> (http://tug.org/mailman/htdig/pdftex/2008-August/007789.html).
>
> However it is pretty confusing, all the more as the pdfTeX manual doesn't
> mention it, quite the contrary: it says that<user action>  is the action
> performed when the _link_ is activated.
>
> While that's no big deal once you know it (any insight on the historical reason
> why?), it remains incoherent and umotivated (as far as I can see, at least). So,
> for the sake of coherency&  clarity of the future, wouldn't it be better to have
> \pdfstartlink create a link no matter what, and perhaps another primitive
> \pdfstartannot ... \pdfendannot that would do the same thing as \pdfstartlink
> but without a /Subtype?
>
> As for compatibility, code written up to know with such things as \pdfstartlink
> user {/Subtype /Whatever ... } ... will produce an annotation with Subtype set
> twice (once to /Link and once to /Whatever), but I've checked and Acrobat at
> least doesn't mind, even if the two subtypes differ, and /Whatever wins, so
> compatibility is preserved.

as such primitives are often encapsulated and not used directly it is no 
big deal that there are some conditions of their usage

also, setting the subset twice is a real bad idea as in the past there 
has been problems with that (in viewers) and validators and parsing the 
annot content in the backend is a no-go

so, this is a 'feature' one has to live with

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Sun Jul 25 22:12:01 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 25 Jul 2010 22:12:01 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4C893A.7010402@arcor.de>
References: <4C4C893A.7010402@arcor.de>
Message-ID: <4C4C9A91.6010106@wxs.nl>

Hi Ulrik,

> I've been doing a bit of OpenType math testing once again with
> LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
> (currently frozen) TL2010 pretest version.

I'll have a look at the reported context bits. Keep in mind that the 
font/math code in context tl-2010 is not the latest (a coupe of month 
old since we've frozen in sync with luatex 0.60). Thanks for looking 
into it.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Jul 25 22:17:15 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 23:17:15 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C80C7.8080806@web.de>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
	<20100725172914.GA4906@khaled-laptop> <4C4C7BB9.2030302@web.de>
	<20100725180640.GA5170@khaled-laptop> <4C4C80C7.8080806@web.de>
Message-ID: <20100725201715.GA7104@khaled-laptop>

On Sun, Jul 25, 2010 at 08:21:59PM +0200, Pablo Rodr?guez wrote:
> On 07/25/2010 08:06 PM, Khaled Hosny wrote:
> >>
> >>Kahled, I don't know how can be tested, but I guess that if all you
> >>need is only a relative large TeX file, ?TeX for the Impatient?
> >>(http://www.ctan.org/tex-archive/info/impatient/) should be a good
> >>choice. Is this what you need?
> >
> >I was actually interested in your microtype usage, I'm not familiar with
> >it myself.
> 
> I'm not familiar with microtype. Thanks to a post from Ulrike
> Fischer, my settings are:
> 
> \pdfprotrudechars2\pdfadjustspacing2
> \defaultfontfeatures{RawFeature={protrusion=default;
> expansion=default;},Mapping=tex-text,Scale=MatchLowercase}

That is the lua-based solution I was referring to, actually :)

BTW, you should not be using Mapping=tex-text with luatex, you should
use Ligatures=TeX instead (luatex has no Mapping support, but fontspec
special case Mapping=tex-text for backward compatibility).

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Jul 25 22:22:18 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 23:22:18 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <4C4C996C.4030104@web.de>
References: <4C4C996C.4030104@web.de>
Message-ID: <20100725202056.GB7104@khaled-laptop>

On Sun, Jul 25, 2010 at 10:07:08PM +0200, Pablo Rodr?guez wrote:
> Hi there,
> 
> I have tried to use in the same single LuaLaTeX document an OpenType
> font and a PostScript font.
> 
> \documentclass[10pt]{book}
> \usepackage{luaotfload}
> \usepackage[EU2]{fontenc}
> \usepackage{fontspec}
> \setmainfont{Theano Didot}
> \setmonofont{WebOMints GD}
> \begin{document}
> This is only a test.
> \end{document}
> 
> But I get an error, because fontspec is not able to find the metrics
> for the PostScript font.

Fontspec (luaotfload actually) doesn't support Type1 (postscript) fonts.
ConTeXt has code to load Type1 fonts using AFM files, but this code
didn't get into luaotfload, you can use Type1 fonts through old TeX TFM
machinery instead (i.e. no fontspec).

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Sun Jul 25 22:24:11 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 25 Jul 2010 22:24:11 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C72E7.2010203@elvenkind.com>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
Message-ID: <4C4C9D6B.5070306@web.de>

On 07/25/2010 07:22 PM, Taco Hoekwater wrote:
> On 07/25/2010 06:37 PM, Patrick Gundlach wrote:
>>
>> So it seems that XeTeX is more efficient in positioning text, but I
>> am not going to judge which is better, as I have no understanding of
>> the background mechanism.
>
> This is a side effect of the font expansion technology, enabled by
> the microtype package. To get a smaller lualatex file size, you can
> disable that package (at the expense of some typesetting quality).

Taco,

I have just remembered that something similar happened to pdftex: it 
generated larger files when font expansion was enabled, but according to 
the microtype documentation that was due to the fact that fonts were 
embedded many times. This was improved in a newer version.

AFAIK LuaTeX doesn't embed expanded fonts many times, is there any 
possibity that in the future the font expansion technology in LuaTeX 
will be improved so that LuaTeX would generate smaller files?

Thanks for your help,


Pablo

From pragma at wxs.nl  Sun Jul 25 22:34:19 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sun, 25 Jul 2010 22:34:19 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C9D6B.5070306@web.de>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<4C4C9D6B.5070306@web.de>
Message-ID: <4C4C9FCB.8060603@wxs.nl>

On 25-7-2010 10:24, Pablo Rodr?guez wrote:

> AFAIK LuaTeX doesn't embed expanded fonts many times, is there any
> possibity that in the future the font expansion technology in LuaTeX
> will be improved so that LuaTeX would generate smaller files?

Actually the backend code has been rewritten and this is the way it's 
done now. I think that the larger file size is a non-issue for documents 
that end up in professional print (esp when images are also part of teh 
document). For documents meant for reading from displays font expansion 
makes no sense anyway (actually, in print it also is somewhat debatable 
as abusing it makes things worse).

Btw, as font expansion works on a line basis, having many more steps 
does not make a big difference in file size (contrary to having more 
font instances) so there you gain. Also, you might consider applying 
font expansion in selected cases.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sun Jul 25 22:39:15 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 23:39:15 +0300
Subject: [luatex] [unimath] some bits of opentype math testing
In-Reply-To: <4C4C893A.7010402@arcor.de>
References: <4C4C893A.7010402@arcor.de>
Message-ID: <20100725203915.GC7104@khaled-laptop>

On Sun, Jul 25, 2010 at 08:58:02PM +0200, Ulrik Vieth wrote:
> Hi folks,
> 
> I've been doing a bit of OpenType math testing once again with
> LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
> (currently frozen) TL2010 pretest version.
> 
> Here are a my observations of rendering and font loading issues.
> 
> I expect that none of them are serious show stoppers for the
> TL2010 release, but they might lead to subsequent online updates
> after the TL release.
> 
> Regards, Ulrik
> 
> 
> Rendering issues (ConTeXt):

[...]

> - For prime (U+0232), ConTeXt does not use the font substitution
>   prime -> prime.ssty, so the raised prime appears too small.
> 
>   This problem was recently fixed in luaotfload for LuaLaTeX
>   and the fix probably needs to be ported back to ConTeXt now.
>   (Or maybe ConTeXt needs to be updated again in TL2010.)

This is already fixed in ConTeXt beta, it was a different issue than in
LuaLaTeX (the ssty feature activation got accidentally disabled during
some code shuffling).

[...]

> Font loading issues (ConTeXt and LuaLaTeX):
> 
> - If cambria.ttc is installed in texmf-local/fonts/opentype,
>   luaotfload fails to find the font "Cambria" or "Cambria Math".
>   If cambria.ttc is installed in texmf-local/fonts/truetype,
>   luaotfload correctly resolves the font name.

This is a kpathsea issue (TTC and TTF fonts are looked for in $TTFONTS
not $OPENTYPEFONTS and thus the font names database generation code will
not see cambria.ttc in the first case (you can check with kpsewhich).

>   With ConTeXt it doesn't matter where cambria.ttc was installed.
>   It was correctly found it both locations.
> 
> - If euler.otf is installed in texmf-local/fonts/opentype,
>   Context fails to find the font, whereas luaotfload does find it.
> 
>   Does this depend on specific names in the defintion of typescript
>   pagella-euler in type-otf.mkiv?

ConTeXt doesn't use kpathsea, luaotfload does. To check if ConTeXt can
find a file try `luatools --find`.

> Font loading issues (XeLaTeX):
> 
> - For Asana-Math, you get a messed up PDF file, if the font
>   is loaded with \setmathfont{Asana Math}, because there are
>   both OTF and TTF versions of the font in the texmf tree.
>   If the font is loaded with \setmathfont{Asana-Math.otf}
>   (specific type), there are no problems.
>
>   With LuaLaTeX, using the unspecific type works fine.

This is a known XeTeX bug (engine bug, no mutter which of te two files
fontspec will load).

> Font issues:
> 
> - It would be nice if Neo-Euler would have a \hslash glpyh (U+210F).
> - It would be nice if Neo-Euler would have a bold \nabla (U+1D6C1).

I'll put them on the, unwritten, TODO list :)
(tracker issues so it does not get missed is appreciated, now and in
the future.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Jul 25 22:40:12 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 25 Jul 2010 23:40:12 +0300
Subject: [luatex] [unimath] some bits of opentype math testing
In-Reply-To: <4C4C893A.7010402@arcor.de>
References: <4C4C893A.7010402@arcor.de>
Message-ID: <20100725203915.GC7104@khaled-laptop>

On Sun, Jul 25, 2010 at 08:58:02PM +0200, Ulrik Vieth wrote:
> Hi folks,
> 
> I've been doing a bit of OpenType math testing once again with
> LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
> (currently frozen) TL2010 pretest version.
> 
> Here are a my observations of rendering and font loading issues.
> 
> I expect that none of them are serious show stoppers for the
> TL2010 release, but they might lead to subsequent online updates
> after the TL release.
> 
> Regards, Ulrik
> 
> 
> Rendering issues (ConTeXt):

[...]

> - For prime (U+0232), ConTeXt does not use the font substitution
>   prime -> prime.ssty, so the raised prime appears too small.
> 
>   This problem was recently fixed in luaotfload for LuaLaTeX
>   and the fix probably needs to be ported back to ConTeXt now.
>   (Or maybe ConTeXt needs to be updated again in TL2010.)

This is already fixed in ConTeXt beta, it was a different issue than in
LuaLaTeX (the ssty feature activation got accidentally disabled during
some code shuffling).

[...]

> Font loading issues (ConTeXt and LuaLaTeX):
> 
> - If cambria.ttc is installed in texmf-local/fonts/opentype,
>   luaotfload fails to find the font "Cambria" or "Cambria Math".
>   If cambria.ttc is installed in texmf-local/fonts/truetype,
>   luaotfload correctly resolves the font name.

This is a kpathsea issue (TTC and TTF fonts are looked for in $TTFONTS
not $OPENTYPEFONTS and thus the font names database generation code will
not see cambria.ttc in the first case (you can check with kpsewhich).

>   With ConTeXt it doesn't matter where cambria.ttc was installed.
>   It was correctly found it both locations.
> 
> - If euler.otf is installed in texmf-local/fonts/opentype,
>   Context fails to find the font, whereas luaotfload does find it.
> 
>   Does this depend on specific names in the defintion of typescript
>   pagella-euler in type-otf.mkiv?

ConTeXt doesn't use kpathsea, luaotfload does. To check if ConTeXt can
find a file try `luatools --find`.

> Font loading issues (XeLaTeX):
> 
> - For Asana-Math, you get a messed up PDF file, if the font
>   is loaded with \setmathfont{Asana Math}, because there are
>   both OTF and TTF versions of the font in the texmf tree.
>   If the font is loaded with \setmathfont{Asana-Math.otf}
>   (specific type), there are no problems.
>
>   With LuaLaTeX, using the unspecific type works fine.

This is a known XeTeX bug (engine bug, no mutter which of te two files
fontspec will load).

> Font issues:
> 
> - It would be nice if Neo-Euler would have a \hslash glpyh (U+210F).
> - It would be nice if Neo-Euler would have a bold \nabla (U+1D6C1).

I'll put them on the, unwritten, TODO list :)
(tracker issues so it does not get missed is appreciated, now and in
the future.)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From hartmut_henkel at gmx.de  Sun Jul 25 22:48:46 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 25 Jul 2010 22:48:46 +0200 (CEST)
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C9FCB.8060603@wxs.nl>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl>
Message-ID: <alpine.DEB.2.00.1007252244260.4753@hahepc1.hahe>

On Sun, 25 Jul 2010, Hans Hagen wrote:
> On 25-7-2010 10:24, Pablo Rodr?guez wrote:
>
> > AFAIK LuaTeX doesn't embed expanded fonts many times, is there any
> > possibity that in the future the font expansion technology in LuaTeX
> > will be improved so that LuaTeX would generate smaller files?
>
> Actually the backend code has been rewritten and this is the way it's
> done now. I think that the larger file size is a non-issue for
> documents that end up in professional print (esp when images are also
> part of teh document). For documents meant for reading from displays
> font expansion makes no sense anyway (actually, in print it also is
> somewhat debatable as abusing it makes things worse).
>
> Btw, as font expansion works on a line basis,

it should i guess, but in that example it doesn't; expansion changes
several times within a line, often glyph-wise. Looks as if the backend
already gets this variable expansion (or extension?) info from the node,
no idea why.

> having many more steps does not make a big difference in file size
> (contrary to having more font instances) so there you gain. Also, you
> might consider applying font expansion in selected cases.

Regards, Hartmut

From oinos at web.de  Sun Jul 25 23:20:06 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Sun, 25 Jul 2010 23:20:06 +0200
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <20100725202056.GB7104@khaled-laptop>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
Message-ID: <4C4CAA86.3090902@web.de>

On 07/25/2010 10:22 PM, Khaled Hosny wrote:
> On Sun, Jul 25, 2010 at 10:07:08PM +0200, Pablo Rodr?guez wrote:
>>  [...]
>> But I get an error, because fontspec is not able to find the metrics
>> for the PostScript font.
>
> Fontspec (luaotfload actually) doesn't support Type1 (postscript) fonts.
> ConTeXt has code to load Type1 fonts using AFM files, but this code
> didn't get into luaotfload, you can use Type1 fonts through old TeX TFM
> machinery instead (i.e. no fontspec).

I wonder whether a future version of luaotfload could have the code to 
load PS fonts implemented.

Thanks for your help,


Pablo

From khaledhosny at eglug.org  Sun Jul 25 23:40:08 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 00:40:08 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <4C4CAA86.3090902@web.de>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de>
Message-ID: <20100725214008.GA8451@khaled-laptop>

On Sun, Jul 25, 2010 at 11:20:06PM +0200, Pablo Rodr?guez wrote:
> On 07/25/2010 10:22 PM, Khaled Hosny wrote:
> >On Sun, Jul 25, 2010 at 10:07:08PM +0200, Pablo Rodr?guez wrote:
> >> [...]
> >>But I get an error, because fontspec is not able to find the metrics
> >>for the PostScript font.
> >
> >Fontspec (luaotfload actually) doesn't support Type1 (postscript) fonts.
> >ConTeXt has code to load Type1 fonts using AFM files, but this code
> >didn't get into luaotfload, you can use Type1 fonts through old TeX TFM
> >machinery instead (i.e. no fontspec).
> 
> I wonder whether a future version of luaotfload could have the code
> to load PS fonts implemented.

I don't see an urgent need, Type1 fonts are obsolete anyway.


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From martin at oneiros.de  Sun Jul 25 23:45:14 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 25 Jul 2010 23:45:14 +0200
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <20100725214008.GA8451@khaled-laptop>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
Message-ID: <AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>

2010/7/25 Khaled Hosny <khaledhosny at eglug.org>:
> I don't see an urgent need, Type1 fonts are obsolete anyway.

But they exist. And I don't think font vendors will upgrade
Type1-fonts to OpenType for free (if at all). E.g. I don't think I'll
be able to get an update of my Lucida Bright Type1 fonts from TUG
anytime soon.

Best
   Martin

From khaledhosny at eglug.org  Sun Jul 25 23:52:53 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 00:52:53 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
Message-ID: <20100725215253.GB8451@khaled-laptop>

On Sun, Jul 25, 2010 at 11:45:14PM +0200, Martin Schr?der wrote:
> 2010/7/25 Khaled Hosny <khaledhosny at eglug.org>:
> > I don't see an urgent need, Type1 fonts are obsolete anyway.
> 
> But they exist. And I don't think font vendors will upgrade
> Type1-fonts to OpenType for free (if at all). E.g. I don't think I'll
> be able to get an update of my Lucida Bright Type1 fonts from TUG
> anytime soon.

But you can still use them as TFM fonts, nothing changed here. Also the
interaction between fontspec (which is modelled around smart fonts) and
the, dump, Type1 fonts need to be thought about, it might not be that
simple.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From ulrik.vieth at arcor.de  Mon Jul 26 00:10:44 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Mon, 26 Jul 2010 00:10:44 +0200
Subject: [luatex] [unimath] some bits of opentype math testing
In-Reply-To: <20100725203915.GC7104@khaled-laptop>
References: <4C4C893A.7010402@arcor.de> <20100725203915.GC7104@khaled-laptop>
Message-ID: <4C4CB664.9030404@arcor.de>

On 07/25/2010 10:39 PM, Khaled Hosny wrote:

> This is a kpathsea issue (TTC and TTF fonts are looked for in $TTFONTS
> not $OPENTYPEFONTS and thus the font names database generation code will
> not see cambria.ttc in the first case (you can check with kpsewhich).

So maybe this a TeXLive documentation issue: Where should users put 
their OpenType fonts if they are in .ttf/.ttc format and not .otf?

>> - If euler.otf is installed in texmf-local/fonts/opentype,
>>    Context fails to find the font, whereas luaotfload does find it.
>
> ConTeXt doesn't use kpathsea, luaotfload does.
 > To check if ConTeXt can find a file try `luatools --find`.

I've checked it, but "luatoots --find-file euler.otf" doesn't find it.

It does find xits-math.otf and asana-math.otf in the texmf-dist tree, 
but it doesn't find cambria.ttc and euler.otf in the texmf-local tree.
Nevertheless, context could use cambria.ttc but couldn't find euler.otf.

As I've checked, euler.otf is also listed in the luatex-cache files
of my texmf-local tree.

$ luatools --find-file euler.otf
[...]
LuaTools | fileio: loading 'files' for '/opt/texlive/texmf-local' from 
'/home/uvi/.texlive2010/texmf-var/luatex-cache/context/1f3583840856de270bff021c0c541f9f/trees/117a211900e1ec281a0287eb597ec69b'

$ grep euler.otf 
/home/uvi/.texlive2010/texmf-var/luatex-cache/context/1f3583840856de270bff021c0c541f9f/trees/117a211900e1ec281a0287eb597ec69b.lua
                 ['euler.otf']='fonts/opentype/public/euler',

$ grep -2 euler.otf 
/home/uvi/.texlive2010/texmf-var/luatex-cache/context/1f3583840856de270bff021c0c541f9f/fonts/data/names.tma 

    designsize=0,
    familyname="neoeuler",
    filename="euler.otf",
    fontname="neoeuler",
    format="otf",

Something strange seems to be going on here!

>> Font loading issues (XeLaTeX):
>>
> This is a known XeTeX bug (engine bug, no matter which of the two files
> fontspec will load).

Yes, I've also seen this bug before.  Maybe it would be better
not to ship two different versions of the same font in TeXLive.

Regards, Ulrik

From taco at elvenkind.com  Mon Jul 26 07:57:35 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 Jul 2010 07:57:35 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4C9A91.6010106@wxs.nl>
References: <4C4C893A.7010402@arcor.de> <4C4C9A91.6010106@wxs.nl>
Message-ID: <4C4D23CF.4010805@elvenkind.com>

On 07/25/2010 10:12 PM, Hans Hagen wrote:
> Hi Ulrik,
>
>> I've been doing a bit of OpenType math testing once again with
>> LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
>> (currently frozen) TL2010 pretest version.
>
> I'll have a look at the reported context bits. Keep in mind that the
> font/math code in context tl-2010 is not the latest (a coupe of month
> old since we've frozen in sync with luatex 0.60). Thanks for looking
> into it.

Can someone warn me explictly if there is some engine issue in luatex?
There are so many differences between context and lualatex that I cannot
oversee whether anything is a core problem.

Best wishes,
Taco

From patrick at gundla.ch  Mon Jul 26 08:41:19 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 26 Jul 2010 08:41:19 +0200
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <20100725215253.GB8451@khaled-laptop>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
	<20100725215253.GB8451@khaled-laptop>
Message-ID: <715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>

Hi,

> But you can still use them as TFM fonts, nothing changed here.

But you do have to deal with encodings, and have to "install" the font.

My customers demand Type1 fonts 50% of the time. (But I am using my own font subsystem anyway - I don't have extra code in there for type 1 fonts, they "just" work, so I wonder what the reason is for dropping type1 support.)


Patrick



From ulrik.vieth at arcor.de  Mon Jul 26 09:28:02 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Mon, 26 Jul 2010 09:28:02 +0200 (CEST)
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4D23CF.4010805@elvenkind.com>
References: <4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
Message-ID: <22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>

Hi Taco,

I suppose most of it will _not_ be engine-related, but rather 
affect TeX macros (e.g. \hbar) or Lua code (e.g. font loading).

If there is anything potentially interesting for you, it might be
the font-size weirdness with Asana, i.e. integrals staying small
and delimiters using extensible rather than big versions.

What puzzles me, is that the integrals are only a problem in 
LuaLaTeX, whereas the delimiters are also wrong in ConTeXt.

However, even that may be related to font-loading issues
or even font-design / parameter settings issues.

Regards, Ulrik.

----- Original Nachricht ----
Von:     Taco Hoekwater <taco at elvenkind.com>
An:      "General discussion of LuaTeX." <luatex at tug.org>
Datum:   26.07.2010 07:57
Betreff: Re: [luatex] some bits of opentype math testing

> On 07/25/2010 10:12 PM, Hans Hagen wrote:
> > Hi Ulrik,
> >
> >> I've been doing a bit of OpenType math testing once again with
> >> LuaLaTeX, XeLaTeX, and ConTeXt MkIV, all based on the final
> >> (currently frozen) TL2010 pretest version.
> >
> > I'll have a look at the reported context bits. Keep in mind that the
> > font/math code in context tl-2010 is not the latest (a coupe of month
> > old since we've frozen in sync with luatex 0.60). Thanks for looking
> > into it.
> 
> Can someone warn me explictly if there is some engine issue in luatex?
> There are so many differences between context and lualatex that I cannot
> oversee whether anything is a core problem.
> 
> Best wishes,
> Taco
> 

From taco at elvenkind.com  Mon Jul 26 10:38:58 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 Jul 2010 10:38:58 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
References: <4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
Message-ID: <4C4D49A2.6010308@elvenkind.com>

On 07/26/2010 09:28 AM, ulrik.vieth at arcor.de wrote:
> Hi Taco,
>
> I suppose most of it will _not_ be engine-related, but rather
> affect TeX macros (e.g. \hbar) or Lua code (e.g. font loading).
>
> If there is anything potentially interesting for you, it might be
> the font-size weirdness with Asana, i.e. integrals staying small
> and delimiters using extensible rather than big versions.

This is an Asana bug. ConTeXt has a runtime font patch for its
too-small DisplayOperatorMinHeight.

Best wishes,
Taco

From ulrik.vieth at arcor.de  Mon Jul 26 10:51:45 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Mon, 26 Jul 2010 10:51:45 +0200 (CEST)
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4D49A2.6010308@elvenkind.com>
References: <4C4D49A2.6010308@elvenkind.com> <4C4D23CF.4010805@elvenkind.com>
	<4C4C893A.7010402@arcor.de> <4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
Message-ID: <1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>

Hi Taco,

thanks for claryfing this issue. I suppose those ConTeXt 
runtime fixes probably need to go into luaotfload as well.

Are there more of these kinds of fixes for other fonts?  
The integrals staying too small also occured in Cambria.

Regards, Ulrik


----- Original Nachricht ----
Von:     Taco Hoekwater <taco at elvenkind.com>
An:      ulrik.vieth at arcor.de
Datum:   26.07.2010 10:38
Betreff: Re: [luatex] some bits of opentype math testing

> On 07/26/2010 09:28 AM, ulrik.vieth at arcor.de wrote:
> > Hi Taco,
> >
> > I suppose most of it will _not_ be engine-related, but rather
> > affect TeX macros (e.g. \hbar) or Lua code (e.g. font loading).
> >
> > If there is anything potentially interesting for you, it might be
> > the font-size weirdness with Asana, i.e. integrals staying small
> > and delimiters using extensible rather than big versions.
> 
> This is an Asana bug. ConTeXt has a runtime font patch for its
> too-small DisplayOperatorMinHeight.
> 
> Best wishes,
> Taco
> 

From taco at elvenkind.com  Mon Jul 26 10:57:50 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 Jul 2010 10:57:50 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
References: <4C4D49A2.6010308@elvenkind.com> <4C4D23CF.4010805@elvenkind.com>
	<4C4C893A.7010402@arcor.de> <4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <4C4D4E0E.5070004@elvenkind.com>

On 07/26/2010 10:51 AM, ulrik.vieth at arcor.de wrote:
> Hi Taco,
>
> thanks for claryfing this issue. I suppose those ConTeXt
> runtime fixes probably need to go into luaotfload as well.
>
> Are there more of these kinds of fixes for other fonts?
> The integrals staying too small also occured in Cambria.

Yes, there are a few more. There is a file in the context
distribution (font-pat.lua) that contains font fixes.

The relevant bits for cambria/math are:

local function patch_domh(data,filename,threshold)
     local m = data.math
     if m then
         local d = m.DisplayOperatorMinHeight or 0
         if d < threshold then
             if trace_loading then
                 report_otf(
                 "patching DisplayOperatorMinHeight(%s -> %s)", d,threshold)
             end
             m.DisplayOperatorMinHeight = threshold
         end
      end
end

patches["cambria"]  = function(data,filename) 
patch_domh(data,filename,2800) end
patches["cambmath"] = function(data,filename) 
patch_domh(data,filename,2800) end
patches["asana"]    = function(data,filename) 
patch_domh(data,filename,1350) end


Best wishes,
Taco

From luatex at nililand.de  Mon Jul 26 11:04:57 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 26 Jul 2010 11:04:57 +0200
Subject: [luatex] letterspacing in LuaTeX
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
Message-ID: <1q27f12sylfbi$.dlg@nililand.de>

Am Sun, 25 Jul 2010 12:57:02 +0200 schrieb Pablo Rodr?guez:


> In the meantime, a workaround might be to use the \so command from the 
> soulutf8 package. This is what I tried first and here is a sample:

[...]

> All I get is the following message:
> 
>      ! Package soul Error: Reconstruction failed.

The problem has nothing to do with fonts or utf8. I get the same
error with lualatex (Version beta-0.61.0-2010061910 (rev 3724))
(xelatex + pdflatex works fine) with this example: 


\documentclass[10pt]{book}
\usepackage{soul}

\begin{document}
This is only a \so{a}.
\end{document}
 

The problem is in SOUL at analyze: soul makes to much loops (and ends
with negative "goal") because the box \@one is not voided like in
pdflatex. The \showbox commands of the example below  shows in the
log file of pdflatex the boxes

First step

> \box1=
\hbox(4.3045+0.0)x0.00002
.\glue 0.0
.\SOUL at tt a
.\penalty 10000
.\glue(\parfillskip) 0.0 plus 1.0fil
.\glue(\rightskip) 0.0

Second step

> \box1=void


lualatex shows:

First step

> \box1=
\hbox(4.3045+0.0)x0.00002, direction TLT
.\SOUL at tt a
.\penalty 10000
.\glue(\parfillskip) 0.0 plus 1.0fil
.\glue(\leftskip) 0.0

Second step

> \box1=
\hbox(0.0+0.0)x0.00002, direction TLT
.\whatsit
..\localinterlinepenalty=0
..\localbrokenpenalty=0
..\localleftbox=null
..\localrightbox=null
.\glue(\rightskip) 0.0

then comes the error.


\documentclass[10pt]{book}
\usepackage{soul}
\makeatletter
\showboxdepth=100
\def\SOUL at analyze{{%
    \setbox\z@\vbox{%
        \unvcopy\z@
        \unskip
        \unpenalty
       \global\setbox\@ne=\lastbox}% 
    \showbox\@ne  %show box @ne
    \ifvoid\@ne
    \else
        \setbox\@ne\hbox{\unhbox\@ne}%
        \SOUL at syllgoal=\wd\@ne
        \showthe\SOUL at syllgoal %show goal
        \advance\count@\@ne
        \SOUL at analyze
        \SOUL at syllwidth\z@
        \SOUL at syllable={}%
        \ifnum\count@>\z@
            \advance\SOUL at syllgoal-\SOUL at ttwidth
            \SOUL at dosyllable
            \SOUL at getkern{\the\SOUL at lasttoken}{\SOUL at hyphkern}%
                {\SOUL at sethyphenchar}%
            \SOUL at everyhyphen
        \else
            \SOUL at dosyllable
        \fi
    \fi
}}

\begin{document}
This is only a \so{a}.
\end{document}


-- 
Ulrike Fischer 


From taco at elvenkind.com  Mon Jul 26 15:59:38 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 Jul 2010 15:59:38 +0200
Subject: [luatex] 4th ConTeXt Meeting, update
Message-ID: <4C4D94CA.4050205@elvenkind.com>


Hello to everybody!

There are few weeks left till the 4th ConTeXt Meeting on September 
13-18, 2010 in Brejlov, Czech Republic.

We have collected interesting talks and tutorials (25+) on ConTeXt, 
LuaTeX, Lua, fonts, OpenType math, Metapost and more:
http://meeting.contextgarden.net/2010/abstracts.shtml

We are working on the preliminary programme and other things to make the 
meeting unforgettable. The highlights of the accompanying programme are 
delicious cuisine, excellent beer and lovely countryside. Developers and 
users of ConTeXt and LuaTeX are coming, so we are going to have 
wonderful time with many interesting talks -- formal and informal: great 
source of encouragement and inspiration.

After the deadline, the registration for the meeting is still open until 
we reach the available capacity.

We hope you are having a good time and we are looking forward to meeting 
you in Brejlov.

Best regards,

Hans, Jano, Pavel & Taco
The organizing committee
http://meeting.contextgarden.net/2010/

From taco at elvenkind.com  Mon Jul 26 16:27:39 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 26 Jul 2010 16:27:39 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <1q27f12sylfbi$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de> <1q27f12sylfbi$.dlg@nililand.de>
Message-ID: <4C4D9B5B.6090601@elvenkind.com>

On 07/26/2010 11:04 AM, Ulrike Fischer wrote:
>
> The problem has nothing to do with fonts or utf8. I get the same
> error with lualatex (Version beta-0.61.0-2010061910 (rev 3724))
> (xelatex + pdflatex works fine) with this example:

This sounds like an engine error, but I am missing what is actually
wrong. Is there a problem with \lastbox ?

Best wishes,
Taco

From ulrik.vieth at arcor.de  Mon Jul 26 16:35:03 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Mon, 26 Jul 2010 16:35:03 +0200 (CEST)
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4D4E0E.5070004@elvenkind.com>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>

Hi folks,

following the feedback and answers already received,
let me try to summarize the status of the reported issues.

Regards, Ulrik


Rendering issues (ConTeXt):

- \hbar/\hslash -> open, mapping issue in Lua tables
- prime.ssty substitution -> already fixed in ConTeXt beta

Rendering issues (LuaLaTeX and XeLaTeX):

- \hbar/\hslash -> open, mapping issue in LaTeX tables

Rendering issues (LuaLaTeX):

- Asana-Math and Cambria-Math displaystyle integrals too small
  -> known font bug, already patched in ConTeXt (font-pat.lua)
  -> still open, to be fixed in luaotfload

Rendering issues (ConTeXt and LuaLaTeX):

- Asana-Math displaystyle delimiters appear in extensible version
  -> open, unresolved, possibly also a font bug

Font loading issues (ConTeXt):

- euler.otf not found by luatoos/context in texmf-local tree
  -> open, unresolved

Font loading issues (LuaLaTeX):

- cambria.ttc not found in fonts/opentype, only in fonts/truetype
  -> known TL/Kpathsea issue -> deferred till next year

Font loading issues (XeLaTeX):

- Asana.otf vs. Asana.ttf mixed up in PDF generation
  -> known XeTeX engine issue -> deferred till next year

Font issues: 

- missing glyphs (\hslash, bold \nabla) in Neo-Euler 
  -> open, logged as tracker issue


From luatex at nililand.de  Mon Jul 26 17:09:19 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 26 Jul 2010 17:09:19 +0200
Subject: [luatex] letterspacing in LuaTeX
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
	<1q27f12sylfbi$.dlg@nililand.de> <4C4D9B5B.6090601@elvenkind.com>
Message-ID: <w622ppk7fvrz$.dlg@nililand.de>

Am Mon, 26 Jul 2010 16:27:39 +0200 schrieb Taco Hoekwater:

> On 07/26/2010 11:04 AM, Ulrike Fischer wrote:
>>
>> The problem has nothing to do with fonts or utf8. I get the same
>> error with lualatex (Version beta-0.61.0-2010061910 (rev 3724))
>> (xelatex + pdflatex works fine) with this example:
> 
> This sounds like an engine error, but I am missing what is actually
> wrong. Is there a problem with \lastbox ?

I don't know. But I now also looked at box \z@ 

And there you get with luatex as first box:

> \box0=
\vbox(12.0+0.0)x0.00002, direction TLT
.\hbox(0.0+0.0)x0.00002, direction TLT
..\whatsit
...\localinterlinepenalty=0
...\localbrokenpenalty=0
...\localleftbox=null
...\localrightbox=null
..\glue(\rightskip) 0.0
.\penalty 300
.\glue(\baselineskip) 7.6955
.\hbox(4.3045+0.0)x0.00002, direction TLT
..\SOUL at tt a
..\penalty 10000
..\glue(\parfillskip) 0.0 plus 1.0fil
..\glue(\leftskip) 0.0



While pdflatex shows

> \box0=
\vbox(4.3045+0.0)x0.00002
.\hbox(4.3045+0.0)x0.00002
..\glue 0.0
..\SOUL at tt a
..\penalty 10000
..\glue(\parfillskip) 0.0 plus 1.0fil
..\glue(\rightskip) 0.0

So box0 contains in luatex at the start 2 hboxes and so needs one
step more to get void than in pdflatex.

The additional box disappears (and also the errors) if I remove the
\tolerance\@M from SOUL at doword:

\documentclass[10pt]{book}
\usepackage{soul}
\makeatletter
\showboxdepth=100
\def\SOUL at doword{%
    \edef\x{\the\SOUL at word}%
    \ifx\x\empty
    \else
        \SOUL at buffer={}%
        \setbox\z@\vbox{%
            \SOUL at tt
            \hyphenchar\font`\-
            \hfuzz\maxdimen
            \hbadness\@M
            \pretolerance\m at ne
       %     \tolerance\@M %<--------------
            \leftskip\z@
            \rightskip\z@
            \hsize1sp
            \everypar{}%
            \parfillskip\z@\@plus1fil
            \hyphenpenalty-\@M
            \noindent
            \hskip\z@
            \relax
            \the\SOUL at word}%
        \showbox\z@    %<------show
        \let\SOUL at errmsg\SOUL at error
        \let\-\relax
        \count@\m at ne
        \SOUL at analyze
        \SOUL at word={}%
    \fi
}


\begin{document}
\so{a}
\end{document}


-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Mon Jul 26 18:29:40 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 19:29:40 +0300
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
Message-ID: <20100726162940.GB4962@khaled-laptop>

On Mon, Jul 26, 2010 at 04:35:03PM +0200, ulrik.vieth at arcor.de wrote:
> Hi folks,
> 
> following the feedback and answers already received,
> let me try to summarize the status of the reported issues.
> 
> Regards, Ulrik

[...]

> Rendering issues (LuaLaTeX):
> 
> - Asana-Math and Cambria-Math displaystyle integrals too small
>   -> known font bug, already patched in ConTeXt (font-pat.lua)
>   -> still open, to be fixed in luaotfload

If this is really a font bug, then we should ask Apostolos to fix Asana
Math, we can try to patch Cambria at run time, but the less font
patching the better we are.

> Rendering issues (ConTeXt and LuaLaTeX):
> 
> - Asana-Math displaystyle delimiters appear in extensible version
>   -> open, unresolved, possibly also a font bug

I think it might be an engine issue, I recall having the same problem
with Neo Euler until I disable the extensible integrals (I think other
fonts have no extensible integrals so the issue is hidden).

[...]

> Font loading issues (LuaLaTeX):
> 
> - cambria.ttc not found in fonts/opentype, only in fonts/truetype
>   -> known TL/Kpathsea issue -> deferred till next year
> 
> Font loading issues (XeLaTeX):
> 
> - Asana.otf vs. Asana.ttf mixed up in PDF generation
>   -> known XeTeX engine issue -> deferred till next year

I think those two issues should be directed to TeXLive team.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Jul 26 18:49:03 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 19:49:03 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
	<20100725215253.GB8451@khaled-laptop>
	<715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
Message-ID: <20100726164903.GA5485@khaled-laptop>

On Mon, Jul 26, 2010 at 08:41:19AM +0200, Patrick Gundlach wrote:
> Hi,
> 
> > But you can still use them as TFM fonts, nothing changed here.
> 
> But you do have to deal with encodings, and have to "install" the font.
> 
> My customers demand Type1 fonts 50% of the time. (But I am using my own font subsystem anyway - I don't have extra code in there for type 1 fonts, they "just" work, so I wonder what the reason is for dropping type1 support.)

We, luaotfload and fontspec, never supported Type1 fonts to drop it,
ConTeXt does but this is a different matter. Type1 fonts are useless to
me (Arabic non-smart fonts need more additional work than merely being
able to load them), so I, myself, have no real interest in it.

Nobody is producing new Type1 fonts, except in TeX, and there are tools
and existing macro packages that handle such fonts, one can still use
them in LuaTeX.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon Jul 26 19:05:19 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 26 Jul 2010 19:05:19 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726162940.GB4962@khaled-laptop>
References: <4C4D4E0E.5070004@elvenkind.com>
	<4C4D49A2.6010308@elvenkind.com>	<4C4D23CF.4010805@elvenkind.com>
	<4C4C893A.7010402@arcor.de>	<4C4C9A91.6010106@wxs.nl>	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
Message-ID: <4C4DC04F.70007@elzevir.fr>

Le 26/07/2010 18:29, Khaled Hosny a ?crit :
> On Mon, Jul 26, 2010 at 04:35:03PM +0200, ulrik.vieth at arcor.de wrote:
>>
>> Font loading issues (LuaLaTeX):
>>
>> - cambria.ttc not found in fonts/opentype, only in fonts/truetype
>>   -> known TL/Kpathsea issue -> deferred till next year
>>
>> Font loading issues (XeLaTeX):
>>
>> - Asana.otf vs. Asana.ttf mixed up in PDF generation
>>   -> known XeTeX engine issue -> deferred till next year
> 
> I think those two issues should be directed to TeXLive team.
> 
Sorry for asking such a stupid question, but concerning the cambria.ttc
question, why not simply put the file under fonts/truetype?

Concerning Asana.{otf,ttf} mixup, Jonathan may be more able than anyone in the
TL team to solve it.

Manuel.

From khaledhosny at eglug.org  Mon Jul 26 19:27:57 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 20:27:57 +0300
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DC04F.70007@elzevir.fr>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
Message-ID: <20100726172757.GA6013@khaled-laptop>

On Mon, Jul 26, 2010 at 07:05:19PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 26/07/2010 18:29, Khaled Hosny a ?crit :
> > On Mon, Jul 26, 2010 at 04:35:03PM +0200, ulrik.vieth at arcor.de wrote:
> >>
> >> Font loading issues (LuaLaTeX):
> >>
> >> - cambria.ttc not found in fonts/opentype, only in fonts/truetype
> >>   -> known TL/Kpathsea issue -> deferred till next year
> >>
> >> Font loading issues (XeLaTeX):
> >>
> >> - Asana.otf vs. Asana.ttf mixed up in PDF generation
> >>   -> known XeTeX engine issue -> deferred till next year
> > 
> > I think those two issues should be directed to TeXLive team.
> > 
> Sorry for asking such a stupid question, but concerning the cambria.ttc
> question, why not simply put the file under fonts/truetype?

I think Ulrik was just concerned what is the right directory to put the
font under.

> Concerning Asana.{otf,ttf} mixup, Jonathan may be more able than anyone in the
> TL team to solve it.

Jonathan already knows about it, and the only possible fix currently is
not to have to different versions of the same font, thus why I think
this is now up to texlive to decide installing only one version of the
font or not.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon Jul 26 19:38:12 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 26 Jul 2010 19:38:12 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726172757.GA6013@khaled-laptop>
References: <4C4D4E0E.5070004@elvenkind.com>
	<4C4D49A2.6010308@elvenkind.com>	<4C4D23CF.4010805@elvenkind.com>
	<4C4C893A.7010402@arcor.de>	<4C4C9A91.6010106@wxs.nl>	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>	<20100726162940.GB4962@khaled-laptop>
	<4C4DC04F.70007@elzevir.fr> <20100726172757.GA6013@khaled-laptop>
Message-ID: <4C4DC804.6000800@elzevir.fr>

Le 26/07/2010 19:27, Khaled Hosny a ?crit :
>> Concerning Asana.{otf,ttf} mixup, Jonathan may be more able than anyone in the
>> TL team to solve it.
> 
> Jonathan already knows about it, and the only possible fix currently is
> not to have to different versions of the same font, thus why I think
> this is now up to texlive to decide installing only one version of the
> font or not.
> 
Ok, thanks for the explanation. But XeTeX is not the only engine able to use
this font. Are there other situations where on version should be preferred over
the other?

Manuel.

From khaledhosny at eglug.org  Mon Jul 26 19:57:53 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 20:57:53 +0300
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DC804.6000800@elzevir.fr>
References: <4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
Message-ID: <20100726175753.GA6090@khaled-laptop>

On Mon, Jul 26, 2010 at 07:38:12PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 26/07/2010 19:27, Khaled Hosny a ?crit :
> >> Concerning Asana.{otf,ttf} mixup, Jonathan may be more able than anyone in the
> >> TL team to solve it.
> > 
> > Jonathan already knows about it, and the only possible fix currently is
> > not to have to different versions of the same font, thus why I think
> > this is now up to texlive to decide installing only one version of the
> > font or not.
> > 
> Ok, thanks for the explanation. But XeTeX is not the only engine able to use
> this font. Are there other situations where on version should be preferred over
> the other?

In Windows, GDI renders TTF better than OTF, but this only affects
applications using the OS native font renderer, which I think does not
affect PDF readers (Adobe Reader at least have its own renderer).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Jul 26 19:59:06 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 20:59:06 +0300
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DC804.6000800@elzevir.fr>
References: <4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
Message-ID: <20100726175753.GA6090@khaled-laptop>

On Mon, Jul 26, 2010 at 07:38:12PM +0200, Manuel P?gouri?-Gonnard wrote:
> Le 26/07/2010 19:27, Khaled Hosny a ?crit :
> >> Concerning Asana.{otf,ttf} mixup, Jonathan may be more able than anyone in the
> >> TL team to solve it.
> > 
> > Jonathan already knows about it, and the only possible fix currently is
> > not to have to different versions of the same font, thus why I think
> > this is now up to texlive to decide installing only one version of the
> > font or not.
> > 
> Ok, thanks for the explanation. But XeTeX is not the only engine able to use
> this font. Are there other situations where on version should be preferred over
> the other?

In Windows, GDI renders TTF better than OTF, but this only affects
applications using the OS native font renderer, which I think does not
affect PDF readers (Adobe Reader at least have its own renderer).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From buliabyak at gmail.com  Mon Jul 26 20:26:57 2010
From: buliabyak at gmail.com (bulia byak)
Date: Mon, 26 Jul 2010 15:26:57 -0300
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <w622ppk7fvrz$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
	<1q27f12sylfbi$.dlg@nililand.de> <4C4D9B5B.6090601@elvenkind.com>
	<w622ppk7fvrz$.dlg@nililand.de>
Message-ID: <AANLkTi=+0BvPEV0CNhAZZbPRgUbbu=X84f4dqpwRKCJv@mail.gmail.com>

Dunno if this will be helpful, but I do letterspacing thus:

\def\spaceone#1{\if#1*\let\nextspaceone=\relax\else\let\nextspaceone=\spaceone{#1}\hskip2.6pt\fi\nextspaceone}
\def\so#1{\bgroup\obeyspaces\spaceone#1*\unskip\egroup}%

You can adjust the amount of spacing in the hskip. Sure, this is a
hack with many limitations, but it works for my limited needs, and it
works in luatex. When \letterspacefont gets fixed, I will happily
switch to it.

-- 
bulia byak
Inkscape. Draw Freely.
http://www.inkscape.org

From taco at elvenkind.com  Mon Jul 26 20:46:19 2010
From: taco at elvenkind.com (taco)
Date: Mon, 26 Jul 2010 20:46:19 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <w622ppk7fvrz$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>	<1q27f12sylfbi$.dlg@nililand.de>
	<4C4D9B5B.6090601@elvenkind.com> <w622ppk7fvrz$.dlg@nililand.de>
Message-ID: <4C4DD7FB.2010601@elvenkind.com>

Ulrike Fischer wrote:
> 
> I don't know. But I now also looked at box \z@ 
> 
> And there you get with luatex as first box:
> 
> [...]
> 
> So box0 contains in luatex at the start 2 hboxes and so needs one
> step more to get void than in pdflatex.
> 
> The additional box disappears (and also the errors) if I remove the
> \tolerance\@M from SOUL at doword:

This makes sense. The extra \whatsit followed by a skip introduces
a possible linebreak point that is chosen thanks to the \tolerance\@M.

The luatex engine should probably suppress this potential breakpoint,
so I will create a bug tracker for that, but that may not help soul.sty
because the \whatsit will remain.

Best wishes,
Taco

From reinhard.kotucha at web.de  Mon Jul 26 21:05:23 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 26 Jul 2010 21:05:23 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726175753.GA6090@khaled-laptop>
References: <4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
	<20100726175753.GA6090@khaled-laptop>
Message-ID: <19533.56435.951572.942240@zaphod.ms25.net>

On 26 July 2010 Khaled Hosny wrote:

 > In Windows, GDI renders TTF better than OTF, but this only affects
 > applications using the OS native font renderer, which I think does not
 > affect PDF readers (Adobe Reader at least have its own renderer).

Is it possible that it depends on whether the OTF contains 2nd or 3rd
order Bezier curves?  I know that Type 1 fonts (3rd order Bezier
curves) are rendered worse than TTF on Windows, but I can't imagine
that there are any differences between OTF and TTF if the OTF contains
TTF outlines (2nd order Bezier curves).

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From khaledhosny at eglug.org  Mon Jul 26 21:13:46 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 26 Jul 2010 22:13:46 +0300
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <19533.56435.951572.942240@zaphod.ms25.net>
References: <4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
	<20100726175753.GA6090@khaled-laptop>
	<19533.56435.951572.942240@zaphod.ms25.net>
Message-ID: <20100726191346.GA6480@khaled-laptop>

On Mon, Jul 26, 2010 at 09:05:23PM +0200, Reinhard Kotucha wrote:
> On 26 July 2010 Khaled Hosny wrote:
> 
>  > In Windows, GDI renders TTF better than OTF, but this only affects
>  > applications using the OS native font renderer, which I think does not
>  > affect PDF readers (Adobe Reader at least have its own renderer).
> 
> Is it possible that it depends on whether the OTF contains 2nd or 3rd
> order Bezier curves?  I know that Type 1 fonts (3rd order Bezier
> curves) are rendered worse than TTF on Windows, but I can't imagine
> that there are any differences between OTF and TTF if the OTF contains
> TTF outlines (2nd order Bezier curves).

When saying OTF I meant the common convention of naming CFF falvoured
OpenType fonts (3rd order Bezier splines) with a .otf extension and
TrueType flavoured (2nd order) with a .ttf extension. Well, I know it
is a major source of confusion, but the OpenType specification choose
to make our life harder by supporting two contradictory file name
extension schemes!

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From arthur.reutenauer at normalesup.org  Mon Jul 26 21:19:42 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 26 Jul 2010 21:19:42 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726191346.GA6480@khaled-laptop>
References: <22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
	<20100726175753.GA6090@khaled-laptop>
	<19533.56435.951572.942240@zaphod.ms25.net>
	<20100726191346.GA6480@khaled-laptop>
Message-ID: <20100726191942.GA27828@phare.normalesup.org>

>                                                       Well, I know it
> is a major source of confusion, but the OpenType specification choose
> to make our life harder by supporting two contradictory file name
> extension schemes!

  I've seen a TrueType-flavoured OpenType font with extension .otf once,
but it's admittedly very rare.

  And the main difference between TrueType- and CFF
(PostScript)-flavoured OpenType fonts is more likely to be in the
hinting engine anyway, not the degree of the B?zier curves.

	Arthur

From taco at elvenkind.com  Mon Jul 26 22:10:50 2010
From: taco at elvenkind.com (taco)
Date: Mon, 26 Jul 2010 22:10:50 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726162940.GB4962@khaled-laptop>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
Message-ID: <4C4DEBCA.3080504@elvenkind.com>

Khaled Hosny wrote:
> 
>> Rendering issues (ConTeXt and LuaLaTeX):
>>
>> - Asana-Math displaystyle delimiters appear in extensible version
>>   -> open, unresolved, possibly also a font bug
> 
> I think it might be an engine issue, I recall having the same problem
> with Neo Euler until I disable the extensible integrals (I think other
> fonts have no extensible integrals so the issue is hidden).

Is there a small test file for this (preferably in ConTeXt or
plain luatex?)

Best wishes,
Taco

From oinos at web.de  Mon Jul 26 22:58:18 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Mon, 26 Jul 2010 22:58:18 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C9FCB.8060603@wxs.nl>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl>
Message-ID: <4C4DF6EA.5030807@web.de>

On 07/25/2010 10:34 PM, Hans Hagen wrote:
> On 25-7-2010 10:24, Pablo Rodr?guez wrote:
>
>> AFAIK LuaTeX doesn't embed expanded fonts many times, is there any
>> possibity that in the future the font expansion technology in LuaTeX
>> will be improved so that LuaTeX would generate smaller files?
>
> Actually the backend code has been rewritten and this is the way it's
> done now. I think that the larger file size is a non-issue for documents
> that end up in professional print (esp when images are also part of teh
> document). For documents meant for reading from displays font expansion
> makes no sense anyway (actually, in print it also is somewhat debatable
> as abusing it makes things worse).

Thanks for your reply, Hans.

Bigger file size might be an issue because not all documents contain 
bitmap images (when they contain images at all).

Sometimes one may need to distribute a document over the internet that 
is actually intended for printing.

I agree with you that in documents meant for reading from displays 
microtypography doesn't make any sense. I would even go further, PDF 
might not be the best option for those documents.

Microtypography could be useful (when not abused) in documents that 
don't end up in a professional print. Because of that bigger file size 
may be an issue.

> Btw, as font expansion works on a line basis, having many more steps
> does not make a big difference in file size (contrary to having more
> font instances) so there you gain. Also, you might consider applying
> font expansion in selected cases.

Sorry, but I'm afraid I don't get your point here (sorry if I 
misunderstood your comment).

If I don't get it wrong, you mean that font expansion shouldn't make 
that big difference in file size. The difference in file size activating 
character protrusion and font expansion is 2.4MB when activated instead 
of 1.1MB when not activated.

Do you mean that this difference is not big?

Thanks for your help,


Pablo

From oinos at web.de  Mon Jul 26 23:04:21 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Mon, 26 Jul 2010 23:04:21 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <1q27f12sylfbi$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de> <1q27f12sylfbi$.dlg@nililand.de>
Message-ID: <4C4DF855.7020106@web.de>

On 07/26/2010 11:04 AM, Ulrike Fischer wrote:
> \documentclass[10pt]{book}
> \usepackage{soul}
> \makeatletter
> \showboxdepth=100
> \def\SOUL at analyze{{%
>      \setbox\z@\vbox{%
>          \unvcopy\z@
>          \unskip
>          \unpenalty
>         \global\setbox\@ne=\lastbox}%
>      \showbox\@ne  %show box @ne
>      \ifvoid\@ne
>      \else
>          \setbox\@ne\hbox{\unhbox\@ne}%
>          \SOUL at syllgoal=\wd\@ne
>          \showthe\SOUL at syllgoal %show goal
>          \advance\count@\@ne
>          \SOUL at analyze
>          \SOUL at syllwidth\z@
>          \SOUL at syllable={}%
>          \ifnum\count@>\z@
>              \advance\SOUL at syllgoal-\SOUL at ttwidth
>              \SOUL at dosyllable
>              \SOUL at getkern{\the\SOUL at lasttoken}{\SOUL at hyphkern}%
>                  {\SOUL at sethyphenchar}%
>              \SOUL at everyhyphen
>          \else
>              \SOUL at dosyllable
>          \fi
>      \fi
> }}
>
> \begin{document}
> This is only a \so{a}.
> \end{document}

Thanks for your in-depth explanation, Ulrike, but I'm afraid I don't 
understand a word (sorry, but it is too complicated for me).

My LuaTeX version is beta-0.60.2-2010071217 (TeX Live 2010) (rev 3736).

BTW, is the sample document above supposed to work. (I'm afraid it doesn't.)

Thanks for your help,


Pablo

From oinos at web.de  Mon Jul 26 23:10:39 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Mon, 26 Jul 2010 23:10:39 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <w622ppk7fvrz$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>	<1q27f12sylfbi$.dlg@nililand.de>
	<4C4D9B5B.6090601@elvenkind.com> <w622ppk7fvrz$.dlg@nililand.de>
Message-ID: <4C4DF9CF.1030109@web.de>

On 07/26/2010 05:09 PM, Ulrike Fischer wrote:
> \documentclass[10pt]{book}
> \usepackage{soul}
> \makeatletter
> \showboxdepth=100
> \def\SOUL at doword{%
>      \edef\x{\the\SOUL at word}%
>      \ifx\x\empty
>      \else
>          \SOUL at buffer={}%
>          \setbox\z@\vbox{%
>              \SOUL at tt
>              \hyphenchar\font`\-
>              \hfuzz\maxdimen
>              \hbadness\@M
>              \pretolerance\m at ne
>         %     \tolerance\@M %<--------------
>              \leftskip\z@
>              \rightskip\z@
>              \hsize1sp
>              \everypar{}%
>              \parfillskip\z@\@plus1fil
>              \hyphenpenalty-\@M
>              \noindent
>              \hskip\z@
>              \relax
>              \the\SOUL at word}%
>          \showbox\z@    %<------show
>          \let\SOUL at errmsg\SOUL at error
>          \let\-\relax
>          \count@\m at ne
>          \SOUL at analyze
>          \SOUL at word={}%
>      \fi
> }
>
>
> \begin{document}
> \so{a}
> \end{document}

Ulrike, many thanks again.

If the above document is supposed to work, I'm afraid it doesn't.

Thanks for your help,


Pablo

From oinos at web.de  Mon Jul 26 23:14:09 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Mon, 26 Jul 2010 23:14:09 +0200
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <20100726164903.GA5485@khaled-laptop>
References: <4C4C996C.4030104@web.de>
	<20100725202056.GB7104@khaled-laptop>	<4C4CAA86.3090902@web.de>
	<20100725214008.GA8451@khaled-laptop>	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>	<20100725215253.GB8451@khaled-laptop>	<715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
	<20100726164903.GA5485@khaled-laptop>
Message-ID: <4C4DFAA1.1050009@web.de>

On 07/26/2010 06:49 PM, Khaled Hosny wrote:
> On Mon, Jul 26, 2010 at 08:41:19AM +0200, Patrick Gundlach wrote:
>> Hi,
>>
>>> But you can still use them as TFM fonts, nothing changed here.
>>
>> But you do have to deal with encodings, and have to "install" the font.
>>
>> My customers demand Type1 fonts 50% of the time. (But I am using my own font subsystem anyway - I don't have extra code in there for type 1 fonts, they "just" work, so I wonder what the reason is for dropping type1 support.)
>
> We, luaotfload and fontspec, never supported Type1 fonts to drop it,
> ConTeXt does but this is a different matter. Type1 fonts are useless to
> me (Arabic non-smart fonts need more additional work than merely being
> able to load them), so I, myself, have no real interest in it.

Thanks for your reply, Kahled.

Sorry, I don't understand that fontspec never supported Type1 fonts. I 
have been using the Type1 font as any other system font thanks to 
fontspec (version 1) in XeLaTeX.

> Nobody is producing new Type1 fonts, except in TeX, and there are tools
> and existing macro packages that handle such fonts, one can still use
> them in LuaTeX.

Does any of them allow the use of the Type1 font without having to 
install it for (Lua)TeX?

Thanks for your help,


Pablo

From ulrik.vieth at arcor.de  Mon Jul 26 23:34:19 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Mon, 26 Jul 2010 23:34:19 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DEBCA.3080504@elvenkind.com>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
	<4C4DEBCA.3080504@elvenkind.com>
Message-ID: <4C4DFF5B.9020601@arcor.de>

On 07/26/2010 10:10 PM, taco wrote:
> Khaled Hosny wrote:
>>
>>> Rendering issues (ConTeXt and LuaLaTeX):
>>>
>>> - Asana-Math displaystyle delimiters appear in extensible version
>>> -> open, unresolved, possibly also a font bug
>>
>> I think it might be an engine issue, I recall having the same problem
>> with Neo Euler until I disable the extensible integrals (I think other
>> fonts have no extensible integrals so the issue is hidden).
>
> Is there a small test file for this (preferably in ConTeXt or
> plain luatex?)

Enclosed is a Context test file and the log file with \tracingoutput.

Regards, Ulrik
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: context-asana-test.log
URL: <http://tug.org/pipermail/luatex/attachments/20100726/37b356b1/attachment-0001.pl>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: context-asana-test.pdf
Type: application/pdf
Size: 10476 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100726/37b356b1/attachment-0001.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: context-asana-test.tex
Type: text/x-tex
Size: 3282 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100726/37b356b1/attachment-0001.bin>

From ulrik.vieth at arcor.de  Mon Jul 26 23:41:21 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Mon, 26 Jul 2010 23:41:21 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DC04F.70007@elzevir.fr>
References: <4C4D4E0E.5070004@elvenkind.com>	<4C4D49A2.6010308@elvenkind.com>	<4C4D23CF.4010805@elvenkind.com>	<4C4C893A.7010402@arcor.de>	<4C4C9A91.6010106@wxs.nl>	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>	<20100726162940.GB4962@khaled-laptop>
	<4C4DC04F.70007@elzevir.fr>
Message-ID: <4C4E0101.1060100@arcor.de>

On 07/26/2010 07:05 PM, Manuel P?gouri?-Gonnard wrote:

> Sorry for asking such a stupid question, but concerning the cambria.ttc
> question, why not simply put the file under fonts/truetype?

Once you know where to put it, it's no longer a problem, but if you
accidentily put it int the wrong place first (i.e. fonts/opentype),
you start wasting your time with "why doesn't it find the font?".

It's even more puzlling if Context can find it, but LuaLateX can't.
Once again, if you know that Context uses a different mechanism,
this becomes much easier to understand.

Regards, Ulrik

From reinhard.kotucha at web.de  Tue Jul 27 01:19:18 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 27 Jul 2010 01:19:18 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <20100726191942.GA27828@phare.normalesup.org>
References: <22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop> <4C4DC04F.70007@elzevir.fr>
	<20100726172757.GA6013@khaled-laptop> <4C4DC804.6000800@elzevir.fr>
	<20100726175753.GA6090@khaled-laptop>
	<19533.56435.951572.942240@zaphod.ms25.net>
	<20100726191346.GA6480@khaled-laptop>
	<20100726191942.GA27828@phare.normalesup.org>
Message-ID: <19534.6134.938465.243686@zaphod.ms25.net>

On 26 July 2010 Arthur Reutenauer wrote:

 > >                                                       Well, I know it
 > > is a major source of confusion, but the OpenType specification choose
 > > to make our life harder by supporting two contradictory file name
 > > extension schemes!
 > 
 >   I've seen a TrueType-flavoured OpenType font with extension .otf once,
 > but it's admittedly very rare.
 > 
 >   And the main difference between TrueType- and CFF
 > (PostScript)-flavoured OpenType fonts is more likely to be in the
 > hinting engine anyway, not the degree of the B?zier curves.

I'm convinced too that the hinting engine is the culprit.  I just used
the degree of the B?zier curves in order to distinguish between the
different font formats an OTF can contain.

I have the impression that Type1 hints are ignored by Microsoft's font
renderer and only anti-aliasing is applied.  But anti-aliasing can
never be a replacement for proper hinting.  The mathematical theory
anti-aliasing is based on is quite clear in this respect. 

I mention this because a few years ago there was a discussion on a
TeX-related mailing list where someone proposed not to apply hints
anymore.  He claimed that modern printers have a reasonably high
resolution and for screen preview anti-aliasing is sufficient.

I suppose that he was bothered by fonts with broken hints.  Sure, no
hinting is better than wrong hinting.  At this time I wasn't able to
provide an example which shows the difference between hinted fonts and
non-hinted fonts.  But now I can, at least for Windows users:

   Install a Type1 font (or an OTF containing CFF) on Windows,
   configure your web browser to use this font, and enjoy the result.

I'm convinced that it makes clear that proper hinting is still
unavoidable.  At least as long as manufacturers of computer screens
believe that a pitiful resolution of 96 dpi is enough for everybody.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From patrick at gundla.ch  Tue Jul 27 07:57:36 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 27 Jul 2010 07:57:36 +0200
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <20100726164903.GA5485@khaled-laptop>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
	<20100725215253.GB8451@khaled-laptop>
	<715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
	<20100726164903.GA5485@khaled-laptop>
Message-ID: <EE62DDA9-19EA-49A7-9B45-A4AB17A93007@gundla.ch>


Am 26.07.2010 um 18:49 schrieb Khaled Hosny:

> On Mon, Jul 26, 2010 at 08:41:19AM +0200, Patrick Gundlach wrote:
> 
> We, luaotfload and fontspec, never supported Type1 fonts

OK, thanks for the info. I just assumed it/you did because of the "history" of luaotfload.

> Nobody is producing new Type1 fonts, except in TeX, and there are tools
> and existing macro packages that handle such fonts, one can still use
> them in LuaTeX.

But they still require 'encodings'.


I anticipate a lot of feature requests from users for LuaLaTeX/Type1.



Patrick



From khaledhosny at eglug.org  Tue Jul 27 08:38:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 27 Jul 2010 09:38:43 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <EE62DDA9-19EA-49A7-9B45-A4AB17A93007@gundla.ch>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
	<20100725215253.GB8451@khaled-laptop>
	<715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
	<20100726164903.GA5485@khaled-laptop>
	<EE62DDA9-19EA-49A7-9B45-A4AB17A93007@gundla.ch>
Message-ID: <20100727063843.GB1833@khaled-laptop>

On Tue, Jul 27, 2010 at 07:57:36AM +0200, Patrick Gundlach wrote:
> 
> Am 26.07.2010 um 18:49 schrieb Khaled Hosny:
> 
> > On Mon, Jul 26, 2010 at 08:41:19AM +0200, Patrick Gundlach wrote:
> > 
> > We, luaotfload and fontspec, never supported Type1 fonts
> 
> OK, thanks for the info. I just assumed it/you did because of the "history" of luaotfload.
> 
> > Nobody is producing new Type1 fonts, except in TeX, and there are tools
> > and existing macro packages that handle such fonts, one can still use
> > them in LuaTeX.
> 
> But they still require 'encodings'.
> 
> 
> I anticipate a lot of feature requests from users for LuaLaTeX/Type1.

Some one have to added support for it then.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Tue Jul 27 08:37:12 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 27 Jul 2010 09:37:12 +0300
Subject: [luatex] not able to load a PostScript font
In-Reply-To: <4C4DFAA1.1050009@web.de>
References: <4C4C996C.4030104@web.de> <20100725202056.GB7104@khaled-laptop>
	<4C4CAA86.3090902@web.de> <20100725214008.GA8451@khaled-laptop>
	<AANLkTi==ERj-UxDwkMangnW9Pv4K3p_9cGuT+srgcYkh@mail.gmail.com>
	<20100725215253.GB8451@khaled-laptop>
	<715417A7-AE93-4757-BE06-81307166CF81@gundla.ch>
	<20100726164903.GA5485@khaled-laptop> <4C4DFAA1.1050009@web.de>
Message-ID: <20100727063711.GA1833@khaled-laptop>

On Mon, Jul 26, 2010 at 11:14:09PM +0200, Pablo Rodr?guez wrote:
> On 07/26/2010 06:49 PM, Khaled Hosny wrote:
> >On Mon, Jul 26, 2010 at 08:41:19AM +0200, Patrick Gundlach wrote:
> >>Hi,
> >>
> >>>But you can still use them as TFM fonts, nothing changed here.
> >>
> >>But you do have to deal with encodings, and have to "install" the font.
> >>
> >>My customers demand Type1 fonts 50% of the time. (But I am using my own font subsystem anyway - I don't have extra code in there for type 1 fonts, they "just" work, so I wonder what the reason is for dropping type1 support.)
> >
> >We, luaotfload and fontspec, never supported Type1 fonts to drop it,
> >ConTeXt does but this is a different matter. Type1 fonts are useless to
> >me (Arabic non-smart fonts need more additional work than merely being
> >able to load them), so I, myself, have no real interest in it.
> 
> Thanks for your reply, Kahled.
> 
> Sorry, I don't understand that fontspec never supported Type1 fonts.
> I have been using the Type1 font as any other system font thanks to
> fontspec (version 1) in XeLaTeX.

Interesting, I was under impression that XeTeX does not support Type1
system fonts, so my statement above only applies to
fontspec/luaotfload/luatex stack.

> >Nobody is producing new Type1 fonts, except in TeX, and there are tools
> >and existing macro packages that handle such fonts, one can still use
> >them in LuaTeX.
> 
> Does any of them allow the use of the Type1 font without having to
> install it for (Lua)TeX?

I don't think so.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From luatex at nililand.de  Tue Jul 27 10:15:19 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 27 Jul 2010 10:15:19 +0200
Subject: [luatex] letterspacing in LuaTeX
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
	<1q27f12sylfbi$.dlg@nililand.de> <4C4D9B5B.6090601@elvenkind.com>
	<w622ppk7fvrz$.dlg@nililand.de> <4C4DF9CF.1030109@web.de>
Message-ID: <q9vgb5el856z$.dlg@nililand.de>

Am Mon, 26 Jul 2010 23:10:39 +0200 schrieb Pablo Rodr?guez:


>> \documentclass[10pt]{book}
>> \usepackage{soul}
>> \makeatletter
>> \showboxdepth=100
>> \def\SOUL at doword{%
>>      \edef\x{\the\SOUL at word}%
>>      \ifx\x\empty
>>      \else
>>          \SOUL at buffer={}%
>>          \setbox\z@\vbox{%
>>              \SOUL at tt
>>              \hyphenchar\font`\-
>>              \hfuzz\maxdimen
>>              \hbadness\@M
>>              \pretolerance\m at ne
>>         %     \tolerance\@M %<--------------
>>              \leftskip\z@
>>              \rightskip\z@
>>              \hsize1sp
>>              \everypar{}%
>>              \parfillskip\z@\@plus1fil
>>              \hyphenpenalty-\@M
>>              \noindent
>>              \hskip\z@
>>              \relax
>>              \the\SOUL at word}%
>>          \showbox\z@    %<------show
>>          \let\SOUL at errmsg\SOUL at error
>>          \let\-\relax
>>          \count@\m at ne
>>          \SOUL at analyze
>>          \SOUL at word={}%
>>      \fi
>> }
>>
>>
>> \begin{document}
>> \so{a}
>> \end{document}


> If the above document is supposed to work, I'm afraid it doesn't.

Well _this_ document is meant to work in the sense the \so doesn't
give an error. But it will not run unattended as it will stop at the
\showbox\z@ and wait that you hit "enter". And I also don't know
what removing the \tolerance setting means to soul. Probably it will
find less break points. 

The other document wasn't meant to work, it should only show the
content of the boxes involved.


-- 
Ulrike Fischer 


From patrick at gundla.ch  Tue Jul 27 10:38:44 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 27 Jul 2010 10:38:44 +0200
Subject: [luatex] topskip
Message-ID: <209F60BC-F811-4B83-9D15-D12CBA47E4F9@gundla.ch>

Hi,

is there a Lua way of saying

\topskip=0pt

?

The manual tells me that these glue parameters are read only (4.12.1.4).



Patrick



From patrick at gundla.ch  Tue Jul 27 11:26:30 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 27 Jul 2010 11:26:30 +0200
Subject: [luatex] tex.setskip
Message-ID: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>

I wonder what is wrong with this texfile:

-----------------------------------------------------------------------------
\catcode`\{=1
\catcode`\}=2

\directlua{

  local myskip = node.new("glue",0)
  myskip.spec  = node.new("glue_spec")
  myskip.spec.width   = tex.sp("20pt")
  
  tex.setskip(5,myskip)

}

\end
-----------------------------------------------------------------------------


$ luatex --ini foo.tex 
This is LuaTeX, Version beta-0.60.1-2010052011 (TeX Live 2010/pretest) (rev 3685)  (INITEX)
 restricted \write18 enabled.
(./foo.tex
! LuaTeX error <\directlua >:1: incorrect value
stack traceback:
	[C]: in function 'setskip'
	<\directlua >:1: in main chunk.
l.13 }
      
? x


Patrick




From zappathustra at free.fr  Tue Jul 27 11:47:47 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 27 Jul 2010 11:47:47 +0200
Subject: [luatex] tex.setskip
In-Reply-To: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>
References: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>
Message-ID: <1280224067.4c4eab434e029@imp.free.fr>

You should use tex.setskip(5,myskip.spec).

Best,
Paul

Selon Patrick Gundlach <patrick at gundla.ch>:

> I wonder what is wrong with this texfile:
>
> -----------------------------------------------------------------------------
> \catcode`\{=1
> \catcode`\}=2
>
> \directlua{
>
>   local myskip = node.new("glue",0)
>   myskip.spec  = node.new("glue_spec")
>   myskip.spec.width   = tex.sp("20pt")
>
>   tex.setskip(5,myskip)
>
> }
>
> \end
> -----------------------------------------------------------------------------
>
>
> $ luatex --ini foo.tex
> This is LuaTeX, Version beta-0.60.1-2010052011 (TeX Live 2010/pretest) (rev
> 3685)  (INITEX)
>  restricted \write18 enabled.
> (./foo.tex
> ! LuaTeX error <\directlua >:1: incorrect value
> stack traceback:
> 	[C]: in function 'setskip'
> 	<\directlua >:1: in main chunk.
> l.13 }
>
> ? x
>
>
> Patrick
>
>
>
>



From patrick at gundla.ch  Tue Jul 27 11:55:39 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 27 Jul 2010 11:55:39 +0200
Subject: [luatex] tex.setskip
In-Reply-To: <1280224067.4c4eab434e029@imp.free.fr>
References: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>
	<1280224067.4c4eab434e029@imp.free.fr>
Message-ID: <FDAC037F-7771-4AB7-84E6-8A54140042F2@gundla.ch>

Hi Paul,


> You should use tex.setskip(5,myskip.spec).

Yes... (I need a course on "reading documentation").


Thanks!

Patrick


From zappathustra at free.fr  Tue Jul 27 12:14:52 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 27 Jul 2010 12:14:52 +0200
Subject: [luatex] tex.setskip
In-Reply-To: <FDAC037F-7771-4AB7-84E6-8A54140042F2@gundla.ch>
References: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>
	<1280224067.4c4eab434e029@imp.free.fr>
	<FDAC037F-7771-4AB7-84E6-8A54140042F2@gundla.ch>
Message-ID: <1280225692.4c4eb19ccc981@imp.free.fr>

Selon Patrick Gundlach <patrick at gundla.ch>:

> > You should use tex.setskip(5,myskip.spec).
>
> Yes... (I need a course on "reading documentation").


The glue_spec as nodes to glue nodes are a bit confusing, I think. But the
manual (to version 0.60.2) states that in the future "the glue fields themselves
will become part of the nodes referencing glue items", which means, if I get it
right (I'm not certain), that glue nodes will have those fields directly (i.e.
<glue node>.width, <glue node>.stretch_order, etc.).

By the way, browsing the manual, I find on page 156 that the glue subtype 103 is
"\aleaders". Is it a typo for "\gleaders" (the new LuaTeX leaders, which aren't
referenced here), or what are \aleaders?

Best,
Paul


From taco at elvenkind.com  Tue Jul 27 12:18:09 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 27 Jul 2010 12:18:09 +0200
Subject: [luatex] topskip
In-Reply-To: <209F60BC-F811-4B83-9D15-D12CBA47E4F9@gundla.ch>
References: <209F60BC-F811-4B83-9D15-D12CBA47E4F9@gundla.ch>
Message-ID: <4C4EB261.6070300@elvenkind.com>

On 07/27/2010 10:38 AM, Patrick Gundlach wrote:
> Hi,
>
> is there a Lua way of saying
>
> \topskip=0pt

Not until one minute ago (in trunk #3752)

Best wishes,
Taco

From taco at elvenkind.com  Tue Jul 27 12:18:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 27 Jul 2010 12:18:37 +0200
Subject: [luatex] tex.setskip
In-Reply-To: <1280225692.4c4eb19ccc981@imp.free.fr>
References: <30B26089-9827-437A-9F8E-BC9E6F616050@gundla.ch>	<1280224067.4c4eab434e029@imp.free.fr>	<FDAC037F-7771-4AB7-84E6-8A54140042F2@gundla.ch>
	<1280225692.4c4eb19ccc981@imp.free.fr>
Message-ID: <4C4EB27D.4030408@elvenkind.com>

On 07/27/2010 12:14 PM, Paul Isambert wrote:
>
> By the way, browsing the manual, I find on page 156 that the glue subtype 103 is
> "\aleaders". Is it a typo for "\gleaders" (the new LuaTeX leaders, which aren't
> referenced here), or what are \aleaders?

Typo, should be gleaders indeed.

Best wishes,
Taco

From taco at elvenkind.com  Tue Jul 27 15:23:32 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 27 Jul 2010 15:23:32 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4DFF5B.9020601@arcor.de>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
	<4C4DEBCA.3080504@elvenkind.com> <4C4DFF5B.9020601@arcor.de>
Message-ID: <4C4EDDD4.2030509@elvenkind.com>


Hi,

On 07/26/2010 11:34 PM, Ulrik Vieth wrote:
> On 07/26/2010 10:10 PM, taco wrote:
>> Khaled Hosny wrote:
>>>
>>>> Rendering issues (ConTeXt and LuaLaTeX):
>>>>
>>>> - Asana-Math displaystyle delimiters appear in extensible version
>>>> -> open, unresolved, possibly also a font bug
>>>
>>> I think it might be an engine issue, I recall having the same problem
>>> with Neo Euler until I disable the extensible integrals (I think other
>>> fonts have no extensible integrals so the issue is hidden).
>>
>> Is there a small test file for this (preferably in ConTeXt or
>> plain luatex?)
>
> Enclosed is a Context test file and the log file with \tracingoutput.

Ok, thanks. I found and corrected a bug in luatex: the last 'single'
glyph in a chained list was always ignored because the fact that it
had extensible tags took precedence over its actual size.

Hans and I never noticed because both Cambria and LatinModern have
single delimiters up to such a large size that the visual difference
becomes negligible.

Best wishes,
Taco

From zappathustra at free.fr  Tue Jul 27 18:01:21 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 27 Jul 2010 18:01:21 +0200
Subject: [luatex] node.insert_before
Message-ID: <1280246481.4c4f02d19ea57@imp.free.fr>

Hello all,

I'm trying to understand how node.insert_before works when <current> is the
head.

I think I understand insert_after:

\setbox0=\vbox{\hbox{a}\hbox{b}}
\setbox1=\hbox{x}

\directlua{%
   mybox = node.new(0)
   mybox = node.hpack(tex.box[1].list)
   node.insert_after(tex.box[0].list, tex.box[0].list, mybox)
   }

\box0
\bye

This correctly inserts "x" just below "a". If I replace the insertion by

node.insert_before(tex.box[0].list, tex.box[0].list.next, mybox)

the same thing occurs, which makes sense: "x" is inserted before "a"'s next,
i.e. before \baselineskip. However this doesn't work:

node.insert_before(tex.box[0].list, tex.box[0].list, mybox)

the intended output being "x" on top of "a". It doesn't work either when
inserting "manually", i.e. by reassigning prev's and next's. Does this mean that
one can't insert before a list's head? And if so, how should one achieve a
similar effect?

Best,
Paul

From taco at elvenkind.com  Tue Jul 27 19:02:04 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 27 Jul 2010 19:02:04 +0200
Subject: [luatex] node.insert_before
In-Reply-To: <1280246481.4c4f02d19ea57@imp.free.fr>
References: <1280246481.4c4f02d19ea57@imp.free.fr>
Message-ID: <4C4F110C.3050600@elvenkind.com>

On 07/27/2010 06:01 PM, Paul Isambert wrote:
>
> node.insert_before(tex.box[0].list, tex.box[0].list.next, mybox)
>
> the same thing occurs, which makes sense: "x" is inserted before "a"'s next,
> i.e. before \baselineskip. However this doesn't work:
>
> node.insert_before(tex.box[0].list, tex.box[0].list, mybox)

The reason why this does not work is that the list node is a child
of a box, but insert_before() only sees that actual list node. The
pointer from the box to the node that is the head of the list is
unreachable to the function (I hope this is clear enough).

An extra

   tex.box[0].list = mybox

following the insert_before() is needed to create the new
parent->child relation.

Best wishes,
Taco


From pragma at wxs.nl  Tue Jul 27 19:26:13 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 27 Jul 2010 19:26:13 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4DF6EA.5030807@web.de>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>
	<4C4DF6EA.5030807@web.de>
Message-ID: <4C4F16B5.6030706@wxs.nl>

On 26-7-2010 10:58, Pablo Rodr?guez wrote:

> Sorry, but I'm afraid I don't get your point here (sorry if I
> misunderstood your comment).

font expansion can be tuned in several ways:

- the number of steps
- factors per glyph

the first one is not that relevant as in the current expansion machinery 
each 'line' gets an expansion factor that gets applied to all glyphs in 
that line

however, if you assign different ef codes to glyphs it might be that 
within a line there are many changes in horizontal scaling

now, in pdftex, pseudo fonts are uses, so there many steps lead to many 
font instances being included, while in luatex the font is included once 
and transform matrices are injected ... the trade off is hard to 
predict, but when it was introduced we did experiments that actually 
gave smaller files so it all depends on the circumstances

there are a couple of other approaches to hz like optimization but 
that's beyond this thread

in luatex we try to keep things clean and simple and the current 
approach qualifies as such; of course we can try to minimize a couple of 
side effects (for instance of scaling) when they don't interfere with 
what you get on paper, so future versions might produce smaller files; 
but it's not a priority

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Jul 27 19:29:02 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 27 Jul 2010 19:29:02 +0200
Subject: [luatex] topskip
In-Reply-To: <209F60BC-F811-4B83-9D15-D12CBA47E4F9@gundla.ch>
References: <209F60BC-F811-4B83-9D15-D12CBA47E4F9@gundla.ch>
Message-ID: <4C4F175E.2050102@wxs.nl>

On 27-7-2010 10:38, Patrick Gundlach wrote:
> Hi,
>
> is there a Lua way of saying
>
> \topskip=0pt

some gluespec are, that is, 0pt is one of those predefined ones, so you 
cannot change that gluespec (there is a writable flag test for that)
if you set a glue, best assign a copy of the gluespec and change values 
in the copy; gluespecs are shares and have their own nasty pending  buglets

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From zappathustra at free.fr  Tue Jul 27 20:01:42 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 27 Jul 2010 20:01:42 +0200
Subject: [luatex] node.insert_before
In-Reply-To: <4C4F110C.3050600@elvenkind.com>
References: <1280246481.4c4f02d19ea57@imp.free.fr>
	<4C4F110C.3050600@elvenkind.com>
Message-ID: <1280253702.4c4f1f0644df1@imp.free.fr>

Selon Taco Hoekwater <taco at elvenkind.com>:

> On 07/27/2010 06:01 PM, Paul Isambert wrote:
> >
> > node.insert_before(tex.box[0].list, tex.box[0].list.next, mybox)
> >
> > the same thing occurs, which makes sense: "x" is inserted before "a"'s
> next,
> > i.e. before \baselineskip. However this doesn't work:
> >
> > node.insert_before(tex.box[0].list, tex.box[0].list, mybox)
>
> The reason why this does not work is that the list node is a child
> of a box, but insert_before() only sees that actual list node. The
> pointer from the box to the node that is the head of the list is
> unreachable to the function (I hope this is clear enough).

Crystal clear. Node manipulations now reach the towering number of 2 in my
output routines. I love it.

Thank you,
Paul



From ulrik.vieth at arcor.de  Wed Jul 28 02:00:30 2010
From: ulrik.vieth at arcor.de (Ulrik Vieth)
Date: Wed, 28 Jul 2010 02:00:30 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4EDDD4.2030509@elvenkind.com>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
	<4C4DEBCA.3080504@elvenkind.com> <4C4DFF5B.9020601@arcor.de>
	<4C4EDDD4.2030509@elvenkind.com>
Message-ID: <4C4F731E.20806@arcor.de>

On 07/27/2010 03:23 PM, Taco Hoekwater wrote:
> Ok, thanks. I found and corrected a bug in luatex: the last 'single'
> glyph in a chained list was always ignored because the fact that it
> had extensible tags took precedence over its actual size.

Hi Taco,

just out of curiosity: How do you actually debug such issues?
Are there extra tracing hooks in LuaTeX you can activate?
Do you compile a special version with extra debug prints?
Do you single-step through the TeX engine in a debugger?

Is there anything, we could use as well to diagnose problems?

Regards,
Ulrik

From oinos at web.de  Wed Jul 28 07:17:00 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Wed, 28 Jul 2010 07:17:00 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <q9vgb5el856z$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>	<1q27f12sylfbi$.dlg@nililand.de>
	<4C4D9B5B.6090601@elvenkind.com>	<w622ppk7fvrz$.dlg@nililand.de>
	<4C4DF9CF.1030109@web.de> <q9vgb5el856z$.dlg@nililand.de>
Message-ID: <4C4FBD4C.7010805@web.de>

On 07/27/2010 10:15 AM, Ulrike Fischer wrote:
> Am Mon, 26 Jul 2010 23:10:39 +0200 schrieb Pablo Rodr?guez:
>
>>> [...]
>
>> If the above document is supposed to work, I'm afraid it doesn't.
>
> Well _this_ document is meant to work in the sense the \so doesn't
> give an error. But it will not run unattended as it will stop at the
> \showbox\z@ and wait that you hit "enter". And I also don't know
> what removing the \tolerance setting means to soul. Probably it will
> find less break points.

Thanks for the reply, Ulrike.

It doesn't work with Greek text and other non-ASCII characters.

Thanks again,


Pablo

From taco at elvenkind.com  Wed Jul 28 08:06:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Jul 2010 08:06:37 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4F731E.20806@arcor.de>
References: <4C4D4E0E.5070004@elvenkind.com> <4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
	<4C4DEBCA.3080504@elvenkind.com> <4C4DFF5B.9020601@arcor.de>
	<4C4EDDD4.2030509@elvenkind.com> <4C4F731E.20806@arcor.de>
Message-ID: <4C4FC8ED.307@elvenkind.com>

On 07/28/2010 02:00 AM, Ulrik Vieth wrote:
> On 07/27/2010 03:23 PM, Taco Hoekwater wrote:
>> Ok, thanks. I found and corrected a bug in luatex: the last 'single'
>> glyph in a chained list was always ignored because the fact that it
>> had extensible tags took precedence over its actual size.
>
> Hi Taco,
>
> just out of curiosity: How do you actually debug such issues?
> Are there extra tracing hooks in LuaTeX you can activate?
> Do you compile a special version with extra debug prints?
> Do you single-step through the TeX engine in a debugger?

Any and all of the above, but mostly by using the gdb debugger and
valgrind (http://valgrind.org/) on a minimal input file. Font
issues start with fontforge to check the font itself, just in case.
Actual luatex crashes always start with a valgrind run, because
most often these are caused by some kind of memory allocation error.

It helps that I know a lot of the luatex code by heart, so that I
normally know what code to check beforehand, and in the cases where
I am not very familiar with the code I usually delegate the
problem to Hartmut.

My local version of luatex is always compiled without optimizations
and with all possible compiler warnings turned on, and the build.sh
script supports a --make option that makes it recompile only the
needed C files.

> Is there anything, we could use as well to diagnose problems?

For actual debugging, it depends on how brave you are, debugging
something as large as luatex is definitely not for the faint of
heart. When trying to diagnose problems, a minimal test file is
always needed, so it helps a lot if there was such a file included
in the bug report.

Best wishes,
Taco



From luatex at nililand.de  Wed Jul 28 09:34:07 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 28 Jul 2010 09:34:07 +0200
Subject: [luatex] letterspacing in LuaTeX
References: <4C4C0AEB.6040408@web.de> <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
	<1q27f12sylfbi$.dlg@nililand.de> <4C4D9B5B.6090601@elvenkind.com>
	<w622ppk7fvrz$.dlg@nililand.de> <4C4DF9CF.1030109@web.de>
	<q9vgb5el856z$.dlg@nililand.de> <4C4FBD4C.7010805@web.de>
Message-ID: <15jd4w4h7j7yr$.dlg@nililand.de>

Am Wed, 28 Jul 2010 07:17:00 +0200 schrieb Pablo Rodr?guez:


>>> If the above document is supposed to work, I'm afraid it doesn't.

>> Well _this_ document is meant to work in the sense the \so doesn't
>> give an error. But it will not run unattended as it will stop at the
>> \showbox\z@ and wait that you hit "enter". And I also don't know
>> what removing the \tolerance setting means to soul. Probably it will
>> find less break points.
 
> Thanks for the reply, Ulrike.
 
> It doesn't work with Greek text and other non-ASCII characters.

I can't test greek here, but other non-ascii chars seems to work
fine if I set \SOUL at tt to a suitable mono font:


\documentclass[10pt]{book}
\usepackage{soul}
\usepackage{luaotfload}
\usepackage{fontspec}

\makeatletter
 \font\SOUL at tt="DejaVu Sans
Mono"\setbox\z@\hbox{\SOUL at tt-}\SOUL at ttwidth\wd\z@
\def\SOUL at doword{%
    \edef\x{\the\SOUL at word}%
    \ifx\x\empty
    \else
        \SOUL at buffer={}%
        \setbox\z@\vbox{%
            \SOUL at tt
            \hyphenchar\font`\-
            \hfuzz\maxdimen
            \hbadness\@M
            \pretolerance\m at ne
       %     \tolerance\@M %<--------------
            \leftskip\z@
            \rightskip\z@
            \hsize1sp
            \everypar{}%
            \parfillskip\z@\@plus1fil
            \hyphenpenalty-\@M
            \noindent
            \hskip\z@
            \relax
            \the\SOUL at word}%
        %\showbox\z@    %<------showbox 
        \let\SOUL at errmsg\SOUL at error
        \let\-\relax
        \count@\m at ne
        \SOUL at analyze
        \SOUL at word={}%
    \fi
}
\makeatother

\begin{document}
\so{a??????}
\end{document}

-- 
Ulrike Fischer 


From khaledhosny at eglug.org  Wed Jul 28 09:40:54 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 28 Jul 2010 10:40:54 +0300
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <15jd4w4h7j7yr$.dlg@nililand.de>
References: <4C4C0E14.9010808@telecom-bretagne.eu>
	<4C4C0EBC.3040901@elvenkind.com> <4C4C187E.6080100@web.de>
	<1q27f12sylfbi$.dlg@nililand.de> <4C4D9B5B.6090601@elvenkind.com>
	<w622ppk7fvrz$.dlg@nililand.de> <4C4DF9CF.1030109@web.de>
	<q9vgb5el856z$.dlg@nililand.de> <4C4FBD4C.7010805@web.de>
	<15jd4w4h7j7yr$.dlg@nililand.de>
Message-ID: <20100728074053.GA15474@khaled-laptop>

On Wed, Jul 28, 2010 at 09:34:07AM +0200, Ulrike Fischer wrote:
> Am Wed, 28 Jul 2010 07:17:00 +0200 schrieb Pablo Rodr?guez:
> 
> 
> >>> If the above document is supposed to work, I'm afraid it doesn't.
> 
> >> Well _this_ document is meant to work in the sense the \so doesn't
> >> give an error. But it will not run unattended as it will stop at the
> >> \showbox\z@ and wait that you hit "enter". And I also don't know
> >> what removing the \tolerance setting means to soul. Probably it will
> >> find less break points.
>  
> > Thanks for the reply, Ulrike.
>  
> > It doesn't work with Greek text and other non-ASCII characters.
> 
> I can't test greek here, but other non-ascii chars seems to work
> fine if I set \SOUL at tt to a suitable mono font:

Since luatex master now have \letterspacefont fixed, have any one tried
it?


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Wed Jul 28 09:40:12 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Jul 2010 09:40:12 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <20100728074053.GA15474@khaled-laptop>
References: <4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>	<1q27f12sylfbi$.dlg@nililand.de>
	<4C4D9B5B.6090601@elvenkind.com>	<w622ppk7fvrz$.dlg@nililand.de>
	<4C4DF9CF.1030109@web.de>	<q9vgb5el856z$.dlg@nililand.de>
	<4C4FBD4C.7010805@web.de>	<15jd4w4h7j7yr$.dlg@nililand.de>
	<20100728074053.GA15474@khaled-laptop>
Message-ID: <4C4FDEDC.6040702@elvenkind.com>

On 07/28/2010 09:40 AM, Khaled Hosny wrote:
> On Wed, Jul 28, 2010 at 09:34:07AM +0200, Ulrike Fischer wrote:
>> Am Wed, 28 Jul 2010 07:17:00 +0200 schrieb Pablo Rodr?guez:
>>
>>
>>>>> If the above document is supposed to work, I'm afraid it doesn't.
>>
>>>> Well _this_ document is meant to work in the sense the \so doesn't
>>>> give an error. But it will not run unattended as it will stop at the
>>>> \showbox\z@ and wait that you hit "enter". And I also don't know
>>>> what removing the \tolerance setting means to soul. Probably it will
>>>> find less break points.
>>
>>> Thanks for the reply, Ulrike.
>>
>>> It doesn't work with Greek text and other non-ASCII characters.
>>
>> I can't test greek here, but other non-ascii chars seems to work
>> fine if I set \SOUL at tt to a suitable mono font:
>
> Since luatex master now have \letterspacefont fixed, have any one tried
> it?

There's going to be a beta release (0.61) later today.

Best wishes,
Taco

From ulrik.vieth at arcor.de  Wed Jul 28 11:49:06 2010
From: ulrik.vieth at arcor.de (ulrik.vieth at arcor.de)
Date: Wed, 28 Jul 2010 11:49:06 +0200 (CEST)
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <4C4FC8ED.307@elvenkind.com>
References: <4C4FC8ED.307@elvenkind.com> <4C4D4E0E.5070004@elvenkind.com>
	<4C4D49A2.6010308@elvenkind.com>
	<4C4D23CF.4010805@elvenkind.com> <4C4C893A.7010402@arcor.de>
	<4C4C9A91.6010106@wxs.nl>
	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>
	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>
	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>
	<20100726162940.GB4962@khaled-laptop>
	<4C4DEBCA.3080504@elvenkind.com> <4C4DFF5B.9020601@arcor.de>
	<4C4EDDD4.2030509@elvenkind.com> <4C4F731E.20806@arcor.de>
Message-ID: <11130634.1280310546179.JavaMail.ngmail@webmail12.arcor-online.net>

 ----- Original Nachricht ----
Von:     Taco Hoekwater <taco at elvenkind.com>
An:      Ulrik Vieth <ulrik.vieth at arcor.de>
Datum:   28.07.2010 08:06
Betreff: Re: [luatex] some bits of opentype math testing

> On 07/28/2010 02:00 AM, Ulrik Vieth wrote:
> 
> > Is there anything, we could use as well to diagnose problems?
> 
> For actual debugging, it depends on how brave you are, debugging
> something as large as luatex is definitely not for the faint of
> heart. When trying to diagnose problems, a minimal test file is
> always needed, so it helps a lot if there was such a file included
> in the bug report.

So there is no magic  \tracingwhatever we could turn on?

Regards, Ulrik

From pragma at wxs.nl  Wed Jul 28 12:33:40 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 28 Jul 2010 12:33:40 +0200
Subject: [luatex] some bits of opentype math testing
In-Reply-To: <11130634.1280310546179.JavaMail.ngmail@webmail12.arcor-online.net>
References: <4C4FC8ED.307@elvenkind.com>
	<4C4D4E0E.5070004@elvenkind.com>	<4C4D49A2.6010308@elvenkind.com>	<4C4D23CF.4010805@elvenkind.com>
	<4C4C893A.7010402@arcor.de>	<4C4C9A91.6010106@wxs.nl>	<22525889.1280129282553.JavaMail.ngmail@webmail13.arcor-online.net>	<1272175452.1280134305107.JavaMail.ngmail@webmail06.arcor-online.net>	<727361241.1280154903730.JavaMail.ngmail@webmail06.arcor-online.net>	<20100726162940.GB4962@khaled-laptop>	<4C4DEBCA.3080504@elvenkind.com>
	<4C4DFF5B.9020601@arcor.de>	<4C4EDDD4.2030509@elvenkind.com>
	<4C4F731E.20806@arcor.de>
	<11130634.1280310546179.JavaMail.ngmail@webmail12.arcor-online.net>
Message-ID: <4C500784.4030304@wxs.nl>

On 28-7-2010 11:49, ulrik.vieth at arcor.de wrote:
>
>   ----- Original Nachricht ----
> Von:     Taco Hoekwater<taco at elvenkind.com>
> An:      Ulrik Vieth<ulrik.vieth at arcor.de>
> Datum:   28.07.2010 08:06
> Betreff: Re: [luatex] some bits of opentype math testing
>
>> On 07/28/2010 02:00 AM, Ulrik Vieth wrote:
>>
>>> Is there anything, we could use as well to diagnose problems?
>>
>> For actual debugging, it depends on how brave you are, debugging
>> something as large as luatex is definitely not for the faint of
>> heart. When trying to diagnose problems, a minimal test file is
>> always needed, so it helps a lot if there was such a file included
>> in the bug report.
>
> So there is no magic  \tracingwhatever we could turn on?

Something \tracingbugs you mean -)

In context there is a lot of tracing code that we can use to look into 
node lists and so, but still one needs to know what to look for. There 
is also quite some font tracing code, but in the case it would probably 
not have helped much simply because when some output looks ok there is 
no reason to assume a bug. As we started with cambria it also means that 
this font becomes a benchmark which easily leads to the assumption that 
it has no problems.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wspr81 at gmail.com  Wed Jul 28 12:55:49 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Wed, 28 Jul 2010 20:25:49 +0930
Subject: [luatex] LuaTeX file almost 2.5x bigger
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl>
Message-ID: <i2p2bl$jao$1@dough.gmane.org>

On 2010-07-26 06:04:19 +0930, Hans Hagen 
<pragma at wxs.nl> said:

> For documents meant for reading from displays font expansion makes no 
> sense anyway (actually, in print it also is somewhat debatable as 
> abusing it makes things worse).

Not sure I agree with you here (or I at least don't understand you). 
Font expansion creates more readable paragraphs by producing lines with 
smaller \badness -- surely that's an advantage even on screen? Where 
does the nonsense come from? (Distorted glyphs? Reading PDF on screen 
in the first place?)

Will



From taco at elvenkind.com  Wed Jul 28 15:41:52 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 28 Jul 2010 15:41:52 +0200
Subject: [luatex] Luatex 0.61.0 announcement
Message-ID: <4C5033A0.5000700@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.61.0,
the first of the betas toward 0.70.0.

New features:

* New lua library 'epdf' for introspection of PDF inclusions,
   see the manual for details.

* Mplib version 1.502 is now included (which is still beta,
   so be careful).

* new "finish_pdffile" and "pre_dump" callbacks.

* new function pdf.pageref()

* In the lua 'tex' library: assignment to internal glue
   parameters is now allowed.

* New lua function tex.error().

Bugfixes:

* Fix for crashes on fonts with bad Panose values.

* Fix for a box placement bug that could sometimes cause text
   to overlap.

* Fix for a few small PDF/A1-a compatibility bugs.

* Fix \letterspacefont.

* Fix \Ustopdisplaymath in combination with aligned displays.

* In math delimiters, the last of a chain of predefined sizes
   was always ignored if there were also extensible parts.


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.61.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From joelcsalomon at gmail.com  Wed Jul 28 22:46:28 2010
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Wed, 28 Jul 2010 16:46:28 -0400
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <4C5033A0.5000700@elvenkind.com>
References: <4C5033A0.5000700@elvenkind.com>
Message-ID: <AANLkTika7UGyzju_BQN+jk_+nWiWcn0Orxg4OxuwUMm5@mail.gmail.com>

On Wed, Jul 28, 2010 at 9:41 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> I have just uploaded the archives for a new luatex release, 0.61.0,
> the first of the betas toward 0.70.0.
<snip>
> Bugfixes:
<snip>
> * Fix \Ustopdisplaymath in combination with aligned displays.

Is this the fix to the problem Khaled Hosny reported at
<http://tug.org/pipermail/luatex/2010-July/001739.html>?

If so, is there a way for me to use this version (as in lualatex) with
my current install of TeX Live 2010?

?Joel Salomon


From taco at elvenkind.com  Wed Jul 28 22:58:17 2010
From: taco at elvenkind.com (taco)
Date: Wed, 28 Jul 2010 22:58:17 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <AANLkTika7UGyzju_BQN+jk_+nWiWcn0Orxg4OxuwUMm5@mail.gmail.com>
References: <4C5033A0.5000700@elvenkind.com>
	<AANLkTika7UGyzju_BQN+jk_+nWiWcn0Orxg4OxuwUMm5@mail.gmail.com>
Message-ID: <4C5099E9.3090600@elvenkind.com>

Joel C. Salomon wrote:
> On Wed, Jul 28, 2010 at 9:41 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
>> I have just uploaded the archives for a new luatex release, 0.61.0,
>> the first of the betas toward 0.70.0.
> <snip>
>> Bugfixes:
> <snip>
>> * Fix \Ustopdisplaymath in combination with aligned displays.
> 
> Is this the fix to the problem Khaled Hosny reported at
> <http://tug.org/pipermail/luatex/2010-July/001739.html>?

Ehm, no. That bit of trouble is related to font metrics,
and has no relation to this bugfix at all, sorry. The bug
this fixes is reported here:

http://archive.contextgarden.net/message/20100727.122121.4a7c3d85.en.html

Best wishes,
Taco

From zappathustra at free.fr  Wed Jul 28 23:18:54 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 28 Jul 2010 23:18:54 +0200
Subject: [luatex] Luatex 0.61.0 announcement
Message-ID: <1280351934.4c509ebe6130d@imp.free.fr>

I have some remarks about the release, or rather the manual:

- First: thank you.
- Then: will there be in the future a more explicit descrition of the epdf
library, for those people who like to tweak pdf but are unable to find a
lepdflib.cc file, an unfortunate set of people of which I am a member?
- The finish_pdffile callback isn't documented.
- And (but that's not new) I can't seem to find the number of
(count/dimen/streams...) registers allowed in LuaTeX. Wouldn't it be nice to
have a page saying there are 6458954.5 count registers in LuaTeX, etc.?

Thanks again for the release.
Best,
Paul

From w.m.l at gmx.net  Thu Jul 29 04:21:46 2010
From: w.m.l at gmx.net (Robert)
Date: Thu, 29 Jul 2010 04:21:46 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C4C80C7.8080806@web.de>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<20100725172914.GA4906@khaled-laptop>	<4C4C7BB9.2030302@web.de>
	<20100725180640.GA5170@khaled-laptop> <4C4C80C7.8080806@web.de>
Message-ID: <i2qokc$9uj$1@dough.gmane.org>

On 25.07.10 20:21, Pablo Rodr?guez wrote:
> I'm not familiar with microtype. Thanks to a post from Ulrike Fischer,
> my settings are:
>
> \pdfprotrudechars2\pdfadjustspacing2
> \defaultfontfeatures{RawFeature={protrusion=default; expansion=default;},Mapping=tex-text,Scale=MatchLowercase}

The "default" expansion settings (which are defined in 
luaotfload/otfl-font-dum.lua) specify different expansion factors for 
different glyphs (so-called selected expansion). Apart from the fact 
that this is the reason why your pdf is blown up, it is not recommended 
(at least not by Han The Thanh) from a typographical point of view. So, 
to have all glyphs expanded by the same amount, you can use the 
following settings instead:

\pdfprotrudechars2
\pdfadjustspacing2
\directlua{
   fonts.expansion.setups['nonselected'] =
     { stretch = 2, shrink = 2, step = .1, factor = 1 } }
\defaultfontfeatures{RawFeature={protrusion=default; 
expansion=nonselected;}, Mapping=tex-text, Scale=MatchLowercase}



On 27.07.10 19:26, Hans Hagen wrote:
> now, in pdftex, pseudo fonts are uses, so there many steps lead to
> many font instances being included, while in luatex the font is
> included once and transform matrices are injected ...

Just for the record, pdftex also takes the textmatrix approach since v1.40.


Regards,
-- 
  Robert


From w.m.l at gmx.net  Thu Jul 29 05:22:59 2010
From: w.m.l at gmx.net (Robert)
Date: Thu, 29 Jul 2010 05:22:59 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <4C5033A0.5000700@elvenkind.com>
References: <4C5033A0.5000700@elvenkind.com>
Message-ID: <i2qs6n$hcj$1@dough.gmane.org>

On 28.07.10 15:41, Taco Hoekwater wrote:
> * Fix \letterspacefont.

It still fails with a "TeX capacity exceeded, sorry [max level recursion 
of virtual fonts=100]" on fonts loaded by luaotfload:

\input{luaotfload.sty}
\font\x="name:Latin Modern Roman" at 10pt \x
\letterspacefont\y\x 100
Lorem ipsum dolor sit amet,
\bye

I don't know whether this should be fixed on luatex's or on luaotfload's 
side.

Regards,
-- 
  Robert


From khaledhosny at eglug.org  Thu Jul 29 05:51:58 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jul 2010 06:51:58 +0300
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <i2qs6n$hcj$1@dough.gmane.org>
References: <4C5033A0.5000700@elvenkind.com>
 <i2qs6n$hcj$1@dough.gmane.org>
Message-ID: <20100729035157.GA29067@khaled-laptop>

On Thu, Jul 29, 2010 at 05:22:59AM +0200, Robert wrote:
> On 28.07.10 15:41, Taco Hoekwater wrote:
> >* Fix \letterspacefont.
> 
> It still fails with a "TeX capacity exceeded, sorry [max level
> recursion of virtual fonts=100]" on fonts loaded by luaotfload:
> 
> \input{luaotfload.sty}
> \font\x="name:Latin Modern Roman" at 10pt \x
> \letterspacefont\y\x 100
> Lorem ipsum dolor sit amet,
> \bye

The same with ConText (after commenting out the \input line).


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Thu Jul 29 07:46:27 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 29 Jul 2010 07:46:27 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <i2qs6n$hcj$1@dough.gmane.org>
References: <4C5033A0.5000700@elvenkind.com> <i2qs6n$hcj$1@dough.gmane.org>
Message-ID: <4C5115B3.8070001@elvenkind.com>

On 07/29/2010 05:22 AM, Robert wrote:
> On 28.07.10 15:41, Taco Hoekwater wrote:
>> * Fix \letterspacefont.
>
> It still fails with a "TeX capacity exceeded, sorry [max level recursion
> of virtual fonts=100]" on fonts loaded by luaotfload:
>
> \input{luaotfload.sty}
> \font\x="name:Latin Modern Roman" at 10pt \x
> \letterspacefont\y\x 100
> Lorem ipsum dolor sit amet,
> \bye
>
> I don't know whether this should be fixed on luatex's or on luaotfload's
> side.

I'll check the engine side first.

Best wishes,
Taco

From oinos at web.de  Thu Jul 29 08:20:17 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Thu, 29 Jul 2010 08:20:17 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i2qokc$9uj$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<20100725172914.GA4906@khaled-laptop>	<4C4C7BB9.2030302@web.de>	<20100725180640.GA5170@khaled-laptop>
	<4C4C80C7.8080806@web.de> <i2qokc$9uj$1@dough.gmane.org>
Message-ID: <4C511DA1.1040401@web.de>

On 07/29/2010 04:21 AM, Robert wrote:
> On 25.07.10 20:21, Pablo Rodr?guez wrote:
>> I'm not familiar with microtype. Thanks to a post from Ulrike Fischer,
>> my settings are:
>>
>> \pdfprotrudechars2\pdfadjustspacing2
>> \defaultfontfeatures{RawFeature={protrusion=default;
>> expansion=default;},Mapping=tex-text,Scale=MatchLowercase}
>
> The "default" expansion settings (which are defined in
> luaotfload/otfl-font-dum.lua) specify different expansion factors for
> different glyphs (so-called selected expansion). Apart from the fact
> that this is the reason why your pdf is blown up, it is not recommended
> (at least not by Han The Thanh) from a typographical point of view. So,
> to have all glyphs expanded by the same amount, you can use the
> following settings instead:
>
> \pdfprotrudechars2
> \pdfadjustspacing2
> \directlua{
> fonts.expansion.setups['nonselected'] =
> { stretch = 2, shrink = 2, step = .1, factor = 1 } }
> \defaultfontfeatures{RawFeature={protrusion=default;
> expansion=nonselected;}, Mapping=tex-text, Scale=MatchLowercase}

Many thanks for your help, Robert.

I'm afraid I get the following error with your code above:

! LuaTeX error <\directlua >:1: attempt to index field 'expansion' (a 
nil value
)
stack traceback:
	<\directlua >:1: in main chunk.
l.9 ... = 2, shrink = 2, step = .1, factor = 1 } }

What am I doing wrong? (I'm afraid it is all Greek to me ;-).)

Thanks again,


Pablo

From khaledhosny at eglug.org  Thu Jul 29 08:30:21 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jul 2010 09:30:21 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C511DA1.1040401@web.de>
References: <4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
	<20100725172914.GA4906@khaled-laptop> <4C4C7BB9.2030302@web.de>
	<20100725180640.GA5170@khaled-laptop> <4C4C80C7.8080806@web.de>
	<i2qokc$9uj$1@dough.gmane.org> <4C511DA1.1040401@web.de>
Message-ID: <20100729063021.GB4780@khaled-laptop>

On Thu, Jul 29, 2010 at 08:20:17AM +0200, Pablo Rodr?guez wrote:
> On 07/29/2010 04:21 AM, Robert wrote:
> >On 25.07.10 20:21, Pablo Rodr?guez wrote:
> >>I'm not familiar with microtype. Thanks to a post from Ulrike Fischer,
> >>my settings are:
> >>
> >>\pdfprotrudechars2\pdfadjustspacing2
> >>\defaultfontfeatures{RawFeature={protrusion=default;
> >>expansion=default;},Mapping=tex-text,Scale=MatchLowercase}
> >
> >The "default" expansion settings (which are defined in
> >luaotfload/otfl-font-dum.lua) specify different expansion factors for
> >different glyphs (so-called selected expansion). Apart from the fact
> >that this is the reason why your pdf is blown up, it is not recommended
> >(at least not by Han The Thanh) from a typographical point of view. So,
> >to have all glyphs expanded by the same amount, you can use the
> >following settings instead:
> >
> >\pdfprotrudechars2
> >\pdfadjustspacing2
> >\directlua{
> >fonts.expansion.setups['nonselected'] =
> >{ stretch = 2, shrink = 2, step = .1, factor = 1 } }
> >\defaultfontfeatures{RawFeature={protrusion=default;
> >expansion=nonselected;}, Mapping=tex-text, Scale=MatchLowercase}
> 
> Many thanks for your help, Robert.
> 
> I'm afraid I get the following error with your code above:
> 
> ! LuaTeX error <\directlua >:1: attempt to index field 'expansion'
> (a nil value
> )
> stack traceback:
> 	<\directlua >:1: in main chunk.
> l.9 ... = 2, shrink = 2, step = .1, factor = 1 } }
> 
> What am I doing wrong? (I'm afraid it is all Greek to me ;-).)

It should be "expansions" (plural).

If it is desirable, we can add this to luaotfload and call it "simple"
or something.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Thu Jul 29 09:06:57 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 29 Jul 2010 09:06:57 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <1280351934.4c509ebe6130d@imp.free.fr>
References: <1280351934.4c509ebe6130d@imp.free.fr>
Message-ID: <4C512891.30702@elvenkind.com>


Hi Paul,

On 07/28/2010 11:18 PM, Paul Isambert wrote:
> I have some remarks about the release, or rather the manual:
>
> - First: thank you.
> - Then: will there be in the future a more explicit descrition of the epdf
> library, for those people who like to tweak pdf but are unable to find a
> lepdflib.cc file, an unfortunate set of people of which I am a member?

This will certainly happen.

> - The finish_pdffile callback isn't documented.

Ok, will be added. It has no arguments or return values and runs just
before the output pdf is closed, iirc. Hartmut, can you add this to
the manual?

> - And (but that's not new) I can't seem to find the number of
> (count/dimen/streams...) registers allowed in LuaTeX. Wouldn't it be nice to
> have a page saying there are 6458954.5 count registers in LuaTeX, etc.?

   All traditional \TEX\ and \ETEX\ registers can be 16~bit numbers as in
   \ALEPH. The affected commands are:
   [...]

So there are 65536 counts/dimens etc.

Best wishes,
Taco

From khaledhosny at eglug.org  Thu Jul 29 09:17:20 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jul 2010 10:17:20 +0300
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <4C3D999B.7060905@elvenkind.com>
References: <4C3D6607.5040403@elvenkind.com> <i1jmmm$g2q$1@dough.gmane.org>
	<456904322.120081279102430840.JavaMail.ngmail@webmail07.arcor-online.net>
	<4C3D999B.7060905@elvenkind.com>
Message-ID: <20100729071720.GA6442@khaled-laptop>

On Wed, Jul 14, 2010 at 01:03:55PM +0200, Taco Hoekwater wrote:
> On 07/14/2010 12:13 PM, ulrik.vieth at arcor.de wrote:
> >>Ulrik, can you try this overbrace stuff in Word to see how it looks?
> >
> >Enclosed is a PDF from Word 2007 using CambriaMath.
> >
> >In Word, the overbrace stuff is hidden in the accents palette.
> >You can choose between a simple overbrace or and overbrace
> >with an extra group (which TeX typesets as \mathop\limits).
> >
> >Hope this helps to clarify your issues.
> 
> Thanks. It sure looks like I am misinterpreting something in
> the luatex implementation.

Also, the over and under delimeters are taken from the scriptfont, the
attached example shows:


Also, the over and under delimeters are taken from the scriptfont, the
attached example shows:


Also, the over and under delimeters are taken from the scriptfont, the
attached example shows:
..\hbox(14.29645+6.952)x12.96399, shifted 228.39551, direction TLT
...\vbox(14.29645+0.0)x6.482, direction TLT
....\hbox(5.852+0.0)x6.482, direction TLT
.....\sevenxits ??
....\kern1.5
....\hbox(6.94444+0.0)x6.482, direction TLT
.....\teni b
...\vbox(6.94444+6.952)x6.482, direction TLT
....\hbox(6.94444+0.0)x6.482, direction TLT
.....\teni b
....\kern5.377
....\hbox(0.623+0.952)x6.482, direction TLT
.....\sevenxits ??

(\sevenxits is the scriptscript font)

I don't recall noticing this before.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From zappathustra at free.fr  Thu Jul 29 09:52:20 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 29 Jul 2010 09:52:20 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <4C512891.30702@elvenkind.com>
References: <1280351934.4c509ebe6130d@imp.free.fr>
	<4C512891.30702@elvenkind.com>
Message-ID: <1280389940.4c513334d5ebc@imp.free.fr>

Selon Taco Hoekwater <taco at elvenkind.com>:
> > - Then: will there be in the future a more explicit descrition of the epdf
> > library, for those people who like to tweak pdf but are unable to find a
> > lepdflib.cc file, an unfortunate set of people of which I am a member?
>
> This will certainly happen.

Wondeful.

> > - The finish_pdffile callback isn't documented.
>
> Ok, will be added. It has no arguments or return values and runs just
> before the output pdf is closed, iirc. Hartmut, can you add this to
> the manual?

Judging from simple tests, it is called before the Catalog and Trailer (and
apparently font information too) are written to the pdf, which is nice to add
info that depends on variable in the document without manipulating the format's
ending command.


> > - And (but that's not new) I can't seem to find the number of
> > (count/dimen/streams...) registers allowed in LuaTeX. Wouldn't it be nice
> to
> > have a page saying there are 6458954.5 count registers in LuaTeX, etc.?
>
>    All traditional \TEX\ and \ETEX\ registers can be 16~bit numbers as in
>    \ALEPH. The affected commands are:
>    [...]
>
> So there are 65536 counts/dimens etc.

Oh. Next time I'll try to understand before asking...

Best,
Paul


From oinos at web.de  Thu Jul 29 19:51:49 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Thu, 29 Jul 2010 19:51:49 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100729063021.GB4780@khaled-laptop>
References: <4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<20100725172914.GA4906@khaled-laptop>
	<4C4C7BB9.2030302@web.de>	<20100725180640.GA5170@khaled-laptop>
	<4C4C80C7.8080806@web.de>	<i2qokc$9uj$1@dough.gmane.org>
	<4C511DA1.1040401@web.de> <20100729063021.GB4780@khaled-laptop>
Message-ID: <4C51BFB5.7010306@web.de>

On 07/29/2010 08:30 AM, Khaled Hosny wrote:
> On Thu, Jul 29, 2010 at 08:20:17AM +0200, Pablo Rodr?guez wrote:
>> [...]
>> I'm afraid I get the following error with your code above:
>> [...]
>>
>> What am I doing wrong? (I'm afraid it is all Greek to me ;-).)
>
> It should be "expansions" (plural).

Many thanks for your help, Kahled.

> If it is desirable, we can add this to luaotfload and call it "simple"
> or something.

I would agree with that (whichever the name might be).

Thanks again for your help,


Pablo

From khaledhosny at eglug.org  Thu Jul 29 20:02:17 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jul 2010 21:02:17 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C51BFB5.7010306@web.de>
References: <808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com>
	<20100725172914.GA4906@khaled-laptop> <4C4C7BB9.2030302@web.de>
	<20100725180640.GA5170@khaled-laptop> <4C4C80C7.8080806@web.de>
	<i2qokc$9uj$1@dough.gmane.org> <4C511DA1.1040401@web.de>
	<20100729063021.GB4780@khaled-laptop> <4C51BFB5.7010306@web.de>
Message-ID: <20100729180217.GA29086@khaled-laptop>

On Thu, Jul 29, 2010 at 07:51:49PM +0200, Pablo Rodr?guez wrote:
> On 07/29/2010 08:30 AM, Khaled Hosny wrote:
> >On Thu, Jul 29, 2010 at 08:20:17AM +0200, Pablo Rodr?guez wrote:
> >>[...]
> >>I'm afraid I get the following error with your code above:
> >>[...]
> >>
> >>What am I doing wrong? (I'm afraid it is all Greek to me ;-).)
> >
> >It should be "expansions" (plural).
> 
> Many thanks for your help, Kahled.
> 
> >If it is desirable, we can add this to luaotfload and call it "simple"
> >or something.
> 
> I would agree with that (whichever the name might be).
> 
> Thanks again for your help,

Does it help reducing the size of the file, is the output still OK?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From oinos at web.de  Thu Jul 29 20:21:31 2010
From: oinos at web.de (=?UTF-8?B?UGFibG8gUm9kcsOtZ3Vleg==?=)
Date: Thu, 29 Jul 2010 20:21:31 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100729180217.GA29086@khaled-laptop>
References: <808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<20100725172914.GA4906@khaled-laptop>
	<4C4C7BB9.2030302@web.de>	<20100725180640.GA5170@khaled-laptop>
	<4C4C80C7.8080806@web.de>	<i2qokc$9uj$1@dough.gmane.org>
	<4C511DA1.1040401@web.de>	<20100729063021.GB4780@khaled-laptop>
	<4C51BFB5.7010306@web.de> <20100729180217.GA29086@khaled-laptop>
Message-ID: <4C51C6AB.7000803@web.de>


On 07/29/2010 08:02 PM, Khaled Hosny wrote:
> On Thu, Jul 29, 2010 at 07:51:49PM +0200, Pablo Rodr?guez wrote:
>> On 07/29/2010 08:30 AM, Khaled Hosny wrote:
>>> On Thu, Jul 29, 2010 at 08:20:17AM +0200, Pablo Rodr?guez wrote:
>>>> [...]
>>>> I'm afraid I get the following error with your code above:
>>>> [...]
>>>>
>>>> What am I doing wrong? (I'm afraid it is all Greek to me ;-).)
>>>
>>> It should be "expansions" (plural).
>>
>> Many thanks for your help, Kahled.
>>
>>> If it is desirable, we can add this to luaotfload and call it "simple"
>>> or something.
>>
>> I would agree with that (whichever the name might be).
>>
>> Thanks again for your help,
>
> Does it help reducing the size of the file, is the output still OK?

Output seems to be fine, but I'm new to font expansion and 
microtypography in general, so my eye is not trained.

File size is the same as without font expansion enabled.


Pablo

From oinos at web.de  Thu Jul 29 20:36:36 2010
From: oinos at web.de (=?ISO-8859-15?Q?Pablo_Rodr=EDguez?=)
Date: Thu, 29 Jul 2010 20:36:36 +0200
Subject: [luatex] letterspacing in LuaTeX
In-Reply-To: <15jd4w4h7j7yr$.dlg@nililand.de>
References: <4C4C0AEB.6040408@web.de>
	<4C4C0E14.9010808@telecom-bretagne.eu>	<4C4C0EBC.3040901@elvenkind.com>
	<4C4C187E.6080100@web.de>	<1q27f12sylfbi$.dlg@nililand.de>
	<4C4D9B5B.6090601@elvenkind.com>	<w622ppk7fvrz$.dlg@nililand.de>
	<4C4DF9CF.1030109@web.de>	<q9vgb5el856z$.dlg@nililand.de>
	<4C4FBD4C.7010805@web.de> <15jd4w4h7j7yr$.dlg@nililand.de>
Message-ID: <4C51CA34.9000608@web.de>

On 07/28/2010 09:34 AM, Ulrike Fischer wrote:
> Am Wed, 28 Jul 2010 07:17:00 +0200 schrieb Pablo Rodr?guez:
>
>
>>>> If the above document is supposed to work, I'm afraid it doesn't.
>
>>> Well _this_ document is meant to work in the sense the \so doesn't
>>> give an error. But it will not run unattended as it will stop at the
>>> \showbox\z@ and wait that you hit "enter". And I also don't know
>>> what removing the \tolerance setting means to soul. Probably it will
>>> find less break points.
>
>> Thanks for the reply, Ulrike.
>
>> It doesn't work with Greek text and other non-ASCII characters.
>
> I can't test greek here, but other non-ascii chars seems to work
> fine if I set \SOUL at tt to a suitable mono font:

Many thanks for your help, Ulrike.

It works fine with Greek text, but it doesn't when the text is in a 
footnote.

Is there a fix for that?

Thanks for your help,


Pablo

From khaledhosny at eglug.org  Thu Jul 29 21:48:00 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 29 Jul 2010 22:48:00 +0300
Subject: [luatex] Why accessing font.fonts table is so slow?
Message-ID: <20100729194759.GA29605@khaled-laptop>

After struggling the whole day trying to figure out why my less than 300
lines of code are so slow, I found that all the slowness comes from
accessing font.fonts table, which would take from 0.02 to 0.07 seconds
each time, getting rid of that drops my test file from ~16 to ~2
seconds. Now I'm just wondering if this slowness is expected, and
wither it deserves a small warning in the manual (it would have saved my
day if I knew it beforehand), I read it is not a real table, but nothing
suggests the slowness I'm getting.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Fri Jul 30 09:07:49 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 30 Jul 2010 09:07:49 +0200
Subject: [luatex] Why accessing font.fonts table is so slow?
In-Reply-To: <20100729194759.GA29605@khaled-laptop>
References: <20100729194759.GA29605@khaled-laptop>
Message-ID: <4C527A45.1020407@elvenkind.com>

On 07/29/2010 09:48 PM, Khaled Hosny wrote:
> After struggling the whole day trying to figure out why my less than 300
> lines of code are so slow, I found that all the slowness comes from
> accessing font.fonts table, which would take from 0.02 to 0.07 seconds
> each time, getting rid of that drops my test file from ~16 to ~2
> seconds. Now I'm just wondering if this slowness is expected, and
> wither it deserves a small warning in the manual (it would have saved my
> day if I knew it beforehand), I read it is not a real table, but nothing
> suggests the slowness I'm getting.

I've added this paragraph to the manual:

Note that at the moment, each access to the \type{font.fonts} or call
to \type{font.getfont} creates a lua table for the whole font. This
process can be quite slow. In a later version of \LUATEX, this
interface will change (it will start using userdata objects instead of
actual tables).

Best wishes,
Taco


From khaledhosny at eglug.org  Fri Jul 30 09:19:19 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 30 Jul 2010 10:19:19 +0300
Subject: [luatex] Why accessing font.fonts table is so slow?
In-Reply-To: <4C527A45.1020407@elvenkind.com>
References: <20100729194759.GA29605@khaled-laptop>
	<4C527A45.1020407@elvenkind.com>
Message-ID: <20100730071919.GA2793@khaled-laptop>

On Fri, Jul 30, 2010 at 09:07:49AM +0200, Taco Hoekwater wrote:
> On 07/29/2010 09:48 PM, Khaled Hosny wrote:
> >After struggling the whole day trying to figure out why my less than 300
> >lines of code are so slow, I found that all the slowness comes from
> >accessing font.fonts table, which would take from 0.02 to 0.07 seconds
> >each time, getting rid of that drops my test file from ~16 to ~2
> >seconds. Now I'm just wondering if this slowness is expected, and
> >wither it deserves a small warning in the manual (it would have saved my
> >day if I knew it beforehand), I read it is not a real table, but nothing
> >suggests the slowness I'm getting.
> 
> I've added this paragraph to the manual:
> 
> Note that at the moment, each access to the \type{font.fonts} or call
> to \type{font.getfont} creates a lua table for the whole font. This
> process can be quite slow. In a later version of \LUATEX, this
> interface will change (it will start using userdata objects instead of
> actual tables).

Sounds good, thanks for the clarification.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Fri Jul 30 10:10:24 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 30 Jul 2010 11:10:24 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C51C6AB.7000803@web.de>
References: <20100725172914.GA4906@khaled-laptop> <4C4C7BB9.2030302@web.de>
	<20100725180640.GA5170@khaled-laptop> <4C4C80C7.8080806@web.de>
	<i2qokc$9uj$1@dough.gmane.org> <4C511DA1.1040401@web.de>
	<20100729063021.GB4780@khaled-laptop> <4C51BFB5.7010306@web.de>
	<20100729180217.GA29086@khaled-laptop> <4C51C6AB.7000803@web.de>
Message-ID: <20100730081024.GB2793@khaled-laptop>

On Thu, Jul 29, 2010 at 08:21:31PM +0200, Pablo Rodr?guez wrote:
> 
> On 07/29/2010 08:02 PM, Khaled Hosny wrote:
> >On Thu, Jul 29, 2010 at 07:51:49PM +0200, Pablo Rodr?guez wrote:
> >>On 07/29/2010 08:30 AM, Khaled Hosny wrote:
> >>>On Thu, Jul 29, 2010 at 08:20:17AM +0200, Pablo Rodr?guez wrote:
> >>>>[...]
> >>>>I'm afraid I get the following error with your code above:
> >>>>[...]
> >>>>
> >>>>What am I doing wrong? (I'm afraid it is all Greek to me ;-).)
> >>>
> >>>It should be "expansions" (plural).
> >>
> >>Many thanks for your help, Kahled.
> >>
> >>>If it is desirable, we can add this to luaotfload and call it "simple"
> >>>or something.
> >>
> >>I would agree with that (whichever the name might be).
> >>
> >>Thanks again for your help,
> >
> >Does it help reducing the size of the file, is the output still OK?
> 
> Output seems to be fine, but I'm new to font expansion and
> microtypography in general, so my eye is not trained.
> 
> File size is the same as without font expansion enabled.

So, what do, the more knowledgeable than me, others think, should that
be the default expansion setup?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From zappathustra at free.fr  Fri Jul 30 22:36:40 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 30 Jul 2010 22:36:40 +0200
Subject: [luatex] File I/O.
Message-ID: <1280522200.4c5337d8dd80f@imp.free.fr>

Hello all,

I'm sure I must have missed something in the manual. I'm totally unable to find
a way to say something like \write5{whatever} in a lua way. The texio.write
function writes only to the terminal or log, and my attempts at hooking lua
functions such as <file>:write() with <file> defined in a find_write_file
callback are unsuccessful, since it works iff I don't also write to the file
with TeX's \write.

So, to produce an intelligible question: how do you write to an external file
with in \directlua, or what is the lua equivalent of \write?

Best,
Paul


From luigi.scarso at gmail.com  Fri Jul 30 22:42:51 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 30 Jul 2010 22:42:51 +0200
Subject: [luatex] File I/O.
In-Reply-To: <1280522200.4c5337d8dd80f@imp.free.fr>
References: <1280522200.4c5337d8dd80f@imp.free.fr>
Message-ID: <AANLkTimVy1bes3i9iAoWLLLGg+wpoVfo6FVoOc6hTquB@mail.gmail.com>

On Fri, Jul 30, 2010 at 10:36 PM, Paul Isambert <zappathustra at free.fr> wrote:
> Hello all,
>
> I'm sure I must have missed something in the manual. I'm totally unable to find
> a way to say something like \write5{whatever} in a lua way. The texio.write
> function writes only to the terminal or log, and my attempts at hooking lua
> functions such as <file>:write() with <file> defined in a find_write_file
> callback are unsuccessful, since it works iff I don't also write to the file
> with TeX's \write.
>
> So, to produce an intelligible question: how do you write to an external file
> with in \directlua, or what is the lua equivalent of \write?
Perhaps
fd = io.open("mfyfile","wb")
fd:write(values)
fd:close()

?

-- 
luigi

From zappathustra at free.fr  Sat Jul 31 00:52:13 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 31 Jul 2010 00:52:13 +0200
Subject: [luatex] File I/O.
In-Reply-To: <AANLkTimVy1bes3i9iAoWLLLGg+wpoVfo6FVoOc6hTquB@mail.gmail.com>
References: <1280522200.4c5337d8dd80f@imp.free.fr>
	<AANLkTimVy1bes3i9iAoWLLLGg+wpoVfo6FVoOc6hTquB@mail.gmail.com>
Message-ID: <1280530333.4c53579d8bcfc@imp.free.fr>

Selon luigi scarso <luigi.scarso at gmail.com>:

> On Fri, Jul 30, 2010 at 10:36 PM, Paul Isambert <zappathustra at free.fr> wrote:
> > Hello all,
> >
> > I'm sure I must have missed something in the manual. I'm totally unable to
> find
> > a way to say something like \write5{whatever} in a lua way. The texio.write
> > function writes only to the terminal or log, and my attempts at hooking lua
> > functions such as <file>:write() with <file> defined in a find_write_file
> > callback are unsuccessful, since it works iff I don't also write to the
> file
> > with TeX's \write.
> >
> > So, to produce an intelligible question: how do you write to an external
> file
> > with in \directlua, or what is the lua equivalent of \write?
> Perhaps
> fd = io.open("mfyfile","wb")
> fd:write(values)
> fd:close()

Thank you Luigi, but it doesn't work: TeX's \write calls and the Lua calls are
incompatible, and the former overwrites the latter, unless "fd:close()" isn't
given, in which case Lua overwrites TeX.

Actually I can make do with

\newwrite\test
\directlua{%
  writetofile = function (message)
    tex.print("\luaescapestring{\write\test}{" .. message .. "}")
  end
  }

but it really seems archaic in view of what LuaTeX usually does. So does this
means there's no function like "tex.filewrite(n,message)" that would be totally
equivalent to (and compatible with) \write<n>{<message>}? I find it quite hard
to believe, which is why I still think I must have missed something in the
manual.

Best,
Paul

From taco at elvenkind.com  Sat Jul 31 08:44:06 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 31 Jul 2010 08:44:06 +0200
Subject: [luatex] File I/O.
In-Reply-To: <1280530333.4c53579d8bcfc@imp.free.fr>
References: <1280522200.4c5337d8dd80f@imp.free.fr>	<AANLkTimVy1bes3i9iAoWLLLGg+wpoVfo6FVoOc6hTquB@mail.gmail.com>
	<1280530333.4c53579d8bcfc@imp.free.fr>
Message-ID: <4C53C636.6070603@elvenkind.com>

On 07/31/2010 12:52 AM, Paul Isambert wrote:
>
> but it really seems archaic in view of what LuaTeX usually does. So does this
> means there's no function like "tex.filewrite(n,message)" that would be totally
> equivalent to (and compatible with) \write<n>{<message>}? I find it quite hard
> to believe, which is why I still think I must have missed something in the
> manual.

It really is archaic. You did not miss anything, somehow we forgot
to add write stream support to the texio library. I'll add a tracker
item for the next beta (it is actually quite trivial to implement).

Best wishes,
Taco

From pragma at wxs.nl  Sat Jul 31 12:14:20 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Sat, 31 Jul 2010 12:14:20 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i2p2bl$jao$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>
	<i2p2bl$jao$1@dough.gmane.org>
Message-ID: <4C53F77C.5030700@wxs.nl>

On 28-7-2010 12:55, Will Robertson wrote:
> On 2010-07-26 06:04:19 +0930, Hans Hagen <pragma at wxs.nl> said:
>
>> For documents meant for reading from displays font expansion makes no
>> sense anyway (actually, in print it also is somewhat debatable as
>> abusing it makes things worse).
>
> Not sure I agree with you here (or I at least don't understand you).
> Font expansion creates more readable paragraphs by producing lines with
> smaller \badness -- surely that's an advantage even on screen? Where
> does the nonsense come from? (Distorted glyphs? Reading PDF on screen in
> the first place?)

Displacement (and scaling) are normally less that pixel differences. 
Differently scaled glyphs in successive lines might stand out more on 
screen. Maybe if we have > 600 dpi screens ...

Concerning the badness ... there is some wishful thinking involved I 
guess ... when hz was introduced in pdftex we did experiments at 
usergroup meetings (each participant got its own randomized copy so no 
shared experiences).

The outcomes were interesting:

- We hadn't told that it was hz and protruding, just wanted to know 
opinions about side by side comparison.

- HZ samples not significantly percieved better. We did statistical 
analysis and the conclusion was that the rating was random.

- Protrusion was seen as a bug.

- Texies came with remarks about wrong penalties and spacing being set, 
of limited hyphenation patterns being used, rivers being seen ... 
basically coming up with reasons why paragraphs next to each other 
looked different but not per se better.

- No differences were see in many cases (we used 600 dpi high quality 
prints).

- Extremes like stretched wide o's in one line and shrunken ones in the 
following ones went unnoticed (so much for claims to see details).

When Thanh and I discussed that (at a Dante meeting) with Hermann Zapf 
he made the remark that probably 99% of the readers would not notice the 
difference. He also suggested that stretching lines vertically in order 
to get rid of widow lines was probably more effective. (I must have the 
tests done afterward somewhere.)

What was striking is that the fact that one uses an advanced engine like 
tex does not mean that the user is capable of seeing the difference. If 
someone shows me two versions of a document probably I cannot say with 
100% certainty which one has used hz.

The fact that we have an engine that can do all these things does not 
mean that we should always use it (the same is true for font features) 
and it also does not mean that users (and readers) see it .. anyway, one 
can use expansions and have maybe better paragraphs but with the wrong 
font and a messy layout it does not help much.

So, it all depends on factors like the font, amount of expansion, 
quality of print, rest of the layout, widths of columns, language 
(length of words, hyphenation etc influences solution space).

ps. See tex/context/samples/zapf.tex.

ps. I tend not to buy books that use expansion and inter character 
spacing trickery to the extreme as it distracts me too much

ps. Keep in mind that with for instance protrusion (and to some extend 
expansion) changes the solution space so we don't get better output. 
Also, expansion happens on a per-line base.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Sat Jul 31 12:30:56 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sat, 31 Jul 2010 13:30:56 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C53F77C.5030700@wxs.nl>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl> <i2p2bl$jao$1@dough.gmane.org>
	<4C53F77C.5030700@wxs.nl>
Message-ID: <20100731103056.GA30763@khaled-laptop>

On Sat, Jul 31, 2010 at 12:14:20PM +0200, Hans Hagen wrote:
> On 28-7-2010 12:55, Will Robertson wrote:
> >On 2010-07-26 06:04:19 +0930, Hans Hagen <pragma at wxs.nl> said:
> >
> >>For documents meant for reading from displays font expansion makes no
> >>sense anyway (actually, in print it also is somewhat debatable as
> >>abusing it makes things worse).
> >
> >Not sure I agree with you here (or I at least don't understand you).
> >Font expansion creates more readable paragraphs by producing lines with
> >smaller \badness -- surely that's an advantage even on screen? Where
> >does the nonsense come from? (Distorted glyphs? Reading PDF on screen in
> >the first place?)
> 
> Displacement (and scaling) are normally less that pixel differences.
> Differently scaled glyphs in successive lines might stand out more
> on screen. Maybe if we have > 600 dpi screens ...
> 
> Concerning the badness ... there is some wishful thinking involved I
> guess ... when hz was introduced in pdftex we did experiments at
> usergroup meetings (each participant got its own randomized copy so
> no shared experiences).

In case of Arabic (where there is no hyphenation, and the alternative
justification techniques are not implemented yet), I got ride of all the
overfull boxes in my document by enabling expansion alone, yet nobody
can notice it, which is good in my book.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From w.m.l at gmx.net  Sat Jul 31 17:34:11 2010
From: w.m.l at gmx.net (Robert)
Date: Sat, 31 Jul 2010 17:34:11 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C53F77C.5030700@wxs.nl>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>
	<4C53F77C.5030700@wxs.nl>
Message-ID: <i31fpk$2un$1@dough.gmane.org>

On 31.07.10 12:14, Hans Hagen wrote:
> Also, expansion happens on a per-line base.

If that were the case then expansion would indeed be rather useless. 
Fortunately, it is not true. Expansion takes place during 
paragraph-breaking, where even a minimal (that is, (almost) invisible) 
expansion amount may reduce the badness, the number of hyphenations, and 
overfull boxes quite substantially.

> - Protrusion was seen as a bug.

Then it was probably overdone (eg., hyphens protruding by their full width).

> - No differences were see in many cases (we used 600 dpi high quality
> prints).
>
> - Extremes like stretched wide o's in one line and shrunken ones in the
> following ones went unnoticed (so much for claims to see details).
>
> When Thanh and I discussed that (at a Dante meeting) with Hermann Zapf
> he made the remark that probably 99% of the readers would not notice the
> difference. He also suggested that stretching lines vertically in order
> to get rid of widow lines was probably more effective. (I must have the
> tests done afterward somewhere.)
>
> What was striking is that the fact that one uses an advanced engine like
> tex does not mean that the user is capable of seeing the difference. If
> someone shows me two versions of a document probably I cannot say with
> 100% certainty which one has used hz.

Which is what microtypography is all about: improving the visual 
appearance *without being noticeable*.

Regards,
-- 
  Robert


From taco at elvenkind.com  Sat Jul 31 17:58:24 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 31 Jul 2010 17:58:24 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i31fpk$2un$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>
	<i31fpk$2un$1@dough.gmane.org>
Message-ID: <4C544820.8050309@elvenkind.com>


Hi Robert,

On 07/31/2010 05:34 PM, Robert wrote:
>
>> - Protrusion was seen as a bug.
>
> Then it was probably overdone (eg., hyphens protruding by their full
> width).

Yeah, I agree with you on that. In fact, if protrusion is done somewhat
subtly, I really do see the paragraph as looking 'better'.

>> What was striking is that the fact that one uses an advanced engine like
>> tex does not mean that the user is capable of seeing the difference. If
>> someone shows me two versions of a document probably I cannot say with
>> 100% certainty which one has used hz.
>
> Which is what microtypography is all about: improving the visual
> appearance *without being noticeable*.

The thing is: the profound level of unnoticeable that came out of the
statistical tests for font expansion nullifies the 'improving the
visual appearance' goal. Wholly unnoticed improvements are not
actually improvements at all.

Best wishes,
Taco

From buliabyak at gmail.com  Sat Jul 31 19:02:00 2010
From: buliabyak at gmail.com (bulia byak)
Date: Sat, 31 Jul 2010 14:02:00 -0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C544820.8050309@elvenkind.com>
References: <4C4C1A14.5080004@web.de> <4C4C2EC7.3060209@elvenkind.com>
	<4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl> <i2p2bl$jao$1@dough.gmane.org>
	<4C53F77C.5030700@wxs.nl> <i31fpk$2un$1@dough.gmane.org>
	<4C544820.8050309@elvenkind.com>
Message-ID: <AANLkTinfvVpxSy=AhqkKtLMZRuwBt4Q+ce+y1JPKAC77@mail.gmail.com>

On Sat, Jul 31, 2010 at 12:58 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> The thing is: the profound level of unnoticeable that came out of the
> statistical tests for font expansion nullifies the 'improving the
> visual appearance' goal. Wholly unnoticed improvements are not
> actually improvements at all.

I doubt that. First of all, how much text was used in the comparisons?
I know that the impression from reading a single paragraph is quite
different from reading a whole book.

Then, I still disagree with your statement. There are many subtleties
in, for example, Shakespeare that 99% of readers will miss, but which,
when explained in footnotes, will be quite interesting for them and
which contribute to the perception of Shakespeare as a great poet.
Depth does not have to be obvious, but the knowledge that it's there -
even if you don't notice it yourself until pointed - can make a work
more enjoyable.

Finally, there's a purely pragmatic aspect. Even if we disregard human
perception, microtypography can result in denser typesetting and thus
less paper spent on printing a book.

-- 
bulia byak
Inkscape. Draw Freely.
http://www.inkscape.org

From w.m.l at gmx.net  Sat Jul 31 20:10:28 2010
From: w.m.l at gmx.net (Robert)
Date: Sat, 31 Jul 2010 20:10:28 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C544820.8050309@elvenkind.com>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>	<i31fpk$2un$1@dough.gmane.org>
	<4C544820.8050309@elvenkind.com>
Message-ID: <i31ouk$t83$1@dough.gmane.org>

On 31.07.10 17:58, Taco Hoekwater wrote:
>> Which is what microtypography is all about: improving the visual
>> appearance *without being noticeable*.
>
> The thing is: the profound level of unnoticeable that came out of the
> statistical tests for font expansion nullifies the 'improving the
> visual appearance' goal. Wholly unnoticed improvements are not
> actually improvements at all.

I don't believe that they go unnoticed. Less hyphenations are a clear 
improvement, less overfull boxes even more so. And I've come across a 
considerable number of statements along the lines: "Gosh, all them 
overfull boxes have vanished!"

My impression is that Hans may have been referring to the first tests, 
which you carried out at NTG and Dante in 1999, where *level 2* 
expansion wasn't available yet.

Best regards,
-- 
  Robert


