From zappathustra at free.fr  Sun Aug  1 11:46:15 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 11:46:15 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
Message-ID: <1280655975.4c554267669dc@imp.free.fr>

Hello all,

Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of course),
I was wondering whether there is any plan to give access to TeX's messages, e.g.
error messages or box reporting, and modify them. My idea is that it may be
interesting to have versions of TeX that speak any language, because those
messages could be written as one wishes. I imagine a kind of callback-like
interface, for instance (probably in a configuration file):

tex.internal_error("undefined_cs","Commande non d?finie")

would replace TeX's "Undefined control sequence" by the French message. The
impact would be somewhat limited, since anyway most people using TeX speak
English (they can't really do otherwise), but wouldn't it be worth trying? That
would be in line with turning from ASCII to Unicode. I haven't the least idea of
what implementing TeX features takes, but this one seems easy to my ignorant
eyes... although I understand the LuaTeX already has much on its plate! (By the
way, thanks Taco for taking into account the write issue.)

Best,
Paul


From khaledhosny at eglug.org  Sun Aug  1 12:06:38 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Aug 2010 13:06:38 +0300
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <1280655975.4c554267669dc@imp.free.fr>
References: <1280655975.4c554267669dc@imp.free.fr>
Message-ID: <20100801100638.GC2827@khaled-laptop>

On Sun, Aug 01, 2010 at 11:46:15AM +0200, Paul Isambert wrote:
> Hello all,
> 
> Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of course),
> I was wondering whether there is any plan to give access to TeX's messages, e.g.
> error messages or box reporting, and modify them. My idea is that it may be
> interesting to have versions of TeX that speak any language, because those
> messages could be written as one wishes. I imagine a kind of callback-like
> interface, for instance (probably in a configuration file):
> 
> tex.internal_error("undefined_cs","Commande non d?finie")
> 
> would replace TeX's "Undefined control sequence" by the French message. The
> impact would be somewhat limited, since anyway most people using TeX speak
> English (they can't really do otherwise), but wouldn't it be worth trying? That
> would be in line with turning from ASCII to Unicode. I haven't the least idea of
> what implementing TeX features takes, but this one seems easy to my ignorant
> eyes... although I understand the LuaTeX already has much on its plate! (By the
> way, thanks Taco for taking into account the write issue.)

I was thinking about localising TeX a while ago too, but I was thinking
in a more conventional way: using GNU gettext to localise TeX messages,
then the localisable strings can be extracted using gettext tools into a
regular PO file that people can translate, convert to MO files and
install alongside LuaTeX. But there might some issue that need to be
considered first e.g. should messages written into log be localised too?
Should there be an explicit switch to select locales or just use the
system locale etc.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Sun Aug  1 12:54:03 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sun, 01 Aug 2010 12:54:03 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <20100801100638.GC2827@khaled-laptop>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
Message-ID: <4C55524B.3090904@elvenkind.com>


Hi,

On 08/01/2010 12:06 PM, Khaled Hosny wrote:
> On Sun, Aug 01, 2010 at 11:46:15AM +0200, Paul Isambert wrote:
>> Hello all,
>>
>> Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of course),
>> I was wondering whether there is any plan to give access to TeX's messages,...
>>
>> tex.internal_error("undefined_cs","Commande non d?finie")
>>
>> would replace TeX's "Undefined control sequence" by the French message....
>
> I was thinking about localising TeX a while ago too, but I was thinking
> in a more conventional way: using GNU gettext to localise TeX messages,  ...

I am not a big fan of using gettext() because it is a nightmare on
Windows. But also, errors in TeX do not have names, and sometimes
the help text is the only difference between certain errors.

My actual plan is to create a callback function in luatex to actually
report the error to the user, and give to that function the formal
error message and the error help as arguments, as well as a hint
on how to handle user feedback. That way, lua code will be able
to hook in whatever translation and/or user response that is needed
(but it needs quite a bit of internal luatex reshuffling so this
will probably be for luatex 0.80)

Best wishes,
Taco

From khaledhosny at eglug.org  Sun Aug  1 13:14:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Aug 2010 14:14:49 +0300
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <4C55524B.3090904@elvenkind.com>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
Message-ID: <20100801111449.GA3725@khaled-laptop>

On Sun, Aug 01, 2010 at 12:54:03PM +0200, Taco Hoekwater wrote:
> 
> Hi,
> 
> On 08/01/2010 12:06 PM, Khaled Hosny wrote:
> >On Sun, Aug 01, 2010 at 11:46:15AM +0200, Paul Isambert wrote:
> >>Hello all,
> >>
> >>Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of course),
> >>I was wondering whether there is any plan to give access to TeX's messages,...
> >>
> >>tex.internal_error("undefined_cs","Commande non d?finie")
> >>
> >>would replace TeX's "Undefined control sequence" by the French message....
> >
> >I was thinking about localising TeX a while ago too, but I was thinking
> >in a more conventional way: using GNU gettext to localise TeX messages,  ...
> 
> I am not a big fan of using gettext() because it is a nightmare on
> Windows. But also, errors in TeX do not have names, and sometimes
> the help text is the only difference between certain errors.

I was also wondering how usable is gettext on Windows.

> My actual plan is to create a callback function in luatex to actually
> report the error to the user, and give to that function the formal
> error message and the error help as arguments, as well as a hint
> on how to handle user feedback. That way, lua code will be able
> to hook in whatever translation and/or user response that is needed
> (but it needs quite a bit of internal luatex reshuffling so this
> will probably be for luatex 0.80)

One of the strength points of gettext is its ability to handle some
relatively complex localisation tasks like plural forms or message
context etc. So my be by then one can find some lua-gettext module to
use :)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From luatex at nililand.de  Sun Aug  1 13:32:27 2010
From: luatex at nililand.de (Ulrike Fischer)
Date: Sun, 1 Aug 2010 13:32:27 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
References: <1280655975.4c554267669dc@imp.free.fr>
Message-ID: <14gdjxhhd4ozv$.dlg@nililand.de>

Am Sun, 01 Aug 2010 11:46:15 +0200 schrieb Paul Isambert:

> Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of course),
> I was wondering whether there is any plan to give access to TeX's messages, e.g.
> error messages or box reporting, and modify them. My idea is that it may be
> interesting to have versions of TeX that speak any language, because those
> messages could be written as one wishes.

Well I can understand that this would be useful for users who don't
speak english well. But one should not forget that log-file and
terminal message are not only for the users. They are also used to
get help and support either by showing other people the log or by
googling the error messages. So it should be easy to get the
standard terminal messages, and I would suggest that a "foreign" log
should be additional so that you get the standard english log and
eg. log-fr or log-de.

-- 
Ulrike Fischer 


From zappathustra at free.fr  Sun Aug  1 13:39:23 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 13:39:23 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <20100801111449.GA3725@khaled-laptop>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
	<20100801111449.GA3725@khaled-laptop>
Message-ID: <1280662763.4c555ceb70a51@imp.free.fr>

Selon Khaled Hosny <khaledhosny at eglug.org>:

> On Sun, Aug 01, 2010 at 12:54:03PM +0200, Taco Hoekwater wrote:
> >
> > Hi,
> >
> > On 08/01/2010 12:06 PM, Khaled Hosny wrote:
> > >On Sun, Aug 01, 2010 at 11:46:15AM +0200, Paul Isambert wrote:
> > >>Hello all,
> > >>
> > >>Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of
> course),
> > >>I was wondering whether there is any plan to give access to TeX's
> messages,...
> > >>
> > >>tex.internal_error("undefined_cs","Commande non d??finie")
> > >>
> > >>would replace TeX's "Undefined control sequence" by the French
> message....
> > >
> > >I was thinking about localising TeX a while ago too, but I was thinking
> > >in a more conventional way: using GNU gettext to localise TeX messages,
> ...
> >
> > I am not a big fan of using gettext() because it is a nightmare on
> > Windows. But also, errors in TeX do not have names, and sometimes
> > the help text is the only difference between certain errors.
>
> I was also wondering how usable is gettext on Windows.
>
> > My actual plan is to create a callback function in luatex to actually
> > report the error to the user, and give to that function the formal
> > error message and the error help as arguments, as well as a hint
> > on how to handle user feedback. That way, lua code will be able
> > to hook in whatever translation and/or user response that is needed
> > (but it needs quite a bit of internal luatex reshuffling so this
> > will probably be for luatex 0.80)
>
> One of the strength points of gettext is its ability to handle some
> relatively complex localisation tasks like plural forms or message
> context etc. So my be by then one can find some lua-gettext module to
> use :)

I have my doubts about gettext... because I don't know it :) (TeX is the only
language, if it is one, in which I can express myself rather clearly.) That's
not totally self-centered: TeX is hard enough, and with Lua on top of it  (or
below) it already becomes rather specialized, so I'll fear any additional
language will make it totally unreachable to most people, and I believe most
people should be able to use TeX more or less directly, for instance using
plain, and still benefit from what LuaTeX has to offer. So I vote for callbacks,
since it seems the easiest way around (a TeX primitive wouldn't be workable, I
suppose)and easily customizable by users.

Best,
Paul



From zappathustra at free.fr  Sun Aug  1 13:44:33 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 13:44:33 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <14gdjxhhd4ozv$.dlg@nililand.de>
References: <1280655975.4c554267669dc@imp.free.fr>
	<14gdjxhhd4ozv$.dlg@nililand.de>
Message-ID: <1280663073.4c555e21cf4a7@imp.free.fr>

Selon Ulrike Fischer <luatex at nililand.de>:

> Am Sun, 01 Aug 2010 11:46:15 +0200 schrieb Paul Isambert:
>
> > Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of
> course),
> > I was wondering whether there is any plan to give access to TeX's messages,
> e.g.
> > error messages or box reporting, and modify them. My idea is that it may be
> > interesting to have versions of TeX that speak any language, because those
> > messages could be written as one wishes.
>
> Well I can understand that this would be useful for users who don't
> speak english well. But one should not forget that log-file and
> terminal message are not only for the users. They are also used to
> get help and support either by showing other people the log or by
> googling the error messages. So it should be easy to get the
> standard terminal messages, and I would suggest that a "foreign" log
> should be additional so that you get the standard english log and
> eg. log-fr or log-de.

I don't know how gettext works, but with callbacks that would be quite easy:
change a file and you get messages in any language, including the original one.
Not to mention a command line option or a TeX primitive like \translatemessages
which when turned to 0 would disable message translation, for instance. And a
well-documented localised TeX should give the equivalence between translated
messages and original ones.

Best,
Paul


From khaledhosny at eglug.org  Sun Aug  1 13:50:51 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Aug 2010 14:50:51 +0300
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <1280662763.4c555ceb70a51@imp.free.fr>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
	<20100801111449.GA3725@khaled-laptop>
	<1280662763.4c555ceb70a51@imp.free.fr>
Message-ID: <20100801115051.GA4706@khaled-laptop>

On Sun, Aug 01, 2010 at 01:39:23PM +0200, Paul Isambert wrote:
> Selon Khaled Hosny <khaledhosny at eglug.org>:
> 
> > On Sun, Aug 01, 2010 at 12:54:03PM +0200, Taco Hoekwater wrote:
> > >
> > > Hi,
> > >
> > > On 08/01/2010 12:06 PM, Khaled Hosny wrote:
> > > >On Sun, Aug 01, 2010 at 11:46:15AM +0200, Paul Isambert wrote:
> > > >>Hello all,
> > > >>
> > > >>Since LuaTeX reaches down to TeX's most intimate parts (its bowels, of
> > course),
> > > >>I was wondering whether there is any plan to give access to TeX's
> > messages,...
> > > >>
> > > >>tex.internal_error("undefined_cs","Commande non d??finie")
> > > >>
> > > >>would replace TeX's "Undefined control sequence" by the French
> > message....
> > > >
> > > >I was thinking about localising TeX a while ago too, but I was thinking
> > > >in a more conventional way: using GNU gettext to localise TeX messages,
> > ...
> > >
> > > I am not a big fan of using gettext() because it is a nightmare on
> > > Windows. But also, errors in TeX do not have names, and sometimes
> > > the help text is the only difference between certain errors.
> >
> > I was also wondering how usable is gettext on Windows.
> >
> > > My actual plan is to create a callback function in luatex to actually
> > > report the error to the user, and give to that function the formal
> > > error message and the error help as arguments, as well as a hint
> > > on how to handle user feedback. That way, lua code will be able
> > > to hook in whatever translation and/or user response that is needed
> > > (but it needs quite a bit of internal luatex reshuffling so this
> > > will probably be for luatex 0.80)
> >
> > One of the strength points of gettext is its ability to handle some
> > relatively complex localisation tasks like plural forms or message
> > context etc. So my be by then one can find some lua-gettext module to
> > use :)
> 
> I have my doubts about gettext... because I don't know it :) (TeX is the only
> language, if it is one, in which I can express myself rather clearly.) That's
> not totally self-centered: TeX is hard enough, and with Lua on top of it  (or
> below) it already becomes rather specialized, so I'll fear any additional
> language will make it totally unreachable to most people, and I believe most
> people should be able to use TeX more or less directly, for instance using
> plain, and still benefit from what LuaTeX has to offer. So I vote for callbacks,
> since it seems the easiest way around (a TeX primitive wouldn't be workable, I
> suppose)and easily customizable by users.

If you are going to do any moderate sized translation project, you will
appreciate using standard translation tools and file formats. Also
gettext is just a C library to help l10n your application, no additional
language or anything, though I admit it is more complex, code wise, than
writing some lua code, but that complexity is no where near the
complexity of maintain translation in a non-standard method. Trust me,
I've been doing localisation for years and only gettext seems to get it
right (to the degree that I convert any text I'm to translate to a PO
file, even plain text).

Regards,
 Khaled


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Sun Aug  1 14:00:11 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Aug 2010 15:00:11 +0300
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <20100801115051.GA4706@khaled-laptop>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
	<20100801111449.GA3725@khaled-laptop>
	<1280662763.4c555ceb70a51@imp.free.fr>
	<20100801115051.GA4706@khaled-laptop>
Message-ID: <20100801120011.GA4755@khaled-laptop>

On Sun, Aug 01, 2010 at 02:50:51PM +0300, Khaled Hosny wrote:
> On Sun, Aug 01, 2010 at 01:39:23PM +0200, Paul Isambert wrote:
> > I have my doubts about gettext... because I don't know it :) (TeX is the only
> > language, if it is one, in which I can express myself rather clearly.) That's
> > not totally self-centered: TeX is hard enough, and with Lua on top of it  (or
> > below) it already becomes rather specialized, so I'll fear any additional
> > language will make it totally unreachable to most people, and I believe most
> > people should be able to use TeX more or less directly, for instance using
> > plain, and still benefit from what LuaTeX has to offer. So I vote for callbacks,
> > since it seems the easiest way around (a TeX primitive wouldn't be workable, I
> > suppose)and easily customizable by users.
> 
> If you are going to do any moderate sized translation project, you will
> appreciate using standard translation tools and file formats. Also
> gettext is just a C library to help l10n your application, no additional
> language or anything, though I admit it is more complex, code wise, than
> writing some lua code, but that complexity is no where near the
> complexity of maintain translation in a non-standard method. Trust me,
> I've been doing localisation for years and only gettext seems to get it
> right (to the degree that I convert any text I'm to translate to a PO
> file, even plain text).

Also, IIUC, Taco's plain is to just expose error message to lua, how
l10n is handled is left to the user (the package writer or whatever).


-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From martin at oneiros.de  Sun Aug  1 14:07:49 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 1 Aug 2010 14:07:49 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <4C55524B.3090904@elvenkind.com>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
Message-ID: <AANLkTin7A_LF199hai1=f1dxp-UC1TOkkKiQJmd5BJ+L@mail.gmail.com>

2010/8/1 Taco Hoekwater <taco at elvenkind.com>:
> My actual plan is to create a callback function in luatex to actually
> report the error to the user, and give to that function the formal
> error message and the error help as arguments, as well as a hint
> on how to handle user feedback. That way, lua code will be able
> to hook in whatever translation and/or user response that is needed
> (but it needs quite a bit of internal luatex reshuffling so this
> will probably be for luatex 0.80)

Nice idea.

In that context: There should be a callback for printing dimens to the
user, so that TeX can communicate in other units than pt (e.g. mm).

Best
   Martin

From zappathustra at free.fr  Sun Aug  1 14:22:04 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 14:22:04 +0200
Subject: [luatex] Translating TeX (obviously a feature request).
In-Reply-To: <AANLkTin7A_LF199hai1=f1dxp-UC1TOkkKiQJmd5BJ+L@mail.gmail.com>
References: <1280655975.4c554267669dc@imp.free.fr>
	<20100801100638.GC2827@khaled-laptop>
	<4C55524B.3090904@elvenkind.com>
	<AANLkTin7A_LF199hai1=f1dxp-UC1TOkkKiQJmd5BJ+L@mail.gmail.com>
Message-ID: <1280665324.4c5566ecaed6a@imp.free.fr>

Selon Martin Schr?der <martin at oneiros.de>:

> 2010/8/1 Taco Hoekwater <taco at elvenkind.com>:
> > My actual plan is to create a callback function in luatex to actually
> > report the error to the user, and give to that function the formal
> > error message and the error help as arguments, as well as a hint
> > on how to handle user feedback. That way, lua code will be able
> > to hook in whatever translation and/or user response that is needed
> > (but it needs quite a bit of internal luatex reshuffling so this
> > will probably be for luatex 0.80)
>
> Nice idea.
>
> In that context: There should be a callback for printing dimens to the
> user, so that TeX can communicate in other units than pt (e.g. mm).

Yes, I'd really appreciate that too. Since we're at it, the user could also
define its own unit which would be added to TeX's repertoire... or replace an
existing one, so that some people could even default the English point to the
PostScript point (i.e. pt to bp). But then, it looks like this feature request
turns into Pandora's box, if it wasn't a token of our appreciation for LuaTeX
(this to cheer Taco, if needed) :)

Best,
Paul


From zappathustra at free.fr  Sun Aug  1 18:50:33 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 18:50:33 +0200
Subject: [luatex] Input/output and encoding.
Message-ID: <1280681433.4c55a5d96b94f@imp.free.fr>

Hello again,

Please consider this document:

\directlua{%
 function convert(buf)
   return string.gsub(buf,"(.)",
                      function (ch) return unicode.utf8.char(string.byte(ch))
     end)
 end
 callback.register('process_input_buffer',convert)
 }

\immediate\openout0=\jobname.xxx
\immediate\write0{H?h?.}
\immediate\closeout0

\directlua{callback.register('process_input_buffer',nil)}
\input \jobname.xxx
\bye

The convert function (adapted from Elie Roux's luainputenc) converts input
character from latin1 to utf-8 (because I'm lost without my old TeXnicCenter,
which does latin1 - windows cp1252 actually, but anyway). It works very well.
However, LuaTeX still writes in utf-8, so the .xxx file is written in utf-8, and
it makes sense, at least to me, to remove the convert function in the callback
before \input'ing that file: it is written in utf-8, so no conversion is needed,
quite the contrary.

However, this doesn't return "H?h?", as I expected. Instead, the "e"'s with
acute accent are ignored, which means LuaTeX hasn't read the proper character.
Of course, if you don't delete the callback beforehand, it doesn't work either,
but that I understand.

I know I could also make LuaTeX write in latin1, which would make everything
simpler. However, I have no heart to produce such code right now, and anyway
that wouldn't make me understand what's going on here, and that annoys me. So if
somebody could enlighten me...?

Best,
Paul

From khaledhosny at eglug.org  Sun Aug  1 19:17:56 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 1 Aug 2010 20:17:56 +0300
Subject: [luatex] Input/output and encoding.
In-Reply-To: <1280681433.4c55a5d96b94f@imp.free.fr>
References: <1280681433.4c55a5d96b94f@imp.free.fr>
Message-ID: <20100801171756.GA14054@khaled-laptop>

On Sun, Aug 01, 2010 at 06:50:33PM +0200, Paul Isambert wrote:
> Hello again,
> 
> Please consider this document:
> 
> \directlua{%
>  function convert(buf)
>    return string.gsub(buf,"(.)",
>                       function (ch) return unicode.utf8.char(string.byte(ch))
>      end)
>  end
>  callback.register('process_input_buffer',convert)
>  }
> 
> \immediate\openout0=\jobname.xxx
> \immediate\write0{H?h?.}
> \immediate\closeout0
> 
> \directlua{callback.register('process_input_buffer',nil)}
> \input \jobname.xxx
> \bye
> 
> The convert function (adapted from Elie Roux's luainputenc) converts input
> character from latin1 to utf-8 (because I'm lost without my old TeXnicCenter,
> which does latin1 - windows cp1252 actually, but anyway). It works very well.
> However, LuaTeX still writes in utf-8, so the .xxx file is written in utf-8, and
> it makes sense, at least to me, to remove the convert function in the callback
> before \input'ing that file: it is written in utf-8, so no conversion is needed,
> quite the contrary.
> 
> However, this doesn't return "H?h?", as I expected. Instead, the "e"'s with
> acute accent are ignored, which means LuaTeX hasn't read the proper character.
> Of course, if you don't delete the callback beforehand, it doesn't work either,
> but that I understand.
> 
> I know I could also make LuaTeX write in latin1, which would make everything
> simpler. However, I have no heart to produce such code right now, and anyway
> that wouldn't make me understand what's going on here, and that annoys me. So if
> somebody could enlighten me...?

There is a process_output_buffer callback that was added just for that.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Sun Aug  1 19:18:46 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sun, 01 Aug 2010 19:18:46 +0200
Subject: [luatex] Input/output and encoding.
In-Reply-To: <1280681433.4c55a5d96b94f@imp.free.fr>
References: <1280681433.4c55a5d96b94f@imp.free.fr>
Message-ID: <4C55AC76.9050305@elzevir.fr>

Hi,

Let's try with the following variation of your example:

Le 01/08/2010 18:50, Paul Isambert a ?crit :
> \directlua{%
>  function convert(buf)
>    return string.gsub(buf,"(.)",
>                       function (ch) return unicode.utf8.char(string.byte(ch))
>      end)
>  end
>  callback.register('process_input_buffer',convert)
>  }
> 
> \immediate\openout0=\jobname.xxx
> \immediate\write0{H?h?.}

\immediate\write0{\def\foo{H?h?.}} % instead

> \immediate\closeout0
> 
> \directlua{callback.register('process_input_buffer',nil)}
> \input \jobname.xxx

\show\foo % added

> \bye
> 
Now it looks working.

OTOH, a simple

H?h?.\bye

won't work.

So I think the problem is not at all due to playing with the callbacks, but only
to the default font missing the "?' character.

Manuel.

From oinos at web.de  Sun Aug  1 19:45:15 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 01 Aug 2010 19:45:15 +0200
Subject: [luatex] fontspec prevents German hyphenation
Message-ID: <4C55B2AB.70609@web.de>

Hi there,

I have just realized that fontspec prevents a particular hyphenation in 
LuaLaTeX. Here you have the sample:

\documentclass{book}
\usepackage{fontspec}
\usepackage[german,spanish]{babel}
\newcommand{\getext}[1]{\foreignlanguage{german}{#1}}
\newcommand{\geit}[1]{\foreignlanguage{german}{\emph{#1}}}
\begin{document}
\showhyphens{documento (documento)}
\showhyphens{\emph{documento (documento)}}
\showhyphens{(\getext{Umwelterlebnis}) (\getext{Andenken})}
\showhyphens{(\geit{Umwelterlebnis}) (\geit{Andenken})}
\end{document}

The fourth pair won't be hyphenated if fontspec is loaded. I guess this 
might be a bug.

BTW, for the German native speakers: isn't Andenken hyphenated as 
An-den-ken?

Thanks for your help,


Pablo

From zappathustra at free.fr  Sun Aug  1 20:32:13 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 01 Aug 2010 20:32:13 +0200
Subject: [luatex] Input/output and encoding.
In-Reply-To: <4C55AC76.9050305@elzevir.fr>
References: <1280681433.4c55a5d96b94f@imp.free.fr>
	<4C55AC76.9050305@elzevir.fr>
Message-ID: <1280687533.4c55bdad0c509@imp.free.fr>

Selon Manuel P?gouri?-Gonnard <mpg at elzevir.fr>:

> Hi,
>
> Let's try with the following variation of your example:
>
> Le 01/08/2010 18:50, Paul Isambert a ?crit :
> > \directlua{%
> >  function convert(buf)
> >    return string.gsub(buf,"(.)",
> >                       function (ch) return
> unicode.utf8.char(string.byte(ch))
> >      end)
> >  end
> >  callback.register('process_input_buffer',convert)
> >  }
> >
> > \immediate\openout0=\jobname.xxx
> > \immediate\write0{H?h?.}
>
> \immediate\write0{\def\foo{H?h?.}} % instead
>
> > \immediate\closeout0
> >
> > \directlua{callback.register('process_input_buffer',nil)}
> > \input \jobname.xxx
>
> \show\foo % added
>
> > \bye
> >
> Now it looks working.
>
> OTOH, a simple
>
> H?h?.\bye
>
> won't work.
>
> So I think the problem is not at all due to playing with the callbacks, but
> only
> to the default font missing the "?' character.

You're absolutely right, Manuel. I got so entangled in my own code that when I
did the example I forgot CM fonts have no "?" character per se (I'm using
OpenType fonts normally). The truth is, the error was in my code (which isn't
meant to print anything, despite the example I've given). I've fixed it, and
everything works fine now. It took me an hour, although the error was so simple
I'm too ashamed to tell it; on my way I thought I had discovered a bug in eTeX.
Which tells a lot about how tired I am.

Sorry to all for the disturbance. I sometimes post faster than I think.

Best,
Paul


From reinhard.kotucha at web.de  Mon Aug  2 02:04:38 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 2 Aug 2010 02:04:38 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C55B2AB.70609@web.de>
References: <4C55B2AB.70609@web.de>
Message-ID: <19542.2966.76756.204659@zaphod.ms25.net>

On 1 August 2010 Pablo Rodr?guez wrote:

 > Hi there,
 > 
 > I have just realized that fontspec prevents a particular hyphenation in 
 > LuaLaTeX. Here you have the sample:
 > 
 > \documentclass{book}
 > \usepackage{fontspec}
 > \usepackage[german,spanish]{babel}
 > \newcommand{\getext}[1]{\foreignlanguage{german}{#1}}
 > \newcommand{\geit}[1]{\foreignlanguage{german}{\emph{#1}}}
 > \begin{document}
 > \showhyphens{documento (documento)}
 > \showhyphens{\emph{documento (documento)}}
 > \showhyphens{(\getext{Umwelterlebnis}) (\getext{Andenken})}
 > \showhyphens{(\geit{Umwelterlebnis}) (\geit{Andenken})}
 > \end{document}
 > 
 > The fourth pair won't be hyphenated if fontspec is loaded. I guess
 > this might be a bug.
 > 
 > BTW, for the German native speakers: isn't Andenken hyphenated as 
 > An-den-ken?

Yes.  I get the same result with and without fontspec

[][] \OT1/cmr/m/n/10 (Um-welt-er-leb-nis) (An-denken)

while with pdflatex (without fontspec) I get:

[] \OT1/cmr/m/n/10 ([]Um-welter-leb-nis[]) ([]An-den-ken[])

Please note that LuaTeX doesn't have hyphenation patterns except those
for English in the format file anymore.  Please check your log file.

So probably you are using English patterns.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From vnpenguin at vnoss.org  Mon Aug  2 08:37:33 2010
From: vnpenguin at vnoss.org (Vnpenguin)
Date: Mon, 2 Aug 2010 08:37:33 +0200
Subject: [luatex] foundry.supelec.fr down ?
Message-ID: <AANLkTim7rd5oPPJXNAQMCvLSEB3Tdh899isJ2HC467yt@mail.gmail.com>

http://foundry.supelec.fr/gf/project/luatex is down ?

From taco at elvenkind.com  Mon Aug  2 10:33:44 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Aug 2010 10:33:44 +0200
Subject: [luatex] foundry.supelec.fr down ?
In-Reply-To: <AANLkTim7rd5oPPJXNAQMCvLSEB3Tdh899isJ2HC467yt@mail.gmail.com>
References: <AANLkTim7rd5oPPJXNAQMCvLSEB3Tdh899isJ2HC467yt@mail.gmail.com>
Message-ID: <4C5682E8.4070802@elvenkind.com>



Vnpenguin wrote:
> http://foundry.supelec.fr/gf/project/luatex is down ?

Yes, it is. I emailed Fabrice already, so I assume the machine
will be back online in few hours.

Best wishes,
Taco

From zappathustra at free.fr  Mon Aug  2 11:22:32 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 11:22:32 +0200
Subject: [luatex] stretch_order
Message-ID: <1280740952.4c568e58e7ec7@imp.free.fr>

Hello all,

The stretch/shrink_order fields of a glue_spec, and the glue_order field of a
box, return a number between 0 and 4, as follows: an finite amount is 0, and
fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent, then?

Best,
Paul


From arthur.reutenauer at normalesup.org  Mon Aug  2 11:24:35 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Aug 2010 11:24:35 +0200
Subject: [luatex] stretch_order
In-Reply-To: <1280740952.4c568e58e7ec7@imp.free.fr>
References: <1280740952.4c568e58e7ec7@imp.free.fr>
Message-ID: <20100802092435.GH8951@phare.normalesup.org>

> The stretch/shrink_order fields of a glue_spec, and the glue_order field of a
> box, return a number between 0 and 4, as follows: an finite amount is 0, and
> fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent, then?

  fi, obviously.  This was introduced in Omega, I believe.

	Arthur

From patrick at gundla.ch  Mon Aug  2 11:28:47 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 2 Aug 2010 11:28:47 +0200
Subject: [luatex] stretch_order
In-Reply-To: <20100802092435.GH8951@phare.normalesup.org>
References: <1280740952.4c568e58e7ec7@imp.free.fr>
	<20100802092435.GH8951@phare.normalesup.org>
Message-ID: <37D17765-A0A4-4DC7-AB18-627ABCF4BDEC@gundla.ch>


Am 02.08.2010 um 11:24 schrieb Arthur Reutenauer:

>> The stretch/shrink_order fields of a glue_spec, and the glue_order field of a
>> box, return a number between 0 and 4, as follows: an finite amount is 0, and
>> fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent, then?
> 
>  fi, obviously.  This was introduced in Omega, I believe.

Yes:

"A new infinity level fi has been added. It is smaller than fil but bigger than any finite quantity. Its original intention was for inter-letter stretching: either filling-in-the-black, as is done for calligraphic scripts such as Arabic; or for emphasis, as in Russian; all this without having to rewrite existing macro packages. There is therefore a new keyword, fi, and two new primitives, \hfi and \vfi."

from http://www.pik-potsdam.de/~kropp/TDOCS/omega/base/omega-manual.pdf

Patrick



From zappathustra at free.fr  Mon Aug  2 11:32:08 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 11:32:08 +0200
Subject: [luatex] stretch_order
In-Reply-To: <20100802092435.GH8951@phare.normalesup.org>
References: <1280740952.4c568e58e7ec7@imp.free.fr>
	<20100802092435.GH8951@phare.normalesup.org>
Message-ID: <1280741528.4c569098ed2a8@imp.free.fr>

Selon Arthur Reutenauer <arthur.reutenauer at normalesup.org>:

> > The stretch/shrink_order fields of a glue_spec, and the glue_order field of
> a
> > box, return a number between 0 and 4, as follows: an finite amount is 0,
> and
> > fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent,
> then?
>
>   fi, obviously.  This was introduced in Omega, I believe.

Indeed. I'd never heard of it.

Thank you,
Paul

From zappathustra at free.fr  Mon Aug  2 11:36:34 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 11:36:34 +0200
Subject: [luatex] stretch_order
In-Reply-To: <37D17765-A0A4-4DC7-AB18-627ABCF4BDEC@gundla.ch>
References: <1280740952.4c568e58e7ec7@imp.free.fr>
	<20100802092435.GH8951@phare.normalesup.org>
	<37D17765-A0A4-4DC7-AB18-627ABCF4BDEC@gundla.ch>
Message-ID: <1280741794.4c5691a20b4a9@imp.free.fr>

Selon Patrick Gundlach <patrick at gundla.ch>:

>
> Am 02.08.2010 um 11:24 schrieb Arthur Reutenauer:
>
> >> The stretch/shrink_order fields of a glue_spec, and the glue_order field
> of a
> >> box, return a number between 0 and 4, as follows: an finite amount is 0,
> and
> >> fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent,
> then?
> >
> >  fi, obviously.  This was introduced in Omega, I believe.
>
> Yes:
>
> "[...] There is therefore a new keyword, fi, and
> two new primitives, \hfi and \vfi."

The fi keyword works, but \hfi and \vfi are undefined. Is it on purpose?

Paul

From mpg at elzevir.fr  Mon Aug  2 12:01:24 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 12:01:24 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <19542.2966.76756.204659@zaphod.ms25.net>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
Message-ID: <4C569774.3090709@elzevir.fr>

Hi,

I think there are two different problems here:

1. Why, with the example of Pablo, are the results different between the last
two lines (\getext and \geit): \geit seems to suppress all hyphenation?

2. Why is Andenken hyphenated as An-denken while pdflatex gives the correct
hyphenation An-den-ken?

Concerning problem 1, I think it has something to do with the timing of font
changing. I propose the following, modified example:

\documentclass{article}
\usepackage{fontspec}
\begin{document} \emph{} % just preload italic font
\showhyphens{document (document)}
\showhyphens{\emph{document} (\emph{document})}
\end{document}

The result is:

[][] \EU2/lmr/m/n/10 doc-u-ment (doc-u-ment)

[][] \EU2/lmr/m/it/10 doc-u-ment \EU2/lmr/m/n/10 (\EU2/lmr/m/it/10 document\EU2
/lmr/m/n/10 )

Notice the missing hyphenation when the font is changed inside the brackets.
Now, commenting out fontspec in the previous example gives:

[][] \OT1/cmr/m/n/10 doc-u-ment (doc-u-ment)

[][] \OT1/cmr/m/it/10 doc-u-ment \OT1/cmr/m/n/10 (\OT1/cmr/m/it/10 doc-u-ment\O
T1/cmr/m/n/10 )

So, clearly fontspec (or most probably luaotfload) has something to do with this
problem. Maybe it introduces some new nodes or whatever. Khaled, any idea?

Le 02/08/2010 02:04, Reinhard Kotucha a ?crit :
> Please note that LuaTeX doesn't have hyphenation patterns except those
> for English in the format file anymore.  Please check your log file.
> 
The patterns are loaded at run time, we wouldn't (purposefully) introduce such a
regression as breaking all non-English languages. Check your log file ;-)

luatex-hyphen: loading patterns and exceptions for: german (\language26))
luatex-hyphen: loading patterns and exceptions for: spanish (\language65)))

> So probably you are using English patterns.
> 
I don't think so. English patterns give:

doc-u-mento Umwel-ter-leb-nis An-denken

while the patterns loaded by Pablo's original example give:

do-cu-men-to Um-welt-er-leb-nis An-denken

I know there are many versions of the German patterns around, I'll check if this
can explain the difference.

Manuel.

From taco at elvenkind.com  Mon Aug  2 12:14:36 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Aug 2010 12:14:36 +0200
Subject: [luatex] stretch_order
In-Reply-To: <20100802092435.GH8951@phare.normalesup.org>
References: <1280740952.4c568e58e7ec7@imp.free.fr>
	<20100802092435.GH8951@phare.normalesup.org>
Message-ID: <4C569A8C.60702@elvenkind.com>



Arthur Reutenauer wrote:
>> The stretch/shrink_order fields of a glue_spec, and the glue_order field of a
>> box, return a number between 0 and 4, as follows: an finite amount is 0, and
>> fil, fill and filll are 2, 3 and 4 respectively. What would 1 represent, then?
> 
>   fi, obviously.  This was introduced in Omega, I believe.

Quite right.

Best wishes,
Taco

From mpg at elzevir.fr  Mon Aug  2 12:29:48 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 12:29:48 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C569774.3090709@elzevir.fr>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
	<4C569774.3090709@elzevir.fr>
Message-ID: <4C569E1C.7040505@elzevir.fr>

Le 02/08/2010 12:01, Manuel P?gouri?-Gonnard a ?crit :
> So, clearly fontspec (or most probably luaotfload) has something to do with this
> problem. Maybe it introduces some new nodes or whatever. Khaled, any idea?
> 
More precisely, it seems to be related to italic correction (automatically
inserted by LaTeX commands when switching to/from italic). First, let's try yet
another example:

\documentclass{article}
\usepackage{fontspec}
\newcommand\boxshow[1]{\setbox0=\hbox{#1}\showbox0}
\showboxdepth8 \showboxbreadth1024
\begin{document} {\itshape} % just preload italic font
\boxshow{(document)}
\boxshow{(\textit{document})}
\boxshow{({\itshape document})}
\end{document}

>From the log:

> \box0=
\hbox(7.5+2.5)x50.56, direction TLT
.\EU2/lmr/m/n/10 (
.\EU2/lmr/m/n/10 d
.\EU2/lmr/m/n/10 o
.\kern 0.28
.\EU2/lmr/m/n/10 c
.\discretionary
..\EU2/lmr/m/n/10 -
.\EU2/lmr/m/n/10 u
.\discretionary
..\EU2/lmr/m/n/10 -
.\EU2/lmr/m/n/10 m
.\EU2/lmr/m/n/10 e
.\EU2/lmr/m/n/10 n
.\kern -0.28
.\EU2/lmr/m/n/10 t
.\EU2/lmr/m/n/10 )


! OK.
l.6 \boxshow{(document)}

?
> \box0=
\hbox(7.5+2.5)x49.18001, direction TLT
.\EU2/lmr/m/n/10 (
.\kern 0.0
.\EU2/lmr/m/it/10 d
.\EU2/lmr/m/it/10 o
.\kern -0.51
.\EU2/lmr/m/it/10 c
.\EU2/lmr/m/it/10 u
.\EU2/lmr/m/it/10 m
.\EU2/lmr/m/it/10 e
.\EU2/lmr/m/it/10 n
.\EU2/lmr/m/it/10 t
.\kern 0.0
.\EU2/lmr/m/n/10 )

! OK.
l.7 \boxshow{(\textit{document})}

Notice the two \kern 0.0

> \box0=
\hbox(7.5+2.5)x49.18001, direction TLT
.\EU2/lmr/m/n/10 (
.\EU2/lmr/m/it/10 d
.\EU2/lmr/m/it/10 o
.\kern -0.51
.\EU2/lmr/m/it/10 c
.\discretionary
..\EU2/lmr/m/it/10 -
.\EU2/lmr/m/it/10 u
.\discretionary
..\EU2/lmr/m/it/10 -
.\EU2/lmr/m/it/10 m
.\EU2/lmr/m/it/10 e
.\EU2/lmr/m/it/10 n
.\EU2/lmr/m/it/10 t
.\EU2/lmr/m/n/10 )

! OK.
l.8 \boxshow{({\itshape document})}

The lower-level command \itshape just switches to italic without inserting \/
and doesn't break hyphenation.

Now, try the same example without fontspec. Here is only the second box (the one
with \textit):

> \box0=
\hbox(7.5+2.5)x50.12613, direction TLT
.\OT1/cmr/m/n/10 (
.\OT1/cmr/m/it/10 d
.\OT1/cmr/m/it/10 o
.\kern-0.51112
.\OT1/cmr/m/it/10 c
.\discretionary
..\OT1/cmr/m/it/10 -
.\OT1/cmr/m/it/10 u
.\discretionary
..\OT1/cmr/m/it/10 -
.\OT1/cmr/m/it/10 m
.\OT1/cmr/m/it/10 e
.\OT1/cmr/m/it/10 n
.\OT1/cmr/m/it/10 t
.\kern 0.94861
.\OT1/cmr/m/n/10 )

! OK.
l.7 \boxshow{(\textit{document})}

Interestingly enough, the initial \kern was omitted, and the last \kern is not
null (I know cmr and lmr aren't supposed to have exactly the same metrics, but
I'm still surprised the italic correction is null for one and non-null for the
other).

Manuel.

From patrick at gundla.ch  Mon Aug  2 12:55:10 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 2 Aug 2010 12:55:10 +0200
Subject: [luatex] epdf/stream contents
Message-ID: <F235F813-529C-47D9-AA44-BEE45DFF38D4@gundla.ch>

Hi,

how do I access the contents of a stream with epdf? (I know it is in early alpha and the interface is subject to change.)

I found these methods: getKind, getKindName, reset, getUndecodedStream, getChar, lookChar, isBinary, getDict - but none of them look like I can use to get the pure contents.

Patrick




From mpg at elzevir.fr  Mon Aug  2 12:58:32 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 12:58:32 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C569774.3090709@elzevir.fr>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
	<4C569774.3090709@elzevir.fr>
Message-ID: <4C56A4D8.8020007@elzevir.fr>

Le 02/08/2010 12:01, Manuel P?gouri?-Gonnard a ?crit :
> I know there are many versions of the German patterns around, I'll check if this
> can explain the difference.
> 
Ok, let's try. Test file:

\documentclass{article}
\makeatletter
\newcommand\try[1]{\showhyphens{\bbl at patterns{#1} Andenken}}
\makeatother
\begin{document}
\try{german}
\try{ngerman}
\try{german-x-latest}
\try{ngerman-x-latest}
\end{document}

With lualatex:

[][]  \OT1/cmr/m/n/10 An-denken
[][]  \OT1/cmr/m/n/10 An-denken
[][]  \OT1/cmr/m/n/10 An-denken
[][]  \OT1/cmr/m/n/10 An-denken

With pdflatex:

[]  []\OT1/cmr/m/n/10 An-den-ken
[]  []\OT1/cmr/m/n/10 An-den-ken
[]  []\OT1/cmr/m/n/10 An-denken
[]  []\OT1/cmr/m/n/10 An-denken

Now, having a look at loadhyph-de-1901.tex (the loader file for language
"german" according to language.dat):

\ifx\secondarg\empty % that is, if using XeTeX or LuaTeX
    \message{UTF-8 German Hyphenation Patterns (Traditional Orthography)}
    \input hyph-de-1901.tex
\else
    \message{German Hyphenation Patterns (Traditional Orthography)}
    % Kept for the sake of backward compatibility, but newer and better patterns
by WL are available.
    \input dehypht.tex
\fi

(And a similar thing for ngerman.)

Now I remember clearly having discussed it on texhyphen. The point is (as the
comment explain), there are two sets of german patterns: one "old" set,
dehyph(n).tex and a newer set. The decision was made to make the old sets the
default for old (8-bit) engines for compatibility, but to use the newer sets
with newer (Unicode-capable) engines. On both kind of engines, "experimental"
patterns are available as (n)german-x-latest. IIRC, currently those
"experimental" patterns are the same as the "new" patterns loaded for (n)german
under Unicode engines.

So, what to do?

- If you think the new patterns are wrong in the way the hyphenate Andenken, you
should bug their maintainer (Werner Lemberg <wl-at-gnu.org> according to the
copyright notice, but Stephan Hennig <mailing_list-at-arcor.de> seems to be
involved too).

- If you'd like babel to provided a way to use the "experimental" (currently =
"new") patterns, you should probably ask the maintainer of german.ldf.

- If you have any other concern about the way patterns are handled, the
texhyphen list may be a good place for discussion.

hth,
Manuel.

PS: http://tug.org/pipermail/tex-hyphen/2010-May/000585.html holds complete
information about the current state of German patterns, though I'm not sure it
is easy to read.

From khaledhosny at eglug.org  Mon Aug  2 13:03:27 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 2 Aug 2010 14:03:27 +0300
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C569774.3090709@elzevir.fr>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
	<4C569774.3090709@elzevir.fr>
Message-ID: <20100802110326.GA5840@khaled-laptop>

On Mon, Aug 02, 2010 at 12:01:24PM +0200, Manuel P?gouri?-Gonnard wrote:
> So, clearly fontspec (or most probably luaotfload) has something to do with this
> problem. Maybe it introduces some new nodes or whatever. Khaled, any idea?

There are some hacks in fontspec to emulate per font hyphen chars, not
sure if it has anything to do with this but I always felt I'm doing it
the wrong way, so I'd first try to see if this behaviour can be
reproduced without fontspec or not.

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From martin at oneiros.de  Mon Aug  2 13:02:57 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Mon, 2 Aug 2010 13:02:57 +0200
Subject: [luatex] epdf/stream contents
In-Reply-To: <F235F813-529C-47D9-AA44-BEE45DFF38D4@gundla.ch>
References: <F235F813-529C-47D9-AA44-BEE45DFF38D4@gundla.ch>
Message-ID: <AANLkTinjYHms=kZfaO0GHz2nEga+Lzcs6DVUB-aUG=2r@mail.gmail.com>

2010/8/2 Patrick Gundlach <patrick at gundla.ch>:
> I found these methods: getKind, getKindName, reset, getUndecodedStream, getChar, lookChar, isBinary, getDict - but none of them look like I can use to get the pure contents.

Methinks getChar is close to what you want. Look at
source/libs/poppler/poppler-0.12.4/poppler/Stream.h
But it's probably too low-level.

Best
   Martin

From patrick at gundla.ch  Mon Aug  2 13:17:58 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 2 Aug 2010 13:17:58 +0200
Subject: [luatex] epdf/stream contents
In-Reply-To: <AANLkTinjYHms=kZfaO0GHz2nEga+Lzcs6DVUB-aUG=2r@mail.gmail.com>
References: <F235F813-529C-47D9-AA44-BEE45DFF38D4@gundla.ch>
	<AANLkTinjYHms=kZfaO0GHz2nEga+Lzcs6DVUB-aUG=2r@mail.gmail.com>
Message-ID: <23A6594B-9201-42F9-9682-D02FB2113CD3@gundla.ch>


Am 02.08.2010 um 13:02 schrieb Martin Schr?der:

> 2010/8/2 Patrick Gundlach <patrick at gundla.ch>:
>> I found these methods: getKind, getKindName, reset, getUndecodedStream, getChar, lookChar, isBinary, getDict - but none of them look like I can use to get the pure contents.
> 
> Methinks getChar is close to what you want. Look at
> source/libs/poppler/poppler-0.12.4/poppler/Stream.h
> But it's probably too low-level.

getChar returns -1 whenever I call it. The stream type is "Flate" and /or "File".

Patrick



From zappathustra at free.fr  Mon Aug  2 13:42:17 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 13:42:17 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
Message-ID: <1280749337.4c56af1962b32@imp.free.fr>

Hello again and again,

(I'm obvioulsy investigating skips today.)

Here's a document. It gets all the glues in the lines of a paragraph and prints
some information to the log if the glue's width is 1sp, to which I've set
\leftskip, or 2sp, to which I've set \rightskip, so they can be spotted (don't
worry, those values doesn't appear anywhere else), or if subtype = 15, i.e. it's
\parfillskip. In case the glue is \left- or \rightskip, the subtype is also
printed. See the log below.

\directlua{%
  get_type = function(head)
    for line in node.traverse_id(0, head) do
      texio.write_nl("Here's a line:")
      for item in node.traverse_id(10,line.list) do
        if item.spec.width == 1 then
          texio.write_nl("That's leftskip with subtype " .. item.subtype)
        elseif item.spec.width == 2 then
          texio.write_nl("That's rightskip with subtype " .. item.subtype)
        elseif item.subtype == 15 then
          texio.write_nl("Here's a parfillskip")
        end
      end
    end
    return head
  end
  callback.register("post_linebreak_filter",get_type)
  }
\leftskip=1sp
\rightskip=2sp
% A two-line paragraph.
abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc
abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc
\bye

Here's the interesting part of the log:

...
Here's a line:
That's leftskip with subtype 7
That's rightskip with subtype 9
Here's a line:
That's leftskip with subtype 7
Here's a parfillskip
That's rightskip with subtype 8
...

The first line displays \leftskip with subtype 7 and \rightskip with subtype 9,
whereas the second line has subtype 8 for \rightskip. The manual says \leftskip
has subtype 8 and \rightskip has subtype 9. I think something is going wrong
here.

As far as I can tell, \rightskip flips its subtype with \parfillskip: it has 9
on all lines except on the last one, where it's 8.

I haven't investigated what value is returned by \belowdisplayshortskip (7
according to the manual) because my handling of math is far from good.

Best,
Paul, tremendously hoping that the bug isn't in his brain again

PS: In the previous thread on glue order, I've said the \hfi and \vfi primitives
from Omega aren't defined. You didn't react, Taco, so I mention it again, just
in case.

From luigi.scarso at gmail.com  Mon Aug  2 14:13:37 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 2 Aug 2010 14:13:37 +0200
Subject: [luatex] File I/O.
In-Reply-To: <4C53C636.6070603@elvenkind.com>
References: <1280522200.4c5337d8dd80f@imp.free.fr>
	<AANLkTimVy1bes3i9iAoWLLLGg+wpoVfo6FVoOc6hTquB@mail.gmail.com>
	<1280530333.4c53579d8bcfc@imp.free.fr>
	<4C53C636.6070603@elvenkind.com>
Message-ID: <AANLkTimqvCwQQcdXabW4+g79juKPNNP=E9BzUPp1NApt@mail.gmail.com>

On Sat, Jul 31, 2010 at 8:44 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> On 07/31/2010 12:52 AM, Paul Isambert wrote:
>>
>> but it really seems archaic in view of what LuaTeX usually does. So does
>> this
>> means there's no function like "tex.filewrite(n,message)" that would be
>> totally
>> equivalent to (and compatible with) \write<n>{<message>}? I find it quite
>> hard
>> to believe, which is why I still think I must have missed something in the
>> manual.
>
> It really is archaic. You did not miss anything, somehow we forgot
> to add write stream support to the texio library. I'll add a tracker
> item for the next beta (it is actually quite trivial to implement).
>
> Best wishes,
> Taco
>

Why not something like
filename  = texio.openioname(<number>)
and then
\directlua{%
    texio.write(texio.openioname(\the\test),"message2")
}
?

-- 
luigi

From taco at elvenkind.com  Mon Aug  2 14:27:18 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Aug 2010 14:27:18 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280749337.4c56af1962b32@imp.free.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
Message-ID: <4C56B9A6.90508@elvenkind.com>



Paul Isambert wrote:
> Hello again and again,
> 
> (I'm obvioulsy investigating skips today.)

I'll get back to you on the skips later, something seems odd there.

> PS: In the previous thread on glue order, I've said the \hfi and \vfi primitives
> from Omega aren't defined. You didn't react, Taco, so I mention it again, just
> in case.

Were these really primitives?  It is the first time I hear of them.

Best wishes,
Taco


From zappathustra at free.fr  Mon Aug  2 14:32:36 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 14:32:36 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <4C56B9A6.90508@elvenkind.com>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56B9A6.90508@elvenkind.com>
Message-ID: <1280752356.4c56bae4319fa@imp.free.fr>

> > PS: In the previous thread on glue order, I've said the \hfi and \vfi
> primitives
> > from Omega aren't defined. You didn't react, Taco, so I mention it again,
> just
> > in case.
>
> Were these really primitives?  It is the first time I hear of them.

See Patrick's message:

"There is therefore a new keyword, fi, and two new primitives, \hfi and \vfi."

quoting from

http://www.pik-potsdam.de/~kropp/TDOCS/omega/base/omega-manual.pdf

I'm totally ignorant on the subject, so I'm just parroting here.

Paul

From taco at elvenkind.com  Mon Aug  2 14:40:55 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Aug 2010 14:40:55 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280749337.4c56af1962b32@imp.free.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
Message-ID: <4C56BCD7.7000007@elvenkind.com>



Paul Isambert wrote:
> whereas the second line has subtype 8 for \rightskip. The manual says \leftskip
> has subtype 8 and \rightskip has subtype 9. I think something is going wrong
> here.

The manual was right, the implementation was wrong. The weird thing is
that I have no idea when and how that happened: \lefstkips were always
reported as belowdisplayshortskip, \rightskips sometimes as leftskip
and sometimes are rightskip. Anyway, bug is corrected in the repository.

Best wishes,
Taco


From zappathustra at free.fr  Mon Aug  2 14:54:13 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 14:54:13 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <4C56BCD7.7000007@elvenkind.com>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
Message-ID: <1280753653.4c56bff535b8f@imp.free.fr>

Selon Taco Hoekwater <taco at elvenkind.com>:

>
>
> Paul Isambert wrote:
> > whereas the second line has subtype 8 for \rightskip. The manual says
> \leftskip
> > has subtype 8 and \rightskip has subtype 9. I think something is going
> wrong
> > here.
>
> The manual was right, the implementation was wrong. The weird thing is
> that I have no idea when and how that happened: \lefstkips were always
> reported as belowdisplayshortskip, \rightskips sometimes as leftskip
> and sometimes are rightskip. Anyway, bug is corrected in the repository.

Too bad I'll have to wait for the next release. Some day I'll try those esoteric
building operations real beta users do =)

Thanks for the fix,
Paul



From patrick at gundla.ch  Mon Aug  2 14:57:55 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 2 Aug 2010 14:57:55 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280753653.4c56bff535b8f@imp.free.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
	<1280753653.4c56bff535b8f@imp.free.fr>
Message-ID: <18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>

> Too bad I'll have to wait for the next release. Some day I'll try those esoteric
> building operations real beta users do =)

They are not esoteric; once you know how to do that and once you have set it up it is only:

svn update
./build.sh --make


or if you use git-svn:

git svn rebase
./build.sh --make

Then you have a fresh binary, copy that in the place you want and that is it.


Patrick



From zappathustra at free.fr  Mon Aug  2 15:07:38 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 15:07:38 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
	<1280753653.4c56bff535b8f@imp.free.fr>
	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
Message-ID: <1280754458.4c56c31a706c6@imp.free.fr>

Selon Patrick Gundlach <patrick at gundla.ch>:

> > Too bad I'll have to wait for the next release. Some day I'll try those
> esoteric
> > building operations real beta users do =)
>
> They are not esoteric; once you know how to do that and once you have set it
> up it is only:
>
> svn update
> ./build.sh --make
>
>
> or if you use git-svn:
>
> git svn rebase
> ./build.sh --make

The svn being Subversion, I guess. Which means I should have Subversion and know
how to use it, which is a very appealing but very very bad idea in PhD-writing
time, when I'm already too much on the
my-dissertation-is-going-to-be-nicely-typeset side (hence my many posts here)
instead of the my-dissertation-is-going-to-be-simply-good-work side. I even
shouldn't be writing this email! :)

Paul

From mpg at elzevir.fr  Mon Aug  2 15:15:42 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 15:15:42 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280754458.4c56c31a706c6@imp.free.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>	<4C56BCD7.7000007@elvenkind.com>	<1280753653.4c56bff535b8f@imp.free.fr>	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
	<1280754458.4c56c31a706c6@imp.free.fr>
Message-ID: <4C56C4FE.8070103@elzevir.fr>

Le 02/08/2010 15:07, Paul Isambert a ?crit :
> The svn being Subversion, I guess. Which means I should have Subversion and know
> how to use it,

For the record, you only need to have svn installed, not know how to use it.
'svn up' is all you need to know once the setup is done. (And 'svn clone' to
initialise it.)

> which is a very appealing but very very bad idea in PhD-writing
> time, when I'm already too much on the
> my-dissertation-is-going-to-be-nicely-typeset side (hence my many posts here)
> instead of the my-dissertation-is-going-to-be-simply-good-work side. I even
> shouldn't be writing this email! :)
> 
I think I know what you're talking about :-)

Manuel.

From zappathustra at free.fr  Mon Aug  2 15:24:55 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 15:24:55 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <4C56C4FE.8070103@elzevir.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
	<1280753653.4c56bff535b8f@imp.free.fr>
	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
	<1280754458.4c56c31a706c6@imp.free.fr>
	<4C56C4FE.8070103@elzevir.fr>
Message-ID: <1280755495.4c56c72794dac@imp.free.fr>

Selon Manuel P?gouri?-Gonnard <mpg at elzevir.fr>:

> Le 02/08/2010 15:07, Paul Isambert a ?crit :
> > The svn being Subversion, I guess. Which means I should have Subversion and
> know
> > how to use it,
>
> For the record, you only need to have svn installed, not know how to use it.
> 'svn up' is all you need to know once the setup is done. (And 'svn clone' to
> initialise it.)

There's definitely an air of temptation around here. Step back, horned one!

> > which is a very appealing but very very bad idea in PhD-writing
> > time, when I'm already too much on the
> > my-dissertation-is-going-to-be-nicely-typeset side (hence my many posts
> here)
> > instead of the my-dissertation-is-going-to-be-simply-good-work side. I even
> > shouldn't be writing this email! :)
> >
> I think I know what you're talking about :-)

Ha. So let's be brave. Let's make the right decision. Let's turn back to MS
Word.

From vnpenguin at vnoss.org  Mon Aug  2 15:29:13 2010
From: vnpenguin at vnoss.org (Vnpenguin)
Date: Mon, 2 Aug 2010 15:29:13 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280754458.4c56c31a706c6@imp.free.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
	<1280753653.4c56bff535b8f@imp.free.fr>
	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
	<1280754458.4c56c31a706c6@imp.free.fr>
Message-ID: <AANLkTin6+yAsN7z7y4BWtHmD+7yok8jtufriyjq8DvsH@mail.gmail.com>

On Mon, Aug 2, 2010 at 15:07, Paul Isambert <zappathustra at free.fr> wrote:
> Selon Patrick Gundlach <patrick at gundla.ch>:
>
>> > Too bad I'll have to wait for the next release. Some day I'll try those
>> esoteric
>> > building operations real beta users do =)
>>
>> They are not esoteric; once you know how to do that and once you have set it
>> up it is only:
>>
>> svn update
>> ./build.sh --make
>>
>>
>> or if you use git-svn:
>>
>> git svn rebase
>> ./build.sh --make


The time you need to write the following phrases, I can compile luatex
from fresh svn source :)


> The svn being Subversion, I guess. Which means I should have Subversion and know
> how to use it, which is a very appealing but very very bad idea in PhD-writing
> time, when I'm already too much on the
> my-dissertation-is-going-to-be-nicely-typeset side (hence my many posts here)
> instead of the my-dissertation-is-going-to-be-simply-good-work side. I even
> shouldn't be writing this email! :)
>
> Paul
>


Here:
> ./build/texk/web2c/luatex --version
This is LuaTeX, Version beta-0.61.0-2010080215 (rev 3782)

Execute  'luatex --credits'  for credits and version details.

There is NO warranty. Redistribution of this software is covered by
the terms of the GNU General Public License, version 2. For more
information about these matters, see the file named COPYING and
the LuaTeX source.

Copyright 2009 Taco Hoekwater, the LuaTeX Team.

From taco at elvenkind.com  Mon Aug  2 15:36:22 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 02 Aug 2010 15:36:22 +0200
Subject: [luatex] Luatex 0.61.0 announcement
In-Reply-To: <20100729035157.GA29067@khaled-laptop>
References: <4C5033A0.5000700@elvenkind.com> <i2qs6n$hcj$1@dough.gmane.org>
	<20100729035157.GA29067@khaled-laptop>
Message-ID: <4C56C9D6.3050802@elvenkind.com>



Khaled Hosny wrote:
> On Thu, Jul 29, 2010 at 05:22:59AM +0200, Robert wrote:
>> On 28.07.10 15:41, Taco Hoekwater wrote:
>>> * Fix \letterspacefont.
>> It still fails with a "TeX capacity exceeded, sorry [max level
>> recursion of virtual fonts=100]" on fonts loaded by luaotfload:
>>
>> \input{luaotfload.sty}
>> \font\x="name:Latin Modern Roman" at 10pt \x
>> \letterspacefont\y\x 100
>> Lorem ipsum dolor sit amet,
>> \bye
> 
> The same with ConText (after commenting out the \input line).

Should be fixed in TRUNK now.

Best wishes,
Taco

From mailing_list at arcor.de  Mon Aug  2 16:07:18 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 02 Aug 2010 16:07:18 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C56A4D8.8020007@elzevir.fr>
References: <4C55B2AB.70609@web.de>
	<19542.2966.76756.204659@zaphod.ms25.net>	<4C569774.3090709@elzevir.fr>
	<4C56A4D8.8020007@elzevir.fr>
Message-ID: <4C56D116.8000108@arcor.de>

Am 02.08.2010 12:58, schrieb Manuel P?gouri?-Gonnard:

> \documentclass{article}
> \makeatletter
> \newcommand\try[1]{\showhyphens{\bbl at patterns{#1} Andenken}}
> \makeatother
> \begin{document}
> \try{german}
> \try{ngerman}
> \try{german-x-latest}
> \try{ngerman-x-latest}
> \end{document}
>
> With lualatex:
>
> [][]  \OT1/cmr/m/n/10 An-denken
> [][]  \OT1/cmr/m/n/10 An-denken
> [][]  \OT1/cmr/m/n/10 An-denken
> [][]  \OT1/cmr/m/n/10 An-denken
>
> With pdflatex:
>
> []  []\OT1/cmr/m/n/10 An-den-ken
> []  []\OT1/cmr/m/n/10 An-den-ken
> []  []\OT1/cmr/m/n/10 An-denken
> []  []\OT1/cmr/m/n/10 An-denken


This is intentional.  Anden is the German name for Andes (mountains). 
The hyphenation Anden-ken therefore belongs to the class of 
(potentially) misleading hyphenations and is suppressed.  This behaviour 
is documented in package dehyph-exptl (with other examples).

Note, when LuaTeX is able to weight hyphenations, we can put a huge 
penalty upon such hyphenations instead of suppressing them completely.

Best regards,
Stephan Hennig

From arthur.reutenauer at normalesup.org  Mon Aug  2 16:28:01 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 2 Aug 2010 16:28:01 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <4C56C4FE.8070103@elzevir.fr>
References: <1280749337.4c56af1962b32@imp.free.fr>
	<4C56BCD7.7000007@elvenkind.com>
	<1280753653.4c56bff535b8f@imp.free.fr>
	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>
	<1280754458.4c56c31a706c6@imp.free.fr>
	<4C56C4FE.8070103@elzevir.fr>
Message-ID: <20100802142801.GN8951@phare.normalesup.org>

> For the record, you only need to have svn installed, not know how to use it.
> 'svn up' is all you need to know once the setup is done. (And 'svn clone' to
> initialise it.)

  svn checkout, mind you (or 'co' for short).  clone is the git command :-)

	Arthur

From mpg at elzevir.fr  Mon Aug  2 16:46:19 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 16:46:19 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <20100802142801.GN8951@phare.normalesup.org>
References: <1280749337.4c56af1962b32@imp.free.fr>	<4C56BCD7.7000007@elvenkind.com>	<1280753653.4c56bff535b8f@imp.free.fr>	<18E59F0A-1E10-4B05-9DC3-4496FA4B9B50@gundla.ch>	<1280754458.4c56c31a706c6@imp.free.fr>	<4C56C4FE.8070103@elzevir.fr>
	<20100802142801.GN8951@phare.normalesup.org>
Message-ID: <4C56DA3B.5040205@elzevir.fr>

Le 02/08/2010 16:28, Arthur Reutenauer a ?crit :
>> For the record, you only need to have svn installed, not know how to use it.
>> 'svn up' is all you need to know once the setup is done. (And 'svn clone' to
>> initialise it.)
> 
>   svn checkout, mind you (or 'co' for short).  clone is the git command :-)
> 
Oops. And git checkout exists too, but isn't the same thing :-)

Manuel.

:wq

From pragma at wxs.nl  Mon Aug  2 17:01:48 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Aug 2010 17:01:48 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100731103056.GA30763@khaled-laptop>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>
	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>
	<20100731103056.GA30763@khaled-laptop>
Message-ID: <4C56DDDC.1020000@wxs.nl>

On 31-7-2010 12:30, Khaled Hosny wrote:

> In case of Arabic (where there is no hyphenation, and the alternative
> justification techniques are not implemented yet), I got ride of all the
> overfull boxes in my document by enabling expansion alone, yet nobody
> can notice it, which is good in my book.

I think that a handwriting inspired font is quite insensitive for the hz 
related stretching indeed, and one can probably use much more extreme 
values than with latin .. what values do you use?

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Aug  2 17:04:40 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Aug 2010 17:04:40 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i31fpk$2un$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>
	<i31fpk$2un$1@dough.gmane.org>
Message-ID: <4C56DE88.7060807@wxs.nl>

On 31-7-2010 5:34, Robert wrote:

>> - Protrusion was seen as a bug.
>
> Then it was probably overdone (eg., hyphens protruding by their full
> width).

eh .. that's quite normal for hanging punctuation

> Which is what microtypography is all about: improving the visual
> appearance *without being noticeable*.

the point is that it was not seen as improvement ... (things like 
successive hyphens or rivers were spotted instead)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Aug  2 17:07:18 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Aug 2010 17:07:18 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C544820.8050309@elvenkind.com>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>	<i31fpk$2un$1@dough.gmane.org>
	<4C544820.8050309@elvenkind.com>
Message-ID: <4C56DF26.90702@wxs.nl>

On 31-7-2010 5:58, Taco Hoekwater wrote:
>
> Hi Robert,
>
> On 07/31/2010 05:34 PM, Robert wrote:
>>
>>> - Protrusion was seen as a bug.
>>
>> Then it was probably overdone (eg., hyphens protruding by their full
>> width).
>
> Yeah, I agree with you on that. In fact, if protrusion is done somewhat
> subtly, I really do see the paragraph as looking 'better'.

One can argue not to hang the hyphens, but just the punctuation; it also 
depends on the layout, for instance in multi columns settings too much 
protrusion in the first column can get disturbing if the second column 
is close .. all a matter of taste I guess.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Aug  2 17:14:44 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 02 Aug 2010 17:14:44 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i31ouk$t83$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>	<i31fpk$2un$1@dough.gmane.org>	<4C544820.8050309@elvenkind.com>
	<i31ouk$t83$1@dough.gmane.org>
Message-ID: <4C56E0E4.4010109@wxs.nl>

On 31-7-2010 8:10, Robert wrote:
> On 31.07.10 17:58, Taco Hoekwater wrote:
>>> Which is what microtypography is all about: improving the visual
>>> appearance *without being noticeable*.
>>
>> The thing is: the profound level of unnoticeable that came out of the
>> statistical tests for font expansion nullifies the 'improving the
>> visual appearance' goal. Wholly unnoticed improvements are not
>> actually improvements at all.
>
> I don't believe that they go unnoticed. Less hyphenations are a clear
> improvement, less overfull boxes even more so. And I've come across a
> considerable number of statements along the lines: "Gosh, all them
> overfull boxes have vanished!"

I normally enable emergencystretch and let tex be a bit more tolerant 
which then hardly gives overfull boxes. If someone starts complaining 
about my docs having too many overfull boxes i'd either change my 
settings or adapt my writing. Applying hz may improve matters a bit but 
it might as well introduce other artefacts.

> My impression is that Hans may have been referring to the first tests,
> which you carried out at NTG and Dante in 1999, where *level 2*
> expansion wasn't available yet.

Level 2 was there already (actually I never used level 1), maybe not in 
distributions but definitely on my machine.

Hans



-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From vnpenguin at vnoss.org  Mon Aug  2 22:20:09 2010
From: vnpenguin at vnoss.org (Vnpenguin)
Date: Mon, 2 Aug 2010 22:20:09 +0200
Subject: [luatex] Daily binary snapshots for Linux
Message-ID: <AANLkTik+ec_B8Ncby=DNR4-gqKyNKBk4eCb5s7Hru9tS@mail.gmail.com>

Binary snapshots of LuaTeX (build from svn source, on CentOS 5.5
hosts) for Linux:

   x86_64: https://my.vnoss.net/pub/luatex/x86_64/
   i686:     https://my.vnoss.net/pub/luatex/i686/

From reinhard.kotucha at web.de  Mon Aug  2 22:39:22 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 2 Aug 2010 22:39:22 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C569774.3090709@elzevir.fr>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
	<4C569774.3090709@elzevir.fr>
Message-ID: <19543.11514.330848.726483@zaphod.ms25.net>

On 2 August 2010 Manuel P?gouri?-Gonnard wrote:

 > The patterns are loaded at run time, we wouldn't (purposefully)
 > introduce such a regression as breaking all non-English
 > languages. Check your log file ;-)
 > 
 > luatex-hyphen: loading patterns and exceptions for: german (\language26))
 > luatex-hyphen: loading patterns and exceptions for: spanish (\language65)))

Sorry, I missed these lines.  I concentrated on the files which were
loaded but files loaded by Lua don't appear in the .log file.  And the
Lua files loaded by TeX don't even appear in the .fls file.  This
confused me a bit.

BTW, I didn't ask Pablo to check the .log file in order tell him that
he hasn't done his homework.  I asked because I couldn't derive from
the .log file what went wrong and hoped that he's more successful.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From w.m.l at gmx.net  Mon Aug  2 23:04:07 2010
From: w.m.l at gmx.net (Robert)
Date: Mon, 02 Aug 2010 23:04:07 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C56E0E4.4010109@wxs.nl>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>	<i31fpk$2un$1@dough.gmane.org>	<4C544820.8050309@elvenkind.com>	<i31ouk$t83$1@dough.gmane.org>
	<4C56E0E4.4010109@wxs.nl>
Message-ID: <i37bs8$5m9$1@dough.gmane.org>

On 02.08.10 17:14, Hans Hagen wrote:
> On 31-7-2010 8:10, Robert wrote:
>> My impression is that Hans may have been referring to the first tests,
>> which you carried out at NTG and Dante in 1999, where *level 2*
>> expansion wasn't available yet.
>
> Level 2 was there already (actually I never used level 1), maybe not in
> distributions but definitely on my machine.

 From Thanh's thesis (p. 91):

| A quick survey of the very first experiments (done by Hans Hagen and
| Taco Hoekwater) was made by Hans Hagen (May 1999). At the meantime,
| only level 1 font expansion was available.

>>> - Protrusion was seen as a bug.
>>
>> Then it was probably overdone (eg., hyphens protruding by their full
>> width).
>
> eh .. that's quite normal for hanging punctuation

But it's a mistake IMO. That's what lp/rpcodes are there for, after all.


Regards,
-- 
  Robert


From zappathustra at free.fr  Mon Aug  2 23:24:19 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 02 Aug 2010 23:24:19 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
Message-ID: <1280784259.4c573783b6032@imp.free.fr>

Selon Patrick Gundlach <patrick at gundla.ch>:

> > Too bad I'll have to wait for the next release. Some day I'll try those
> esoteric
> > building operations real beta users do =)
>
> They are not esoteric; once you know how to do that and once you have set it
> up it is only:
>
> svn update
> ./build.sh --make
>
>
> or if you use git-svn:
>
> git svn rebase
> ./build.sh --make

Ok. I've installed Subversion. The little bast*** has been downloading things
for hours (my internet access isn't very fast, since I'm retired in the country
for, ha-hum, PhD writing - plus I guess there was a way to avoid downloading all
those previous versions...). My self-esteemed has lowered - damn, haven't
resisted the pressure of TeXoholism - but I'm quite happy to know that I'll be
able to stay in tune every time Taco announces `fixed in commit...'

Thanks - or maybe not - to the tempters.

Best & good night,
Paul



From mpg at elzevir.fr  Mon Aug  2 23:51:21 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 02 Aug 2010 23:51:21 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <19543.11514.330848.726483@zaphod.ms25.net>
References: <4C55B2AB.70609@web.de>
	<19542.2966.76756.204659@zaphod.ms25.net>	<4C569774.3090709@elzevir.fr>
	<19543.11514.330848.726483@zaphod.ms25.net>
Message-ID: <4C573DD9.7020009@elzevir.fr>

Le 02/08/2010 22:39, Reinhard Kotucha a ?crit :
> On 2 August 2010 Manuel P?gouri?-Gonnard wrote:
> 
>  > The patterns are loaded at run time, we wouldn't (purposefully)
>  > introduce such a regression as breaking all non-English
>  > languages. Check your log file ;-)
>  > 
>  > luatex-hyphen: loading patterns and exceptions for: german (\language26))
>  > luatex-hyphen: loading patterns and exceptions for: spanish (\language65)))
> 
> Sorry, I missed these lines.

No problem, I asked you to check the log only for kidding.

>  I concentrated on the files which were
> loaded but files loaded by Lua don't appear in the .log file.  And the
> Lua files loaded by TeX don't even appear in the .fls file.  This
> confused me a bit.
> 
Hum, maybe something should be done so that those files are recorded in the .fls
file too. Taco, wdyt?

Manuel.

From patrick at gundla.ch  Mon Aug  2 23:53:43 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 2 Aug 2010 23:53:43 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280784259.4c573783b6032@imp.free.fr>
References: <1280784259.4c573783b6032@imp.free.fr>
Message-ID: <AD0CA7C8-6314-49C7-B8CA-EFCAA0A00362@gundla.ch>


> Ok. I've installed Subversion. The little bast*** has been downloading things
> for hours


make sure you don't do:

svn checkout http://foundry.supelec.fr/svn/luatex

but do

svn checkout http://foundry.supelec.fr/svn/luatex/trunk

then the time should be OK


Patrick



From zappathustra at free.fr  Tue Aug  3 00:15:15 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 03 Aug 2010 00:15:15 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <AD0CA7C8-6314-49C7-B8CA-EFCAA0A00362@gundla.ch>
References: <1280784259.4c573783b6032@imp.free.fr>
	<AD0CA7C8-6314-49C7-B8CA-EFCAA0A00362@gundla.ch>
Message-ID: <1280787315.4c5743737877b@imp.free.fr>

Selon Patrick Gundlach <patrick at gundla.ch>:

>
> > Ok. I've installed Subversion. The little bast*** has been downloading
> things
> > for hours
>
>
> make sure you don't do:
>
> svn checkout http://foundry.supelec.fr/svn/luatex
>
> but do
>
> svn checkout http://foundry.supelec.fr/svn/luatex/trunk
>
> then the time should be OK

Too late :)
That's I've thought - afterward. Anyway it's over now. I'm going to try to build
it.

Best,
Paul



From reinhard.kotucha at web.de  Tue Aug  3 01:32:27 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 3 Aug 2010 01:32:27 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C573DD9.7020009@elzevir.fr>
References: <4C55B2AB.70609@web.de> <19542.2966.76756.204659@zaphod.ms25.net>
	<4C569774.3090709@elzevir.fr>
	<19543.11514.330848.726483@zaphod.ms25.net>
	<4C573DD9.7020009@elzevir.fr>
Message-ID: <19543.21899.37170.585670@zaphod.ms25.net>

On 2 August 2010 Manuel P?gouri?-Gonnard wrote:

 >> Sorry, I missed these lines.
 > 
 > No problem, I asked you to check the log only for kidding.

I know.  Don't worry.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From reinhard.kotucha at web.de  Tue Aug  3 02:58:23 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 3 Aug 2010 02:58:23 +0200
Subject: [luatex] Trouble with subtype leftskip/rightskip.
In-Reply-To: <1280787315.4c5743737877b@imp.free.fr>
References: <1280784259.4c573783b6032@imp.free.fr>
	<AD0CA7C8-6314-49C7-B8CA-EFCAA0A00362@gundla.ch>
	<1280787315.4c5743737877b@imp.free.fr>
Message-ID: <19543.27055.119615.258148@zaphod.ms25.net>

On 3 August 2010 Paul Isambert wrote:

 >>> Ok. I've installed Subversion. The little bast*** has been
 >>> downloading things for hours

If it takes hours to download the stuff, then you have plenty of time
for your thesis.  Cheer up!

 > Too late :)

It's never too late.  Run 'svn update' in svn/luatex/trunk instead of
svn/luatex.

Regards,
  Reinhard


-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at elvenkind.com  Tue Aug  3 07:53:27 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 03 Aug 2010 07:53:27 +0200
Subject: [luatex] fontspec prevents German hyphenation
In-Reply-To: <4C573DD9.7020009@elzevir.fr>
References: <4C55B2AB.70609@web.de>	<19542.2966.76756.204659@zaphod.ms25.net>	<4C569774.3090709@elzevir.fr>	<19543.11514.330848.726483@zaphod.ms25.net>
	<4C573DD9.7020009@elzevir.fr>
Message-ID: <4C57AED7.3070204@elvenkind.com>



Manuel P?gouri?-Gonnard wrote:
>>  I concentrated on the files which were
>> loaded but files loaded by Lua don't appear in the .log file.  And the
>> Lua files loaded by TeX don't even appear in the .fls file.  This
>> confused me a bit.
>>
> Hum, maybe something should be done so that those files are recorded in the .fls
> file too. Taco, wdyt?

I will add something to luatex (not sure what yet).

Best wishes,
Taco

From taco at elvenkind.com  Tue Aug  3 09:38:18 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 03 Aug 2010 09:38:18 +0200
Subject: [luatex] filename recorder
In-Reply-To: <4C57AED7.3070204@elvenkind.com>
References: <4C55B2AB.70609@web.de>	<19542.2966.76756.204659@zaphod.ms25.net>	<4C569774.3090709@elzevir.fr>	<19543.11514.330848.726483@zaphod.ms25.net>	<4C573DD9.7020009@elzevir.fr>
	<4C57AED7.3070204@elvenkind.com>
Message-ID: <4C57C76A.80802@elvenkind.com>

Hi,

Taco Hoekwater wrote:
> 
> Manuel P?gouri?-Gonnard wrote:
>>>  I concentrated on the files which were
>>> loaded but files loaded by Lua don't appear in the .log file.  And the
>>> Lua files loaded by TeX don't even appear in the .fls file.  This
>>> confused me a bit.
>>>
>> Hum, maybe something should be done so that those files are recorded in the .fls
>> file too. Taco, wdyt?
> 
> I will add something to luatex (not sure what yet).

Starting with revision #3794, luatex --recorder also handles
files opened by

  require
  dofile()
  io.open()
  fontloader.open()
  fontloader.info()

I hope that is all of them, let me know if I missed something.

Best wishes,
Taco

From pragma at wxs.nl  Wed Aug  4 17:16:34 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 04 Aug 2010 17:16:34 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <i37bs8$5m9$1@dough.gmane.org>
References: <4C4C1A14.5080004@web.de>	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>	<i2p2bl$jao$1@dough.gmane.org>	<4C53F77C.5030700@wxs.nl>	<i31fpk$2un$1@dough.gmane.org>	<4C544820.8050309@elvenkind.com>	<i31ouk$t83$1@dough.gmane.org>	<4C56E0E4.4010109@wxs.nl>
	<i37bs8$5m9$1@dough.gmane.org>
Message-ID: <4C598452.90606@wxs.nl>

On 2-8-2010 11:04, Robert wrote:
> On 02.08.10 17:14, Hans Hagen wrote:
>> On 31-7-2010 8:10, Robert wrote:
>>> My impression is that Hans may have been referring to the first tests,
>>> which you carried out at NTG and Dante in 1999, where *level 2*
>>> expansion wasn't available yet.
>>
>> Level 2 was there already (actually I never used level 1), maybe not in
>> distributions but definitely on my machine.
>
>  From Thanh's thesis (p. 91):
>
> | A quick survey of the very first experiments (done by Hans Hagen and
> | Taco Hoekwater) was made by Hans Hagen (May 1999). At the meantime,
> | only level 1 font expansion was available.

hm, i explicitly set level 2 in the files (btw, we did it in NL, DE and 
CZ and maybe in some more places)

>>>> - Protrusion was seen as a bug.
>>>
>>> Then it was probably overdone (eg., hyphens protruding by their full
>>> width).
>>
>> eh .. that's quite normal for hanging punctuation
>
> But it's a mistake IMO. That's what lp/rpcodes are there for, after all.

mistake? more a matter of taste and also very dependent on the font 
(length of hyphen etc) but that istru efor more typographical tricks

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From wspr81 at gmail.com  Thu Aug  5 04:27:07 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Thu, 5 Aug 2010 11:57:07 +0930
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C53F77C.5030700@wxs.nl>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>
	<i2p2bl$jao$1@dough.gmane.org> <4C53F77C.5030700@wxs.nl>
Message-ID: <55904682-42DB-4416-BA30-B935DF556EA8@gmail.com>

On 31/07/2010, at 7:44 PM, Hans Hagen wrote:

> Concerning the badness ... there is some wishful thinking involved I guess ... when hz was introduced in pdftex we did experiments at usergroup meetings (each participant got its own randomized copy so no shared experiences).

Interesting stuff, thanks for the comments.

> - Texies came with remarks about wrong penalties and spacing being set, of limited hyphenation patterns being used, rivers being seen ... basically coming up with reasons why paragraphs next to each other looked different but not per se better.

I doubt very much that I, at least, can spot the difference between two good-enough paragraphs with and without hz. Or even between a local line-breaking algorithm (e.g., Word) and TeX's global-per-paragraph one.

It's in the bad examples that the differences become obvious. E.g., very wide inter-word space is a common sign of poor automatic typesetting that TeX simply wouldn't allow (by default). And overfull lines is an obvious indication of poor automatic typesetting by TeX.

So while enabling hz to remove overfull lines might not be detectable, the fact that it helps to remove them in the first place is a good reason to use it, for me.

(I can take or leave margin kerning; I'm referring mostly to character expansion.)

> When Thanh and I discussed that (at a Dante meeting) with Hermann Zapf he made the remark that probably 99% of the readers would not notice the difference. He also suggested that stretching lines vertically in order to get rid of widow lines was probably more effective. (I must have the tests done afterward somewhere.)

This is a nice idea (as long as you're not interested in grid typesetting). Although with 40 lines per page, say, you'd need to stretch by a bit more than 2.5%, which seems a little high. Perhaps you'd stretch by 1% in combination with reducing the interline space to achieve the rest.

> ps. I tend not to buy books that use expansion and inter character spacing trickery to the extreme as it distracts me too much

Absolutely -- if you notice it then it's not done right. (Which is my one complaint with Jean-luc Doumont's book: all of the hanging punctuation is set completely into the margin, which distracts my eyes a little. I prefer margin kerning to achieve "optical straightness" instead.)

> ps. Keep in mind that with for instance protrusion (and to some extend expansion) changes the solution space so we don't get better output.

Well, better output than it was -- surely :) -- but I understand what you're saying. TeX is optimal in the solution it chooses, so you can't improve on that without expanding the solution space.

Cheers,
-- Will



From khaledhosny at eglug.org  Thu Aug  5 09:00:43 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 5 Aug 2010 10:00:43 +0300
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C56DDDC.1020000@wxs.nl>
References: <4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl> <i2p2bl$jao$1@dough.gmane.org>
	<4C53F77C.5030700@wxs.nl> <20100731103056.GA30763@khaled-laptop>
	<4C56DDDC.1020000@wxs.nl>
Message-ID: <20100805070043.GA1956@khaled-laptop>

On Mon, Aug 02, 2010 at 05:01:48PM +0200, Hans Hagen wrote:
> On 31-7-2010 12:30, Khaled Hosny wrote:
> 
> >In case of Arabic (where there is no hyphenation, and the alternative
> >justification techniques are not implemented yet), I got ride of all the
> >overfull boxes in my document by enabling expansion alone, yet nobody
> >can notice it, which is good in my book.
> 
> I think that a handwriting inspired font is quite insensitive for
> the hz related stretching indeed, and one can probably use much more
> extreme values than with latin .. what values do you use?

I was using the default "quality" setup of context.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From pragma at wxs.nl  Thu Aug  5 09:56:39 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 05 Aug 2010 09:56:39 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <55904682-42DB-4416-BA30-B935DF556EA8@gmail.com>
References: <4C4C1A14.5080004@web.de>
	<4C4C2EC7.3060209@elvenkind.com>	<4C4C57D7.8000101@web.de>	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>	<4C4C72E7.2010203@elvenkind.com>
	<4C4C9D6B.5070306@web.de>	<4C4C9FCB.8060603@wxs.nl>
	<i2p2bl$jao$1@dough.gmane.org> <4C53F77C.5030700@wxs.nl>
	<55904682-42DB-4416-BA30-B935DF556EA8@gmail.com>
Message-ID: <4C5A6EB7.8070301@wxs.nl>

On 5-8-2010 4:27, Will Robertson wrote:

> I doubt very much that I, at least, can spot the difference between two good-enough paragraphs with and without hz. Or even between a local line-breaking algorithm (e.g., Word) and TeX's global-per-paragraph one.

Same for me. I've seen word output that looked quite good (probably 
depends on conditions, font, etc). When in the previous century I bought

http://portal.acm.org/citation.cfm?id=42470
http://www.amazon.com/exec/obidos/ASIN/0201176335/acmorg-20

I was sutpised to see that it was done on an apple using msword 3.01 as 
it looked quite ok (including the math). Discusses interesting research 
on grayness of paragraphs (what hz is all about).

> It's in the bad examples that the differences become obvious. E.g., very wide inter-word space is a common sign of poor automatic typesetting that TeX simply wouldn't allow (by default). And overfull lines is an obvious indication of poor automatic typesetting by TeX.

Sure. but getting rid of a 20pt space by stretching shapes by .5pt can 
be a bit over the top ... texies are hooked to justified (also for 
narrow columns) just as many dtp users are hooked to ragged right (as 
their machinery does not hyphenate or look at whole paragraphs) ... it 
does not hurt to switch to ragged right occasionally.

> So while enabling hz to remove overfull lines might not be detectable, the fact that it helps to remove them in the first place is a good reason to use it, for me.

I must admit that I seldom has overfull boxes (maybe lucky with 
settings), sometimes long inline verbatim gets tricky (thinking of it 
... inline monospaced fonts can have much stretch /shrinkas squeezing is 
already part of the design.

> (I can take or leave margin kerning; I'm referring mostly to character expansion.)
>
>> When Thanh and I discussed that (at a Dante meeting) with Hermann Zapf he made the remark that probably 99% of the readers would not notice the difference. He also suggested that stretching lines vertically in order to get rid of widow lines was probably more effective. (I must have the tests done afterward somewhere.)
>
> This is a nice idea (as long as you're not interested in grid typesetting). Although with 40 lines per page, say, you'd need to stretch by a bit more than 2.5%, which seems a little high. Perhaps you'd stretch by 1% in combination with reducing the interline space to achieve the rest.

The assumption was that no one notices. And of course spreads should 
then align.

>> ps. I tend not to buy books that use expansion and inter character spacing trickery to the extreme as it distracts me too much
>
> Absolutely -- if you notice it then it's not done right. (Which is my one complaint with Jean-luc Doumont's book: all of the hanging punctuation is set completely into the margin, which distracts my eyes a little. I prefer margin kerning to achieve "optical straightness" instead.)

sure, but there's margin kerning (each char optimized) and hanging 
punctuation (punctuation and either or not hyphen too) and the later is 
the traditional protrusion (as mentioned in typography books).

>> ps. Keep in mind that with for instance protrusion (and to some extend expansion) changes the solution space so we don't get better output.
>
> Well, better output than it was -- surely :) -- but I understand what you're saying. TeX is optimal in the solution it chooses, so you can't improve on that without expanding the solution space.

Right, and as long as most designer specs I have to implement involve 
ragged right, no widows etc (so all penalties 10k) nice tricks like hz 
is not going to save my day .. I have to leave that for my own docs.

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From preining at logic.at  Thu Aug  5 10:07:16 2010
From: preining at logic.at (Norbert Preining)
Date: Thu, 5 Aug 2010 17:07:16 +0900
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C5A6EB7.8070301@wxs.nl>
References: <4C4C57D7.8000101@web.de>
	<AANLkTim+S944OVCYB5OrF2pR-mrUHHXtnxknJSzQ0_rx@mail.gmail.com>
	<808146B7-2F64-4EE3-92FA-DA2714B38AC1@gundla.ch>
	<4C4C72E7.2010203@elvenkind.com> <4C4C9D6B.5070306@web.de>
	<4C4C9FCB.8060603@wxs.nl> <i2p2bl$jao$1@dough.gmane.org>
	<4C53F77C.5030700@wxs.nl>
	<55904682-42DB-4416-BA30-B935DF556EA8@gmail.com>
	<4C5A6EB7.8070301@wxs.nl>
Message-ID: <20100805080716.GE16833@gamma.logic.tuwien.ac.at>

On Do, 05 Aug 2010, Hans Hagen wrote:
> I was sutpised to see that it was done on an apple using msword 3.01 as  
> it looked quite ok (including the math). Discusses interesting research  
> on grayness of paragraphs (what hz is all about).

I think most people agree that it *is* possible to produce decent
things with word, but the default way of using it do not coincide with
a successful usage of Word, because Word has less typographic feature
built in.

Concerning math I haven't seen the article you cited, but I wrote 
stuff with word some years ago, and since I am mathematician I use
a lot of mathematics, and what word produces (produced? new layout engine
I haven't tested) was a PITA, honestly.

> I must admit that I seldom has overfull boxes (maybe lucky with  
> settings), sometimes long inline verbatim gets tricky (thinking of it  

Maybe not enough math ;-) Inline math formulas have the tendency to 
create these overful boxes. It needs line by line tweaking and rewording
of sentences to get rid of them.

>> This is a nice idea (as long as you're not interested in grid typesetting). Although with 40 lines per page, say, you'd need to stretch by a bit more than 2.5%, which seems a little high. Perhaps you'd stretch by 1% in combination with reducing the interline space to achieve the rest.

Grid typesetting is anyway a bit a problem. Anyone heard what has happened
with the macros/adaptions that Kaveh did? Some years ago there was a talk
at one of the bachoTeXs on grid typesetting by Kaveh,... I am still
waiting for him to upload the stuff to CTAN ;-)

Best wishes

Norbert
------------------------------------------------------------------------
Norbert Preining            preining@{jaist.ac.jp, logic.at, debian.org}
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------
SHALUNT (n.)
One who wears Trinidad and Tobago T-shirts on the beach in Bali to
prove they didn't just win the holiday in a competition or anything.
			--- Douglas Adams, The Meaning of Liff

From zappathustra at free.fr  Thu Aug  5 11:38:38 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 05 Aug 2010 11:38:38 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
Message-ID: <1281001118.4c5a869ee840f@imp.free.fr>

Hello all,

Here's a document:

\directlua{%
  what_context = function (head, context)
    if context == "" then
      context = "main"
    end
    texio.write_nl("The context is " .. context)
    return head
  end
  callback.register("pre_linebreak_filter", what_context)
  }%
\long\def\Insert#1{%
  \directlua{texio.write_nl("<< Start of insert")}%
  \insert\footins{#1}%
  \directlua{texio.write_nl("End of insert >>")}%
  }

Hello \Insert{world}

Hello \Insert{world\par}
\bye

For each paragraph, it writes the context in which it is typeset to the log. Now
the log looks like this:

<< Start of insert
The context is insert
End of insert >>
The context is main
<< Start of insert
The context is main % !!!
End of insert >>
The context is main

The problem, as you can see, is that the paragraph of the second insert, with
the explicit \par command, "thinks" it is in the main vertical list.

Some observations:
- My changing context = "" into context = "main" is of course immaterial, as is
the \Insert macro - they just (hopefully) make things easier to read.
- Of course, the problem doesn't depend on the type of insert (I've used plain's
\footins here, but the problem occurred in my own footnote inserts, as well as
in any \newinsert).
- \endgraf produces the same result (the contrary would be surprising, but who
knows?), and \vskip too, so the problem seems to stem from explicitly turning to
vertical mode in an insert.
- If the insert contains other paragraphs, they return "insert" as context. So
only the first paragraph is affected.
- The same thing happens with post_linebreak_filter.

I'm using 0.62 rev 3794 - since thanks to the gentle pressure of some people
here and Manuel's precious help I'm now a Subversion- and build-it-yourself
guy...

Sorry if I seem to spend my time hunting bugs instead of contributing to the
march forward... (although those bugs tend to appear when I devise macros which
in the back of my mind would fit in a TUGboat paper about some nice things you
can do with LuaTeX)

Best,
Paul

From taco at elvenkind.com  Thu Aug  5 12:04:25 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Aug 2010 12:04:25 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
In-Reply-To: <1281001118.4c5a869ee840f@imp.free.fr>
References: <1281001118.4c5a869ee840f@imp.free.fr>
Message-ID: <4C5A8CA9.8080004@elvenkind.com>

On 08/05/2010 11:38 AM, Paul Isambert wrote:
>
> The problem, as you can see, is that the paragraph of the second insert, with
> the explicit \par command, "thinks" it is in the main vertical list.

I can (almost/hopefully) explain why that is so: the page builder is
called from various bits in the input processing, like at the end
of a \par, or the start of a display, or the end of an \insert or
\vbox or \hbox, or when a \vskip is encountered at bottom level, etc.
Such calls trigger the callback handling is there is something that
is actually added to the vertical list (either main or an insert).

In some cases, the context is quite clear, like in your first example,
where it is triggered by the } that ends the \insert. But it is also
triggered by a \par command, and those are processed independently at
a different spot in the program, where it is not easy to deduce that
this is actually in the middle of an isert. In those cases, an empty 
context argument is passed to the callback.

The reason why you don't see another 'insert' is because at that point,
there is actually nothing added to the main vertical list.

I can try to improve the context discovery, but I am not sure whether
it will work as expected soon: this list addition code was spread
all over TeX, and not much work has been done yet to reorganize it.

Best wishes,
Taco



From taco at elvenkind.com  Thu Aug  5 12:08:41 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Aug 2010 12:08:41 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
In-Reply-To: <4C5A8CA9.8080004@elvenkind.com>
References: <1281001118.4c5a869ee840f@imp.free.fr>
	<4C5A8CA9.8080004@elvenkind.com>
Message-ID: <4C5A8DA9.8030109@elvenkind.com>

On 08/05/2010 12:04 PM, Taco Hoekwater wrote:
> On 08/05/2010 11:38 AM, Paul Isambert wrote:
>>
>> The problem, as you can see, is that the paragraph of the second
>> insert, with
>> the explicit \par command, "thinks" it is in the main vertical list.
>
> I can (almost/hopefully) explain why that is so: the page builder is

Sorry, that should have been 'line breaker', not 'page builder'.
Everything else I wrote is essentially correct.

Best wishes,
Taco

From zappathustra at free.fr  Thu Aug  5 12:52:22 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 05 Aug 2010 12:52:22 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
In-Reply-To: <4C5A8CA9.8080004@elvenkind.com>
References: <1281001118.4c5a869ee840f@imp.free.fr>
	<4C5A8CA9.8080004@elvenkind.com>
Message-ID: <1281005542.4c5a97e666e70@imp.free.fr>

Selon Taco Hoekwater <taco at elvenkind.com>:

> On 08/05/2010 11:38 AM, Paul Isambert wrote:
> >
> > The problem, as you can see, is that the paragraph of the second insert,
> with
> > the explicit \par command, "thinks" it is in the main vertical list.
>
> I can (almost/hopefully) explain why that is so: the page builder is
> called from various bits in the input processing, like at the end
> of a \par, or the start of a display, or the end of an \insert or
> \vbox or \hbox, or when a \vskip is encountered at bottom level, etc.
> Such calls trigger the callback handling is there is something that
> is actually added to the vertical list (either main or an insert).
>
> In some cases, the context is quite clear, like in your first example,
> where it is triggered by the } that ends the \insert. But it is also
> triggered by a \par command, and those are processed independently at
> a different spot in the program, where it is not easy to deduce that
> this is actually in the middle of an isert. In those cases, an empty
> context argument is passed to the callback.

Indeed (don't know why I haven't tested it before), it also happens in
\vbox/\vtop.

> The reason why you don't see another 'insert' is because at that point,
> there is actually nothing added to the main vertical list.

Which leads me to correct a previous assertion: only the last paragraph of the
insert/box displays the right context, provided it is closed by the insert/box's
ending. (My previous message stated that only the first paragraph was affected
because I'd run tests with only two paragraphs - pretty stupid.)

> I can try to improve the context discovery, but I am not sure whether
> it will work as expected soon: this list addition code was spread
> all over TeX, and not much work has been done yet to reorganize it.

Just so you know the motivation: I want to remove paragraph indent after a
section title with pre_linebreak_filter, because I prefer not to rely on
\everypar. To do so, section commands define the filter to a function which
removes the first box from the first paragraph in the main vertical list (hence
the context), and then sets the filter back to nil. The problem occurred in a 
paragraph with a multi-paragraph footnote (and I don't indent footnotes, so it
took me some time to figure out where the code was called).

By the way, to spot the indent box, and not another box, the only way (as far as
I can see) is to check that it has subtype = 0 (unknown origin) and width =
tex.parindent. Altough I can't see how a box with the same properties could ever
happen, wouldn't it be nice to have more subtypes? I'm thinking about the indent
box and the hbox that TeX produces when it's not happy about how \end was
called. (Oh, sorry, I'm feature-requesting again!)

Best,
Paul

From zappathustra at free.fr  Thu Aug  5 13:30:20 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 05 Aug 2010 13:30:20 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
Message-ID: <1281007820.4c5aa0cc7dfb9@imp.free.fr>

If I may jump right into the discussion and perhaps miss the point:

HH:
> WR:
>> So while enabling hz to remove overfull lines might not be detectable,
>> the fact that it helps to remove them in the first place is a good
>> reason to use it, for me.
>
> I must admit that I seldom has overfull boxes (maybe lucky with
> settings), sometimes long inline verbatim gets tricky (thinking of it
> ... inline monospaced fonts can have much stretch /shrinkas squeezing is
> already part of the design.

Some of my latest docs involving pretty narrow \hsize would have been undoable
without hz (tons of overfull boxes otherwise). While I've tired my eyes on page
191 of Bringhurst's /Elements/ to no great avail (barring the line-by-line
comparison, of course), it seems to me that hz can be spotted when comparing
narrow paragraphs with and without it (something in the text's color, although I
might be cheating myself here); anyway, hz (meaning character expansion only
here) is one of the (many) reasons why I moved from XeTeX to LuaTeX, and with
regard to what I can do now, I couldn't live without (to the extent that I
haven't tried not to use it with comfortable \hsize... I should do the test).

HH:
> WR:
>> HH:
>>> He also suggested that stretching lines vertically in order to get rid
>>> of widow lines was probably more effective.
>>
>> This is a nice idea (as long as you're not interested in grid typesetting).
>> Although with 40 lines per page, say, you'd need to stretch by a bit more
>> than 2.5%, which seems a little high. Perhaps you'd stretch by 1% in
>> combination with reducing the interline space to achieve the rest.
>
> The assumption was that no one notices. And of course spreads should
> then align.

Pages on the same leaf wouldn't align though. It depends on the paper, but
sometimes it's annoying (and sometimes for me it's just "ha ha, no grid! damn, I
ain't disturbed... I MUST find a way to be disturbed, I can't allow no grid!",
and then I feel quite pedantic and almost a fraud).

Best,
Paul

From taco at elvenkind.com  Thu Aug  5 13:29:28 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Aug 2010 13:29:28 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
In-Reply-To: <1281005542.4c5a97e666e70@imp.free.fr>
References: <1281001118.4c5a869ee840f@imp.free.fr>
	<4C5A8CA9.8080004@elvenkind.com>
	<1281005542.4c5a97e666e70@imp.free.fr>
Message-ID: <4C5AA098.7010503@elvenkind.com>

Hi,

On 08/05/2010 12:52 PM, Paul Isambert wrote:
>
> By the way, to spot the indent box, and not another box, the only way (as far as
> I can see) is to check that it has subtype = 0 (unknown origin) and width =
> tex.parindent. Altough I can't see how a box with the same properties could ever
> happen, wouldn't it be nice to have more subtypes?  I'm thinking about the indent
> box and

Now, that was easy enough. As of #3796, paragraph indentation boxes
have subtype 3.

> the hbox that TeX produces when it's not happy about how \end was called.

That one is extra special, so I have not done that yet.

Best wishes,
Taco

From zappathustra at free.fr  Thu Aug  5 13:41:21 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 05 Aug 2010 13:41:21 +0200
Subject: [luatex] Multi-paragraph insert confuses linebreak filters.
In-Reply-To: <4C5AA098.7010503@elvenkind.com>
References: <1281001118.4c5a869ee840f@imp.free.fr>
	<4C5A8CA9.8080004@elvenkind.com>
	<1281005542.4c5a97e666e70@imp.free.fr>
	<4C5AA098.7010503@elvenkind.com>
Message-ID: <1281008481.4c5aa361da1fc@imp.free.fr>

Selon Taco Hoekwater <taco at elvenkind.com>:

> Hi,
>
> On 08/05/2010 12:52 PM, Paul Isambert wrote:
> >
> > By the way, to spot the indent box, and not another box, the only way (as
> far as
> > I can see) is to check that it has subtype = 0 (unknown origin) and width =
> > tex.parindent. Altough I can't see how a box with the same properties could
> ever
> > happen, wouldn't it be nice to have more subtypes?  I'm thinking about the
> indent
> > box and
>
> Now, that was easy enough. As of #3796, paragraph indentation boxes
> have subtype 3.

Wow. That is extremely nice (and fast!). Thank you!

>
> > the hbox that TeX produces when it's not happy about how \end was called.
>
> That one is extra special, so I have not done that yet.
>

Not urgent, though. I think everybody (or every format) has a way to avoid it.
That's just a kind of global consistency.

Best,
Paul

From taco at elvenkind.com  Thu Aug  5 13:42:51 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 05 Aug 2010 13:42:51 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
Message-ID: <4C5AA3BB.2070208@elvenkind.com>


Hi,

On 08/05/2010 01:30 PM, Paul Isambert wrote:
>
> ... it seems to me that hz can be spotted when comparing
> narrow paragraphs with and without it (something in the text's color, although I
> might be cheating myself here);

I can indeed sometimes notice font expansion in hardcopy precisely
because it subtly alters the text color. In cases where there would not
have been overfull boxes in the text anyway, then the simple fact that
I am able to 'see' the effects of font expansion itself renders it
worthless: it makes the text font look slightly out of focus (or
something like that, I do not know a proper word).

It seems this effect is at its worst at 1200dpi, probably because of
some interference with font hinting technology. But of course this is
not really a hz problem, just a side-effect of the pseudo-hz implemented
in pdftex/luatex.

>>>> He also suggested that stretching lines vertically in order to get rid
>>>> of widow lines was probably more effective.
>>>
>>> This is a nice idea (as long as you're not interested in grid typesetting).
>>> Although with 40 lines per page, say, you'd need to stretch by a bit more
>>> than 2.5%, which seems a little high. Perhaps you'd stretch by 1% in
>>> combination with reducing the interline space to achieve the rest.
>>
>> The assumption was that no one notices. And of course spreads should
>> then align.
>
> Pages on the same leaf wouldn't align though. It depends on the paper, but
> sometimes it's annoying

Right, on thin paper, the shine-throughs would not align. Not a big
deal for academic papers with lots of sectioning and displays where
each page is sort of messy anyway, but disastrous in novels.

Best wishes,
Taco

From khaledhosny at eglug.org  Fri Aug  6 10:06:33 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 6 Aug 2010 11:06:33 +0300
Subject: [luatex] "Proper" use of \Udelimiterover &c
In-Reply-To: <20100729071720.GA6442@khaled-laptop>
References: <4C3D6607.5040403@elvenkind.com> <i1jmmm$g2q$1@dough.gmane.org>
	<456904322.120081279102430840.JavaMail.ngmail@webmail07.arcor-online.net>
	<4C3D999B.7060905@elvenkind.com>
	<20100729071720.GA6442@khaled-laptop>
Message-ID: <20100806080633.GB1964@khaled-laptop>

On Thu, Jul 29, 2010 at 10:17:20AM +0300, Khaled Hosny wrote:
> On Wed, Jul 14, 2010 at 01:03:55PM +0200, Taco Hoekwater wrote:
> > On 07/14/2010 12:13 PM, ulrik.vieth at arcor.de wrote:
> > >>Ulrik, can you try this overbrace stuff in Word to see how it looks?
> > >
> > >Enclosed is a PDF from Word 2007 using CambriaMath.
> > >
> > >In Word, the overbrace stuff is hidden in the accents palette.
> > >You can choose between a simple overbrace or and overbrace
> > >with an extra group (which TeX typesets as \mathop\limits).
> > >
> > >Hope this helps to clarify your issues.
> > 
> > Thanks. It sure looks like I am misinterpreting something in
> > the luatex implementation.
> 
> Also, the over and under delimeters are taken from the scriptfont, the
> attached example shows:

Now reading the MAPS article on LuaTeX math, it is clear that this is
what it is supposed to do:

  ... and the complementary \Udelimiterunder and \Udelimiterover
  primitives allow the placement of an extensible item as a subscript or
  superscript on a nucleus.

So I'm wondering if those are the right primitives for \over/underbrace,
since in plain TeX both text style. In this case \Umathaccent and
\Umathbotaccent seems to be a better match.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From zappathustra at free.fr  Fri Aug  6 20:02:19 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 06 Aug 2010 20:02:19 +0200
Subject: [luatex] Copy or recreate nodes.
Message-ID: <1281117739.4c5c4e2b0b492@imp.free.fr>

Hello all,

It's a bit calm here today, so let's ask a somewhat Byzantine question so we (at
least I) will be a little more knowledgeable tonight.

Suppose I want to add a node in a list. The question is, what's the preferred
solution between the following two:

1. Create one node and copy it:
\directlua{%
  mynode = node.create(10) % Let's say it's a glue.
  % Some node specs here
  function addnode (head,place)
    node.insert_after(head,place,node.copy(mynode))
  end
  }

2. Create a new node each time:
\directlua{%
  function addnode(head,place)
    local mynode = node.create(10)
    % Some node specs here
    node.insert_after(head,place,mynode)
  end
  }

Both approaches work, but: is one better/faster/more economical than the other?
Is the difference significant anyway?

My guess is that the first method is better if for instance you add a few nodes
many times, and the second one is better if you add many nodes a few times each.
(Overall I find the first one looks better.)

Best,
Paul

From taco at elvenkind.com  Sat Aug  7 10:55:50 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 07 Aug 2010 10:55:50 +0200
Subject: [luatex] Copy or recreate nodes.
In-Reply-To: <1281117739.4c5c4e2b0b492@imp.free.fr>
References: <1281117739.4c5c4e2b0b492@imp.free.fr>
Message-ID: <4C5D1F96.8020005@elvenkind.com>


Hi Paul,

On 08/06/2010 08:02 PM, Paul Isambert wrote:
> Hello all,
>
> It's a bit calm here today, so let's ask a somewhat Byzantine question so we (at
> least I) will be a little more knowledgeable tonight.
>
> Suppose I want to add a node in a list. The question is, what's the preferred
> solution between the following two:
>
> 1. Create one node and copy it:
> \directlua{%
>    mynode = node.create(10) % Let's say it's a glue.
>    % Some node specs here
>    function addnode (head,place)
>      node.insert_after(head,place,node.copy(mynode))
>    end
>    }
>
> 2. Create a new node each time:
> \directlua{%
>    function addnode(head,place)
>      local mynode = node.create(10)
>      % Some node specs here
>      node.insert_after(head,place,mynode)
>    end
>    }
>
> Both approaches work, but: is one better/faster/more economical than the other?

The first solution is somewhat faster (fewer function calls), but
whether it is 'better' depends on the 'Some node specs': if all nodes
are the same, the first solution is a bit cleaner to look at as well
so then I would use that. But if there are even slight variations, the
second form makes this more obvious, and I would use that. The speed
gain is not that much.

There are not *that* many nodes involved with typesetting, so unless
you do lots and lots of work, you won't notice any difference.

Best wishes,
Taco




From oinos at web.de  Sat Aug  7 13:48:46 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sat, 07 Aug 2010 13:48:46 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C5AA3BB.2070208@elvenkind.com>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com>
Message-ID: <4C5D481E.7030203@web.de>

On 08/05/2010 01:42 PM, Taco Hoekwater wrote:
> On 08/05/2010 01:30 PM, Paul Isambert wrote:
>>
>> ... it seems to me that hz can be spotted when comparing
>> narrow paragraphs with and without it (something in the text's color,
>> although I might be cheating myself here);
>
> [...]
>
> It seems this effect is at its worst at 1200dpi, probably because of
> some interference with font hinting technology. But of course this is
> not really a hz problem, just a side-effect of the pseudo-hz implemented
> in pdftex/luatex.

Thanks for your explanation, Taco.

I was wondering why pdftex/luatex have a pseudo-hz algorithm implemented 
and I have just found out that the hz algorithm was patented by URW and 
later bought by Adobe.

I guess there is no way to avoid it (since there is no easy way to avoid 
the patent itself).

Thanks for your help,


Pablo

From martin at oneiros.de  Sat Aug  7 21:05:47 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sat, 7 Aug 2010 21:05:47 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <4C5D481E.7030203@web.de>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
Message-ID: <AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>

2010/8/7 Pablo Rodr?guez <oinos at web.de>:
> I guess there is no way to avoid it (since there is no easy way to avoid the
> patent itself).

Well, the patent is EP0466953, which should have expired on 2010-07-18
(1990-07-17 plus 20 years), but IANAL... :-)

Best
   Martin


From reinhard.kotucha at web.de  Sun Aug  8 02:21:54 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 8 Aug 2010 02:21:54 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
Message-ID: <19549.63650.827919.756429@zaphod.ms25.net>

On 7 August 2010 Martin Schr?der wrote:

 > 2010/8/7 Pablo Rodr?guez <oinos at web.de>:
 > > I guess there is no way to avoid it (since there is no easy way
 > > to avoid the patent itself).
 > 
 > Well, the patent is EP0466953, which should have expired on
 > 2010-07-18 (1990-07-17 plus 20 years), but IANAL... :-)

There are also severe technical problems.  I assume that Zapf's idea
is based on multiple-master fonts.  But since such fonts are not
available, there is no easy way to implement Zapf's algorithm.
Hence it's not only a legal problem.

The difference between Thanh's and Zapf's algorithms is that Thanh
scales the glyphs horizontally while Zapf proposes to create dedicated
instances of a font where the stroke width is preserved.

Quite strange: There is no easy way to implement Zapf's algorithm
anymore since we have/prefer Type1 fonts, TTF, and OTF.  With
Metafont, I believe, it's not a big deal. :)

I don't know whether it's possible at all to create expanded instances
from Type1 outlines on-the-fly with Lua.  In a properly hinted Type1
font the stroke width can be derived from the /hstem and /vstem hints.
But I fear that many fonts are not properly hinted and thus this
approach is supposed to fail.

The subject of this thread is "LuaTeX file almost 2.5x bigger".
So let me summarize:

   * Zapf's algorithm requires dedicated fonts for each level of
     expansion.  This leads to larger PDF files.  Especially if Type1
     fonts are involved which can't be compressed efficiently because
     they are encrypted.

   * Thanh's algorithm requires that a particular font is inserted
     only once and expansion is performed by scaling the glyphs.  This
     obviously leads to smaller files.  

Nevertheless, as Patrick pointed out, the reason that the file created
by LuaTeX is so large is that each glyph is preceded by the TextMatrix:

  0.98 0 0 1 226.832 147.716 Tm [<0057>]TJ
  0.985 0 0 1 230.145 147.716 Tm [<0058>]TJ
  0.98 0 0 1 235.264 147.716 Tm [<0055>]TJ
  0.985 0 0 1 238.686 147.716 Tm [<0044>]TJ
  0.98 0 0 1 242.624 147.716 Tm [<004F>]TJ
  0.985 0 0 1 247.57 147.716 Tm [<0056>]TJ
  0.98 0 0 1 251.064 147.716 Tm [<00B5004F>]TJ

There is probably some room for improvements.  The TJ operator
supports kerning already quite similar to dvips, which is very
efficient.

Example (from the PDF reference manual):

  [(A) 120 (W) 120 (A) 95 (Y)] TJ

And the Th operator supports horizontal scaling.

I think that a lot of space can be saved if these operators are used
instead of the TextMatrix.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha		1] http://www.adobe.com/devnet/font/pdfs/5091.Design_MM_Fonts.pdf	              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From zappathustra at free.fr  Sun Aug  8 10:50:00 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 08 Aug 2010 10:50:00 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <19549.63650.827919.756429@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
Message-ID: <1281257400.4c5e6fb87cb38@imp.free.fr>

Selon Reinhard Kotucha <reinhard.kotucha at web.de>:

> Nevertheless, as Patrick pointed out, the reason that the file created
> by LuaTeX is so large is that each glyph is preceded by the TextMatrix:
>
>   0.98 0 0 1 226.832 147.716 Tm [<0057>]TJ
>   0.985 0 0 1 230.145 147.716 Tm [<0058>]TJ
>   0.98 0 0 1 235.264 147.716 Tm [<0055>]TJ
>   0.985 0 0 1 238.686 147.716 Tm [<0044>]TJ
>   0.98 0 0 1 242.624 147.716 Tm [<004F>]TJ
>   0.985 0 0 1 247.57 147.716 Tm [<0056>]TJ
>   0.98 0 0 1 251.064 147.716 Tm [<00B5004F>]TJ

It'd be interesting to know what a PDF file produced with InDesign (hence very
probably hz) looks like. But is there a possibility to compress the file as
little as possible with InDesign, so we can read it? At least we would have the
mere weight to compare.


> There is probably some room for improvements.  The TJ operator
> supports kerning already quite similar to dvips, which is very
> efficient.
>
> Example (from the PDF reference manual):
>
>   [(A) 120 (W) 120 (A) 95 (Y)] TJ
>
> And the Th operator supports horizontal scaling.
>
> I think that a lot of space can be saved if these operators are used
> instead of the TextMatrix.

If I'm not mistaken, that's letterspacing instead of glyph reshaping, right?

Best,
Paul

From zappathustra at free.fr  Sun Aug  8 11:07:56 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 08 Aug 2010 11:07:56 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <19549.63650.827919.756429@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
Message-ID: <1281258476.4c5e73ec1ef8b@imp.free.fr>

Selon Reinhard Kotucha <reinhard.kotucha at web.de>:

> Nevertheless, as Patrick pointed out, the reason that the file created
> by LuaTeX is so large is that each glyph is preceded by the TextMatrix:
>
>   0.98 0 0 1 226.832 147.716 Tm [<0057>]TJ
>   0.985 0 0 1 230.145 147.716 Tm [<0058>]TJ
>   0.98 0 0 1 235.264 147.716 Tm [<0055>]TJ
>   0.985 0 0 1 238.686 147.716 Tm [<0044>]TJ
>   0.98 0 0 1 242.624 147.716 Tm [<004F>]TJ
>   0.985 0 0 1 247.57 147.716 Tm [<0056>]TJ
>   0.98 0 0 1 251.064 147.716 Tm [<00B5004F>]TJ
>
> There is probably some room for improvements.  The TJ operator
> supports kerning already quite similar to dvips, which is very
> efficient.

By the way, and perhaps slightly off-topic, I've noted that pdfTeX uses the Td
operator to move to a new line, while LuaTeX uses a Tm. Since Td takes only two
arguments (it's just a translation) and Tm takes 6 (and of course (of course? in
the normal case at least) only the last two matter), this makes LuaTeX files
larger than pdfTeX files, although I don't know if the difference is
significant. What's the rationale behind this change of operator?

(LuaTeX has another difference: every line of text is a separate line of code in
the PDF, whereas pdfTeX produces very long lines; the Lua way is definitely more
readable, although I don't spend my time reading PDFs.)

Best,
Paul

From oinos at web.de  Sun Aug  8 12:00:45 2010
From: oinos at web.de (=?ISO-8859-1?Q?Pablo_Rodr=EDguez?=)
Date: Sun, 08 Aug 2010 12:00:45 +0200
Subject: [luatex] the hz algorithm (was:Re: LuaTeX file almost 2.5x bigger)
In-Reply-To: <19549.63650.827919.756429@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>	<4C5AA3BB.2070208@elvenkind.com>
	<4C5D481E.7030203@web.de>	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
Message-ID: <4C5E804D.4050603@web.de>

On 08/08/2010 02:21 AM, Reinhard Kotucha wrote:
> On 7 August 2010 Martin Schr?der wrote:
>
>   >  2010/8/7 Pablo Rodr?guez<oinos at web.de>:
>   >  >  I guess there is no way to avoid it (since there is no easy way
>   >  >  to avoid the patent itself).
>   >
>   >  Well, the patent is EP0466953, which should have expired on
>   >  2010-07-18 (1990-07-17 plus 20 years), but IANAL... :-)
>
> There are also severe technical problems.  I assume that Zapf's idea
> is based on multiple-master fonts.  But since such fonts are not
> available, there is no easy way to implement Zapf's algorithm.
> Hence it's not only a legal problem.

Thanks for your reply, Reinhard.

I'm not a lawyer, but even in the legal side of this issue (when the the 
European doesn't expire until 1/1/2011), there might be a related patent 
for a line-breaking algorithm granted to Adobe 
(http://www.freepatentsonline.com/6510441.pdf) that might involve the 
hz-algorithm (http://typophile.com/node/16525).

> The difference between Thanh's and Zapf's algorithms is that Thanh
> scales the glyphs horizontally while Zapf proposes to create dedicated
> instances of a font where the stroke width is preserved.
>
> Quite strange: There is no easy way to implement Zapf's algorithm
> anymore since we have/prefer Type1 fonts, TTF, and OTF.  With
> Metafont, I believe, it's not a big deal. :)

If I don't get you point wrong, the original hz-algorithm is not 
suitable for other fonts than Multiple Master, is it?

I wounder whether US Patent 6510441 
(http://www.freepatentsonline.com/6510441.pdf) solves this.

> The subject of this thread is "LuaTeX file almost 2.5x bigger".
> [...]
> I think that a lot of space can be saved if these operators are used
> instead of the TextMatrix.

This is all my fault, since I didn't change the subject of this thread.

Robert Schlicht solved this in a previous message 
(http://tug.org/pipermail/luatex/2010-July/001854.html). It was an issue 
of better tuning, since the default font expansion in LuaTeX isn't 
typographycally recommended.

Thanks for your help,


Pablo

From martin at oneiros.de  Sun Aug  8 12:42:26 2010
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Sun, 8 Aug 2010 12:42:26 +0200
Subject: [luatex] the hz algorithm
Message-ID: <AANLkTimviOb1c3r7rdj3sU=--5_DFnhkZn+ttS7p=PM8@mail.gmail.com>

2010/8/8 Pablo Rodr?guez <oinos at web.de>:
> I'm not a lawyer, but even in the legal side of this issue (when the the
> European doesn't expire until 1/1/2011), there might be a related patent for
> a line-breaking algorithm granted to Adobe
> (http://www.freepatentsonline.com/6510441.pdf) that might involve the
> hz-algorithm (http://typophile.com/node/16525).

That patent should be easy to shoot down as TeX is clearly prior art.
I didn't read it all, but on a cursory glance it looks much like TeX.

Best
   Martin


From hartmut_henkel at gmx.de  Sun Aug  8 12:59:16 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 8 Aug 2010 12:59:16 +0200 (CEST)
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281257400.4c5e6fb87cb38@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281257400.4c5e6fb87cb38@imp.free.fr>
Message-ID: <alpine.DEB.2.00.1008081258130.23161@hahepc1.hahe>

On Sun, 8 Aug 2010, Paul Isambert wrote:

> It'd be interesting to know what a PDF file produced with InDesign
> (hence very probably hz) looks like.

me too.

> But is there a possibility to compress the file as little as possible
> with InDesign, so we can read it?

you can always use pdftk to uncompress, it doesn't change the page
stream contents.

Regards, Hartmut


From hartmut_henkel at gmx.de  Sun Aug  8 13:10:28 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 8 Aug 2010 13:10:28 +0200 (CEST)
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <19549.63650.827919.756429@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
Message-ID: <alpine.DEB.2.00.1008081300530.23219@hahepc1.hahe>

On Sun, 8 Aug 2010, Reinhard Kotucha wrote:

> There is probably some room for improvements.  The TJ operator
> supports kerning already quite similar to dvips, which is very
> efficient.
>
> Example (from the PDF reference manual):
>
>   [(A) 120 (W) 120 (A) 95 (Y)] TJ

that's already being used, as long as no expand change is needed. The
reason for repeated Tm is that different glyphs in a line may have
different efcode tagged to them, so that several expand switches are
needed in the same line.

> And the Th operator supports horizontal scaling.
>
> I think that a lot of space can be saved if these operators are used
> instead of the TextMatrix.

yes, one could try this. I refrained from using Th as it's not entirely
clear yet how the absolute horizontal PDF position is incrementally
updated when using Th []TJ Th []TJ sequences, in particular with mixed
horizontal and vertical typesetting. This would need some experimenting.
With the absolute position reset done be Tm it's rather safe.

Regards, Hartmut

From reinhard.kotucha at web.de  Sun Aug  8 15:51:28 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 8 Aug 2010 15:51:28 +0200
Subject: [luatex] the hz algorithm
In-Reply-To: <AANLkTimviOb1c3r7rdj3sU=--5_DFnhkZn+ttS7p=PM8@mail.gmail.com>
References: <AANLkTimviOb1c3r7rdj3sU=--5_DFnhkZn+ttS7p=PM8@mail.gmail.com>
Message-ID: <19550.46688.573004.605118@zaphod.ms25.net>

On 8 August 2010 Martin Schr?der wrote:

 > 2010/8/8 Pablo Rodr?guez <oinos at web.de>:
 > > I'm not a lawyer, but even in the legal side of this issue (when
 > > the the European doesn't expire until 1/1/2011), there might be a
 > > related patent for a line-breaking algorithm granted to Adobe
 > > (http://www.freepatentsonline.com/6510441.pdf) that might involve
 > > the hz-algorithm (http://typophile.com/node/16525).
 > 
 > That patent should be easy to shoot down as TeX is clearly prior
 > art.  I didn't read it all, but on a cursory glance it looks much
 > like TeX.

The invention is to find optimal line breaks only in a portion of a
paragraph instead of the whole paragraph in order to save resources.
So it's an extension of Knuth's algorithm.

It makes some sense if the cost grows quadratically with the size of a
paragraph and paragraphs are large.  I don't know how much is gained,
but it might be irrelevant since we have computers now which can
compile "The TeXbook" within less than a second.

BTW, you'll find the original of the graph shown in the patent in a
reprint of an article written by Knuth and Plass in

  Donald E Knuth, Digital Typography, CSLI, Stanford 1999, page 107.

The original article is mentioned in the patent.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From zappathustra at free.fr  Sun Aug  8 16:18:04 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 08 Aug 2010 16:18:04 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <alpine.DEB.2.00.1008081258130.23161@hahepc1.hahe>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281257400.4c5e6fb87cb38@imp.free.fr>
	<alpine.DEB.2.00.1008081258130.23161@hahepc1.hahe>
Message-ID: <1281277084.4c5ebc9ce78dc@imp.free.fr>

Selon Hartmut Henkel <hartmut_henkel at gmx.de>:

> On Sun, 8 Aug 2010, Paul Isambert wrote:
>
> > It'd be interesting to know what a PDF file produced with InDesign
> > (hence very probably hz) looks like.
>
> me too.
>
> > But is there a possibility to compress the file as little as possible
> > with InDesign, so we can read it?
>
> you can always use pdftk to uncompress, it doesn't change the page
> stream contents.

Well then, since I can't find a PDF document made with InDesign on the internet
(Adobe's technical docs are made with FrameMaker), or the ones I find don't
display much text, and generally it's ragged right (so probably no hz), etc.,
etc., I'm downloading the trial version of InDesign. My internet access is
pretty slow, so it takes some time, but I think I'll be able to make some
comparisons between TeX and InDesign output tonight or tomorrow. If anybody's
interested, I can send some files, or you can download InDesign too. Anyway I'll
post here if I find any fascinating difference.

Note that I've had to create an account at Adobe. I hope you'll appreciate the
sacrifice :)

Best,
Paul


From arthur.reutenauer at normalesup.org  Sun Aug  8 16:33:05 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 8 Aug 2010 16:33:05 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281277084.4c5ebc9ce78dc@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281257400.4c5e6fb87cb38@imp.free.fr>
	<alpine.DEB.2.00.1008081258130.23161@hahepc1.hahe>
	<1281277084.4c5ebc9ce78dc@imp.free.fr>
Message-ID: <20100808143305.GA15496@phare.normalesup.org>

>                                                                  If anybody's
> interested, I can send some files, or you can download InDesign too. Anyway I'll
> post here if I find any fascinating difference.

  Please do post the files somewhere, be it only for completeness.

	Arthur

From arthur.reutenauer at normalesup.org  Sun Aug  8 16:34:37 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 8 Aug 2010 16:34:37 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281258476.4c5e73ec1ef8b@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
Message-ID: <20100808143437.GB15496@phare.normalesup.org>

> (LuaTeX has another difference: every line of text is a separate line of code in
> the PDF, whereas pdfTeX produces very long lines; the Lua way is definitely more
> readable, although I don't spend my time reading PDFs.)

  As you know, this makes no difference at all for the file size since
it's only replacing ASCII 0x20, a single byte, by ASCII 0x0a, another
single byte.

	Arthur

From reinhard.kotucha at web.de  Sun Aug  8 18:34:08 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 8 Aug 2010 18:34:08 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281257400.4c5e6fb87cb38@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281257400.4c5e6fb87cb38@imp.free.fr>
Message-ID: <19550.56448.438580.150923@zaphod.ms25.net>

On 8 August 2010 Paul Isambert wrote:

 > Selon Reinhard Kotucha <reinhard.kotucha at web.de>:
 > 
 > > There is probably some room for improvements.  The TJ operator
 > > supports kerning already quite similar to dvips, which is very
 > > efficient.
 > >
 > > Example (from the PDF reference manual):
 > >
 > >   [(A) 120 (W) 120 (A) 95 (Y)] TJ
 > >
 > > And the Th operator supports horizontal scaling.
 > >
 > > I think that a lot of space can be saved if these operators are used
 > > instead of the TextMatrix.
 > 
 > If I'm not mistaken, that's letterspacing instead of glyph
 > reshaping, right?

Yes, the numbers between characters denote the amount of kerning.
Glyph reshaping can be done using the Th operator.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Sun Aug  8 19:18:01 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 08 Aug 2010 19:18:01 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <19550.56448.438580.150923@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281257400.4c5e6fb87cb38@imp.free.fr>
	<19550.56448.438580.150923@zaphod.ms25.net>
Message-ID: <1281287881.4c5ee6c92fff5@imp.free.fr>

Selon Reinhard Kotucha <reinhard.kotucha at web.de>:

> On 8 August 2010 Paul Isambert wrote:
>
>  > Selon Reinhard Kotucha <reinhard.kotucha at web.de>:
>  >
>  > > There is probably some room for improvements.  The TJ operator
>  > > supports kerning already quite similar to dvips, which is very
>  > > efficient.
>  > >
>  > > Example (from the PDF reference manual):
>  > >
>  > >   [(A) 120 (W) 120 (A) 95 (Y)] TJ
>  > >
>  > > And the Th operator supports horizontal scaling.
>  > >
>  > > I think that a lot of space can be saved if these operators are used
>  > > instead of the TextMatrix.
>  >
>  > If I'm not mistaken, that's letterspacing instead of glyph
>  > reshaping, right?
>
> Yes, the numbers between characters denote the amount of kerning.
> Glyph reshaping can be done using the Th operator.

Which pdf/LuaTeX don't use, I guess because since expansion is made line by
line, it goes faster to use Tm to both expand and move to the beginning of the
line. I've said earlier that pdfTeX uses Td to move to the next line (while
LuaTeX uses Tm), but that's the case without expansion. If expansion is in
force, it uses Tm - even if the line isn't reshaped (i.e. 1 0 0 1 x y Tm).

Best,
Paul

From reinhard.kotucha at web.de  Sun Aug  8 23:22:45 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 8 Aug 2010 23:22:45 +0200
Subject: [luatex] the hz algorithm (was:Re: LuaTeX file almost 2.5x
	bigger)
In-Reply-To: <4C5E804D.4050603@web.de>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<4C5E804D.4050603@web.de>
Message-ID: <19551.8229.318716.6821@zaphod.ms25.net>

On 8 August 2010 Pablo Rodr?guez wrote:

 > On 08/08/2010 02:21 AM, Reinhard Kotucha wrote:
 > > On 7 August 2010 Martin Schr?der wrote:
 > >
 > >   >  2010/8/7 Pablo Rodr?guez<oinos at web.de>:
 > >   >  >  I guess there is no way to avoid it (since there is no easy way
 > >   >  >  to avoid the patent itself).
 > >   >
 > >   >  Well, the patent is EP0466953, which should have expired on
 > >   >  2010-07-18 (1990-07-17 plus 20 years), but IANAL... :-)
 > >
 > > There are also severe technical problems.  I assume that Zapf's idea
 > > is based on multiple-master fonts.  But since such fonts are not
 > > available, there is no easy way to implement Zapf's algorithm.
 > > Hence it's not only a legal problem.
 > 
 > Thanks for your reply, Reinhard.
 > 
 > I'm not a lawyer, but even in the legal side of this issue (when the the 
 > European doesn't expire until 1/1/2011), there might be a related patent 
 > for a line-breaking algorithm granted to Adobe 
 > (http://www.freepatentsonline.com/6510441.pdf) that might involve the 
 > hz-algorithm (http://typophile.com/node/16525).

The patent only mentions an article written by Zapf and Karow in
section "OTHER PUBLICATIONS".  I do not see anything about character
protrusion or font expansion in the patent itself.
 
 > > The difference between Thanh's and Zapf's algorithms is that Thanh
 > > scales the glyphs horizontally while Zapf proposes to create dedicated
 > > instances of a font where the stroke width is preserved.
 > >
 > > Quite strange: There is no easy way to implement Zapf's algorithm
 > > anymore since we have/prefer Type1 fonts, TTF, and OTF.  With
 > > Metafont, I believe, it's not a big deal. :)
 > 
 > If I don't get you point wrong, the original hz-algorithm is not 
 > suitable for other fonts than Multiple Master, is it?

Yes.  If the stroke width has to be preserved, you can't simply scale
the glyphs horizontically.  An example is here, see the figure showing
the letters "m" and "i":

  http://www.typografi.org/justering/gut_hz/gutenberg_hz_english.html

It seems that the implementation of font expansion in InDesign is
quite similar as in pdfTeX.

 > I wounder whether US Patent 6510441 
 > (http://www.freepatentsonline.com/6510441.pdf) solves this.

No, it's only about line breaking.  See my response to Martin's mail.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From zappathustra at free.fr  Mon Aug  9 00:13:07 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 09 Aug 2010 00:13:07 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <20100808143437.GB15496@phare.normalesup.org>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
Message-ID: <1281305587.4c5f2bf37e0a8@imp.free.fr>

Allright, InDesign has been downloaded, installed, and used. (Not bad, I must
admit.) You'll find files here:

http://paulisambert.free.fr/tex/

I'll let you appreciate the difference in justification. Note that barring font
expansion, I haven't tried to set identical spacing (I've just set French
spacing in TeX) and hyphenation rules.

Unfortunately, the uncompressed PDF made with InDesign has text strings written
with character codes, which makes it pretty painful to read. I haven't been able
to overdo that since I don't know where to look in the first place.

Remember that T* means "move to the next line". And note that the expanded text
appears after the non-expanded one (from line 175), probably because I've set
them in that order in InDesign, even though the output displays the other way
around.

On the whole, nothing fascinating: InDesign uses Tm for expansion (and move to
the next like). Which was expected. The difference in result is rather striking,
though, but might be tied to differences in space stretching/shrinking.

Best,
Paul

From hartmut_henkel at gmx.de  Mon Aug  9 01:37:26 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Mon, 9 Aug 2010 01:37:26 +0200 (CEST)
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281305587.4c5f2bf37e0a8@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
Message-ID: <alpine.DEB.2.00.1008090120300.7828@hahepc1.hahe>

Hi Paul,

On Mon, 9 Aug 2010, Paul Isambert wrote:
>
> On the whole, nothing fascinating: InDesign uses Tm for expansion (and
> move to the next like). Which was expected. The difference in result
> is rather striking, though, but might be tied to differences in space
> stretching/shrinking.

very interesting, many thanks! In this example InDesign treats whole
lines by only one Tm, so that all glyphs in one line have the same
expansion. This gets much more busy in the page stream when characters
have different \efcode values, so that glyphs within one line need
different expansion, leading to the file size increase as seen in the
discussed luatex examples. But as it looks, there should be no file size
penalty with luatex over InDesign, if all characters have the same
\efcode. The \efcode refinement can be seen as a quality feature for
pdftex/luatex.

Does InDesign also allow such variable glyph expansion by \efcode within
one line?

Regards, Hartmut

From zappathustra at free.fr  Mon Aug  9 13:28:19 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 09 Aug 2010 13:28:19 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <alpine.DEB.2.00.1008090120300.7828@hahepc1.hahe>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
	<alpine.DEB.2.00.1008090120300.7828@hahepc1.hahe>
Message-ID: <1281353299.4c5fe6537b326@imp.free.fr>

Selon Hartmut Henkel <hartmut_henkel at gmx.de>:

> Hi Paul,
>
> On Mon, 9 Aug 2010, Paul Isambert wrote:
> >
> > On the whole, nothing fascinating: InDesign uses Tm for expansion (and
> > move to the next like). Which was expected. The difference in result
> > is rather striking, though, but might be tied to differences in space
> > stretching/shrinking.
>
> very interesting, many thanks! In this example InDesign treats whole
> lines by only one Tm, so that all glyphs in one line have the same
> expansion. This gets much more busy in the page stream when characters
> have different \efcode values, so that glyphs within one line need
> different expansion, leading to the file size increase as seen in the
> discussed luatex examples. But as it looks, there should be no file size
> penalty with luatex over InDesign, if all characters have the same
> \efcode. The \efcode refinement can be seen as a quality feature for
> pdftex/luatex.
>
> Does InDesign also allow such variable glyph expansion by \efcode within
> one line?


If there is such an option, I haven't found it. I guess there isn't any.

Interestingly, the expansion step, if any, seems very small in InDesign. For
instance, on line 179:

9.8327 0 0 10 85.0394 685.8898 Tm

which translates as .98327 ... Tm for us (there must be a scaling somewhere but
I can't find it); pdfTeX's step is as least 1, i.e. one thousandth... although I
guess you can use decimal values in LuaTeX's fonts.expansions table?


Now, you can set TeX's spacing to InDesign's values, which are much more
drastic:

\spaceskip=3.33333pt plus 1.1pt minus 0.66666pt

This represents 133% stretch and 80% shrink (whereas TeX's default plus
1.66666pt minus 1.11111pt is 150% stretch and 67% shrink, if I'm not mistaken).

The results are then similar in the expanded text: TeX produces one bad box in
the third paragraph, and InDesign too ("widow, an emergence from C, a titular
C,"). The difference is that InDesign creates an undefull line, whereas TeX
makes an overfull one (InDesign isn't allowed to create overfull boxes, I
suppose).

In the non-expanded text, InDesign produces 12 bad boxes, pdfTeX 1, and LuaTeX
10... I understand the difference between InDesign and LuaTeX (TeX may avoid
several undefull boxes with one overfull one, so actually there's no real
difference), but I don't understand the difference between LuaTeX and pdfTeX. I
know difference in justification are supposed to occur, but is it normal to this
extent?

Best,
Paul

From zappathustra at free.fr  Mon Aug  9 14:12:30 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 09 Aug 2010 14:12:30 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281353299.4c5fe6537b326@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
	<alpine.DEB.2.00.1008090120300.7828@hahepc1.hahe>
	<1281353299.4c5fe6537b326@imp.free.fr>
Message-ID: <1281355950.4c5ff0ae40355@imp.free.fr>

Selon Paul Isambert <zappathustra at free.fr>:


> In the non-expanded text, InDesign produces 12 bad boxes, pdfTeX 1, and
> LuaTeX
> 10... I understand the difference between InDesign and LuaTeX (TeX may avoid
> several undefull boxes with one overfull one, so actually there's no real
> difference), but I don't understand the difference between LuaTeX and pdfTeX.
> I
> know difference in justification are supposed to occur, but is it normal to
> this
> extent?

And: both LuaTeX and pdfTeX produce the same first line for the third paragraph
(broken after "undeterred"), but it is bad in LuaTeX only (0.283284pt too
large). Then, if I do:

\hbox to6cm{And still the hushing plaint, undeterred}

(where 6cm is the original \hsize minus \parindent) both pdfTeX and LuaTeX
reports an overfull box, 0.28386pt too large.

Finally, pdfTeX producing dvi behaves like LuaTeX. (Difference in font?)

So: why such a difference between LuaTeX and pdfTeX -- and why such a difference
between the paragraph builder and an explicit box?

I'm loosing my Latin, we say in French. I guess InDesign must be messing with my
neurons, because there must be an extremely simple explanation.

Best,
Paul

From reinhard.kotucha at web.de  Tue Aug 10 00:05:48 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 10 Aug 2010 00:05:48 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <1281305587.4c5f2bf37e0a8@imp.free.fr>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
Message-ID: <19552.31676.388930.725794@zaphod.ms25.net>

On 9 August 2010 Paul Isambert wrote:

 > Unfortunately, the uncompressed PDF made with InDesign has text
 > strings written with character codes, which makes it pretty painful
 > to read.

I'm wondering which character encoding is used:

 (\007\033\030\f\032\013\031)

It doesn't look like ASCII, ISO-8859-*, UTF-8, or UCS-2.  
All these encodings support ASCII.  What's \007 here?  

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From hartmut_henkel at gmx.de  Tue Aug 10 00:57:11 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Tue, 10 Aug 2010 00:57:11 +0200 (CEST)
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <19552.31676.388930.725794@zaphod.ms25.net>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
	<19552.31676.388930.725794@zaphod.ms25.net>
Message-ID: <alpine.DEB.2.00.1008100050080.7472@hahepc1.hahe>

On Tue, 10 Aug 2010, Reinhard Kotucha wrote:
> On 9 August 2010 Paul Isambert wrote:
>
>  > Unfortunately, the uncompressed PDF made with InDesign has text
>  > strings written with character codes, which makes it pretty painful
>  > to read.
>
> I'm wondering which character encoding is used:
>
>  (\007\033\030\f\032\013\031)
>
> It doesn't look like ASCII, ISO-8859-*, UTF-8, or UCS-2.  All these
> encodings support ASCII.  What's \007 here?

Bond --- James Bond :-)

It's octal and seems to be translated by object no. 8 to "woeful ":

007 0x07 0x77 w
033 0x1b 0x6f o
030 0x18 0x65 e
f   f    f    f
032 0x1a 0x75 u
013 0x0b 0x6c l
031 0x19 0x20 Blank

Regards, Hartmut

From aschmittbuhl at libertysurf.fr  Tue Aug 10 11:36:52 2010
From: aschmittbuhl at libertysurf.fr (Arnaud Schmittbuhl)
Date: Tue, 10 Aug 2010 11:36:52 +0200
Subject: [luatex] luaotfload dot tex
Message-ID: <20100810113652.5b92501a@debian>


Hi all,

Two insignificant questions about luaotfload.

1/ 'luaotfload.sty' is the name of the beast. Why .sty?
Why not a two lines .sty wrapper and a .tex file?
There must be a good reason... which one?

2/ Don't you think that the luaotfload doc should use an otf font to
illustrate its major goal? It looks like you do not trust your code ;-)

Thanks for that really nice tool!

-- 
Arnaud Schmittbuhl
France

From elie.roux at telecom-bretagne.eu  Tue Aug 10 12:38:46 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 10 Aug 2010 12:38:46 +0200
Subject: [luatex] luaotfload dot tex
In-Reply-To: <20100810113652.5b92501a@debian>
References: <20100810113652.5b92501a@debian>
Message-ID: <4C612C36.1010907@telecom-bretagne.eu>

Arnaud Schmittbuhl a ?crit :
> 1/ 'luaotfload.sty' is the name of the beast. Why .sty?
> Why not a two lines .sty wrapper and a .tex file?
> There must be a good reason... which one?
>   

Hello,

there is no particularly good reason for a wrapper neither... having one 
file instead of two is maybe more confortable.

> 2/ Don't you think that the luaotfload doc should use an otf font to
> illustrate its major goal? It looks like you do not trust your code ;-)
>   

To avoid complex doc compilation. Like this even pdfTeX can compile it. 
It's way simpler than for instance fontspec documentation that only 
people on mac can compile.

Thank you,
-- 
Elie

From reinhard.kotucha at web.de  Tue Aug 10 19:55:43 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 10 Aug 2010 19:55:43 +0200
Subject: [luatex] LuaTeX file almost 2.5x bigger
In-Reply-To: <alpine.DEB.2.00.1008100050080.7472@hahepc1.hahe>
References: <1281007820.4c5aa0cc7dfb9@imp.free.fr>
	<4C5AA3BB.2070208@elvenkind.com> <4C5D481E.7030203@web.de>
	<AANLkTinUqT76175k7K3-+bbjp0VxqF1wUzamERegw1Ws@mail.gmail.com>
	<19549.63650.827919.756429@zaphod.ms25.net>
	<1281258476.4c5e73ec1ef8b@imp.free.fr>
	<20100808143437.GB15496@phare.normalesup.org>
	<1281305587.4c5f2bf37e0a8@imp.free.fr>
	<19552.31676.388930.725794@zaphod.ms25.net>
	<alpine.DEB.2.00.1008100050080.7472@hahepc1.hahe>
Message-ID: <19553.37535.634899.86804@zaphod.ms25.net>

On 10 August 2010 Hartmut Henkel wrote:

 > On Tue, 10 Aug 2010, Reinhard Kotucha wrote:
 > > On 9 August 2010 Paul Isambert wrote:
 > >
 > >  > Unfortunately, the uncompressed PDF made with InDesign has text
 > >  > strings written with character codes, which makes it pretty painful
 > >  > to read.
 > >
 > > I'm wondering which character encoding is used:
 > >
 > >  (\007\033\030\f\032\013\031)
 > >
 > > It doesn't look like ASCII, ISO-8859-*, UTF-8, or UCS-2.  All these
 > > encodings support ASCII.  What's \007 here?
 > 
 > Bond --- James Bond :-)

:)
 
 > It's octal and seems to be translated by object no. 8 to "woeful ":
 > 
 > 007 0x07 0x77 w
 > 033 0x1b 0x6f o
 > 030 0x18 0x65 e
 > f   f    f    f
 > 032 0x1a 0x75 u
 > 013 0x0b 0x6c l
 > 031 0x19 0x20 Blank

Aaah, CID encryption. :)

Thanks,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From simon at mintsource.org  Wed Aug 11 17:22:08 2010
From: simon at mintsource.org (Simon Peter Nicholls)
Date: Wed, 11 Aug 2010 17:22:08 +0200
Subject: [luatex] lualatex not setting filename as jobname when using \input
	in command	line
Message-ID: <4C62C020.8020502@mintsource.org>

Is there a known issue where lualatex fails to set the jobname as the 
filename when "\input" is specified on the command line?

I'm using Emacs with Auctex 11.86, and the generated LaTeX command 
results in output going to "texput" files. Here's a test run with the 
fontspec luatex test file 
(http://www.ctan.org/tex-archive/macros/xetex/latex/fontspec/):

lualatex -interaction=nonstopmode "\input" fontspec-luatex.tex
This is LuaTeX, Version beta-0.60.1-2010062416 (TeX Live 2010) (rev 3723)
...
Transcript written on texput.log.

When I process tex files using xetex or pdftex engines (or even luatex, 
ignoring the control sequence errors), the jobname is set to the sole 
input, and I get the fontspec-luatex.* files I expect. Running the 
lualatex command without "\input" works too.

Thanks,
Si

From taco at elvenkind.com  Wed Aug 11 18:00:24 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 11 Aug 2010 18:00:24 +0200
Subject: [luatex] lualatex not setting filename as jobname when using
 \input	in command	line
In-Reply-To: <4C62C020.8020502@mintsource.org>
References: <4C62C020.8020502@mintsource.org>
Message-ID: <4C62C918.9020609@elvenkind.com>

On 08/11/2010 05:22 PM, Simon Peter Nicholls wrote:
> Is there a known issue where lualatex fails to set the jobname as the
> filename when "\input" is specified on the command line?

That problem does not happen for me with an older lualatex.ini,
but it does happen with the one from texlive (the newest I have).

But I do not know how this is possible (yet).

Best wishes,
Taco

From mpg at elzevir.fr  Wed Aug 11 19:39:21 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 11 Aug 2010 19:39:21 +0200
Subject: [luatex] lualatex not setting filename as jobname when using
 \input	in command	line
In-Reply-To: <4C62C918.9020609@elvenkind.com>
References: <4C62C020.8020502@mintsource.org> <4C62C918.9020609@elvenkind.com>
Message-ID: <4C62E049.8020409@elzevir.fr>

Le 11/08/2010 18:00, Taco Hoekwater a ?crit :
> On 08/11/2010 05:22 PM, Simon Peter Nicholls wrote:
>> Is there a known issue where lualatex fails to set the jobname as the
>> filename when "\input" is specified on the command line?
> 
> That problem does not happen for me with an older lualatex.ini,
> but it does happen with the one from texlive (the newest I have).
> 
> But I do not know how this is possible (yet).
> 
I'm afraid I do. The new lualatex.ini tries to fix an issue with \jobname
containing spaces, checking \jobname (and possibly redefining it) at \everyjob time.

Apparently, looking at the value of \jobname forces luatex to set \jobname
immediately while it would normally wait for the first \input to do so.
I'm really really sorry for forgetting to test this case.

For reference, the problem I was trying to address in luatexquotejobname.tex is
the following:

1. The latex kernel, as well as 3rd-party packages (and most probably personal
macros too) do \input\jobname.ext at some points. It fails horribly when
\jobname contains a space.
2. The cleanest solution would probably involve fixing those macros to use
\input "\jobname.ext" but it doesn't sound very realistic.
3. pdftex (web2c) provides a workaround by automagically quoting \jobname.
3a. LuaTeX doesn't do so, as already discussed in [1], and for good reasons IMO.
3b. Even if the solution from point 2 was realistic, it would be even more
complicated to implement it while remaining compatible with pdftex.
3c. So the only solution seemed to be mimicking pdftex's automagic quoting using
macros, but it is clearly a failure.

[1] http://www.ntg.nl/pipermail/dev-luatex/2009-April/002549.html

Manuel.

From taco at elvenkind.com  Wed Aug 11 20:18:19 2010
From: taco at elvenkind.com (taco)
Date: Wed, 11 Aug 2010 20:18:19 +0200
Subject: [luatex] lualatex not setting filename as jobname when using
 \input	in command	line
In-Reply-To: <4C62E049.8020409@elzevir.fr>
References: <4C62C020.8020502@mintsource.org> <4C62C918.9020609@elvenkind.com>
	<4C62E049.8020409@elzevir.fr>
Message-ID: <4C62E96B.9090202@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Le 11/08/2010 18:00, Taco Hoekwater a ?crit :
>> On 08/11/2010 05:22 PM, Simon Peter Nicholls wrote:
>>> Is there a known issue where lualatex fails to set the jobname as the
>>> filename when "\input" is specified on the command line?
>> That problem does not happen for me with an older lualatex.ini,
>> but it does happen with the one from texlive (the newest I have).
>>
>> But I do not know how this is possible (yet).
>>
> I'm afraid I do. The new lualatex.ini tries to fix an issue with \jobname
> containing spaces, checking \jobname (and possibly redefining it) at \everyjob time.
> 
> Apparently, looking at the value of \jobname forces luatex to set \jobname
> immediately while it would normally wait for the first \input to do so.
> I'm really really sorry for forgetting to test this case.

Well, I think this is a fairly minor issue. But then, I believe it was
a mistake of Knuth (and later web2c) to allow actual TeX code on the
command line at all.

Best wishes,
Taco

From simon at mintsource.org  Thu Aug 12 15:25:55 2010
From: simon at mintsource.org (Simon Peter Nicholls)
Date: Thu, 12 Aug 2010 15:25:55 +0200
Subject: [luatex] lualatex not setting filename as jobname when
	using	\input	in command	line
In-Reply-To: <4C62E96B.9090202@elvenkind.com>
References: <4C62E96B.9090202@elvenkind.com>
Message-ID: <4C63F663.9000500@mintsource.org>

Thanks for the comments, guys. For now I'll configure my AucTeX to pass 
in the filename as a jobname parameter.

Si

From linuxss at list.ru  Thu Aug 19 14:58:43 2010
From: linuxss at list.ru (Linas)
Date: Thu, 19 Aug 2010 12:58:43 +0000 (UTC)
Subject: [luatex] DVI h/vlist position
Message-ID: <loom.20100819T143906-733@post.gmane.org>

Hi, All!
I tried to find an info about (h/v)list coordinates in dvi file. Is it possible
to find out any corner of hlist where it is fitted into a page?

There could be an information reporting callback 'shipout_filter' which could
write a positions of the fitted boxes?

shipout: hbox atrr lly llx width height 
(width and height is known from hlist node)

does anybody knows about box coordinates after shipout?

thanks, Linas


From heiko.oberdiek at googlemail.com  Thu Aug 19 23:43:39 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 19 Aug 2010 23:43:39 +0200
Subject: [luatex] DVI h/vlist position
In-Reply-To: <loom.20100819T143906-733@post.gmane.org>
References: <loom.20100819T143906-733@post.gmane.org>
Message-ID: <20100819214338.GA11154@oberdiek.my-fqdn.de>

On Thu, Aug 19, 2010 at 12:58:43PM +0000, Linas wrote:

> I tried to find an info about (h/v)list coordinates in dvi file. Is it possible
> to find out any corner of hlist where it is fitted into a page?

The feature \pdfsavepos also works in DVI mode.

Yours sincerely
  Heiko Oberdiek

From zappathustra at free.fr  Fri Aug 20 09:17:10 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 20 Aug 2010 09:17:10 +0200
Subject: [luatex] DVI h/vlist position
In-Reply-To: <20100819214338.GA11154@oberdiek.my-fqdn.de>
References: <loom.20100819T143906-733@post.gmane.org>
	<20100819214338.GA11154@oberdiek.my-fqdn.de>
Message-ID: <1282288630.4c6e2bf6b5a47@imp.free.fr>

Selon Heiko Oberdiek <heiko.oberdiek at googlemail.com>:

> On Thu, Aug 19, 2010 at 12:58:43PM +0000, Linas wrote:
>
> > I tried to find an info about (h/v)list coordinates in dvi file. Is it
> possible
> > to find out any corner of hlist where it is fitted into a page?
>
> The feature \pdfsavepos also works in DVI mode.

Otherwise you can still analyze the box that's being shipped out, singling out
boxes thanks to attributes. I don't know if it's simpler than \pdfsavepos (never
tried that function).

Paul

From heiko.oberdiek at googlemail.com  Fri Aug 20 09:38:58 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Fri, 20 Aug 2010 09:38:58 +0200
Subject: [luatex] DVI h/vlist position
In-Reply-To: <1282288630.4c6e2bf6b5a47@imp.free.fr>
References: <loom.20100819T143906-733@post.gmane.org>
	<20100819214338.GA11154@oberdiek.my-fqdn.de>
	<1282288630.4c6e2bf6b5a47@imp.free.fr>
Message-ID: <20100820073857.GA14348@oberdiek.my-fqdn.de>

On Fri, Aug 20, 2010 at 09:17:10AM +0200, Paul Isambert wrote:

> Selon Heiko Oberdiek <heiko.oberdiek at googlemail.com>:
> 
> > On Thu, Aug 19, 2010 at 12:58:43PM +0000, Linas wrote:
> >
> > > I tried to find an info about (h/v)list coordinates in dvi file. Is it
> > possible
> > > to find out any corner of hlist where it is fitted into a page?
> >
> > The feature \pdfsavepos also works in DVI mode.
> 
> Otherwise you can still analyze the box that's being shipped out, singling out
> boxes thanks to attributes. I don't know if it's simpler than \pdfsavepos (never
> tried that function).

\pdfsavepos is simpler, because the analyzing is done by the engine.
However it needs two compile runs.

Yours sincerely
  Heiko Oberdiek

From taco at elvenkind.com  Mon Aug 23 09:01:16 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 23 Aug 2010 09:01:16 +0200
Subject: [luatex] Luatex 0.62.0 announcement
Message-ID: <4C721CBC.6000702@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.62.0.
This is a development release, but it also fixes some nasty bugs
in beta 0.61.0, so if you use that right now, upgrading is recommended.

News:

* LuaTeX now uses libpoppler (0.12.4) instead of xpdf.

* All backend functions now report what file they were searching
   for whenever a file cannot be found.

* Input-ed lua files are now mentioned in the fls file if
   the --recorder switch is specified on the command line.

* Paragraph indentation hlist nodes and hlist and vlist nodes
   generated by alignment rows and cells now have a subtype
   (3 for indent box, 4 for rows/columns, 5 for cells).

* The 'epdf' lib is in active development and still growing.

* The 'fontforge' table is finally removed (was deprecated
   since 0.40).

Bugfixes:

* A new mplib import fixes two bad bugs in mplib:
   - string equality test was wrong
   - type declarations could delete pre-existing variables

* PNG images with transparency could create random size
   differences in the generated PDF.

* In some special cases, font expansion could cause wrong
   spacing in the generated PDF.

* \letterspacefont was broken since a very long time.

* The node subtype of the \leftskip and \rightskip glues was
   wrong.

* Some memory leaks have been removed.

* Various manual fixes.


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.62.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org

Have fun,
Taco




From joseph.wright at morningstar2.co.uk  Mon Aug 23 21:56:05 2010
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Mon, 23 Aug 2010 20:56:05 +0100
Subject: [luatex] Crash with hyphenation patterns
Message-ID: <4C72D255.1030101@morningstar2.co.uk>

Hello all,

With the minimal format file

\catcode `\{ = 1 \relax
\catcode `\} = 2 \relax
\catcode 32  = 9  \relax
\endlinechar = 32 \relax
\input hyphen.tex
\dump

everything works fine with either pdfTeX or XeTeX (TeX Live 2010 Pretest 
builds). However, with LuaTeX I get a crash:

This is LuaTeX, Version beta-0.60.1-2010052109 (TeX Live 2010/pretest) 
(rev 3685)  (INITEX)
  restricted \write18 enabled.
(./format.tex 
(/usr/local/texlive/2010/texmf/tex/generic/hyphen/hyphen.texAbort trap

Any idea why this is happening? (You can probably guess from the 
catcodes that this is LaTeX3-related.)
-- 
Joseph Wright

From taco at elvenkind.com  Mon Aug 23 23:29:41 2010
From: taco at elvenkind.com (taco)
Date: Mon, 23 Aug 2010 23:29:41 +0200
Subject: [luatex] Crash with hyphenation patterns
In-Reply-To: <4C72D255.1030101@morningstar2.co.uk>
References: <4C72D255.1030101@morningstar2.co.uk>
Message-ID: <4C72E845.5060908@elvenkind.com>

Joseph Wright wrote:
> 
> Any idea why this is happening? (You can probably guess from the 
> catcodes that this is LaTeX3-related.)

No idea yet, it crashes in an odd place. I will check.

Best wishes,
Taco

From pragma at wxs.nl  Tue Aug 24 00:28:45 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 24 Aug 2010 00:28:45 +0200
Subject: [luatex] the hz algorithm
In-Reply-To: <AANLkTimviOb1c3r7rdj3sU=--5_DFnhkZn+ttS7p=PM8@mail.gmail.com>
References: <AANLkTimviOb1c3r7rdj3sU=--5_DFnhkZn+ttS7p=PM8@mail.gmail.com>
Message-ID: <4C72F61D.3070909@wxs.nl>

On 8-8-2010 12:42, Martin Schr?der wrote:
> 2010/8/8 Pablo Rodr?guez<oinos at web.de>:
>> I'm not a lawyer, but even in the legal side of this issue (when the the
>> European doesn't expire until 1/1/2011), there might be a related patent for
>> a line-breaking algorithm granted to Adobe
>> (http://www.freepatentsonline.com/6510441.pdf) that might involve the
>> hz-algorithm (http://typophile.com/node/16525).
>
> That patent should be easy to shoot down as TeX is clearly prior art.
> I didn't read it all, but on a cursory glance it looks much like TeX.

He situation around hz and the patent and who owns what is somewhat 
messy (urw breaking up etc). Anyhow, long ago Hermann Zapf explicitly 
gave his blessing over the hz as used in pdftex and (1) he's the main 
inventor and (2) was afaik not involved in selling the patent.

Also, the original implementation in pdftex assumes special fonts, for 
instance multiple instances generated by metafont in which case the 
fonts are scaled but strokes are preserved. Hz itself was inspired by 
gutenberg who used fonts with multiple alternatives for glyphs.

(In the oriental tex project we use variants to achieve simular effects.)

(Anyhow, stretching glyphs in the sense of scaling lines to fit is as 
old as computers do typesetting.)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Aug 24 19:25:29 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 24 Aug 2010 19:25:29 +0200
Subject: [luatex] Crash with hyphenation patterns
In-Reply-To: <4C72D255.1030101@morningstar2.co.uk>
References: <4C72D255.1030101@morningstar2.co.uk>
Message-ID: <4C740089.1080507@elvenkind.com>



Joseph Wright wrote:
> Hello all,
> 
> With the minimal format file
> 
> \catcode `\{ = 1 \relax
> \catcode `\} = 2 \relax
> \catcode 32  = 9  \relax
> \endlinechar = 32 \relax
> \input hyphen.tex
> \dump
> 
> everything works fine with either pdfTeX or XeTeX (TeX Live 2010 Pretest
> builds). However, with LuaTeX I get a crash:
> 
> This is LuaTeX, Version beta-0.60.1-2010052109 (TeX Live 2010/pretest)
> (rev 3685)  (INITEX)
>  restricted \write18 enabled.
> (./format.tex
> (/usr/local/texlive/2010/texmf/tex/generic/hyphen/hyphen.texAbort trap
> 
> Any idea why this is happening? 

It crashed because this input creates a single pattern containing the
whole file, and the code that does the processing was not guarded
against that. I have now introduced a new error message:

  ! Pattern of enormous length ignored.

and that stops the crash (with an error).

Best wishes,
Taco





