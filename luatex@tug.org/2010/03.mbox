From elie.roux at telecom-bretagne.eu  Mon Mar  1 18:34:56 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 01 Mar 2010 19:34:56 +0200
Subject: [luatex] readlink?
Message-ID: <4B8BFAC0.8000009@telecom-bretagne.eu>

Hello,

during some scripting for a font database to be used with LuaLaTeX, I 
encountered two difficulties (Unix-only) :
 - I couldn't know if I had the permission or not to write on a file: 
lua.attributes() gives me uid, gid and the persmission string, but this 
is unusable as I don't know what is the uid of the program, and I know 
even less if I'm in a group that fits the permissions...
 - I couldn't know where the symlinks were pointing to

A solution to these two problems would be the inclusion of the posix[1] 
library. I know you're quite reluctant to new libraries inclusion, but I 
think these two problems (especially the first one) will be encountered 
by many users or at least package writers under Plain/LaTeX. Would you 
be interested in a patch implementing the needed functions to solve 
these problems? Or including the whole library? It's in the public 
domain so there aren't no legal problems.

Thank you in advance,
-- 
Elie

[1]: http://luaforge.net/frs/download.php/3572/luaposix-5.1.4.tar.gz

From taco at elvenkind.com  Mon Mar  1 18:50:09 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 01 Mar 2010 18:50:09 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8BFAC0.8000009@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>
Message-ID: <4B8BFE51.5030909@elvenkind.com>


Hi,

Elie Roux wrote:
> Hello,
> 
> during some scripting for a font database to be used with LuaLaTeX, I 
> encountered two difficulties (Unix-only) :
> - I couldn't know if I had the permission or not to write on a file: 
> lua.attributes() gives me uid, gid and the persmission string, but this 
> is unusable as I don't know what is the uid of the program, and I know 
> even less if I'm in a group that fits the permissions...

Why not just do io.open(,"w") ? if it fails, you couldn't write. And
such a test will do the 'right thing' if the disk is full or mounted
read-only.

> - I couldn't know where the symlinks were pointing to

lfs has lfs.symlinkattributes() for this, but I have never
used it so I am not sure how useful that is.

> A solution to these two problems would be the inclusion of the posix[1] 
> library. 

Libraries that do not run on win32 are definitely out of the question.

Best wishes,
Taco

From mailing_list at arcor.de  Mon Mar  1 19:23:12 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 01 Mar 2010 19:23:12 +0100
Subject: [luatex] problem with slnunicode's find
Message-ID: <4B8C0610.7030907@arcor.de>

Hi,

I have trouble getting the position of a character in a UTF-8 string 
with slnunicode.  The attached Lua script reads two UTF-8 encoded (I 
think) strings, '?b' and '??b', from a file and outputs their length and 
the position of the last character 'b'.  (UTF-8 characters are scrambled 
in the output, because this is on a Windows console.  But that shouldn't 
harm, should it?)

 > >texlua slnunicode-find.lua
 > line = ??b
 > len(line) = 2
 > character 'b' at position 3
 >
 > line = ????b
 > len(line) = 3
 > character 'b' at position 5

I would expect the positions of 'b' being 2 and 3, resp., as that are 
the lengths of the strings as returned by unicode.utf8.len.  However, 
unicode.utf8.find seems to have another notion of the length of a 
string.  To correct these values manually (apparently the byte 
positions) one needed to know how many of the characters preceding 'b' 
are multiple bytes long.  Actually, I thought, that is what slnunicode 
is made for.

What is the preferred way to get the position of a character in a UTF-8 
string, given a string contains only 'letters'?

Best regards,
Stephan Hennig


> >texlua -v
> This is LuaTeX, Version beta-0.40.6-2009110118 (Web2C 2009) luatex.web >= v14240

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: words.utf8
URL: <http://tug.org/pipermail/luatex/attachments/20100301/4660827b/attachment.pl>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: slnunicode-find.lua
URL: <http://tug.org/pipermail/luatex/attachments/20100301/4660827b/attachment-0001.pl>

From elie.roux at telecom-bretagne.eu  Mon Mar  1 19:24:01 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 01 Mar 2010 20:24:01 +0200
Subject: [luatex] readlink?
In-Reply-To: <4B8BFE51.5030909@elvenkind.com>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>
	<4B8BFE51.5030909@elvenkind.com>
Message-ID: <4B8C0641.3030406@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Why not just do io.open(,"w") ? if it fails, you couldn't write. And
> such a test will do the 'right thing' if the disk is full or mounted
> read-only.

That what I do, but this is a bit dirty as a solution...

> lfs has lfs.symlinkattributes() for this, but I have never
> used it so I am not sure how useful that is.

It gives some informations about the link, but it does not tell where it 
points.

> Libraries that do not run on win32 are definitely out of the question.

Sure, I thought about that after I sent my mail... what about adding a 
lfs.readlink available only under unix (just like lfs.symlinkattributes 
is)? And maybe having the two or three functions to get the permissions 
working would help too... The functions are like 15 lines long in 
posix.c, I think it shouldn't be a problem...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Mon Mar  1 19:39:10 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 01 Mar 2010 19:39:10 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0641.3030406@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>
	<4B8C0641.3030406@telecom-bretagne.eu>
Message-ID: <4B8C09CE.8030707@elzevir.fr>

Hi ?lie,

Elie Roux a ?crit :
> Taco Hoekwater a ?crit :
>> Why not just do io.open(,"w") ? if it fails, you couldn't write. And
>> such a test will do the 'right thing' if the disk is full or mounted
>> read-only.
> 
> That what I do, but this is a bit dirty as a solution...
> 
On the contrary, as Taco said, and as every Unix guru will confirm, it is *the*
way to go. Just try opening and see if it worked. The system is not going to
blame you because you tried to do something forbidden :-)

Manuel.


From patrick at gundla.ch  Mon Mar  1 19:42:16 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 1 Mar 2010 19:42:16 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8C0610.7030907@arcor.de>
References: <4B8C0610.7030907@arcor.de>
Message-ID: <24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>

Hi Stephan,

> I would expect the positions of 'b' being 2 and 3, resp., as that are the lengths of the strings as returned by unicode.utf8.len.  However, unicode.utf8.find seems to have another notion of the length of a string.

It is documented: (Well, sort of, you need to downlaod the slunicode library and look into 'unittest'.)

--	NOTE: find positions are in bytes for all ctypes!
--	use ascii.sub to cut found ranges!
--	this is a) faster b) more reliable

Patrick



From elie.roux at telecom-bretagne.eu  Mon Mar  1 19:43:10 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 01 Mar 2010 20:43:10 +0200
Subject: [luatex] readlink?
In-Reply-To: <4B8C09CE.8030707@elzevir.fr>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>
	<4B8C09CE.8030707@elzevir.fr>
Message-ID: <4B8C0ABE.4010204@telecom-bretagne.eu>

Manuel P?gouri?-Gonnard a ?crit :
> On the contrary, as Taco said, and as every Unix guru will confirm, it 
> is *the*
> way to go. Just try opening and see if it worked. The system is not going to
> blame you because you tried to do something forbidden :-)
>   

Ok then... it sound weird to open and close a file to see if it's 
writable, but why not... Anyway, in a purpose of path normalization I 
would really like to the the true files behind symlinks...

Thank you,
-- 
Elie

From mpg at elzevir.fr  Mon Mar  1 19:52:30 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 01 Mar 2010 19:52:30 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0ABE.4010204@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>	<4B8C09CE.8030707@elzevir.fr>
	<4B8C0ABE.4010204@telecom-bretagne.eu>
Message-ID: <4B8C0CEE.9080609@elzevir.fr>

Elie Roux a ?crit :
> Manuel P?gouri?-Gonnard a ?crit :
>> On the contrary, as Taco said, and as every Unix guru will confirm, it
>> is *the*
>> way to go. Just try opening and see if it worked. The system is not
>> going to
>> blame you because you tried to do something forbidden :-)
>>   
> 
> Ok then... it sound weird to open and close a file to see if it's
> writable, but why not...

Comme l'a dit Taco, les permissions ne te diront jamais si un syst?me de
fichiers en est lecture seule par exemple, et il y tout un tas d'autres choses
qu'elles ne te diront jamais. Exemple :

thue:/home/sftponly/shared# ls -l foo
-rw-r--r-- 1 root root 0 2010-03-01 19:48 foo
thue:/home/sftponly/shared# id
uid=0(root) gid=0(root) groups=0(root)
thue:/home/sftponly/shared# echo hi > foo
zsh: read-only file system: foo
thue:/home/sftponly/shared#

Et pourtant, c'est roo qui essaie, donc il a grave les droits...

Par ailleurs un autre probl?me est celui du temps : ce n'est pas parce qu'on
peut ?crire ? un endroit ? un moment qu'on pourra aussi ? un autre moment. Du
coup, ?a n'a pas grand sens de v?rifier si on peut ?crire dans un fichier ? un
autre moment que l'instant pr?cis om on veut y ?crire.

> Anyway, in a purpose of path normalization I
> would really like to the the true files behind symlinks...
> 
R?ponse sur la liste.

m

From khaledhosny at eglug.org  Mon Mar  1 19:53:13 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 1 Mar 2010 20:53:13 +0200
Subject: [luatex] readlink?
In-Reply-To: <4B8C0641.3030406@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>
	<4B8BFE51.5030909@elvenkind.com>
	<4B8C0641.3030406@telecom-bretagne.eu>
Message-ID: <20100301185313.GB3557@khaled-laptop>

On Mon, Mar 01, 2010 at 08:24:01PM +0200, Elie Roux wrote:
> Taco Hoekwater a ?crit :
> >Why not just do io.open(,"w") ? if it fails, you couldn't write. And
> >such a test will do the 'right thing' if the disk is full or mounted
> >read-only.
> 
> That what I do, but this is a bit dirty as a solution...
> 
> >lfs has lfs.symlinkattributes() for this, but I have never
> >used it so I am not sure how useful that is.
> 
> It gives some informations about the link, but it does not tell
> where it points.
> 
> >Libraries that do not run on win32 are definitely out of the question.
> 
> Sure, I thought about that after I sent my mail... what about adding
> a lfs.readlink available only under unix (just like
> lfs.symlinkattributes is)? And maybe having the two or three
> functions to get the permissions working would help too... The
> functions are like 15 lines long in posix.c, I think it shouldn't be
> a problem...

I'm not sure if I understand this, but aren't symlinks filesystem rather
than OS specific (i.e. no symlinks on FAT but symlinks on ISO 9660
filesystems, no matter what OS you are running)?

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mpg at elzevir.fr  Mon Mar  1 19:54:51 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 01 Mar 2010 19:54:51 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0CEE.9080609@elzevir.fr>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>	<4B8C09CE.8030707@elzevir.fr>	<4B8C0ABE.4010204@telecom-bretagne.eu>
	<4B8C0CEE.9080609@elzevir.fr>
Message-ID: <4B8C0D7B.2030807@elzevir.fr>

Oops, this was meant to be off-list. (I'm used to "reply" not going to the
list.) Sorry for speaking French here.

Manuel P?gouri?-Gonnard a ?crit :
> Elie Roux a ?crit :
>> Manuel P?gouri?-Gonnard a ?crit :
>>> On the contrary, as Taco said, and as every Unix guru will confirm, it
>>> is *the*
>>> way to go. Just try opening and see if it worked. The system is not
>>> going to
>>> blame you because you tried to do something forbidden :-)
>>>   
>> Ok then... it sound weird to open and close a file to see if it's
>> writable, but why not...
> 
> Comme l'a dit Taco, les permissions ne te diront jamais si un syst?me de
> fichiers en est lecture seule par exemple, et il y tout un tas d'autres choses
> qu'elles ne te diront jamais. Exemple :
> 
> thue:/home/sftponly/shared# ls -l foo
> -rw-r--r-- 1 root root 0 2010-03-01 19:48 foo
> thue:/home/sftponly/shared# id
> uid=0(root) gid=0(root) groups=0(root)
> thue:/home/sftponly/shared# echo hi > foo
> zsh: read-only file system: foo
> thue:/home/sftponly/shared#
> 
> Et pourtant, c'est roo qui essaie, donc il a grave les droits...
> 
> Par ailleurs un autre probl?me est celui du temps : ce n'est pas parce qu'on
> peut ?crire ? un endroit ? un moment qu'on pourra aussi ? un autre moment. Du
> coup, ?a n'a pas grand sens de v?rifier si on peut ?crire dans un fichier ? un
> autre moment que l'instant pr?cis om on veut y ?crire.
> 
>> Anyway, in a purpose of path normalization I
>> would really like to the the true files behind symlinks...
>>
> R?ponse sur la liste.
> 
> m

From mpg at elzevir.fr  Mon Mar  1 19:55:41 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 01 Mar 2010 19:55:41 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0ABE.4010204@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>	<4B8C09CE.8030707@elzevir.fr>
	<4B8C0ABE.4010204@telecom-bretagne.eu>
Message-ID: <4B8C0DAD.1070907@elzevir.fr>

Elie Roux a ?crit :
> Anyway, in a purpose of path normalization I
> would really like to the the true files behind symlinks...
> 
For this one, I'm pretty sure kpse has some function to do that. It may not be
available directly in the Lua interface, but maybe one can get it as a
side-effect of some other function. I have to go right now, but I can check that
later.

Manuel.

From elie.roux at telecom-bretagne.eu  Mon Mar  1 19:59:14 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 01 Mar 2010 20:59:14 +0200
Subject: [luatex] readlink?
In-Reply-To: <20100301185313.GB3557@khaled-laptop>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>
	<20100301185313.GB3557@khaled-laptop>
Message-ID: <4B8C0E82.40407@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> I'm not sure if I understand this, but aren't symlinks filesystem rather
> than OS specific (i.e. no symlinks on FAT but symlinks on ISO 9660
> filesystems, no matter what OS you are running)?
>   

Yes, but I don't think Windows can do symlinks, even with drivers for a 
symlinkable filesystem... anyways, having the same check as 
lfs.symlinkattributes has would be OK I guess...
-- 
Elie

From taco at elvenkind.com  Mon Mar  1 20:12:39 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 01 Mar 2010 20:12:39 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0641.3030406@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>
	<4B8C0641.3030406@telecom-bretagne.eu>
Message-ID: <4B8C11A7.40805@elvenkind.com>

Elie Roux wrote:
> Taco Hoekwater a ?crit :
>> Why not just do io.open(,"w") ? if it fails, you couldn't write. And
>> such a test will do the 'right thing' if the disk is full or mounted
>> read-only.
> 
> That what I do, but this is a bit dirty as a solution...
> 
>> lfs has lfs.symlinkattributes() for this, but I have never
>> used it so I am not sure how useful that is.
> 
> It gives some informations about the link, but it does not tell where it 
> points.

You could use a trick I've used in the past:

   local oldpwd = lfs.currentdir()
   lfs.chdir (link)
   local newpwd = lfs.currentdir()
   lfs.chdir (oldpwd)

and then compare oldpwd and newpwd, but that is not a proper replacement
for readlink(), I agree on that. If you create a tracker item on
tracker.luatex.org, I will (problaby) not forget to add lfs.readlink().

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Mon Mar  1 20:29:07 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Mon, 01 Mar 2010 21:29:07 +0200
Subject: [luatex] readlink?
In-Reply-To: <4B8C11A7.40805@elvenkind.com>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>
	<4B8C11A7.40805@elvenkind.com>
Message-ID: <4B8C1583.8080009@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> If you create a tracker item on
> tracker.luatex.org, I will (problaby) not forget to add lfs.readlink().

Done, thank you!
-- 
Elie

From reinhard.kotucha at web.de  Mon Mar  1 22:44:44 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 1 Mar 2010 22:44:44 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0CEE.9080609@elzevir.fr>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>
	<4B8BFE51.5030909@elvenkind.com>
	<4B8C0641.3030406@telecom-bretagne.eu>
	<4B8C09CE.8030707@elzevir.fr>
	<4B8C0ABE.4010204@telecom-bretagne.eu>
	<4B8C0CEE.9080609@elzevir.fr>
Message-ID: <19340.13644.357136.459764@zaphod.ms25.net>

On 1 March 2010 Manuel P?gouri?-Gonnard wrote:

 > Elie Roux a ?crit :
 >> Ok then... it sound weird to open and close a file to see if it's
 >> writable, but why not...
 > 
 > Comme l'a dit Taco, les permissions ne te diront jamais si un
 > syst?me de fichiers en est lecture seule par exemple, et il y tout
 > un tas d'autres choses qu'elles ne te diront jamais. Exemple :

Can't we continue the discussion in German?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From mailing_list at arcor.de  Mon Mar  1 23:17:48 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 01 Mar 2010 23:17:48 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
Message-ID: <4B8C3D0C.5030001@arcor.de>

Am 01.03.2010 19:42, schrieb Patrick Gundlach:

>> I would expect the positions of 'b' being 2 and 3, resp., as that
>> are the lengths of the strings as returned by unicode.utf8.len.
>> However, unicode.utf8.find seems to have another notion of the
>> length of a string.
>
> It is documented: (Well, sort of, you need to downlaod the slunicode
> library and look into 'unittest'.)

Thanks for the pointer!


> --	NOTE: find positions are in bytes for all ctypes!
 > --	use ascii.sub to cut found ranges!

Hmm, neither do I want to cut something nor do I have a range available. 
  I just want to count.  Attached is my attempt of a utf8 aware find 
function based on the utf8 aware parts of slnunicode.  Comments and 
improvements are welcome!


> --	this is a) faster b) more reliable

But leaves this simple case uncovered. :/

Best regards,
Stephan Hennig
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: utf8_find.lua
URL: <http://tug.org/pipermail/luatex/attachments/20100301/6c7e6373/attachment-0002.pl>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: words.utf8
URL: <http://tug.org/pipermail/luatex/attachments/20100301/6c7e6373/attachment-0003.pl>

From patrick at gundla.ch  Tue Mar  2 07:46:40 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 07:46:40 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8C3D0C.5030001@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
Message-ID: <FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>

Hi Stephan,

> 
>> --	NOTE: find positions are in bytes for all ctypes!
> > --	use ascii.sub to cut found ranges!
> 
> Hmm, neither do I want to cut something nor do I have a range available.  I just want to count.  Attached is my attempt of a utf8 aware find function based on the utf8 aware parts of slnunicode.  Comments and improvements are welcome!

What is wrong with

str="??ABC??"

b,e = unicode.utf8.find(str,"%u+")
print(string.sub(str,b,e))
print("count=" .. tostring(e - b + 1))

?

Patrick



From taco at elvenkind.com  Tue Mar  2 07:49:20 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 02 Mar 2010 07:49:20 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
Message-ID: <4B8CB4F0.5010904@elvenkind.com>

Patrick Gundlach wrote:
> Hi Stephan,
> 
>>> --	NOTE: find positions are in bytes for all ctypes! --	use
>>> ascii.sub to cut found ranges!
>> Hmm, neither do I want to cut something nor do I have a range
>> available.  I just want to count.  Attached is my attempt of a utf8
>> aware find function based on the utf8 aware parts of slnunicode.

Luatex itself has an internal UTF-8 counting function. At some point
(don't know when but before 1.0) the internal Unicode library will
replace slnunicode, and I will make sure that it exports a counter
as well.

Best wishes,
Taco

From mailing_list at arcor.de  Tue Mar  2 13:45:31 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 13:45:31 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
Message-ID: <4B8D086B.6020500@arcor.de>

Hi Patrick,

Am 02.03.2010 07:46, schrieb Patrick Gundlach:
>> Hmm, neither do I want to cut something nor do I have a range
>> available.  I just want to count.  Attached is my attempt of a utf8
>> aware find function based on the utf8 aware parts of slnunicode.
>> Comments and improvements are welcome!
>
> What is wrong with
>
> str="??ABC??"
>
> b,e = unicode.utf8.find(str,"%u+")
 > print(string.sub(str,b,e))
> print("count=" .. tostring(e - b + 1))
>
> ?

That counts the length of a match as long as that contains no characters 
above code point 127.  (It fails for str="?a?A?BC??".)

Anyway, what I want is the position of the match.  In your example the 
result would be 3, but the values of b and e are 5 and 7.  I can't see 
how that tells me anything.  Is there something that I'm overlooking?

Best regards,
Stephan Hennig

From mailing_list at arcor.de  Tue Mar  2 14:01:50 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 14:01:50 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8CB4F0.5010904@elvenkind.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com>
Message-ID: <4B8D0C3E.2020005@arcor.de>

Am 02.03.2010 07:49, schrieb Taco Hoekwater:

> Luatex itself has an internal UTF-8 counting function. At some point
> (don't know when but before 1.0) the internal Unicode library will
> replace slnunicode, and I will make sure that it exports a counter as
> well.

Good to know.  For the time being this paragraph from the LuaTeX manual

> Note: The string library functions find etc. are not Unicode-aware.
> In cases where this is required (i. e. because the pattern used for
> searching contains characters above code point 127), the
> corresponding functions from unicode.utf8 should be used.

is a bit misleading, since just unicode.utf8.find is again not 
Unicode-aware.  The same applies for the empty capture () in match and 
gmatch, BTW.  The output of

   str = "abcde"
   print(unicode.utf8.match(str, "()e"))
   str = "?abcde"
   print(unicode.utf8.match(str, "()e"))

is 5 and 7.  The second one is obviously wrong.

Best regards,
Stephan Hennig


From taco at elvenkind.com  Tue Mar  2 14:16:35 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 02 Mar 2010 14:16:35 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D0C3E.2020005@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
Message-ID: <4B8D0FB3.5090602@elvenkind.com>



Stephan Hennig wrote:
> 
>> Note: The string library functions find etc. are not Unicode-aware.
>> In cases where this is required (i. e. because the pattern used for
>> searching contains characters above code point 127), the
>> corresponding functions from unicode.utf8 should be used.
> 
> is a bit misleading, since just unicode.utf8.find is again not
> Unicode-aware.  The same applies for the empty capture () in match and
> gmatch, BTW.  The output of
> 
>   str = "abcde"
>   print(unicode.utf8.match(str, "()e"))
>   str = "?abcde"
>   print(unicode.utf8.match(str, "()e"))
> 
> is 5 and 7.  The second one is obviously wrong.

Can you suggest a rewording of that paragraph?



From luigi.scarso at gmail.com  Tue Mar  2 14:41:07 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Mar 2010 14:41:07 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D0C3E.2020005@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
Message-ID: <fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>

On Tue, Mar 2, 2010 at 2:01 PM, Stephan Hennig <mailing_list at arcor.de> wrote:
> Am 02.03.2010 07:49, schrieb Taco Hoekwater:
>
>> Luatex itself has an internal UTF-8 counting function. At some point
>> (don't know when but before 1.0) the internal Unicode library will
>> replace slnunicode, and I will make sure that it exports a counter as
>> well.
>
> Good to know. ?For the time being this paragraph from the LuaTeX manual
>
>> Note: The string library functions find etc. are not Unicode-aware.
>> In cases where this is required (i. e. because the pattern used for
>> searching contains characters above code point 127), the
>> corresponding functions from unicode.utf8 should be used.
>
> is a bit misleading, since just unicode.utf8.find is again not
> Unicode-aware. ?The same applies for the empty capture () in match and
> gmatch, BTW. ?The output of
>
> ?str = "abcde"
> ?print(unicode.utf8.match(str, "()e"))
> ?str = "?abcde"
> ?print(unicode.utf8.match(str, "()e"))
>
> is 5 and 7. ?The second one is obviously wrong.
I believe 7 is ok, because in utf8 ?abcde is 7 octet long
and  unittest.c says
 NOTE: find positions are in bytes for all ctypes!


-- 
luigi


From patrick at gundla.ch  Tue Mar  2 16:03:01 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 16:03:01 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D086B.6020500@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8D086B.6020500@arcor.de>
Message-ID: <3908544A-9679-4189-8416-0F328E08D638@gundla.ch>

> Anyway, what I want is the position of the match.  In your example the result would be 3, but the values of b and e are 5 and 7.  I can't see how that tells me anything.

Sorry, my fault:

str="???a?A?BC??"

b = unicode.utf8.find(str,"%u+")
print(unicode.utf8.len(string.sub(str,1,b))) -- 6

better?



Patrick



From patrick at gundla.ch  Tue Mar  2 16:11:32 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 16:11:32 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D0C3E.2020005@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
Message-ID: <BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>

> is a bit misleading, since just unicode.utf8.find is again not Unicode-aware.


This is not true. It just returns the position in bytes. What would you suggest the following statement returns?

str="a?"
unicode.utf8.find(str,"\182")  -- (?'s utf8 values are 195 and 182)



Patrick

From mailing_list at arcor.de  Tue Mar  2 16:39:16 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 16:39:16 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
Message-ID: <4B8D3124.9030006@arcor.de>

Am 02.03.2010 14:41, schrieb luigi scarso:
> On Tue, Mar 2, 2010 at 2:01 PM, Stephan Hennig<mailing_list at arcor.de>  wrote:
>> The output of
>>
>>   str = "abcde"
>>   print(unicode.utf8.match(str, "()e"))
>>   str = "?abcde"
>>   print(unicode.utf8.match(str, "()e"))
>>
>> is 5 and 7.  The second one is obviously wrong.
> I believe 7 is ok, because in utf8 ?abcde is 7 octet long
> and  unittest.c says
>   NOTE: find positions are in bytes for all ctypes!

Logicians might be satisfied with broken behaviour as long as it's 
documented.  But I'm not a logician, so I cannot agree. :)

Best regards,
Stephan Hennig

From patrick at gundla.ch  Tue Mar  2 17:09:00 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 17:09:00 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D3124.9030006@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
Message-ID: <232E041C-5F6C-4767-AAA3-51473E0B380D@gundla.ch>

> Logicians might be satisfied with broken behaviour as long as it's documented.

Why do you insist that it is broken? As I have shown in my last mail, unicode.utf8.find cannot simply return the utf-8 position.

Patrick



From luigi.scarso at gmail.com  Tue Mar  2 17:18:35 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Mar 2010 17:18:35 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D3124.9030006@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
Message-ID: <fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>

On Tue, Mar 2, 2010 at 4:39 PM, Stephan Hennig <mailing_list at arcor.de> wrote:
> Am 02.03.2010 14:41, schrieb luigi scarso:
>>
>> On Tue, Mar 2, 2010 at 2:01 PM, Stephan Hennig<mailing_list at arcor.de>
>> ?wrote:
>>>
>>> The output of
>>>
>>> ?str = "abcde"
>>> ?print(unicode.utf8.match(str, "()e"))
>>> ?str = "?abcde"
>>> ?print(unicode.utf8.match(str, "()e"))
>>>
>>> is 5 and 7. ?The second one is obviously wrong.
>>
>> I believe 7 is ok, because in utf8 ?abcde is 7 octet long
>> and ?unittest.c says
>> ?NOTE: find positions are in bytes for all ctypes!
>
> Logicians might be satisfied with broken behaviour as long as it's
> documented.
I believe that it's not a broken behaviour, it's only  a mix from two
differents points of view:
"abstract" (or "sign"  or "glyph" o "character" ),  where we see ?  as "unit"
and "implementation"  where ? in utf8  is two octet.


>But I'm not a logician, so I cannot agree. :)
To be honest I'm not confortable with regex and unicode.

Perl can help here, but, just to see an example

#> perl  -e '$str = "?abcde"; print length($str),"\n" ;' ;
7
#> perl  -e 'use utf8; $str = "?abcde"; print length($str),"\n" ;' ;
6

#> perl -v
This is perl, v5.10.0 built for i586-linux-thread-multi

Of course there are other libs,like
http://site.icu-project.org/
http://www.pcre.org/pcre.txt

and of course luatex can become bigger and slower .

A solution can be a dynamic loading so one can choose at runtime
what module to use --- but we must ensure that the same  shared lib.
is available for all systems, and this is not easy .




-- 
luigi


From mailing_list at arcor.de  Tue Mar  2 16:28:48 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 16:28:48 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D0FB3.5090602@elvenkind.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>
	<4B8D0FB3.5090602@elvenkind.com>
Message-ID: <4B8D2EB0.2030308@arcor.de>

Am 02.03.2010 14:16, schrieb Taco Hoekwater:
> Stephan Hennig wrote:
>>
>>> Note: The string library functions find etc. are not Unicode-aware.
>>> In cases where this is required (i. e. because the pattern used for
>>> searching contains characters above code point 127), the
>>> corresponding functions from unicode.utf8 should be used.
>>
>> is a bit misleading,  [...]
>
> Can you suggest a rewording of that paragraph?

Here's my proposal:

Note: The \lua{string} library functions \luatex{len}, \luatex{lower},
\luatex{sub} etc. are not \UNICODE|-|aware.  For strings in the UTF-8
encoding, i.e., strings containing characters above code point 127, the
corresponding functions from the \lua{slnunicode} library can be used,
e.g., \luatex{unicode.utf8.len}, \luatex{unicode.utf8.lower} etc.  The
exceptions are \luatex{unicode.utf8.find}, that always returns byte
positions in a string, and \luatex{unicode.utf8.match} and
\luatex{unicode.utf8.gmatch}.  While the latter two functions in general
{\it are} \UNICODE|-|aware, they fall-back to non|-|\UNICODE|-|aware
behaviour when using the empty capture \lua{()} (other captures work as
expected).  For the interpretation of character classes in
\luatex{unicode.utf8} functions refer to the library sources at
\hyphenatedurl{http://luaforge.net/projects/sln}.  The \lua{slnunicode}
library will be replaced by an internal \UNICODE\ library in a future
\LUATEX\ version.

Best regards,
Stephan Hennig

From taco at elvenkind.com  Tue Mar  2 17:46:09 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 02 Mar 2010 17:46:09 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D2EB0.2030308@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<4B8D0FB3.5090602@elvenkind.com>
	<4B8D2EB0.2030308@arcor.de>
Message-ID: <4B8D40D1.20507@elvenkind.com>



Stephan Hennig wrote:
> Am 02.03.2010 14:16, schrieb Taco Hoekwater:
>> Stephan Hennig wrote:
>>>
>>>> Note: The string library functions find etc. are not Unicode-aware.
>>>> In cases where this is required (i. e. because the pattern used for
>>>> searching contains characters above code point 127), the
>>>> corresponding functions from unicode.utf8 should be used.
>>>
>>> is a bit misleading,  [...]
>>
>> Can you suggest a rewording of that paragraph?
> 
> Here's my proposal:

Thanks a lot, will paste that in.

Best wishes,
Taco

From luigi.scarso at gmail.com  Tue Mar  2 18:25:59 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 2 Mar 2010 18:25:59 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D2EB0.2030308@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<4B8D0FB3.5090602@elvenkind.com> <4B8D2EB0.2030308@arcor.de>
Message-ID: <fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>

On Tue, Mar 2, 2010 at 4:28 PM, Stephan Hennig <mailing_list at arcor.de> wrote:
> Am 02.03.2010 14:16, schrieb Taco Hoekwater:
>>
>> Stephan Hennig wrote:
>>>
>>>> Note: The string library functions find etc. are not Unicode-aware.
>>>> In cases where this is required (i. e. because the pattern used for
>>>> searching contains characters above code point 127), the
>>>> corresponding functions from unicode.utf8 should be used.
>>>
>>> is a bit misleading, ?[...]
>>
>> Can you suggest a rewording of that paragraph?
>
> Here's my proposal:
>
> Note: The \lua{string} library functions \luatex{len}, \luatex{lower},
> \luatex{sub} etc. are not \UNICODE|-|aware. ?For strings in the UTF-8
> encoding, i.e., strings containing characters above code point 127, the
> corresponding functions from the \lua{slnunicode} library can be used,
> e.g., \luatex{unicode.utf8.len}, \luatex{unicode.utf8.lower} etc. ?The
> exceptions are \luatex{unicode.utf8.find}, that always returns byte
> positions in a string, and \luatex{unicode.utf8.match} and
> \luatex{unicode.utf8.gmatch}.


>?While the latter two functions in general
> {\it are} \UNICODE|-|aware, they fall-back to non|-|\UNICODE|-|aware
> behaviour when using the empty capture \lua{()} (other captures work as
> expected).
Hm, I don't understand this.



-- 
luigi


From mailing_list at arcor.de  Tue Mar  2 18:58:32 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 18:58:32 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
Message-ID: <4B8D51C8.4040905@arcor.de>

Am 02.03.2010 16:11, schrieb Patrick Gundlach:
>> is a bit misleading, since just unicode.utf8.find is again not
>> Unicode-aware.
>
>
> This is not true. It just returns the position in bytes. What would
> you suggest the following statement returns?
>
> str="a?" unicode.utf8.find(str,"\182")  -- (?'s utf8 values are 195
> and 182)

Nil, or even better error out, since the second argument is invalid.  Do 
you think 3 is a sensible result?

This can lead to subtle errors, e.g., when strings are represented in
UTF-8 in a programme, but a user accidentally inputs a pattern in, say, 
latin1.  A wrong match might be undiscovered for a long time, while a 
non-match might catch the user's attention instantly.

Is there a function in slnunicode that checks a string for UTF-8 compliance?

Best regards,
Stephan Hennig

From patrick at gundla.ch  Tue Mar  2 19:09:29 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 19:09:29 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D51C8.4040905@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
	<4B8D51C8.4040905@arcor.de>
Message-ID: <0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>

>> What would
>> you suggest the following statement returns?
>> 
>> str="a?" unicode.utf8.find(str,"\182")  -- (?'s utf8 values are 195
>> and 182)
> 
> Nil, or even better error out, since the second argument is invalid.

That would break every program that uses unicode.utf8 as a replacement for string, which is meant for. How would you then search for a byte sequence in another byte sequence?


> Do you think 3 is a sensible result?

Yes, and the only sensible result.


And what would you expect in this case:

my_three_numbers = "\97\195\182" unicode.utf8.find(my_three_numbers,"\182")

and in this case:

my_three_numbers = "\97\195\182" string.find(my_three_numbers,"\182")

?

This discussion is getting ridiculous, and I'll stop here. If you want something that returns utf-8 lengths then please write a wrapper around the find function yourself.

Patrick



From mailing_list at arcor.de  Tue Mar  2 19:33:59 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 19:33:59 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
Message-ID: <4B8D5A17.9080000@arcor.de>

Am 02.03.2010 17:18, schrieb luigi scarso:
> On Tue, Mar 2, 2010 at 4:39 PM, Stephan Hennig<mailing_list at arcor.de>  wrote:
>> Am 02.03.2010 14:41, schrieb luigi scarso:
>>>
>>> I believe 7 is ok, because in utf8 ?abcde is 7 octet long
>>> and  unittest.c says
>>>   NOTE: find positions are in bytes for all ctypes!
>>
>> Logicians might be satisfied with broken behaviour as long as it's
>> documented.
> I believe that it's not a broken behaviour, it's only  a mix from two
> differents points of view:
> "abstract" (or "sign"  or "glyph" o "character" ),  where we see ?  as "unit"
> and "implementation"  where ? in utf8  is two octet.

Yes, that's why I call it "broken".  Switching point of view within the 
unicode.utf8 functions doesn't seem a good design to me.  I cannot see 
why it could be sensible to regard the length of ? as one (character) in 
len and two (octets) in find.  After all, we already have function(s) 
that return byte positions in a strings, string.find or 
unicode.ascii.find.  Why not drop unicode.utf8.find at all?  That'd be a 
clear design. (Only beaten by a find function that regards ? the same 
length as len does.  There are use-cases for such a find function.)


>> But I'm not a logician, so I cannot agree. :)
> To be honest I'm not confortable with regex and unicode.
>
> Perl can help here, but, just to see an example
>
> #>  perl  -e '$str = "?abcde"; print length($str),"\n" ;' ;
> 7
> #>  perl  -e 'use utf8; $str = "?abcde"; print length($str),"\n" ;' ;
> 6

Same with string.len and unicode.ut8.len in Lua.  You made me curious. 
Is there a find function in Perl?  What values does that return?

Best regards,
Stephan Hennig

From patrick at gundla.ch  Tue Mar  2 19:43:43 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 2 Mar 2010 19:43:43 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D5A17.9080000@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
Message-ID: <F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>


>   Why not drop unicode.utf8.find at all?


Because it is very useful as it is now. unicode.utf8.find has different character classes as string.find. 

I assume from your mail address that you are german, so you can have a look at:

http://www.luatex.de/2010/02/selene-unicode-bibliothek/

Patrick

From mailing_list at arcor.de  Tue Mar  2 20:15:06 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 20:15:06 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<4B8D0FB3.5090602@elvenkind.com>
	<4B8D2EB0.2030308@arcor.de>
	<fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>
Message-ID: <4B8D63BA.1060304@arcor.de>

Am 02.03.2010 18:25, schrieb luigi scarso:
> On Tue, Mar 2, 2010 at 4:28 PM, Stephan Hennig<mailing_list at arcor.de>  wrote:
>
>>   While the latter two functions in general
>> {\it are} \UNICODE|-|aware, they fall-back to non|-|\UNICODE|-|aware
>> behaviour when using the empty capture \lua{()} (other captures work as
>> expected).
> Hm, I don't understand this.

Neither do I. :)  SCNR

Best regards,
Stephan Hennig

From mpg at elzevir.fr  Tue Mar  2 20:22:18 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Tue, 02 Mar 2010 20:22:18 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D51C8.4040905@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
	<4B8D51C8.4040905@arcor.de>
Message-ID: <4B8D656A.7060602@elzevir.fr>

Hi,

Stephan Hennig a ?crit :
> Is there a function in slnunicode that checks a string for UTF-8
> compliance?
> 
There wasn't last time I checked. For what it's worth, I wrote an utf-8
validator in Lua some time ago.

http://gist.github.com/77135

Manuel.

From khaledhosny at eglug.org  Tue Mar  2 21:28:22 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 2 Mar 2010 22:28:22 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
	<4B8D51C8.4040905@arcor.de>
	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
Message-ID: <20100302202822.GA2541@khaled-laptop>

On Tue, Mar 02, 2010 at 07:09:29PM +0100, Patrick Gundlach wrote:
> This discussion is getting ridiculous, and I'll stop here. If you want something that returns utf-8 lengths then please write a wrapper around the find function yourself.

Absolutely right! I find your aggressive response the most ridicules
part of this whole discussion! What you are saying is an absolute
non-sense; a utf-8 aware function that act on byte sequences is broken
period. There is nothing to argue here.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From mailing_list at arcor.de  Tue Mar  2 21:30:59 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 21:30:59 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>	<4B8D51C8.4040905@arcor.de>
	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
Message-ID: <4B8D7583.6020803@arcor.de>

Am 02.03.2010 19:09, schrieb Patrick Gundlach:
>>> What would you suggest the following statement returns?
>>>
>>> str="a?" unicode.utf8.find(str,"\182")  -- (?'s utf8 values are
>>> 195 and 182)
>>
>> Nil, or even better error out, since the second argument is
>> invalid.
>
> That would break every program that uses unicode.utf8 as a
> replacement for string,

For UTF-8 encoded strings?  That's what one commits to when using 
unicode.utf8, no?  So, it would only break in case of a programming 
error.  Not that bad, I'd say.


> which is meant for.

Any pointer?  That would explain much.  Even though, it seem to me like
harnessing a horse to a car for those who don't have a driver's license, 
but want to use the car as a drop-in replacement for their carriage. 
The benefit of crippled functionality is questionable.


> How would you then search for a byte sequence in another byte
> sequence?

string.find.  Whoever wants to search for arbitrary byte values with a
Unicode string library does something truly wrong, IMHO.  Do you have a
use-case at hand where that would seem desirable, while at the same time
the built-in string library is not at hand?


>> Do you think 3 is a sensible result?
>
> Yes, and the only sensible result.
>
>
> And what would you expect in this case:
>
> my_three_numbers = "\97\195\182"
> unicode.utf8.find(my_three_numbers,"\182")

Nil or error out, since \182 is an invalid argument.


> and in this case:
>
> my_three_numbers = "\97\195\182"
> string.find(my_three_numbers,"\182")

3


> This discussion is getting ridiculous, and I'll stop here. If you
> want something that returns utf-8 lengths then please write a wrapper
> around the find function yourself.

That's what my question

> Is there a function in slnunicode that checks a string for UTF-8
> compliance?

was aiming at.  Even though, explicitly pre-processing strings might 
lower the performance penalty compared to a wrapper.

Best regards,
Stephan Hennig

From elie.roux at telecom-bretagne.eu  Tue Mar  2 21:32:48 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 02 Mar 2010 22:32:48 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100302202822.GA2541@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>	<4B8D51C8.4040905@arcor.de>	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
	<20100302202822.GA2541@khaled-laptop>
Message-ID: <4B8D75F0.50609@telecom-bretagne.eu>

Khaled Hosny a ?crit :
> Absolutely right! I find your aggressive response the most ridicules
> part of this whole discussion! What you are saying is an absolute
> non-sense; a utf-8 aware function that act on byte sequences is broken
> period. There is nothing to argue here.
>   

I couldn't say it better... (well, a bit less personal maybe, but...)

Thank you,
-- 
Elie

From mailing_list at arcor.de  Tue Mar  2 21:42:28 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 02 Mar 2010 21:42:28 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D656A.7060602@elzevir.fr>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>	<4B8D51C8.4040905@arcor.de>
	<4B8D656A.7060602@elzevir.fr>
Message-ID: <4B8D7834.9040303@arcor.de>

Am 02.03.2010 20:22, schrieb Manuel P?gouri?-Gonnard:
> Stephan Hennig a ?crit :
>> Is there a function in slnunicode that checks a string for UTF-8
>> compliance?
>>
> There wasn't last time I checked. For what it's worth, I wrote an utf-8
> validator in Lua some time ago.
>
> http://gist.github.com/77135

Thanks!


> WTFPL

And thanks for making it free software! ;)

Best regards,
Stephan Hennig

From mpg at elzevir.fr  Tue Mar  2 22:04:02 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 02 Mar 2010 22:04:02 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D7583.6020803@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>	<4B8D51C8.4040905@arcor.de>	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
	<4B8D7583.6020803@arcor.de>
Message-ID: <4B8D7D42.7030805@elzevir.fr>

Stephan Hennig a ?crit :
> Am 02.03.2010 19:09, schrieb Patrick Gundlach:
>> That would break every program that uses unicode.utf8 as a
>> replacement for string,
> 
I disagree here for two reasons:

1. unicode.utf8 is not meant to be a drop-in replacement for string. This
explains why unicode.utf8 is not used to replace string in LuaTeX (I think it
was already mentioned in this thread). So you should use string when you want to
manipulate arbitrary strings of bytes, and unicode.utf8 only with strings of
bytes that happen to be valid UTF-8 (as the name implies).

2. string.find can already return nil, so I don't see how it breaks anything.

>> How would you then search for a byte sequence in another byte
>> sequence?
> 
> string.find.  Whoever wants to search for arbitrary byte values with a
> Unicode string library does something truly wrong, IMHO.

I strongly agree here.

>> This discussion is getting ridiculous, and I'll stop here. If you
>> want something that returns utf-8 lengths then please write a wrapper
>> around the find function yourself.
> 
> That's what my question
> 
Do you agree that Patrick's suggestion answers this question? I mean this one:

b = unicode.utf8.find(str,"%u+")
print(unicode.utf8.len(string.sub(str,1,b)))

If so, then from a practical point of view, your problem is solved. From a
theoretical point of view (the logician's point of view as you might say) there
is no problem with the function itself since it just does what the
"documentation" (if comments in a test file can be called documentation) says.

So the only question that remains is the following: is the design Good? or Bad??
I'm not particularly interested in this debate (but while we're at it, I find it
quite surprising but wouldn't call it just plain broken either).

Manuel.

From mpg at elzevir.fr  Tue Mar  2 22:32:54 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Tue, 02 Mar 2010 22:32:54 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>	<4B8D51C8.4040905@arcor.de>
	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
Message-ID: <4B8D8406.3070106@elzevir.fr>

By the way, I re-read the "documentation" of slnunicode and found interesting
things.

Patrick Gundlach a ?crit :
> That would break every program that uses unicode.utf8 as a replacement for
> string, which is meant for.

The documentation says: "ascii or latin1 can be used as locale-independent
string replacement." While it doesn't formally says that unicode.utf8 can *not*
be used as a string replacement, it is quite implied by not mentioning it.

> And what would you expect in this case:
> 
> my_three_numbers = "\97\195\182" unicode.utf8.find(my_three_numbers,"\182")
> 
Here the fun begins :-) According to the doc:

-- Any byte not part of such a sequence is treated as it's (Latin-1) value.

Doesn't it mean that "\182" should be treated as "\194\182" (the proper utf8
encoding of U+00B6, aka ?)? If so, then indeed the return value should be nil.

(Note that, as a matter of personal taste, I tend to disagree with interpreting
an out-of-sequence byte as a latin1 character, but the point here is that the
function just doesn't do what the doc says: precisely what I usually call a bug.)

Manuel.


From luigi.scarso at gmail.com  Wed Mar  3 01:57:38 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 01:57:38 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100302202822.GA2541@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
	<4B8D51C8.4040905@arcor.de>
	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
	<20100302202822.GA2541@khaled-laptop>
Message-ID: <fe8d59da1003021657y48b34e9bhc35f24590d79c3f8@mail.gmail.com>

On Tue, Mar 2, 2010 at 9:28 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:

> What you are saying is an absolute
> non-sense;
> a utf-8 aware function that act on byte sequences is broken
> period. There is nothing to argue here.
#> man perlre

  \C  Match a single C char (octet) even under Unicode.
               NOTE: breaks up characters into their UTF-8 bytes,
               so you may end up with malformed pieces of UTF-8.
               Unsupported in lookbehind.

# perl -e 'use utf8;  binmode(STDOUT, ":utf8"); $s="\x{0110}";  $s =~
m/(\C)(\C*)/;  print "$s: 1=",length($1)," 2=",length($2),"\n"'
?: 1=1 2=1
#

I argue that it's not a non-sense, but only for experts .

-- 
luigi


From luigi.scarso at gmail.com  Wed Mar  3 01:59:12 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 01:59:12 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D5A17.9080000@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
Message-ID: <fe8d59da1003021659x5348f5a5t4906d19c824b772b@mail.gmail.com>

On Tue, Mar 2, 2010 at 7:33 PM, Stephan Hennig <mailing_list at arcor.de> wrote:

> Same with string.len and unicode.ut8.len in Lua. ?You made me curious. Is
> there a find function in Perl? ?What values does that return?

man perluniintro
man perlunicode
man perlre
man perlretut

-- 
luigi


From luigi.scarso at gmail.com  Wed Mar  3 02:03:11 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 02:03:11 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8D63BA.1060304@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<4B8D0FB3.5090602@elvenkind.com> <4B8D2EB0.2030308@arcor.de>
	<fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>
	<4B8D63BA.1060304@arcor.de>
Message-ID: <fe8d59da1003021703s6f472877h1b57efc9979ee31b@mail.gmail.com>

On Tue, Mar 2, 2010 at 8:15 PM, Stephan Hennig <mailing_list at arcor.de> wrote:
> Am 02.03.2010 18:25, schrieb luigi scarso:
>>
>> On Tue, Mar 2, 2010 at 4:28 PM, Stephan Hennig<mailing_list at arcor.de>
>> ?wrote:
>>
>>> ?While the latter two functions in general
>>> {\it are} \UNICODE|-|aware, they fall-back to non|-|\UNICODE|-|aware
>>> behaviour when using the empty capture \lua{()} (other captures work as
>>> expected).
>>
>> Hm, I don't understand this.
>
> Neither do I. :) ?SCNR
I mean: you said that empty capture is not unicode-aware
but others are ok (about match an gmatch)
Can you make a small example  ?

-- 
luigi


From khaledhosny at eglug.org  Wed Mar  3 05:33:01 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 3 Mar 2010 06:33:01 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003021657y48b34e9bhc35f24590d79c3f8@mail.gmail.com>
References: <24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>
	<4B8C3D0C.5030001@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<BFABDBBE-85E8-43DD-B6EA-09A46F77B2E8@gundla.ch>
	<4B8D51C8.4040905@arcor.de>
	<0258FB4A-E9B4-4CC7-A307-25CB1A0C59DD@gundla.ch>
	<20100302202822.GA2541@khaled-laptop>
	<fe8d59da1003021657y48b34e9bhc35f24590d79c3f8@mail.gmail.com>
Message-ID: <20100303043301.GD3850@khaled-laptop>

On Wed, Mar 03, 2010 at 01:57:38AM +0100, luigi scarso wrote:
> On Tue, Mar 2, 2010 at 9:28 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:
> 
> > What you are saying is an absolute
> > non-sense;
> > a utf-8 aware function that act on byte sequences is broken
> > period. There is nothing to argue here.
> #> man perlre
> 
>   \C  Match a single C char (octet) even under Unicode.
>                NOTE: breaks up characters into their UTF-8 bytes,
>                so you may end up with malformed pieces of UTF-8.
>                Unsupported in lookbehind.

But, AFAICS, this is a special case so it doesn't count here;
unicode.utf8.find() has only a bytes mode, IMNSHO, this makes it broken.
(And we already have string.find() for this kind of functionality)

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From patrick at gundla.ch  Wed Mar  3 08:50:26 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 3 Mar 2010 08:50:26 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
Message-ID: <2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>

Hi all,

this discussion is IMO whether unicode.* libraries are a replacement for string or not.

If they are a replacement for string, then they must preserve its semantics. For example string.find must be able to find bytes and return byte positions, because a string can also be binary data. I don't think that we can argue about this.

So the question is: are the unicode.* libraries meant as a drop in replacement for string? So that one can say for example:

if input=="utf8" then
  string = unicode.utf8
elseif input=="latin1" then
  string = uniocde.latin1
end

result = string.whatever()

When I look at the source code of the selene library, it seems to me perfectly clear that is meant as a drop in replacement. 

a) It covers exactly the same functions as string.*
b) The only changes are the extended character classes and the counting of character lengths when there is a non-byte operation (for example string.len() vs. #str)
c) everything else behaves exactly like strings.
d) it even mentions that it can be used as a replacement

So if it is a replacement, changing the find function would break everything that deals with binary data. Please let's not easily call the unicode library broken, because it is a design decision that has been made and for me it makes perfectly sense. And with the combination of *.len and *.sub as I have shown in a previous mail, everything that has been requested so far can be made.


And yes, if it is *not* meant as a replacement, than I can understand that this opens questions. But then find should not allow bytes in the pattern and should raise an error.

Patrick

(trying to avoid a heated discussion)

From taco at elvenkind.com  Wed Mar  3 08:55:02 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 03 Mar 2010 08:55:02 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>	<4B8D5A17.9080000@arcor.de>	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
Message-ID: <4B8E15D6.7030209@elvenkind.com>



Patrick Gundlach wrote:
> 
> So if it is a replacement, changing the find function would break
> everything that deals with binary data. Please let's not easily call
> the unicode library broken, because it is a design decision that has
> been made and for me it makes perfectly sense. ...
> 
> And yes, if it is *not* meant as a replacement, than I can understand
> that this opens questions. But then find should not allow bytes in
> the pattern and should raise an error.
> 
> Patrick
> 
> (trying to avoid a heated discussion)

Can any remaining discussion be moved to the lua list at
lua at bazar2.conectiva.com.br please? There are no selene developers
on the luatex list, and we are not going to patch the library either.

Best wishes,
Taco

From luigi.scarso at gmail.com  Wed Mar  3 09:43:02 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 09:43:02 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
References: <4B8C0610.7030907@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
Message-ID: <fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>

On Wed, Mar 3, 2010 at 8:50 AM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Hi all,
>
> this discussion is IMO whether unicode.* libraries are a replacement for string or not.
Hm.
A difficult question.

string.* is in the core lua , selene no;
maybe we will drop selene for a new unicode library and the semantic
of the new unicode.utf8.find will be different
from the semantic of  string.find  --- or maybe there will be another
kind of find.

I understand that actually (by design I believe) "selene" find() and
"string" find() share the same semantic,
but I prefear to use string.*   for byte oriented  operations
and unicode.<encode>.* for unicode (<encode> encoded) operations
Said in another way:
I don't like to mix string.* and unicode.*  --- but as you wrote
selene was design to manage this particular situation .

The relevant question is:
Have we found a bug in unicode.utf8.find or it's correct but we
disagree about its behavior ?
If  we disagree, what is the expected behavior ?
Can we implement an acceptable  wrapper  ?


-- 
luigi

From mpg at elzevir.fr  Wed Mar  3 10:19:25 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 03 Mar 2010 10:19:25 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>	<4B8D5A17.9080000@arcor.de>	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
Message-ID: <4B8E299D.3050907@elzevir.fr>

luigi scarso a ?crit :
>> this discussion is IMO whether unicode.* libraries are a replacement for string or not.
> Hm.
> A difficult question.
> 
IMO not. The comments state that unicode.ascii and unicode.latin1 are
locale-independent replacements for string, but doens't say anything about
unicode.utf8, and that's probably for a reason. But as Taco, said, this would be
best discussed with the selene developpers.

> Have we found a bug in unicode.utf8.find or it's correct but we
> disagree about its behavior ?

This question has been answered many times: the fact that string.find returns
positions in bytes (as opposed to characters) is a design decision and the
function behaves precisely as the doc says on this point:

-- NOTE: find positions are in bytes for all ctypes!
-- use ascii.sub to cut found ranges!
-- this is a) faster b) more reliable

> If  we disagree, what is the expected behavior ?

People who disagree would like the counts to be characters, not bytes.

> Can we implement an acceptable  wrapper  ?
> 
Yes, an proper wrapper has already been given by Patrick [1] and quoted by
myself. Here it is again, now in the form of a function:

function find_utf8_chars(str, pat)
    local a, b = unicode.utf8.find(str, pat)
    a = unicode.utf8.len(string.sub(str, 1, a))
    b = unicode.utf8.len(string.sub(str, 1, b))
    return a, b
end

Note that this is not proper full version of find (arguments 3 and 4 not
supported, no captures returned). However, it does answers Stephan's original
question.

Manuel.

[1] http://tug.org/pipermail/luatex/2010-March/001262.html



From luigi.scarso at gmail.com  Wed Mar  3 10:43:33 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 10:43:33 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E15D6.7030209@elvenkind.com>
References: <4B8C0610.7030907@arcor.de> <4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
	<4B8E15D6.7030209@elvenkind.com>
Message-ID: <fe8d59da1003030143h72cd0657y7f4e0f05a3a111e4@mail.gmail.com>

On Wed, Mar 3, 2010 at 8:55 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Can any remaining discussion be moved to the lua list at
> lua at bazar2.conectiva.com.br please? There are no selene developers
> on the luatex list, and we are not going to patch the library either.

I disagree here (until discussion is meaningful).

The problem is  not a bug/feature of selene
but how we see unicode, utf8 , strings manipulation, octet stream etc.
from the point of view of typography .

I'm not surprise if someone says "OK, I undertand unicode.utf8.find,
but I think we need for our purposes
an unicode.utf8.findutf8 that does this & that " --- but maybe this
doesn't care selene developers at all, because it's a typography (and
TeX) issue.

So the first reaction is "Is it a bug ?"   and we must be able to
resolve this question as soon as possible .
Next "If no bug  do  we need something more ?" but here we can be more
relaxed --- I'm lazy.

To be honest, I expect more and more questions about these issue ---
we must be prepare to discuss and solve them .



-- 
luigi

From luigi.scarso at gmail.com  Wed Mar  3 11:13:34 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 11:13:34 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E299D.3050907@elzevir.fr>
References: <4B8C0610.7030907@arcor.de> <4B8D0C3E.2020005@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
	<4B8E299D.3050907@elzevir.fr>
Message-ID: <fe8d59da1003030213k4aa485abh4fce093689cc5497@mail.gmail.com>

On Wed, Mar 3, 2010 at 10:19 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> luigi scarso a ?crit :
>>> this discussion is IMO whether unicode.* libraries are a replacement for string or not.
>> Hm.
>> A difficult question.
>>
> IMO not. The comments state that unicode.ascii and unicode.latin1 are
> locale-independent replacements for string, but doens't say anything about
> unicode.utf8, and that's probably for a reason. But as Taco, said, this would be
> best discussed with the selene developpers.

My point it's not about this  implementation but to keep separate
semantic of string.* and  unicode.*
In lua string module  cover 0x0 to 0xff  --- it's  octet oriented, and
it's in Lua core .
The name "string" will be always in "conflict" with any unicode.*
implementation --- there are no unicode module in Lua core actually
because ansi C .
Selene implementation resolves this "conflict" in a precise manner:
its C code it's not so long to check & understand  .
Someone agree and someother no, but it's not a bug --- we have not a
buggy luatex, this is important.




>> Can we implement an acceptable ?wrapper ??
>>
> Here it is again, now in the form of a function:
>
> function find_utf8_chars(str, pat)
> ? ?local a, b = unicode.utf8.find(str, pat)
> ? ?a = unicode.utf8.len(string.sub(str, 1, a))
> ? ?b = unicode.utf8.len(string.sub(str, 1, b))
> ? ?return a, b
> end
For example here I disagree  because you mix string and unicode.utf8
--- but it's my first look, I should check.
Maybe it's the only way to resolve the problem.

Anyway I don't consider this a waste of time.


-- 
luigi


From mpg at elzevir.fr  Wed Mar  3 11:38:35 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Wed, 03 Mar 2010 11:38:35 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003030213k4aa485abh4fce093689cc5497@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>
	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>	<4B8D5A17.9080000@arcor.de>	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>	<4B8E299D.3050907@elzevir.fr>
	<fe8d59da1003030213k4aa485abh4fce093689cc5497@mail.gmail.com>
Message-ID: <4B8E3C2B.3020608@elzevir.fr>

luigi scarso a ?crit :
> On Wed, Mar 3, 2010 at 10:19 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
>> function find_utf8_chars(str, pat)
>>    local a, b = unicode.utf8.find(str, pat)
>>    a = unicode.utf8.len(string.sub(str, 1, a))
>>    b = unicode.utf8.len(string.sub(str, 1, b))
>>    return a, b
>> end
> For example here I disagree  because you mix string and unicode.utf8
> --- but it's my first look, I should check.

I think you should :-) It's a design decision by slnunicode developpers. Strings
are meant to be cut with byte-oriented string functions (like unicode.ascii.sub,
unicode.latin1.sub, or string.sub). Again, this is documented in unitest from
the slnunicode distribution.

By the way, that's the whole point of the discussion: unicode.utf8.find returns
values with byte semantics...

Manuel.

From mailing_list at arcor.de  Wed Mar  3 11:49:29 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Wed, 03 Mar 2010 11:49:29 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003021703s6f472877h1b57efc9979ee31b@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>
	<4B8D0C3E.2020005@arcor.de>	<4B8D0FB3.5090602@elvenkind.com>
	<4B8D2EB0.2030308@arcor.de>	<fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>	<4B8D63BA.1060304@arcor.de>
	<fe8d59da1003021703s6f472877h1b57efc9979ee31b@mail.gmail.com>
Message-ID: <4B8E3EB9.1000700@arcor.de>

Am 03.03.2010 02:03, schrieb luigi scarso:
> On Tue, Mar 2, 2010 at 8:15 PM, Stephan Hennig<mailing_list at arcor.de>  wrote:
>> Am 02.03.2010 18:25, schrieb luigi scarso:
>>> On Tue, Mar 2, 2010 at 4:28 PM, Stephan Hennig<mailing_list at arcor.de>
>>>   wrote:
>>>
>>>>   While the latter two functions in general
>>>> {\it are} \UNICODE|-|aware, they fall-back to non|-|\UNICODE|-|aware
>>>> behaviour when using the empty capture \lua{()} (other captures work as
>>>> expected).
>>>
>>> Hm, I don't understand this.
>>
>> Neither do I. :)  SCNR
> I mean: you said that empty capture is not unicode-aware
> but others are ok (about match an gmatch)
> Can you make a small example  ?

I wanted to mail you off-list, anyway.  It was just late yesterday. 
Here is an example:

str = "?#?"
print("str: ", str)

-- This considers '?' a single upper-case letter, i.e.,
-- '?' is one (character) long.
print('match("%u"): ', unicode.utf8.match(str, "(%u)"))
-- Like len does.
print('len("?"): ', unicode.utf8.len("?"))

-- This returns the byte position of '?' in the string, i.e.,
-- it considers the length of '?' as two (bytes).
print('match("()%u"): ', unicode.utf8.match(str, "()%u"))
-- Unlike len.
print('len("?"): ', unicode.utf8.len("?"))

> >texlua empty.lua
> str:    ?#?
> match("%u"):    ?
> len("?"):      1
> match("()%u"):  4
> len("?"):      1

Note, the empty capture () doesn't return a match, but its position 
within a string in case of a match, similar to find.  So, no surprise it 
returns byte positions.  But one can argue, if that is documented behaviour.

Best regards,
Stephan Hennig

From luigi.scarso at gmail.com  Wed Mar  3 11:52:27 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 11:52:27 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E3EB9.1000700@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>
	<4B8CB4F0.5010904@elvenkind.com> <4B8D0C3E.2020005@arcor.de>
	<4B8D0FB3.5090602@elvenkind.com> <4B8D2EB0.2030308@arcor.de>
	<fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>
	<4B8D63BA.1060304@arcor.de>
	<fe8d59da1003021703s6f472877h1b57efc9979ee31b@mail.gmail.com>
	<4B8E3EB9.1000700@arcor.de>
Message-ID: <fe8d59da1003030252l1f121b2bv56fdca00dd7507d8@mail.gmail.com>

> I wanted to mail you off-list, anyway. ?It was just late yesterday. Here is
> an example:
>
> str = "?#?"
> print("str: ", str)
>
> -- This considers '?' a single upper-case letter, i.e.,
> -- '?' is one (character) long.
> print('match("%u"): ', unicode.utf8.match(str, "(%u)"))
> -- Like len does.
> print('len("?"): ', unicode.utf8.len("?"))
>
> -- This returns the byte position of '?' in the string, i.e.,
> -- it considers the length of '?' as two (bytes).
> print('match("()%u"): ', unicode.utf8.match(str, "()%u"))
> -- Unlike len.
> print('len("?"): ', unicode.utf8.len("?"))
>
>> >texlua empty.lua
>> str: ? ??#?
>> match("%u"): ? ??
>> len("?"): ? ? ?1
>> match("()%u"): ?4
>> len("?"): ? ? ?1
>
> Note, the empty capture () doesn't return a match, but its position within a
> string in case of a match, similar to find. ?So, no surprise it returns byte
> positions. ?But one can argue, if that is documented behaviour.

Good -- I will check it today


-- 
luigi


From luigi.scarso at gmail.com  Wed Mar  3 11:57:47 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 11:57:47 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E3C2B.3020608@elzevir.fr>
References: <4B8C0610.7030907@arcor.de> <4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
	<4B8E299D.3050907@elzevir.fr>
	<fe8d59da1003030213k4aa485abh4fce093689cc5497@mail.gmail.com>
	<4B8E3C2B.3020608@elzevir.fr>
Message-ID: <fe8d59da1003030257l57490c00r4c047117c4c04632@mail.gmail.com>

On Wed, Mar 3, 2010 at 11:38 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> luigi scarso a ?crit :
>> On Wed, Mar 3, 2010 at 10:19 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
>>> function find_utf8_chars(str, pat)
>>> ? ?local a, b = unicode.utf8.find(str, pat)
>>> ? ?a = unicode.utf8.len(string.sub(str, 1, a))
>>> ? ?b = unicode.utf8.len(string.sub(str, 1, b))
>>> ? ?return a, b
>>> end
>> For example here I disagree ?because you mix string and unicode.utf8
>> --- but it's my first look, I should check.


>
> I think you should :-)
As I wrote, can be the only way . I would like something like this
--
--  this example can be totally wrong
--  it's just to show what I would like to see
--
 function find_utf8_chars(str, pat)
   local a, b = unicode.utf8.find(str, pat)
    a = unicode.utf8.len(unicode.utf8.sub(str, 1, a))
    b = unicode.utf8.len(unicode.utf8.sub(str, 1, b))
   return a, b
end

If not possible , well you have hide details in your function
and it's also from ok a user point of view .


> By the way, that's the whole point of the discussion: unicode.utf8.find returns
> values with byte semantics...
It's not a problem anymore.
We all know now, and there is also a function that solves some problems.


-- 
luigi


From mailing_list at arcor.de  Wed Mar  3 12:01:51 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Wed, 03 Mar 2010 12:01:51 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E3EB9.1000700@arcor.de>
References: <4B8C0610.7030907@arcor.de>	<24F809AD-99A4-4389-9EDD-062218A3D93E@gundla.ch>	<4B8C3D0C.5030001@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<4B8D0FB3.5090602@elvenkind.com>	<4B8D2EB0.2030308@arcor.de>	<fe8d59da1003020925tef75a64g6909514ae38c9a3@mail.gmail.com>	<4B8D63BA.1060304@arcor.de>	<fe8d59da1003021703s6f472877h1b57efc9979ee31b@mail.gmail.com>
	<4B8E3EB9.1000700@arcor.de>
Message-ID: <4B8E419F.8010505@arcor.de>

Am 03.03.2010 11:49, schrieb Stephan Hennig:

> Here is an example:

A revisited example (a pair of parentheses was missing in line 6):

str = "?#?"
print("str: ", str)

-- This considers '?' a single upper-case letter, i.e.,
-- '?' is one (character) long.
print('match("(%u)"): ', unicode.utf8.match(str, "(%u)"))
-- Like len does.
print('len("?"): ', unicode.utf8.len("?"))

-- This returns the byte position of '?' in the string, i.e.,
-- it considers the length of '?' as two (bytes).
print('match("()%u"): ', unicode.utf8.match(str, "()%u"))
-- Unlike len.
print('len("?"): ', unicode.utf8.len("?"))


 > >texlua empty.lua
 > str:    ?#?
 > match("(%u)"):    ?
 > len("?"):      1
 > match("()%u"):  4
 > len("?"):      1

Best regards,
Stephan Hennig

From mailing_list at arcor.de  Wed Mar  3 17:18:46 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Wed, 03 Mar 2010 17:18:46 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E299D.3050907@elzevir.fr>
References: <4B8C0610.7030907@arcor.de>	<FCAD31EC-C899-4D11-AB6C-4A2AC5718948@gundla.ch>	<4B8CB4F0.5010904@elvenkind.com>	<4B8D0C3E.2020005@arcor.de>	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>	<4B8D3124.9030006@arcor.de>	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>	<4B8D5A17.9080000@arcor.de>	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
	<4B8E299D.3050907@elzevir.fr>
Message-ID: <4B8E8BE6.6020702@arcor.de>

Am 03.03.2010 10:19, schrieb Manuel P?gouri?-Gonnard:
> luigi scarso a ?crit :
>
>> Can we implement an acceptable  wrapper  ?
>>
> Yes, an proper wrapper has already been given by Patrick [1] and quoted by
> myself. Here it is again, now in the form of a function:
>
> function find_utf8_chars(str, pat)
>      local a, b = unicode.utf8.find(str, pat)
>      a = unicode.utf8.len(string.sub(str, 1, a))
>      b = unicode.utf8.len(string.sub(str, 1, b))
>      return a, b
> end
>
   > [...]
>
> [1] http://tug.org/pipermail/luatex/2010-March/001262.html

My original problem has already been solved by the function posted in my 
second mail.[1]  Here's a slightly modified version:

function utf8_find(str, pattern, init)
     local s = unicode.utf8.sub(str, init)
     -- search for first occurrence of pattern
     s = unicode.utf8.match(s, "^.-" .. pattern)
     -- calculate end point of match
     local e = s and init + unicode.utf8.len(s) - 1
     -- calculate beginning of match
     local b = e and e - unicode.utf8.len(pattern) + 1
     -- return indices of found match, or nil
     return b, e
end

It works similar, but uses match instead of find.  Although, Patrick's 
approach could be a bit faster than mine, both won't perform well, since 
they

    * build temporary strings and

    * have to iterate over strings several times (find/match, sub, len).

A native C implementation would probably be significantly faster than a 
Lua implementation.  Slnunicode developers decided not to provide such 
thing.  I can't imagine, why.

In my personal utf8_find, I think I'll use both Lua solutions and check 
for differences of the find/match approaches for the sake of robustness 
(until I get confident upon unicode.utf8.find again).

Best regards,
Stephan Hennig

[1] <URL:http://permalink.gmane.org/gmane.comp.tex.luatex.user/1182>

From luigi.scarso at gmail.com  Wed Mar  3 17:54:47 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 3 Mar 2010 17:54:47 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8E8BE6.6020702@arcor.de>
References: <4B8C0610.7030907@arcor.de>
	<fe8d59da1003020541l28d4eaa2o20d7b6cc8d35515f@mail.gmail.com>
	<4B8D3124.9030006@arcor.de>
	<fe8d59da1003020818r1f6f88d1o6143255367cff909@mail.gmail.com>
	<4B8D5A17.9080000@arcor.de>
	<F6207D4B-C693-44BE-A806-DDCF07F0A765@gundla.ch>
	<2CB57645-4FCC-4E71-95EA-64AB14D539FE@gundla.ch>
	<fe8d59da1003030043t74094f9fp752fd3ef8f9c0d23@mail.gmail.com>
	<4B8E299D.3050907@elzevir.fr> <4B8E8BE6.6020702@arcor.de>
Message-ID: <fe8d59da1003030854t5988bdd7x8a6d4aa7b1a726b@mail.gmail.com>

On Wed, Mar 3, 2010 at 5:18 PM, Stephan Hennig <mailing_list at arcor.de> wrote:
>
> My original problem has already been solved by the function posted in my
> second mail.[1] ?Here's a slightly modified version:
>
> function utf8_find(str, pattern, init)
> ? ?local s = unicode.utf8.sub(str, init)
> ? ?-- search for first occurrence of pattern
> ? ?s = unicode.utf8.match(s, "^.-" .. pattern)
> ? ?-- calculate end point of match
> ? ?local e = s and init + unicode.utf8.len(s) - 1
> ? ?-- calculate beginning of match
> ? ?local b = e and e - unicode.utf8.len(pattern) + 1
> ? ?-- return indices of found match, or nil
> ? ?return b, e
> end

I like this one because it's not mixed with string.*:
we all know that unicode.utf8.match
operate  in "octect point of view mode "
and unicode.utf8.len in "unicode  point of view mode" .




-- 
luigi


From jfine at pytex.org  Thu Mar  4 09:15:31 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 08:15:31 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8C0610.7030907@arcor.de>
References: <4B8C0610.7030907@arcor.de>
Message-ID: <4B8F6C23.9040800@pytex.org>

Stephan Hennig wrote:
> Hi,
> 
> I have trouble getting the position of a character in a UTF-8 string 
> with slnunicode.  The attached Lua script reads two UTF-8 encoded (I 
> think) strings, '?b' and '??b', from a file and outputs their length and 
> the position of the last character 'b'.  (UTF-8 characters are scrambled 
> in the output, because this is on a Windows console.  But that shouldn't 
> harm, should it?)
> 
>  > >texlua slnunicode-find.lua
>  > line = ??b
>  > len(line) = 2
>  > character 'b' at position 3
>  >
>  > line = ????b
>  > len(line) = 3
>  > character 'b' at position 5
> 
> I would expect the positions of 'b' being 2 and 3, resp., as that are 
> the lengths of the strings as returned by unicode.utf8.len.


Stephan: Is this what you want (except of course in Lua)?

$ python
Python 2.6.2 (release26-maint, Apr 19 2009, 01:58:18)
[GCC 4.3.3] on linux2
Type "help", "copyright", "credits" or "license" for more information.
 >>> data = '?b', '??b', u'?b', u'??b'
 >>> data
('\xc3\xa4b', '\xc3\xb6\xc3\xa4b', u'\xe4b', u'\xf6\xe4b')
 >>> for s in data: print repr(s), s, len(s), s.index('b')
...
'\xc3\xa4b' ?b 3 2
'\xc3\xb6\xc3\xa4b' ??b 5 4
u'\xe4b' ?b 2 1
u'\xf6\xe4b' ??b 3 2

In the above we have the two strings, first in 8-bit form and then in 
unicode.

-- 
Jonathan








   However,
> unicode.utf8.find seems to have another notion of the length of a 
> string.  To correct these values manually (apparently the byte 
> positions) one needed to know how many of the characters preceding 'b' 
> are multiple bytes long.  Actually, I thought, that is what slnunicode 
> is made for.
> 
> What is the preferred way to get the position of a character in a UTF-8 
> string, given a string contains only 'letters'?
> 
> Best regards,
> Stephan Hennig
> 
> 
>> >texlua -v
>> This is LuaTeX, Version beta-0.40.6-2009110118 (Web2C 2009) luatex.web 
>> >= v14240
> 


From mailing_list at arcor.de  Thu Mar  4 17:00:39 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Thu, 04 Mar 2010 17:00:39 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8F6C23.9040800@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
Message-ID: <4B8FD927.3000401@arcor.de>

Am 04.03.2010 09:15, schrieb Jonathan Fine:
> Stephan Hennig wrote:
>>
>>   >  >texlua slnunicode-find.lua
>>   >  line = ??b
>>   >  len(line) = 2
>>   >  character 'b' at position 3
>>   >
>>   >  line = ????b
>>   >  len(line) = 3
>>   >  character 'b' at position 5
>>
>> I would expect the positions of 'b' being 2 and 3, resp., as that are
>> the lengths of the strings as returned by unicode.utf8.len.
>
>
> Stephan: Is this what you want (except of course in Lua)?
>
> $ python
> Python 2.6.2 (release26-maint, Apr 19 2009, 01:58:18)
> [GCC 4.3.3] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
>   >>>  data = '?b', '??b', u'?b', u'??b'
>   >>>  data
> ('\xc3\xa4b', '\xc3\xb6\xc3\xa4b', u'\xe4b', u'\xf6\xe4b')
>   >>>  for s in data: print repr(s), s, len(s), s.index('b')
> ...
> '\xc3\xa4b' ?b 3 2
> '\xc3\xb6\xc3\xa4b' ??b 5 4
> u'\xe4b' ?b 2 1
> u'\xf6\xe4b' ??b 3 2
>
> In the above we have the two strings, first in 8-bit form and then in
> unicode.

If strings start with index zero in Python, then yes, the second variant 
is what I'm after.

Best regards,
Stephan Hennig

From jfine at pytex.org  Thu Mar  4 21:08:56 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 20:08:56 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B8FD927.3000401@arcor.de>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de>
Message-ID: <4B901358.90707@pytex.org>

Stephan Hennig wrote:
> Am 04.03.2010 09:15, schrieb Jonathan Fine:
>> Stephan Hennig wrote:
>>>
>>>   >  >texlua slnunicode-find.lua
>>>   >  line = ??b
>>>   >  len(line) = 2
>>>   >  character 'b' at position 3
>>>   >
>>>   >  line = ????b
>>>   >  len(line) = 3
>>>   >  character 'b' at position 5
>>>
>>> I would expect the positions of 'b' being 2 and 3, resp., as that are
>>> the lengths of the strings as returned by unicode.utf8.len.
>>
>>
>> Stephan: Is this what you want (except of course in Lua)?
>>
>> $ python
>> Python 2.6.2 (release26-maint, Apr 19 2009, 01:58:18)
>> [GCC 4.3.3] on linux2
>> Type "help", "copyright", "credits" or "license" for more information.
>>   >>>  data = '?b', '??b', u'?b', u'??b'
>>   >>>  data
>> ('\xc3\xa4b', '\xc3\xb6\xc3\xa4b', u'\xe4b', u'\xf6\xe4b')
>>   >>>  for s in data: print repr(s), s, len(s), s.index('b')
>> ...
>> '\xc3\xa4b' ?b 3 2
>> '\xc3\xb6\xc3\xa4b' ??b 5 4
>> u'\xe4b' ?b 2 1
>> u'\xf6\xe4b' ??b 3 2
>>
>> In the above we have the two strings, first in 8-bit form and then in
>> unicode.
> 
> If strings start with index zero in Python, then yes, the second variant 
> is what I'm after.

Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python 
would be a good example to study and perhaps follow.


Jonathan


From khaledhosny at eglug.org  Thu Mar  4 21:24:34 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 4 Mar 2010 22:24:34 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B901358.90707@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de> <4B901358.90707@pytex.org>
Message-ID: <20100304202434.GA6737@khaled-laptop>

On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
> Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python
> would be a good example to study and perhaps follow.

Actually, python < 3.0 is a horrible mess Unicode-wise and I'd never
ever try to follow it. Python is my favorite programming language, but
I'd never call its Unicode support a "good example".

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From jfine at pytex.org  Thu Mar  4 21:42:42 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 20:42:42 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100304202434.GA6737@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>
	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>
	<4B901358.90707@pytex.org> <20100304202434.GA6737@khaled-laptop>
Message-ID: <4B901B42.50005@pytex.org>

Khaled Hosny wrote:
> On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
>> Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python
>> would be a good example to study and perhaps follow.
> 
> Actually, python < 3.0 is a horrible mess Unicode-wise and I'd never
> ever try to follow it. Python is my favorite programming language, but
> I'd never call its Unicode support a "good example".

"Horrible mess":  a provocative statement!

See here for the problems that are recognised and fixed in Python 3.

http://docs.python.org/dev/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit

Khaled:  Please suggest, with reasons, a better example to follow.

-- 
Jonathan

From jfine at pytex.org  Thu Mar  4 21:50:43 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 20:50:43 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B901B42.50005@pytex.org>
References: <4B8C0610.7030907@arcor.de>	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>	<4B901358.90707@pytex.org>
	<20100304202434.GA6737@khaled-laptop> <4B901B42.50005@pytex.org>
Message-ID: <4B901D23.3070300@pytex.org>

Jonathan Fine wrote:
> Khaled Hosny wrote:
>> On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
>>> Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python
>>> would be a good example to study and perhaps follow.
>>
>> Actually, python < 3.0 is a horrible mess Unicode-wise and I'd never
>> ever try to follow it. Python is my favorite programming language, but
>> I'd never call its Unicode support a "good example".
> 
> "Horrible mess":  a provocative statement!
> 
> See here for the problems that are recognised and fixed in Python 3.
> 
> http://docs.python.org/dev/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit 
> 
> 
> Khaled:  Please suggest, with reasons, a better example to follow.

I forgot to mention this:
     http://docs.python.org/dev/3.0/howto/unicode.html

I'd be grateful if the Unicode experts in this list could read it 
through and let me know if they see any problems.

-- 
Jonathan


From luigi.scarso at gmail.com  Thu Mar  4 22:01:51 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 4 Mar 2010 22:01:51 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B901D23.3070300@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de> <4B901358.90707@pytex.org>
	<20100304202434.GA6737@khaled-laptop> <4B901B42.50005@pytex.org>
	<4B901D23.3070300@pytex.org>
Message-ID: <fe8d59da1003041301y58bb0947r68e92f5aaf4bddef@mail.gmail.com>

On Thu, Mar 4, 2010 at 9:50 PM, Jonathan Fine <jfine at pytex.org> wrote:
> Jonathan Fine wrote:
>>
>> Khaled Hosny wrote:
>>>
>>> On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
>>>>
>>>> Yes, Stephan, they do start at zero. ?So for Unicode in Lua, Python
>>>> would be a good example to study and perhaps follow.
>>>
>>> Actually, python < 3.0 is a horrible mess Unicode-wise and I'd never
>>> ever try to follow it. Python is my favorite programming language, but
>>> I'd never call its Unicode support a "good example".
>>
>> "Horrible mess": ?a provocative statement!
>>
>> See here for the problems that are recognised and fixed in Python 3.
>>
>>
>> http://docs.python.org/dev/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit
>>
>> Khaled: ?Please suggest, with reasons, a better example to follow.
>
> I forgot to mention this:
> ? ?http://docs.python.org/dev/3.0/howto/unicode.html
>
> I'd be grateful if the Unicode experts in this list could read it through
> and let me know if they see any problems.
I have found this, but not time to judge

http://lucumr.pocoo.org/2010/1/7/pros-and-cons-about-python-3


-- 
luigi


From mailing_list at arcor.de  Thu Mar  4 22:07:38 2010
From: mailing_list at arcor.de (Stephan Hennig)
Date: Thu, 04 Mar 2010 22:07:38 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100304202434.GA6737@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>
	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>
	<4B901358.90707@pytex.org> <20100304202434.GA6737@khaled-laptop>
Message-ID: <4B90211A.8050008@arcor.de>

Am 04.03.2010 21:24, schrieb Khaled Hosny:
> On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
>> Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python
>> would be a good example to study and perhaps follow.
>
> Actually, python<  3.0 is a horrible mess Unicode-wise and I'd never
> ever try to follow it. Python is my favorite programming language, but
> I'd never call its Unicode support a "good example".

But I think Jonathan's Python example can act as an indicator that 
slnunicode does things wrong[1], or at least it doesn't comply to 
conventions even if its behaviour is documented.

In Python len and index always keep consistent about what the length of 
the string is, whether they treat it as a UTF-8 string or a byte sequence.

>> '\xc3\xa4b' ?b 3 2
>> '\xc3\xb6\xc3\xa4b' ??b 5 4
>> u'\xe4b' ?b 2 1
>> u'\xf6\xe4b' ??b 3 2

Best regards,
Stephan Hennig

[1] I know that a sample of one language might be a bit weak an 
argument.  But I have yet to see a language supporting slnunicode's 
behaviour.  Or a use-case, that doesn't qualify as a programming error.

From khaledhosny at eglug.org  Thu Mar  4 22:14:38 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 4 Mar 2010 23:14:38 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B901B42.50005@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de> <4B901358.90707@pytex.org>
	<20100304202434.GA6737@khaled-laptop> <4B901B42.50005@pytex.org>
Message-ID: <20100304211438.GA7217@khaled-laptop>

On Thu, Mar 04, 2010 at 08:42:42PM +0000, Jonathan Fine wrote:
> Khaled Hosny wrote:
> >On Thu, Mar 04, 2010 at 08:08:56PM +0000, Jonathan Fine wrote:
> >>Yes, Stephan, they do start at zero.  So for Unicode in Lua, Python
> >>would be a good example to study and perhaps follow.
> >
> >Actually, python < 3.0 is a horrible mess Unicode-wise and I'd never
> >ever try to follow it. Python is my favorite programming language, but
> >I'd never call its Unicode support a "good example".
> 
> "Horrible mess":  a provocative statement!

If you have ever tried to manipulate Unicode text in python (even in a
less than 100 lines script), you will see from where this "provocative
statement" came.

> See here for the problems that are recognised and fixed in Python 3.
> 
> http://docs.python.org/dev/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit

I already stated that I'm referring to pre-3.0 python.

> Khaled:  Please suggest, with reasons, a better example to follow.

I don't know much programming languages to suggest any thing, but I
happen to know enough python to "unsuggest" it.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From jfine at pytex.org  Thu Mar  4 22:51:30 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 21:51:30 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <fe8d59da1003041301y58bb0947r68e92f5aaf4bddef@mail.gmail.com>
References: <4B8C0610.7030907@arcor.de>
	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>
	<4B901358.90707@pytex.org>	<20100304202434.GA6737@khaled-laptop>
	<4B901B42.50005@pytex.org>	<4B901D23.3070300@pytex.org>
	<fe8d59da1003041301y58bb0947r68e92f5aaf4bddef@mail.gmail.com>
Message-ID: <4B902B62.9090706@pytex.org>

luigi scarso wrote:

>> I'd be grateful if the Unicode experts in this list could read it through
>> and let me know if they see any problems.
> I have found this, but not time to judge
> 
> http://lucumr.pocoo.org/2010/1/7/pros-and-cons-about-python-3

And this page has a link to:
http://www.cmlenz.net/archives/2008/07/the-truth-about-unicode-in-python

-- 
Jonathan


From jfine at pytex.org  Thu Mar  4 22:54:44 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 21:54:44 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100304211438.GA7217@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>
	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>
	<4B901358.90707@pytex.org>	<20100304202434.GA6737@khaled-laptop>
	<4B901B42.50005@pytex.org> <20100304211438.GA7217@khaled-laptop>
Message-ID: <4B902C24.6030504@pytex.org>

Khaled Hosny wrote:

> If you have ever tried to manipulate Unicode text in python (even in a
> less than 100 lines script), you will see from where this "provocative
> statement" came.

Khaled: Please could you give an example of Unicode difficulties in 
Python, and also, if possible an example of how a different language 
does it better.

-- 
Jonathan

From khaledhosny at eglug.org  Thu Mar  4 23:03:44 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 5 Mar 2010 00:03:44 +0200
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B902C24.6030504@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de> <4B901358.90707@pytex.org>
	<20100304202434.GA6737@khaled-laptop> <4B901B42.50005@pytex.org>
	<20100304211438.GA7217@khaled-laptop> <4B902C24.6030504@pytex.org>
Message-ID: <20100304220344.GA7598@khaled-laptop>

On Thu, Mar 04, 2010 at 09:54:44PM +0000, Jonathan Fine wrote:
> Khaled Hosny wrote:
> 
> >If you have ever tried to manipulate Unicode text in python (even in a
> >less than 100 lines script), you will see from where this "provocative
> >statement" came.
> 
> Khaled: Please could you give an example of Unicode difficulties in
> Python, and also, if possible an example of how a different language
> does it better.

I find discussing the pros and cons of python are way OT to this list,
the web is full of such examples.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From luigi.scarso at gmail.com  Thu Mar  4 23:08:52 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 4 Mar 2010 23:08:52 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B902B62.9090706@pytex.org>
References: <4B8C0610.7030907@arcor.de> <4B8F6C23.9040800@pytex.org>
	<4B8FD927.3000401@arcor.de> <4B901358.90707@pytex.org>
	<20100304202434.GA6737@khaled-laptop> <4B901B42.50005@pytex.org>
	<4B901D23.3070300@pytex.org>
	<fe8d59da1003041301y58bb0947r68e92f5aaf4bddef@mail.gmail.com>
	<4B902B62.9090706@pytex.org>
Message-ID: <fe8d59da1003041408qa69347fua305d0b91a4c1cf1@mail.gmail.com>

On Thu, Mar 4, 2010 at 10:51 PM, Jonathan Fine <jfine at pytex.org> wrote:
> luigi scarso wrote:
>
>>> I'd be grateful if the Unicode experts in this list could read it through
>>> and let me know if they see any problems.
>>
>> I have found this, but not time to judge
>>
>> http://lucumr.pocoo.org/2010/1/7/pros-and-cons-about-python-3
>
> And this page has a link to:
> http://www.cmlenz.net/archives/2008/07/the-truth-about-unicode-in-python

A bit outdate for python.

Anyway I think that ICU can be candidate, but it's big (icu-lua exists
but I don't know if is usable)
Until now I haven't seen an error in Selene, which is really compact
and tested.
For a tex macro programmer should be not a problem write some wrapper
functions in lua
(infact there are two versions of find_utf8) .

-- 
luigi

From jfine at pytex.org  Thu Mar  4 23:29:38 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Thu, 04 Mar 2010 22:29:38 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <20100304220344.GA7598@khaled-laptop>
References: <4B8C0610.7030907@arcor.de>
	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>
	<4B901358.90707@pytex.org>	<20100304202434.GA6737@khaled-laptop>
	<4B901B42.50005@pytex.org>	<20100304211438.GA7217@khaled-laptop>
	<4B902C24.6030504@pytex.org> <20100304220344.GA7598@khaled-laptop>
Message-ID: <4B903452.7090400@pytex.org>

Khaled Hosny wrote:
> On Thu, Mar 04, 2010 at 09:54:44PM +0000, Jonathan Fine wrote:
>> Khaled Hosny wrote:
>>
>>> If you have ever tried to manipulate Unicode text in python (even in a
>>> less than 100 lines script), you will see from where this "provocative
>>> statement" came.
>> Khaled: Please could you give an example of Unicode difficulties in
>> Python, and also, if possible an example of how a different language
>> does it better.
> 
> I find discussing the pros and cons of python are way OT to this list,
> the web is full of such examples.

Khaled:  If there are so many, it won't take you a moment to supply a 
URL.  Please do, so I can understand the problem better.

-- 
Jonathan

From taco at elvenkind.com  Fri Mar  5 09:06:48 2010
From: taco at elvenkind.com (taco)
Date: Fri, 05 Mar 2010 09:06:48 +0100
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B903452.7090400@pytex.org>
References: <4B8C0610.7030907@arcor.de>	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>	<4B901358.90707@pytex.org>	<20100304202434.GA6737@khaled-laptop>	<4B901B42.50005@pytex.org>	<20100304211438.GA7217@khaled-laptop>	<4B902C24.6030504@pytex.org>
	<20100304220344.GA7598@khaled-laptop> <4B903452.7090400@pytex.org>
Message-ID: <4B90BB98.703@elvenkind.com>

Jonathan Fine wrote:
> Khaled Hosny wrote:
>> On Thu, Mar 04, 2010 at 09:54:44PM +0000, Jonathan Fine wrote:
>>> Khaled Hosny wrote:
>>>
>>>> If you have ever tried to manipulate Unicode text in python (even in a
>>>> less than 100 lines script), you will see from where this "provocative
>>>> statement" came.
>>> Khaled: Please could you give an example of Unicode difficulties in
>>> Python, and also, if possible an example of how a different language
>>> does it better.
>>
>> I find discussing the pros and cons of python are way OT to this list,
>> the web is full of such examples.
> 
> Khaled:  If there are so many, it won't take you a moment to supply a 
> URL.  Please do, so I can understand the problem better.

Offlist please! This is *way* offtopic.


From jfine at pytex.org  Fri Mar  5 19:22:41 2010
From: jfine at pytex.org (Jonathan Fine)
Date: Fri, 05 Mar 2010 18:22:41 +0000
Subject: [luatex] problem with slnunicode's find
In-Reply-To: <4B90BB98.703@elvenkind.com>
References: <4B8C0610.7030907@arcor.de>	<4B8F6C23.9040800@pytex.org>	<4B8FD927.3000401@arcor.de>	<4B901358.90707@pytex.org>	<20100304202434.GA6737@khaled-laptop>	<4B901B42.50005@pytex.org>	<20100304211438.GA7217@khaled-laptop>	<4B902C24.6030504@pytex.org>	<20100304220344.GA7598@khaled-laptop>
	<4B903452.7090400@pytex.org> <4B90BB98.703@elvenkind.com>
Message-ID: <4B914BF1.7000505@pytex.org>

taco wrote:

>> Khaled:  If there are so many, it won't take you a moment to supply a 
>> URL.  Please do, so I can understand the problem better.
> 
> Offlist please! This is *way* offtopic.

I don't agree, but I won't press the matter.  I do hope that Khaled will 
reply to my request off-list.

-- 
Jonathan


From pragma at wxs.nl  Mon Mar  8 21:47:39 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 08 Mar 2010 21:47:39 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <4B85238B.7040805@elvenkind.com>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>
	<4B85238B.7040805@elvenkind.com>
Message-ID: <4B95626B.4080302@wxs.nl>

On 24-2-2010 14:03, Taco Hoekwater wrote:
> ?lie Roux wrote:
>> Hello,
>>
>> While trying to get the \LuaTeX and \LuaLaTeX macros into the LaTeX
>> metalogo package, I tried to make the logos a bit more fancy but still
>> respecting the style of the LuaTeX manual. Here is my attempt. What do
>> you think about it? My personal favorites are proposal 3 for both.
>
> You probably already know how I feel about this: proposal 1 is my
> favorite.

Indeed. No fancy shifting needed. It also avoids endless discussions 
about how to deal with it in whatever font: just Lua\TeX as we have been 
using right from the start.

I don't care about the lualatex logo.

(Btw, we never had pdfcontext, luacontext of whatevercontext and there 
will never be such combination names; te rules for rendering ConTeXt are 
not that strict and might depend on the font e.g. smallcaps is fine too. 
In retrospect i'd just used 'context' as too many of those funny logos 
lead to rather ugly looking pages.)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Mar  8 21:51:43 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 08 Mar 2010 21:51:43 +0100
Subject: [luatex] readlink?
In-Reply-To: <4B8C0E82.40407@telecom-bretagne.eu>
References: <4B8BFAC0.8000009@telecom-bretagne.eu>	<4B8BFE51.5030909@elvenkind.com>	<4B8C0641.3030406@telecom-bretagne.eu>	<20100301185313.GB3557@khaled-laptop>
	<4B8C0E82.40407@telecom-bretagne.eu>
Message-ID: <4B95635F.7070005@wxs.nl>

On 1-3-2010 19:59, Elie Roux wrote:
> Khaled Hosny a ?crit :
>> I'm not sure if I understand this, but aren't symlinks filesystem rather
>> than OS specific (i.e. no symlinks on FAT but symlinks on ISO 9660
>> filesystems, no matter what OS you are running)?
>
> Yes, but I don't think Windows can do symlinks, even with drivers for a
> symlinkable filesystem... anyways, having the same check as
> lfs.symlinkattributes has would be OK I guess...

ntfs has links and if i remember right in the beginning of luatex we had 
do patch the lfs library (of that time) to deal with it in order to get 
the right attributes.

Hans

-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From reinhard.kotucha at web.de  Tue Mar  9 01:52:25 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 9 Mar 2010 01:52:25 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <4B95626B.4080302@wxs.nl>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>
	<4B85238B.7040805@elvenkind.com> <4B95626B.4080302@wxs.nl>
Message-ID: <19349.39881.355872.391990@zaphod.ms25.net>

On 8 March 2010 Hans Hagen wrote:

 > On 24-2-2010 14:03, Taco Hoekwater wrote:
 > > ?lie Roux wrote:
 > >> Hello,
 > >>
 > >> While trying to get the \LuaTeX and \LuaLaTeX macros into the
 > >> LaTeX metalogo package, I tried to make the logos a bit more
 > >> fancy but still respecting the style of the LuaTeX manual. Here
 > >> is my attempt. What do you think about it? My personal favorites
 > >> are proposal 3 for both.
 > >
 > > You probably already know how I feel about this: proposal 1 is my
 > > favorite.
 > 
 > Indeed. No fancy shifting needed. It also avoids endless
 > discussions about how to deal with it in whatever font: just
 > Lua\TeX as we have been using right from the start.
 > 
 > I don't care about the lualatex logo.

Hans, I fully agree.  This "fancy shifting" is ridiculous, of course.
But it's actually unavoidable because it was introduced by Knuth and
we all know that Knuth is infallible. IMO it's (more than) sufficient
if "Lua\TeX" contains "\TeX".

In order to avoid endless discussions I think that Taco should decide
and carve his decision in stone.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From khaledhosny at eglug.org  Tue Mar  9 02:13:24 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 9 Mar 2010 03:13:24 +0200
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <19349.39881.355872.391990@zaphod.ms25.net>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>
	<4B85238B.7040805@elvenkind.com> <4B95626B.4080302@wxs.nl>
	<19349.39881.355872.391990@zaphod.ms25.net>
Message-ID: <20100309011324.GA23268@khaled-laptop>

On Tue, Mar 09, 2010 at 01:52:25AM +0100, Reinhard Kotucha wrote:
> On 8 March 2010 Hans Hagen wrote:
> 
>  > On 24-2-2010 14:03, Taco Hoekwater wrote:
>  > > ?lie Roux wrote:
>  > >> Hello,
>  > >>
>  > >> While trying to get the \LuaTeX and \LuaLaTeX macros into the
>  > >> LaTeX metalogo package, I tried to make the logos a bit more
>  > >> fancy but still respecting the style of the LuaTeX manual. Here
>  > >> is my attempt. What do you think about it? My personal favorites
>  > >> are proposal 3 for both.
>  > >
>  > > You probably already know how I feel about this: proposal 1 is my
>  > > favorite.
>  > 
>  > Indeed. No fancy shifting needed. It also avoids endless
>  > discussions about how to deal with it in whatever font: just
>  > Lua\TeX as we have been using right from the start.
>  > 
>  > I don't care about the lualatex logo.
> 
> Hans, I fully agree.  This "fancy shifting" is ridiculous, of course.
> But it's actually unavoidable because it was introduced by Knuth and
> we all know that Knuth is infallible. IMO it's (more than) sufficient
> if "Lua\TeX" contains "\TeX".
> 
> In order to avoid endless discussions I think that Taco should decide
> and carve his decision in stone.

I don't recall anybody objecting on Taco's decision, I don't see any
"endless discussions" either, all what I see is a genuine question which
is, to the best of my knowledge, is first time to be asked. I'm just
sating that because I don't like the implied stigmatization of any one
daring to even mention the "funny logos", and no, I don't think Knuth is
infallible and I find such note very offensive.

P.S. I do find the mixed casing of TeX or LaTeX more ridiculous, it
doesn't even have the sense of cleverness or hack the typeset logo has.

P.S.2 I posted a more funny LuaTeX logo a while ago, it was a kind of
joke actually, just in case some one came across it and thought I was
seriously proposing it.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From taco at elvenkind.com  Tue Mar  9 08:41:23 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 09 Mar 2010 08:41:23 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <20100309011324.GA23268@khaled-laptop>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>
	<4B95626B.4080302@wxs.nl>	<19349.39881.355872.391990@zaphod.ms25.net>
	<20100309011324.GA23268@khaled-laptop>
Message-ID: <4B95FBA3.9020003@elvenkind.com>


Hi,

Khaled Hosny wrote:
> 
> I don't recall anybody objecting on Taco's decision, I don't see any
> "endless discussions" either, all what I see is a genuine question which
> is, to the best of my knowledge, is first time to be asked. I'm just
> sating that because I don't like the implied stigmatization of any one
> daring to even mention the "funny logos", and no, I don't think Knuth is
> infallible and I find such note very offensive.

I've been asked to logo question at least a dozen times, but all
off-list, as far as I remember. I don't think this was an unreasonable
thread at all: there was a genuine question, considering all the
already existing typographical logos in our community.

> P.S. I do find the mixed casing of TeX or LaTeX more ridiculous, it
> doesn't even have the sense of cleverness or hack the typeset logo has.

I find that when I am writing about the 'language', I tend to use
'LuaTeX' (or the logo Lua\TeX, in typeset material) but a simple
'luatex' when referring to the binary or implementation details.

This is what I will keep doing, and I don't really care or mind what
anybody else uses ;)

Best wishes,
Taco



From Robin.Fairbairns at cl.cam.ac.uk  Tue Mar  9 08:48:28 2010
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 09 Mar 2010 07:48:28 +0000
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: Your message of Tue, 09 Mar 2010 01:52:25 +0100.
	<19349.39881.355872.391990@zaphod.ms25.net>
Message-ID: <19801.1268120908@cl.cam.ac.uk>

Reinhard Kotucha <reinhard.kotucha at web.de> wrote:

> On 8 March 2010 Hans Hagen wrote:
> 
>  > On 24-2-2010 14:03, Taco Hoekwater wrote:
>  > > ?lie Roux wrote:
>  > >
>  > >> While trying to get the \LuaTeX and \LuaLaTeX macros into the
>  > >> LaTeX metalogo package, I tried to make the logos a bit more
>  > >> fancy but still respecting the style of the LuaTeX manual. Here
>  > >> is my attempt. What do you think about it? My personal favorites
>  > >> are proposal 3 for both.
>  > >
>  > > You probably already know how I feel about this: proposal 1 is my
>  > > favorite.
>  > 
>  > Indeed. No fancy shifting needed. It also avoids endless
>  > discussions about how to deal with it in whatever font: just
>  > Lua\TeX as we have been using right from the start.
>  > 
>  > I don't care about the lualatex logo.
> 
> Hans, I fully agree.  This "fancy shifting" is ridiculous, of course.
> But it's actually unavoidable because it was introduced by Knuth and
> we all know that Knuth is infallible. IMO it's (more than) sufficient
> if "Lua\TeX" contains "\TeX".
> 
> In order to avoid endless discussions I think that Taco should decide
> and carve his decision in stone.

a simple initial logo is a discouragement to people who will later (no
doubt) want to add illegibility to it.  the range of tex-related logos
has several excrescences in it, and the smaller the incentive to make
yet more, the better, imo.

so, you can tell where my vote goes.

robin the minimalist.


From pragma at wxs.nl  Tue Mar  9 19:28:27 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 19:28:27 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <19349.39881.355872.391990@zaphod.ms25.net>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>
	<4B95626B.4080302@wxs.nl>
	<19349.39881.355872.391990@zaphod.ms25.net>
Message-ID: <4B96934B.1010907@wxs.nl>

On 9-3-2010 1:52, Reinhard Kotucha wrote:
> On 8 March 2010 Hans Hagen wrote:
>
>   >  On 24-2-2010 14:03, Taco Hoekwater wrote:
>   >  >  ?lie Roux wrote:
>   >  >>  Hello,
>   >  >>
>   >  >>  While trying to get the \LuaTeX and \LuaLaTeX macros into the
>   >  >>  LaTeX metalogo package, I tried to make the logos a bit more
>   >  >>  fancy but still respecting the style of the LuaTeX manual. Here
>   >  >>  is my attempt. What do you think about it? My personal favorites
>   >  >>  are proposal 3 for both.
>   >  >
>   >  >  You probably already know how I feel about this: proposal 1 is my
>   >  >  favorite.
>   >
>   >  Indeed. No fancy shifting needed. It also avoids endless
>   >  discussions about how to deal with it in whatever font: just
>   >  Lua\TeX as we have been using right from the start.
>   >
>   >  I don't care about the lualatex logo.
>
> Hans, I fully agree.  This "fancy shifting" is ridiculous, of course.
> But it's actually unavoidable because it was introduced by Knuth and
> we all know that Knuth is infallible. IMO it's (more than) sufficient
> if "Lua\TeX" contains "\TeX".

indeed, and i have definitely have no problem with the tex logo at all 
as it's Don's nice joke; it's just the additional 'funny' shifting in 
derived logos that i dislike (esp when using special fonts as in etex 
and amstex cum suis)

ok, i admit that the random generated metafun logo is also somwhat over 
the top but at least it sits on the baseline

> In order to avoid endless discussions I think that Taco should decide
> and carve his decision in stone.

don't worry, we already decided for the simple case long ago; we made 
the decision before the first version of luatex was demonstrated - at 
the tug conference in wuhan/china -)

btw, the first instance luatex binary was generated by hartmut so that 
was actually the moment that the name 'luatex' as program showed up 
first; those historic bits and pieces are described someplace

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar  9 19:33:32 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 19:33:32 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <20100309011324.GA23268@khaled-laptop>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>
	<4B95626B.4080302@wxs.nl>	<19349.39881.355872.391990@zaphod.ms25.net>
	<20100309011324.GA23268@khaled-laptop>
Message-ID: <4B96947C.4080805@wxs.nl>

On 9-3-2010 2:13, Khaled Hosny wrote:

> P.S.2 I posted a more funny LuaTeX logo a while ago, it was a kind of
> joke actually, just in case some one came across it and thought I was
> seriously proposing it.

actually, i have no problem with alternative logo's being uses as long 
as it's clear that we're talking of a personal touch and not the 
official one; after all we're talking of typography and that means that 
there is quite some freedom involved; we're not talking trademarks here

side note: at one of the context conferences an alternative context logo 
was made up without me being present and knowing how serious all those 
present (at 3 o'clock in the middle of the night surrounded by beer and 
chips) i could hardly object -)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Tue Mar  9 19:35:58 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 9 Mar 2010 19:35:58 +0100
Subject: [luatex] Strategy for creating a nodelist
Message-ID: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>

Hello,

I wonder what is the best strategy for creating a (double linked) node list.

Let's say I want to create a list containing the three gylph_nodes T, E, and X. One way would be 

----------
t = node.new(glyph_node)
t.font = 1
t.char = string.byte("T")

e = node.new(glyph_node)
e.font = 1
e.char = string.byte("E")

x = node.new(glyph_node)
x.font = 1
x.char = string.byte("X")

t.next = e
e.next = x

node.slide(t)
----------

Looking at the documentation, node.insert_after() looks very much like what I want to use. But I don't quite understand its use when the head node is nil.

For node.insert_after() I need a valid "current" node and a valid "new" node. But that would mean that I already have a head in form of the "current" node, right?

Patrick




From pragma at wxs.nl  Tue Mar  9 19:59:08 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 19:59:08 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <20100309011324.GA23268@khaled-laptop>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>
	<4B95626B.4080302@wxs.nl>	<19349.39881.355872.391990@zaphod.ms25.net>
	<20100309011324.GA23268@khaled-laptop>
Message-ID: <4B969A7C.4070206@wxs.nl>

Hi Khaled:

> P.S.2 I posted a more funny LuaTeX logo a while ago, it was a kind of
> joke actually, just in case some one came across it and thought I was
> seriously proposing it.

Actually we can make a nice definition using the RL typesetting ... as 
not that many fonts have a proper aT kerning we can do the following:

\def\LuaTeX
   {\begingroup
    Lua%
    \setbox0\hbox{oT}%
    \setbox2\hbox{o\kern0ptT}%
    \ifdim\wd0=\wd2
      \setbox0\hbox dir TRT{To}%
      \setbox2\hbox{T\kern0pto}%
      \hskip\dimexpr\wd0-\wd2\relax
    \fi
    \TeX
    \endgroup}

Of course this ignores the fact that the a is not symmetrical which is 
why we use the o instead  but it looks impressive (as the T normally is 
symmetrical we don't really need the need the dir).

Maybe I should write an article about it (as i've seen quite some 
articles / talks about how complex it is to do tex related logos) ...

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar  9 20:02:59 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 20:02:59 +0100
Subject: [luatex] Strategy for creating a nodelist
In-Reply-To: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>
References: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>
Message-ID: <4B969B63.3090305@wxs.nl>

On 9-3-2010 19:35, Patrick Gundlach wrote:
> Hello,
>
> I wonder what is the best strategy for creating a (double linked) node list.
>
> Let's say I want to create a list containing the three gylph_nodes T, E, and X. One way would be
>
> ----------
> t = node.new(glyph_node)
> t.font = 1
> t.char = string.byte("T")
>
> e = node.new(glyph_node)
> e.font = 1
> e.char = string.byte("E")
>
> x = node.new(glyph_node)
> x.font = 1
> x.char = string.byte("X")
>
> t.next = e
> e.next = x
>
> node.slide(t)
> ----------
>
> Looking at the documentation, node.insert_after() looks very much like what I want to use. But I don't quite understand its use when the head node is nil.
>
> For node.insert_after() I need a valid "current" node and a valid "new" node. But that would mean that I already have a head in form of the "current" node, right?

i normally just use something

t = node.new(glyph_node)
t.font = 1
t.char = string.byte("T")

e = node.new(glyph_node)
e.font = 1
e.char = string.byte("E")

e.prev = t
t.next = e

x = node.new(glyph_node)
x.font = 1
x.char = string.byte("X")

x.prev = t
t.next = e

no need to slide

in most cases you can forget about the prev as luatex itself will slide 
when needed (in order to be sure of a proper list)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar  9 20:12:45 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 20:12:45 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <4B96947C.4080805@wxs.nl>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>	<4B95626B.4080302@wxs.nl>	<19349.39881.355872.391990@zaphod.ms25.net>	<20100309011324.GA23268@khaled-laptop>
	<4B96947C.4080805@wxs.nl>
Message-ID: <4B969DAD.8040107@wxs.nl>

btw,

Officially Lua is called Lua with a captical L so that sort of demands 
luaTeX to be LuaTeX but in some cases lua\TeX looks nicer for (depends a 
bit on the font) as one then sees the two words so i guess that both 
lua\TeX and Lua\TeX are quite ok as long as it's used consistently. In 
all-caps titles LUA\TeX is also ok. So the spec boils down to:

logo   : [Lua|lua|LUA]\TeX
binary : luatex

(personally I use luaTeX as it looks nice in smallcaps)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue Mar  9 20:19:35 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 09 Mar 2010 20:19:35 +0100
Subject: [luatex] Strategy for creating a nodelist
In-Reply-To: <4B969B63.3090305@wxs.nl>
References: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>
	<4B969B63.3090305@wxs.nl>
Message-ID: <4B969F47.3030707@elvenkind.com>

Hans Hagen wrote:
>> Looking at the documentation, node.insert_after() looks very much like 
>> what I want to use. But I don't quite understand its use when the head 
>> node is nil.

Both for speed and for ease of use when building a moderate node list
from scratch, the optimal solution is to only set the .next pointers
and use a single node.slide() when the construction is finished: this
is the fastest solution for any new list with non-trivial length, and
it takes the least amount of code.

When you have to splice one or two nodes into an existing node list,
node.insert_before/insert_after are probably better.

And for really short lists, .next and .prev are fine.


>>
>> For node.insert_after() I need a valid "current" node and a valid 
>> "new" node. But that would mean that I already have a head in form of 
>> the "current" node, right?

Yes. Starting a node list with insert_after() feels a bit clumsy,
because it was specifically written for splicing stuff into an
existing node list.

> in most cases you can forget about the prev as luatex itself will slide 
> when needed (in order to be sure of a proper list)

I want to get rid of those automatic slides by the executable as much
as possible: if everything on the lua side is behaving properly, they
should not be needed and only waste cpu cycles.

Best wishes,
Taco






From pragma at wxs.nl  Tue Mar  9 22:07:48 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 09 Mar 2010 22:07:48 +0100
Subject: [luatex] Strategy for creating a nodelist
In-Reply-To: <4B969F47.3030707@elvenkind.com>
References: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>	<4B969B63.3090305@wxs.nl>
	<4B969F47.3030707@elvenkind.com>
Message-ID: <4B96B8A4.8030106@wxs.nl>

On 9-3-2010 20:19, Taco Hoekwater wrote:
> Hans Hagen wrote:
>>> Looking at the documentation, node.insert_after() looks very much
>>> like what I want to use. But I don't quite understand its use when
>>> the head node is nil.
>
> Both for speed and for ease of use when building a moderate node list
> from scratch, the optimal solution is to only set the .next pointers
> and use a single node.slide() when the construction is finished: this
> is the fastest solution for any new list with non-trivial length, and
> it takes the least amount of code.
>
> When you have to splice one or two nodes into an existing node list,
> node.insert_before/insert_after are probably better.

in addition:

when these helpers were introduced we did some timing and the helpers 
are more efficient than similar code that used nil/next/prev/head 
checking and prev/next/head assignments

when deciding on an optimum, keep in mind that .next and .prev are in 
fact function calls (meta keys), so, node.insert_before is one call at 
the lua end while .next etc are each a call

in a similar fashion, when using node.traverse can be faster than a 
while loop, although in this case each iteration is a function call 
(luaish) so there

local n = head
while n do
    ...
    n = n.next
end

and

for n in node.traverse(head) do
   ...
end

are comparable; on the other hand, traverse_id can be faster as it does 
the comparison (save a call to n.id) and jumps over non matching nodes

when writing code one should keep in mind that in practice the 
difference in speed is not that large

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From kohda at pm.tokushima-u.ac.jp  Wed Mar 10 04:31:40 2010
From: kohda at pm.tokushima-u.ac.jp (Atsuhito Kohda)
Date: Wed, 10 Mar 2010 12:31:40 +0900 (JST)
Subject: [luatex] ligature of OpenType fonts
Message-ID: <20100310.123140.112733186.kohda@pm.tokushima-u.ac.jp>

Hi all,

I'm very new with LuaTeX but recently I succeeded to display
Japanese text with LuaLaTeX.  It is very nice but I noticed
also a slight problem, that is, it seems ligature is not effective 
with my fonts settings.

My method is to follow instructions from
http://luatex.bluwiki.com/go/Use_a_TrueType_font
(needs to modify fontforge -> fontloader)
http://luatex.bluwiki.com/go/Japanese_and_more_generally_CJK_typesetting
and set up fonts as follows:

\DeclareFontFamily{OT1}{jpnfnt}{}
\DeclareFontShape{OT1}{jpnfnt}{m}{n}{<-> s * [0.961026]"ipam.otf"}{}
\DeclareFontShape{OT1}{jpnfnt}{bx}{n}{<-> s * [0.961026]"ipag.otf"}{}
(IPA is a free Japanese OTF and very popular in Japan at present)

Generally this works fine but ligature seems not effective,
for example, output of ``foo`` displays open-quotes simply
succesive two quote mark instead of compressed ", normally
seen with TeX output.
(I hope you can understand my poor explanation ;-)

I suspect there is a method to tell "make ligature effective"
in LuaTeX like XeTeX (fontspec) but can't find concrete example
code yet.

After googling a bit I found "luaotfload" but I don't know
how to use it yet and some trial failed at present.

If it is necessary to review my style file please let me know.
I'll post it but it is almost literal copy of files in
http://luatex.bluwiki.com/go/

Thanks in advance.
Best regards,			2010-3-10(Wed)

-- 
 Debian Developer - much more I18N of Debian
 Atsuhito Kohda <kohda AT debian.org>
 Department of Math., Univ. of Tokushima

From elie.roux at telecom-bretagne.eu  Wed Mar 10 08:39:17 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Wed, 10 Mar 2010 09:39:17 +0200
Subject: [luatex] ligature of OpenType fonts
In-Reply-To: <20100310.123140.112733186.kohda@pm.tokushima-u.ac.jp>
References: <20100310.123140.112733186.kohda@pm.tokushima-u.ac.jp>
Message-ID: <eba574421003092339l51d36c77n96b52d72e0d53c9b@mail.gmail.com>

Hello,

you should use the package luaotfload, as almost all OTF tables work
with it (all kinds of ligatures, kernings, etc.). There is a CTAN
version working under TeX Live 2009 and with a recent LuaTeX, there is
also a development version (http://github.com/mpg/luaotfload/) that
works only with the svn version of LuaTeX (but it seems there will be
a release soon).

Thank you,
-- 
Elie

From heiko.oberdiek at googlemail.com  Wed Mar 10 10:54:58 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Wed, 10 Mar 2010 10:54:58 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <4B969A7C.4070206@wxs.nl>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>
	<4B85238B.7040805@elvenkind.com> <4B95626B.4080302@wxs.nl>
	<19349.39881.355872.391990@zaphod.ms25.net>
	<20100309011324.GA23268@khaled-laptop> <4B969A7C.4070206@wxs.nl>
Message-ID: <20100310095458.GB2904@oberdiek.my-fqdn.de>

Hi Hans,

On Tue, Mar 09, 2010 at 07:59:08PM +0100, Hans Hagen wrote:

> Hi Khaled:
> 
> >P.S.2 I posted a more funny LuaTeX logo a while ago, it was a kind of
> >joke actually, just in case some one came across it and thought I was
> >seriously proposing it.
> 
> Actually we can make a nice definition using the RL typesetting ...
> as not that many fonts have a proper aT kerning we can do the
> following:
> 
> \def\LuaTeX
>   {\begingroup
>    Lua%
>    \setbox0\hbox{oT}%
>    \setbox2\hbox{o\kern0ptT}%

Using `o' it remains hidden whether the font contains `aT' kerning.
Therefore I think `a' should be used instead of `o'.

>    \ifdim\wd0=\wd2
>      \setbox0\hbox dir TRT{To}%

I don't see the point in using TRT. What's the difference to \hbox{oT}?

>      \setbox2\hbox{T\kern0pto}%
>      \hskip\dimexpr\wd0-\wd2\relax
>    \fi
>    \TeX
>    \endgroup}
> 
> Of course this ignores the fact that the a is not symmetrical which
> is why we use the o instead  but it looks impressive (as the T
> normally is symmetrical we don't really need the need the dir).

A variant that tries the implicite kernings in the order of
`aT', `oT', `To'. Also the code is compatible to plain-TeX:

\def\LuaTeX{%
  \begingroup
    Lua%
    \setbox0\hbox{aT}%
    \setbox2\hbox{a\kern0ptT}%
    \ifdim\wd0<\wd2 %
    \else
      \setbox0\hbox{oT}%
      \setbox2\hbox{o\kern0ptT}%
      \ifdim\wd0<\wd2 %   
      \else
        \setbox0\hbox{To}%
        \setbox2\hbox{T\kern0pto}%
      \fi
      \ifdim\wd0<\wd2 %  
        \dimen0=\wd0 %  
        \advance\dimen0-\wd2 %  
        \kern\dimen0 %  
      \fi  
    \fi    
    \TeX   
  \endgroup
}

Test file:

\documentclass[12pt,a4paper]{article}
\usepackage[
  vmargin=15mm
]{geometry}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{tgheros}
\let\rmdefault\sfdefault
\parindent=0pt
\providecommand*{\LuaTeX}{%
  \begingroup
    Lua%
    \setbox0\hbox{aT}%
    \setbox2\hbox{a\kern0ptT}%
\typeout{\ifdim\wd0=\wd2=\else*\fi aT: \the\wd0, \the\wd2}%
    \ifdim\wd0<\wd2 %
    \else
      \setbox0\hbox{oT}%
      \setbox2\hbox{o\kern0ptT}%
\typeout{\ifdim\wd0=\wd2=\else*\fi oT: \the\wd0, \the\wd2}%
      \ifdim\wd0<\wd2 %
      \else
        \setbox0\hbox{To}%
        \setbox2\hbox{T\kern0pto}%
\typeout{\ifdim\wd0=\wd2=\else*\fi To: \the\wd0, \the\wd2}%
      \fi
      \ifdim\wd0<\wd2 %
        \dimen0=\wd0 %
        \advance\dimen0-\wd2 %
        \kern\dimen0 %
      \fi
    \fi
    \TeX
  \endgroup
}
\begin{document}
\Huge
\def\test#1\\{%
  \fontfamily{#1}\selectfont Lua\TeX\newline \LuaTeX &
  \texttt{#1}\tabularnewline
  \hline
}
\def\Test#1{%
  \begingroup
    #1%
    \begin{tabular}{p{40mm}l}
    \hline
    \multicolumn{2}{c}{\texttt{\detokenize{#1}}}\tabularnewline
    \hline
    \test cmr\\
    \test cmss\\
    \test cmtt\\
    \test lmr\\
    \test lmss\\
    \test lmtt\\
    \test lmvtt\\
    \test qtm\\
    \test qhv\\
    \test qcr\\
    \end{tabular}%
  \endgroup
  \newpage
}
\Test{\normalfont}
\Test{\itshape}
\Test{\scshape} 
\end{document}

Best regards
  Heiko <oberdiek at uni-freiburg.de>

From patrick at gundla.ch  Wed Mar 10 11:23:48 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 10 Mar 2010 11:23:48 +0100
Subject: [luatex] Strategy for creating a nodelist
In-Reply-To: <4B96B8A4.8030106@wxs.nl>
References: <BB7A8D12-FCE2-4058-AB74-6E71285DA295@gundla.ch>	<4B969B63.3090305@wxs.nl>
	<4B969F47.3030707@elvenkind.com> <4B96B8A4.8030106@wxs.nl>
Message-ID: <9E3F7B56-86EE-4B79-88FA-BEABC2DA3DEE@gundla.ch>

Hello Hans and Taco,

thanks for the comments on this. I now have a much better "feeling" for nodes!

Patrick



From mpg at elzevir.fr  Thu Mar 11 15:05:39 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Thu, 11 Mar 2010 15:05:39 +0100
Subject: [luatex] stability disclaimer in the manual
Message-ID: <4B98F8B3.1020608@elzevir.fr>

Hi,

I happened to re-read the disclaimer in the introduction of the LuaTeX manual
(version from trunk) recently. At the end, it states that

> Currently we expect the first release with (some) fixed interfaces to be
> available sometime in the autumn of 2008. [...]

Since 2008 is now in the past, you may want to update the wording :-)

Manuel.

PS: I'm not asking for more stability right now, nor for comprehensive
stability-related indications in the manual, just pointing out a small typo.

From taco at elvenkind.com  Thu Mar 11 19:02:09 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Thu, 11 Mar 2010 19:02:09 +0100
Subject: [luatex] stability disclaimer in the manual
In-Reply-To: <4B98F8B3.1020608@elzevir.fr>
References: <4B98F8B3.1020608@elzevir.fr>
Message-ID: <4B993021.5050804@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> I happened to re-read the disclaimer in the introduction of the LuaTeX manual
> (version from trunk) recently. At the end, it states that
> 
>> Currently we expect the first release with (some) fixed interfaces to be
>> available sometime in the autumn of 2008. [...]
> 
> Since 2008 is now in the past, you may want to update the wording :-)
> 
> Manuel.
> 
> PS: I'm not asking for more stability right now, nor for comprehensive
> stability-related indications in the manual, just pointing out a small typo.

Actually, some stuff (like the node and font interface) is now rather
stable, I'll try to add some remarks in the relevant sections.

Best wishes,
Taco

From pragma at wxs.nl  Thu Mar 11 19:56:50 2010
From: pragma at wxs.nl (Hans Hagen)
Date: Thu, 11 Mar 2010 19:56:50 +0100
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <20100310095458.GB2904@oberdiek.my-fqdn.de>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>	<4B85238B.7040805@elvenkind.com>
	<4B95626B.4080302@wxs.nl>	<19349.39881.355872.391990@zaphod.ms25.net>	<20100309011324.GA23268@khaled-laptop>
	<4B969A7C.4070206@wxs.nl>
	<20100310095458.GB2904@oberdiek.my-fqdn.de>
Message-ID: <4B993CF2.80709@wxs.nl>

On 10-3-2010 10:54, Heiko Oberdiek wrote:

> Using `o' it remains hidden whether the font contains `aT' kerning.
> Therefore I think `a' should be used instead of `o'.

sure, it's just an example that assumes that there is no aT kern but 
maybe a Ta which is then wrong since the shape is non symmetrical hence 
the o.

>>     \ifdim\wd0=\wd2
>>       \setbox0\hbox dir TRT{To}%
>
> I don't see the point in using TRT. What's the difference to \hbox{oT}?

lack of kerns of oT in most fonts (we often have upper-lower kerns but 
not the reverse); the TRT is just a touch of luatex -)

> A variant that tries the implicite kernings in the order of
> `aT', `oT', `To'. Also the code is compatible to plain-TeX:

you mean traditional (non-etex) i guess

> \def\LuaTeX{%
>    \begingroup
>      Lua%
>      \setbox0\hbox{aT}%
>      \setbox2\hbox{a\kern0ptT}%
>      \ifdim\wd0<\wd2 %
>      \else
>        \setbox0\hbox{oT}%
>        \setbox2\hbox{o\kern0ptT}%
>        \ifdim\wd0<\wd2 %
>        \else
>          \setbox0\hbox{To}%
>          \setbox2\hbox{T\kern0pto}%
>        \fi
>        \ifdim\wd0<\wd2 %
>          \dimen0=\wd0 %
>          \advance\dimen0-\wd2 %
>          \kern\dimen0 %
>        \fi
>      \fi
>      \TeX
>    \endgroup
> }

sure testing for those often non present kerns makes sense and we need a 
bit of stay in hmode code and so and we get our complicated looking logo -)

btw, regular times makes a nice test case

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
      tel: 038 477 53 69 | fax: 038 477 53 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Fri Mar 12 09:32:51 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 12 Mar 2010 09:32:51 +0100
Subject: [luatex] Q: What is a "running" glue dimension in rule node?
Message-ID: <353DDE86-0437-42E3-8ED1-7E9F966F87A0@gundla.ch>

Good morning,

I have this rule in a vbox:

\vrule width 1mm

and this looks like it turns out to a node like this:

rule: width=186467, height=-1073741824, depth=-1073741824

Now looking at the reference manual, it states (8.1.2.3) that the special value "-1073741824" is used for ?running' glue dimensions. What is a running glue dimension? Does that mean that there is no height and depth given in TeX's input?

Patrick




From heiko.oberdiek at googlemail.com  Fri Mar 12 10:10:25 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Fri, 12 Mar 2010 10:10:25 +0100
Subject: [luatex] Q: What is a "running" glue dimension in rule node?
In-Reply-To: <353DDE86-0437-42E3-8ED1-7E9F966F87A0@gundla.ch>
References: <353DDE86-0437-42E3-8ED1-7E9F966F87A0@gundla.ch>
Message-ID: <20100312091025.GA6737@oberdiek.my-fqdn.de>

On Fri, Mar 12, 2010 at 09:32:51AM +0100, Patrick Gundlach wrote:

> \vrule width 1mm
> 
> and this looks like it turns out to a node like this:
> 
> rule: width=186467, height=-1073741824, depth=-1073741824
> 
> Now looking at the reference manual, it states (8.1.2.3) that the special
> value "-1073741824" is used for ?running' glue dimensions. What is a
> running glue dimension? Does that mean that there is no height and depth
> given in TeX's input?

The height and depth will be taken from the surrounding box.

Yours sincerely
  Heiko

From taco at elvenkind.com  Fri Mar 12 15:44:15 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 12 Mar 2010 15:44:15 +0100
Subject: [luatex] Luatex 0.51.0 announcement
Message-ID: <4B9A533F.700@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.51.0.

New features:

* Various small manual improvements.
* The backend message "cannot open Type 1 font file for reading"
   now reports which Type1 font it was looking for.
* Fontforge clears some font names at loading time that will be
   refilled in at font generation time, but the fontloader should not
   do that. Patch from Khaled Hosny.
* New synctex code imported from TeXLive.
* luamd5/md5.h is renamed to luamd5/luamd5.h to avoid confusion.
* Embedded mplib is now 1.209.
* Some experimental tweaking of buildpage_filter, see the manual
   for details.
* Luatex now detects kfreebsd (from Alan Braslau)
* The new lua function tex.sp() converts a string to a number
   representing scaled points.
* There is now support for revision numbers in the banner and stats
   library again.
* The command line help and manual documentation page is extended.
* node.hpack() now also accepts "cal_expand_ratio" and "subst_ex_font"
   modifiers.
* node.hpack() and node.vpack() now give back the badness of the box
   as second return value.
* node.copy_list() now allows a second (stop) argument, this stopper
   is not copied.
* new lua functions in lfs: lfs.readlink() and lfs.shortname().
* new lua function tex.tprint() that can combine multiple catcode
   regime prints in one function call.
* new lua sub-table: tex.nest[] (read/write access to the semantic
   nest state).
* New lua functions in kpse: kpse.lookup() and kpse.version(). See
   the manual for more details.
* New lua function tex.shipout().

Bug fixes:

* There problems in the pdf output for Type3 (pk) fonts.
* Fix a bug that allowed bad commandline quoting.
* Fix a bug that sometimes caused crashes when \pdfprotrudechars.
* The build script now exports CONFIG_SHELL to avoid problems with
   /bin/dash.
* The was a bug in the generated /Image /ProcSet.
* status.font_bytes reported the wrong value.
* Lots of compiler warnings are removed (thanks Javier Mugica).
* Patch to fontloader.info() to accept filenames with embedded
   parentheses.
* Fix a \write error with docstrip package.
* Fixed a crash on AdobeMyungjoStd-Medium.otf.
* Fix coco stack overflows, needed for lpeg.
* \pdfcompresslevel wasn't initialized for early immediate objects.
* Fix for slanted fonts when HZ was on (slant angle was multiplied).
* When concatenating content streams, put a space between them.
* Allow pfb lines to end with \r as well as \n (for msam10.pfb).
* Fix the internal string->scaled point conversion in the lua
   interface.
* Memory leaks in the fontloader removed, thanks to patches from
   Elie Roux.
* Fix a crash caused by the combination of coroutines and font.each().

Removed features:

* Support for Type3 .pgc files (nobody used them).


The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.51.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org


Have fun,
Taco


From zappathustra at free.fr  Tue Mar 16 12:25:28 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 16 Mar 2010 12:25:28 +0100
Subject: [luatex] \pdfthread makes LuaTeX crash.
In-Reply-To: <4B9A533F.700@elvenkind.com>
References: <4B9A533F.700@elvenkind.com>
Message-ID: <4B9F6AA8.6030502@free.fr>

Hello,

I'm having fun with pdfTeX's pdf features, and turning to LuaTeX v0.51, 
there seems to be something wrong. Indeed, \pdfthread makes it crash, 
even in as simple a document as:

\pdfthread name{hello}
\bye

and by "crash" I mean "crash badly" , i.e. a Windows error message 
"LuaTeX has encountered a problem and needs to close, et cetera". This 
does not happen with pdfTeX, naturally.

Something completely different:
Taco mentionned "Some tweaking of buildpage_filter, see the manual for 
details" in the v0.51 announcement, but I can't see any difference 
between the two manuals (0.5 vs. 0.51) on this point (except in the 
typography). Where did I miss something (I've made a simple search on 
"buildpage_filter")?

Best,

Paul


Taco Hoekwater a ?crit :
> Hi,
>
> I have just uploaded the archives for a new luatex release, 0.51.0.
>
> New features:
>
> * Various small manual improvements.
> * The backend message "cannot open Type 1 font file for reading"
>   now reports which Type1 font it was looking for.
> * Fontforge clears some font names at loading time that will be
>   refilled in at font generation time, but the fontloader should not
>   do that. Patch from Khaled Hosny.
> * New synctex code imported from TeXLive.
> * luamd5/md5.h is renamed to luamd5/luamd5.h to avoid confusion.
> * Embedded mplib is now 1.209.
> * Some experimental tweaking of buildpage_filter, see the manual
>   for details.
> * Luatex now detects kfreebsd (from Alan Braslau)
> * The new lua function tex.sp() converts a string to a number
>   representing scaled points.
> * There is now support for revision numbers in the banner and stats
>   library again.
> * The command line help and manual documentation page is extended.
> * node.hpack() now also accepts "cal_expand_ratio" and "subst_ex_font"
>   modifiers.
> * node.hpack() and node.vpack() now give back the badness of the box
>   as second return value.
> * node.copy_list() now allows a second (stop) argument, this stopper
>   is not copied.
> * new lua functions in lfs: lfs.readlink() and lfs.shortname().
> * new lua function tex.tprint() that can combine multiple catcode
>   regime prints in one function call.
> * new lua sub-table: tex.nest[] (read/write access to the semantic
>   nest state).
> * New lua functions in kpse: kpse.lookup() and kpse.version(). See
>   the manual for more details.
> * New lua function tex.shipout().
>
> Bug fixes:
>
> * There problems in the pdf output for Type3 (pk) fonts.
> * Fix a bug that allowed bad commandline quoting.
> * Fix a bug that sometimes caused crashes when \pdfprotrudechars.
> * The build script now exports CONFIG_SHELL to avoid problems with
>   /bin/dash.
> * The was a bug in the generated /Image /ProcSet.
> * status.font_bytes reported the wrong value.
> * Lots of compiler warnings are removed (thanks Javier Mugica).
> * Patch to fontloader.info() to accept filenames with embedded
>   parentheses.
> * Fix a \write error with docstrip package.
> * Fixed a crash on AdobeMyungjoStd-Medium.otf.
> * Fix coco stack overflows, needed for lpeg.
> * \pdfcompresslevel wasn't initialized for early immediate objects.
> * Fix for slanted fonts when HZ was on (slant angle was multiplied).
> * When concatenating content streams, put a space between them.
> * Allow pfb lines to end with \r as well as \n (for msam10.pfb).
> * Fix the internal string->scaled point conversion in the lua
>   interface.
> * Memory leaks in the fontloader removed, thanks to patches from
>   Elie Roux.
> * Fix a crash caused by the combination of coroutines and font.each().
>
> Removed features:
>
> * Support for Type3 .pgc files (nobody used them).
>
>
> The archives can be downloaded from supelec as usual:
>
>         http://foundry.supelec.fr/gf/project/luatex/
>
> You could also check out the sources via anonymous svn:
>
>   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.51.0
>
> Bugs and feature requests can be added to the issue tracker at
>
>        http://tracker.luatex.org
>
>
> Have fun,
> Taco
>


From joelcsalomon at gmail.com  Tue Mar 16 16:31:22 2010
From: joelcsalomon at gmail.com (Joel C. Salomon)
Date: Tue, 16 Mar 2010 11:31:22 -0400
Subject: [luatex] LuaTeX and LuaLaTeX logos
In-Reply-To: <20100309011324.GA23268@khaled-laptop>
References: <eba574421002240454x17cbd118s667e5d1a93980042@mail.gmail.com>
	<4B85238B.7040805@elvenkind.com> <4B95626B.4080302@wxs.nl>
	<19349.39881.355872.391990@zaphod.ms25.net>
	<20100309011324.GA23268@khaled-laptop>
Message-ID: <7871fcf51003160831if721b36vf7793e4eaf1b9174@mail.gmail.com>

On Mon, Mar 8, 2010 at 9:13 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:
> P.S. I do find the mixed casing of TeX or LaTeX more ridiculous, it
> doesn't even have the sense of cleverness or hack the typeset logo has.

How does ??? or L???? look to you?

?Joel


From taco at elvenkind.com  Tue Mar 16 17:02:30 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 17:02:30 +0100
Subject: [luatex] \pdfthread makes LuaTeX crash.
In-Reply-To: <4B9F6AA8.6030502@free.fr>
References: <4B9A533F.700@elvenkind.com> <4B9F6AA8.6030502@free.fr>
Message-ID: <4B9FAB96.4080300@elvenkind.com>

Paul Isambert wrote:
> Hello,
> 
> I'm having fun with pdfTeX's pdf features, and turning to LuaTeX v0.51, 
> there seems to be something wrong. Indeed, \pdfthread makes it crash, 
> even in as simple a document as:
> 
> \pdfthread name{hello}
> \bye
> 
> and by "crash" I mean "crash badly" , i.e. a Windows error message 
> "LuaTeX has encountered a problem and needs to close, et cetera". This 
> does not happen with pdfTeX, naturally.

will get back on this shortly.

> Something completely different:
> Taco mentionned "Some tweaking of buildpage_filter, see the manual for 
> details" in the v0.51 announcement, but I can't see any difference 
> between the two manuals (0.5 vs. 0.51) on this point (except in the 
> typography). Where did I miss something (I've made a simple search on 
> "buildpage_filter")?

That was commit #3417, and the manual was actually updated:

  \NC \ssbf value     \NC \bf explanation                        \NC\NR
  \NC alignment       \NC a (partial) alignment is being added   \NC\NR
  \NC after_output    \NC an output routine has just finished    \NC\NR
+\NC pre_box         \NC pending data is flushed before a
+                        typeset box that will be added         \NC\NR
+\NC pre_adjust      \NC the \type{\vadjust pre} list of the
+                        next box (if any)                      \NC\NR
  \NC box             \NC a typeset box is being added           \NC\NR
+\NC adjust          \NC the \type{\vadjust} list of the
+                        previous box (if any)                  \NC\NR
  \NC new_graf        \NC the beginning of a new paragraph       \NC\NR
  \NC vmode_par       \NC \tex{par} was found in vertical mode   \NC\NR
  \NC hmode_par       \NC \tex{par} was found in horizontal mode \NC\NR

What this comes down to is that buildpage_filter is now called from
within the paragraph breaker more often than before: instead of a
single call with 'box' value per line, there can now be upto four calls:
once for pending material that was present before a line was to be added
(pre_box), once for any \vadjust pre material, the line box itself, and
once for the any \vadjust {} material from the current line box.

Best wishes,
Taco


From taco at elvenkind.com  Tue Mar 16 18:13:33 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 18:13:33 +0100
Subject: [luatex] \pdfthread makes LuaTeX crash.
In-Reply-To: <4B9F6AA8.6030502@free.fr>
References: <4B9A533F.700@elvenkind.com> <4B9F6AA8.6030502@free.fr>
Message-ID: <4B9FBC3D.5020008@elvenkind.com>

Paul Isambert wrote:
> Hello,
> 
> I'm having fun with pdfTeX's pdf features, and turning to LuaTeX v0.51, 
> there seems to be something wrong. Indeed, \pdfthread makes it crash, 
> even in as simple a document as:
> 
> \pdfthread name{hello}
> \bye

Fixed by commit #3511 (reversal of function arguments)

Best wishes,
Taco

From elie.roux at telecom-bretagne.eu  Tue Mar 16 18:16:29 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 16 Mar 2010 19:16:29 +0200
Subject: [luatex] compiling error
Message-ID: <4B9FBCED.30905@telecom-bretagne.eu>

Hello,

trying to compile LuaTeX with latest svn version, I get from build.sh:

checking for icu-config... icu-config
checking requested system `graphite' library... ok
checking requested system `icu' library... ok
configure: error: you can not use system libraries for a native TeX Live 
build

and the compilation stops... what did I do wrong?

Thank you,
-- 
Elie

From taco at elvenkind.com  Tue Mar 16 18:23:28 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 18:23:28 +0100
Subject: [luatex] compiling error
In-Reply-To: <4B9FBCED.30905@telecom-bretagne.eu>
References: <4B9FBCED.30905@telecom-bretagne.eu>
Message-ID: <4B9FBE90.9000008@elvenkind.com>

Elie Roux wrote:
> Hello,
> 
> trying to compile LuaTeX with latest svn version, I get from build.sh:
> 
> checking for icu-config... icu-config
> checking requested system `graphite' library... ok
> checking requested system `icu' library... ok
> configure: error: you can not use system libraries for a native TeX Live 
> build

Did you specify --make ? You need a clean rebuild this time,
there are quite a lot of build system changes.



From elie.roux at telecom-bretagne.eu  Tue Mar 16 19:13:47 2010
From: elie.roux at telecom-bretagne.eu (Elie Roux)
Date: Tue, 16 Mar 2010 20:13:47 +0200
Subject: [luatex] compiling error
In-Reply-To: <4B9FBE90.9000008@elvenkind.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
Message-ID: <4B9FCA5B.4050005@telecom-bretagne.eu>

Taco Hoekwater a ?crit :
> Did you specify --make ? You need a clean rebuild this time,
> there are quite a lot of build system changes.

Specifying --make or not doesn't change anything...
-- 
Elie


From luigi.scarso at gmail.com  Tue Mar 16 19:43:02 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 16 Mar 2010 19:43:02 +0100
Subject: [luatex] compiling error
In-Reply-To: <4B9FBE90.9000008@elvenkind.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
Message-ID: <fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>

On Tue, Mar 16, 2010 at 6:23 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Elie Roux wrote:
>>
>> Hello,
>>
>> trying to compile LuaTeX with latest svn version, I get from build.sh:
>>
>> checking for icu-config... icu-config
>> checking requested system `graphite' library... ok
>> checking requested system `icu' library... ok
>> configure: error: you can not use system libraries for a native TeX Live
>> build
>
> Did you specify --make ? You need a clean rebuild this time,
> there are quite a lot of build system changes.
>
>
>
Error here too with 3512

make[1]: ingresso nella directory ?/opt/luatex/svn/trunk/build/utils?
Making all in dummy
/bin/bash: line 17: cd: dummy: Nessun file o directory
make[1]: *** [all-recursive] Errore 1
make[1]: uscita dalla directory ?/opt/luatex/svn/trunk/build/utils?
make: *** [all-recursive] Errore 1
strip: 'build/texk/web2c/luatex': No such file
ls: impossibile accedere a build/texk/web2c/luatex: Nessun file o directory

-- 
luigi


From taco at elvenkind.com  Tue Mar 16 19:47:16 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 19:47:16 +0100
Subject: [luatex] compiling error
In-Reply-To: <fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>	<4B9FBE90.9000008@elvenkind.com>
	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
Message-ID: <4B9FD234.7010606@elvenkind.com>

luigi scarso wrote:
> On Tue, Mar 16, 2010 at 6:23 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>> Elie Roux wrote:
>>> Hello,
>>>
>>> trying to compile LuaTeX with latest svn version, I get from build.sh:
>>>
>>> checking for icu-config... icu-config
>>> checking requested system `graphite' library... ok
>>> checking requested system `icu' library... ok
>>> configure: error: you can not use system libraries for a native TeX Live
>>> build
>> Did you specify --make ? You need a clean rebuild this time,
>> there are quite a lot of build system changes.
>>
>>
>>
> Error here too with 3512

Give me a few hours, ok? ;)


From arthur.reutenauer at normalesup.org  Tue Mar 16 19:47:52 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 16 Mar 2010 19:47:52 +0100
Subject: [luatex] compiling error
In-Reply-To: <fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
Message-ID: <20100316184752.GB3800@phare.normalesup.org>

> /bin/bash: line 17: cd: dummy: Nessun file o directory

  I just love that error message!  Do you really use "file" and "directory"
literaly in Italian?

  By the way, I have the same error, but in English ;-)  So thanks for the
report.

	Arthur

From luigi.scarso at gmail.com  Tue Mar 16 19:52:58 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 16 Mar 2010 19:52:58 +0100
Subject: [luatex] compiling error
In-Reply-To: <4B9FD234.7010606@elvenkind.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
	<4B9FD234.7010606@elvenkind.com>
Message-ID: <fe8d59da1003161152j29ae6240t24dd284ba2509adf@mail.gmail.com>

>> Error here too with 3512
>
> Give me a few hours, ok? ;)
no problem



-- 
luigi

From taco at elvenkind.com  Tue Mar 16 20:08:28 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 20:08:28 +0100
Subject: [luatex] compiling error
In-Reply-To: <fe8d59da1003161152j29ae6240t24dd284ba2509adf@mail.gmail.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>	<4B9FBE90.9000008@elvenkind.com>	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>	<4B9FD234.7010606@elvenkind.com>
	<fe8d59da1003161152j29ae6240t24dd284ba2509adf@mail.gmail.com>
Message-ID: <4B9FD72C.4080203@elvenkind.com>

luigi scarso wrote:
>>> Error here too with 3512
>> Give me a few hours, ok? ;)
> no problem

#3514 compiles nicely for me, can you guys please give that a try?

you cannot use --make, and you need a clean tree.

Best wishes,
Taco

From luigi.scarso at gmail.com  Tue Mar 16 20:08:36 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 16 Mar 2010 20:08:36 +0100
Subject: [luatex] compiling error
In-Reply-To: <20100316184752.GB3800@phare.normalesup.org>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
	<20100316184752.GB3800@phare.normalesup.org>
Message-ID: <fe8d59da1003161208q550481d9i26ade161656401c0@mail.gmail.com>

On Tue, Mar 16, 2010 at 7:47 PM, Arthur Reutenauer
<arthur.reutenauer at normalesup.org> wrote:
>> /bin/bash: line 17: cd: dummy: Nessun file o directory
>
> ?I just love that error message! ?Do you really use "file" and "directory"
> literaly in Italian?
Yes and usually only in singular form, ie "un file, due file" and so on
ie we drop the -s in files because we have not t so many words that end in -s .
Also "una directory, due directory " (-ies in directories is really
too much for us)

Maybe you want to see
http://www.accademiadellacrusca.it

-- 
luigi


From luigi.scarso at gmail.com  Tue Mar 16 20:20:54 2010
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 16 Mar 2010 20:20:54 +0100
Subject: [luatex] compiling error
In-Reply-To: <4B9FD72C.4080203@elvenkind.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>
	<4B9FBE90.9000008@elvenkind.com>
	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>
	<4B9FD234.7010606@elvenkind.com>
	<fe8d59da1003161152j29ae6240t24dd284ba2509adf@mail.gmail.com>
	<4B9FD72C.4080203@elvenkind.com>
Message-ID: <fe8d59da1003161220j59d6e46dncd35cbf2702071e4@mail.gmail.com>

On Tue, Mar 16, 2010 at 8:08 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> luigi scarso wrote:
>>>>
>>>> Error here too with 3512
>>>
>>> Give me a few hours, ok? ;)
>>
>> no problem
>
> #3514 compiles nicely for me, can you guys please give that a try?
>
> you cannot use --make, and you need a clean tree.
>
> Best wishes,
> Taco
>

This is LuaTeX, Version beta-0.52.0-2010031620 (rev 3515)
**


-- 
luigi

From taco at elvenkind.com  Tue Mar 16 20:40:34 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 20:40:34 +0100
Subject: [luatex] compiling error
In-Reply-To: <fe8d59da1003161220j59d6e46dncd35cbf2702071e4@mail.gmail.com>
References: <4B9FBCED.30905@telecom-bretagne.eu>	<4B9FBE90.9000008@elvenkind.com>	<fe8d59da1003161143nf6a9c79laeeed244baca6a59@mail.gmail.com>	<4B9FD234.7010606@elvenkind.com>	<fe8d59da1003161152j29ae6240t24dd284ba2509adf@mail.gmail.com>	<4B9FD72C.4080203@elvenkind.com>
	<fe8d59da1003161220j59d6e46dncd35cbf2702071e4@mail.gmail.com>
Message-ID: <4B9FDEB2.3040601@elvenkind.com>

luigi scarso wrote:
> On Tue, Mar 16, 2010 at 8:08 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>> luigi scarso wrote:
>>>>> Error here too with 3512
>>>> Give me a few hours, ok? ;)
>>> no problem
>> #3514 compiles nicely for me, can you guys please give that a try?
>>
>> you cannot use --make, and you need a clean tree.
>>
>> Best wishes,
>> Taco
>>
> 
> This is LuaTeX, Version beta-0.52.0-2010031620 (rev 3515)
> **

Good! time for a new beta ...

Best wishes,
Taco

From taco at elvenkind.com  Tue Mar 16 21:01:56 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 21:01:56 +0100
Subject: [luatex] Luatex 0.52.0 announcement
Message-ID: <4B9FE3B4.106@elvenkind.com>

Hi,

I have just uploaded the archives for a new luatex release, 0.52.0.

New features:

* Various small manual improvements.

* A better version of getluatexsvnversion.sh, from Tomek.

* node.copy_list() now allows the second (optional) argument to
   be nil.

* An import of the current state of the texlive repository
   (kpathsea and build system).

Bug fixes:

* An attempt fix for bug #345 (math kerning is not perfect): when the
   current math font is a new math font, check against \catcode <cur_c>
   == 11 to suppress the italic correction, instead of looking at
   the value of space(<cur_f>).

* There is a new <tfmtable> key: 'units_per_em' (defaults to 0).
   This is part of a fix for bug #200 (Problem with CFF fonts having
   em-size other than 1000): there is a special correction to the
   embedded cff font itself and the font scale if the font to be output
   is opentype or type1 in unicode encoding and the 'units_per_em
   differs' from zero.
   <tfmtable>.units_per_em has to be passed back to luatex from
   the lua font loading code for this to work.

* A fix for bug #314 (problem with pk file).

* lua code can no longer change the internal preallocated glue_spec
   nodes (as that resulted in weird spacing bugs). For this, glue_specs
   now have a new field: 'writable'. If that field is false, a copy
   has to be made of the glue_spec instead of doing an assignment
   to it.

* Setting of \textdir inside the output routine could trash output
   on following pages due to a lingering internal variable.

* \pdfthread crashed because the arguments were handled in reverse
   order.

The archives can be downloaded from supelec as usual:

         http://foundry.supelec.fr/gf/project/luatex/

You could also check out the sources via anonymous svn:

   svn co http://foundry.supelec.fr/svn/luatex/tags/beta-0.52.0

Bugs and feature requests can be added to the issue tracker at

        http://tracker.luatex.org


Have fun,
Taco


From t34www at googlemail.com  Tue Mar 16 21:26:28 2010
From: t34www at googlemail.com (T T)
Date: Tue, 16 Mar 2010 20:26:28 +0000
Subject: [luatex] configure error on mingw
Message-ID: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>

Rev. 3517 doesn't compile on mingw:

...
checking whether ln -s works... no, using cp -p
configure: error: You could use `--without-ln-s' to build without
working `ln -s'

but how can I pass this option? The following doesn't work:

>sh build.sh --without-ln-s
Your make is a GNU-make; I will use that
ERROR: invalid build.sh parameter: --without-ln-s

Cheers,

Tomek

From taco at elvenkind.com  Tue Mar 16 22:52:23 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 16 Mar 2010 22:52:23 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
Message-ID: <4B9FFD97.6070908@elvenkind.com>

T T wrote:
> Rev. 3517 doesn't compile on mingw:
> 
> ...
> checking whether ln -s works... no, using cp -p
> configure: error: You could use `--without-ln-s' to build without
> working `ln -s'

> but how can I pass this option? The following doesn't work:
> 
>> sh build.sh --without-ln-s
> Your make is a GNU-make; I will use that
> ERROR: invalid build.sh parameter: --without-ln-s

Just patch your local build.sh for now, there are many --without-xxx
lines in there. Then we can work out a better solution later.

But the error is a bit odd considering that it has found a
workable alternative. Peter?

Best wishes,
Taco

From t34www at googlemail.com  Tue Mar 16 23:07:39 2010
From: t34www at googlemail.com (T T)
Date: Tue, 16 Mar 2010 22:07:39 +0000
Subject: [luatex] configure error on mingw
In-Reply-To: <4B9FFD97.6070908@elvenkind.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com>
Message-ID: <e7fba2611003161507g6eb14a80rd7a59d84b3b62122@mail.gmail.com>

On 16 March 2010 21:52, Taco Hoekwater <taco at elvenkind.com> wrote:
> T T wrote:
>>
>> Rev. 3517 doesn't compile on mingw:
>>
>> ...
>> checking whether ln -s works... no, using cp -p
>> configure: error: You could use `--without-ln-s' to build without
>> working `ln -s'
>
>> but how can I pass this option? The following doesn't work:
>>
>>> sh build.sh --without-ln-s
>>
>> Your make is a GNU-make; I will use that
>> ERROR: invalid build.sh parameter: --without-ln-s
>
> Just patch your local build.sh for now, there are many --without-xxx
> lines in there. Then we can work out a better solution later.
>
> But the error is a bit odd considering that it has found a
> workable alternative. Peter?

The patch at the end almost worked for me. The configure failed at the end with

  build.sh: go: command not found

or something like that, but restarting `sh build.sh --make' finally
produced the binaries.

Cheers,

Tomek

Index: build.sh
===================================================================
--- build.sh	(revision 3517)
+++ build.sh	(working copy)
@@ -58,13 +58,13 @@
 STRIP=strip
 LUATEXEXE=luatex

+B=build
+CONFHOST=
+
 case `uname` in
-  MINGW32*    ) LUATEXEXE=luatex.exe ;;
+  MINGW32*    ) LUATEXEXE=luatex.exe; CONFHOST=--without-ln-s ;;
 esac

-B=build
-CONFHOST=
-
 if [ "$MINGWCROSS" = "TRUE" ]
 then
   B=build-windows

From indiego at gmx.net  Wed Mar 17 00:01:26 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 00:01:26 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <4B9FFD97.6070908@elvenkind.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com>
Message-ID: <4BA00DC6.4030705@gmx.net>

Am 16.03.2010 22:52, schrieb Taco Hoekwater:
> T T wrote:
>> Rev. 3517 doesn't compile on mingw:
>>
>> ...
>> checking whether ln -s works... no, using cp -p
>> configure: error: You could use `--without-ln-s' to build without
>> working `ln -s'
> 
>> but how can I pass this option? The following doesn't work:
>>
>>> sh build.sh --without-ln-s
>> Your make is a GNU-make; I will use that
>> ERROR: invalid build.sh parameter: --without-ln-s
> 
> Just patch your local build.sh for now, there are many --without-xxx
> lines in there. Then we can work out a better solution later.
> 
> But the error is a bit odd considering that it has found a
> workable alternative. Peter?
> 
sorry for the delay. i was just watching 'the men you stare at goats'. :)

same little hiccups here. just run a single 'make' without additional
arguments and you should get a clean luatex binary.

best wishes

Peter

From indiego at gmx.net  Wed Mar 17 00:08:23 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 00:08:23 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <4BA00DC6.4030705@gmx.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>
Message-ID: <4BA00F67.3070902@gmx.net>

Am 17.03.2010 00:01, schrieb Peter Rolf:
> Am 16.03.2010 22:52, schrieb Taco Hoekwater:
>> T T wrote:
>>> Rev. 3517 doesn't compile on mingw:
>>>
>>> ...
>>> checking whether ln -s works... no, using cp -p
>>> configure: error: You could use `--without-ln-s' to build without
>>> working `ln -s'
>>
>>> but how can I pass this option? The following doesn't work:
>>>
>>>> sh build.sh --without-ln-s
>>> Your make is a GNU-make; I will use that
>>> ERROR: invalid build.sh parameter: --without-ln-s
>>
>> Just patch your local build.sh for now, there are many --without-xxx
>> lines in there. Then we can work out a better solution later.
>>
>> But the error is a bit odd considering that it has found a
>> workable alternative. Peter?
>>
> sorry for the delay. i was just watching 'the men you stare at goats'. :)
> 
> same little hiccups here. just run a single 'make' without additional
> arguments and you should get a clean luatex binary.

oeps, i meant './build.sh'

> 
> best wishes
> 
> Peter
> 


From t34www at googlemail.com  Wed Mar 17 00:29:33 2010
From: t34www at googlemail.com (T T)
Date: Tue, 16 Mar 2010 23:29:33 +0000
Subject: [luatex] configure error on mingw
In-Reply-To: <4BA00F67.3070902@gmx.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com> <4BA00DC6.4030705@gmx.net>
	<4BA00F67.3070902@gmx.net>
Message-ID: <e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>

On 16 March 2010 23:08, Peter Rolf <indiego at gmx.net> wrote:
>>
>> same little hiccups here. just run a single 'make' without additional
>> arguments and you should get a clean luatex binary.
>
> oeps, i meant './build.sh'

Nope, it doesn't work unless I patch in the --without-ln-s. I tried
'./build.sh' twice in a row to make sure. It failed the same way both
times.

Cheers,

Tomek

PS. Unrelated question: is it possible to build with --enable-shared on mingw?

From indiego at gmx.net  Wed Mar 17 10:55:58 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 10:55:58 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
Message-ID: <4BA0A72E.8060801@gmx.net>

Am 17.03.2010 00:29, schrieb T T:
> On 16 March 2010 23:08, Peter Rolf <indiego at gmx.net> wrote:
>>>
>>> same little hiccups here. just run a single 'make' without additional
>>> arguments and you should get a clean luatex binary.
>>
>> oeps, i meant './build.sh'
> 
> Nope, it doesn't work unless I patch in the --without-ln-s. I tried
> './build.sh' twice in a row to make sure. It failed the same way both
> times.
> 
mh, i got a working version here after a single './build.sh'.

this is the content of my 'installed.ini' in the mingw directory. OS is
vista64. do you see any differences?


[settings]
mirror=
installtype=current

[components]
runtime=mingwrt-3.17-mingw32-dev.tar.gz
w32api=w32api-3.14-mingw32-dev.tar.gz
binutils=binutils-2.20-1-mingw32-bin.tar.gz
core=gcc-core-3.4.5-20060117-3.tar.gz
gpp=gcc-g++-3.4.5-20060117-3.tar.gz
g77=
ada=
java=
objc=gcc-objc-3.4.5-20060117-3.tar.gz
make=
runtimeDLL=mingwrt-3.17-mingw32-dll.tar.gz



> Cheers,
> 
> Tomek
> 
> PS. Unrelated question: is it possible to build with --enable-shared on mingw?
> 

i donno. but knowing that option makes you an 'expert', so give it a try ;)


best (compilation) wishes

Peter

From taco at elvenkind.com  Wed Mar 17 11:05:20 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 17 Mar 2010 11:05:20 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
Message-ID: <4BA0A960.2040100@elvenkind.com>



T T wrote:
> 
> PS. Unrelated question: is it possible to build with --enable-shared on mingw?

Probably not. Last time I checked, libtool did not understand mingw's
dll creation. But you could try, of course.

Best wishes,
Taco

From t34www at googlemail.com  Wed Mar 17 12:45:16 2010
From: t34www at googlemail.com (T T)
Date: Wed, 17 Mar 2010 11:45:16 +0000
Subject: [luatex] configure error on mingw
In-Reply-To: <4BA0A72E.8060801@gmx.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com> <4BA00DC6.4030705@gmx.net>
	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
	<4BA0A72E.8060801@gmx.net>
Message-ID: <e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>

On 17 March 2010 09:55, Peter Rolf <indiego at gmx.net> wrote:
> Am 17.03.2010 00:29, schrieb T T:
>> On 16 March 2010 23:08, Peter Rolf <indiego at gmx.net> wrote:
>>>>
>>>> same little hiccups here. just run a single 'make' without additional
>>>> arguments and you should get a clean luatex binary.
>>>
>>> oeps, i meant './build.sh'
>>
>> Nope, it doesn't work unless I patch in the --without-ln-s. I tried
>> './build.sh' twice in a row to make sure. It failed the same way both
>> times.
>>
> mh, i got a working version here after a single './build.sh'.
>
> this is the content of my 'installed.ini' in the mingw directory. OS is
> vista64. do you see any differences?

I hand crafted my MSYS install (by unpacking various *.tar.gz files)
and don't remember any more which versions I have atm. I will try to
update it and see if it helps.

>>
>> PS. Unrelated question: is it possible to build with --enable-shared on mingw?
>>
>
> i donno. but knowing that option makes you an 'expert', so give it a try ;)

I tried and:

configure: error: you can not use a shared Kpathsea library for a
native TeX Live build

??

Cheers,

Tomek

From t34www at googlemail.com  Wed Mar 17 13:44:33 2010
From: t34www at googlemail.com (T T)
Date: Wed, 17 Mar 2010 12:44:33 +0000
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com> <4BA00DC6.4030705@gmx.net>
	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
	<4BA0A72E.8060801@gmx.net>
	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
Message-ID: <e7fba2611003170544r30256edcm2920624094d0bf3@mail.gmail.com>

On 17 March 2010 11:45, T T <t34www at googlemail.com> wrote:
> On 17 March 2010 09:55, Peter Rolf <indiego at gmx.net> wrote:
>> Am 17.03.2010 00:29, schrieb T T:
>>>
>>> PS. Unrelated question: is it possible to build with --enable-shared on mingw?
>>>
>>
>> i donno. but knowing that option makes you an 'expert', so give it a try ;)
>
> I tried and:
>
> configure: error: you can not use a shared Kpathsea library for a
> native TeX Live build

Adding --disable-native-texlive-build produced the luatex binary
(15KB) but no dlls. The binary seems to work but it calls another one
(build\texk\web2c\.libs\luatex.exe), which appears to be a static
build. Hmm, I think I will leave that to real experts then ;)

Cheers,

Tomek

From indiego at gmx.net  Wed Mar 17 13:45:09 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 13:45:09 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>	<4BA00F67.3070902@gmx.net>	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>	<4BA0A72E.8060801@gmx.net>
	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
Message-ID: <4BA0CED5.5060804@gmx.net>

Am 17.03.2010 12:45, schrieb T T:
> On 17 March 2010 09:55, Peter Rolf <indiego at gmx.net> wrote:
>> Am 17.03.2010 00:29, schrieb T T:
>>> On 16 March 2010 23:08, Peter Rolf <indiego at gmx.net> wrote:
>>>>>
>>>>> same little hiccups here. just run a single 'make' without additional
>>>>> arguments and you should get a clean luatex binary.
>>>>
>>>> oeps, i meant './build.sh'
>>>
>>> Nope, it doesn't work unless I patch in the --without-ln-s. I tried
>>> './build.sh' twice in a row to make sure. It failed the same way both
>>> times.
>>>
>> mh, i got a working version here after a single './build.sh'.
>>
>> this is the content of my 'installed.ini' in the mingw directory. OS is
>> vista64. do you see any differences?
> 
> I hand crafted my MSYS install (by unpacking various *.tar.gz files)
> and don't remember any more which versions I have atm. I will try to
> update it and see if it helps.
>
mingw now comes with a simple installer. just download 'MinGW-5.1.6.exe'
and start it. then select the packages to install (see my
'installed.ini' file).

[mingw-installer on top]
http://sourceforge.net/projects/mingw/files/

i still use msys 1.0.11 here. a newer version can be found in the file
section of the upper link (but looks like sources only).
anyhow, installation should be no problem for you.

best wishes

Peter

>>>
>>> PS. Unrelated question: is it possible to build with --enable-shared on mingw?
>>>
>>
>> i donno. but knowing that option makes you an 'expert', so give it a try ;)
> 
> I tried and:
> 
> configure: error: you can not use a shared Kpathsea library for a
> native TeX Live build
> 
> ??
>
> Cheers,
> 
> Tomek
> 


From t34www at googlemail.com  Wed Mar 17 14:41:36 2010
From: t34www at googlemail.com (T T)
Date: Wed, 17 Mar 2010 13:41:36 +0000
Subject: [luatex] configure error on mingw
In-Reply-To: <4BA0CED5.5060804@gmx.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com> <4BA00DC6.4030705@gmx.net>
	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
	<4BA0A72E.8060801@gmx.net>
	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
	<4BA0CED5.5060804@gmx.net>
Message-ID: <e7fba2611003170641wb9bc83braa288de62c363653@mail.gmail.com>

On 17 March 2010 12:45, Peter Rolf <indiego at gmx.net> wrote:
> mingw now comes with a simple installer. just download 'MinGW-5.1.6.exe'

Yes, I know, but I don't understand what it does. It puts some stuff
in the registry, changes path, etc. and that bothers me. I want to use
msys from usb stick, so I do it myself :)

Cheers,

Tomek

From indiego at gmx.net  Wed Mar 17 16:06:21 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 16:06:21 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <e7fba2611003170641wb9bc83braa288de62c363653@mail.gmail.com>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>	<4BA00F67.3070902@gmx.net>	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>	<4BA0A72E.8060801@gmx.net>	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>	<4BA0CED5.5060804@gmx.net>
	<e7fba2611003170641wb9bc83braa288de62c363653@mail.gmail.com>
Message-ID: <4BA0EFED.5030002@gmx.net>

Am 17.03.2010 14:41, schrieb T T:
> On 17 March 2010 12:45, Peter Rolf <indiego at gmx.net> wrote:
>> mingw now comes with a simple installer. just download 'MinGW-5.1.6.exe'
> 
> Yes, I know, but I don't understand what it does. It puts some stuff
> in the registry, changes path, etc. and that bothers me. I want to use
> msys from usb stick, so I do it myself :)
>
it's more convenient this way, because the mingw installer also updates
the packages (only when called). the msys package itself has no
installer (it's not in the software list).
also: you use a microsoft os and have security concerns about open
source software? :D

but we are getting off-topic with this...

Peter


From reinhard.kotucha at web.de  Wed Mar 17 19:08:53 2010
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 17 Mar 2010 19:08:53 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <4BA0EFED.5030002@gmx.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>
	<4B9FFD97.6070908@elvenkind.com> <4BA00DC6.4030705@gmx.net>
	<4BA00F67.3070902@gmx.net>
	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>
	<4BA0A72E.8060801@gmx.net>
	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>
	<4BA0CED5.5060804@gmx.net>
	<e7fba2611003170641wb9bc83braa288de62c363653@mail.gmail.com>
	<4BA0EFED.5030002@gmx.net>
Message-ID: <19361.6837.731685.757611@zaphod.ms25.net>

On 17 March 2010 Peter Rolf wrote:

 > Am 17.03.2010 14:41, schrieb T T:
 > > On 17 March 2010 12:45, Peter Rolf <indiego at gmx.net> wrote:
 > >> mingw now comes with a simple installer. just download 'MinGW-5.1.6.exe'
 > > 
 > > Yes, I know, but I don't understand what it does. It puts some stuff
 > > in the registry, changes path, etc. and that bothers me. I want to use
 > > msys from usb stick, so I do it myself :)
 > >
 > it's more convenient this way, because the mingw installer also
 > updates the packages (only when called). the msys package itself
 > has no installer (it's not in the software list).  also: you use a
 > microsoft os and have security concerns about open source software?
 > :D

But the installer writes stuff to the registry without any good
reason.  It's useless if you want to run the software from a USB
stick.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha			              Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover	                      mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From indiego at gmx.net  Wed Mar 17 21:10:41 2010
From: indiego at gmx.net (Peter Rolf)
Date: Wed, 17 Mar 2010 21:10:41 +0100
Subject: [luatex] configure error on mingw
In-Reply-To: <19361.6837.731685.757611@zaphod.ms25.net>
References: <e7fba2611003161326t3d7b8c84od70852a029de6481@mail.gmail.com>	<4B9FFD97.6070908@elvenkind.com>
	<4BA00DC6.4030705@gmx.net>	<4BA00F67.3070902@gmx.net>	<e7fba2611003161629p1a265b9fud6c2c92dba512235@mail.gmail.com>	<4BA0A72E.8060801@gmx.net>	<e7fba2611003170445q4147556cja4fd0d1dd8f3ed85@mail.gmail.com>	<4BA0CED5.5060804@gmx.net>	<e7fba2611003170641wb9bc83braa288de62c363653@mail.gmail.com>	<4BA0EFED.5030002@gmx.net>
	<19361.6837.731685.757611@zaphod.ms25.net>
Message-ID: <4BA13741.1090505@gmx.net>

Am 17.03.2010 19:08, schrieb Reinhard Kotucha:
> On 17 March 2010 Peter Rolf wrote:
> 
>  > Am 17.03.2010 14:41, schrieb T T:
>  > > On 17 March 2010 12:45, Peter Rolf <indiego at gmx.net> wrote:
>  > >> mingw now comes with a simple installer. just download 'MinGW-5.1.6.exe'
>  > > 
>  > > Yes, I know, but I don't understand what it does. It puts some stuff
>  > > in the registry, changes path, etc. and that bothers me. I want to use
>  > > msys from usb stick, so I do it myself :)
>  > >
>  > it's more convenient this way, because the mingw installer also
>  > updates the packages (only when called). the msys package itself
>  > has no installer (it's not in the software list).  also: you use a
>  > microsoft os and have security concerns about open source software?
>  > :D
> 
> But the installer writes stuff to the registry without any good
> reason.  It's useless if you want to run the software from a USB
> stick.
>
ah, i got the point.

[reminder for myself]
keep your mouth shut when the discussion comes to portable apps. :)

best wishes,

Peter

From eythanweg at gmail.com  Fri Mar 19 14:26:20 2010
From: eythanweg at gmail.com (Eythan Weg)
Date: Fri, 19 Mar 2010 09:26:20 -0400
Subject: [luatex] Luatex 0.52.0 announcement
In-Reply-To: <4B9FE3B4.106@elvenkind.com> (Taco Hoekwater's message of "Tue,
	16 Mar 2010 21:01:56 +0100")
References: <4B9FE3B4.106@elvenkind.com>
Message-ID: <87sk7w8mtf.fsf@gmail.com>

Hi,

I fail to compile 0.52.0 (0.51.0 is ok): 
  
  Making all in web2c
  make[5]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  sed -e 's,web2c/c-auto,kpathsea/c-auto,' ../../../../source/texk/web2c/web2c/../config.h >native/config.h
  make  all-am
  make[6]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  make[7]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  make[7]: `../../../../source/texk/web2c/web2c/web2c-parser.c' is up to date.
  make[7]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  gcc -DHAVE_CONFIG_H -I. -I../../../../source/texk/web2c/web2c -I./native/kpathsea -Inative -I../../../../source/texk/web2c/web2c/native -I../../../../source/texk/web2c/web2c/.. -I../../../../source/texk/web2c/web2c/../..   -Wimplicit -Wreturn-type -Wdeclaration-after-statement -Wno-unknown-pragmas -g -O2 -MT web2c-parser.o -MD -MP -MF .deps/web2c-parser.Tpo -c -o web2c-parser.o ../../../../source/texk/web2c/web2c/web2c-parser.c
  mv -f .deps/web2c-parser.Tpo .deps/web2c-parser.Po
  test -f web2c-lexer.c || /bin/bash ../../../../source/texk/web2c/web2c/../../../build-aux/ylwrap ../../../../source/texk/web2c/web2c/web2c-lexer.l .c web2c-lexer.c -- :
  make[6]: *** [web2c-lexer.c] Error 1
  make[6]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  make[5]: *** [all] Error 2
  make[5]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
  make[4]: *** [all-recursive] Error 1
  make[4]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c'
  make[3]: *** [all] Error 2
  make[3]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c'
  make[2]: *** [subtexk] Error 1
  make[2]: Leaving directory `/home/weg/beta-0.52.0/build/texk'
  make[1]: *** [all-recursive] Error 1
  make[1]: Leaving directory `/home/weg/beta-0.52.0/build/texk'
  make: *** [all-recursive] Error 1
  strip: 'build/texk/web2c/luatex': No such file
  ls: cannot access build/texk/web2c/luatex: No such file or directory

Any help?

Thanks, 
Eythan 

From taco at elvenkind.com  Fri Mar 19 14:51:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 19 Mar 2010 14:51:37 +0100
Subject: [luatex] Luatex 0.52.0 announcement
In-Reply-To: <87sk7w8mtf.fsf@gmail.com>
References: <4B9FE3B4.106@elvenkind.com> <87sk7w8mtf.fsf@gmail.com>
Message-ID: <4BA38169.2050404@elvenkind.com>

Eythan Weg wrote:
> Hi,
> 
> I fail to compile 0.52.0 (0.51.0 is ok): 
>   
>   Making all in web2c
>   make[5]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
>   sed -e 's,web2c/c-auto,kpathsea/c-auto,' ../../../../source/texk/web2c/web2c/../config.h >native/config.h
>   make  all-am
>   make[6]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
>   make[7]: Entering directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
>   make[7]: `../../../../source/texk/web2c/web2c/web2c-parser.c' is up to date.
>   make[7]: Leaving directory `/home/weg/beta-0.52.0/build/texk/web2c/web2c'
>   gcc -DHAVE_CONFIG_H -I. -I../../../../source/texk/web2c/web2c -I./native/kpathsea -Inative -I../../../../source/texk/web2c/web2c/native -I../../../../source/texk/web2c/web2c/.. -I../../../../source/texk/web2c/web2c/../..   -Wimplicit -Wreturn-type -Wdeclaration-after-statement -Wno-unknown-pragmas -g -O2 -MT web2c-parser.o -MD -MP -MF .deps/web2c-parser.Tpo -c -o web2c-parser.o ../../../../source/texk/web2c/web2c/web2c-parser.c
>   mv -f .deps/web2c-parser.Tpo .deps/web2c-parser.Po
>   test -f web2c-lexer.c || /bin/bash ../../../../source/texk/web2c/web2c/../../../build-aux/ylwrap ../../../../source/texk/web2c/web2c/web2c-lexer.l .c web2c-lexer.c -- :

Please check whether source/texk/web2c/web2c/web2c-lexer.c exists
(it should, and probably does). It also should not be older than
web2c-lexer.l in that same directory, and that is probably what goes
wrong: because it is older, make tries to create it anew, but you
don't have flex installed so the regeneration fails.

Quick fix:

   $ touch web2c-lexer.c



Best wishes,
Taco

From eythanweg at gmail.com  Fri Mar 19 16:46:29 2010
From: eythanweg at gmail.com (Eythan Weg)
Date: Fri, 19 Mar 2010 11:46:29 -0400
Subject: [luatex] Luatex 0.52.0 announcement
In-Reply-To: <4BA38169.2050404@elvenkind.com> (Taco Hoekwater's message of
	"Fri, 19 Mar 2010 14:51:37 +0100")
References: <4B9FE3B4.106@elvenkind.com> <87sk7w8mtf.fsf@gmail.com>
	<4BA38169.2050404@elvenkind.com>
Message-ID: <87iq8s8gbu.fsf@gmail.com>


Taco Hoekwater <taco at elvenkind.com>
Fri, 19 Mar 2010 14:51:37 +0100

  .......
  
   Please check whether source/texk/web2c/web2c/web2c-lexer.c exists
   (it should, and probably does). It also should not be older than
   web2c-lexer.l in that same directory, and that is probably what goes
   wrong: because it is older, make tries to create it anew, but you
   don't have flex installed so the regeneration fails.
   
   Quick fix:
   
     $ touch web2c-lexer.c
   
   
   
   Best wishes,
   Taco

I installed flex on my  system and it worked.  

Perhaps I should set "use-commit-times = yes" in my configuration for
subversion.

Thank you.

Eythan 

From trebestie at gmail.com  Sat Mar 20 08:59:21 2010
From: trebestie at gmail.com (Diego Depaoli)
Date: Sat, 20 Mar 2010 08:59:21 +0100
Subject: [luatex] Luatex 0.52.0 announcement
In-Reply-To: <4B9FE3B4.106@elvenkind.com>
References: <4B9FE3B4.106@elvenkind.com>
Message-ID: <83e5fb981003200059m5c323657jd50c54f8024eccc3@mail.gmail.com>

2010/3/16 Taco Hoekwater <taco at elvenkind.com>:
> Hi,
>
> I have just uploaded the archives for a new luatex release, 0.52.0.

Sorry Taco for bothering you again.
On my FreeBSD box, configure fails here

if test -z "`${MAKE-make} -v 2>/dev/null | grep GNU`"; then
  if test "x$enable_native_texlive_build" = xno; then
    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Building TeX
Live may require GNU make" >&5
$as_echo "$as_me: WARNING: Building TeX Live may require GNU make" >&2;}
  else
    as_fn_error "Building TeX Live requires GNU make" "$LINENO" 5
  fi
fi

since ${MAKE-make} is set to make instead of gmake which (co)exists in
my system.
At this moment I've no time to find a better workaround than to skip this test.

Regards

-- 
Diego Depaoli

From patrick at gundla.ch  Sun Mar 21 15:32:39 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 15:32:39 +0100
Subject: [luatex] Duplicate images in pdf
Message-ID: <F786B36A-1C53-4023-8F93-619F01EED202@gundla.ch>

Hi,

when I write this code:

local n1,n2
n1 = img.node { filename = "hacker.jpg" }
node.write(n1)
n2 = img.node { filename = "hacker.jpg" }
node.write(n2)

the file hacker.jpg will be inserted twice in the pdf. I guess no duplicate prevention is done on purpose, right?

Patrick



From hartmut_henkel at gmx.de  Sun Mar 21 15:43:48 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 21 Mar 2010 15:43:48 +0100 (CET)
Subject: [luatex] Duplicate images in pdf
In-Reply-To: <F786B36A-1C53-4023-8F93-619F01EED202@gundla.ch>
References: <F786B36A-1C53-4023-8F93-619F01EED202@gundla.ch>
Message-ID: <alpine.DEB.1.00.1003211541180.31998@hahepc1.hahe>

On Sun, 21 Mar 2010, Patrick Gundlach wrote:

> when I write this code:
>
> local n1,n2
> n1 = img.node { filename = "hacker.jpg" }
> node.write(n1)
> n2 = img.node { filename = "hacker.jpg" }
> node.write(n2)
>
> the file hacker.jpg will be inserted twice in the pdf. I guess no
> duplicate prevention is done on purpose, right?

yes, by tradition (same as pdftex). This should work (can't test right
now):

local n1,n2
local a = img.scan{ filename = "hacker.jpg" }
n1 = img.node { a }
node.write(n1)
n2 = img.node { a }
node.write(n2)

Regards, Hartmut

From patrick at gundla.ch  Sun Mar 21 17:21:23 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 17:21:23 +0100
Subject: [luatex] Duplicate images in pdf
In-Reply-To: <alpine.DEB.1.00.1003211541180.31998@hahepc1.hahe>
References: <F786B36A-1C53-4023-8F93-619F01EED202@gundla.ch>
	<alpine.DEB.1.00.1003211541180.31998@hahepc1.hahe>
Message-ID: <B97F4F30-0B1E-4816-B3F6-B726D119EFEF@gundla.ch>

Hello Hartmut,

> yes, by tradition (same as pdftex). This should work (can't test right
> now):

it does.

Thanks for your answer.

Patrick


From patrick at gundla.ch  Sun Mar 21 20:01:24 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 20:01:24 +0100
Subject: [luatex] howto: scaling an image
Message-ID: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>

Hi,

what is the preferred strategy for scaling an external image?

When I load an image with img.new({filename=...}) I don't have access to the width/height or xsize/ysize before I turn the image into a node. Once it is a whatsit node, I have (as far as I understand) two alternatives:

1) wrap the image in a (scale_x 0 0 scale_y 0 0) matrix or
2) change the width or height and again turn the image into a node.

Which one is the preferred way?

Oh, an additional question: what are the units of the img.xsize and img.ysize table values?

Patrick



From patrick at gundla.ch  Sun Mar 21 20:53:45 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 20:53:45 +0100
Subject: [luatex] howto: scaling an image
In-Reply-To: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
Message-ID: <72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>

> When I load an image with img.new({filename=...}) I don't have access to the width/height or xsize/ysize before I turn the image into a node. Once it is a whatsit node, I have (as far as I understand) two alternatives:

I see that with img.scan I get the data, so I'd guess that just changing img.width and img.height should do it, right?

> 
> 1) wrap the image in a (scale_x 0 0 scale_y 0 0) matrix or
> 2) change the width or height and again turn the image into a node.
> 
> Which one is the preferred way?
> 


> Oh, an additional question: what are the units of the img.xsize and img.ysize table values?

This is still "open".

Patrick



From hartmut_henkel at gmx.de  Sun Mar 21 21:50:54 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 21 Mar 2010 21:50:54 +0100 (CET)
Subject: [luatex] howto: scaling an image
In-Reply-To: <72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
	<72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
Message-ID: <alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>

On Sun, 21 Mar 2010, Patrick Gundlach wrote:

> > When I load an image with img.new({filename=...}) I don't have
> > access to the width/height or xsize/ysize before I turn the image
> > into a node. Once it is a whatsit node, I have (as far as I
> > understand) two alternatives:
>
> I see that with img.scan I get the data, so I'd guess that just
> changing img.width and img.height should do it, right?

yes. or only one of these to keep the aspect ratio.

> > 1) wrap the image in a (scale_x 0 0 scale_y 0 0) matrix or
> > 2) change the width or height and again turn the image into a node.
> >
> > Which one is the preferred way?
>
> > Oh, an additional question: what are the units of the img.xsize and
> > img.ysize table values?

just sp, isn't it? With pixel images these are calculated from the
number of horizontal/vertical pixels and the x/y resolutions, with the
same heuristics as with pdftex.

Regards, Hartmut

From patrick at gundla.ch  Sun Mar 21 22:21:08 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 22:21:08 +0100
Subject: [luatex] howto: scaling an image
In-Reply-To: <alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
	<72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
	<alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>
Message-ID: <6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>


Am 21.03.2010 um 21:50 schrieb Hartmut Henkel:

> On Sun, 21 Mar 2010, Patrick Gundlach wrote:
> 
>>> When I load an image with img.new({filename=...}) I don't have
>>> access to the width/height or xsize/ysize before I turn the image
>>> into a node. Once it is a whatsit node, I have (as far as I
>>> understand) two alternatives:
>> 
>> I see that with img.scan I get the data, so I'd guess that just
>> changing img.width and img.height should do it, right?
> 
> yes. or only one of these to keep the aspect ratio.

No:

local hacker = img.scan{filename = "hacker.jpg"}

hacker.width  = hacker.width * 0.5
node.write(img.node(hacker))

gives me a distorted image.

> just sp, isn't it? With pixel images these are calculated from the
> number of horizontal/vertical pixels and the x/y resolutions, with the
> same heuristics as with pdftex.

I'd guess bp. But I don't know.

print(string.format("xsize=%d, ysize=%d",hacker.xsize,hacker.ysize)):

xsize=531, ysize=354


Patrick


From hartmut_henkel at gmx.de  Sun Mar 21 22:27:32 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 21 Mar 2010 22:27:32 +0100 (CET)
Subject: [luatex] howto: scaling an image
In-Reply-To: <6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
	<72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
	<alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>
	<6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>
Message-ID: <alpine.DEB.1.00.1003212225100.4180@hahepc1.hahe>

On Sun, 21 Mar 2010, Patrick Gundlach wrote:
> Am 21.03.2010 um 21:50 schrieb Hartmut Henkel:
> > On Sun, 21 Mar 2010, Patrick Gundlach wrote:
> >
> >>> When I load an image with img.new({filename=...}) I don't have
> >>> access to the width/height or xsize/ysize before I turn the image
> >>> into a node. Once it is a whatsit node, I have (as far as I
> >>> understand) two alternatives:
> >>
> >> I see that with img.scan I get the data, so I'd guess that just
> >> changing img.width and img.height should do it, right?
> >
> > yes. or only one of these to keep the aspect ratio.
>
> No:
>
> local hacker = img.scan{filename = "hacker.jpg"}
>
> hacker.width  = hacker.width * 0.5
> node.write(img.node(hacker))
>
> gives me a distorted image.

right, forgot: set the others to nil, and it will be re-scaled.

(xsize question i have to check)

Regards, Hartmut


From patrick at gundla.ch  Sun Mar 21 23:02:23 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 21 Mar 2010 23:02:23 +0100
Subject: [luatex] howto: scaling an image
In-Reply-To: <alpine.DEB.1.00.1003212225100.4180@hahepc1.hahe>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
	<72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
	<alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>
	<6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>
	<alpine.DEB.1.00.1003212225100.4180@hahepc1.hahe>
Message-ID: <9367FF41-2551-470F-B6CA-F5BA18FF75D5@gundla.ch>

>> 
>> local hacker = img.scan{filename = "hacker.jpg"}
>> 
>> hacker.width  = hacker.width * 0.5
>> node.write(img.node(hacker))
>> 
>> gives me a distorted image.
> 
> right, forgot: set the others to nil, and it will be re-scaled.

Thats interesting and works quite well! Thanks for the pointer.

Patrick


From hartmut_henkel at gmx.de  Sun Mar 21 23:08:07 2010
From: hartmut_henkel at gmx.de (Hartmut Henkel)
Date: Sun, 21 Mar 2010 23:08:07 +0100 (CET)
Subject: [luatex] howto: scaling an image
In-Reply-To: <6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>
References: <E65F2A04-22F9-4519-83B6-315880544B77@gundla.ch>
	<72E2A93E-92F3-4039-B207-FC42AC59E227@gundla.ch>
	<alpine.DEB.1.00.1003212146270.4022@hahepc1.hahe>
	<6F43E9AA-D1CF-42EE-9BE5-53240D2FBDD1@gundla.ch>
Message-ID: <alpine.DEB.1.00.1003212306310.32169@hahepc1.hahe>

On Sun, 21 Mar 2010, Patrick Gundlach wrote:
>
> I'd guess bp. But I don't know.
>
> print(string.format("xsize=%d, ysize=%d",hacker.xsize,hacker.ysize)):
>
> xsize=531, ysize=354

integer pixels, it's a 531x354 pixel image. With pdf images it's sp.

Regards, Hartmut

From zappathustra at free.fr  Fri Mar 26 19:55:16 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 26 Mar 2010 19:55:16 +0100
Subject: [luatex] Trouble with the output routine?
Message-ID: <4BAD0314.60707@free.fr>

There's a strange bug in LuaTeX v0.52 (but it also happened in v.51, and 
before that I can't tell). Here's a minimal example:

\output{\shipout\box255}

\topskip\baselineskip
\vsize3\baselineskip
\def\endline{\hfil\penalty-10000}

This is\endline
a 4-line\endline
paragraph\endline
that ends here\par

\vskip0pt
\hbox{A TITLE?}
A new paragraph...

\bye

(The \endline macro is just because I was too lazy to typeset an entire 
paragraph and is completely immaterial.)
So we have 3-line pages (which is immaterial once again). The 
interesting thing is that the second page should show:

that ends here
A TITLE?
A new paragraph...

but what happen is

A TITLE?
that ends here
A new paragraph...

with apparently no interline glue between the first two lines. This 
happens whatever the value of \vskip; interestingly, the skip (when 
non-0) appears after "that ends here". If your remove the skip, it works 
correctly again.
This happens with an old plain format without primitives enabled, and 
also with a luatex-plain format, in whatever output, with no callback 
anywhere, so apparently it's the engine. (And of course, it doesn't 
happen in pdfTeX.)

Best,
Paul



From zappathustra at free.fr  Fri Mar 26 19:57:30 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 26 Mar 2010 19:57:30 +0100
Subject: [luatex] the son of trouble in the output routine.
Message-ID: <4BAD039A.40103@free.fr>

Damn. I forgot to mention one important thing: if you turn the 4-line 
paragraph into a 5-line one, i.e. if you kill the widow, everything 
works fine (the title appears after the paragraph, etc.)
Paul


From taco at elvenkind.com  Fri Mar 26 20:32:45 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Fri, 26 Mar 2010 20:32:45 +0100
Subject: [luatex] the son of trouble in the output routine.
In-Reply-To: <4BAD039A.40103@free.fr>
References: <4BAD039A.40103@free.fr>
Message-ID: <4BAD0BDD.3080008@elvenkind.com>

Paul Isambert wrote:
> Damn. I forgot to mention one important thing: if you turn the 4-line 
> paragraph into a 5-line one, i.e. if you kill the widow, everything 
> works fine (the title appears after the paragraph, etc.)
> Paul

Thanks for the report, I will look into this.



From patrick at gundla.ch  Fri Mar 26 21:34:25 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 26 Mar 2010 21:34:25 +0100
Subject: [luatex] lccode in lua?
Message-ID: <64EC2BC4-5695-40C1-A9AF-86DDAA6D6C2D@gundla.ch>

Hi,

can I set lccode in lua? That is: do the following equivalent "without the backslashes":

\lccode`\?=`\?
\lccode`\?=`\?
\lccode`\?=`\?

Patrick



From mpg at elzevir.fr  Fri Mar 26 23:33:01 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Fri, 26 Mar 2010 23:33:01 +0100
Subject: [luatex] dofile(nil) in batchmode
Message-ID: <4BAD361D.8000701@elzevir.fr>

Hi,

As I understand it, \batchmode disables all interaction, including reading
things from standard input. So, I wonder if dofile() without arguments shouldn't
result in an error rather than hang forever.

Also, in non-batch modes, it would be nice to have some indication that luatex
is waiting for some input.

Of course these are details, but I just lost 15 minutes trying to understand why
one of my loops wouldn't properly terminate before I noticed the dofile() right
before the loop. (Yeah, I know, assert() is my friend.)

Thanks,
Manuel.

From mpg at elzevir.fr  Sat Mar 27 01:58:22 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 01:58:22 +0100
Subject: [luatex] \catcodetable0
Message-ID: <4BAD582E.6040508@elzevir.fr>

Hi,

Sorry if I'm missing something obvious, but I fail to understand the behaviour
of \catcodetable0. Consider the following test file.

\catcodetable0\relax
\showthe\catcode64
\catcode64 11
\catcodetable0\relax
\showthe\catcode64
\initcatcodetable1
\catcodetable1\relax
\showthe\catcode64
\bye

The "output" is 12, 11, 12 (LuaTeX from trunk). I would expect 12, 12, 12 (the
\catcodetable0 statement should override the preceding \catcode asignement, as
does the later \catcodetable1).

Thanks,
Manuel.


From heiko.oberdiek at googlemail.com  Sat Mar 27 04:41:39 2010
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Sat, 27 Mar 2010 04:41:39 +0100
Subject: [luatex] \catcodetable0
In-Reply-To: <4BAD582E.6040508@elzevir.fr>
References: <4BAD582E.6040508@elzevir.fr>
Message-ID: <20100327034139.GA19548@oberdiek.my-fqdn.de>

On Sat, Mar 27, 2010 at 01:58:22AM +0100, Manuel P?gouri?-Gonnard wrote:

> Sorry if I'm missing something obvious, but I fail to understand the
> behaviour of \catcodetable0. Consider the following test file.
> 
> \catcodetable0\relax
> \showthe\catcode64
> \catcode64 11
> \catcodetable0\relax
> \showthe\catcode64
> \initcatcodetable1
> \catcodetable1\relax
> \showthe\catcode64
> \bye
> 
> The "output" is 12, 11, 12 (LuaTeX from trunk). I would expect 12, 12, 12
> \(the catcodetable0 statement should override the preceding \catcode
> assignment, as does the later \catcodetable1).

The \catcode assignment has changed catcode
table 0 (until the current group is closed).
And the following \catcodetable0 has nothing to do,
because the current table is already table 0.

Yours sincerely
  Heiko Oberdiek

From taco at elvenkind.com  Sat Mar 27 08:12:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 27 Mar 2010 08:12:37 +0100
Subject: [luatex] lccode in lua?
In-Reply-To: <64EC2BC4-5695-40C1-A9AF-86DDAA6D6C2D@gundla.ch>
References: <64EC2BC4-5695-40C1-A9AF-86DDAA6D6C2D@gundla.ch>
Message-ID: <4BADAFE5.4060908@elvenkind.com>

Patrick Gundlach wrote:
> Hi,
> 
> can I set lccode in lua? That is: do the following equivalent "without the backslashes":
> 
> \lccode`\?=`\?
> \lccode`\?=`\?
> \lccode`\?=`\?

Not yet.

From taco at elvenkind.com  Sat Mar 27 08:51:02 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 27 Mar 2010 08:51:02 +0100
Subject: [luatex] dofile(nil) in batchmode
In-Reply-To: <4BAD361D.8000701@elzevir.fr>
References: <4BAD361D.8000701@elzevir.fr>
Message-ID: <4BADB8E6.3060008@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> As I understand it, \batchmode disables all interaction, including reading
> things from standard input. So, I wonder if dofile() without arguments shouldn't
> result in an error rather than hang forever.
> 
> Also, in non-batch modes, it would be nice to have some indication that luatex
> is waiting for some input.
> 
> Of course these are details, but I just lost 15 minutes trying to understand why
> one of my loops wouldn't properly terminate before I noticed the dofile() right
> before the loop. (Yeah, I know, assert() is my friend.)

See here: http://tracker.luatex.org/view.php?id=363

I have not removed the need for assert() around dofile(), because
I think this is really the programmer's job.

Best wishes,
Taco




From mpg at elzevir.fr  Sat Mar 27 10:54:50 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 10:54:50 +0100
Subject: [luatex] \catcodetable0
In-Reply-To: <20100327034139.GA19548@oberdiek.my-fqdn.de>
References: <4BAD582E.6040508@elzevir.fr>
	<20100327034139.GA19548@oberdiek.my-fqdn.de>
Message-ID: <4BADD5EA.9060607@elzevir.fr>

Hi,

Heiko Oberdiek a ?crit :
> On Sat, Mar 27, 2010 at 01:58:22AM +0100, Manuel P?gouri?-Gonnard wrote:
> 
>> Sorry if I'm missing something obvious, but I fail to understand the
>> behaviour of \catcodetable0. Consider the following test file.
>>
>> \catcodetable0\relax
>> \showthe\catcode64
>> \catcode64 11
>> \catcodetable0\relax
>> \showthe\catcode64
>> \initcatcodetable1
>> \catcodetable1\relax
>> \showthe\catcode64
>> \bye
>>
>> The "output" is 12, 11, 12 (LuaTeX from trunk). I would expect 12, 12, 12
>> \(the catcodetable0 statement should override the preceding \catcode
>> assignment, as does the later \catcodetable1).
> 
> The \catcode assignment has changed catcode
> table 0 (until the current group is closed).

That's what I misunderstood. It thought the catcode tables could only be
modified (globally) by \initcatcodetable and \savecatcodetable.

> And the following \catcodetable0 has nothing to do,
> because the current table is already table 0.
> 
Right. For some reason I thought that \catcode modifies only the "current set of
catcodes" which would be an object different from the "current catcode table".

So, to sum up, a catcode table can be modified:
- locally, when it is active, using \catcode,
- globally, when it is active, using \global\catcode,
- globally, when it is not active, using \savecatcodetable,
- globally, when it has never been used before, using \initcatcodetable.

I previously missed the first two options. Am I still missing something?

Thanks,
Manuel.


From mpg at elzevir.fr  Sat Mar 27 11:03:22 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 11:03:22 +0100
Subject: [luatex] dofile(nil) in batchmode
In-Reply-To: <4BADB8E6.3060008@elvenkind.com>
References: <4BAD361D.8000701@elzevir.fr> <4BADB8E6.3060008@elvenkind.com>
Message-ID: <4BADD7EA.30500@elzevir.fr>

Taco Hoekwater a ?crit :
> See here: http://tracker.luatex.org/view.php?id=363
> 
Great, thanks.

> I have not removed the need for assert() around dofile(), because
> I think this is really the programmer's job.
> 
I agree.

Manuel.

From taco at elvenkind.com  Sat Mar 27 16:59:22 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 27 Mar 2010 16:59:22 +0100
Subject: [luatex] the son of trouble in the output routine.
In-Reply-To: <4BAD0BDD.3080008@elvenkind.com>
References: <4BAD039A.40103@free.fr> <4BAD0BDD.3080008@elvenkind.com>
Message-ID: <4BAE2B5A.4010006@elvenkind.com>

Taco Hoekwater wrote:
> Paul Isambert wrote:
>> Damn. I forgot to mention one important thing: if you turn the 4-line 
>> paragraph into a 5-line one, i.e. if you kill the widow, everything 
>> works fine (the title appears after the paragraph, etc.)
>> Paul
> 
> Thanks for the report, I will look into this.

Found and fixed (took me a long time to find it). The bug was introduced
during commit #3417: * Some experimental tweaking of buildpage_filter.

What this experiment actually did was: it split the adding of a new
(line) box to the vertical list into separate steps for

a. the already waiting contributions
b. any \adjust pre stuff from the box
c. the box
d. any \adjust stuff from the box

This split introduced extra calls to the page builder, which then
resulted in the bug. So, the experiment is now reverted.

Best wishes,
Taco

From shavrin.ivan at gmail.com  Sat Mar 27 17:19:01 2010
From: shavrin.ivan at gmail.com (shiva)
Date: Sat, 27 Mar 2010 19:19:01 +0300
Subject: [luatex] Cyrillic in \directlua0
Message-ID: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>

Hi, all.

I am trying to use lualatex with cyrillic characters (lualatex version
is beta-0.50.0-2009122515)

Here is main.tex file
------------------------
\documentclass{article}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{luainputenc}
\usepackage{luatextra}
\begin{document}
??????????, ???

\directlua0{
tex.print("??????????, ???")
}
\end{document}
------------------------

"lualatex main.tex" produced main.pdf, with this content:
--------------------------------------
??????????, ???

T2ACYRZ T2Acyrd T2Acyrr T2Acyra T2Acyrv T2Acyrs T2Acyrt T2Acyrv
T2Acyru T2Acyrishrt , T2ACYRM T2Acyri T2Acyrr
--------------------------------------

We see, that first line produced correctly, but the second line is not.

The question is: Does LuaLaTeX support cyrillic symbols inside luacode?

Best wishes,
Shavrin Ivan


From patrick at gundla.ch  Sat Mar 27 17:30:44 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 27 Mar 2010 17:30:44 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
Message-ID: <C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>

Hi,


> The question is: Does LuaLaTeX support cyrillic symbols inside luacode?

Yes, it should be completely transparent. This example works.

\documentclass{article}
\usepackage{luaotfload}
\usepackage[EU2]{fontenc}
\usepackage{libertine}
\begin{document}
??????????, ???

\directlua{
tex.print("??????????, ???")
}
\end{document}


and my (needed) eu2fxl.fd can be found here:

http://gist.github.com/346196


BTW: you should use \directlua without a number.


Does this help?

Patrick



From taco at elvenkind.com  Sat Mar 27 17:37:21 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 27 Mar 2010 17:37:21 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
Message-ID: <4BAE3441.7080001@elvenkind.com>

Patrick Gundlach wrote:
> Hi,
> 
> 
>> The question is: Does LuaLaTeX support cyrillic symbols inside luacode?
> 
> Yes, it should be completely transparent. This example works.
> 
> \documentclass{article}
> \usepackage{luaotfload}
> \usepackage[EU2]{fontenc}
> \usepackage{libertine}
> \begin{document}
> ??????????, ???
> 
> \directlua{
> tex.print("??????????, ???")
> }
> \end{document}

Out of curiosity: this example looks like it is using a Unicode-encoded
font and 'normal' luatex input encoding (=UTF-8). Is someone able and
willing to explain what the original post was supposed to (and failed)
do?

Cheers,
Taco


From arthur.reutenauer at normalesup.org  Sat Mar 27 17:47:05 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 27 Mar 2010 17:47:05 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE3441.7080001@elvenkind.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
Message-ID: <20100327164705.GA30460@phare.normalesup.org>

>                                                   Is someone able and
> willing to explain what the original post was supposed to (and failed)
> do?

  Basically, it used the good ol' 8-bit LaTeX tricks to map an input
encoding to a font encoding : Unicode character -> LaTeX internal
character control sequence -> 8-bit font slot (via fontenc).  That's
what Lua saw (\T2A\CYRZ, etc.)

  Ivan, you shouldn't use fontenc at all with LuaTeX, it doesn't work.
Use luaotfload to load an OpenType font, and simply type in UTF-8.
luainputenc is useless in that case, since input is always in UTF-8.

	Arthur

From shavrin.ivan at gmail.com  Sat Mar 27 17:54:17 2010
From: shavrin.ivan at gmail.com (shiva)
Date: Sat, 27 Mar 2010 19:54:17 +0300
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <20100327164705.GA30460@phare.normalesup.org>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
	<20100327164705.GA30460@phare.normalesup.org>
Message-ID: <fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>

Thanks to all.

Patrick, your sample is work, but if I correctly understood, it's not
"true way".

Arthur, thanks to. I will try to play with luaotfload.

2010/3/27 Arthur Reutenauer <arthur.reutenauer at normalesup.org>:
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? Is someone able and
>> willing to explain what the original post was supposed to (and failed)
>> do?
>
> ?Basically, it used the good ol' 8-bit LaTeX tricks to map an input
> encoding to a font encoding : Unicode character -> LaTeX internal
> character control sequence -> 8-bit font slot (via fontenc). ?That's
> what Lua saw (\T2A\CYRZ, etc.)
>
> ?Ivan, you shouldn't use fontenc at all with LuaTeX, it doesn't work.
> Use luaotfload to load an OpenType font, and simply type in UTF-8.
> luainputenc is useless in that case, since input is always in UTF-8.
>
> ? ? ? ?Arthur
>


From mpg at elzevir.fr  Sat Mar 27 17:59:07 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 27 Mar 2010 17:59:07 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE3441.7080001@elvenkind.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
Message-ID: <4BAE395B.4070804@elzevir.fr>

Taco Hoekwater a ?crit :
> Out of curiosity: this example looks like it is using a Unicode-encoded
> font and 'normal' luatex input encoding (=UTF-8). Is someone able and
> willing to explain what the original post was supposed to (and failed)
> do?
> 
Well, I'm not in Shiva's mind, but let me try. Currently, the situation wrt
encodings in LaTeX is as follows:

1. you can use the "natural" (=UTF-8) input encoding with Unicode fonts. Such
fonts can be loaded using luaotfload and fontenc/EU2, or the experimental
version of fontspec which should take care of everything.

2. OR, if you want/need to use a font in a legacy encoding such as T2A, then,
surprisingly, you need to load luainputenc even if your source is in UTF-8 (and
of course it also supports more input encodings). Its purpose is to transcode
from the input encoding (here, UTF-8) to the internal encoding of LaTeX (LICR)
by making quite a lot of characters active. Then, the normal fontenc translates
from LICR to the font's legacy encoding.

The output observed is the expansion of the LICR macro representation of the
string when the current output (font) encoding is T2A.

Option 2 is kinda dirty because of the active characters. Another way to support
legacy font encodings (if that is really needed) would be to build a virtual
Unicode font on the fly so that luainputenc isn't needed any more (or could
avoid using active characters). I intend to give it a try some day, but who
knows when...

Manuel.

From arthur.reutenauer at normalesup.org  Sat Mar 27 18:02:46 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 27 Mar 2010 18:02:46 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
Message-ID: <20100327170246.GB30460@phare.normalesup.org>

> Patrick, your sample is work, but if I correctly understood, it's not
> "true way".

  What do you mean by ?true way??  Patrick's sample shows the best
possible way: you just use UTF-8 encoding and OpenType fonts.  On the
other hand, what you did originally used the tricks that were developed
for 8-bit TeX engines, and it's a bad idea to use them in LuaTeX
(although they may work to some extent).

	Arthur

From mpg at elzevir.fr  Sat Mar 27 18:09:42 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 18:09:42 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
Message-ID: <4BAE3BD6.5030407@elzevir.fr>

Hi,

shiva a ?crit :
> Patrick, your sample is work, but if I correctly understood, it's not
> "true way".
> 
At this point, there is no "Right Way" (yet). There are two ways: one way for
Unicode fonts, another way for legacy-encoded fonts. The "rightest" of those
ways is to use an Unicode font, if you have a choice. The other way is merely a
hack to try supporting legacy fonts.

> 2010/3/27 Arthur Reutenauer <arthur.reutenauer at normalesup.org>:
>>  Ivan, you shouldn't use fontenc at all with LuaTeX, it doesn't work.
>> Use luaotfload to load an OpenType font, and simply type in UTF-8.
>> luainputenc is useless in that case, since input is always in UTF-8.
>>
I respectfully disagree here. fontenc works with EU2 for Unicode fonts. It also
works with legacy encodings if you load luainputenc. That is, it will work as
well (and as bad) as it does with pdfTeX. Said otherwise, it's a huge pain, but
if need to use a font for which no Unicode version is available, it's the only
solution right now.

Manuel.

PS : with the example given, since the font will be cm or lm, and lm exists in
Opentype, of course the best solution is to use the Opentype version using
luaotfload (or the development version of fontspec).


From patrick at gundla.ch  Sat Mar 27 18:17:11 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sat, 27 Mar 2010 18:17:11 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE3BD6.5030407@elzevir.fr>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
	<4BAE3BD6.5030407@elzevir.fr>
Message-ID: <A91AAA66-E51D-4822-87C9-C6DBFA93A6AD@gundla.ch>


>> 2010/3/27 Arthur Reutenauer <arthur.reutenauer at normalesup.org>:
>>> Ivan, you shouldn't use fontenc at all with LuaTeX, it doesn't work.
>>> Use luaotfload to load an OpenType font, and simply type in UTF-8.
>>> luainputenc is useless in that case, since input is always in UTF-8.
>>> 
> I respectfully disagree here. fontenc works with EU2 for Unicode fonts.

I agree completely. If I might be allowed to put an additional remark:

For those who haven't looked into eu2 font definition files (fd-files): These files do not normally reencode the fonts, so this fontenc is a LaTeX necessity and does nothing wrt the encoding. For example the eu2 fd file for Latin modern:

\ProvidesFile{eu2lmr.fd}[2009/10/30 v1.6 Font defs for Latin Modern]
\DeclareFontFamily{EU2}{lmr}{}
\DeclareFontShape{EU2}{lmr}{m}{n}%
     {<-5.5>    file:lmroman5-regular:script=latn;+trep;+tlig; 
        ....
      }
...


Patrick

(who really likes the eu2 "encoding")

From arthur.reutenauer at normalesup.org  Sat Mar 27 18:20:11 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 27 Mar 2010 18:20:11 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE3BD6.5030407@elzevir.fr>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
	<4BAE3BD6.5030407@elzevir.fr>
Message-ID: <20100327172011.GD30460@phare.normalesup.org>

> I respectfully disagree here. fontenc works with EU2 for Unicode fonts. It also
> works with legacy encodings if you load luainputenc.

  Right, but I think this is besides the issue here (as far as I am
concerned, I stay by the feeling that LaTeX hardly works with LuaTeX
anyway, even if it can be made to produce documents ;-).  At this point,
it would be best if Ivan told us what he's using LuaTeX for (new
documents in Russian?  Other languages too?  Old documents too?)

> PS : with the example given, since the font will be cm or lm, and lm exists in
> Opentype, of course the best solution is to use the Opentype version using
> luaotfload (or the development version of fontspec).

  Actually no, with the T2A font encoding the Cyrillic version of
Computer Modern (called lh at some point) will be used.  I can't
remember if *Latin* Modern doesn't by chance contain Cyrillic characters
after all.

	Arthur

From mpg at elzevir.fr  Sat Mar 27 18:20:23 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 18:20:23 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <A91AAA66-E51D-4822-87C9-C6DBFA93A6AD@gundla.ch>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>	<20100327164705.GA30460@phare.normalesup.org>	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>	<4BAE3BD6.5030407@elzevir.fr>
	<A91AAA66-E51D-4822-87C9-C6DBFA93A6AD@gundla.ch>
Message-ID: <4BAE3E57.8010305@elzevir.fr>

Patrick Gundlach a ?crit :
> For those who haven't looked into eu2 font definition files (fd-files): These files do not normally reencode the fonts, so this fontenc is a LaTeX necessity and does nothing wrt the encoding. For example the eu2 fd file for Latin modern:
> 
> \ProvidesFile{eu2lmr.fd}[2009/10/30 v1.6 Font defs for Latin Modern]
> \DeclareFontFamily{EU2}{lmr}{}
> \DeclareFontShape{EU2}{lmr}{m}{n}%
>      {<-5.5>    file:lmroman5-regular:script=latn;+trep;+tlig; 
>         ....
>       }
> ...
> 
Oh, right. I wasn't sure if eu2/fontenc was just "working" or "working and
actually necessary". Now I am. Thanks for the info.

Manuel.

From arthur.reutenauer at normalesup.org  Sat Mar 27 18:22:57 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 27 Mar 2010 18:22:57 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <A91AAA66-E51D-4822-87C9-C6DBFA93A6AD@gundla.ch>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
	<4BAE3BD6.5030407@elzevir.fr>
	<A91AAA66-E51D-4822-87C9-C6DBFA93A6AD@gundla.ch>
Message-ID: <20100327172257.GE30460@phare.normalesup.org>

> For those who haven't looked into eu2 font definition files (fd-files): These files do not normally reencode the fonts, so this fontenc is a LaTeX necessity and does nothing wrt the encoding.

  That was pretty much my point: if you can make fontenc do nothing at
all, then it'll work without any problem :-)

  For the samples I showed at TUG'09 I used the U encoding, I think.

	Arthur

From mpg at elzevir.fr  Sat Mar 27 18:34:36 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Sat, 27 Mar 2010 18:34:36 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <20100327172011.GD30460@phare.normalesup.org>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>	<20100327164705.GA30460@phare.normalesup.org>	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>	<4BAE3BD6.5030407@elzevir.fr>
	<20100327172011.GD30460@phare.normalesup.org>
Message-ID: <4BAE41AC.7070106@elzevir.fr>

Arthur Reutenauer a ?crit :
>> I respectfully disagree here. fontenc works with EU2 for Unicode fonts. It also
>> works with legacy encodings if you load luainputenc.
> 
>   Right, but I think this is besides the issue here (as far as I am
> concerned, I stay by the feeling that LaTeX hardly works with LuaTeX
> anyway, even if it can be made to produce documents ;-).

Well, there are people working on it...

>> PS : with the example given, since the font will be cm or lm, and lm exists in
>> Opentype, of course the best solution is to use the Opentype version using
>> luaotfload (or the development version of fontspec).
> 
>   Actually no, with the T2A font encoding the Cyrillic version of
> Computer Modern (called lh at some point) will be used.

That's what I meant by "cm or lm". The intention was to make a statement vague
enough so that is couldn't be entirely false :-)

>  I can't
> remember if *Latin* Modern doesn't by chance contain Cyrillic characters
> after all.
> 
I na?vely assumed Latim Modern's character coverage was at least as wide as
Computer Modern. However, I just checked using fontforge, and there are no
Cyrilic characters in lmroman10-regular.otf indeed.

Manuel.

From arthur.reutenauer at normalesup.org  Sat Mar 27 18:46:31 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sat, 27 Mar 2010 18:46:31 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE41AC.7070106@elzevir.fr>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com>
	<20100327164705.GA30460@phare.normalesup.org>
	<fff6e00c1003270954m4d88d97j8e41ec44dcb2111b@mail.gmail.com>
	<4BAE3BD6.5030407@elzevir.fr>
	<20100327172011.GD30460@phare.normalesup.org>
	<4BAE41AC.7070106@elzevir.fr>
Message-ID: <20100327174631.GG30460@phare.normalesup.org>

>                  However, I just checked using fontforge, and there are no
> Cyrilic characters in lmroman10-regular.otf indeed.

  No big surprise, the font used for T2A is really a different one.  Its
TFM name is larm*, it's neither cm or lm in any form.

	Arthur

From taco at elvenkind.com  Sat Mar 27 21:09:37 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Sat, 27 Mar 2010 21:09:37 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE395B.4070804@elzevir.fr>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>
	<4BAE395B.4070804@elzevir.fr>
Message-ID: <4BAE6601.4020404@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> 
> The output observed is the expansion of the LICR macro representation of the
> string when the current output (font) encoding is T2A.

In that case,

   tex.print([[??????????, ???]])

maybe works (as using [[]] strings stopslua from interpreting
backslash characters in the string as escape sequence starts).

Best wishes,
Taco





From mpg at elzevir.fr  Sat Mar 27 21:35:37 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sat, 27 Mar 2010 21:35:37 +0100
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE6601.4020404@elvenkind.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>	<4BAE395B.4070804@elzevir.fr>
	<4BAE6601.4020404@elvenkind.com>
Message-ID: <4BAE6C19.2080708@elzevir.fr>

Taco Hoekwater a ?crit :
> Manuel P?gouri?-Gonnard wrote:
>>
>> The output observed is the expansion of the LICR macro representation
>> of the
>> string when the current output (font) encoding is T2A.
> 
> In that case,
> 
>   tex.print([[??????????, ???]])
> 
> maybe works (as using [[]] strings stopslua from interpreting
> backslash characters in the string as escape sequence starts).
> 
Unfortunately not, since the name of the control sequence aren't re-tokenized
properly: \T2A (aka \csname T2A\endcsname) is interpreted as \T 2A...

A possible solution (tested) is:

\directlua{
  \unexpanded{tex.print("??????????, ???")}
  }

That way, characters aren't expanded before being passed to Lua, so are
correctly printed back to TeX and tokenized. (This kind of problem wouldn't
happen if the Lua code were in a separate file, btw.)

Manuel.

PS: I had to first run a variant of the example under pdfTeX so that
larm1000.tfm got generated before I could succesfully compile it with LuaTeX. I
guess that tfm generation is disabled on purpose?

From shavrin.ivan at gmail.com  Sun Mar 28 09:26:05 2010
From: shavrin.ivan at gmail.com (shiva)
Date: Sun, 28 Mar 2010 11:26:05 +0400
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <4BAE6C19.2080708@elzevir.fr>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>
	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>
	<4BAE3441.7080001@elvenkind.com> <4BAE395B.4070804@elzevir.fr>
	<4BAE6601.4020404@elvenkind.com> <4BAE6C19.2080708@elzevir.fr>
Message-ID: <fff6e00c1003280026xbda1ddpa870dd63fa898972@mail.gmail.com>

>>
>> In that case,
>>
>> ? tex.print([[??????????, ???]])
>>
>> maybe works (as using [[]] strings stopslua from interpreting
>> backslash characters in the string as escape sequence starts).
>>

So, it works:
--------------------
\documentclass{article}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{luainputenc}
\usepackage{luatextra}
\input cyracc.def
\font\tencyr=wncyr10
\def\cyr{\tencyr\cyracc}
\def\T2A{}
\begin{document}
??????????, ???

\directlua0{
tex.print([[??????????, ???]])
}
\end{document}
--------------------

But as I rightly understand, it used very old method for cyrillic language.

> A possible solution (tested) is:
>
> \directlua{
> ?\unexpanded{tex.print("??????????, ???")}
> ?}

That works too.


> it would be best if Ivan told us what he's using LuaTeX for (new
> documents in Russian?  Other languages too?  Old documents too?)
>

So, i use pdfLaTeX with T2A  in fontenc and utf8 inputenc much for new
documents in russian and english (without any languages). But there
are some problems in this case, for example listings package works
uncorrectly with utf-8 coded source. Also, i am trying to use python
inside latex (for some automatisation), but i think, that use lua in
lualatex is better.


From mpg at elzevir.fr  Sun Mar 28 12:02:55 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Sun, 28 Mar 2010 12:02:55 +0200
Subject: [luatex] Cyrillic in \directlua0
In-Reply-To: <fff6e00c1003280026xbda1ddpa870dd63fa898972@mail.gmail.com>
References: <fff6e00c1003270919q4b0a5771g84c365ef6b211472@mail.gmail.com>	<C183B382-94CE-4D84-9C6F-D2B3F6B607B9@gundla.ch>	<4BAE3441.7080001@elvenkind.com>
	<4BAE395B.4070804@elzevir.fr>	<4BAE6601.4020404@elvenkind.com>
	<4BAE6C19.2080708@elzevir.fr>
	<fff6e00c1003280026xbda1ddpa870dd63fa898972@mail.gmail.com>
Message-ID: <4BAF294F.6020808@elzevir.fr>

shiva a ?crit :
> So, i use pdfLaTeX with T2A  in fontenc and utf8 inputenc much for new
> documents in russian and english (without any languages).

For new documents, I highly recommend to use a Unicode font, without luinputenc,
but with luaotfload, as Patrick suggested.

> But there
> are some problems in this case, for example listings package works
> uncorrectly with utf-8 coded source.

You'll have the same problems in LuaTeX if you use luainputenc. So, there is no
benefit here unless you use a Unicode font and get rid of luainputenc.

Manuel.

From mpg at elzevir.fr  Mon Mar 29 02:45:09 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 29 Mar 2010 02:45:09 +0200
Subject: [luatex] package loaders
Message-ID: <4BAFF815.10708@elzevir.fr>

Hi,

Here are two suggestions concerning the kpse package loaders, with patches.

1. Cosmetic change: cleaner error messages in case the file isn't found (or C
loading is disabled). This is errmsg.patch.

2. require"foo.bar" should look for "foo/bar" to be consistent with Lua
conventions (this is slashify.patch). Alternatively, it can look for "foo/bar"
first, and "foo.bar" as a fall-back, which is my preferred option (this is
slashify-or-not.patch).

Arguably, 2 could be done in Lua, but LuaTeX already modifies the loaders for
our convenience, so this additional modification doesn't add too much complexity
(or so I hope).

While we're at it, I'm quite surprised that package.loaders[4] is left
unaffected: it is not disabled in --safer mode, nor does it try to use kpse. I
have no opinion right now on how this loader such behave exactly, but it seems
strange that loader 3 is disabled in safer mode but not this one.

Thanks for your attention,
Manuel.

PS: all patches apply cleanly on trunk, and the slashify* patches supersede
errmsg.patch, if you choose to apply one of them.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: errmsg.patch
Type: text/x-patch
Size: 1715 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100329/4b34b0d6/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slashify.patch
Type: text/x-patch
Size: 1889 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100329/4b34b0d6/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slashify-or-not.patch
Type: text/x-patch
Size: 2483 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100329/4b34b0d6/attachment-0002.bin>

From dcnieho at gmail.com  Mon Mar 29 03:52:20 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Mon, 29 Mar 2010 09:52:20 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
Message-ID: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>

Dear Khaled,

As you suggested, I have gotten the newest luaotfload from github.
I've installed it manually by analyzing the makefile, but that should
be fine (replaced all the files in $(TEXMFROOT)/tex/luatex/luaotfload
and created the directory in $(TEXMFROOT)/scripts/mkluatexfontdb +
copied mkluatexfontdb, amongst the other non-vital steps). Ran
mktexlsr.

Now, with the following minimal document
----
\documentclass[11pt]{article}
\usepackage[no-math]{fontspec}

\setmainfont[Ligatures=Common]{Arno Pro}

\begin{document}
\textbf{Theorem 1 (Residue Theorem)} Let $f$ be analytic in the region
$G$ \textit{G}
\end{document}
----
I get the error (log attached):
----
(c:/texlive/2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua
! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:22: atte
mpt to index global 'dir' (a nil value)
stack traceback:
        ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:22: in main chun
k
        [C]: in function 'dofile'
        ...2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:48: in function
'loadm
odule'
        ...2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:154: in main chu
nk
        [C]: in function 'dofile'
        ...e/2009/texmf-dist/tex/luatex/luatextra/luatextra.lua:130: in function
 'use_
module'
        <\directlua >:1: in main chunk.
\luatexUseModule ...{luatextra.use_module([[#1]])}

l.57 \luatexUseModule{luaotfload}
----

Would this have something to do with the fontnamedb not being
generated properly? Do I need to any extra (one-time?) call to get
that done?

BTW, the link <http://github.com/mpg/luaotfload> in the luaotfload
README does not exist ;)

I'm on windows XP, "This is LuaTeX, Version beta-0.52.0-2010031722 (rev 3515)"

BTW, the offer for doing quick tests (just send me stuff, I can run
it) on Windows XP 32bit or Windows 7 64bit stands, just mail me
directly.

Best,
Dee

From mpg at elzevir.fr  Mon Mar 29 04:11:59 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 29 Mar 2010 04:11:59 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
Message-ID: <4BB00C6F.1030609@elzevir.fr>

Diederick C. Niehorster a ?crit :
> As you suggested, I have gotten the newest luaotfload from github.
> [...]

Since this is about macros (and lua functions), this message is probably
misplaced on this list. You may want to use the lualatex-dev mailing list (which
is also a google group): <http://groups.google.com/group/lualatex-dev>.

> BTW, the link <http://github.com/mpg/luaotfload> in the luaotfload
> README does not exist ;)
> 
It was suppressed a few days ago. Now the files are at

http://github.com/khaledhosny/luaotfload

(There was technical problems with the repe requiring admin intervention, and
since I'm fairly inactive on luaotfload, it seemed easier to transfer the repo
to Khaled.)

Manuel.


From dcnieho at gmail.com  Mon Mar 29 04:17:03 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Mon, 29 Mar 2010 10:17:03 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB00C6F.1030609@elzevir.fr>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<4BB00C6F.1030609@elzevir.fr>
Message-ID: <803fcee31003281917u7bbf411fl55a3f3fbd8924fe8@mail.gmail.com>

Hi Manuel,

On Mon, Mar 29, 2010 at 10:11 AM, Manuel P?gouri?-Gonnard
<mpg at elzevir.fr> wrote:
> Diederick C. Niehorster a ?crit :
>> As you suggested, I have gotten the newest luaotfload from github.
>> [...]
>
> Since this is about macros (and lua functions), this message is probably
> misplaced on this list. You may want to use the lualatex-dev mailing list (which
> is also a google group): <http://groups.google.com/group/lualatex-dev>.

Ah, ok. The nex tissue I (might) run into  I'll report on the dev list.

Thanks,
Dee


From khaledhosny at eglug.org  Mon Mar 29 07:45:26 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 29 Mar 2010 07:45:26 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
Message-ID: <20100329054524.GB2283@khaled-laptop>

On Mon, Mar 29, 2010 at 09:52:20AM +0800, Diederick C. Niehorster wrote:
> Dear Khaled,
> 
> As you suggested, I have gotten the newest luaotfload from github.
> I've installed it manually by analyzing the makefile, but that should
> be fine (replaced all the files in $(TEXMFROOT)/tex/luatex/luaotfload
> and created the directory in $(TEXMFROOT)/scripts/mkluatexfontdb +
> copied mkluatexfontdb, amongst the other non-vital steps). Ran
> mktexlsr.

You can just uninstall luaotfload using tlmgr then installing it in your
local texmf tree, under *nix:
$ make TEXMFROOT=~/texmf install

> Now, with the following minimal document
> ----
> \documentclass[11pt]{article}
> \usepackage[no-math]{fontspec}
> 
> \setmainfont[Ligatures=Common]{Arno Pro}
> 
> \begin{document}
> \textbf{Theorem 1 (Residue Theorem)} Let $f$ be analytic in the region
> $G$ \textit{G}
> \end{document}
> ----
> I get the error (log attached):
> ----
> (c:/texlive/2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua
> ! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:22: atte
> mpt to index global 'dir' (a nil value)
> stack traceback:
>         ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:22: in main chun
> k
>         [C]: in function 'dofile'
>         ...2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:48: in function
> 'loadm
> odule'
>         ...2009/texmf-dist/tex/luatex/luaotfload/luaotfload.lua:154: in main chu
> nk
>         [C]: in function 'dofile'
>         ...e/2009/texmf-dist/tex/luatex/luatextra/luatextra.lua:130: in function
>  'use_
> module'
>         <\directlua >:1: in main chunk.
> \luatexUseModule ...{luatextra.use_module([[#1]])}
> 
> l.57 \luatexUseModule{luaotfload}
> ----
> 
> Would this have something to do with the fontnamedb not being
> generated properly? Do I need to any extra (one-time?) call to get
> that done?

You are missing luaextra package, http://github.com/mpg/luaextra, I
forgot to mention it, sorry.

> BTW, the link <http://github.com/mpg/luaotfload> in the luaotfload
> README does not exist ;)

Fix, thanks.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From khaledhosny at eglug.org  Mon Mar 29 07:49:37 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 29 Mar 2010 07:49:37 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <20100329054524.GB2283@khaled-laptop>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
Message-ID: <20100329054937.GC2283@khaled-laptop>

On Mon, Mar 29, 2010 at 07:45:25AM +0200, Khaled Hosny wrote:
> On Mon, Mar 29, 2010 at 09:52:20AM +0800, Diederick C. Niehorster wrote:
> > Dear Khaled,
> > 
> > As you suggested, I have gotten the newest luaotfload from github.
> > I've installed it manually by analyzing the makefile, but that should
> > be fine (replaced all the files in $(TEXMFROOT)/tex/luatex/luaotfload
> > and created the directory in $(TEXMFROOT)/scripts/mkluatexfontdb +
> > copied mkluatexfontdb, amongst the other non-vital steps). Ran
> > mktexlsr.
> 
> You can just uninstall luaotfload using tlmgr then installing it in your
> local texmf tree, under *nix:
> $ make TEXMFROOT=~/texmf install

BTW, you don't need to install the mkluatexfontdb.lua script, just run
it from the directory of the downloaded luaotfload (this what I do, any
other method is not tested right now).

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From wspr81 at gmail.com  Mon Mar 29 05:20:33 2010
From: wspr81 at gmail.com (Will Robertson)
Date: Mon, 29 Mar 2010 13:50:33 +1030
Subject: [luatex] LuaLaTeX mailing list
Message-ID: <hop6a1$5mm$1@dough.gmane.org>

Hello,

While getting LaTeX and LuaTeX playing nicely hasn't progressed as 
quickly as some would like, there's been a little bit of development 
mainly focussed around getting fontspec working in LuaTeX  as it does 
in XeTeX.

This work has been done mostly by Elie Roux and Khaled Hosny and Manuel 
P?gouri?-Gonnard; my involvement (unfortunately not a much as I would 
like) has been in the TeX-based macros of fontspec itself; cleaning it 
up a little and fixing bugs and adding the internal features to suit 
the needs of LuaTeX.

(This new version of fontspec isn't quite ready to be released but it 
basically works right now. Still need more documentation, etc.)

We have a discussion group set up for LuaLaTeX work, which was recently 
mentioned by Manuel:
  <http://groups.google.com/group/lualatex-dev>

Any questions or discussion related to LuaLaTeX are welcome there. I'm 
not trying to fragment this LuaTeX group; my feeling is just that most 
people here don't care so much for what happens on the LaTeX side of 
the fence :)

Will



From arthur.reutenauer at normalesup.org  Mon Mar 29 09:15:03 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 29 Mar 2010 09:15:03 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB00C6F.1030609@elzevir.fr>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<4BB00C6F.1030609@elzevir.fr>
Message-ID: <20100329071503.GF2399@phare.normalesup.org>

> Since this is about macros (and lua functions), this message is probably
> misplaced on this list.

  I don't think so; this list is about LuaTeX use in general, every
LuaTeX-related question is welcome.  Of course, since Diederick's
question is about the packages that are developed precisely on
lualatex-dev, it would probably be answered faster there; on the other
hand, you all read this mailing-list, too, anyway ;-)

	Arthur

From patrick at gundla.ch  Mon Mar 29 09:31:14 2010
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 29 Mar 2010 09:31:14 +0200
Subject: [luatex] On or off topic?
Message-ID: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>

Hello out there,

there is a question about luaotfload and fontspec and the question is: is this discussion on topic on the luatex user's mailing list?

For me, reading a mailing list has the benefit of "knowing what are the current problems and developments in an area", so I welcome such questions, even if I have no clue what to answer. People will ask me in the future about things like these and then I can have a look in the mailing list archives. If a certain subject gets too dominant then a separation could make sense.

Just my 0.02?

Patrick



From taco at elvenkind.com  Mon Mar 29 09:34:56 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 29 Mar 2010 09:34:56 +0200
Subject: [luatex] package loaders
In-Reply-To: <4BAFF815.10708@elzevir.fr>
References: <4BAFF815.10708@elzevir.fr>
Message-ID: <4BB05820.5000703@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Hi,
> 
> Here are two suggestions concerning the kpse package loaders, with patches.

I've applied slashify-or-not.patch, with a few modifications.
I also added code to disable loaders[4] under --safer mode.

Thanks,
Taco

From dcnieho at gmail.com  Mon Mar 29 10:14:18 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Mon, 29 Mar 2010 16:14:18 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <20100329054524.GB2283@khaled-laptop>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
Message-ID: <803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>

Dear Khaled,

>
> You are missing luaextra package, http://github.com/mpg/luaextra, I
> forgot to mention it, sorry.
>

hmm, it seems the directory for this package
(C:\texlive\2009\texmf-dist\tex\luatex\luatextra) is not very clean.
It is mixed with something called luatextra (notice the t in 4th
position). At first I simply emptied the directory and replaced its
contents with what i got from github (and docstrip), but that didnt
work (luatex just didnt do anything anymore after loading some
packages, no message and no cpu activity). So i reinstalled the
luatextra package using tlmgr and then copied over all the files. Now
it works..

Cool, that did the trick! I was able to execute the mkluatexfontdb.lua
script now as you said (just run lua(la)tex on it, is that the right
way to do it?).

Then, it appears it did not create anything (but no error messages, it
just returned at about 75%, see below), maybe because there is no
directory 'luatex-cache' in my $TEXMFVAR. Instead of testing that, I
called the script again, asking it to dump its output in directory
'.'. Then I manually created the directory and copied the
otf-names.lua file in there. Now it works beautifully, my fonts are
found (lualatex ate up almost 960 MB during the run btw :P).

Next up, I'll be testing fontspec, I want to use my font for math as
well, at least for the roman and greek glyphs, not for the operators
and such. Lets see if i can get that to work! Those issues I will post
on the lualatex-dev list.

Best,
Dee

From dcnieho at gmail.com  Mon Mar 29 10:21:44 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Mon, 29 Mar 2010 16:21:44 +0800
Subject: [luatex] On or off topic?
In-Reply-To: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>
References: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>
Message-ID: <803fcee31003290121t14c7b158v108b8e29118cea55@mail.gmail.com>

Dear All,

As an outsider who wants to try out luatex to compile his latex
document, this seemed like the right list. I have zero context
experience for now, though I realize thats where the main development
effort comes from so it might be the main interest of many readers of
this list.

As LuaTeX gets better known and more popular, many people will be
trying to compile their LaTeX documents on LuaTeX and more such
questions will crop up. It might indeed be good to prepare an
infrastructure for that.

Best,
Dee

On Mon, Mar 29, 2010 at 3:31 PM, Patrick Gundlach <patrick at gundla.ch> wrote:
> Hello out there,
>
> there is a question about luaotfload and fontspec and the question is: is this discussion on topic on the luatex user's mailing list?
>
> For me, reading a mailing list has the benefit of "knowing what are the current problems and developments in an area", so I welcome such questions, even if I have no clue what to answer. People will ask me in the future about things like these and then I can have a look in the mailing list archives. If a certain subject gets too dominant then a separation could make sense.
>
> Just my 0.02?
>
> Patrick
>
>
>


From dcnieho at gmail.com  Mon Mar 29 10:28:20 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Mon, 29 Mar 2010 16:28:20 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
Message-ID: <803fcee31003290128u5a8fb50cgac5f96167cd92375@mail.gmail.com>

Dear Khaled,

On Mon, Mar 29, 2010 at 4:14 PM, Diederick C. Niehorster
<dcnieho at gmail.com> wrote:
> Then, it appears it did not create anything (but no error messages, it
> just returned at about 75%, see below),

Whoops, forgot to paste the output below:

Best,
Dee
---
C:\texlive\2009\texmf-dist\tex\luatex\luaotfload>lualatex mkluatexfontdb.lua

luaotfload | generating font names database.
luaotfload | scanning TEXMF and OS fonts:
[=>                                                                            ]
[==>                                                                           ]
[===>                                                                          ]
[...]
[========================================================>                     ]
[=========================================================>                    ]
[===========================================================>                  ]


C:\texlive\2009\texmf-dist\tex\luatex\luaotfload>lualatex
mkluatexfontdb.lua -d .

luaotfload | generating font names database.
luaotfload | scanning TEXMF and OS fonts:
[=>                                                                            ]
[==>                                                                           ]
[===>                                                                          ]
[...]
[=========================================================================>    ]
[==========================================================================>   ]
[============================================================================> ]

luaotfload | 934 fonts in 338 families in the database
luaotfload | saved font names database in ./otfl-names.lua

From elie.roux at telecom-bretagne.eu  Mon Mar 29 10:36:42 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Mon, 29 Mar 2010 11:36:42 +0300
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
Message-ID: <eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>

2010/3/29 Diederick C. Niehorster <dcnieho at gmail.com>:
>
> Then, it appears it did not create anything (but no error messages, it
> just returned at about 75%, see below), maybe because there is no
> directory 'luatex-cache' in my $TEXMFVAR.

Hello,

can you please sent the ouptut of 'texlua mkluatexfontdb.lua -vvv'
please? The -vvv option increases the log level.

Thank you,
-- 
Elie

From taco at elvenkind.com  Mon Mar 29 11:23:54 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 29 Mar 2010 11:23:54 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
Message-ID: <4BB071AA.9050709@elvenkind.com>

Diederick C. Niehorster wrote:
> otf-names.lua file in there. Now it works beautifully, my fonts are
> found (lualatex ate up almost 960 MB during the run btw :P).

This is excessive (unless you are loading lots of CJK fonts), but it is
not so easy to see why it happens without your input file.

Best wishes,
Taco

From arthur.reutenauer at normalesup.org  Mon Mar 29 11:27:12 2010
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 29 Mar 2010 11:27:12 +0200
Subject: [luatex] On or off topic?
In-Reply-To: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>
References: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>
Message-ID: <20100329092712.GH2399@phare.normalesup.org>

> For me, reading a mailing list has the benefit of "knowing what are the current problems and developments in an area", so I welcome such questions, even if I have no clue what to answer.

  Pretty much the point I was trying to make. Thanks, Patrick :-)

	Arfthur

From mpg at elzevir.fr  Mon Mar 29 13:32:49 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 29 Mar 2010 13:32:49 +0200
Subject: [luatex] package loaders
In-Reply-To: <4BB05820.5000703@elvenkind.com>
References: <4BAFF815.10708@elzevir.fr> <4BB05820.5000703@elvenkind.com>
Message-ID: <4BB08FE1.6070500@elzevir.fr>

Taco Hoekwater a ?crit :
> I've applied slashify-or-not.patch, with a few modifications.
> I also added code to disable loaders[4] under --safer mode.
> 
Great, thanks.

Manuel.

From zappathustra at free.fr  Mon Mar 29 13:39:43 2010
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 29 Mar 2010 13:39:43 +0200
Subject: [luatex] the son of trouble in the output routine.
In-Reply-To: <4BAE2B5A.4010006@elvenkind.com>
References: <4BAD039A.40103@free.fr> <4BAD0BDD.3080008@elvenkind.com>
	<4BAE2B5A.4010006@elvenkind.com>
Message-ID: <1269862783.4bb0917fee59f@imp.free.fr>

Thanks for the repair!

Selon Taco Hoekwater <taco at elvenkind.com>:

> Taco Hoekwater wrote:
> > Paul Isambert wrote:
> >> Damn. I forgot to mention one important thing: if you turn the 4-line
> >> paragraph into a 5-line one, i.e. if you kill the widow, everything
> >> works fine (the title appears after the paragraph, etc.)
> >> Paul
> >
> > Thanks for the report, I will look into this.
>
> Found and fixed (took me a long time to find it). The bug was introduced
> during commit #3417: * Some experimental tweaking of buildpage_filter.
>
> What this experiment actually did was: it split the adding of a new
> (line) box to the vertical list into separate steps for
>
> a. the already waiting contributions
> b. any \adjust pre stuff from the box
> c. the box
> d. any \adjust stuff from the box
>
> This split introduced extra calls to the page builder, which then
> resulted in the bug. So, the experiment is now reverted.
>
> Best wishes,
> Taco
>



From mpg at elzevir.fr  Mon Mar 29 13:43:59 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Mon, 29 Mar 2010 13:43:59 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
Message-ID: <4BB0927F.5040402@elzevir.fr>

Diederick C. Niehorster a ?crit :
> Dear Khaled,
> 
>> You are missing luaextra package, http://github.com/mpg/luaextra, I
>> forgot to mention it, sorry.
>>
> 
> hmm, it seems the directory for this package
> (C:\texlive\2009\texmf-dist\tex\luatex\luatextra) is not very clean.
> It is mixed with something called luatextra (notice the t in 4th
> position).

It just so happens the packages have been split recently (like yesterday) so
things are cleaner now :-)

> At first I simply emptied the directory and replaced its
> contents with what i got from github (and docstrip), but that didnt
> work (luatex just didnt do anything anymore after loading some
> packages, no message and no cpu activity). So i reinstalled the
> luatextra package using tlmgr and then copied over all the files. Now
> it works..
> 
Due to the split up, if you install luatextra (with a t) from master, then you
also need luaextra (no t) and luatexbase which are now in independent
repositories. Besides, I'm currently doing a few changes to luatexbase and
luatextra (t) which break backwards compatibility, so I recommend not to install
them from master until further notice, but rather use the TDS-ready zip I
prepared at

http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-stable.tds.zip

If your really want to install from git, use tag 0.1 of luatexbase and tag 0.96
of luatextra (t) with master from luaextra (no t).

Manuel.


From mpg at elzevir.fr  Mon Mar 29 13:53:38 2010
From: mpg at elzevir.fr (=?ISO-8859-1?Q?Manuel_P=E9gouri=E9-Gonnard?=)
Date: Mon, 29 Mar 2010 13:53:38 +0200
Subject: [luatex] On or off topic?
In-Reply-To: <20100329092712.GH2399@phare.normalesup.org>
References: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>
	<20100329092712.GH2399@phare.normalesup.org>
Message-ID: <4BB094C2.6040606@elzevir.fr>

Arthur Reutenauer a ?crit :
>> For me, reading a mailing list has the benefit of "knowing what are the 
>> current problems and developments in an area", so I welcome such questions,
>> even if I have no clue what to answer.
> 
> Pretty much the point I was trying to make. Thanks, Patrick :-)>

Your point seems quite valid to me, and I understand not everyone is willing to
subscribe to yet another list just to "know what's going on".

OTOH some discussions can lead to pretty long technical developments, and I just
don't want Taco to be bothered with a lot of messages centred on macros as
opposed to the engine itself.

An alternative solution is that bug report against (and discussion specifically
about) packages go to lualatex-dev to avoid producing "noise" here, but that
lualatex developpers regularly post short notices of what's going on.

Taco, please tell us what you think.

Manuel.

From taco at elvenkind.com  Mon Mar 29 14:18:05 2010
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 29 Mar 2010 14:18:05 +0200
Subject: [luatex] On or off topic?
In-Reply-To: <4BB094C2.6040606@elzevir.fr>
References: <1DB26955-FC2C-43B8-9CBB-4FEB51E29739@gundla.ch>	<20100329092712.GH2399@phare.normalesup.org>
	<4BB094C2.6040606@elzevir.fr>
Message-ID: <4BB09A7D.1000209@elvenkind.com>

Manuel P?gouri?-Gonnard wrote:
> Arthur Reutenauer a ?crit :
>>> For me, reading a mailing list has the benefit of "knowing what are the 
>>> current problems and developments in an area", so I welcome such questions,
>>> even if I have no clue what to answer.
>> Pretty much the point I was trying to make. Thanks, Patrick :-)>
> 
> Your point seems quite valid to me, and I understand not everyone is willing to
> subscribe to yet another list just to "know what's going on".
> 
> OTOH some discussions can lead to pretty long technical developments, and I just
> don't want Taco to be bothered with a lot of messages centred on macros as
> opposed to the engine itself.
> 
> An alternative solution is that bug report against (and discussion specifically
> about) packages go to lualatex-dev to avoid producing "noise" here, but that
> lualatex developpers regularly post short notices of what's going on.
> 
> Taco, please tell us what you think.

I think lualatex messages on this list are on-topic as long as they
actually deal with luatex packages, after all that is why we have a
users list now as well as the dev list. I consider this list is similar
to the xetex list in that respect (non-luatex latex questions should
go to latex-l or c.t.t.).

However, I may coose not to read latex threads, so if my action is
required and I do not reply, it would be wise to forward a message
to dev-luatex or create an actual bug report.

Best wishes,
Taco

From dcnieho at gmail.com  Tue Mar 30 02:25:52 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 08:25:52 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
Message-ID: <803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>

On Mon, Mar 29, 2010 at 4:36 PM, ?lie Roux
<elie.roux at telecom-bretagne.eu> wrote:
> can you please sent the ouptut of 'texlua mkluatexfontdb.lua -vvv'
> please? The -vvv option increases the log level.

Hi ?lie,

I first updated luatextra, luaextra and luatexbase per message from mpg below.
Turns out that now at least, otfl-names.lua is created succesfully in
C:\Documents and
Settings\DCN\.texlive2009\texmf-var\luatex-cache\latex\names, instead
of C:\texlive\2009\texmf-var\luatex-cache\latex\names.

When I give the extra --sys switch, execution does not finish
correctly, although no error message is produced. otfl-names.lua in
C:\texlive\2009\texmf-var\luatex-cache\latex\names is empty and
otfl-names.lua in my personal directory is not touched. Log attached.

I cant test if LuaTeX runs correctly on the version installed in my
personal directory, as compilation crashes after I applied mpg's
update.

Best,
Dee
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mkluatexfontdb.log
Type: application/octet-stream
Size: 116117 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100330/1a91b8c0/attachment-0001.obj>

From dcnieho at gmail.com  Tue Mar 30 02:27:21 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 08:27:21 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB071AA.9050709@elvenkind.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB071AA.9050709@elvenkind.com>
Message-ID: <803fcee31003291727v3f064509m38e0ae66064c7a0f@mail.gmail.com>

On Mon, Mar 29, 2010 at 5:23 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Diederick C. Niehorster wrote:
>>
>> otf-names.lua file in there. Now it works beautifully, my fonts are
>> found (lualatex ate up almost 960 MB during the run btw :P).
>
> This is excessive (unless you are loading lots of CJK fonts), but it is
> not so easy to see why it happens without your input file.

Heh, I read somewhere it consumes a lot of memory, so didn't think too
much of it. Once i can compile documents again, I'll test with some
different fonts and report some results (plus the input file).

Best,
Dee

From mpg at elzevir.fr  Tue Mar 30 02:33:57 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Tue, 30 Mar 2010 02:33:57 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>	<20100329054524.GB2283@khaled-laptop>	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>	<eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
	<803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
Message-ID: <4BB146F5.3020204@elzevir.fr>

Diederick C. Niehorster a ?crit :
> I cant test if LuaTeX runs correctly on the version installed in my
> personal directory, as compilation crashes

Hum, could you please be more precise? Compilation of what, crashes how (error
messages, etc)?

Thanks,
Manuel.

From dcnieho at gmail.com  Tue Mar 30 02:34:36 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 08:34:36 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB0927F.5040402@elzevir.fr>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB0927F.5040402@elzevir.fr>
Message-ID: <803fcee31003291734r3f0ef04bx997fcaf49df43c1d@mail.gmail.com>

On Mon, Mar 29, 2010 at 7:43 PM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
>
> It just so happens the packages have been split recently (like yesterday) so
> things are cleaner now :-)

Nice :)

>> At first I simply emptied the directory and replaced its
>> contents with what i got from github (and docstrip), but that didnt
>> work (luatex just didnt do anything anymore after loading some
>> packages, no message and no cpu activity). So i reinstalled the
>> luatextra package using tlmgr and then copied over all the files. Now
>> it works..
>>
> Due to the split up, if you install luatextra (with a t) from master, then you
> also need luaextra (no t) and luatexbase which are now in independent
> repositories. Besides, I'm currently doing a few changes to luatexbase and
> luatextra (t) which break backwards compatibility, so I recommend not to install
> them from master until further notice, but rather use the TDS-ready zip I
> prepared at
>
> http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-stable.tds.zip

Hmm, I deleted the old luatextra folder and then unzipped into texmf.
ran mktexlsr. This crashes upon document compilation:
---- (from log-file)
(c:/texlive/2009/texmf-dist/tex/luatex/luatexbase/luatexbase-cctb.sty
Package: luatexbase-cctb 2010/03/26 v0.1 Catcodetable allocation for LuaTeX (mp
g)
\lltxb at catcodetable@alloc=\count123
\CatcodeTableIniTeX=\luatexcatcodetable1
\CatcodeTableString=\luatexcatcodetable2
\CatcodeTableOther=\luatexcatcodetable3
\CatcodeTableLaTeX=\luatexcatcodetable4
\CatcodeTableLaTeXAtLetter=\luatexcatcodetable5
\CatcodeTableExpl=\luatexcatcodetable6

! LuaTeX error <\directlua >:1: attempt to call field 'catcodetable_do_shortcut
s' (a nil value)
stack traceback:
	<\directlua >:1: in main chunk.
l.166 ...ua{luatextra.catcodetable_do_shortcuts()}
-----

> If your really want to install from git, use tag 0.1 of luatexbase and tag 0.96
> of luatextra (t) with master from luaextra (no t).

This tag seems to be from before the split? At least, luaextra is
still in the luatextra (t) branch.

Since you're making non-breaking changes, guess I'll have to wait till
those are finished? No rush, but let me know :)

Best,
Dee


From mpg at elzevir.fr  Tue Mar 30 02:39:38 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Tue, 30 Mar 2010 02:39:38 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB146F5.3020204@elzevir.fr>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>	<20100329054524.GB2283@khaled-laptop>	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>	<eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
	<803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
	<4BB146F5.3020204@elzevir.fr>
Message-ID: <4BB1484A.6090009@elzevir.fr>

Manuel P?gouri?-Gonnard a ?crit :
> Diederick C. Niehorster a ?crit :
>> I cant test if LuaTeX runs correctly on the version installed in my
>> personal directory, as compilation crashes
> 
> Hum, could you please be more precise? Compilation of what, crashes how (error
> messages, etc)?
> 
Ok, just saw your other messages, investigating.

m

From mpg at elzevir.fr  Tue Mar 30 03:49:07 2010
From: mpg at elzevir.fr (=?UTF-8?B?TWFudWVsIFDDqWdvdXJpw6ktR29ubmFyZA==?=)
Date: Tue, 30 Mar 2010 03:49:07 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003291734r3f0ef04bx997fcaf49df43c1d@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>	<20100329054524.GB2283@khaled-laptop>	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>	<4BB0927F.5040402@elzevir.fr>
	<803fcee31003291734r3f0ef04bx997fcaf49df43c1d@mail.gmail.com>
Message-ID: <4BB15893.3050707@elzevir.fr>

Diederick C. Niehorster a ?crit :
> Hmm, I deleted the old luatextra folder and then unzipped into texmf.
> ran mktexlsr. This crashes upon document compilation:
> ---- (from log-file)
> [...]

Thanks for the report. Well, it's embarrassing, I mistakenly used master (not
0.1) of luatexbase in the zip. A correct zip is at:

http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-current.tds.zip

This time, I carefully tested it :-)

>> If your really want to install from git, use tag 0.1 of luatexbase and tag 0.96
>> of luatextra (t) with master from luaextra (no t).
> 
> This tag seems to be from before the split? At least, luaextra is
> still in the luatextra (t) branch.
> 
Right, luatextra/0.96 is after the luatexbase split out, but before luaextra. I
made a new tag 0.97 to account for the splitting. So, to sum up:

luatextra/previously = luatexbase/0.1 + luatextra/0.96
                     = luatexbase/0.1 + luaextra/master + luatextra/0.97

Manuel.


From dcnieho at gmail.com  Tue Mar 30 04:22:40 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 10:22:40 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB15893.3050707@elzevir.fr>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB0927F.5040402@elzevir.fr>
	<803fcee31003291734r3f0ef04bx997fcaf49df43c1d@mail.gmail.com>
	<4BB15893.3050707@elzevir.fr>
Message-ID: <803fcee31003291922v38cb8d12n367b0623656327e7@mail.gmail.com>

Hi Manuel,

Thanks, that did it!

Best,
Dee

On Tue, Mar 30, 2010 at 9:49 AM, Manuel P?gouri?-Gonnard <mpg at elzevir.fr> wrote:
> Diederick C. Niehorster a ?crit :
>> Hmm, I deleted the old luatextra folder and then unzipped into texmf.
>> ran mktexlsr. This crashes upon document compilation:
>> ---- (from log-file)
>> [...]
>
> Thanks for the report. Well, it's embarrassing, I mistakenly used master (not
> 0.1) of luatexbase in the zip. A correct zip is at:
>
> http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-current.tds.zip
>
> This time, I carefully tested it :-)
>
>>> If your really want to install from git, use tag 0.1 of luatexbase and tag 0.96
>>> of luatextra (t) with master from luaextra (no t).
>>
>> This tag seems to be from before the split? At least, luaextra is
>> still in the luatextra (t) branch.
>>
> Right, luatextra/0.96 is after the luatexbase split out, but before luaextra. I
> made a new tag 0.97 to account for the splitting. So, to sum up:
>
> luatextra/previously = luatexbase/0.1 + luatextra/0.96
> ? ? ? ? ? ? ? ? ? ? = luatexbase/0.1 + luaextra/master + luatextra/0.97
>
> Manuel.
>
>


From dcnieho at gmail.com  Tue Mar 30 05:12:38 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 11:12:38 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <4BB071AA.9050709@elvenkind.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB071AA.9050709@elvenkind.com>
Message-ID: <803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>

Hi Taco,

On Mon, Mar 29, 2010 at 5:23 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
> Diederick C. Niehorster wrote:
>>
>> otf-names.lua file in there. Now it works beautifully, my fonts are
>> found (lualatex ate up almost 960 MB during the run btw :P).
>
> This is excessive (unless you are loading lots of CJK fonts), but it is
> not so easy to see why it happens without your input file.

I've managed to get it up to 1270 MB in the last run now. A little
testing revealed that it really depends on the font indeed. When I run
with Arno Pro, an OpenType font containing roman, greek and cyrillic
in a wide variety of glyphs (sc, swash, etc) spread over 32 OpenType
fonts, I see such memory eating.

When I however use the Latin Modern opentype fonts or Tex Gyre Heros,
memory usage stays below 200 MB. Input file attached, ran with
lualatex. You'll need the new fontspec to run this correctly, see
http://github.com/wspr/fontspec. You can run with latin modern by
commenting out lines 15--17. Uncomment any of the lines to try those
different fonts.

This leads me to another point, for Khaled I guess. When I try to
compile with Futura Std (or Adobe Caslon Pro / Adobe Garamond Pro for
that matter), I get errors in fontspec (I think). last part of the log
so you can see how far it gets (with XeTeX it compiles fine):

-----
Defining \msg_text > fontspec/set-scale:xxxx on line 1844
Defining \msg_text > fontspec/setup-math:xxxx on line 1848

fontspec.cfg loaded.
(./fontspec.cfg))
! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:85: atte
mpt to compare nil with number.
<to be read again>
                   \let
l.17 ...ing=tex-text,Ligatures=Common]{Futura Std}
-----

Best,
Dee
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sample.tex
Type: application/x-tex
Size: 2523 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100330/18164caf/attachment-0001.tex>

From dcnieho at gmail.com  Tue Mar 30 05:47:01 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 11:47:01 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB071AA.9050709@elvenkind.com>
	<803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>
Message-ID: <803fcee31003292047i79f3e99dyd1e262ccd632a640@mail.gmail.com>

And the pdf output, should that be helpful..

Best,
Dee

On Tue, Mar 30, 2010 at 11:12 AM, Diederick C. Niehorster
<dcnieho at gmail.com> wrote:
> Hi Taco,
>
> On Mon, Mar 29, 2010 at 5:23 PM, Taco Hoekwater <taco at elvenkind.com> wrote:
>> Diederick C. Niehorster wrote:
>>>
>>> otf-names.lua file in there. Now it works beautifully, my fonts are
>>> found (lualatex ate up almost 960 MB during the run btw :P).
>>
>> This is excessive (unless you are loading lots of CJK fonts), but it is
>> not so easy to see why it happens without your input file.
>
> I've managed to get it up to 1270 MB in the last run now. A little
> testing revealed that it really depends on the font indeed. When I run
> with Arno Pro, an OpenType font containing roman, greek and cyrillic
> in a wide variety of glyphs (sc, swash, etc) spread over 32 OpenType
> fonts, I see such memory eating.
>
> When I however use the Latin Modern opentype fonts or Tex Gyre Heros,
> memory usage stays below 200 MB. Input file attached, ran with
> lualatex. You'll need the new fontspec to run this correctly, see
> http://github.com/wspr/fontspec. You can run with latin modern by
> commenting out lines 15--17. Uncomment any of the lines to try those
> different fonts.
>
> This leads me to another point, for Khaled I guess. When I try to
> compile with Futura Std (or Adobe Caslon Pro / Adobe Garamond Pro for
> that matter), I get errors in fontspec (I think). last part of the log
> so you can see how far it gets (with XeTeX it compiles fine):
>
> -----
> Defining \msg_text > fontspec/set-scale:xxxx on line 1844
> Defining \msg_text > fontspec/setup-math:xxxx on line 1848
>
> fontspec.cfg loaded.
> (./fontspec.cfg))
> ! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:85: atte
> mpt to compare nil with number.
> <to be read again>
> ? ? ? ? ? ? ? ? ? \let
> l.17 ...ing=tex-text,Ligatures=Common]{Futura Std}
> -----
>
> Best,
> Dee
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sample.pdf
Type: application/pdf
Size: 91864 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20100330/701791c1/attachment-0001.pdf>

From elie.roux at telecom-bretagne.eu  Tue Mar 30 10:05:23 2010
From: elie.roux at telecom-bretagne.eu (=?UTF-8?Q?=C3=89lie_Roux?=)
Date: Tue, 30 Mar 2010 11:05:23 +0300
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
	<803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
Message-ID: <eba574421003300105v6f2a9eb1t3bb3ee7e078920cf@mail.gmail.com>

2010/3/30 Diederick C. Niehorster <dcnieho at gmail.com>:
>
> When I give the extra --sys switch, execution does not finish
> correctly, although no error message is produced. otfl-names.lua in
> C:\texlive\2009\texmf-var\luatex-cache\latex\names is empty and
> otfl-names.lua in my personal directory is not touched. Log attached.

Hello,

I must say it's extremely strange... do you have room on the partition
containing C:\texlive ?

Thank you,
-- 
Elie

From dcnieho at gmail.com  Tue Mar 30 10:11:29 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 16:11:29 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <eba574421003300105v6f2a9eb1t3bb3ee7e078920cf@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<eba574421003290136v6cc0a7c0meeb0e102b58d6db6@mail.gmail.com>
	<803fcee31003291725w6b561f91wbebb8b2042f93f23@mail.gmail.com>
	<eba574421003300105v6f2a9eb1t3bb3ee7e078920cf@mail.gmail.com>
Message-ID: <803fcee31003300111i2eb6d211r519a14ddfeeacdfa@mail.gmail.com>

Hi ?lie,

Yup, 80GB (they're on the same partition).

I believe everything is the updated versions, specifically i am using:

The master copy of luaotfload of two days ago and the lua(t)extra, etc
from here: http://tug.org/~mpg/packages/luatextra+luatexbase+luaextra-current.tds.zip.

Best,
Dee

On Tue, Mar 30, 2010 at 4:05 PM, ?lie Roux
<elie.roux at telecom-bretagne.eu> wrote:
> 2010/3/30 Diederick C. Niehorster <dcnieho at gmail.com>:
>>
>> When I give the extra --sys switch, execution does not finish
>> correctly, although no error message is produced. otfl-names.lua in
>> C:\texlive\2009\texmf-var\luatex-cache\latex\names is empty and
>> otfl-names.lua in my personal directory is not touched. Log attached.
>
> Hello,
>
> I must say it's extremely strange... do you have room on the partition
> containing C:\texlive ?
>
> Thank you,
> --
> Elie
>


From khaledhosny at eglug.org  Tue Mar 30 14:35:49 2010
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 30 Mar 2010 14:35:49 +0200
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB071AA.9050709@elvenkind.com>
	<803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>
Message-ID: <20100330123549.GC2934@khaled-laptop>

On Tue, Mar 30, 2010 at 11:12:38AM +0800, Diederick C. Niehorster wrote:
> This leads me to another point, for Khaled I guess. When I try to
> compile with Futura Std (or Adobe Caslon Pro / Adobe Garamond Pro for
> that matter), I get errors in fontspec (I think). last part of the log
> so you can see how far it gets (with XeTeX it compiles fine):
> 
> -----
> Defining \msg_text > fontspec/set-scale:xxxx on line 1844
> Defining \msg_text > fontspec/setup-math:xxxx on line 1848
> 
> fontspec.cfg loaded.
> (./fontspec.cfg))
> ! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:85: atte
> mpt to compare nil with number.
> <to be read again>
>                    \let
> l.17 ...ing=tex-text,Ligatures=Common]{Futura Std}
> -----

I only have Futura Std here and your document compiles just fine. BTW,
`Mapping=tex-text` makes no sense with luatex, better use `Ligatures=TeX`
which will internally do the 'right thing' for luatex and xetex.

Regards,
 Khaled

-- 
 Khaled Hosny
 Arabic localiser and member of Arabeyes.org team
 Free font developer

From dcnieho at gmail.com  Tue Mar 30 14:47:09 2010
From: dcnieho at gmail.com (Diederick C. Niehorster)
Date: Tue, 30 Mar 2010 20:47:09 +0800
Subject: [luatex] [luaotfload & fontspec] trunk errors
In-Reply-To: <20100330123549.GC2934@khaled-laptop>
References: <803fcee31003281852m2b31d6a4n84dbaf1c2bfd1333@mail.gmail.com>
	<20100329054524.GB2283@khaled-laptop>
	<803fcee31003290114t2da880a2kc44cdd217efc3a27@mail.gmail.com>
	<4BB071AA.9050709@elvenkind.com>
	<803fcee31003292012j6febf800nc2b4e0f0dfab2367@mail.gmail.com>
	<20100330123549.GC2934@khaled-laptop>
Message-ID: <803fcee31003300547g363ab58aga1c1465d98439909@mail.gmail.com>

On Tue, Mar 30, 2010 at 8:35 PM, Khaled Hosny <khaledhosny at eglug.org> wrote:
> On Tue, Mar 30, 2010 at 11:12:38AM +0800, Diederick C. Niehorster wrote:
>> This leads me to another point, for Khaled I guess. When I try to
>> compile with Futura Std (or Adobe Caslon Pro / Adobe Garamond Pro for
>> that matter), I get errors in fontspec (I think). last part of the log
>> so you can see how far it gets (with XeTeX it compiles fine):
>>
>> -----
>> Defining \msg_text > fontspec/set-scale:xxxx on line 1844
>> Defining \msg_text > fontspec/setup-math:xxxx on line 1848
>>
>> fontspec.cfg loaded.
>> (./fontspec.cfg))
>> ! LuaTeX error ...9/texmf-dist/tex/luatex/luaotfload/otfl-font-nms.lua:85: atte
>> mpt to compare nil with number.
>> <to be read again>
>> ? ? ? ? ? ? ? ? ? ?\let
>> l.17 ...ing=tex-text,Ligatures=Common]{Futura Std}
>> -----
>
> I only have Futura Std here and your document compiles just fine. BTW,
> `Mapping=tex-text` makes no sense with luatex, better use `Ligatures=TeX`
> which will internally do the 'right thing' for luatex and xetex.
>
> Regards,
> ?Khaled

Hmm, I am having weird problem with luaotfload and the functions
therein. Some font in otfl-names.lua work, others don't... Also,
sometimes some trouble building otfl-names.lua. See the lualatex-dev
list for more on this issue, as it cropped up as part of fontspec
trouble.

Best,
Dee


