From khaledhosny at eglug.org  Wed Feb  1 16:09:18 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 1 Feb 2012 17:09:18 +0200
Subject: [luatex] small script to change initial letter forms
In-Reply-To: <4F28617F.70709@web.de>
References: <4F2590CC.1070203@web.de>
 <20120130073921.AED8CA6413@smtp3-g21.free.fr>
 <4F26EBEC.1050309@web.de>
 <20120131065933.06743A6386@smtp3-g21.free.fr>
 <4F28617F.70709@web.de>
Message-ID: <20120201150918.GC3054@khaled-laptop>

On Tue, Jan 31, 2012 at 10:47:43PM +0100, Pablo Rodr?guez wrote:
> On 01/31/2012 07:59 AM, Paul Isambert wrote:
> > Pablo Rodr?guez <oinos at web.de> a ?crit:
> >> [...]
> >> Thanks for the reply, Paul.
> >>
> >> I'm afraid that the feature file might be easy to create, but in order
> >> to make use of it you have to edit the font files (not allowed by
> >> copyright law [digital fonts are protected as computer programs).
> > 
> > Patrick has answered to that, and I suppose you will be following that
> > road (if you manage to do it in ConTeXt, and I can't see why you
> > wouldn't).
> 
> Thank you very much for your help, Paul.
> 
> Just for the record, the ConTeXt command is the following:
> 
> \definefontfeature[default][default][script=latn,featurefile={myligs.fea}]
> 
> Another question would be to generate a feature file that works with
> initial and medial/final glyphs. (I wrote one, but it doesn't work ;-))

If you are using init/fina features, it will only work with
Arabic/Syriac and similar scripts where it is needed for basic shaping,
most OpenType engines (including the one Hans wrote for LuaTeX) don't
support them for other scripts. However, you can use contextual
substitution to implement the word boundary logic into your OpenType
code, but that is a bit tricky.

Regards,
 Khaled

From till-heilmann at uiowa.edu  Thu Feb  2 16:59:11 2012
From: till-heilmann at uiowa.edu (Heilmann, Till)
Date: Thu, 2 Feb 2012 15:59:11 +0000
Subject: [luatex] ActualText attribute for hyphenated words
Message-ID: <1803C1CF-49AB-4204-AD53-FC86F43BB670@uiowa.edu>

This may be a feature request (or simply a stupid question).

Some PDF viewers can't find words hyphenated at the end of a line because, well, they contain a hyphen. Acrobat doesn't suffer from this limitation but Apple's Preview and derived programs, for instance, do. So my question is this:

Is it possible/desirable to let the LuaTeX PDF generator automatically tag words which are hyphenated at the end of line with a matching /ActualText attribute (so that the sequence of glyphs "hyphen- ation", for example, is internally represented as the sequence of characters 'hyphenation')? That would make sense from a linguistic viewpoint because the display of a text in a PDF is strictly presentational and may differ from its lexical and grammatical structure. It would also ensure that you can search for and find words in a LuaTeX-generated PDF with almost any viewer.

Thanks
Till
-- 
Dr. Till A. Heilmann
Obermann Fellow-in-Residence, Spring 2012

The University of Iowa
Obermann Center for Advanced Studies
111 Church St
Iowa City IA 52242
United States of America


From patrick at gundla.ch  Thu Feb  2 18:43:47 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 2 Feb 2012 18:43:47 +0100
Subject: [luatex] ActualText attribute for hyphenated words
In-Reply-To: <1803C1CF-49AB-4204-AD53-FC86F43BB670@uiowa.edu>
References: <1803C1CF-49AB-4204-AD53-FC86F43BB670@uiowa.edu>
Message-ID: <D34B6F7F-7E77-4846-A2ED-89D32D689CDD@gundla.ch>

Hello Till,

(just for the record: this comes from a discussion on tex.sx: http://tex.stackexchange.com/q/43033/243 )

> Is it possible/desirable to let the LuaTeX PDF generator automatically tag words which are hyphenated at the end of line with a matching /ActualText attribute (so that the sequence of glyphs "hyphen- ation", for example, is internally represented as the sequence of characters 'hyphenation')? That would make sense from a linguistic viewpoint because the display of a text in a PDF is strictly presentational and may differ from its lexical and grammatical structure. It would also ensure that you can search for and find words in a LuaTeX-generated PDF with almost any viewer.

This might be achieved by using LuaTeX's ability to modify a node list after line breaking. But I am not totally sure if one can modify the text to look like
----------------------------------------
BT
/Span << /E (hyphenation) >>

BDC
(hyphen-) Tj

EMC
(ation) Tj /Span 

ET
----------------------------------------

Patrick

From zappathustra at free.fr  Fri Feb  3 11:20:55 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 3 Feb 2012 11:20:55 +0100
Subject: [luatex] ActualText attribute for hyphenated words
In-Reply-To: <D34B6F7F-7E77-4846-A2ED-89D32D689CDD@gundla.ch>
References: <1803C1CF-49AB-4204-AD53-FC86F43BB670@uiowa.edu>
 <D34B6F7F-7E77-4846-A2ED-89D32D689CDD@gundla.ch>
Message-ID: <20120203102055.B4ECEA6107@smtp3-g21.free.fr>

Patrick Gundlach <patrick at gundla.ch> a ?crit:
> 
> Hello Till,
> 
> (just for the record: this comes from a discussion on tex.sx: http://tex.stackexchange.com/q/43033/243 )
> 
> > Is it possible/desirable to let the LuaTeX PDF generator automatically tag words which are hyphenated at the end of line with a matching /ActualText attribute (so that the sequence of glyphs "hyphen- ation", for example, is internally represented as the sequence of characters 'hyphenation')? That would make sense from a linguistic viewpoint because the display of a text in a PDF is strictly presentational and may differ from its lexical and grammatical structure. It would also ensure that you can search for and find words in a LuaTeX-generated PDF with almost any viewer.
> 
> This might be achieved by using LuaTeX's ability to modify a node list after line breaking.

Building on this idea, see code below.

I suppose it will fail miserably in many cases, and it should be extended
to handle non-ASCII characters; also, although Acrobat, Evince and Xpdf
now all find hyphenated words (the latter two could not do that before),
they don't highlight them properly. Finally, this will work only for
those viewer which implement /ActualText, and perhaps this is not the
case with Till's previewer.

In the meanwhile, I've discovered something very nice: Acrobat for
Debian doesn't lock the document, so you can keep it open and compile
too. That was not possible under Windows!

Best,
Paul


local HBOX = node.id"hlist"
local DISC = node.id"disc"
local GLYF = node.id"glyph"
local GLUE = node.id"glue"
local KERN = node.id"kern"

local function collect (n, dir)
  local text = ""
  local limit
  while n and
        (n.id == GLYF or n.id == KERN and n.subtype == 0) do
    if n.id == GLYF then
      local c = string.char(n.char)
      text = dir == "prev" and (c .. text) or (text .. c)
      limit = n
    end
    n = n[dir]
  end
  return text, limit
end

callback.register("post_linebreak_filter",
function (head)
  for line in node.traverse_id(HBOX, head) do
    local last = node.slide(line.head)
    if last.id == GLUE and last.subtype == 9 then
      last = last.prev
    end
    if last and last.id == DISC then
      local nextline = line.next
      while nextline do
        if nextline.id == HBOX then
          break
        else
          nextline = nextline.next
        end
      end
      if nextline then
        local prevnode = last.prev.prev
        local prevtext, l1 = collect(last.prev.prev, "prev")
        local n = nextline.head
        if n.id == GLUE and n.subtype == 8 then
          n = n.next
        end
        local nexttext, l2 = collect(n, "next")
        local lit1, lit2 = node.new(8, 8), node.new(8, 8)
        lit1.mode, lit2.mode = 2, 2
        lit1.data = "/Span << /ActualText (" .. prevtext .. nexttext .. ") >> BDC"
        lit2.data = "EMC"
        node.insert_before(line.head, l1, lit1)
        node.insert_after(nextline.head, l2, lit2)
      end
    end
  end
  return head
end)


From andreas.matthias at gmail.com  Mon Feb  6 21:16:35 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Mon, 06 Feb 2012 21:16:35 +0100
Subject: [luatex] void box
Message-ID: <32p509-9f5.ln1@fawkes.hogwarts>

What is the lua equivalent of a void box? I.e. how to
create a void box in lua?


Ciao
Andreas


From zappathustra at free.fr  Tue Feb  7 07:58:52 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 7 Feb 2012 07:58:52 +0100
Subject: [luatex] void box
In-Reply-To: <32p509-9f5.ln1@fawkes.hogwarts>
References: <32p509-9f5.ln1@fawkes.hogwarts>
Message-ID: <20120207065853.557F3A617D@smtp3-g21.free.fr>

Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
> 
> What is the lua equivalent of a void box? I.e. how to
> create a void box in lua?

I'm not sure that it can be done, strictly speaking. By a void box, I
suppose you mean an unassigned box register (i.e. \voidb at x); now that
I think of it, it is strange that \unhbox\voidb at x is allowed in the
first place (if nothing is assigned to the register, how can you unhbox
it?).

On the Lua side, an unassigned box register (e.g. tex.box["voidb at x"])
returns nil (unlike an unassigned count register, which returns 0), so
I'd say the Lua equivalent of a void box is nil. Of course, if you're
just looking for an empty box, that's easy (except you have to specify
if it's an horizontal or vertical box): node.new(node.id"hlist", 2) or
node.new(node.id"vlist", 2) (the second argument is optional but later
it might be useful to know that this is a handmade box).

Best,
Paul


From Robin.Fairbairns at cl.cam.ac.uk  Tue Feb  7 08:31:14 2012
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 07 Feb 2012 07:31:14 +0000
Subject: [luatex] void box
In-Reply-To: Your message of Tue, 07 Feb 2012 07:58:52 +0100.
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
Message-ID: <7028.1328599874@cl.cam.ac.uk>

Paul Isambert <zappathustra at free.fr> wrote:

> Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
> > 
> > What is the lua equivalent of a void box? I.e. how to
> > create a void box in lua?
> 
> I'm not sure that it can be done, strictly speaking. By a void box, I
> suppose you mean an unassigned box register (i.e. \voidb at x); now that
> I think of it, it is strange that \unhbox\voidb at x is allowed in the
> first place (if nothing is assigned to the register, how can you unhbox
> it?).

what do you mean by "unassigned"?

of course, without macros of some sort, \voidb at x won't be assigned
(i.e., the name won't mean anything).  i've not looked at context, but
both plain and latex execute \newbox \voidb at x, but in both cases they
only ever use it -- so nothing has been put into the virgin box.

does luatex not actually allocate a register until its first use?  if
not, it will have to allocate \voidb at x pretty often, in two of the "big
three" formats i know of.

robin
the un-knowledgeable


From dirk.laurie at gmail.com  Tue Feb  7 08:59:50 2012
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Tue, 7 Feb 2012 09:59:50 +0200
Subject: [luatex] void box
In-Reply-To: <32p509-9f5.ln1@fawkes.hogwarts>
References: <32p509-9f5.ln1@fawkes.hogwarts>
Message-ID: <CABcj=tnRmwOdbGw=-XOfN+w2wXYyhjmEktrsesMihjHhMnJ+cw@mail.gmail.com>

Op 6 februari 2012 22:16 schreef Andreas Matthias <
andreas.matthias at gmail.com> het volgende:

> What is the lua equivalent of a void box? I.e. how to
> create a void box in lua?
>
> An empty table?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20120207/f977a23d/attachment.html>

From zappathustra at free.fr  Tue Feb  7 09:40:37 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 7 Feb 2012 09:40:37 +0100
Subject: [luatex] void box
In-Reply-To: <7028.1328599874@cl.cam.ac.uk>
References: <7028.1328599874@cl.cam.ac.uk>
Message-ID: <20120207084042.B47BBA6269@smtp3-g21.free.fr>

Robin Fairbairns <Robin.Fairbairns at cl.cam.ac.uk> a ?crit:
> 
> Paul Isambert <zappathustra at free.fr> wrote:
> 
> > Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
> > > 
> > > What is the lua equivalent of a void box? I.e. how to
> > > create a void box in lua?
> > 
> > I'm not sure that it can be done, strictly speaking. By a void box, I
> > suppose you mean an unassigned box register (i.e. \voidb at x); now that
> > I think of it, it is strange that \unhbox\voidb at x is allowed in the
> > first place (if nothing is assigned to the register, how can you unhbox
> > it?).
> 
> what do you mean by "unassigned"?
> 
> of course, without macros of some sort, \voidb at x won't be assigned
> (i.e., the name won't mean anything).  i've not looked at context, but
> both plain and latex execute \newbox \voidb at x, but in both cases they
> only ever use it -- so nothing has been put into the virgin box.
> 

(I'm not sure I understand exactly what you mean, but I'll try to answer
anyway.)

By "unassigned" I mean that no material has been assigned to the register;
the allocation part is strictly cosmetic. I wouldn't say that `nothing
has been put into the virgin box;' rather, there is no box at all (i.e.
it's not the same thing as the empty box \setbox<register>=\hbox{})

> does luatex not actually allocate a register until its first use?  if
> not, it will have to allocate \voidb at x pretty often, in two of the "big
> three" formats i know of.

The allocation is done alright, otherwise tex.box["voidb at x"] would
return an error; that it returns nil means that nothing has been
assigned to that particular register, i.e. it doesn't point to any
h/vlist node.

> robin
> the un-knowledgeable

Oh, come on, you're the FAQman!

Best,
Paul


From andreas.matthias at gmail.com  Tue Feb  7 18:48:39 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Tue, 07 Feb 2012 18:48:39 +0100
Subject: [luatex] void box
References: <32p509-9f5.ln1@fawkes.hogwarts>
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
Message-ID: <no4809-5p4.ln1@fawkes.hogwarts>

Paul Isambert wrote:

> Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
>> 
>> What is the lua equivalent of a void box? I.e. how to
>> create a void box in lua?
> 
> I'm not sure that it can be done, strictly speaking. By a void box, I
> suppose you mean an unassigned box register (i.e. \voidb at x);

Yes, I was thinking of \voidb at x.

> now that
> I think of it, it is strange that \unhbox\voidb at x is allowed in the
> first place (if nothing is assigned to the register, how can you unhbox
> it?).

That's what amazed me too.

> On the Lua side, an unassigned box register (e.g. tex.box["voidb at x"])
> returns nil (unlike an unassigned count register, which returns 0), so
> I'd say the Lua equivalent of a void box is nil. 

Yes, but you can neither append a node to nil nor pack nil with
node.hpack. So, it is not too equivalent, is it?

> Of course, if you're
> just looking for an empty box, that's easy (except you have to specify
> if it's an horizontal or vertical box): node.new(node.id"hlist", 2) or
> node.new(node.id"vlist", 2) (the second argument is optional but later
> it might be useful to know that this is a handmade box).

Oh yes! Of course! One can create hlist nodes directly. I didn't
remember that. I was trying something like node.hpack(nil) which
didn't work.


Actually I was just looking for a simple node as a starting point
for a list of nodes which are generated in some kind of loop.
I think an hlist node is very suitable for this:


list = node.new(node.id('hlist'))
curr = list

for i=0,5 do
    n = node.new(node.id('glyph'))
    n.font=1
    n.char=97+i

    curr.next = n
    curr = n
end



Ciao
Andreas


From andreas.matthias at gmail.com  Tue Feb  7 20:31:10 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Tue, 07 Feb 2012 20:31:10 +0100
Subject: [luatex] Calling TeX primitives inside lua?
Message-ID: <uoa809-5h5.ln1@fawkes.hogwarts>

Is it possible to use TeX primitive like \showbox (or the
C-function show_box()) from within lua? If not, will this eventually
be possible? Or should I write my own showbox in lua?


Ciao
Andreas


From patrick at gundla.ch  Tue Feb  7 22:52:56 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 7 Feb 2012 22:52:56 +0100
Subject: [luatex] void box
In-Reply-To: <no4809-5p4.ln1@fawkes.hogwarts>
References: <32p509-9f5.ln1@fawkes.hogwarts>
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
 <no4809-5p4.ln1@fawkes.hogwarts>
Message-ID: <9890F36A-639C-4107-950C-DFBDF5D2C32E@gundla.ch>


Am 07.02.2012 um 18:48 schrieb Andreas Matthias:

> 
> Actually I was just looking for a simple node as a starting point
> for a list of nodes which are generated in some kind of loop.
> I think an hlist node is very suitable for this:
> 
> 
> list = node.new(node.id('hlist'))

you can say: node.new("hlist")


> curr = list
> 
> for i=0,5 do
>    n = node.new(node.id('glyph'))
>    n.font=1
>    n.char=97+i
> 
>    curr.next = n
>    curr = n
> end

that's fine, but you don't use 'list', right?

you can create a node chain and use node.hpack(mychain) to get a hbox. You don't need one from start.

Patrick



From patrick at gundla.ch  Tue Feb  7 22:55:20 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 7 Feb 2012 22:55:20 +0100
Subject: [luatex] Calling TeX primitives inside lua?
In-Reply-To: <uoa809-5h5.ln1@fawkes.hogwarts>
References: <uoa809-5h5.ln1@fawkes.hogwarts>
Message-ID: <FEEBD22D-7A9A-4E6F-B9D7-5368CAF4EB80@gundla.ch>


Am 07.02.2012 um 20:31 schrieb Andreas Matthias:

> Is it possible to use TeX primitive like \showbox (or the
> C-function show_box()) from within lua?

I don't know for sure, but my answer would be 'no'.


> If not, will this eventually
> be possible? Or should I write my own showbox in lua?

You can always use TeX to do that. Just jump back to TeX mode and use \showbox.

And, if you're sick of showbox and want something more graphical, see

https://gist.github.com/556247

Patrick



From andreas.matthias at gmail.com  Tue Feb  7 23:53:08 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Tue, 07 Feb 2012 23:53:08 +0100
Subject: [luatex] void box
References: <32p509-9f5.ln1@fawkes.hogwarts>
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
 <no4809-5p4.ln1@fawkes.hogwarts>
 <9890F36A-639C-4107-950C-DFBDF5D2C32E@gundla.ch>
Message-ID: <kjm809-m5m.ln1@fawkes.hogwarts>

Patrick Gundlach wrote:

> Am 07.02.2012 um 18:48 schrieb Andreas Matthias:
> 
>> 
>> Actually I was just looking for a simple node as a starting point
>> for a list of nodes which are generated in some kind of loop.
>> I think an hlist node is very suitable for this:
>> 
>> 
>> list = node.new(node.id('hlist'))
> 
> you can say: node.new("hlist")
> 
> 
>> curr = list
>> 
>> for i=0,5 do
>>    n = node.new(node.id('glyph'))
>>    n.font=1
>>    n.char=97+i
>> 
>>    curr.next = n
>>    curr = n
>> end
> 
> that's fine, but you don't use 'list', right?

You mean the very first node of the list. Yes, it's just the head
of the list with no special meaning.

> you can create a node chain and use node.hpack(mychain) to get a hbox. You don't need one from start.

Well, if the first node is missing, I have to check inside the
loop for each created node whether or not it becomes the head
of the list. I think the code is much clearer without additional
if-clauses. And one can always remove the very first node
afterwards. -- Okay, maybe not a big advantage. But this was
the reason why I started to look for a suitable header of a
node list, i.e. an empty or void box. And I was astonished to
realize that I didn't know what a \voidb at x really was.


Ciao
Andreas


From andreas.matthias at gmail.com  Wed Feb  8 00:24:34 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Wed, 08 Feb 2012 00:24:34 +0100
Subject: [luatex] Calling TeX primitives inside lua?
References: <uoa809-5h5.ln1@fawkes.hogwarts>
 <FEEBD22D-7A9A-4E6F-B9D7-5368CAF4EB80@gundla.ch>
Message-ID: <jeo809-umf.ln1@fawkes.hogwarts>

Patrick Gundlach wrote:

> Am 07.02.2012 um 20:31 schrieb Andreas Matthias:
> 
>> Is it possible to use TeX primitive like \showbox (or the
>> C-function show_box()) from within lua?
> 
> I don't know for sure, but my answer would be 'no'.
> 
> 
>> If not, will this eventually
>> be possible? Or should I write my own showbox in lua?
> 
> You can always use TeX to do that. Just jump back to TeX mode and use \showbox.

Jumping to and fro just for sake of debugging is cumbersome.

> And, if you're sick of showbox and want something more graphical, see
> 
> https://gist.github.com/556247

This is a very nice tool. I like it.


Ciao
Andreas


From patrick at gundla.ch  Wed Feb  8 00:42:21 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 8 Feb 2012 00:42:21 +0100
Subject: [luatex] Calling TeX primitives inside lua?
In-Reply-To: <jeo809-umf.ln1@fawkes.hogwarts>
References: <uoa809-5h5.ln1@fawkes.hogwarts>
 <FEEBD22D-7A9A-4E6F-B9D7-5368CAF4EB80@gundla.ch>
 <jeo809-umf.ln1@fawkes.hogwarts>
Message-ID: <DAADD7C4-1EE3-43C7-98C2-5AEEFA38A592@gundla.ch>


Am 08.02.2012 um 00:24 schrieb Andreas Matthias:

> Jumping to and fro just for sake of debugging is cumbersome.

not necessarily. You can define a "directtex()" method for jumping from Lua into TeX mode. See

http://tex.stackexchange.com/a/20905/243

But this has a few drawbacks (error handling, for example). And I don't know how well coroutines are supported on a future version of Lua/TeX/Jit.


Patrick



From zappathustra at free.fr  Wed Feb  8 07:43:40 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 8 Feb 2012 07:43:40 +0100
Subject: [luatex] void box
In-Reply-To: <kjm809-m5m.ln1@fawkes.hogwarts>
References: <32p509-9f5.ln1@fawkes.hogwarts>
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
 <no4809-5p4.ln1@fawkes.hogwarts>
 <9890F36A-639C-4107-950C-DFBDF5D2C32E@gundla.ch>
 <kjm809-m5m.ln1@fawkes.hogwarts>
Message-ID: <20120208064340.D92FBA6251@smtp3-g21.free.fr>

Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
> 
> Patrick Gundlach wrote:
> > you can say: node.new("hlist")

Thank you Patrick, I always forget that.

> > 
> > 
> >> curr = list
> >> 
> >> for i=0,5 do
> >>    n = node.new(node.id('glyph'))
> >>    n.font=1
> >>    n.char=97+i
> >> 
> >>    curr.next = n
> >>    curr = n
> >> end
> > 
> 
> Well, if the first node is missing, I have to check inside the
> loop for each created node whether or not it becomes the head
> of the list. I think the code is much clearer without additional
> if-clauses. And one can always remove the very first node
> afterwards. -- Okay, maybe not a big advantage. But this was
> the reason why I started to look for a suitable header of a
> node list, i.e. an empty or void box. And I was astonished to
> realize that I didn't know what a \voidb at x really was.

Actually, you can do without a dummy head and without conditionals:

local list
for i = 0, 5 do
  local n = node.new("glyph")
  n.font  = 1
  n.char  = 97+i
  list    = node.insert_after(list, nil, n)
end

That's because node.insert_after can take `nil' as its first argument
(in which case it simply returns the `added' node) ... a functionality
I didn't understand what it was good for until now!

(I've added local's because I didn't know whether you're naturally light
on them, which is *very bad*, or you just omit them for examples.)

Best,
Paul


From andreas.matthias at gmail.com  Wed Feb  8 17:37:15 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Wed, 08 Feb 2012 17:37:15 +0100
Subject: [luatex] void box
References: <32p509-9f5.ln1@fawkes.hogwarts>
 <20120207065853.557F3A617D@smtp3-g21.free.fr>
 <no4809-5p4.ln1@fawkes.hogwarts>
 <9890F36A-639C-4107-950C-DFBDF5D2C32E@gundla.ch>
 <kjm809-m5m.ln1@fawkes.hogwarts>
 <20120208064340.D92FBA6251@smtp3-g21.free.fr>
Message-ID: <ruka09-id4.ln1@fawkes.hogwarts>

Paul Isambert wrote:

> Actually, you can do without a dummy head and without conditionals:
> 
> local list
> for i = 0, 5 do
>   local n = node.new("glyph")
>   n.font  = 1
>   n.char  = 97+i
>   list    = node.insert_after(list, nil, n)
> end
> 
> That's because node.insert_after can take `nil' as its first argument
> (in which case it simply returns the `added' node) ... a functionality
> I didn't understand what it was good for until now!

That's nice. Thanks! I didn't know that the second argument may be
nil as well! I think the documentation should be changed because
it says: "It is your responsibility to make sure that current is
really part of that list."

So, I was actually not looking for a void box but for insert_after. :)

> (I've added local's because I didn't know whether you're naturally light
> on them, which is *very bad*, or you just omit them for examples.)

I know. It was just for simplicity.


Ciao
Andreas


From kip at thevertigo.com  Fri Feb 10 05:59:40 2012
From: kip at thevertigo.com (Kip Warner)
Date: Thu, 09 Feb 2012 20:59:40 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1324869174.13205.18.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
Message-ID: <1328849980.23524.75.camel@kip-laptop>

On Sun, 2011-12-25 at 19:12 -0800, Kip Warner wrote:
> I am witnessing a segfault in luatex when it attempts to compile my book
> on mips64el hardware. Compiling a trivial hello world, however, is fine.
> I don't think it is an endian issue since this hardware is little endian
> which.
> 
> I am using luatex beta 0.71.0-2011122518 (rev 4358) and I have attached
> the output of its execution with a hopefully useful stacktrace. 

Hey list,

I was wondering if LuaTeX happens to have an issue tracker somewhere
where I can make note of the aforementioned issue I raised in December
of last year along with any relevant logs?

Here is the complete message along with the stacktrace:
http://tug.org/mailman/htdig/luatex/2011-December/003367.html

Thank you,

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120209/edcf70c4/attachment.bin>

From luigi.scarso at gmail.com  Fri Feb 10 07:41:27 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 10 Feb 2012 07:41:27 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1328849980.23524.75.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
Message-ID: <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>

On Fri, Feb 10, 2012 at 5:59 AM, Kip Warner <kip at thevertigo.com> wrote:
> On Sun, 2011-12-25 at 19:12 -0800, Kip Warner wrote:
>> I am witnessing a segfault in luatex when it attempts to compile my book
>> on mips64el hardware. Compiling a trivial hello world, however, is fine.
>> I don't think it is an endian issue since this hardware is little endian
>> which.
>>
>> I am using luatex beta 0.71.0-2011122518 (rev 4358) and I have attached
>> the output of its execution with a hopefully useful stacktrace.
>
> Hey list,
>
> I was wondering if LuaTeX happens to have an issue tracker somewhere
> where I can make note of the aforementioned issue I raised in December
> of last year along with any relevant logs?
>
> Here is the complete message along with the stacktrace:
> http://tug.org/mailman/htdig/luatex/2011-December/003367.html

http://tracker.luatex.org

-- 
luigi

From kip at thevertigo.com  Fri Feb 10 23:21:56 2012
From: kip at thevertigo.com (Kip Warner)
Date: Fri, 10 Feb 2012 14:21:56 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
Message-ID: <1328912516.23524.84.camel@kip-laptop>

On Fri, 2012-02-10 at 07:41 +0100, luigi scarso wrote:
> http://tracker.luatex.org

Thanks Luigi.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120210/2d584ffc/attachment.bin>

From luigi.scarso at gmail.com  Sat Feb 11 10:33:39 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 11 Feb 2012 10:33:39 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1328912516.23524.84.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
Message-ID: <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>

On Fri, Feb 10, 2012 at 11:21 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Fri, 2012-02-10 at 07:41 +0100, luigi scarso wrote:
>> http://tracker.luatex.org
>
> Thanks Luigi.
>
> --
> Kip Warner -- Software Engineer
> OpenPGP encrypted/signed mail preferred
> http://www.thevertigo.com

Do you have any experience on this
http://www.aurel32.net/info/debian_mips_qemu.php
?

-- 
luigi

From kip at thevertigo.com  Mon Feb 13 22:43:45 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 13 Feb 2012 13:43:45 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
Message-ID: <1329169425.2984.3.camel@kip-laptop>

On Sat, 2012-02-11 at 10:33 +0100, luigi scarso wrote:
> Do you have any experience on this
> http://www.aurel32.net/info/debian_mips_qemu.php
> ?

I'm afraid not. But if it helps, I have actual hardware we can test on
and I can even provide you with a shell account on it if you need it.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120213/2421bb03/attachment.bin>

From luigi.scarso at gmail.com  Mon Feb 13 22:58:41 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 13 Feb 2012 22:58:41 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329169425.2984.3.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
Message-ID: <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>

On Mon, Feb 13, 2012 at 10:43 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Sat, 2012-02-11 at 10:33 +0100, luigi scarso wrote:
>> Do you have any experience on this
>> http://www.aurel32.net/info/debian_mips_qemu.php
>> ?
>
> I'm afraid not. But if it helps, I have actual hardware we can test on
> and I can even provide you with a shell account on it if you need it.
 I will see if I'm able to emulate a mips here.


-- 
luigi

From taco at elvenkind.com  Tue Feb 14 09:41:38 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 14 Feb 2012 09:41:38 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
Message-ID: <4F3A1E42.6050802@elvenkind.com>

On 02/13/2012 10:58 PM, luigi scarso wrote:
> On Mon, Feb 13, 2012 at 10:43 PM, Kip Warner<kip at thevertigo.com>  wrote:
>> On Sat, 2012-02-11 at 10:33 +0100, luigi scarso wrote:
>>> Do you have any experience on this
>>> http://www.aurel32.net/info/debian_mips_qemu.php
>>> ?
>>
>> I'm afraid not. But if it helps, I have actual hardware we can test on
>> and I can even provide you with a shell account on it if you need it.
>   I will see if I'm able to emulate a mips here.

You would be emulating a mips32 though?

As I wrote in the tracker: if the problem is not an endianness issue,
perhaps the bug can be reproduced elsewhere with identical input. From
the mails so far, it looks like noone has tried that yet?

Best wishes,
Taco


From luigi.scarso at gmail.com  Tue Feb 14 09:58:44 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 14 Feb 2012 09:58:44 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <4F3A1E42.6050802@elvenkind.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
Message-ID: <CAG5iGsDxQXMk0xjBeSZN1CsRZY3zHZcVjajJcZb6q2JdeGo3ow@mail.gmail.com>

On Tue, Feb 14, 2012 at 9:41 AM, Taco Hoekwater <taco at elvenkind.com> wrote:
> On 02/13/2012 10:58 PM, luigi scarso wrote:
>>
>> On Mon, Feb 13, 2012 at 10:43 PM, Kip Warner<kip at thevertigo.com> ?wrote:
>>>
>>> On Sat, 2012-02-11 at 10:33 +0100, luigi scarso wrote:
>>>>
>>>> Do you have any experience on this
>>>> http://www.aurel32.net/info/debian_mips_qemu.php
>>>> ?
>>>
>>>
>>> I'm afraid not. But if it helps, I have actual hardware we can test on
>>> and I can even provide you with a shell account on it if you need it.
>>
>> ?I will see if I'm able to emulate a mips here.
>
>
> You would be emulating a mips32 though?
well, I don't know if I'm able with mips and if eventually will be ok
for Kip but I've done a similar job for armel and I would like to try.
>
> As I wrote in the tracker: if the problem is not an endianness issue,
> perhaps the bug can be reproduced elsewhere with identical input. From
> the mails so far, it looks like noone has tried that yet?
yes, it seems so --- I don't have the input and I'm running a 32bit
linux box. Quite improbable that I'm able to reproduce the bug, but
I'm always suspected of a seg. fault --- they are so rare in tex
implementations

-- 
luigi


From mojca.miklavec.lists at gmail.com  Tue Feb 14 13:30:15 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 14 Feb 2012 06:30:15 -0600
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <4F3A1E42.6050802@elvenkind.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
Message-ID: <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>

On Tue, Feb 14, 2012 at 02:41, Taco Hoekwater wrote:
>
>> ?I will see if I'm able to emulate a mips here.
>
> You would be emulating a mips32 though?

Kip is using mips64el hardware, but mipsel (32-bit) operating system.
So in theory they would be using the same architecture, only different
hardware.

Mojca


From zappathustra at free.fr  Wed Feb 15 09:02:26 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 15 Feb 2012 09:02:26 +0100
Subject: [luatex] The node returned by node.traverse().
Message-ID: <20120215080230.189A7A6239@smtp3-g21.free.fr>

Hello there,

I have a problem with the identity, so to speak, of nodes returned by
node.traverse(); I don't know if I'm missing something (perhaps related
to Lua rather than LuaTeX) or what. The following code should illustrate
the problem (I do not bother with breaks since there is only one node in
the list and one entry in the table):

%%%%%%%%%%%
\setbox0=\hbox{a}

\directlua{
  local head = tex.box[0].head
  local t = { [head] = true }
  for n in node.traverse(head) do
    texio.write_nl(tostring(t[n]))
    texio.write_nl(tostring(n == head))
    for a in pairs(t) do
      if a == n then
        texio.write_nl("They match!")
      end
    end
  end
}

\bye
%%%%%%%%%%%

This prints "nil/true/They match!"; the second and third messages show
that "n" is recognized as being the same thing as "head"; yet the first
message would show that this is not the case.

Am I overlooking something, or should I pay a visit to Bugtracking Palace?

Best,
Paul


From luigi.scarso at gmail.com  Wed Feb 15 14:32:13 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 15 Feb 2012 14:32:13 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <20120215080230.189A7A6239@smtp3-g21.free.fr>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
Message-ID: <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>

On Wed, Feb 15, 2012 at 9:02 AM, Paul Isambert <zappathustra at free.fr> wrote:
> Hello there,
>
> I have a problem with the identity, so to speak, of nodes returned by
> node.traverse(); I don't know if I'm missing something (perhaps related
> to Lua rather than LuaTeX) or what. The following code should illustrate
> the problem (I do not bother with breaks since there is only one node in
> the list and one entry in the table):
>
> %%%%%%%%%%%
> \setbox0=\hbox{a}
>
> \directlua{
> ?local head = tex.box[0].head
> ?local t = { [head] = true }
> ?for n in node.traverse(head) do
> ? ?texio.write_nl(tostring(t[n]))
> ? ?texio.write_nl(tostring(n == head))
> ? ?for a in pairs(t) do
> ? ? ?if a == n then
> ? ? ? ?texio.write_nl("They match!")
> ? ? ?end
> ? ?end
> ?end
> }
The key of t is head,  and head is a userdata.

 n==head is managed by __eq(n,head)  handler so can happen that
__eq(n,head) is true based on some considerations of n and head.

On the other side rawequal(n,head) gives false
so n and head have not the same identity (can be a different address,
but we don't have a
way to print addresses in Lua).
With
local head_copy = head
rawequal(head_copy,head)
gives true , i.e head_copy and head have the same identity.
(and of course head_copy == head  is true )

As far I know, keys are based on  identities, so t[n] and t[head] differs.

-- 
luigi


From zappathustra at free.fr  Wed Feb 15 14:44:48 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 15 Feb 2012 14:44:48 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
Message-ID: <20120215134451.7E343A6263@smtp3-g21.free.fr>

luigi scarso <luigi.scarso at gmail.com> a ?crit:
> 
> On Wed, Feb 15, 2012 at 9:02 AM, Paul Isambert <zappathustra at free.fr> wrote:
> > Hello there,
> >
> > I have a problem with the identity, so to speak, of nodes returned by
> > node.traverse(); I don't know if I'm missing something (perhaps related
> > to Lua rather than LuaTeX) or what. The following code should illustrate
> > the problem (I do not bother with breaks since there is only one node in
> > the list and one entry in the table):
> >
> > %%%%%%%%%%%
> > \setbox0=\hbox{a}
> >
> > \directlua{
> > ?local head = tex.box[0].head
> > ?local t = { [head] = true }
> > ?for n in node.traverse(head) do
> > ? ?texio.write_nl(tostring(t[n]))
> > ? ?texio.write_nl(tostring(n == head))
> > ? ?for a in pairs(t) do
> > ? ? ?if a == n then
> > ? ? ? ?texio.write_nl("They match!")
> > ? ? ?end
> > ? ?end
> > ?end
> > }
> The key of t is head,  and head is a userdata.
> 
>  n==head is managed by __eq(n,head)  handler so can happen that
> __eq(n,head) is true based on some considerations of n and head.
> 
> On the other side rawequal(n,head) gives false
> so n and head have not the same identity (can be a different address,
> but we don't have a
> way to print addresses in Lua).
> With
> local head_copy = head
> rawequal(head_copy,head)
> gives true , i.e head_copy and head have the same identity.
> (and of course head_copy == head  is true )
> 
> As far I know, keys are based on  identities, so t[n] and t[head] differs.

Thank you Luigi; I'd thought about metatable magic but I hadn't considered
rawequal to make sure.

Now I should recast the question: why are "head" an "n" different? I
suppose the answer of course is: because node.traverse() doesn't really
return the node, but then what does it return and why?

Best,
Paul


From luigi.scarso at gmail.com  Wed Feb 15 19:34:18 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 15 Feb 2012 19:34:18 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <20120215134451.7E343A6263@smtp3-g21.free.fr>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
Message-ID: <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>

On Wed, Feb 15, 2012 at 2:44 PM, Paul Isambert <zappathustra at free.fr> wrote:
> luigi scarso <luigi.scarso at gmail.com> a ?crit:
>>
>> On Wed, Feb 15, 2012 at 9:02 AM, Paul Isambert <zappathustra at free.fr> wrote:
>> > Hello there,
>> >
>> > I have a problem with the identity, so to speak, of nodes returned by
>> > node.traverse(); I don't know if I'm missing something (perhaps related
>> > to Lua rather than LuaTeX) or what. The following code should illustrate
>> > the problem (I do not bother with breaks since there is only one node in
>> > the list and one entry in the table):
>> >
>> > %%%%%%%%%%%
>> > \setbox0=\hbox{a}
>> >
>> > \directlua{
>> > ?local head = tex.box[0].head
>> > ?local t = { [head] = true }
>> > ?for n in node.traverse(head) do
>> > ? ?texio.write_nl(tostring(t[n]))
>> > ? ?texio.write_nl(tostring(n == head))
>> > ? ?for a in pairs(t) do
>> > ? ? ?if a == n then
>> > ? ? ? ?texio.write_nl("They match!")
>> > ? ? ?end
>> > ? ?end
>> > ?end
>> > }
>> The key of t is head, ?and head is a userdata.
>>
>> ?n==head is managed by __eq(n,head) ?handler so can happen that
>> __eq(n,head) is true based on some considerations of n and head.
>>
>> On the other side rawequal(n,head) gives false
>> so n and head have not the same identity (can be a different address,
>> but we don't have a
>> way to print addresses in Lua).
>> With
>> local head_copy = head
>> rawequal(head_copy,head)
>> gives true , i.e head_copy and head have the same identity.
>> (and of course head_copy == head ?is true )
>>
>> As far I know, keys are based on ?identities, so t[n] and t[head] differs.
>
> Thank you Luigi; I'd thought about metatable magic but I hadn't considered
> rawequal to make sure.
>
> Now I should recast the question: why are "head" an "n" different? I
> suppose the answer of course is: because node.traverse() doesn't really
> return the node, but then what does it return and why?
>
> Best,
> Paul
>
another pointer to the same object, but for  the key its address is
used, not the content
so we avoid collisions:
\starttext
\setbox0=\hbox{a}
\startluacode
  local head = tex.box[0].head
  local head1 = tex.box[0].head
  local t1={[head]="I'm head!",[head1]="I'm head1!"}
  print("rawequal(head,head1):", rawequal(head,head1))
  print("t1[head]="..t1[head],"t1[head1]="..t1[head1])
  print("head==head1?", head==head1)
  head1=head
  print("rawequal(head,head1):", rawequal(head,head1))
  print("t1[head]="..t1[head],"t1[head1]="..t1[head1])
  print("head==head1?", head==head1)


 local t = { [head] = true }
  for n in node.traverse(head) do
    texio.write_nl(tostring(t[n]))
    texio.write_nl(tostring(n == head))
    for a in pairs(t) do
      if a == n then
        texio.write_nl("They match!")
      end
    end
  end
\stopluacode
\stoptext

gives

rawequal(head,head1):	false
t1[head]=I'm head!	t1[head1]=I'm head1!
head==head1?	true
rawequal(head,head1):	true
t1[head]=I'm head!	t1[head1]=I'm head!
head==head1?	true

nil
true
They match! )



-- 
luigi


From kip at thevertigo.com  Wed Feb 15 20:32:00 2012
From: kip at thevertigo.com (Kip Warner)
Date: Wed, 15 Feb 2012 11:32:00 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
Message-ID: <1329334320.3643.0.camel@kip-laptop>

On Tue, 2012-02-14 at 06:30 -0600, Mojca Miklavec wrote:
> Kip is using mips64el hardware, but mipsel (32-bit) operating system.
> So in theory they would be using the same architecture, only different
> hardware.
> 
> Mojca

Yes, good point.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120215/785de262/attachment.bin>

From luigi.scarso at gmail.com  Wed Feb 15 20:48:23 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 15 Feb 2012 20:48:23 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329334320.3643.0.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
Message-ID: <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>

On Wed, Feb 15, 2012 at 8:32 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Tue, 2012-02-14 at 06:30 -0600, Mojca Miklavec wrote:
>> Kip is using mips64el hardware, but mipsel (32-bit) operating system.
>> So in theory they would be using the same architecture, only different
>> hardware.
>>
>> Mojca
>
> Yes, good point.
which subarchictecture ?
http://www.debian.org/releases/stable/mipsel/ch02s01.html.en
-- 
luigi

From khaledhosny at eglug.org  Thu Feb 16 00:04:11 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 16 Feb 2012 01:04:11 +0200
Subject: [luatex] different text direction
In-Reply-To: <20120126231305.GD13262@gamma.logic.tuwien.ac.at>
References: <4F2171B4.1010009@FU-Berlin.DE>
 <20120126231305.GD13262@gamma.logic.tuwien.ac.at>
Message-ID: <20120215230411.GA6989@khaled-laptop>

On Fri, Jan 27, 2012 at 08:13:05AM +0900, Norbert Preining wrote:
> On Do, 26 Jan 2012, Herbert Voss wrote:
> > Why do I get the extra vertical space before bar?
> > my output with current live http://perce.de/temp/cjk.png
> 
> Different question, why is the spacing sooo bad? I am suprised.

Most likely because vertical metrics were not used; OpenType fonts have
different tables for horizontal and vertical metrics that the engine
should use according to text direction, but I doubt luatex (or whatever
layer is responsible for this) is doing anything special when
typesetting in vertical direction.

Someone needs to investigate OpenType vertical text layout model and
check what is missing at luatex side.

Regards,
 Khaled

From zappathustra at free.fr  Thu Feb 16 07:24:07 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 16 Feb 2012 07:24:07 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
Message-ID: <20120216062409.18CE7A619E@smtp3-g21.free.fr>

luigi scarso <luigi.scarso at gmail.com> a ?crit:
> 
> On Wed, Feb 15, 2012 at 2:44 PM, Paul Isambert <zappathustra at free.fr> wrote:
> > luigi scarso <luigi.scarso at gmail.com> a ?crit:
> >>
> >> On Wed, Feb 15, 2012 at 9:02 AM, Paul Isambert <zappathustra at free.fr> wrote:
> >> > Hello there,
> >> >
> >> > I have a problem with the identity, so to speak, of nodes returned by
> >> > node.traverse(); I don't know if I'm missing something (perhaps related
> >> > to Lua rather than LuaTeX) or what. The following code should illustrate
> >> > the problem (I do not bother with breaks since there is only one node in
> >> > the list and one entry in the table):
> >> >
> >> > %%%%%%%%%%%
> >> > \setbox0=\hbox{a}
> >> >
> >> > \directlua{
> >> > ?local head = tex.box[0].head
> >> > ?local t = { [head] = true }
> >> > ?for n in node.traverse(head) do
> >> > ? ?texio.write_nl(tostring(t[n]))
> >> > ? ?texio.write_nl(tostring(n == head))
> >> > ? ?for a in pairs(t) do
> >> > ? ? ?if a == n then
> >> > ? ? ? ?texio.write_nl("They match!")
> >> > ? ? ?end
> >> > ? ?end
> >> > ?end
> >> > }
> >> The key of t is head, ?and head is a userdata.
> >>
> >> ?n==head is managed by __eq(n,head) ?handler so can happen that
> >> __eq(n,head) is true based on some considerations of n and head.
> >>
> >> On the other side rawequal(n,head) gives false
> >> so n and head have not the same identity (can be a different address,
> >> but we don't have a
> >> way to print addresses in Lua).
> >> With
> >> local head_copy = head
> >> rawequal(head_copy,head)
> >> gives true , i.e head_copy and head have the same identity.
> >> (and of course head_copy == head ?is true )
> >>
> >> As far I know, keys are based on ?identities, so t[n] and t[head] differs.
> >
> > Thank you Luigi; I'd thought about metatable magic but I hadn't considered
> > rawequal to make sure.
> >
> > Now I should recast the question: why are "head" an "n" different? I
> > suppose the answer of course is: because node.traverse() doesn't really
> > return the node, but then what does it return and why?
> >
> > Best,
> > Paul
> >
> another pointer to the same object, but for  the key its address is
> used, not the content
> so we avoid collisions:

[...]

The C parlance eludes me, as you know, but reworded in Lua: "head" and
"head1" do not even point to the same userdata:

%%%%
\setbox0=\hbox{a}

\directlua{%
  local head = tex.box[0].head
  local head1 = tex.box[0].head
  getmetatable(head).__tostring = nil
  print(head, head1)
}

\bye
%%%%

This prints "userdata: 0x27521b8	userdata: 0x27520f8". Unfortunately,
there is no __WhenUsedAsIndex metamethod that would make "Table[head]"
equal to "Table[head1]". So I guess the only way to really get the
identity of a node (regardless of its prev and next) is something like

local function NodeNumber (n)
  return tostring(n):match("<%s+(%d+)%s+>")
end

which can then be used as an index, under the assumption that node
numbers are never reused.

Thank you Luigi,
Paul


From patrick at gundla.ch  Thu Feb 16 08:58:40 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 16 Feb 2012 08:58:40 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <20120216062409.18CE7A619E@smtp3-g21.free.fr>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
 <20120216062409.18CE7A619E@smtp3-g21.free.fr>
Message-ID: <61E36A5B-228C-4009-B315-B5DCDD30958F@gundla.ch>


> 
> local function NodeNumber (n)
>  return tostring(n):match("<%s+(%d+)%s+>")
> end
> 
> which can then be used as an index, under the assumption that node
> numbers are never reused.

Taco once wrote here

"This number uniquely identifies a node for as long as it stays
allocated, yes. If it is freed, a new node may have the same
number."

Patrick


From zappathustra at free.fr  Thu Feb 16 09:31:47 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 16 Feb 2012 09:31:47 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <61E36A5B-228C-4009-B315-B5DCDD30958F@gundla.ch>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
 <20120216062409.18CE7A619E@smtp3-g21.free.fr>
 <61E36A5B-228C-4009-B315-B5DCDD30958F@gundla.ch>
Message-ID: <20120216083149.09A9AA61BC@smtp3-g21.free.fr>

Patrick Gundlach <patrick at gundla.ch> a ?crit:
> 
> > 
> > local function NodeNumber (n)
> >  return tostring(n):match("<%s+(%d+)%s+>")
> > end
> > 
> > which can then be used as an index, under the assumption that node
> > numbers are never reused.
> 
> Taco once wrote here
> 
> "This number uniquely identifies a node for as long as it stays
> allocated, yes. If it is freed, a new node may have the same
> number."

Ah, I should have reread the Scriptures. Then I guess only attributes
may uniquely identify nodes... unless I humbly request a "uniqueid"
field present in all nodes, but that might not be extremely interesting
beside my particular problem.

Best,
Paul


From luigi.scarso at gmail.com  Thu Feb 16 11:09:32 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 16 Feb 2012 11:09:32 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <20120216062409.18CE7A619E@smtp3-g21.free.fr>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
 <20120216062409.18CE7A619E@smtp3-g21.free.fr>
Message-ID: <CAG5iGsD0etXKkx=QA_+oy6EZjA6ZV4e9--HWB0GW0XB-O2FCuA@mail.gmail.com>

On Thu, Feb 16, 2012 at 7:24 AM, Paul Isambert <zappathustra at free.fr> wrote:
> The C parlance eludes me, as you know, but reworded in Lua: "head" and
> "head1" do not even point to the same userdata:
>
> %%%%
> \setbox0=\hbox{a}
>
> \directlua{%
> ?local head = tex.box[0].head
> ?local head1 = tex.box[0].head
> ?getmetatable(head).__tostring = nil
> ?print(head, head1)
> }
>
> \bye
> %%%%
Hm, print(head,head1) is print(tostring(head),tostring(head1))
and tostring(head) gives the address of an internal "objects" used to
access the "raw userdata"
--- but has almost no practical use.
I mean that if the addresses differ than we cannot say that the "raw
userdata" are different .
I think to head and head1 as different "proxy objects" to access the
same raw userdata:
if rawequal(head,head1) is true than they are the same proxy object
and hence they manage the same raw userdata;
if rawequal(head,head1) is false than they are different proxy
objects, but they can manage the same raw userdata;
and if head == head1 is true than the raw userdata they manage is
viewed as equal.

At least, this is how I see these things.


-- 
luigi


From taco at docwolves.nl  Thu Feb 16 10:03:48 2012
From: taco at docwolves.nl (Taco Hoekwater)
Date: Thu, 16 Feb 2012 10:03:48 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <20120216083149.09A9AA61BC@smtp3-g21.free.fr>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
 <20120216062409.18CE7A619E@smtp3-g21.free.fr>
 <61E36A5B-228C-4009-B315-B5DCDD30958F@gundla.ch>
 <20120216083149.09A9AA61BC@smtp3-g21.free.fr>
Message-ID: <4F3CC674.8080404@docwolves.nl>

On 02/16/2012 09:31 AM, Paul Isambert wrote:
> Ah, I should have reread the Scriptures. Then I guess only attributes 
> may uniquely identify nodes... unless I humbly request a "uniqueid" 
> field present in all nodes, but that might not be extremely 
> interesting beside my particular problem. Best, Paul 
Sure, doable. Write a ticket?

Taco

From kip at thevertigo.com  Thu Feb 16 23:12:52 2012
From: kip at thevertigo.com (Kip Warner)
Date: Thu, 16 Feb 2012 14:12:52 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
Message-ID: <1329430372.2886.37.camel@kip-laptop>

On Wed, 2012-02-15 at 20:48 +0100, luigi scarso wrote:
> which subarchictecture ?
> http://www.debian.org/releases/stable/mipsel/ch02s01.html.en

Hey Luigi,

I believe it is none of them. The machine in question is a Lemote
YeeLoong. Loongson is apparently its own architecture.

In case it helps, here is the contents of /proc/cpuinfo.

$ cat /proc/cpuinfo
system type		: lemote-yeeloong-2f-8.9inches
processor		: 0
cpu model		: ICT Loongson-2 V0.3  FPU V0.1
BogoMIPS		: 797.00
wait instruction	: no
microsecond timers	: yes
tlb_entries		: 64
extra interrupt vector	: no
hardware watchpoint	: yes, count: 0, address/irw mask: []
ASEs implemented	:
shadow register sets	: 1
kscratch registers	: 0
core			: 0
VCED exceptions		: not available
VCEI exceptions		: not available

More information on the architecture here:

http://www.gnewsense.org/Projects/Lemote?action=recoverpass#TheCPU

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120216/b8ea988f/attachment.bin>

From zappathustra at free.fr  Fri Feb 17 07:58:34 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 17 Feb 2012 07:58:34 +0100
Subject: [luatex] The node returned by node.traverse().
In-Reply-To: <4F3CC674.8080404@docwolves.nl>
References: <20120215080230.189A7A6239@smtp3-g21.free.fr>
 <CAG5iGsCKWAWBwCA-md=y_BoZZNKKS5dVzSUtS3-zRra5x=-B9w@mail.gmail.com>
 <20120215134451.7E343A6263@smtp3-g21.free.fr>
 <CAG5iGsD5hKnX+wrukdOuWtO_OXOo71_oiVBSCr4+vWzR__6ZoQ@mail.gmail.com>
 <20120216062409.18CE7A619E@smtp3-g21.free.fr>
 <61E36A5B-228C-4009-B315-B5DCDD30958F@gundla.ch>
 <20120216083149.09A9AA61BC@smtp3-g21.free.fr> <4F3CC674.8080404@docwolves.nl>
Message-ID: <20120217065836.2A06CA6107@smtp3-g21.free.fr>

Taco Hoekwater <taco at docwolves.nl> a ?crit:
> 
> On 02/16/2012 09:31 AM, Paul Isambert wrote:
> > Ah, I should have reread the Scriptures. Then I guess only attributes 
> > may uniquely identify nodes... unless I humbly request a "uniqueid" 
> > field present in all nodes, but that might not be extremely 
> > interesting beside my particular problem. Best, Paul 
> Sure, doable. Write a ticket?

Done, thanks.
Paul


From luigi.scarso at gmail.com  Fri Feb 17 09:46:32 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2012 09:46:32 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329430372.2886.37.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
Message-ID: <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>

On Thu, Feb 16, 2012 at 11:12 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Wed, 2012-02-15 at 20:48 +0100, luigi scarso wrote:
>> which subarchictecture ?
>> http://www.debian.org/releases/stable/mipsel/ch02s01.html.en
>
> Hey Luigi,
>
> I believe it is none of them. The machine in question is a Lemote
> YeeLoong. Loongson is apparently its own architecture.
>
> In case it helps, here is the contents of /proc/cpuinfo.
>
> $ cat /proc/cpuinfo
> system type ? ? ? ? ? ? : lemote-yeeloong-2f-8.9inches
> processor ? ? ? ? ? ? ? : 0
> cpu model ? ? ? ? ? ? ? : ICT Loongson-2 V0.3 ?FPU V0.1
> BogoMIPS ? ? ? ? ? ? ? ?: 797.00
> wait instruction ? ? ? ?: no
> microsecond timers ? ? ?: yes
> tlb_entries ? ? ? ? ? ? : 64
> extra interrupt vector ?: no
> hardware watchpoint ? ? : yes, count: 0, address/irw mask: []
> ASEs implemented ? ? ? ?:
> shadow register sets ? ?: 1
> kscratch registers ? ? ?: 0
> core ? ? ? ? ? ? ? ? ? ?: 0
> VCED exceptions ? ? ? ? : not available
> VCEI exceptions ? ? ? ? : not available
>
> More information on the architecture here:
>
> http://www.gnewsense.org/Projects/Lemote?action=recoverpass#TheCPU
Hm I  have to see if there is some support for qemu, ( and even better
for cross-compilation).
From
http://en.wikipedia.org/wiki/Loongson

Unlike processors from Intel, Advanced Micro Devices or VIA
Technologies, Loongson does not support the x86 instruction set. The
processor's main operating system is GNU/Linux, while in theory any OS
with MIPS support should also work. For example, Windows CE was ported
to a Loongson-based system with minimal effort.[13] In 2010, Lemote
ported an Android distribution to the Loongson platform.[14]




-- 
luigi


From kip at thevertigo.com  Fri Feb 17 20:23:59 2012
From: kip at thevertigo.com (Kip Warner)
Date: Fri, 17 Feb 2012 11:23:59 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
Message-ID: <1329506639.2886.53.camel@kip-laptop>

On Fri, 2012-02-17 at 09:46 +0100, luigi scarso wrote:
> Hm I  have to see if there is some support for qemu, ( and even better
> for cross-compilation).
> From
> http://en.wikipedia.org/wiki/Loongson
> 
> Unlike processors from Intel, Advanced Micro Devices or VIA
> Technologies, Loongson does not support the x86 instruction set. The
> processor's main operating system is GNU/Linux, while in theory any OS
> with MIPS support should also work. For example, Windows CE was ported
> to a Loongson-based system with minimal effort.[13] In 2010, Lemote
> ported an Android distribution to the Loongson platform.[14]

Well, best of luck to you. I'll be out of town until Sunday night. Let
me know if you need me to do anything with the machine.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120217/3cdf4fc2/attachment.bin>

From luigi.scarso at gmail.com  Fri Feb 17 20:31:00 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2012 20:31:00 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329506639.2886.53.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
Message-ID: <CAG5iGsBsWpmKt1OKr4N1v_Orx0LkG7XZTGxkfTawzoVob0MYzw@mail.gmail.com>

On Fri, Feb 17, 2012 at 8:23 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Fri, 2012-02-17 at 09:46 +0100, luigi scarso wrote:
>> Hm I ?have to see if there is some support for qemu, ( and even better
>> for cross-compilation).
>> From
>> http://en.wikipedia.org/wiki/Loongson
>>
>> Unlike processors from Intel, Advanced Micro Devices or VIA
>> Technologies, Loongson does not support the x86 instruction set. The
>> processor's main operating system is GNU/Linux, while in theory any OS
>> with MIPS support should also work. For example, Windows CE was ported
>> to a Loongson-based system with minimal effort.[13] In 2010, Lemote
>> ported an Android distribution to the Loongson platform.[14]
>
> Well, best of luck to you. I'll be out of town until Sunday night. Let
> me know if you need me to do anything with the machine.
it seems that there are some materials, but also broken links.
But I don't need the machine now.
-- 
luigi


From luigi.scarso at gmail.com  Fri Feb 17 22:17:12 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 17 Feb 2012 22:17:12 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsBsWpmKt1OKr4N1v_Orx0LkG7XZTGxkfTawzoVob0MYzw@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBsWpmKt1OKr4N1v_Orx0LkG7XZTGxkfTawzoVob0MYzw@mail.gmail.com>
Message-ID: <CAG5iGsCjrty_7P-gCkBzq-xOMB9QmiT7TCG3JgG9hG36Ma8=iw@mail.gmail.com>

On Fri, Feb 17, 2012 at 8:31 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
> On Fri, Feb 17, 2012 at 8:23 PM, Kip Warner <kip at thevertigo.com> wrote:
>> On Fri, 2012-02-17 at 09:46 +0100, luigi scarso wrote:
>>> Hm I ?have to see if there is some support for qemu, ( and even better
>>> for cross-compilation).
>>> From
>>> http://en.wikipedia.org/wiki/Loongson
>>>
>>> Unlike processors from Intel, Advanced Micro Devices or VIA
>>> Technologies, Loongson does not support the x86 instruction set. The
>>> processor's main operating system is GNU/Linux, while in theory any OS
>>> with MIPS support should also work. For example, Windows CE was ported
>>> to a Loongson-based system with minimal effort.[13] In 2010, Lemote
>>> ported an Android distribution to the Loongson platform.[14]
>>
>> Well, best of luck to you. I'll be out of town until Sunday night. Let
>> me know if you need me to do anything with the machine.
Do you have an example to test ?


-- 
luigi


From luigi.scarso at gmail.com  Mon Feb 20 20:07:21 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 20 Feb 2012 20:07:21 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329506639.2886.53.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
Message-ID: <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>

On Fri, Feb 17, 2012 at 8:23 PM, Kip Warner <kip at thevertigo.com> wrote:
> On Fri, 2012-02-17 at 09:46 +0100, luigi scarso wrote:
>> Hm I ?have to see if there is some support for qemu, ( and even better
>> for cross-compilation).
>> From
>> http://en.wikipedia.org/wiki/Loongson
>>
>> Unlike processors from Intel, Advanced Micro Devices or VIA
>> Technologies, Loongson does not support the x86 instruction set. The
>> processor's main operating system is GNU/Linux, while in theory any OS
>> with MIPS support should also work. For example, Windows CE was ported
>> to a Loongson-based system with minimal effort.[13] In 2010, Lemote
>> ported an Android distribution to the Loongson platform.[14]
>
> Well, best of luck to you. I'll be out of town until Sunday night. Let
> me know if you need me to do anything with the machine.
>
> --
> Kip Warner -- Software Engineer
> OpenPGP encrypted/signed mail preferred
> http://www.thevertigo.com
Download files from
ftp.debian.org/debian/dists/wheezy/main/installer-mipsel/current/images/malta/netboot
and
http://cdimage.debian.org/debian-cd/6.0.4/mipsel/iso-dvd/

Install the system with

#qemu-img create -f raw mipsel.img 10G
#qemu-system-mips64el  -M malta -initrd initrd.gz -cpu 5Kc -kernel
vmlinux-2.6.32-5-4kc-malta -hda mipsel.img -append "root=/dev/ram
console=ttyS0" -nographic  -m 256
#exit

Copy then new kernel:
#mkdir temp
#modprobe nbd max_part=16
#qemu-nbd -c /dev/nbd0 mipsel.img
#partprobe /dev/nbd0
#mount /dev/nbd0p1 temp/
#cp temp/boot/vmlinux-2.6.32-5-5kc-malta .
#umount temp
#exit

Run the system:

#qemu-system-mips64el -M malta -cpu 5Kc -kernel
vmlinux-2.6.32-5-5kc-malta -hda mipsel.img -cdrom
debian-6.0.4-mipsel-DVD-1.iso -append "root=/dev/sda1 console=ttyS0"
-nographic -m 256 -redir tcp:2232::22
#exit
(cdrom is /dev/sr0, make a symlink  /cdrom -> /dev/sr0 ortherwise
apt-cdrom fails)

$> cat /proc/cpuinfo
system type		: MIPS Malta
processor		: 0
cpu model		: MIPS 5Kc V0.0
BogoMIPS		: 465.92
wait instruction	: yes
microsecond timers	: yes
tlb_entries		: 32
extra interrupt vector	: yes
hardware watchpoint	: yes, count: 1, address/irw mask: [0x0ff8]
ASEs implemented	:
shadow register sets	: 1
core			: 0
VCED exceptions		: not available
VCEI exceptions		: not available

Unfortunately Loongson froze qemu, and even malta is a bit instable.


Install luatex from svn and  compile with build.sh as usual

Compilation take ~8hours on my laptop
Intel(R) Core(TM)2 Duo CPU     T7250  @ 2.00GHz
4GByte.
It would be nice to have a cross-compiler.
(Maybe aboriginal
http://landley.net/aboriginal/
can help here)

Anyway at the end :
root at debian-mips64el:/opt/luatex/trunk/build/texk/web2c# ./luatex
warning: kpathsea: configuration file texmf.cnf not found in these
directories: /opt/luatex/trunk/build/texk/web2c:/opt/luatex/trunk/build/texk:/opt/luatex/trunk/build:/opt/luatex/trunk/build/texk/web2c/share/texmf-local/web2c:/opt/luatex/trunk/build/texk/share/texmf-local/web2c:/opt/luatex/trunk/build/share/texmf-local/web2c:/opt/luatex/trunk/build/texk/web2c/texmf-local/web2c:/opt/luatex/trunk/build/texk/texmf-local/web2c:/opt/luatex/trunk/build/texmf-local/web2c:/opt/luatex/trunk/build/texk/web2c/share/texmf/web2c:/opt/luatex/trunk/build/texk/share/texmf/web2c:/opt/luatex/trunk/build/share/texmf/web2c:/opt/luatex/trunk/build/texk/web2c/texmf/web2c:/opt/luatex/trunk/build/texk/texmf/web2c:/opt/luatex/trunk/build/texmf/web2c.
This is LuaTeX, Version beta-0.71.0-2012022010 (rev 4358)
**

I will eventually install context.
-- 
luigi


From khaledhosny at eglug.org  Mon Feb 20 23:52:25 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 21 Feb 2012 00:52:25 +0200
Subject: [luatex] The use of \delimeterfactor and \delimitershortfall with
 math accents
Message-ID: <20120220225225.GA18423@khaled-laptop>

Hi all,

While trying to implement support for extensible math accents in XeTeX,
I noticed that LuaTeX takes into account \delimeterfactor and
\delimitershortfall while computing the desired size of the accents
(mlist.w l.2195-2197), but this does not follow the MS Office
implementation nor TeX behaviour (not even plain TeX's faked accent
implantation of \overbrace), so I'm wondering why it is done that way
and wither it worth breaking compatibility with MS implementation or
not.

Regards,
 Khaled

From mojca.miklavec.lists at gmail.com  Tue Feb 21 03:10:42 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 20 Feb 2012 20:10:42 -0600
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
Message-ID: <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>

On Mon, Feb 20, 2012 at 13:07, luigi scarso wrote:
>
> Compilation take ~8hours on my laptop
> Intel(R) Core(TM)2 Duo CPU ? ? T7250 ?@ 2.00GHz
> 4GByte.
> It would be nice to have a cross-compiler.
> (Maybe aboriginal
> http://landley.net/aboriginal/
> can help here)

You could have also asked me. I already have all the necessary
binaries (natively compiled on Kip's machine). It might be that Karl
will eventually put them online on TUG's ftp server as well (or maybe
he did that already).

Mojca


From kip at thevertigo.com  Tue Feb 21 03:59:45 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 20 Feb 2012 18:59:45 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
 <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>
Message-ID: <1329793185.2886.100.camel@kip-laptop>

On Mon, 2012-02-20 at 20:10 -0600, Mojca Miklavec wrote:
> You could have also asked me. I already have all the necessary
> binaries (natively compiled on Kip's machine). It might be that Karl
> will eventually put them online on TUG's ftp server as well (or maybe
> he did that already).

Hey Luigi and Mojca. It might actually be a good idea if Mojca takes a
stab at it since she already has a shell account on the machine in
question and has experience with it.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120220/8f0abe2c/attachment.bin>

From mojca.miklavec.lists at gmail.com  Tue Feb 21 04:40:24 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Mon, 20 Feb 2012 21:40:24 -0600
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1329793185.2886.100.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
 <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>
 <1329793185.2886.100.camel@kip-laptop>
Message-ID: <CALBOmsYWbP1dRGEJB2NQAF0tWuRGdPO8U+uyKkuk0YgTbtQ22A@mail.gmail.com>

On Mon, Feb 20, 2012 at 20:59, Kip Warner wrote:
> On Mon, 2012-02-20 at 20:10 -0600, Mojca Miklavec wrote:
>> You could have also asked me. I already have all the necessary
>> binaries (natively compiled on Kip's machine). It might be that Karl
>> will eventually put them online on TUG's ftp server as well (or maybe
>> he did that already).
>
> Hey Luigi and Mojca. It might actually be a good idea if Mojca takes a
> stab at it since she already has a shell account on the machine in
> question and has experience with it.

I don't know how to reproduce the error though.

When I said "you could have asked me" I mostly meant providing set of
binaries, also because Luigi might be a lot better in bug hunting than
I am.

I could try of course, but I would at least need to know how to
reproduce the error. Compiling simple documents worked for me when I
last tried.

Mojca

From luigi.scarso at gmail.com  Tue Feb 21 13:24:16 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 21 Feb 2012 13:24:16 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CALBOmsYWbP1dRGEJB2NQAF0tWuRGdPO8U+uyKkuk0YgTbtQ22A@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
 <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>
 <1329793185.2886.100.camel@kip-laptop>
 <CALBOmsYWbP1dRGEJB2NQAF0tWuRGdPO8U+uyKkuk0YgTbtQ22A@mail.gmail.com>
Message-ID: <CAG5iGsDiG=EPDxHEi0DOnJdBoW6bFT++ON8X1Kz0BkA990jD_w@mail.gmail.com>

On Tue, Feb 21, 2012 at 4:40 AM, Mojca Miklavec
<mojca.miklavec.lists at gmail.com> wrote:
> On Mon, Feb 20, 2012 at 20:59, Kip Warner wrote:
>> On Mon, 2012-02-20 at 20:10 -0600, Mojca Miklavec wrote:
>>> You could have also asked me. I already have all the necessary
>>> binaries (natively compiled on Kip's machine). It might be that Karl
>>> will eventually put them online on TUG's ftp server as well (or maybe
>>> he did that already).
>>
>> Hey Luigi and Mojca. It might actually be a good idea if Mojca takes a
>> stab at it since she already has a shell account on the machine in
>> question and has experience with it.
ok for me
>
> I don't know how to reproduce the error though.
>
> When I said "you could have asked me" I mostly meant providing set of
> binaries, also because Luigi might be a lot better in bug hunting than
> I am.
uh it depends to the bug...

Anyway the overall idea is to setup a virtual machine that is as much
as possible similar to the target one,
if the last one is not at hand.

For example the qemu 0.9.1 on my Ubuntu LTS  doesn't support Loongson,
while the latest 1.0.1 has some kind of support -- it doesn't work on
my machine, anyway; the daily images from
http://d-i.debian.org/daily-images/mipsel/daily/loongson-2f/netboot/
frozen the cpu on 100% .
Usually Debian offers a quick way to setup a vm: either download the
netinst from
http://www.debian.org/CD/netinst/
~180MByte or if the connection is ok use a netinst
http://ftp.debian.org/debian/dists/squeeze/main/installer-mipsel/current/images/malta/netboot/
Anyway, with a modern adsl updating a vm is not a problem.

The problem for luatex is to build the executable for the target machine.
The preferred way is of course use gcc on the target machine, but the
slowdown can be 10 times.
It is preferable to build a cross-toolchain on host, e.g
http://imara.inria.fr/users/oliviermehani/2007ie/mipsellinuxtoolchain
or check if the binaries from
http://landley.net/aboriginal/
are ok
or whatever else (I e.g

Another example is gub
http://lilypond.org/gub/
useful to cross-compile luatex for MacOs and Windows
Puredarwin offers a vm for macos
http://www.puredarwin.org/developers/qemu
but until now I've had no time to test it.



-- 
luigi

From ikrabbe.ask at gmail.com  Tue Feb 21 14:37:49 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Tue, 21 Feb 2012 14:37:49 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
Message-ID: <20120221133749.GL10077@ask-sec>

Hi,

this might have been asked some times ago, or it might not, as the vast
crowd won't use enctex to write plain TeX files, but I do!

My keyboard contains about 100 keys, where a few of them are directly
known to break 7-bit ascii, such as ????????.

I know there are more, but my brain is too weak or too lazy to remember
all those alt_gr and shift+alt_gr kombinations to produce such nice
symbols as ?????? ??????????, mostly useless to TeX anyway.

As I don't like to read the sequences \"a,\"o,\ss{} ? and so on ? while editing
my texts, I learned to use enctex and use a little charmap:

\mubyte \adiaresis	^^c3^^a4\endmubyte % ?
\mubyte \odiaresis	^^c3^^b6\endmubyte % ?
\mubyte \udiaresis	^^c3^^bc\endmubyte % ?
\mubyte \Adiaresis	^^c3^^84\endmubyte % ?
\mubyte \Odiaresis	^^c3^^96\endmubyte % ?
\mubyte \Udiaresis	^^c3^^9c\endmubyte % ?
\mubyte \szlig	^^c3^^9f\endmubyte % ?
\def\adiaresis{\"{a}}
\def\odiaresis{\"{o}}
\def\udiaresis{\"{u}}
\def\Adiaresis{\"{A}}
\def\Odiaresis{\"{O}}
\def\Udiaresis{\"{U}}
\def\szlig{\ss{}}
\mubytein=1 \mubytelog=1

So far, so easy.

Now I want to push my source code through luatex, to give it a try and
anythings works fine, but of course \mubyte does not work and simply
disabling my \input{mubytes.tex} include does not produce the right
output for those special chars from my UTF-8 encoded source file.

So what Do I need to do to make the step from producing the same output
from this source file:

\input mubytes.tex
\footline={}
This is an Umlaut Test: ???????.
\vfill\eject\bye

(for luatex comment out or delete the first line, and plain pdftex, as I
use it, has to be initialized with -enc, of course, for this to work.)

tia
ingo

-- 
i don't do signatures
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mubytes.tex
Type: application/x-tex
Size: 473 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120221/62c052c5/attachment.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: src-file.tex
Type: application/x-tex
Size: 89 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120221/62c052c5/attachment-0001.tex>

From luigi.scarso at gmail.com  Tue Feb 21 16:02:12 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 21 Feb 2012 16:02:12 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <20120221133749.GL10077@ask-sec>
References: <20120221133749.GL10077@ask-sec>
Message-ID: <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>

On Tue, Feb 21, 2012 at 2:37 PM, Ingo Krabbe <ikrabbe.ask at gmail.com> wrote:
> Hi,
>
> this might have been asked some times ago, or it might not, as the vast
> crowd won't use enctex to write plain TeX files, but I do!
>
> My keyboard contains about 100 keys, where a few of them are directly
> known to break 7-bit ascii, such as ????????.
>
> I know there are more, but my brain is too weak or too lazy to remember
> all those alt_gr and shift+alt_gr kombinations to produce such nice
> symbols as ?????? ??????????, mostly useless to TeX anyway.
>
> As I don't like to read the sequences \"a,\"o,\ss{} ? and so on ? while editing
> my texts, I learned to use enctex and use a little charmap:
>
> \mubyte \adiaresis ? ? ?^^c3^^a4\endmubyte % ?
> \mubyte \odiaresis ? ? ?^^c3^^b6\endmubyte % ?
> \mubyte \udiaresis ? ? ?^^c3^^bc\endmubyte % ?
> \mubyte \Adiaresis ? ? ?^^c3^^84\endmubyte % ?
> \mubyte \Odiaresis ? ? ?^^c3^^96\endmubyte % ?
> \mubyte \Udiaresis ? ? ?^^c3^^9c\endmubyte % ?
> \mubyte \szlig ?^^c3^^9f\endmubyte % ?
> \def\adiaresis{\"{a}}
> \def\odiaresis{\"{o}}
> \def\udiaresis{\"{u}}
> \def\Adiaresis{\"{A}}
> \def\Odiaresis{\"{O}}
> \def\Udiaresis{\"{U}}
> \def\szlig{\ss{}}
> \mubytein=1 \mubytelog=1
>
> So far, so easy.
>
> Now I want to push my source code through luatex, to give it a try and
> anythings works fine, but of course \mubyte does not work and simply
> disabling my \input{mubytes.tex} include does not produce the right
> output for those special chars from my UTF-8 encoded source file.
>
> So what Do I need to do to make the step from producing the same output
> from this source file:
>
> \input mubytes.tex
> \footline={}
> This is an Umlaut Test: ???????.
> \vfill\eject\bye
>
> (for luatex comment out or delete the first line, and plain pdftex, as I
> use it, has to be initialized with -enc, of course, for this to work.)
>
> tia
> ingo
>
> --
> i don't do signatures
If the file is utf-8, this is ok with the format build from context standalone
and the lmroman otf
\font\testa=file:lmroman10-regular
\testa
\footline={}
This is an Umlaut Test: ???????.
\vfill\eject\bye

This one loads the pfb fonts and no umlauts are shown
\footline={}
This is an Umlaut Test: ???????.
\vfill\eject\bye



-- 
luigi


From ikrabbe.ask at gmail.com  Tue Feb 21 16:09:58 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Tue, 21 Feb 2012 16:09:58 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
Message-ID: <20120221150957.GA14208@ask-sec>

On Tue, Feb 21, 2012 at 04:02:12PM +0100, luigi scarso wrote:
> On Tue, Feb 21, 2012 at 2:37 PM, Ingo Krabbe <ikrabbe.ask at gmail.com> wrote:
> > Hi,
> >
> > this might have been asked some times ago, or it might not, as the vast
> > crowd won't use enctex to write plain TeX files, but I do!
> >
> > My keyboard contains about 100 keys, where a few of them are directly
> > known to break 7-bit ascii, such as ????????.
> >
> > I know there are more, but my brain is too weak or too lazy to remember
> > all those alt_gr and shift+alt_gr kombinations to produce such nice
> > symbols as ?????? ??????????, mostly useless to TeX anyway.
> >
> > As I don't like to read the sequences \"a,\"o,\ss{} ? and so on ? while editing
> > my texts, I learned to use enctex and use a little charmap:
> >
> > \mubyte \adiaresis ? ? ?^^c3^^a4\endmubyte % ?
> > \mubyte \odiaresis ? ? ?^^c3^^b6\endmubyte % ?
> > \mubyte \udiaresis ? ? ?^^c3^^bc\endmubyte % ?
> > \mubyte \Adiaresis ? ? ?^^c3^^84\endmubyte % ?
> > \mubyte \Odiaresis ? ? ?^^c3^^96\endmubyte % ?
> > \mubyte \Udiaresis ? ? ?^^c3^^9c\endmubyte % ?
> > \mubyte \szlig ?^^c3^^9f\endmubyte % ?
> > \def\adiaresis{\"{a}}
> > \def\odiaresis{\"{o}}
> > \def\udiaresis{\"{u}}
> > \def\Adiaresis{\"{A}}
> > \def\Odiaresis{\"{O}}
> > \def\Udiaresis{\"{U}}
> > \def\szlig{\ss{}}
> > \mubytein=1 \mubytelog=1
> >
> > So far, so easy.
> >
> > Now I want to push my source code through luatex, to give it a try and
> > anythings works fine, but of course \mubyte does not work and simply
> > disabling my \input{mubytes.tex} include does not produce the right
> > output for those special chars from my UTF-8 encoded source file.
> >
> > So what Do I need to do to make the step from producing the same output
> > from this source file:
> >
> > \input mubytes.tex
> > \footline={}
> > This is an Umlaut Test: ???????.
> > \vfill\eject\bye
> >
> > (for luatex comment out or delete the first line, and plain pdftex, as I
> > use it, has to be initialized with -enc, of course, for this to work.)
> >
> > tia
> > ingo
> >
> > --
> > i don't do signatures
> If the file is utf-8, this is ok with the format build from context standalone
> and the lmroman otf
> \font\testa=file:lmroman10-regular
> \testa
> \footline={}
> This is an Umlaut Test: ???????.
> \vfill\eject\bye
> 
> This one loads the pfb fonts and no umlauts are shown
> \footline={}
> This is an Umlaut Test: ???????.
> \vfill\eject\bye
> 

Ok, my further problem is, that I use the font-change package too, to
use the set of fonts from there, that map to pfb encoded fonts, of
course as they are formerly used with plain TeX.

Isn't there a way to keep that fonts for my documents, that I don't need
to change the font sets and the visual output of the result?

> 
> 
> -- 
> luigi

-- 
i don't do signatures

From motarecuk at seznam.cz  Tue Feb 21 17:17:37 2012
From: motarecuk at seznam.cz (TK)
Date: Tue, 21 Feb 2012 17:17:37 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <20120221150957.GA14208@ask-sec>
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec>
Message-ID: <4F43C3A1.1020309@seznam.cz>

\input luaotfload and use OTF versions of your fonts.
Tom??


Dne 21.2.2012 16:09, Ingo Krabbe napsal(a):
> On Tue, Feb 21, 2012 at 04:02:12PM +0100, luigi scarso wrote:
>> On Tue, Feb 21, 2012 at 2:37 PM, Ingo Krabbe <ikrabbe.ask at gmail.com> wrote:
>>> Hi,
>>>
>>> this might have been asked some times ago, or it might not, as the vast
>>> crowd won't use enctex to write plain TeX files, but I do!
>>>
>>> My keyboard contains about 100 keys, where a few of them are directly
>>> known to break 7-bit ascii, such as ????????.
>>>
>>> I know there are more, but my brain is too weak or too lazy to remember
>>> all those alt_gr and shift+alt_gr kombinations to produce such nice
>>> symbols as ?????? ??????????, mostly useless to TeX anyway.
>>>
>>> As I don't like to read the sequences \"a,\"o,\ss{} ? and so on ? while editing
>>> my texts, I learned to use enctex and use a little charmap:
>>>
>>> \mubyte \adiaresis      ^^c3^^a4\endmubyte % ?
>>> \mubyte \odiaresis      ^^c3^^b6\endmubyte % ?
>>> \mubyte \udiaresis      ^^c3^^bc\endmubyte % ?
>>> \mubyte \Adiaresis      ^^c3^^84\endmubyte % ?
>>> \mubyte \Odiaresis      ^^c3^^96\endmubyte % ?
>>> \mubyte \Udiaresis      ^^c3^^9c\endmubyte % ?
>>> \mubyte \szlig  ^^c3^^9f\endmubyte % ?
>>> \def\adiaresis{\"{a}}
>>> \def\odiaresis{\"{o}}
>>> \def\udiaresis{\"{u}}
>>> \def\Adiaresis{\"{A}}
>>> \def\Odiaresis{\"{O}}
>>> \def\Udiaresis{\"{U}}
>>> \def\szlig{\ss{}}
>>> \mubytein=1 \mubytelog=1
>>>
>>> So far, so easy.
>>>
>>> Now I want to push my source code through luatex, to give it a try and
>>> anythings works fine, but of course \mubyte does not work and simply
>>> disabling my \input{mubytes.tex} include does not produce the right
>>> output for those special chars from my UTF-8 encoded source file.
>>>
>>> So what Do I need to do to make the step from producing the same output
>>> from this source file:
>>>
>>> \input mubytes.tex
>>> \footline={}
>>> This is an Umlaut Test: ???????.
>>> \vfill\eject\bye
>>>
>>> (for luatex comment out or delete the first line, and plain pdftex, as I
>>> use it, has to be initialized with -enc, of course, for this to work.)
>>>
>>> tia
>>> ingo
>>>
>>> --
>>> i don't do signatures
>> If the file is utf-8, this is ok with the format build from context standalone
>> and the lmroman otf
>> \font\testa=file:lmroman10-regular
>> \testa
>> \footline={}
>> This is an Umlaut Test: ???????.
>> \vfill\eject\bye
>>
>> This one loads the pfb fonts and no umlauts are shown
>> \footline={}
>> This is an Umlaut Test: ???????.
>> \vfill\eject\bye
>>
> Ok, my further problem is, that I use the font-change package too, to
> use the set of fonts from there, that map to pfb encoded fonts, of
> course as they are formerly used with plain TeX.
>
> Isn't there a way to keep that fonts for my documents, that I don't need
> to change the font sets and the visual output of the result?
>
>>
>> -- 
>> luigi


From patrick at gundla.ch  Wed Feb 22 11:01:35 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 22 Feb 2012 11:01:35 +0100
Subject: [luatex] glue_sign
Message-ID: <51FA63AF-FEC7-4ADA-9C76-E5F3E82CB319@gundla.ch>

Hi there,

the vlist/hlist nodes have a field called glue_sign, which is the direction of stretching/shrinking. It seems that it can have a value of 0,1 and 2. Which value has which meaning?

0 = normal
1 = stretch
2 = shrink

?

Patrick




From taco at elvenkind.com  Wed Feb 22 11:05:16 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Wed, 22 Feb 2012 11:05:16 +0100
Subject: [luatex] glue_sign
In-Reply-To: <51FA63AF-FEC7-4ADA-9C76-E5F3E82CB319@gundla.ch>
References: <51FA63AF-FEC7-4ADA-9C76-E5F3E82CB319@gundla.ch>
Message-ID: <4F44BDDC.7030105@elvenkind.com>

On 02/22/2012 11:01 AM, Patrick Gundlach wrote:
> Hi there,
>
> the vlist/hlist nodes have a field called glue_sign, which is the direction of stretching/shrinking. It seems that it can have a value of 0,1 and 2. Which value has which meaning?
>
> 0 = normal
> 1 = stretch
> 2 = shrink

Yes. I'll add that to the manual.

Best wishes,
Taco

From luatex at nililand.de  Wed Feb 22 11:39:44 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 22 Feb 2012 11:39:44 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec>
Message-ID: <ms993pcc1y8j.dlg@nililand.de>

Am Tue, 21 Feb 2012 16:09:58 +0100 schrieb Ingo Krabbe:

> Ok, my further problem is, that I use the font-change package too, to
> use the set of fonts from there, that map to pfb encoded fonts, of
> course as they are formerly used with plain TeX.
> 
> Isn't there a way to keep that fonts for my documents, that I don't need
> to change the font sets and the visual output of the result?

In theory yes, but it is not advisable. Beside the fact that you
would have to make a lot of non-ascii input chars (like ? or ?)
active to map them to the correct positions in your fonts you could
also get wrong hyphenations (the patterns assume unicode). 

If you want to switch to luatex you should also switch with the text
fonts to open type fonts using unicode (math and symbols are a
different matter, there the old type 1 fonts can still be used). 


-- 
Ulrike Fischer 


From ikrabbe.ask at gmail.com  Wed Feb 22 13:40:44 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Wed, 22 Feb 2012 13:40:44 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <ms993pcc1y8j.dlg@nililand.de>
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec> <ms993pcc1y8j.dlg@nililand.de>
Message-ID: <20120222124044.GA5798@ask-sec.eoa.intra>

On Wed, Feb 22, 2012 at 11:39:44AM +0100, Ulrike Fischer wrote:
> Am Tue, 21 Feb 2012 16:09:58 +0100 schrieb Ingo Krabbe:
> 
> > Ok, my further problem is, that I use the font-change package too, to
> > use the set of fonts from there, that map to pfb encoded fonts, of
> > course as they are formerly used with plain TeX.
> > 
> > Isn't there a way to keep that fonts for my documents, that I don't need
> > to change the font sets and the visual output of the result?
> 
> In theory yes, but it is not advisable. Beside the fact that you
> would have to make a lot of non-ascii input chars (like ? or ?)
> active to map them to the correct positions in your fonts you could
> also get wrong hyphenations (the patterns assume unicode). 
> 
> If you want to switch to luatex you should also switch with the text
> fonts to open type fonts using unicode (math and symbols are a
> different matter, there the old type 1 fonts can still be used). 
> 

Yes, I understood this relationship now and consider this topic fixed.
The unicode math handling by the way, isn't quite clear to me yet, but
it works well with the old font mapping.

On the other hand I detected, that using unicode math, might drastically
reduce the size of the generated document.

Do you have some hints and to-be-reads to get started with unicode math
and plain TeX?

Please don't point me to latex techniques, such as unicode-math.sty. I
decided to render latex as useless, years ago and I'm still convinced of
my decision (not to be discussed).

regards

ingo

> 
> -- 
> Ulrike Fischer 

From reinhard.kotucha at web.de  Wed Feb 22 20:58:14 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 22 Feb 2012 20:58:14 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <20120222124044.GA5798@ask-sec.eoa.intra>
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec> <ms993pcc1y8j.dlg@nililand.de>
 <20120222124044.GA5798@ask-sec.eoa.intra>
Message-ID: <20293.18646.276034.178499@zaphod.ms25.net>

On 2012-02-22 at 13:40:44 +0100, Ingo Krabbe wrote:

 > On Wed, Feb 22, 2012 at 11:39:44AM +0100, Ulrike Fischer wrote:
 > > Am Tue, 21 Feb 2012 16:09:58 +0100 schrieb Ingo Krabbe:
 > > 
 > > > Ok, my further problem is, that I use the font-change package too, to
 > > > use the set of fonts from there, that map to pfb encoded fonts, of
 > > > course as they are formerly used with plain TeX.
 > > > 
 > > > Isn't there a way to keep that fonts for my documents, that I don't need
 > > > to change the font sets and the visual output of the result?
 > > 
 > > In theory yes, but it is not advisable. Beside the fact that you
 > > would have to make a lot of non-ascii input chars (like ? or ?)
 > > active to map them to the correct positions in your fonts you could
 > > also get wrong hyphenations (the patterns assume unicode). 
 > > 
 > > If you want to switch to luatex you should also switch with the text
 > > fonts to open type fonts using unicode (math and symbols are a
 > > different matter, there the old type 1 fonts can still be used). 
 > > 
 > 
 > Yes, I understood this relationship now and consider this topic fixed.
 > The unicode math handling by the way, isn't quite clear to me yet, but
 > it works well with the old font mapping.
 > 
 > On the other hand I detected, that using unicode math, might drastically
 > reduce the size of the generated document.
 > 
 > Do you have some hints and to-be-reads to get started with unicode math
 > and plain TeX?
 > 
 > Please don't point me to latex techniques, such as unicode-math.sty. I
 > decided to render latex as useless, years ago and I'm still convinced of
 > my decision (not to be discussed).

If you insist on plain TeX whereas a particular problem is already
solved in LaTeX, why don't you simply look into the sources?

You can also look into the ConTeXt sources, ConTeXt is probably a
little bit closer to plain TeX.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From patrick at gundla.ch  Thu Feb 23 11:13:02 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Feb 2012 11:13:02 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
Message-ID: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>

Hi,

just for your information: there is a new (Lua)LaTeX package on CTAN (hopefully soon in the distributions): lua-visual-debug.

Heavily inspired by Hans Hagen's visual debugging "art-visi.pdf" http://pragma-ade.com/articles/art-visi.pdf

---------------------
\documentclass{article}
\usepackage{lmodern}
\usepackage{lua-visual-debug}

\setlength\textwidth{300pt}
\setlength\textheight{10cm}

\begin{document}

\section{A short story}

A wonderful serenity has taken possession of my entire soul, like these sweet 
mornings of spring which I enjoy with my whole heart. I am alone, and feel the 
charm of existence in this spot, which was created for the bliss of souls like 
mine. I am so happy, my dear friend, so absorbed in the exquisite sense of mere 
tranquil existence, that I neglect my talents.

\begin{itemize}
  \item one
  \item two
  \item three
\end{itemize}

\bgroup\fontsize{30}{34}\selectfont
\centerline{\TeX}
\egroup

\vbox{\strut Hello}\kern .5cm\vbox{\strut World}

\[ \int_e^x=mc^2 \]

\end{document}
---------------------

Gives the attached PDF.

http://www.ctan.org/pkg/lua-visual-debug



Patrick



-------------- next part --------------
A non-text attachment was scrubbed...
Name: sample.pdf
Type: application/pdf
Size: 99236 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120223/5b493b58/attachment-0001.pdf>

From khaledhosny at eglug.org  Thu Feb 23 12:41:17 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 23 Feb 2012 13:41:17 +0200
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
Message-ID: <20120223114117.GA3491@khaled-laptop>

On Thu, Feb 23, 2012 at 11:13:02AM +0100, Patrick Gundlach wrote:
> Hi,
> 
> just for your information: there is a new (Lua)LaTeX package on CTAN
> (hopefully soon in the distributions): lua-visual-debug.

Very nice, I wanted something like that for long time :)

Regards,
 Khaled

From zappathustra at free.fr  Thu Feb 23 13:20:12 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 23 Feb 2012 13:20:12 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
Message-ID: <20120223122011.B27D5A6203@smtp3-g21.free.fr>

[I don't know why my first message didn't appear on the list. So I'm
reposting, sorry if the first message finally shows up.]

Patrick Gundlach <patrick at gundla.ch> a ?crit:
> 
> Hi,
> 
> just for your information: there is a new (Lua)LaTeX package on CTAN (hopefully soon in the distributions): lua-visual-debug.

This is beautiful, really.

I hate to spoil the beauty of it with remarks, but I can't help it:
given that everything is done in Lua, I suppose, why does it require
LaTeX at all? Plain TeX users can definitely use that.

Also, I would love to read it all explained in a TUGboat paper, a wiki
article, or both. It weaves together TeXnics and typographic concern
in a wonderful way, and it would make a nice third part to Hans's
original papers. So I hope all readers of this list will sing along
with me: `Patrick, an article! Patrick, an article!' (French readers
shall *not* lengthen the `i' in `Patrick'.)

Best,
Paul


From luatex at nililand.de  Thu Feb 23 14:39:36 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 23 Feb 2012 14:39:36 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec> <ms993pcc1y8j.dlg@nililand.de>
 <20120222124044.GA5798@ask-sec.eoa.intra>
Message-ID: <13spxmo1upexg.dlg@nililand.de>

[For some reason my answer didn't appear on the list. So I'm
reposting, sorry if the first message finally shows up.]

Am Wed, 22 Feb 2012 13:40:44 +0100 schrieb Ingo Krabbe:

> Do you have some hints and to-be-reads to get started with unicode math
> and plain TeX?

No.

> Please don't point me to latex techniques, such as unicode-math.sty. 

Then try out context (I have no idea how good its unicode math 
support is, but as context uses luatex as default engine and the 
luatex developers use context many things are better supported there 
than in latex). 

> I decided to render latex as useless, years ago and I'm still convinced of
> my decision (not to be discussed).

And I have decided for years that plain is useless as soon you want 
some higher level font support. 

-- 
Ulrike Fischer 


From patrick at gundla.ch  Thu Feb 23 14:47:57 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Feb 2012 14:47:57 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <20120223122011.B27D5A6203@smtp3-g21.free.fr>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
Message-ID: <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>

Hi Paul,

>> just for your information: there is a new (Lua)LaTeX package on CTAN (hopefully soon in the distributions): lua-visual-debug.
> 
> This is beautiful, really.

Thanks.


> I hate to spoil the beauty of it with remarks, but I can't help it:
> given that everything is done in Lua, I suppose, why does it require
> LaTeX at all? Plain TeX users can definitely use that.

I don't know how to get the output box when using plain :-) I guess the module should be called when inside \output{...}, right? I have not thought about making a plain TeX version of it, but why not?

And yes, I'll put something into the wiki _and_ use it as an TUGboat article (at least I submit it). - when I find some time.

> with me: `Patrick, an article! Patrick, an article!' (French readers
> shall *not* lengthen the `i' in `Patrick'.)

They may, I was born in France and thus my name was originally with a long i :)


:)) Thanks for your encouraging words

Patrick




From heiko.oberdiek at googlemail.com  Thu Feb 23 17:16:20 2012
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Thu, 23 Feb 2012 17:16:20 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
Message-ID: <20120223161620.GA14101@oberdiek.my-fqdn.de>

On Thu, Feb 23, 2012 at 02:47:57PM +0100, Patrick Gundlach wrote:

> > I hate to spoil the beauty of it with remarks, but I can't help it:
> > given that everything is done in Lua, I suppose, why does it require
> > LaTeX at all? Plain TeX users can definitely use that.
> 
> I don't know how to get the output box when using plain :-) I guess the
> module should be called when inside \output{...}, right? I have not
> thought about making a plain TeX version of it, but why not?

You can still use atbegshi:

\input ifluatex.sty\relax
\ifluatex
  \input{atbegshi.sty}%
  \directlua{lvdebug = require("lua-visual-debug")}%
  \AtBeginShipout{\directlua{lvdebug.draw()}}%
  \AtBeginShipoutInit
\fi

Package atbegshi.sty only requires \newbox.
If \newbox is provided, then this can also be used with iniTeX.

Yours sincerely
  Heiko Oberdiek

From dirk.laurie at gmail.com  Thu Feb 23 21:28:40 2012
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Thu, 23 Feb 2012 22:28:40 +0200
Subject: [luatex] Unicode Math (was: This might have been asked: UTF-8
 input from plain TeX
Message-ID: <CABcj=tmk-2e2=6Hu-JP5EhNHZ2dPD+oA=fx-hYPBwJe5S6ctAQ@mail.gmail.com>

Op 23 februari 2012 15:39 heeft Ulrike Fischer <luatex at nililand.de>
het volgende geschreven:
> [For some reason my answer didn't appear on the list. So I'm
> reposting, sorry if the first message finally shows up.]
>
> Am Wed, 22 Feb 2012 13:40:44 +0100 schrieb Ingo Krabbe:
>
>> Do you have some hints and to-be-reads to get started with unicode math
>> and plain TeX?
>
By unicode math, I hope you don't mean the glyphs in u2190 to u22ff.
Donald Knuth did not invent TeX so that we should go back to character-based
math typesetting.

From patrick at gundla.ch  Thu Feb 23 21:33:14 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Feb 2012 21:33:14 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <20120223161620.GA14101@oberdiek.my-fqdn.de>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
 <20120223161620.GA14101@oberdiek.my-fqdn.de>
Message-ID: <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>

Hello Heiko,

>> I don't know how to get the output box when using plain :-) I guess the
>> module should be called when inside \output{...}, right? I have not
>> thought about making a plain TeX version of it, but why not?
> 
> You can still use atbegshi:

great! Next version has plain TeX support as well.

Thanks,

Patrick




From Herbert.Voss at FU-Berlin.DE  Thu Feb 23 21:45:21 2012
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Thu, 23 Feb 2012 21:45:21 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
 <20120223161620.GA14101@oberdiek.my-fqdn.de>
 <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>
Message-ID: <4F46A561.7000407@FU-Berlin.DE>

Am 23.02.2012 21:33, schrieb Patrick Gundlach:
> Hello Heiko,
>
>>> I don't know how to get the output box when using plain :-) I guess the
>>> module should be called when inside \output{...}, right? I have not
>>> thought about making a plain TeX version of it, but why not?
>>
>> You can still use atbegshi:
>
> great! Next version has plain TeX support as well.

Patrick,
why is it not possible to use \latelua?

Herbert

From patrick at gundla.ch  Thu Feb 23 21:49:25 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Thu, 23 Feb 2012 21:49:25 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <4F46A561.7000407@FU-Berlin.DE>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
 <20120223161620.GA14101@oberdiek.my-fqdn.de>
 <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>
 <4F46A561.7000407@FU-Berlin.DE>
Message-ID: <8D8249A6-2F0C-4E13-B856-C43BF92265F4@gundla.ch>

Hello Herbert,

> why is it not possible to use \latelua?

I don't know. I don't even know what \latelua is, so I don't even understand your question ;-)

>From the name I suppose it is executed during shipout, but can I access the whole shipout box from there? Is it box255?

Patrick



From ikrabbe.ask at gmail.com  Thu Feb 23 14:49:00 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Thu, 23 Feb 2012 14:49:00 +0100
Subject: [luatex] This might have been asked: UTF-8 input from plain TeX
In-Reply-To: <13spxmo1upexg.dlg@nililand.de>
References: <20120221133749.GL10077@ask-sec>
 <CAG5iGsCJf=+ZmpSVTghZ6aDG+aSA_fTAa8AxaxJCjRGJQbBRaw@mail.gmail.com>
 <20120221150957.GA14208@ask-sec> <ms993pcc1y8j.dlg@nililand.de>
 <20120222124044.GA5798@ask-sec.eoa.intra>
 <13spxmo1upexg.dlg@nililand.de>
Message-ID: <20120223134900.GA15327@ask-sec>

On Thu, Feb 23, 2012 at 02:39:36PM +0100, Ulrike Fischer wrote:
> [For some reason my answer didn't appear on the list. So I'm
> reposting, sorry if the first message finally shows up.]
> 
> Am Wed, 22 Feb 2012 13:40:44 +0100 schrieb Ingo Krabbe:
> 
> > Do you have some hints and to-be-reads to get started with unicode math
> > and plain TeX?
> 
> No.
> 
> > Please don't point me to latex techniques, such as unicode-math.sty. 
> 
> Then try out context (I have no idea how good its unicode math 
> support is, but as context uses luatex as default engine and the 
> luatex developers use context many things are better supported there 
> than in latex). 
> 
> > I decided to render latex as useless, years ago and I'm still convinced of
> > my decision (not to be discussed).
> 
> And I have decided for years that plain is useless as soon you want 
> some higher level font support. 

Yes, I have seen some papers about unicode math now and also see the
vast area of problems that is opened, when sticking to the bare plain
TeX mode.

On the other hand, for my needs, with old style math fonts, anything
works as expected now.

Seems that I need to make some ab initio experiments with unicode fonts
before I can use that in more depth.

Thanks for your answers, anyway.

Regards,
Ingo

-- 
i don't do signatures

From khaledhosny at eglug.org  Thu Feb 23 22:30:37 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 23 Feb 2012 23:30:37 +0200
Subject: [luatex] Unicode Math (was: This might have been asked: UTF-8
 input from plain TeX
In-Reply-To: <CABcj=tmk-2e2=6Hu-JP5EhNHZ2dPD+oA=fx-hYPBwJe5S6ctAQ@mail.gmail.com>
References: <CABcj=tmk-2e2=6Hu-JP5EhNHZ2dPD+oA=fx-hYPBwJe5S6ctAQ@mail.gmail.com>
Message-ID: <20120223213037.GA18362@khaled-laptop>

On Thu, Feb 23, 2012 at 10:28:40PM +0200, Dirk Laurie wrote:
> Donald Knuth did not invent TeX so that we should go back to character-based
> math typesetting.

Huh?

From martin at oneiros.de  Thu Feb 23 22:37:31 2012
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Thu, 23 Feb 2012 22:37:31 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <8D8249A6-2F0C-4E13-B856-C43BF92265F4@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
 <20120223161620.GA14101@oberdiek.my-fqdn.de>
 <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>
 <4F46A561.7000407@FU-Berlin.DE>
 <8D8249A6-2F0C-4E13-B856-C43BF92265F4@gundla.ch>
Message-ID: <CAP7DCDdSncyTyoNSYOHpARWrLHUJUenm9qc+HA3FXYW5KxOh1g@mail.gmail.com>

2012/2/23 Patrick Gundlach <patrick at gundla.ch>:
> I don't know. I don't even know what \latelua is, so I don't even understand your question ;-)

Section 2.6.2 of the manual. You don't know the manual by heart? :-)

Best
   Martin

From Robin.Fairbairns at cl.cam.ac.uk  Thu Feb 23 23:39:47 2012
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 23 Feb 2012 22:39:47 +0000
Subject: [luatex] Unicode Math (was: This might have been asked: UTF-8
	input from plain TeX
In-Reply-To: Your message of Thu, 23 Feb 2012 22:28:40 +0200.
 <CABcj=tmk-2e2=6Hu-JP5EhNHZ2dPD+oA=fx-hYPBwJe5S6ctAQ@mail.gmail.com>
Message-ID: <27175.1330036787@cl.cam.ac.uk>

Dirk Laurie <dirk.laurie at gmail.com> wrote:

> Op 23 februari 2012 15:39 heeft Ulrike Fischer <luatex at nililand.de>
> het volgende geschreven:
> > [For some reason my answer didn't appear on the list. So I'm
> > reposting, sorry if the first message finally shows up.]
> >
> > Am Wed, 22 Feb 2012 13:40:44 +0100 schrieb Ingo Krabbe:
> >
> >> Do you have some hints and to-be-reads to get started with unicode math
> >> and plain TeX?
>
> By unicode math, I hope you don't mean the glyphs in u2190 to u22ff.
> Donald Knuth did not invent TeX so that we should go back to character-based
> math typesetting.

eh?  i always type characters when i'm writing maths for processing with
tex.  what unicode does for us in this context is provide a huge range
of character codes for things that were (perforce) in different 7-bit
fonts when tex first appeared.

remember that the membership of the iso committees that defined the
character set included one barbara beeton, as fine a tex conservative as
any i know.

robin

From patrick at gundla.ch  Fri Feb 24 07:16:12 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 24 Feb 2012 07:16:12 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <CAP7DCDdSncyTyoNSYOHpARWrLHUJUenm9qc+HA3FXYW5KxOh1g@mail.gmail.com>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
 <20120223161620.GA14101@oberdiek.my-fqdn.de>
 <39EA311B-C31F-40CB-86FC-A3049EAADAE4@gundla.ch>
 <4F46A561.7000407@FU-Berlin.DE>
 <8D8249A6-2F0C-4E13-B856-C43BF92265F4@gundla.ch>
 <CAP7DCDdSncyTyoNSYOHpARWrLHUJUenm9qc+HA3FXYW5KxOh1g@mail.gmail.com>
Message-ID: <46A086AB-B79E-41F6-B578-FEFE498695EC@gundla.ch>



>> I don't know. I don't even know what \latelua is, so I don't even understand your question ;-)
> 
> Section 2.6.2 of the manual. You don't know the manual by heart? :-)

No, I skipped section 2.6.2 and 5 (Math---who needs math?)

Anyway, I've got it to work with Heiko's great package atbegshi (inspired by the luacolor package). It will work with more formats than LaTeX.

Patrick



From Robin.Fairbairns at cl.cam.ac.uk  Fri Feb 24 08:27:34 2012
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 24 Feb 2012 07:27:34 +0000
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: Your message of Fri, 24 Feb 2012 07:16:12 +0100.
 <46A086AB-B79E-41F6-B578-FEFE498695EC@gundla.ch>
Message-ID: <16375.1330068454@cl.cam.ac.uk>

Patrick Gundlach <patrick at gundla.ch> wrote:

> >> I don't know. I don't even know what \latelua is, so I don't even understand your question ;-)
> > 
> > Section 2.6.2 of the manual. You don't know the manual by heart? :-)
> 
> No, I skipped section 2.6.2 and 5 (Math---who needs math?)

it makes the world go round, you know...

> Anyway, I've got it to work with Heiko's great package atbegshi
> (inspired by the luacolor package). It will work with more formats
> than LaTeX. 

can we expect a revision on ctan (and hence in tex live)?  or is it just
a of documentation -- a sort of "how-to"?

either way, i would like to update the ctan catalogue to reflect your
last sentence...

robin

From patrick at gundla.ch  Fri Feb 24 08:41:23 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 24 Feb 2012 08:41:23 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <16375.1330068454@cl.cam.ac.uk>
References: <16375.1330068454@cl.cam.ac.uk>
Message-ID: <84225C09-98CD-46D8-9F13-FFC48C37913A@gundla.ch>


Am 24.02.2012 um 08:27 schrieb Robin Fairbairns:

>> Anyway, I've got it to work with Heiko's great package atbegshi
>> (inspired by the luacolor package). It will work with more formats
>> than LaTeX. 
> 
> can we expect a revision on ctan (and hence in tex live)?  or is it just
> a of documentation -- a sort of "how-to"?
> 
> either way, i would like to update the ctan catalogue to reflect your
> last sentence...

I'll upload an update today. I have fixed a bug and will do more (code) documentation.

Patrick



From zappathustra at free.fr  Thu Feb 23 15:13:12 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Thu, 23 Feb 2012 15:13:12 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <20120223122011.B27D5A6203@smtp3-g21.free.fr>
 <89792581-5F87-481E-88AB-4DB26DA2E7DD@gundla.ch>
Message-ID: <20120223141311.DB5CEA6283@smtp3-g21.free.fr>

Patrick Gundlach <patrick at gundla.ch> a ?crit:
> > I hate to spoil the beauty of it with remarks, but I can't help it:
> > given that everything is done in Lua, I suppose, why does it require
> > LaTeX at all? Plain TeX users can definitely use that.
> 
> I don't know how to get the output box when using plain :-) I guess the module should be called when inside \output{...}, right?

I don't know yet how your module works, but I suppose that is so. If you
want to catch the output box just when it's being shipped out, then
hacking \shipout is the best solution. But I'd rather recommend having a
function that applies your coloring to any box, which function plain TeX
users may apply at will to the output box (and to anything else:
actually it'd be nice if you could apply that to just a part of the
document).

> And yes, I'll put something into the wiki _and_ use it as an TUGboat article (at least I submit it). - when I find some time.

Wonderful!

> 
> > with me: `Patrick, an article! Patrick, an article!' (French readers
> > shall *not* lengthen the `i' in `Patrick'.)
> 
> They may, I was born in France and thus my name was originally with a long i :)

Oh, that's not a matter of vowel length (actually the short/long vowel
opposition is not distinctive in French). I was alluding to a French
singer, firstname Patrick, who at some point in his career was particularly
favored by teenage girls reportedly crying `Patriiiiiiiiick' at his
concerts. Which cry remains attached to the singer. (If there exists
an award for the biggest off-topic of the year, I think I've just won
it.)

Best,
Paul


From patrick at gundla.ch  Sun Feb 26 20:28:48 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 26 Feb 2012 20:28:48 +0100
Subject: [luatex] parshape
Message-ID: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>

Hello,

(4.13.13.2 tex.linebreak())

in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of 

{ n, <glue_spec>,<glue_spec>, .. 2n <glue_spec> items}
?

Or what do I need to fill in?


Thanks

Patrick



From ikrabbe.ask at gmail.com  Sun Feb 26 22:49:42 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Sun, 26 Feb 2012 22:49:42 +0100
Subject: [luatex] parshape
In-Reply-To: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
Message-ID: <20120226214942.GA22577@ask-sec>

On Sun, Feb 26, 2012 at 08:28:48PM +0100, Patrick Gundlach wrote:
> Hello,
> 
> (4.13.13.2 tex.linebreak())
> 
> in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of 
> 
> { n, <glue_spec>,<glue_spec>, .. 2n <glue_spec> items}
> ?
> 
> Or what do I need to fill in?

I don't have any clue about luatex, but most likely the texbook is still
normative here:

"In general, '\parshape=n i1 l1 i2 l2 ... in ln' specifies a paragraph
whose first n lines will have lengths l1, l2, ..., ln, respectively and
they will be indented from the left margin by the respective amounts i1,
i2, ..., in.


From patrick at gundla.ch  Mon Feb 27 08:03:51 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 27 Feb 2012 08:03:51 +0100
Subject: [luatex] parshape
In-Reply-To: <20120226214942.GA22577@ask-sec>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120226214942.GA22577@ask-sec>
Message-ID: <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>


Am 26.02.2012 um 22:49 schrieb Ingo Krabbe:

> On Sun, Feb 26, 2012 at 08:28:48PM +0100, Patrick Gundlach wrote:
>> Hello,
>> 
>> (4.13.13.2 tex.linebreak())
>> 
>> in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of 
>> 
>> { n, <glue_spec>,<glue_spec>, .. 2n <glue_spec> items}
>> ?
>> 
>> Or what do I need to fill in?
> 
> I don't have any clue about luatex, but most likely the texbook is still
> normative here:
> 
> "In general, '\parshape=n i1 l1 i2 l2 ... in ln' specifies a paragraph
> whose first n lines will have lengths l1, l2, ..., ln, respectively and
> they will be indented from the left margin by the respective amounts i1,
> i2, ..., in.

Hi Ingo,

everything I've tried so far gave me an error:

 parshape = {2,  0, 40 * 2^16, 0,37 * 2^16 }
 parshape = {2,  l0,n0,l1,n1 } -- l,n are glue_spec items
 parshape = {2,  "0pt","40pt","0pt","37pt" }

Patrick




From taco at elvenkind.com  Mon Feb 27 11:28:01 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 27 Feb 2012 11:28:01 +0100
Subject: [luatex] parshape
In-Reply-To: <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120226214942.GA22577@ask-sec>
 <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>
Message-ID: <4F4B5AB1.3000106@elvenkind.com>

On 02/27/2012 08:03 AM, Patrick Gundlach wrote:
>
> Am 26.02.2012 um 22:49 schrieb Ingo Krabbe:
>
>> On Sun, Feb 26, 2012 at 08:28:48PM +0100, Patrick Gundlach wrote:
>>> Hello,
>>>
>>> (4.13.13.2 tex.linebreak())
>>>
>>> in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of
>>>
>>> { n,<glue_spec>,<glue_spec>, .. 2n<glue_spec>  items}
>>> ?
>>>
>>> Or what do I need to fill in?

The manual leaves that open. From the code, it looks like luatex
wants a totally normal lua table with integer values for width
and indent only.

   parshape = {0, 40 * 2^16, 0,37 * 2^16 }

since I assume at least one of you has a test file, can you please
try that?

Best wishes,
Taco


From taco at elvenkind.com  Mon Feb 27 11:39:54 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 27 Feb 2012 11:39:54 +0100
Subject: [luatex] parshape
In-Reply-To: <4F4B5AB1.3000106@elvenkind.com>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120226214942.GA22577@ask-sec>
 <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>
 <4F4B5AB1.3000106@elvenkind.com>
Message-ID: <4F4B5D7A.9020505@elvenkind.com>

On 02/27/2012 11:28 AM, Taco Hoekwater wrote:
> On 02/27/2012 08:03 AM, Patrick Gundlach wrote:
>>
>> Am 26.02.2012 um 22:49 schrieb Ingo Krabbe:
>>
>>> On Sun, Feb 26, 2012 at 08:28:48PM +0100, Patrick Gundlach wrote:
>>>> Hello,
>>>>
>>>> (4.13.13.2 tex.linebreak())
>>>>
>>>> in tex.linebreak() I can give "parameters". How is the parshape
>>>> table suppose to look like? Is it a table of
>>>>
>>>> { n,<glue_spec>,<glue_spec>, .. 2n<glue_spec> items}
>>>> ?
>>>>
>>>> Or what do I need to fill in?
>
> The manual leaves that open. From the code, it looks like luatex
> wants a totally normal lua table with integer values for width
> and indent only.
>
> parshape = {0, 40 * 2^16, 0,37 * 2^16 }

Or:

   parshape = {{0, 40 * 2^16}, {0,37 * 2^16 }}

(sorry, no time to write a test file now)




From ikrabbe.ask at gmail.com  Mon Feb 27 11:49:29 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Mon, 27 Feb 2012 11:49:29 +0100
Subject: [luatex] parshape
In-Reply-To: <4F4B5D7A.9020505@elvenkind.com>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120226214942.GA22577@ask-sec>
 <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>
 <4F4B5AB1.3000106@elvenkind.com> <4F4B5D7A.9020505@elvenkind.com>
Message-ID: <20120227104929.GD22577@ask-sec>

On Mon, Feb 27, 2012 at 11:39:54AM +0100, Taco Hoekwater wrote:
> On 02/27/2012 11:28 AM, Taco Hoekwater wrote:
> > On 02/27/2012 08:03 AM, Patrick Gundlach wrote:
> >>
> >> Am 26.02.2012 um 22:49 schrieb Ingo Krabbe:
> >>
> >>> On Sun, Feb 26, 2012 at 08:28:48PM +0100, Patrick Gundlach wrote:
> >>>> Hello,
> >>>>
> >>>> (4.13.13.2 tex.linebreak())
> >>>>
> >>>> in tex.linebreak() I can give "parameters". How is the parshape
> >>>> table suppose to look like? Is it a table of
> >>>>
> >>>> { n,<glue_spec>,<glue_spec>, .. 2n<glue_spec> items}
> >>>> ?
> >>>>
> >>>> Or what do I need to fill in?
> >
> > The manual leaves that open. From the code, it looks like luatex
> > wants a totally normal lua table with integer values for width
> > and indent only.
> >
> > parshape = {0, 40 * 2^16, 0,37 * 2^16 }
> 
> Or:
> 
>    parshape = {{0, 40 * 2^16}, {0,37 * 2^16 }}
> 
> (sorry, no time to write a test file now)
> 

I don't have any luatex test files here, and time, haven't seen any of
this thing around for ages.

So, Patrik, it would be nice if you can provide a minimal example here.

Cheers, ingo

> 

-- 
i don't do signatures

From patrick at gundla.ch  Mon Feb 27 12:05:45 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Mon, 27 Feb 2012 12:05:45 +0100
Subject: [luatex] parshape
In-Reply-To: <4F4B5D7A.9020505@elvenkind.com>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120226214942.GA22577@ask-sec>
 <B96A4A03-0603-469A-B0A2-7356A0F7CAAC@gundla.ch>
 <4F4B5AB1.3000106@elvenkind.com> <4F4B5D7A.9020505@elvenkind.com>
Message-ID: <C3F10E66-5957-438A-BFC0-7F3A5389DD90@gundla.ch>

Hi,

I don't have a test file that is usable, but here is part of my routine, that works fine:

function do_linebreak( nodelist,hsize,parameters )
  parameters = parameters or {}

  local pdfignoreddimen
  pdfignoreddimen    = -65536000

  local default_parameters = {
    hsize = hsize,
    emergencystretch = 0.1 * hsize,
    hyphenpenalty = 0,
    linepenalty = 10,
    pretolerance = 0,
    tolerance = 2000,
    doublehyphendemerits = 1000,
    pdfeachlineheight = pdfignoreddimen,
    pdfeachlinedepth  = pdfignoreddimen,
    pdflastlinedepth  = pdfignoreddimen,
    pdfignoreddimen   = pdfignoreddimen,
    parshape = { {0,40*2^16},{0,hsize} }
  }
  setmetatable(parameters,{__index=default_parameters})
  local j = tex.linebreak(nodelist,parameters)

...
end


so parshape = {  {}, {}, {} } is the pattern, where {} contains i_n,l_n.

Patrick




From zappathustra at free.fr  Mon Feb 27 06:35:26 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Mon, 27 Feb 2012 06:35:26 +0100
Subject: [luatex] parshape
In-Reply-To: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
Message-ID: <20120227053527.90587A60FD@smtp3-g21.free.fr>

Patrick Gundlach <patrick at gundla.ch> a ?crit:
> 
> Hello,
> 
> (4.13.13.2 tex.linebreak())
> 
> in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of 
> 
> { n, <glue_spec>,<glue_spec>, .. 2n <glue_spec> items}
> ?
> 
> Or what do I need to fill in?

I'd say, hmmmm, something like tex.parshape? :)

I.e., following Ingo's notation from the TeXbook:

tex.parshape = {
  {<i1>, <l1>},
  {<i2>, <l2>},
  ...
  {<in>, <ln>}
  }

As usual, all the values are given in scaled points.

Best,
Paul


From ikrabbe.ask at gmail.com  Mon Feb 27 17:20:19 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Mon, 27 Feb 2012 17:20:19 +0100
Subject: [luatex] parshape
In-Reply-To: <20120227053527.90587A60FD@smtp3-g21.free.fr>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
Message-ID: <20120227162019.GE22577@ask-sec>

On Mon, Feb 27, 2012 at 06:35:26AM +0100, Paul Isambert wrote:
> Patrick Gundlach <patrick at gundla.ch> a ?crit:
> > 
> > Hello,
> > 
> > (4.13.13.2 tex.linebreak())
> > 
> > in tex.linebreak() I can give "parameters". How is the parshape table suppose to look like? Is it a table of 
> > 
> > { n, <glue_spec>,<glue_spec>, .. 2n <glue_spec> items}
> > ?
> > 
> > Or what do I need to fill in?
> 
> I'd say, hmmmm, something like tex.parshape? :)
> 
> I.e., following Ingo's notation from the TeXbook:

OT:
User-Agent: Homemade email client working with Vim, still alpha and not public.

well done!


> 
> tex.parshape = {
>   {<i1>, <l1>},
>   {<i2>, <l2>},
>   ...
>   {<in>, <ln>}
>   }
> 
> As usual, all the values are given in scaled points.

I just wonder after this discussion, why even simple and solved things
have to become more complex, when redesigning as in luatex.

-- 
i don't do signatures

From patrick at gundla.ch  Tue Feb 28 07:29:01 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 28 Feb 2012 07:29:01 +0100
Subject: [luatex] parshape
In-Reply-To: <20120227162019.GE22577@ask-sec>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
Message-ID: <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>


>> tex.parshape = {
>>  {<i1>, <l1>},
>>  {<i2>, <l2>},
>>  ...
>>  {<in>, <ln>}
>>  }
>> 
>> As usual, all the values are given in scaled points.
> 
> I just wonder after this discussion, why even simple and solved things
> have to become more complex, when redesigning as in luatex.

you mean more complex than

parshape =  n, i_0, l_0, ... , i_n, l_n ?

Patrick


From ikrabbe.ask at gmail.com  Tue Feb 28 08:40:33 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Tue, 28 Feb 2012 08:40:33 +0100
Subject: [luatex] parshape
In-Reply-To: <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
 <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
Message-ID: <20120228074033.GB2428@ask-sec>

On Tue, Feb 28, 2012 at 07:29:01AM +0100, Patrick Gundlach wrote:
> 
> >> tex.parshape = {
> >>  {<i1>, <l1>},
> >>  {<i2>, <l2>},
> >>  ...
> >>  {<in>, <ln>}
> >>  }
> >> 
> >> As usual, all the values are given in scaled points.
> > 
> > I just wonder after this discussion, why even simple and solved things
> > have to become more complex, when redesigning as in luatex.
> 
> you mean more complex than
> 
> parshape =  n, i_0, l_0, ... , i_n, l_n ?

right, and that the parameters have to be calculated to scaled points,
instead of given as glue.

On the other hand, I understand that this is just the intrinsic formula
for luatex programming, and in this context, the list is completely
understandable in the the format, given above.

> 
> Patrick

-- 
i don't do signatures

From reinhard.kotucha at web.de  Wed Feb 29 00:15:31 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 29 Feb 2012 00:15:31 +0100
Subject: [luatex] parshape
In-Reply-To: <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
 <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
Message-ID: <20301.24595.751182.393560@zaphod.ms25.net>

On 2012-02-28 at 07:29:01 +0100, Patrick Gundlach wrote:

 > 
 > >> tex.parshape = {
 > >>  {<i1>, <l1>},
 > >>  {<i2>, <l2>},
 > >>  ...
 > >>  {<in>, <ln>}
 > >>  }
 > >> 
 > >> As usual, all the values are given in scaled points.
 > > 
 > > I just wonder after this discussion, why even simple and solved things
 > > have to become more complex, when redesigning as in luatex.
 > 
 > you mean more complex than
 > 
 > parshape =  n, i_0, l_0, ... , i_n, l_n ?

I'm not sure either what Ingo meant.  But the first parameter (n) in
\parshape is needed by TeX's parser in order determine the number of
arguments.  In Lua it's not needed and should be avoided.

I like Paul's proposal very much.  It's exactly what Lua programmers
expect.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From patrick at gundla.ch  Wed Feb 29 08:42:32 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Feb 2012 08:42:32 +0100
Subject: [luatex] parshape
In-Reply-To: <20120228074033.GB2428@ask-sec>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
 <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
 <20120228074033.GB2428@ask-sec>
Message-ID: <0B1E6920-9978-4F7B-88E1-1853D5514C1D@gundla.ch>

>> right, and that the parameters have to be calculated to scaled points,
> instead of given as glue.
> 
> On the other hand, I understand that this is just the intrinsic formula
> for luatex programming, and in this context, the list is completely
> understandable in the the format, given above.


in LuaTeX (on the lua side) everything works with scaled points (when a <dimen> is expected).

For example, when you create a new kern node:

k = node.new("kern")
k.kern = 2 * 2^16 -- that is 2 TeX points


I confused <dimen> in the explanation in the TeXbook with <glue>. Thus I assumed glue_spec nodes in the parshape table of tex.linebreak().

Patrick




From ikrabbe.ask at gmail.com  Wed Feb 29 05:44:43 2012
From: ikrabbe.ask at gmail.com (Ingo Krabbe)
Date: Wed, 29 Feb 2012 05:44:43 +0100
Subject: [luatex] parshape
In-Reply-To: <20301.24595.751182.393560@zaphod.ms25.net>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
 <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
 <20301.24595.751182.393560@zaphod.ms25.net>
Message-ID: <20120229044443.GL2428@ask-sec>

On Wed, Feb 29, 2012 at 12:15:31AM +0100, Reinhard Kotucha wrote:
> On 2012-02-28 at 07:29:01 +0100, Patrick Gundlach wrote:
> 
>  > 
>  > >> tex.parshape = {
>  > >>  {<i1>, <l1>},
>  > >>  {<i2>, <l2>},
>  > >>  ...
>  > >>  {<in>, <ln>}
>  > >>  }
>  > >> 
>  > >> As usual, all the values are given in scaled points.
>  > > 
>  > > I just wonder after this discussion, why even simple and solved things
>  > > have to become more complex, when redesigning as in luatex.
>  > 
>  > you mean more complex than
>  > 
>  > parshape =  n, i_0, l_0, ... , i_n, l_n ?
> 
> I'm not sure either what Ingo meant.  But the first parameter (n) in
> \parshape is needed by TeX's parser in order determine the number of
> arguments.  In Lua it's not needed and should be avoided.
> 
> I like Paul's proposal very much.  It's exactly what Lua programmers
> expect.

I'm sorry for the confusion. This all came from a misunderstanding, in
which context of code such a statement p={ {}, {}, ..., {} } will be
used.

When you write a document it is still easier to have a \parshape
declaration, as TeX introduces, since TeX is a language to write
documents. TeX is more flexible in how the arguments are parsed as glue,
as you can say: \parshape=6 5mm 4.5cm 10mm 3cm 0mm 5cm.

On the other hand, when you write algorithms that somehow calculate the
parshape from some other parameters, the way lua does this is exactly
what you want, together with the parameter normalization to scaled
points.

regards

ingo

> 
> Regards,
>   Reinhard
> 
> -- 
> ----------------------------------------------------------------------------
> Reinhard Kotucha                                      Phone: +49-511-3373112
> Marschnerstr. 25
> D-30167 Hannover                              mailto:reinhard.kotucha at web.de
> ----------------------------------------------------------------------------
> Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
> ----------------------------------------------------------------------------

-- 
i don't do signatures

From patrick at gundla.ch  Wed Feb 29 14:21:05 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Feb 2012 14:21:05 +0100
Subject: [luatex] parshape
In-Reply-To: <20120229044443.GL2428@ask-sec>
References: <ADE1523A-085B-4727-AC45-39CAFD32E4F1@gundla.ch>
 <20120227053527.90587A60FD@smtp3-g21.free.fr>
 <20120227162019.GE22577@ask-sec>
 <3870BCBC-0918-480C-AE9E-BCA9E6BEC8AD@gundla.ch>
 <20301.24595.751182.393560@zaphod.ms25.net> <20120229044443.GL2428@ask-sec>
Message-ID: <8406BB0E-966B-417B-B80E-D2F9836CBEFC@gundla.ch>


> On the other hand, when you write algorithms that somehow calculate the
> parshape from some other parameters, the way lua does this is exactly
> what you want, together with the parameter normalization to scaled
> points.

just to add some background information. See the attached image. The yellow cells are "allocated cells" in a grid and the text flows around it automatically. The text is generated "manually" with glyph nodes and other Lua(TeX) nodes and the function tex.linebreak(). Therefore I need the Lua equivalent of \parshape to get the text shaped as it should be.

Patrick


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20120229/27f3b611/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: text-image-alloc.png
Type: image/png
Size: 191395 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120229/27f3b611/attachment-0001.png>

From Arno.Trautmann at gmx.de  Wed Feb 29 20:19:28 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 29 Feb 2012 20:19:28 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
Message-ID: <4F4E7A40.4040208@gmx.de>

Hi all,

the lua-visual-debug package seems to be unable to handle footnotes. Is 
this known/intended? The footnote in the following basic example is 
complete displaced:

\documentclass{article}

\usepackage{lua-visual-debug}


\begin{document}
a\footnote{b}
\end{document}

cheers
Arno

From patrick at gundla.ch  Wed Feb 29 21:31:57 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Feb 2012 21:31:57 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <4F4E7A40.4040208@gmx.de>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <4F4E7A40.4040208@gmx.de>
Message-ID: <DED69F27-7EFE-4F60-9AD4-8A7F1E7050A1@gundla.ch>

Hello Arno,

> the lua-visual-debug package seems to be unable to handle footnotes. Is this known/intended? The footnote in the following basic example is complete displaced:

holy cow! This is not intended and a known issue (since 2 minutes ago).

I'll look into it and try to find a fix.

Thank you very much for the report!

Patrick



From patrick at gundla.ch  Wed Feb 29 21:46:36 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 Feb 2012 21:46:36 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <DED69F27-7EFE-4F60-9AD4-8A7F1E7050A1@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <4F4E7A40.4040208@gmx.de> <DED69F27-7EFE-4F60-9AD4-8A7F1E7050A1@gundla.ch>
Message-ID: <DE077816-5D2A-435E-B35B-C8E6152C12F7@gundla.ch>

Hello Arno,

> the lua-visual-debug package seems to be unable to handle footnotes. Is this known/intended? The footnote in the following basic example is complete displaced:



Fix will be on CTAN soon. Thanks for the report.

Patrick


-------------- next part --------------
A non-text attachment was scrubbed...
Name: lua-visual-debug.lua
Type: application/octet-stream
Size: 6413 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120229/c4a41481/attachment.obj>

From Arno.Trautmann at gmx.de  Wed Feb 29 23:12:25 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 29 Feb 2012 23:12:25 +0100
Subject: [luatex] FYI: visual debugging in LuaLaTeX
In-Reply-To: <DE077816-5D2A-435E-B35B-C8E6152C12F7@gundla.ch>
References: <8C7DF1CD-327C-4C2C-814F-9BB03BB0BDF6@gundla.ch>
 <4F4E7A40.4040208@gmx.de> <DED69F27-7EFE-4F60-9AD4-8A7F1E7050A1@gundla.ch>
 <DE077816-5D2A-435E-B35B-C8E6152C12F7@gundla.ch>
Message-ID: <4F4EA2C9.4010805@gmx.de>

Patrick Gundlach wrote:
> Hello Arno,
>
>> the lua-visual-debug package seems to be unable to handle footnotes. Is this known/intended? The footnote in the following basic example is complete displaced:
>
> Fix will be on CTAN soon. Thanks for the report.

Did I ever forget to mention that I just love the quick response of TeX 
[package] developers on bug reports?

Thank you!

Arno

