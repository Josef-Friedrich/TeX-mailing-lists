From andreas.matthias at gmail.com  Sun Jun  3 14:50:13 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Sun, 3 Jun 2012 14:50:13 +0200
Subject: [luatex] glue_order `sfi'
Message-ID: <553s99-osk.ln1@winky.hogwarts>

I'm wondering about glue_order `sfi'. Why was it introduced?
Could someone give me some information about this glue_order?

Ciao
Andreas


From patrick at gundla.ch  Sun Jun  3 17:42:36 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 3 Jun 2012 17:42:36 +0200
Subject: [luatex] glue_order `sfi'
In-Reply-To: <553s99-osk.ln1@winky.hogwarts>
References: <553s99-osk.ln1@winky.hogwarts>
Message-ID: <ECF34E18-1C5E-415C-9C69-FA35A5F5237C@gundla.ch>

Hello Andreas,

> I'm wondering about glue_order `sfi'. Why was it introduced?

I assume it is the same as "fi" without "s"? It comes from omega

> Could someone give me some information about this glue_order?


"5.1 New infinity level

A new infinity level fi has been added. It is smaller than fil but bigger than any finite quantity. Its original intention was for inter-letter stretching: either filling-in-the-black, as is done for calligraphic scripts such as Arabic; or for emphasis, as in Russian; all this without having to rewrite existing macro packages. There is therefore a new keyword, fi, and two new primitives, \hfi and \vfi."


Can't find the manual on the internet at the moment.

Patrick



From nicolas.holzschuch at inria.fr  Mon Jun  4 11:40:50 2012
From: nicolas.holzschuch at inria.fr (Nicolas Holzschuch)
Date: Mon, 4 Jun 2012 11:40:50 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
Message-ID: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>

Hello fellow luaTeX-perts,

so I'm trying to make TeX run on my iPad. No real big deal, except that
the available memory is really small. Overall, compiling the binaries
works nicely.

However, I'm running into a problem with LuaLaTeX, combined with
fontspec (LuaLaTeX without fontspec runs fine, but what's the point?)

It loads the fonts, processes the TeX file, goes as far as "here's how
much of TeX memory you've used" and even writes the first font into the
PDF file. 

And that's exactly where it crashes, all the time. Right after dumping
the first font in the PDF file.

Now I know this must be an uncommon problem, but is there anyone who
could point me to the right place to start debugging this?

Is my problem in fontspec, or in luaotfload? Somewhere else?
(I have the latest files from the TeXLive 2012 SVN server).

Here are the last lines of the TeX output:
(?)
Overfull \hbox (25.72816pt too wide) in paragraph at lines 25--27
[]\EU2/LinuxLibertineO(0)/m/n/10.95 ???? ?? ???????? ????
??????? ????????? ??? ???? ???? ??????
????? ??? ?? ??????????. 

Underfull \hbox (badness 10000) in paragraph at lines 29--30

 [1{/private/var/mobile/src/trunk/Master/texmf-var/fonts/map/pdftex/updmap/pdft
ex.map}] (./testModernTeX.aux) )
(see the transcript file for additional information)
 291 words of node memory still in use:
   3 hlist, 1 vlist, 1 rule, 2 glue, 3 attribute, 40 glue_spec, 3 attribute_lis
t, 1 write nodes
   avail lists: 1:1,2:1633,3:49,4:263,5:32,6:525,7:2,9:34,10:17
</private/var/mobile/src/trunk/Master/texmf-dist/fonts/opentype/public/libertin
eotf/LinLibertine_RI.otf>Segmentation fault: 11

~/TeXProjects mobile$ 

Thanks for any help, 
Nicolas



From taco at elvenkind.com  Mon Jun  4 11:45:31 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 4 Jun 2012 11:45:31 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
In-Reply-To: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
References: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
Message-ID: <4FCC83BB.4040601@elvenkind.com>

On 06/04/2012 11:40 AM, Nicolas Holzschuch wrote:
>
> Now I know this must be an uncommon problem, but is there anyone who
> could point me to the right place to start debugging this?

In Xcode. In particular, the stack backtrace from the crash should be
helpful.

Best wishes,
Taco




From luatex at nililand.de  Mon Jun  4 14:58:30 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 4 Jun 2012 14:58:30 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
References: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
Message-ID: <10ccrsl37nqty.dlg@nililand.de>

Am Mon, 4 Jun 2012 11:40:50 +0200 schrieb Nicolas Holzschuch:

> Is my problem in fontspec, or in luaotfload? Somewhere else?

It could be also in the font or in your code. 

You should show a minimal example that demonstrates the problem. And
you should try other fonts e.g. \setmainfont{Arial} or the default
fonts of fontspec.


-- 
Ulrike Fischer 


From Nicolas.Holzschuch at inria.fr  Mon Jun  4 15:16:01 2012
From: Nicolas.Holzschuch at inria.fr (Nicolas Holzschuch)
Date: Mon, 4 Jun 2012 15:16:01 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
In-Reply-To: <10ccrsl37nqty.dlg@nililand.de>
References: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
 <10ccrsl37nqty.dlg@nililand.de>
Message-ID: <A45BE843-209C-4531-BE0B-C0E5E12B0582@inria.fr>

Hello,

On 4 Jun 2012, at 14:58, Ulrike Fischer wrote:
> Am Mon, 4 Jun 2012 11:40:50 +0200 schrieb Nicolas Holzschuch:
> 
>> Is my problem in fontspec, or in luaotfload? Somewhere else?
> 
> It could be also in the font or in your code. 
> 
> You should show a minimal example that demonstrates the problem. And
> you should try other fonts e.g. \setmainfont{Arial} or the default
> fonts of fontspec.

You're right. Here is a minimal example of code:

\documentclass[11pt]{article}
\usepackage{fontspec}
\begin{document}
 a
\end{document}

And again, it ends in:
(?)

(/private/var/mobile/src/trunk/Master/texmf-dist/tex/latex/latexconfig/epstopdf
-sys.cfg)) [1{/private/var/mobile/src/trunk/Master/texmf-var/fonts/map/pdftex/u
pdmap/pdftex.map}] (./minimal.aux) )
 285 words of node memory still in use:
   3 hlist, 1 vlist, 1 rule, 2 glue, 3 attribute, 40 glue_spec, 3 attribute_lis
t, 1 write nodes
   avail lists: 2:23,3:2,4:26,6:9,7:1,9:8
</private/var/mobile/src/trunk/Master/texmf-dist/fonts/opentype/public/lm/lmrom
an10-regular.otf>Segmentation fault: 11

Best regards, 
Nicolas Holzschuch

From andreas.matthias at gmail.com  Mon Jun  4 20:26:17 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Mon, 4 Jun 2012 20:26:17 +0200
Subject: [luatex] glue_order `sfi'
References: <553s99-osk.ln1@winky.hogwarts>
 <ECF34E18-1C5E-415C-9C69-FA35A5F5237C@gundla.ch>
Message-ID: <97bv99-8b6.ln1@winky.hogwarts>

Patrick Gundlach wrote:

> Hello Andreas,
> 
>> I'm wondering about glue_order `sfi'. Why was it introduced?
> 
> I assume it is the same as "fi" without "s"?

The keyword is `fi' but in the source it's called `sfi'.

> It comes from omega

I see. So it was not introduced by luatex which was my first
assumption.

> Can't find the manual on the internet at the moment.

It's there, on CTAN ;-)


Thanks.
Andreas


From taco at elvenkind.com  Tue Jun  5 10:06:00 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 5 Jun 2012 10:06:00 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
In-Reply-To: <B3474BD5-8946-4EF4-BA68-09821216F7B2@inria.fr>
References: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
 <4FCC83BB.4040601@elvenkind.com>
 <B3474BD5-8946-4EF4-BA68-09821216F7B2@inria.fr>
Message-ID: <4FCDBDE8.7080509@elvenkind.com>

On 06/04/2012 06:26 PM, Nicolas Holzschuch wrote:
> #0  write_cid_tounicode (pdf=0x2fdff4fc, fo=0x40427a0, f=Cannot access memory at address 0x2fcff478
> ) at ../../../source/texk/web2c/luatexdir/font/tounicode.w:479
> #1  0x0006d4b8 in write_cid_fontdictionary (pdf=0x1afbc00, fo=0x40427a0, f=21) at ../../../source/texk/web2c/luatexdir/font/writefont.w:990

Either went wrong during your compilation, or the call stack on
the iPad is too small.

write_cid_fontdictionary and  write_cid_tounicode have the same
function prototype with the same argument list, and the start of
write_cid_fontdictionary is:

void write_cid_fontdictionary(PDF pdf, fo_entry * fo, 
internal_font_number f)
{
     int i;
     fo->tounicode_objnum = write_cid_tounicode(pdf, fo, f);

So, unless something was seriously messed up, both argument lists in
the backtrace should look the exactly the same.  Instead, both 'pdf'
and 'f' have changed on the call stack, and usually that happens
because the call stack has overrun.  Possibly because of this:

int write_cid_tounicode(PDF pdf, fo_entry * fo, internal_font_number f)
{

     int range_size[65537];
     glyph_unicode_entry gtab[65537];

Changing those static local definitions into malloc-ed memory
will probably fix the bug (at least, this bug. You may well run
into a similar or different memory-related problem elsewhere).

Best wishes,

Taco

From Nicolas.Holzschuch at inria.fr  Tue Jun  5 21:06:24 2012
From: Nicolas.Holzschuch at inria.fr (Nicolas Holzschuch)
Date: Tue, 5 Jun 2012 21:06:24 +0200
Subject: [luatex] Odd behavior of luatex + fontspec + luaotfload
In-Reply-To: <4FCDBDE8.7080509@elvenkind.com>
References: <C716884F-8BC1-4395-A2A5-B359D0AB83DA@inria.fr>
 <4FCC83BB.4040601@elvenkind.com>
 <B3474BD5-8946-4EF4-BA68-09821216F7B2@inria.fr>
 <4FCDBDE8.7080509@elvenkind.com>
Message-ID: <89A0A47F-461D-4050-B2FC-27AE3CA6C450@inria.fr>

On Jun 5, 2012, at 10:06, Taco Hoekwater <taco at elvenkind.com> wrote:

> On 06/04/2012 06:26 PM, Nicolas Holzschuch wrote:
>> #0  write_cid_tounicode (pdf=0x2fdff4fc, fo=0x40427a0, f=Cannot access memory at address 0x2fcff478
>> ) at ../../../source/texk/web2c/luatexdir/font/tounicode.w:479
>> #1  0x0006d4b8 in write_cid_fontdictionary (pdf=0x1afbc00, fo=0x40427a0, f=21) at ../../../source/texk/web2c/luatexdir/font/writefont.w:990
> 
> Either went wrong during your compilation, or the call stack on
> the iPad is too small.

Indeed, the call stack is limited to 1020, which is a bit small.

> write_cid_fontdictionary and  write_cid_tounicode have the same
> function prototype with the same argument list, and the start of
> write_cid_fontdictionary is:
> 
> void write_cid_fontdictionary(PDF pdf, fo_entry * fo, internal_font_number f)
> {
>    int i;
>    fo->tounicode_objnum = write_cid_tounicode(pdf, fo, f);
> 
> So, unless something was seriously messed up, both argument lists in
> the backtrace should look the exactly the same.  Instead, both 'pdf'
> and 'f' have changed on the call stack, and usually that happens
> because the call stack has overrun.  Possibly because of this:
> 
> int write_cid_tounicode(PDF pdf, fo_entry * fo, internal_font_number f)
> {
> 
>    int range_size[65537];
>    glyph_unicode_entry gtab[65537];
> 
> Changing those static local definitions into malloc-ed memory
> will probably fix the bug (at least, this bug. You may well run
> into a similar or different memory-related problem elsewhere).

Has anybody ever told you that you're a genius?
Yes, simply changing these two variables into malloc-ed memory solved my problem. I am now able to run  lualatex on my iPad. Thank you very, very much.

As you said, there are other memory issues (with only 256 Mb available, and the system and other apps taking already half of that, I am used to memory issues). But the memory limit now happens at page 28, which is much better.

-- 
Best regards,
Nicolas Holzschuch

> 
> Best wishes,
> 
> Taco


From senseiwa at gmail.com  Thu Jun  7 15:53:03 2012
From: senseiwa at gmail.com (Sensei)
Date: Thu, 7 Jun 2012 15:53:03 +0200
Subject: [luatex] Getting all symbols
Message-ID: <4FD0B23F.70302@gmail.com>

Hi all,

I've posted this question to comp.text.tex, and they've suggested to 
take a look at LuaTeX. So here it goes!

I'm trying to find *at runtime* all the symbols allowed in a latex 
environment. So, given a tex file, I'd like to access
- the complete predefined commands/symbols/definitions;
- the complete list of commands/symbols/definitions defined in packages.

So, the predefined language list would include \LaTeX, \def, 
\newcommand, ~, \usepackage, and so on. I've been informed that this is 
a naive view, since there are lots of other commands such as \@ and 
similars, and a simple match with a \ would be unrealistic (e.g., 
anything beginning with a \ is a command).

When including a package, for example graphicx, I expect to find a way 
to have \includegraphics and its siblings. Again, packages may mess up a 
little bit.

The best would be having commands along with their options, but I don't 
know if this is possible.

One thing I'd like to avoid: creating my own parser. Why on earth should 
I create a parser when latex knows more than me (or everyone else) what 
symbols and commands it knows?

The suggestions from the newsgroup is that *maybe* LuaTeX gives a way to 
access all TeX's macro hash table. If so, I'd be really happy.


Am I looking in the wrong place?


Thanks & Cheers!

From Joerg.Weber at nottingham.ac.uk  Thu Jun  7 12:38:21 2012
From: Joerg.Weber at nottingham.ac.uk (=?ISO-8859-1?Q?J=F6rg_Weber?=)
Date: Thu, 7 Jun 2012 11:38:21 +0100
Subject: [luatex] LuaLaTeX + fontspec: cannot compare documents with Acrobat
Message-ID: <4B6965E54E385E419329B3AA1E1A46F045B8136701@EXCHANGE3.ad.nottingham.ac.uk>

(This is an issue I originally posted here: http://tex.stackexchange.com/questions/58760/lualatex-fontspec-cannot-compare-documents-with-acrobat)

I?use the option "compare documents" in Adobe Acrobat Pro a lot to highlight changes between revisions. What I just noticed is, if I compile a simple document such as the one below with LuaLaTeX + fontspec, Acrobat is unable to perform the comparison, giving a unspecific error message ("cannot compare document..."). Compiling the same document without fontspec allows the comparison, as does XeLaTeX + fontspec.

I tried with TeX Live 2012 and the current MikTeX, without success. Ulrike Fischer suggested \usepackage{luaotfload} \font\test=Arial \pagestyle{empty} and \test after \begin{document} instead of fontspec, but the error remains. Does anyone know what is going on and of a possible fix?

\documentclass{article}
\usepackage{fontspec}
\usepackage{lipsum}

\begin{document}

\lipsum

\end{document}

Best,
J?rg

This message and any attachment are intended solely for the addressee and may contain confidential information. If you have received this message in error, please send it back to me, and immediately delete it.   Please do not use, copy or disclose the information contained in this message or in any attachment.  Any views or opinions expressed by the author of this email do not necessarily reflect the views of the University of Nottingham.

This message has been checked for viruses but the contents of an attachment
may still contain software viruses which could damage your computer system:
you are advised to perform your own checks. Email communications with the
University of Nottingham may be monitored as permitted by UK legislation.

From Arno.Trautmann at gmx.de  Thu Jun  7 17:20:48 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Thu, 7 Jun 2012 17:20:48 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD0B23F.70302@gmail.com>
References: <4FD0B23F.70302@gmail.com>
Message-ID: <4FD0C6D0.3060300@gmx.de>

Hi,

Sensei wrote:
> I'm trying to find *at runtime* all the symbols allowed in a latex
> environment. So, given a tex file, I'd like to access
> - the complete predefined commands/symbols/definitions;
> - the complete list of commands/symbols/definitions defined in packages.

This may not really help, but maybe give a hint: I think I had asked a 
similar question some time ago, Tako answered that he wanted to 
implement something, and Hans answered that he [Tako] already did. 
Unfortunately I cannot find the corresponding mails, sorry.

Cheers
Arno

> So, the predefined language list would include \LaTeX, \def,
> \newcommand, ~, \usepackage, and so on. I've been informed that this is
> a naive view, since there are lots of other commands such as \@ and
> similars, and a simple match with a \ would be unrealistic (e.g.,
> anything beginning with a \ is a command).
>
> When including a package, for example graphicx, I expect to find a way
> to have \includegraphics and its siblings. Again, packages may mess up a
> little bit.
>
> The best would be having commands along with their options, but I don't
> know if this is possible.
>
> One thing I'd like to avoid: creating my own parser. Why on earth should
> I create a parser when latex knows more than me (or everyone else) what
> symbols and commands it knows?
>
> The suggestions from the newsgroup is that *maybe* LuaTeX gives a way to
> access all TeX's macro hash table. If so, I'd be really happy.
>
>
> Am I looking in the wrong place?
>
>
> Thanks & Cheers!
>


From Arno.Trautmann at gmx.de  Thu Jun  7 18:18:19 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Thu, 7 Jun 2012 18:18:19 +0200
Subject: [luatex] Problem with drawing pdf
Message-ID: <4FD0D44B.5010709@gmx.de>

Hi all,

I'm having some trouble using curves in pdf. Inspired by the article by 
Paul Isambert in the TUGboat, I am using the code shown below to draw 
circles. (I'd like to use this to encircle special positions in a text.)
This works fine on my screen. However, the circles are just missing when 
the document is printed. I guess it's just some minor(?) pdf syntax 
error that is ignored by the viewer but leads to problems with printers. 
Unfortunately, I don't have a printer here, so I cannot test things 
easily ? does anyone have a hint what's wrong?

Cheers
Arno

\directlua{
function pdf_print (...)
   for _, str in ipairs({...}) do
     pdf.print(str .. " ")
   end
   pdf.print("\string\n")
end

function move (p)
   pdf_print(p[1],p[2],"m")
end

function curve(p1,p2,p3)
   pdf_print(p1[1], p1[2],
             p2[1], p2[2],
             p3[1], p3[2], "c")
end

function stroke ()
   pdf_print("S")
end

function mysloppycircle(center,radius)
   local left = {center[1] - radius, center[2]}
   local lefttop = {left[1], left[2] + 1.45*radius}
   local leftbot = {lefttop[1], lefttop[2] - 2.9*radius}
   local right = {center[1] + radius, center[2]}
   local righttop = {right[1], right[2] + 1.45*radius}
   local rightbot = {right[1], right[2] - 1.45*radius}

   local right_end = (right)

   move (right)

   curve (righttop,lefttop,left)
   curve (leftbot,rightbot,right_end)

   stroke()
end
}

\long\def\luadraw#1{%
   \vbox to 0bp{%
     \vfil
     \luatexlatelua{pdf_print("q") #1 pdf_print("Q")}%
   }%
}

\luadraw{mysloppycircle({21,-9},5)} test

\bye

From zappathustra at free.fr  Fri Jun  8 11:05:50 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 8 Jun 2012 11:05:50 +0200
Subject: [luatex] Problem with drawing pdf
In-Reply-To: <4FD0D44B.5010709@gmx.de>
References: <4FD0D44B.5010709@gmx.de>
Message-ID: <20120608090551.E2159A6272@smtp3-g21.free.fr>

Arno Trautmann <Arno.Trautmann at gmx.de> a ?crit:
> 
> Hi all,
> 
> I'm having some trouble using curves in pdf. Inspired by the article by 
> Paul Isambert in the TUGboat, I am using the code shown below to draw 
> circles. (I'd like to use this to encircle special positions in a text.)
> This works fine on my screen. However, the circles are just missing when 
> the document is printed. I guess it's just some minor(?) pdf syntax 
> error that is ignored by the viewer but leads to problems with printers. 
> Unfortunately, I don't have a printer here, so I cannot test things 
> easily ? does anyone have a hint what's wrong?

The PDF syntax is ok as far as I can tell, and anyway the circle is
properly printed with my printer. So I'd say perhaps the printer you
used just doesn't understand PDF graphics, but since I'm totally
incompetent here it's a wild guess (I don't know if such a printer
exists).

Best,
Paul


From senseiwa at gmail.com  Fri Jun  8 12:10:43 2012
From: senseiwa at gmail.com (Sensei)
Date: Fri, 8 Jun 2012 12:10:43 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD0C6D0.3060300@gmx.de>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
Message-ID: <4FD1CFA3.3050203@gmail.com>

On 6/7/12 5:20 PM, Arno Trautmann wrote:
> Hi,
>
> Sensei wrote:
>> I'm trying to find *at runtime* all the symbols allowed in a latex
>> environment. So, given a tex file, I'd like to access
>> - the complete predefined commands/symbols/definitions;
>> - the complete list of commands/symbols/definitions defined in packages.
>
> This may not really help, but maybe give a hint: I think I had asked a
> similar question some time ago, Tako answered that he wanted to
> implement something, and Hans answered that he [Tako] already did.
> Unfortunately I cannot find the corresponding mails, sorry.


Thanks for the answer, but it seems that the archive contains only this 
thread with "tako".

Am I lost?

From mojca.miklavec.lists at gmail.com  Fri Jun  8 12:14:58 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Fri, 8 Jun 2012 12:14:58 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD1CFA3.3050203@gmail.com>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <4FD1CFA3.3050203@gmail.com>
Message-ID: <CALBOmsa_8=HJRPn88oNhFYMi0y6RndxhohbjDSB_nyHS8AP3wA@mail.gmail.com>

On Fri, Jun 8, 2012 at 12:10 PM, Sensei wrote:
> On 6/7/12 5:20 PM, Arno Trautmann wrote:
>
>> This may not really help, but maybe give a hint: I think I had asked a
>> similar question some time ago, Tako answered
>
> Thanks for the answer, but it seems that the archive contains only this
> thread with "tako".

You could try with the non-phonetic version of his name, Taco Hoekwater ;)
No guarantee that it would return you anything though, and there are
actually two mailing lists, a development one (on ntg.nl) and the
user-oriented one.

Mojca

From weber at jwe.cc  Fri Jun  8 17:25:32 2012
From: weber at jwe.cc (=?iso-8859-1?Q?J=F6rg_Weber?=)
Date: Fri, 8 Jun 2012 15:25:32 +0000
Subject: [luatex] LuaLaTeX + fontspec: cannot compare documents with Acrobat
Message-ID: <F5BB236ECA942C4587667F86D518307F28EA05DC@AMSPRD0410MB363.eurprd04.prod.outlook.com>

(This is an issue I originally posted here: http://tex.stackexchange.com/questions/58760/lualatex-fontspec-cannot-compare-documents-with-acrobat)

I use the option "compare documents" in Adobe Acrobat Pro a lot to highlight changes between revisions. What I just noticed is, if I compile a simple document such as the one below with LuaLaTeX + fontspec, Acrobat is unable to perform the comparison, giving a unspecific error message ("cannot compare document..."). Compiling the same document without fontspec allows the comparison, as does XeLaTeX + fontspec.

I tried with TeX Live 2012 and the current MikTeX, without success. Ulrike Fischer suggested \usepackage{luaotfload} \font\test=Arial \pagestyle{empty} and \test after \begin{document} instead of fontspec, but the error remains. Does anyone know what is going on and of a possible fix?

\documentclass{article}
\usepackage{fontspec}
\usepackage{lipsum}

\begin{document}

\lipsum

\end{document}

Best,
J?rg



From patrick at gundla.ch  Fri Jun  8 21:51:41 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 8 Jun 2012 21:51:41 +0200
Subject: [luatex] LuaLaTeX + fontspec: cannot compare documents with
	Acrobat
In-Reply-To: <F5BB236ECA942C4587667F86D518307F28EA05DC@AMSPRD0410MB363.eurprd04.prod.outlook.com>
References: <F5BB236ECA942C4587667F86D518307F28EA05DC@AMSPRD0410MB363.eurprd04.prod.outlook.com>
Message-ID: <37BE3B67-EDA9-4C9D-BECC-B8132A62893D@gundla.ch>


> 
> \documentclass{article}
> \usepackage{fontspec}
> \usepackage{lipsum}
> 
> \begin{document}
> 
> \lipsum
> 
> \end{document}

that document works fine here (Acrobat 8, Mac) with "normal" analysis.

Patrick


From patrick at gundla.ch  Fri Jun  8 21:59:30 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 8 Jun 2012 21:59:30 +0200
Subject: [luatex] Problem with drawing pdf
In-Reply-To: <4FD0D44B.5010709@gmx.de>
References: <4FD0D44B.5010709@gmx.de>
Message-ID: <C1CBA0F3-4036-46BF-8940-F7FCD61C038A@gundla.ch>

> 
> This works fine on my screen. However, the circles are just missing when the document is printed. I guess it's just some minor(?) pdf syntax error that is ignored by the viewer but leads to problems with printers. Unfortunately, I don't have a printer here, so I cannot test things easily ? does anyone have a hint what's wrong?

acrobat 8 tells me that your document is fine.

Patrick



From Arno.Trautmann at gmx.de  Sat Jun  9 19:06:19 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 9 Jun 2012 19:06:19 +0200
Subject: [luatex] =?utf-8?q?Libertine_+math_shift_+_=C3=A4_=3D_error=3F?=
Message-ID: <4FD3828B.80204@gmx.de>

Hi all,

I'm getting a strange error when I try to compile the following code:

\documentclass{scrartcl}
\usepackage{fontspec}
\setmainfont{Linux Libertine O}
\begin{document}
$8,56 eV$, wa?hrend
\end{document}

The error I get states:

error: ...1/texmf-dist/tex/luatex/luaotfload/otfl-node-inj.lua:197: 
attempt to index local 'tm' (a nil value)
.
\newpage ...k \@nobreakfalse \everypar {}\fi \par
                                                   \vfil \penalty -\@M
l.6 \end{document}

?

Please note that the ?a? glyph is not a single character, but is a 
composite umlaut plus an a. (You get this, e.g. by copying from the Mac 
preview software instead of the ? that originally was used.) A normal ? 
in the source code does work without problems.

However, this seems to happen only with the Linux Libertine font. But 
the really mind blowing thing here is: The error only appears when a 
math shift is used in the paragraph where the ? appears ? both before 
and after the ?. This makes things hard to track ?

So, any ideas what the problem here could be?

cheers
Arno

From Arno.Trautmann at gmx.de  Sat Jun  9 19:24:59 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 9 Jun 2012 19:24:59 +0200
Subject: [luatex] Problem with drawing pdf
In-Reply-To: <C1CBA0F3-4036-46BF-8940-F7FCD61C038A@gundla.ch>
References: <4FD0D44B.5010709@gmx.de>
 <C1CBA0F3-4036-46BF-8940-F7FCD61C038A@gundla.ch>
Message-ID: <4FD386EB.2040504@gmx.de>

Thanks for testing, Patrick and Paul. Maybe the differences between the 
original document and the minimal example I provided make problems ? 
I'll have to take a look at it and make some test prints ?

cheers
Arno

Patrick Gundlach wrote:
>>
>> This works fine on my screen. However, the circles are just missing when the document is printed. I guess it's just some minor(?) pdf syntax error that is ignored by the viewer but leads to problems with printers. Unfortunately, I don't have a printer here, so I cannot test things easily ? does anyone have a hint what's wrong?
>
> acrobat 8 tells me that your document is fine.
>
> Patrick
>
>
>


From weber at jwe.cc  Sun Jun 10 16:07:34 2012
From: weber at jwe.cc (=?iso-8859-1?Q?J=F6rg_Weber?=)
Date: Sun, 10 Jun 2012 14:07:34 +0000
Subject: [luatex] LuaLaTeX + fontspec: cannot compare documents
	with	Acrobat
In-Reply-To: <37BE3B67-EDA9-4C9D-BECC-B8132A62893D@gundla.ch>
References: <F5BB236ECA942C4587667F86D518307F28EA05DC@AMSPRD0410MB363.eurprd04.prod.outlook.com>
 <37BE3B67-EDA9-4C9D-BECC-B8132A62893D@gundla.ch>
Message-ID: <F5BB236ECA942C4587667F86D518307F28EA22A8@AMSPRD0410MB363.eurprd04.prod.outlook.com>

You are right, I just tested it with Acrobat 8,9 and 10. LuaLaTeX+ fontspec documents compare fine with v8, but not v9 or v10. Adobe changed the comparison routine from version 9 onwards quite substantially, and the new implementation is much much better. Does anyone has a suggestion how to tackle this problem?


-----Original Message-----
From: luatex-bounces at tug.org [mailto:luatex-bounces at tug.org] On Behalf Of Patrick Gundlach
Sent: Friday, June 08, 2012 8:52 PM
To: General discussion of LuaTeX.
Subject: Re: [luatex] LuaLaTeX + fontspec: cannot compare documents with Acrobat


> 
> \documentclass{article}
> \usepackage{fontspec}
> \usepackage{lipsum}
> 
> \begin{document}
> 
> \lipsum
> 
> \end{document}

that document works fine here (Acrobat 8, Mac) with "normal" analysis.

Patrick





From taco at elvenkind.com  Mon Jun 11 10:25:18 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 11 Jun 2012 10:25:18 +0200
Subject: [luatex] LuaLaTeX + fontspec: cannot compare documents
	with	Acrobat
In-Reply-To: <F5BB236ECA942C4587667F86D518307F28EA22A8@AMSPRD0410MB363.eurprd04.prod.outlook.com>
References: <F5BB236ECA942C4587667F86D518307F28EA05DC@AMSPRD0410MB363.eurprd04.prod.outlook.com>
 <37BE3B67-EDA9-4C9D-BECC-B8132A62893D@gundla.ch>
 <F5BB236ECA942C4587667F86D518307F28EA22A8@AMSPRD0410MB363.eurprd04.prod.outlook.com>
Message-ID: <4FD5AB6E.7060907@elvenkind.com>

On 06/10/2012 04:07 PM, J?rg Weber wrote:
> You are right, I just tested it with Acrobat 8,9 and 10. LuaLaTeX+
> fontspec documents compare fine with v8, but not v9 or v10. Adobe
> changed the comparison routine from version 9 onwards quite
> substantially, and the new implementation is much much better. Does
> anyone has a suggestion how to tackle this problem?

You'll have to get Adobe to fess up what the exact requirements are,
and report back to us what should be changed so that the Acrobat(tm)
Black Box can Do The Right Thing.  Quite simple, really. ;)

Best wishes,
Taco






From andreas.matthias at gmail.com  Mon Jun 11 22:56:44 2012
From: andreas.matthias at gmail.com (Andreas Matthias)
Date: Mon, 11 Jun 2012 22:56:44 +0200
Subject: [luatex] \pdfrefobj -> \pdfobj
Message-ID: <cl2ia9-rvf.ln1@winky.hogwarts>

If I have got the node of a \pdfrefobj, how do I get the node
of the corresponding \pdfobj?


From zappathustra at free.fr  Tue Jun 12 07:34:57 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 12 Jun 2012 07:34:57 +0200
Subject: [luatex] \pdfrefobj -> \pdfobj
In-Reply-To: <cl2ia9-rvf.ln1@winky.hogwarts>
References: <cl2ia9-rvf.ln1@winky.hogwarts>
Message-ID: <20120612053458.829CEA6260@smtp3-g21.free.fr>

Andreas Matthias <andreas.matthias at gmail.com> a ?crit:
> 
> If I have got the node of a \pdfrefobj, how do I get the node
> of the corresponding \pdfobj?

It doesn't exist; the object is kept in memory and its content is written
to the PDF file when \pdfrefobj is called with the associated number
(or if \pdfobj is \immediate). So it is not a node.

It may be nice (I don't know) to have a command to retrieve the content
of a pdf object, but of course you couldn't modify it because perhaps
the object has already been written to the PDF. (I say that in case
that's what you wanted to do.)

Best,
Paul


From luatex at nililand.de  Tue Jun 12 11:48:13 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 12 Jun 2012 11:48:13 +0200
Subject: [luatex] Getting all symbols
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
Message-ID: <1qpsfizhzv6lq.dlg@nililand.de>

Am Thu, 7 Jun 2012 17:20:48 +0200 schrieb Arno Trautmann:


>> I'm trying to find *at runtime* all the symbols allowed in a latex
>> environment. So, given a tex file, I'd like to access
>> - the complete predefined commands/symbols/definitions;
>> - the complete list of commands/symbols/definitions defined in packages.
 
> This may not really help, but maybe give a hint: I think I had asked a 
> similar question some time ago, Tako answered that he wanted to 
> implement something, and Hans answered that he [Tako] already did. 
> Unfortunately I cannot find the corresponding mails, sorry.

The thread starts here
http://tug.org/mailman/htdig/luatex/2011-July/003115.html

And Hans answer is here
http://tug.org/mailman/htdig/luatex/2011-July/003125.html


If I process the following document with 

"lualatex test > output.txt"

I get a list of about 3500 commands in output.txt

\documentclass{article}

\begin{document}
\directlua{
 for name in pairs(tex.hashtokens()) do
     print(name)
 end}
\end{document}

Addings fontspec leds to 14.000 commands.

-- 
Ulrike Fischer 


From senseiwa at gmail.com  Tue Jun 12 16:29:09 2012
From: senseiwa at gmail.com (Sensei)
Date: Tue, 12 Jun 2012 16:29:09 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <1qpsfizhzv6lq.dlg@nililand.de>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de>
Message-ID: <4FD75235.50307@gmail.com>

On 6/12/12 11:48am, Ulrike Fischer wrote:
> The thread starts here
> http://tug.org/mailman/htdig/luatex/2011-July/003115.html
>
> And Hans answer is here
> http://tug.org/mailman/htdig/luatex/2011-July/003125.html
>
>
> If I process the following document with
>
> "lualatex test>  output.txt"
>
> I get a list of about 3500 commands in output.txt
>
> \documentclass{article}
>
> \begin{document}
> \directlua{
>   for name in pairs(tex.hashtokens()) do
>       print(name)
>   end}
> \end{document}
>
> Addings fontspec leds to 14.000 commands.


Thanks for the info!

I am puzzled by the output, though. When I dump the contents to a file, 
with the following:

\documentclass{article}

\begin{document}
\directlua{
  local f = io.open("hash.txt", "w")
  for name in pairs(tex.hashtokens()) do
      f:write(name .. ";;;;")
  end
  f:close()}
\end{document}



I can't open it with ease with a text editor: it complains it has a 
corrupt UTF-8 enconding. I am using ";;;;" since I don't know how to add 
a new line safely here: sorry for this inconvenience.


Moreover, I can find symbols that are common, for example begin, textit, 
equation, but they're all without a backslash. How can I distinguish 
between \ commands and known symbols? For example, begin is a command, 
\begin, and it may accept the environment flushleft, but not \flushleft.

It is somewhat confusing to me...


From Robin.Fairbairns at cl.cam.ac.uk  Tue Jun 12 16:57:03 2012
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 12 Jun 2012 15:57:03 +0100
Subject: [luatex] Getting all symbols
In-Reply-To: Your message of Tue, 12 Jun 2012 16:29:09 +0200.
 <4FD75235.50307@gmail.com>
Message-ID: <8256.1339513023@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> [ulrike's code snipped]
> 
> I am puzzled by the output, though. When I dump the contents to a
> file, with the following:
> 
> \documentclass{article}
> 
> \begin{document}
> \directlua{
>  local f = io.open("hash.txt", "w")
>  for name in pairs(tex.hashtokens()) do
>      f:write(name .. ";;;;")
>  end
>  f:close()}
> \end{document}
> 
> I can't open it with ease with a text editor: it complains it has a
> corrupt UTF-8 enconding. I am using ";;;;" since I don't know how to
> add a new line safely here: sorry for this inconvenience.

ulrike's code simpler and didn't exhibit that problem.

> Moreover, I can find symbols that are common, for example begin,
> textit, equation, but they're all without a backslash. How can I
> distinguish between \ commands and known symbols? For example, begin
> is a command, \begin, and it may accept the environment flushleft, but
> not \flushleft.

\begin{flushleft} uses \flushleft

it's not clear to me what you mean by "known symbols".  afaics, this
table doesn't deal with active characters, if that's what you're after.

(note, ulrike's is the first lua code i've run; i tend to spend my tex
time behind the bleading edge, hoping to ride others' shock waves...)



From joseph.wright at morningstar2.co.uk  Tue Jun 12 17:04:26 2012
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 12 Jun 2012 16:04:26 +0100
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD75235.50307@gmail.com>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD75235.50307@gmail.com>
Message-ID: <4FD75A7A.6030500@morningstar2.co.uk>

On 12/06/2012 15:29, Sensei wrote:
> Thanks for the info!
> 
> I am puzzled by the output, though. When I dump the contents to a file,
> with the following:
> 
> \documentclass{article}
> 
> \begin{document}
> \directlua{
>  local f = io.open("hash.txt", "w")
>  for name in pairs(tex.hashtokens()) do
>      f:write(name .. ";;;;")
>  end
>  f:close()}
> \end{document}

I would use

  f:write(name .. "\string\n")

to write one csname per line in your output.

> I can't open it with ease with a text editor: it complains it has a
> corrupt UTF-8 enconding. I am using ";;;;" since I don't know how to add
> a new line safely here: sorry for this inconvenience.

Works fine for me.

> Moreover, I can find symbols that are common, for example begin, textit,
> equation, but they're all without a backslash. How can I distinguish
> between \ commands and known symbols? For example, begin is a command,
> \begin, and it may accept the environment flushleft, but not \flushleft.

The escape character (usually "\") is not part of the name of control
sequences. Depending on the current value of \escapechar you will see
different things here.

What you need to remember that the way LaTeX works for environments is
that when you type

   \begin{foo}

it looks for a macro which could also be used directly as \foo. As you
are seeing the names, and not the control sequences, this means you need
"begin" and "foo".
--
Joseph Wright

From senseiwa at gmail.com  Tue Jun 12 17:54:59 2012
From: senseiwa at gmail.com (Sensei)
Date: Tue, 12 Jun 2012 17:54:59 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD75A7A.6030500@morningstar2.co.uk>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD75235.50307@gmail.com>
 <4FD75A7A.6030500@morningstar2.co.uk>
Message-ID: <4FD76653.4060203@gmail.com>

On 6/12/12 5:04pm, Joseph Wright wrote:

> I would use
>
>    f:write(name .. "\string\n")
>
> to write one csname per line in your output.
>
>> I can't open it with ease with a text editor: it complains it has a
>> corrupt UTF-8 enconding. I am using ";;;;" since I don't know how to add
>> a new line safely here: sorry for this inconvenience.
>
> Works fine for me.

With your modification, works for me too. Thanks!

> The escape character (usually "\") is not part of the name of control
> sequences. Depending on the current value of \escapechar you will see
> different things here.
>
> What you need to remember that the way LaTeX works for environments is
> that when you type
>
>     \begin{foo}
>
> it looks for a macro which could also be used directly as \foo. As you
> are seeing the names, and not the control sequences, this means you need
> "begin" and "foo".

You were perfectly clear! Thanks for the pointers, they're invaluable! :)









From reinhard.kotucha at web.de  Tue Jun 12 22:45:00 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Tue, 12 Jun 2012 22:45:00 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD75235.50307@gmail.com>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD75235.50307@gmail.com>
Message-ID: <20439.43596.474815.581454@zaphod.ms25.net>

On 2012-06-12 at 16:29:09 +0200, Sensei wrote:

 > On 6/12/12 11:48am, Ulrike Fischer wrote:
 > > The thread starts here
 > > http://tug.org/mailman/htdig/luatex/2011-July/003115.html
 > >
 > > And Hans answer is here
 > > http://tug.org/mailman/htdig/luatex/2011-July/003125.html
 > >
 > >
 > > If I process the following document with
 > >
 > > "lualatex test>  output.txt"
 > >
 > > I get a list of about 3500 commands in output.txt
 > >
 > > \documentclass{article}
 > >
 > > \begin{document}
 > > \directlua{
 > >   for name in pairs(tex.hashtokens()) do
 > >       print(name)
 > >   end}
 > > \end{document}
 > >
 > > Addings fontspec leds to 14.000 commands.
 > 
 > 
 > Thanks for the info!
 > 
 > I am puzzled by the output, though. When I dump the contents to a file, 
 > with the following:
 > 
 > \documentclass{article}
 > 
 > \begin{document}
 > \directlua{
 >   local f = io.open("hash.txt", "w")
 >   for name in pairs(tex.hashtokens()) do
 >       f:write(name .. ";;;;")
 >   end
 >   f:close()}
 > \end{document}
 > 
 > 
 > 
 > I can't open it with ease with a text editor: it complains it has a 
 > corrupt UTF-8 enconding. 

When I run Ulrike's example with plain TeX, I get two lines containing
the byte sequence EF BF BF, which is probably the culprit.

It certainly doesn't come from plain.tex, but maybe from hyphenation
pattern loading.  Or it's used by TeX internally.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From Arno.Trautmann at gmx.de  Wed Jun 13 08:35:24 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 13 Jun 2012 08:35:24 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <1qpsfizhzv6lq.dlg@nililand.de>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de>
Message-ID: <4FD834AC.1030006@gmx.de>

Ulrike Fischer wrote:
> Am Thu, 7 Jun 2012 17:20:48 +0200 schrieb Arno Trautmann:
>>> I'm trying to find *at runtime* all the symbols allowed in a latex
>>> environment. So, given a tex file, I'd like to access
>>> - the complete predefined commands/symbols/definitions;
>>> - the complete list of commands/symbols/definitions defined in packages.
>
>> This may not really help, but maybe give a hint: I think I had asked a
>> similar question some time ago, Tako answered that he wanted to
>> implement something, and Hans answered that he [Tako] already did.
>> Unfortunately I cannot find the corresponding mails, sorry.
>
> The thread starts here
> http://tug.org/mailman/htdig/luatex/2011-July/003115.html
>
> And Hans answer is here
> http://tug.org/mailman/htdig/luatex/2011-July/003125.html

Thanks for finding and posting this again!

> If I process the following document with
>
> "lualatex test > output.txt"
>
> I get a list of about 3500 commands in output.txt
>
> \documentclass{article}
>
> \begin{document}
> \directlua{
>   for name in pairs(tex.hashtokens()) do
>       print(name)
>   end}
> \end{document}
>
> Addings fontspec leds to 14.000 commands.

I tried your example with fontspec and am somewhat puzzled with the 
result. The L3 syntax seems to lead to some strange entries, e.g.:

pdfdecimaldigits
key code > fontspec/Script/Braille
@ifdot
key var > fontspec/Script/osma.req
key var > fontspec/CharacterWidth/Quarter.default

How do these key code and key var expressions make it into the 
hashtokens? I guess it's because of the ~ that is used in L3, but I 
don't the exact reasoning.

Cheers
Arno

From patrick at gundla.ch  Wed Jun 13 09:28:37 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 13 Jun 2012 09:28:37 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD834AC.1030006@gmx.de>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD834AC.1030006@gmx.de>
Message-ID: <D1E6688E-923D-4990-A313-98CDFEC50E82@gundla.ch>



> 
> I tried your example with fontspec and am somewhat puzzled with the result. The L3 syntax seems to lead to some strange entries, e.g.:
> 
> pdfdecimaldigits
> key code > fontspec/Script/Braille
> @ifdot
> key var > fontspec/Script/osma.req
> key var > fontspec/CharacterWidth/Quarter.default
> 
> How do these key code and key var expressions make it into the hashtokens? I guess it's because of the ~ that is used in L3, but I don't the exact reasoning.


I am not sure if I understand the question. With 
\csname ... \endcsname you can create any hash tokens you want even with spaces and other funny things. Everything between those two is expanded so you can create dynamic names (arrays for example).

If you ask for the rationale behind it, then I don't know.

Patrick



From luatex at nililand.de  Wed Jun 13 09:54:51 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 13 Jun 2012 09:54:51 +0200
Subject: [luatex] Getting all symbols
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD834AC.1030006@gmx.de>
Message-ID: <tkch112q8kj$.dlg@nililand.de>

Am Wed, 13 Jun 2012 08:35:24 +0200 schrieb Arno Trautmann:


> I tried your example with fontspec and am somewhat puzzled with the 
> result. The L3 syntax seems to lead to some strange entries, e.g.:
> 
> pdfdecimaldigits
> key code > fontspec/Script/Braille
> @ifdot
> key var > fontspec/Script/osma.req
> key var > fontspec/CharacterWidth/Quarter.default
> 
> How do these key code and key var expressions make it into the 
> hashtokens? I guess it's because of the ~ that is used in L3, but I 
> don't the exact reasoning.

Well the list contains other command names which looks a bit odd
like e.g.   "\T1\'-C"    ;-)


The command names starting with "key var" are created when you
define keys. E.g. this

============================
\documentclass{article}
\usepackage{expl3}
\RequirePackage{l3keys2e}
\begin{document}
\ExplSyntaxOn
\keys_define:nn {keytest}
 {
  famtest / style         .code:n =
   {
     blub
   },
 }
\ExplSyntaxOff

\directlua{
 for name in pairs(tex.hashtokens()) do
     print(name)
 end}
\end{document}
==============================

will led to the command name

    "key var > keytest/famtest/style.req"


The prefix comes from the following definition in l3keys:

\tl_const:Nn \c_keys_vars_root_tl { key~var~>~ }


Using spaces inside commands names (and keys like in beamer and pgf)
are sometimes a bit confusing as it can be unclear when the command
actually ends but on the other side they improve readability. 


-- 
Ulrike Fischer 


From joseph.wright at morningstar2.co.uk  Wed Jun 13 10:06:30 2012
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 13 Jun 2012 09:06:30 +0100
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD834AC.1030006@gmx.de>
References: <4FD0B23F.70302@gmail.com> <4FD0C6D0.3060300@gmx.de>
 <1qpsfizhzv6lq.dlg@nililand.de> <4FD834AC.1030006@gmx.de>
Message-ID: <4FD84A06.8090005@morningstar2.co.uk>

On 13/06/2012 07:35, Arno Trautmann wrote:
> Ulrike Fischer wrote:
>> Am Thu, 7 Jun 2012 17:20:48 +0200 schrieb Arno Trautmann:
>>>> I'm trying to find *at runtime* all the symbols allowed in a latex
>>>> environment. So, given a tex file, I'd like to access
>>>> - the complete predefined commands/symbols/definitions;
>>>> - the complete list of commands/symbols/definitions defined in
>>>> packages.
>>
>>> This may not really help, but maybe give a hint: I think I had asked a
>>> similar question some time ago, Tako answered that he wanted to
>>> implement something, and Hans answered that he [Tako] already did.
>>> Unfortunately I cannot find the corresponding mails, sorry.
>>
>> The thread starts here
>> http://tug.org/mailman/htdig/luatex/2011-July/003115.html
>>
>> And Hans answer is here
>> http://tug.org/mailman/htdig/luatex/2011-July/003125.html
> 
> Thanks for finding and posting this again!
> 
>> If I process the following document with
>>
>> "lualatex test > output.txt"
>>
>> I get a list of about 3500 commands in output.txt
>>
>> \documentclass{article}
>>
>> \begin{document}
>> \directlua{
>>   for name in pairs(tex.hashtokens()) do
>>       print(name)
>>   end}
>> \end{document}
>>
>> Addings fontspec leds to 14.000 commands.
> 
> I tried your example with fontspec and am somewhat puzzled with the
> result. The L3 syntax seems to lead to some strange entries, e.g.:
> 
> pdfdecimaldigits
> key code > fontspec/Script/Braille
> @ifdot
> key var > fontspec/Script/osma.req
> key var > fontspec/CharacterWidth/Quarter.default
> 
> How do these key code and key var expressions make it into the
> hashtokens? I guess it's because of the ~ that is used in L3, but I
> don't the exact reasoning.
> 
> Cheers
> Arno

As Patrick has said, any \csname construct can lead to 'odd' looking
names. For example, the LaTeX kernel uses spaces in names to produce
'robust' commands. So in the hash listing you will find both "cite" and
"cite " :-)

On why the names have spaces in them here, the idea is to make things
more 'human readable' in the log and so forth. It also means that these
names are 'out of the way' in namespacing terms, as they are quite
distinct from 'normal' LaTeX2e and LaTeX3 names. You see similar 'odd'
naming approaches for example with the NFSS (things like
"<5><6><7><8><9><10><10.95><12><14.4><17.28><20.74><24.88>cmcsc10" and
"OT1/cmr/m/n/7"), or with pgf (e.g. "pgfk@/pgfplots/table/header/has
colnames/. at cmd").

The thing to remember here is that these names are not really meant for
direct access: not everything in the hash table is a user command.
-- 
Joseph Wright

From senseiwa at gmail.com  Wed Jun 13 11:36:33 2012
From: senseiwa at gmail.com (Sensei)
Date: Wed, 13 Jun 2012 11:36:33 +0200
Subject: [luatex] Getting all symbols
In-Reply-To: <8256.1339513023@cl.cam.ac.uk>
References: <8256.1339513023@cl.cam.ac.uk>
Message-ID: <4FD85F21.6010208@gmail.com>

On 6/12/12 4:57 PM, Robin Fairbairns wrote:
> ulrike's code simpler and didn't exhibit that problem.

Reinhard reports also this behavior. I don't know why the "bug" (?) is 
there, though.


>> Moreover, I can find symbols that are common, for example begin,
>> textit, equation, but they're all without a backslash. How can I
>> distinguish between \ commands and known symbols? For example, begin
>> is a command, \begin, and it may accept the environment flushleft, but
>> not \flushleft.
>
> \begin{flushleft} uses \flushleft
>
> it's not clear to me what you mean by "known symbols".  afaics, this
> table doesn't deal with active characters, if that's what you're after.
>
> (note, ulrike's is the first lua code i've run; i tend to spend my tex
> time behind the bleading edge, hoping to ride others' shock waves...)

That code essentially satifies me.

One thing that I've noticed though is this: it isn't "hierarchical". If 
I add a package, there seems no distinction on symbols.

You may say that it's the way TeX works, and that could be fine with me. 
But this also means that we are unable to know the origin of symbols 
(which package defines, for instance, \mathbb?).

Is this last step hopeless?


Thanks & Cheers!

From joseph.wright at morningstar2.co.uk  Wed Jun 13 11:55:52 2012
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Wed, 13 Jun 2012 10:55:52 +0100
Subject: [luatex] Getting all symbols
In-Reply-To: <4FD85F21.6010208@gmail.com>
References: <8256.1339513023@cl.cam.ac.uk> <4FD85F21.6010208@gmail.com>
Message-ID: <4FD863A8.6020707@morningstar2.co.uk>

On 13/06/2012 10:36, Sensei wrote:
> One thing that I've noticed though is this: it isn't "hierarchical". If
> I add a package, there seems no distinction on symbols.
> 
> You may say that it's the way TeX works, and that could be fine with me.
> But this also means that we are unable to know the origin of symbols
> (which package defines, for instance, \mathbb?).
> 
> Is this last step hopeless?

TeX has no 'intrinsic' namespacing: it's all done by convention. There
is no link between macro definitions and packages, and indeed it is
possible for packages to (re)define the same macros. So you cannot
simply go from the document level commands (e.g. \mathbb) to the
packages which define them.
-- 
Joseph Wright

From Robin.Fairbairns at cl.cam.ac.uk  Wed Jun 13 11:58:39 2012
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 13 Jun 2012 10:58:39 +0100
Subject: [luatex] Getting all symbols
In-Reply-To: Your message of Wed, 13 Jun 2012 11:36:33 +0200.
 <4FD85F21.6010208@gmail.com>
Message-ID: <3552.1339581519@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> > (note, ulrike's is the first lua code i've run; i tend to spend my tex
> > time behind the bleading edge, hoping to ride others' shock waves...)
> 
> That code essentially satifies me.
> 
> One thing that I've noticed though is this: it isn't
> "hierarchical". If I add a package, there seems no distinction on
> symbols.

that's a property of hash tables.  a new cs will be put in the table at
a place selected by the hashing algorithm, not by the specifics of its
definition.

as far as the hash table (indeed, the tex engine as a whole) is
concerned, a cs is nothing more than a link to its definition.

> You may say that it's the way TeX works, and that could be fine with
> me. But this also means that we are unable to know the origin of
> symbols
> 
> Is this last step hopeless?

yes.

you could take snapshots of the hash table before loading each package,
and then compare them.  (this would require sorting the name list,
presumably.)

> (which package defines, for instance, \mathbb?).

quite a lot.  of tex required packages, the answer is something in the
amslatex distribution, by the look of it, but several packages provide
alternative bb characters.

From zappathustra at free.fr  Fri Jun 15 08:48:26 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 15 Jun 2012 08:48:26 +0200
Subject: [luatex] [lltx] luaotfload maintenance
In-Reply-To: <20120615015027.GA3431@khaled-laptop>
References: <20120615015027.GA3431@khaled-laptop>
Message-ID: <20120615064827.C1745A6264@smtp3-g21.free.fr>

[Khaled's message was sent to the LuaLaTeX devel list; I forward it here
because it may be of interest to everybody.]

Khaled Hosny <khaledhosny at eglug.org> a ?crit:
> 
> After so many not so successful attempts to sync luaotfload with ConTeXt
> font code, I gave up. It is simply to much effort for little (personal)
> gain. I was mainly worried about having two incompatible OpenType
> implementations, but I'd rather not have my fonts working with LuaLaTeX
> at all, than spending all that time an effort.
> 
> Any way, the code was just accumulating bugs and no one is working on
> it, so, unless someone stands up to maintain that code, I'm going to
> declare it unmaintained and essentially an abandonware.
> 
> Regards,
> Khaled

Too bad if it comes to that. But anyway many, many thanks for what you
did, Khaled; it definitely made LuaTeX real for a lot of people.

Hopefully someday someone will come up with a new implementation; it
will be hard to match luaotfload, though!

Best,
Paul


From patrick at gundla.ch  Fri Jun 15 10:25:44 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 15 Jun 2012 10:25:44 +0200
Subject: [luatex] [lltx] luaotfload maintenance
In-Reply-To: <4FDAE81A.50607@morningstar2.co.uk>
References: <20120615015027.GA3431@khaled-laptop>
 <4FDAE81A.50607@morningstar2.co.uk>
Message-ID: <0519CD45-B0EA-4C40-A3F8-30ABA9C8994C@gundla.ch>


(I don't think that the luatexlatex-dev mailinglist is the right one -> luatex users or dev-luatex should be more appropriate)

> Assuming that
> continuing from luaotfload is the 'right' way, is there any public
> listing of known issues with the code?

https://github.com/khaledhosny/luaotfload/issues?direction=desc&page=1&sort=created&state=open

Patrick



From khaledhosny at eglug.org  Fri Jun 15 11:33:25 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Fri, 15 Jun 2012 11:33:25 +0200
Subject: [luatex] [lltx] luaotfload maintenance
In-Reply-To: <0519CD45-B0EA-4C40-A3F8-30ABA9C8994C@gundla.ch>
References: <20120615015027.GA3431@khaled-laptop>
 <4FDAE81A.50607@morningstar2.co.uk>
 <0519CD45-B0EA-4C40-A3F8-30ABA9C8994C@gundla.ch>
Message-ID: <20120615093325.GB6304@khaled-laptop>

On Fri, Jun 15, 2012 at 10:25:44AM +0200, Patrick Gundlach wrote:
> 
> (I don't think that the luatexlatex-dev mailinglist is the right one -> luatex users or dev-luatex should be more appropriate)
> 
> > Assuming that
> > continuing from luaotfload is the 'right' way, is there any public
> > listing of known issues with the code?
> 
> https://github.com/khaledhosny/luaotfload/issues?direction=desc&page=1&sort=created&state=open

More ever, master branch (which was synced with ConTeXt a month or so),
has few more regressions in the pseudo features (tlig, trep, anum, itlc)
and the support for optical bounding feature (opbd) is missing. And
there are some bugs reported in TeX.SE like no hyphenation with
ligatures, but someone have to search for them and report them in the
tracker.

Regards,
 Khaled

From patrick at gundla.ch  Fri Jun 15 13:45:08 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 15 Jun 2012 13:45:08 +0200
Subject: [luatex] node.copy_list() does not copy glue_spec nodes
In-Reply-To: <D805FADD-1E75-48CB-8ADA-0CF71199FD0A@gundla.ch>
References: <D805FADD-1E75-48CB-8ADA-0CF71199FD0A@gundla.ch>
Message-ID: <42528D0B-9EFE-4855-A132-4153CF34055B@gundla.ch>

I'd like to bring this up again. Is this something I should report to the tracker or is this "it's a feature, not a bug"?

Patrick




Am 03.05.2012 um 15:35 schrieb Patrick Gundlach:

> Hello all,
> 
> it seems that node.copy_list() does not copy the glue_spec nodes, right? Any chance for a fix?
> 
> Patrick
> 
> 
> 
> \documentclass{article}
> \usepackage{luacode}
> \begin{document}
> \begin{luacode}
> 
> g1 = node.new("glue")
> g1.spec = node.new("glue_spec")
> g1.spec.stretch_order = 3
> print(g1.spec.stretch_order) -- 3: ok
> 
> g2 = node.copy_list(g1)
> g2.spec.stretch_order = 1
> print(g1.spec.stretch_order) -- 1, expected 3
> 
> -- This is because both are the same:
> print(g1.spec)
> print(g2.spec)
> 
> -- <node    nil <     86 >    nil : glue_spec 0>
> -- <node    nil <     86 >    nil : glue_spec 0>
> 
> \end{luacode}
> \end{document}
> 
> 
> 




From zrbabbler at yahoo.co.jp  Fri Jun 15 19:26:33 2012
From: zrbabbler at yahoo.co.jp (Takayuki YATO)
Date: Sat, 16 Jun 2012 02:26:33 +0900
Subject: [luatex] Assignment to tex.skip shows an unexpected behaviour
Message-ID: <353344.58845.qm@web100908.mail.kks.yahoo.co.jp>

Hello,

I found a strange behavior about tex.skip array.
The LuaTeX manual says that assignment to TeX registers
through tex.count, tex.skip, etc. is local (perhaps unless
\globaldefs > 0).

Thus when I compile the following plain TeX source:

\newskip\skipA
\skipA=50pt
\begingroup
%\skipA=60pt  %(*)
\message{\the\skipA}
\directlua{
  local gsp = node.new(node.id("glue_spec"))
  gsp.width = 100 * 0x10000
  tex.skip.skipA = gsp
}
\message{\the\skipA}
\endgroup
\message{\the\skipA}
\bye

the expected terminal output will be:

50.0pt 100.0pt 50.0pt

But the actual output is:

50.0pt 100.0pt 100.0pt

that is, the assignment through tex.skip turns to be global.

The more strange fact is that uncommenting the line (*)
(thus once doing local assignment in TeX) causes the Lua
assignment local, leading to the output:

60.0pt 100.0pt 50.0pt

And finally I make the nesting one-level deeper:

\newskip\skipA
\skipA=25pt
\begingroup
    \skipA=50pt
    \begingroup
        \directlua{
          local gsp = node.new(node.id("glue_spec"))
          gsp.width = 100 * 0x10000
          tex.skip.skipA = gsp
        }
        \message{\the\skipA}
    \endgroup
    \message{\the\skipA} % here \skipA becomes zero!
\endgroup
\message{\the\skipA}
\bye

the resulting output is totally unreasonable:

100.0pt 0.0pt 25.0pt

I inspected the source code and found that Lua assignments
are handled by the following function:

int set_tex_skip_register(int j, halfword v)
{
    //......
    if (type(v) != glue_spec_node)
        return 1;
    word_define(j + skip_base, v);   //(**)
    return 0;
}

If Lua assignment should be done in the same way as in
TeX, then the line (**) should be:

    define(j + skip_base, glue_ref_cmd, v);

Happy (Lua)TeXing,
  Takayuki YATO


From schultzk at uni-trier.de  Sun Jun 17 11:21:16 2012
From: schultzk at uni-trier.de (Keith J. Schultz)
Date: Sun, 17 Jun 2012 11:21:16 +0200
Subject: [luatex] Accessing pgf nodes from inside Lua(La)Tex
Message-ID: <9978C910-EF39-4396-99FA-859023D9B613@uni-trier.de>

Hi All,

I am writing a package with pgf/TikZ from making Nassi-Schneider diagramms.
I have the code working under XeLaTeX and wanted to refracture it to LuaTeX.
I have to admit that I am not very TeXian. 

My question is if I have the name of a pgf node how do I get at its coordinates from
within LuaTeX.

Or, is there a way to call pgf from directly inside LuaTeX.

What I am looking for is to have a LuaTeX call to get the coordinates.
The following code that I have is: 

	\pgfextracty{\YCoordinate}{\pgfpointanchor{\LastNode}{south}}

	where \LastNode is the Name of the pgf node and \YCoordinate is a dimension.

So my do I access pgf structures from in LuaTeX?

Any help or pointers would be appreciated.


It would help me, also, if someone could tell me how to access something I have defined
with \edef in LuaTeX

eg. 

in the TeX file 
\edef{\aValue}{tttt}

in a loaded .lua file

function get_my_value(NameValue)
	local a = <some in Lua to access the edef>(NameValue)

	return a
end

Thanx in advance

regards
	Keith.

From zappathustra at free.fr  Tue Jun 19 08:45:18 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 19 Jun 2012 08:45:18 +0200
Subject: [luatex] Accessing pgf nodes from inside Lua(La)Tex
In-Reply-To: <9978C910-EF39-4396-99FA-859023D9B613@uni-trier.de>
References: <9978C910-EF39-4396-99FA-859023D9B613@uni-trier.de>
Message-ID: <20120619064519.5F46DA6244@smtp3-g21.free.fr>

"Keith J. Schultz" <schultzk at uni-trier.de> a ?crit:
> 
> Hi All,
> 
> I am writing a package with pgf/TikZ from making Nassi-Schneider diagramms.
> I have the code working under XeLaTeX and wanted to refracture it to LuaTeX.
> I have to admit that I am not very TeXian. 
> 
> My question is if I have the name of a pgf node how do I get at its coordinates from
> within LuaTeX.
> 
> Or, is there a way to call pgf from directly inside LuaTeX.
> 
> What I am looking for is to have a LuaTeX call to get the coordinates.
> The following code that I have is: 
> 
> 	\pgfextracty{\YCoordinate}{\pgfpointanchor{\LastNode}{south}}
> 
> 	where \LastNode is the Name of the pgf node and \YCoordinate is a dimension.
> 
> So my do I access pgf structures from in LuaTeX?
> 
> Any help or pointers would be appreciated.

I don't think PGF has any Lua interface, but I might be wrong here.

> 
> It would help me, also, if someone could tell me how to access something I have defined
> with \edef in LuaTeX
> 
> eg. 
> 
> in the TeX file 
> \edef{\aValue}{tttt}
> 
> in a loaded .lua file
> 
> function get_my_value(NameValue)
> 	local a = <some in Lua to access the edef>(NameValue)
> 
> 	return a
> end

You can't do that, really. You may devise a complex system of
\directlua/tex.print calls, but I have some doubts it'll work.

Instead, you can use token lists:

    \edef\aValue{tttt}
    \mytok\expandafter{\aValue}

and in Lua:

    function get_my_value (name)
      local a = tex.toks.mytok
      return a
    end

Otherwise, if you really need a TeX macro (not a token list), you can
try:

    \directlua{ mymacros = {} }
    \def\gobble#1{}
    \def\Def#1#2{%
      \edef#1{#2}%
      \directlua{%
        mymacros["\expandafter\gobble\string#1"] =
          "\luaescapestring{#2}" }%
      }

then
  
    \Def\aValue{tttt}

defines \aValue as before and makes its replacement text available in
Lua as "mymacros.aValue". Admittedly suboptimal...

Best,
Paul


From schultzk at gmx.net  Tue Jun 19 12:49:37 2012
From: schultzk at gmx.net (Keith J. Schultz)
Date: Tue, 19 Jun 2012 12:49:37 +0200
Subject: [luatex] Accessing pgf nodes from inside Lua(La)Tex
In-Reply-To: <20120619064519.5F46DA6244@smtp3-g21.free.fr>
References: <9978C910-EF39-4396-99FA-859023D9B613@uni-trier.de>
 <20120619064519.5F46DA6244@smtp3-g21.free.fr>
Message-ID: <F758A999-A7C1-4896-897C-64ECE5A4BA37@gmx.net>

HI Paul,

You have helped understand a few things and not in the documentation.

Actually, I do not want to use TeX macros.
I am looking for a way to access the structures of the nodes defined
through pgf. 

I was hoping to find a way to access them from lua.

so instead of:  
	\pgfextracty{\YCoordinate}{\pgfpointanchor{\LastNode}{south}}

in lua something like:
	local Y = getx(get_anchor(<pgfNodeName>, "south")

What you have shown me I might be able to go into the sources of pgf and
find a way to extract the data I want. But, I do not have the time to go that route.

regards
	Keith.

Am 19.06.2012 um 08:45 schrieb Paul Isambert:

> "Keith J. Schultz" <schultzk at uni-trier.de> a ?crit:
>> 
>> Hi All,
>> 
>> I am writing a package with pgf/TikZ from making Nassi-Schneider diagramms.
>> I have the code working under XeLaTeX and wanted to refracture it to LuaTeX.
>> I have to admit that I am not very TeXian. 
>> 
>> My question is if I have the name of a pgf node how do I get at its coordinates from
>> within LuaTeX.
>> 
>> Or, is there a way to call pgf from directly inside LuaTeX.
>> 
>> What I am looking for is to have a LuaTeX call to get the coordinates.
>> The following code that I have is: 
>> 
>> 	\pgfextracty{\YCoordinate}{\pgfpointanchor{\LastNode}{south}}
>> 
>> 	where \LastNode is the Name of the pgf node and \YCoordinate is a dimension.
>> 
>> So my do I access pgf structures from in LuaTeX?
>> 
>> Any help or pointers would be appreciated.
> 
> I don't think PGF has any Lua interface, but I might be wrong here.
> 
>> 
>> It would help me, also, if someone could tell me how to access something I have defined
>> with \edef in LuaTeX
>> 
>> eg. 
>> 
>> in the TeX file 
>> \edef{\aValue}{tttt}
>> 
>> in a loaded .lua file
>> 
>> function get_my_value(NameValue)
>> 	local a = <some in Lua to access the edef>(NameValue)
>> 
>> 	return a
>> end
> 
> You can't do that, really. You may devise a complex system of
> \directlua/tex.print calls, but I have some doubts it'll work.
> 
> Instead, you can use token lists:
> 
>    \edef\aValue{tttt}
>    \mytok\expandafter{\aValue}
> 
> and in Lua:
> 
>    function get_my_value (name)
>      local a = tex.toks.mytok
>      return a
>    end
> 
> Otherwise, if you really need a TeX macro (not a token list), you can
> try:
> 
>    \directlua{ mymacros = {} }
>    \def\gobble#1{}
>    \def\Def#1#2{%
>      \edef#1{#2}%
>      \directlua{%
>        mymacros["\expandafter\gobble\string#1"] =
>          "\luaescapestring{#2}" }%
>      }
> 
> then
> 
>    \Def\aValue{tttt}
> 
> defines \aValue as before and makes its replacement text available in
> Lua as "mymacros.aValue". Admittedly suboptimal...
> 
> Best,
> Paul
> 



From zappathustra at free.fr  Sun Jun 24 09:29:42 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 24 Jun 2012 09:29:42 +0200
Subject: [luatex] Math \fontdimen's.
Message-ID: <20120624072944.0AAE8A6229@smtp3-g21.free.fr>

Hello all,

I'm playing around with math, in which I'm mostly incompetent. However I
notice that modifying the \fontdimen parameters has no effect. Try this
in PDFTeX and LuaTeX:

    \fontdimen14\tensy=1em
    $2^2$
    \bye

In PDFTeX, the superscript is raised, but not in LuaTeX. I know the
same effect can be achieved with the \Umath... parameters (here
\Umathsupshiftup), but my question is: is it normal that \fontdimen
parameters aren't obeyed anymore? (I suppose it is; somebody would have
already complained otherwise; nonetheless I find it strange, because it
means those dimensions do not depend on the fonts anymore.)

Best,
Paul


From vafakhlg at googlemail.com  Sun Jun 24 15:43:19 2012
From: vafakhlg at googlemail.com (Vafa Khalighi)
Date: Sun, 24 Jun 2012 23:43:19 +1000
Subject: [luatex] luaotfload maintenance
Message-ID: <372FB8C9-4F51-4B00-9DB2-5E533F4C54E6@googlemail.com>

Hi

I am working on my own font loader but at the moment it is too unstable to be real eased on CTAN. 

By the way, I can maintain luaotfload code if and only if no one else will be willing to do that.

From Arno.Trautmann at gmx.de  Sun Jun 24 16:06:38 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 24 Jun 2012 16:06:38 +0200
Subject: [luatex] luaotfload maintenance
In-Reply-To: <372FB8C9-4F51-4B00-9DB2-5E533F4C54E6@googlemail.com>
References: <372FB8C9-4F51-4B00-9DB2-5E533F4C54E6@googlemail.com>
Message-ID: <4FE71EEE.6040607@gmx.de>

Hi,

Vafa Khalighi wrote:
> I am working on my own font loader but at the moment it is too unstable to be real eased on CTAN.

Glad to hear this ? how about offering it on TLContrib? That would make 
testing and hepling easier, if you want help ;)

> By the way, I can maintain luaotfload code if and only if no one else will be willing to do that.

Good news, too :)

cheers
Arno

From patrick at gundla.ch  Sun Jun 24 17:42:37 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 24 Jun 2012 17:42:37 +0200
Subject: [luatex] luaotfload maintenance
In-Reply-To: <372FB8C9-4F51-4B00-9DB2-5E533F4C54E6@googlemail.com>
References: <372FB8C9-4F51-4B00-9DB2-5E533F4C54E6@googlemail.com>
Message-ID: <7180C060-61C4-4383-9BD1-1D8034F7CE66@gundla.ch>


> By the way, I can maintain luaotfload code if and only if no one else will be willing to do that.


+1!

Go ahead, please. There is no one willing to do that.

First wish from me: include support for type1 fonts :)


Patrick




From Arno.Trautmann at gmx.de  Sun Jun 24 22:35:50 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 24 Jun 2012 22:35:50 +0200
Subject: [luatex] =?utf-8?q?Libertine_+math_shift_+_=C3=A4_=3D_error=3F?=
In-Reply-To: <4FD3828B.80204@gmx.de>
References: <4FD3828B.80204@gmx.de>
Message-ID: <4FE77A26.3000608@gmx.de>

Hi,

can anybody at least reproduce this error? Or was my question unclear 
and therefore no answers??  :(

cheers
Arno

Arno Trautmann wrote:
> Hi all,
>
> I'm getting a strange error when I try to compile the following code:
>
> \documentclass{scrartcl}
> \usepackage{fontspec}
> \setmainfont{Linux Libertine O}
> \begin{document}
> $8,56 eV$, wa?hrend
> \end{document}
>
> The error I get states:
>
> error: ...1/texmf-dist/tex/luatex/luaotfload/otfl-node-inj.lua:197:
> attempt to index local 'tm' (a nil value)
> .
> \newpage ...k \@nobreakfalse \everypar {}\fi \par
>                                                    \vfil \penalty -\@M
> l.6 \end{document}
>
> ?
>
> Please note that the ?a? glyph is not a single character, but is a
> composite umlaut plus an a. (You get this, e.g. by copying from the Mac
> preview software instead of the ? that originally was used.) A normal ?
> in the source code does work without problems.
>
> However, this seems to happen only with the Linux Libertine font. But
> the really mind blowing thing here is: The error only appears when a
> math shift is used in the paragraph where the ? appears ? both before
> and after the ?. This makes things hard to track ?
>
> So, any ideas what the problem here could be?
>
> cheers
> Arno
>



From khaledhosny at eglug.org  Sun Jun 24 23:02:12 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 24 Jun 2012 23:02:12 +0200
Subject: [luatex]
 =?utf-8?q?Libertine_+math_shift_+_=C3=A4__=3D_error=3F?=
In-Reply-To: <4FE77A26.3000608@gmx.de>
References: <4FD3828B.80204@gmx.de>
 <4FE77A26.3000608@gmx.de>
Message-ID: <20120624210212.GA6619@khaled-laptop>

Apparently it is a luatfload bug, which is looking for a new maintainer.
You would better report this to luatofload tracker and hope the new
maintainer would look into it.

Regards,
 Khaled

On Sun, Jun 24, 2012 at 10:35:50PM +0200, Arno Trautmann wrote:
> Hi,
> 
> can anybody at least reproduce this error? Or was my question
> unclear and therefore no answers??  :(
> 
> cheers
> Arno
> 
> Arno Trautmann wrote:
> >Hi all,
> >
> >I'm getting a strange error when I try to compile the following code:
> >
> >\documentclass{scrartcl}
> >\usepackage{fontspec}
> >\setmainfont{Linux Libertine O}
> >\begin{document}
> >$8,56 eV$, wa?hrend
> >\end{document}
> >
> >The error I get states:
> >
> >error: ...1/texmf-dist/tex/luatex/luaotfload/otfl-node-inj.lua:197:
> >attempt to index local 'tm' (a nil value)
> >.
> >\newpage ...k \@nobreakfalse \everypar {}\fi \par
> >                                                   \vfil \penalty -\@M
> >l.6 \end{document}
> >
> >?
> >
> >Please note that the ?a? glyph is not a single character, but is a
> >composite umlaut plus an a. (You get this, e.g. by copying from the Mac
> >preview software instead of the ? that originally was used.) A normal ?
> >in the source code does work without problems.
> >
> >However, this seems to happen only with the Linux Libertine font. But
> >the really mind blowing thing here is: The error only appears when a
> >math shift is used in the paragraph where the ? appears ? both before
> >and after the ?. This makes things hard to track ?
> >
> >So, any ideas what the problem here could be?
> >
> >cheers
> >Arno
> >
> 

From Arno.Trautmann at gmx.de  Sun Jun 24 23:05:51 2012
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 24 Jun 2012 23:05:51 +0200
Subject: [luatex]
	=?utf-8?q?Libertine_+math_shift_+_=C3=A4__=3D_error=3F?=
In-Reply-To: <20120624210212.GA6619@khaled-laptop>
References: <4FD3828B.80204@gmx.de> <4FE77A26.3000608@gmx.de>
 <20120624210212.GA6619@khaled-laptop>
Message-ID: <4FE7812F.9020905@gmx.de>

Khaled Hosny wrote:
> Apparently it is a luatfload bug, which is looking for a new maintainer.
> You would better report this to luatofload tracker and hope the new
> maintainer would look into it.

Ok, thanks, I was not sure whom to ?blame?, since it only happens with 
this font etc.

cheers
Arno

> On Sun, Jun 24, 2012 at 10:35:50PM +0200, Arno Trautmann wrote:
>> Hi,
>>
>> can anybody at least reproduce this error? Or was my question
>> unclear and therefore no answers??  :(
>>
>> cheers
>> Arno
>>
>> Arno Trautmann wrote:
>>> Hi all,
>>>
>>> I'm getting a strange error when I try to compile the following code:
>>>
>>> \documentclass{scrartcl}
>>> \usepackage{fontspec}
>>> \setmainfont{Linux Libertine O}
>>> \begin{document}
>>> $8,56 eV$, wa?hrend
>>> \end{document}
>>>
>>> The error I get states:
>>>
>>> error: ...1/texmf-dist/tex/luatex/luaotfload/otfl-node-inj.lua:197:
>>> attempt to index local 'tm' (a nil value)
>>> .
>>> \newpage ...k \@nobreakfalse \everypar {}\fi \par
>>>                                                    \vfil \penalty -\@M
>>> l.6 \end{document}
>>>
>>> ?
>>>
>>> Please note that the ?a? glyph is not a single character, but is a
>>> composite umlaut plus an a. (You get this, e.g. by copying from the Mac
>>> preview software instead of the ? that originally was used.) A normal ?
>>> in the source code does work without problems.
>>>
>>> However, this seems to happen only with the Linux Libertine font. But
>>> the really mind blowing thing here is: The error only appears when a
>>> math shift is used in the paragraph where the ? appears ? both before
>>> and after the ?. This makes things hard to track ?
>>>
>>> So, any ideas what the problem here could be?
>>>
>>> cheers
>>> Arno
>>>
>>
>



From luatex at nililand.de  Mon Jun 25 10:19:54 2012
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 25 Jun 2012 10:19:54 +0200
Subject: [luatex] =?utf-8?q?Libertine_+math_shift_+_=C3=A4_=3D_error=3F?=
References: <4FD3828B.80204@gmx.de> <4FE77A26.3000608@gmx.de>
Message-ID: <16pwqozvlbck9$.dlg@nililand.de>

Am Sun, 24 Jun 2012 22:35:50 +0200 schrieb Arno Trautmann:

>> I'm getting a strange error when I try to compile the following code:
>>
>> \documentclass{scrartcl}
>> \usepackage{fontspec}
>> \setmainfont{Linux Libertine O}
>> \begin{document}
>> $8,56 eV$, wa?hrend
>> \end{document}
>>
>> The error I get states:
>>
>> error: ...1/texmf-dist/tex/luatex/luaotfload/otfl-node-inj.lua:197:
>> attempt to index local 'tm' (a nil value)
>> .
>> \newpage ...k \@nobreakfalse \everypar {}\fi \par
>>                                                    \vfil \penalty -\@M
>> l.6 \end{document}
>>
>> ?
>>
>> Please note that the ?a? glyph is not a single character, but is a
>> composite umlaut plus an a. (You get this, e.g. by copying from the Mac
>> preview software instead of the ? that originally was used.) A normal ?
>> in the source code does work without problems.
>>
>> However, this seems to happen only with the Linux Libertine font. But
>> the really mind blowing thing here is: The error only appears when a
>> math shift is used in the paragraph where the ? appears ? both before
>> and after the ?. This makes things hard to track ?

> can anybody at least reproduce this error? Or was my question unclear 
> and therefore no answers??  :(


Well I can reproduce the problem.  Also using math alone doesn't
trigger the error: It doesn't happen if the math contain only $\int$
or if you use unicode-math. Looks as if the math must actually use
the font somehow.

I compared the file otfl-node-inj a bit with the relevant context
file. For me it looks as if some checks have been added so I have
doubts that the problem exists also in context. Saddenly it looks as
if the context code has been changed a lot since the last sync with
luaotfload so if the problem has been resolved in context it will be
not easy to move the solution to luaotfload. 


-- 
Ulrike Fischer 


