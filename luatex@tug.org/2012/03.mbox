From rameyer at uni-math.gwdg.de  Thu Mar  1 15:54:50 2012
From: rameyer at uni-math.gwdg.de (Ralf Meyer)
Date: Thu, 1 Mar 2012 15:54:50 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
Message-ID: <4F4F8DBA.3080109@uni-math.gwdg.de>

When I was trying out how to format the date in LuaTeX as advertised
using os.setlocale and os.date, I still got the english date.  Actually,
this is a Lua problem because when I run lua, I get the same result:

Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
> os.setlocale("de_DE")
> print(os.date("Heute ist der \%A im Monat \%B."))
Heute ist der Thursday im Monat March.
> os.setlocale("de_DE","time")
> print(os.date("Heute ist der \%A im Monat \%B."))
Heute ist der Thursday im Monat March.

What could be the reason for os.setlocale to have no effect?

Yours,
Ralf Meyer

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 6462 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://tug.org/pipermail/luatex/attachments/20120301/5779ffc2/attachment.bin>

From luigi.scarso at gmail.com  Thu Mar  1 16:07:22 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Thu, 1 Mar 2012 16:07:22 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F4F8DBA.3080109@uni-math.gwdg.de>
References: <4F4F8DBA.3080109@uni-math.gwdg.de>
Message-ID: <CAG5iGsDRJ-UMzY8B407ySuMsEidPq6HhrpbrYujJj7rJsEMpjA@mail.gmail.com>

On Thu, Mar 1, 2012 at 3:54 PM, Ralf Meyer <rameyer at uni-math.gwdg.de> wrote:

> When I was trying out how to format the date in LuaTeX as advertised
> using os.setlocale and os.date, I still got the english date.  Actually,
> this is a Lua problem because when I run lua, I get the same result:
>
> Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
> > os.setlocale("de_DE")
> > print(os.date("Heute ist der \%A im Monat \%B."))
>
Heute ist der Thursday im Monat March.
> > os.setlocale("de_DE","time")
> > print(os.date("Heute ist der \%A im Monat \%B."))
> Heute ist der Thursday im Monat March.
>
> res=os.setlocale("de_DE")
print(res)
Is res nil ?

(under linux)
What is your
$> locale -a
?
Mine said that it_IT.UTF-8 is a lvalide locale, so

$> lua
Lua 5.1.2  Copyright (C) 1994-2007 Lua.org, PUC-Rio
> res=os.setlocale('it_IT.UTF-8');print(res)
it_IT.UTF-8
>  print(os.date("Heute ist der \%A im Monat \%B."))
Heute ist der gioved? im Monat marzo.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20120301/e3439f73/attachment.html>

From martin at oneiros.de  Thu Mar  1 17:09:35 2012
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Thu, 1 Mar 2012 17:09:35 +0100
Subject: [luatex] CaLi2CoPi
Message-ID: <CAP7DCDdGAShRD8dYNMxocgA8KmrDOXQ8PiveYW7huw3R-Zr5uA@mail.gmail.com>

FYI: On the ghostscript-devel list I came accross this announcement.
Don't be frightened by the language: Google can translate catalan. :-)

Best
   Martin
---------- Forwarded message ----------
From: Marc Antoni Malagarriga i Picas <marcantoni at femfum.com>
Date: 2012/3/1
Subject: Re: [gs-devel] Separating PDF layers with ghostscript
To: gs-devel at ghostscript.com



Hi Simone,


Al 01/03/12 8:06, En/na simonecesano at libero.it ha escrit:

> I need to separate layers in PDF files (created in adobe illustrator) into
> different files - pdf or raster - via the command line.


You can try our open source CaLi2CoPi library (PostScript code),
online via Ghostscript, to separate in PDF layers different graphic
elements (vectors, XObjects, inLine images, text, shading patterns and
FormXObjects), upload a PDF file e voil?...
http://www.l?l.cat/femfum/CaLi2CoPi_10/
...this is one of several specialized flags that performs jobs inside
PDF files. Here you have the project in SF...
http://femfumcali2copi.sourceforge.net/

Ciao,


--
Marc Antoni Malagarriga-Picas
(34) 938721642 | (34) 667517069
(?][ www.femfum.com
PostScript&PDF Tool Developers
Desenvolupadors d'Eines PostScript i PDF


From Herbert.Voss at FU-Berlin.DE  Thu Mar  1 18:06:53 2012
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Thu, 1 Mar 2012 18:06:53 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F4F8DBA.3080109@uni-math.gwdg.de>
References: <4F4F8DBA.3080109@uni-math.gwdg.de>
Message-ID: <4F4FACAD.3080107@FU-Berlin.DE>

Am 01.03.2012 15:54, schrieb Ralf Meyer:
> When I was trying out how to format the date in LuaTeX as advertised
> using os.setlocale and os.date, I still got the english date.  Actually,
> this is a Lua problem because when I run lua, I get the same result:
>
> Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio

voss at shania:~/texte/dtk/dtk12-1> lua
Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
 > print(os.date())
Thu Mar  1 18:04:12 2012
 > os.setlocale("de_DE.UTF-8","time")
 > print(os.date())
Do 01 M?r 2012 18:04:33 CET

SuSE Linux 12.1

However, I also do not understand, why Lua doesn't
take the current setting, which is already de_DE.UTF-8
into account.

Herbert


>> os.setlocale("de_DE")
>> print(os.date("Heute ist der \%A im Monat \%B."))
> Heute ist der Thursday im Monat March.
>> os.setlocale("de_DE","time")
>> print(os.date("Heute ist der \%A im Monat \%B."))
> Heute ist der Thursday im Monat March.
>
> What could be the reason for os.setlocale to have no effect?
>
> Yours,
> Ralf Meyer
>


From p.stephani2 at googlemail.com  Thu Mar  1 22:23:39 2012
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 1 Mar 2012 22:23:39 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F4FACAD.3080107@FU-Berlin.DE>
References: <4F4F8DBA.3080109@uni-math.gwdg.de> <4F4FACAD.3080107@FU-Berlin.DE>
Message-ID: <CAArVCkQXjMetdJhercZhEF3Ak9_39PR+YXgur0jomb3aP2F9GQ@mail.gmail.com>

Am 1. M?rz 2012 18:06 schrieb Herbert Voss <Herbert.Voss at fu-berlin.de>:
> However, I also do not understand, why Lua doesn't
> take the current setting, which is already de_DE.UTF-8
> into account.

That is intentional, see the last paragraph of section 3.2 of the manual.


From p.stephani2 at googlemail.com  Thu Mar  1 22:28:30 2012
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Thu, 1 Mar 2012 22:28:30 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F4F8DBA.3080109@uni-math.gwdg.de>
References: <4F4F8DBA.3080109@uni-math.gwdg.de>
Message-ID: <CAArVCkR4M7zX-+yQFoJLp9fEqBsf82-bQB0_9j36Yzkgz3m9iw@mail.gmail.com>

2012/3/1 Ralf Meyer <rameyer at uni-math.gwdg.de>:
> When I was trying out how to format the date in LuaTeX as advertised
> using os.setlocale and os.date, I still got the english date. ?Actually,
> this is a Lua problem because when I run lua, I get the same result:
>
> Lua 5.1.4 ?Copyright (C) 1994-2008 Lua.org, PUC-Rio
>> os.setlocale("de_DE")
>> print(os.date("Heute ist der \%A im Monat \%B."))
> Heute ist der Thursday im Monat March.
>> os.setlocale("de_DE","time")
>> print(os.date("Heute ist der \%A im Monat \%B."))
> Heute ist der Thursday im Monat March.

On OS X 10.6:

$ lua
Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
> os.setlocale("de_DE")
> print(os.date("Heute ist der \%A im Monat \%B."))
Heute ist der Donnerstag im Monat M?rz.
> os.setlocale("de_DE","time")
> print(os.date("Heute ist der \%A im Monat \%B."))
Heute ist der Donnerstag im Monat M?rz.

>
> What could be the reason for os.setlocale to have no effect?

Windows uses different names (e.g, "German"), but your mail headers
tell me you're running Linux, so that should work.  My best guess is
that the localization package is not installed.


From Herbert.Voss at FU-Berlin.DE  Thu Mar  1 22:31:58 2012
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Thu, 1 Mar 2012 22:31:58 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <CAArVCkQXjMetdJhercZhEF3Ak9_39PR+YXgur0jomb3aP2F9GQ@mail.gmail.com>
References: <4F4F8DBA.3080109@uni-math.gwdg.de> <4F4FACAD.3080107@FU-Berlin.DE>
 <CAArVCkQXjMetdJhercZhEF3Ak9_39PR+YXgur0jomb3aP2F9GQ@mail.gmail.com>
Message-ID: <4F4FEACE.8030304@FU-Berlin.DE>

Am 01.03.2012 22:23, schrieb Philipp Stephani:
> Am 1. M?rz 2012 18:06 schrieb Herbert Voss<Herbert.Voss at fu-berlin.de>:
>> However, I also do not understand, why Lua doesn't
>> take the current setting, which is already de_DE.UTF-8
>> into account.
>
> That is intentional, see the last paragraph of section 3.2 of the manual.

that refers to LuaTeX but I meant Lua

Herbert

From reinhard.kotucha at web.de  Fri Mar  2 02:20:22 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 2 Mar 2012 02:20:22 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <CAArVCkR4M7zX-+yQFoJLp9fEqBsf82-bQB0_9j36Yzkgz3m9iw@mail.gmail.com>
References: <4F4F8DBA.3080109@uni-math.gwdg.de>
 <CAArVCkR4M7zX-+yQFoJLp9fEqBsf82-bQB0_9j36Yzkgz3m9iw@mail.gmail.com>
Message-ID: <20304.8278.91747.77313@zaphod.ms25.net>

On 2012-03-01 at 22:28:30 +0100, Philipp Stephani wrote:

 > > What could be the reason for os.setlocale to have no effect?
 > 
 > Windows uses different names (e.g, "German"), but your mail headers
 > tell me you're running Linux, so that should work.  My best guess
 > is that the localization package is not installed.

Maybe a bit unrelated: I'm executing an external program from texlua
and want to tell it to emit its output in UTF-8.

On Linux I set the locale with os.setenv() before running
os.execute().  This works fine because on Linux it's sufficient to set
an environment variable.  I don't know how to achieve this on
Windows.  It's probably not sufficient to set an environment
variable.  Does os.setlocale() has an effect on external programs or
does it affect Lua functions only?  I could't try because I don't hnow
which argument is expected on Windows.

What I'm doing now is to check with os.type whether the program is run
under Windows and if so, I use the tiny functions recently published
by Paul Isambert in TUGboat in order to convert strings from
ISO-8859-1 to UTF-8.  The only non-ASCII characters I currently have
to deal with are ? and ?, hence this workaround is sufficient.

It would be nicer though if I could ask the external program to emit
UTF-8 on Windows too.  Any idea how to accomplish it?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------


From kip at thevertigo.com  Fri Mar  2 07:46:57 2012
From: kip at thevertigo.com (Kip Warner)
Date: Thu, 1 Mar 2012 22:46:57 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CALBOmsYWbP1dRGEJB2NQAF0tWuRGdPO8U+uyKkuk0YgTbtQ22A@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <1328849980.23524.75.camel@kip-laptop>
 <CAG5iGsCbYstGATSB_L8NAt0dWioCfSM-RygBrPjYVhwFa2GBjw@mail.gmail.com>
 <1328912516.23524.84.camel@kip-laptop>
 <CAG5iGsC=p96tY9BKA7eRVCvkw4GqC1hU2w8sG2wxXZG4iqyeYA@mail.gmail.com>
 <1329169425.2984.3.camel@kip-laptop>
 <CAG5iGsB3SqDR2UnfUzARbYg9aTVpg31gbXWYGAtJSKun5dcWKA@mail.gmail.com>
 <4F3A1E42.6050802@elvenkind.com>
 <CALBOmsbr2TAYMf2bkA57bf3MshXPQcLWRJJ7zLVskazbnu7zKg@mail.gmail.com>
 <1329334320.3643.0.camel@kip-laptop>
 <CAG5iGsBj-z16vtYYLSbpXwCj_w=6ac7pXvEdNJT+SbUiQ2dKGQ@mail.gmail.com>
 <1329430372.2886.37.camel@kip-laptop>
 <CAG5iGsBx1687aOKLytcJd9QMJGvj1qAWUxnT6HP7gAn+a6EmiQ@mail.gmail.com>
 <1329506639.2886.53.camel@kip-laptop>
 <CAG5iGsBzXU7SzMQCx-Te+XVwsoP7-Q0Pg-R+_UTA5B=NS+cZgg@mail.gmail.com>
 <CALBOmsZDtMH=HjpWFJKCN+3huWwaAE4RhQGCwRX+uh04LwV=0Q@mail.gmail.com>
 <1329793185.2886.100.camel@kip-laptop>
 <CALBOmsYWbP1dRGEJB2NQAF0tWuRGdPO8U+uyKkuk0YgTbtQ22A@mail.gmail.com>
Message-ID: <1330670817.3025.57.camel@kip-laptop>

On Mon, 2012-02-20 at 21:40 -0600, Mojca Miklavec wrote:
> 
> I could try of course, but I would at least need to know how to
> reproduce the error. Compiling simple documents worked for me when I
> last tried. 

Do you want me to prepare the test case on your shell account?

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120301/8bbee191/attachment.bin>

From rameyer at uni-math.gwdg.de  Fri Mar  2 09:12:47 2012
From: rameyer at uni-math.gwdg.de (Ralf Meyer)
Date: Fri, 2 Mar 2012 09:12:47 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
Message-ID: <4F5080FF.90804@uni-math.gwdg.de>

Dear Luigi,

it was as you expected: on my system,
os.setlocale("de_DE.utf8")
has the required effect, thanks.

It is remarkable that the names of locales are so system dependent.
Even more disturbing, the shell command "locale -a" showed me that my
computer only knows about several German and English locales.

Hence a french luatex document a colleague sends me will not work on my
computer because it lacks the necessary locales, and probably my
documents will not work on his computer for the same reason.  This is
really bad news!  One of the great things about TeX is portability.

Should one refrain from using the os library, or at least its
localisation aspects, and warn users to avoid it for this reason?
Should one reimplement the localisation libraries that os.setlocale is
calling in luatex itself, so that users can rely on a common framework
all over the world?

Yours,

Ralf

-- 
Prof. Dr. Ralf Meyer		Bunsenstr. 3-5, 37073 G?ttingen
Mathematisches Institut		Tel: +49 551 397774
Universit?t G?ttingen		FAX: +49 551 3922985

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 6462 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://tug.org/pipermail/luatex/attachments/20120302/ca6531bf/attachment-0001.bin>

From luigi.scarso at gmail.com  Fri Mar  2 10:07:11 2012
From: luigi.scarso at gmail.com (luigi scarso)
Date: Fri, 2 Mar 2012 10:07:11 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F5080FF.90804@uni-math.gwdg.de>
References: <4F5080FF.90804@uni-math.gwdg.de>
Message-ID: <CAG5iGsD9ToU=0MS-r8bvYtL9DGF-jLuJk1ZymgrGoyweM5xyyg@mail.gmail.com>

On Fri, Mar 2, 2012 at 9:12 AM, Ralf Meyer <rameyer at uni-math.gwdg.de> wrote:

> Dear Luigi,
>
> it was as you expected: on my system,
> os.setlocale("de_DE.utf8")
> has the required effect, thanks.
>
> It is remarkable that the names of locales are so system dependent.
> Even more disturbing, the shell command "locale -a" showed me that my
> computer only knows about several German and English locales.
>
> Hence a french luatex document a colleague sends me will not work on my
> computer because it lacks the necessary locales, and probably my
> documents will not work on his computer for the same reason.  This is
> really bad news!  One of the great things about TeX is portability.
>
> Should one refrain from using the os library, or at least its
> localisation aspects, and warn users to avoid it for this reason?
> Should one reimplement the localisation libraries that os.setlocale is
> calling in luatex itself, so that users can rely on a common framework
> all over the world?
>
Every os.* is, of course, os dependant. I have a linux box that has 19
locales, another one that has 731..Of course
Windows and MacOS have their locale setup too.

It's a matter of robust programming then: for simple things for example
maybe this is ok
if os.setlocale("<your string>") == nil then
 if os.setlocale("<another try 1>") == nil then
  if os.setlocale("<another try 2>") == nil then
   ..
 end
 end
end
but locale is a huge .. and you reinvent the wheel.
A common framework is icu : just jump to
http://site.icu-project.org/home
and see how much complex localization+encoding can be.


About portability: even with tex (I mean the Knuth tex, not etex or pdftex
or luatex) the same source can
give very different results if you use only a slightly different version of
the same metafont font (given that we use the same frozen  tex version, of
course). So the same result is a matter of the same boundary conditions.
Things doen't change much with luatex, we have more  boundary conditions
than before --- but with lua we  have much more power than before and hence
we need more control.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20120302/84858e05/attachment.html>

From gesang at stud.uni-heidelberg.de  Fri Mar  2 09:53:52 2012
From: gesang at stud.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 2 Mar 2012 09:53:52 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F5080FF.90804@uni-math.gwdg.de>
References: <4F5080FF.90804@uni-math.gwdg.de>
Message-ID: <20120302085351.GA5029@phlegethon>

On 2012-03-02 09:12, Ralf Meyer wrote:

> Should one refrain from using the os library, or at least its
> localisation aspects, and warn users to avoid it for this reason?

Instead of an answer, here a snippet from the ConTeXt sources
(luat-env.lua):

????????????????????????????????????????????????????????????????????????
-- precautions

os.setlocale(nil,nil) -- useless feature and even dangerous in luatex

function os.setlocale()
    -- no way you can mess with it
end
????????????????????????????????????????????????????????????????????????

Regards
Philipp



-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120302/428f1bcc/attachment.bin>

From patrick at gundla.ch  Fri Mar  2 14:40:47 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 2 Mar 2012 14:40:47 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F5080FF.90804@uni-math.gwdg.de>
References: <4F5080FF.90804@uni-math.gwdg.de>
Message-ID: <806E0158-D09A-49D0-B315-2C791ACC34D7@gundla.ch>


> 
> Hence a french luatex document a colleague sends me will not work on my
> computer because it lacks the necessary locales, and probably my
> documents will not work on his computer for the same reason.  This is
> really bad news!  One of the great things about TeX is portability.

If you want portability, don't mess with system (locale, time, ...) dependent settings. French documents work with German installations, of course. 

Patrick



From p.stephani2 at googlemail.com  Fri Mar  2 22:15:21 2012
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Fri, 2 Mar 2012 22:15:21 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F4FEACE.8030304@FU-Berlin.DE>
References: <4F4F8DBA.3080109@uni-math.gwdg.de> <4F4FACAD.3080107@FU-Berlin.DE>
 <CAArVCkQXjMetdJhercZhEF3Ak9_39PR+YXgur0jomb3aP2F9GQ@mail.gmail.com>
 <4F4FEACE.8030304@FU-Berlin.DE>
Message-ID: <CAArVCkSJHj3UF150tjvtG9CQ+WawkdHAvtj5s2GA7zUzXBOEvA@mail.gmail.com>

Am 1. M?rz 2012 22:31 schrieb Herbert Voss <Herbert.Voss at fu-berlin.de>:
> Am 01.03.2012 22:23, schrieb Philipp Stephani:
>
>> Am 1. M?rz 2012 18:06 schrieb Herbert Voss<Herbert.Voss at fu-berlin.de>:
>>>
>>> However, I also do not understand, why Lua doesn't
>>> take the current setting, which is already de_DE.UTF-8
>>> into account.
>>
>>
>> That is intentional, see the last paragraph of section 3.2 of the manual.
>
>
> that refers to LuaTeX but I meant Lua

I see.  The reason here is inherited from the C behavior: The global
locale before the first call to setlocale() is always the "classic"
locale.  On Linux, you have to call os.setlocale("") to take the
locale settings from the environment.


From p.stephani2 at googlemail.com  Fri Mar  2 22:17:53 2012
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Fri, 2 Mar 2012 22:17:53 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <20304.8278.91747.77313@zaphod.ms25.net>
References: <4F4F8DBA.3080109@uni-math.gwdg.de>
 <CAArVCkR4M7zX-+yQFoJLp9fEqBsf82-bQB0_9j36Yzkgz3m9iw@mail.gmail.com>
 <20304.8278.91747.77313@zaphod.ms25.net>
Message-ID: <CAArVCkT8Cmt1b+CRDTkzFChuAAGMUkZ70EH5hPRqZjKi7XhtJA@mail.gmail.com>

2012/3/2 Reinhard Kotucha <reinhard.kotucha at web.de>:
> It would be nicer though if I could ask the external program to emit
> UTF-8 on Windows too. ?Any idea how to accomplish it?

This has to be supported by the external program.  The locale system
on Windows is totally different; more specifically, you cannot usually
set some encoding by changing the locale.


From p.stephani2 at googlemail.com  Fri Mar  2 22:31:22 2012
From: p.stephani2 at googlemail.com (Philipp Stephani)
Date: Fri, 2 Mar 2012 22:31:22 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <4F5080FF.90804@uni-math.gwdg.de>
References: <4F5080FF.90804@uni-math.gwdg.de>
Message-ID: <CAArVCkQkVfWSgC1uJ7CXMz1Sy+acD419assyLCZ9PiGcFpys9w@mail.gmail.com>

2012/3/2 Ralf Meyer <rameyer at uni-math.gwdg.de>:
> It is remarkable that the names of locales are so system dependent.

Well, they are not standardized (there is the POSIX standard, but that
is of course not universal).

> Even more disturbing, the shell command "locale -a" showed me that my
> computer only knows about several German and English locales.

Yes, localizations have to be manually installed on most operating systems.

> Hence a french luatex document a colleague sends me will not work on my
> computer because it lacks the necessary locales, and probably my
> documents will not work on his computer for the same reason.

Depending on what you mean by "does not work."  No part of LuaTeX
depend on the OS locale unless you explicitly write code to take the
OS locale into account.

>
> Should one refrain from using the os library, or at least its
> localisation aspects, and warn users to avoid it for this reason?

The C89 locale functionality is neither platform-independent nor
sufficient.  For serious Unicode or localization work, you usually
want a powerful library like ICU or one of its wrappers, e.g.,
Boost.Locale.

From Herbert.Voss at FU-Berlin.DE  Sat Mar  3 08:23:22 2012
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Sat, 3 Mar 2012 08:23:22 +0100
Subject: [luatex] Localisation of Lua or LuaTeX
In-Reply-To: <CAArVCkSJHj3UF150tjvtG9CQ+WawkdHAvtj5s2GA7zUzXBOEvA@mail.gmail.com>
References: <4F4F8DBA.3080109@uni-math.gwdg.de> <4F4FACAD.3080107@FU-Berlin.DE>
 <CAArVCkQXjMetdJhercZhEF3Ak9_39PR+YXgur0jomb3aP2F9GQ@mail.gmail.com>
 <4F4FEACE.8030304@FU-Berlin.DE>
 <CAArVCkSJHj3UF150tjvtG9CQ+WawkdHAvtj5s2GA7zUzXBOEvA@mail.gmail.com>
Message-ID: <4F51C6EA.2090206@FU-Berlin.DE>

Am 02.03.2012 22:15, schrieb Philipp Stephani:
> Am 1. M?rz 2012 22:31 schrieb Herbert Voss<Herbert.Voss at fu-berlin.de>:
>> Am 01.03.2012 22:23, schrieb Philipp Stephani:
>>
>>> Am 1. M?rz 2012 18:06 schrieb Herbert Voss<Herbert.Voss at fu-berlin.de>:
>>>>
>>>> However, I also do not understand, why Lua doesn't
>>>> take the current setting, which is already de_DE.UTF-8
>>>> into account.
>>>
>>>
>>> That is intentional, see the last paragraph of section 3.2 of the manual.
>>
>>
>> that refers to LuaTeX but I meant Lua
>
> I see.  The reason here is inherited from the C behavior: The global
> locale before the first call to setlocale() is always the "classic"
> locale.  On Linux, you have to call os.setlocale("") to take the
> locale settings from the environment.

Ah ok, I missed that

thanks
Herbert

From zappathustra at free.fr  Sat Mar  3 12:21:42 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Sat, 3 Mar 2012 12:21:42 +0100
Subject: [luatex] Fatal error when removing nodelist's tail.
Message-ID: <1330773702.4f51fec6349f6@imp.free.fr>

Hello all,

The following code produces a fatal error:

callback.register("ligaturing",
  function (head)
    node.remove(head, node.tail(last))
  end)

The error is:
! This can't happen (linebreak_tail).
!  ==> Fatal error occurred, no output PDF file produced!

The same happens in the "kerning" callback. It also happens even if you add
another node after the tail (and then remove the latter). I know the manual says
something about the tail of the list being recalculated, but I wouldn't expect
that removing the tail would cause an error. As far as I can tell, the error
happens at paragraph-building time (i.e. in "linebreak_filter").

Am I doing something wrong, or contemplating a bug?

Best,
Paul

From crhan123 at gmail.com  Sun Mar  4 16:23:39 2012
From: crhan123 at gmail.com (=?UTF-8?B?6ZmI6Iul5ra1?=)
Date: Sun, 4 Mar 2012 23:23:39 +0800
Subject: [luatex] meet Error 2 when usemodule{bib}
Message-ID: <CAG4GxSU=QSGH8e_bqxmQS-e3KD_H=KpUtYZWNuMoz=AtxTWTcA@mail.gmail.com>

Hi all,

After I'm using sample.bib provided by ConTeXt and write \cite[hh2010a], I
got an `error 2' instead of the reference's num in the PDF file. And got
nothing in the \completepublications list, until I use
\completepublications[criterium=all]. But this cause some bibs I haven't
used in the article appear in the refrences list.

Is that something wrong by me or the ConTeXt?

I'm using TexLive 2011 distuibution. ConTeXt version:

> mtx-context     | main context file:
> /usr/local/texlive/2011/texmf-dist/tex/context/base/context.mkiv
> mtx-context     | current version: 2011.05.18 18:04


Here is my test.tex file

> \setupbibtex[database=sample]
> \starttext
> \chapter{haha}
> \cite[hh2010b]
> \cite[hh2010a]
> \completepublications
> \stoptext


Here is part of the sample.bib

> @STRING{hh = {Hans Hagen}}
> @ARTICLE{hh2010a,
>   author = hh,
>   title = {The Font Name Mess},  journal = {MAPS},
>   year = {2010},  volume = {40},
>   pages = {2-8},
>   keywords = {context},
> }
> @ARTICLE{hh2010b,
>   author = hh,
>   title = {Grouping in Hybrid Environments},
>   journal = {MAPS},
>   year = {2010},
>   volume = {40},
>   pages = {67-71},
>   keywords = {context},
> }

-----------
?????,?????.??????????,????????!
@ruohanc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20120304/c5269ff1/attachment.html>

From taco at elvenkind.com  Mon Mar  5 09:20:11 2012
From: taco at elvenkind.com (Taco Hoekwater)
Date: Mon, 5 Mar 2012 09:20:11 +0100
Subject: [luatex] Fatal error when removing nodelist's tail.
In-Reply-To: <1330773702.4f51fec6349f6@imp.free.fr>
References: <1330773702.4f51fec6349f6@imp.free.fr>
Message-ID: <4F54773B.9020201@elvenkind.com>

On 03/03/2012 12:21 PM, Paul Isambert wrote:
> Hello all,
>
> The following code produces a fatal error:
>
> callback.register("ligaturing",
>    function (head)
>      node.remove(head, node.tail(last))
>    end)
>
> The error is:
> ! This can't happen (linebreak_tail).
> !  ==>  Fatal error occurred, no output PDF file produced!
>
> The same happens in the "kerning" callback. It also happens even if you add
> another node after the tail (and then remove the latter). I know the manual says
> something about the tail of the list being recalculated, but I wouldn't expect
> that removing the tail would cause an error. As far as I can tell, the error
> happens at paragraph-building time (i.e. in "linebreak_filter").
>
> Am I doing something wrong, or contemplating a bug?

I think this is a documentation bug. If your callback does not actually
return anything, luatex assumes that the list is unaltered so does not
do any recalculations (in the interest of speed).

Best wishes,
Taco


From dirk.laurie at gmail.com  Wed Mar  7 18:38:01 2012
From: dirk.laurie at gmail.com (Dirk Laurie)
Date: Wed, 7 Mar 2012 19:38:01 +0200
Subject: [luatex] SVG
Message-ID: <CABcj=tmC2764bd+-aSFtfu4m7iuO14wtToPReba5kdy08-COMw@mail.gmail.com>

How do I include SVG graphics?

From khaledhosny at eglug.org  Wed Mar  7 19:04:47 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 7 Mar 2012 20:04:47 +0200
Subject: [luatex] SVG
In-Reply-To: <CABcj=tmC2764bd+-aSFtfu4m7iuO14wtToPReba5kdy08-COMw@mail.gmail.com>
References: <CABcj=tmC2764bd+-aSFtfu4m7iuO14wtToPReba5kdy08-COMw@mail.gmail.com>
Message-ID: <20120307180447.GA9830@khaled-laptop>

On Wed, Mar 07, 2012 at 07:38:01PM +0200, Dirk Laurie wrote:
> How do I include SVG graphics?

Convert it to PDF first, LuaTeX does not support SVG graphics (nor PDF
IIRC, so the conversion have to be done any way).

Regards,
 Khaled

From mojca.miklavec.lists at gmail.com  Sun Mar 11 02:51:46 2012
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Sun, 11 Mar 2012 02:51:46 +0100
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <1324869174.13205.18.camel@kip-laptop>
References: <1324869174.13205.18.camel@kip-laptop>
Message-ID: <CALBOmsYbhhHS6eDFWp6w5nM85h=QRtzFH0e+Q=AZ3BM-vuPerg@mail.gmail.com>

On Mon, Dec 26, 2011 at 04:12, Kip Warner wrote:
> Hey folks,
>
> I am witnessing a segfault in luatex when it attempts to compile my book
> on mips64el hardware. Compiling a trivial hello world, however, is fine.
> I don't think it is an endian issue since this hardware is little endian
> which.

Here's a minimal example that generates the problem:

\definetextbackground[CodeExampleFrame]
    [location=paragraph]
\definetyping
    [CodeExample]
    [before=\startCodeExampleFrame,
     after=\stopCodeExampleFrame]
\starttext
\startCodeExample
hello
\stopCodeExample
\stoptext

Compiled with ConTeXt MKIV 2011.11.23 18:58 and LuaTeX
beta-0.71.0-2011122518 (rev 4358), but even though ConTeXt is old,
LuaTeX should not segfault. I get more or less the same backtrace - it
breaks during hyphenation (replacing "hello" with dots won't generate
a problem). The example compiles fine on my Mac, but I didn't try that
exact version of ConTeXt yet.

Mojca
-------------- next part --------------
Program received signal SIGSEGV, Segmentation fault.
hnj_hyphenation (head=<value optimized out>, tail=<value optimized out>) at ../../../source/texk/web2c/luatexdir/lang/texlang.w:904
904	            if (lang->exceptions != 0 &&
(gdb) bt full
#0  hnj_hyphenation (head=<value optimized out>, tail=<value optimized out>) at ../../../source/texk/web2c/luatexdir/lang/texlang.w:904
        clang = -1
        end_word = 805
        lhmin = 2
        rhmin = 3
        hyf_font = 44
        lchar = <value optimized out>
        i = <value optimized out>
        lang = 0x3
        langdata = {pre_hyphen_char = -1, post_hyphen_char = -1, pre_exhyphen_char = 0, post_exhyphen_char = 16}
        utf8word = "someveryveryveryveryery", '\000' <repeats 1001 times>
        wordlen = 23
        hy = 0x7fff28bb ""
        replacement = 0x2c <Address 0x2c out of bounds>
        explicit_hyphen = 0
        s = <value optimized out>
        r = 464
        save_tail = 0
        left = <value optimized out>
        right = <value optimized out>
        __PRETTY_FUNCTION__ = "hnj_hyphenation"
#1  0x004d2af0 in do_lang_hyphenate (L=0xc34118) at ../../../source/texk/web2c/luatexdir/lua/llanglib.c:217
        h = 0xfb48f0
        tt = 10265812
#2  0x00685ee8 in luaD_precall (L=0xc34118, func=<value optimized out>, nresults=1) at ../../../source/texk/web2c/luatexdir/lua51/ldo.c:319
        ci = <value optimized out>
        n = <value optimized out>
        funcr = <value optimized out>
#3  0x0069a24c in luaV_execute (L=0xc34118, nexeccalls=3) at ../../../source/texk/web2c/luatexdir/lua51/lvm.c:587
        nresults = 1
        i = <value optimized out>
        ra = 0x3
        base = 0x3
        k = 0x0
        pc = 0xfc51b4
#4  0x006864bc in luaD_call (L=0xc34118, func=0x221b310, nResults=<value optimized out>) at ../../../source/texk/web2c/luatexdir/lua51/ldo.c:377
No locals.
#5  0x00685888 in luaD_rawrunprotected (L=0xc34118, f=0x67c7a0 <f_call>, ud=0x7fff33e0) at ../../../source/texk/web2c/luatexdir/lua51/ldo.c:116
        lj = {previous = 0x0, b = {{__jmpbuf = {{__pc = 0x685868, __sp = 0x7fff3260, __regs = {12796184, 0, 1, 0, 19928352, 19928352, 9306676, 9950748}, __fp = 0x97d754, __gp = 0x2aeed960, 
                  __fpc_csr = 4, __fpregs = {-nan(0xfffffffffffff), -nan(0xfffffffffffff), -nan(0xfffffffffffff), -nan(0xfffffffffffff), -nan(0xfffffffffffff), -nan(0xfffffffffffff)}}}, 
              __mask_was_saved = 0, __saved_mask = {__val = {28, 720296288, 6864, 720296288, 720296288, 12796184, 12796304, 28, 12796184, 0, 240, 13269400, 4552380, 9951060, 6841532, 
                  4294967295, 4294967295, 9969568, 9950748, 0, 28, 2, 6855844, 9953480, 0, 0, 5571244, 9969568, 24, 9950760, 9951176, 9969568}}}}, status = 0}
#6  0x006858ec in luaD_pcall (L=0x9ca4d4, func=0x7fff0203, u=0x7fff0203, old_top=<value optimized out>, ef=0) at ../../../source/texk/web2c/luatexdir/lua51/ldo.c:457
        status = <value optimized out>
        oldnCcalls = 0
        old_allowhooks = 1 '\001'
---Type <return> to continue, or q <return> to quit---
        old_errfunc = 0
#7  0x0067c534 in lua_pcall (L=0xc34118, nargs=<value optimized out>, nresults=1, errfunc=<value optimized out>) at ../../../source/texk/web2c/luatexdir/lua51/lapi.c:816
        c = {func = 0x221b310, nresults = 1}
        status = 10265808
        func = 10265808
#8  0x005354e0 in lua_node_filter (filterid=<value optimized out>, xextrainfo=2147418627, head_node=30, tail_node=0xca7998) at ../../../source/texk/web2c/luatexdir/lua/luanode.w:105
        ret = <value optimized out>
        a = <value optimized out>
        L = 0xc34118
        s_top = 23
        extrainfo = 0x8e0234 ""
        callback_id = <value optimized out>
#9  0x005582e8 in line_break (d=0, line_break_context=0) at ../../../source/texk/web2c/luatexdir/tex/linebreak.w:134
        paragraph_dir = <value optimized out>
        final_par_glue = 1174
        start_of_par = 12788316
        callback_id = <value optimized out>
        __PRETTY_FUNCTION__ = "line_break"
#10 0x0047dd78 in end_graf (line_break_context=<value optimized out>) at ../../../source/texk/web2c/luatexdir/tex/maincontrol.w:1523
No locals.
#11 0x0047e078 in run_par_end_hmode () at ../../../source/texk/web2c/luatexdir/tex/maincontrol.w:504
No locals.
#12 0x00483bd0 in main_control () at ../../../source/texk/web2c/luatexdir/tex/maincontrol.w:905
No locals.
#13 0x004782e4 in main_body () at ../../../source/texk/web2c/luatexdir/tex/mainbody.w:469
        pdftex_map = "pdftex.map"
#14 0x0044a788 in main (ac=<value optimized out>, av=<value optimized out>) at ../../../source/texk/web2c/luatexdir/luatex.c:460
No locals.

From kip at thevertigo.com  Sun Mar 11 03:04:27 2012
From: kip at thevertigo.com (Kip Warner)
Date: Sat, 10 Mar 2012 18:04:27 -0800
Subject: [luatex] luatex segfault on mips64el hardware
In-Reply-To: <CALBOmsYbhhHS6eDFWp6w5nM85h=QRtzFH0e+Q=AZ3BM-vuPerg@mail.gmail.com>
References: <1324869174.13205.18.camel@kip-laptop>
 <CALBOmsYbhhHS6eDFWp6w5nM85h=QRtzFH0e+Q=AZ3BM-vuPerg@mail.gmail.com>
Message-ID: <1331431467.2833.34.camel@kip-laptop>

On Sun, 2012-03-11 at 03:51 +0100, Mojca Miklavec wrote:
> Here's a minimal example that generates the problem:

Wow. Congrats Mojca. I think that just isolating the minimal might have
been more laborious than possibly the patch to come with a book that
size.

I added your notes to the issue tracker:
http://tracker.luatex.org/view.php?id=739

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120310/008d9642/attachment.bin>

From bernhard.tempel at freenet.de  Sun Mar 11 16:27:29 2012
From: bernhard.tempel at freenet.de (Bernhard Tempel)
Date: Sun, 11 Mar 2012 16:27:29 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
Message-ID: <4F5CC461.2050103@freenet.de>

Hello,

as Source2e states, the LaTeX font change commands with argument like 
\emph{foo} "automatically take care of any necessary italic correction
on either side of the argument" ([1] The LaTeX2e sources [2011/06/27], p. 
190). Using pdfTeX this works with some fonts like Latin Modern or MinionPro. 
Unfortunately with luaTeX italic correction in normal text seems not to work 
at all. Take a look at the minimal working example following.

I noticed some earlier discussion about italic correction with lua(La)TeX and 
math mode, but this doesn't apply here. As I'm only LaTeX user it's difficult 
for me to analyze this more in depth. There are fonts where even pdfTeX has no 
italic correction as the font metrics don't include the necessary values, e.g. 
Linux Libertine. My hope was changing to luaTeX, using otf fonts, would solve 
this - which is not the case as I had to realize.

Any ideas?

Yours,

Bernhard


\documentclass{minimal}

\usepackage{luaotfload}
\usepackage{fontspec}
\setmainfont{Latin Modern Roman}

\listfiles

\begin{document}
\emph{f}!
\end{document}

*File List*
  minimal.cls    2001/05/25 Standard LaTeX minimal class
luaotfload.sty    2011/04/21 v1.25 OpenType layout system
luatexbase.sty    2010/10/06 v0.3 Module utilities for LuaTeX
ifluatex.sty    2010/03/01 v1.3 Provides the ifluatex switch (HO)
luatexbase-compat.sty    2010/10/10 v0.3 Compatibility tools for LuaTeX
luatexbase-loader.sty    2010/10/10 v0.3 Lua module loader for LuaTeX
luatexbase-regs.sty    2010/10/10 v0.3 Registers allocation for LuaTeX
     etex.sty    1998/03/26 v2.0 eTeX basic definition package (PEB)
luatexbase-attr.sty    2011/05/21 v0.31 Attributes allocation for LuaTeX
luatexbase-cctb.sty    2010/10/10 v0.3 Catcodetable allocation for LuaTeX
luatexbase-mcb.sty    2010/10/10 v0.3 Callback management for LuaTeX
luatexbase-modutils.sty    2010/10/10 v0.3 Module utilities for LuaTeX
fontspec.sty    2011/09/18 v2.2a Advanced font selection for XeLaTeX/LuaLaTeX
    expl3.sty    2012/02/26 v3471 L3 Experimental code bundle wrapper
  l3names.sty    2011/12/30 v3113 L3 Experimental namespace for primitives
l3bootstrap.sty    2011/12/29 v3110 L3 Experimental bootstrap code
   luatex.sty    2010/03/09 v0.4 LuaTeX basic definition package (HO)
infwarerr.sty    2010/04/08 v1.3 Providing info/warning/message (HO)
luatex-loader.sty    2010/03/09 v0.4 Lua module loader (HO)
pdftexcmds.sty    2011/04/22 v0.16 Utilities of pdfTeX for LuaTeX (HO)
  ltxcmds.sty    2011/04/18 v1.20 LaTeX kernel commands for general use (HO)
    ifpdf.sty    2011/01/30 v2.3 Provides the ifpdf switch (HO)
    color.sty    2005/11/14 v1.0j Standard LaTeX Color (DPC)
    color.cfg    2007/01/18 v1.5 color configuration of teTeX/TeXLive
   pdftex.def    2011/05/27 v0.06d Graphics/color for pdfTeX
graphics.sty    2009/02/05 v1.0o Standard LaTeX Graphics (DPC,SPQR)
     trig.sty    1999/03/16 v1.09 sin cos tan (DPC)
graphics.cfg    2010/04/23 v1.9 graphics configuration of TeX Live
l3basics.sty    2012/02/26 v3460 L3 Experimental basic definitions
  l3expan.sty    2012/02/26 v3460 L3 Experimental argument expansion
     l3tl.sty    2012/02/26 v3460 L3 Experimental token lists
    l3seq.sty    2012/01/09 v3158 L3 Experimental sequences and stacks
    l3int.sty    2012/02/26 v3460 L3 Experimental integers
  l3quark.sty    2012/02/12 v3384 L3 Experimental quarks
    l3prg.sty    2012/02/26 v3464 L3 Experimental control structures
  l3clist.sty    2012/02/26 v3460 L3 Experimental comma separated lists
  l3token.sty    2012/02/26 v3460 L3 Experimental token manipulation
   l3prop.sty    2012/02/26 v3460 L3 Experimental property lists
    l3msg.sty    2012/02/26 v3470 L3 Experimental messages
   l3file.sty    2012/02/26 v3464 L3 Experimental file and I/O operations
   l3skip.sty    2012/02/26 v3460 L3 Experimental dimensions and skips
   l3keys.sty    2011/12/22 v3086 L3 Experimental key-value interfaces
     l3fp.sty    2012/02/06 v3315 L3 Experimental floating-point operations
    l3box.sty    2012/02/18 v3432 L3 Experimental boxes
l3coffins.sty    2012/02/26 v3460 L3 Experimental coffin code layer
  l3color.sty    2011/09/07 v2776 L3 Experimental colour support
l3luatex.sty    2012/02/09 v3355 L3 Experimental LuaTeX-specific functions
   xparse.sty    2012/02/26 v3471 L3 Experimental document command parser
fontspec-patches.sty    2011/09/18 v2.2a Advanced font selection for XeLaTeX/Lu
aLaTeX
fixltx2e.sty    2006/09/13 v1.1m fixes to LaTeX
fontspec-luatex.sty    2011/09/18 v2.2a Advanced font selection for XeLaTeX/Lua
LaTeX
  fontenc.sty
   eu2enc.def    2010/05/27 v0.1h Experimental Unicode font encodings
   eu2lmr.fd    2009/10/30 v1.6 Font defs for Latin Modern
xunicode.sty    2011/09/09 v0.981 provides access to latin accents and many oth
er characters in Unicode lower plane
  eu2lmss.fd    2009/10/30 v1.6 Font defs for Latin Modern
graphicx.sty    1999/02/16 v1.0f Enhanced LaTeX Graphics (DPC,SPQR)
   keyval.sty    1999/03/16 v1.13 key=value parser (DPC)
fontspec.cfg
    t3cmr.fd    2001/12/31 TIPA font definitions
supp-pdf.mkii
epstopdf-base.sty    2010/02/09 v2.5 Base part for package epstopdf
   grfext.sty    2010/08/19 v1.1 Managing graphics extensions (HO)
kvdefinekeys.sty    2011/04/07 v1.3 Defining keys (HO)
kvoptions.sty    2010/12/23 v3.10 Keyval support for LaTeX options (HO)
kvsetkeys.sty    2011/04/07 v1.13 Key value parser (HO)
etexcmds.sty    2011/02/16 v1.5 Prefix for e-TeX command names (HO)
epstopdf-sys.cfg    2010/07/13 v1.3 Configuration of (r)epstopdf for TeX Live

-- 
http://www.tempelb.de


From khaledhosny at eglug.org  Sun Mar 11 18:48:46 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Sun, 11 Mar 2012 19:48:46 +0200
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <4F5CC461.2050103@freenet.de>
References: <4F5CC461.2050103@freenet.de>
Message-ID: <20120311174846.GB27324@khaled-laptop>

On Sun, Mar 11, 2012 at 04:27:29PM +0100, Bernhard Tempel wrote:
> Hello,
> 
> as Source2e states, the LaTeX font change commands with argument
> like \emph{foo} "automatically take care of any necessary italic
> correction
> on either side of the argument" ([1] The LaTeX2e sources
> [2011/06/27], p. 190). Using pdfTeX this works with some fonts like
> Latin Modern or MinionPro. Unfortunately with luaTeX italic
> correction in normal text seems not to work at all. Take a look at
> the minimal working example following.

The concept of italic correction does not exist in OpenType fonts (it is
a character propriety in TFM files, with no correspondence in OpenType),
so it will only work with TFM fonts.

"luaotfload" has an `itlc` option that would try to guess an italic
correction for glyphs when loading the fonts. I've no idea how reliable
is it.

Try \setmainfont[RawFeature={+itlc}]{Latin Modern Roman}, it seems to
make a noticeable improvement.

If you are using ConTeXt, Hans has some experimental features for
automatic italic correction, see
http://www.pragma-ade.com/preliminaries/hybrid-italics.pdf.

Regards,
 Khaled

From bernhard.tempel at freenet.de  Sun Mar 11 20:54:32 2012
From: bernhard.tempel at freenet.de (Bernhard Tempel)
Date: Sun, 11 Mar 2012 20:54:32 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <20120311174846.GB27324@khaled-laptop>
References: <4F5CC461.2050103@freenet.de>
 <20120311174846.GB27324@khaled-laptop>
Message-ID: <4F5D02F8.3010002@freenet.de>

Am 11.03.2012 18:48, schrieb Khaled Hosny:
>  The concept of italic correction does not exist in OpenType fonts (it
>  is a character propriety in TFM files, with no correspondence in
>  OpenType), so it will only work with TFM fonts.

And only with those TFM fonts which have information on italic correction 
values for each glyph, so Source2e statement on automatic italic correction 
seems too general...

>  "luaotfload" has an `itlc` option that would try to guess an italic
>  correction for glyphs when loading the fonts. I've no idea how
>  reliable is it.
>
>  Try \setmainfont[RawFeature={+itlc}]{Latin Modern Roman}, it seems
>  to make a noticeable improvement.

Thanks a lot for this. It really makes an improvement. In some cases the 
guessed glue is to big, but better results would be very difficult to reach 
when using heuristics. To calculate the extreme "\emph{f}!" combination works 
fine; with the less extreme combination "\emph{f}:" the kerning could be more 
tight, but I can see that the guessed value must be the the same as for 
"\emph{f}!".

>  If you are using ConTeXt, Hans has some experimental features for
>  automatic italic correction, see
>  http://www.pragma-ade.com/preliminaries/hybrid-italics.pdf.

Seems interesting, but as I am usually writing texts using biblatex, I can't 
use ConTeXt.

Best regards,

Bernhard

-- 
http://www.tempelb.de


From reinhard.kotucha at web.de  Sun Mar 11 21:47:06 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sun, 11 Mar 2012 21:47:06 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <4F5D02F8.3010002@freenet.de>
References: <4F5CC461.2050103@freenet.de>
 <20120311174846.GB27324@khaled-laptop>
 <4F5D02F8.3010002@freenet.de>
Message-ID: <20317.3914.571842.321422@zaphod.ms25.net>

On 2012-03-11 at 20:54:32 +0100, Bernhard Tempel wrote:

 > Am 11.03.2012 18:48, schrieb Khaled Hosny:
 > >  The concept of italic correction does not exist in OpenType fonts (it
 > >  is a character propriety in TFM files, with no correspondence in
 > >  OpenType), so it will only work with TFM fonts.
 > 
 > And only with those TFM fonts which have information on italic correction 
 > values for each glyph, so Source2e statement on automatic italic correction 
 > seems too general...
 > 
 > >  "luaotfload" has an `itlc` option that would try to guess an
 > >  italic correction for glyphs when loading the fonts. I've no
 > >  idea how reliable is it.
 > >
 > >  Try \setmainfont[RawFeature={+itlc}]{Latin Modern Roman}, it
 > >  seems to make a noticeable improvement.
 > 
 > Thanks a lot for this. It really makes an improvement. In some
 > cases the guessed glue is to big, but better results would be very
 > difficult to reach when using heuristics. To calculate the extreme
 > "\emph{f}!" combination works fine; with the less extreme
 > combination "\emph{f}:" the kerning could be more tight, but I can
 > see that the guessed value must be the the same as for "\emph{f}!".

But if you try

  \parindent0pt
  \emph{f}! \par 
  \emph{f}: \par 
  \emph{f}; \par 
  \emph{f}. \par  

you'll see that the period is treated differently.  Is this a result
of the heuristics or does it come from somewhere else?

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From heiko.oberdiek at googlemail.com  Mon Mar 12 01:19:12 2012
From: heiko.oberdiek at googlemail.com (Heiko Oberdiek)
Date: Mon, 12 Mar 2012 01:19:12 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <20317.3914.571842.321422@zaphod.ms25.net>
References: <4F5CC461.2050103@freenet.de>
 <20120311174846.GB27324@khaled-laptop>
 <4F5D02F8.3010002@freenet.de>
 <20317.3914.571842.321422@zaphod.ms25.net>
Message-ID: <20120312001912.GA30081@oberdiek.my-fqdn.de>

On Sun, Mar 11, 2012 at 09:47:06PM +0100, Reinhard Kotucha wrote:

> On 2012-03-11 at 20:54:32 +0100, Bernhard Tempel wrote:
> 
>  > Am 11.03.2012 18:48, schrieb Khaled Hosny:

>  > >  Try \setmainfont[RawFeature={+itlc}]{Latin Modern Roman}, it
>  > >  seems to make a noticeable improvement.
>  > 
>  > Thanks a lot for this. It really makes an improvement. In some
>  > cases the guessed glue is to big, but better results would be very
>  > difficult to reach when using heuristics. To calculate the extreme
>  > "\emph{f}!" combination works fine; with the less extreme
>  > combination "\emph{f}:" the kerning could be more tight, but I can
>  > see that the guessed value must be the the same as for "\emph{f}!".
> 
> But if you try
> 
>   \parindent0pt
>   \emph{f}! \par 
>   \emph{f}: \par 
>   \emph{f}; \par 
>   \emph{f}. \par  
> 
> you'll see that the period is treated differently.  Is this a result
> of the heuristics or does it come from somewhere else?

>From LaTeX. It manages a list \nocorrlist with the entries `,'
and `.' as default. \emph suppresses the italic correction
before a character in \nocorrlist.

Yours sincerely
  Heiko Oberdiek

From reinhard.kotucha at web.de  Mon Mar 12 01:54:59 2012
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 12 Mar 2012 01:54:59 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <20120312001912.GA30081@oberdiek.my-fqdn.de>
References: <4F5CC461.2050103@freenet.de>
 <20120311174846.GB27324@khaled-laptop>
 <4F5D02F8.3010002@freenet.de>
 <20317.3914.571842.321422@zaphod.ms25.net>
 <20120312001912.GA30081@oberdiek.my-fqdn.de>
Message-ID: <20317.18787.264701.502455@zaphod.ms25.net>

On 2012-03-12 at 01:19:12 +0100, Heiko Oberdiek wrote:

 > On Sun, Mar 11, 2012 at 09:47:06PM +0100, Reinhard Kotucha wrote:
 > 
 > > On 2012-03-11 at 20:54:32 +0100, Bernhard Tempel wrote:
 > > 
 > >  > Am 11.03.2012 18:48, schrieb Khaled Hosny:
 > 
 > >  > >  Try \setmainfont[RawFeature={+itlc}]{Latin Modern Roman}, it
 > >  > >  seems to make a noticeable improvement.
 > >  > 
 > >  > Thanks a lot for this. It really makes an improvement. In some
 > >  > cases the guessed glue is to big, but better results would be very
 > >  > difficult to reach when using heuristics. To calculate the extreme
 > >  > "\emph{f}!" combination works fine; with the less extreme
 > >  > combination "\emph{f}:" the kerning could be more tight, but I can
 > >  > see that the guessed value must be the the same as for "\emph{f}!".
 > > 
 > > But if you try
 > > 
 > >   \parindent0pt
 > >   \emph{f}! \par 
 > >   \emph{f}: \par 
 > >   \emph{f}; \par 
 > >   \emph{f}. \par  
 > > 
 > > you'll see that the period is treated differently.  Is this a result
 > > of the heuristics or does it come from somewhere else?
 > 
 > >From LaTeX. It manages a list \nocorrlist with the entries `,'
 > and `.' as default. \emph suppresses the italic correction
 > before a character in \nocorrlist.

Thanks for the hint.  It explains a lot.  Maybe for : and ; LaTeX
should provide a \halfcorrlist as well. :)

However, things are more difficult, of course, especially if you are
going to emphasize a part of a composed word.  You can't guess the
amount of italic correction needed from the bounding box.  Imagine the
characters d and b, which have the same height.  On the other hand it
seems that Khaled's heuristics are sufficient here:

 \emph{b}d \par
 \emph{d}b \par
 \emph{b}b \par
 \emph{d}d \par

The output is at least reasonable and going much further doesn't make
much sense if the information isn't provided by the fonts themselves.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From zappathustra at free.fr  Sun Mar 11 16:59:52 2012
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 11 Mar 2012 16:59:52 +0100
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <4F5CC461.2050103@freenet.de>
References: <4F5CC461.2050103@freenet.de>
Message-ID: <20120311155952.11CB0A615E@smtp3-g21.free.fr>

Bernhard Tempel <bernhard.tempel at freenet.de> a ?crit:
> 
> Hello,
> 
> as Source2e states, the LaTeX font change commands with argument like 
> \emph{foo} "automatically take care of any necessary italic correction
> on either side of the argument" ([1] The LaTeX2e sources [2011/06/27], p. 
> 190). Using pdfTeX this works with some fonts like Latin Modern or MinionPro. 
> Unfortunately with luaTeX italic correction in normal text seems not to work 
> at all. Take a look at the minimal working example following.
> 
> I noticed some earlier discussion about italic correction with lua(La)TeX and 
> math mode, but this doesn't apply here. As I'm only LaTeX user it's difficult 
> for me to analyze this more in depth. There are fonts where even pdfTeX has no 
> italic correction as the font metrics don't include the necessary values, e.g. 
> Linux Libertine. My hope was changing to luaTeX, using otf fonts, would solve 
> this - which is not the case as I had to realize.
> 
> Any ideas?

Italic correction is a concept related to TFM fonts; OTF fonts do not
have such a parameter by default. However, it can be calculated, and
apparently luaotfload (the fontloader you must be using) doesn't do
that.

Best,
Paul


From khaledhosny at eglug.org  Mon Mar 12 14:16:36 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Mon, 12 Mar 2012 15:16:36 +0200
Subject: [luatex] Italic correction for normal text with LuaLaTex
In-Reply-To: <20317.18787.264701.502455@zaphod.ms25.net>
References: <4F5CC461.2050103@freenet.de>
 <20120311174846.GB27324@khaled-laptop>
 <4F5D02F8.3010002@freenet.de>
 <20317.3914.571842.321422@zaphod.ms25.net>
 <20120312001912.GA30081@oberdiek.my-fqdn.de>
 <20317.18787.264701.502455@zaphod.ms25.net>
Message-ID: <20120312131636.GA19011@khaled-laptop>

On Mon, Mar 12, 2012 at 01:54:59AM +0100, Reinhard Kotucha wrote:
> However, things are more difficult, of course, especially if you are
> going to emphasize a part of a composed word.  You can't guess the
> amount of italic correction needed from the bounding box.  Imagine the
> characters d and b, which have the same height.  On the other hand it
> seems that Khaled's heuristics are sufficient here:

It is Hans' not mine. Also italic correction is a "fixed" glyph
property, it does not check the next glyph or anything ("itlc" feature
just loops over all glyphs in the font and guesses a value for each),
but I think Hans' "hybrid-italic' in ConTeXt might be (or can be made
to) look ahead and adapt the correction to the next glyph.

Regards,
 Khaled

From kip at thevertigo.com  Mon Mar 19 00:25:32 2012
From: kip at thevertigo.com (Kip Warner)
Date: Sun, 18 Mar 2012 16:25:32 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
Message-ID: <1332113133.3358.43.camel@kip-laptop>

On Sat, 2012-03-17 at 11:21 +0100, Wolfgang Schuster wrote:
> Am 17.03.2012 um 10:21 schrieb luigi scarso:
> 
> > On Sat, Mar 17, 2012 at 2:47 AM, Kip Warner <kip at thevertigo.com> wrote:
> >> Hey list,
> >> 
> >> Is there any way to hint to ConTeXt that the contents of a \startitemize
> >> \stopitemize pair should try to be all on the same page?
> > plain old tex
> > \vbox{%
> > \startitemize
> > \stopitemize%
> > }
> 
> Better:
> 
> \startitemize[before=\startlinecorrection,after=\stoplinecorrection]
> 
> \stopitemize
> 
> You can control the space before/after the linecorrection environment with the optional
> argument which accepts all values for \blank, e.g. \startlinecorrection[2*line].
> 
> Wolfgang

Hey Wolfgang,

The good news is that this is probably what I need. The bad news is
luatex completely blows itself to pieces, allocating memory until the
system crashes. 

After much grinding of the machine, I managed to finally SIGSTOP and
attach gdb to the naughty process.

I've cc'd the luatex user mailing list since this is probably, I
suppose, a luatex issue more than a ConTeXt one.

I am using luatex beta-0.71.0-2012030522 (rev 4364) through context
version 2012.03.13 21:26 on amd64 hardware running Ubuntu Maverick.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gdb.log
Type: text/x-log
Size: 7005 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120318/1e841bd4/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120318/1e841bd4/attachment-0001.bin>

From kip at thevertigo.com  Mon Mar 19 00:29:11 2012
From: kip at thevertigo.com (Kip Warner)
Date: Sun, 18 Mar 2012 16:29:11 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332113133.3358.43.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop>
Message-ID: <1332113351.3358.44.camel@kip-laptop>

On Sun, 2012-03-18 at 16:25 -0700, Kip Warner wrote:
> On Sat, 2012-03-17 at 11:21 +0100, Wolfgang Schuster wrote:
> > Am 17.03.2012 um 10:21 schrieb luigi scarso:
> > 
> > > On Sat, Mar 17, 2012 at 2:47 AM, Kip Warner <kip at thevertigo.com> wrote:
> > >> Hey list,
> > >> 
> > >> Is there any way to hint to ConTeXt that the contents of a \startitemize
> > >> \stopitemize pair should try to be all on the same page?
> > > plain old tex
> > > \vbox{%
> > > \startitemize
> > > \stopitemize%
> > > }
> > 
> > Better:
> > 
> > \startitemize[before=\startlinecorrection,after=\stoplinecorrection]
> > 
> > \stopitemize
> > 
> > You can control the space before/after the linecorrection environment with the optional
> > argument which accepts all values for \blank, e.g. \startlinecorrection[2*line].
> > 
> > Wolfgang
> 
> Hey Wolfgang,
> 
> The good news is that this is probably what I need. The bad news is
> luatex completely blows itself to pieces, allocating memory until the
> system crashes. 
> 
> After much grinding of the machine, I managed to finally SIGSTOP and
> attach gdb to the naughty process.
> 
> I've cc'd the luatex user mailing list since this is probably, I
> suppose, a luatex issue more than a ConTeXt one.
> 
> I am using luatex beta-0.71.0-2012030522 (rev 4364) through context
> version 2012.03.13 21:26 on amd64 hardware running Ubuntu Maverick.

One other thing that I should have made more clear, this only happens
when I insert the aforementioned line correction commands.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120318/a64134e8/attachment.bin>

From schuster.wolfgang at googlemail.com  Mon Mar 19 09:17:42 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Mon, 19 Mar 2012 09:17:42 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332113351.3358.44.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
Message-ID: <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>


Am 19.03.2012 um 00:29 schrieb Kip Warner:

> On Sun, 2012-03-18 at 16:25 -0700, Kip Warner wrote:
>> On Sat, 2012-03-17 at 11:21 +0100, Wolfgang Schuster wrote:
>>> Am 17.03.2012 um 10:21 schrieb luigi scarso:
>>> 
>>>> On Sat, Mar 17, 2012 at 2:47 AM, Kip Warner <kip at thevertigo.com> wrote:
>>>>> Hey list,
>>>>> 
>>>>> Is there any way to hint to ConTeXt that the contents of a \startitemize
>>>>> \stopitemize pair should try to be all on the same page?
>>>> plain old tex
>>>> \vbox{%
>>>> \startitemize
>>>> \stopitemize%
>>>> }
>>> 
>>> Better:
>>> 
>>> \startitemize[before=\startlinecorrection,after=\stoplinecorrection]
>>> 
>>> \stopitemize
>>> 
>>> You can control the space before/after the linecorrection environment with the optional
>>> argument which accepts all values for \blank, e.g. \startlinecorrection[2*line].
>>> 
>>> Wolfgang
>> 
>> Hey Wolfgang,
>> 
>> The good news is that this is probably what I need. The bad news is
>> luatex completely blows itself to pieces, allocating memory until the
>> system crashes. 
>> 
>> After much grinding of the machine, I managed to finally SIGSTOP and
>> attach gdb to the naughty process.
>> 
>> I've cc'd the luatex user mailing list since this is probably, I
>> suppose, a luatex issue more than a ConTeXt one.
>> 
>> I am using luatex beta-0.71.0-2012030522 (rev 4364) through context
>> version 2012.03.13 21:26 on amd64 hardware running Ubuntu Maverick.
> 
> One other thing that I should have made more clear, this only happens
> when I insert the aforementioned line correction commands.


Make a example because this works:

\starttext

%\dorecurse{2}{\input tufte\par}
\dorecurse{3}{\input tufte\par}

\startitemize[before={\startlinecorrection[blank]},after=\stoplinecorrection]
\dorecurse{4}{\startitem \input ward \stopitem}
\stopitemize

\dorecurse{3}{\input tufte\par}

\stoptext

Wolfgang

From pragma at wxs.nl  Mon Mar 19 22:49:23 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 19 Mar 2012 22:49:23 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332113351.3358.44.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
Message-ID: <4F67A9E3.2040401@wxs.nl>

On 19-3-2012 00:29, Kip Warner wrote:

>> I've cc'd the luatex user mailing list since this is probably, I
>> suppose, a luatex issue more than a ConTeXt one.

not that probable

> One other thing that I should have made more clear, this only happens
> when I insert the aforementioned line correction commands.

test needed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Mon Mar 19 22:50:16 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Mon, 19 Mar 2012 22:50:16 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332113133.3358.43.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop>
Message-ID: <4F67AA18.8030701@wxs.nl>

On 19-3-2012 00:25, Kip Warner wrote:

> The good news is that this is probably what I need. The bad news is
> luatex completely blows itself to pieces, allocating memory until the
> system crashes.

Packaging itemizes are on a todo list as I sometimes need it myself, but 
it has a low priority

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From kip at thevertigo.com  Tue Mar 20 01:43:10 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 19 Mar 2012 17:43:10 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <4F67A9E3.2040401@wxs.nl>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <4F67A9E3.2040401@wxs.nl>
Message-ID: <1332204190.3358.242.camel@kip-laptop>

On Mon, 2012-03-19 at 22:49 +0100, Hans Hagen wrote:
> On 19-3-2012 00:29, Kip Warner wrote:
> 
> >> I've cc'd the luatex user mailing list since this is probably, I
> >> suppose, a luatex issue more than a ConTeXt one.
> 
> not that probable

Actually highly probably, since the seg fault is raised in luatex and
not context. Even if context is feeding it malformed input, luatex
should not ever crash.

> test needed

On it. My book is a couple hundred pages long, so hopefully I will be
able to come up with one.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120319/04e66f60/attachment.bin>

From kip at thevertigo.com  Tue Mar 20 02:04:16 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 19 Mar 2012 18:04:16 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
Message-ID: <1332205456.3358.248.camel@kip-laptop>

On Mon, 2012-03-19 at 09:17 +0100, Wolfgang Schuster wrote:
> Make a example because this works:
> 
> \starttext
> 
> %\dorecurse{2}{\input tufte\par}
> \dorecurse{3}{\input tufte\par}
> 
> \startitemize[before={\startlinecorrection[blank]},after=
> \stoplinecorrection]
> \dorecurse{4}{\startitem \input ward \stopitem}
> \stopitemize
> 
> \dorecurse{3}{\input tufte\par}
> 
> \stoptext 

I concur that your example works. Attached is an example of a minimal
that does not for me. ConTeXt does its thing, invoking luatex which
quickly gets nasty and starts spinning the clock - endlessly allocating
memory until a 4GB system is run into the ground.

This is what I see:

$ context minimal.tex 

resolvers       | resolving | loading configuration file
'selfautodir:/share/texmf/web2c/contextcnf.lua'
resolvers       | resolving | loading configuration file
'/usr/share/texmf/web2c/contextcnf.lua'
mtx-context     | run 1: luatex
--fmt="/home/kip/.texmf-var/luatex-cache/context/e570cb3e0e3ab0118ca08dd148bbec7d/formats/cont-en" --lua="/home/kip/.texmf-var/luatex-cache/context/e570cb3e0e3ab0118ca08dd148bbec7d/formats/cont-en.lui" --backend="pdf" "./minimal.tex" \stoptext
This is LuaTeX, Version beta-0.71.0-2012030522 (rev 4364) 
 \write18 enabled.

resolvers       > resolving > loading configuration file
'/usr/share/texmf/web2c/contextcnf.lua'
(minimal.tex

ConTeXt  ver: 2012.03.13 21:26 MKIV  fmt: 2012.3.14  int:
english/english

system          > cont-new.mkiv loaded
(/usr/share/texmf/tex/context/base/cont-new.mkiv
system          > beware: some patches loaded from cont-new.mkiv
)
system          > minimal.top loaded
(minimal.top)
fonts           > latin modern fonts are not preloaded
languages       > language en is active
{/usr/share/texmf/fonts/map/pdftex/context/mkiv-base.map}
fonts           > preloading latin modern fonts (second stage)
fonts           > typescripts > unknown: library 'loc'
{/usr/share/texmf/fonts/map/dvips/lm/lm-math.map}{/usr/share/texmf/fonts/map/dvips/lm/lm-rm.map}
fonts           > defining > forced type afm of stmary10 not found
fonts           > defining > font with asked name 'stmary10' is not
found using lookup 'file'
fonts           > virtual math > loading font LMMath7-Regular subfont 9
with name stmary10.afm at 458752 is skipped, not found
fonts           > defining > forced type afm of stmary10 not found
fonts           > defining > font with asked name 'stmary10' is not
found using lookup 'file'
fonts           > virtual math > loading font LMMath9-Regular subfont 9
with name stmary10.afm at 589824 is skipped, not found
fonts           > defining > forced type afm of stmary10 not found
fonts           > defining > font with asked name 'stmary10' is not
found using lookup 'file'
fonts           > virtual math > loading font LMMath12-Regular subfont 9
with name stmary10.afm at 786432 is skipped, not found
fonts           > fallback modern rm 12pt is loaded

[***hangs at this point***]

I am using ConTeXt and LuaTeX packages off of Adam's PPA. These are
luatex version beta-0.71.0-2012030522 (rev 4364) under context version
2012.03.13 21:26 on amd64 hardware using Ubuntu Maverick.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minimal.tex
Type: text/x-tex
Size: 138 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20120319/bf1c2a53/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120319/bf1c2a53/attachment-0001.bin>

From schuster.wolfgang at googlemail.com  Tue Mar 20 06:22:43 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 20 Mar 2012 06:22:43 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332205456.3358.248.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
Message-ID: <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>


Am 20.03.2012 um 02:04 schrieb Kip Warner:

> On Mon, 2012-03-19 at 09:17 +0100, Wolfgang Schuster wrote:
>> Make a example because this works:
>> 
>> \starttext
>> 
>> %\dorecurse{2}{\input tufte\par}
>> \dorecurse{3}{\input tufte\par}
>> 
>> \startitemize[before={\startlinecorrection[blank]},after=
>> \stoplinecorrection]
>> \dorecurse{4}{\startitem \input ward \stopitem}
>> \stopitemize
>> 
>> \dorecurse{3}{\input tufte\par}
>> 
>> \stoptext 
> 
> I concur that your example works. Attached is an example of a minimal
> that does not for me. ConTeXt does its thing, invoking luatex which
> quickly gets nasty and starts spinning the clock - endlessly allocating
> memory until a 4GB system is run into the ground.


The problem is the empty second argument.

\startitemize[before=\startlinecorrection,after=\stoplinecorrection][]

When you pass two arguments with \startitemize the first argument os for keywords (e.g. packed or fit)
and second argument is for assignments (e.g. width=3cm) in your case context is looking for the keywords
?before=\startlinecorrection? and ?after=\stoplinecorrection? which results in a loop.

Wolfgang

From kip at thevertigo.com  Tue Mar 20 06:31:22 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 19 Mar 2012 22:31:22 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
Message-ID: <1332221482.3358.310.camel@kip-laptop>

On Tue, 2012-03-20 at 06:22 +0100, Wolfgang Schuster wrote:
> The problem is the empty second argument.
> 
> \startitemize[before=\startlinecorrection,after=\stoplinecorrection][]
> 
> When you pass two arguments with \startitemize the first argument os for keywords (e.g. packed or fit)
> and second argument is for assignments (e.g. width=3cm) in your case context is looking for the keywords
> ?before=\startlinecorrection? and ?after=\stoplinecorrection? which results in a loop.

Even if that were the case, that's a fragility that no program should
its users endure. It should probably have bailed with an error message
after seeing that the second argument was empty rather than taking down
the entire operating system with it.

But regardless, this does not seem to be the case. The following minimal
still blows up, even with an assignment in the second parameter.

\starttext

    \startitemize[before=\startlinecorrection,after=
\stoplinecorrection][start=11]
    \item foo
    \stopitemize

\stoptext

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120319/0f5f20b7/attachment-0001.bin>

From schuster.wolfgang at googlemail.com  Tue Mar 20 06:46:00 2012
From: schuster.wolfgang at googlemail.com (Wolfgang Schuster)
Date: Tue, 20 Mar 2012 06:46:00 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332221482.3358.310.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
Message-ID: <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>


Am 20.03.2012 um 06:31 schrieb Kip Warner:

> On Tue, 2012-03-20 at 06:22 +0100, Wolfgang Schuster wrote:
>> The problem is the empty second argument.
>> 
>> \startitemize[before=\startlinecorrection,after=\stoplinecorrection][]
>> 
>> When you pass two arguments with \startitemize the first argument os for keywords (e.g. packed or fit)
>> and second argument is for assignments (e.g. width=3cm) in your case context is looking for the keywords
>> ?before=\startlinecorrection? and ?after=\stoplinecorrection? which results in a loop.
> 
> Even if that were the case, that's a fragility that no program should
> its users endure. It should probably have bailed with an error message
> after seeing that the second argument was empty rather than taking down
> the entire operating system with it.

TeX has it?s problem with certain errors, accept it.

> But regardless, this does not seem to be the case. The following minimal
> still blows up, even with an assignment in the second parameter.
> 
> \starttext
> 
>    \startitemize[before=\startlinecorrection,after=
> \stoplinecorrection][start=11]
>    \item foo
>    \stopitemize
> 
> \stoptext

You can?t have a assignment in both parameters because this would lead to the same problem as before,
combine both settings in one argument and it works.

Wolfgang

From kip at thevertigo.com  Tue Mar 20 06:49:48 2012
From: kip at thevertigo.com (Kip Warner)
Date: Mon, 19 Mar 2012 22:49:48 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
Message-ID: <1332222588.3358.311.camel@kip-laptop>

On Tue, 2012-03-20 at 06:46 +0100, Wolfgang Schuster wrote:
> TeX has it?s problem with certain errors, accept it.

It is not a problem with the program raising an error, it was how it
went about doing it. It should not have to take down the entire
operating system to indicate to the user that there was a non-intuitive
syntactical error in typesetting.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120319/1408f182/attachment.bin>

From patrick at gundla.ch  Tue Mar 20 08:21:35 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 20 Mar 2012 08:21:35 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332222588.3358.311.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
Message-ID: <887D043D-CBB9-4ED3-BFDA-D4B033FB83C0@gundla.ch>


Am 20.03.2012 um 06:49 schrieb Kip Warner:

> On Tue, 2012-03-20 at 06:46 +0100, Wolfgang Schuster wrote:
>> TeX has it?s problem with certain errors, accept it.
> 
> It is not a problem with the program raising an error, it was how it
> went about doing it. It should not have to take down the entire
> operating system to indicate to the user that there was a non-intuitive
> syntactical error in typesetting.


I also agree that a segfault is not an acceptable behavior of a program, regardless of the input (unless you are doing low level stuff). But it is not clear if this is a problem on the ConTeXt side or the LuaTeX side.

Patrick



From pragma at wxs.nl  Tue Mar 20 09:11:48 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Mar 2012 09:11:48 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332204190.3358.242.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <4F67A9E3.2040401@wxs.nl> <1332204190.3358.242.camel@kip-laptop>
Message-ID: <4F683BC4.2070405@wxs.nl>

On 20-3-2012 01:43, Kip Warner wrote:
> On Mon, 2012-03-19 at 22:49 +0100, Hans Hagen wrote:
>> On 19-3-2012 00:29, Kip Warner wrote:
>>
>>>> I've cc'd the luatex user mailing list since this is probably, I
>>>> suppose, a luatex issue more than a ConTeXt one.
>>
>> not that probable
>
> Actually highly probably, since the seg fault is raised in luatex and
> not context. Even if context is feeding it malformed input, luatex
> should not ever crash.

it depends ... if some node list juggling happens in macros/lua code and 
something is done wrong there, one can run out of memory (for instance)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From pragma at wxs.nl  Tue Mar 20 09:17:18 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Mar 2012 09:17:18 +0100
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332222588.3358.311.camel@kip-laptop>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
Message-ID: <4F683D0E.8070602@wxs.nl>

On 20-3-2012 06:49, Kip Warner wrote:
> On Tue, 2012-03-20 at 06:46 +0100, Wolfgang Schuster wrote:
>> TeX has it?s problem with certain errors, accept it.
>
> It is not a problem with the program raising an error, it was how it
> went about doing it. It should not have to take down the entire
> operating system to indicate to the user that there was a non-intuitive
> syntactical error in typesetting.

tex is a macro language and that has benefits but also drawbacks; as 
soon as you end up in unwanted expansion things can get nasty; anyhow, I get

Runaway argument?
{before=\startlinecorrection ,after= \stoplinecorrection 
}]{\dodoubleemptyYESone \ETC.
! TeX capacity exceeded, sorry [token memory size=90996078].

which is not really a crash of my operating system; there is not much I 
can do about this issue I fear.

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From khaledhosny at eglug.org  Tue Mar 20 15:57:51 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 20 Mar 2012 16:57:51 +0200
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <1332222588.3358.311.camel@kip-laptop>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop>
 <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
Message-ID: <20120320145751.GA19233@khaled-laptop>

On Mon, Mar 19, 2012 at 10:49:48PM -0700, Kip Warner wrote:
> On Tue, 2012-03-20 at 06:46 +0100, Wolfgang Schuster wrote:
> > TeX has it?s problem with certain errors, accept it.
> 
> It is not a problem with the program raising an error, it was how it
> went about doing it. It should not have to take down the entire
> operating system to indicate to the user that there was a non-intuitive
> syntactical error in typesetting.

Older TeX engines had hard memory limit, so in case of such
"syntactical" errors the engine would consume all its allocated memory
and die (with a misleading error message), LuaTeX dynamically allocates
memory (for good reasons) so it won't stop before consuming all your
available memory, its the responsibility of an operating system to
prevent such a faulty application from taking the whole system down.

Regards,
 Khaled


From khaledhosny at eglug.org  Tue Mar 20 16:02:35 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 20 Mar 2012 17:02:35 +0200
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <887D043D-CBB9-4ED3-BFDA-D4B033FB83C0@gundla.ch>
References: <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop>
 <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
 <887D043D-CBB9-4ED3-BFDA-D4B033FB83C0@gundla.ch>
Message-ID: <20120320150235.GB19233@khaled-laptop>

On Tue, Mar 20, 2012 at 08:21:35AM +0100, Patrick Gundlach wrote:
> 
> Am 20.03.2012 um 06:49 schrieb Kip Warner:
> 
> > On Tue, 2012-03-20 at 06:46 +0100, Wolfgang Schuster wrote:
> >> TeX has it?s problem with certain errors, accept it.
> > 
> > It is not a problem with the program raising an error, it was how it
> > went about doing it. It should not have to take down the entire
> > operating system to indicate to the user that there was a non-intuitive
> > syntactical error in typesetting.
> 
> 
> I also agree that a segfault is not an acceptable behavior of a
> program, regardless of the input (unless you are doing low level
> stuff). But it is not clear if this is a problem on the ConTeXt side
> or the LuaTeX side.

It did not segfault, it just consumed all available memory :) A sane
operating system wouldn't allow any program to do this (mine is not
sane, I know, but luatex is hardly the only program that does this to
me).

Regards,
 Khaled

From kip at thevertigo.com  Tue Mar 20 19:50:04 2012
From: kip at thevertigo.com (Kip Warner)
Date: Tue, 20 Mar 2012 11:50:04 -0700
Subject: [luatex] [NTG-context] Itemize without page break
In-Reply-To: <4F683D0E.8070602@wxs.nl>
References: <1331948860.30893.0.camel@kip-laptop>
 <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>  <4F683D0E.8070602@wxs.nl>
Message-ID: <1332269404.3358.312.camel@kip-laptop>

On Tue, 2012-03-20 at 09:17 +0100, Hans Hagen wrote:
> which is not really a crash of my operating system; there is not much
> I 
> can do about this issue I fear. 

Totally up to you. I just wanted to bring it to your attention.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120320/79c4b6ec/attachment.bin>

From kip at thevertigo.com  Tue Mar 20 19:59:44 2012
From: kip at thevertigo.com (Kip Warner)
Date: Tue, 20 Mar 2012 11:59:44 -0700
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <20120320145751.GA19233@khaled-laptop>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
 <20120320145751.GA19233@khaled-laptop>
Message-ID: <1332269984.3358.318.camel@kip-laptop>

On Tue, 2012-03-20 at 16:57 +0200, Khaled Hosny wrote:
> Older TeX engines had hard memory limit, so in case of such
> "syntactical" errors the engine would consume all its allocated memory
> and die (with a misleading error message), LuaTeX dynamically allocates
> memory (for good reasons) so it won't stop before consuming all your
> available memory, its the responsibility of an operating system to
> prevent such a faulty application from taking the whole system down.

I'd be very interested in seeing the operating system memory manager's
algorithm that could do such a remarkable thing.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120320/dd3bc038/attachment.bin>

From pragma at wxs.nl  Tue Mar 20 20:26:39 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Mar 2012 20:26:39 +0100
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <1332269984.3358.318.camel@kip-laptop>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop> <20120320145751.GA19233@khaled-laptop>
 <1332269984.3358.318.camel@kip-laptop>
Message-ID: <4F68D9EF.30008@wxs.nl>

On 20-3-2012 19:59, Kip Warner wrote:
> On Tue, 2012-03-20 at 16:57 +0200, Khaled Hosny wrote:
>> Older TeX engines had hard memory limit, so in case of such
>> "syntactical" errors the engine would consume all its allocated memory
>> and die (with a misleading error message), LuaTeX dynamically allocates
>> memory (for good reasons) so it won't stop before consuming all your
>> available memory, its the responsibility of an operating system to
>> prevent such a faulty application from taking the whole system down.
>
> I'd be very interested in seeing the operating system memory manager's
> algorithm that could do such a remarkable thing.

well you can try what happens if you run stock lua:

local t = { }
while true do
     t[#t+1] = "just a bogus string: " .. (#t+1)
end

at some point your system will run out of (virtual) memory or lua will 
run out of whatever its limits are

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From kip at thevertigo.com  Tue Mar 20 20:59:40 2012
From: kip at thevertigo.com (Kip Warner)
Date: Tue, 20 Mar 2012 12:59:40 -0700
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <4F68D9EF.30008@wxs.nl>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
 <20120320145751.GA19233@khaled-laptop>
 <1332269984.3358.318.camel@kip-laptop>  <4F68D9EF.30008@wxs.nl>
Message-ID: <1332273580.3358.320.camel@kip-laptop>

On Tue, 2012-03-20 at 20:26 +0100, Hans Hagen wrote:
> well you can try what happens if you run stock lua:
> 
> local t = { }
> while true do
>      t[#t+1] = "just a bogus string: " .. (#t+1)
> end
> 
> at some point your system will run out of (virtual) memory or lua will 
> run out of whatever its limits are

Of course. And the same could be done in C, C++, or really any language
that supports dynamic memory allocation. We just hope that programs that
are built from them won't do that.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120320/1219d4a1/attachment-0001.bin>

From pragma at wxs.nl  Tue Mar 20 21:44:11 2012
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 20 Mar 2012 21:44:11 +0100
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <1332273580.3358.320.camel@kip-laptop>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop> <20120320145751.GA19233@khaled-laptop>
 <1332269984.3358.318.camel@kip-laptop> <4F68D9EF.30008@wxs.nl>
 <1332273580.3358.320.camel@kip-laptop>
Message-ID: <4F68EC1B.9020005@wxs.nl>

On 20-3-2012 20:59, Kip Warner wrote:
> On Tue, 2012-03-20 at 20:26 +0100, Hans Hagen wrote:
>> well you can try what happens if you run stock lua:
>>
>> local t = { }
>> while true do
>>       t[#t+1] = "just a bogus string: " .. (#t+1)
>> end
>>
>> at some point your system will run out of (virtual) memory or lua will
>> run out of whatever its limits are
>
> Of course. And the same could be done in C, C++, or really any language
> that supports dynamic memory allocation. We just hope that programs that
> are built from them won't do that.

sure, but mu experience is that browsers of email clients are way more 
demanding than tex when it comes to memory usage

for tex it depends how much memory is permitted (there are some maxima 
that can be set in configuration files) ... i must say that I never run 
out of memory, although with doing extreme torture tests with many fonts 
one can come pretty close

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From kip at thevertigo.com  Tue Mar 20 22:26:28 2012
From: kip at thevertigo.com (Kip Warner)
Date: Tue, 20 Mar 2012 14:26:28 -0700
Subject: [luatex] [NTG-context]   Itemize without page break
In-Reply-To: <4F68EC1B.9020005@wxs.nl>
References: <CAG5iGsAGp90Tgx8WGa4QN81GWOf5G92TO+jUYniJQgYDwbJf1A@mail.gmail.com>
 <CBEC4406-E13A-42B4-9855-F56C982BF72D@googlemail.com>
 <1332113133.3358.43.camel@kip-laptop> <1332113351.3358.44.camel@kip-laptop>
 <CB9142FB-3CFD-4788-9095-80F12B7DAA6E@googlemail.com>
 <1332205456.3358.248.camel@kip-laptop>
 <7448136C-5F9E-44D5-8D5E-DF40EA6C3E57@googlemail.com>
 <1332221482.3358.310.camel@kip-laptop>
 <46285150-558A-4D3E-B052-12DFBF7E6F70@googlemail.com>
 <1332222588.3358.311.camel@kip-laptop>
 <20120320145751.GA19233@khaled-laptop>
 <1332269984.3358.318.camel@kip-laptop> <4F68D9EF.30008@wxs.nl>
 <1332273580.3358.320.camel@kip-laptop>  <4F68EC1B.9020005@wxs.nl>
Message-ID: <1332278788.3358.326.camel@kip-laptop>

On Tue, 2012-03-20 at 21:44 +0100, Hans Hagen wrote:
> sure, but mu experience is that browsers of email clients are way more 
> demanding than tex when it comes to memory usage

I've never had either take down the entire operating system. There is a
different from intended memory usage and unintended anyways. In this
case, we are talking about the latter.

> for tex it depends how much memory is permitted (there are some maxima 
> that can be set in configuration files) ... i must say that I never run 
> out of memory, although with doing extreme torture tests with many fonts 
> one can come pretty close

Well, you saw what happened with my sample minimal.

Anyways, if this is normal behaviour, that's fine, I just wanted to
bring it to the list's attention. That's all.

-- 
Kip Warner -- Software Engineer
OpenPGP encrypted/signed mail preferred
http://www.thevertigo.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://tug.org/pipermail/luatex/attachments/20120320/568721d2/attachment.bin>

From Herbert.Voss at FU-Berlin.DE  Tue Mar 27 15:44:40 2012
From: Herbert.Voss at FU-Berlin.DE (Herbert Voss)
Date: Tue, 27 Mar 2012 15:44:40 +0200
Subject: [luatex] font problem
Message-ID: <4F71C448.2070908@FU-Berlin.DE>

With xelatex both values for 1ex are the same, but
with lualatex I get  (10.67352pt) versus (3.43344pt)
The reason why the sans serif \LaTeX is not correct.
This happens only for LinBiolinum_R.otf and I do not
know why.

\documentclass{article}
\usepackage{fontspec}
\setmainfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\newdimen\EX
\begin{document}
\Huge
\LaTeX (\EX=1ex \the\EX)

\sffamily
\LaTeX (\EX=1ex \the\EX)

\end{document}

Herbert

From joseph.wright at morningstar2.co.uk  Tue Mar 27 16:03:39 2012
From: joseph.wright at morningstar2.co.uk (Joseph Wright)
Date: Tue, 27 Mar 2012 15:03:39 +0100
Subject: [luatex] font problem
In-Reply-To: <4F71C448.2070908@FU-Berlin.DE>
References: <4F71C448.2070908@FU-Berlin.DE>
Message-ID: <4F71C8BB.8070003@morningstar2.co.uk>

On 27/03/2012 14:44, Herbert Voss wrote:
> With xelatex both values for 1ex are the same, but
> with lualatex I get  (10.67352pt) versus (3.43344pt)
> The reason why the sans serif \LaTeX is not correct.
> This happens only for LinBiolinum_R.otf and I do not
> know why.
> 
> \documentclass{article}
> \usepackage{fontspec}
> \setmainfont{Linux Libertine O}
> \setsansfont{Linux Biolinum O}
> \newdimen\EX
> \begin{document}
> \Huge
> \LaTeX (\EX=1ex \the\EX)
> 
> \sffamily
> \LaTeX (\EX=1ex \the\EX)
> 
> \end{document}
> 
> Herbert

Issue with the ex height in the font, as noted in
http://tex.stackexchange.com/questions/47157/.
-- 
Joseph Wright

From khaledhosny at eglug.org  Tue Mar 27 16:45:58 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 27 Mar 2012 16:45:58 +0200
Subject: [luatex] font problem
In-Reply-To: <4F71C448.2070908@FU-Berlin.DE>
References: <4F71C448.2070908@FU-Berlin.DE>
Message-ID: <20120327144558.GB6783@khaled-laptop>

On Tue, Mar 27, 2012 at 03:44:40PM +0200, Herbert Voss wrote:
> With xelatex both values for 1ex are the same, but
> with lualatex I get  (10.67352pt) versus (3.43344pt)
> The reason why the sans serif \LaTeX is not correct.
> This happens only for LinBiolinum_R.otf and I do not
> know why.
> 
> \documentclass{article}
> \usepackage{fontspec}
> \setmainfont{Linux Libertine O}
> \setsansfont{Linux Biolinum O}
> \newdimen\EX
> \begin{document}
> \Huge
> \LaTeX (\EX=1ex \the\EX)
> 
> \sffamily
> \LaTeX (\EX=1ex \the\EX)
> 
> \end{document}

The font is broken (I sympathize with the developers since it is actually
a bug in FontForge that affects only some fonts, I had to post-process
one of the fonts I work on to fix a similar bug), but fortunately it can
be solved with LuaTeX. Adding the following lines just after loading
fontspec should do the trick:

\directlua {
local function fix_biolinum_xheight(fontdata)
  if fontdata.fullname:find("Linux Biolinum") then
    if fontdata.characters[string.byte("x")] then
      fontdata.parameters.x_height = fontdata.characters[string.byte("x")].height
    end
  end
end

luatexbase.add_to_callback("luaotfload.patch_font", fix_biolinum_xheight, "mypatch.fix_biolinum_xheight")
}

Regards,
 Khaled

From patrick at gundla.ch  Wed Mar 28 09:54:52 2012
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 28 Mar 2012 09:54:52 +0200
Subject: [luatex] font problem
In-Reply-To: <20120327144558.GB6783@khaled-laptop>
References: <4F71C448.2070908@FU-Berlin.DE>
 <20120327144558.GB6783@khaled-laptop>
Message-ID: <12180D88-6A05-4763-8F76-E183117B72AA@gundla.ch>

Hello Khaled,

can you tell me what you did (postprocessing) or how the fontforge bug can be circumvented?

Patrick




From khaledhosny at eglug.org  Wed Mar 28 16:12:58 2012
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 28 Mar 2012 16:12:58 +0200
Subject: [luatex] font problem
In-Reply-To: <12180D88-6A05-4763-8F76-E183117B72AA@gundla.ch>
References: <4F71C448.2070908@FU-Berlin.DE>
 <20120327144558.GB6783@khaled-laptop>
 <12180D88-6A05-4763-8F76-E183117B72AA@gundla.ch>
Message-ID: <20120328141258.GA2138@khaled-laptop>

On Wed, Mar 28, 2012 at 09:54:52AM +0200, Patrick Gundlach wrote:
> Hello Khaled,
> 
> can you tell me what you did (postprocessing) or how the fontforge bug
> can be circumvented?

I use FontTools Python library to open the fonts after FontForge
generates them and set the respective fields in OS/2 table directly, see
for example:
http://crimsontext.svn.sourceforge.net/viewvc/crimsontext/trunk/tools/generate.py?r1=96&r2=95&pathrev=96

Regards,
 Khaled

