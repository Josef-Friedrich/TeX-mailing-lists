From re.re at o2.pl  Wed May  1 14:16:54 2013
From: re.re at o2.pl (*)
Date: Wed, 1 May 2013 14:16:54 +0200
Subject: [luatex] (no subject)
In-Reply-To: <20120829083758.53A88A622E@smtp3-g21.free.fr>
References: <20120829083758.53A88A622E@smtp3-g21.free.fr>
Message-ID: <518107B6.2020304@o2.pl>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

please tell me waht i can add polish letter to document i lualatex ?
in latex test.tex all working in lualatex i get
 Package inputenc Error: Unicode char \u8:??ty not set up for use with
LaTeX

====
\documentclass[12pt,openany]{mwbk}
\usepackage{polski}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lipsum}

\begin{document}
\lipsum [1]
???ty

\end{document}

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAlGBB7YACgkQI6NVfpTMoOerIwCggIVqvbtrMvLQxFcxvVRNFunI
fH4An3J6ydHarJq8Pykq9FFM9S2WvwQe
=vVQF
-----END PGP SIGNATURE-----


From elie.roux at telecom-bretagne.eu  Wed May  1 14:58:33 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-2?Q?=C9lie_Roux?=)
Date: Wed, 1 May 2013 14:58:33 +0200
Subject: [luatex] (no subject)
In-Reply-To: <518107B6.2020304@o2.pl>
References: <20120829083758.53A88A622E@smtp3-g21.free.fr>
 <518107B6.2020304@o2.pl>
Message-ID: <51811179.8030000@telecom-bretagne.eu>

> Hello,
>
> please tell me waht i can add polish letter to document i lualatex ?
> in latex test.tex all working in lualatex i get
>   Package inputenc Error: Unicode char \u8:??ty not set up for use with
> LaTeX
>
> ====
> \documentclass[12pt,openany]{mwbk}
> \usepackage{polski}
> \usepackage[utf8]{inputenc}
> \usepackage[T1]{fontenc}
> \usepackage{lipsum}
>
> \begin{document}
> \lipsum [1]
> ???ty
>
> \end{document}

Dear *,

you should try with the luainputenc package. Inputenc doesn't support 
LuaTeX and is frozen for ages (so it cannot be adapted)...

Thank you,
-- 
Elie

From komascript at gmx.info  Wed May  1 15:25:50 2013
From: komascript at gmx.info (Markus Kohm)
Date: Wed, 1 May 2013 15:25:50 +0200
Subject: [luatex] (no subject)
In-Reply-To: <518107B6.2020304@o2.pl>
References: <20120829083758.53A88A622E@smtp3-g21.free.fr>
 <518107B6.2020304@o2.pl>
Message-ID: <2234317.IoyRq0PLNA@mailjo.komascript.de>

> \documentclass[12pt,openany]{mwbk}
> \usepackage{polski}
> \usepackage[utf8]{inputenc}
> \usepackage[T1]{fontenc}
> \usepackage{lipsum}
> 
> \begin{document}
> \lipsum [1]
> ???ty
> 
> \end{document}

You don't need inputenc for UTF-8 with xelatex or lualatex, because both have 
native support for UTF-8. But you should use fontspec instead of fontenc:

\documentclass[12pt,openany]{mwbk}
\usepackage{polski}
\usepackage{fontspec}
\usepackage{lipsum}

\begin{document}
\lipsum [1]
???ty

\end{document}

(Note, that this may fail if you're using a new LuaTeX, e.g., from TLcontrib, 
but an old oberdiek.luatex.lua, e.g., from TeX Live 2012.)

Using xelatex you may also want to use

\usepackage{polyglossia}
\setdefaultlanguage{polish}

instead of \usepackage{polski}.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <http://tug.org/pipermail/luatex/attachments/20130501/8d813c59/attachment.bin>

From luatex at nililand.de  Wed May  1 18:50:01 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 1 May 2013 18:50:01 +0200
Subject: [luatex] \openin and files without extensions
Message-ID: <1vj939omsl4nx.dlg@nililand.de>

In february there was a discussion about how \input handles files
without extension
(http://tug.org/mailman/htdig/luatex/2013-February/004042.html).

The problem popped up again in a tex.sx question today
http://tex.stackexchange.com/questions/111747/error-with-lualatex-lstinputlisting-and-an-extension-less-file

So I tried to identify the source of the problem.

When using \input{foo} LaTeX checks for the existence of a file with
\openin and \ifeof and this test fails for files without extension.
On the other side the primitive \input foo works without problem. 


\openin0 makefile % makefile exist in the folder
  \ifeof0         % gives: don't exist  
   don't exist
  \else
   exist
  \fi
\closein0

\openin0 {makefile} %with braces
  \ifeof0        % gives: exist
   don't exist
  \else
   exist
  \fi
\closein0

\input makefile %works

\openin0 test-1 % test-1.tex exists
  \ifeof0       % gives: exist
   don't exist
  \else
   exist
  \fi
\closein0

\input test-1   %works
\bye


I tested with
LuaTeX, Version beta-0.70.2-2012080612 (TeX Live 2012/W32TeX)
and Version beta-0.77.0-2013041621 (rev 4633) (Context)

Is this behaviour of \openin a bug or intended?



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From gnurser at gmail.com  Wed May  1 22:30:56 2013
From: gnurser at gmail.com (George Nurser)
Date: Wed, 1 May 2013 21:30:56 +0100
Subject: [luatex] oberdiek.luatex.lua still failing for me with MacTeX
	2013
In-Reply-To: <517FD0A2.9030605@telecom-bretagne.eu>
References: <CAAyCRnTcLOv5QngF4+M8NwMTuKFq4h9QYqTK4TQ8BYaejawzCA@mail.gmail.com>
 <517FD0A2.9030605@telecom-bretagne.eu>
Message-ID: <CAAyCRnQOHs4CQSRkKDk-vBXF1F2B5QM5YVRcJ1fTfFKZnQ--kw@mail.gmail.com>

Dear Elie,
It seems to work now.
Thanks again, George.


On 30 April 2013 15:09, ?lie Roux <elie.roux at telecom-bretagne.eu> wrote:

> On 30/04/2013 15:54, George Nurser wrote:
>
>> Hi,
>> I apologize if this is a known problem...
>> I just today downloaded and installed MacTeX 2013, which I (perhaps
>> wrongly) assumed has all the fixes in it.
>>
>> Trying to lualatex my current .tex file, which calls
>>
>>
>> \usepackage[no-math]{fontspec}
>> \usepackage{lualatex-math}
>> \usepackage{unicode-math}
>>
>
> Dear George,
>
> It seems, indeed, that your versions of oberdiek.luatex.lua and luaotfload
> are not up-to-date. Attached is the new version of oberdiek.luatex.lua, and
> the fixed luaotfload is on CTAN.
>
> Thank you,
> --
> Elie
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130501/36d794d8/attachment.html>

From persian-tex at tug.org  Thu May  2 02:53:30 2013
From: persian-tex at tug.org (Persian TeX Group)
Date: Thu, 2 May 2013 10:53:30 +1000
Subject: [luatex] About bidi typesetting in luatex
Message-ID: <CALRNUsbwJ69YJZUHVVb3QbZVMMMttK3uJQsfHRTB6aoXzpi-0Q@mail.gmail.com>

Hi taco and others

a while ago, John Plaice said that the whole bidi algorithm in luatex needs
to be redone. I was wondering if there has been a progress on that?

I also have a feature request. since \hbox and \vbox accept direction (i.e.
\hbox dir), I was wondering if this functionality could also be added to
\halign. Last time, I think Hartmut Henkel suggested[2] \vbox dir
TRT{\halign...} but that would stop \halign to break across pages, right?

[1] http://tug.org/pipermail/luatex/2012-December/003968.html
[2] http://tug.org/mailman/htdig/luatex/2009-August/001003.html

-- 
Sincerely yours,
Persian TeX Group
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130502/39f457df/attachment.html>

From lomov.vl at gmail.com  Thu May  2 03:46:25 2013
From: lomov.vl at gmail.com (Vladimir Lomov)
Date: Thu, 2 May 2013 10:46:25 +0900
Subject: [luatex] \openin and files without extensions
In-Reply-To: <1vj939omsl4nx.dlg@nililand.de>
References: <1vj939omsl4nx.dlg@nililand.de>
Message-ID: <20130502014625.GA699@smoon>

Hello,
** Ulrike Fischer [2013-05-01 18:50:01 +0200]:

> In february there was a discussion about how \input handles files
> without extension
> (http://tug.org/mailman/htdig/luatex/2013-February/004042.html).

> The problem popped up again in a tex.sx question today
> http://tex.stackexchange.com/questions/111747/error-with-lualatex-lstinputlisting-and-an-extension-less-file

> So I tried to identify the source of the problem.

> When using \input{foo} LaTeX checks for the existence of a file with
> \openin and \ifeof and this test fails for files without extension.
> On the other side the primitive \input foo works without problem. 


> \openin0 makefile % makefile exist in the folder
>   \ifeof0         % gives: don't exist  
>    don't exist
>   \else
>    exist
>   \fi
> \closein0

> \openin0 {makefile} %with braces
>   \ifeof0        % gives: exist
>    don't exist
>   \else
>    exist
>   \fi
> \closein0

> \input makefile %works

> \openin0 test-1 % test-1.tex exists
>   \ifeof0       % gives: exist
>    don't exist
>   \else
>    exist
>   \fi
> \closein0

> \input test-1   %works
> \bye


> I tested with
> LuaTeX, Version beta-0.70.2-2012080612 (TeX Live 2012/W32TeX)
> and Version beta-0.77.0-2013041621 (rev 4633) (Context)

> Is this behaviour of \openin a bug or intended?

I'm not TeX expert but I did some extended tests based on your example in
TeX Live 2012 (Linux x86_64) using pdftex, xetex and luatex engines.

ex1: full copy of Ulrike example;
ex2: my dummy example, here I use macros for file names;
ex3: slightly modified version of ex1;

Results:

ex1
===

   block / engine   |    pdftex   |   xetex     | luatex
--------------------+-------------+-------------+-------------
\openin0 makefile   |    exist    |     exist   | don't exist
\openin0 {makefile} | don't exist | don't exist |    exist
\openin0 test-1     |    exist    |     exist   |    exist
--------------------+-------------+-------------+-------------

File 'makefile' included into document in all cases, as well as
'test-1.tex'.

ex2
===

Here I define two macros for file names: '\flI' and '\flII'.

 block / engine  |    pdftex   |   xetex     | luatex
-----------------+-------------+-------------+---------
\openin0 \flI    |    exist    |      -      |  exist
\openin0 {\flI}  | don't exist | don't exist |  exist
\openin0 \flII   |    exist    |      -      |  exist
-----------------+-------------+-------------+---------

xetex don't show message for first and third '\ifeof0' but still
includes both files.

ex3
===

This test file is essential the same as ex1 but I added some test to
'if' branches to distinguish all three blocks.

   block / engine   |    pdftex   |   xetex     | luatex
--------------------+-------------+-------------+-------------
\openin0 makefile   |    exist    |     exist   | don't exist
\openin0 {makefile} | don't exist | don't exist |    exist
\openin0 test-1     |    exist    |     exist   |    exist
--------------------+-------------+-------------+-------------

As I told I'm not TeX expert but from my PoV enclosing file name in {}
or defining a macro for it is fine and works in all cases.

I attach test TeX files and corresponding PDF files.

---
WBR, Vladimir Lomov

-- 
OS/2 must die!
-------------- next part --------------
A non-text attachment was scrubbed...
Name: openin-test-files.tar.xz
Type: application/octet-stream
Size: 38236 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130502/47f8972e/attachment-0001.obj>

From J2N-FORGET at orange.fr  Thu May  2 21:28:00 2013
From: J2N-FORGET at orange.fr (Jean)
Date: Thu, 2 May 2013 21:28:00 +0200
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
Message-ID: <1367522880.2394.13.camel@jf-xubuntu>

When I typeset the following file:
--- beginning of copy-paste
\documentclass[a4paper]{article}
\usepackage{luamplib}

\begin{document}

\begin{mplibcode}
beginfig(1);

z0 = ( 0, 40); dotlabel.top("Solar noon", z0);
z1 = ( 0, 20); dotlabel.top("Mean noon",  z1);
z2 = (80, 40); dotlabel.top("Midi solaire",  z2);
z3 = (80, 20); dotlabel.top("Midi moyen",  z3);
z4 = (80,  0); dotlabel.top("J 90",  z4);
z5 = ( 0,  0); dotlabel.top("J+90",  z5);

endfig;
\end{mplibcode}

\end{document}
--- end of copy-paste
I obtain a curious result with the "Midi moyen" and
"J+90" string: first they trigger two error messages each,
then they appear in the PDF file with "e-05 bp" unwanted
prefix. And because of this prefix, the label is not centered
as it should be.

The two error messages are:
! Illegal unit of measure (pt inserted).
! A <box> was supposed to be here.

The same error happens with "label" instead of "dotlabel" and
with any other position ("bot", "rt", "llft", etc) instead
of "top".

A wild guess: all labels are preceded with a length string such
as "0pt", "1bp", "2cm" and the like. For some reason, the computation
for "Midi moyen" and "J+90" does not yield exactly 0, but 
1/100000 bp. So this generates a prefix "1e-05 bp" instead of
"0 bp". Then, the interpreter scans the string "1e-05 bpJ+90",
extracts the number 1 and then gags on the "e", which it cannot
interpret as a length unit. So, as explained in the log file,
the interpreter insert its preferred unit "pt" and rescans
the updated string "1pte-05 bpJ+90", extract the length
prefix "1pt" and typeset the remainder of the string "e-05 bpJ+90".

This error happens with a recent version of luatex:

--- beginning of copy-paste
This is LuaTeX, Version beta-0.76.0-2013042400  (TeX Live 2013) (rev
4627)

Execute  'luatex --credits'  for credits and version details.

There is NO warranty. Redistribution of this software is covered by
the terms of the GNU General Public License, version 2 or (at your
option)
any later version. For more information about these matters, see the
file
named COPYING and the LuaTeX source.

Copyright 2013 Taco Hoekwater, the LuaTeX Team.
--- end of copy-paste

With an older version of luatex (from the Ubuntu 12.04 repository),
there
is a Lua error about an invalid argument sent to the "format" function
within the "module_log" function in modutils.lua, but since I have
installed the version above, I am more concerned with the
"e-05 bp" bug.

I have searched the Metapost mailing-list archive at
http://tug.org/pipermail/metapost/
and the Luatex mailing-list archive at
http://tug.org/mailman/mmsearch/luatex
with "illegal unit measure", and I have found nothing.

I include the source file and the log file if you want
to experiment.

So what is the problem? Does anyone know how to fix it?

Thank you in advance,

Jean Forget
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-mp.tex
Type: text/x-tex
Size: 449 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130502/e66bf1e8/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-mp.log
Type: text/x-log
Size: 4431 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130502/e66bf1e8/attachment-0001.bin>

From nomosnomos at gmail.com  Fri May  3 03:18:47 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Fri, 3 May 2013 10:18:47 +0900
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <1367522880.2394.13.camel@jf-xubuntu>
References: <1367522880.2394.13.camel@jf-xubuntu>
Message-ID: <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>

2013/5/3 Jean <J2N-FORGET at orange.fr>:
> When I typeset the following file:
> --- beginning of copy-paste
> \documentclass[a4paper]{article}
> \usepackage{luamplib}
>
> \begin{document}
>
> \begin{mplibcode}
> beginfig(1);
>
> z0 = ( 0, 40); dotlabel.top("Solar noon", z0);
> z1 = ( 0, 20); dotlabel.top("Mean noon",  z1);
> z2 = (80, 40); dotlabel.top("Midi solaire",  z2);
> z3 = (80, 20); dotlabel.top("Midi moyen",  z3);
> z4 = (80,  0); dotlabel.top("J 90",  z4);
> z5 = ( 0,  0); dotlabel.top("J+90",  z5);
>
> endfig;
> \end{mplibcode}
>
> \end{document}
> --- end of copy-paste
> I obtain a curious result with the "Midi moyen" and
> "J+90" string: first they trigger two error messages each,
> then they appear in the PDF file with "e-05 bp" unwanted
> prefix. And because of this prefix, the label is not centered
> as it should be.
>
> The two error messages are:
> ! Illegal unit of measure (pt inserted).
> ! A <box> was supposed to be here.
>

This issue seems to be caused by the inclusion of lua 5.2 into new
luatex engine. In the end, there should be an update of luamplib
package to fix this.

For the time being, you can use luatexko-mplib which I uploaded to
another mainling list to suggest an adoption into luamplib.  Download
the attchment at
http://tug.org/pipermail/lualatex-dev/2013-April/001504.html
and change the line \usepackage{luamplib} into
    \usepackage{fontspec}
    \usepackage{luatexko-mplib}
then recompile it.  I get no error message.

BTW, without \usepackage{fontspec}, I get "undefined control sequence"
error at \pdfstrcmp. I haven't noticed that before, as I always loaded
fontspec package. However, fontspec is a too heavy a package for
\pdfstrcmp command only. Could anybody tell me what package is
suitable for this purpose? I tried \usepackage{pdftexcmds}, but of no
use.

Best,
Dohyun Kim

From nomosnomos at gmail.com  Fri May  3 06:30:30 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Fri, 3 May 2013 13:30:30 +0900
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
References: <1367522880.2394.13.camel@jf-xubuntu>
 <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
Message-ID: <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>

2013/5/3 Dohyun Kim <nomosnomos at gmail.com>:
>
> BTW, without \usepackage{fontspec}, I get "undefined control sequence"
> error at \pdfstrcmp. I haven't noticed that before, as I always loaded
> fontspec package. However, fontspec is a too heavy a package for
> \pdfstrcmp command only. Could anybody tell me what package is
> suitable for this purpose? I tried \usepackage{pdftexcmds}, but of no
> use.

OK. According to the manual, pdftexcmds package provides not
\pdfstrcmp, but \pdf at strcmp instead. Therefore luatexko-mplib.sty
should be patched as follows:

10a11
>   \input pdftexcmds.sty
13a15
>   \RequirePackage{pdftexcmds}
61c63
<   \ifnum\pdfstrcmp{#1}{mplibcode}=\z@
---
>   \ifnum\pdf at strcmp{#1}{mplibcode}=\z@

Then no need to load fontspec.  ?lle, please apply this patch as well
when you import luatexko-mplib to luamplib if it is acceptable.

Best,
--
Dohyun Kim
Seoul, Republic of Korea


From philipp.gesang at alumni.uni-heidelberg.de  Sun May  5 14:15:41 2013
From: philipp.gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sun, 5 May 2013 14:15:41 +0200
Subject: [luatex] line break reassigns font id with expansion
Message-ID: <20130505121541.GA32014@phlegethon>

Hi all,

with expansion enabled, line breaking assigns new font ids to
glyph nodes. Example for luatex-plain:

?????????????????????????????????????????????????????????????????
%\font\somefont=file:Iwona-Regular.otf
\font\somefont=file:Iwona-Regular.otf:expansion=default;
\somefont
\pdfadjustspacing=2
\catcode`\%=11

\directlua{
  local glyph_t    = node.id"glyph"
  local hlist_t    = node.id"hlist"
  local vlist_t    = node.id"vlist"
  local sub_box_t  = node.id"sub_box"

  local show_font_id
  show_font_id = function (hd, when, nested)
    for n in node.traverse(hd) do
      local n_id = n.id
      if n_id == glyph_t then
        local n_font = n.font
        local tfmdata = font.getfont(n_font)
        print(string.format(
              "(%s (rec %s) (byte %d) (chr %s) (font %s) (tfmdata %s))",
              when,
              nested,
              n.char,
              unicode.utf8.char(n.char),
              n_font,
              tfmdata))
      elseif n_id == hlist_t or n_id == vlist_t or n_id == sub_box_t then
        show_font_id(n.list, when, true)
      end
    end
    return hd
  end
  callback.register(
    "pre_linebreak_filter",
    function (hd) return show_font_id(hd, "pre_line") end)
  callback.register(
    "post_linebreak_filter",
    function (hd) return show_font_id(hd, "post_line") end)
  callback.register(
    "pre_output_filter",
    function (hd) return show_font_id(hd, "pre_out") end)
}

\hsize 1cm

foo bar

\bye
?????????????????????????????????????????????????????????????????

On my machine (version beta-0.76.0-2013040516), all glyphs have
font 51 initially. During line breaking, those glyphs that are
subject to expansion get reassigned font 53 or 54. I?m not sure
whether this is caused by the font loader or the engine itself.
Anyways, the font loader doesn?t create entries for font ids 53
and 54 in fonts.hashes.identifiers.

My question is thus: is there a way to get the original font id
of an expanded glyph after line breaking, or at least to get the
corresponding tfmdata?

Thanks
Philipp



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130505/10f5c792/attachment.bin>

From zappathustra at free.fr  Sun May  5 15:56:04 2013
From: zappathustra at free.fr (Paul Isambert)
Date: Sun, 5 May 2013 15:56:04 +0200
Subject: [luatex] line break reassigns font id with expansion
In-Reply-To: <20130505121541.GA32014@phlegethon>
References: <20130505121541.GA32014@phlegethon>
Message-ID: <20130505135605.9C353D4810C@smtp5-g21.free.fr>

Philipp Gesang <philipp.gesang at alumni.uni-heidelberg.de> a ?crit:
> Hi all,
> 
> with expansion enabled, line breaking assigns new font ids to
> glyph nodes. Example for luatex-plain:
> 
> ?????????????????????????????????????????????????????????????????
> %\font\somefont=file:Iwona-Regular.otf
> \font\somefont=file:Iwona-Regular.otf:expansion=default;
> \somefont
> \pdfadjustspacing=2
> \catcode`\%=11
> 
> \directlua{
>   local glyph_t    = node.id"glyph"
>   local hlist_t    = node.id"hlist"
>   local vlist_t    = node.id"vlist"
>   local sub_box_t  = node.id"sub_box"
> 
>   local show_font_id
>   show_font_id = function (hd, when, nested)
>     for n in node.traverse(hd) do
>       local n_id = n.id
>       if n_id == glyph_t then
>         local n_font = n.font
>         local tfmdata = font.getfont(n_font)
>         print(string.format(
>               "(%s (rec %s) (byte %d) (chr %s) (font %s) (tfmdata %s))",
>               when,
>               nested,
>               n.char,
>               unicode.utf8.char(n.char),
>               n_font,
>               tfmdata))
>       elseif n_id == hlist_t or n_id == vlist_t or n_id == sub_box_t then
>         show_font_id(n.list, when, true)
>       end
>     end
>     return hd
>   end
>   callback.register(
>     "pre_linebreak_filter",
>     function (hd) return show_font_id(hd, "pre_line") end)
>   callback.register(
>     "post_linebreak_filter",
>     function (hd) return show_font_id(hd, "post_line") end)
>   callback.register(
>     "pre_output_filter",
>     function (hd) return show_font_id(hd, "pre_out") end)
> }
> 
> \hsize 1cm
> 
> foo bar
> 
> \bye
> ?????????????????????????????????????????????????????????????????
> 
> On my machine (version beta-0.76.0-2013040516), all glyphs have
> font 51 initially. During line breaking, those glyphs that are
> subject to expansion get reassigned font 53 or 54. I?m not sure
> whether this is caused by the font loader or the engine itself.
> Anyways, the font loader doesn?t create entries for font ids 53
> and 54 in fonts.hashes.identifiers.
> 
> My question is thus: is there a way to get the original font id
> of an expanded glyph after line breaking, or at least to get the
> corresponding tfmdata?

I can?t compile your example but it sounds like the original PDFTeX
implementation of expansion with several fonts (now triggered only if
?autoexpand? is missing in the \pdffontexpand call). Why it should be
so, I really don?t know, but at least you can test the idea with:

    \directlua{
      texio.write_nl(tostring(font.getfont(font.id("somefont")).auto_expand))
    }

(Note that I?d be surprised to be right.)

Best,
Paul


From J2N-FORGET at orange.fr  Mon May  6 06:56:40 2013
From: J2N-FORGET at orange.fr (Jean)
Date: Mon, 6 May 2013 06:56:40 +0200
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>
References: <1367522880.2394.13.camel@jf-xubuntu>
 <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
 <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>
Message-ID: <1367816200.2825.5.camel@jf-xubuntu>

Le vendredi 03 mai 2013 ? 13:30 +0900, Dohyun Kim a ?crit :
> 2013/5/3 Dohyun Kim <nomosnomos at gmail.com>:
> >
> > BTW, without \usepackage{fontspec}, I get "undefined control sequence"
> > error at \pdfstrcmp. I haven't noticed that before, as I always loaded
> > fontspec package. However, fontspec is a too heavy a package for
> > \pdfstrcmp command only. Could anybody tell me what package is
> > suitable for this purpose? I tried \usepackage{pdftexcmds}, but of no
> > use.
> 
> OK. According to the manual, pdftexcmds package provides not
> \pdfstrcmp, but \pdf at strcmp instead. Therefore luatexko-mplib.sty
> should be patched as follows:
> 
> 10a11
> >   \input pdftexcmds.sty
> 13a15
> >   \RequirePackage{pdftexcmds}
> 61c63
> <   \ifnum\pdfstrcmp{#1}{mplibcode}=\z@
> ---
> >   \ifnum\pdf at strcmp{#1}{mplibcode}=\z@
> 
> Then no need to load fontspec.  ?lle, please apply this patch as well
> when you import luatexko-mplib to luamplib if it is acceptable.
> 
> Best,
> --
> Dohyun Kim
> Seoul, Republic of Korea
> 
Thank you for your help. I have downloaded your package, patched 
luatexko-mplib.sty and installed the two files into the directory
     .../texmf-dist/tex/luatex/luamplib
that is, the same directory as luamplib.lua and luamplib.sty.
But the compilation failed because of :
! LaTeX Error: File `luatexko-mplib.sty' not found.
I have tried creating a 
     .../texmf-dist/tex/luatex/luatexko-mplib
directory and storing your two files into it, but the
result is the same. Is there any missing step in the
installation process?

Thank you for your help

Jean Forget



From reinhard.kotucha at web.de  Mon May  6 09:19:22 2013
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Mon, 6 May 2013 09:19:22 +0200
Subject: [luatex] getting --output-directory
In-Reply-To: <517FF530.9050304@arcor.de>
References: <517AA92E.3040507@arcor.de> <517EA9F2.1040601@arcor.de>
 <517FF530.9050304@arcor.de>
Message-ID: <20871.22906.219978.417363@zaphod.ms25.net>

On 2013-04-30 at 18:45:36 +0200, Stephan Hennig wrote:

 > Am 29.04.2013 19:12, schrieb Stephan Hennig:
 > 
 > > Shouldn't io.read and io.write operate in the output directory
 > > instead of the current directory in the first place?
 > 
 > Or rather io.open and io.popen.
 > 
 > > Does this reasoning make any sense?

I don't think so.  There might be reasons to set --output-directory in
order to put the PDF file somewhere else than other files.

If you want to read/write other files from/to the directory specified
by --output-directory, it's easy enough to determine the argument of
--output-directory in Lua.

\documentclass{minimal}
\usepackage{luacode}
\begin{luacode*}
  for k,v in pairs(arg) do
    if v:find('%-output%-directory') then
      if v:find('%-output%-directory=') then
        outputdir=string.explode(v, '=')[2]
      else
        outputdir=arg[tonumber(k)+1]
      end
    end
  end
  if outputdir and lfs.isdir(outputdir) then 
    texio.write_nl(outputdir..'\n') 
  end
\end{luacode*}
\begin{document}
\end{document}


But if you create a file, process it by an external tool, and read the
resulting file, it would be quite annoying if read and write
operations take place in different directories.  Thus I think that the
current behavior is appropriate and less confusing.

And even if Taco agrees more with you than with me, it would be very
helpful at least to have a boolean variable 'luaoutputdirectory' which
allows to control the behavior. 

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From taco at docwolves.nl  Mon May  6 10:05:50 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Mon, 6 May 2013 10:05:50 +0200
Subject: [luatex] \openin and files without extensions
In-Reply-To: <1vj939omsl4nx.dlg@nililand.de>
References: <1vj939omsl4nx.dlg@nililand.de>
Message-ID: <5187645E.4080906@docwolves.nl>

On 05/01/2013 06:50 PM, Ulrike Fischer wrote:
> In february there was a discussion about how \input handles files
> without extension
> [...]
>
>
> Is this behaviour of \openin a bug or intended?

I think this is a bug in \openin in luatex. Could someone create a 
tracker item please?

Best wishes,
Taco


From taco at docwolves.nl  Mon May  6 10:07:02 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Mon, 6 May 2013 10:07:02 +0200
Subject: [luatex] About bidi typesetting in luatex
In-Reply-To: <CALRNUsbwJ69YJZUHVVb3QbZVMMMttK3uJQsfHRTB6aoXzpi-0Q@mail.gmail.com>
References: <CALRNUsbwJ69YJZUHVVb3QbZVMMMttK3uJQsfHRTB6aoXzpi-0Q@mail.gmail.com>
Message-ID: <518764A6.6040100@docwolves.nl>

On 05/02/2013 02:53 AM, Persian TeX Group wrote:
> Hi taco and others
>
> a while ago, John Plaice said that the whole bidi algorithm in luatex
> needs to be redone. I was wondering if there has been a progress on that?

That is for John to answer.

Best wishes,
Taco


From nomosnomos at gmail.com  Mon May  6 10:09:32 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Mon, 6 May 2013 17:09:32 +0900
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <1367816200.2825.5.camel@jf-xubuntu>
References: <1367522880.2394.13.camel@jf-xubuntu>
 <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
 <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>
 <1367816200.2825.5.camel@jf-xubuntu>
Message-ID: <CAFzmAm2BvN_fjY6_MtThsf8Zz6KubkL8mSUqBdG8+fe0j6n0fQ@mail.gmail.com>

2013/5/6 Jean <J2N-FORGET at orange.fr>:
> Thank you for your help. I have downloaded your package, patched
> luatexko-mplib.sty and installed the two files into the directory
>      .../texmf-dist/tex/luatex/luamplib
> that is, the same directory as luamplib.lua and luamplib.sty.
> But the compilation failed because of :
> ! LaTeX Error: File `luatexko-mplib.sty' not found.
> I have tried creating a
>      .../texmf-dist/tex/luatex/luatexko-mplib
> directory and storing your two files into it, but the
> result is the same. Is there any missing step in the
> installation process?
>

It seems that you did not run 'mktexlsr'.

Anyway, I don't recommend putting these files under texmf-dist
directory. Above all they are for temporary or ad hoc solution. Why
don't you put those files in the working directory, the same place as
your tex source file?

Best,
--
Dohyun Kim
Seoul, Republic of Korea

From taco at docwolves.nl  Mon May  6 10:09:43 2013
From: taco at docwolves.nl (Taco Hoekwater)
Date: Mon, 6 May 2013 10:09:43 +0200
Subject: [luatex] getting --output-directory
In-Reply-To: <20871.22906.219978.417363@zaphod.ms25.net>
References: <517AA92E.3040507@arcor.de> <517EA9F2.1040601@arcor.de>
 <517FF530.9050304@arcor.de> <20871.22906.219978.417363@zaphod.ms25.net>
Message-ID: <51876547.2020504@docwolves.nl>

On 05/06/2013 09:19 AM, Reinhard Kotucha wrote:
>
> But if you create a file, process it by an external tool, and read the
> resulting file, it would be quite annoying if read and write
> operations take place in different directories.  Thus I think that the
> current behavior is appropriate and less confusing.

+1 (wontfix).

Nice example code also. Nevertheless, perhaps there should be a more
structured way of getting the 'output directory' value rather than
parsing arg[] manually. Adding something cleaner is a good thing to
consider.

Best wishes,
Taco


From luatex at nililand.de  Mon May  6 10:47:40 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Mon, 6 May 2013 10:47:40 +0200
Subject: [luatex] \openin and files without extensions
References: <1vj939omsl4nx.dlg@nililand.de> <5187645E.4080906@docwolves.nl>
Message-ID: <1ik5wdxqnn5n0.dlg@nililand.de>

Am Mon, 6 May 2013 10:05:50 +0200 schrieb Taco Hoekwater:


>> In february there was a discussion about how \input handles files
>> without extension
>> [...]
>>
>>
>> Is this behaviour of \openin a bug or intended?
> 
> I think this is a bug in \openin in luatex. Could someone create a 
> tracker item please?

I have created a tracker item.

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From J2N-FORGET at orange.fr  Mon May  6 21:53:50 2013
From: J2N-FORGET at orange.fr (Jean Forget)
Date: Mon, 6 May 2013 21:53:50 +0200
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <CAFzmAm2BvN_fjY6_MtThsf8Zz6KubkL8mSUqBdG8+fe0j6n0fQ@mail.gmail.com>
References: <1367522880.2394.13.camel@jf-xubuntu>
 <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
 <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>
 <1367816200.2825.5.camel@jf-xubuntu>
 <CAFzmAm2BvN_fjY6_MtThsf8Zz6KubkL8mSUqBdG8+fe0j6n0fQ@mail.gmail.com>
Message-ID: <1367870030.3493.9.camel@jf-xubuntu>

Le lundi 06 mai 2013 ? 17:09 +0900, Dohyun Kim a ?crit :
> 2013/5/6 Jean <J2N-FORGET at orange.fr>:
> > Thank you for your help. I have downloaded your package, patched
> > luatexko-mplib.sty and installed the two files into the directory
> >      .../texmf-dist/tex/luatex/luamplib
> > that is, the same directory as luamplib.lua and luamplib.sty.
> > But the compilation failed because of :
> > ! LaTeX Error: File `luatexko-mplib.sty' not found.
> > I have tried creating a
> >      .../texmf-dist/tex/luatex/luatexko-mplib
> > directory and storing your two files into it, but the
> > result is the same. Is there any missing step in the
> > installation process?
> >
> 
> It seems that you did not run 'mktexlsr'.
> 
> Anyway, I don't recommend putting these files under texmf-dist
> directory. Above all they are for temporary or ad hoc solution. Why
> don't you put those files in the working directory, the same place as
> your tex source file?
> 
Why didn't I put those files in the working directory? Because I did
not think of it. Because I still lack familiarity with the tex-live
directory architecture. Because I do not know if there is a tex-live
equivalent to the shell's $PATH. Because of many other reasons. 
Summing up: because PEBKAC (not always, but unfortunately too often).

Anyhow, I tried with luaexko-mplib.* in the working directory
and it works.

Since these files are public domain as you said in
http://tug.org/pipermail/lualatex-dev/2013-April/001504.html,
does that mean that I can put them in a Github repo where I
have a LuaLaTeX + MetaPost file? (Asking just to be
sure).

> Best,
> --
> Dohyun Kim
> Seoul, Republic of Korea

Thank you,

Jean Forget


From nomosnomos at gmail.com  Tue May  7 04:50:44 2013
From: nomosnomos at gmail.com (Dohyun Kim)
Date: Tue, 7 May 2013 11:50:44 +0900
Subject: [luatex] METAPOST labels in Lualatex: illegal unit of measure
In-Reply-To: <1367870030.3493.9.camel@jf-xubuntu>
References: <1367522880.2394.13.camel@jf-xubuntu>
 <CAFzmAm23n5Dunbc4ZL2XAitCBK5SoFRDk+9rPu4WGmtGtXKGNQ@mail.gmail.com>
 <CAFzmAm1AR-8SxW7Q7_d+2qg8qzBxB12Jg0C2PgzaJOSOiCVn=Q@mail.gmail.com>
 <1367816200.2825.5.camel@jf-xubuntu>
 <CAFzmAm2BvN_fjY6_MtThsf8Zz6KubkL8mSUqBdG8+fe0j6n0fQ@mail.gmail.com>
 <1367870030.3493.9.camel@jf-xubuntu>
Message-ID: <CAFzmAm06mbOEM0L3nL3EzA8oQSn7s6dwG7XimXznVtF45ReY6w@mail.gmail.com>

2013/5/7 Jean Forget <J2N-FORGET at orange.fr>:
> Since these files are public domain as you said in
> http://tug.org/pipermail/lualatex-dev/2013-April/001504.html,
> does that mean that I can put them in a Github repo where I
> have a LuaLaTeX + MetaPost file? (Asking just to be
> sure).

Sure. why not?

Best,
--
Dohyun Kim
Seoul, Republic of Korea

From evan.cooch at gmail.com  Tue May  7 15:48:45 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Tue, 7 May 2013 09:48:45 -0400
Subject: [luatex] latest luaotfload breaks something...again
Message-ID: <5189063D.2070104@gmail.com>

Just an the May 6 update on my MikTeX 2.9 install. When I try to compile 
the following MWE (bottom), I get a major error - I've copied bits of 
the log below. Main problem sems to be 'file not found: lualibs




Command Line:   lualatex.exe --shell-escape "lua-mwe.tex"
Startup Folder: C:\Users\egc\Desktop

This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
  \write18 enabled.
(C:/Users/egc/Desktop/lua-mwe.tex
LaTeX2e <2011/06/27>
LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns 
for engl
ish, loaded.

<snip>
("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luaotfload/luaotfload.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/luatexbase.sty"
("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-compat.sty
")
("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-loader.sty
"
(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase.loader.lua)
) ("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-regs.sty
") ("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-attr.st
y"
(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/attr.lua))
("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-cctb.sty"
(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/cctb.lua))
("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-mcb.sty"
("C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/luatexbase-modutils.s
ty"
(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua))
(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/mcb.lua)))
! LuaTeX error ... (x86)/MiKTeX 
2.9/tex/luatex/luatexbase/modutils.lua:49: modu
le 'lualibs' not found:
  no field package.preload['lualibs']
  [luatexbase.loader] Loading error:
  C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/lualibs/lualibs.lua:19: 
'=' expec
ted near 'default'
  [kpse C searcher] file not found: 'lualibs'
  [oberdiek.luatex.kpse_module_loader] Search failed
stack traceback:
  [C]: in function 'require'
  ... (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua:49: in 
function 'requi
re_module'
  <\directlua >:1: in main chunk.
\lltxb at requirelua ...xluaescapestring {#2}" \fi )}

l.34 \RequireLuaModule
                       {luaotfload}
?

Process has been terminated ...





\documentclass[11pt,letterpaper]{article}

\usepackage{fontspec}
\setmainfont{XITS}
\usepackage{unicode-math}
   \setmathfont{Asana Math}

\begin{document}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum quam 
ut erat rutrum consequat.

\begin{equation}
\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
\end{equation}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget 
dolor ac diam interdum volutpat. Cras luctus congue nibh, at dictum 
nulla iaculis quis.


\end{document}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130507/19d60b32/attachment.html>

From evan.cooch at gmail.com  Tue May  7 15:52:51 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Tue, 7 May 2013 09:52:51 -0400
Subject: [luatex] latest luaotfload breaks something...again
In-Reply-To: <5189063D.2070104@gmail.com>
References: <5189063D.2070104@gmail.com>
Message-ID: <51890733.6080906@gmail.com>

Confirmed (in a fashion). When I try to run mkluatexfontdb -V, I now get 
the following eror:

error loading module lualibs from file C:/blah/blah/blah

tex/lualibs/lualibs.lua c:/pathstuff/luatex/lualibs/lualibs:19: '=' 
expected near 'default'.

Suggestions?


On 5/7/2013 9:48 AM, Evan Cooch wrote:
> Just an the May 6 update on my MikTeX 2.9 install. When I try to 
> compile the following MWE (bottom), I get a major error - I've copied 
> bits of the log below. Main problem sems to be 'file not found: lualibs
>
>
>
>
> Command Line:   lualatex.exe --shell-escape "lua-mwe.tex"
> Startup Folder: C:\Users\egc\Desktop
>
> This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
>  \write18 enabled.
> (C:/Users/egc/Desktop/lua-mwe.tex
> LaTeX2e <2011/06/27>
> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation patterns 
> for engl
> ish, loaded.
>
> <snip>
> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luaotfload/luaotfload.sty"
> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/luatexbase.sty"
> ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-compat.sty
> ")
> ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-loader.sty
> "
> (C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase.loader.lua)
> ) ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-regs.sty
> ") ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-attr.st
> y"
> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/attr.lua))
> ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-cctb.sty"
> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/cctb.lua))
> ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-mcb.sty"
> ("C:/Program Files (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/luatexbase-modutils.s
> ty"
> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua))
> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/mcb.lua)))
> ! LuaTeX error ... (x86)/MiKTeX 
> 2.9/tex/luatex/luatexbase/modutils.lua:49: modu
> le 'lualibs' not found:
>  no field package.preload['lualibs']
>  [luatexbase.loader] Loading error:
>  C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/lualibs/lualibs.lua:19: 
> '=' expec
> ted near 'default'
>  [kpse C searcher] file not found: 'lualibs'
>  [oberdiek.luatex.kpse_module_loader] Search failed
> stack traceback:
>  [C]: in function 'require'
>  ... (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua:49: in 
> function 'requi
> re_module'
>  <\directlua >:1: in main chunk.
> \lltxb at requirelua ...xluaescapestring {#2}" \fi )}
>
> l.34 \RequireLuaModule
>                       {luaotfload}
> ?
>
> Process has been terminated ...
>
>
>
>
>
> \documentclass[11pt,letterpaper]{article}
>
> \usepackage{fontspec}
> \setmainfont{XITS}
> \usepackage{unicode-math}
>   \setmathfont{Asana Math}
>
> \begin{document}
>
> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
> tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
> venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum quam 
> ut erat rutrum consequat.
>
> \begin{equation}
> \frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
> \end{equation}
>
> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget 
> dolor ac diam interdum volutpat. Cras luctus congue nibh, at dictum 
> nulla iaculis quis.
>
>
> \end{document}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130507/2088fd63/attachment.html>

From evan.cooch at gmail.com  Tue May  7 15:59:23 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Tue, 7 May 2013 09:59:23 -0400
Subject: [luatex] latest luaotfload breaks something...again
In-Reply-To: <51890733.6080906@gmail.com>
References: <5189063D.2070104@gmail.com> <51890733.6080906@gmail.com>
Message-ID: <518908BB.1050907@gmail.com>

Reverted back to previous files in /luatex subdirectory, and everything 
compiles fine. Tried the updates again, and compile failed after the 
updates - so, consistent problem following the updates.


On 5/7/2013 9:52 AM, Evan Cooch wrote:
> Confirmed (in a fashion). When I try to run mkluatexfontdb -V, I now 
> get the following eror:
>
> error loading module lualibs from file C:/blah/blah/blah
>
> tex/lualibs/lualibs.lua c:/pathstuff/luatex/lualibs/lualibs:19: '=' 
> expected near 'default'.
>
> Suggestions?
>
>
> On 5/7/2013 9:48 AM, Evan Cooch wrote:
>> Just an the May 6 update on my MikTeX 2.9 install. When I try to 
>> compile the following MWE (bottom), I get a major error - I've copied 
>> bits of the log below. Main problem sems to be 'file not found: lualibs
>>
>>
>>
>>
>> Command Line:   lualatex.exe --shell-escape "lua-mwe.tex"
>> Startup Folder: C:\Users\egc\Desktop
>>
>> This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
>>  \write18 enabled.
>> (C:/Users/egc/Desktop/lua-mwe.tex
>> LaTeX2e <2011/06/27>
>> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation 
>> patterns for engl
>> ish, loaded.
>>
>> <snip>
>> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luaotfload/luaotfload.sty"
>> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/luatexbase.sty"
>> ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-compat.sty
>> ")
>> ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-loader.sty
>> "
>> (C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase.loader.lua)
>> ) ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-regs.sty
>> ") ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-attr.st
>> y"
>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/attr.lua))
>> ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-cctb.sty"
>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/cctb.lua))
>> ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-mcb.sty"
>> ("C:/Program Files (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/luatexbase-modutils.s
>> ty"
>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua))
>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/mcb.lua)))
>> ! LuaTeX error ... (x86)/MiKTeX 
>> 2.9/tex/luatex/luatexbase/modutils.lua:49: modu
>> le 'lualibs' not found:
>>  no field package.preload['lualibs']
>>  [luatexbase.loader] Loading error:
>>  C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/lualibs/lualibs.lua:19: 
>> '=' expec
>> ted near 'default'
>>  [kpse C searcher] file not found: 'lualibs'
>>  [oberdiek.luatex.kpse_module_loader] Search failed
>> stack traceback:
>>  [C]: in function 'require'
>>  ... (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua:49: in 
>> function 'requi
>> re_module'
>>  <\directlua >:1: in main chunk.
>> \lltxb at requirelua ...xluaescapestring {#2}" \fi )}
>>
>> l.34 \RequireLuaModule
>>                       {luaotfload}
>> ?
>>
>> Process has been terminated ...
>>
>>
>>
>>
>>
>> \documentclass[11pt,letterpaper]{article}
>>
>> \usepackage{fontspec}
>> \setmainfont{XITS}
>> \usepackage{unicode-math}
>>   \setmathfont{Asana Math}
>>
>> \begin{document}
>>
>> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
>> tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
>> venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum 
>> quam ut erat rutrum consequat.
>>
>> \begin{equation}
>> \frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
>> \end{equation}
>>
>> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget 
>> dolor ac diam interdum volutpat. Cras luctus congue nibh, at dictum 
>> nulla iaculis quis.
>>
>>
>> \end{document}
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130507/f424a28d/attachment-0001.html>

From loic.grobol at gmail.com  Tue May  7 16:02:51 2013
From: loic.grobol at gmail.com (=?UTF-8?B?TG/Dr2MgR3JvYm9s?=)
Date: Tue, 7 May 2013 16:02:51 +0200
Subject: [luatex] latest luaotfload breaks something...again
In-Reply-To: <518908BB.1050907@gmail.com>
References: <5189063D.2070104@gmail.com> <51890733.6080906@gmail.com>
 <518908BB.1050907@gmail.com>
Message-ID: <CADtLoSfp3o_5akyPxYjVg0DCpe3_XRV-=eBgd4D9LWpQ-20u1A@mail.gmail.com>

On 7 May 2013 15:59, Evan Cooch <evan.cooch at gmail.com> wrote:
> Reverted back to previous files in /luatex subdirectory, and everything
> compiles fine. Tried the updates again, and compile failed after the updates
> - so, consistent problem following the updates.
>
>
> On 5/7/2013 9:52 AM, Evan Cooch wrote:
>
> Confirmed (in a fashion). When I try to run mkluatexfontdb -V, I now get the
> following eror:
>
> error loading module lualibs from file C:/blah/blah/blah
>
> tex/lualibs/lualibs.lua c:/pathstuff/luatex/lualibs/lualibs:19: '=' expected
> near 'default'.
Similar issue on Linux (Kubuntu x64)

loic at morrigan:~$ mkluatexfontdb -V
/usr/local/texlive/2013/bin/x86_64-linux/mkluatexfontdb:91: module
'lualibs' not found:
        no field package.preload['lualibs']
        [luatexbase.loader] Loading error:
        ...l/texlive/2013/texmf-dist/tex/luatex/lualibs/lualibs.lua:19:
syntax error near 'default'
        [kpse C searcher] file not found: 'lualibs'

--
Lo?c Grobol.


From Philipp.Gesang at alumni.uni-heidelberg.de  Tue May  7 16:03:57 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Tue, 7 May 2013 16:03:57 +0200
Subject: [luatex] latest luaotfload breaks something...again
In-Reply-To: <51890733.6080906@gmail.com>
References: <5189063D.2070104@gmail.com>
 <51890733.6080906@gmail.com>
Message-ID: <20130507140357.GA22250@phlegethon>

???<date: 2013-05-07, Tuesday>???<from: Evan Cooch>???

> Confirmed (in a fashion). When I try to run mkluatexfontdb -V, I now
> get the following eror:
> 
> error loading module lualibs from file C:/blah/blah/blah
> 
> tex/lualibs/lualibs.lua c:/pathstuff/luatex/lualibs/lualibs:19: '='
> expected near 'default'.
> 
> Suggestions?

The lualibs update on Sunday was corrupt. You can either wait
until the new zip reaches ctan or update yourself:

  https://phi-gamma.net/archives/lualibs.zip

Regards
Philipp



> 
> On 5/7/2013 9:48 AM, Evan Cooch wrote:
> >Just an the May 6 update on my MikTeX 2.9 install. When I try to
> >compile the following MWE (bottom), I get a major error - I've
> >copied bits of the log below. Main problem sems to be 'file not
> >found: lualibs
> >
> >
> >
> >
> >Command Line:   lualatex.exe --shell-escape "lua-mwe.tex"
> >Startup Folder: C:\Users\egc\Desktop
> >
> >This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
> > \write18 enabled.
> >(C:/Users/egc/Desktop/lua-mwe.tex
> >LaTeX2e <2011/06/27>
> >LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation
> >patterns for engl
> >ish, loaded.
> >
> ><snip>
> >("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luaotfload/luaotfload.sty"
> >("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/luatexbase.sty"
> >("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-compat.sty
> >")
> >("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-loader.sty
> >"
> >(C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase.loader.lua)
> >) ("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-regs.sty
> >") ("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-attr.st
> >y"
> >(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/attr.lua))
> >("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-cctb.sty"
> >(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/cctb.lua))
> >("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-mcb.sty"
> >("C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/luatexbase-modutils.s
> >ty"
> >(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua))
> >(C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/mcb.lua)))
> >! LuaTeX error ... (x86)/MiKTeX
> >2.9/tex/luatex/luatexbase/modutils.lua:49: modu
> >le 'lualibs' not found:
> > no field package.preload['lualibs']
> > [luatexbase.loader] Loading error:
> > C:/Program Files (x86)/MiKTeX
> >2.9/tex/luatex/lualibs/lualibs.lua:19: '=' expec
> >ted near 'default'
> > [kpse C searcher] file not found: 'lualibs'
> > [oberdiek.luatex.kpse_module_loader] Search failed
> >stack traceback:
> > [C]: in function 'require'
> > ... (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua:49: in
> >function 'requi
> >re_module'
> > <\directlua >:1: in main chunk.
> >\lltxb at requirelua ...xluaescapestring {#2}" \fi )}
> >
> >l.34 \RequireLuaModule
> >                      {luaotfload}
> >?
> >
> >Process has been terminated ...
> >
> >
> >
> >
> >
> >\documentclass[11pt,letterpaper]{article}
> >
> >\usepackage{fontspec}
> >\setmainfont{XITS}
> >\usepackage{unicode-math}
> >  \setmathfont{Asana Math}
> >
> >\begin{document}
> >
> >Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent
> >in tincidunt nulla. Donec quis laoreet est. Aenean vitae est
> >felis, a venenatis magna. Mauris semper bibendum vulputate. Etiam
> >bibendum quam ut erat rutrum consequat.
> >
> >\begin{equation}
> >\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
> >\end{equation}
> >
> >Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi
> >eget dolor ac diam interdum volutpat. Cras luctus congue nibh, at
> >dictum nulla iaculis quis.
> >
> >
> >\end{document}
> 

-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130507/32f179f4/attachment.bin>

From evan.cooch at gmail.com  Tue May  7 16:18:59 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Tue, 7 May 2013 10:18:59 -0400
Subject: [luatex] latest luaotfload breaks something...again
In-Reply-To: <20130507140357.GA22250@phlegethon>
References: <5189063D.2070104@gmail.com> <51890733.6080906@gmail.com>
 <20130507140357.GA22250@phlegethon>
Message-ID: <51890D53.7080708@gmail.com>


Ah - thanks...

On 5/7/2013 10:03 AM, Philipp Gesang wrote:
> ???<date: 2013-05-07, Tuesday>???<from: Evan Cooch>???
>
>> Confirmed (in a fashion). When I try to run mkluatexfontdb -V, I now
>> get the following eror:
>>
>> error loading module lualibs from file C:/blah/blah/blah
>>
>> tex/lualibs/lualibs.lua c:/pathstuff/luatex/lualibs/lualibs:19: '='
>> expected near 'default'.
>>
>> Suggestions?
> The lualibs update on Sunday was corrupt. You can either wait
> until the new zip reaches ctan or update yourself:
>
>    https://phi-gamma.net/archives/lualibs.zip
>
> Regards
> Philipp
>
>
>
>> On 5/7/2013 9:48 AM, Evan Cooch wrote:
>>> Just an the May 6 update on my MikTeX 2.9 install. When I try to
>>> compile the following MWE (bottom), I get a major error - I've
>>> copied bits of the log below. Main problem sems to be 'file not
>>> found: lualibs
>>>
>>>
>>>
>>>
>>> Command Line:   lualatex.exe --shell-escape "lua-mwe.tex"
>>> Startup Folder: C:\Users\egc\Desktop
>>>
>>> This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
>>> \write18 enabled.
>>> (C:/Users/egc/Desktop/lua-mwe.tex
>>> LaTeX2e <2011/06/27>
>>> LuaTeX adaptation of babel <v3.8l-luatex-1.4> and hyphenation
>>> patterns for engl
>>> ish, loaded.
>>>
>>> <snip>
>>> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luaotfload/luaotfload.sty"
>>> ("C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/luatexbase.sty"
>>> ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-compat.sty
>>> ")
>>> ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-loader.sty
>>> "
>>> (C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase.loader.lua)
>>> ) ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-regs.sty
>>> ") ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-attr.st
>>> y"
>>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/attr.lua))
>>> ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-cctb.sty"
>>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/cctb.lua))
>>> ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-mcb.sty"
>>> ("C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/luatexbase-modutils.s
>>> ty"
>>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua))
>>> (C:/Program Files (x86)/MiKTeX 2.9/tex/luatex/luatexbase/mcb.lua)))
>>> ! LuaTeX error ... (x86)/MiKTeX
>>> 2.9/tex/luatex/luatexbase/modutils.lua:49: modu
>>> le 'lualibs' not found:
>>> no field package.preload['lualibs']
>>> [luatexbase.loader] Loading error:
>>> C:/Program Files (x86)/MiKTeX
>>> 2.9/tex/luatex/lualibs/lualibs.lua:19: '=' expec
>>> ted near 'default'
>>> [kpse C searcher] file not found: 'lualibs'
>>> [oberdiek.luatex.kpse_module_loader] Search failed
>>> stack traceback:
>>> [C]: in function 'require'
>>> ... (x86)/MiKTeX 2.9/tex/luatex/luatexbase/modutils.lua:49: in
>>> function 'requi
>>> re_module'
>>> <\directlua >:1: in main chunk.
>>> \lltxb at requirelua ...xluaescapestring {#2}" \fi )}
>>>
>>> l.34 \RequireLuaModule
>>>                       {luaotfload}
>>> ?
>>>
>>> Process has been terminated ...
>>>
>>>
>>>
>>>
>>>
>>> \documentclass[11pt,letterpaper]{article}
>>>
>>> \usepackage{fontspec}
>>> \setmainfont{XITS}
>>> \usepackage{unicode-math}
>>>   \setmathfont{Asana Math}
>>>
>>> \begin{document}
>>>
>>> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent
>>> in tincidunt nulla. Donec quis laoreet est. Aenean vitae est
>>> felis, a venenatis magna. Mauris semper bibendum vulputate. Etiam
>>> bibendum quam ut erat rutrum consequat.
>>>
>>> \begin{equation}
>>> \frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
>>> \end{equation}
>>>
>>> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi
>>> eget dolor ac diam interdum volutpat. Cras luctus congue nibh, at
>>> dictum nulla iaculis quis.
>>>
>>>
>>> \end{document}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130507/8ea2909c/attachment.html>

From evan.cooch at gmail.com  Thu May  9 13:21:51 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 07:21:51 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
Message-ID: <518B86CF.2080008@gmail.com>

So, I waited until this morning to try updating my MikTeX 2.9 system 
(one of them, at least). Various updates dated May 8 (couple of days 
after I'd reported some problems, which were purpotedly related to 
corrupt lualibs).

Now, a simple MWE don't compile, with errors stating that the font db 
can't be found.  Here is the log (or, relevant bits) from a compile of 
nothing more than the following:

\documentclass[11pt,letterpaper]{article}

\usepackage{fontspec}
\setmainfont{XITS}
\usepackage{unicode-math}
    \setmathfont{XITS Math}

\begin{document}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum quam 
ut erat rutrum consequat.

\begin{equation}
\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
\end{equation}

\end{document}



Here are the relevant bits of the error log.


Command Line:   lualatex.exe --shell-escape --enable-write18 
"lualatex-mwe.tex"

This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
  \write18 enabled.
(C:/Users/self/Desktop/lualatex-mwe.tex
LaTeX2e <2011/06/27>
LuaTeX adaptation of babel <v3.8m-luatex-1.5> and hyphenation patterns 
for engl
ish, loaded.
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/article.cls"
Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/size11.clo"))
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.sty"

<lots of basic loads snipped>

(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luaotfload/luaotfload-loaders.lua
)
(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luaotfload/luaotfload-database.lu
a)
(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luaotfload/luaotfload-colors.lua)

(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luaotfload/luaotfload-features.lu
a)
(C:/Program Files (x86)/MiKTeX 
2.9/tex/luatex/luaotfload/luaotfload-auxiliary.l
ua))
(C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.lua)
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec-patches.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/fixltx2e.sty")
*************************************************
* LaTeX warning: "xparse/redefine-command"
*
* Redefining document command \oldstylenums with arg. spec. 'm' on line 128.
*************************************************
) ("C:/Program Files (x86)/MiKTeX 
2.9/tex/latex/fontspec/fontspec-luatex.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/fontenc.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/euenc/eu2enc.def")
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/euenc/eu2lmr.fd")
luaotfload | db: Font names database not found, generating new one.
              This can take several minutes; please be 
patient.lualatex.exe: Unexpected condition.

LuaLaTeX failed to create a pdf file.
For possible explanations start the command from the Command Prompt...


So, when I tried mkluatexfontdb from a cmd prompt, it tells me the 
script isn't found (which is odd, since I used it last night - before 
the updates).


Suggestions?





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130509/fb23dec4/attachment.html>

From evan.cooch at gmail.com  Thu May  9 13:33:46 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 07:33:46 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B86CF.2080008@gmail.com>
References: <518B86CF.2080008@gmail.com>
Message-ID: <518B899A.9040901@gmail.com>


On 5/9/2013 7:21 AM, Evan Cooch wrote:
> So, I waited until this morning to try updating my MikTeX 2.9 system 
> (one of them, at least). Various updates dated May 8 (couple of days 
> after I'd reported some problems, which were purpotedly related to 
> corrupt lualibs).
>

Reverted to versions before todays 'updates' - everything works fine.


Sorry for sounding like a broken record, but this does seem to be 
hapenning with some frequency, at least recently.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130509/371ddc87/attachment.html>

From mojca.miklavec.lists at gmail.com  Thu May  9 13:57:09 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Thu, 9 May 2013 13:57:09 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B899A.9040901@gmail.com>
References: <518B86CF.2080008@gmail.com>
	<518B899A.9040901@gmail.com>
Message-ID: <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>

On Thu, May 9, 2013 at 1:33 PM, Evan Cooch wrote:
>
> On 5/9/2013 7:21 AM, Evan Cooch wrote:
>
>> So, I waited until this morning to try updating my MikTeX 2.9 system (one of
>> them, at least). Various updates dated May 8 (couple of days after I'd
>> reported some problems, which were purpotedly related to corrupt lualibs).
>
> Reverted to versions before todays 'updates' -  everything works fine.
>
> Sorry for sounding like a broken record, but this does seem to be hapenning
> with some frequency, at least recently.

Updates are coordinated with TeX Live team (and W32TeX follows TeX
Live), but they aren't coordinated with Christian Schenk (which I
believe they should). Particularly for the latest luatex & babel
updates (as well as hyph-utf8).

After LuaTeX update in TeX Live, many scripts and packages had to be
adapted to get compliant with lua 5.2. TeX Live is frozen, but without
close coordination the author of MikTeX probably doesn't know what
exactly is going on has to fight with all the problems on his own
which is suboptimal.

Mojca

From evan.cooch at gmail.com  Thu May  9 14:47:57 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 08:47:57 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
Message-ID: <518B9AFD.2030209@gmail.com>

Thanks for the insight. Would the best advice then, for MikTeX users 
be....'don't update anything having to do with lua*'? (Whch as of this 
morning has become a personal memo to self - I've even put a post-it 
note above my monitor to remind me).

Perhaps someone on the dev side of things for lua* should email 
Christian, and let me know (although it is easy enough to broadcast a 
general warning on various discussion boards, it might be better to 
contact the maintainer of MikTeX in the first place).



On 5/9/2013 7:57 AM, Mojca Miklavec wrote:
> On Thu, May 9, 2013 at 1:33 PM, Evan Cooch wrote:
>> On 5/9/2013 7:21 AM, Evan Cooch wrote:
>>
>>> So, I waited until this morning to try updating my MikTeX 2.9 system (one of
>>> them, at least). Various updates dated May 8 (couple of days after I'd
>>> reported some problems, which were purpotedly related to corrupt lualibs).
>> Reverted to versions before todays 'updates' -  everything works fine.
>>
>> Sorry for sounding like a broken record, but this does seem to be hapenning
>> with some frequency, at least recently.
> Updates are coordinated with TeX Live team (and W32TeX follows TeX
> Live), but they aren't coordinated with Christian Schenk (which I
> believe they should). Particularly for the latest luatex & babel
> updates (as well as hyph-utf8).
>
> After LuaTeX update in TeX Live, many scripts and packages had to be
> adapted to get compliant with lua 5.2. TeX Live is frozen, but without
> close coordination the author of MikTeX probably doesn't know what
> exactly is going on has to fight with all the problems on his own
> which is suboptimal.
>
> Mojca
>


From evan.cooch at gmail.com  Thu May  9 14:50:11 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 08:50:11 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B9AFD.2030209@gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com>
Message-ID: <518B9B83.3010905@gmail.com>


> Perhaps someone on the dev side of things for lua* should email 
> Christian, and let me know...

Whoops - I meant, let 'him' (Christian) know...

From reinhard.kotucha at web.de  Thu May  9 14:59:51 2013
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 9 May 2013 14:59:51 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B9B83.3010905@gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
Message-ID: <20875.40391.107925.22707@zaphod.ms25.net>

On 2013-05-09 at 08:50:11 -0400, Evan Cooch wrote:

 > 
 > > Perhaps someone on the dev side of things for lua* should email 
 > > Christian, and let me know...
 > 
 > Whoops - I meant, let 'him' (Christian) know...

Why don't *you* contact him?

  Regards,
    Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From evan.cooch at gmail.com  Thu May  9 15:03:07 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 09:03:07 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <20875.40391.107925.22707@zaphod.ms25.net>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net>
Message-ID: <518B9E8B.2000204@gmail.com>

Simple reason - any note I'd send to Christian would be of the generic 
'There is a problem with various lua* updates", without being able to be 
specific as to what the problems are. Someone more intimately familiar 
with (i) the problems, and (ii) hat the current, canonical files should 
be, would be betterequipped to not only alert Christian, but work with 
him on some fixes (or, some strategies).



On 5/9/2013 8:59 AM, Reinhard Kotucha wrote:
> On 2013-05-09 at 08:50:11 -0400, Evan Cooch wrote:
>
>   >
>   > > Perhaps someone on the dev side of things for lua* should email
>   > > Christian, and let me know...
>   >
>   > Whoops - I meant, let 'him' (Christian) know...
>
> Why don't *you* contact him?
>
>    Regards,
>      Reinhard
>


From Arno.Trautmann at gmx.de  Thu May  9 15:14:30 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Thu, 9 May 2013 15:14:30 +0200
Subject: [luatex] mkluatexfontdb devours memory
Message-ID: <518BA136.8070104@gmx.de>

Hi all,

after some days I tried to compile a basic document with LuaLaTeX today 
but the memory just ran full and nothing happened. Trying only to update 
the font database leads to:

arno at tiger> mkluatexfontdb -vvv

luaotfload | util: setting log level
luaotfload | util: task completed successfully
luaotfload | db: Updating the font names database
luaotfload | db: Font names database not found, generating new one.
              This can take several minutes; please be patient.
luaotfload | db: Updating the font names database
luaotfload | db: Scanning TEXMF fonts...
luaotfload | db: Scanning OS fonts...
luaotfload | db: Searching in static system directories...

Then nothing happens, and I only see how my memory gets full untill the 
full 3+1GB RAM and swap are full. This happens on a linux X86_64 with 
today's updated TeX Live. I'm sorry if this is already reported, I 
didn't have much time to read all the messages about LuaTeX carefully.

cheers
Arno

From elie.roux at telecom-bretagne.eu  Thu May  9 15:19:39 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Thu, 9 May 2013 15:19:39 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B9E8B.2000204@gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
Message-ID: <518BA26B.5080402@telecom-bretagne.eu>

On 09/05/2013 15:03, Evan Cooch wrote:
> Simple reason - any note I'd send to Christian would be of the generic
> 'There is a problem with various lua* updates", without being able to be
> specific as to what the problems are. Someone more intimately familiar
> with (i) the problems, and (ii) hat the current, canonical files should
> be, would be betterequipped to not only alert Christian, but work with
> him on some fixes (or, some strategies).

I'm sorry to say something here while I'm not really involved in the 
whole situation (only the lua* part), but what about an option in MikTeX 
to enable/disable updates while TeXLive is in pretest? For me, in the 
workflow of TeXLive, we are in the pretest version where we are 
experimenting big changes, so it's certainly wise for MikTeX to consider 
this?

Thank you
-- 
Elie

From preining at logic.at  Thu May  9 15:22:05 2013
From: preining at logic.at (Norbert Preining)
Date: Thu, 9 May 2013 22:22:05 +0900
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518B9E8B.2000204@gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
Message-ID: <20130509132205.GB8582@gamma.logic.tuwien.ac.at>

On Do, 09 Mai 2013, Evan Cooch wrote:
> ... not only alert Christian, but work with him on some fixes 

Unfortunately although there have been several attempts in the
past, Christian is not interested in common development and
collaboration.

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------

From Robin.Fairbairns at cl.cam.ac.uk  Thu May  9 15:36:45 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 9 May 2013 14:36:45 +0100
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: Your message of Thu, 09 May 2013 22:22:05 +0900.
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
Message-ID: <7775.1368106605@cl.cam.ac.uk>

Norbert Preining <preining at logic.at> wrote:

> On Do, 09 Mai 2013, Evan Cooch wrote:
> > ... not only alert Christian, but work with him on some fixes 
> 
> Unfortunately although there have been several attempts in the
> past, Christian is not interested in common development and
> collaboration.

it would not surprise me if i learned he reads this list.

i have the impression that he's a 1-person team, and has little time for
any extension of what he does already.

(i met hime once, when he turned up at a meeting on ctan development,
which was on the coat-tails of a dante meeting.  so he has been
interested in collaborative work in the past.)

robin

From evan.cooch at gmail.com  Thu May  9 16:18:34 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 10:18:34 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518BA26B.5080402@telecom-bretagne.eu>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <518BA26B.5080402@telecom-bretagne.eu>
Message-ID: <518BB03A.1000101@gmail.com>


> I'm sorry to say something here while I'm not really involved in the 
> whole situation (only the lua* part), but what about an option in 
> MikTeX to enable/disable updates while TeXLive is in pretest? For me, 
> in the workflow of TeXLive, we are in the pretest version where we are 
> experimenting big changes, so it's certainly wise for MikTeX to 
> consider this?


Beyond that, it would be useful for MikTeX (and other '*TeX distros') to 
let us (users) roll-back updates with the click of a button. perhaps TeX 
Live already lets you do this (can't say - I've been using MikTeX for a 
*long* time). At the moment, I have my own blunt instrument for doing 
this - I have one machine I always leave 'one update behind', which I 
then use as a local repo to pull from in case my other, 'updated' 
machines stop playing nice. This works (more or less), but clearly lacks 
elegance.

From preining at logic.at  Thu May  9 16:29:14 2013
From: preining at logic.at (Norbert Preining)
Date: Thu, 9 May 2013 23:29:14 +0900
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <518BB03A.1000101@gmail.com>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <518BA26B.5080402@telecom-bretagne.eu> <518BB03A.1000101@gmail.com>
Message-ID: <20130509142914.GD8582@gamma.logic.tuwien.ac.at>

On Do, 09 Mai 2013, Evan Cooch wrote:
> let us (users) roll-back updates with the click of a button. perhaps TeX  
> Live already lets you do this (can't say - I've been using MikTeX for a  

tlmgr restore .... even the GUI supports it.

But it depends on whether you have activated backups and how many
are done.

the documentation of tlmgr is your friend

Norbert

------------------------------------------------------------------------
PREINING, Norbert                               http://www.preining.info
JAIST, Japan                                 TeX Live & Debian Developer
DSA: 0x09C5B094   fp: 14DF 2E6C 0307 BE6D AD76  A9C0 D2BF 4AA3 09C5 B094
------------------------------------------------------------------------

From evan.cooch at gmail.com  Thu May  9 16:48:10 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Thu, 9 May 2013 10:48:10 -0400
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <20130509142914.GD8582@gamma.logic.tuwien.ac.at>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <518BA26B.5080402@telecom-bretagne.eu> <518BB03A.1000101@gmail.com>
 <20130509142914.GD8582@gamma.logic.tuwien.ac.at>
Message-ID: <518BB72A.4010404@gmail.com>


On 5/9/2013 10:29 AM, Norbert Preining wrote:
> On Do, 09 Mai 2013, Evan Cooch wrote:
>> let us (users) roll-back updates with the click of a button. perhaps TeX
>> Live already lets you do this (can't say - I've been using MikTeX for a
> tlmgr restore .... even the GUI supports it.
>
> But it depends on whether you have activated backups and how many
> are done.
>
> the documentation of tlmgr is your friend
>


Score one for TeX Live, it would seem. ;-)

Cheers...


From Philipp.Gesang at alumni.uni-heidelberg.de  Thu May  9 17:47:09 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Thu, 9 May 2013 17:47:09 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518BA136.8070104@gmx.de>
References: <518BA136.8070104@gmx.de>
Message-ID: <20130509154709.GA20616@phlegethon>

Hi Arno!

???<date: 2013-05-09, Thursday>???<from: Arno Trautmann>???

> after some days I tried to compile a basic document with LuaLaTeX
> today but the memory just ran full and nothing happened. Trying only
> to update the font database leads to:
> 
> arno at tiger> mkluatexfontdb -vvv
> 
> luaotfload | util: setting log level
> luaotfload | util: task completed successfully
> luaotfload | db: Updating the font names database
> luaotfload | db: Font names database not found, generating new one.
>              This can take several minutes; please be patient.
> luaotfload | db: Updating the font names database
> luaotfload | db: Scanning TEXMF fonts...
> luaotfload | db: Scanning OS fonts...
> luaotfload | db: Searching in static system directories...
> 
> Then nothing happens, and I only see how my memory gets full untill
> the full 3+1GB RAM and swap are full. This happens on a linux X86_64
> with today's updated TeX Live. I'm sorry if this is already
> reported, I didn't have much time to read all the messages about
> LuaTeX carefully.

Could this be due to symlink recursion? Can you paste the output
of

  luaotfload-tool --update --force --verbose=5 --log=stdout

(preferably to some paste site).

Thanks
Philipp


-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130509/4a9154e5/attachment.bin>

From luatex at nililand.de  Thu May  9 17:55:01 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Thu, 9 May 2013 17:55:01 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <518BA26B.5080402@telecom-bretagne.eu>
Message-ID: <qztzfnwgvu14.dlg@nililand.de>

Am Thu, 9 May 2013 15:19:39 +0200 schrieb ?lie Roux:


>> Simple reason - any note I'd send to Christian would be of the generic
>> 'There is a problem with various lua* updates", without being able to be
>> specific as to what the problems are. Someone more intimately familiar
>> with (i) the problems, and (ii) hat the current, canonical files should
>> be, would be betterequipped to not only alert Christian, but work with
>> him on some fixes (or, some strategies).

> I'm sorry to say something here while I'm not really involved in the 
> whole situation (only the lua* part), but what about an option in MikTeX 
> to enable/disable updates while TeXLive is in pretest? For me, in the 
> workflow of TeXLive, we are in the pretest version where we are 
> experimenting big changes, so it's certainly wise for MikTeX to consider  this? 

Imho it is a bit of a problem if the pretest affects CTAN in this
way. It is naturally ok that packages are updated for a new TeXLive
but if problems due to large changes are expected they perhaps
should better be put in some "pretest branch". Not every user expect
packages on CTAN to suddenly switch in a sort of beta modus. 


Beside this Christian would certainly have been willing to keep back
some updates if someone would have notified him (he did it for a
babel update after I told him that it break polyglossia). 

But it could be a bit late now: the first messages are arriving in
some forums about problems. 

I hadn't much time last week and so couldn't get involved but I
think I will be able to look into the problem tomorrow afternoon.
For this it would be really useful if all this various updates were
in some tds-tree somewhere for download. I can attach such trees
easily to my system and so wouldn't have to do a lot of preparation
to keep my main system safe.  

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From cs at miktex.org  Thu May  9 21:16:53 2013
From: cs at miktex.org (Christian Schenk)
Date: Thu, 9 May 2013 21:16:53 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
Message-ID: <518BF625.8020005@miktex.org>




On 5/9/2013 3:22 PM, Norbert Preining wrote:
> On Do, 09 Mai 2013, Evan Cooch wrote:
>> ... not only alert Christian, but work with him on some fixes
>
> Unfortunately although there have been several attempts in the
> past, Christian is not interested in common development and
> collaboration.

Evan has directed me to this list so I have the opportunity to answer.

It's not true that I have no interest in collaboration. But: my current 
workflow is optimized in such a way that it allows me to do the 
packaging (grab stuff from CTAN and make MiKTeX packages) and upgrade 
programs. Collaboration requires a lot of communication (reading and 
writing mails), i.e. it requires (a lot of) time. Since I have a 
full-time job and some time consuming hobbies, there is not much time 
left for TeX related collaboration and/or development (at the moment).

I will subscribe to this list (yet another) and will try my best to hold 
back pre-release stuff in the future.



From elie.roux at telecom-bretagne.eu  Fri May 10 09:14:05 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Fri, 10 May 2013 09:14:05 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <qztzfnwgvu14.dlg@nililand.de>
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <518BA26B.5080402@telecom-bretagne.eu> <qztzfnwgvu14.dlg@nililand.de>
Message-ID: <518C9E3D.2090306@telecom-bretagne.eu>

Dear all,

> Imho it is a bit of a problem if the pretest affects CTAN in this
> way. It is naturally ok that packages are updated for a new TeXLive
> but if problems due to large changes are expected they perhaps
> should better be put in some "pretest branch". Not every user expect
> packages on CTAN to suddenly switch in a sort of beta modus.

This is actually a very interesting discussion. The main point being 
that, according to me, luaotfload is no ordinary package: it should be 
considered as being part of the format, or maybe even the engine. So 
yes, updates changing 2000 lines of code[1] in the format are dangerous 
and should be widely tested by many people before reaching the "stable" 
release. The question is: how do we handle it? For me the pretest period 
of TeXLive is very ok, but should there be a ctan-dev repository? Or a 
miktex-dev? I don't know...

By the way, polyglossia and luaotfload rely on a recent LuaTeX, so it's 
definitely safer to take the same LuaTeX as TeXLive 2013...

Thank you!
-- 
Elie

[1] https://github.com/lualatex/luaotfload/pulse

From luatex at nililand.de  Fri May 10 09:13:59 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 10 May 2013 09:13:59 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org>
Message-ID: <7bv97n9ignqo$.dlg@nililand.de>

Am Thu, 9 May 2013 21:16:53 +0200 schrieb Christian Schenk:


>> Unfortunately although there have been several attempts in the
>> past, Christian is not interested in common development and
>> collaboration.
 
> Evan has directed me to this list so I have the opportunity to answer.
 
> It's not true that I have no interest in collaboration. But: my current 
> workflow is optimized in such a way that it allows me to do the 
> packaging (grab stuff from CTAN and make MiKTeX packages) and upgrade 
> programs. Collaboration requires a lot of communication (reading and 
> writing mails), i.e. it requires (a lot of) time. Since I have a 
> full-time job and some time consuming hobbies, there is not much time 
> left for TeX related collaboration and/or development (at the moment).

> I will subscribe to this list (yet another) and will try my best to hold 
> back pre-release stuff in the future.

On lualatex.devel Philipp Gesang just mentioned that probably the
binary is simply to old for all the changes:

"But judging from your logs your luatex binary is
*really* out of date. There?s even warning:

Module luaotfload warning: LuaTeX v0.70 is old, v0.76 is
recommended."



-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From h_kitagawa2001 at yahoo.co.jp  Fri May 10 12:43:58 2013
From: h_kitagawa2001 at yahoo.co.jp (Hironori KITAGAWA)
Date: Fri, 10 May 2013 19:43:58 +0900
Subject: [luatex] font feature with new luaotfload
Message-ID: <20130510194358.1fac70c911fbc7cbf75c8681@yahoo.co.jp>

Hello,

I tried the following source with TeX Live 2013 pretest.

---
\documentclass{article}
\usepackage{fontspec}
\begin{document}
\fontspec[RawFeature=+pwid]{KozMinPr6N-Regular}
A?B

\fontspec[RawFeature=+fwid]{KozMinPr6N-Regular}
A?B

\end{document}
---

But I got unintentional result from LuaLaTeX with luaotfload v2.2.
In concrete terms, '?' in the second line should be replaced by 
its fullwidth variants CID #668 (as in koz-xetex.pdf), 
but it doesn't so ('?' is not replaced) in koz-luatex.pdf. 


The following patch solve the problem for the time being
(maybe this isn't a good solution):
--- a/luaotfload-merged.lua	2013-05-07 07:01:04.000000000 +0900
+++ b/luaotfload-merged.lua	2013-05-09 16:56:43.081995799 +0900
@@ -5556,6 +5556,7 @@
               if not unicode or unicode==-1 or unicode>=criterium then
                 unicode=cidunicodes[index]
               end
+              if unicode and descriptions[unicode] then unicode=-1 end
               if not unicode or unicode==-1 or unicode>=criterium then
                 if not name then
                   name=format("u%06X",private)

Regards 
Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: koz.tar.gz
Type: application/octet-stream
Size: 9148 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130510/c4ae70ef/attachment.obj>

From Philipp.Gesang at alumni.uni-heidelberg.de  Fri May 10 13:30:09 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 10 May 2013 13:30:09 +0200
Subject: [luatex] font feature with new luaotfload
In-Reply-To: <20130510194358.1fac70c911fbc7cbf75c8681@yahoo.co.jp>
References: <20130510194358.1fac70c911fbc7cbf75c8681@yahoo.co.jp>
Message-ID: <20130510113004.GB2493@phlegethon>

???<date: 2013-05-10, Friday>???<from: Hironori KITAGAWA>???

> I tried the following source with TeX Live 2013 pretest.
> 
> ---
> \documentclass{article}
> \usepackage{fontspec}
> \begin{document}
> \fontspec[RawFeature=+pwid]{KozMinPr6N-Regular}
> A?B
> 
> \fontspec[RawFeature=+fwid]{KozMinPr6N-Regular}
> A?B
> 
> \end{document}
> ---
> 
> But I got unintentional result from LuaLaTeX with luaotfload v2.2.
> In concrete terms, '?' in the second line should be replaced by 
> its fullwidth variants CID #668 (as in koz-xetex.pdf), 
> but it doesn't so ('?' is not replaced) in koz-luatex.pdf. 

Confirmed. This is the code translated to Context:

  \definefontfeature[pwid][mode=node,script=latn,language=dflt,pwid=yes]
  \definefontfeature[fwid][mode=node,script=latn,language=dflt,fwid=yes]
  \starttext
    {\definedfont[file:kozminpr6n_regular.otf*pwid]A?B}
    {\definedfont[file:kozminpr6n_regular.otf*fwid]A?B}
  \stoptext

Below is the patch translated for font-otf.lua.

Best
Philipp



--- font-otf.lua.orig	2013-05-10 13:24:16.252748027 +0200
+++ font-otf.lua	2013-05-10 13:25:00.830697179 +0200
@@ -644,6 +644,9 @@
                             if not unicode or unicode == -1 or unicode >= criterium then
                                 unicode = cidunicodes[index]
                             end
+                            if unicode and descriptions[unicode] then
+                              unicode = -1
+                            end
                             if not unicode or unicode == -1 or unicode >= criterium then
                                 if not name then
                                     name = format("u%06X",private)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130510/cb5b4708/attachment.bin>

From luatex at nililand.de  Fri May 10 18:03:35 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 10 May 2013 18:03:35 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <518B86CF.2080008@gmail.com> <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
Message-ID: <1rmv0tmt0gqac.dlg@nililand.de>

Am Fri, 10 May 2013 09:13:59 +0200 schrieb Ulrike Fischer:


>> I will subscribe to this list (yet another) and will try my best to hold 
>> back pre-release stuff in the future.
 
> On lualatex.devel Philipp Gesang just mentioned that probably the
> binary is simply to old for all the changes:

I made some tests this afternoon. I pulled from the various github
sites lualibs, luatexbase, luaotfload, fontspec. After blacklisting
some fonts I could create a fontname database with texlua
luaotfload-tool.lua. 

But using the fonts failed: At first luaoftload-database use load()
where older lua-versions need loadstring(). And if I correct this
problem I get messages about "invalid field id 9". 

On the whole I would say that the current state of luaotfload & co
is unsuitable for the miktex binary. So miktex should either update
the binary or revert to some older version of all this packages. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From Philipp.Gesang at alumni.uni-heidelberg.de  Fri May 10 18:15:51 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 10 May 2013 18:15:51 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <1rmv0tmt0gqac.dlg@nililand.de>
References: <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net>
 <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
 <1rmv0tmt0gqac.dlg@nililand.de>
Message-ID: <20130510161551.GA7758@phlegethon>

???<Datum: Friday, 10. May 2013>???<Von: Ulrike Fischer>???

> Am Fri, 10 May 2013 09:13:59 +0200 schrieb Ulrike Fischer:
> 
> >> I will subscribe to this list (yet another) and will try my best to hold 
> >> back pre-release stuff in the future.
>  
> > On lualatex.devel Philipp Gesang just mentioned that probably the
> > binary is simply to old for all the changes:
> 
> I made some tests this afternoon. I pulled from the various github
> sites lualibs, luatexbase, luaotfload, fontspec. After blacklisting
> some fonts I could create a fontname database with texlua
> luaotfload-tool.lua. 
> 
> But using the fonts failed: At first luaoftload-database use load()
> where older lua-versions need loadstring(). And if I correct this
> problem I get messages about "invalid field id 9". 

That indicates an outdated luatex. Depending on what you do you
get the same error with e.g. the binary from TL 2012.

> On the whole I would say that the current state of luaotfload & co
> is unsuitable for the miktex binary. So miktex should either update
> the binary or revert to some older version of all this packages. 

Are there packages that don?t work with current Luatex?

Best
Philipp


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130510/44c4eeb5/attachment-0001.bin>

From luatex at nililand.de  Fri May 10 18:32:49 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Fri, 10 May 2013 18:32:49 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <518B899A.9040901@gmail.com>
 <CALBOmsY48WZYLhH+H0JB0pOhTqZb8MwY6gALLOyHTXdSKjh6Zg@mail.gmail.com>
 <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
 <1rmv0tmt0gqac.dlg@nililand.de> <20130510161551.GA7758@phlegethon>
Message-ID: <s94soq4uyqi0$.dlg@nililand.de>

Am Fri, 10 May 2013 18:15:51 +0200 schrieb Philipp Gesang:


>> I made some tests this afternoon. I pulled from the various github
>> sites lualibs, luatexbase, luaotfload, fontspec. After blacklisting
>> some fonts I could create a fontname database with texlua
>> luaotfload-tool.lua. 
>> 
>> But using the fonts failed: At first luaoftload-database use load()
>> where older lua-versions need loadstring(). And if I correct this
>> problem I get messages about "invalid field id 9". 
> 
> That indicates an outdated luatex. Depending on what you do you
> get the same error with e.g. the binary from TL 2012.

Well "outdated" is a bit harsh. After all it is the version which is
also used by a current texlive 2012. 
And the luatex sites claims (or - as the text is quite old - perhaps
better "claimed") that only major updates (x.x0 versions) "are
stable enough to be used for production work". 

Until a few days an update of the binary would have been highly
problematic as a lot of packages didn't work with the newer luatex.
So imho it is not a bad idea to keep a stable system for some time. 

(But it would be useful to have a newer version for tests parallel
to the stable system).

 
>> On the whole I would say that the current state of luaotfload & co
>> is unsuitable for the miktex binary. So miktex should either update
>> the binary or revert to some older version of all this packages. 
 
> Are there packages that don?t work with current Luatex?

Sorry I'm not sure that I understand the question.


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From Arno.Trautmann at gmx.de  Fri May 10 19:04:05 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Fri, 10 May 2013 19:04:05 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <20130509154709.GA20616@phlegethon>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
Message-ID: <518D2885.5040703@gmx.de>

Hi Philipp,

the output of

luaotfload-tool --update --force --verbose=5 --log=stdout

is available under

http://justpaste.it/2lhr

I stopped the program when suddenly the memory ran full. This happend at 
some step, it did not increase steadily during the whole process. Also, 
the CPU was at 100% from that point on. The output doesn't seem to 
report an error, does it?

cheers
Arno

Philipp Gesang wrote:
> Hi Arno!
>
> ???<date: 2013-05-09, Thursday>???<from: Arno Trautmann>???
>
>> after some days I tried to compile a basic document with LuaLaTeX
>> today but the memory just ran full and nothing happened. Trying only
>> to update the font database leads to:
>>
>> arno at tiger> mkluatexfontdb -vvv
>>
>> luaotfload | util: setting log level
>> luaotfload | util: task completed successfully
>> luaotfload | db: Updating the font names database
>> luaotfload | db: Font names database not found, generating new one.
>>               This can take several minutes; please be patient.
>> luaotfload | db: Updating the font names database
>> luaotfload | db: Scanning TEXMF fonts...
>> luaotfload | db: Scanning OS fonts...
>> luaotfload | db: Searching in static system directories...
>>
>> Then nothing happens, and I only see how my memory gets full untill
>> the full 3+1GB RAM and swap are full. This happens on a linux X86_64
>> with today's updated TeX Live. I'm sorry if this is already
>> reported, I didn't have much time to read all the messages about
>> LuaTeX carefully.
>
> Could this be due to symlink recursion? Can you paste the output
> of
>
>    luaotfload-tool --update --force --verbose=5 --log=stdout
>
> (preferably to some paste site).
>
> Thanks
> Philipp
>
>


From Philipp.Gesang at alumni.uni-heidelberg.de  Fri May 10 19:02:45 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 10 May 2013 19:02:45 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <s94soq4uyqi0$.dlg@nililand.de>
References: <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net>
 <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
 <1rmv0tmt0gqac.dlg@nililand.de> <20130510161551.GA7758@phlegethon>
 <s94soq4uyqi0$.dlg@nililand.de>
Message-ID: <20130510170245.GA9868@phlegethon>

???<Datum: Friday, 10. May 2013>???<Von: Ulrike Fischer>???

> Am Fri, 10 May 2013 18:15:51 +0200 schrieb Philipp Gesang:
> 
> 
> >> I made some tests this afternoon. I pulled from the various github
> >> sites lualibs, luatexbase, luaotfload, fontspec. After blacklisting
> >> some fonts I could create a fontname database with texlua
> >> luaotfload-tool.lua. 
> >> 
> >> But using the fonts failed: At first luaoftload-database use load()
> >> where older lua-versions need loadstring(). And if I correct this
> >> problem I get messages about "invalid field id 9". 
> > 
> > That indicates an outdated luatex. Depending on what you do you
> > get the same error with e.g. the binary from TL 2012.
> 
> Well "outdated" is a bit harsh.

Yes, I meant that relative to what the fontloader requires.

>                                 After all it is the version which is
> also used by a current texlive 2012. 

But the next current gets v0.76.

> And the luatex sites claims (or - as the text is quite old - perhaps
> better "claimed") that only major updates (x.x0 versions) "are
> stable enough to be used for production work". 
> 
> Until a few days an update of the binary would have been highly
> problematic as a lot of packages didn't work with the newer luatex.
> So imho it is not a bad idea to keep a stable system for some time. 
> 
> (But it would be useful to have a newer version for tests parallel
> to the stable system).
> 
>  
> >> On the whole I would say that the current state of luaotfload & co
> >> is unsuitable for the miktex binary. So miktex should either update
> >> the binary or revert to some older version of all this packages. 
>  
> > Are there packages that don?t work with current Luatex?
> 
> Sorry I'm not sure that I understand the question.

Which packages prohibit using a newer binary because they break
with current luatex? There are fallbacks for all sorts of things.

Best
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130510/55ee6fdf/attachment.bin>

From Robin.Fairbairns at cl.cam.ac.uk  Fri May 10 20:27:20 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Fri, 10 May 2013 19:27:20 +0100
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: Your message of Fri, 10 May 2013 18:32:49 +0200.
 <s94soq4uyqi0$.dlg@nililand.de>
Message-ID: <22104.1368210440@cl.cam.ac.uk>

Ulrike Fischer <luatex at nililand.de> wrote:

> Am Fri, 10 May 2013 18:15:51 +0200 schrieb Philipp Gesang:
> 
> >> I made some tests this afternoon. I pulled from the various github
> >> sites lualibs, luatexbase, luaotfload, fontspec. After blacklisting
> >> some fonts I could create a fontname database with texlua
> >> luaotfload-tool.lua. 
> >> 
> >> But using the fonts failed: At first luaoftload-database use load()
> >> where older lua-versions need loadstring(). And if I correct this
> >> problem I get messages about "invalid field id 9". 
> > 
> > That indicates an outdated luatex. Depending on what you do you
> > get the same error with e.g. the binary from TL 2012.
> 
> Well "outdated" is a bit harsh. After all it is the version which is
> also used by a current texlive 2012. 

outdated with respect to the testing environment, i suppose.

> And the luatex sites claims (or - as the text is quite old - perhaps
> better "claimed") that only major updates (x.x0 versions) "are
> stable enough to be used for production work". 

one man's minor update is another's game breaker; i wouldn't criticise
the luatex team, here.

> Until a few days an update of the binary would have been highly
> problematic as a lot of packages didn't work with the newer luatex.
> So imho it is not a bad idea to keep a stable system for some time. 
> 
> (But it would be useful to have a newer version for tests parallel
> to the stable system).

there seemed to me to be a coherent structure, of a tex live "testing"
repository against which "interested experts" could perform
experiments.  this seems to have gone rather severely off the rails, for
a number of reasons ... not least that the ctan team has been merrily
updating luatex-related packages on the archive, as they were supplied
to us.  i don't know what would have been best, but it's clearly an item
for discussion of "next time".

so, the process needs to be rethought for another year.  for now, i
would claim that those involved should try to make the best of a bad
job; proposals for a better process for next year would be useful, but
we can surely now take the failures of process "as read", and plough on
with the actual work the testing version is there for.

robin

From elie.roux at telecom-bretagne.eu  Sat May 11 10:52:10 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Sat, 11 May 2013 10:52:10 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518D2885.5040703@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de>
Message-ID: <518E06BA.5090400@telecom-bretagne.eu>

Hi,

> the output of
>
> luaotfload-tool --update --force --verbose=5 --log=stdout
>
> is available under
>
> http://justpaste.it/2lhr
>
> I stopped the program when suddenly the memory ran full. This happend at
> some step, it did not increase steadily during the whole process. Also,
> the CPU was at 100% from that point on. The output doesn't seem to
> report an error, does it?

It doesn't seem to report any error. I've run a valgrind on luatex with 
the attached simple test file calling fontloader.info(); it seems to 
have a memleak of about 80kb+(2kb per font). It's not nothing, but 2kb 
times your 7400 fonts is about 15Mb, we're far from 3Gb... This doesn't 
seem very easy to debug, but I'll continue to make tests about this... 
Maybe you could run dbg or valgrind to see what's happening? (you'll 
have to build luatex from sources if you want to follow this way, but 
it's fairly easy).

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: toto.lua
Type: text/x-lua
Size: 111 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/b967a40c/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: valgrind-report.log
Type: text/x-log
Size: 17589 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/b967a40c/attachment-0003.bin>

From luatex at nililand.de  Sat May 11 11:21:19 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Sat, 11 May 2013 11:21:19 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <s94soq4uyqi0$.dlg@nililand.de> <22104.1368210440@cl.cam.ac.uk>
Message-ID: <yf2tzw8n5n39$.dlg@nililand.de>

Am Fri, 10 May 2013 19:27:20 +0100 schrieb Robin Fairbairns:

> 
>> And the luatex sites claims (or - as the text is quite old - perhaps
>> better "claimed") that only major updates (x.x0 versions) "are
>> stable enough to be used for production work". 
> 
> one man's minor update is another's game breaker; i wouldn't criticise
> the luatex team, here.

It wasn't meant as critic. It only explains why miktex didn't rush
to update to 0.75 or 0.76.

> 
>> Until a few days an update of the binary would have been highly
>> problematic as a lot of packages didn't work with the newer luatex.
>> So imho it is not a bad idea to keep a stable system for some time. 
>> 
>> (But it would be useful to have a newer version for tests parallel
>> to the stable system).
> 
> there seemed to me to be a coherent structure, of a tex live "testing"
> repository against which "interested experts" could perform
> experiments.  this seems to have gone rather severely off the rails, for
> a number of reasons ... not least that the ctan team has been merrily
> updating luatex-related packages on the archive, as they were supplied
> to us.  i don't know what would have been best, but it's clearly an item
> for discussion of "next time".
> 
> so, the process needs to be rethought for another year.  for now, i
> would claim that those involved should try to make the best of a bad
> job; proposals for a better process for next year would be useful, but
> we can surely now take the failures of process "as read", and plough on
> with the actual work the testing version is there for.

Actually I'm quite happy currently: something is happening with
lualatex/luaotfload. The changes and the work currently done by
various people - even if they mean that one has to struggle a bit to
get everything working again - made me quite optimistic regarding
the future of lualatex. I don't mind problems if I can see a way to
solve them. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From Arno.Trautmann at gmx.de  Sat May 11 11:25:02 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 11:25:02 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E06BA.5090400@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
Message-ID: <518E0E6E.3060703@gmx.de>

Hi,

?lie Roux wrote:
> Hi,
>
>> the output of
>>
>> luaotfload-tool --update --force --verbose=5 --log=stdout
>>
>> is available under
>>
>> http://justpaste.it/2lhr
>>
>> I stopped the program when suddenly the memory ran full. This happend at
>> some step, it did not increase steadily during the whole process. Also,
>> the CPU was at 100% from that point on. The output doesn't seem to
>> report an error, does it?
>
> It doesn't seem to report any error. I've run a valgrind on luatex with
> the attached simple test file calling fontloader.info(); it seems to
> have a memleak of about 80kb+(2kb per font). It's not nothing, but 2kb
> times your 7400 fonts is about 15Mb, we're far from 3Gb... This doesn't
> seem very easy to debug, but I'll continue to make tests about this...
> Maybe you could run dbg or valgrind to see what's happening? (you'll
> have to build luatex from sources if you want to follow this way, but
> it's fairly easy).

I'll happily do this, but unfortunately I don't even know what you are 
talking about ?
So far I've never built luatex from source, I don't know what dbg is and 
I've never heard of valgrind ? is this something that can be done by a 
few lines of input that you can offer me or do I have to dig into 
building luatex? (If so, I'll try to, but it may take some time ?)

cheers
Arno

From Arno.Trautmann at gmx.de  Sat May 11 12:03:36 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 12:03:36 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E0E6E.3060703@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de>
Message-ID: <518E1778.2050704@gmx.de>

Hi all,

besides possible problems, I could work for now if the OS's fonts would 
not be loaded. Is it possible to blacklist a whole directory? In the 
documentation I only found blacklisting of single files.

cheers
Arno

Arno Trautmann wrote:
> Hi,
>
> ?lie Roux wrote:
>> Hi,
>>
>>> the output of
>>>
>>> luaotfload-tool --update --force --verbose=5 --log=stdout
>>>
>>> is available under
>>>
>>> http://justpaste.it/2lhr
>>>
>>> I stopped the program when suddenly the memory ran full. This happend at
>>> some step, it did not increase steadily during the whole process. Also,
>>> the CPU was at 100% from that point on. The output doesn't seem to
>>> report an error, does it?
>>
>> It doesn't seem to report any error. I've run a valgrind on luatex with
>> the attached simple test file calling fontloader.info(); it seems to
>> have a memleak of about 80kb+(2kb per font). It's not nothing, but 2kb
>> times your 7400 fonts is about 15Mb, we're far from 3Gb... This doesn't
>> seem very easy to debug, but I'll continue to make tests about this...
>> Maybe you could run dbg or valgrind to see what's happening? (you'll
>> have to build luatex from sources if you want to follow this way, but
>> it's fairly easy).
>
> I'll happily do this, but unfortunately I don't even know what you are
> talking about ?
> So far I've never built luatex from source, I don't know what dbg is and
> I've never heard of valgrind ? is this something that can be done by a
> few lines of input that you can offer me or do I have to dig into
> building luatex? (If so, I'll try to, but it may take some time ?)
>
> cheers
> Arno
>


From elie.roux at telecom-bretagne.eu  Sat May 11 12:08:09 2013
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Sat, 11 May 2013 12:08:09 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E0E6E.3060703@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de>
Message-ID: <518E1889.70408@telecom-bretagne.eu>

 >
> I'll happily do this, but unfortunately I don't even know what you are
> talking about ?
> So far I've never built luatex from source, I don't know what dbg is and
> I've never heard of valgrind ? is this something that can be done by a
> few lines of input that you can offer me or do I have to dig into
> building luatex? (If so, I'll try to, but it may take some time ?)

It's not simple, but it's not complex neither:

First install some packages:

sudo aptitude install build-essential autopoint subversion gdb valgrind

I don't think some are missing, but it's not easy to test...

svn co https://foundry.supelec.fr/svn/luatex/trunk
cd trunk
./build.sh --debug --make

Here it might output errors, if it does it means you should install more 
packages, please tell me the errors if there are some.

sudo cp /usr/bin/luatex /usr/bin/luatex-old
sudo cp build/texk/web2c/luatex /usr/bin/luatex
fmtutil --byengine luatex

then go in the directory where luaotfload-tool.lua is, run

kpsewhich luaotfload-tool.lua

to know it.

Then run

valgrind -v --leak-check=full texlua luaotfload-tool.lua 2>report.log

And see how it goes... It should create a report.log file with things 
you can paste us... If it's just never ending, then it's a dead end, and 
I'm not sure I can teach you C debugging with gdb in this email... If 
it's a dead end, I could try directly on your machine if you have a ssh 
access (meaning a public IP address) or teamviewer (works fine for Linux).

Please tell me how it goes!
-- 
Elie

From Arno.Trautmann at gmx.de  Sat May 11 12:41:14 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 12:41:14 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E1889.70408@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
Message-ID: <518E204A.70706@gmx.de>

?lie Roux wrote:
>  >
>> I'll happily do this, but unfortunately I don't even know what you are
>> talking about ?
>> So far I've never built luatex from source, I don't know what dbg is and
>> I've never heard of valgrind ? is this something that can be done by a
>> few lines of input that you can offer me or do I have to dig into
>> building luatex? (If so, I'll try to, but it may take some time ?)
>
> It's not simple, but it's not complex neither:
>
> First install some packages:
>
> sudo aptitude install build-essential autopoint subversion gdb valgrind
>
> I don't think some are missing, but it's not easy to test...
>
> svn co https://foundry.supelec.fr/svn/luatex/trunk
> cd trunk
> ./build.sh --debug --make
>
> Here it might output errors, if it does it means you should install more
> packages, please tell me the errors if there are some.

Surprisingly, this worked on my totally broken Arch Linux so far ? I get 
no error messages, seems to be fine.

> sudo cp /usr/bin/luatex /usr/bin/luatex-old
> sudo cp build/texk/web2c/luatex /usr/bin/luatex
> fmtutil --byengine luatex

But this does not work, the .ini files are not found:

[130] arno at tiger> fmtutil --byengine luatex

fmtutil: running `luatex -ini   -jobname=dvilualatex 
-progname=dvilualatex dvilualatex.ini' ...
This is LuaTeX, Version beta-0.77.0-2013051112 (rev 4635)  (INITEX)
! I can't find file `dvilualatex.ini'.
<*> dvilualatex.ini

Please type another input file name:
! Emergency stop.
<*> dvilualatex.ini

This comes for all luatex-based formats. The .ini files and bins are 
located at

/home/texlive2013/texmf-dist/tex/plain/config/luatex.ini
/home/texlive2013/bin/x86_64-linux/luatex

Is this a problem? Everything is owned by arno, not by root. Calling 
luatex reports v0.77, so it is found correctly.

Not related to the original problem, but something definitely is wrong 
here ?

cheers
Arno

From elie.roux at telecom-bretagne.eu  Sat May 11 14:04:04 2013
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Sat, 11 May 2013 14:04:04 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E204A.70706@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de>
Message-ID: <518E33B4.2010804@telecom-bretagne.eu>

> [130] arno at tiger> fmtutil --byengine luatex
>
> fmtutil: running `luatex -ini -jobname=dvilualatex -progname=dvilualatex
> dvilualatex.ini' ...
> This is LuaTeX, Version beta-0.77.0-2013051112 (rev 4635) (INITEX)
> ! I can't find file `dvilualatex.ini'.
> <*> dvilualatex.ini

That's interesting... I indeed wouldn't have expected errors here... 
what about

sudo fmtutil-sys --byengine luatex

?
-- 
Elie

From Philipp.Gesang at alumni.uni-heidelberg.de  Sat May 11 14:16:11 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sat, 11 May 2013 14:16:11 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518D2885.5040703@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de>
Message-ID: <20130511121611.GA15329@phlegethon>

Arno, ?lie,

???<date: 2013-05-10, Friday>???<from: Arno Trautmann>???

> the output of
> 
> luaotfload-tool --update --force --verbose=5 --log=stdout

Fyi I just added a --dry-run option to luaotfload-tool that skips
the actual loading part. This can help distinguishing issues
pertaining to the file system from those caused by the font
loader.

> is available under
> 
> http://justpaste.it/2lhr

Looks good to me. I can?t help here.

Best
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/4f553790/attachment.bin>

From Arno.Trautmann at gmx.de  Sat May 11 14:20:43 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 14:20:43 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E33B4.2010804@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
Message-ID: <518E379B.3060605@gmx.de>

?lie Roux wrote:
>> [130] arno at tiger> fmtutil --byengine luatex
>>
>> fmtutil: running `luatex -ini -jobname=dvilualatex -progname=dvilualatex
>> dvilualatex.ini' ...
>> This is LuaTeX, Version beta-0.77.0-2013051112 (rev 4635) (INITEX)
>> ! I can't find file `dvilualatex.ini'.
>> <*> dvilualatex.ini
>
> That's interesting... I indeed wouldn't have expected errors here...
> what about
>
> sudo fmtutil-sys --byengine luatex

Runs fine for the TeX Live binary, but same errors when using my 0.77 
build. Did I miss some step in the build process? Do I have to specify 
paths anywhere?

cheers
Arno

From elie.roux at telecom-bretagne.eu  Sat May 11 14:33:49 2013
From: elie.roux at telecom-bretagne.eu (=?windows-1252?Q?=C9lie_Roux?=)
Date: Sat, 11 May 2013 14:33:49 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E379B.3060605@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de>
Message-ID: <518E3AAD.8060106@telecom-bretagne.eu>

>> sudo fmtutil-sys --byengine luatex
>
> Runs fine for the TeX Live binary, but same errors when using my 0.77
> build. Did I miss some step in the build process? Do I have to specify
> paths anywhere?

No... I just tried with latest svn version, it works here too... this is 
really strange...

I have to say I really don't understand... can you try

kpsewhich --progname luatex dvilualatex.ini

?

I have to say I'm stuck... does someone on the list have an idea?

Thank you,
-- 
Elie

From ismo.toijala at gmail.com  Sat May 11 14:40:24 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 14:40:24 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E3AAD.8060106@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
Message-ID: <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>

Hello,

On Sat, May 11, 2013 at 2:33 PM, ?lie Roux
<elie.roux at telecom-bretagne.eu> wrote:
>>> sudo fmtutil-sys --byengine luatex
>>
>> Runs fine for the TeX Live binary, but same errors when using my 0.77
>> build. Did I miss some step in the build process? Do I have to specify
>> paths anywhere?
>
> I have to say I'm stuck... does someone on the list have an idea?

I also run Arch Linux and ran into this problem when testing svn
versions of LuaTeX. Are you sure that you copied the binary into
/usr/bin? This is essential because TeXLive is setup to find the texmf
trees relative to the location of the binary. ?lie did include this
step, but you may have missed it due to its unintuitive nature.

Another possibility is to change the configuration in
/etc/texmf/web2c/texmf.conf to use absolute paths. I believe this
should also work.

I hope this helps

Ismo


From Arno.Trautmann at gmx.de  Sat May 11 14:45:50 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 14:45:50 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E3AAD.8060106@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
Message-ID: <518E3D7E.5000902@gmx.de>

?lie Roux wrote:
>>> sudo fmtutil-sys --byengine luatex
>>
>> Runs fine for the TeX Live binary, but same errors when using my 0.77
>> build. Did I miss some step in the build process? Do I have to specify
>> paths anywhere?
>
> No... I just tried with latest svn version, it works here too... this is
> really strange...
>
> I have to say I really don't understand... can you try
>
> kpsewhich --progname luatex dvilualatex.ini

results in:

/home/texlive2013/texmf-dist/tex/latex/latexconfig/dvilualatex.ini

Maybe the version of fmtutil is interesting?

fmtutil version $Id: fmtutil.sh 30365 2013-05-10 06:53:44Z peter $

Thank you for investigating this!

cheers
Arno

From Arno.Trautmann at gmx.de  Sat May 11 14:50:44 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 14:50:44 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
Message-ID: <518E3EA4.6030103@gmx.de>

Ismo Toijala wrote:
> On Sat, May 11, 2013 at 2:33 PM, ?lie Roux
> <elie.roux at telecom-bretagne.eu> wrote:
>>>> sudo fmtutil-sys --byengine luatex
>>>
>>> Runs fine for the TeX Live binary, but same errors when using my 0.77
>>> build. Did I miss some step in the build process? Do I have to specify
>>> paths anywhere?
>>
>> I have to say I'm stuck... does someone on the list have an idea?
>
> I also run Arch Linux and ran into this problem when testing svn
> versions of LuaTeX. Are you sure that you copied the binary into
> /usr/bin?

no, it is at

/home/texlive2013/bin/x86_64-linux/luatex

where all other binaries are. This works fine for the old luatex, also 
the PATH is set to this place.

> This is essential because TeXLive is setup to find the texmf
> trees relative to the location of the binary. ?lie did include this
> step, but you may have missed it due to its unintuitive nature.

Well, I just replaced the working luatex binary by the one I built. If 
it worked for the the old one, it should be fine for the new one, too, no?

> Another possibility is to change the configuration in
> /etc/texmf/web2c/texmf.conf to use absolute paths. I believe this
> should also work.

It's called texmf.cnf here, but I guess that was a typo. What exactly 
should I adapt here?

cheers
Arno

From elie.roux at telecom-bretagne.eu  Sat May 11 15:00:51 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 15:00:51 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E3EA4.6030103@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
Message-ID: <518E4103.2040307@telecom-bretagne.eu>

> Well, I just replaced the working luatex binary by the one I built. If
> it worked for the the old one, it should be fine for the new one, too, no?

Hmmm, maybe not... I have to say I've never dug into that, but it might 
not, no...

> It's called texmf.cnf here, but I guess that was a typo. What exactly
> should I adapt here?

You should adapt these variables, with the good absolute path values 
(not mine)

TEXMFMAIN = /usr/share/texmf
TEXMFDIST = /usr/share/texmf-texlive
TEXMFLOCAL = /usr/local/share/texmf
TEXMFSYSVAR = /var/lib/texmf
TEXMFSYSCONFIG = /etc/texmf

I think it should be enough...
-- 
Elie

From ismo.toijala at gmail.com  Sat May 11 15:01:55 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 15:01:55 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E3EA4.6030103@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
Message-ID: <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>

>> I also run Arch Linux and ran into this problem when testing svn
>> versions of LuaTeX. Are you sure that you copied the binary into
>> /usr/bin?
>
>
> no, it is at
>
> /home/texlive2013/bin/x86_64-linux/luatex
>
> where all other binaries are. This works fine for the old luatex, also the
> PATH is set to this place.

You're right, I realized after posting that you are not using the Arch packages.

My setup is very similar, except my TeXLive is in ~/.texlive/2013

> Well, I just replaced the working luatex binary by the one I built. If it
> worked for the the old one, it should be fine for the new one, too, no?

I just tested this myself and ran into exactly the same problem.
I compiled LuaTeX from the newest svn sources and copied it to bin/x86_64-linux.

> It's called texmf.cnf here, but I guess that was a typo. What exactly should
> I adapt here?

Yes, a typo.

I tried changing TEXMFROOT to an absolute path. It still doesnt't work.

If I don't copy the binary to the right place, it complains that it
cannot find temf.cnf. This means that the file is found when the
binary in in the right place.

Ismo

From ismo.toijala at gmail.com  Sat May 11 15:11:28 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 15:11:28 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
Message-ID: <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>

It seems that the problem is even worse:

$ luatex -ini  -jobname=luatex -progname=luatex
~/.texlive/2013/texmf-dist/tex/plain/config/luatex.ini
This is LuaTeX, Version beta-0.77.0-2013051114 (rev 4635)  (INITEX)
! I can't find file `/home/ismo/.texlive/2013/texmf-dist/tex/plain/config/luatex
.ini'.
<*> ...ve/2013/texmf-dist/tex/plain/config/luatex.ini

Please type another input file name:

Giving LuaTeX an absolute path is not helping.

I also tried

$ touch a.tex
$ luatex -ini a.tex

It also does not find the file a.tex.

From elie.roux at telecom-bretagne.eu  Sat May 11 15:22:01 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 15:22:01 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
Message-ID: <518E45F9.6060303@telecom-bretagne.eu>

On 11/05/2013 15:11, Ismo Toijala wrote:
> It seems that the problem is even worse:
>
> $ luatex -ini  -jobname=luatex -progname=luatex
> ~/.texlive/2013/texmf-dist/tex/plain/config/luatex.ini
> This is LuaTeX, Version beta-0.77.0-2013051114 (rev 4635)  (INITEX)
> ! I can't find file `/home/ismo/.texlive/2013/texmf-dist/tex/plain/config/luatex
> .ini'.
> <*>  ...ve/2013/texmf-dist/tex/plain/config/luatex.ini
>
> Please type another input file name:
>
> Giving LuaTeX an absolute path is not helping.
>
> I also tried
>
> $ touch a.tex
> $ luatex -ini a.tex
>
> It also does not find the file a.tex.

Hmm, I have to say this is getting even worse... the main problem being 
that it does work on my system... can you try with the option

-kpathsea-debug -1

(or 2047 or so) to luatex?

Thank you,
-- 
Elie

From Arno.Trautmann at gmx.de  Sat May 11 15:40:01 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 15:40:01 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E45F9.6060303@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu>
Message-ID: <518E4A31.1000508@gmx.de>

?lie Roux wrote:
> On 11/05/2013 15:11, Ismo Toijala wrote:
>> It seems that the problem is even worse:
>>
>> $ luatex -ini  -jobname=luatex -progname=luatex
>> ~/.texlive/2013/texmf-dist/tex/plain/config/luatex.ini
>> This is LuaTeX, Version beta-0.77.0-2013051114 (rev 4635)  (INITEX)
>> ! I can't find file
>> `/home/ismo/.texlive/2013/texmf-dist/tex/plain/config/luatex
>> .ini'.
>> <*>  ...ve/2013/texmf-dist/tex/plain/config/luatex.ini
>>
>> Please type another input file name:
>>
>> Giving LuaTeX an absolute path is not helping.
>>
>> I also tried
>>
>> $ touch a.tex
>> $ luatex -ini a.tex
>>
>> It also does not find the file a.tex.
>
> Hmm, I have to say this is getting even worse... the main problem being
> that it does work on my system... can you try with the option
>
> -kpathsea-debug -1
>
> (or 2047 or so) to luatex?

That gives the output here:

http://justpaste.it/2loi

I cannot interpret it, sorry ?

cheers
Arno

From Philipp.Gesang at alumni.uni-heidelberg.de  Sat May 11 15:51:08 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sat, 11 May 2013 15:51:08 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E204A.70706@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de>
Message-ID: <20130511135108.GB15329@phlegethon>

???<date: 2013-05-11, Saturday>???<from: Arno Trautmann>???

> ?lie Roux wrote:
> > >
> >>I'll happily do this, but unfortunately I don't even know what you are
> >>talking about ?
> >>So far I've never built luatex from source, I don't know what dbg is and
> >>I've never heard of valgrind ? is this something that can be done by a
> >>few lines of input that you can offer me or do I have to dig into
> >>building luatex? (If so, I'll try to, but it may take some time ?)
> >
> >It's not simple, but it's not complex neither:
> >
> >First install some packages:
> >
> >sudo aptitude install build-essential autopoint subversion gdb valgrind
> >
> >I don't think some are missing, but it's not easy to test...
> >
> >svn co https://foundry.supelec.fr/svn/luatex/trunk
> >cd trunk
> >./build.sh --debug --make
> >
> >Here it might output errors, if it does it means you should install more
> >packages, please tell me the errors if there are some.
> 
> Surprisingly, this worked on my totally broken Arch Linux so far ? I
> get no error messages, seems to be fine.
> 
> >sudo cp /usr/bin/luatex /usr/bin/luatex-old
> >sudo cp build/texk/web2c/luatex /usr/bin/luatex
> >fmtutil --byengine luatex
> 
> But this does not work, the .ini files are not found:
> 
> [130] arno at tiger> fmtutil --byengine luatex
> 
> fmtutil: running `luatex -ini   -jobname=dvilualatex
> -progname=dvilualatex dvilualatex.ini' ...
> This is LuaTeX, Version beta-0.77.0-2013051112 (rev 4635)  (INITEX)
> ! I can't find file `dvilualatex.ini'.
> <*> dvilualatex.ini
> 
> Please type another input file name:
> ! Emergency stop.
> <*> dvilualatex.ini
> 
> This comes for all luatex-based formats. The .ini files and bins are
> located at
> 
> /home/texlive2013/texmf-dist/tex/plain/config/luatex.ini
> /home/texlive2013/bin/x86_64-linux/luatex
> 
> Is this a problem? Everything is owned by arno, not by root. Calling
> luatex reports v0.77, so it is found correctly.
> 
> Not related to the original problem, but something definitely is
> wrong here ?

Confirmed. I have the same problem with svn revision 4635 on x64
Arch. The TL binary is revision 4627, maybe do a debug build of
that one?

Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/875a0e0f/attachment.bin>

From ismo.toijala at gmail.com  Sat May 11 15:56:41 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 15:56:41 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <20130511135108.GB15329@phlegethon>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <20130511135108.GB15329@phlegethon>
Message-ID: <CAPd6TP3DYBZc46-CTbOTMmmUJLz=UHf2PGPQq5EW2Cd=7S4eOA@mail.gmail.com>

> Confirmed. I have the same problem with svn revision 4635 on x64
> Arch. The TL binary is revision 4627, maybe do a debug build of
> that one?

This used to work with revision 4633, which I used to debug a
different problem. This resulted in the next revision 4635, which is
the latest.

Back then, I was combining the self-compiled luatex with TL2012 from
the Arch Linux packages by copying into /usr/bin.

This means that the problem is not with the code in luatex but with
something else in TL2013.

I am now going to test compiling the code from TL svn and not luatex svn.

Ismo

From elie.roux at telecom-bretagne.eu  Sat May 11 16:11:32 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 16:11:32 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E4A31.1000508@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu> <518E4A31.1000508@gmx.de>
Message-ID: <518E5194.9060304@telecom-bretagne.eu>

>
> That gives the output here:
>
> http://justpaste.it/2loi
>
> I cannot interpret it, sorry ?

Well, curiously, it says almost nothing at all...

On 11/05/2013 15:51, Philipp Gesang wrote:
 > Confirmed. I have the same problem with svn revision 4635 on x64
 > Arch. The TL binary is revision 4627, maybe do a debug build of
 > that one?

There have been modifications in the TeXLive binary that haven't reached 
LuaTeX svn yet. Anyway, this would be interesting to do the same test: 
in the svn directory do

svn up -r 4627
./build.sh --make --debug

and try to copy the binary instead of the other?

On 11/05/2013 15:56, Ismo Toijala wrote:
 > This used to work with revision 4633, which I used to debug a
 > different problem. This resulted in the next revision 4635, which is
 > the latest.
 >
 > Back then, I was combining the self-compiled luatex with TL2012 from
 > the Arch Linux packages by copying into /usr/bin.
 >
 > This means that the problem is not with the code in luatex but with
 > something else in TL2013.
 >
 > I am now going to test compiling the code from TL svn and not luatex 
 > svn.

Interesting...

By the way, Arno, can you try reverting to the old binary, rebuild the 
formats and try the next step (with valgrind)?

Thanks,
-- 
Elie

From elie.roux at telecom-bretagne.eu  Sat May 11 16:17:09 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 16:17:09 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E5194.9060304@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu> <518E4A31.1000508@gmx.de>
 <518E5194.9060304@telecom-bretagne.eu>
Message-ID: <518E52E5.1080704@telecom-bretagne.eu>

On 11/05/2013 16:11, ?lie Roux wrote:
>>
>> That gives the output here:
>>
>> http://justpaste.it/2loi
>>
>> I cannot interpret it, sorry ?
>
> Well, curiously, it says almost nothing at all...

Sorry, I misread, can you try with

luatex -ini -kpathsea-debug -1 -jobname=luatex -progname=luatex luatex.ini

?

Thanks,
-- 
Elie

From ismo.toijala at gmail.com  Sat May 11 16:22:29 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 16:22:29 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E52E5.1080704@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu> <518E4A31.1000508@gmx.de>
 <518E5194.9060304@telecom-bretagne.eu> <518E52E5.1080704@telecom-bretagne.eu>
Message-ID: <CAPd6TP10YkX2YHjViNgXKOMNZU+8hajSMCcRB0KOPO7cum0YOg@mail.gmail.com>

> Sorry, I misread, can you try with
>
> luatex -ini -kpathsea-debug -1 -jobname=luatex -progname=luatex luatex.ini

For me:

$ luatex -ini -kpathsea-debug -1 -jobname=luatex -progname=luatex luatex.ini
kdebug:Search path for cnf files (from compile-time paths.h)
kdebug:  = /home/ismo/.local/texlive/2013/bin/x86_64-linux:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf/web2c:/home/ismo/.local/texlive/2013/bin:/home/ismo/.local/texlive/2013/bin/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/texmf/web2c:/home/ismo/.local/texlive/2013/../texmf-local/web2c:/home/ismo/.local/texlive/2013:/home/ismo/.local/texlive/2013/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/share/texmf/web2c:/home/ismo/.local/texlive/2013/texmf-local/web2c:/home/ismo/.local/texlive/2013/texmf/web2c
kdebug:  before expansion =
{$SELFAUTOLOC,$SELFAUTOLOC/share/texmf-local/web2c,$SELFAUTOLOC/share/texmf/web2c,$SELFAUTOLOC/texmf-local/web2c,$SELFAUTOLOC/texmf/web2c,$SELFAUTODIR,$SELFAUTODIR/share/texmf-local/web2c,$SELFAUTODIR/share/texmf/web2c,$SELFAUTODIR/texmf-local/web2c,$SELFAUTODIR/texmf/web2c,$SELFAUTOPARENT/../texmf-local/web2c,$SELFAUTOPARENT,$SELFAUTOPARENT/share/texmf-local/web2c,$SELFAUTOPARENT/share/texmf/web2c,$SELFAUTOPARENT/texmf-local/web2c,$SELFAUTOPARENT/texmf/web2c}
kdebug:  application override path = (none)
kdebug:  application config file path = (none)
kdebug:  texmf.cnf path = (none)
kdebug:  compile-time path =
{$SELFAUTOLOC,$SELFAUTOLOC/share/texmf-local/web2c,$SELFAUTOLOC/share/texmf/web2c,$SELFAUTOLOC/texmf-local/web2c,$SELFAUTOLOC/texmf/web2c,$SELFAUTODIR,$SELFAUTODIR/share/texmf-local/web2c,$SELFAUTODIR/share/texmf/web2c,$SELFAUTODIR/texmf-local/web2c,$SELFAUTODIR/texmf/web2c,$SELFAUTOPARENT/../texmf-local/web2c,$SELFAUTOPARENT,$SELFAUTOPARENT/share/texmf-local/web2c,$SELFAUTOPARENT/share/texmf/web2c,$SELFAUTOPARENT/texmf-local/web2c,$SELFAUTOPARENT/texmf/web2c}
kdebug:  environment variables = TEXMFCNF
kdebug:  default suffixes = .cnf
kdebug:  other suffixes = (none)
kdebug:  search only with suffix = 0
kdebug:  runtime generation program = (none)
kdebug:  runtime generation command = (none)
kdebug:  program enabled = 0
kdebug:  program enable level = 0
kdebug:  open files in binary mode = 0
kdebug:  numeric format value = 8
kdebug:start search(file=texmf.cnf, must_exist=1, find_all=1,
path=/home/ismo/.local/texlive/2013/bin/x86_64-linux:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf/web2c:/home/ismo/.local/texlive/2013/bin:/home/ismo/.local/texlive/2013/bin/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/texmf/web2c:/home/ismo/.local/texlive/2013/../texmf-local/web2c:/home/ismo/.local/texlive/2013:/home/ismo/.local/texlive/2013/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/share/texmf/web2c:/home/ismo/.local/texlive/2013/texmf-local/web2c:/home/ismo/.local/texlive/2013/texmf/web2c).
kdebug:path element /home/ismo/.local/texlive/2013/bin/x86_64-linux =>
/home/ismo/.local/texlive/2013/bin/x86_64-linux/
kdebug:path element
/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf-local/web2c
=>
kdebug:path element
/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf/web2c =>
kdebug:path element
/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf-local/web2c =>
kdebug:path element
/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/bin =>
/home/ismo/.local/texlive/2013/bin/
kdebug:path element
/home/ismo/.local/texlive/2013/bin/share/texmf-local/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/bin/share/texmf/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/bin/texmf-local/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/bin/texmf/web2c =>
kdebug:path element
/home/ismo/.local/texlive/2013/../texmf-local/web2c =>
/home/ismo/.local/texlive/2013/../texmf-local/web2c/
kdebug:path element /home/ismo/.local/texlive/2013 =>
/home/ismo/.local/texlive/2013/
kdebug:path element /home/ismo/.local/texlive/2013/share/texmf-local/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/share/texmf/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/texmf-local/web2c =>
kdebug:path element /home/ismo/.local/texlive/2013/texmf/web2c =>
kdebug:fopen(/home/ismo/.local/texlive/2013/texmf.cnf, r) => 0x2ddc460
kdebug:fclose(0x2ddc460) => 0
kdebug:hash_lookup(TEXMFDBS.luatex) => (nil)
kdebug:hash_lookup(TEXMFDBS) => (nil)
kdebug:Search path for ls-R files (from compile-time paths.h)
kdebug:  = /nonesuch
kdebug:  before expansion = /nonesuch
kdebug:  application override path = (none)
kdebug:  application config file path = (none)
kdebug:  texmf.cnf path = (none)
kdebug:  compile-time path = /nonesuch
kdebug:  environment variables = TEXMFDBS
kdebug:  default suffixes = ls-R ls-r
kdebug:  other suffixes = (none)
kdebug:  search only with suffix = 0
kdebug:  runtime generation program = (none)
kdebug:  runtime generation command = (none)
kdebug:  program enabled = 0
kdebug:  program enable level = 0
kdebug:  open files in binary mode = 0
kdebug:  numeric format value = 9
kdebug:start search(files=[ls-R ls-r], must_exist=1, find_all=1,
path=/nonesuch).
kdebug:path element /nonesuch =>
kdebug:search([ls-R ls-r]) =>kdebug:hash_lookup(TEXMFLOG.luatex) => (nil)
kdebug:hash_lookup(TEXMFLOG) => (nil)
kdebug:variable: TEXMFLOG = (nil)

kdebug:start search(file=aliases, must_exist=1, find_all=1, path=/nonesuch).
kdebug:search(aliases) =>
kdebug:hash_lookup(shell_escape.luatex) => (nil)
kdebug:hash_lookup(shell_escape) => (nil)
kdebug:variable: shell_escape = (nil)
kdebug:hash_lookup(max_strings.luatex) => (nil)
kdebug:hash_lookup(max_strings) => (nil)
kdebug:variable: max_strings = (nil)
kdebug:hash_lookup(strings_free.luatex) => (nil)
kdebug:hash_lookup(strings_free) => (nil)
kdebug:variable: strings_free = (nil)
kdebug:hash_lookup(buf_size.luatex) => (nil)
kdebug:hash_lookup(buf_size) => (nil)
kdebug:variable: buf_size = (nil)
kdebug:hash_lookup(nest_size.luatex) => (nil)
kdebug:hash_lookup(nest_size) => (nil)
kdebug:variable: nest_size = (nil)
kdebug:hash_lookup(max_in_open.luatex) => (nil)
kdebug:hash_lookup(max_in_open) => (nil)
kdebug:variable: max_in_open = (nil)
kdebug:hash_lookup(param_size.luatex) => (nil)
kdebug:hash_lookup(param_size) => (nil)
kdebug:variable: param_size = (nil)
kdebug:hash_lookup(save_size.luatex) => (nil)
kdebug:hash_lookup(save_size) => (nil)
kdebug:variable: save_size = (nil)
kdebug:hash_lookup(stack_size.luatex) => (nil)
kdebug:hash_lookup(stack_size) => (nil)
kdebug:variable: stack_size = (nil)
kdebug:hash_lookup(dvi_buf_size.luatex) => (nil)
kdebug:hash_lookup(dvi_buf_size) => (nil)
kdebug:variable: dvi_buf_size = (nil)
kdebug:hash_lookup(error_line.luatex) => (nil)
kdebug:hash_lookup(error_line) => (nil)
kdebug:variable: error_line = (nil)
kdebug:hash_lookup(half_error_line.luatex) => (nil)
kdebug:hash_lookup(half_error_line) => (nil)
kdebug:variable: half_error_line = (nil)
kdebug:hash_lookup(max_print_line.luatex) => (nil)
kdebug:hash_lookup(max_print_line) => (nil)
kdebug:variable: max_print_line = (nil)
kdebug:hash_lookup(hash_extra.luatex) => (nil)
kdebug:hash_lookup(hash_extra) => (nil)
kdebug:variable: hash_extra = (nil)
kdebug:hash_lookup(pk_dpi.luatex) => (nil)
kdebug:hash_lookup(pk_dpi) => (nil)
kdebug:variable: pk_dpi = (nil)
kdebug:hash_lookup(expand_depth.luatex) => (nil)
kdebug:hash_lookup(expand_depth) => (nil)
kdebug:variable: expand_depth = (nil)
This is LuaTeX, Version beta-0.77.0-2013051114 (rev 4635)  (INITEX)
kdebug:hash_lookup(MKTEXTEX.luatex) => (nil)
kdebug:hash_lookup(MKTEXTEX) => (nil)
kdebug:variable: MKTEXTEX = (nil)
kdebug:hash_lookup(TEXINPUTS.luatex) => (nil)
kdebug:hash_lookup(TEXINPUTS) => (nil)
kdebug:Search path for tex files (from compile-time paths.h)
kdebug:  = /nonesuch
kdebug:  before expansion = /nonesuch
kdebug:  application override path = (none)
kdebug:  application config file path = (none)
kdebug:  texmf.cnf path = (none)
kdebug:  compile-time path = /nonesuch
kdebug:  environment variables = TEXINPUTS
kdebug:  default suffixes = .tex
kdebug:  other suffixes = .sty .cls .fd .aux .bbl .def .clo .ldf
kdebug:  search only with suffix = 0
kdebug:  runtime generation program = mktextex
kdebug:  runtime generation command = mktextex
kdebug:  program enabled = 0
kdebug:  program enable level = 0
kdebug:  open files in binary mode = 0
kdebug:  numeric format value = 26
kdebug:kpse_find_file: searching for luatex.ini of type tex (from
compile-time paths.h)
kdebug:hash_lookup(try_std_extension_first.luatex) => (nil)
kdebug:hash_lookup(try_std_extension_first) => (nil)
kdebug:variable: try_std_extension_first = (nil)
kdebug:start search(files=[luatex.ini luatex.ini.tex], must_exist=0,
find_all=0, path=/nonesuch).
kdebug:search([luatex.ini luatex.ini.tex]) =>
kdebug:start search(files=[luatex.ini], must_exist=1, find_all=0,
path=/nonesuch).
kdebug:search([luatex.ini]) =>
! I can't find file `luatex.ini'.
<*> luatex.ini

Please type another input file name:
kdebug:hash_lookup(openout_any.luatex) => (nil)
kdebug:hash_lookup(openout_any) => (nil)
kdebug:variable: openout_any = (nil)

! Emergency stop.
<*> luatex.ini

No pages of output.
Transcript written on luatex.log.

Ismo


From h_kitagawa2001 at yahoo.co.jp  Sat May 11 16:27:08 2013
From: h_kitagawa2001 at yahoo.co.jp (Hironori KITAGAWA)
Date: Sat, 11 May 2013 23:27:08 +0900
Subject: [luatex] reading font.fonts[] gives an error
Message-ID: <20130511232708.793b9f73e3c7dc3104d51106@yahoo.co.jp>

Hello,

LuaTeX in TeX Live 2013 pretest (x86_64-linux)
with the following source
---
%#!luatex
\input luaotfload.sty
\font\jx=file:KozMinPr6N-Regular.otf:+palt \jx 
\directlua{local t = font.fonts[font.current()]}%
?
\end
---
gives a strange error:
  > error: ...3/texmf-dist/tex/luatex/luaotfload/luaotfload-merged.lua:7493: 
  > attempt to perform arithmetic on local 'factor' (a nil value)
(The complete log is attached to this mail.)

Of course, this error disappeared if the line 5 is commented out.
I think that the line 5 does nothing harmful...

Regards
Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: factor-nil.log
URL: <http://tug.org/pipermail/luatex/attachments/20130511/aca3af47/attachment.ksh>

From elie.roux at telecom-bretagne.eu  Sat May 11 16:33:45 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 16:33:45 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <CAPd6TP10YkX2YHjViNgXKOMNZU+8hajSMCcRB0KOPO7cum0YOg@mail.gmail.com>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu> <518E4A31.1000508@gmx.de>
 <518E5194.9060304@telecom-bretagne.eu> <518E52E5.1080704@telecom-bretagne.eu>
 <CAPd6TP10YkX2YHjViNgXKOMNZU+8hajSMCcRB0KOPO7cum0YOg@mail.gmail.com>
Message-ID: <518E56C9.5000307@telecom-bretagne.eu>

On 11/05/2013 16:22, Ismo Toijala wrote:
> kdebug:fopen(/home/ismo/.local/texlive/2013/texmf.cnf, r) =>
> 0x2ddc460

Does this file exist? Is it the good one? If not, which one should it 
find? Is it in one of the directories listed here:

>
path=/home/ismo/.local/texlive/2013/bin/x86_64-linux:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf/web2c:/home/ismo/.local/texlive/2013/bin:/home/ismo/.local/texlive/2013/bin/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/texmf/web2c:/home/ismo/.local/texlive/2013/../texmf-local/web2c:/home/ismo/.local/texlive/2013:/home/ismo/.local/texlive/2013/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/share/texmf/web2c:/home/ismo/.local/texlive/2013/texmf-local/web2c:/home/ismo/.local/texlive/2013/texmf/web2c).

?

Thanks,
-- 
Elie

From Philipp.Gesang at alumni.uni-heidelberg.de  Sat May 11 16:35:45 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sat, 11 May 2013 16:35:45 +0200
Subject: [luatex] reading font.fonts[] gives an error
In-Reply-To: <20130511232708.793b9f73e3c7dc3104d51106@yahoo.co.jp>
References: <20130511232708.793b9f73e3c7dc3104d51106@yahoo.co.jp>
Message-ID: <20130511143544.GC15329@phlegethon>

???<date: 2013-05-11, Saturday>???<from: Hironori KITAGAWA>???

> Hello,
> 
> LuaTeX in TeX Live 2013 pretest (x86_64-linux)
> with the following source
> ---
> %#!luatex
> \input luaotfload.sty
> \font\jx=file:KozMinPr6N-Regular.otf:+palt \jx 
> \directlua{local t = font.fonts[font.current()]}%

with the fontloader, use either

  \directlua{local t = font.getfont(font.current())}%

or

  \directlua{local t = fonts.hashes.identifiers[font.current()]}%

> ?
> \end

The Luatex reference says:

  Note that at the moment, each access to the font.fonts or call
  to font.getfont creates a lua table for the whole font.

That interferes with the font loader, so font.getfont() has been
overloaded some time ago, for an explanation see:

  http://www.ntg.nl/pipermail/ntg-context/2013/072166.html

Best
Philipp

> ---
> gives a strange error:
>   > error: ...3/texmf-dist/tex/luatex/luaotfload/luaotfload-merged.lua:7493: 
>   > attempt to perform arithmetic on local 'factor' (a nil value)
> (The complete log is attached to this mail.)
> 
> Of course, this error disappeared if the line 5 is commented out.
> I think that the line 5 does nothing harmful...
> 
> Regards
> Hironori KITAGAWA <h_kitagawa2001 at yahoo.co.jp>

> This is LuaTeX, Version beta-0.76.0-2013050111 (rev 4627)  (format=luatex 2013.5.8)  11 MAY 2013 23:25
>  restricted \write18 enabled.
> **factor-nil
> (./factor-nil.tex
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload.sty
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase.sty
> Package: luatexbase 2013/05/04 v0.6 Module utilities for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package: ifluatex 2010/03/01 v1.3 Provides the ifluatex switch (HO)
> Package ifluatex Info: LuaTeX detected.
> )
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/luatex.sty
> Package: luatex 2010/03/09 v0.4 LuaTeX basic definition package (HO)
> 
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/infwarerr.sty
> Package: infwarerr 2010/04/08 v1.3 Providing info/warning/error messages (HO)
> )
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> \@tempcnta=\count277
> \@tempcntb=\count278
> \LuT at AllocAttribute=\count279
> \LuT at AllocCatcodeTable=\count280
> \CatcodeTableStack=\count281
> \CatcodeTableIniTeX=\catcodetable1
> \CatcodeTableString=\catcodetable3
> \CatcodeTableOther=\catcodetable5
> \CatcodeTableLaTeX=\catcodetable7
> 
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/luatex-loader.sty
> Package: luatex-loader 2010/03/09 v0.4 Lua module loader (HO)
> 
> (/opt/texlive/2013/texmf-dist/scripts/oberdiek/oberdiek.luatex.lua)))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-compat.sty
> Package: luatexbase-compat 2011/05/24 v0.4 Compatibility tools for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> ))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty
> Package: luatexbase-loader 2013/04/13 v0.5 Lua module loader for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-compat.sty)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase.loader.lua))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-regs.sty
> Package: luatexbase-regs 2011/05/24 v0.4 Registers allocation for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> ))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-attr.sty
> Package: luatexbase-attr 2011/05/24 v0.4 Attributes allocation for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-compat.sty)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty)
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/luatex.sty
> Package luatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/attr.lua)
> \lltxb at attr@unsetvalue=\count282
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-cctb.sty
> Package: luatexbase-cctb 2011/05/24 v0.4 Catcodetable allocation for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/cctb.lua)
> \lltxb at catcodetable@alloc=\count283
> \CatcodeTableStack=\count284
> \CatcodeTableIniTeX=\luatexcatcodetable1
> \CatcodeTableString=\luatexcatcodetable3
> \CatcodeTableOther=\luatexcatcodetable5
> \CatcodeTableLaTeX=\luatexcatcodetable7
> \CatcodeTableLaTeXAtLetter=\luatexcatcodetable9
> \CatcodeTableExpl=\luatexcatcodetable11
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-mcb.sty
> Package: luatexbase-mcb 2013/04/13 v0.5 Callback management for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-modutils.sty
> Package: luatexbase-modutils 2013/04/13 v0.5 Module utilities for LuaTeX
> (/opt/texlive/2013/texmf-dist/tex/generic/oberdiek/ifluatex.sty
> Package ifluatex Info: The package is already loaded.
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-loader.sty)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/modutils.lua))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/mcb.lua)
> Lua module: luatexbase-mcb 2013/04/13 0.5 register several functions in a callba
> ck
> )
> (/opt/texlive/2013/texmf-dist/tex/luatex/luatexbase/luatexbase-modutils.sty))
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload.lua)
> Lua module: luaotfload 2013/04/29 2.2 OpenType layout system.
> 
> luaotfload: push namespace for font loader
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-merged.lua)(using
>  write cache: /home/h7k/.texlive2013/texmf-var/luatex-cache/generic)(using read 
> cache: /opt/texlive/2013/texmf-var/luatex-cache/generic /home/h7k/.texlive2013/t
> exmf-var/luatex-cache/generic)
> (log) luatexbase.attributes["luaotfload at kernpair"] = 1
> (log) luatexbase.attributes["luaotfload at ligacomp"] = 2
> (log) luatexbase.attributes["luaotfload at markbase"] = 3
> (log) luatexbase.attributes["luaotfload at markmark"] = 4
> (log) luatexbase.attributes["luaotfload at markdone"] = 5
> (log) luatexbase.attributes["luaotfload at cursbase"] = 6
> (log) luatexbase.attributes["luaotfload at curscurs"] = 7
> (log) luatexbase.attributes["luaotfload at cursdone"] = 8
> (log) luatexbase.attributes["luaotfload at state"] = 9
> luaotfload: ?I am using the merged version of 'luaotfload.lua' here. If
> luaotfload:  you run into problems or experience unexpected behaviour,
> luaotfload:  and if you have ConTeXt installed you can try to delete the
> luaotfload:  file 'luaotfload-font-merged.lua' as I might then use the
> luaotfload:  possibly updated libraries. The merged version is not
> luaotfload:  supported as it is a frozen instance. Problems can be
> luaotfload:  reported to the ConTeXt mailing list.?
> luaotfload: pop namespace from font loader -- non-destructive
> luaotfload: fontloader loaded in 0.014 seconds
> luatexbase-mcb: inserting 'luaotfload.node_processor'
> at position 1 in 'pre_line
> break_filter'
> luatexbase-mcb: inserting 'luaotfload.node_processor'
> at position 1 in 'hpack_fi
> lter'
> luatexbase-mcb: inserting 'luaotfload.find_vf_file'
> at position 1 in 'find_vf_fi
> le'
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-lib-dir.lua)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-override.lua)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-loaders.lua)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-database.lua)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-colors.lua)
> luatexbase-mcb: creating 'luaotfload.patch_font' type 4
> luatexbase-mcb: resetting callback 'define_font'
> luatexbase-mcb: inserting 'luaotfload.define_font'
> at position 1 in 'define_font
> '
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-features.lua)
> (/opt/texlive/2013/texmf-dist/tex/luatex/luaotfload/luaotfload-auxiliary.lua)
> luatexbase-mcb: inserting 'luaotfload.fontdata_fallbacks'
> at position 1 in 'luao
> tfload.patch_font'
> luatexbase-mcb: inserting 'luaotfload.aux.set_sscale_dimens'
> at position 2 in 'l
> uaotfload.patch_font'
> luatexbase-mcb: inserting 'luaotfload.aux.patch_cambria_domh'
> at position 3 in '
> luaotfload.patch_font'
> luatexbase-mcb: inserting 'luaotfload.aux.set_capheight'
> at position 4 in 'luaot
> fload.patch_font')
> luaotfload | load: auto-selecting default features for script: dflt(load lua: /h
> ome/h7k/.texlive2013/texmf-var/luatex-cache/generic/fonts/otf/kozminpr6n-regular
> .lua).
> <inserted text> \par 
>      
> <to be read again> 
> \end 
> l.6 \end
>       
> ? x
> No pages of output.
> 
> PDF statistics: 0 PDF objects out of 1000 (max. 8388607)
>  0 named destinations out of 1000 (max. 131072)
>  1 words of extra memory for PDF output out of 10000 (max. 10000000)
> 


-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/e99d88d9/attachment-0001.bin>

From ismo.toijala at gmail.com  Sat May 11 16:37:51 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Sat, 11 May 2013 16:37:51 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E56C9.5000307@telecom-bretagne.eu>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de> <518E33B4.2010804@telecom-bretagne.eu>
 <518E379B.3060605@gmx.de> <518E3AAD.8060106@telecom-bretagne.eu>
 <CAPd6TP0AV_LSUyrBi_7Pvc0HUJK0ChC8TdwuMjceem1=j_Pp9g@mail.gmail.com>
 <518E3EA4.6030103@gmx.de>
 <CAPd6TP1MmOOrkAvxGftbj5D7Bo7J3yi44VUyAqU_B79fev-dUw@mail.gmail.com>
 <CAPd6TP1RCOQScDc4iE0p6KP6yAZxETkb8Cuqn6pfyBQc-tzxxA@mail.gmail.com>
 <518E45F9.6060303@telecom-bretagne.eu> <518E4A31.1000508@gmx.de>
 <518E5194.9060304@telecom-bretagne.eu> <518E52E5.1080704@telecom-bretagne.eu>
 <CAPd6TP10YkX2YHjViNgXKOMNZU+8hajSMCcRB0KOPO7cum0YOg@mail.gmail.com>
 <518E56C9.5000307@telecom-bretagne.eu>
Message-ID: <CAPd6TP2C-9scxXinY5JHB8EFBSxBWiixGGbf+5+F_XV-W0aDaQ@mail.gmail.com>

>> kdebug:fopen(/home/ismo/.local/texlive/2013/texmf.cnf, r) =>
>> 0x2ddc460
>
>
> Does this file exist? Is it the good one? If not, which one should it find?
> Is it in one of the directories listed here:
>
>
>>
> path=/home/ismo/.local/texlive/2013/bin/x86_64-linux:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/x86_64-linux/texmf/web2c:/home/ismo/.local/texlive/2013/bin:/home/ismo/.local/texlive/2013/bin/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/share/texmf/web2c:/home/ismo/.local/texlive/2013/bin/texmf-local/web2c:/home/ismo/.local/texlive/2013/bin/texmf/web2c:/home/ismo/.local/texlive/2013/../texmf-local/web2c:/home/ismo/.local/texlive/2013:/home/ismo/.local/texlive/2013/share/texmf-local/web2c:/home/ismo/.local/texlive/2013/share/texmf/web2c:/home/ismo/.local/texlive/2013/texmf-local/web2c:/home/ismo/.local/texlive/2013/texmf/web2c).

I think we have found the problem: the file is in
/home/ismo/.local/texlive/2013/texmf-dist/web2c

Notice how texmf-dist is completely missing from the above list. That
means this has to do with the merging of texmf into texmf-dist.

I guess there is a list of paths hardcoded into luatex somewhere.

Ismo


From kakuto at fuk.kindai.ac.jp  Sat May 11 16:46:29 2013
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 11 May 2013 23:46:29 +0900
Subject: [luatex]  mkluatexfontdb devours memory
Message-ID: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>

Hi all,

> Confirmed. I have the same problem with svn revision 4635 on x64
> Arch. The TL binary is revision 4627, maybe do a debug build of
> that one?

You havt to apply the attached patch to kpathsea/texmf.cnf
in the luatex svn before the build.

Thanks,
Akira
-------------- next part --------------
A non-text attachment was scrubbed...
Name: texmf.cnf.diff.gz
Type: application/x-gzip
Size: 3062 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/df8c7906/attachment.gz>

From elie.roux at telecom-bretagne.eu  Sat May 11 17:30:43 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 17:30:43 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
Message-ID: <518E6423.3020201@telecom-bretagne.eu>

On 11/05/2013 16:46, Akira Kakuto wrote:
> Hi all,
>
>> Confirmed. I have the same problem with svn revision 4635 on x64
>> Arch. The TL binary is revision 4627, maybe do a debug build of
>> that one?
>
> You havt to apply the attached patch to kpathsea/texmf.cnf
> in the luatex svn before the build.

Many thanks!

Arno, if you replace source/texk/kpathsea/texmf.cnf with the attached 
file and recompile the binary, can you build the formats?

Thank you,
-- 
Elie
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: texmf.cnf
URL: <http://tug.org/pipermail/luatex/attachments/20130511/f34a03c1/attachment-0001.ksh>

From Philipp.Gesang at alumni.uni-heidelberg.de  Sat May 11 17:39:38 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sat, 11 May 2013 17:39:38 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
Message-ID: <20130511153938.GD15329@phlegethon>

???<date: 2013-05-11, Saturday>???<from: Akira Kakuto>???

> Hi all,
> 
> >Confirmed. I have the same problem with svn revision 4635 on x64
> >Arch. The TL binary is revision 4627, maybe do a debug build of
> >that one?
> 
> You havt to apply the attached patch to kpathsea/texmf.cnf
> in the luatex svn before the build.

Hi Akira,

thanks, it builds and runs fine now.

Best regards
Philipp



-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/fe4d7a5c/attachment.bin>

From Arno.Trautmann at gmx.de  Sat May 11 18:25:20 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sat, 11 May 2013 18:25:20 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E6423.3020201@telecom-bretagne.eu>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu>
Message-ID: <518E70F0.9070607@gmx.de>

?lie Roux wrote:
> On 11/05/2013 16:46, Akira Kakuto wrote:
>> Hi all,
>>
>>> Confirmed. I have the same problem with svn revision 4635 on x64
>>> Arch. The TL binary is revision 4627, maybe do a debug build of
>>> that one?
>>
>> You havt to apply the attached patch to kpathsea/texmf.cnf
>> in the luatex svn before the build.
>
> Many thanks!

Thank you, too, Akira. With the patched version from ?lie I now can 
compile fine and the formats are build.

> Arno, if you replace source/texk/kpathsea/texmf.cnf with the attached
> file and recompile the binary, can you build the formats?

Yes. Running now

valgrind -v --leak-check=full texlua luaotfload-tool.lua 2

results in the output here:

http://justpaste.it/2lq6

with the summary:

==29474== LEAK SUMMARY:
==29474==    definitely lost: 11,667 bytes in 539 blocks
==29474==    indirectly lost: 2,638 bytes in 92 blocks
==29474==      possibly lost: 0 bytes in 0 blocks
==29474==    still reachable: 5,524,891 bytes in 257,399 blocks
==29474==         suppressed: 0 bytes in 0 blocks
==29474== Reachable blocks (those to which a pointer was found) are not 
shown.
==29474== To see them, rerun with: --leak-check=full --show-reachable=yes
==29474==
==29474== ERROR SUMMARY: 38 errors from 38 contexts (suppressed: 2 from 2)
--29474--
--29474-- used_suppression:      2 dl-hack3-cond-1
==29474==
==29474== ERROR SUMMARY: 38 errors from 38 contexts (suppressed: 2 from 2)

I guess ERROR is not good? ?

I now tried again

luaotfload-tool --update --force --verbose=5 --log=stdout

but still it fills the whole memory up. The first time it stopped at the 
font Loma.ttf, so I blacklisted it, but now the last output I get is

luaotfload | db: loading font ?/usr/share/fonts/TTF/Loma.ttf?
luaotfload | db: ignoring blacklisted font ?/usr/share/fonts/TTF/Loma.ttf?

So maybe a font after this one is a problem? But as I don't see any 
system in the order in which the fonts are loaded, I cannot say which 
one is loaded next ?

cheers
Arno

From elie.roux at telecom-bretagne.eu  Sat May 11 18:36:04 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Sat, 11 May 2013 18:36:04 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E70F0.9070607@gmx.de>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
Message-ID: <518E7374.3000305@telecom-bretagne.eu>

 >
> valgrind -v --leak-check=full texlua luaotfload-tool.lua 2
>
> results in the output here:
>
> http://justpaste.it/2lq6

Well, it's not that bad, there is a memory leak of about 5Mb. It's a 
lot, but far from 3Gb! but the database was not rebuilt entirely (I 
guess). What about

valgrind -v --leak-check=full texlua luaotfload-tool.lua --update --force

?

If it still shows no error, can you install teamviewer or an equivalent? 
I won't have time today but tomorrow I'll try to debug more deeply...

Thank you,
-- 
Elie

From Philipp.Gesang at alumni.uni-heidelberg.de  Sat May 11 19:25:51 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Sat, 11 May 2013 19:25:51 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E70F0.9070607@gmx.de>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
Message-ID: <20130511172551.GA9212@phlegethon>

???<date: 2013-05-11, Saturday>???<from: Arno Trautmann>???

> ?lie Roux wrote:
> >On 11/05/2013 16:46, Akira Kakuto wrote:
> >>Hi all,
> >>
> >>>Confirmed. I have the same problem with svn revision 4635 on x64
> >>>Arch. The TL binary is revision 4627, maybe do a debug build of
> >>>that one?
> >>
> >>You havt to apply the attached patch to kpathsea/texmf.cnf
> >>in the luatex svn before the build.
> >
> >Many thanks!
> 
> Thank you, too, Akira. With the patched version from ?lie I now can
> compile fine and the formats are build.
> 
> >Arno, if you replace source/texk/kpathsea/texmf.cnf with the attached
> >file and recompile the binary, can you build the formats?
> 
> Yes. Running now
> 
> valgrind -v --leak-check=full texlua luaotfload-tool.lua 2
> 
> results in the output here:
> 
> http://justpaste.it/2lq6
> 
> with the summary:
> 
> ==29474== LEAK SUMMARY:
> ==29474==    definitely lost: 11,667 bytes in 539 blocks
> ==29474==    indirectly lost: 2,638 bytes in 92 blocks
> ==29474==      possibly lost: 0 bytes in 0 blocks
> ==29474==    still reachable: 5,524,891 bytes in 257,399 blocks
> ==29474==         suppressed: 0 bytes in 0 blocks
> ==29474== Reachable blocks (those to which a pointer was found) are
> not shown.
> ==29474== To see them, rerun with: --leak-check=full --show-reachable=yes
> ==29474==
> ==29474== ERROR SUMMARY: 38 errors from 38 contexts (suppressed: 2 from 2)
> --29474--
> --29474-- used_suppression:      2 dl-hack3-cond-1
> ==29474==
> ==29474== ERROR SUMMARY: 38 errors from 38 contexts (suppressed: 2 from 2)
> 
> I guess ERROR is not good? ?
> 
> I now tried again
> 
> luaotfload-tool --update --force --verbose=5 --log=stdout
> 
> but still it fills the whole memory up. The first time it stopped at
> the font Loma.ttf, so I blacklisted it, but now the last output I
> get is
> 
> luaotfload | db: loading font ?/usr/share/fonts/TTF/Loma.ttf?
> luaotfload | db: ignoring blacklisted font ?/usr/share/fonts/TTF/Loma.ttf?
> 
> So maybe a font after this one is a problem?

Yes, that is possible. The logging mechanism uses texio.*() and
the line printing the culprit font may not have been flushed at
that moment. It happened before.

>                                              But as I don't see any
> system in the order in which the fonts are loaded, I cannot say
> which one is loaded next ?

I?ll upload a new version to CTAN inside an hour. It?ll provide
the --dry-run switch that will print the loading order.

Thanks for testing
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130511/e76fbd51/attachment.bin>

From reinhard.kotucha at web.de  Sat May 11 23:53:30 2013
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Sat, 11 May 2013 23:53:30 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E204A.70706@gmx.de>
References: <518BA136.8070104@gmx.de> <20130509154709.GA20616@phlegethon>
 <518D2885.5040703@gmx.de> <518E06BA.5090400@telecom-bretagne.eu>
 <518E0E6E.3060703@gmx.de> <518E1889.70408@telecom-bretagne.eu>
 <518E204A.70706@gmx.de>
Message-ID: <20878.48602.844694.327559@zaphod.ms25.net>

On 2013-05-11 at 12:41:14 +0200, Arno Trautmann wrote:

 > But this does not work, the .ini files are not found:

Hi Arno,
an invaluable tool in order to find out where programs expect files
is strace.  AFAIK it's provided by all Linux distributions.

By default it traces all system calls and thus produces more output
than desired.

If you only want to trace stat() and open() calls, just call

  strace -e open,stat <your command>

Output is written to stderr and it's often more convenient to redirect
it to a file and examine the file afterwards:

  strace -e open,stat <your command>  2>strace-output

This allows you to use the search facilities of your text editor in
order to examine the results.

Though it's a matter of fact that kpathsea-debug is the best tool for
debugging TeX-related problems, I'm convinced that being aware of
strace is extremely helpful.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From Arno.Trautmann at gmx.de  Sun May 12 03:06:04 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Sun, 12 May 2013 03:06:04 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518E7374.3000305@telecom-bretagne.eu>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu>
Message-ID: <518EEAFC.1070304@gmx.de>

?lie Roux wrote:
>  >
>> valgrind -v --leak-check=full texlua luaotfload-tool.lua 2
>>
>> results in the output here:
>>
>> http://justpaste.it/2lq6
>
> Well, it's not that bad, there is a memory leak of about 5Mb. It's a
> lot, but far from 3Gb! but the database was not rebuilt entirely (I
> guess). What about
>
> valgrind -v --leak-check=full texlua luaotfload-tool.lua --update --force
>
> ?

Did this, and let it run for 7 hours. It did not finish. CPU was 100% 
busy, but memory was not full. After stopping the program (ctrl+c), I got:

==30667== LEAK SUMMARY:
==30667==    definitely lost: 2,958,863 bytes in 28,218 blocks
==30667==    indirectly lost: 58,307,328 bytes in 59,833 blocks
==30667==      possibly lost: 13,388,168 bytes in 24 blocks
==30667==    still reachable: 100,485,349 bytes in 1,510,432 blocks
==30667==         suppressed: 0 bytes in 0 blocks
==30667== Reachable blocks (those to which a pointer was found) are not 
shown.
==30667== To see them, rerun with: --leak-check=full --show-reachable=yes
==30667==
==30667== ERROR SUMMARY: 88 errors from 88 contexts (suppressed: 2 from 2)
--30667--
--30667-- used_suppression:      2 dl-hack3-cond-1
==30667==
==30667== ERROR SUMMARY: 88 errors from 88 contexts (suppressed: 2 from 2)

cheers
Arno

From elie.roux at telecom-bretagne.eu  Mon May 13 17:21:20 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Mon, 13 May 2013 17:21:20 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <518EEAFC.1070304@gmx.de>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu> <518EEAFC.1070304@gmx.de>
Message-ID: <519104F0.9000703@telecom-bretagne.eu>

Dear Arno,

The new version of luaotfload is available here: 
http://www.ctan.org/tex-archive/macros/luatex/generic/luaotfload (I 
don't know if it reached texlive or not), can you test

luaotfload-tool --dry-run --update --force --verbose=5 --log=stdout

?

It should output the order of fonts, we'll see what the culprit is...

Thank you,
-- 
Elie

From arthur.reutenauer at normalesup.org  Mon May 13 20:11:38 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 13 May 2013 19:11:38 +0100
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: <s94soq4uyqi0$.dlg@nililand.de>
References: <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net>
 <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
 <1rmv0tmt0gqac.dlg@nililand.de> <20130510161551.GA7758@phlegethon>
 <s94soq4uyqi0$.dlg@nililand.de>
Message-ID: <20130513181138.GE12038@phare.normalesup.org>

> (But it would be useful to have a newer version for tests parallel
> to the stable system).

  The infrastructure for that is already in place, in the form of
tlcontrib that can be used as an alternative repository for TeX Live
(http://tlcontrib.metatex.org/).  If we're serious about setting up a
test environment it seems like a better alternative to uploading beta
versions to CTAN. To be honest I've never understood that urge to upload
everything to CTAN as soon as possible; that's not how I see its role,
and that seems to be an unfair burden on CTAN'ers.

	Arthur

From Robin.Fairbairns at cl.cam.ac.uk  Mon May 13 21:24:33 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 13 May 2013 20:24:33 +0100
Subject: [luatex] latest 'fixes' don't fix....again.
In-Reply-To: Your message of Mon, 13 May 2013 19:11:38 +0100.
 <20130513181138.GE12038@phare.normalesup.org>
Message-ID: <10466.1368473073@cl.cam.ac.uk>

Arthur Reutenauer <arthur.reutenauer at normalesup.org> wrote:

> > (But it would be useful to have a newer version for tests parallel
> > to the stable system).
> 
>   The infrastructure for that is already in place, in the form of
> tlcontrib that can be used as an alternative repository for TeX Live
> (http://tlcontrib.metatex.org/).  If we're serious about setting up a
> test environment it seems like a better alternative to uploading beta
> versions to CTAN.

it _is_ a convenient way.  however, don't you need to generate a tl
structure to use it?

> To be honest I've never understood that urge to upload
> everything to CTAN as soon as possible; that's not how I see its role,
> and that seems to be an unfair burden on CTAN'ers.

it's not impossibly bad; most of the people are well-acquainted with our
needs, and use a modern zipper, so that we can process the uploads
quickly and "cleanly".

the alternative is problematic, though: at the end of a development
spurt such as we see at present, how many people will remember to
package up their final version for ctan, if they've not been doing it
all along?

there are already more than enough packages that people refer to as "not
up to date on ctan -- get it from <some random site>" (happens regularly
on tex/sx, for example).

not enough of today's texies were around before ctan, when you never
heard about a package unless someone mentioned it on info-tex (or
whatever) ... they simply don't know how bad it can get to be!

robin

From mailing_list at arcor.de  Mon May 13 23:19:04 2013
From: mailing_list at arcor.de (Stephan Hennig)
Date: Mon, 13 May 2013 23:19:04 +0200
Subject: [luatex] LuaTeX 0.76: problem with pdf_colorstack whatsit
In-Reply-To: <517EB802.9060009@arcor.de>
References: <517E9F05.2010507@arcor.de>
 <BEA6584A-E5B2-4693-A0BC-CC876A834C64@gundla.ch> <517EB802.9060009@arcor.de>
Message-ID: <519158C8.3060301@arcor.de>

Am 29.04.2013 20:12, schrieb Stephan Hennig:

> Taco, is this change intentional?  It hasn't been announced in the
> LuaTeX changelog.  Do I have to adapt my code (the change breaks the
> spelling package) or will LuaTeX be fixed?

Ping!

Referring to field 'command' instead 'cmd' works.  I could test for the
correct node field, but since node.has_field(n, 'cmd') returns true and
node.has_field(n, 'command') returns false with LuaTeX 0.76, one needed
to explicitly test for an error triggered by an assignment to either field.

\directlua{
  local WHATSIT = node.id('whatsit')
  local PDF_COLORSTACK = node.subtype('pdf_colorstack')

  local function test_node_cmd()
    local n = node.new(WHATSIT, PDF_COLORSTACK)
    n.cmd = 1
  end

  if pcall(test_node_cmd) then
    texio.write_nl('node.cmd')
  else
    texio.write_nl('node.command')
  end
}
\bye

Do I need to add such an ugly test to my code or may we expect this to
be fixed before TL2013 is released?

Best regards,
Stephan Hennig


From Arno.Trautmann at gmx.de  Tue May 14 09:04:59 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Tue, 14 May 2013 09:04:59 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <519104F0.9000703@telecom-bretagne.eu>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu> <518EEAFC.1070304@gmx.de>
 <519104F0.9000703@telecom-bretagne.eu>
Message-ID: <5191E21B.3050309@gmx.de>

Hi ?lie,

?lie Roux wrote:
> The new version of luaotfload is available here:
> http://www.ctan.org/tex-archive/macros/luatex/generic/luaotfload (I
> don't know if it reached texlive or not), can you test
>
> luaotfload-tool --dry-run --update --force --verbose=5 --log=stdout

Did this, it runs through and outputs e.g.

luaotfload | db: would have been loading ?/usr/share/fonts/TTF/Loma.ttf?
luaotfload | db: would have been loading ?/usr/share/fonts/TTF/Loma.ttf?
luaotfload | db: would have been loading 
?/usr/share/fonts/OTF/Diablindall.ttf?
luaotfload | db: would have been loading 
?/usr/share/fonts/OTF/Diablindall.ttf?
luaotfload | db: would have been loading ?/usr/share/fonts/OTF/SpArFgRg.ttf?
luaotfload | db: would have been loading ?/usr/share/fonts/OTF/SpArFgRg.ttf?

The normal run with luaotfload-tool now stops at:

luaotfload | db: loading font 
?/usr/share/fonts/TTF/TlwgMono-BoldOblique.ttf?
luaotfload | db: loading font 
?/usr/share/fonts/TTF/TlwgMono-BoldOblique.ttf?
luaotfload | db: loading font ?/usr/share/fonts/TTF/Loma.ttf?
luaotfload | db: loading font ?/usr/share/fonts/TTF/Loma.ttf?
luaotfload | db: loading font ?/usr/share/fonts/OTF/Diablindall.ttf?
^C^C^C^C

Insterestingly, now every fonts seems to be loaded twice ? is it a bug 
during loading or only reporting it twice?
However, it doesn't seem to make sense that it could load once but not 
twice, so I am so free as to assume that the first line indicates the 
next-to-be-loaded font and only when it is really in work, the second 
line is reported? Concluding from this, I blacklisted Diablindall.ttf 
now and everything is fine, so we found the culprit!

Maybe the output of luaotfload-tool could be changed in a way like:

luaotfload | db: next font to load: XYZ.ttf
luaotfload | db: successfully loaded font XYZ.ttf

?lie, thank you very much for all your time and effort, it would have 
been very hard for me to figure this out by myself. Also thanks to all 
the outher guys who helped here!

cheers
Arno

From elie.roux at telecom-bretagne.eu  Tue May 14 09:19:09 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Tue, 14 May 2013 09:19:09 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <5191E21B.3050309@gmx.de>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu> <518EEAFC.1070304@gmx.de>
 <519104F0.9000703@telecom-bretagne.eu> <5191E21B.3050309@gmx.de>
Message-ID: <5191E56D.8010004@telecom-bretagne.eu>

Hi,

> Insterestingly, now every fonts seems to be loaded twice ? is it a
> bug during loading or only reporting it twice?

It is just reported twice due to --log=stdout, it was just in case but
you can remove it...

> Concluding from this, I blacklisted Diablindall.ttf now and
> everything is fine, so we found the culprit!

Oh, great! Can you send it to me so that I can inspect what's going on
and see if it's a bug in LuaTeX or in the font?

> ?lie, thank you very much for all your time and effort, it would
> have been very hard for me to figure this out by myself. Also thanks
> to all the outher guys who helped here!

You should mostly thank Philipp, my guess (a memleak) was a deadend...

Thank you!
-- 
Elie

From luatex at nililand.de  Tue May 14 09:49:09 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 14 May 2013 09:49:09 +0200
Subject: [luatex] mkluatexfontdb devours memory
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu> <518EEAFC.1070304@gmx.de>
 <519104F0.9000703@telecom-bretagne.eu> <5191E21B.3050309@gmx.de>
 <5191E56D.8010004@telecom-bretagne.eu>
Message-ID: <du3t87q0zq5l$.dlg@nililand.de>

Am Tue, 14 May 2013 09:19:09 +0200 schrieb ?lie Roux:

>> Concluding from this, I blacklisted Diablindall.ttf now and
>> everything is fine, so we found the culprit!
 
> Oh, great! Can you send it to me so that I can inspect what's going on
> and see if it's a bug in LuaTeX or in the font?

This font has always been in my black list together with some
others:

c:/windows/fonts/diablindall.ttf
c:/windows/fonts/spltfgbd.ttf
c:/windows/fonts/spltfgbi.ttf
c:/windows/fonts/spltfgit.ttf
c:/windows/fonts/spltfgrg.ttf

They are chess fonts from chessbase - old, non-unicode and
unstandard. While the first is completly useless for luatex the
other (which contain figurines) could perhaps in the future be used
- when there is some reliable and documentated interface to reencode
such fonts (or to create new virtual fonts).

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luatex at nililand.de  Tue May 14 09:55:17 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 14 May 2013 09:55:17 +0200
Subject: [luatex] latest 'fixes' don't fix....again.
References: <518B9AFD.2030209@gmail.com> <518B9B83.3010905@gmail.com>
 <20875.40391.107925.22707@zaphod.ms25.net> <518B9E8B.2000204@gmail.com>
 <20130509132205.GB8582@gamma.logic.tuwien.ac.at>
 <518BF625.8020005@miktex.org> <7bv97n9ignqo$.dlg@nililand.de>
 <1rmv0tmt0gqac.dlg@nililand.de> <20130510161551.GA7758@phlegethon>
 <s94soq4uyqi0$.dlg@nililand.de> <20130513181138.GE12038@phare.normalesup.org>
Message-ID: <voe0nfpu5v6b$.dlg@nililand.de>

Am Mon, 13 May 2013 19:11:38 +0100 schrieb Arthur Reutenauer:

>> (But it would be useful to have a newer version for tests parallel
>> to the stable system).
> 
>   The infrastructure for that is already in place, in the form of
> tlcontrib that can be used as an alternative repository for TeX Live
> (http://tlcontrib.metatex.org/).

I was speaking about the luatex binary in miktex. 

> If we're serious about setting up a test environment it seems like
> a better alternative to uploading beta versions to CTAN. To be
> honest I've never understood that urge to upload everything to
> CTAN as soon as possible; that's not how I see its role, and that
> seems to be an unfair burden on CTAN'ers.

I don't see such an urge. I have more the impression that some
uploads are rather slow and that you have to find all the github
places to get newer version which correct a bug. I prefer the other
way: That newer versions get fast to CTAN and that you can get older
versions from github or whatever.


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From elie.roux at telecom-bretagne.eu  Tue May 14 09:57:28 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Tue, 14 May 2013 09:57:28 +0200
Subject: [luatex] mkluatexfontdb devours memory
In-Reply-To: <du3t87q0zq5l$.dlg@nililand.de>
References: <BE1328329A0541BC8A9306C2FC58E6E1@CJ3001517a>
 <518E6423.3020201@telecom-bretagne.eu> <518E70F0.9070607@gmx.de>
 <518E7374.3000305@telecom-bretagne.eu> <518EEAFC.1070304@gmx.de>
 <519104F0.9000703@telecom-bretagne.eu> <5191E21B.3050309@gmx.de>
 <5191E56D.8010004@telecom-bretagne.eu> <du3t87q0zq5l$.dlg@nililand.de>
Message-ID: <5191EE68.1010701@telecom-bretagne.eu>

> This font has always been in my black list together with some
> others:
>
> c:/windows/fonts/diablindall.ttf
> c:/windows/fonts/spltfgbd.ttf
> c:/windows/fonts/spltfgbi.ttf
> c:/windows/fonts/spltfgit.ttf
> c:/windows/fonts/spltfgrg.ttf
>
> They are chess fonts from chessbase - old, non-unicode and
> unstandard. While the first is completly useless for luatex the
> other (which contain figurines) could perhaps in the future be used
> - when there is some reliable and documentated interface to reencode
> such fonts (or to create new virtual fonts).

Ok, it seems safe to blacklist them too...

Thank you,
-- 
Elie

From pragma at wxs.nl  Tue May 14 10:02:29 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 14 May 2013 10:02:29 +0200
Subject: [luatex] LuaTeX 0.76: problem with pdf_colorstack whatsit
In-Reply-To: <519158C8.3060301@arcor.de>
References: <517E9F05.2010507@arcor.de>
 <BEA6584A-E5B2-4693-A0BC-CC876A834C64@gundla.ch> <517EB802.9060009@arcor.de>
 <519158C8.3060301@arcor.de>
Message-ID: <5191EF95.4090508@wxs.nl>

On 5/13/2013 11:19 PM, Stephan Hennig wrote:
> Am 29.04.2013 20:12, schrieb Stephan Hennig:
>
>> Taco, is this change intentional?  It hasn't been announced in the
>> LuaTeX changelog.  Do I have to adapt my code (the change breaks the
>> spelling package) or will LuaTeX be fixed?
>
> Ping!
>
> Referring to field 'command' instead 'cmd' works.  I could test for the
> correct node field, but since node.has_field(n, 'cmd') returns true and
> node.has_field(n, 'command') returns false with LuaTeX 0.76, one needed
> to explicitly test for an error triggered by an assignment to either field.

> Do I need to add such an ugly test to my code or may we expect this to
> be fixed before TL2013 is released?

'command' is the right key (so the has_field list has to be adapted)

(fyi: around 0.75 node field access h as been cleaned up, normalized and 
made faster as well)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From taco at elvenkind.com  Tue May 14 10:24:12 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 14 May 2013 10:24:12 +0200
Subject: [luatex] LuaTeX 0.76: problem with pdf_colorstack whatsit
In-Reply-To: <5191EF95.4090508@wxs.nl>
References: <517E9F05.2010507@arcor.de>
 <BEA6584A-E5B2-4693-A0BC-CC876A834C64@gundla.ch> <517EB802.9060009@arcor.de>
 <519158C8.3060301@arcor.de> <5191EF95.4090508@wxs.nl>
Message-ID: <7F8F2E67-3BEA-47CD-A4BF-2B2705E80D96@elvenkind.com>


On May 14, 2013, at 10:02 AM, Hans Hagen <pragma at wxs.nl> wrote:

> On 5/13/2013 11:19 PM, Stephan Hennig wrote:
>> Am 29.04.2013 20:12, schrieb Stephan Hennig:
>> 
>>> Taco, is this change intentional?  It hasn't been announced in the
>>> LuaTeX changelog.  Do I have to adapt my code (the change breaks the
>>> spelling package) or will LuaTeX be fixed?
>> 
>> Ping!
>> 
>> Referring to field 'command' instead 'cmd' works.  I could test for the
>> correct node field, but since node.has_field(n, 'cmd') returns true and
>> node.has_field(n, 'command') returns false with LuaTeX 0.76, one needed
>> to explicitly test for an error triggered by an assignment to either field.
> 
>> Do I need to add such an ugly test to my code or may we expect this to
>> be fixed before TL2013 is released?
> 
> 'command' is the right key (so the has_field list has to be adapted)

Yes.

 As for fix: probably not before TL2013, as it is unlikely Karl wants to do another rebuild at this late stage.

Best wishes,
Taco




From pragma at wxs.nl  Tue May 14 10:23:24 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 14 May 2013 10:23:24 +0200
Subject: [luatex] line break reassigns font id with expansion
In-Reply-To: <20130505121541.GA32014@phlegethon>
References: <20130505121541.GA32014@phlegethon>
Message-ID: <5191F47C.3010401@wxs.nl>

On 5/5/2013 2:15 PM, Philipp Gesang wrote:
> Hi all,
>
> with expansion enabled, line breaking assigns new font ids to
> glyph nodes. Example for luatex-plain:
>
> ?????????????????????????????????????????????????????????????????
> %\font\somefont=file:Iwona-Regular.otf
> \font\somefont=file:Iwona-Regular.otf:expansion=default;
> \somefont
> \pdfadjustspacing=2
> \catcode`\%=11
>
> \directlua{
>    local glyph_t    = node.id"glyph"
>    local hlist_t    = node.id"hlist"
>    local vlist_t    = node.id"vlist"
>    local sub_box_t  = node.id"sub_box"
>
>    local show_font_id
>    show_font_id = function (hd, when, nested)
>      for n in node.traverse(hd) do
>        local n_id = n.id
>        if n_id == glyph_t then
>          local n_font = n.font
>          local tfmdata = font.getfont(n_font)
>          print(string.format(
>                "(%s (rec %s) (byte %d) (chr %s) (font %s) (tfmdata %s))",
>                when,
>                nested,
>                n.char,
>                unicode.utf8.char(n.char),
>                n_font,
>                tfmdata))
>        elseif n_id == hlist_t or n_id == vlist_t or n_id == sub_box_t then
>          show_font_id(n.list, when, true)
>        end
>      end
>      return hd
>    end
>    callback.register(
>      "pre_linebreak_filter",
>      function (hd) return show_font_id(hd, "pre_line") end)
>    callback.register(
>      "post_linebreak_filter",
>      function (hd) return show_font_id(hd, "post_line") end)
>    callback.register(
>      "pre_output_filter",
>      function (hd) return show_font_id(hd, "pre_out") end)
> }
>
> \hsize 1cm
>
> foo bar
>
> \bye
> ?????????????????????????????????????????????????????????????????
>
> On my machine (version beta-0.76.0-2013040516), all glyphs have
> font 51 initially. During line breaking, those glyphs that are
> subject to expansion get reassigned font 53 or 54. I?m not sure
> whether this is caused by the font loader or the engine itself.
> Anyways, the font loader doesn?t create entries for font ids 53
> and 54 in fonts.hashes.identifiers.
>
> My question is thus: is there a way to get the original font id
> of an expanded glyph after line breaking, or at least to get the
> corresponding tfmdata?

As all my luatex mailing list mails get filtered through its own box 
(simply because most concerns latex issues) I never see such mails till 
I explicitly walk through that list. Anyhow, the answer to this is:

It's just the way it works, and we will not extend that interface.
In fact, I've done experiments with this already years ago and already 
cooked up a more efficient and clean method which will get implemented 
after this tex live freeze. It also gives a better separation between 
front and backend. I actually patched the engine while testing but 
Hartmut will do the final cleanup so we have to be patient. There is no 
need to waste time on intermediate hacking.

The current implementation is taken from pdftex and is also a research 
instrument and therefore inhits on-the-fly fontbuilding (as needed for 
bitmap fonts).

Hans


-- 

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From vleclement at gmail.com  Tue May 14 12:23:30 2013
From: vleclement at gmail.com (=?ISO-8859-1?Q?Vianney_le_Cl=E9ment?=)
Date: Tue, 14 May 2013 12:23:30 +0200
Subject: [luatex] ligaturing callback in horizontal mode cannot replace tail
Message-ID: <CAMQPmcCTf+uEgiZW++y9wubkB4FPt4PbG0eOkGGO917Ljj2wgA@mail.gmail.com>

Hi all,

I want to replace three consecutive dots by an ellipsis throughout the
whole document. The ligaturing callback seems like the right place to
do this. It works fine in the general case, but fails sometimes when
the ellipsis comes at the end of a paragraph.

I have narrowed the problem down to the following problem. When trying
to replace the tail node in the ligaturing callback, LuaTeX yields the
following error.

    ! This can't happen (linebreak_tail).

This only seems to happen in horizontal mode. In restricted horizontal
mode (in an \hbox), it works fine.

At the end of the mail, you will find an example that replaces the
last glyph by a new glyph "A". If the glyph to be replaced is not the
tail node of the list or we are in restricted horizontal mode,
everything is fine. But as soon as we want to replace the tail node in
horizontal mode, the error message shows up.

Am I overlooking something or is this a LuaTeX bug?

The manual says that "After the callback, the internal value of the
'tail of the list' will be recalculated." Maybe this is not done
correctly in horizontal mode?

Kind regards,
Vianney

--
\directlua{
callback.register('ligaturing', function(head, tail)
    local s = ""
    for n in node.traverse(head) do
        if n.id == 37 then
            s = s .. " " .. unicode.utf8.char(n.char)
        else
            s = s .. " " .. n.id
        end
    end
    texio.write_nl("Ligaturing" .. s .. ".")
    while tail do
        if tail.id == 37 then
            local n = node.new(37, 1)
            n.char = unicode.utf8.byte("A")
            n.font = tail.font
            n.lang = tail.lang
            n.next = tail.next
            tail.prev.next = n
            node.free(tail)
            return
        end
        tail = tail.prev
    end
end)
}

Test % OK (tail node is a glue and is not replaced)

\hbox{Test} % OK (works in restricted hmode)

\vbox{Test} % KO (tail node is the glyph)

Test% KO (tail node is the glyph)

\bye

From zappathustra at free.fr  Tue May 14 13:08:52 2013
From: zappathustra at free.fr (Paul Isambert)
Date: Tue, 14 May 2013 13:08:52 +0200
Subject: [luatex] ligaturing callback in horizontal mode cannot replace
	tail
In-Reply-To: <CAMQPmcCTf+uEgiZW++y9wubkB4FPt4PbG0eOkGGO917Ljj2wgA@mail.gmail.com>
References: <CAMQPmcCTf+uEgiZW++y9wubkB4FPt4PbG0eOkGGO917Ljj2wgA@mail.gmail.com>
Message-ID: <20130514110853.C6BFDD4809A@smtp5-g21.free.fr>

Vianney le Cl?ment <vleclement at gmail.com> a ?crit:
> Hi all,
> 
> I want to replace three consecutive dots by an ellipsis throughout the
> whole document. The ligaturing callback seems like the right place to
> do this. It works fine in the general case, but fails sometimes when
> the ellipsis comes at the end of a paragraph.
> 
> I have narrowed the problem down to the following problem. When trying
> to replace the tail node in the ligaturing callback, LuaTeX yields the
> following error.
> 
>     ! This can't happen (linebreak_tail).
> 
> This only seems to happen in horizontal mode. In restricted horizontal
> mode (in an \hbox), it works fine.
> 
> At the end of the mail, you will find an example that replaces the
> last glyph by a new glyph "A". If the glyph to be replaced is not the
> tail node of the list or we are in restricted horizontal mode,
> everything is fine. But as soon as we want to replace the tail node in
> horizontal mode, the error message shows up.
> 
> Am I overlooking something or is this a LuaTeX bug?


It is a bug, and it has already been reported:
http://tracker.luatex.org/view.php?id=747

Best,
Paul


From vleclement at gmail.com  Tue May 14 13:57:07 2013
From: vleclement at gmail.com (=?ISO-8859-1?Q?Vianney_le_Cl=E9ment?=)
Date: Tue, 14 May 2013 13:57:07 +0200
Subject: [luatex] ligaturing callback in horizontal mode cannot replace
	tail
In-Reply-To: <20130514110853.C6BFDD4809A@smtp5-g21.free.fr>
References: <CAMQPmcCTf+uEgiZW++y9wubkB4FPt4PbG0eOkGGO917Ljj2wgA@mail.gmail.com>
 <20130514110853.C6BFDD4809A@smtp5-g21.free.fr>
Message-ID: <CAMQPmcBXwbRVFTe7BRNQPJBB_E9qpT8R2ZzsdrNv1XApPu3EOQ@mail.gmail.com>

On Tue, May 14, 2013 at 1:08 PM, Paul Isambert <zappathustra at free.fr> wrote:
> It is a bug, and it has already been reported:
> http://tracker.luatex.org/view.php?id=747

Thanks. I should have looked in the tracker first.
Sorry for the noise.
Vianney

From Philipp.Gesang at alumni.uni-heidelberg.de  Tue May 14 14:16:54 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Tue, 14 May 2013 14:16:54 +0200
Subject: [luatex] line break reassigns font id with expansion
In-Reply-To: <5191F47C.3010401@wxs.nl>
References: <20130505121541.GA32014@phlegethon>
 <5191F47C.3010401@wxs.nl>
Message-ID: <20130514121654.GA26463@phlegethon>

???<date: 2013-05-14, Tuesday>???<from: Hans Hagen>???

> On 5/5/2013 2:15 PM, Philipp Gesang wrote:
> >Hi all,
> >
> >with expansion enabled, line breaking assigns new font ids to
> >glyph nodes. Example for luatex-plain:
> >
> >?????????????????????????????????????????????????????????????????
> >%\font\somefont=file:Iwona-Regular.otf
> >\font\somefont=file:Iwona-Regular.otf:expansion=default;
> >\somefont
> >\pdfadjustspacing=2
> >\catcode`\%=11
> >
> >\directlua{
> >   local glyph_t    = node.id"glyph"
> >   local hlist_t    = node.id"hlist"
> >   local vlist_t    = node.id"vlist"
> >   local sub_box_t  = node.id"sub_box"
> >
> >   local show_font_id
> >   show_font_id = function (hd, when, nested)
> >     for n in node.traverse(hd) do
> >       local n_id = n.id
> >       if n_id == glyph_t then
> >         local n_font = n.font
> >         local tfmdata = font.getfont(n_font)
> >         print(string.format(
> >               "(%s (rec %s) (byte %d) (chr %s) (font %s) (tfmdata %s))",
> >               when,
> >               nested,
> >               n.char,
> >               unicode.utf8.char(n.char),
> >               n_font,
> >               tfmdata))
> >       elseif n_id == hlist_t or n_id == vlist_t or n_id == sub_box_t then
> >         show_font_id(n.list, when, true)
> >       end
> >     end
> >     return hd
> >   end
> >   callback.register(
> >     "pre_linebreak_filter",
> >     function (hd) return show_font_id(hd, "pre_line") end)
> >   callback.register(
> >     "post_linebreak_filter",
> >     function (hd) return show_font_id(hd, "post_line") end)
> >   callback.register(
> >     "pre_output_filter",
> >     function (hd) return show_font_id(hd, "pre_out") end)
> >}
> >
> >\hsize 1cm
> >
> >foo bar
> >
> >\bye
> >?????????????????????????????????????????????????????????????????
> >
> >On my machine (version beta-0.76.0-2013040516), all glyphs have
> >font 51 initially. During line breaking, those glyphs that are
> >subject to expansion get reassigned font 53 or 54. I?m not sure
> >whether this is caused by the font loader or the engine itself.
> >Anyways, the font loader doesn?t create entries for font ids 53
> >and 54 in fonts.hashes.identifiers.
> >
> >My question is thus: is there a way to get the original font id
> >of an expanded glyph after line breaking, or at least to get the
> >corresponding tfmdata?
> 
> As all my luatex mailing list mails get filtered through its own box
> (simply because most concerns latex issues) I never see such mails
> till I explicitly walk through that list. Anyhow, the answer to this
> is:
> 
> It's just the way it works, and we will not extend that interface.
> In fact, I've done experiments with this already years ago and
> already cooked up a more efficient and clean method which will get
> implemented after this tex live freeze. It also gives a better
> separation between front and backend. I actually patched the engine
> while testing but Hartmut will do the final cleanup so we have to be
> patient. There is no need to waste time on intermediate hacking.

Great news, looking forward to it!

> The current implementation is taken from pdftex and is also a
> research instrument and therefore inhits on-the-fly fontbuilding (as
> needed for bitmap fonts).

Makes sense. Thanks a lot for the detailed explanation. Maybe for
the time being this should be mentioned in luatexref-t because it
can be quite confusing.

Best
Philipp



-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/ecd9fa92/attachment.bin>

From kmaeda at users.sourceforge.jp  Tue May 14 14:28:11 2013
From: kmaeda at users.sourceforge.jp (Kazuki Maeda)
Date: Tue, 14 May 2013 21:28:11 +0900
Subject: [luatex] fontspec and IPAexMincho with CJKShape=JIS1990
Message-ID: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>

Hi all,

I tried the attached source with TL2013 pretest, then the attached PDF (ipaexm-jp90-test-TL2013.pdf) was produced.
The PDF contains three glyphs and all these glyphs should be same (see ipaexm-jp90-test-TL2012.pdf, which is generated by TL2012).
But the first and second glyphs are different from the third glyph.
The fontspec package output the following warnings:


*************************************************
* fontspec warning: "icu-feature-not-exist-in-font"
*
* OpenType feature 'CJKShape=JIS1990' (+jp90) not available for font
* 'IPAexMincho' with script '' and language ''.
*************************************************

*************************************************
* fontspec warning: "icu-feature-not-exist-in-font"
*
* OpenType feature 'CJKShape=JIS1990' (+jp90) not available for font
* 'IPAexMincho' with script '' and language ''.
*************************************************


Best regards
Kazuki Maeda
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ipaexm-jp90-test.tex
Type: text/x-tex
Size: 310 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/4abc9727/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ipaexm-jp90-test-TL2012.pdf
Type: application/pdf
Size: 153007 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/4abc9727/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ipaexm-jp90-test-TL2013.pdf
Type: application/pdf
Size: 153389 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/4abc9727/attachment-0003.pdf>

From Philipp.Gesang at alumni.uni-heidelberg.de  Tue May 14 15:26:44 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Tue, 14 May 2013 15:26:44 +0200
Subject: [luatex] fontspec and IPAexMincho with CJKShape=JIS1990
In-Reply-To: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>
References: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>
Message-ID: <20130514132644.GC26463@phlegethon>

Hi!

???<date: 2013-05-14, Tuesday>???<from: Kazuki Maeda>???

> Hi all,
> 
> I tried the attached source with TL2013 pretest, then the attached PDF (ipaexm-jp90-test-TL2013.pdf) was produced.
> The PDF contains three glyphs and all these glyphs should be same (see ipaexm-jp90-test-TL2012.pdf, which is generated by TL2012).
> But the first and second glyphs are different from the third glyph.
> The fontspec package output the following warnings:

Your test file runs fine here. Can you post your logfile?

Thanks
Philipp





-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/d8144acf/attachment.bin>

From kmaeda at users.sourceforge.jp  Tue May 14 15:40:42 2013
From: kmaeda at users.sourceforge.jp (Kazuki Maeda)
Date: Tue, 14 May 2013 22:40:42 +0900
Subject: [luatex] fontspec and IPAexMincho with CJKShape=JIS1990
In-Reply-To: <20130514132644.GC26463@phlegethon>
References: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>
 <20130514132644.GC26463@phlegethon>
Message-ID: <20130514224042.49c7dac1e5d1bc1da1adf969@users.sourceforge.jp>

Hi.

> > I tried the attached source with TL2013 pretest, then the attached PDF (ipaexm-jp90-test-TL2013.pdf) was produced.
> > The PDF contains three glyphs and all these glyphs should be same (see ipaexm-jp90-test-TL2012.pdf, which is generated by TL2012).
> > But the first and second glyphs are different from the third glyph.
> > The fontspec package output the following warnings:
>
> Your test file runs fine here. Can you post your logfile?

I attach the log file.

Best regards
Kazuki Maeda
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ipaexm-jp90-test.log
URL: <http://tug.org/pipermail/luatex/attachments/20130514/a142cd21/attachment-0001.ksh>

From mojca.miklavec.lists at gmail.com  Tue May 14 16:16:31 2013
From: mojca.miklavec.lists at gmail.com (Mojca Miklavec)
Date: Tue, 14 May 2013 16:16:31 +0200
Subject: [luatex] Support for Thai in LuaTeX
Message-ID: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>

Hi,

I've recently added Thai hyphenation patterns to hyph-utf8. I have a
few questions though (I was already discussing it a bit with Taco with
respect to Lao or some Ethiopic script on some field trip long time
ago).

Description:

Words in Thai aren't separated with spaces, so one can end up with
potentially infinite strings that TeX considers to be a single word.
According to my understanding there are two problems to be solved:
a) splitting sentences into words
b) syllabification of words

Hyphenation patterns could in principle do both simultaneously, but at
one point (at 64 or 256 characters in LuaTeX) TeX runs into a problem
of "too long word to hyphenate" and simply stops. (I still believe
that the hyphenation algorithm should be able to work on infinite
strings as long as hyphenation patterns are of finite length, but I'm
not comfortable working with TeX sources, and this is a bit off-topic
anyway.)

I thought at first that ICU library in XeTeX does both, but I was told
that it only does word-splitting, so hyphenation still remains to be
done. (Honestly, I don't see why it couldn't do syllabification in
addition to word splitting since determining boundaries of syllables
must be an easier problem, but I might be wrong.)

In pdfTeX the problem is solved by running a special program "swath":
- http://linux.thai.net/projects/swath (currently broken site)
- http://www.cs.cmu.edu/~paisarn/software.html (broken link)
which reads the input file and creates an output tex file with a
command sequence \wbr insterted between words. After that TeX can do
its job to hyphenate separate words easily, but that requires an
external preprocessor and "latex" as such cannot be run
out-of-the-box.

Question:

My question is: are there any plans or visions about how the problem
should be tackled in LuaTeX in the most elegant way, given the absence
of the ICU library?

I could also ask differently: suppose that a motivated Thai programmer
would be willing to work on solving the problem properly. What would
be the suggested solution?

Thank you,
    Mojca

From taco at elvenkind.com  Tue May 14 16:46:10 2013
From: taco at elvenkind.com (Taco Hoekwater)
Date: Tue, 14 May 2013 16:46:10 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
Message-ID: <51924E32.5090908@elvenkind.com>

Hi,
On 05/14/2013 04:16 PM, Mojca Miklavec wrote:
>
> Hyphenation patterns could in principle do both simultaneously, but at
> one point (at 64 or 256 characters in LuaTeX) TeX runs into a problem
> of "too long word to hyphenate" and simply stops. (I still believe

The 256 char limit is there to simplify coding a bit, and because Hans 
and I wanted to have a limit somewhere; at that point in time that 
seemed like the thing-to-do.

But there is no real need for that limit. If you recompile luatex with 
MAX_WORD_LEN in lang/texlang.h adjusted, you can hyphenate words up to 
about 1.5MB without any other changes to the source code (the limit 
depends on the C stack, as currently it uses a static array which 
resides on the call stack).

However, if you do this, you will run into two other problems:
1. no spaces means no flexibility in the line at all (this should be 
fixable with font expansion or box postprocessing, though)
2. the paragraph pathfinder (i.e. the code tries to minimize badness in 
the line breaking process) will run into its limits, resulting in 
suboptimal paragraphs even if problem 1. is fixed (and is a lot harder a 
problem to solve).

See the attached pdf of a single 230kb-word hyphenated over 40 pages to 
illustrate the issue (\hfuzz=9pt, otherwise all lines would have had
black boxes).

Best wishes,
Taco

-------------- next part --------------
A non-text attachment was scrubbed...
Name: longword.pdf
Type: application/pdf
Size: 19382 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/ec18b75d/attachment-0001.pdf>

From elie.roux at telecom-bretagne.eu  Tue May 14 16:51:54 2013
From: elie.roux at telecom-bretagne.eu (=?UTF-8?B?w4lsaWUgUm91eA==?=)
Date: Tue, 14 May 2013 16:51:54 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
Message-ID: <51924F8A.7060101@telecom-bretagne.eu>

> My question is: are there any plans or visions about how the problem
> should be tackled in LuaTeX in the most elegant way, given the absence
> of the ICU library?
>
> I could also ask differently: suppose that a motivated Thai programmer
> would be willing to work on solving the problem properly. What would
> be the suggested solution?

A very interesting question! Next thing on my todolist is to handle 
tibetan. It seems to have the same kind of difficulty, and the rules for 
end of lines could be summarized as follows: you can end a line only on 
a space (which is rare) or after a certain character (tshegs, U0F0B). 
How could it be possible to handle this?

Thank you,
-- 
Elie

From arthur.reutenauer at normalesup.org  Tue May 14 16:57:33 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 14 May 2013 16:57:33 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
Message-ID: <20130514145733.GB17338@phare.normalesup.org>

> I could also ask differently: suppose that a motivated Thai programmer
> would be willing to work on solving the problem properly. What would
> be the suggested solution?

  Insert word breaks by dictionary lookup just before hyphenation.

	Arthur

From luigi.scarso at gmail.com  Tue May 14 16:58:46 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 14 May 2013 16:58:46 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
Message-ID: <CAG5iGsBbev+Jh6n_nv4G0A5zyi8fiqrqp0nv708ndeWzqSweFg@mail.gmail.com>

On Tue, May 14, 2013 at 4:16 PM, Mojca Miklavec <
mojca.miklavec.lists at gmail.com> wrote:

>
> I could also ask differently: suppose that a motivated Thai programmer
> would be willing to work on solving the problem properly. What would
> be the suggested solution?
>
> Thank you,
>     Mojca
>

You can post also in the context ml, maybe there is some Thai user there .

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130514/baf32ffd/attachment.html>

From arthur.reutenauer at normalesup.org  Tue May 14 16:59:56 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 14 May 2013 16:59:56 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <51924F8A.7060101@telecom-bretagne.eu>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
 <51924F8A.7060101@telecom-bretagne.eu>
Message-ID: <20130514145956.GC17338@phare.normalesup.org>

> A very interesting question! Next thing on my todolist is to handle
> tibetan. It seems to have the same kind of difficulty, and the rules
> for end of lines could be summarized as follows: you can end a line
> only on a space (which is rare) or after a certain character
> (tshegs, U0F0B). How could it be possible to handle this?

  Your problem is quite different, ?lie: you simply need to insert break
opportunities after each tsek.

	Arthur

From theppitak at gmail.com  Tue May 14 17:59:35 2013
From: theppitak at gmail.com (Theppitak Karoonboonyanan)
Date: Tue, 14 May 2013 22:59:35 +0700
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CAG5iGsBbev+Jh6n_nv4G0A5zyi8fiqrqp0nv708ndeWzqSweFg@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
 <CAG5iGsBbev+Jh6n_nv4G0A5zyi8fiqrqp0nv708ndeWzqSweFg@mail.gmail.com>
Message-ID: <CACvhRiv6DaLQ+VtSZsq-_aj5FqEuL6E6NWS8xuKXxBdF27vu+A@mail.gmail.com>

On Tue, May 14, 2013 at 9:58 PM, luigi scarso <luigi.scarso at gmail.com> wrote:
>
> On Tue, May 14, 2013 at 4:16 PM, Mojca Miklavec
> <mojca.miklavec.lists at gmail.com> wrote:
>>
>> I could also ask differently: suppose that a motivated Thai programmer
>> would be willing to work on solving the problem properly. What would
>> be the suggested solution?
>
> You can post also in the context ml, maybe there is some Thai user there .

I am a Thai developer who works on Thai word segmentation tools and
thailatex package. So, you can suggest to me. (Please Cc: me, I'm not
in the mailing list.)

I'm totally new to LuaTeX and Lua programming language. But I can learn
necessary stuffs to get it done.

With a quick search, I saw "linebreak_filter" callback in LuaTeX reference.
Is that relevant to the problem? Or using external filter is already
acceptable?

Regards,
--
Theppitak Karoonboonyanan
http://linux.thai.net/~thep/

From arthur.reutenauer at normalesup.org  Tue May 14 18:11:34 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 14 May 2013 18:11:34 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CACvhRiv6DaLQ+VtSZsq-_aj5FqEuL6E6NWS8xuKXxBdF27vu+A@mail.gmail.com>
References: <CALBOmsaZX+krsREaOc8L5E8pyg7cF4WtwMPrfMEVWn4XPr_UqQ@mail.gmail.com>
 <CAG5iGsBbev+Jh6n_nv4G0A5zyi8fiqrqp0nv708ndeWzqSweFg@mail.gmail.com>
 <CACvhRiv6DaLQ+VtSZsq-_aj5FqEuL6E6NWS8xuKXxBdF27vu+A@mail.gmail.com>
Message-ID: <20130514161134.GE17338@phare.normalesup.org>

> With a quick search, I saw "linebreak_filter" callback in LuaTeX reference.
> is that relevant to the problem?

  Yes, that's one of the callbacks you can use to hook word segmentation
into TeX's flow, and that's the one I would recommend.

>                                  or using external filter is already
> acceptable?

  You should be the one answering this question, as you're probably the
only one on this list who's going to typeset Thai with LuaTeX: do you
want to continue using an external filter?  LuaTeX provides ways to
avoid that entirely, but of course that needs some additional code to be
written.

  In any case, LuaTeX is essentially compatible with pdfTeX, so whatever
worked with pdfTeX should work with LuaTeX too.

	Arthur

From Philipp.Gesang at alumni.uni-heidelberg.de  Tue May 14 18:52:43 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Tue, 14 May 2013 18:52:43 +0200
Subject: [luatex] fontspec and IPAexMincho with CJKShape=JIS1990
In-Reply-To: <20130514224042.49c7dac1e5d1bc1da1adf969@users.sourceforge.jp>
References: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>
 <20130514132644.GC26463@phlegethon>
 <20130514224042.49c7dac1e5d1bc1da1adf969@users.sourceforge.jp>
Message-ID: <20130514165243.GA30143@phlegethon>

???<date: 2013-05-14, Tuesday>???<from: Kazuki Maeda>???

> > > I tried the attached source with TL2013 pretest, then the attached PDF (ipaexm-jp90-test-TL2013.pdf) was produced.
> > > The PDF contains three glyphs and all these glyphs should be same (see ipaexm-jp90-test-TL2012.pdf, which is generated by TL2012).
> > > But the first and second glyphs are different from the third glyph.
> > > The fontspec package output the following warnings:
> >
> > Your test file runs fine here. Can you post your logfile?
> 
> I attach the log file.

Thanks.

    Package: fontspec 2013/03/16 v2.3a Font selection for XeLaTeX and LuaLaTeX

Can you try again with the fontspec from github:

    https://github.com/wspr/fontspec

There have been some changes regarding feature lookups.

Best regards
Philipp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130514/bec91204/attachment.bin>

From mailing_list at arcor.de  Tue May 14 18:41:20 2013
From: mailing_list at arcor.de (Stephan Hennig)
Date: Tue, 14 May 2013 18:41:20 +0200
Subject: [luatex] LuaTeX 0.76: problem with pdf_colorstack whatsit
In-Reply-To: <7F8F2E67-3BEA-47CD-A4BF-2B2705E80D96@elvenkind.com>
References: <517E9F05.2010507@arcor.de>
 <BEA6584A-E5B2-4693-A0BC-CC876A834C64@gundla.ch> <517EB802.9060009@arcor.de>
 <519158C8.3060301@arcor.de> <5191EF95.4090508@wxs.nl>
 <7F8F2E67-3BEA-47CD-A4BF-2B2705E80D96@elvenkind.com>
Message-ID: <51926930.8020405@arcor.de>

Am 14.05.2013 10:24, schrieb Taco Hoekwater:

> As for fix: probably not before TL2013,

OK, to maintain compatibility of my package with TL2012 I'll test for an
error during an assignment to field 'command'.

Best regards,
Stephan Hennig


From mico.loretan at mac.com  Wed May 15 00:26:40 2013
From: mico.loretan at mac.com (Mico Loretan)
Date: Tue, 14 May 2013 15:26:40 -0700
Subject: [luatex] latest round of updates to fontspec and related packages
 seems to disable ligatures in Opentype fonts
Message-ID: <5E21ED06-3720-43BF-A4E6-FEF917F1B12D@mac.com>

Greetings!

I'm running MacTeX2013 pre-release, on a system running MacOSX 10.7.5. I've installed all the latest packages via tlmgr through this morning. The header line from the .log file says:

     This is LuaTeX, Version beta-0.76.0-2013051018 (rev 4627)  (format=lualatex 2013.5.12)  

Consider the following MWE; Garamond Premier Pro is a system font distributed with Macs:

  \documentclass{article}
  \usepackage{fontspec}
  \setmainfont[Ligatures={Common,Rare}]{Garamond Premier Pro}
  \begin{document}
  off fit fly office baffle 

  act stab spoon 
  \end{document}

Since running the latest round of updates on all packages, neither the "common" ligatures (see the words in the first line after \begin{document} nor the "rare" ligatures (the following line) are being produced any longer. This problem also occurs if I use the font "Sabon Next LT Pro Regular". 

In contrast, if I use the font "EB Garamond" (a "free" opentype font(), the common ligatures are generated but *not* the rare ones. Finally, if I use "Latin Modern Roman", the common ligatures are also produced correctly; of course, Latin Modern doesn't feature "rare" ligatures, so I can't tell if the problem with rare ligatures not being produced extends to Latin Modern Roman...

I've never experienced a problem like this before. Are there some font cache file I need to wipe out and rebuild, or is the problem seated at some deeper, darker level?






From kmaeda at amp.i.kyoto-u.ac.jp  Wed May 15 00:38:55 2013
From: kmaeda at amp.i.kyoto-u.ac.jp (Kazuki Maeda)
Date: Wed, 15 May 2013 07:38:55 +0900
Subject: [luatex] fontspec and IPAexMincho with CJKShape=JIS1990
In-Reply-To: <20130514165243.GA30143@phlegethon>
References: <20130514212811.bf1d6f06e9c8ea5259072566@users.sourceforge.jp>
 <20130514132644.GC26463@phlegethon>
 <20130514224042.49c7dac1e5d1bc1da1adf969@users.sourceforge.jp>
 <20130514165243.GA30143@phlegethon>
Message-ID: <20130515073855.97a48a14db032fcdb162be57@amp.i.kyoto-u.ac.jp>

On Tue, 14 May 2013 18:52:43 +0200
Philipp Gesang <Philipp.Gesang at alumni.uni-heidelberg.de> wrote:

> ???<date: 2013-05-14, Tuesday>???<from: Kazuki Maeda>???
>
> > > > I tried the attached source with TL2013 pretest, then the attached PDF (ipaexm-jp90-test-TL2013.pdf) was produced.
> > > > The PDF contains three glyphs and all these glyphs should be same (see ipaexm-jp90-test-TL2012.pdf, which is generated by TL2012).
> > > > But the first and second glyphs are different from the third glyph.
> > > > The fontspec package output the following warnings:
> > >
> > > Your test file runs fine here. Can you post your logfile?
> >
> > I attach the log file.
>
> Thanks.
>
>     Package: fontspec 2013/03/16 v2.3a Font selection for XeLaTeX and LuaLaTeX
>
> Can you try again with the fontspec from github:
>
>     https://github.com/wspr/fontspec
>
> There have been some changes regarding feature lookups.

Package: fontspec 2013/05/03 v2.3b Font selection for XeLaTeX and LuaLaTeX

With this version, I found no problem. Thanks.

Best regards
Kazuki Maeda

From Philipp.Gesang at alumni.uni-heidelberg.de  Wed May 15 12:49:49 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Wed, 15 May 2013 12:49:49 +0200
Subject: [luatex] latest round of updates to fontspec and related
 packages seems to disable ligatures in Opentype fonts
In-Reply-To: <5E21ED06-3720-43BF-A4E6-FEF917F1B12D@mac.com>
References: <5E21ED06-3720-43BF-A4E6-FEF917F1B12D@mac.com>
Message-ID: <20130515104949.GB5498@phlegethon>

Hi Mico!

???<date: 2013-05-14, Tuesday>???<from: Mico Loretan>???

> Greetings!
> 
> I'm running MacTeX2013 pre-release, on a system running MacOSX 10.7.5. I've installed all the latest packages via tlmgr through this morning. The header line from the .log file says:
> 
>      This is LuaTeX, Version beta-0.76.0-2013051018 (rev 4627)  (format=lualatex 2013.5.12)  
> 
> Consider the following MWE; Garamond Premier Pro is a system font distributed with Macs:
> 
>   \documentclass{article}
>   \usepackage{fontspec}
>   \setmainfont[Ligatures={Common,Rare}]{Garamond Premier Pro}
>   \begin{document}
>   off fit fly office baffle 
> 
>   act stab spoon 
>   \end{document}
> 
> Since running the latest round of updates on all packages, neither the "common" ligatures (see the words in the first line after \begin{document} nor the "rare" ligatures (the following line) are being produced any longer. This problem also occurs if I use the font "Sabon Next LT Pro Regular". 
> 
> In contrast, if I use the font "EB Garamond" (a "free" opentype
> font(), the common ligatures are generated but *not* the rare
> ones.

?rare? is fontspec for ?dlig?, which in EB Garamond -- though
defined -- does nothing in the text you are testing with.

>       Finally, if I use "Latin Modern Roman", the common
> ligatures are also produced correctly; of course, Latin Modern
> doesn't feature "rare" ligatures, so I can't tell if the problem
> with rare ligatures not being produced extends to Latin Modern
> Roman...
> 
> I've never experienced a problem like this before. Are there
> some font cache file I need to wipe out and rebuild, or is the
> problem seated at some deeper, darker level?

Yes. Your options include manually updating fontspec
https://github.com/wspr/fontspec or replacing
luaotfload-auxiliary.lua with this version:
https://raw.github.com/phi-gamma/luaotfload/master/luaotfload-auxiliary.lua

Btw. this is not a Luatex problem, so the Lualatex list would be
a more appropriate forum: http://tug.org/mailman/listinfo/lualatex-dev

Thanks for testing
Philipp


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130515/ad3013f7/attachment.bin>

From arthur.reutenauer at normalesup.org  Sun May 19 14:07:52 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Sun, 19 May 2013 13:07:52 +0100
Subject: [luatex] [arthur.reutenauer@normalesup.org: Re: Support for
 Thai in LuaTeX]
In-Reply-To: <CACvhRivaVu15D3M85zj=kG37joWas4PYGdM6dTD-qE2YHayw_w@mail.gmail.com>
References: <20130518110818.GM8879@phare.normalesup.org>
 <CACvhRivaVu15D3M85zj=kG37joWas4PYGdM6dTD-qE2YHayw_w@mail.gmail.com>
Message-ID: <20130519120752.GC8879@phare.normalesup.org>

> Secondly, could you explain to me briefly what is passed to the callback,
> and what it should output back?

  Basically, a list of nodes such as glyphs, glue, etc.  (LuaTeX has a
small library to represent TeX nodes.)  It should output the same type
of data.

  You can see a simple example of using pre_linebreak_filter on

	http://wiki.luatex.org/index.php/Traversing_TeX_nodes

  All it does is display information on the terminal, it doesn't modify
the data TeX processes in any way, but I think provides a good example.

> I have got a Thai support library written in C which provides word breaking
> API. Is it possible to write some code to plug it to Lua?

  Yes, although I've never done that myself.

> The problem is that, currently, neither babel nor polyglossia can be used
> within LuaLaTeX docuement. Therefore, even if I use the external filter,
> some hard-coded macro for word break marker as used by the filter is
> still needed in the preamble.

  Polyglossia can now be used with LuaLaTeX.  If you tell me what macro
you need for Thai I can add it to the gloss file.

	Arthur

From theppitak at gmail.com  Sun May 19 07:09:04 2013
From: theppitak at gmail.com (Theppitak Karoonboonyanan)
Date: Sun, 19 May 2013 12:09:04 +0700
Subject: [luatex] [arthur.reutenauer@normalesup.org: Re: Support for
 Thai in LuaTeX]
In-Reply-To: <20130518110818.GM8879@phare.normalesup.org>
References: <20130518110818.GM8879@phare.normalesup.org>
Message-ID: <CACvhRivaVu15D3M85zj=kG37joWas4PYGdM6dTD-qE2YHayw_w@mail.gmail.com>

On Sat, May 18, 2013 at 6:08 PM, Arthur Reutenauer
<arthur.reutenauer at normalesup.org> wrote:

>   I am ready to help you if you want to implement word segmentation for
> Thai in LuaTeX, which surely would benefit Thai-speaking users of TeX.

Thanks. First of all, I have to learn Lua first.

>> With a quick search, I saw "linebreak_filter" callback in LuaTeX reference.
>> is that relevant to the problem?
>
>   Yes, that's one of the callbacks you can use to hook word segmentation
> into TeX's flow, and that's the one I would recommend.

Secondly, could you explain to me briefly what is passed to the callback,
and what it should output back?

I have got a Thai support library written in C which provides word breaking
API. Is it possible to write some code to plug it to Lua?

>>                                  or using external filter is already
>> acceptable?
>
>   You should be the one answering this question, as you're probably the
> only one on this list who's going to typeset Thai with LuaTeX: do you
> want to continue using an external filter?  LuaTeX provides ways to
> avoid that entirely, but of course that needs some additional code to be
> written.

Close integration should be better for general users. For me myself,
using external filter is fine. But many users are not happy with that.

>   In any case, LuaTeX is essentially compatible with pdfTeX, so whatever
> worked with pdfTeX should work with LuaTeX too.

The problem is that, currently, neither babel nor polyglossia can be used
within LuaLaTeX docuement. Therefore, even if I use the external filter,
some hard-coded macro for word break marker as used by the filter is
still needed in the preamble.

Regards,
--
Theppitak Karoonboonyanan
http://linux.thai.net/~thep/

From listas at tex-tipografia.com  Mon May 20 15:07:06 2013
From: listas at tex-tipografia.com (Javier Bezos)
Date: Mon, 20 May 2013 15:07:06 +0200
Subject: [luatex] Support for Thai in LuaTeX
In-Reply-To: <CACvhRivaVu15D3M85zj=kG37joWas4PYGdM6dTD-qE2YHayw_w@mail.gmail.com>
References: <20130518110818.GM8879@phare.normalesup.org>
 <CACvhRivaVu15D3M85zj=kG37joWas4PYGdM6dTD-qE2YHayw_w@mail.gmail.com>
Message-ID: <519A1FFA.4060900@tex-tipografia.com>

El 19/05/2013 7:09, Theppitak Karoonboonyanan escribi?:

>>> With a quick search, I saw "linebreak_filter" callback in LuaTeX reference.
>>> is that relevant to the problem?

There is a great article explaining callbacks on

http://www.tug.org/TUGboat/tb32-1/tb100isambert.pdf

Javier

From Arno.Trautmann at gmx.de  Tue May 21 23:33:29 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Tue, 21 May 2013 23:33:29 +0200
Subject: [luatex] Behaviour of pdf.print changed?
Message-ID: <519BE829.9090201@gmx.de>

Hi all,

the following code is written after an article by Paul Isambert in the 
TUGboat some time ago. The article was about drawing in LuaTeX using 
direct pdf commands in the following way:

function pdf_print (...)
   for _, str in ipairs({...}) do
     pdf.print(str .. " ")
   end
   pdf.print("\\string\n")
end

function line (p1,p2)
   pdf_print(p1,p2,"l")
end

Until yesterday, I used the line

   pdf.print("\string\n")

with a single backslash in front of the "string". This still works with 
a TeX Live 2012 system with LuaTeX 0.70.2. However, with the latest TL 
pretest and LuaTeX 0.77.0 (rev 4635), this results in

./placeat.sty:21: LuaTeX error ./placeat.lua:19: invalid escape sequence 
near '\
s'
stack traceback:
	[C]: in function 'dofile'
	[string "\directlua "]:1: in main chunk.
l.21 ...ctlua{dofile(kpse.find_file("placeat.lua"))}

Now, I have to use the line like above with two backslashes:

   pdf.print("\\string\n")

which also seems to work with 0.70.2. Which behaviour is correct? 
Unfortunately I don't really understand what the code does, so I cannot 
guess how it should behave ?

cheers
Arno

From zappathustra at free.fr  Wed May 22 12:40:06 2013
From: zappathustra at free.fr (Paul Isambert)
Date: Wed, 22 May 2013 12:40:06 +0200
Subject: [luatex] Behaviour of pdf.print changed?
In-Reply-To: <519BE829.9090201@gmx.de>
References: <519BE829.9090201@gmx.de>
Message-ID: <20130522104007.6B1CCD48183@smtp5-g21.free.fr>

Arno Trautmann <Arno.Trautmann at gmx.de> a ?crit:
> Hi all,
> 
> the following code is written after an article by Paul Isambert in the 
> TUGboat some time ago. The article was about drawing in LuaTeX using 
> direct pdf commands in the following way:
> 
> function pdf_print (...)
>    for _, str in ipairs({...}) do
>      pdf.print(str .. " ")
>    end
>    pdf.print("\\string\n")
> end
> 
> function line (p1,p2)
>    pdf_print(p1,p2,"l")
> end
> 
> Until yesterday, I used the line
> 
>    pdf.print("\string\n")
> 
> with a single backslash in front of the "string". This still works with 
> a TeX Live 2012 system with LuaTeX 0.70.2. However, with the latest TL 
> pretest and LuaTeX 0.77.0 (rev 4635), this results in
> 
> ./placeat.sty:21: LuaTeX error ./placeat.lua:19: invalid escape sequence 
> near '\
> s'
> stack traceback:
> 	[C]: in function 'dofile'
> 	[string "\directlua "]:1: in main chunk.
> l.21 ...ctlua{dofile(kpse.find_file("placeat.lua"))}
> 
> Now, I have to use the line like above with two backslashes:
> 
>    pdf.print("\\string\n")
> 
> which also seems to work with 0.70.2. Which behaviour is correct? 
> Unfortunately I don't really understand what the code does, so I cannot 
> guess how it should behave ?

If the line

    pdf.print("\string\n")

is in a Lua file, there shouldn?t be any ?\string? at all, which is useful only
with \directlua; here this results in the unexisting character ?\s?
followed by ?tring\n?.

So the code was wrong from the beginning, however you didn?t notice
the error because in Lua 5.1 ?\s? is not an invalid sequence, whereas
it is in Lua 5.2.

Best,
Paul


From evan.cooch at gmail.com  Wed May 22 16:10:18 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Wed, 22 May 2013 10:10:18 -0400
Subject: [luatex] another update, another 'break'
Message-ID: <519CD1CA.4040906@gmail.com>

This time, I *think* the culprit is fontspec, which was recent updated 
(MikTeX 2.9).  Or unicode-math (also updated). Or both. MWE (at bottom) 
no longer compiles. Generates following error message (I'vee snipped out 
a bunch of stuff which I don't think is related to the failure of the 
file to compile). Any suggestions?

Command Line:   lualatex.exe --shell-escape "mwe.tex"
Startup Folder: C:\Users\egc\Desktop

This is LuaTeX, Version beta-0.70.2-2012060719 (MiKTeX 2.9)
  \write18 enabled.

<snip>

Module luatexbase-mcb info: inserting 'luaotfload.find_vf_file'
(luatexbase-mcb)            at position 1 in 'find_vf_file'
Module luatexbase-mcb info: inserting 'unicodemath.set_sscale_diments'
(luatexbase-mcb)            at position 1 in 'luaotfload.patch_font'
)

LaTeX Warning: You have requested, on input line 41, version
                `2013/05/20' of package luaotfload,
                but only version
                `2012/03/27 v1.26 OpenType layout system'
                is available.

(C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.lua)
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec-patches.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/fixltx2e.sty")
*************************************************
* LaTeX warning: "xparse/redefine-command"
*
* Redefining document command \oldstylenums with arg. spec. 'm' on line 128.
*************************************************
) ("C:/Program Files (x86)/MiKTeX 
2.9/tex/latex/fontspec/fontspec-luatex.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/base/fontenc.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/euenc/eu2enc.def")
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/euenc/eu2lmr.fd")(load: 
C:/Users/
egc/AppData/Local/MiKTeX/2.9/luatex-cache/generic/fonts/otf/temp-lmroman10-regu
lar.lua)) ("C:/Program Files (x86)/MiKTeX 
2.9/tex/xelatex/xunicode/xunicode.sty
" ("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/tipa/t3enc.def"(load: 
C:/Users/
egc/AppData/Local/MiKTeX/2.9/luatex-cache/generic/fonts/otf/temp-lmromanslant10
-regular.lua)(load: 
C:/Users/egc/AppData/Local/MiKTeX/2.9/luatex-cache/generic/
fonts/otf/temp-lmroman10-italic.lua)(load: 
C:/Users/egc/AppData/Local/MiKTeX/2.
9/luatex-cache/generic/fonts/otf/temp-lmroman10-bold.lua)
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/euenc/eu2lmss.fd")(load: 
C:/Users
/egc/AppData/Local/MiKTeX/2.9/luatex-cache/generic/fonts/otf/temp-lmsans10-regu
lar.lua)) ("C:/Program Files (x86)/MiKTeX 
2.9/tex/latex/graphics/graphicx.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/graphics/keyval.sty")
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/graphics/graphics.sty"
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/graphics/trig.sty")
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/00miktex/graphics.cfg")
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/pdftex-def/pdftex.def"))))
("C:/Program Files (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.cfg")))
luaotfload | Font names database loaded: 
C:/Users/egc/AppData/Local/MiKTeX/2.9/
luatex-cache/generic/names/otfl-names.lua(load: 
C:/Users/egc/AppData/Local/MiKT
eX/2.9/luatex-cache/generic/fonts/otf/temp-xits-regular.lua)
! LuaTeX error ...les (x86)/MiKTeX 
2.9/tex/latex/fontspec/fontspec.lua:45: atte
mpt to call upvalue 'check_script' (a nil value)
stack traceback:
  ...les (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.lua:45: in 
function 'check
_ot_script'
  <\directlua >:1: in main chunk.
\fontspec_check_script:nTF ...ontspec_font","#1")}
                                                   \if at tempswa 
\prg_return_tr...
l.4 \setmainfont{XITS}

?


\documentclass[11pt,letterpaper]{article}

\usepackage{fontspec}
\setmainfont{XITS}
\usepackage{unicode-math}
    \setmathfont{XITS Math}

\begin{document}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum quam 
ut erat rutrum consequat.

\begin{equation}
\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
\end{equation}

\end{document}




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130522/7f1b1dbc/attachment.html>

From evan.cooch at gmail.com  Wed May 22 16:21:03 2013
From: evan.cooch at gmail.com (Evan Cooch)
Date: Wed, 22 May 2013 10:21:03 -0400
Subject: [luatex] another update, another 'break'
In-Reply-To: <519CD1CA.4040906@gmail.com>
References: <519CD1CA.4040906@gmail.com>
Message-ID: <519CD44F.2020703@gmail.com>

If in the MWE I drop the equation, and don't specify the math font 
(below), still get the error, which seems to point to fontspec as the 
culprit. Still get the following error:


luaotfload | Font names database loaded: 
C:/Users/egc/AppData/Local/MiKTeX/2.9/
luatex-cache/generic/names/otfl-names.lua(load: 
C:/Users/egc/AppData/Local/MiKT
eX/2.9/luatex-cache/generic/fonts/otf/temp-xits-regular.lua)
! LuaTeX error ...les (x86)/MiKTeX 
2.9/tex/latex/fontspec/fontspec.lua:45: atte
mpt to call upvalue 'check_script' (a nil value)
stack traceback:
  ...les (x86)/MiKTeX 2.9/tex/latex/fontspec/fontspec.lua:45: in 
function 'check
_ot_script'
  <\directlua >:1: in main chunk.
\fontspec_check_script:nTF ...ontspec_font","#1")}
                                                   \if at tempswa 
\prg_return_tr...
l.4 \setmainfont{XITS}

?

Process has been terminated ...


>
>
> \documentclass[11pt,letterpaper]{article}
>
> \usepackage{fontspec}
> \setmainfont{XITS}
> %\usepackage{unicode-math}
>   % \setmathfont{XITS Math}
>
> \begin{document}
>
> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent in 
> tincidunt nulla. Donec quis laoreet est. Aenean vitae est felis, a 
> venenatis magna. Mauris semper bibendum vulputate. Etiam bibendum quam 
> ut erat rutrum consequat.
>
> %\begin{equation}
> %\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right)
> %\end{equation}
>
> \end{document}
>
>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130522/3d49d324/attachment.html>

From luatex at nililand.de  Wed May 22 17:05:28 2013
From: luatex at nililand.de (Ulrike Fischer)
Date: Wed, 22 May 2013 17:05:28 +0200
Subject: [luatex] another update, another 'break'
References: <519CD1CA.4040906@gmail.com>
Message-ID: <1qx3bescfum43.dlg@nililand.de>

Am Wed, 22 May 2013 10:10:18 -0400 schrieb Evan Cooch:

> This time, I *think* the culprit is fontspec, which was recent updated 
> (MikTeX 2.9).  Or unicode-math (also updated). Or both. MWE (at bottom) 
> no longer compiles. Generates following error message (I'vee snipped out 
> a bunch of stuff which I don't think is related to the failure of the 
> file to compile). Any suggestions?

Roll back to an older fontspec and unicode-math. And avoid to
automatically update lua related package in miktex: the luatex of
miktex is too old. Chances are currently very high that newer
versions of packages use some feature which needs a newer luatex
version. 

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From evan.cooch at cornell.edu  Wed May 22 17:10:20 2013
From: evan.cooch at cornell.edu (Evan Cooch)
Date: Wed, 22 May 2013 11:10:20 -0400
Subject: [luatex] issue with fontspec update | probably cause
Message-ID: <519CDFDC.30007@cornell.edu>

At least, I think. Hopped over to gthb pages for fontspec. The thing 
that changed with the latest update was


v2.3c (2013/05/20)

  * Compatibility with luaotfload 2013/05/20 2.2c, support for older
    version removed.


So, I suspect what is happening is that IIRC that MikTeX is using an 
older version of luaotfload, which worked fine, until fontspec dropped 
support for it as of version 2.2c (as noted above)

is this a likely explanation? If so, then the obvious short-term 
solution for MikTeX users is to revert to older version of fontspec. I 
did this, and things compile perfectly.

-- 

    _```_
    -. .-            +--------------------------------------+
    ( L )    \////   |            Evan G. Cooch             |
  --(\=/)--  (   )   |   Department of Natural Resources    |
/         \ /  /    |          Cornell University          |
I          V  /     |        Ithaca, NY, USA  14853        |
I            /      |     v: 607-255-1368  (f: x-0349)     |
I           /       +--------------------------------------+


"Ginger Rogers did everything Fred Astaire did, except backwards and in high heels..."

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130522/797880e3/attachment-0001.html>

From Arno.Trautmann at gmx.de  Wed May 22 22:38:52 2013
From: Arno.Trautmann at gmx.de (Arno Trautmann)
Date: Wed, 22 May 2013 22:38:52 +0200
Subject: [luatex] Behaviour of pdf.print changed?
In-Reply-To: <20130522104007.6B1CCD48183@smtp5-g21.free.fr>
References: <519BE829.9090201@gmx.de>
 <20130522104007.6B1CCD48183@smtp5-g21.free.fr>
Message-ID: <519D2CDC.30700@gmx.de>

Hi,

Paul Isambert wrote:
> If the line
>
>      pdf.print("\string\n")
>
> is in a Lua file, there shouldn?t be any ?\string? at all, which is useful only
> with \directlua; here this results in the unexisting character ?\s?
> followed by ?tring\n?.

It was in a Lua file. I got rid of the \string, now everything works. 
Thanks for the hint.

> So the code was wrong from the beginning, however you didn?t notice
> the error because in Lua 5.1 ?\s? is not an invalid sequence, whereas
> it is in Lua 5.2.

Good to know ?

cheers
Arno

From khaledhosny at eglug.org  Thu May 23 00:47:29 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Thu, 23 May 2013 00:47:29 +0200
Subject: [luatex] issue with fontspec update | probably cause
In-Reply-To: <519CDFDC.30007@cornell.edu>
References: <519CDFDC.30007@cornell.edu>
Message-ID: <20130522224728.GC11331@khaled-laptop>

On Wed, May 22, 2013 at 11:10:20AM -0400, Evan Cooch wrote:
> is this a likely explanation?

Yes. LaTeX should be giving you a warning already.

Regards,
Khaled

From senseiwa at gmail.com  Mon May 27 15:06:33 2013
From: senseiwa at gmail.com (Sensei)
Date: Mon, 27 May 2013 15:06:33 +0200
Subject: [luatex] Hash tokens meaning
Message-ID: <51A35A59.4030203@gmail.com>

Dear all,

I am trying to grasp the meaning of the hash tokens I find in a latex 
document. I am a novice TeX user, so please bear with my (almost surely) 
stupid questions: I've only used LaTeX, and never looked into the pit :)


- First of all, I find many tokens that contain @ or ! or ^, for example 
"tagsleft at false", "ps at headings", "\T1\^-\i", or "!!stringa": do these 
characters have a special meaning?


- Why do I have so many "blank" tokens? At the end of this you'll find a 
sample from a dump file viewed from emacs, so an encoding of special 
characters is visible.


-Are tokens as 
"<5><6><7><8><9>gen*cmbx<10><10.95>cmbx10<12><14.4><17.28><20.74><24.88>cmbx12" 
real, or is it some kind of "encoding" that I see?


- Are these tokens portable? I mean, a friend of mine on windows will 
produce the very same tokens with the same document?


- All \label{something} seem to be processed as token "r at something". Is 
this real, or just my imagination?



Again, I am sorry to ask such trivial questions, but I didn't find 
anything anywhere on the internals of TeX!


Thanks & Cheers!



===BEGIN===
luatexattributedef
sffamily
^A
tracingoutput

^H
^K
macc at palette
^M
^L
^N
@currdir
makesm at sh
pdftrue
?\textless
====END====

From Robin.Fairbairns at cl.cam.ac.uk  Mon May 27 15:31:10 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 27 May 2013 14:31:10 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Mon, 27 May 2013 15:06:33 +0200.
 <51A35A59.4030203@gmail.com>
Message-ID: <6454.1369661470@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> I am trying to grasp the meaning of the hash tokens I find in a latex
> document. I am a novice TeX user, so please bear with my (almost
> surely) stupid questions: I've only used LaTeX, and never looked into
> the pit :)
> 
> 
> - First of all, I find many tokens that contain @ or ! or ^, for
> example "tagsleft at false", "ps at headings", "\T1\^-\i", or "!!stringa":
> do these characters have a special meaning?
 [etc...]

did you ever learn to swim?  did they teach you by throwing you in the
deep end of the pool, and telling you to read the instructions on the
bottom?

i ask, because that's what you seem to be doing here.  if you want to
get a feel for tex, read "tex for the impatient
(mirror.ctan.org:/info/impatient/book.pdf -- also available in french)

if (as it seems) you want to learn latex, don't start with the latex
kernel (which is poorly commented in many places), start from the users'
point of view, with something like "short introduction to latex"
(mirror.ctan.org:/info/lshort/english/lshort.pdf -- also available in
several other languages)

most people take some time to progress from user-level stuff to reading
the kernel's code.  (fwiw, my head often swims when reading latex
internals, and i've been reading it(them) on and off since the 1980s,
before the current latex 2e was released.)

r

From senseiwa at gmail.com  Mon May 27 15:55:50 2013
From: senseiwa at gmail.com (Sensei)
Date: Mon, 27 May 2013 15:55:50 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <6454.1369661470@cl.cam.ac.uk>
References: <6454.1369661470@cl.cam.ac.uk>
Message-ID: <51A365E6.3050902@gmail.com>

On 5/27/13 3:31 PM, Robin Fairbairns wrote:
> did you ever learn to swim?  did they teach you by throwing you in the
> deep end of the pool, and telling you to read the instructions on the
> bottom?

No, but they did ask me to enter the pool. I learned by trial and error.

> i ask, because that's what you seem to be doing here.  if you want to
> get a feel for tex, read "tex for the impatient
> (mirror.ctan.org:/info/impatient/book.pdf -- also available in french)

> if (as it seems) you want to learn latex, don't start with the latex
> kernel (which is poorly commented in many places), start from the users'
> point of view, with something like "short introduction to latex"
> (mirror.ctan.org:/info/lshort/english/lshort.pdf -- also available in
> several other languages)

No. I am a happy LaTeX user, I just wanted to see TeX.

I honestly didn't realize that I asked something "deep" or "sensitive", 
I thought there just was some kind a cheatsheet somewhere that I didn't 
find by myself. I was wrong.

> most people take some time to progress from user-level stuff to reading
> the kernel's code.  (fwiw, my head often swims when reading latex
> internals, and i've been reading it(them) on and off since the 1980s,
> before the current latex 2e was released.)

Well, I'll find myself some time to read it, then :)

From luigi.scarso at gmail.com  Mon May 27 16:40:06 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Mon, 27 May 2013 16:40:06 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A35A59.4030203@gmail.com>
References: <51A35A59.4030203@gmail.com>
Message-ID: <CAG5iGsDsi+VPJPat9-9TJKY=TMJ=ZPfK+46EWnYoZ+JCgoF+PA@mail.gmail.com>

On Mon, May 27, 2013 at 3:06 PM, Sensei <senseiwa at gmail.com> wrote:

> Dear all,
>
> I am trying to grasp the meaning of the hash tokens I find in a latex
> document. I am a novice TeX user, so please bear with my (almost surely)
> stupid questions: I've only used LaTeX, and never looked into the pit :)
>
>
> - First of all, I find many tokens that contain @ or ! or ^, for example
> "tagsleft at false", "ps at headings", "\T1\^-\i", or "!!stringa": do these
> characters have a special meaning?
>
>
> - Why do I have so many "blank" tokens? At the end of this you'll find a
> sample from a dump file viewed from emacs, so an encoding of special
> characters is visible.
>
>
> -Are tokens as "<5><6><7><8><9>gen*cmbx<10><**
> 10.95>cmbx10<12><14.4><17.28><**20.74><24.88>cmbx12" real, or is it some
> kind of "encoding" that I see?
>
>
> - Are these tokens portable? I mean, a friend of mine on windows will
> produce the very same tokens with the same document?
>
>
> - All \label{something} seem to be processed as token "r at something". Is
> this real, or just my imagination?
>
>
>
> Again, I am sorry to ask such trivial questions, but I didn't find
> anything anywhere on the internals of TeX!
>
>
> Thanks & Cheers!
>
>
>
> ===BEGIN===
> luatexattributedef
> sffamily
> ^A
> tracingoutput
>
> ^H
> ^K
> macc at palette
> ^M
> ^L
> ^N
> @currdir
> makesm at sh
> pdftrue
> ?\textless
> ====END====
>


I have to admit that I don't uderstand which files are you reading...

For the characters @ ^ etc you should search for \makeatletter just start
to understand the catcodes
but for the text between BEGIN/END ..what is it ? A   lualatex / luatex fmt
file ?
If it's a luatex format file (I guess, after all this is  the luatex ml)
you should see also the macro used for the dump.
About portability of the format, well yes and no. See
3.5.2.3 Hardware and memory dumps
at
http://www.tug.org/texinfohtml/web2c.html#Memory-dumps


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130527/4192059b/attachment.html>

From arthur.reutenauer at normalesup.org  Mon May 27 17:15:24 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Mon, 27 May 2013 16:15:24 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A365E6.3050902@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk>
 <51A365E6.3050902@gmail.com>
Message-ID: <20130527151524.GO31062@phare.normalesup.org>

> No, but they did ask me to enter the pool. I learned by trial and error.

  That's your problem here.  What are you trying to do, and what were
the errors you encountered?  So far as I can see you're not actually
doing anything real, only asking vague questions, the purpose of which
is not clear at all.

> I honestly didn't realize that I asked something "deep" or
> "sensitive", I thought there just was some kind a cheatsheet
> somewhere that I didn't find by myself. I was wrong.

  Not only is there no such document, but if it did it would probably
not help you very much.  The problem with the word "cheatsheet" is that
the information it contains is only valuable to you if you actually know
something beforehand.  It doesn't really help you to cheat, more to
quickly find something that temporarily slipped your mind, or that you
learned a long time ago and need to brush up on.

  Now, being well understood that the answers probably won't help you at
all, there is no reason why we shouldn't try and answer your questions,
to the extent that they make sense:

> I am trying to grasp the meaning of the hash tokens I find in a latex 
> document. I am a novice TeX user, so please bear with my (almost surely) 
> stupid questions: I've only used LaTeX, and never looked into the pit :)

  First of all, I believe that what you're calling "hash token" is a
control sequence, i. e., any sequence of characters starting with
backslash (\).  It's not necessarily always backslash, by the way, but
usually is.  Is that what you mean?

> - First of all, I find many tokens that contain @ or ! or ^, for example 
> "tagsleft at false", "ps at headings", "\T1\^-\i", or "!!stringa": do these 
> characters have a special meaning?

  Not necessarily.  The commercial at sign (@) is often used in LaTeX2e
packages by a special convention, that dictates that its use in control
sequence names is reserved to developers writing packages, and that
users should not type them in their documents.  This enables developers
to be reasonably certain that their internal commands won't be
overwritten by users at typesetting time, and is enforced at a technical
level (by changing @'s category code); but it is no more than a
convention, and it's not uncommon for users to change the category code
themselves at times (the LaTeX kernel even provides commands to switch
back and forth).

  The command \^ takes one argument and puts a circumflex accent over
it.  The caret character is only visual and mnemonic.

  I don't know where you took "!!stringa" from, but it seems to be a
similar case to @, using the exclamation mark to ensure that the control
sequence won't be overwritten by users (as ! is usually not legal in
control sequences).

> - Why do I have so many "blank" tokens? At the end of this you'll find a 
> sample from a dump file viewed from emacs, so an encoding of special 
> characters is visible.

  I don't know what you mean.  In the file you attached, there's only
one blank line, and since you're not telling us how you produced the
file exactly, it could be anything.

> -Are tokens as 
> "<5><6><7><8><9>gen*cmbx<10><10.95>cmbx10<12><14.4><17.28><20.74><24.88>cmbx12" 
> real, or is it some kind of "encoding" that I see?

  They're not real, of course, they're imaginary tokens from the land of
Narnia.  Ah, the Narnian tokens!  Many a night I've spent hunting down
those that, like sheep, had gone astray, and turned them back to the
right path.

  (Or, they could be related to the NFSS.)

> - Are these tokens portable? I mean, a friend of mine on windows will 
> produce the very same tokens with the same document?

  Assuming again that you mean control sequences by "tokens", yes,
they're extremely portable, if they come from the LaTeX kernel.  If
they've been defined by a package, your correspondent needs to have the
same package, of course, but there usually are very few incompatibility
between OSes.  XeTeX, and to some extent LuaTeX, have changed that
partly.

> - All \label{something} seem to be processed as token "r at something". Is 
> this real, or just my imagination?

  See above about Narnia.  Seriously, I have no idea what you mean.  The
vast majority of control sequences are expandable, meaning that their
low-level meaning usually is something else than what you type.  That is
of course the whole point of a macro language; there would be little
advantage to defining commands such as \label, if all "\label{something}"
did was to print "\label{something}" on the page.  It might be that in
the course of being expanded, \label{something} produces a control
sequence \r at something; I do not know the details of how it's implemented,
and have no inclination to look into it.  I fail to see how it's
interesting anyway.

> Again, I am sorry to ask such trivial questions, but I didn't find 
> anything anywhere on the internals of TeX!

  Read the TeXbook.

	Arthur

From Robin.Fairbairns at cl.cam.ac.uk  Mon May 27 18:50:22 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Mon, 27 May 2013 17:50:22 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Mon, 27 May 2013 15:55:50 +0200.
 <51A365E6.3050902@gmail.com>
Message-ID: <8301.1369673422@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> On 5/27/13 3:31 PM, Robin Fairbairns wrote:
> > did you ever learn to swim?  did they teach you by throwing you in the
> > deep end of the pool, and telling you to read the instructions on the
> > bottom?
> 
> No, but they did ask me to enter the pool. I learned by trial and error.
> 
> > i ask, because that's what you seem to be doing here.  if you want to
> > get a feel for tex, read "tex for the impatient
> > (mirror.ctan.org:/info/impatient/book.pdf -- also available in french)
> 
> > if (as it seems) you want to learn latex, don't start with the latex
> > kernel (which is poorly commented in many places), start from the users'
> > point of view, with something like "short introduction to latex"
> > (mirror.ctan.org:/info/lshort/english/lshort.pdf -- also available in
> > several other languages)
> 
> No. I am a happy LaTeX user, I just wanted to see TeX.

so your question -- about hash tokens -- was misleading?  or do i miss
something?  have you avoided writing macros up until now?

> I honestly didn't realize that I asked something "deep" or
> "sensitive", I thought there just was some kind a cheatsheet somewhere
> that I didn't find by myself. I was wrong.

no cheatsheet, but it's not so much "deep" as "tortuous".  (though there
are depths in there, but none that

> > most people take some time to progress from user-level stuff to reading
> > the kernel's code.  (fwiw, my head often swims when reading latex
> > internals, and i've been reading it(them) on and off since the 1980s,
> > before the current latex 2e was released.)
> 
> Well, I'll find myself some time to read it, then :)

there are documented sources in http://www.ctan.org/pkg/latex-tds (that
is, the package that catalogue entry describes).  they're much better
(in parts) than reading the sources that get compiled ... there are some
parts that are no more use in those compiled packages than the code
itself (the comments being as good as useless -- one of the *really*
tricky areas of latex, the output routine, is characterised by comments
like "lots of changes here", with no hint as to what was changed or why).

robin

From elie.roux at telecom-bretagne.eu  Mon May 27 18:57:20 2013
From: elie.roux at telecom-bretagne.eu (=?ISO-8859-1?Q?=C9lie_Roux?=)
Date: Mon, 27 May 2013 18:57:20 +0200
Subject: [luatex] bugreport (too late?)
Message-ID: <51A39070.80303@telecom-bretagne.eu>

Dear all,

it seems there is a bug in the way TeXLive 2013 LuaTeX handles 
shell-escape (i386-Linux). See the attached files: when running

luatex --shell-escape bug-shell-escape.tex

test 1 should pass, instead it fails: io.popen never works, 
independently of the value of --shell-escape. It used to work before, 
has something changed? Lua manual states that io.popen is system 
dependant and might not be available on all platforms, but I guess the 
error would be different if it was not available...

Thank you,
-- 
Elie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-shell-escape.lua
Type: text/x-lua
Size: 244 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130527/e837211c/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug-shell-escape.tex
Type: text/x-tex
Size: 48 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130527/e837211c/attachment-0001.bin>

From stephanhennig at arcor.de  Mon May 27 20:08:28 2013
From: stephanhennig at arcor.de (Stephan Hennig)
Date: Mon, 27 May 2013 20:08:28 +0200
Subject: [luatex] bugreport (too late?)
In-Reply-To: <51A39070.80303@telecom-bretagne.eu>
References: <51A39070.80303@telecom-bretagne.eu>
Message-ID: <51A3A11C.2090607@arcor.de>

Am 27.05.2013 18:57, schrieb ?lie Roux:

> it seems there is a bug in the way TeXLive 2013 LuaTeX handles 
> shell-escape (i386-Linux). See the attached files: when running
> 
> luatex --shell-escape bug-shell-escape.tex
> 
> test 1 should pass, instead it fails: io.popen never works, 
> independently of the value of --shell-escape. It used to work before, 
> has something changed? Lua manual states that io.popen is system 
> dependant and might not be available on all platforms, but I guess the 
> error would be different if it was not available...

Can't confirm on Windows 7 x64.

There's identical behaviour between TL2012 and TL2013:

  * both test fail without --shell-escape,
  * both test pass with --shell-escape.

Best regards,
Stephan Hennig


From ismo.toijala at gmail.com  Mon May 27 21:19:25 2013
From: ismo.toijala at gmail.com (Ismo Toijala)
Date: Mon, 27 May 2013 21:19:25 +0200
Subject: [luatex] bugreport (too late?)
In-Reply-To: <51A3A11C.2090607@arcor.de>
References: <51A39070.80303@telecom-bretagne.eu> <51A3A11C.2090607@arcor.de>
Message-ID: <CAPd6TP1zMNC+85NjEhLBY5ZPKBSTwtcG+Q_8ewABYhm_VJwgaw@mail.gmail.com>

On Mon, May 27, 2013 at 8:08 PM, Stephan Hennig <stephanhennig at arcor.de> wrote:
> Am 27.05.2013 18:57, schrieb ?lie Roux:
>
>> it seems there is a bug in the way TeXLive 2013 LuaTeX handles
>> shell-escape (i386-Linux). See the attached files: when running
>>
>> luatex --shell-escape bug-shell-escape.tex
>
> Can't confirm on Windows 7 x64.

I can confirm the bug on x86_64-linux.
Only the second test passes with --shell-escape.

Ismo Toijala


From senseiwa at gmail.com  Tue May 28 08:53:56 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 08:53:56 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130527151524.GO31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
Message-ID: <51A45484.7030607@gmail.com>

On 5/27/13 5:15 PM, Arthur Reutenauer wrote:
>    That's your problem here.  What are you trying to do, and what were
> the errors you encountered?  So far as I can see you're not actually
> doing anything real, only asking vague questions, the purpose of which
> is not clear at all.

Well, it's not clear because I am not trying to *do* anything. I am 
trying to analyze what TeX produces (dumping the contents of 
tex.hashtokens() by the way).

So I am only looking at the tokens produced by TeX, feeding a LaTeX 
file: I know what LaTeX does, but since it uses TeX as an engine, I 
wanted to know what TeX does with my document structure (labels, 
chapters, floats, bibliographies, ...).

>    Not only is there no such document, but if it did it would probably
> not help you very much.  The problem with the word "cheatsheet" is that
> the information it contains is only valuable to you if you actually know
> something beforehand.  It doesn't really help you to cheat, more to
> quickly find something that temporarily slipped your mind, or that you
> learned a long time ago and need to brush up on.
>
>    Now, being well understood that the answers probably won't help you at
> all, there is no reason why we shouldn't try and answer your questions,
> to the extent that they make sense:

Thanks! :)


>> I am trying to grasp the meaning of the hash tokens I find in a latex
>> document. I am a novice TeX user, so please bear with my (almost surely)
>> stupid questions: I've only used LaTeX, and never looked into the pit :)
>
>    First of all, I believe that what you're calling "hash token" is a
> control sequence, i. e., any sequence of characters starting with
> backslash (\).  It's not necessarily always backslash, by the way, but
> usually is.  Is that what you mean?

Probably, except that tex.hashtokens() contains no leading "\" for many 
commands (for example endequation, while others to as \T1\.-\i).


>> - First of all, I find many tokens that contain @ or ! or ^, for example
>> "tagsleft at false", "ps at headings", "\T1\^-\i", or "!!stringa": do these
>> characters have a special meaning?
>
>    Not necessarily.  The commercial at sign (@) is often used in LaTeX2e
> packages by a special convention, that dictates that its use in control
> sequence names is reserved to developers writing packages, and that
> users should not type them in their documents.  This enables developers
> to be reasonably certain that their internal commands won't be
> overwritten by users at typesetting time, and is enforced at a technical
> level (by changing @'s category code); but it is no more than a
> convention, and it's not uncommon for users to change the category code
> themselves at times (the LaTeX kernel even provides commands to switch
> back and forth).

I understand. This means that an average LaTeX user won't even try to 
change the meaning of @, and this behavior is almost completely well 
defined.

>    The command \^ takes one argument and puts a circumflex accent over
> it.  The caret character is only visual and mnemonic.
>
>    I don't know where you took "!!stringa" from, but it seems to be a
> similar case to @, using the exclamation mark to ensure that the control
> sequence won't be overwritten by users (as ! is usually not legal in
> control sequences).

As before, I just dump to file what tex.hashtokens() contains. I can 
attach the file if needed.

>> - Why do I have so many "blank" tokens? At the end of this you'll find a
>> sample from a dump file viewed from emacs, so an encoding of special
>> characters is visible.
>
>    I don't know what you mean.  In the file you attached, there's only
> one blank line, and since you're not telling us how you produced the
> file exactly, it could be anything.

This is how I am dumping the strings:

      \directlua{
         local f = io.open("hash.txt", "w")
         for name in pairs(tex.hashtokens()) do
             f:write(name .. "\string\n")
         end
         f:close()}

Maybe I used a misleading word. I am referring to lines contain 
non-printable characters, for example:

===BEGIN===
sffamily
^A
tracingoutput
                     <=== THIS IS A TAB
^H
^K
macc at palette
^M
^L
^N
@currdir
makesm at sh
pdftrue
?\textless
@@MP:P:curveto
^Y
^[
^Z
luatexUroot
!
                     <=== THIS IS A SPACE
====END====


Control sequences as ^H seemed to me very strange, not to say that 
something is "wrong" in how I create the tokens file. Moreover, it seems 
that something is screwing with the encoding ? la UTF, for example I find

===BEGIN===
pagecolor
?,                 <=== THIS IS A WEIRD ONE
skipemptyMPgraphictrue 

====END====

With an hex editor, I find that the second line is EF BF BF 2C.

It seems to me that TeX is using a very low level encoding, which I find 
again weird (or wrong, in the sense that I don't know how to correctly 
dump the tokens).

>> -Are tokens as
>> "<5><6><7><8><9>gen*cmbx<10><10.95>cmbx10<12><14.4><17.28><20.74><24.88>cmbx12"
>> real, or is it some kind of "encoding" that I see?
>
>    They're not real, of course, they're imaginary tokens from the land of
> Narnia.  Ah, the Narnian tokens!  Many a night I've spent hunting down
> those that, like sheep, had gone astray, and turned them back to the
> right path.
>
>    (Or, they could be related to the NFSS.)


Yes, I imagined it was related to the Narnian way of encoding fonts, but 
I don't know how it encodes it (I found a document by Rahtz on TUG, but 
I see no mention of "<>").


>> - Are these tokens portable? I mean, a friend of mine on windows will
>> produce the very same tokens with the same document?
>
>    Assuming again that you mean control sequences by "tokens", yes,
> they're extremely portable, if they come from the LaTeX kernel.  If
> they've been defined by a package, your correspondent needs to have the
> same package, of course, but there usually are very few incompatibility
> between OSes.  XeTeX, and to some extent LuaTeX, have changed that
> partly.

That is good news, I like portability :)

>> - All \label{something} seem to be processed as token "r at something". Is
>> this real, or just my imagination?
>
>    See above about Narnia.  Seriously, I have no idea what you mean.  The
> vast majority of control sequences are expandable, meaning that their
> low-level meaning usually is something else than what you type.  That is
> of course the whole point of a macro language; there would be little
> advantage to defining commands such as \label, if all "\label{something}"
> did was to print "\label{something}" on the page.  It might be that in
> the course of being expanded, \label{something} produces a control
> sequence \r at something; I do not know the details of how it's implemented,
> and have no inclination to look into it.

> I fail to see how it's interesting anyway.


You don't have this interest, it's ok, but I really do! I like to know 
how something works! ;)


>> Again, I am sorry to ask such trivial questions, but I didn't find
>> anything anywhere on the internals of TeX!
>
>    Read the TeXbook.

I will, I promise. And I am curious about these internals.


Thanks!





From senseiwa at gmail.com  Tue May 28 08:55:47 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 08:55:47 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <8301.1369673422@cl.cam.ac.uk>
References: <8301.1369673422@cl.cam.ac.uk>
Message-ID: <51A454F3.5060201@gmail.com>

On 5/27/13 6:50 PM, Robin Fairbairns wrote:

> so your question -- about hash tokens -- was misleading?  or do i miss
> something?  have you avoided writing macros up until now?

Except for basic \newcommand lines, yes, I just used LaTeX as a user.

> there are documented sources in http://www.ctan.org/pkg/latex-tds (that
> is, the package that catalogue entry describes).  they're much better
> (in parts) than reading the sources that get compiled ... there are some
> parts that are no more use in those compiled packages than the code
> itself (the comments being as good as useless -- one of the *really*
> tricky areas of latex, the output routine, is characterised by comments
> like "lots of changes here", with no hint as to what was changed or why).


Well, I will take a look at those codes, even though they contain 
comments without any info.


Thanks!



From luigi.scarso at gmail.com  Tue May 28 08:59:41 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 May 2013 08:59:41 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A45484.7030607@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
Message-ID: <CAG5iGsD=-of3Z-H772WFJkPpiN4cHHjpO-YrpFF4ZqVF6=W7kA@mail.gmail.com>

On Tue, May 28, 2013 at 8:53 AM, Sensei <senseiwa at gmail.com> wrote:

> This is how I am dumping the strings:
>
>      \directlua{
>         local f = io.open("hash.txt", "w")
>         for name in pairs(tex.hashtokens()) do
>             f:write(name .. "\string\n")
>         end
>         f:close()}
>
> For luatex you can see
http://www.luatex.org/documentation.html



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130528/f5c5374d/attachment-0001.html>

From martin at oneiros.de  Tue May 28 09:06:20 2013
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 28 May 2013 09:06:20 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A45484.7030607@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
Message-ID: <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>

2013/5/28 Sensei <senseiwa at gmail.com>:
> Well, it's not clear because I am not trying to *do* anything. I am trying
> to analyze what TeX produces (dumping the contents of tex.hashtokens() by
> the way).

Why? Did you learn C by analyzing .o-Files?
TeX is well documented - read the documentation.
Wikipedia would be one way to start.


Best
   Martin

From senseiwa at gmail.com  Tue May 28 09:27:47 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 09:27:47 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
Message-ID: <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>

On Tue, May 28, 2013 at 9:06 AM, Martin Schr?der <martin at oneiros.de> wrote:
> Why? Did you learn C by analyzing .o-Files?

No, but after knowing to program in C, you might want to know how your
program is encoded, and yes, I know how object files are created (not
only with C, by the way).

Under your comparison, C is LaTeX, and an object file is TeX (I don't
care about the dvi right now).

> TeX is well documented - read the documentation.
> Wikipedia would be one way to start.

As I said, I will.

However, I find the translation from C to object much easier: the
number of segments in an object files roughly compares to the number
of functions contained in the original source code. It seems that
LaTeX commands are much more complex than I've thought.


From Robin.Fairbairns at cl.cam.ac.uk  Tue May 28 11:29:21 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Tue, 28 May 2013 10:29:21 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Tue, 28 May 2013 09:06:20 +0200.
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
Message-ID: <4858.1369733361@cl.cam.ac.uk>

Martin Schr?der <martin at oneiros.de> wrote:

> 2013/5/28 Sensei <senseiwa at gmail.com>:
> > Well, it's not clear because I am not trying to *do* anything. I am trying
> > to analyze what TeX produces (dumping the contents of tex.hashtokens() by
> > the way).
> 
> Why? Did you learn C by analyzing .o-Files?

surely that wouldn't work, given that .o files aren't a linear mapping
of the input, whereas tex tokenisation is nearly linear.

(fwiw, i learned c by osmosis from decades of writing fortran and a fair
time writing pascal.  as a result, i once slipped up in a job interview
spouting pascal where i had been asked for c ;-)

> TeX is well documented - read the documentation.
> Wikipedia would be one way to start.

in other messages, it's become plain that sensei has some experience of
_writing_ tex ... just wants to "look under the bonnet[*]" -- about
which tex documentation is rather short.

i'm not going to blame sensei for that, but i'm not sure what to
recommend.

robin

[*] this is english for what the americans call "hood"


From arthur.reutenauer at normalesup.org  Tue May 28 11:58:35 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 10:58:35 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAG5iGsD=-of3Z-H772WFJkPpiN4cHHjpO-YrpFF4ZqVF6=W7kA@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAG5iGsD=-of3Z-H772WFJkPpiN4cHHjpO-YrpFF4ZqVF6=W7kA@mail.gmail.com>
Message-ID: <20130528095835.GU31062@phare.normalesup.org>

> For luatex you can see
> http://www.luatex.org/documentation.html

  Evidently he's already found some documentation about LuaTeX, since he
came across tex.hashtokens(), whose output he's now inflicting upon us.

	Arthur

From luigi.scarso at gmail.com  Tue May 28 12:06:11 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 May 2013 12:06:11 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528095835.GU31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAG5iGsD=-of3Z-H772WFJkPpiN4cHHjpO-YrpFF4ZqVF6=W7kA@mail.gmail.com>
 <20130528095835.GU31062@phare.normalesup.org>
Message-ID: <CAG5iGsC1AB_NYxpUT8ENc8PBzeO-u7A3tq7bhWMmFX+wCBxLkg@mail.gmail.com>

On Tue, May 28, 2013 at 11:58 AM, Arthur Reutenauer <
arthur.reutenauer at normalesup.org> wrote:

>
>   Evidently
>
evidently... strong word for TeX... I still haven't found when/where to use
it ...
imho it should be forbidden, or at least replaced by "probably".
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130528/7304aeda/attachment.html>

From arthur.reutenauer at normalesup.org  Tue May 28 12:06:55 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 11:06:55 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
Message-ID: <20130528100655.GV31062@phare.normalesup.org>

> Under your comparison, C is LaTeX, and an object file is TeX (I don't
> care about the dvi right now).

  That doesn't make any sense.  TeX is a program, you can't compare it
to a file format.  A comparison that would make more sense is that C is
TeX, the object file is TeX's hash table (that is usually not dumped on
file), and up to now you've not really used TeX itself, but a macro
package, LaTeX, that provides a convenient user interface to it.

> However, I find the translation from C to object much easier: the
> number of segments in an object files roughly compares to the number
> of functions contained in the original source code. It seems that
> LaTeX commands are much more complex than I've thought.

  That's because they're macros, and -- presumably -- you've only used
the high-level user interface up to now.  Hence you seem disturbed by
the fact that LaTeX defines many more commands that you've used until
now; but you shouldn't.  If you look at LaTeX's source code it should be
much clearer.

	Arthur

From arthur.reutenauer at normalesup.org  Tue May 28 12:08:57 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 11:08:57 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAG5iGsC1AB_NYxpUT8ENc8PBzeO-u7A3tq7bhWMmFX+wCBxLkg@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAG5iGsD=-of3Z-H772WFJkPpiN4cHHjpO-YrpFF4ZqVF6=W7kA@mail.gmail.com>
 <20130528095835.GU31062@phare.normalesup.org>
 <CAG5iGsC1AB_NYxpUT8ENc8PBzeO-u7A3tq7bhWMmFX+wCBxLkg@mail.gmail.com>
Message-ID: <20130528100857.GW31062@phare.normalesup.org>

  "Evidently" qualifies "he's already found" in my sentence.  And it
doesn't mean the same as "obviously".

	Arthur

From arthur.reutenauer at normalesup.org  Tue May 28 13:01:39 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 12:01:39 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A45484.7030607@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
Message-ID: <20130528110139.GX31062@phare.normalesup.org>

> Well, it's not clear because I am not trying to *do* anything.

  That's what I'm saying, it's a problem.

>                                                                I am
> trying to analyze what TeX produces (dumping the contents of
> tex.hashtokens() by the way).

  Oh, so that was it ...  Well, I can say with confidence that there
were probably only three to five people in the world who had any chance
of understanding what you meant by "hash tokens", in your original
email, and none of them is contributing to this discussion (but one of
them definitely is subscribed to this list ;-)

  So part of what I said earlier doesn't apply, you really are looking
at TeX's hash table.  This is yet different, and happens at a very low
level.  The documentation for that is in tex.web, and the change files
for the different extensions.  You're not really doing yourself a favour
by starting with LuaTeX; better to start with Knuth's TeX, in my
opinion.  Its source code, along with the comments, actually is
published as a book.

> So I am only looking at the tokens produced by TeX, feeding a LaTeX
> file: I know what LaTeX does, but since it uses TeX as an engine, I
> wanted to know what TeX does with my document structure (labels,
> chapters, floats, bibliographies, ...).

  Which is absurd: shouldn't you look at the source code of *LaTeX*
first, before looking at a dump of TeX's memory?  It's almost like you
want to be confused.

> As before, I just dump to file what tex.hashtokens() contains. I can
> attach the file if needed.

  Yes, obviously, we need the source file.  Did you really imagine that
we could say anything substantial about random bits of TeX's memory
without knowing what the input was?

> ===BEGIN===
> sffamily
> ^A
> tracingoutput
>                     <=== THIS IS A TAB
> ^H
> ^K
> macc at palette
> ^M
> ^L
> ^N
> @currdir
> makesm at sh
> pdftrue
> ?\textless
> @@MP:P:curveto
> ^Y
> ^[
> ^Z
> luatexUroot
> !
>                     <=== THIS IS A SPACE
> ====END====

  OK, so you meant white space.  Blank is indeed a misleading word to
call these strings.  Yes, there may be white space.  Why does it bother
you?  "\ " actually is a pretty common user-level command of TeX.

> ===BEGIN===
> pagecolor
> ?,                 <=== THIS IS A WEIRD ONE
> skipemptyMPgraphictrue
> 
> ====END====
> 
> With an hex editor, I find that the second line is EF BF BF 2C.

  This is perfectly valid UTF-8, it's the byte sequence for two
characters: U+FFFF and U+002C.  The former is not supposed to be used in
files, and usually appears as a replacement of an invalid character, and
the latter is simply a comma.

> It seems to me that TeX is using a very low level encoding, which I
> find again weird (or wrong, in the sense that I don't know how to
> correctly dump the tokens).

  You may have dumped the tokens correctly, there is a lot of low-level
stuff in TeX.  What's surprising to me is that you find it weird!

> Yes, I imagined it was related to the Narnian way of encoding fonts,
> but I don't know how it encodes it (I found a document by Rahtz on
> TUG, but I see no mention of "<>").

  Look again, then.  The long string you quoted (<5><6> etc.) clearly is
the fifth argument to \DeclareFontShape, one of the standard NFSS
commands.  It's part of the LaTeX2e and is documented in several places,
for example the LaTeX Companion, or, for a free resource,
doc/latex/base/fntguide.pdf in most TeX distributions.

>>    See above about Narnia.  Seriously, I have no idea what you mean.  The
>> vast majority of control sequences are expandable, meaning that their
>> low-level meaning usually is something else than what you type.  That is
>> of course the whole point of a macro language; there would be little
>> advantage to defining commands such as \label, if all "\label{something}"
>> did was to print "\label{something}" on the page.  It might be that in
>> the course of being expanded, \label{something} produces a control
>> sequence \r at something; I do not know the details of how it's implemented,
>> and have no inclination to look into it.
> 
>> I fail to see how it's interesting anyway.
> 
> 
> You don't have this interest, it's ok, but I really do! I like to
> know how something works! ;)

  You're missing the point.  Producing \r at something is *one of the many*
things that happens when you type \label{something}; it's probably the
control sequence whose name is most obviously related to the label you
created, but there is nothing special about that particular control
sequence.  That's why I remarked that it's not an interesting fact, and
you probably wouldn't have noticed it, hadn't it been for your biased
approach of looking at static memory dumps.

  Far more interesting are the different commands defined by LaTeX when
\label is called, look for "ltxref.dtx" in latex.ltx.  The letter "r"
(in \r at something) is introduced in a macro called \newlabel (line 3881
of my copy of latex.ltx), and "@" in \@newl at bel, one line above it.

	Arthur

From senseiwa at gmail.com  Tue May 28 12:55:42 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 12:55:42 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528100655.GV31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
Message-ID: <51A48D2E.3000203@gmail.com>

On 5/28/13 12:06 PM, Arthur Reutenauer wrote:
>> Under your comparison, C is LaTeX, and an object file is TeX (I don't
>> care about the dvi right now).
>
>    That doesn't make any sense.  TeX is a program, you can't compare it
> to a file format.  A comparison that would make more sense is that C is
> TeX, the object file is TeX's hash table (that is usually not dumped on
> file), and up to now you've not really used TeX itself, but a macro
> package, LaTeX, that provides a convenient user interface to it.

Since I am not a TeX user, I compared the "LaTeX output/under the hood" 
to an object file.

>> However, I find the translation from C to object much easier: the
>> number of segments in an object files roughly compares to the number
>> of functions contained in the original source code. It seems that
>> LaTeX commands are much more complex than I've thought.
>
>    That's because they're macros, and -- presumably -- you've only used
> the high-level user interface up to now.  Hence you seem disturbed by
> the fact that LaTeX defines many more commands that you've used until
> now; but you shouldn't.  If you look at LaTeX's source code it should be
> much clearer.

I have tried, but it's not like what I expected. I know how to walk 
through a program in source code, because that's what I'm accustomed to: 
I find LaTeX's source code very different, I find myself wandering 
around without any clear and sharp indication on a "main".

I guess I will read the TeX book, first.


Cheers!



From arthur.reutenauer at normalesup.org  Tue May 28 13:39:43 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 12:39:43 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A48D2E.3000203@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
 <51A48D2E.3000203@gmail.com>
Message-ID: <20130528113943.GY31062@phare.normalesup.org>

> Since I am not a TeX user, I compared the "LaTeX output/under the
> hood" to an object file.

  That comparison clearly doesn't work at this point.  Let's just move
on.

> I have tried, but it's not like what I expected.

  Who would have guessed ...

>                                                  I know how to walk
> through a program in source code, because that's what I'm accustomed
> to: I find LaTeX's source code very different, I find myself
> wandering around without any clear and sharp indication on a "main".

  You need to get rid of your misconceptions about programming, first.
latex.ltx is a "program in source code" too, if you expected it to look
different, you need to change your expectations and learn about this way
of programming.  Many languages don't need a "main" at all; you seem to
come from an imperative programming point of view, but that's not the
only one.

> I guess I will read the TeX book, first.

  Probably one of the best choices.

	Arthur

From pragma at wxs.nl  Tue May 28 14:48:27 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Tue, 28 May 2013 14:48:27 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528113943.GY31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org>
Message-ID: <51A4A79B.3060509@wxs.nl>

On 5/28/2013 1:39 PM, Arthur Reutenauer wrote:
>> Since I am not a TeX user, I compared the "LaTeX output/under the
>> hood" to an object file.
>
>    That comparison clearly doesn't work at this point.  Let's just move
> on.
>
>> I have tried, but it's not like what I expected.
>
>    Who would have guessed ...
>
>>                                                   I know how to walk
>> through a program in source code, because that's what I'm accustomed
>> to: I find LaTeX's source code very different, I find myself
>> wandering around without any clear and sharp indication on a "main".
>
>    You need to get rid of your misconceptions about programming, first.
> latex.ltx is a "program in source code" too, if you expected it to look
> different, you need to change your expectations and learn about this way
> of programming.  Many languages don't need a "main" at all; you seem to
> come from an imperative programming point of view, but that's not the
> only one.
>
>> I guess I will read the TeX book, first.
>
>    Probably one of the best choices.

Another option is buying a real big hard disk, start the document with 
\tracingall (top of file), have a coffee break (or take a walk, or read 
tex-by-topic), locate the log file, find an editor that can load this 
beast and start deciphering what happens in there. Best take a real 
document, with proper font usage and lots of structure, lists and 
referencing as well as some interactive features.

Looking at the hash is rather useless as figuring out the expansion 
chain is non trivial (comparable to reading assembler, cpu instructions 
or bytecode). Looking at a traced log at least gives an impression of 
what *happens* which is a good first step.

(I didn't really follow this thread, but tex usage is normally layered: 
primitives, basic helper code, macro package, user code, and subsystems 
like those for fonts can be pretty big and complex and one needs to 
understand a bit about what typesetting and such is about in order to 
get the picture.)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Tue May 28 14:54:40 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 13:54:40 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4A79B.3060509@wxs.nl>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
 <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org>
 <51A4A79B.3060509@wxs.nl>
Message-ID: <20130528125440.GZ31062@phare.normalesup.org>

> Looking at the hash is rather useless as figuring out the expansion
> chain is non trivial (comparable to reading assembler, cpu
> instructions or bytecode). Looking at a traced log at least gives an
> impression of what *happens* which is a good first step.

  Sounds like fun indeed :-)

	Arthur

From senseiwa at gmail.com  Tue May 28 15:04:24 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 15:04:24 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528110139.GX31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
Message-ID: <51A4AB58.4060700@gmail.com>

On 5/28/13 1:01 PM, Arthur Reutenauer wrote:

>> I am trying to analyze what TeX produces (dumping the contents of
>> tex.hashtokens() by the way).
>
>    Oh, so that was it ...  Well, I can say with confidence that there
> were probably only three to five people in the world who had any chance
> of understanding what you meant by "hash tokens", in your original
> email, and none of them is contributing to this discussion (but one of
> them definitely is subscribed to this list ;-)


I supposed it was clear, because I posted to luatex asking about hash 
tokens. I was obviously misleading others! :)

>    So part of what I said earlier doesn't apply, you really are looking
> at TeX's hash table.  This is yet different, and happens at a very low
> level.  The documentation for that is in tex.web, and the change files
> for the different extensions.  You're not really doing yourself a favour
> by starting with LuaTeX; better to start with Knuth's TeX, in my
> opinion.  Its source code, along with the comments, actually is
> published as a book.


Good to know, I supposed I could start by getting a low level 
impression, the same way I do when asking for symbols in an object 
files, and next take a look at the disassembly.

>> So I am only looking at the tokens produced by TeX, feeding a LaTeX
>> file: I know what LaTeX does, but since it uses TeX as an engine, I
>> wanted to know what TeX does with my document structure (labels,
>> chapters, floats, bibliographies, ...).
>
>    Which is absurd: shouldn't you look at the source code of *LaTeX*
> first, before looking at a dump of TeX's memory?  It's almost like you
> want to be confused.

That is not my purpose, and by the way, yes I look at the memory when 
trying to figure out how a piece of software works (it's part of my 
job), especially when you assume that you don't have the source code.


>> As before, I just dump to file what tex.hashtokens() contains. I can
>> attach the file if needed.
>
>    Yes, obviously, we need the source file.  Did you really imagine that
> we could say anything substantial about random bits of TeX's memory
> without knowing what the input was?


I attached parts of it, since the symbol table is 70K.


>
>> ===BEGIN===
>> sffamily
>> ^A
>> tracingoutput
>>                      <=== THIS IS A TAB
>> ^H
>> ^K
>> macc at palette
>> ^M
>> ^L
>> ^N
>> @currdir
>> makesm at sh
>> pdftrue
>> ?\textless
>> @@MP:P:curveto
>> ^Y
>> ^[
>> ^Z
>> luatexUroot
>> !
>>                      <=== THIS IS A SPACE
>> ====END====
>
>    OK, so you meant white space.  Blank is indeed a misleading word to
> call these strings.  Yes, there may be white space.  Why does it bother
> you?  "\ " actually is a pretty common user-level command of TeX.

Because it's new. I thought of it as an escaping in C, a sort, let's say 
this, of protection of the next character, as in \% (the same way in C 
for \").


>> ===BEGIN===
>> pagecolor
>> ?,                 <=== THIS IS A WEIRD ONE
>> skipemptyMPgraphictrue
>>
>> ====END====
>>
>> With an hex editor, I find that the second line is EF BF BF 2C.
>
>    This is perfectly valid UTF-8, it's the byte sequence for two
> characters: U+FFFF and U+002C.  The former is not supposed to be used in
> files, and usually appears as a replacement of an invalid character, and
> the latter is simply a comma.

Yes, I knew that once opened the hash file with an hex editor. I knew 
TeX didn't have support for unicode, and I thought that lualatex 
translated into TeX, which produced an output. So a unicode string was 
unexpected, and I thought I messed up with my dump code.

>> It seems to me that TeX is using a very low level encoding, which I
>> find again weird (or wrong, in the sense that I don't know how to
>> correctly dump the tokens).
>
>    You may have dumped the tokens correctly, there is a lot of low-level
> stuff in TeX.  What's surprising to me is that you find it weird!


Pardon me, but I'm used to write code in C, assembly, C++, or whatever 
other programming language (mainly those three, in that order). TeX is 
very, very different.


>> Yes, I imagined it was related to the Narnian way of encoding fonts,
>> but I don't know how it encodes it (I found a document by Rahtz on
>> TUG, but I see no mention of "<>").
>
>    Look again, then.  The long string you quoted (<5><6> etc.) clearly is
> the fifth argument to \DeclareFontShape, one of the standard NFSS
> commands.  It's part of the LaTeX2e and is documented in several places,
> for example the LaTeX Companion, or, for a free resource,
> doc/latex/base/fntguide.pdf in most TeX distributions.

Good!


>> You don't have this interest, it's ok, but I really do! I like to
>> know how something works! ;)
>
>    You're missing the point.  Producing \r at something is *one of the many*
> things that happens when you type \label{something}; it's probably the
> control sequence whose name is most obviously related to the label you
> created, but there is nothing special about that particular control
> sequence.  That's why I remarked that it's not an interesting fact, and
> you probably wouldn't have noticed it, hadn't it been for your biased
> approach of looking at static memory dumps.
>
>    Far more interesting are the different commands defined by LaTeX when
> \label is called, look for "ltxref.dtx" in latex.ltx.  The letter "r"
> (in \r at something) is introduced in a macro called \newlabel (line 3881
> of my copy of latex.ltx), and "@" in \@newl at bel, one line above it.

That is awesome, I now have a place to start!

Anyway, at some point there *is* a static version of a code somewhere, 
otherwise there would be no output. Yes, I am biased by my job and 
education, but I find hard to grasp the opposition to this approach.

You look "top down", I use the "bottom up" approach :)












From senseiwa at gmail.com  Tue May 28 15:09:56 2013
From: senseiwa at gmail.com (Sensei)
Date: Tue, 28 May 2013 15:09:56 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4A79B.3060509@wxs.nl>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
Message-ID: <51A4ACA4.3090002@gmail.com>

On 5/28/13 2:48 PM, Hans Hagen wrote:

> Another option is buying a real big hard disk, start the document with
> \tracingall (top of file), have a coffee break (or take a walk, or read
> tex-by-topic), locate the log file, find an editor that can load this
> beast and start deciphering what happens in there. Best take a real
> document, with proper font usage and lots of structure, lists and
> referencing as well as some interactive features.

Good, I've just loaded it and it's like looking at a compiler's chain of 
substitutions... on steroids (17K lines).

> Looking at the hash is rather useless as figuring out the expansion
> chain is non trivial (comparable to reading assembler, cpu instructions
> or bytecode). Looking at a traced log at least gives an impression of
> what *happens* which is a good first step.

Well, I do that, I write also in assembly and it's not that bad! As I 
said elsewhere, a static version is also interesting.

I will get deeper into latex source code!


From luigi.scarso at gmail.com  Tue May 28 17:53:12 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 28 May 2013 17:53:12 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4AB58.4060700@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
Message-ID: <CAG5iGsBCGXmw-AidWCojP=Yo=8sNbAV5WknSwyi62Sz4P181Hw@mail.gmail.com>

On Tue, May 28, 2013 at 3:04 PM, Sensei <senseiwa at gmail.com> wrote:

>
>
> Pardon me, but I'm used to write code in C, assembly, C++, or whatever
> other programming language (mainly those three, in that order). TeX is
> very, very different.
>
> Another option is to download the source of luatex, compile it with the
--debug switch
and then run luatex with gdb.
Probably (not evidently nor obviously)  you need a format: you can install
a context standalone which has a plain fmt easy to build.
TeX is a procedural markup  language where everything, even a character,
is a procedure (or macro ),
luatex, pdftex,xetex,etex are interpreters of TeX with some differences on
the languages accepted,
but basically they all are Syntax-Directed Interpreters: a big switch/case
inside a while that dispatches the tokens from the lexer
to the right subroutines (iirc it's called main_control in maincontrol.w,
the cweb file).
The main difference from others similar languages probably is the fact that
the user can modify the meaning of the tokens,
more or less as if  were able to modify the keywords of C --- so  TeX is a
kind of meta SDI ;
also it's carefully designed to be platform independent (but as  say
previously you should see
http://www.tug.org/texinfohtml/web2c.html#Memory-dumps)
With  a debugged version of luatex , the plain format from standalone and
test.tex like
Hello\bye
you can see TeX in action running gdb with
luatex --fmt=luatex-plain.fmt test.tex


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130528/13b4f337/attachment.html>

From arthur.reutenauer at normalesup.org  Tue May 28 18:11:46 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 17:11:46 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4AB58.4060700@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
Message-ID: <20130528161146.GC31062@phare.normalesup.org>

> I supposed it was clear, because I posted to luatex asking about
> hash tokens. I was obviously misleading others! :)

  You really could have simply mentioned you were using tex.hashtokens()
from the LuaTeX library.  "Hash token" is not part of the standard TeX
vocabulary, but "token" is, with a different meaning.

> That is not my purpose, and by the way, yes I look at the memory
> when trying to figure out how a piece of software works (it's part
> of my job), especially when you assume that you don't have the
> source code.

  OK, but you do have the source code here: why refuse to use it?

> I attached parts of it, since the symbol table is 70K.

  I can't see anything attached, and I meant the TeX source anyway.
That's the input.

> Because it's new. I thought of it as an escaping in C, a sort, let's
> say this, of protection of the next character, as in \% (the same
> way in C for \").

  That's understandable, but TeX's control sequence mechanism is
different from escaping.  A control sequence is anything starting with a
character having category code 0 -- that character is usually \, but can
actually be anything -- and that translates to something else during
macro expansion.  And you can even make \ a part of a control sequence's
name, if you want, but that's a little bit convoluted (and not very
useful).

  And I did leave several parts out, read the TeXbook for the full story.

> Yes, I knew that once opened the hash file with an hex editor. I
> knew TeX didn't have support for unicode, and I thought that
> lualatex translated into TeX, which produced an output. So a unicode
> string was unexpected, and I thought I messed up with my dump code.

  That's another misconception, I'm afraid.  LuaTeX doesn't translate to
TeX, it is an extension of TeX.  It augments the original code base with
many new features -- including, obviously, Lua -- and its input and
output are in UTF-8 (by default).

  (And the code base has been converted from Pascal to C, etc., etc.,
there are many subtopics to that aspect.)

> Pardon me, but I'm used to write code in C, assembly, C++, or
> whatever other programming language (mainly those three, in that
> order). TeX is very, very different.

  Yes, and it is a programming language too (specifically, a macro
language).  It would be useful if you would stop resisting the notion.

>>    Far more interesting are the different commands defined by LaTeX when
>> \label is called, look for "ltxref.dtx" in latex.ltx.  The letter "r"
>> (in \r at something) is introduced in a macro called \newlabel (line 3881
>> of my copy of latex.ltx), and "@" in \@newl at bel, one line above it.
> 
> That is awesome, I now have a place to start!

  I still don't see what's exciting about these few macros, but if it
makes you happy ...

> Anyway, at some point there *is* a static version of a code
> somewhere, otherwise there would be no output.

  I'm not sure that makes sense, but let's just leave it at that for the
time being.

>                                                Yes, I am biased by
> my job and education, but I find hard to grasp the opposition to
> this approach.

  I can't believe I'm reading that.  *You* are the one coming towards
TeX with a huge bias and a host of misconceptions, and you're talking
about opposition to your approach on *our* part?  You freely admit that
you don't understand the way a source file is structured, and you want
us to help you analyse a file that you've produced according to your own
taste, without even showing us what the input was?  You won't tell us
your name, and use a pseudonym that, when you're in the position of a
student, is at best snooty?  If it wasn't for our expertise, your
approach wouldn't have led you anywhere.  Sensei my *ss.

	Arthur

From martin at oneiros.de  Tue May 28 18:29:15 2013
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Tue, 28 May 2013 18:29:15 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4AB58.4060700@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
Message-ID: <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>

2013/5/28 Sensei <senseiwa at gmail.com>:
> I knew TeX didn't have support for unicode, and I thought that
> lualatex translated into TeX, which produced an output.

Seriously: Where did you get that idea? Did you smoke something?
Because if you had done _any_ _research_ (like using Google and then
reading the Wikipedia article on LuaTeX) you would know that your
"thought" is wrong.

Are you a troll?

Best
   Martin

From khaledhosny at eglug.org  Tue May 28 21:02:58 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 28 May 2013 21:02:58 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528161146.GC31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <20130528161146.GC31062@phare.normalesup.org>
Message-ID: <20130528190258.GA25477@khaled-laptop>

On Tue, May 28, 2013 at 05:11:46PM +0100, Arthur Reutenauer wrote:
> Sensei my *ss.

ROFL.

(I had to lookup Sensei in Wikipedia to get it :))

From khaledhosny at eglug.org  Tue May 28 21:05:37 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Tue, 28 May 2013 21:05:37 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
Message-ID: <20130528190537.GB25477@khaled-laptop>

On Tue, May 28, 2013 at 06:29:15PM +0200, Martin Schr?der wrote:
> Are you a troll?

No, he is someone trying to understand TeX without making any attempt to
understand it, may be there is a word for that.

Regards,
Khaled

From furrabi at gmail.com  Tue May 28 21:25:05 2013
From: furrabi at gmail.com (=?UTF-8?B?VGjDqXLDqHNlIEJvbmlu?=)
Date: Tue, 28 May 2013 15:25:05 -0400
Subject: [luatex] shrinking italics
Message-ID: <CALytN1udzwWk7RNexF5_etr2RxEKyGJ5D90BWHiC53P84gfuGw@mail.gmail.com>

Dear all,

I bought Adobe Jenson Pro Opticals and used it with pleasure until
sometime this year, when suddenly any instance of italics after the
first page was too small.  Unfortunately, since I don?t have occasion
to use the font every day, I didn?t notice exactly which packages had
just been updated when the problem began.  Any ideas how I might go
about solving the difficulty?

I?m using LuaTeX version beta-0.70.2-2012062812 (TeX Live 2012),
fontspec 2013/03/16 v2.3a, and Adobe Jenson Pro version 2.053 on
Debian GNU/Linux.  Specifying ?Scale=1? or
?ItalicFeatures={Scale=MatchLowercase}? hasn?t helped, and neither has
deleting the temp-ajensonpro... files in luatex?s cache.

Attached are a minimal working example and the PDF output.

Thanks for any insights you can offer.  I wish I could send everyone
the fonts to play with, but Adobe would have my head!

Th?r?se Bonin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Jenson_italics.tex
Type: application/x-tex
Size: 816 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130528/53c66a23/attachment-0001.tex>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Jenson_italics-secured.pdf
Type: application/pdf
Size: 33469 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130528/53c66a23/attachment-0001.pdf>

From arthur.reutenauer at normalesup.org  Tue May 28 22:28:19 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 21:28:19 +0100
Subject: [luatex] shrinking italics
In-Reply-To: <CALytN1udzwWk7RNexF5_etr2RxEKyGJ5D90BWHiC53P84gfuGw@mail.gmail.com>
References: <CALytN1udzwWk7RNexF5_etr2RxEKyGJ5D90BWHiC53P84gfuGw@mail.gmail.com>
Message-ID: <20130528202819.GG31062@phare.normalesup.org>

	Hello Th?r?se,

  Thank you for the very precise bug report.  I actually have Adobe
Jenson Pro, but in a much older version (1.01299), and unfortunately I'm
not able to reproduce your problem.

  I can however observe something in the PDF you sent: pdffonts reports
that it contains three fonts, namely

name                                 type              emb sub uni object ID
------------------------------------ ----------------- --- --- --- ---------
YQTGAU+AJensonPro-Regular            CID Type 0C       yes yes yes      6  0
FOLTBU+AJensonPro-It                 CID Type 0C       yes yes yes      7  0
OCAHSN+AJensonPro-ItCapt             CID Type 0C       yes yes yes     11  0

where "Capt" in the name of the last one must stand for "caption",
Adobe's lingo for the smallest optical size in their fonts.  That would
explain why your text is suddenly much too small; but unfortunately I
don't know why issuing \itshape twice in a row confuses fontspec.

  You could try two things, however:

  1. Delete the name database in the cache (it should be in
     luatex-cache/generic/names, next to where the font cache is).  I
can't guarantee that it will work better, but it's always worth a try.

  2. TeX Live 2013 is being finalised, and you can download a
     pre-release version (see http://tug.org/texlive/pretest.html for
details).  Unfortunately there is no straightforward way to upgrade from
TeX Live 2012, it's best to just re-download everything.  A lot of work
has been done recently on luaotfload, the low-level font loader on which
fontspec relies for LuaTeX, and it's quite possible that using this
version will help.  In fact, that's what I'm using myself, and I still
have the weird behaviour where the italic font is included twice, but
luaotfload seems to at least pick the right one each time:

name                                 type              emb sub uni object ID
------------------------------------ ----------------- --- --- --- ---------
ADXFMD+AJensonPro-Regular            CID Type 0C       yes yes yes      4  0
SFXVJW+AJensonPro-It                 CID Type 0C       yes yes yes      5  0
ZUHANK+AJensonPro-It                 CID Type 0C       yes yes yes     11  0

  So there's hope yet :-)  (Including the font twice should clearly be
considered a bug, but at least it doesn't affect the visual display).

	Best,

		Arthur

From arthur.reutenauer at normalesup.org  Tue May 28 22:40:43 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Tue, 28 May 2013 21:40:43 +0100
Subject: [luatex] shrinking italics
In-Reply-To: <20130528202819.GG31062@phare.normalesup.org>
References: <CALytN1udzwWk7RNexF5_etr2RxEKyGJ5D90BWHiC53P84gfuGw@mail.gmail.com>
 <20130528202819.GG31062@phare.normalesup.org>
Message-ID: <20130528204043.GH31062@phare.normalesup.org>

  Sorry, replying to myself:

  In fact, switching back to TeX Live 2012, I can reproduce your exact
problem, with all the italic text in a tiny size after the first chunk,
and pdffonts reporting that Jenson Italics Caption is included in the
PDF (should have tried that first).  So if you're up for downloading 2GB
of TeX stuff this afternoon, it would seem like this would solve your
problem ;-)

	Arthur

From furrabi at gmail.com  Tue May 28 22:53:45 2013
From: furrabi at gmail.com (=?UTF-8?B?VGjDqXLDqHNlIEJvbmlu?=)
Date: Tue, 28 May 2013 16:53:45 -0400
Subject: [luatex] shrinking italics
In-Reply-To: <20130528204043.GH31062@phare.normalesup.org>
References: <CALytN1udzwWk7RNexF5_etr2RxEKyGJ5D90BWHiC53P84gfuGw@mail.gmail.com>
 <20130528202819.GG31062@phare.normalesup.org>
 <20130528204043.GH31062@phare.normalesup.org>
Message-ID: <CALytN1tixUE5_aCHJ3GmjU9iKTZWLC1uo3-Sw8VmwT8cZ2yvww@mail.gmail.com>

Thanks for the good news, Arthur.  I?m running out of disk space here,
but next time I?m on campus, where there?s plenty of space, I?ll try
the pre-test.

Th?r?se

On Tue, May 28, 2013 at 4:40 PM, Arthur Reutenauer
<arthur.reutenauer at normalesup.org> wrote:
>   Sorry, replying to myself:
>
>   In fact, switching back to TeX Live 2012, I can reproduce your exact
> problem, with all the italic text in a tiny size after the first chunk,
> and pdffonts reporting that Jenson Italics Caption is included in the
> PDF (should have tried that first).  So if you're up for downloading 2GB
> of TeX stuff this afternoon, it would seem like this would solve your
> problem ;-)
>
>         Arthur


From reinhard.kotucha at web.de  Wed May 29 00:32:17 2013
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Wed, 29 May 2013 00:32:17 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A4ACA4.3090002@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
 <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org>
 <51A4A79B.3060509@wxs.nl> <51A4ACA4.3090002@gmail.com>
Message-ID: <20901.12401.601219.786747@zaphod.ms25.net>

On 2013-05-28 at 15:09:56 +0200, Sensei wrote:

 > I will get deeper into latex source code!

I fear that you have to read the TeXbook first.  LaTeX is a macro
package written in TeX.  The TeXbook describes the programming
language.  TeX is quite different from C and similar languages.
You'll certainly fail if you're not aware of its basic concepts.

If you prefer to start at the bottom, then forget LaTeX.  It's sitting
on top of TeX and adds an extra level of complexity which is
definitely not negligible.  And every macro package contributes to the
complexity.  If someone encounters a bug, we ask him to provide a
*minimal* example which reproduces the error, otherwise it's too
painful to debug it.  In your case I think that if you want to start
at the bottom than it's better to avoid LaTeX due to its complexity.
You can investigate LaTeX later.

Robin already pointed you to the LaTeX sources.  They are documented
somehow but the documentation assumes that the reader is familiar with
the content of the TeXbook.  In short:  The TeXbook is unavoidable.

 > That is not my purpose, and by the way, yes I look at the memory
 > when trying to figure out how a piece of software works 

Arthur already explained that you can't compare TeX with C.  C is a
low-level language and if you disassemble a program, you can certainly
see how it works.  However, TeX is extremely complex and you don't
achieve anything without having read the TeXbook before. 

 > (it's part of my job), especially when you assume that you don't
 > have the source code.

I hope that what you do is legal and you don't end up in prison one
day.  :)

However, the TeX source code is available and there shouldn't be a
need to reverse engineer things.  It's shipped with TeX Live.

I just created a PDF file for you and put it on my server:

  http://ms25.ath.cx/tex/tex.pdf

It describes Knuth's TeX, thus no PDF or Lua related code inside.

BTW, I understand that you want to find out how TeX works.  This is
understandable.  However, I'm convinced that the hash table is by far
the worst starting point.  I can't imagine a worse one.  The hash
table is meaningless unless you know where the entries come from and
what they are good for.

IMO the best approach to make TeX's internals visible is provided by
Patrick Gundlach.  His tool examines TeX's internals and uses Graphviz
in order to display them graphically.

I'm absolutely convinced that everything you're doing at this low
level is absolutely useless and you waste your time unless you've read
the TeXbook before.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From arthur.reutenauer at normalesup.org  Wed May 29 01:29:57 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 29 May 2013 00:29:57 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20901.12401.601219.786747@zaphod.ms25.net>
References: <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
 <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org>
 <51A4A79B.3060509@wxs.nl> <51A4ACA4.3090002@gmail.com>
 <20901.12401.601219.786747@zaphod.ms25.net>
Message-ID: <20130528232957.GJ31062@phare.normalesup.org>

> I'm absolutely convinced that everything you're doing at this low
> level is absolutely useless and you waste your time unless you've read
> the TeXbook before.

  Amen to that.  I just counted: considering the book recommendations
we've made in this thread, "Sensei" now has to read

	The TeXbook: 483 pages (\newcount\allpages\allpages=483)
	The TeX sources, a. k. a. "TeX, the Programm": 535 pages (\advance\allpages by 535)
	The LaTeX sources (source2e.pdf): 482 pages (\advance\allpages by 482)
	The LaTeX Companion, 2nd edition: 1090 pages (\advance\allpages by 1090)

hence a total of:

	\showthe\allpages
	> 2590.

pages to read (and a tag price of about 50 euros, I'd guess, for the
TeXbook and the LaTeX Companion).

  I may have forgotten some other resources we mentioned (I recommended
fntguide.pdf at one point, but it's a paltry 25 pages, and it's mostly
redundant with the LaTeX sources and the LaTeX Companion).

	\bye

		Arthur (who just realised that his copy of TLC2 was signed by Michel Goossens)

From senseiwa at gmail.com  Wed May 29 11:28:32 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 11:28:32 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528190537.GB25477@khaled-laptop>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org> <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
 <20130528190537.GB25477@khaled-laptop>
Message-ID: <51A5CA40.6070605@gmail.com>

On 5/28/13 9:05pm, Khaled Hosny wrote:
> On Tue, May 28, 2013 at 06:29:15PM +0200, Martin Schr?der wrote:
>> Are you a troll?
>
> No, he is someone trying to understand TeX without making any attempt to
> understand it, may be there is a word for that.

No, I am just looking at the symbols produced in a tex document (see 
below), trying to see if there is some structure that I can relate to, 
for example names (along with mangling) in an object file.

I don't think I offended anyone. If so, I am sorry. If not, why are you 
so hostile?

I said I started reading the TeX book, but I am curious, and I don't 
think it's a bad thing.





\documentclass{article}


\title{The Title}

\author{The Author}

\begin{document}

\maketitle

\section{Preface}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis felis 
urna, congue commodo accumsan non, congue et enim. Vivamus tristique, 
augue sed adipiscing hendrerit, nunc arcu aliquet orci, et convallis 
risus nibh sed urna. Suspendisse placerat semper lobortis. Integer vitae 
urna at elit suscipit porta a quis leo. Cras ornare faucibus 
sollicitudin. Maecenas est lectus, cursus vel cursus et, ullamcorper in 
lectus. Integer non orci quis arcu aliquam laoreet. Nunc malesuada, 
augue ut pretium congue, risus augue interdum leo, hendrerit malesuada 
magna est vitae odio. Nullam blandit adipiscing massa, sit amet 
tristique justo porta ut. Aliquam sodales faucibus nisl placerat 
consequat. In rhoncus sem id metus auctor mattis. Nunc varius bibendum 
augue, vitae condimentum justo fringilla at. Cras ut tincidunt augue. 
Duis vitae risus in libero fermentum hendrerit vel ac elit. Donec 
tristique congue lorem eget interdum. Phasellus facilisis magna turpis.

Nunc mattis lacinia lacinia. Suspendisse euismod nibh vitae est cursus 
ac gravida lectus vehicula. Sed ultricies leo nec mi rhoncus 
scelerisque. Vestibulum a gravida ante. Aenean nec ligula ante. Duis ac 
ipsum ante. Class aptent taciti sociosqu ad litora torquent per conubia 
nostra, per inceptos himenaeos. Integer eget tincidunt est. Ut viverra, 
sem ac suscipit adipiscing, urna nisl adipiscing tortor, id aliquet ante 
nunc a nisl~\cite{someReferenceHere}.


\end{document}





From senseiwa at gmail.com  Wed May 29 11:30:47 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 11:30:47 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org> <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
Message-ID: <51A5CAC7.8080405@gmail.com>

On 5/28/13 6:29pm, Martin Schr?der wrote:
> 2013/5/28 Sensei <senseiwa at gmail.com>:
>> I knew TeX didn't have support for unicode, and I thought that
>> lualatex translated into TeX, which produced an output.
>
> Seriously: Where did you get that idea? Did you smoke something?
> Because if you had done _any_ _research_ (like using Google and then
> reading the Wikipedia article on LuaTeX) you would know that your
> "thought" is wrong.


That was my understanding of reading, for instance, the wiki page. If 
it's a collection of macros for simplifying life with TeX, then it would 
"translate" to TeX what I write.


> Are you a troll?

If you think so, I am sorry.



From luigi.scarso at gmail.com  Wed May 29 11:47:54 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 29 May 2013 11:47:54 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5CA40.6070605@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
 <20130528190537.GB25477@khaled-laptop> <51A5CA40.6070605@gmail.com>
Message-ID: <CAG5iGsAbQer22VQFxXzC+4ZCNR90HFpdUu-NkLjgKwcKaEYjTA@mail.gmail.com>

2013/5/29 Sensei <senseiwa at gmail.com>

> On 5/28/13 9:05pm, Khaled Hosny wrote:
>
>> On Tue, May 28, 2013 at 06:29:15PM +0200, Martin Schr?der wrote:
>>
>>> Are you a troll?
>>>
>>
>> No, he is someone trying to understand TeX without making any attempt to
>> understand it, may be there is a word for that.
>>
>
> No, I am just looking at the symbols produced in a tex document (see
> below), trying to see if there is some structure that I can relate to, for
> example names (along with mangling) in an object file.
>
>  hm ... let's see.
pdftex/xetex/luatex read a tex file (high level lang) and produces a pdf
file, so most direct relation between input and output
is the
character. Very ofter all the other high level markup are flatted into
(font,size,char) streeams (of course there is a way to put outline in pdf
one to one to section of tex).
For example with tha plain format
H\bye
produces a pdf with the H character with a certain font  and hence, from a
certain point of view this is the symbol produced.
You can see how *tex works from the external   with
\tracingall H\bye
but I believe that you cannot see all the details down to the pdf.
Probably you can also play with the lua callbacks to print intermediate
values,
but if you want to see how the tokens are produced , managed and how they
go into the pdf,
it's better to run a debugged version of luatex. Starting from here you can
have a better vision also
on which lua callbacks are involved.





-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130529/0000c067/attachment.html>

From senseiwa at gmail.com  Wed May 29 12:02:32 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 12:02:32 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20901.12401.601219.786747@zaphod.ms25.net>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
 <51A4ACA4.3090002@gmail.com> <20901.12401.601219.786747@zaphod.ms25.net>
Message-ID: <51A5D238.5070302@gmail.com>

On 5/29/13 12:32am, Reinhard Kotucha wrote:

> I fear that you have to read the TeXbook first.  [...] You can
> investigate LaTeX later. [...] In short: The TeXbook is unavoidable.

As I said multiple times: I've downloaded the TeX book, and I am reading it.

> Arthur already explained that you can't compare TeX with C.  C is a
> low-level language and if you disassemble a program, you can certainly
> see how it works.  However, TeX is extremely complex and you don't
> achieve anything without having read the TeXbook before.


Ok, I get it. I said i *THOUGHT* I could relate it to C, and I also said 
that I was obviously wrong.

>   > (it's part of my job), especially when you assume that you don't
>   > have the source code.
>
> I hope that what you do is legal and you don't end up in prison one
> day.  :)


It is legal. You just don't see many do reverse engineering. I'm not 15 
anymore to waste time on "cracks".


> However, the TeX source code is available and there shouldn't be a
> need to reverse engineer things.  It's shipped with TeX Live.
>
> I just created a PDF file for you and put it on my server:
>
>    http://ms25.ath.cx/tex/tex.pdf
>
> It describes Knuth's TeX, thus no PDF or Lua related code inside.


Thanks, I have another source to read!

> BTW, I understand that you want to find out how TeX works.  This is
> understandable.  However, I'm convinced that the hash table is by far
> the worst starting point.  I can't imagine a worse one.  The hash
> table is meaningless unless you know where the entries come from and
> what they are good for.


Disclaimer: I am trying to say why I was proceeding that way.

It is quite common to make a dummy program to see how a compiler encodes 
things, how symbols are translated (their names), how the code is 
produced (symbol's contents). I made the same: a dummy latex, and dumped 
the symbols.


> IMO the best approach to make TeX's internals visible is provided by
> Patrick Gundlach.  His tool examines TeX's internals and uses Graphviz
> in order to display them graphically.
>
> I'm absolutely convinced that everything you're doing at this low
> level is absolutely useless and you waste your time unless you've read
> the TeXbook before.


You've made your point clear.





From senseiwa at gmail.com  Wed May 29 12:04:01 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 12:04:01 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528232957.GJ31062@phare.normalesup.org>
References: <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
 <51A4ACA4.3090002@gmail.com> <20901.12401.601219.786747@zaphod.ms25.net>
 <20130528232957.GJ31062@phare.normalesup.org>
Message-ID: <51A5D291.109@gmail.com>

On 5/29/13 1:29am, Arthur Reutenauer wrote:
>    Amen to that.  I just counted: considering the book recommendations
> we've made in this thread, "Sensei" now has to read
>
> 	The TeXbook: 483 pages (\newcount\allpages\allpages=483)
> 	The TeX sources, a. k. a. "TeX, the Programm": 535 pages (\advance\allpages by 535)
> 	The LaTeX sources (source2e.pdf): 482 pages (\advance\allpages by 482)
> 	The LaTeX Companion, 2nd edition: 1090 pages (\advance\allpages by 1090)
>
> hence a total of:
>
> 	\showthe\allpages
> 	> 2590.
>
> pages to read (and a tag price of about 50 euros, I'd guess, for the
> TeXbook and the LaTeX Companion).
>
>    I may have forgotten some other resources we mentioned (I recommended
> fntguide.pdf at one point, but it's a paltry 25 pages, and it's mostly
> redundant with the LaTeX sources and the LaTeX Companion).


Thanks for these other books.


From senseiwa at gmail.com  Wed May 29 12:07:21 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 12:07:21 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <CAG5iGsBCGXmw-AidWCojP=Yo=8sNbAV5WknSwyi62Sz4P181Hw@mail.gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org> <51A4AB58.4060700@gmail.com>
 <CAG5iGsBCGXmw-AidWCojP=Yo=8sNbAV5WknSwyi62Sz4P181Hw@mail.gmail.com>
Message-ID: <51A5D359.4020800@gmail.com>

On 5/28/13 5:53pm, luigi scarso wrote:
>
>
>
> On Tue, May 28, 2013 at 3:04 PM, Sensei <senseiwa at gmail.com
> <mailto:senseiwa at gmail.com>> wrote:
>
>
>
>     Pardon me, but I'm used to write code in C, assembly, C++, or
>     whatever other programming language (mainly those three, in that
>     order). TeX is very, very different.
>
> Another option is to download the source of luatex, compile it with the
> --debug switch
> and then run luatex with gdb.
> Probably (not evidently nor obviously)  you need a format: you can
> install a context standalone which has a plain fmt easy to build.
> TeX is a procedural markup  language where everything, even a
> character,  is a procedure (or macro ),
> luatex, pdftex,xetex,etex are interpreters of TeX with some differences
> on the languages accepted,
> but basically they all are Syntax-Directed Interpreters: a big
> switch/case inside a while that dispatches the tokens from the lexer
> to the right subroutines (iirc it's called main_control in
> maincontrol.w, the cweb file).

That's interesting.

> The main difference from others similar languages probably is the fact
> that the user can modify the meaning of the tokens,
> more or less as if  were able to modify the keywords of C --- so  TeX is
> a kind of meta SDI ;
> also it's carefully designed to be platform independent (but as  say
> previously you should see
> http://www.tug.org/texinfohtml/web2c.html#Memory-dumps)
> With  a debugged version of luatex , the plain format from standalone
> and test.tex like
> Hello\bye
> you can see TeX in action running gdb with
> luatex --fmt=luatex-plain.fmt test.tex



Thanks Luigi, the fact that I can modify everything is new (no other 
programming language does that at this level, iirc).

I moved to read the TeX book, maybe that clarifies a lot.


Cheers




From patrick at gundla.ch  Wed May 29 12:10:49 2013
From: patrick at gundla.ch (Patrick Gundlach)
Date: Wed, 29 May 2013 12:10:49 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20901.12401.601219.786747@zaphod.ms25.net>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
 <51A4ACA4.3090002@gmail.com> <20901.12401.601219.786747@zaphod.ms25.net>
Message-ID: <5F493C9B-E4C3-4615-B6BA-4D7A5F8B4E58@gundla.ch>



> IMO the best approach to make TeX's internals visible is provided by
> Patrick Gundlach.  His tool examines TeX's internals and uses Graphviz
> in order to display them graphically.

http://wiki.luatex.org/index.php/Main_Page#Useful_modules

see also 

http://wiki.luatex.org/index.php/TeX_without_TeX

Patrick


From luigi.scarso at gmail.com  Wed May 29 12:12:47 2013
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 29 May 2013 12:12:47 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5D359.4020800@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <CAG5iGsBCGXmw-AidWCojP=Yo=8sNbAV5WknSwyi62Sz4P181Hw@mail.gmail.com>
 <51A5D359.4020800@gmail.com>
Message-ID: <CAG5iGsB_K2c96oje9QGAavU+C0--7tm==b6T7f=9G=hk7LbZhQ@mail.gmail.com>

On Wed, May 29, 2013 at 12:07 PM, Sensei <senseiwa at gmail.com> wrote:

> Thanks Luigi, the fact that I can modify everything is new (no other
> programming language does that at this level, iirc).
>
> yes, it's not a common feature of DSL

> I moved to read the TeX book, maybe that clarifies a lot.
>
> Maybe you can give a try to  tex by topic (pdf is free)  first .



-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://tug.org/pipermail/luatex/attachments/20130529/4965e6a1/attachment.html>

From senseiwa at gmail.com  Wed May 29 12:25:15 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 12:25:15 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130528161146.GC31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org> <51A4AB58.4060700@gmail.com>
 <20130528161146.GC31062@phare.normalesup.org>
Message-ID: <51A5D78B.9070402@gmail.com>

On 5/28/13 6:11pm, Arthur Reutenauer wrote:
>    You really could have simply mentioned you were using tex.hashtokens()
> from the LuaTeX library.  "Hash token" is not part of the standard TeX
> vocabulary, but "token" is, with a different meaning.

As I said, I didn't post to TeX but to Lua because I used LuaLaTeX, and 
the subject of this post was about Hash tokens. I thought it was a 
LuaTeX feature, not a TeX one (no "\" in any token, so I didn't 
recognize TeX except for the names which are the same, except for "\"), 
and I thought it was clear. So, again as I said, I was wrong, I wasn't 
clear.

>    OK, but you do have the source code here: why refuse to use it?

Where did I ever refuse to use it? I said I would get myself the code 
and the TeX book.

>> Because it's new. I thought of it as an escaping in C, a sort, let's
>> say this, of protection of the next character, as in \% (the same
>> way in C for \").
>
>    That's understandable, but TeX's control sequence mechanism is
> different from escaping.  A control sequence is anything starting with a
> character having category code 0 -- that character is usually \, but can
> actually be anything -- and that translates to something else during
> macro expansion.  And you can even make \ a part of a control sequence's
> name, if you want, but that's a little bit convoluted (and not very
> useful).


I understand now.

>    And I did leave several parts out, read the TeXbook for the full story.

Yes, I am reading it.

>> Yes, I knew that once opened the hash file with an hex editor. I
>> knew TeX didn't have support for unicode, and I thought that
>> lualatex translated into TeX, which produced an output. So a unicode
>> string was unexpected, and I thought I messed up with my dump code.
>
>    That's another misconception, I'm afraid.  LuaTeX doesn't translate to
> TeX, it is an extension of TeX.  It augments the original code base with
> many new features -- including, obviously, Lua -- and its input and
> output are in UTF-8 (by default).
>
>    (And the code base has been converted from Pascal to C, etc., etc.,
> there are many subtopics to that aspect.)

A common misconception that I've fallen into.


>> Pardon me, but I'm used to write code in C, assembly, C++, or
>> whatever other programming language (mainly those three, in that
>> order). TeX is very, very different.
>
>    Yes, and it is a programming language too (specifically, a macro
> language).  It would be useful if you would stop resisting the notion.

Where did I resist? I accept the notion, and I am just trying to explain 
*WHY* I thought otherwise. It's not that I am saying that I was right.


>>>     Far more interesting are the different commands defined by LaTeX when
>>> \label is called, look for "ltxref.dtx" in latex.ltx.  The letter "r"
>>> (in \r at something) is introduced in a macro called \newlabel (line 3881
>>> of my copy of latex.ltx), and "@" in \@newl at bel, one line above it.
>>
>> That is awesome, I now have a place to start!
>
>    I still don't see what's exciting about these few macros, but if it
> makes you happy ...

I start walking, then I run. Since I don't know for instance where the 
equivalent of "main()" is in the LaTeX code, you provided me a


>> Anyway, at some point there *is* a static version of a code
>> somewhere, otherwise there would be no output.
>
>    I'm not sure that makes sense, but let's just leave it at that for the
> time being.

There is a static version because somewhere the codes are in RAM, 
somewhere the final version of a LaTeX command can be found.

>>                                                 Yes, I am biased by
>> my job and education, but I find hard to grasp the opposition to
>> this approach.
>
>    I can't believe I'm reading that.  *You* are the one coming towards
> TeX with a huge bias and a host of misconceptions, and you're talking
> about opposition to your approach on *our* part?  You freely admit that
> you don't understand the way a source file is structured, and you want
> us to help you analyse a file that you've produced according to your own
> taste, without even showing us what the input was?  You won't tell us
> your name, and use a pseudonym that, when you're in the position of a
> student, is at best snooty?  If it wasn't for our expertise, your
> approach wouldn't have led you anywhere.


I never asked to analyze a file, reread my post. I asked about specific 
tokens.

I am quite sure of my knowledge to recognize that I am not able to make 
it on my own.

So, since I recognize my bias, I asked for something that in the 
programming language community is clear. If I have a function in C 
called "main()" how will this be translated? Well, you'll end up with a 
symbol "_main". If you don't see why this connection makes sense... but 
anyway, if you read my posts with calm and zen, you will see that I 
always said "I was wrong".

Should I flog myself for being wrong? It's the only way to improve.

Again, I never had an attitude of someone saying "you pricks don't know 
s*it and I do LOL". If you ever see in one of my posts that, I didn't do 
that *INTENTIONALLY*.


>  Sensei my *ss.

And that's very mature.

I understand you know everything on every topic, and don't need to ask 
questions to those who know more than you. Well, I am sorry I am not 
skilled on these matters, that's why I asked.


A "RTFM" attitude won't make you any more respected.




From arthur.reutenauer at normalesup.org  Wed May 29 13:25:58 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 29 May 2013 12:25:58 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5D238.5070302@gmail.com>
References: <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org>
 <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org>
 <51A4A79B.3060509@wxs.nl> <51A4ACA4.3090002@gmail.com>
 <20901.12401.601219.786747@zaphod.ms25.net>
 <51A5D238.5070302@gmail.com>
Message-ID: <20130529112558.GK31062@phare.normalesup.org>

> As I said multiple times: I've downloaded the TeX book, and I am reading it.

  That's illegal.  Wherever you've downloaded it from, shouldn't have
made it available.  Unfortunately Addison-Wesley doesn't provide the
option to buy an electronic version (that I know of), you have to buy
the paper copy.

	Arthur

From martin.berggren at cs.umu.se  Wed May 29 13:30:00 2013
From: martin.berggren at cs.umu.se (Martin Berggren)
Date: Wed, 29 May 2013 13:30:00 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529112558.GK31062@phare.normalesup.org>
References: <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
 <51A4ACA4.3090002@gmail.com> <20901.12401.601219.786747@zaphod.ms25.net>
 <51A5D238.5070302@gmail.com> <20130529112558.GK31062@phare.normalesup.org>
Message-ID: <EE391535-B0C5-4604-AE8C-4025FA4D592A@cs.umu.se>

On May 29, 2013, at 13:25 , Arthur Reutenauer wrote:

>> As I said multiple times: I've downloaded the TeX book, and I am reading it.
> 
>  That's illegal.  Wherever you've downloaded it from, shouldn't have
> made it available.  Unfortunately Addison-Wesley doesn't provide the
> option to buy an electronic version (that I know of), you have to buy
> the paper copy.
> 
> 	Arthur


Reading the .tex source of the TeX book should is legal.


Martin Berggren
-------------------------------------------------------------------
Department of Computing Science, 
UMIT Research Lab
Ume? Universitet
Campustorget 5, S-901 87 Ume?, Sweden. Ph: +46-70-732 8111
http://www.cs.umu.se/~martinb, Martin.Berggren at cs.umu.se



From Robin.Fairbairns at cl.cam.ac.uk  Wed May 29 13:47:26 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 29 May 2013 12:47:26 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Wed, 29 May 2013 13:30:00 +0200.
 <EE391535-B0C5-4604-AE8C-4025FA4D592A@cs.umu.se>
Message-ID: <7161.1369828046@cl.cam.ac.uk>

Martin Berggren <martin.berggren at cs.umu.se> wrote:

> On May 29, 2013, at 13:25 , Arthur Reutenauer wrote:
> 
> >> As I said multiple times: I've downloaded the TeX book, and I am reading it.
> > 
> >  That's illegal.  Wherever you've downloaded it from, shouldn't have
> > made it available.  Unfortunately Addison-Wesley doesn't provide the
> > option to buy an electronic version (that I know of), you have to buy
> > the paper copy.
>
> Reading the .tex source of the TeX book should is legal.

sure.  but if your purpose is understanding tex, reading knuth's sources
is not a way i would recommend.  (the texbook is quite hard going, in
places, and reading code describing something difficult may be worse
still.  note that ymmv, but i struggled in the 80s having never used
anything more complex than digital runoff.)

i agree, it's a shame a-w (or whatever they're called now) can't bring
themselves to offer an e-book version.

From senseiwa at gmail.com  Wed May 29 13:53:07 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 13:53:07 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529112558.GK31062@phare.normalesup.org>
References: <51A45484.7030607@gmail.com>
 <CAP7DCDeRC9UNqid-4DEXE7KTmN0Mt3JdJ=1EUUYNbvaNJw0oPw@mail.gmail.com>
 <CABjH9sp4vnG1L5VXji9f2Rm_GGmS5S52OQmOZdMHPQRtjU09Eg@mail.gmail.com>
 <20130528100655.GV31062@phare.normalesup.org> <51A48D2E.3000203@gmail.com>
 <20130528113943.GY31062@phare.normalesup.org> <51A4A79B.3060509@wxs.nl>
 <51A4ACA4.3090002@gmail.com> <20901.12401.601219.786747@zaphod.ms25.net>
 <51A5D238.5070302@gmail.com> <20130529112558.GK31062@phare.normalesup.org>
Message-ID: <51A5EC23.2010402@gmail.com>

On 5/29/13 1:25pm, Arthur Reutenauer wrote:
>> As I said multiple times: I've downloaded the TeX book, and I am reading it.
>
>    That's illegal.  Wherever you've downloaded it from, shouldn't have
> made it available.  Unfortunately Addison-Wesley doesn't provide the
> option to buy an electronic version (that I know of), you have to buy
> the paper copy.

So... CTAN is illegal?

http://www.ctan.org/pkg/texbook



From Robin.Fairbairns at cl.cam.ac.uk  Wed May 29 14:04:45 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 29 May 2013 13:04:45 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Wed, 29 May 2013 13:53:07 +0200.
 <51A5EC23.2010402@gmail.com>
Message-ID: <7332.1369829085@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> On 5/29/13 1:25pm, Arthur Reutenauer wrote:
> >> As I said multiple times: I've downloaded the TeX book, and I am reading it.
> >
> >    That's illegal.  Wherever you've downloaded it from, shouldn't have
> > made it available.  Unfortunately Addison-Wesley doesn't provide the
> > option to buy an electronic version (that I know of), you have to buy
> > the paper copy.
> 
> So... CTAN is illegal?
> 
> http://www.ctan.org/pkg/texbook

read that page: "The source has ?protection? against use to produce a
document" and "... only allowed with permission ..."

the *source* is distributed quite legally.  a pdf copy (i've been told
such exist on the net) is illegal.

so we're within the law.  even dmca!  (in this instance, at least...)

Robin Fairbairns

For the CTAN team


From senseiwa at gmail.com  Wed May 29 14:09:09 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 14:09:09 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <7332.1369829085@cl.cam.ac.uk>
References: <7332.1369829085@cl.cam.ac.uk>
Message-ID: <51A5EFE5.1060706@gmail.com>

On 5/29/13 2:04pm, Robin Fairbairns wrote:
> read that page: "The source has ?protection? against use to produce a
> document" and "... only allowed with permission ..."
>
> the *source* is distributed quite legally.  a pdf copy (i've been told
> such exist on the net) is illegal.
>
> so we're within the law.  even dmca!  (in this instance, at least...)
>
> Robin Fairbairns
>
> For the CTAN team

Yes, that is why I am reading the *source* code.

I also found myself "TeX for the Impatient", on TUG (legally, I hope), 
and "TeX by Topic" (on CTAN, legally I hope, again), both in PDF form 
from those websites.

Weird as this might sound to someone, I value intellectual property.


From Robin.Fairbairns at cl.cam.ac.uk  Wed May 29 14:20:17 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 29 May 2013 13:20:17 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Wed, 29 May 2013 14:09:09 +0200.
 <51A5EFE5.1060706@gmail.com>
Message-ID: <7505.1369830017@cl.cam.ac.uk>

Sensei <senseiwa at gmail.com> wrote:

> [...]
>
> Yes, that is why I am reading the *source* code.

hardly surprising that i assumed you were doing other, given your
comment about us operating illegally.

> I also found myself "TeX for the Impatient", on TUG (legally, I hope),
> and "TeX by Topic" (on CTAN, legally I hope, again), both in PDF form
> from those websites.

they are both legal, for sure.  i think "tex by topic" can be printed on
demand, but i've not tried (my paid-for copy hasn't fallen apart yet...)

> Weird as this might sound to someone, I value intellectual property.

i guess you're confusing us all ;-0

robin

From senseiwa at gmail.com  Wed May 29 14:28:35 2013
From: senseiwa at gmail.com (Sensei)
Date: Wed, 29 May 2013 14:28:35 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <7505.1369830017@cl.cam.ac.uk>
References: <7505.1369830017@cl.cam.ac.uk>
Message-ID: <51A5F473.7080807@gmail.com>

On 5/29/13 2:20pm, Robin Fairbairns wrote:
> Sensei <senseiwa at gmail.com> wrote:
>
>> [...]
>>
>> Yes, that is why I am reading the *source* code.
>
> hardly surprising that i assumed you were doing other, given your
> comment about us operating illegally.

I don't understand... where did I say that? Sincerely, I'm confused.


From arthur.reutenauer at normalesup.org  Wed May 29 17:43:59 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 29 May 2013 16:43:59 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5EFE5.1060706@gmail.com>
References: <7332.1369829085@cl.cam.ac.uk>
 <51A5EFE5.1060706@gmail.com>
Message-ID: <20130529154359.GM31062@phare.normalesup.org>

> Yes, that is why I am reading the *source* code.

  You really don't want to do anything like anyone else, do you?

	Arthur

From arthur.reutenauer at normalesup.org  Wed May 29 18:04:33 2013
From: arthur.reutenauer at normalesup.org (Arthur Reutenauer)
Date: Wed, 29 May 2013 17:04:33 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5CAC7.8080405@gmail.com>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
 <51A5CAC7.8080405@gmail.com>
Message-ID: <20130529160433.GN31062@phare.normalesup.org>

> That was my understanding of reading, for instance, the wiki page.

  Is there any particular place on the Wikipedia page that made you
think that?  It's always worth improving.  The very first sentence reads

	LuaTeX is a TeX-based computer typesetting system which started
	as a version of pdfTeX with a Lua scripting engine embedded.

where the expression "TeX-based" can possibly be misunderstood to mean
that LuaTeX is a layer on top of TeX, but the end of the sentence does
call it "a version of pdfTeX" and the first section of the article
("Objective of the project") should clear any misunderstanding that the
phrase "TeX-based" may have introduced.

  The first sentence of http://wiki.luatex.org/ describes LuaTeX as
"a typesetting engine derived from TeX"; I'm not really sure offhand
which expression is better.

> If it's a collection of macros for simplifying life with TeX, then
> it would "translate" to TeX what I write.

  Just to make things overwhelmingly clear: you've now understood that
LuaTeX is not a collection of macros for simplifying life with TeX,
right?

	Arthur

From khaledhosny at eglug.org  Wed May 29 18:48:52 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 29 May 2013 18:48:52 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <51A5F473.7080807@gmail.com>
References: <7505.1369830017@cl.cam.ac.uk>
 <51A5F473.7080807@gmail.com>
Message-ID: <20130529164852.GA22295@khaled-laptop>

On Wed, May 29, 2013 at 02:28:35PM +0200, Sensei wrote:
> On 5/29/13 2:20pm, Robin Fairbairns wrote:
> >Sensei <senseiwa at gmail.com> wrote:
> >
> >>[...]
> >>
> >>Yes, that is why I am reading the *source* code.
> >
> >hardly surprising that i assumed you were doing other, given your
> >comment about us operating illegally.
> 
> I don't understand... where did I say that? Sincerely, I'm confused.

"I've downloaded the TeX book" is not the as "I am reading the *source*
code".

From khaledhosny at eglug.org  Wed May 29 18:52:01 2013
From: khaledhosny at eglug.org (Khaled Hosny)
Date: Wed, 29 May 2013 18:52:01 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529160433.GN31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org>
 <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org>
 <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
 <51A5CAC7.8080405@gmail.com>
 <20130529160433.GN31062@phare.normalesup.org>
Message-ID: <20130529165201.GB22295@khaled-laptop>

On Wed, May 29, 2013 at 05:04:33PM +0100, Arthur Reutenauer wrote:
> > That was my understanding of reading, for instance, the wiki page.
> 
>   Is there any particular place on the Wikipedia page that made you
> think that?  It's always worth improving.  The very first sentence reads
> 
> 	LuaTeX is a TeX-based computer typesetting system which started
> 	as a version of pdfTeX with a Lua scripting engine embedded.
> 
> where the expression "TeX-based" can possibly be misunderstood to mean
> that LuaTeX is a layer on top of TeX, but the end of the sentence does
> call it "a version of pdfTeX" and the first section of the article
> ("Objective of the project") should clear any misunderstanding that the
> phrase "TeX-based" may have introduced.
> 
>   The first sentence of http://wiki.luatex.org/ describes LuaTeX as
> "a typesetting engine derived from TeX"; I'm not really sure offhand
> which expression is better.

LuaTeX's is, IMO. A "TeX-based computer typesetting system" can be said
about ContTeXt or even LaTeX and still be true.

Regards,
Khaled

From pragma at wxs.nl  Wed May 29 17:55:28 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Wed, 29 May 2013 17:55:28 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529154359.GM31062@phare.normalesup.org>
References: <7332.1369829085@cl.cam.ac.uk> <51A5EFE5.1060706@gmail.com>
 <20130529154359.GM31062@phare.normalesup.org>
Message-ID: <51A624F0.6090100@wxs.nl>

On 5/29/2013 5:43 PM, Arthur Reutenauer wrote:
>> Yes, that is why I am reading the *source* code.
>
>    You really don't want to do anything like anyone else, do you?

make me think of

http://en.wikipedia.org/wiki/Rosetta_Stone

some day one finds an old bunch of mem chips and magically it contains 
left overs of a plain tex, latex and context run ... all kind of 
interesting expansions, catcode remappings, a bit of utf 8 in there and 
of course snippets missing ... and from that trying to reconstruct the 
tex primitives, concepts, whatever as well as the input file(s) ... 
makes a nice effort

anyway, this topic is less and less related to luatex

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From Robin.Fairbairns at cl.cam.ac.uk  Wed May 29 20:08:19 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Wed, 29 May 2013 19:08:19 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Wed, 29 May 2013 17:55:28 +0200.
 <51A624F0.6090100@wxs.nl>
Message-ID: <1356.1369850899@cl.cam.ac.uk>

Hans Hagen <pragma at wxs.nl> wrote:

> On 5/29/2013 5:43 PM, Arthur Reutenauer wrote:
> >> Yes, that is why I am reading the *source* code.
> >
> >    You really don't want to do anything like anyone else, do you?
> 
> make me think of
> 
> http://en.wikipedia.org/wiki/Rosetta_Stone
> 
> some day one finds an old bunch of mem chips and magically it contains
> left overs of a plain tex, latex and context run ... all kind of
> interesting expansions, catcode remappings, a bit of utf 8 in there
> and of course snippets missing ... and from that trying to reconstruct
> the tex primitives, concepts, whatever as well as the input file(s)
> ... makes a nice effort
> 
> anyway, this topic is less and less related to luatex

so let's switch to decoding ancient scripts from greek lands.

it's not just the rosetta stone -- there's a good bunch of samples of a
script which was given the name "linear a", which afaik no-one's got
anywhere with.  (linear b was decoded by ventris -- it's actually
written greek; linear a is the older one.)

robin (who's feeling a bit punch drunk from the run up to the tl freeze
-- lots of stuff rushing at ctan from all directions...)

From reinhard.kotucha at web.de  Thu May 30 01:41:52 2013
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Thu, 30 May 2013 01:41:52 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <1356.1369850899@cl.cam.ac.uk>
References: <51A624F0.6090100@wxs.nl>
	<1356.1369850899@cl.cam.ac.uk>
Message-ID: <20902.37440.513129.285054@zaphod.ms25.net>

On 2013-05-29 at 19:08:19 +0100, Robin Fairbairns wrote:

 > robin (who's feeling a bit punch drunk from the run up to the tl freeze
 > -- lots of stuff rushing at ctan from all directions...)

Robin, enjoy the calm after the storm.

Regards,
  Reinhard

-- 
----------------------------------------------------------------------------
Reinhard Kotucha                                      Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                              mailto:reinhard.kotucha at web.de
----------------------------------------------------------------------------
Microsoft isn't the answer. Microsoft is the question, and the answer is NO.
----------------------------------------------------------------------------

From Robin.Fairbairns at cl.cam.ac.uk  Thu May 30 10:35:33 2013
From: Robin.Fairbairns at cl.cam.ac.uk (Robin Fairbairns)
Date: Thu, 30 May 2013 09:35:33 +0100
Subject: [luatex] Hash tokens meaning
In-Reply-To: Your message of Thu, 30 May 2013 01:41:52 +0200.
 <20902.37440.513129.285054@zaphod.ms25.net>
Message-ID: <2840.1369902933@cl.cam.ac.uk>

Reinhard Kotucha <reinhard.kotucha at web.de> wrote:

> On 2013-05-29 at 19:08:19 +0100, Robin Fairbairns wrote:
> 
>  > robin (who's feeling a bit punch drunk from the run up to the tl freeze
>  > -- lots of stuff rushing at ctan from all directions...)
> 
> Robin, enjoy the calm after the storm.

will try  ;-)

robin

From senseiwa at gmail.com  Thu May 30 11:14:42 2013
From: senseiwa at gmail.com (Sensei)
Date: Thu, 30 May 2013 11:14:42 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529164852.GA22295@khaled-laptop>
References: <7505.1369830017@cl.cam.ac.uk> <51A5F473.7080807@gmail.com>
 <20130529164852.GA22295@khaled-laptop>
Message-ID: <51A71882.4000406@gmail.com>

On 5/29/13 6:48 PM, Khaled Hosny wrote:
> On Wed, May 29, 2013 at 02:28:35PM +0200, Sensei wrote:
>> On 5/29/13 2:20pm, Robin Fairbairns wrote:
>>> Sensei <senseiwa at gmail.com> wrote:
>>>
>>>> [...]
>>>>
>>>> Yes, that is why I am reading the *source* code.
>>>
>>> hardly surprising that i assumed you were doing other, given your
>>> comment about us operating illegally.
>>
>> I don't understand... where did I say that? Sincerely, I'm confused.
>
> "I've downloaded the TeX book" is not the as "I am reading the *source*
> code".
>

Uh, ok, I get it now, although I didn't say PDF or any other means. :)

From motarecuk at seznam.cz  Thu May 30 11:56:47 2013
From: motarecuk at seznam.cz (TK)
Date: Thu, 30 May 2013 11:56:47 +0200
Subject: [luatex] Hash tokens meaning
In-Reply-To: <20130529160433.GN31062@phare.normalesup.org>
References: <6454.1369661470@cl.cam.ac.uk> <51A365E6.3050902@gmail.com>
 <20130527151524.GO31062@phare.normalesup.org> <51A45484.7030607@gmail.com>
 <20130528110139.GX31062@phare.normalesup.org> <51A4AB58.4060700@gmail.com>
 <CAP7DCDeQQW7+4c7HEpzVBLQXgz6bdYaXhNhZDab5YwoWTYXBLw@mail.gmail.com>
 <51A5CAC7.8080405@gmail.com> <20130529160433.GN31062@phare.normalesup.org>
Message-ID: <51A7225F.5080104@seznam.cz>

I think the misunderstanding starts here:

?I knew TeX didn't have support for unicode, and I thought that lualatex
translated into TeX, which produced an output.?

Sensei is writing about LuaLaTeX, not LuaTeX?

Tom




Dne 29.5.2013 18:04, Arthur Reutenauer napsal(a):
>> That was my understanding of reading, for instance, the wiki page.
>   Is there any particular place on the Wikipedia page that made you
> think that?  It's always worth improving.  The very first sentence reads
>
> 	LuaTeX is a TeX-based computer typesetting system which started
> 	as a version of pdfTeX with a Lua scripting engine embedded.
>
> where the expression "TeX-based" can possibly be misunderstood to mean
> that LuaTeX is a layer on top of TeX, but the end of the sentence does
> call it "a version of pdfTeX" and the first section of the article
> ("Objective of the project") should clear any misunderstanding that the
> phrase "TeX-based" may have introduced.
>
>   The first sentence of http://wiki.luatex.org/ describes LuaTeX as
> "a typesetting engine derived from TeX"; I'm not really sure offhand
> which expression is better.
>
>> If it's a collection of macros for simplifying life with TeX, then
>> it would "translate" to TeX what I write.
>   Just to make things overwhelmingly clear: you've now understood that
> LuaTeX is not a collection of macros for simplifying life with TeX,
> right?
>
> 	Arthur
>


From herbs at wideopenwest.com  Fri May 31 15:20:56 2013
From: herbs at wideopenwest.com (Herbert Schulz)
Date: Fri, 31 May 2013 08:20:56 -0500
Subject: [luatex] Sample documentation won't compile.
Message-ID: <32F516B8-C367-4DE7-814C-68EB74BA3D24@wideopenwest.com>

Howdy,

MacTeX has installed some sample documentation for Context/LuaTeX/XeTeX at least since 2010. One document used to compile fine but doesn't do so with the TeX Live 2013 pretest. Mojca Miklavec was able to fix the document by

-        context("%#2i",r)
+        context("%2i",r)

i.e., removing the `#' from the format string.

I'm wondering if this is because of a change in the Lua interpreter or something else. The corrected file is enclosed.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: ConTeXt-table.tex
Type: application/octet-stream
Size: 776 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130531/c0f657f2/attachment.obj>
-------------- next part --------------


PS: Please copy any answers to me since I'm not a member of this list.

Good Luck,

Herb Schulz
(herbs at wideopenwest dot com)




From zappathustra at free.fr  Fri May 31 16:56:46 2013
From: zappathustra at free.fr (Paul Isambert)
Date: Fri, 31 May 2013 16:56:46 +0200
Subject: [luatex] Sample documentation won't compile.
In-Reply-To: <32F516B8-C367-4DE7-814C-68EB74BA3D24@wideopenwest.com>
Message-ID: <1625075565.1933620.1370012206879.JavaMail.root@zimbra54-e10.priv.proxad.net>

Herbert Schulz <herbs at wideopenwest.com> a ?crit:
> Howdy,
> 
> MacTeX has installed some sample documentation for Context/LuaTeX/XeTeX at least since 2010. One document used to compile fine but doesn't do so with the TeX Live 2013 pretest. Mojca Miklavec was able to fix the document by
> 
> -        context("%#2i",r)
> +        context("%2i",r)
> 
> i.e., removing the `#' from the format string.
> 
> I'm wondering if this is because of a change in the Lua interpreter or something else. The corrected file is enclosed.

The Lua 5.1 documentation* states that ?format.string()? (on which, I
suppose, the ?context()? function is based) ?follows the same rules as
the printf family of standard C functions?, whereas according to the
Lua 5.2 documentation,** it ?follows the same rules as the ANSI C
function sprintf?. Perhaps that?s the source of the difference?

> PS: Please copy any answers to me since I'm not a member of this list.
> 
> Good Luck,

We?ll need it, what with the depressing rainy spring and all :)

Best,
Paul

*  http://www.lua.org/manual/5.1/manual.html#pdf-string.format
** http://www.lua.org/manual/5.2/manual.html#pdf-string.format


From Philipp.Gesang at alumni.uni-heidelberg.de  Fri May 31 17:07:09 2013
From: Philipp.Gesang at alumni.uni-heidelberg.de (Philipp Gesang)
Date: Fri, 31 May 2013 17:07:09 +0200
Subject: [luatex] Sample documentation won't compile.
In-Reply-To: <1625075565.1933620.1370012206879.JavaMail.root@zimbra54-e10.priv.proxad.net>
References: <32F516B8-C367-4DE7-814C-68EB74BA3D24@wideopenwest.com>
 <1625075565.1933620.1370012206879.JavaMail.root@zimbra54-e10.priv.proxad.net>
Message-ID: <20130531150709.GA28074@phlegethon>

???<date: 2013-05-31, Friday>???<from: Paul Isambert>???

> Herbert Schulz <herbs at wideopenwest.com> a ?crit:
> > Howdy,
> > 
> > MacTeX has installed some sample documentation for Context/LuaTeX/XeTeX at least since 2010. One document used to compile fine but doesn't do so with the TeX Live 2013 pretest. Mojca Miklavec was able to fix the document by
> > 
> > -        context("%#2i",r)
> > +        context("%2i",r)
> > 
> > i.e., removing the `#' from the format string.
> > 
> > I'm wondering if this is because of a change in the Lua interpreter or something else. The corrected file is enclosed.
> 
> The Lua 5.1 documentation* states that ?format.string()? (on which, I
> suppose, the ?context()? function is based)

The cld printers are based on formatters, not string.format()
(see cldf-ini.lua), which may account for the difference.

Best
Philipp

>                                             ?follows the same rules as
> the printf family of standard C functions?, whereas according to the
> Lua 5.2 documentation,** it ?follows the same rules as the ANSI C
> function sprintf?. Perhaps that?s the source of the difference?
> > PS: Please copy any answers to me since I'm not a member of this list.
> > 
> > Good Luck,
> 
> We?ll need it, what with the depressing rainy spring and all :)
> 
> Best,
> Paul
> 
> *  http://www.lua.org/manual/5.1/manual.html#pdf-string.format
> ** http://www.lua.org/manual/5.2/manual.html#pdf-string.format
> 

-- 
()  ascii ribbon campaign - against html e-mail
/\  www.asciiribbon.org   - against proprietary attachments
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130531/104c5813/attachment.bin>

From pragma at wxs.nl  Fri May 31 18:32:17 2013
From: pragma at wxs.nl (Hans Hagen)
Date: Fri, 31 May 2013 18:32:17 +0200
Subject: [luatex] Sample documentation won't compile.
In-Reply-To: <32F516B8-C367-4DE7-814C-68EB74BA3D24@wideopenwest.com>
References: <32F516B8-C367-4DE7-814C-68EB74BA3D24@wideopenwest.com>
Message-ID: <51A8D091.2030408@wxs.nl>

On 5/31/2013 3:20 PM, Herbert Schulz wrote:
> Howdy,
>
> MacTeX has installed some sample documentation for Context/LuaTeX/XeTeX at least since 2010. One document used to compile fine but doesn't do so with the TeX Live 2013 pretest. Mojca Miklavec was able to fix the document by
>
> -        context("%#2i",r)
> +        context("%2i",r)

the # should not have been there ... and lua 5.1 was more tolerant than 
5.2 so it went unnoticed

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
     tel: 038 477 53 69 | voip: 087 875 68 74 | www.pragma-ade.com
                                              | www.pragma-pod.nl
-----------------------------------------------------------------

From martin at oneiros.de  Fri May 31 21:16:45 2013
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 31 May 2013 21:16:45 +0200
Subject: [luatex] [texhax] Black box in math mode with LuaLaTeX + koma
	script
In-Reply-To: <51A8B1BA.3050408@tuwien.ac.at>
References: <51A8B1BA.3050408@tuwien.ac.at>
Message-ID: <CAP7DCDdk=9KSDRt0o40mKzW4DgXv8MOnv4+PR9ojVRBbE4HboQ@mail.gmail.com>

2013/5/31 Stefan L?ffler <stefan.loeffler at tuwien.ac.at>:
> I just stumbled over the following peculiar problem: When typesetting the
> following minimal example,
>
>
> \documentclass{scrreprt}
>
> \pagestyle{empty}
>
> \begin{document}
>
> \[
>
> \sqrt{\sum_i \Bigg(}
>
> \]
>
> \end{document}
>
>
> with LuaLaTeX, the square root symbol is typeset above the rest of the math,
> with a large black box inside. This is reproducible with all koma script
> documentclasses. When switching to "article", using pdfLaTeX, or replacing
> \Bigg( by something smaller, the formula is typeset as it should be.
>
> Can someone reproduce this / tell me what the problem is / tell me how to
> fix this?

Reproduced. Let's continue this on the luatex list.

Best
   Martin


From kakuto at fuk.kindai.ac.jp  Fri May 31 23:39:32 2013
From: kakuto at fuk.kindai.ac.jp (Akira Kakuto)
Date: Sat, 1 Jun 2013 06:39:32 +0900
Subject: [luatex] [texhax] Black box in math mode with LuaLaTeX + koma script
Message-ID: <2E299C51F17842E598082DDFA5940D5A@CJ3001517a>

Hello,

> Reproduced. Let's continue this on the luatex list.

I cannot reproduce here. See the attached komatst.tar.gz.
My package may not be the latest.

Best regards,
Akira KAKUTO
-------------- next part --------------
A non-text attachment was scrubbed...
Name: komatst.tar.gz
Type: application/x-gzip
Size: 18327 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130601/8063f706/attachment-0001.gz>

From martin at oneiros.de  Fri May 31 23:50:43 2013
From: martin at oneiros.de (=?ISO-8859-1?Q?Martin_Schr=F6der?=)
Date: Fri, 31 May 2013 23:50:43 +0200
Subject: [luatex] [texhax] Black box in math mode with LuaLaTeX + koma
	script
In-Reply-To: <2E299C51F17842E598082DDFA5940D5A@CJ3001517a>
References: <2E299C51F17842E598082DDFA5940D5A@CJ3001517a>
Message-ID: <CAP7DCDcBHcS4VqRNEQrt-W_TY+f+A=KKoM44PDSSjFMJcUq+fw@mail.gmail.com>

2013/5/31 Akira Kakuto <kakuto at fuk.kindai.ac.jp>:
>> Reproduced. Let's continue this on the luatex list.
>
>
> I cannot reproduce here. See the attached komatst.tar.gz.
> My package may not be the latest.

I can reproduce it with TL2012. If it's fixed in pretest, that's fine. :-)

Best
   Martin

From st.loeffler at gmail.com  Fri May 31 23:51:31 2013
From: st.loeffler at gmail.com (=?UTF-8?B?U3RlZmFuIEzDtmZmbGVy?=)
Date: Fri, 31 May 2013 23:51:31 +0200
Subject: [luatex] [texhax] Black box in math mode with LuaLaTeX + koma
 script
In-Reply-To: <2E299C51F17842E598082DDFA5940D5A@CJ3001517a>
References: <2E299C51F17842E598082DDFA5940D5A@CJ3001517a>
Message-ID: <51A91B63.5060303@gmail.com>

Hi,

FWIW, I reproduced it on another computer as well - see attachment for
output and log.

Best regards,
Stefan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: t.log
Type: text/x-log
Size: 5702 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130531/14250133/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: t.pdf
Type: video/x-flv
Size: 16267 bytes
Desc: not available
URL: <http://tug.org/pipermail/luatex/attachments/20130531/14250133/attachment-0001.flv>

