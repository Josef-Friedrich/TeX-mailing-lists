From d.p.carlisle at gmail.com  Sat Sep  1 10:46:03 2018
From: d.p.carlisle at gmail.com (David Carlisle)
Date: Sat, 1 Sep 2018 09:46:03 +0100
Subject: [luatex] new commands in luatex 1.08/9
Message-ID: <CAEW6iOjhMnBCNz9tBtqOfr0ZYB_ExfcCrVJncrvQ+YDG71wg2Q@mail.gmail.com>

While checking the latex interfaces for the luatex update, the
following primitives which don't seem to be in the manual came up


    + compoundhyphenmode
    + endlocalcontrol
    + fixupboxesmode
    + gtoksapp
    + gtokspre
    + mathflattenmode
    + mathrulethicknessmode
    + xtoksapp
    + xtokspre

from the names and a quick look at the sources, we can see what some
of them do, but are these experimental additions that may go, or are
they new primitives that just missed the manual in the current
revision.  Either way some hints of what they do would be useful,
thanks:-)

David

From j.hagen at xs4all.nl  Sat Sep  1 11:10:28 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sat, 1 Sep 2018 11:10:28 +0200
Subject: [luatex] new commands in luatex 1.08/9
In-Reply-To: <CAEW6iOjhMnBCNz9tBtqOfr0ZYB_ExfcCrVJncrvQ+YDG71wg2Q@mail.gmail.com>
References: <CAEW6iOjhMnBCNz9tBtqOfr0ZYB_ExfcCrVJncrvQ+YDG71wg2Q@mail.gmail.com>
Message-ID: <e6076144-a6d9-322d-8626-e5fceddffa8c@xs4all.nl>

On 9/1/2018 10:46 AM, David Carlisle wrote:
> While checking the latex interfaces for the luatex update, the
> following primitives which don't seem to be in the manual came up
> 
> 
>      + compoundhyphenmode
>      + endlocalcontrol
>      + fixupboxesmode
>      + gtoksapp
>      + gtokspre
>      + mathflattenmode
>      + mathrulethicknessmode
>      + xtoksapp
>      + xtokspre
> 
> from the names and a quick look at the sources, we can see what some
> of them do, but are these experimental additions that may go, or are
> they new primitives that just missed the manual in the current
> revision.  Either way some hints of what they do would be useful,
> thanks:-)
once i've tested them (read: let them test in production by ctx users) 
they will become official in 1.10 (although for instance fixupboxesmode 
and endlocalcontrol might stay experimental for a quite while as they 
are really experimental)

(thanks for checking, i'll add them to the todo list)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From henrimenke at gmail.com  Sun Sep  2 02:57:17 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Sun, 2 Sep 2018 12:57:17 +1200
Subject: [luatex] Luatex 1.08.0 announcement
In-Reply-To: <CAG5iGsAeFxJ3Sq_7F9btTL_-XV5_u7NwzB7MTJkQUB6tivyeBw@mail.gmail.com>
References: <CAG5iGsAeFxJ3Sq_7F9btTL_-XV5_u7NwzB7MTJkQUB6tivyeBw@mail.gmail.com>
Message-ID: <0d7e5595-d415-17fa-932c-b8929c7e5be7@gmail.com>



On 01/09/18 07:00, luigi scarso wrote:
> ==============================================================
> LuaTeX 1.08 2018-08-28
> ==============================================================
> 
> 
> (1) This release is a prelude to 1.10, the next stable iteration of LuaTeX
> after version 1.00.
> 
> (2) Lua 5.3 is now considered to be default and we might use 5.4 in version
> 1.10. There are no real functional changed expected. You still need to
> rename
> the binary for 5.3!
> 
> (3) Binary mode is no longer available in MPlib but it is still available in
> stand alone MetaPost. This simplifies compilation and reduces dependencies.
> 
> (4) The dependency on Poppler for pdf image inclusion has been removed. We
> now use a small dedicated library written by Pawel Jakowski. We no longer
> need c++ compilers. We're in the process of making it behave well on all
> platforms. It has been tested on intel platforms.

Hm, a C++ compiler still seems to be necessary.  The build fails without
one.

configure: LuaTeX enabled, requiring C++11 support
[...]
configure: error: *** A compiler with support for C++11 language
features is required.

> 
> (5) We know that there can be some (alignment) issues with the arm platform
> but these are looked into. Therefore, later this year we will release 1.09.
> Version 1.10 is planned for TeXlive. We hope that ffi works ok on intel and
> arm platforms at that point.
> 
> (6) There have been some extensions to the Lua libraries and some callbacks
> have been added. Also, a few new primitives have been introduced. The
> documentation mentions the stable extensions.
> 
> (7) There are the usual bug fixes and cleanups but there have been no real
> fundamental changes in the API.
> 
> The LuaTeX team?



From henrimenke at gmail.com  Wed Sep  5 10:03:08 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Wed, 5 Sep 2018 20:03:08 +1200
Subject: [luatex] Luatex 1.08.0 announcement
In-Reply-To: <0d7e5595-d415-17fa-932c-b8929c7e5be7@gmail.com>
References: <CAG5iGsAeFxJ3Sq_7F9btTL_-XV5_u7NwzB7MTJkQUB6tivyeBw@mail.gmail.com>
 <0d7e5595-d415-17fa-932c-b8929c7e5be7@gmail.com>
Message-ID: <99e6446a-a051-4e5e-e37e-a7eb5570bb62@gmail.com>

bump

On 02/09/18 12:57, Henri Menke wrote:
> 
> 
> On 01/09/18 07:00, luigi scarso wrote:
>> ==============================================================
>> LuaTeX 1.08 2018-08-28
>> ==============================================================
>>
>>
>> (1) This release is a prelude to 1.10, the next stable iteration of LuaTeX
>> after version 1.00.
>>
>> (2) Lua 5.3 is now considered to be default and we might use 5.4 in version
>> 1.10. There are no real functional changed expected. You still need to
>> rename
>> the binary for 5.3!
>>
>> (3) Binary mode is no longer available in MPlib but it is still available in
>> stand alone MetaPost. This simplifies compilation and reduces dependencies.
>>
>> (4) The dependency on Poppler for pdf image inclusion has been removed. We
>> now use a small dedicated library written by Pawel Jakowski. We no longer
>> need c++ compilers. We're in the process of making it behave well on all
>> platforms. It has been tested on intel platforms.
> 
> Hm, a C++ compiler still seems to be necessary.  The build fails without
> one.
> 
> configure: LuaTeX enabled, requiring C++11 support
> [...]
> configure: error: *** A compiler with support for C++11 language
> features is required.
> 
>>
>> (5) We know that there can be some (alignment) issues with the arm platform
>> but these are looked into. Therefore, later this year we will release 1.09.
>> Version 1.10 is planned for TeXlive. We hope that ffi works ok on intel and
>> arm platforms at that point.
>>
>> (6) There have been some extensions to the Lua libraries and some callbacks
>> have been added. Also, a few new primitives have been introduced. The
>> documentation mentions the stable extensions.
>>
>> (7) There are the usual bug fixes and cleanups but there have been no real
>> fundamental changes in the API.
>>
>> The LuaTeX team?
> 



From luigi.scarso at gmail.com  Wed Sep  5 11:34:34 2018
From: luigi.scarso at gmail.com (luigi scarso)
Date: Wed, 5 Sep 2018 11:34:34 +0200
Subject: [luatex] Luatex 1.08.0 announcement
In-Reply-To: <99e6446a-a051-4e5e-e37e-a7eb5570bb62@gmail.com>
References: <CAG5iGsAeFxJ3Sq_7F9btTL_-XV5_u7NwzB7MTJkQUB6tivyeBw@mail.gmail.com>
 <0d7e5595-d415-17fa-932c-b8929c7e5be7@gmail.com>
 <99e6446a-a051-4e5e-e37e-a7eb5570bb62@gmail.com>
Message-ID: <CAG5iGsCqgfXmsY9zcmGM1j8kGsmPVboGrOjf4aw_5n7+vghbrQ@mail.gmail.com>

On Wed, Sep 5, 2018 at 10:03 AM Henri Menke <henrimenke at gmail.com> wrote:

> bump
>
> On 02/09/18 12:57, Henri Menke wrote:
> >
> >
> > On 01/09/18 07:00, luigi scarso wrote:
> >> ==============================================================
> >> LuaTeX 1.08 2018-08-28
> >> ==============================================================
> >>
> >>
> >> (1) This release is a prelude to 1.10, the next stable iteration of
> LuaTeX
> >> after version 1.00.
> >>
> >> (2) Lua 5.3 is now considered to be default and we might use 5.4 in
> version
> >> 1.10. There are no real functional changed expected. You still need to
> >> rename
> >> the binary for 5.3!
> >>
> >> (3) Binary mode is no longer available in MPlib but it is still
> available in
> >> stand alone MetaPost. This simplifies compilation and reduces
> dependencies.
> >>
> >> (4) The dependency on Poppler for pdf image inclusion has been removed.
> We
> >> now use a small dedicated library written by Pawel Jakowski. We no
> longer
> >> need c++ compilers. We're in the process of making it behave well on all
> >> platforms. It has been tested on intel platforms.
> >
> > Hm, a C++ compiler still seems to be necessary.  The build fails without
> > one.
>
The luatex from svn repository
is a cut of texlive, so we have all the autotools scripts (i.e. those we
need to compile luatex,luajittex,metapost)
from TeXLive -- -and TeXLive  needs C++ . It's easy to modify the script(s)
to drop the C++ dependency for luatex,
but it has to be done in coordination with the TeXLive maintainer (very
likely it will happen for  luatex 1.09.0 expected before end of year).

Integrators of other tex distributions should find that a C++ compiler is
not needed anymore.


-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://tug.org/pipermail/luatex/attachments/20180905/26ae1ce1/attachment.html>

From preining at logic.at  Thu Sep  6 03:30:15 2018
From: preining at logic.at (Norbert Preining)
Date: Thu, 6 Sep 2018 10:30:15 +0900
Subject: [luatex] luatex 1.08 in TL cannot be built with --with-system-gmp
Message-ID: <20180906013015.GC4225@bulldog.preining.info>

Hi Luigi, hi all,

configuring current TL sources with
	--with-system-gmp
I get an error:
gcc -DHAVE_CONFIG_H -I. -I../../../texk/web2c -I./w2c    -I/usr/include/libpng16  -I/home/norbert/Development/TeX/texlive.git/Build/source/foo/texk -I/home/norbert/Development/TeX/texlive.git/Build/source/texk -I../../../texk/web2c/mplibdir  -Wimplicit -Wreturn-type -g -O2 -MT libmplibcore_a-mpmathbinary.o -MD -MP -MF .deps/libmplibcore_a-mpmathbinary.Tpo -c -o libmplibcore_a-mpmathbinary.o `test -f 'mpmathbinary.c' || echo '../../../texk/web2c/'`mpmathbinary.c
In file included from ../../../texk/web2c/mplibdir/mpmathbinary.w:28:
../../../texk/web2c/mplibdir/mpmathbinary.w:44:10: fatal error: gmp/config.h: No such file or directory
 #include <gmp/config.h>
          ^~~~~~~~~~~~~~
compilation terminated.


Debian's libgmp-dev does not ship 
	gmp/config.h
only
	gmp.h

Is it now necessary to build with the TL shipped libgmp?

Thanks

Norbert

--
PREINING Norbert                               http://www.preining.info
Accelia Inc.     +    JAIST     +    TeX Live     +    Debian Developer
GPG: 0x860CDC13   fp: F7D8 A928 26E3 16A1 9FA0 ACF0 6CAC A448 860C DC13

From patrick at gundla.ch  Fri Sep  7 08:29:01 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 7 Sep 2018 08:29:01 +0200
Subject: [luatex] to unicode / copy paste from PDF
Message-ID: <203B74B6-AF29-4ECE-B4B3-BF84ED8975C5@gundla.ch>

Hello all,

I have used LuaTeX 0.79 for a while and now LuaTeX 1.07 (with my own software). I think since the switch I cannot copy & paste from PDF anymore. Now I have seen that I can set (in the font table)

tounicode = 0 (instead of 1 what I had before)

And now copy and paste seems to work fine.

Are there any drawbacks using that? Or should I take care of the to unicode mapping myself in the long run? 


 Patrick






From doc.evans at gmail.com  Sat Sep  8 22:38:22 2018
From: doc.evans at gmail.com (D. R. Evans)
Date: Sat, 8 Sep 2018 14:38:22 -0600
Subject: [luatex] simple question: how to select LM font
Message-ID: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>

This is my first attempt to use luatex. I am running up-to-date 64-bit debian
stable.

I have the Latin Modern fonts installed, but don't know how to get luatex to
recognise and use them. In particular, because I will be using Unicode
characters, I need access to the complete set of glyphs, not just the subsets
available with the Cork and other old-style encodings.

For example, the line:
  \font\rm=lmr10

Causes:
  ! Font \rm=lmr10 not loadable: metric data not found or bad.
to appear in the log file.

[\font\rm=ec-lmr10 works, but then I can't access the Unicode characters
seamlessly]

So, within luatex, how do I access the full range of Unicode characters
encoded in the LM fonts?

  Doc

-- 
Web:  http://enginehousebooks.com/drevans

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 195 bytes
Desc: OpenPGP digital signature
URL: <https://tug.org/pipermail/luatex/attachments/20180908/6c54219c/attachment.sig>

From martin at oneiros.de  Sat Sep  8 22:50:35 2018
From: martin at oneiros.de (=?UTF-8?Q?Martin_Schr=C3=B6der?=)
Date: Sat, 8 Sep 2018 22:50:35 +0200
Subject: [luatex] simple question: how to select LM font
In-Reply-To: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>
References: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>
Message-ID: <CAP7DCDfg0X0jysrKzwFDbBRzVF1yPxVpNo3+YwKJjPKCzvcXSg@mail.gmail.com>

Am Sa., 8. Sep. 2018 um 22:38 Uhr schrieb D. R. Evans <doc.evans at gmail.com>:
> For example, the line:
>   \font\rm=lmr10

\usepackage{fontspec}

Best
    Martin

From Herbert.Voss at fu-berlin.de  Sat Sep  8 22:57:00 2018
From: Herbert.Voss at fu-berlin.de (Herbert Voss)
Date: Sat, 8 Sep 2018 22:57:00 +0200
Subject: [luatex] simple question: how to select LM font
In-Reply-To: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>
References: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>
Message-ID: <19d4ae4b-c7ff-4b94-ca80-c38e2994b182@fu-berlin.de>



Am 08.09.18 um 22:38 schrieb D. R. Evans:
> This is my first attempt to use luatex. I am running up-to-date 64-bit debian
> stable.
>
> I have the Latin Modern fonts installed, but don't know how to get luatex to
> recognise and use them. In particular, because I will be using Unicode
> characters, I need access to the complete set of glyphs, not just the subsets
> available with the Cork and other old-style encodings.
>
> For example, the line:
>    \font\rm=lmr10

for LuaTeX:

\input luaotfload.sty
\font\LMR={file:lmroman10-regular.otf} at 11pt
\LMR
foo
\bye


Herbert


> Causes:
>    ! Font \rm=lmr10 not loadable: metric data not found or bad.
> to appear in the log file.
>
> [\font\rm=ec-lmr10 works, but then I can't access the Unicode characters
> seamlessly]
>
> So, within luatex, how do I access the full range of Unicode characters
> encoded in the LM fonts?
>
>    Doc
>


From doc.evans at gmail.com  Sat Sep  8 23:17:46 2018
From: doc.evans at gmail.com (D. R. Evans)
Date: Sat, 8 Sep 2018 15:17:46 -0600
Subject: [luatex] simple question: how to select LM font
In-Reply-To: <19d4ae4b-c7ff-4b94-ca80-c38e2994b182@fu-berlin.de>
References: <26c3090c-a36d-a5fb-daad-e3c6f4be48e7@gmail.com>
 <19d4ae4b-c7ff-4b94-ca80-c38e2994b182@fu-berlin.de>
Message-ID: <ed0fe9af-7311-da6b-b540-4c3f1cbc8ebb@gmail.com>

Herbert Voss wrote on 09/08/2018 02:57 PM:
>
>> I have the Latin Modern fonts installed, but don't know how to get luatex to
>> recognise and use them. In particular, because I will be using Unicode
>> characters, I need access to the complete set of glyphs, not just the subsets
>> available with the Cork and other old-style encodings.
>>

> for LuaTeX:
> 
> \input luaotfload.sty
> \font\LMR={file:lmroman10-regular.otf} at 11pt
> \LMR
> foo
> \bye

Thank you very much.

The documentation for luaotfload.sty looks excellent and both comprehensive
and amazingly comprehensible for TeX-related font documentation. Thanks again.

  Doc

-- 
Web:  http://enginehousebooks.com/drevans

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 195 bytes
Desc: OpenPGP digital signature
URL: <https://tug.org/pipermail/luatex/attachments/20180908/3e68269d/attachment.sig>

From henrimenke at gmail.com  Sat Sep 15 07:50:04 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Sat, 15 Sep 2018 17:50:04 +1200
Subject: [luatex] How to insert mathkerns?
Message-ID: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>

Dear list,

I'm trying to add mathkerns to a font on the fly.  I adapted the code
from ConTeXt in good-mth.lua but nothing happens.  How can I make this
work?  MWE below.
N.B. I'm using 1.09.0 svn6938 with Ulrike's fontloader 2018-09-01

Cheers, Henri

---

\input luaotfload.sty
\directlua{
function kern_right_fence(tfmdata)
    if tfmdata.mathparameters then
        local characters = tfmdata.characters
        if characters[0x1D44E] then % we have at least an italic a
            print("PATCHING FONT " .. tfmdata.psname)
            characters[0x1D453].mathkerns = {
                force = true,
                bottomright = { { kern = 1000 } },
            }
        end
    end
end
%
luatexbase.add_to_callback("luaotfload.patch_font",
                           kern_right_fence,
                           "kern right fence")
}

\font\lmmath="Latin Modern Math:script=math;" at 10pt
\textfont0=\lmmath

\Umathcodenum`e="1D452
\Umathcodenum`f="1D453
\Umathcodenum`g="1D454

$efg$

\bye



From luigi.scarso at gmail.com  Sat Sep 15 08:34:20 2018
From: luigi.scarso at gmail.com (luigi scarso)
Date: Sat, 15 Sep 2018 08:34:20 +0200
Subject: [luatex] How to insert mathkerns?
In-Reply-To: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
References: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
Message-ID: <CAG5iGsAK6Q6Hx_31+B+eqyE7wVO02T0bcHTgLeW02MRmLBqg4A@mail.gmail.com>

On Sat, Sep 15, 2018 at 7:50 AM Henri Menke <henrimenke at gmail.com> wrote:

> Dear list,
>
> I'm trying to add mathkerns to a font on the fly.  I adapted the code
> from ConTeXt in good-mth.lua but nothing happens.  How can I make this
> work?  MWE below.
> N.B. I'm using 1.09.0 svn6938 with Ulrike's fontloader 2018-09-01
>
> Be careful with experimental (is not the case of  rev 6938):
we are  fixing things .
Especially the "WORK IN PROGRESS" commits , that cannot even compile.
-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://tug.org/pipermail/luatex/attachments/20180915/95a2fe02/attachment.html>

From henrimenke at gmail.com  Sat Sep 15 09:04:03 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Sat, 15 Sep 2018 19:04:03 +1200
Subject: [luatex] How to insert mathkerns?
In-Reply-To: <CAG5iGsAK6Q6Hx_31+B+eqyE7wVO02T0bcHTgLeW02MRmLBqg4A@mail.gmail.com>
References: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
 <CAG5iGsAK6Q6Hx_31+B+eqyE7wVO02T0bcHTgLeW02MRmLBqg4A@mail.gmail.com>
Message-ID: <96707a4a-f4f5-e735-f5b6-b46d68b43da8@gmail.com>

On 15/09/18 18:34, luigi scarso wrote:
> On Sat, Sep 15, 2018 at 7:50 AM Henri Menke <henrimenke at gmail.com> wrote:
> 
>> Dear list,
>>
>> I'm trying to add mathkerns to a font on the fly.  I adapted the code
>> from ConTeXt in good-mth.lua but nothing happens.  How can I make this
>> work?  MWE below.
>> N.B. I'm using 1.09.0 svn6938 with Ulrike's fontloader 2018-09-01
>>
>> Be careful with experimental (is not the case of  rev 6938):
> we are  fixing things .
> Especially the "WORK IN PROGRESS" commits , that cannot even compile.
> 

Sorry for the confusion, but that's not really the point.  It also
doesn't do anything in the release version 1.07.0 with luaotfload from
TeX Live.



From j.hagen at xs4all.nl  Sat Sep 15 10:53:49 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Sat, 15 Sep 2018 10:53:49 +0200
Subject: [luatex] How to insert mathkerns?
In-Reply-To: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
References: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
Message-ID: <fa0f6a27-cd0c-6366-f59c-a76527dbe064@xs4all.nl>

On 9/15/2018 7:50 AM, Henri Menke wrote:
> Dear list,
> 
> I'm trying to add mathkerns to a font on the fly.  I adapted the code
> from ConTeXt in good-mth.lua but nothing happens.  How can I make this
> work?  MWE below.
> N.B. I'm using 1.09.0 svn6938 with Ulrike's fontloader 2018-09-01
> 
> Cheers, Henri
> 
> ---
> 
> \input luaotfload.sty
> \directlua{
> function kern_right_fence(tfmdata)
>      if tfmdata.mathparameters then
>          local characters = tfmdata.characters
>          if characters[0x1D44E] then % we have at least an italic a
>              print("PATCHING FONT " .. tfmdata.psname)
>              characters[0x1D453].mathkerns = {
>                  force = true,
>                  bottomright = { { kern = 1000 } },
>              }
>          end
>      end
> end
> %
> luatexbase.add_to_callback("luaotfload.patch_font",
>                             kern_right_fence,
>                             "kern right fence")
> }
> 
> \font\lmmath="Latin Modern Math:script=math;" at 10pt
> \textfont0=\lmmath
> 
> \Umathcodenum`e="1D452
> \Umathcodenum`f="1D453
> \Umathcodenum`g="1D454
> 
> $efg$

I don't know how the plugs in otfload work but it's more something like

characters[0x1D453].math =
   { kerns = { bottomright = { { kern = 1000 } } }

where of course you need to make sure that when there is already a math 
table you add instead of replace; eventually that becomes something scaled

characters[0x1D453].mathkern.bottom_right = ...

don't confuse a higher level context interface with low level font 
properties

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From henrimenke at gmail.com  Sat Sep 15 11:44:08 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Sat, 15 Sep 2018 21:44:08 +1200
Subject: [luatex] How to insert mathkerns?
In-Reply-To: <fa0f6a27-cd0c-6366-f59c-a76527dbe064@xs4all.nl>
References: <5291937a-e76a-fc91-9a59-55fe6cff4877@gmail.com>
 <fa0f6a27-cd0c-6366-f59c-a76527dbe064@xs4all.nl>
Message-ID: <800d855a-4643-4b2a-f4ba-a7d5d8ddd824@gmail.com>

On 09/15/2018 08:53 PM, Hans Hagen wrote:
> On 9/15/2018 7:50 AM, Henri Menke wrote:
>> Dear list,
>>
>> I'm trying to add mathkerns to a font on the fly.? I adapted the code
>> from ConTeXt in good-mth.lua but nothing happens.? How can I make this
>> work?? MWE below.
>> N.B. I'm using 1.09.0 svn6938 with Ulrike's fontloader 2018-09-01
>>
>> Cheers, Henri
>>
>> ---
>>
>> \input luaotfload.sty
>> \directlua{
>> function kern_right_fence(tfmdata)
>> ???? if tfmdata.mathparameters then
>> ???????? local characters = tfmdata.characters
>> ???????? if characters[0x1D44E] then % we have at least an italic a
>> ???????????? print("PATCHING FONT " .. tfmdata.psname)
>> ???????????? characters[0x1D453].mathkerns = {
>> ???????????????? force = true,
>> ???????????????? bottomright = { { kern = 1000 } },
>> ???????????? }
>> ???????? end
>> ???? end
>> end
>> %
>> luatexbase.add_to_callback("luaotfload.patch_font",
>> ??????????????????????????? kern_right_fence,
>> ??????????????????????????? "kern right fence")
>> }
>>
>> \font\lmmath="Latin Modern Math:script=math;" at 10pt
>> \textfont0=\lmmath
>>
>> \Umathcodenum`e="1D452
>> \Umathcodenum`f="1D453
>> \Umathcodenum`g="1D454
>>
>> $efg$
> 
> I don't know how the plugs in otfload work but it's more something like
> 
> characters[0x1D453].math =
> ? { kerns = { bottomright = { { kern = 1000 } } }

That doesn't do anything either :( but thanks for replying

> 
> where of course you need to make sure that when there is already a math
> table you add instead of replace; eventually that becomes something scaled
> 
> characters[0x1D453].mathkern.bottom_right = ...
> 
> don't confuse a higher level context interface with low level font
> properties

I won't because in ConTeXt I can just use goodies, but they are not
available in Plain TeX and LaTeX.

> 
> Hans
> 
> 
> -----------------------------------------------------------------
> ????????????????????????????????????????? Hans Hagen | PRAGMA ADE
> ????????????? Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ?????? tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------


From patrick at gundla.ch  Tue Sep 18 08:50:01 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 18 Sep 2018 08:50:01 +0200
Subject: [luatex] How to letter space font?
Message-ID: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>

Hello all,


I need to insert little spaces between characters / glyphs in a word. If I understand the manual correctly, there was a primitive \letterspacefont in pdftex doing that. Is there something similar in LuaTeX? (I have never used the PDFTeX's command).

Of course I could insert little spaces myself, but if there is a convenient command for that, I'd give this a try.


Patrick

From andreas.dafferner at adw.uni-heidelberg.de  Tue Sep 18 09:02:27 2018
From: andreas.dafferner at adw.uni-heidelberg.de (Andreas Dafferner)
Date: Tue, 18 Sep 2018 09:02:27 +0200
Subject: [luatex] How to letter space font?
In-Reply-To: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
Message-ID: <c8a2269c-14a9-d4c4-dcfc-fd67f8283e08@adw.uni-heidelberg.de>

Hallo Patrick,

Am 18.09.18 um 08:50 schrieb Patrick Gundlach:
> Hello all,
> 
> 
> I need to insert little spaces between characters / glyphs in a word. If I understand the manual correctly, there was a primitive \letterspacefont in pdftex doing that. Is there something similar in LuaTeX? (I have never used the PDFTeX's command).

hab das mit \addfontfeatures{LetterSpace=15.0}% und LuaLaTeX gemacht

viele Gr??e

Andreas

From patrick at gundla.ch  Tue Sep 18 10:01:38 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Tue, 18 Sep 2018 10:01:38 +0200
Subject: [luatex] How to letter space font?
In-Reply-To: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
Message-ID: <BF478152-C4E7-44A4-8CDB-01B4E3015E80@gundla.ch>



> I need to insert little spaces between characters / glyphs in a word. If I understand the manual correctly, there was a primitive \letterspacefont in pdftex doing that. Is there something similar in LuaTeX? (I have never used the PDFTeX's command).


> 
> Of course I could insert little spaces myself, but if there is a convenient command for that, I'd give this a try.

thanks for the answers. Fontspec (= luaotfload = ConTeXt) goes the second way. That is what I will do now.

Patrick




From luatex at nililand.de  Tue Sep 18 10:24:54 2018
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 18 Sep 2018 10:24:54 +0200
Subject: [luatex] How to letter space font?
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
Message-ID: <fmogo6o3cspm$.dlg@nililand.de>

Am Tue, 18 Sep 2018 08:50:01 +0200 schrieb Patrick Gundlach:

> Hello all, 
> 
> 
> 
> I need to insert little spaces between characters / glyphs in a
> word. If I understand the manual correctly, there was a primitive
> \letterspacefont in pdftex doing that. Is there something similar
> in LuaTeX? (I have never used the PDFTeX's command). 

the command exists in luatex too. But there was a bug in 1.07 (and
in some version of 1.08) and it failed for tfm-fonts with virtual
fonts.


\input luaotfload.sty
\font\1="name:SourceSansPro-Regular" at 10pt %
\1 aaa

\letterspacefont\2\1 100
\2 aaa

\bye

-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luigi.scarso at gmail.com  Tue Sep 18 10:42:35 2018
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 18 Sep 2018 10:42:35 +0200
Subject: [luatex] How to letter space font?
In-Reply-To: <fmogo6o3cspm$.dlg@nililand.de>
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
 <fmogo6o3cspm$.dlg@nililand.de>
Message-ID: <CAG5iGsDUH+7XVj8jabGfJ5esebYxww5qFg0mV7rtsbTpHT=AAg@mail.gmail.com>

On Tue, Sep 18, 2018 at 10:25 AM Ulrike Fischer <luatex at nililand.de> wrote:

> Am Tue, 18 Sep 2018 08:50:01 +0200 schrieb Patrick Gundlach:
>
> > Hello all,
> >
> >
> >
> > I need to insert little spaces between characters / glyphs in a
> > word. If I understand the manual correctly, there was a primitive
> > \letterspacefont in pdftex doing that. Is there something similar
> > in LuaTeX? (I have never used the PDFTeX's command).
>
> the command exists in luatex too. But there was a bug in 1.07 (and
> in some version of 1.08) and it failed for tfm-fonts with virtual
> fonts.
>
> as far as I know, there should be only one version of luatex 1.08


>
> \input luaotfload.sty
> \font\1="name:SourceSansPro-Regular" at 10pt %
> \1 aaa
>
> \letterspacefont\2\1 100
> \2 aaa
>
> \bye
>
>
does it fails at you end ?
Here it seems ok (texlive 2018)

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://tug.org/pipermail/luatex/attachments/20180918/1d108748/attachment.html>

From luatex at nililand.de  Tue Sep 18 11:01:03 2018
From: luatex at nililand.de (Ulrike Fischer)
Date: Tue, 18 Sep 2018 11:01:03 +0200
Subject: [luatex] How to letter space font?
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
 <fmogo6o3cspm$.dlg@nililand.de>
 <CAG5iGsDUH+7XVj8jabGfJ5esebYxww5qFg0mV7rtsbTpHT=AAg@mail.gmail.com>
Message-ID: <1031c54nrxhj7$.dlg@nililand.de>

Am Tue, 18 Sep 2018 10:42:35 +0200 schrieb luigi scarso:

> does it fails at you end ?
> Here it seems ok (texlive 2018)

No, that's not the failing example as it uses an otf font. 
I only wanted to mention the bug so that Patrick is warned in case
type1 font are involved.

The failing example is 

\nopagenumbers
%\font\1="cmr10" at 10pt % OK
%\font\1="pbkd8t" at 10pt  % not OK
\font\1="SourceSansPro-Regular-osf-t1" at 10pt % not OK
\1 aaa

\letterspacefont\2\1 100
\2 aaa

\bye

But as I wrote the bug has been resolved and in the current 1.08 (id
6930) it works fine. 


-- 
Ulrike Fischer 
http://www.troubleshooting-tex.de/


From luigi.scarso at gmail.com  Tue Sep 18 11:07:51 2018
From: luigi.scarso at gmail.com (luigi scarso)
Date: Tue, 18 Sep 2018 11:07:51 +0200
Subject: [luatex] How to letter space font?
In-Reply-To: <1031c54nrxhj7$.dlg@nililand.de>
References: <00AE240E-579F-492F-B6CB-3AF8FE18C700@gundla.ch>
 <fmogo6o3cspm$.dlg@nililand.de>
 <CAG5iGsDUH+7XVj8jabGfJ5esebYxww5qFg0mV7rtsbTpHT=AAg@mail.gmail.com>
 <1031c54nrxhj7$.dlg@nililand.de>
Message-ID: <CAG5iGsB3cMzu9YTWj06tKZNXgKYUWw9Zq1QGwK7gUGh=7Q1ZGg@mail.gmail.com>

On Tue, Sep 18, 2018 at 11:01 AM Ulrike Fischer <luatex at nililand.de> wrote:

>
> But as I wrote the bug has been resolved and in the current 1.08 (id
> 6930) it works fine.
>
ah ok, luatex trunk, so latest context beta.

-- 
luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://tug.org/pipermail/luatex/attachments/20180918/66ae1631/attachment.html>

From henrimenke at gmail.com  Thu Sep 27 07:23:01 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Thu, 27 Sep 2018 17:23:01 +1200
Subject: [luatex] Subscript drop too large
Message-ID: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>

Dear list,

When using a Unicode math font, the subscript drop increases by a lot.
It does not seem to be font dependent, so it's likely an engine issue.
Is there any parameter which I could tweak?

Cheers, Henri

See also https://tex.stackexchange.com/questions/452455

---

\input luaotfload.sty
\font\math="Latin Modern Math" at 10pt
$\hbox{get}_{gst}$
\textfont0=\math
$\hbox{get}_{gst}$
\bye



From j.hagen at xs4all.nl  Thu Sep 27 09:50:44 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Thu, 27 Sep 2018 09:50:44 +0200
Subject: [luatex] Subscript drop too large
In-Reply-To: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
References: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
Message-ID: <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>

On 9/27/2018 7:23 AM, Henri Menke wrote:
> Dear list,
> 
> When using a Unicode math font, the subscript drop increases by a lot.
> It does not seem to be font dependent, so it's likely an engine issue.
> Is there any parameter which I could tweak?

all kind of math parameters .. like

$ \the\Umathsubshiftdrop\textstyle\quad {gt}_{gt} $
$ \Umathsubshiftdrop\textstyle.2ex      {gt}_{gt} $

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From henrimenke at gmail.com  Thu Sep 27 12:37:51 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Thu, 27 Sep 2018 22:37:51 +1200
Subject: [luatex] Subscript drop too large
In-Reply-To: <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>
References: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
 <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>
Message-ID: <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>

On 9/27/18 7:50 PM, Hans Hagen wrote:
> On 9/27/2018 7:23 AM, Henri Menke wrote:
>> Dear list,
>>
>> When using a Unicode math font, the subscript drop increases by a lot.
>> It does not seem to be font dependent, so it's likely an engine issue.
>> Is there any parameter which I could tweak?
> 
> all kind of math parameters .. like
> 
> $ \the\Umathsubshiftdrop\textstyle\quad {gt}_{gt} $
> $ \Umathsubshiftdrop\textstyle.2ex????? {gt}_{gt} $

This partly answers the question, but it seems that there is something
wrong with subscripts after boxes, see MWE below.  With XeTeX it looks
okay and the drop is basically the same with and without a Unicode math
font, but with LuaTeX the drop after the box is much larger with a
Unicode math font whereas the drop after a regular atom is the same.

\ifdefined\directlua
  \input luaotfload.sty
\fi
\font\math="Latin Modern Math" at 10pt
$\hbox{gt}_{gt} gt_{gt}$
\textfont0=\math
$\hbox{gt}_{gt} gt_{gt}$
\bye

> 
> Hans
> 
> -----------------------------------------------------------------
> ????????????????????????????????????????? Hans Hagen | PRAGMA ADE
> ????????????? Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ?????? tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------


From j.hagen at xs4all.nl  Thu Sep 27 12:53:43 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Thu, 27 Sep 2018 12:53:43 +0200
Subject: [luatex] Subscript drop too large
In-Reply-To: <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>
References: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
 <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>
 <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>
Message-ID: <4ce3545f-8456-1fe3-b6d8-c629fe919a75@xs4all.nl>

On 9/27/2018 12:37 PM, Henri Menke wrote:
> On 9/27/18 7:50 PM, Hans Hagen wrote:
>> On 9/27/2018 7:23 AM, Henri Menke wrote:
>>> Dear list,
>>>
>>> When using a Unicode math font, the subscript drop increases by a lot.
>>> It does not seem to be font dependent, so it's likely an engine issue.
>>> Is there any parameter which I could tweak?
>>
>> all kind of math parameters .. like
>>
>> $ \the\Umathsubshiftdrop\textstyle\quad {gt}_{gt} $
>> $ \Umathsubshiftdrop\textstyle.2ex????? {gt}_{gt} $
> 
> This partly answers the question, but it seems that there is something
> wrong with subscripts after boxes, see MWE below.  With XeTeX it looks
> okay and the drop is basically the same with and without a Unicode math
> font, but with LuaTeX the drop after the box is much larger with a
> Unicode math font whereas the drop after a regular atom is the same.
> 
> \ifdefined\directlua
>    \input luaotfload.sty
> \fi
> \font\math="Latin Modern Math" at 10pt
> $\hbox{gt}_{gt} gt_{gt}$
> \textfont0=\math
> $\hbox{gt}_{gt} gt_{gt}$

- fwiw i only test in context (i don't know wnat luaotfload does with math)

- afaiks your \math font is not set up as math

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From henrimenke at gmail.com  Thu Sep 27 13:10:39 2018
From: henrimenke at gmail.com (Henri Menke)
Date: Thu, 27 Sep 2018 23:10:39 +1200
Subject: [luatex] Subscript drop too large
In-Reply-To: <4ce3545f-8456-1fe3-b6d8-c629fe919a75@xs4all.nl>
References: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
 <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>
 <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>
 <4ce3545f-8456-1fe3-b6d8-c629fe919a75@xs4all.nl>
Message-ID: <be60fcf2-e647-f9c7-e670-468cda4bb125@gmail.com>

On 9/27/18 10:53 PM, Hans Hagen wrote:
> On 9/27/2018 12:37 PM, Henri Menke wrote:
>> On 9/27/18 7:50 PM, Hans Hagen wrote:
>>> On 9/27/2018 7:23 AM, Henri Menke wrote:
>>>> Dear list,
>>>>
>>>> When using a Unicode math font, the subscript drop increases by a lot.
>>>> It does not seem to be font dependent, so it's likely an engine issue.
>>>> Is there any parameter which I could tweak?
>>>
>>> all kind of math parameters .. like
>>>
>>> $ \the\Umathsubshiftdrop\textstyle\quad {gt}_{gt} $
>>> $ \Umathsubshiftdrop\textstyle.2ex????? {gt}_{gt} $
>>
>> This partly answers the question, but it seems that there is something
>> wrong with subscripts after boxes, see MWE below.? With XeTeX it looks
>> okay and the drop is basically the same with and without a Unicode math
>> font, but with LuaTeX the drop after the box is much larger with a
>> Unicode math font whereas the drop after a regular atom is the same.
>>
>> \ifdefined\directlua
>> ?? \input luaotfload.sty
>> \fi
>> \font\math="Latin Modern Math" at 10pt
>> $\hbox{gt}_{gt} gt_{gt}$
>> \textfont0=\math
>> $\hbox{gt}_{gt} gt_{gt}$
> 
> - fwiw i only test in context (i don't know wnat luaotfload does with math)

Fair enough.  Consider the following MWE:

\starttext

$\hbox{gt}_{gt} {gt}_{gt}$

\stoptext

Attached are two versions, one typeset with ?texexec --xtx test.tex?,
the other with ?context test.tex? (should be obvious from the file
name).  In the LuaTeX version the subscript drop is considerably larger
than in the XeTeX version.

> 
> - afaiks your \math font is not set up as math
> 
> Hans
> 
> 
> -----------------------------------------------------------------
> ????????????????????????????????????????? Hans Hagen | PRAGMA ADE
> ????????????? Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
> ?????? tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
> -----------------------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-lua.pdf
Type: application/pdf
Size: 8395 bytes
Desc: not available
URL: <https://tug.org/pipermail/luatex/attachments/20180927/00ce8aac/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-xtx.pdf
Type: application/pdf
Size: 4257 bytes
Desc: not available
URL: <https://tug.org/pipermail/luatex/attachments/20180927/00ce8aac/attachment-0003.pdf>

From j.hagen at xs4all.nl  Thu Sep 27 13:10:47 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Thu, 27 Sep 2018 13:10:47 +0200
Subject: [luatex] Subscript drop too large
In-Reply-To: <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>
References: <fe27ac6a-ce84-95a1-5919-ba98957dd448@gmail.com>
 <a7098e2f-b356-b1bd-d060-37e8320ffde4@xs4all.nl>
 <b287cebe-3799-6473-a369-4e20b61e9885@gmail.com>
Message-ID: <9a17dec1-0cee-4063-3f9b-f083783ec2bb@xs4all.nl>

On 9/27/2018 12:37 PM, Henri Menke wrote:
> On 9/27/18 7:50 PM, Hans Hagen wrote:
>> On 9/27/2018 7:23 AM, Henri Menke wrote:
>>> Dear list,
>>>
>>> When using a Unicode math font, the subscript drop increases by a lot.
>>> It does not seem to be font dependent, so it's likely an engine issue.
>>> Is there any parameter which I could tweak?
>>
>> all kind of math parameters .. like
>>
>> $ \the\Umathsubshiftdrop\textstyle\quad {gt}_{gt} $
>> $ \Umathsubshiftdrop\textstyle.2ex????? {gt}_{gt} $
> 
> This partly answers the question, but it seems that there is something
> wrong with subscripts after boxes, see MWE below.  With XeTeX it looks
> okay and the drop is basically the same with and without a Unicode math
> font, but with LuaTeX the drop after the box is much larger with a
> Unicode math font whereas the drop after a regular atom is the same.
> 
> \ifdefined\directlua
>    \input luaotfload.sty
> \fi
> \font\math="Latin Modern Math" at 10pt
> $\hbox{gt}_{gt} gt_{gt}$
> \textfont0=\math
> $\hbox{gt}_{gt} gt_{gt}$
> \bye
thee drop shifts kick in after non-characters so if you don't want that 
you can just set them to zero (instead of the value set by the font)

(afaiks it looks the same as in pdftex)

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Fri Sep 28 09:19:36 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 28 Sep 2018 09:19:36 +0200
Subject: [luatex] Accented characters on Windows / lfs
Message-ID: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>

Hello all,

I have a problem with Windows, accented characters and lfs.

My code is something like this:


for entry in lfs.dir(dir) do
  ...
end

and I have a file named 'c?w.pdf'

(LATIN SMALL LETTER O WITH DIAERESIS, U+00F6)

and the "entry" variable above has the bytes

63 F6 77 2E 70 64 66
c  ?  w  .  p  d  f


So the ? is encoded as F6.

Is it possible to get utf8 encoding there? Or do I need a mapping such as:

filename on disk -> utf8 -> filename on disk (for file access)?

Any advice on this topic?

Patrick






From j.hagen at xs4all.nl  Fri Sep 28 12:06:14 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Fri, 28 Sep 2018 12:06:14 +0200
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
Message-ID: <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>

On 9/28/2018 9:19 AM, Patrick Gundlach wrote:
> Hello all,
> 
> I have a problem with Windows, accented characters and lfs.
> 
> My code is something like this:
> 
> 
> for entry in lfs.dir(dir) do
>    ...
> end
> 
> and I have a file named 'c?w.pdf'
> 
> (LATIN SMALL LETTER O WITH DIAERESIS, U+00F6)
> 
> and the "entry" variable above has the bytes
> 
> 63 F6 77 2E 70 64 66
> c  ?  w  .  p  d  f
> 
> 
> So the ? is encoded as F6.
> 
> Is it possible to get utf8 encoding there? Or do I need a mapping such as:
> 
> filename on disk -> utf8 -> filename on disk (for file access)?
> 
> Any advice on this topic?
afaik windows has no utf filenames, so when i save a file with that name 
i get

  c??w.txt

(internally i think names become unicode16 and display depends on the 
code page)

so, if you see

63 F6 77 2E 70 64 66

that's just bytes ... so you nee to recode

i'll mail you a solution

Hans




-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From harald.hanche-olsen at ntnu.no  Fri Sep 28 13:07:50 2018
From: harald.hanche-olsen at ntnu.no (Harald Hanche-Olsen)
Date: Fri, 28 Sep 2018 13:07:50 +0200
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
 <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
Message-ID: <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>

From:?Hans Hagen <j.hagen at xs4all.nl>
Date:?28 September 2018 at 12:07:03

afaik windows has no utf filenames, so when i save a file with that name?
i get?

c??w.txt?

(internally i think names become unicode16 and display depends on the?
code page)?

so, if you see?

63 F6 77 2E 70 64 66?

that's just bytes ... so you nee to recode?
I found this answer on stackoverflow (https://stackoverflow.com/a/2051018/1842907):

????






NTFS stores filenames in UTF16, however fopen is using ANSI (not utf8).

In order to use an UTF16-encoded file name you will need to use the Unicode versions of the file open calls. Do this by defineing UNICODE and _UNICODE in your project. Then use the CreateFile call or the wfopen call.

????

Does luatex not do this on windows systems? Perhaps it ought to?

(But I am not a windows user myself, nor do I know much about windows, so I have nothing to contribute other than this reference. Sorry if it is off the mark or irrelevant.)

? Harald
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://tug.org/pipermail/luatex/attachments/20180928/fbf97c2c/attachment.html>

From patrick at gundla.ch  Fri Sep 28 14:48:21 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 28 Sep 2018 14:48:21 +0200
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
 <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
 <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
Message-ID: <DDBBC524-BAEE-4885-8375-9A1243563575@gundla.ch>

Thank you, Harald and Hans for your answers on this topic.

I have done some (little) further research and I found out, that filenames with characters outside the CP 1250 get converted to a "?" which is not good...

I use Lua file system (lfs) to build a list of available files and then filename lookup is done with the entries I get back. So when a user request

c?w.pdf

I do a static lookup and return "file does not exist" if it is not in my list. And since lfs does not return the correct file name, the file is not in my list, even though it is on the drive.

So even with a mapping (thanks Hans!) I can't do very much. (I will use another external library for the lookup now).


Thanks

  Patrick




From patrick at gundla.ch  Fri Sep 28 15:19:56 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Fri, 28 Sep 2018 15:19:56 +0200
Subject: [luatex] callback for image loading?
Message-ID: <B6FCAE74-967B-40BA-8B6A-C390A6F2DA55@gundla.ch>

Hello all,

is there a callback for image loading (reading)?

I use

img.scan{filename = "some filename" }

which (if I understand it correctly) calls find_image_file (with kpathsea disabled) but no reader callback. 

Why I am asking: I have an image caching mechanism for images got via http(s) and I'd like to serve these images from memory.

Patrick




From j.hagen at xs4all.nl  Fri Sep 28 15:48:03 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Fri, 28 Sep 2018 15:48:03 +0200
Subject: [luatex] callback for image loading?
In-Reply-To: <B6FCAE74-967B-40BA-8B6A-C390A6F2DA55@gundla.ch>
References: <B6FCAE74-967B-40BA-8B6A-C390A6F2DA55@gundla.ch>
Message-ID: <a1dec24a-9f87-3f08-4b8f-2678efcbfd30@xs4all.nl>

On 9/28/2018 3:19 PM, Patrick Gundlach wrote:
> Hello all,
> 
> is there a callback for image loading (reading)?
> 
> I use
> 
> img.scan{filename = "some filename" }
> 
> which (if I understand it correctly) calls find_image_file (with kpathsea disabled) but no reader callback.
> 
> Why I am asking: I have an image caching mechanism for images got via http(s) and I'd like to serve these images from memory.
no, because luatex parses the image (random access) and buffering huge 
bitmaps is not really an option

what i do in such case i cache on disk

Hans


-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From maxwell at umiacs.umd.edu  Fri Sep 28 20:17:20 2018
From: maxwell at umiacs.umd.edu (maxwell)
Date: Fri, 28 Sep 2018 14:17:20 -0400
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
 <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
 <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
Message-ID: <7512be5e600f0d038f5278795b2b78fe@umiacs.umd.edu>

On 2018-09-28 07:07, Harald Hanche-Olsen wrote:
> From:?Hans Hagen <j.hagen at xs4all.nl>
> Date:?28 September 2018 at 12:07:03
> 
> afaik windows has no utf filenames, so when i save a file with that 
> name?
> i get?
> 
> c??w.txt?
> 
> (internally i think names become unicode16 and display depends on the?
> code page)?
> ...
> (But I am not a windows user myself, nor do I know much about windows,
> so I have nothing to contribute other than this reference. Sorry if it
> is off the mark or irrelevant.)

I think this is fundamentally correct, but just in case: Windows 
supports Unicode UTF-16 in file names in NTFS-based file systems (but 
not in the earlier FATxx file systems).  NTFS was introduced in Windows 
NT in 1993, and became a part of consumer-based Windows systems with 
Windows 2000:
     https://en.wikipedia.org/wiki/NTFS
If you're getting weird characters (like in the line quoted above), it's 
likely that you're viewing them in a non-UTF16 application.  So yes, in 
such applications the display depends on the code page--although code 
pages themselves are largely deprecated in modern versions of Windows, 
in favor of Unicode:
     
https://en.wikipedia.org/wiki/Windows_code_page#Problems_arising_from_the_use_of_code_pages

    Mike Maxwell

From reinhard.kotucha at web.de  Fri Sep 28 21:25:59 2018
From: reinhard.kotucha at web.de (Reinhard Kotucha)
Date: Fri, 28 Sep 2018 21:25:59 +0200
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <7512be5e600f0d038f5278795b2b78fe@umiacs.umd.edu>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
 <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
 <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
 <7512be5e600f0d038f5278795b2b78fe@umiacs.umd.edu>
Message-ID: <23470.32839.750326.797404@gargle.gargle.HOWL>

On 2018-09-28 at 14:17:20 -0400, maxwell wrote:

 > On 2018-09-28 07:07, Harald Hanche-Olsen wrote:
 > > From:?Hans Hagen <j.hagen at xs4all.nl>
 > > Date:?28 September 2018 at 12:07:03
 > > 
 > > afaik windows has no utf filenames, so when i save a file with that 
 > > name?
 > > i get?
 > > 
 > > c??w.txt?
 > > 
 > > (internally i think names become unicode16 and display depends on
 > > the? code page)? ...  (But I am not a windows user myself, nor do
 > > I know much about windows, so I have nothing to contribute other
 > > than this reference. Sorry if it is off the mark or irrelevant.)
 > 
 > I think this is fundamentally correct, but just in case: Windows
 > supports Unicode UTF-16 in file names in NTFS-based file systems
 > (but not in the earlier FATxx file systems).  NTFS was introduced
 > in Windows NT in 1993, and became a part of consumer-based Windows
 > systems with Windows 2000: https://en.wikipedia.org/wiki/NTFS If
 > you're getting weird characters (like in the line quoted above),
 > it's likely that you're viewing them in a non-UTF16 application.
 > So yes, in such applications the display depends on the code
 > page--although code pages themselves are largely deprecated in
 > modern versions of Windows, in favor of Unicode:
 >      
 > https://en.wikipedia.org/wiki/Windows_code_page#Problems_arising_from_the_use_of_code_pages

It's not sufficient to declare code pages deprecated as long as they
are unavoidable.  The default code page of the CLI is CP850 in Western
Europe.  According to Phil Taylor it's possible to switch to UTF-8
with

  chcp 65001

but this only works if the font used in the terminal window is "Lucida
Console".  I can't imagine why it depends on a particular font but I
tried and it obviously works.

The font change is permanent.  When you start a new terminal window
you get the same font until you change it again.

In order to make CP65001 the default you have to edit the registry.
See

  https://superuser.com/questions/269818/change-default-code-page-of-windows-console-to-utf-8

Maybe a few problems can be avoided if the CLI is configured to use
UTF-8 by default.  Sure, many problems can't be resolved this way.

Regards,
  Reinhard

-- 
------------------------------------------------------------------
Reinhard Kotucha                            Phone: +49-511-3373112
Marschnerstr. 25
D-30167 Hannover                    mailto:reinhard.kotucha at web.de
------------------------------------------------------------------


From j.hagen at xs4all.nl  Fri Sep 28 22:50:48 2018
From: j.hagen at xs4all.nl (Hans Hagen)
Date: Fri, 28 Sep 2018 22:50:48 +0200
Subject: [luatex] Accented characters on Windows / lfs
In-Reply-To: <23470.32839.750326.797404@gargle.gargle.HOWL>
References: <DB0C5866-404C-471D-8544-C20ECD63BC99@gundla.ch>
 <2fc9450e-bcb0-07c1-12bd-2fdb25fd9495@xs4all.nl>
 <etPan.5bae0b86.7e30af1b.83a8@ntnu.no>
 <7512be5e600f0d038f5278795b2b78fe@umiacs.umd.edu>
 <23470.32839.750326.797404@gargle.gargle.HOWL>
Message-ID: <1d67384d-9bb9-2e53-1480-9ceb8c7e69ef@xs4all.nl>

On 9/28/2018 9:25 PM, Reinhard Kotucha wrote:
> On 2018-09-28 at 14:17:20 -0400, maxwell wrote:
> 
>   > On 2018-09-28 07:07, Harald Hanche-Olsen wrote:
>   > > From:?Hans Hagen <j.hagen at xs4all.nl>
>   > > Date:?28 September 2018 at 12:07:03
>   > >
>   > > afaik windows has no utf filenames, so when i save a file with that
>   > > name
>   > > i get
>   > >
>   > > c??w.txt
>   > >
>   > > (internally i think names become unicode16 and display depends on
>   > > the? code page)? ...  (But I am not a windows user myself, nor do
>   > > I know much about windows, so I have nothing to contribute other
>   > > than this reference. Sorry if it is off the mark or irrelevant.)
>   >
>   > I think this is fundamentally correct, but just in case: Windows
>   > supports Unicode UTF-16 in file names in NTFS-based file systems
>   > (but not in the earlier FATxx file systems).  NTFS was introduced
>   > in Windows NT in 1993, and became a part of consumer-based Windows
>   > systems with Windows 2000: https://en.wikipedia.org/wiki/NTFS If
>   > you're getting weird characters (like in the line quoted above),
>   > it's likely that you're viewing them in a non-UTF16 application.
>   > So yes, in such applications the display depends on the code
>   > page--although code pages themselves are largely deprecated in
>   > modern versions of Windows, in favor of Unicode:
>   >
>   > https://en.wikipedia.org/wiki/Windows_code_page#Problems_arising_from_the_use_of_code_pages
> 
> It's not sufficient to declare code pages deprecated as long as they
> are unavoidable.  The default code page of the CLI is CP850 in Western
> Europe.  According to Phil Taylor it's possible to switch to UTF-8
> with
> 
>    chcp 65001
> 
> but this only works if the font used in the terminal window is "Lucida
> Console".  I can't imagine why it depends on a particular font but I
> tried and it obviously works.

i've been using dejavu nono for many years with success with utf in the 
console

(btw, the console code in recent windows 10 is rewritten and also much 
faster)

Hans

-----------------------------------------------------------------
                                           Hans Hagen | PRAGMA ADE
               Ridderstraat 27 | 8061 GH Hasselt | The Netherlands
        tel: 038 477 53 69 | www.pragma-ade.nl | www.pragma-pod.nl
-----------------------------------------------------------------

From patrick at gundla.ch  Sun Sep 30 11:45:32 2018
From: patrick at gundla.ch (Patrick Gundlach)
Date: Sun, 30 Sep 2018 11:45:32 +0200
Subject: [luatex] More on loading non-ascii filenames on windows
Message-ID: <BE457A3A-22BC-4E82-A186-59593D053CB1@gundla.ch>

Hello again,

I am still struggling with loading images with filenames on windows. (My test environment is windows 7, 32 bit)

I now bypass lua file system to build a file list, so I have all filenames encoded as UTF-8. Now I try to pass a filename to 

img.scan{...}

But as I understand, Windows is not happy about the UTF8 filenames, so what should I do?

! error:  (pdf backend): reading image file 'Z:\foo\c?w.pdf' failed
!  ==> Fatal error occurred, no output PDF file produced!

I have tried to pass the CP1250 value for ? (\f6) but this gives me:

I/O Error: Couldn't open file 'c<f6>w.pdf': No error.

! error:  (pdf inclusion): reading image failed
!  ==> Fatal error occurred, no output PDF file produced!


So, I am clueless....



Patrick

From luatex at nililand.de  Sun Sep 30 16:21:28 2018
From: luatex at nililand.de (Ulrike Fischer)
Date: Sun, 30 Sep 2018 16:21:28 +0200
Subject: [luatex] More on loading non-ascii filenames on windows
References: <BE457A3A-22BC-4E82-A186-59593D053CB1@gundla.ch>
Message-ID: <1kgcborgezdvu.dlg@nililand.de>

Am Sun, 30 Sep 2018 11:45:32 +0200 schrieb Patrick Gundlach:

> Hello again,
> 
> I am still struggling with loading images with filenames on windows. (My test environment is windows 7, 32 bit)
> 
> I now bypass lua file system to build a file list, so I have all filenames encoded as UTF-8. Now I try to pass a filename to 
> 
> img.scan{...}
> 
> But as I understand, Windows is not happy about the UTF8 filenames, so what should I do?
> 
> ! error:  (pdf backend): reading image file 'Z:\foo\c?w.pdf' failed
> !  ==> Fatal error occurred, no output PDF file produced!
> 
> I have tried to pass the CP1250 value for ? (\f6) but this gives me:
> 
> I/O Error: Couldn't open file 'c<f6>w.pdf': No error.
> 
> ! error:  (pdf inclusion): reading image failed
> !  ==> Fatal error occurred, no output PDF file produced!
> 

I tried on a windows 10 laptop

\documentclass{article}
\begin{document}%
\directlua{
a = img.write({ filename = "c?w.pdf"}) 
}
\end{document}

It works with miktex (luatex 1.07) but fails with texlive (1.07 +
1.09). 

You could ask on the texlive list, but imho it would be better to
avoid such names. The majority of crashes I saw in last years was
connected to non-ascii in graphics and other files. 


-- 
Ulrike Fischer 
https://www.troubleshooting-tex.de/


